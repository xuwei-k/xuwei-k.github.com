<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>play/play/data/Form.java</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> play.data;

<span class="keyword">import</span> javax.validation.*;
<span class="keyword">import</span> javax.validation.metadata.*;

<span class="keyword">import</span> java.util.*;
<span class="keyword">import</span> java.lang.annotation.*;

<span class="keyword">import</span> <span title="object java.lang.annotation.ElementType">static</span> java.lang.annotation.ElementType.*;
<span class="keyword">import</span> <span title="object java.lang.annotation.RetentionPolicy">static</span> java.lang.annotation.RetentionPolicy.*;

<span class="keyword">import</span> play.libs.F;
<span class="keyword">import</span> play.mvc.Http;
<span class="keyword">import</span> <a href="../libs/F.java.html#20914" title="object play.libs.F">static</a> play.libs.F.*;

<span class="keyword">import</span> play.data.validation.*;

<span class="keyword">import</span> org.springframework.beans.*;
<span class="keyword">import</span> org.springframework.validation.*;
<span class="keyword">import</span> org.springframework.validation.beanvalidation.*;

<span class="keyword">import</span> org.hibernate.validator.engine.*;

<span class="comment">/**
 * Helper to manage HTML form description, submission and validation.
 */</span>
public <span class="keyword">class</span> <a title="object play.data.Form" id="20594">Form</a>&lt;<a title="Nothing" id="20623">T</a>&gt; <span class="delimiter">{</span>
    
    <span class="comment">/**
     * Defines a form element's display name.
     */</span>
    @Retention<span class="delimiter">(</span>RUNTIME<span class="delimiter">)</span>
    @Target<span class="delimiter">(</span><span class="delimiter">{</span>ANNOTATION_TYPE<span class="delimiter">}</span><span class="delimiter">)</span>
    public static @interface <a title="object play.data.Form.Display" id="236832">Display</a> <span class="delimiter">{</span>
        String name<span class="delimiter">(</span><span class="delimiter">)</span>;
        String<span class="delimiter">[</span><span class="delimiter">]</span> <span title="">attributes</span><span class="delimiter">(</span><span class="delimiter">)</span> default <span class="delimiter">{</span><span class="delimiter">}</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">// --</span>
    
    <span class="keyword">private</span> <span class="keyword">final</span> String <a title="java.lang.String" id="382002">rootName</a>;
    <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;<a href="#20623" title="T">T</a>&gt; <a title="java.lang.Class[T]" id="382003">backedType</a>;
    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String,String&gt; <a title="java.util.Map[java.lang.String,java.lang.String]" id="382004">data</a>;
    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String,List&lt;ValidationError&gt;&gt; <a title="java.util.Map[java.lang.String,java.util.List[play.data.validation.ValidationError]]" id="382005">errors</a>;
    <span class="keyword">private</span> <span class="keyword">final</span> Option&lt;<a href="#20623" title="T">T</a>&gt; <a title="play.libs.F.Option[T]" id="382006">value</a>;
    
    <span class="keyword">private</span> <a href="#20623" title="T">T</a> <a title="()T" id="382007">blankInstance</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">try</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> backedType.newInstance<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span> <span class="keyword">catch</span><span class="delimiter">(</span>Exception e<span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException<span class="delimiter">(</span><span class="string">&quot;Cannot instantiate &quot;</span> + backedType + <span class="string">&quot;. It must have a default constructor&quot;</span>, e<span class="delimiter">)</span>;
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Creates a new &lt;code&gt;Form&lt;/code&gt;.
     *
     * @param clazz wrapped class
     */</span>
    public Form<span class="delimiter">(</span>Class&lt;T&gt; clazz<span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">this</span><span class="delimiter">(</span><span class="keyword">null</span>, clazz<span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    public Form<a title="(name: java.lang.String, clazz: java.lang.Class[T])play.data.Form[T]" id="382009" class="delimiter">(</a>String <a title="java.lang.String" id="382040">name</a>, Class&lt;<a href="#20623" title="T">T</a>&gt; <a title="java.lang.Class[T]" id="382041">clazz</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">this</span><span class="delimiter">(</span>name, clazz, <span class="keyword">new</span> HashMap&lt;String,String&gt;<span class="delimiter">(</span><span class="delimiter">)</span>, <span class="keyword">new</span> HashMap&lt;String,List&lt;ValidationError&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span>, None<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Creates a new &lt;code&gt;Form&lt;/code&gt;.
     *
     * @param clazz wrapped class
     * @param data the current form data (used to display the form)
     * @param errors the collection of errors associated with this form
     * @param value optional concrete value of type &lt;code&gt;T&lt;/code&gt; if the form submission was successful
     */</span>
    public Form<a title="(rootName: java.lang.String, clazz: java.lang.Class[T], data: java.util.Map[java.lang.String,java.lang.String], errors: java.util.Map[java.lang.String,java.util.List[play.data.validation.ValidationError]], value: play.libs.F.Option[T])play.data.Form[T]" id="382010" class="delimiter">(</a>String <a title="java.lang.String" id="382043">rootName</a>, Class&lt;<a href="#20623" title="T">T</a>&gt; <a title="java.lang.Class[T]" id="382044">clazz</a>, Map&lt;String,String&gt; <a title="java.util.Map[java.lang.String,java.lang.String]" id="382045">data</a>, Map&lt;String,List&lt;ValidationError&gt;&gt; <a title="java.util.Map[java.lang.String,java.util.List[play.data.validation.ValidationError]]" id="382046">errors</a>, Option&lt;<a href="#20623" title="T">T</a>&gt; <a title="play.libs.F.Option[T]" id="382047">value</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">this</span>.rootName = rootName;
        <span class="keyword">this</span>.backedType = clazz;
        <span class="keyword">this</span>.data = data;
        <span class="keyword">this</span>.errors = errors;
        <span class="keyword">this</span>.value = value;
    <span class="delimiter">}</span>
    
    <span class="keyword">protected</span> Map&lt;String,String&gt; <a title="()java.util.Map[java.lang.String,java.lang.String]" id="382011">requestData</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        
        Map&lt;String,String<span class="delimiter">[</span><span class="delimiter">]</span>&gt; urlFormEncoded = <span class="keyword">new</span> HashMap&lt;String,String<span class="delimiter">[</span><span class="delimiter">]</span>&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">if</span><span class="delimiter">(</span>play.mvc.Controller.request<span class="delimiter">(</span><span class="delimiter">)</span>.body<span class="delimiter">(</span><span class="delimiter">)</span>.asFormUrlEncoded<span class="delimiter">(</span><span class="delimiter">)</span> != <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            urlFormEncoded = play.mvc.Controller.request<span class="delimiter">(</span><span class="delimiter">)</span>.body<span class="delimiter">(</span><span class="delimiter">)</span>.asFormUrlEncoded<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        
        Map&lt;String,String<span class="delimiter">[</span><span class="delimiter">]</span>&gt; multipartFormData = <span class="keyword">new</span> HashMap&lt;String,String<span class="delimiter">[</span><span class="delimiter">]</span>&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">if</span><span class="delimiter">(</span>play.mvc.Controller.request<span class="delimiter">(</span><span class="delimiter">)</span>.body<span class="delimiter">(</span><span class="delimiter">)</span>.asMultipartFormData<span class="delimiter">(</span><span class="delimiter">)</span> != <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            multipartFormData = play.mvc.Controller.request<span class="delimiter">(</span><span class="delimiter">)</span>.body<span class="delimiter">(</span><span class="delimiter">)</span>.asMultipartFormData<span class="delimiter">(</span><span class="delimiter">)</span>.asFormUrlEncoded<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        
        Map&lt;String,String&gt; jsonData = <span class="keyword">new</span> HashMap&lt;String,String&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">if</span><span class="delimiter">(</span>play.mvc.Controller.request<span class="delimiter">(</span><span class="delimiter">)</span>.body<span class="delimiter">(</span><span class="delimiter">)</span>.asJson<span class="delimiter">(</span><span class="delimiter">)</span> != <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            jsonData = play.libs.Scala.asJava<span class="delimiter">(</span>
                play.api.data.FormUtils.fromJson<span class="delimiter">(</span><span class="string">&quot;&quot;</span>, 
                    play.api.libs.json.Json.parse<span class="delimiter">(</span>
                        play.libs.Json.stringify<span class="delimiter">(</span>play.mvc.Controller.request<span class="delimiter">(</span><span class="delimiter">)</span>.body<span class="delimiter">(</span><span class="delimiter">)</span>.asJson<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
                    <span class="delimiter">)</span>
                <span class="delimiter">)</span>
            <span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        
        Map&lt;String,String<span class="delimiter">[</span><span class="delimiter">]</span>&gt; queryString = play.mvc.Controller.request<span class="delimiter">(</span><span class="delimiter">)</span>.queryString<span class="delimiter">(</span><span class="delimiter">)</span>;
        
        Map&lt;String,String&gt; data = <span class="keyword">new</span> HashMap&lt;String,String&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
        
        <span class="keyword">for</span><span class="delimiter">(</span>String key: urlFormEncoded.keySet<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            String<span class="delimiter">[</span><span class="delimiter">]</span> value = urlFormEncoded.get<span class="delimiter">(</span>key<span class="delimiter">)</span>;
            <span class="keyword">if</span><span class="delimiter">(</span>value.length &gt; <span class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                data.put<span class="delimiter">(</span>key, value<span class="delimiter">[</span><span class="int">0</span><span class="delimiter">]</span><span class="delimiter">)</span>;
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        
        <span class="keyword">for</span><span class="delimiter">(</span>String key: multipartFormData.keySet<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            String<span class="delimiter">[</span><span class="delimiter">]</span> value = multipartFormData.get<span class="delimiter">(</span>key<span class="delimiter">)</span>;
            <span class="keyword">if</span><span class="delimiter">(</span>value.length &gt; <span class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                data.put<span class="delimiter">(</span>key, value<span class="delimiter">[</span><span class="int">0</span><span class="delimiter">]</span><span class="delimiter">)</span>;
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        
        <span class="keyword">for</span><span class="delimiter">(</span>String key: jsonData.keySet<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            data.put<span class="delimiter">(</span>key, jsonData.get<span class="delimiter">(</span>key<span class="delimiter">)</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        
        <span class="keyword">for</span><span class="delimiter">(</span>String key: queryString.keySet<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            String<span class="delimiter">[</span><span class="delimiter">]</span> value = queryString.get<span class="delimiter">(</span>key<span class="delimiter">)</span>;
            <span class="keyword">if</span><span class="delimiter">(</span>value.length &gt; <span class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                data.put<span class="delimiter">(</span>key, value<span class="delimiter">[</span><span class="int">0</span><span class="delimiter">]</span><span class="delimiter">)</span>;
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        
        <span class="keyword">return</span> data;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Binds request data to this form - that is, handles form submission.
     *
     * @return a copy of this form filled with the new data
     */</span>
    public <a href="#20594" title="play.data.Form">Form</a>&lt;<a href="#20623" title="T">T</a>&gt; <a title="(allowedFields: &lt;repeated...&gt;[java.lang.String])play.data.Form[T]" id="382012">bindFromRequest</a><span class="delimiter">(</span><span title="&lt;repeated...&gt;">String</span>... <a title="&lt;repeated...&gt;[java.lang.String]" id="382048">allowedFields</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">return</span> bind<span class="delimiter">(</span>requestData<span class="delimiter">(</span><span class="delimiter">)</span>, allowedFields<span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Binds Json data to this form - that is, handles form submission.
     *
     * @param data data to submit
     * @return a copy of this form filled with the new data
     */</span>
    public <a href="#20594" title="play.data.Form">Form</a>&lt;<a href="#20623" title="T">T</a>&gt; <a title="(data: org.codehaus.jackson.JsonNode, allowedFields: &lt;repeated...&gt;[java.lang.String])play.data.Form[T]" id="382013">bind</a><span class="delimiter">(</span>org.codehaus.jackson.<span title="org.codehaus.jackson.JsonNode">JsonNode</span> <a title="org.codehaus.jackson.JsonNode" id="382049">data</a>, <span title="&lt;repeated...&gt;">String</span>... <a title="&lt;repeated...&gt;[java.lang.String]" id="382050">allowedFields</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">return</span> bind<span class="delimiter">(</span>
            play.libs.Scala.asJava<span class="delimiter">(</span>
                play.api.data.FormUtils.fromJson<span class="delimiter">(</span><span class="string">&quot;&quot;</span>, 
                    play.api.libs.json.Json.parse<span class="delimiter">(</span>
                        play.libs.Json.stringify<span class="delimiter">(</span>data<span class="delimiter">)</span>
                    <span class="delimiter">)</span>
                <span class="delimiter">)</span>
            <span class="delimiter">)</span>,
            allowedFields
        <span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Binds data to this form - that is, handles form submission.
     *
     * @param data data to submit
     * @return a copy of this form filled with the new data
     */</span>
    public <a href="#20594" title="play.data.Form">Form</a>&lt;<a href="#20623" title="T">T</a>&gt; <a title="(data: java.util.Map[java.lang.String,java.lang.String], allowedFields: &lt;repeated...&gt;[java.lang.String])play.data.Form[T]" id="382014">bind</a><span class="delimiter">(</span>Map&lt;String,String&gt; <a title="java.util.Map[java.lang.String,java.lang.String]" id="382051">data</a>, <span title="&lt;repeated...&gt;">String</span>... <a title="&lt;repeated...&gt;[java.lang.String]" id="382052">allowedFields</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        
        DataBinder dataBinder = <span class="keyword">null</span>;
        Map&lt;String, String&gt; objectData = data;
        <span class="keyword">if</span><span class="delimiter">(</span>rootName == <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            dataBinder = <span class="keyword">new</span> DataBinder<span class="delimiter">(</span>blankInstance<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            dataBinder = <span class="keyword">new</span> DataBinder<span class="delimiter">(</span>blankInstance<span class="delimiter">(</span><span class="delimiter">)</span>, rootName<span class="delimiter">)</span>;
            objectData = <span class="keyword">new</span> HashMap&lt;String,String&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
            <span class="keyword">for</span><span class="delimiter">(</span>String key: data.keySet<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">if</span><span class="delimiter">(</span>key.startsWith<span class="delimiter">(</span>rootName + <span class="string">&quot;.&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                    objectData.put<span class="delimiter">(</span>key.substring<span class="delimiter">(</span>rootName.length<span class="delimiter">(</span><span class="delimiter">)</span> + <span class="int">1</span><span class="delimiter">)</span>, data.get<span class="delimiter">(</span>key<span class="delimiter">)</span><span class="delimiter">)</span>;
                <span class="delimiter">}</span>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span class="keyword">if</span><span class="delimiter">(</span>allowedFields.length &gt; <span class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            dataBinder.setAllowedFields<span class="delimiter">(</span>allowedFields<span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        dataBinder.setValidator<span class="delimiter">(</span><span class="keyword">new</span> SpringValidatorAdapter<span class="delimiter">(</span>play.data.validation.Validation.getValidator<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        dataBinder.setConversionService<span class="delimiter">(</span>play.data.format.Formatters.conversion<span class="delimiter">)</span>;
        dataBinder.setAutoGrowNestedPaths<span class="delimiter">(</span><span class="keyword">true</span><span class="delimiter">)</span>;
        dataBinder.bind<span class="delimiter">(</span><span class="keyword">new</span> MutablePropertyValues<span class="delimiter">(</span>objectData<span class="delimiter">)</span><span class="delimiter">)</span>;
        dataBinder.validate<span class="delimiter">(</span><span class="delimiter">)</span>;
        BindingResult result = dataBinder.getBindingResult<span class="delimiter">(</span><span class="delimiter">)</span>;
        
        <span class="keyword">if</span><span class="delimiter">(</span>result.hasErrors<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            Map&lt;String,List&lt;ValidationError&gt;&gt; errors = <span class="keyword">new</span> HashMap&lt;String,List&lt;ValidationError&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
            <span class="keyword">for</span><span class="delimiter">(</span>FieldError error: result.getFieldErrors<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                String key = error.getObjectName<span class="delimiter">(</span><span class="delimiter">)</span> + <span class="string">&quot;.&quot;</span> + error.getField<span class="delimiter">(</span><span class="delimiter">)</span>;
                <span class="keyword">if</span><span class="delimiter">(</span>key.startsWith<span class="delimiter">(</span><span class="string">&quot;target.&quot;</span><span class="delimiter">)</span> &amp;&amp; rootName == <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                    key = key.substring<span class="delimiter">(</span><span class="int">7</span><span class="delimiter">)</span>;
                <span class="delimiter">}</span>
                List&lt;Object&gt; arguments = <span class="keyword">new</span> ArrayList&lt;Object&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
                <span class="keyword">for</span><span class="delimiter">(</span>Object arg: error.getArguments<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                    <span class="keyword">if</span><span class="delimiter">(</span>!<span class="delimiter">(</span>arg instanceof org.springframework.context.support.DefaultMessageSourceResolvable<span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                        arguments.add<span class="delimiter">(</span>arg<span class="delimiter">)</span>;
                    <span class="delimiter">}</span>                    
                <span class="delimiter">}</span>
                <span class="keyword">if</span><span class="delimiter">(</span>!errors.containsKey<span class="delimiter">(</span>key<span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                   errors.put<span class="delimiter">(</span>key, <span class="keyword">new</span> ArrayList&lt;ValidationError&gt;<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>; 
                <span class="delimiter">}</span>
                errors.get<span class="delimiter">(</span>key<span class="delimiter">)</span>.add<span class="delimiter">(</span><span class="keyword">new</span> ValidationError<span class="delimiter">(</span>key, error.isBindingFailure<span class="delimiter">(</span><span class="delimiter">)</span> ? <span class="string">&quot;error.invalid&quot;</span> : error.getDefaultMessage<span class="delimiter">(</span><span class="delimiter">)</span>, arguments<span class="delimiter">)</span><span class="delimiter">)</span>;                    
            <span class="delimiter">}</span>
            <span class="keyword">return</span> <span class="keyword">new</span> Form<span class="delimiter">(</span>rootName, backedType, data, errors, None<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            String globalError = <span class="keyword">null</span>;
            <span class="keyword">if</span><span class="delimiter">(</span>result.getTarget<span class="delimiter">(</span><span class="delimiter">)</span> != <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">try</span> <span class="delimiter">{</span>
                    java.lang.reflect.Method v = result.getTarget<span class="delimiter">(</span><span class="delimiter">)</span>.getClass<span class="delimiter">(</span><span class="delimiter">)</span>.getMethod<span class="delimiter">(</span><span class="string">&quot;validate&quot;</span><span class="delimiter">)</span>;
                    globalError = <span class="delimiter">(</span>String<span class="delimiter">)</span>v.invoke<span class="delimiter">(</span>result.getTarget<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
                <span class="delimiter">}</span> <span class="keyword">catch</span><span class="delimiter">(</span>NoSuchMethodException e<span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="delimiter">}</span> <span class="keyword">catch</span><span class="delimiter">(</span>Throwable e<span class="delimiter">)</span> <span class="delimiter">{</span>
                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException<span class="delimiter">(</span>e<span class="delimiter">)</span>;
                <span class="delimiter">}</span>
            <span class="delimiter">}</span>
            <span class="keyword">if</span><span class="delimiter">(</span>globalError != <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                Map&lt;String,List&lt;ValidationError&gt;&gt; errors = <span class="keyword">new</span> HashMap&lt;String,List&lt;ValidationError&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
                errors.put<span class="delimiter">(</span><span class="string">&quot;&quot;</span>, <span class="keyword">new</span> ArrayList&lt;ValidationError&gt;<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
                errors.get<span class="delimiter">(</span><span class="string">&quot;&quot;</span><span class="delimiter">)</span>.add<span class="delimiter">(</span><span class="keyword">new</span> ValidationError<span class="delimiter">(</span><span class="string">&quot;&quot;</span>, globalError, <span class="keyword">new</span> ArrayList<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>;
                <span class="keyword">return</span> <span class="keyword">new</span> Form<span class="delimiter">(</span>rootName, backedType, data, errors, None<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
            <span class="delimiter">}</span>
            <span class="keyword">return</span> <span class="keyword">new</span> Form<span class="delimiter">(</span>rootName, backedType, <span class="keyword">new</span> HashMap&lt;String,String&gt;<span class="delimiter">(</span>data<span class="delimiter">)</span>, <span class="keyword">new</span> HashMap&lt;String,List&lt;ValidationError&gt;&gt;<span class="delimiter">(</span>errors<span class="delimiter">)</span>, Some<span class="delimiter">(</span><span class="delimiter">(</span>T<span class="delimiter">)</span>result.getTarget<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Retrieves the actual form data.
     */</span>
    public Map&lt;String,String&gt; <a title="()java.util.Map[java.lang.String,java.lang.String]" id="382015">data</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">return</span> data;
    <span class="delimiter">}</span>
    
    public String <a title="()java.lang.String" id="382016">name</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">return</span> rootName;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Retrieves the actual form value.
     */</span>
    public Option&lt;<a href="#20623" title="T">T</a>&gt; <a title="()play.libs.F.Option[T]" id="382017">value</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">return</span> value;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Populates this form with an existing value, used for edit forms.
     *
     * @param value existing value of type &lt;code&gt;T&lt;/code&gt; used to fill this form
     * @return a copy of this form filled with the new data
     */</span>
    public <a href="#20594" title="play.data.Form">Form</a>&lt;<a href="#20623" title="T">T</a>&gt; <a title="(value: T)play.data.Form[T]" id="382018">fill</a><span class="delimiter">(</span><a href="#20623" title="T">T</a> <a title="T" id="382053">value</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">if</span><span class="delimiter">(</span>value == <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException<span class="delimiter">(</span><span class="string">&quot;Cannot fill a form with a null value&quot;</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        <span class="keyword">return</span> <span class="keyword">new</span> Form<span class="delimiter">(</span>rootName, backedType, <span class="keyword">new</span> HashMap&lt;String,String&gt;<span class="delimiter">(</span><span class="delimiter">)</span>, <span class="keyword">new</span> HashMap&lt;String,ValidationError&gt;<span class="delimiter">(</span><span class="delimiter">)</span>, Some<span class="delimiter">(</span>value<span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Returns &lt;code&gt;true&lt;code&gt; if there are any errors related to this form.
     */</span>
    public boolean <a title="()Boolean" id="382019">hasErrors</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">return</span> !errors.isEmpty<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Returns &lt;code&gt;true&lt;code&gt; if there any global errors related to this form.
     */</span>
    public boolean <a title="()Boolean" id="382020">hasGlobalErrors</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">return</span> errors.containsKey<span class="delimiter">(</span><span class="string">&quot;&quot;</span><span class="delimiter">)</span> &amp;&amp; !errors.get<span class="delimiter">(</span><span class="string">&quot;&quot;</span><span class="delimiter">)</span>.isEmpty<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Retrieve all global errors - errors without a key.
     *
     * @return All global errors.
     */</span>
    public List&lt;ValidationError&gt; <a title="()java.util.List[play.data.validation.ValidationError]" id="382021">globalErrors</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        List&lt;ValidationError&gt; e = errors.get<span class="delimiter">(</span><span class="string">&quot;&quot;</span><span class="delimiter">)</span>;
        <span class="keyword">if</span><span class="delimiter">(</span>e == <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            e = <span class="keyword">new</span> ArrayList&lt;ValidationError&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        <span class="keyword">return</span> e;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Retrieves the first global error (an error without any key), if it exists.
     *
     * @return An error or &lt;code&gt;null&lt;/code&gt;.
     */</span>
    public ValidationError <a title="()play.data.validation.ValidationError" id="382022">globalError</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        List&lt;ValidationError&gt; errors = globalErrors<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">if</span><span class="delimiter">(</span>errors.isEmpty<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> <span class="keyword">null</span>;
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> errors.get<span class="delimiter">(</span><span class="int">0</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Returns all errors.
     *
     * @return All errors associated with this form.
     */</span>
    public Map&lt;String,List&lt;ValidationError&gt;&gt; <a title="()java.util.Map[java.lang.String,java.util.List[play.data.validation.ValidationError]]" id="382023">errors</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">return</span> errors;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Retrieve an error by key.
     */</span>
    public ValidationError <a title="(key: java.lang.String)play.data.validation.ValidationError" id="382024">error</a><span class="delimiter">(</span>String <a title="java.lang.String" id="382054">key</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        List&lt;ValidationError&gt; err = errors.get<span class="delimiter">(</span>key<span class="delimiter">)</span>;
        <span class="keyword">if</span><span class="delimiter">(</span>err == <span class="keyword">null</span> || err.isEmpty<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> <span class="keyword">null</span>;
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> err.get<span class="delimiter">(</span><span class="int">0</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Returns the form errors serialized as Json.
     */</span>
    public org.codehaus.jackson.<span title="org.codehaus.jackson.JsonNode">JsonNode</span> <a title="()org.codehaus.jackson.JsonNode" id="382025">errorsAsJson</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">return</span> errorsAsJson<span class="delimiter">(</span>Http.Context.Implicit.lang<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Returns the form errors serialized as Json using the given Lang.
     */</span>
    public org.codehaus.jackson.<span title="org.codehaus.jackson.JsonNode">JsonNode</span> <a title="(lang: play.i18n.Lang)org.codehaus.jackson.JsonNode" id="382026">errorsAsJson</a><span class="delimiter">(</span>play.i18n.<a href="../i18n/Lang.java.html#20841" title="play.i18n.Lang">Lang</a> <a title="play.i18n.Lang" id="382055">lang</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        Map&lt;String, List&lt;String&gt;&gt; allMessages = <span class="keyword">new</span> HashMap&lt;String, List&lt;String&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">for</span> <span class="delimiter">(</span>String key : errors.keySet<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            List&lt;ValidationError&gt; errs = errors.get<span class="delimiter">(</span>key<span class="delimiter">)</span>;
            <span class="keyword">if</span> <span class="delimiter">(</span>errs != <span class="keyword">null</span> &amp;&amp; !errs.isEmpty<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                List&lt;String&gt; messages = <span class="keyword">new</span> ArrayList&lt;String&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
                <span class="keyword">for</span> <span class="delimiter">(</span>ValidationError error : errs<span class="delimiter">)</span> <span class="delimiter">{</span>
                    messages.add<span class="delimiter">(</span>play.i18n.Messages.get<span class="delimiter">(</span>lang, error.message<span class="delimiter">(</span><span class="delimiter">)</span>, error.arguments<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>;
                <span class="delimiter">}</span>
                allMessages.put<span class="delimiter">(</span>key, messages<span class="delimiter">)</span>;
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span class="keyword">return</span> play.libs.Json.toJson<span class="delimiter">(</span>allMessages<span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    
    <span class="comment">/**
     * Gets the concrete value if the submission was a success.
     */</span>
    public <a href="#20623" title="T">T</a> <a title="()T" id="382027">get</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">return</span> value.get<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Adds an error to this form.
     *
     * @param error the &lt;code&gt;ValidationError&lt;/code&gt; to add.
     */</span>
    public void <a title="(error: play.data.validation.ValidationError)Unit" id="382028">reject</a><span class="delimiter">(</span>ValidationError <a title="play.data.validation.ValidationError" id="382056">error</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">if</span><span class="delimiter">(</span>!errors.containsKey<span class="delimiter">(</span>error.key<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
           errors.put<span class="delimiter">(</span>error.key<span class="delimiter">(</span><span class="delimiter">)</span>, <span class="keyword">new</span> ArrayList&lt;ValidationError&gt;<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>; 
        <span class="delimiter">}</span>
        errors.get<span class="delimiter">(</span>error.key<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>.add<span class="delimiter">(</span>error<span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Adds an error to this form.
     *
     * @param key the error key
     * @param error the error message
     * @param args the errot arguments
     */</span>
    public void <a title="(key: java.lang.String, error: java.lang.String, args: java.util.List[java.lang.Object])Unit" id="382029">reject</a><span class="delimiter">(</span>String <a title="java.lang.String" id="382057">key</a>, String <a title="java.lang.String" id="382058">error</a>, List&lt;Object&gt; <a title="java.util.List[java.lang.Object]" id="382059">args</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        reject<span class="delimiter">(</span><span class="keyword">new</span> ValidationError<span class="delimiter">(</span>key, error, args<span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Adds an error to this form.
     *
     * @param key the error key
     * @param error the error message
     */</span>    
    public void <a title="(key: java.lang.String, error: java.lang.String)Unit" id="382030">reject</a><span class="delimiter">(</span>String <a title="java.lang.String" id="382060">key</a>, String <a title="java.lang.String" id="382061">error</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        reject<span class="delimiter">(</span>key, error, <span class="keyword">new</span> ArrayList<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Adds a global error to this form.
     *
     * @param error the error message
     * @param args the errot arguments
     */</span>
    public void <a title="(error: java.lang.String, args: java.util.List[java.lang.Object])Unit" id="382031">reject</a><span class="delimiter">(</span>String <a title="java.lang.String" id="382062">error</a>, List&lt;Object&gt; <a title="java.util.List[java.lang.Object]" id="382063">args</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        reject<span class="delimiter">(</span><span class="keyword">new</span> ValidationError<span class="delimiter">(</span><span class="string">&quot;&quot;</span>, error, args<span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Add a global error to this form.
     *
     * @param error the error message.
     */</span>    
    public void <a title="(error: java.lang.String)Unit" id="382032">reject</a><span class="delimiter">(</span>String <a title="java.lang.String" id="382064">error</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        reject<span class="delimiter">(</span><span class="string">&quot;&quot;</span>, error, <span class="keyword">new</span> ArrayList<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Retrieve a field.
     *
     * @param key field name
     * @return the field (even if the field does not exist you get a field)
     */</span>
    public Field <a title="(key: java.lang.String)play.data.Form.Field" id="382033">apply</a><span class="delimiter">(</span>String <a title="java.lang.String" id="382065">key</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">return</span> field<span class="delimiter">(</span>key<span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Retrieve a field.
     *
     * @param key field name
     * @return the field (even if the field does not exist you get a field)
     */</span>
    public Field <a title="(key: java.lang.String)play.data.Form.Field" id="382034">field</a><span class="delimiter">(</span>String <a title="java.lang.String" id="382066">key</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        
        <span class="comment">// Value</span>
        String fieldValue = <span class="keyword">null</span>;
        <span class="keyword">if</span><span class="delimiter">(</span>data.containsKey<span class="delimiter">(</span>key<span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            fieldValue = data.get<span class="delimiter">(</span>key<span class="delimiter">)</span>;
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="keyword">if</span><span class="delimiter">(</span>value.isDefined<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                BeanWrapper beanWrapper = <span class="keyword">new</span> BeanWrapperImpl<span class="delimiter">(</span>value.get<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
                beanWrapper.setAutoGrowNestedPaths<span class="delimiter">(</span><span class="keyword">true</span><span class="delimiter">)</span>;
                String objectKey = key;
                <span class="keyword">if</span><span class="delimiter">(</span>rootName != <span class="keyword">null</span> &amp;&amp; key.startsWith<span class="delimiter">(</span>rootName + <span class="string">&quot;.&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                    objectKey = key.substring<span class="delimiter">(</span>rootName.length<span class="delimiter">(</span><span class="delimiter">)</span> + <span class="int">1</span><span class="delimiter">)</span>;
                <span class="delimiter">}</span>
                <span class="keyword">if</span><span class="delimiter">(</span>beanWrapper.isReadableProperty<span class="delimiter">(</span>objectKey<span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                    Object oValue = beanWrapper.getPropertyValue<span class="delimiter">(</span>objectKey<span class="delimiter">)</span>;
                    <span class="keyword">if</span><span class="delimiter">(</span>oValue != <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                        fieldValue = play.data.format.Formatters.print<span class="delimiter">(</span>beanWrapper.getPropertyTypeDescriptor<span class="delimiter">(</span>objectKey<span class="delimiter">)</span>, oValue<span class="delimiter">)</span>;
                    <span class="delimiter">}</span>
                <span class="delimiter">}</span>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        
        <span class="comment">// Error</span>
        List&lt;ValidationError&gt; fieldErrors = errors.get<span class="delimiter">(</span>key<span class="delimiter">)</span>;
        <span class="keyword">if</span><span class="delimiter">(</span>fieldErrors == <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            fieldErrors = <span class="keyword">new</span> ArrayList&lt;ValidationError&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        
        <span class="comment">// Format</span>
        Tuple&lt;String,List&lt;Object&gt;&gt; format = <span class="keyword">null</span>;
        BeanWrapper beanWrapper = <span class="keyword">new</span> BeanWrapperImpl<span class="delimiter">(</span>blankInstance<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        beanWrapper.setAutoGrowNestedPaths<span class="delimiter">(</span><span class="keyword">true</span><span class="delimiter">)</span>;
        <span class="keyword">try</span> <span class="delimiter">{</span>
            <span class="keyword">for</span><span class="delimiter">(</span>Annotation a: beanWrapper.getPropertyTypeDescriptor<span class="delimiter">(</span>key<span class="delimiter">)</span>.getAnnotations<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                Class&lt;?&gt; annotationType = a.annotationType<span class="delimiter">(</span><span class="delimiter">)</span>;
                <span class="keyword">if</span><span class="delimiter">(</span>annotationType.isAnnotationPresent<span class="delimiter">(</span>play.data.Form.Display.<span class="keyword">class</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                    play.data.Form.Display d = annotationType.getAnnotation<span class="delimiter">(</span>play.data.Form.Display.<span class="keyword">class</span><span class="delimiter">)</span>;
                    <span class="keyword">if</span><span class="delimiter">(</span>d.name<span class="delimiter">(</span><span class="delimiter">)</span>.startsWith<span class="delimiter">(</span><span class="string">&quot;format.&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                        List&lt;Object&gt; attributes = <span class="keyword">new</span> ArrayList&lt;Object&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
                        <span class="keyword">for</span><span class="delimiter">(</span>String attr: d.attributes<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                            Object attrValue = <span class="keyword">null</span>;
                            <span class="keyword">try</span> <span class="delimiter">{</span>
                                attrValue = a.getClass<span class="delimiter">(</span><span class="delimiter">)</span>.getDeclaredMethod<span class="delimiter">(</span>attr<span class="delimiter">)</span>.invoke<span class="delimiter">(</span>a<span class="delimiter">)</span>;
                            <span class="delimiter">}</span> <span class="keyword">catch</span><span class="delimiter">(</span>Exception e<span class="delimiter">)</span> <span class="delimiter">{</span><span class="delimiter">}</span>
                            attributes.add<span class="delimiter">(</span>attrValue<span class="delimiter">)</span>;
                        <span class="delimiter">}</span>
                        format = Tuple<span class="delimiter">(</span>d.name<span class="delimiter">(</span><span class="delimiter">)</span>, attributes<span class="delimiter">)</span>;
                    <span class="delimiter">}</span>
                <span class="delimiter">}</span>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">catch</span><span class="delimiter">(</span>NullPointerException e<span class="delimiter">)</span> <span class="delimiter">{</span><span class="delimiter">}</span>

        
        <span class="comment">// Constraints</span>
        PropertyDescriptor property = play.data.validation.Validation.getValidator<span class="delimiter">(</span><span class="delimiter">)</span>.getConstraintsForClass<span class="delimiter">(</span>backedType<span class="delimiter">)</span>.getConstraintsForProperty<span class="delimiter">(</span>key<span class="delimiter">)</span>;
        List&lt;Tuple&lt;String,List&lt;Object&gt;&gt;&gt; constraints = <span class="keyword">new</span> ArrayList&lt;Tuple&lt;String,List&lt;Object&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">if</span><span class="delimiter">(</span>property != <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            constraints = Constraints.displayableConstraint<span class="delimiter">(</span>property.getConstraintDescriptors<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        
        <span class="keyword">return</span> <span class="keyword">new</span> Field<span class="delimiter">(</span><span class="keyword">this</span>, key, constraints, format, fieldErrors, fieldValue<span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    public String <a title="()java.lang.String" id="382035">toString</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">return</span> <span class="string">&quot;Form(of=&quot;</span> + backedType + <span class="string">&quot;, data=&quot;</span> + data + <span class="string">&quot;, value=&quot;</span> + value +<span class="string">&quot;, errors=&quot;</span> + errors + <span class="string">&quot;)&quot;</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * A form field.
     */</span>
    public static <span class="keyword">class</span> <a title="object play.data.Form.Field" id="236835">Field</a> <span class="delimiter">{</span>
        
        <span class="keyword">private</span> <span class="keyword">final</span> <a href="#20594" title="play.data.Form">Form</a>&lt;?&gt; <a title="play.data.Form[_]" id="237372">form</a>;
        <span class="keyword">private</span> <span class="keyword">final</span> String <a title="java.lang.String" id="237373">name</a>;
        <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Tuple&lt;String,List&lt;Object&gt;&gt;&gt; <a title="java.util.List[play.libs.F.Tuple[java.lang.String,java.util.List[java.lang.Object]]]" id="237374">constraints</a>;
        <span class="keyword">private</span> <span class="keyword">final</span> Tuple&lt;String,List&lt;Object&gt;&gt; <a title="play.libs.F.Tuple[java.lang.String,java.util.List[java.lang.Object]]" id="237375">format</a>;
        <span class="keyword">private</span> <span class="keyword">final</span> List&lt;ValidationError&gt; <a title="java.util.List[play.data.validation.ValidationError]" id="237376">errors</a>;
        <span class="keyword">private</span> <span class="keyword">final</span> String <a title="java.lang.String" id="237377">value</a>;
        
        <span class="comment">/**
         * Creates a form field.
         *
         * @param name the field name
         * @param constraints the constraints associated with the field
         * @param format the format expected for this field
         * @param errors the errors associated with this field
         * @param value the field value ,if any
         */</span>
        public Field<span class="delimiter">(</span>Form&lt;?&gt; form, String name, List&lt;Tuple&lt;String,List&lt;Object&gt;&gt;&gt; constraints, Tuple&lt;String,List&lt;Object&gt;&gt; format, List&lt;ValidationError&gt; errors, String value<span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">this</span>.form = form;
            <span class="keyword">this</span>.name = name;
            <span class="keyword">this</span>.constraints = constraints;
            <span class="keyword">this</span>.format = format;
            <span class="keyword">this</span>.errors = errors;
            <span class="keyword">this</span>.value = value;
        <span class="delimiter">}</span>
        
        <span class="comment">/**
         * Returns the field name.
         *
         * @return The field name.
         */</span>
        public String <a title="()java.lang.String" id="237379">name</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> name;
        <span class="delimiter">}</span>
        
        <span class="comment">/**
         * Returns the field value, if defined.
         *
         * @return The field value, if defined.
         */</span>
        public String <a title="()java.lang.String" id="237380">value</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> value;
        <span class="delimiter">}</span>
        
        public String <a title="(or: java.lang.String)java.lang.String" id="237381">valueOr</a><span class="delimiter">(</span>String <a title="java.lang.String" id="382036">or</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">if</span><span class="delimiter">(</span>value == <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">return</span> or;
            <span class="delimiter">}</span>
            <span class="keyword">return</span> value;
        <span class="delimiter">}</span>
        
        <span class="comment">/**
         * Returns all the errors associated with this field.
         *
         * @return The errors associated with this field.
         */</span>
        public List&lt;ValidationError&gt; <a title="()java.util.List[play.data.validation.ValidationError]" id="237382">errors</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> errors;
        <span class="delimiter">}</span>
        
        <span class="comment">/**
         * Returns all the constraints associated with this field.
         *
         * @return The constraints associated with this field.
         */</span>
        public List&lt;Tuple&lt;String,List&lt;Object&gt;&gt;&gt; <a title="()java.util.List[play.libs.F.Tuple[java.lang.String,java.util.List[java.lang.Object]]]" id="237383">constraints</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> constraints;
        <span class="delimiter">}</span>
        
        <span class="comment">/**
         * Returns the expected format for this field.
         * 
         * @return The expected format for this field.
         */</span>
        public Tuple&lt;String,List&lt;Object&gt;&gt; <a title="()play.libs.F.Tuple[java.lang.String,java.util.List[java.lang.Object]]" id="237384">format</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> format;
        <span class="delimiter">}</span>
        
        <span class="comment">/**
         * Return the indexes available for this field (for repeated fields ad List)
         */</span>
        public List&lt;Integer&gt; <a title="()java.util.List[java.lang.Integer]" id="237385">indexes</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            List&lt;Integer&gt; result = <span class="keyword">new</span> ArrayList&lt;Integer&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
            <span class="keyword">if</span><span class="delimiter">(</span>form.value<span class="delimiter">(</span><span class="delimiter">)</span>.isDefined<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                BeanWrapper beanWrapper = <span class="keyword">new</span> BeanWrapperImpl<span class="delimiter">(</span>form.value<span class="delimiter">(</span><span class="delimiter">)</span>.get<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
                beanWrapper.setAutoGrowNestedPaths<span class="delimiter">(</span><span class="keyword">true</span><span class="delimiter">)</span>;
                String objectKey = name;
                <span class="keyword">if</span><span class="delimiter">(</span>form.name<span class="delimiter">(</span><span class="delimiter">)</span> != <span class="keyword">null</span> &amp;&amp; name.startsWith<span class="delimiter">(</span>form.name<span class="delimiter">(</span><span class="delimiter">)</span> + <span class="string">&quot;.&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                    objectKey = name.substring<span class="delimiter">(</span>form.name<span class="delimiter">(</span><span class="delimiter">)</span>.length<span class="delimiter">(</span><span class="delimiter">)</span> + <span class="int">1</span><span class="delimiter">)</span>;
                <span class="delimiter">}</span>
                <span class="keyword">if</span><span class="delimiter">(</span>beanWrapper.isReadableProperty<span class="delimiter">(</span>objectKey<span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                    Object value = beanWrapper.getPropertyValue<span class="delimiter">(</span>objectKey<span class="delimiter">)</span>;
                    <span class="keyword">if</span><span class="delimiter">(</span>value instanceof Collection<span class="delimiter">)</span> <span class="delimiter">{</span>
                        <span class="keyword">for</span><span class="delimiter">(</span>int i=<span class="int">0</span>; i&lt;<span class="delimiter">(</span><span class="delimiter">(</span>Collection<span class="delimiter">)</span>value<span class="delimiter">)</span>.size<span class="delimiter">(</span><span class="delimiter">)</span>; i++<span class="delimiter">)</span> <span class="delimiter">{</span>
                            result.add<span class="delimiter">(</span>i<span class="delimiter">)</span>;
                        <span class="delimiter">}</span>
                    <span class="delimiter">}</span>
                <span class="delimiter">}</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                java.util.regex.Pattern pattern = java.util.regex.Pattern.compile<span class="delimiter">(</span><span class="string">&quot;^&quot;</span> + java.util.regex.Pattern.quote<span class="delimiter">(</span>name<span class="delimiter">)</span> + <span class="string">&quot;\\[(\\d+)\\].*$&quot;</span><span class="delimiter">)</span>;
                <span class="keyword">for</span><span class="delimiter">(</span>String key: form.data<span class="delimiter">(</span><span class="delimiter">)</span>.keySet<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                    java.util.regex.Matcher matcher = pattern.matcher<span class="delimiter">(</span>key<span class="delimiter">)</span>;
                    <span class="keyword">if</span><span class="delimiter">(</span>matcher.matches<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                        result.add<span class="delimiter">(</span>Integer.parseInt<span class="delimiter">(</span>matcher.group<span class="delimiter">(</span><span class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>;
                    <span class="delimiter">}</span>
                <span class="delimiter">}</span>
            <span class="delimiter">}</span>
            <span class="keyword">return</span> result;
        <span class="delimiter">}</span>
        
        <span class="comment">/**
         * Get a sub-field, with a key relative to the current field.
         */</span>
        public Field <a title="(key: java.lang.String)play.data.Form.Field" id="237386">sub</a><span class="delimiter">(</span>String <a title="java.lang.String" id="237396">key</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            String subKey = <span class="keyword">null</span>;
            <span class="keyword">if</span><span class="delimiter">(</span>key.startsWith<span class="delimiter">(</span><span class="string">&quot;[&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                subKey = name + key;
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                subKey = name + <span class="string">&quot;.&quot;</span> + key;
            <span class="delimiter">}</span>
            <span class="keyword">return</span> form.field<span class="delimiter">(</span>subKey<span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        
        public String <a title="()java.lang.String" id="237387">toString</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> <span class="string">&quot;Form.Field(&quot;</span> + name + <span class="string">&quot;)&quot;</span>;
        <span class="delimiter">}</span>
    
    <span class="delimiter">}</span>
    
<span class="delimiter">}</span>
        </pre>
    </body>
</html>