<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>filters-helpers/play/filters/csrf/csrf.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2009-2013 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> play.filters.csrf

<span class="keyword">import</span> play.api.mvc._
<span class="keyword">import</span> play.api._
<span class="keyword">import</span> play.api.mvc.<a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc.Results" title="play.api.mvc.Results.type">Results</a>._
<span class="keyword">import</span> play.api.libs.Crypto
<span class="keyword">import</span> play.core.j.JavaHelpers

<span class="keyword">private</span><span class="delimiter">[</span>csrf<span class="delimiter">]</span> <span class="keyword">object</span> <a title="play.filters.csrf.CSRFConf.type" id="play.filters.csrf.CSRFConf">CSRFConf</a> <a href="#play.filters.csrf.CSRFConf" title="play.filters.csrf.CSRFConf.type" class="delimiter">{</a>
  <span class="keyword">import</span> play.api.<a href="../../../../play/play/api/Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.current

  <span class="keyword">def</span> <a title="=&gt; play.api.Configuration" id="play.filters.csrf.CSRFConf.c">c</a> = <a href="../../../../play/play/api/Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../../../../play/play/api/Play.scala.html#play.api.Play.configuration" title="(implicit app: play.api.Application)play.api.Configuration">configuration</a>

  <span class="keyword">def</span> <a title="=&gt; String" id="play.filters.csrf.CSRFConf.TokenName">TokenName</a>: <span title="String">String</span> = <a href="#play.filters.csrf.CSRFConf.c" title="play.api.Configuration" id="play.filters.csrf.CSRFConf.TokenName.qual$1">c</a>.<a href="../../../../play/play/api/Configuration.scala.html#play.api;Configuration.getString$default$2" title="Option[Set[String]] @scala.reflect.internal.annotations.uncheckedBounds" id="play.filters.csrf.CSRFConf.TokenName.x$3">getString</a><span class="delimiter">(</span><a title="String" id="play.filters.csrf.CSRFConf.TokenName.x$2" class="string">&quot;csrf.token.name&quot;</a><span class="delimiter">)</span>.<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><span title="String(&quot;csrfToken&quot;)" class="string">&quot;csrfToken&quot;</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; Option[String]" id="play.filters.csrf.CSRFConf.CookieName">CookieName</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#play.filters.csrf.CSRFConf.c" title="play.api.Configuration" id="play.filters.csrf.CSRFConf.CookieName.qual$2">c</a>.<a href="../../../../play/play/api/Configuration.scala.html#play.api;Configuration.getString$default$2" title="Option[Set[String]] @scala.reflect.internal.annotations.uncheckedBounds" id="play.filters.csrf.CSRFConf.CookieName.x$5">getString</a><span class="delimiter">(</span><a title="String" id="play.filters.csrf.CSRFConf.CookieName.x$4" class="string">&quot;csrf.cookie.name&quot;</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="play.filters.csrf.CSRFConf.SecureCookie">SecureCookie</a>: <span title="Boolean">Boolean</span> = <a href="#play.filters.csrf.CSRFConf.c" title="=&gt; play.api.Configuration">c</a>.<a href="../../../../play/play/api/Configuration.scala.html#play.api;Configuration.getBoolean" title="(path: String)Option[Boolean]">getBoolean</a><span class="delimiter">(</span><span title="String(&quot;csrf.cookie.secure&quot;)" class="string">&quot;csrf.cookie.secure&quot;</span><span class="delimiter">)</span>.<span title="(default: =&gt; Boolean)Boolean">getOrElse</span><span class="delimiter">(</span><a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc.Session" title="play.api.mvc.Session.type">Session</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc.Session.secure" title="=&gt; Boolean">secure</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; Long" id="play.filters.csrf.CSRFConf.PostBodyBuffer">PostBodyBuffer</a>: <span title="Long">Long</span> = <a href="#play.filters.csrf.CSRFConf.c" title="=&gt; play.api.Configuration">c</a>.<a href="../../../../play/play/api/Configuration.scala.html#play.api;Configuration.getBytes" title="(path: String)Option[Long]">getBytes</a><span class="delimiter">(</span><span title="String(&quot;csrf.body.bufferSize&quot;)" class="string">&quot;csrf.body.bufferSize&quot;</span><span class="delimiter">)</span>.<span title="(default: =&gt; Long)Long">getOrElse</span><span class="delimiter">(</span><span title="Long(102400L)" class="long">102400L</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="play.filters.csrf.CSRFConf.SignTokens">SignTokens</a>: <span title="Boolean">Boolean</span> = <a href="#play.filters.csrf.CSRFConf.c" title="=&gt; play.api.Configuration">c</a>.<a href="../../../../play/play/api/Configuration.scala.html#play.api;Configuration.getBoolean" title="(path: String)Option[Boolean]">getBoolean</a><span class="delimiter">(</span><span title="String(&quot;csrf.sign.tokens&quot;)" class="string">&quot;csrf.sign.tokens&quot;</span><span class="delimiter">)</span>.<span title="(default: =&gt; Boolean)Boolean">getOrElse</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="scala.collection.immutable.Set[String]" id="play.filters.csrf.CSRFConf.UnsafeMethods">UnsafeMethods</a> = <span title="(elems: String*)scala.collection.immutable.Set[String]">Set</span><span class="delimiter">(</span><span title="String(&quot;POST&quot;)" class="string">&quot;POST&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="scala.collection.immutable.Set[String]" id="play.filters.csrf.CSRFConf.UnsafeContentTypes">UnsafeContentTypes</a> = <span title="(elems: String*)scala.collection.immutable.Set[String]">Set</span><span class="delimiter">(</span><span title="String(&quot;application/x-www-form-urlencoded&quot;)" class="string">&quot;application/x-www-form-urlencoded&quot;</span>, <span title="String(&quot;text/plain&quot;)" class="string">&quot;text/plain&quot;</span>, <span title="String(&quot;multipart/form-data&quot;)" class="string">&quot;multipart/form-data&quot;</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="String" id="play.filters.csrf.CSRFConf.HeaderName">HeaderName</a> = <span title="String(&quot;Csrf-Token&quot;)" class="string">&quot;Csrf-Token&quot;</span>
  <span class="keyword">val</span> <a title="String" id="play.filters.csrf.CSRFConf.HeaderNoCheck">HeaderNoCheck</a> = <span title="String(&quot;nocheck&quot;)" class="string">&quot;nocheck&quot;</span>

  <span class="keyword">def</span> <a title="(request: play.api.mvc.RequestHeader)Boolean" id="play.filters.csrf.CSRFConf.defaultCreateIfNotFound">defaultCreateIfNotFound</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader" id="play.filters.csrf.CSRFConf.defaultCreateIfNotFound.request">request</a>: <a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="comment">// If the request isn't accepting HTML, then it won't be rendering a form, so there's no point in generating a</span>
    <span class="comment">// CSRF token for it.</span>
    <span class="delimiter">(</span><a href="#play.filters.csrf.CSRFConf.defaultCreateIfNotFound.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.method" title="=&gt; String">method</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="String(&quot;GET&quot;)" class="string">&quot;GET&quot;</span> <span title="(x: Boolean)Boolean">||</span> <a href="#play.filters.csrf.CSRFConf.defaultCreateIfNotFound.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.method" title="=&gt; String">method</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="String(&quot;HEAD&quot;)" class="string">&quot;HEAD&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#play.filters.csrf.CSRFConf.defaultCreateIfNotFound.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.accepts" title="(mimeType: String)Boolean">accepts</a><span class="delimiter">(</span><span title="String(&quot;text/html&quot;)" class="string">&quot;text/html&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#play.filters.csrf.CSRFConf.defaultCreateIfNotFound.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.accepts" title="(mimeType: String)Boolean">accepts</a><span class="delimiter">(</span><span title="String(&quot;application/xml+xhtml&quot;)" class="string">&quot;application/xml+xhtml&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * This is used by the noarg constructor of CSRFFilter, so that Java developers can select an error handler.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; play.filters.csrf.CSRF.ErrorHandler" id="play.filters.csrf.CSRFConf.defaultJavaErrorHandler">defaultJavaErrorHandler</a>: CSRF.<a href="#play.filters.csrf.CSRF;ErrorHandler" title="play.filters.csrf.CSRF.ErrorHandler">ErrorHandler</a> = <span class="delimiter">{</span>
    <a href="#play.filters.csrf.CSRFConf.c" title="play.api.Configuration" id="play.filters.csrf.CSRFConf.defaultJavaErrorHandler.qual$3">c</a>.<a href="../../../../play/play/api/Configuration.scala.html#play.api;Configuration.getString$default$2" title="Option[Set[String]] @scala.reflect.internal.annotations.uncheckedBounds" id="play.filters.csrf.CSRFConf.defaultJavaErrorHandler.x$7">getString</a><span class="delimiter">(</span><a title="String" id="play.filters.csrf.CSRFConf.defaultJavaErrorHandler.x$6" class="string">&quot;csrf.error.handler&quot;</a><span class="delimiter">)</span>.<span title="(f: String =&gt; play.filters.csrf.CSRF.ErrorHandler)Option[play.filters.csrf.CSRF.ErrorHandler]">map</span> <span class="delimiter">{</span> <a title="String" id="play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun.className">className</a> =&gt;
      <span class="keyword">val</span> <a title="Class[_]" id="play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun.clazz">clazz</a> = <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="../../../../play/play/api/Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../../../../play/play/api/Play.scala.html#play.api.Play.classloader" title="(implicit app: play.api.Application)ClassLoader">classloader</a>.<span title="(x$1: String)Class[_]">loadClass</span><span class="delimiter">(</span><a href="#play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun.className" title="String">className</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="ClassNotFoundException" id="play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun.clazz.c">c</a>: <span title="ClassNotFoundException">ClassNotFoundException</span> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String, x$2: Throwable)RuntimeException" class="keyword">new</span> <span title="RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="String(&quot;Could not find CSRF error handler &quot;)" class="string">&quot;Could not find CSRF error handler &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun.className" title="String">className</a>, <a href="#play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun.clazz.c" title="ClassNotFoundException">c</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span title="play.filters.csrf.CSRF.ErrorHandler" class="keyword">if</span> <span class="delimiter">(</span>classOf<span title="Class[play.filters.csrf.CSRFErrorHandler](classOf[play.filters.csrf.CSRFErrorHandler])" class="delimiter">[</span>CSRFErrorHandler<span class="delimiter">]</span>.<span title="(x$1: Class[_])Boolean">isAssignableFrom</span><span class="delimiter">(</span><a href="#play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun.clazz" title="Class[_]">clazz</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">import</span> play.mvc.<a href="../../../../play/play/mvc/Http.java.html#play.mvc.Http" title="play.mvc.Http.type">Http</a>.<span class="delimiter">{</span> Context =&gt; JContext <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="play.filters.csrf.CSRFErrorHandler" id="play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun.errorHandler">errorHandler</a> = <a href="#play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun.clazz" title="Class[_]">clazz</a>.<span title="()?0">newInstance</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="play.filters.csrf.CSRFErrorHandler" class="delimiter">[</span><a href="CSRFErrorHandler.java.html#play.filters.csrf;CSRFErrorHandler" title="play.filters.csrf.CSRFErrorHandler">CSRFErrorHandler</a><span class="delimiter">]</span>
        <a href="#play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun;$anon" title="play.filters.csrf.CSRF.ErrorHandler" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with play.filters.csrf.CSRF.ErrorHandler" id="play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun;$anon">CSRF</a>.<a href="#play.filters.csrf.CSRF;ErrorHandler" title="play.filters.csrf.CSRF.ErrorHandler">ErrorHandler</a> <span class="delimiter">{</span>
          <span class="keyword">def</span> <a title="(req: play.api.mvc.RequestHeader, msg: String)play.api.mvc.Result" id="play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun;$anon.handle">handle</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader" id="play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun;$anon.handle.req">req</a>: <a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a>, <a title="String" id="play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun;$anon.handle.msg">msg</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="play.mvc.Http.Context" id="play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun;$anon.handle.ctx">ctx</a> = <a href="../../../../play/play/core/j/JavaHelpers.scala.html#play.core.j.JavaHelpers" title="play.core.j.JavaHelpers.type">JavaHelpers</a>.<a href="../../../../play/play/core/j/JavaHelpers.scala.html#play.core.j;JavaHelpers.createJavaContext(62518d4a33)" title="(req: play.api.mvc.RequestHeader)play.mvc.Http.Context">createJavaContext</a><span class="delimiter">(</span><a href="#play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun;$anon.handle.req" title="play.api.mvc.RequestHeader">req</a><span class="delimiter">)</span>
            <a href="../../../../play/play/mvc/Http.java.html#play.mvc.Http.Context" title="play.mvc.Http.Context.type">JContext</a>.<a href="../../../../play/play/mvc/Http.java.html#play.mvc.Http.Context.current" title="ThreadLocal[play.mvc.Http.Context]">current</a>.<span title="(x$1: play.mvc.Http.Context)Unit">set</span><span class="delimiter">(</span><a href="#play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun;$anon.handle.ctx" title="play.mvc.Http.Context">ctx</a><span class="delimiter">)</span>
            <span class="keyword">try</span> <span class="delimiter">{</span>
              <a href="#play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun.errorHandler" title="play.filters.csrf.CSRFErrorHandler">errorHandler</a>.<a href="CSRFErrorHandler.java.html#play.filters.csrf;CSRFErrorHandler.handle" title="(msg: String)play.mvc.Result">handle</a><span class="delimiter">(</span><a href="#play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun;$anon.handle.msg" title="String">msg</a><span class="delimiter">)</span>.<a href="../../../../play/play/mvc/Result.java.html#play.mvc;Result.toScala" title="()play.api.mvc.Result">toScala</a>
            <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
              <a href="../../../../play/play/mvc/Http.java.html#play.mvc.Http.Context" title="play.mvc.Http.Context.type">JContext</a>.<a href="../../../../play/play/mvc/Http.java.html#play.mvc.Http.Context.current" title="ThreadLocal[play.mvc.Http.Context]">current</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="play.filters.csrf.CSRF.ErrorHandler" class="keyword">if</span> <span class="delimiter">(</span>classOf<span title="Class[play.filters.csrf.CSRF.ErrorHandler](classOf[play.filters.csrf.CSRF$$ErrorHandler])" class="delimiter">[</span>CSRF.ErrorHandler<span class="delimiter">]</span>.<span title="(x$1: Class[_])Boolean">isAssignableFrom</span><span class="delimiter">(</span><a href="#play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun.clazz" title="Class[_]">clazz</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#play.filters.csrf.CSRFConf.defaultJavaErrorHandler.$anonfun.clazz" title="Class[_]">clazz</a>.<span title="()?0">newInstance</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="play.filters.csrf.CSRF.ErrorHandler" class="delimiter">[</span>CSRF.<a href="#play.filters.csrf.CSRF;ErrorHandler" title="play.filters.csrf.CSRF.ErrorHandler">ErrorHandler</a><span class="delimiter">]</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)RuntimeException" class="keyword">new</span> <span title="RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Error handler must implement &quot;)">Error handler must implement $</span><span class="delimiter">{</span>classOf<span title="Class[play.filters.csrf.CSRFErrorHandler](classOf[play.filters.csrf.CSRFErrorHandler])" class="delimiter">[</span>CSRFErrorHandler<span class="delimiter">]</span><span class="delimiter">}</span><span title="String(&quot; or &quot;)"> or $</span><span class="delimiter">{</span>classOf<span title="Class[play.filters.csrf.CSRF.ErrorHandler](classOf[play.filters.csrf.CSRF$$ErrorHandler])" class="delimiter">[</span>CSRF.ErrorHandler<span class="delimiter">]</span><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>.<span title="(default: =&gt; play.filters.csrf.CSRF.ErrorHandler)play.filters.csrf.CSRF.ErrorHandler">getOrElse</span><span class="delimiter">(</span><a href="#play.filters.csrf.CSRF" title="play.filters.csrf.CSRF.type">CSRF</a>.<a href="#play.filters.csrf.CSRF.DefaultErrorHandler" title="play.filters.csrf.CSRF.DefaultErrorHandler.type">DefaultErrorHandler</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; play.filters.csrf.CSRF.DefaultErrorHandler.type" id="play.filters.csrf.CSRFConf.defaultErrorHandler">defaultErrorHandler</a> = <a href="#play.filters.csrf.CSRF" title="play.filters.csrf.CSRF.type">CSRF</a>.<a href="#play.filters.csrf.CSRF.DefaultErrorHandler" title="play.filters.csrf.CSRF.DefaultErrorHandler.type">DefaultErrorHandler</a>
  <span class="keyword">def</span> <a title="=&gt; play.filters.csrf.CSRF.TokenProvider" id="play.filters.csrf.CSRFConf.defaultTokenProvider">defaultTokenProvider</a> = <span class="delimiter">{</span>
    <span title="play.filters.csrf.CSRF.TokenProvider" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.filters.csrf.CSRFConf.SignTokens" title="=&gt; Boolean">SignTokens</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#play.filters.csrf.CSRF" title="play.filters.csrf.CSRF.type">CSRF</a>.<a href="#play.filters.csrf.CSRF.SignedTokenProvider" title="play.filters.csrf.CSRF.SignedTokenProvider.type">SignedTokenProvider</a>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#play.filters.csrf.CSRF" title="play.filters.csrf.CSRF.type">CSRF</a>.<a href="#play.filters.csrf.CSRF.UnsignedTokenProvider" title="play.filters.csrf.CSRF.UnsignedTokenProvider.type">UnsignedTokenProvider</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span title="AnyRef" class="keyword">object</span> <a title="play.filters.csrf.CSRF.type" id="play.filters.csrf.CSRF">CSRF</a> <a href="#play.filters.csrf.CSRF" title="play.filters.csrf.CSRF.type" class="delimiter">{</a>

  <span class="keyword">private</span><span class="delimiter">[</span>csrf<span class="delimiter">]</span> <span class="keyword">val</span> <a title="play.api.Logger" id="play.filters.csrf.CSRF.filterLogger">filterLogger</a> = play.api.<a href="../../../../play/play/api/Logger.scala.html#play.api.Logger.apply(c877c33b49)" title="(name: String)play.api.Logger">Logger</a><span class="delimiter">(</span><span title="String(&quot;play.filters&quot;)" class="string">&quot;play.filters&quot;</span><span class="delimiter">)</span>

  <span class="comment">/**
   * A CSRF token
   */</span>
  <span class="keyword">case class</span> <a title="class Token extends AnyRef with Product with Serializable" id="play.filters.csrf.CSRF;Token">Token</a><a href="#play.filters.csrf.CSRF;Token" title="Product" class="delimiter">(</a><a title="String" id="play.filters.csrf.CSRF;Token.value">value</a>: <span title="String">String</span><span class="delimiter">)</span>

  <span class="keyword">object</span> <a title="play.filters.csrf.CSRF.Token.type" id="play.filters.csrf.CSRF.Token.readResolve">Token</a> <a href="#play.filters.csrf.CSRF.Token.readResolve" title="play.filters.csrf.CSRF.Token.type" class="delimiter">{</a>
    <span class="keyword">val</span> <a title="String" id="play.filters.csrf.CSRF.Token.RequestTag">RequestTag</a> = <span title="String(&quot;CSRF_TOKEN&quot;)" class="string">&quot;CSRF_TOKEN&quot;</span>

    <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit play.filters.csrf.CSRF.Token.getToken : (implicit request: play.api.mvc.RequestHeader)play.filters.csrf.CSRF.Token" id="play.filters.csrf.CSRF.Token.getToken">getToken</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="play.api.mvc.RequestHeader" id="play.filters.csrf.CSRF.Token.getToken.request">request</a>: <a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a><span class="delimiter">)</span>: <a href="#play.filters.csrf.CSRF;Token" title="play.filters.csrf.CSRF.Token">Token</a> = <span class="delimiter">{</span>
      <a href="#play.filters.csrf.CSRF" title="play.filters.csrf.CSRF.type">CSRF</a>.<a href="#play.filters.csrf.CSRF.getToken" title="(request: play.api.mvc.RequestHeader)Option[play.filters.csrf.CSRF.Token]">getToken</a><span class="delimiter">(</span><a href="#play.filters.csrf.CSRF.Token.getToken.request" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span>.<span title="(default: =&gt; play.filters.csrf.CSRF.Token)play.filters.csrf.CSRF.Token">getOrElse</span><span class="delimiter">(</span>sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="String(&quot;Missing CSRF Token&quot;)" class="string">&quot;Missing CSRF Token&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">// Allows the template helper to access it</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="play.filters.csrf.CSRF.TokenName">TokenName</a> = <a href="#play.filters.csrf.CSRFConf" title="play.filters.csrf.CSRFConf.type">CSRFConf</a>.<a href="#play.filters.csrf.CSRFConf.TokenName" title="=&gt; String">TokenName</a>

  <span class="keyword">import</span> <a href="#play.filters.csrf.CSRFConf" title="play.filters.csrf.CSRFConf.type">CSRFConf</a>._

  <span class="comment">/**
   * Extract token from current request
   */</span>
  <span class="keyword">def</span> <a title="(request: play.api.mvc.RequestHeader)Option[play.filters.csrf.CSRF.Token]" id="play.filters.csrf.CSRF.getToken">getToken</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader" id="play.filters.csrf.CSRF.getToken.request">request</a>: <a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a><span class="delimiter">)</span>: <span title="Option[play.filters.csrf.CSRF.Token]">Option</span><span class="delimiter">[</span>Token<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="comment">// First check the tags, this is where tokens are added if it's added to the current request</span>
    <span class="keyword">val</span> <a title="Option[String]" id="play.filters.csrf.CSRF.getToken.token">token</a> = <a href="#play.filters.csrf.CSRF.getToken.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.tags" title="=&gt; Map[String,String]">tags</a>.<span title="(key: String)Option[String]">get</span><span class="delimiter">(</span><a href="#play.filters.csrf.CSRF.Token.readResolve" title="play.filters.csrf.CSRF.Token.type">Token</a>.<a href="#play.filters.csrf.CSRF.Token.RequestTag" title="=&gt; String">RequestTag</a><span class="delimiter">)</span>
      <span class="comment">// Check cookie if cookie name is defined</span>
      .<span title="(alternative: =&gt; Option[String])Option[String]">orElse</span><span class="delimiter">(</span><a href="#play.filters.csrf.CSRFConf.CookieName" title="=&gt; Option[String]">CookieName</a>.<span title="(f: String =&gt; Option[String])Option[String]">flatMap</span><span class="delimiter">(</span><a title="String" id="play.filters.csrf.CSRF.getToken.token.$anonfun.n">n</a> =&gt; <a href="#play.filters.csrf.CSRF.getToken.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.cookies" title="=&gt; play.api.mvc.Cookies">cookies</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;Cookies.get" title="(name: String)Option[play.api.mvc.Cookie]">get</a><span class="delimiter">(</span><a href="#play.filters.csrf.CSRF.getToken.token.$anonfun.n" title="String">n</a><span class="delimiter">)</span>.<span title="(f: play.api.mvc.Cookie =&gt; String)Option[String]">map</span><span class="delimiter">(</span><a href="#play.filters.csrf.CSRF.getToken.token.$anonfun.$anonfun.x$1" title="play.api.mvc.Cookie">_</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;Cookie.value" title="=&gt; String">value</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="comment">// Check session</span>
      .<span title="(alternative: =&gt; Option[String])Option[String]">orElse</span><span class="delimiter">(</span><a href="#play.filters.csrf.CSRF.getToken.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.session" title="=&gt; play.api.mvc.Session">session</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;Session.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="#play.filters.csrf.CSRF.TokenName" title="=&gt; String">TokenName</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="Option[play.filters.csrf.CSRF.Token]" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.filters.csrf.CSRFConf.SignTokens" title="=&gt; Boolean">SignTokens</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// Extract the signed token, and then resign it. This makes the token random per request, preventing the BREACH</span>
      <span class="comment">// vulnerability</span>
      <a href="#play.filters.csrf.CSRF.getToken.token" title="Option[String]">token</a>.<span title="(f: String =&gt; Option[String])Option[String]">flatMap</span><span class="delimiter">(</span><a href="../../../../play/play/api/libs/Crypto.scala.html#play.api.libs.Crypto" title="play.api.libs.Crypto.type">Crypto</a>.<a href="../../../../play/play/api/libs/Crypto.scala.html#play.api.libs.Crypto.extractSignedToken" title="(token: String)Option[String]">extractSignedToken</a><span class="delimiter">)</span>
        .<span title="(f: String =&gt; play.filters.csrf.CSRF.Token)Option[play.filters.csrf.CSRF.Token]">map</span><span class="delimiter">(</span><a title="String" id="play.filters.csrf.CSRF.getToken.$anonfun.token">token</a> =&gt; <a href="#play.filters.csrf.CSRF;Token" title="(value: String)play.filters.csrf.CSRF.Token">Token</a><span class="delimiter">(</span><a href="../../../../play/play/api/libs/Crypto.scala.html#play.api.libs.Crypto" title="play.api.libs.Crypto.type">Crypto</a>.<a href="../../../../play/play/api/libs/Crypto.scala.html#play.api.libs.Crypto.signToken" title="(token: String)String">signToken</a><span class="delimiter">(</span><a href="#play.filters.csrf.CSRF.getToken.$anonfun.token" title="String">token</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#play.filters.csrf.CSRF.getToken.token" title="Option[String]">token</a>.<span title="(f: String =&gt; play.filters.csrf.CSRF.Token)Option[play.filters.csrf.CSRF.Token]">map</span><span class="delimiter">(</span><a href="#play.filters.csrf.CSRF.Token.readResolve" title="play.filters.csrf.CSRF.Token.type">Token</a>.<a href="#play.filters.csrf.CSRF;Token" title="(value: String)play.filters.csrf.CSRF.Token">apply</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * A token provider, for generating and comparing tokens.
   *
   * This abstraction allows the use of randomised tokens.
   */</span>
  <span class="keyword">trait</span> <a title="trait TokenProvider extends AnyRef" id="play.filters.csrf.CSRF;TokenProvider">TokenProvider</a> <span class="delimiter">{</span>
    <span class="comment">/** Generate a token */</span>
    <span class="keyword">def</span> <a title="=&gt; String" id="play.filters.csrf.CSRF;TokenProvider.generateToken">generateToken</a>: <span title="String">String</span>
    <span class="comment">/** Compare two tokens */</span>
    <span class="keyword">def</span> <a title="(tokenA: String, tokenB: String)Boolean" id="play.filters.csrf.CSRF;TokenProvider.compareTokens">compareTokens</a><span class="delimiter">(</span><a title="String" id="play.filters.csrf.CSRF;TokenProvider.compareTokens.tokenA">tokenA</a>: <span title="String">String</span>, <a title="String" id="play.filters.csrf.CSRF;TokenProvider.compareTokens.tokenB">tokenB</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span>
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="play.filters.csrf.CSRF.SignedTokenProvider.type" id="play.filters.csrf.CSRF.SignedTokenProvider">SignedTokenProvider</a> <a href="#play.filters.csrf.CSRF.SignedTokenProvider" title="play.filters.csrf.CSRF.SignedTokenProvider.type" class="keyword">extends</a> <a href="#play.filters.csrf.CSRF;TokenProvider" title="play.filters.csrf.CSRF.TokenProvider">TokenProvider</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; String" id="play.filters.csrf.CSRF.SignedTokenProvider.generateToken">generateToken</a> = <a href="../../../../play/play/api/libs/Crypto.scala.html#play.api.libs.Crypto" title="play.api.libs.Crypto.type">Crypto</a>.<a href="../../../../play/play/api/libs/Crypto.scala.html#play.api.libs.Crypto.generateSignedToken" title="=&gt; String">generateSignedToken</a>
    <span class="keyword">def</span> <a title="(tokenA: String, tokenB: String)Boolean" id="play.filters.csrf.CSRF.SignedTokenProvider.compareTokens">compareTokens</a><span class="delimiter">(</span><a title="String" id="play.filters.csrf.CSRF.SignedTokenProvider.compareTokens.tokenA">tokenA</a>: <span title="String">String</span>, <a title="String" id="play.filters.csrf.CSRF.SignedTokenProvider.compareTokens.tokenB">tokenB</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="../../../../play/play/api/libs/Crypto.scala.html#play.api.libs.Crypto" title="play.api.libs.Crypto.type">Crypto</a>.<a href="../../../../play/play/api/libs/Crypto.scala.html#play.api.libs.Crypto.compareSignedTokens" title="(tokenA: String, tokenB: String)Boolean">compareSignedTokens</a><span class="delimiter">(</span><a href="#play.filters.csrf.CSRF.SignedTokenProvider.compareTokens.tokenA" title="String">tokenA</a>, <a href="#play.filters.csrf.CSRF.SignedTokenProvider.compareTokens.tokenB" title="String">tokenB</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="play.filters.csrf.CSRF.UnsignedTokenProvider.type" id="play.filters.csrf.CSRF.UnsignedTokenProvider">UnsignedTokenProvider</a> <a href="#play.filters.csrf.CSRF.UnsignedTokenProvider" title="play.filters.csrf.CSRF.UnsignedTokenProvider.type" class="keyword">extends</a> <a href="#play.filters.csrf.CSRF;TokenProvider" title="play.filters.csrf.CSRF.TokenProvider">TokenProvider</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; String" id="play.filters.csrf.CSRF.UnsignedTokenProvider.generateToken">generateToken</a> = <a href="../../../../play/play/api/libs/Crypto.scala.html#play.api.libs.Crypto" title="play.api.libs.Crypto.type">Crypto</a>.<a href="../../../../play/play/api/libs/Crypto.scala.html#play.api.libs.Crypto.generateToken" title="=&gt; String">generateToken</a>
    <span class="keyword">def</span> <a title="(tokenA: String, tokenB: String)Boolean" id="play.filters.csrf.CSRF.UnsignedTokenProvider.compareTokens">compareTokens</a><span class="delimiter">(</span><a title="String" id="play.filters.csrf.CSRF.UnsignedTokenProvider.compareTokens.tokenA">tokenA</a>: <span title="String">String</span>, <a title="String" id="play.filters.csrf.CSRF.UnsignedTokenProvider.compareTokens.tokenB">tokenB</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="../../../../play/play/api/libs/Crypto.scala.html#play.api.libs.Crypto" title="play.api.libs.Crypto.type">Crypto</a>.<a href="../../../../play/play/api/libs/Crypto.scala.html#play.api.libs.Crypto.constantTimeEquals" title="(a: String, b: String)Boolean">constantTimeEquals</a><span class="delimiter">(</span><a href="#play.filters.csrf.CSRF.UnsignedTokenProvider.compareTokens.tokenA" title="String">tokenA</a>, <a href="#play.filters.csrf.CSRF.UnsignedTokenProvider.compareTokens.tokenB" title="String">tokenB</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * This trait handles the CSRF error.
   */</span>
  <span class="keyword">trait</span> <a title="trait ErrorHandler extends AnyRef" id="play.filters.csrf.CSRF;ErrorHandler">ErrorHandler</a> <span class="delimiter">{</span>
    <span class="comment">/** Handle a result */</span>
    <span class="keyword">def</span> <a title="(req: play.api.mvc.RequestHeader, msg: String)play.api.mvc.Result" id="play.filters.csrf.CSRF;ErrorHandler.handle">handle</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader" id="play.filters.csrf.CSRF;ErrorHandler.handle.req">req</a>: <a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a>, <a title="String" id="play.filters.csrf.CSRF;ErrorHandler.handle.msg">msg</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Result" title="play.api.mvc.Result">Result</a>
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="play.filters.csrf.CSRF.DefaultErrorHandler.type" id="play.filters.csrf.CSRF.DefaultErrorHandler">DefaultErrorHandler</a> <a href="#play.filters.csrf.CSRF.DefaultErrorHandler" title="play.filters.csrf.CSRF.DefaultErrorHandler.type" class="keyword">extends</a> <a href="#play.filters.csrf.CSRF;ErrorHandler" title="play.filters.csrf.CSRF.ErrorHandler">ErrorHandler</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(req: play.api.mvc.RequestHeader, msg: String)play.api.mvc.Result" id="play.filters.csrf.CSRF.DefaultErrorHandler.handle">handle</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader" id="play.filters.csrf.CSRF.DefaultErrorHandler.handle.req">req</a>: <a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a>, <a title="String" id="play.filters.csrf.CSRF.DefaultErrorHandler.handle.msg">msg</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Results;Status.apply" title="(content: String)(implicit writeable: play.api.http.Writeable[String])play.api.mvc.Result">Forbidden</a><a href="../../../../play/play/api/http/Writeable.scala.html#play.api.http;DefaultWriteables.wString" title="implicit play.api.http.DefaultWriteables.wString : (implicit codec: play.api.mvc.Codec)play.api.http.Writeable[String]" class="delimiter">(</a><a href="#play.filters.csrf.CSRF.DefaultErrorHandler.handle.msg" title="String">msg</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Default global, use this if CSRF is your only Filter
 */</span>
<span title="AnyRef" class="keyword">object</span> <a title="play.filters.csrf.Global.type" id="play.filters.csrf.Global">Global</a> <a href="#play.filters.csrf.Global" title="play.filters.csrf.Global.type" class="keyword">extends</a> <a href="../../../../play/play/api/mvc/Filters.scala.html#play.api.mvc;WithFilters" title="play.api.mvc.WithFilters">WithFilters</a><span class="delimiter">(</span><a href="CSRFFilter.scala.html#play.filters.csrf;CSRFFilter.<init>(7e5ee3d6ac)" title="()play.filters.csrf.CSRFFilter" class="keyword">new</a> <a href="CSRFFilter.scala.html#play.filters.csrf;CSRFFilter" title="play.filters.csrf.CSRFFilter">CSRFFilter</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">with</span> <a href="../../../../play/play/api/GlobalSettings.scala.html#play.api;GlobalSettings" title="play.api.GlobalSettings">GlobalSettings</a>


        </pre>
    </body>
</html>
