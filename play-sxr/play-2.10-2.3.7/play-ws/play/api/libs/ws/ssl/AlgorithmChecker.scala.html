<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>play-ws/play/api/libs/ws/ssl/AlgorithmChecker.scala</title>
        <script type="text/javascript" src="../../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2009-2013 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> play.api.libs.ws.ssl

<span class="keyword">import</span> java.security.cert._

<span class="keyword">import</span> scala.collection.<span title="scala.collection.JavaConverters.type">JavaConverters</span>._
<span class="keyword">import</span> javax.naming.ldap.<span class="delimiter">{</span> Rdn, LdapName <span class="delimiter">}</span>
<span class="keyword">import</span> javax.naming.InvalidNameException

<span class="comment">/**
 * Looks for disabled algorithms in the certificate.  This is because some certificates are signed with
 * forgable hashes such as MD2 or MD5, so we can't be certain of their authenticity.
 *
 * This class is needed because the JDK 1.6 Algorithm checker doesn't give us any way to customize the list of
 * disabled algorithms, and we need to be able to support that.
 *
 * Also note that we need to check the trust anchor for disabled key sizes, and the CertPath explicitly removes
 * the trust anchor from the chain of certificates.  This means we need to check the trust anchor explicitly in the
 * through the CompositeTrustManager.
 */</span>
<span class="keyword">class</span> <a title="class AlgorithmChecker extends java.security.cert.PKIXCertPathChecker" id="play.api.libs.ws.ssl;AlgorithmChecker">AlgorithmChecker</a><a href="#play.api.libs.ws.ssl;AlgorithmChecker" title="play.api.libs.ws.ssl.AlgorithmChecker" class="delimiter">(</a><span class="keyword">val</span> <a title="Set[play.api.libs.ws.ssl.AlgorithmConstraint]" id="play.api.libs.ws.ssl;AlgorithmChecker.signatureConstraints">signatureConstraints</a>: <span title="Set[play.api.libs.ws.ssl.AlgorithmConstraint]">Set</span><span class="delimiter">[</span>AlgorithmConstraint<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="Set[play.api.libs.ws.ssl.AlgorithmConstraint]" id="play.api.libs.ws.ssl;AlgorithmChecker.keyConstraints">keyConstraints</a>: <span title="Set[play.api.libs.ws.ssl.AlgorithmConstraint]">Set</span><span class="delimiter">[</span>AlgorithmConstraint<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.security.cert.PKIXCertPathChecker">PKIXCertPathChecker</span> <span class="delimiter">{</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="org.slf4j.Logger" id="play.api.libs.ws.ssl;AlgorithmChecker.logger">logger</a> = org.slf4j.<span title="org.slf4j.LoggerFactory.type">LoggerFactory</span>.<span title="(x$1: Class[_])org.slf4j.Logger">getLogger</span><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker" title="()Class[_]">getClass</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Map[String,play.api.libs.ws.ssl.AlgorithmConstraint]" id="play.api.libs.ws.ssl;AlgorithmChecker.signatureConstraintsMap">signatureConstraintsMap</a>: <span title="Map[String,play.api.libs.ws.ssl.AlgorithmConstraint]">Map</span><span class="delimiter">[</span>String, AlgorithmConstraint<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="play.api.libs.ws.ssl.AlgorithmConstraint" id="play.api.libs.ws.ssl;AlgorithmChecker.signatureConstraintsMap.$anonfun.c">c</a> &lt;- <a href="#play.api.libs.ws.ssl;AlgorithmChecker.signatureConstraints" title="=&gt; Set[play.api.libs.ws.ssl.AlgorithmConstraint]">signatureConstraints</a>.<span title="(f: play.api.libs.ws.ssl.AlgorithmConstraint =&gt; (String, play.api.libs.ws.ssl.AlgorithmConstraint))Iterator[(String, play.api.libs.ws.ssl.AlgorithmConstraint)]">iterator</span><span class="delimiter">)</span> <span class="keyword">yield</span> <span class="delimiter">{</span>
      <a href="#play.api.libs.ws.ssl;AlgorithmChecker.signatureConstraintsMap.$anonfun.c" title="play.api.libs.ws.ssl.AlgorithmConstraint">c</a>.<a href="Algorithms.scala.html#play.api.libs.ws.ssl;AlgorithmConstraint.algorithm" title="(x: String)ArrowAssoc[String]">algorithm</a> <span title="(y: play.api.libs.ws.ssl.AlgorithmConstraint)(String, play.api.libs.ws.ssl.AlgorithmConstraint)">-&gt;</span> <a href="#play.api.libs.ws.ssl;AlgorithmChecker.signatureConstraintsMap.$anonfun.c" title="play.api.libs.ws.ssl.AlgorithmConstraint">c</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>.<span title="(implicit ev: &lt;:&lt;[(String, play.api.libs.ws.ssl.AlgorithmConstraint),(String, play.api.libs.ws.ssl.AlgorithmConstraint)])scala.collection.immutable.Map[String,play.api.libs.ws.ssl.AlgorithmConstraint]">toMap</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Map[String,play.api.libs.ws.ssl.AlgorithmConstraint]" id="play.api.libs.ws.ssl;AlgorithmChecker.keyConstraintsMap">keyConstraintsMap</a>: <span title="Map[String,play.api.libs.ws.ssl.AlgorithmConstraint]">Map</span><span class="delimiter">[</span>String, AlgorithmConstraint<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="play.api.libs.ws.ssl.AlgorithmConstraint" id="play.api.libs.ws.ssl;AlgorithmChecker.keyConstraintsMap.$anonfun.c">c</a> &lt;- <a href="#play.api.libs.ws.ssl;AlgorithmChecker.keyConstraints" title="=&gt; Set[play.api.libs.ws.ssl.AlgorithmConstraint]">keyConstraints</a>.<span title="(f: play.api.libs.ws.ssl.AlgorithmConstraint =&gt; (String, play.api.libs.ws.ssl.AlgorithmConstraint))Iterator[(String, play.api.libs.ws.ssl.AlgorithmConstraint)]">iterator</span><span class="delimiter">)</span> <span class="keyword">yield</span> <span class="delimiter">{</span>
      <a href="#play.api.libs.ws.ssl;AlgorithmChecker.keyConstraintsMap.$anonfun.c" title="play.api.libs.ws.ssl.AlgorithmConstraint">c</a>.<a href="Algorithms.scala.html#play.api.libs.ws.ssl;AlgorithmConstraint.algorithm" title="(x: String)ArrowAssoc[String]">algorithm</a> <span title="(y: play.api.libs.ws.ssl.AlgorithmConstraint)(String, play.api.libs.ws.ssl.AlgorithmConstraint)">-&gt;</span> <a href="#play.api.libs.ws.ssl;AlgorithmChecker.keyConstraintsMap.$anonfun.c" title="play.api.libs.ws.ssl.AlgorithmConstraint">c</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>.<span title="(implicit ev: &lt;:&lt;[(String, play.api.libs.ws.ssl.AlgorithmConstraint),(String, play.api.libs.ws.ssl.AlgorithmConstraint)])scala.collection.immutable.Map[String,play.api.libs.ws.ssl.AlgorithmConstraint]">toMap</span>

  <span class="keyword">def</span> <a title="()Boolean" id="play.api.libs.ws.ssl;AlgorithmChecker.isForwardCheckingSupported">isForwardCheckingSupported</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>

  <span class="keyword">def</span> <a title="()java.util.Set[String]" id="play.api.libs.ws.ssl;AlgorithmChecker.getSupportedExtensions">getSupportedExtensions</a>: java.util.<span title="java.util.Set[String]">Set</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = java.util.<span title="java.util.Collections.type">Collections</span>.<span title="()java.util.Set[String]">emptySet</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(forward: Boolean)Unit" id="play.api.libs.ws.ssl;AlgorithmChecker.init">init</a><span class="delimiter">(</span><a title="Boolean" id="play.api.libs.ws.ssl;AlgorithmChecker.init.forward">forward</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#play.api.libs.ws.ssl;AlgorithmChecker.logger" title="=&gt; org.slf4j.Logger">logger</a>.<span title="(x$1: String)Unit">debug</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;init: forward = &quot;)">init: forward = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.init.forward" title="Boolean">forward</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
    <span class="comment">// forward is from target to most-trusted CA</span>
    <span class="comment">// backwards is from most-trusted CA to target, which means we get the root CA first.</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.init.forward" title="Boolean">forward</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)java.security.cert.CertPathValidatorException" class="keyword">new</span> <span title="java.security.cert.CertPathValidatorException">CertPathValidatorException</span><span class="delimiter">(</span><span title="String(&quot;Forward checking not supported&quot;)" class="string">&quot;Forward checking not supported&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(algorithm: String)Option[play.api.libs.ws.ssl.AlgorithmConstraint]" id="play.api.libs.ws.ssl;AlgorithmChecker.findSignatureConstraint">findSignatureConstraint</a><span class="delimiter">(</span><a title="String" id="play.api.libs.ws.ssl;AlgorithmChecker.findSignatureConstraint.algorithm">algorithm</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[play.api.libs.ws.ssl.AlgorithmConstraint]">Option</span><span class="delimiter">[</span>AlgorithmConstraint<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#play.api.libs.ws.ssl;AlgorithmChecker.signatureConstraintsMap" title="=&gt; Map[String,play.api.libs.ws.ssl.AlgorithmConstraint]">signatureConstraintsMap</a>.<span title="(key: String)Option[play.api.libs.ws.ssl.AlgorithmConstraint]">get</span><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.findSignatureConstraint.algorithm" title="String">algorithm</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(algorithm: String)Option[play.api.libs.ws.ssl.AlgorithmConstraint]" id="play.api.libs.ws.ssl;AlgorithmChecker.findKeyConstraint">findKeyConstraint</a><span class="delimiter">(</span><a title="String" id="play.api.libs.ws.ssl;AlgorithmChecker.findKeyConstraint.algorithm">algorithm</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[play.api.libs.ws.ssl.AlgorithmConstraint]">Option</span><span class="delimiter">[</span>AlgorithmConstraint<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#play.api.libs.ws.ssl;AlgorithmChecker.keyConstraintsMap" title="=&gt; Map[String,play.api.libs.ws.ssl.AlgorithmConstraint]">keyConstraintsMap</a>.<span title="(key: String)Option[play.api.libs.ws.ssl.AlgorithmConstraint]">get</span><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.findKeyConstraint.algorithm" title="String">algorithm</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Checks for signature algorithms in the certificate and throws CertPathValidatorException if matched.
   * @param x509Cert
   */</span>
  <span class="keyword">def</span> <a title="(x509Cert: java.security.cert.X509Certificate)Unit" id="play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms">checkSignatureAlgorithms</a><span class="delimiter">(</span><a title="java.security.cert.X509Certificate" id="play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.x509Cert">x509Cert</a>: <span title="java.security.cert.X509Certificate">X509Certificate</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.sigAlgName">sigAlgName</a> = <a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.x509Cert" title="java.security.cert.X509Certificate">x509Cert</a>.<span title="()String">getSigAlgName</span>
    <span class="keyword">val</span> <a title="Set[String]" id="play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.sigAlgorithms">sigAlgorithms</a> = <a href="Algorithms.scala.html#play.api.libs.ws.ssl.Algorithms" title="play.api.libs.ws.ssl.Algorithms.type">Algorithms</a>.<a href="Algorithms.scala.html#play.api.libs.ws.ssl.Algorithms.decomposes" title="(algorithm: String)Set[String]">decomposes</a><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.sigAlgName" title="String">sigAlgName</a><span class="delimiter">)</span>

    <a href="#play.api.libs.ws.ssl;AlgorithmChecker.logger" title="=&gt; org.slf4j.Logger">logger</a>.<span title="(x$1: String)Unit">debug</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;checkSignatureAlgorithms: sigAlgName = &quot;)">checkSignatureAlgorithms: sigAlgName = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.sigAlgName" title="String">sigAlgName</a><span title="String(&quot;, sigAlgName = &quot;)">, sigAlgName = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.sigAlgName" title="String">sigAlgName</a><span title="String(&quot;, sigAlgorithms = &quot;)">, sigAlgorithms = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.sigAlgorithms" title="Set[String]">sigAlgorithms</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>

    <span class="keyword">for</span> <span class="delimiter">(</span><a title="String" id="play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.$anonfun.a">a</a> &lt;- <a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.sigAlgorithms" title="(f: String =&gt; Option[Unit])Unit">sigAlgorithms</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#play.api.libs.ws.ssl;AlgorithmChecker.findSignatureConstraint" title="(algorithm: String)Option[play.api.libs.ws.ssl.AlgorithmConstraint]">findSignatureConstraint</a><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.$anonfun.a" title="String">a</a><span class="delimiter">)</span>.<span title="(f: play.api.libs.ws.ssl.AlgorithmConstraint =&gt; Unit)Option[Unit]">map</span> <span class="delimiter">{</span>
        <a title="play.api.libs.ws.ssl.AlgorithmConstraint" id="play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.$anonfun.$anonfun.constraint">constraint</a> =&gt;
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.$anonfun.$anonfun.constraint" title="play.api.libs.ws.ssl.AlgorithmConstraint">constraint</a>.<a href="Algorithms.scala.html#play.api.libs.ws.ssl;AlgorithmConstraint.matches(0945b1969a)" title="(algorithm: String)Boolean">matches</a><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.$anonfun.a" title="String">a</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#play.api.libs.ws.ssl;AlgorithmChecker.logger" title="=&gt; org.slf4j.Logger">logger</a>.<span title="(x$1: String)Unit">debug</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;checkSignatureAlgorithms: x509Cert = &quot;)">checkSignatureAlgorithms: x509Cert = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.x509Cert" title="java.security.cert.X509Certificate">x509Cert</a><span title="String(&quot; failed on constraint &quot;)"> failed on constraint $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.$anonfun.$anonfun.constraint" title="play.api.libs.ws.ssl.AlgorithmConstraint">constraint</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="String" id="play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.$anonfun.$anonfun.msg">msg</a> = <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Certificate failed: &quot;)">Certificate failed: $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.$anonfun.a" title="String">a</a><span title="String(&quot; matched constraint &quot;)"> matched constraint $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.$anonfun.$anonfun.constraint" title="play.api.libs.ws.ssl.AlgorithmConstraint">constraint</a><span title="String(&quot;&quot;)" class="string">&quot;</span>
            <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)java.security.cert.CertPathValidatorException" class="keyword">new</span> <span title="java.security.cert.CertPathValidatorException">CertPathValidatorException</span><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms.$anonfun.$anonfun.msg" title="String">msg</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Checks for key algorithms in the certificate and throws CertPathValidatorException if matched.
   * @param x509Cert
   */</span>
  <span class="keyword">def</span> <a title="(x509Cert: java.security.cert.X509Certificate)Unit" id="play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms">checkKeyAlgorithms</a><span class="delimiter">(</span><a title="java.security.cert.X509Certificate" id="play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.x509Cert">x509Cert</a>: <span title="java.security.cert.X509Certificate">X509Certificate</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.security.PublicKey" id="play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.key">key</a> = <a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.x509Cert" title="java.security.cert.X509Certificate">x509Cert</a>.<span title="()java.security.PublicKey">getPublicKey</span>
    <span class="keyword">val</span> <a title="String" id="play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.keyAlgorithmName">keyAlgorithmName</a> = <a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.key" title="java.security.PublicKey">key</a>.<span title="()String">getAlgorithm</span>
    <span class="keyword">val</span> <a title="Int" id="play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.keySize">keySize</a> = <a href="Algorithms.scala.html#play.api.libs.ws.ssl.Algorithms" title="play.api.libs.ws.ssl.Algorithms.type">Algorithms</a>.<a href="Algorithms.scala.html#play.api.libs.ws.ssl.Algorithms.keySize" title="(key: java.security.Key)Option[Int]">keySize</a><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.key" title="java.security.PublicKey">key</a><span class="delimiter">)</span>.<span title="(default: =&gt; Int)Int">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IllegalStateException" class="keyword">new</span> <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;No keySize found for &quot;)">No keySize found for $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.key" title="java.security.PublicKey">key</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Set[String]" id="play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.keyAlgorithms">keyAlgorithms</a> = <a href="Algorithms.scala.html#play.api.libs.ws.ssl.Algorithms" title="play.api.libs.ws.ssl.Algorithms.type">Algorithms</a>.<a href="Algorithms.scala.html#play.api.libs.ws.ssl.Algorithms.decomposes" title="(algorithm: String)Set[String]">decomposes</a><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.keyAlgorithmName" title="String">keyAlgorithmName</a><span class="delimiter">)</span>
    <a href="#play.api.libs.ws.ssl;AlgorithmChecker.logger" title="=&gt; org.slf4j.Logger">logger</a>.<span title="(x$1: String)Unit">debug</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;checkKeyAlgorithms: keyAlgorithmName = &quot;)">checkKeyAlgorithms: keyAlgorithmName = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.keyAlgorithmName" title="String">keyAlgorithmName</a><span title="String(&quot;, keySize = &quot;)">, keySize = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.keySize" title="Int">keySize</a><span title="String(&quot;, keyAlgorithms = &quot;)">, keyAlgorithms = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.keyAlgorithms" title="Set[String]">keyAlgorithms</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>

    <span class="keyword">for</span> <span class="delimiter">(</span><a title="String" id="play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.$anonfun.a">a</a> &lt;- <a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.keyAlgorithms" title="(f: String =&gt; Option[Unit])Unit">keyAlgorithms</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#play.api.libs.ws.ssl;AlgorithmChecker.findKeyConstraint" title="(algorithm: String)Option[play.api.libs.ws.ssl.AlgorithmConstraint]">findKeyConstraint</a><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.$anonfun.a" title="String">a</a><span class="delimiter">)</span>.<span title="(f: play.api.libs.ws.ssl.AlgorithmConstraint =&gt; Unit)Option[Unit]">map</span> <span class="delimiter">{</span>
        <a title="play.api.libs.ws.ssl.AlgorithmConstraint" id="play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.$anonfun.$anonfun.constraint">constraint</a> =&gt;
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.$anonfun.$anonfun.constraint" title="play.api.libs.ws.ssl.AlgorithmConstraint">constraint</a>.<a href="Algorithms.scala.html#play.api.libs.ws.ssl;AlgorithmConstraint.matches(0a891f0cc7)" title="(algorithm: String, keySize: Int)Boolean">matches</a><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.$anonfun.a" title="String">a</a>, <a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.keySize" title="Int">keySize</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="String" id="play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.$anonfun.$anonfun.certName">certName</a> = <a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.x509Cert" title="java.security.cert.X509Certificate">x509Cert</a>.<span title="()javax.security.auth.x500.X500Principal">getSubjectX500Principal</span>.<span title="()String">getName</span>
            <a href="#play.api.libs.ws.ssl;AlgorithmChecker.logger" title="=&gt; org.slf4j.Logger">logger</a>.<span title="(x$1: String)Unit">debug</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;&quot;&quot;<span title="String(&quot;checkKeyAlgorithms: cert = \&quot;certName\&quot; failed on constraint &quot;)">checkKeyAlgorithms: cert = &quot;certName&quot; failed on constraint $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.$anonfun.$anonfun.constraint" title="play.api.libs.ws.ssl.AlgorithmConstraint">constraint</a><span title="String(&quot;, algorithm = &quot;)">, algorithm = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.$anonfun.a" title="String">a</a><span title="String(&quot;, keySize = &quot;)">, keySize = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.keySize" title="Int">keySize</a><span title="String(&quot;&quot;)" class="string">&quot;&quot;&quot;</span><span class="delimiter">)</span>

            <span class="keyword">val</span> <a title="String" id="play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.$anonfun.$anonfun.msg">msg</a> = <span title="(args: Any*)String">s</span>&quot;&quot;&quot;<span title="String(&quot;Certificate failed: cert = \&quot;&quot;)">Certificate failed: cert = &quot;$</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.$anonfun.$anonfun.certName" title="String">certName</a><span title="String(&quot;\&quot; failed on constraint &quot;)">&quot; failed on constraint $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.$anonfun.$anonfun.constraint" title="play.api.libs.ws.ssl.AlgorithmConstraint">constraint</a><span title="String(&quot;, algorithm = &quot;)">, algorithm = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.$anonfun.a" title="String">a</a><span title="String(&quot;, keySize = &quot;)">, keySize = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.keySize" title="Int">keySize</a><span title="String(&quot;&quot;)" class="string">&quot;&quot;&quot;</span>
            <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)java.security.cert.CertPathValidatorException" class="keyword">new</span> <span title="java.security.cert.CertPathValidatorException">CertPathValidatorException</span><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms.$anonfun.$anonfun.msg" title="String">msg</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Checks the algorithms in the given certificate.  Note that this implementation skips signature checking in a
   * root certificate, as a trusted root cert by definition is in the trust store and doesn't need to be signed.
   */</span>
  <span class="keyword">def</span> <a title="(cert: java.security.cert.Certificate, unresolvedCritExts: java.util.Collection[String])Unit" id="play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69)">check</a><span class="delimiter">(</span><a title="java.security.cert.Certificate" id="play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).cert">cert</a>: <span title="java.security.cert.Certificate">Certificate</span>, <a title="java.util.Collection[String]" id="play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).unresolvedCritExts">unresolvedCritExts</a>: java.util.<span title="java.util.Collection[String]">Collection</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).cert" title="java.security.cert.Certificate">cert</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="java.security.cert.X509Certificate" id="play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).x509Cert">x509Cert</a>: <span title="java.security.cert.X509Certificate">X509Certificate</span> =&gt;

        <span class="keyword">val</span> <a title="String" id="play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).commonName">commonName</a> = <a href="#play.api.libs.ws.ssl;AlgorithmChecker.getCommonName" title="(cert: java.security.cert.X509Certificate)String">getCommonName</a><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).x509Cert" title="java.security.cert.X509Certificate">x509Cert</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="java.util.Collection[java.util.List[_]]" id="play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).subAltNames">subAltNames</a> = <a href="#play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).x509Cert" title="java.security.cert.X509Certificate">x509Cert</a>.<span title="()java.util.Collection[java.util.List[_]]">getSubjectAlternativeNames</span>
        <span class="keyword">val</span> <a title="String" id="play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).certName">certName</a> = <a href="#play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).x509Cert" title="java.security.cert.X509Certificate">x509Cert</a>.<span title="()javax.security.auth.x500.X500Principal">getSubjectX500Principal</span>.<span title="()String">getName</span>
        <a href="#play.api.libs.ws.ssl;AlgorithmChecker.logger" title="=&gt; org.slf4j.Logger">logger</a>.<span title="(x$1: String)Unit">debug</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;check: checking certificate commonName = &quot;)">check: checking certificate commonName = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).commonName" title="String">commonName</a><span title="String(&quot;, subjAltName = &quot;)">, subjAltName = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).subAltNames" title="java.util.Collection[java.util.List[_]]">subAltNames</a><span title="String(&quot;, certName = &quot;)">, certName = $</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).certName" title="String">certName</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>

        <a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkSignatureAlgorithms" title="(x509Cert: java.security.cert.X509Certificate)Unit">checkSignatureAlgorithms</a><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).x509Cert" title="java.security.cert.X509Certificate">x509Cert</a><span class="delimiter">)</span>
        <a href="#play.api.libs.ws.ssl;AlgorithmChecker.checkKeyAlgorithms" title="(x509Cert: java.security.cert.X509Certificate)Unit">checkKeyAlgorithms</a><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.check(046e34ef69).x509Cert" title="java.security.cert.X509Certificate">x509Cert</a><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt;
        <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)UnsupportedOperationException" class="keyword">new</span> <span title="UnsupportedOperationException">UnsupportedOperationException</span><span class="delimiter">(</span><span title="String(&quot;check only works with x509 certificates!&quot;)" class="string">&quot;check only works with x509 certificates!&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Useful way to get certificate info without getting spammed with data.
   */</span>
  <span class="keyword">def</span> <a title="(cert: java.security.cert.X509Certificate)String" id="play.api.libs.ws.ssl;AlgorithmChecker.getCommonName">getCommonName</a><span class="delimiter">(</span><a title="java.security.cert.X509Certificate" id="play.api.libs.ws.ssl;AlgorithmChecker.getCommonName.cert">cert</a>: <span title="java.security.cert.X509Certificate">X509Certificate</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="comment">// http://stackoverflow.com/a/18174689/5266</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="javax.naming.ldap.LdapName" id="play.api.libs.ws.ssl;AlgorithmChecker.getCommonName.ldapName">ldapName</a> = <span title="javax.naming.ldap.LdapName" class="keyword">new</span> <span title="javax.naming.ldap.LdapName">LdapName</span><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.getCommonName.cert" title="java.security.cert.X509Certificate">cert</a>.<span title="()javax.security.auth.x500.X500Principal">getSubjectX500Principal</span>.<span title="()String">getName</span><span class="delimiter">)</span>
      <span class="comment">/*
       * Looking for the &quot;most specific CN&quot; (i.e. the last).
       */</span>
      <span class="keyword">var</span> <a title="String" id="play.api.libs.ws.ssl;AlgorithmChecker.getCommonName.cn">cn</a>: <span title="String">String</span> = <span title="Null(null)" class="keyword">null</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="javax.naming.ldap.Rdn" id="play.api.libs.ws.ssl;AlgorithmChecker.getCommonName.$anonfun.rdn">rdn</a>: <span title="javax.naming.ldap.Rdn">Rdn</span> &lt;- <a href="#play.api.libs.ws.ssl;AlgorithmChecker.getCommonName.ldapName" title="javax.naming.ldap.LdapName">ldapName</a>.<span title="(l: java.util.List[javax.naming.ldap.Rdn])scala.collection.convert.Decorators.AsScala[scala.collection.mutable.Buffer[javax.naming.ldap.Rdn]]">getRdns</span>.<a href="#play.api.libs.ws.ssl;AlgorithmChecker.getCommonName.$anonfun.check$ifrefutable$1" title="(f: javax.naming.ldap.Rdn =&gt; Unit)Unit">asScala</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="String(&quot;CN&quot;)" class="string">&quot;CN&quot;</span>.<span title="(x$1: String)Boolean">equalsIgnoreCase</span><span class="delimiter">(</span><a href="#play.api.libs.ws.ssl;AlgorithmChecker.getCommonName.$anonfun.rdn" title="javax.naming.ldap.Rdn">rdn</a>.<span title="()String">getType</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#play.api.libs.ws.ssl;AlgorithmChecker.getCommonName.cn" title="String">cn</a> = <a href="#play.api.libs.ws.ssl;AlgorithmChecker.getCommonName.$anonfun.rdn" title="javax.naming.ldap.Rdn">rdn</a>.<span title="()Object">getValue</span>.<span title="()String">toString</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#play.api.libs.ws.ssl;AlgorithmChecker.getCommonName.cn" title="String">cn</a>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="javax.naming.InvalidNameException" id="play.api.libs.ws.ssl;AlgorithmChecker.getCommonName.e">e</a>: <span title="javax.naming.InvalidNameException">InvalidNameException</span> =&gt;
        <span title="Null(null)" class="keyword">null</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
