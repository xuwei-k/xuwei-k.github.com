<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>play/play/core/server/netty/NettyResultStreamer.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2009-2013 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> play.core.server.netty

<span class="keyword">import</span> play.api.mvc._
<span class="keyword">import</span> play.api.libs.iteratee._
<span class="keyword">import</span> play.api._

<span class="keyword">import</span> org.jboss.netty.handler.codec.http.<span title="org.jboss.netty.handler.codec.http.HttpHeaders.type">HttpHeaders</span>.<span title="org.jboss.netty.handler.codec.http.HttpHeaders.Names.type">Names</span>._
<span class="keyword">import</span> org.jboss.netty.buffer.ChannelBuffers
<span class="keyword">import</span> org.jboss.netty.channel._
<span class="keyword">import</span> org.jboss.netty.handler.codec.http._
<span class="keyword">import</span> org.jboss.netty.handler.codec.http.<span title="org.jboss.netty.handler.codec.http.HttpHeaders.type">HttpHeaders</span>.<span title="org.jboss.netty.handler.codec.http.HttpHeaders.Values.type">Values</span>._

<span class="keyword">import</span> com.typesafe.netty.http.pipelining.<span class="delimiter">{</span> OrderedDownstreamChannelEvent, OrderedUpstreamMessageEvent <span class="delimiter">}</span>

<span class="keyword">import</span> scala.concurrent.Future
<span class="keyword">import</span> scala.util.<span class="delimiter">{</span> Failure, Success <span class="delimiter">}</span>

<span class="comment">/**
 * Streams Play results to Netty
 */</span>
<span class="keyword">object</span> <a title="play.core.server.netty.NettyResultStreamer.type" id="play.core.server.netty.NettyResultStreamer">NettyResultStreamer</a> <a href="#play.core.server.netty.NettyResultStreamer" title="play.core.server.netty.NettyResultStreamer.type" class="delimiter">{</a>

  <span class="keyword">import</span> <a href="NettyFuture.scala.html#play.core.server.netty.NettyFuture" title="play.core.server.netty.NettyFuture.type">NettyFuture</a>._

  <span class="comment">// A channel status holds whether the connection must be closed and the last subsequence sent</span>
  <span class="keyword">class</span> <a title="class ChannelStatus extends AnyRef" id="play.core.server.netty.NettyResultStreamer;ChannelStatus">ChannelStatus</a><a href="#play.core.server.netty.NettyResultStreamer;ChannelStatus" title="play.core.server.netty.NettyResultStreamer.ChannelStatus" class="delimiter">(</a><span class="keyword">val</span> <a title="Boolean" id="play.core.server.netty.NettyResultStreamer;ChannelStatus.closeConnection">closeConnection</a>: <span title="Boolean">Boolean</span>, <span class="keyword">val</span> <a title="Int" id="play.core.server.netty.NettyResultStreamer;ChannelStatus.lastSubsequence">lastSubsequence</a>: <span title="Int">Int</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Send the result to netty
   *
   * @return A Future that will be redeemed when the result is completely sent
   */</span>
  <span class="keyword">def</span> <a title="(result: play.api.mvc.Result, closeConnection: Boolean, httpVersion: org.jboss.netty.handler.codec.http.HttpVersion, startSequence: Int)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit oue: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)scala.concurrent.Future[_]" id="play.core.server.netty.NettyResultStreamer.sendResult">sendResult</a><span class="delimiter">(</span><a title="play.api.mvc.Result" id="play.core.server.netty.NettyResultStreamer.sendResult.result">result</a>: <a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result" title="play.api.mvc.Result">Result</a>, <a title="Boolean" id="play.core.server.netty.NettyResultStreamer.sendResult.closeConnection">closeConnection</a>: <span title="Boolean">Boolean</span>, <a title="org.jboss.netty.handler.codec.http.HttpVersion" id="play.core.server.netty.NettyResultStreamer.sendResult.httpVersion">httpVersion</a>: <span title="org.jboss.netty.handler.codec.http.HttpVersion">HttpVersion</span>, <a title="Int" id="play.core.server.netty.NettyResultStreamer.sendResult.startSequence">startSequence</a>: <span title="Int">Int</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.jboss.netty.channel.ChannelHandlerContext" id="play.core.server.netty.NettyResultStreamer.sendResult.ctx">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent" id="play.core.server.netty.NettyResultStreamer.sendResult.oue">oue</a>: <span title="com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent">OrderedUpstreamMessageEvent</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[_]">Future</span><span class="delimiter">[</span>_<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="comment">// Result of this iteratee is a completion status</span>
    <span class="keyword">val</span> <a title="scala.concurrent.Future[play.core.server.netty.NettyResultStreamer.ChannelStatus]" id="play.core.server.netty.NettyResultStreamer.sendResult.sentResponse">sentResponse</a>: <span title="scala.concurrent.Future[play.core.server.netty.NettyResultStreamer.ChannelStatus]">Future</span><span class="delimiter">[</span>ChannelStatus<span class="delimiter">]</span> = <a href="#play.core.server.netty.NettyResultStreamer.sendResult.result" title="play.api.mvc.Result">result</a> <span title="scala.concurrent.Future[play.core.server.netty.NettyResultStreamer.ChannelStatus]" class="keyword">match</span> <span class="delimiter">{</span>

      <span class="keyword">case</span> <a title="play.api.mvc.Result" id="play.core.server.netty.NettyResultStreamer.sendResult.sentResponse.res">res</a> <span class="keyword">if</span> <a href="#play.core.server.netty.NettyResultStreamer.sendResult.sentResponse.res" title="play.api.mvc.Result">res</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.header" title="=&gt; play.api.mvc.ResponseHeader">header</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;ResponseHeader.headers" title="=&gt; Map[String,String]">headers</a>.<span title="(p: ((String, String)) =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.sendResult.sentResponse.$anonfun.x$1" title="(String, String)">_</a>.<span title="=&gt; String">_2</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="comment">// Make sure enumerator knows it's done, so that any resources it uses can be cleaned up</span>
        <a href="#play.core.server.netty.NettyResultStreamer.sendResult.result" title="play.api.mvc.Result">result</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.body" title="=&gt; play.api.libs.iteratee.Enumerator[Array[Byte]]">body</a> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Enumerator.scala.html#play.api.libs.iteratee;Enumerator.|>>" title="(i: play.api.libs.iteratee.Iteratee[Array[Byte],Unit])scala.concurrent.Future[play.api.libs.iteratee.Iteratee[Array[Byte],Unit]]">|&gt;&gt;</a> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Done.apply" title="(a: Unit, e: play.api.libs.iteratee.Input[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],Unit]">Done</a><span class="delimiter">(</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <a href="../../../api/Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../../../api/Play.scala.html#play.api.Play.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../api/Logger.scala.html#play.api;LoggerLike.debug(83d3728a3c)" title="(message: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Response with headers set to null, sending 500 response.&quot;)" class="string">&quot;Response with headers set to null, sending 500 response.&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <span title="play.api.mvc.Result">error</span> = <a href="../../../api/mvc/Results.scala.html#play.api.mvc.Results" title="play.api.mvc.Results.type">Results</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Results;Status.apply" title="(content: String)(implicit writeable: play.api.http.Writeable[String])play.api.mvc.Result">InternalServerError</a><a href="../../../api/http/Writeable.scala.html#play.api.http;DefaultWriteables.wString" title="implicit play.api.http.DefaultWriteables.wString : (implicit codec: play.api.mvc.Codec)play.api.http.Writeable[String]" class="delimiter">(</a><span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
        <span title="play.api.mvc.Result">error</span>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.body" title="=&gt; play.api.libs.iteratee.Enumerator[Array[Byte]]">body</a> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Enumerator.scala.html#play.api.libs.iteratee;Enumerator.|>>>" title="(i: play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus])scala.concurrent.Future[play.core.server.netty.NettyResultStreamer.ChannelStatus]">|&gt;&gt;&gt;</a> <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee" title="(nettyResponse: org.jboss.netty.handler.codec.http.HttpResponse, startSequence: Int, closeConnection: Boolean)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit e: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">nettyStreamIteratee</a><a href="#play.core.server.netty.NettyResultStreamer.sendResult.ctx" title="org.jboss.netty.channel.ChannelHandlerContext" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse" title="(header: play.api.mvc.ResponseHeader, closeConnection: Boolean, httpVersion: org.jboss.netty.handler.codec.http.HttpVersion)org.jboss.netty.handler.codec.http.DefaultHttpResponse">createNettyResponse</a><span class="delimiter">(</span><span title="play.api.mvc.Result">error</span>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.header" title="=&gt; play.api.mvc.ResponseHeader">header</a>, <span title="Boolean(true)" class="keyword">true</span>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.httpVersion" title="org.jboss.netty.handler.codec.http.HttpVersion">httpVersion</a><span class="delimiter">)</span>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.startSequence" title="Int">startSequence</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="comment">// Sanitisation: ensure that we don't send chunked responses to HTTP 1.0 requests</span>
      <span class="keyword">case</span> <a href="#play.core.server.netty.NettyResultStreamer.UsesTransferEncoding.unapply" title="(result: play.api.mvc.Result)Boolean">UsesTransferEncoding</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#play.core.server.netty.NettyResultStreamer.sendResult.httpVersion" title="org.jboss.netty.handler.codec.http.HttpVersion">httpVersion</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="org.jboss.netty.handler.codec.http.HttpVersion.type">HttpVersion</span>.<span title="org.jboss.netty.handler.codec.http.HttpVersion">HTTP_1_0</span> =&gt; <span class="delimiter">{</span>
        <span class="comment">// Make sure enumerator knows it's done, so that any resources it uses can be cleaned up</span>
        <a href="#play.core.server.netty.NettyResultStreamer.sendResult.result" title="play.api.mvc.Result">result</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.body" title="=&gt; play.api.libs.iteratee.Enumerator[Array[Byte]]">body</a> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Enumerator.scala.html#play.api.libs.iteratee;Enumerator.|>>" title="(i: play.api.libs.iteratee.Iteratee[Array[Byte],Unit])scala.concurrent.Future[play.api.libs.iteratee.Iteratee[Array[Byte],Unit]]">|&gt;&gt;</a> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Done.apply" title="(a: Unit, e: play.api.libs.iteratee.Input[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],Unit]">Done</a><span class="delimiter">(</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <a href="../../../api/Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../../../api/Play.scala.html#play.api.Play.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../api/Logger.scala.html#play.api;LoggerLike.debug(83d3728a3c)" title="(message: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Chunked response to HTTP/1.0 request, sending 505 response.&quot;)" class="string">&quot;Chunked response to HTTP/1.0 request, sending 505 response.&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <span title="play.api.mvc.Result">error</span> = <a href="../../../api/mvc/Results.scala.html#play.api.mvc.Results" title="play.api.mvc.Results.type">Results</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Results;Status.apply" title="(content: String)(implicit writeable: play.api.http.Writeable[String])play.api.mvc.Result">HttpVersionNotSupported</a><a href="../../../api/http/Writeable.scala.html#play.api.http;DefaultWriteables.wString" title="implicit play.api.http.DefaultWriteables.wString : (implicit codec: play.api.mvc.Codec)play.api.http.Writeable[String]" class="delimiter">(</a><span title="String(&quot;The response to this request is chunked and hence requires HTTP 1.1 to be sent, but this is a HTTP 1.0 request.&quot;)" class="string">&quot;The response to this request is chunked and hence requires HTTP 1.1 to be sent, but this is a HTTP 1.0 request.&quot;</span><span class="delimiter">)</span>
        <span title="play.api.mvc.Result">error</span>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.body" title="=&gt; play.api.libs.iteratee.Enumerator[Array[Byte]]">body</a> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Enumerator.scala.html#play.api.libs.iteratee;Enumerator.|>>>" title="(i: play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus])scala.concurrent.Future[play.core.server.netty.NettyResultStreamer.ChannelStatus]">|&gt;&gt;&gt;</a> <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee" title="(nettyResponse: org.jboss.netty.handler.codec.http.HttpResponse, startSequence: Int, closeConnection: Boolean)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit e: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">nettyStreamIteratee</a><a href="#play.core.server.netty.NettyResultStreamer.sendResult.ctx" title="org.jboss.netty.channel.ChannelHandlerContext" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse" title="(header: play.api.mvc.ResponseHeader, closeConnection: Boolean, httpVersion: org.jboss.netty.handler.codec.http.HttpVersion)org.jboss.netty.handler.codec.http.DefaultHttpResponse">createNettyResponse</a><span class="delimiter">(</span><span title="play.api.mvc.Result">error</span>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.header" title="=&gt; play.api.mvc.ResponseHeader">header</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.closeConnection" title="Boolean">closeConnection</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.httpVersion" title="org.jboss.netty.handler.codec.http.HttpVersion">httpVersion</a><span class="delimiter">)</span>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.startSequence" title="Int">startSequence</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.closeConnection" title="Boolean">closeConnection</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">case</span> <a href="#play.core.server.netty.NettyResultStreamer.CloseConnection.unapply" title="(result: play.api.mvc.Result)Boolean">CloseConnection</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#play.core.server.netty.NettyResultStreamer.sendResult.result" title="play.api.mvc.Result">result</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.body" title="=&gt; play.api.libs.iteratee.Enumerator[Array[Byte]]">body</a> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Enumerator.scala.html#play.api.libs.iteratee;Enumerator.|>>>" title="(i: play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus])scala.concurrent.Future[play.core.server.netty.NettyResultStreamer.ChannelStatus]">|&gt;&gt;&gt;</a> <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee" title="(nettyResponse: org.jboss.netty.handler.codec.http.HttpResponse, startSequence: Int, closeConnection: Boolean)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit e: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">nettyStreamIteratee</a><a href="#play.core.server.netty.NettyResultStreamer.sendResult.ctx" title="org.jboss.netty.channel.ChannelHandlerContext" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse" title="(header: play.api.mvc.ResponseHeader, closeConnection: Boolean, httpVersion: org.jboss.netty.handler.codec.http.HttpVersion)org.jboss.netty.handler.codec.http.DefaultHttpResponse">createNettyResponse</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.sendResult.result" title="play.api.mvc.Result">result</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.header" title="=&gt; play.api.mvc.ResponseHeader">header</a>, <span title="Boolean(true)" class="keyword">true</span>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.httpVersion" title="org.jboss.netty.handler.codec.http.HttpVersion">httpVersion</a><span class="delimiter">)</span>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.startSequence" title="Int">startSequence</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">case</span> <a href="#play.core.server.netty.NettyResultStreamer.EndOfBodyInProtocol.unapply" title="(result: play.api.mvc.Result)Boolean">EndOfBodyInProtocol</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#play.core.server.netty.NettyResultStreamer.sendResult.result" title="play.api.mvc.Result">result</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.body" title="=&gt; play.api.libs.iteratee.Enumerator[Array[Byte]]">body</a> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Enumerator.scala.html#play.api.libs.iteratee;Enumerator.|>>>" title="(i: play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus])scala.concurrent.Future[play.core.server.netty.NettyResultStreamer.ChannelStatus]">|&gt;&gt;&gt;</a> <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee" title="(nettyResponse: org.jboss.netty.handler.codec.http.HttpResponse, startSequence: Int, closeConnection: Boolean)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit e: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">nettyStreamIteratee</a><a href="#play.core.server.netty.NettyResultStreamer.sendResult.ctx" title="org.jboss.netty.channel.ChannelHandlerContext" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse" title="(header: play.api.mvc.ResponseHeader, closeConnection: Boolean, httpVersion: org.jboss.netty.handler.codec.http.HttpVersion)org.jboss.netty.handler.codec.http.DefaultHttpResponse">createNettyResponse</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.sendResult.result" title="play.api.mvc.Result">result</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.header" title="=&gt; play.api.mvc.ResponseHeader">header</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.closeConnection" title="Boolean">closeConnection</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.httpVersion" title="org.jboss.netty.handler.codec.http.HttpVersion">httpVersion</a><span class="delimiter">)</span>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.startSequence" title="Int">startSequence</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.closeConnection" title="Boolean">closeConnection</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">case</span> _ =&gt; <span class="delimiter">{</span>
        <a href="#play.core.server.netty.NettyResultStreamer.sendResult.result" title="play.api.mvc.Result">result</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.body" title="=&gt; play.api.libs.iteratee.Enumerator[Array[Byte]]">body</a> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Enumerator.scala.html#play.api.libs.iteratee;Enumerator.|>>>" title="(i: play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus])scala.concurrent.Future[play.core.server.netty.NettyResultStreamer.ChannelStatus]">|&gt;&gt;&gt;</a> <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee" title="(nettyResponse: org.jboss.netty.handler.codec.http.HttpResponse, startSequence: Int, closeConnection: Boolean, httpVersion: org.jboss.netty.handler.codec.http.HttpVersion)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit e: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">bufferingIteratee</a><a href="#play.core.server.netty.NettyResultStreamer.sendResult.ctx" title="org.jboss.netty.channel.ChannelHandlerContext" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse" title="(header: play.api.mvc.ResponseHeader, closeConnection: Boolean, httpVersion: org.jboss.netty.handler.codec.http.HttpVersion)org.jboss.netty.handler.codec.http.DefaultHttpResponse">createNettyResponse</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.sendResult.result" title="play.api.mvc.Result">result</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.header" title="=&gt; play.api.mvc.ResponseHeader">header</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.closeConnection" title="Boolean">closeConnection</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.httpVersion" title="org.jboss.netty.handler.codec.http.HttpVersion">httpVersion</a><span class="delimiter">)</span>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.startSequence" title="Int">startSequence</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.closeConnection" title="Boolean">closeConnection</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.httpVersion" title="org.jboss.netty.handler.codec.http.HttpVersion">httpVersion</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span>

    <span class="comment">// Clean up</span>
    <span class="keyword">import</span> play.api.libs.iteratee.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution" title="play.api.libs.iteratee.Execution.type">Execution</a>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution.Implicits" title="play.api.libs.iteratee.Execution.Implicits.type">Implicits</a>.trampoline

    <a href="#play.core.server.netty.NettyResultStreamer.sendResult.sentResponse" title="scala.concurrent.Future[play.core.server.netty.NettyResultStreamer.ChannelStatus]">sentResponse</a>.<span title="(func: scala.util.Try[play.core.server.netty.NettyResultStreamer.ChannelStatus] =&gt; Any)(implicit executor: scala.concurrent.ExecutionContext)Unit">onComplete</span> <a href="#play.core.server.netty.NettyResultStreamer.sendResult.$anonfun.x0$2" title="Any" class="delimiter">{</a>
      <span class="keyword">case</span> Success<span class="delimiter">(</span><a title="play.core.server.netty.NettyResultStreamer.ChannelStatus" id="play.core.server.netty.NettyResultStreamer.sendResult.$anonfun.cs">cs</a>: <a href="#play.core.server.netty.NettyResultStreamer;ChannelStatus" title="play.core.server.netty.NettyResultStreamer.ChannelStatus">ChannelStatus</a><span class="delimiter">)</span> =&gt;
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.sendResult.$anonfun.cs" title="play.core.server.netty.NettyResultStreamer.ChannelStatus">cs</a>.<a href="#play.core.server.netty.NettyResultStreamer;ChannelStatus.closeConnection" title="=&gt; Boolean">closeConnection</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="comment">// Close in an orderely fashion.</span>
          <span class="keyword">val</span> <a title="org.jboss.netty.channel.Channel" id="play.core.server.netty.NettyResultStreamer.sendResult.$anonfun.channel">channel</a> = <a href="#play.core.server.netty.NettyResultStreamer.sendResult.oue" title="com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent">oue</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>;
          <span class="keyword">val</span> <a title="org.jboss.netty.channel.DownstreamChannelStateEvent" id="play.core.server.netty.NettyResultStreamer.sendResult.$anonfun.closeEvent">closeEvent</a> = <span title="org.jboss.netty.channel.DownstreamChannelStateEvent" class="keyword">new</span> <span title="org.jboss.netty.channel.DownstreamChannelStateEvent">DownstreamChannelStateEvent</span><span class="delimiter">(</span>
            <a href="#play.core.server.netty.NettyResultStreamer.sendResult.$anonfun.channel" title="org.jboss.netty.channel.Channel">channel</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.$anonfun.channel" title="org.jboss.netty.channel.Channel">channel</a>.<span title="()org.jboss.netty.channel.ChannelFuture">getCloseFuture</span>, ChannelState.<span title="org.jboss.netty.channel.ChannelState(OPEN)">OPEN</span>, java.lang.<span title="Boolean.type">Boolean</span>.<span title="Boolean">FALSE</span><span class="delimiter">)</span>;
          <span class="keyword">val</span> <a title="com.typesafe.netty.http.pipelining.OrderedDownstreamChannelEvent" id="play.core.server.netty.NettyResultStreamer.sendResult.$anonfun.ode">ode</a> = <span title="com.typesafe.netty.http.pipelining.OrderedDownstreamChannelEvent" class="keyword">new</span> <span title="com.typesafe.netty.http.pipelining.OrderedDownstreamChannelEvent">OrderedDownstreamChannelEvent</span><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.sendResult.oue" title="com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent">oue</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.$anonfun.cs" title="play.core.server.netty.NettyResultStreamer.ChannelStatus">cs</a>.<a href="#play.core.server.netty.NettyResultStreamer;ChannelStatus.lastSubsequence" title="=&gt; Int">lastSubsequence</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <span title="Boolean(true)" class="keyword">true</span>, <a href="#play.core.server.netty.NettyResultStreamer.sendResult.$anonfun.closeEvent" title="org.jboss.netty.channel.DownstreamChannelStateEvent">closeEvent</a><span class="delimiter">)</span>
          <a href="#play.core.server.netty.NettyResultStreamer.sendResult.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="(x$1: org.jboss.netty.channel.ChannelEvent)Unit">sendDownstream</span><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.sendResult.$anonfun.ode" title="com.typesafe.netty.http.pipelining.OrderedDownstreamChannelEvent">ode</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> Failure<span class="delimiter">(</span><a title="Throwable" id="play.core.server.netty.NettyResultStreamer.sendResult.$anonfun.ex">ex</a><span class="delimiter">)</span> =&gt;
        <a href="../../../api/Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../../../api/Play.scala.html#play.api.Play.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../api/Logger.scala.html#play.api;LoggerLike.debug(83d3728a3c)" title="(message: =&gt; String)Unit">debug</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.sendResult.$anonfun.ex" title="Throwable">ex</a>.<span title="()String">toString</span><span class="delimiter">)</span>
        <span title="org.jboss.netty.channel.Channels.type">Channels</span>.<span title="(x$1: org.jboss.netty.channel.Channel)org.jboss.netty.channel.ChannelFuture">close</span><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.sendResult.oue" title="com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent">oue</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#play.core.server.netty.NettyResultStreamer.sendResult.sentResponse" title="scala.concurrent.Future[play.core.server.netty.NettyResultStreamer.ChannelStatus]">sentResponse</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * An iteratee that buffers the first element from the enumerator, and if it then receives EOF, sends the a result
   * immediately with the body and a content length.
   *
   * If there is more than one element from the enumerator, it sends the response either as chunked or as a stream that
   * gets closed, depending on whether the protocol is HTTP 1.0 or HTTP 1.1.
   */</span>
  <span class="keyword">def</span> <a title="(nettyResponse: org.jboss.netty.handler.codec.http.HttpResponse, startSequence: Int, closeConnection: Boolean, httpVersion: org.jboss.netty.handler.codec.http.HttpVersion)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit e: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee">bufferingIteratee</a><span class="delimiter">(</span><a title="org.jboss.netty.handler.codec.http.HttpResponse" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.nettyResponse">nettyResponse</a>: <span title="org.jboss.netty.handler.codec.http.HttpResponse">HttpResponse</span>, <a title="Int" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.startSequence">startSequence</a>: <span title="Int">Int</span>, <a title="Boolean" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.closeConnection">closeConnection</a>: <span title="Boolean">Boolean</span>, <a title="org.jboss.netty.handler.codec.http.HttpVersion" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.httpVersion">httpVersion</a>: <span title="org.jboss.netty.handler.codec.http.HttpVersion">HttpVersion</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.jboss.netty.channel.ChannelHandlerContext" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.ctx">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.e">e</a>: <span title="com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent">OrderedUpstreamMessageEvent</span><span class="delimiter">)</span>: <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee" title="play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">Iteratee</a><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>, ChannelStatus<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <span class="comment">// Left is the first chunk if there was more than one chunk, right is the zero or one and only chunk</span>
    <span class="keyword">def</span> <a title="(chunk: Option[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],Either[Array[Byte],Option[Array[Byte]]]]" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.takeUpToOneChunk">takeUpToOneChunk</a><span class="delimiter">(</span><a title="Option[Array[Byte]]" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.takeUpToOneChunk.chunk">chunk</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee" title="play.api.libs.iteratee.Iteratee[Array[Byte],Either[Array[Byte],Option[Array[Byte]]]]">Iteratee</a><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>, Either<span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>, Option<span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span> = <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Cont.apply" title="(k: play.api.libs.iteratee.Input[Array[Byte]] =&gt; play.api.libs.iteratee.Iteratee[Array[Byte],Either[Array[Byte],Option[Array[Byte]]]])play.api.libs.iteratee.Iteratee[Array[Byte],Either[Array[Byte],Option[Array[Byte]]]]">Cont</a> <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.takeUpToOneChunk.$anonfun.x0$3" title="play.api.libs.iteratee.Iteratee[Array[Byte],Either[Array[Byte],Option[Array[Byte]]]]" class="delimiter">{</a>
      <span class="comment">// We have a second chunk, fail with left</span>
      <span class="keyword">case</span> <a title="play.api.libs.iteratee.Input.El[Array[Byte]]" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.takeUpToOneChunk.$anonfun.in">in</a> @ Input.El<span class="delimiter">(</span><span title="Array[Byte]">data</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.takeUpToOneChunk.chunk" title="Option[Array[Byte]]">chunk</a>.<span title="=&gt; Boolean">isDefined</span> =&gt; <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Done.apply" title="(a: scala.util.Left[Array[Byte],Nothing], e: play.api.libs.iteratee.Input[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],scala.util.Left[Array[Byte],Nothing]]">Done</a><span class="delimiter">(</span><span title="(a: Array[Byte])scala.util.Left[Array[Byte],Nothing]">Left</span><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.takeUpToOneChunk.chunk" title="Option[Array[Byte]]">chunk</a>.<span title="=&gt; Array[Byte]">get</span><span class="delimiter">)</span>, <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.takeUpToOneChunk.$anonfun.in" title="play.api.libs.iteratee.Input.El[Array[Byte]]">in</a><span class="delimiter">)</span>
      <span class="comment">// This is the first chunk</span>
      <span class="keyword">case</span> Input.El<span class="delimiter">(</span><span title="Array[Byte]">data</span><span class="delimiter">)</span> =&gt; <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.takeUpToOneChunk" title="(chunk: Option[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],Either[Array[Byte],Option[Array[Byte]]]]">takeUpToOneChunk</a><span class="delimiter">(</span><span title="(x: Array[Byte])Some[Array[Byte]]">Some</span><span class="delimiter">(</span><span title="Array[Byte]">data</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Input" title="play.api.libs.iteratee.Input.type">Input</a>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Input.Empty" title="play.api.libs.iteratee.Input.Empty.type">Empty</a> =&gt; <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.takeUpToOneChunk" title="(chunk: Option[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],Either[Array[Byte],Option[Array[Byte]]]]">takeUpToOneChunk</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.takeUpToOneChunk.chunk" title="Option[Array[Byte]]">chunk</a><span class="delimiter">)</span>
      <span class="comment">// We reached EOF, which means we either have one or zero chunks</span>
      <span class="keyword">case</span> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Input" title="play.api.libs.iteratee.Input.type">Input</a>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Input.EOF" title="play.api.libs.iteratee.Input.EOF.type">EOF</a> =&gt; <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Done.apply" title="(a: scala.util.Right[Nothing,Option[Array[Byte]]], e: play.api.libs.iteratee.Input[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],scala.util.Right[Nothing,Option[Array[Byte]]]]">Done</a><span class="delimiter">(</span><span title="(b: Option[Array[Byte]])scala.util.Right[Nothing,Option[Array[Byte]]]">Right</span><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.takeUpToOneChunk.chunk" title="Option[Array[Byte]]">chunk</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">import</span> play.api.libs.iteratee.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution" title="play.api.libs.iteratee.Execution.type">Execution</a>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution.Implicits" title="play.api.libs.iteratee.Execution.Implicits.type">Implicits</a>.trampoline

    <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.takeUpToOneChunk" title="(chunk: Option[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],Either[Array[Byte],Option[Array[Byte]]]]">takeUpToOneChunk</a><span class="delimiter">(</span><span title="None.type">None</span><span class="delimiter">)</span>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee.flatMap" title="(f: Either[Array[Byte],Option[Array[Byte]]] =&gt; play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus])(implicit ec: scala.concurrent.ExecutionContext)play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">flatMap</a> <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.x0$4" title="play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]" class="delimiter">{</a>
      <span class="keyword">case</span> Right<span class="delimiter">(</span><span title="Option[Array[Byte]]">chunk</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="org.jboss.netty.buffer.ChannelBuffer" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.buffer">buffer</a> = <span title="Option[Array[Byte]]">chunk</span>.<span title="(f: Array[Byte] =&gt; org.jboss.netty.buffer.ChannelBuffer)Option[org.jboss.netty.buffer.ChannelBuffer]">map</span><span class="delimiter">(</span><span title="org.jboss.netty.buffer.ChannelBuffers.type">ChannelBuffers</span>.<a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.buffer.$anonfun.x$1" title="(x$1: Array[Byte])org.jboss.netty.buffer.ChannelBuffer">wrappedBuffer</a><span class="delimiter">)</span>.<span title="(default: =&gt; org.jboss.netty.buffer.ChannelBuffer)org.jboss.netty.buffer.ChannelBuffer">getOrElse</span><span class="delimiter">(</span><span title="org.jboss.netty.buffer.ChannelBuffers.type">ChannelBuffers</span>.<span title="org.jboss.netty.buffer.ChannelBuffer">EMPTY_BUFFER</span><span class="delimiter">)</span>
        <span class="comment">// We successfully buffered it, so set the content length and send the whole thing as one buffer</span>
        <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.nettyResponse" title="org.jboss.netty.handler.codec.http.HttpResponse">nettyResponse</a>.<span title="()org.jboss.netty.handler.codec.http.HttpHeaders">headers</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: String, x$2: Any)org.jboss.netty.handler.codec.http.HttpHeaders">set</span><span class="delimiter">(</span><span title="String(&quot;Content-Length&quot;)">CONTENT_LENGTH</span>, <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.buffer" title="org.jboss.netty.buffer.ChannelBuffer">buffer</a>.<span title="()Int">readableBytes</span><span class="delimiter">)</span>
        <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.nettyResponse" title="org.jboss.netty.handler.codec.http.HttpResponse">nettyResponse</a>.<span title="(x$1: org.jboss.netty.buffer.ChannelBuffer)Unit">setContent</span><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.buffer" title="org.jboss.netty.buffer.ChannelBuffer">buffer</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="scala.concurrent.Future[org.jboss.netty.channel.Channel]" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.promise">promise</a> = <a href="#play.core.server.netty.NettyResultStreamer.sendDownstream" title="(subSequence: Int, last: Boolean, message: Object)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit oue: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)org.jboss.netty.channel.ChannelFuture">sendDownstream</a><a href="NettyFuture.scala.html#play.core.server.netty.NettyFuture.ToScala" title="implicit play.core.server.netty.NettyFuture.ToScala : (channelFuture: org.jboss.netty.channel.ChannelFuture)play.core.server.netty.NettyFuture.ToScala" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.startSequence" title="Int">startSequence</a>, <span title="=&gt; Boolean">!</span><a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.closeConnection" title="Boolean">closeConnection</a>, <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.nettyResponse" title="org.jboss.netty.handler.codec.http.HttpResponse">nettyResponse</a><span class="delimiter">)</span>.<a href="NettyFuture.scala.html#play.core.server.netty.NettyFuture;ToScala.toScala" title="=&gt; scala.concurrent.Future[org.jboss.netty.channel.Channel]">toScala</a>
        <span class="keyword">val</span> <a title="play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.done">done</a> = <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Done.apply" title="[E, A](a: A, e: play.api.libs.iteratee.Input[E])play.api.libs.iteratee.Iteratee[E,A]">Done</a><a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Done.apply$default$2" title="(a: play.core.server.netty.NettyResultStreamer.ChannelStatus, e: play.api.libs.iteratee.Input[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]" class="delimiter">[</a><span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <a href="#play.core.server.netty.NettyResultStreamer;ChannelStatus" title="play.core.server.netty.NettyResultStreamer.ChannelStatus">ChannelStatus</a><span class="delimiter">]</span><span class="delimiter">(</span><span title="play.core.server.netty.NettyResultStreamer.ChannelStatus" class="keyword">new</span> <a href="#play.core.server.netty.NettyResultStreamer;ChannelStatus" title="play.core.server.netty.NettyResultStreamer.ChannelStatus">ChannelStatus</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.closeConnection" title="Boolean">closeConnection</a>, <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.startSequence" title="Int">startSequence</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Iteratee" title="play.api.libs.iteratee.Iteratee.type">Iteratee</a>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Iteratee.flatten" title="(i: scala.concurrent.Future[play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]])play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">flatten</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.promise" title="scala.concurrent.Future[org.jboss.netty.channel.Channel]">promise</a>.<span title="(f: org.jboss.netty.channel.Channel =&gt; play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]]">map</span><a href="../../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution.Implicits.trampoline" title="=&gt; scala.concurrent.ExecutionContext" class="delimiter">(</a><a title="org.jboss.netty.channel.Channel" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.$anonfun.x$2">_</a> =&gt; <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.done" title="play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">done</a><span class="delimiter">)</span>.<span title="(pf: PartialFunction[Throwable,play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]]">recover</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Throwable,play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]] with Serializable" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
          <span class="keyword">case</span> _ =&gt; <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.done" title="play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">done</a>
        <span class="delimiter">}</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> Left<span class="delimiter">(</span><span title="Array[Byte]">chunk</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="play.api.libs.iteratee.Enumerator[Array[Byte]]" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.bufferedAsEnumerator">bufferedAsEnumerator</a> = <a href="../../../../../play-iteratees/play/api/libs/iteratee/Enumerator.scala.html#play.api.libs.iteratee.Enumerator.apply" title="(in: Array[Byte]*)play.api.libs.iteratee.Enumerator[Array[Byte]]">Enumerator</a><span class="delimiter">(</span><span title="Array[Byte]">chunk</span><span class="delimiter">)</span>

        <span class="comment">// Get the iteratee, maybe chunked or maybe not according HTTP version</span>
        <span class="keyword">val</span> <a title="play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]" id="play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.bodyIteratee">bodyIteratee</a> = <span title="play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.httpVersion" title="org.jboss.netty.handler.codec.http.HttpVersion">httpVersion</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="org.jboss.netty.handler.codec.http.HttpVersion.type">HttpVersion</span>.<span title="org.jboss.netty.handler.codec.http.HttpVersion">HTTP_1_0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee" title="(nettyResponse: org.jboss.netty.handler.codec.http.HttpResponse, startSequence: Int, closeConnection: Boolean)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit e: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">nettyStreamIteratee</a><a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.ctx" title="org.jboss.netty.channel.ChannelHandlerContext" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.nettyResponse" title="org.jboss.netty.handler.codec.http.HttpResponse">nettyResponse</a>, <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.startSequence" title="Int">startSequence</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="comment">// Chunk it</span>
          <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.nettyResponse" title="org.jboss.netty.handler.codec.http.HttpResponse">nettyResponse</a>.<span title="()org.jboss.netty.handler.codec.http.HttpHeaders">headers</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: String, x$2: Any)org.jboss.netty.handler.codec.http.HttpHeaders">set</span><span class="delimiter">(</span><span title="String(&quot;Transfer-Encoding&quot;)">TRANSFER_ENCODING</span>, <span title="String(&quot;chunked&quot;)">CHUNKED</span><span class="delimiter">)</span>
          <a href="../../../api/mvc/Results.scala.html#play.api.mvc.Results" title="play.api.mvc.Results.type">Results</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Results.chunk(033c07489a)" title="=&gt; play.api.libs.iteratee.Enumeratee[Array[Byte],Array[Byte]]">chunk</a> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Enumeratee.scala.html#play.api.libs.iteratee;Enumeratee.&>>" title="(inner: play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus])play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">&amp;&gt;&gt;</a> <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee" title="(nettyResponse: org.jboss.netty.handler.codec.http.HttpResponse, startSequence: Int, closeConnection: Boolean)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit e: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">nettyStreamIteratee</a><a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.ctx" title="org.jboss.netty.channel.ChannelHandlerContext" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.nettyResponse" title="org.jboss.netty.handler.codec.http.HttpResponse">nettyResponse</a>, <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.startSequence" title="Int">startSequence</a>, <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.closeConnection" title="Boolean">closeConnection</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="comment">// Feed the buffered content into the iteratee, and return the iteratee so that future content can continue</span>
        <span class="comment">// to be fed directly in as normal</span>
        <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Iteratee" title="play.api.libs.iteratee.Iteratee.type">Iteratee</a>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Iteratee.flatten" title="(i: scala.concurrent.Future[play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]])play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">flatten</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.bufferedAsEnumerator" title="play.api.libs.iteratee.Enumerator[Array[Byte]]">bufferedAsEnumerator</a> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Enumerator.scala.html#play.api.libs.iteratee;Enumerator.|>>" title="(i: play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus])scala.concurrent.Future[play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]]">|&gt;&gt;</a> <a href="#play.core.server.netty.NettyResultStreamer.bufferingIteratee.$anonfun.bodyIteratee" title="play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">bodyIteratee</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  <span class="comment">// Construct an iteratee for the purposes of streaming responses to a downstream handler.</span>
  <span class="keyword">def</span> <a title="(nettyResponse: org.jboss.netty.handler.codec.http.HttpResponse, startSequence: Int, closeConnection: Boolean)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit e: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]" id="play.core.server.netty.NettyResultStreamer.nettyStreamIteratee">nettyStreamIteratee</a><span class="delimiter">(</span><a title="org.jboss.netty.handler.codec.http.HttpResponse" id="play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.nettyResponse">nettyResponse</a>: <span title="org.jboss.netty.handler.codec.http.HttpResponse">HttpResponse</span>, <a title="Int" id="play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.startSequence">startSequence</a>: <span title="Int">Int</span>, <a title="Boolean" id="play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.closeConnection">closeConnection</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.jboss.netty.channel.ChannelHandlerContext" id="play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.ctx">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent" id="play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.e">e</a>: <span title="com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent">OrderedUpstreamMessageEvent</span><span class="delimiter">)</span>: <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee" title="play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">Iteratee</a><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>, ChannelStatus<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <span class="keyword">def</span> <a title="(subsequence: Int)(in: play.api.libs.iteratee.Input[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]" id="play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step">step</a><span class="delimiter">(</span><a title="Int" id="play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.subsequence">subsequence</a>: <span title="Int">Int</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="play.api.libs.iteratee.Input[Array[Byte]]" id="play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.in">in</a>: <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Input" title="play.api.libs.iteratee.Input[Array[Byte]]">Input</a><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee" title="play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">Iteratee</a><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>, ChannelStatus<span class="delimiter">]</span> = <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.in" title="play.api.libs.iteratee.Input[Array[Byte]]">in</a> <span title="play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Input.El<span class="delimiter">(</span><a title="Array[Byte]" id="play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.x">x</a><span class="delimiter">)</span> =&gt;
        <span class="keyword">val</span> <a title="org.jboss.netty.buffer.ChannelBuffer" id="play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.b">b</a> = <span title="org.jboss.netty.buffer.ChannelBuffers.type">ChannelBuffers</span>.<span title="(x$1: Array[Byte])org.jboss.netty.buffer.ChannelBuffer">wrappedBuffer</span><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.x" title="Array[Byte]">x</a><span class="delimiter">)</span>
        <a href="#play.core.server.netty.NettyResultStreamer.nextWhenComplete" title="(future: org.jboss.netty.channel.ChannelFuture, step: play.api.libs.iteratee.Input[Array[Byte]] =&gt; play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus], done: play.core.server.netty.NettyResultStreamer.ChannelStatus)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext)play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">nextWhenComplete</a><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.ctx" title="org.jboss.netty.channel.ChannelHandlerContext" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.sendDownstream" title="(subSequence: Int, last: Boolean, message: Object)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit oue: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)org.jboss.netty.channel.ChannelFuture">sendDownstream</a><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.ctx" title="org.jboss.netty.channel.ChannelHandlerContext" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.subsequence" title="Int">subsequence</a>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.b" title="org.jboss.netty.buffer.ChannelBuffer">b</a><span class="delimiter">)</span>, <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step" title="(subsequence: Int)(in: play.api.libs.iteratee.Input[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">step</a><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.$anonfun.in" title="play.api.libs.iteratee.Input[Array[Byte]]" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.subsequence" title="Int">subsequence</a> <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.eta$0$1" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="play.core.server.netty.NettyResultStreamer.ChannelStatus" class="keyword">new</span> <a href="#play.core.server.netty.NettyResultStreamer;ChannelStatus" title="play.core.server.netty.NettyResultStreamer.ChannelStatus">ChannelStatus</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.closeConnection" title="Boolean">closeConnection</a>, <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.subsequence" title="Int">subsequence</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Input" title="play.api.libs.iteratee.Input.type">Input</a>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Input.Empty" title="play.api.libs.iteratee.Input.Empty.type">Empty</a> =&gt;
        <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Cont.apply" title="(k: play.api.libs.iteratee.Input[Array[Byte]] =&gt; play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus])play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">Cont</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step" title="(subsequence: Int)(in: play.api.libs.iteratee.Input[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">step</a><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.$anonfun.in" title="play.api.libs.iteratee.Input[Array[Byte]]" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.subsequence" title="Int">subsequence</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Input" title="play.api.libs.iteratee.Input.type">Input</a>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Input.EOF" title="play.api.libs.iteratee.Input.EOF.type">EOF</a> =&gt;
        <a href="#play.core.server.netty.NettyResultStreamer.sendDownstream" title="(subSequence: Int, last: Boolean, message: Object)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit oue: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)org.jboss.netty.channel.ChannelFuture">sendDownstream</a><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.ctx" title="org.jboss.netty.channel.ChannelHandlerContext" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.subsequence" title="Int">subsequence</a>, <span title="=&gt; Boolean">!</span><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.closeConnection" title="Boolean">closeConnection</a>, <span title="org.jboss.netty.buffer.ChannelBuffers.type">ChannelBuffers</span>.<span title="org.jboss.netty.buffer.ChannelBuffer">EMPTY_BUFFER</span><span class="delimiter">)</span>
        <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Done.apply" title="(a: play.core.server.netty.NettyResultStreamer.ChannelStatus, e: play.api.libs.iteratee.Input[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">Done</a><span class="delimiter">(</span><span title="play.core.server.netty.NettyResultStreamer.ChannelStatus" class="keyword">new</span> <a href="#play.core.server.netty.NettyResultStreamer;ChannelStatus" title="play.core.server.netty.NettyResultStreamer.ChannelStatus">ChannelStatus</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.closeConnection" title="Boolean">closeConnection</a>, <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step.subsequence" title="Int">subsequence</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#play.core.server.netty.NettyResultStreamer.nextWhenComplete" title="(future: org.jboss.netty.channel.ChannelFuture, step: play.api.libs.iteratee.Input[Array[Byte]] =&gt; play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus], done: play.core.server.netty.NettyResultStreamer.ChannelStatus)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext)play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">nextWhenComplete</a><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.ctx" title="org.jboss.netty.channel.ChannelHandlerContext" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.sendDownstream" title="(subSequence: Int, last: Boolean, message: Object)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit oue: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)org.jboss.netty.channel.ChannelFuture">sendDownstream</a><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.ctx" title="org.jboss.netty.channel.ChannelHandlerContext" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.startSequence" title="Int">startSequence</a>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.nettyResponse" title="org.jboss.netty.handler.codec.http.HttpResponse">nettyResponse</a><span class="delimiter">)</span>, <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.step" title="(subsequence: Int)(in: play.api.libs.iteratee.Input[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],play.core.server.netty.NettyResultStreamer.ChannelStatus]">step</a><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.$anonfun.in" title="play.api.libs.iteratee.Input[Array[Byte]]" class="delimiter">(</a><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.startSequence" title="Int">startSequence</a> <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.eta$0$2" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="play.core.server.netty.NettyResultStreamer.ChannelStatus" class="keyword">new</span> <a href="#play.core.server.netty.NettyResultStreamer;ChannelStatus" title="play.core.server.netty.NettyResultStreamer.ChannelStatus">ChannelStatus</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.closeConnection" title="Boolean">closeConnection</a>, <a href="#play.core.server.netty.NettyResultStreamer.nettyStreamIteratee.startSequence" title="Int">startSequence</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(header: play.api.mvc.ResponseHeader, closeConnection: Boolean, httpVersion: org.jboss.netty.handler.codec.http.HttpVersion)org.jboss.netty.handler.codec.http.DefaultHttpResponse" id="play.core.server.netty.NettyResultStreamer.createNettyResponse">createNettyResponse</a><span class="delimiter">(</span><a title="play.api.mvc.ResponseHeader" id="play.core.server.netty.NettyResultStreamer.createNettyResponse.header">header</a>: <a href="../../../api/mvc/Results.scala.html#play.api.mvc;ResponseHeader" title="play.api.mvc.ResponseHeader">ResponseHeader</a>, <a title="Boolean" id="play.core.server.netty.NettyResultStreamer.createNettyResponse.closeConnection">closeConnection</a>: <span title="Boolean">Boolean</span>, <a title="org.jboss.netty.handler.codec.http.HttpVersion" id="play.core.server.netty.NettyResultStreamer.createNettyResponse.httpVersion">httpVersion</a>: <span title="org.jboss.netty.handler.codec.http.HttpVersion">HttpVersion</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.jboss.netty.handler.codec.http.DefaultHttpResponse" id="play.core.server.netty.NettyResultStreamer.createNettyResponse.nettyResponse">nettyResponse</a> = <span title="org.jboss.netty.handler.codec.http.DefaultHttpResponse" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.http.DefaultHttpResponse">DefaultHttpResponse</span><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.httpVersion" title="org.jboss.netty.handler.codec.http.HttpVersion">httpVersion</a>, <span title="org.jboss.netty.handler.codec.http.HttpResponseStatus.type">HttpResponseStatus</span>.<span title="(x$1: Int)org.jboss.netty.handler.codec.http.HttpResponseStatus">valueOf</span><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.header" title="play.api.mvc.ResponseHeader">header</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;ResponseHeader.status" title="=&gt; Int">status</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">import</span> scala.collection.<span title="scala.collection.JavaConverters.type">JavaConverters</span>._

    <span class="comment">// Set response headers</span>
    <a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.header" title="play.api.mvc.ResponseHeader">header</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;ResponseHeader.headers" title="=&gt; Map[String,String]">headers</a>.<span title="(f: ((String, String)) =&gt; org.jboss.netty.handler.codec.http.HttpHeaders)Unit">foreach</span> <a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.$anonfun.x0$1" title="org.jboss.netty.handler.codec.http.HttpHeaders" class="delimiter">{</a>

      <span class="comment">// Fix a bug for Set-Cookie header.</span>
      <span class="comment">// Multiple cookies could be merged in a single header</span>
      <span class="comment">// but it's not properly supported by some browsers</span>
      <span class="keyword">case</span> <span class="delimiter">(</span><span title="String">name</span> @ play.api.http.<a href="../../../api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../api/http/StandardValues.scala.html#play.api.http;HeaderNames.SET_COOKIE" title="=&gt; String">SET_COOKIE</a>, <span title="String">value</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="java.util.List[String]" id="play.core.server.netty.NettyResultStreamer.createNettyResponse.$anonfun.cookieValues">cookieValues</a> = <a href="../../../api/mvc/Http.scala.html#play.api.mvc.Cookies" title="play.api.mvc.Cookies.type">Cookies</a>.<a href="../../../api/mvc/Http.scala.html#play.api.mvc.Cookies.decode" title="(cookieHeader: String)Seq[play.api.mvc.Cookie]">decode</a><span class="delimiter">(</span><span title="String">value</span><span class="delimiter">)</span>.<span title="(f: play.api.mvc.Cookie =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.mvc.Cookie],String,Seq[String]])Seq[String]">map</span> <span title="(b: Seq[String])scala.collection.convert.Decorators.AsJava[java.util.List[String]]" class="delimiter">{</span>
          c: play.api.mvc.<a href="../../../api/mvc/Http.scala.html#play.api.mvc;Cookie" title="play.api.mvc.Cookie">Cookie</a> =&gt; <a href="../../../api/mvc/Http.scala.html#play.api.mvc.Cookies" title="play.api.mvc.Cookies.type">Cookies</a>.<a href="../../../api/mvc/Http.scala.html#play.api.mvc.Cookies.encode" title="(cookies: Seq[play.api.mvc.Cookie])String">encode</a><span class="delimiter">(</span><span title="(elems: play.api.mvc.Cookie*)Seq[play.api.mvc.Cookie]">Seq</span><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.$anonfun.cookieValues.$anonfun.c" title="play.api.mvc.Cookie">c</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>.<span title="=&gt; java.util.List[String]">asJava</span>
        <a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.nettyResponse" title="org.jboss.netty.handler.codec.http.DefaultHttpResponse">nettyResponse</a>.<span title="()org.jboss.netty.handler.codec.http.HttpHeaders">headers</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: String, x$2: Iterable[_])org.jboss.netty.handler.codec.http.HttpHeaders">set</span><span class="delimiter">(</span><span title="String">name</span>, <a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.$anonfun.cookieValues" title="java.util.List[String]">cookieValues</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">case</span> <span class="delimiter">(</span><span title="String">name</span>, <span title="String">value</span><span class="delimiter">)</span> =&gt; <a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.nettyResponse" title="org.jboss.netty.handler.codec.http.DefaultHttpResponse">nettyResponse</a>.<span title="()org.jboss.netty.handler.codec.http.HttpHeaders">headers</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: String, x$2: Any)org.jboss.netty.handler.codec.http.HttpHeaders">set</span><span class="delimiter">(</span><span title="String">name</span>, <span title="String">value</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">// Response header Connection: Keep-Alive is needed for HTTP 1.0</span>
    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.closeConnection" title="Boolean">closeConnection</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.httpVersion" title="org.jboss.netty.handler.codec.http.HttpVersion">httpVersion</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="org.jboss.netty.handler.codec.http.HttpVersion.type">HttpVersion</span>.<span title="org.jboss.netty.handler.codec.http.HttpVersion">HTTP_1_0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.nettyResponse" title="org.jboss.netty.handler.codec.http.DefaultHttpResponse">nettyResponse</a>.<span title="()org.jboss.netty.handler.codec.http.HttpHeaders">headers</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: String, x$2: Any)org.jboss.netty.handler.codec.http.HttpHeaders">set</span><span class="delimiter">(</span><span title="String(&quot;Connection&quot;)">CONNECTION</span>, <span title="String(&quot;keep-alive&quot;)">KEEP_ALIVE</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.closeConnection" title="Boolean">closeConnection</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.httpVersion" title="org.jboss.netty.handler.codec.http.HttpVersion">httpVersion</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="org.jboss.netty.handler.codec.http.HttpVersion.type">HttpVersion</span>.<span title="org.jboss.netty.handler.codec.http.HttpVersion">HTTP_1_1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.nettyResponse" title="org.jboss.netty.handler.codec.http.DefaultHttpResponse">nettyResponse</a>.<span title="()org.jboss.netty.handler.codec.http.HttpHeaders">headers</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: String, x$2: Any)org.jboss.netty.handler.codec.http.HttpHeaders">set</span><span class="delimiter">(</span><span title="String(&quot;Connection&quot;)">CONNECTION</span>, <span title="String(&quot;close&quot;)">CLOSE</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#play.core.server.netty.NettyResultStreamer.createNettyResponse.nettyResponse" title="org.jboss.netty.handler.codec.http.DefaultHttpResponse">nettyResponse</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(subSequence: Int, last: Boolean, message: Object)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext, implicit oue: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent)org.jboss.netty.channel.ChannelFuture" id="play.core.server.netty.NettyResultStreamer.sendDownstream">sendDownstream</a><span class="delimiter">(</span><a title="Int" id="play.core.server.netty.NettyResultStreamer.sendDownstream.subSequence">subSequence</a>: <span title="Int">Int</span>, <a title="Boolean" id="play.core.server.netty.NettyResultStreamer.sendDownstream.last">last</a>: <span title="Boolean">Boolean</span>, <a title="Object" id="play.core.server.netty.NettyResultStreamer.sendDownstream.message">message</a>: <span title="Object">Object</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.jboss.netty.channel.ChannelHandlerContext" id="play.core.server.netty.NettyResultStreamer.sendDownstream.ctx">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent" id="play.core.server.netty.NettyResultStreamer.sendDownstream.oue">oue</a>: <span title="com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent">OrderedUpstreamMessageEvent</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="com.typesafe.netty.http.pipelining.OrderedDownstreamChannelEvent" id="play.core.server.netty.NettyResultStreamer.sendDownstream.ode">ode</a> = <span title="(x$1: com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent, x$2: Int, x$3: Boolean, x$4: Any)com.typesafe.netty.http.pipelining.OrderedDownstreamChannelEvent" class="keyword">new</span> <span title="com.typesafe.netty.http.pipelining.OrderedDownstreamChannelEvent">OrderedDownstreamChannelEvent</span><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.sendDownstream.oue" title="com.typesafe.netty.http.pipelining.OrderedUpstreamMessageEvent">oue</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendDownstream.subSequence" title="Int">subSequence</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendDownstream.last" title="Boolean">last</a>, <a href="#play.core.server.netty.NettyResultStreamer.sendDownstream.message" title="Object">message</a><span class="delimiter">)</span>
    <a href="#play.core.server.netty.NettyResultStreamer.sendDownstream.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="(x$1: org.jboss.netty.channel.ChannelEvent)Unit">sendDownstream</span><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.sendDownstream.ode" title="com.typesafe.netty.http.pipelining.OrderedDownstreamChannelEvent">ode</a><span class="delimiter">)</span>
    <a href="#play.core.server.netty.NettyResultStreamer.sendDownstream.ode" title="com.typesafe.netty.http.pipelining.OrderedDownstreamChannelEvent">ode</a>.<span title="()org.jboss.netty.channel.ChannelFuture">getFuture</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[E, A](future: org.jboss.netty.channel.ChannelFuture, step: play.api.libs.iteratee.Input[E] =&gt; play.api.libs.iteratee.Iteratee[E,A], done: A)(implicit ctx: org.jboss.netty.channel.ChannelHandlerContext)play.api.libs.iteratee.Iteratee[E,A]" id="play.core.server.netty.NettyResultStreamer.nextWhenComplete">nextWhenComplete</a><span class="delimiter">[</span><a title="" id="play.core.server.netty.NettyResultStreamer.nextWhenComplete;E">E</a>, <a title="" id="play.core.server.netty.NettyResultStreamer.nextWhenComplete;A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelFuture" id="play.core.server.netty.NettyResultStreamer.nextWhenComplete.future">future</a>: <span title="org.jboss.netty.channel.ChannelFuture">ChannelFuture</span>, <a title="play.api.libs.iteratee.Input[E] =&gt; play.api.libs.iteratee.Iteratee[E,A]" id="play.core.server.netty.NettyResultStreamer.nextWhenComplete.step">step</a>: <span class="delimiter">(</span>Input<span class="delimiter">[</span>E<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; Iteratee<span class="delimiter">[</span>E, A<span class="delimiter">]</span>, <a title="A" id="play.core.server.netty.NettyResultStreamer.nextWhenComplete.done">done</a>: <a href="#play.core.server.netty.NettyResultStreamer.nextWhenComplete;A" title="A">A</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.jboss.netty.channel.ChannelHandlerContext" id="play.core.server.netty.NettyResultStreamer.nextWhenComplete.ctx">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span><span class="delimiter">)</span>: <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee" title="play.api.libs.iteratee.Iteratee[E,A]">Iteratee</a><span class="delimiter">[</span>E, A<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="comment">// If the channel isn't currently connected, then this future will never be redeemed.  This is racey, and impossible</span>
    <span class="comment">// to 100% detect, but it's better to fail fast if possible than to sit there waiting forever</span>
    <span class="keyword">import</span> play.api.libs.iteratee.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution" title="play.api.libs.iteratee.Execution.type">Execution</a>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution.Implicits" title="play.api.libs.iteratee.Execution.Implicits.type">Implicits</a>.trampoline
    <span title="play.api.libs.iteratee.Iteratee[E,A]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#play.core.server.netty.NettyResultStreamer.nextWhenComplete.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="()Boolean">isConnected</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Done.apply" title="(a: A, e: play.api.libs.iteratee.Input[E])play.api.libs.iteratee.Iteratee[E,A]">Done</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.nextWhenComplete.done" title="A">done</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Iteratee" title="play.api.libs.iteratee.Iteratee.type">Iteratee</a>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Iteratee.flatten" title="(i: scala.concurrent.Future[play.api.libs.iteratee.Iteratee[E,A]])play.api.libs.iteratee.Iteratee[E,A]">flatten</a><span class="delimiter">(</span>
        <a href="NettyFuture.scala.html#play.core.server.netty.NettyFuture.ToScala" title="implicit play.core.server.netty.NettyFuture.ToScala : (channelFuture: org.jboss.netty.channel.ChannelFuture)play.core.server.netty.NettyFuture.ToScala">future</a>.<a href="NettyFuture.scala.html#play.core.server.netty.NettyFuture;ToScala.toScala" title="=&gt; scala.concurrent.Future[org.jboss.netty.channel.Channel]">toScala</a>.<span title="[S](f: org.jboss.netty.channel.Channel =&gt; S)(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[S]">map</span><span title="(f: org.jboss.netty.channel.Channel =&gt; play.api.libs.iteratee.Iteratee[E,A])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[play.api.libs.iteratee.Iteratee[E,A]]" class="delimiter">[</span><a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee" title="play.api.libs.iteratee.Iteratee[E,A]">Iteratee</a><span class="delimiter">[</span>E, A<span class="delimiter">]</span><span class="delimiter">]</span> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution.Implicits.trampoline" title="=&gt; scala.concurrent.ExecutionContext" class="delimiter">{</a>
          <a title="org.jboss.netty.channel.Channel" id="play.core.server.netty.NettyResultStreamer.nextWhenComplete.$anonfun.x$3">_</a> =&gt; <span title="play.api.libs.iteratee.Iteratee[E,A]" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.nextWhenComplete.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="()Boolean">isConnected</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Cont.apply" title="(k: play.api.libs.iteratee.Input[E] =&gt; play.api.libs.iteratee.Iteratee[E,A])play.api.libs.iteratee.Iteratee[E,A]">Cont</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.nextWhenComplete.step" title="play.api.libs.iteratee.Input[E] =&gt; play.api.libs.iteratee.Iteratee[E,A]">step</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Done.apply" title="(a: A, e: play.api.libs.iteratee.Input[E])play.api.libs.iteratee.Iteratee[E,A]">Done</a><span class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.nextWhenComplete.done" title="A">done</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>.<span title="[U &gt;: play.api.libs.iteratee.Iteratee[E,A]](pf: PartialFunction[Throwable,U])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[U]">recover</span><span title="(pf: PartialFunction[Throwable,play.api.libs.iteratee.Iteratee[E,A]])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[play.api.libs.iteratee.Iteratee[E,A]]" class="delimiter">[</span><a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee" title="play.api.libs.iteratee.Iteratee[E,A]">Iteratee</a><span class="delimiter">[</span>E, A<span class="delimiter">]</span><span class="delimiter">]</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Throwable,play.api.libs.iteratee.Iteratee[E,A]] with Serializable" id="play.core.server.netty.NettyResultStreamer.nextWhenComplete;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
          <span class="keyword">case</span> _ =&gt; <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Done.apply" title="(a: A, e: play.api.libs.iteratee.Input[E])play.api.libs.iteratee.Iteratee[E,A]">Done</a><span title="Boolean(true)" class="delimiter">(</span><a href="#play.core.server.netty.NettyResultStreamer.nextWhenComplete.done" title="A">done</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Extractor object that determines whether the end of the body is specified by the protocol
   */</span>
  <span class="keyword">object</span> <a title="play.core.server.netty.NettyResultStreamer.EndOfBodyInProtocol.type" id="play.core.server.netty.NettyResultStreamer.EndOfBodyInProtocol">EndOfBodyInProtocol</a> <a href="#play.core.server.netty.NettyResultStreamer.EndOfBodyInProtocol" title="play.core.server.netty.NettyResultStreamer.EndOfBodyInProtocol.type" class="delimiter">{</a>
    <span class="keyword">def</span> <a title="(result: play.api.mvc.Result)Boolean" id="play.core.server.netty.NettyResultStreamer.EndOfBodyInProtocol.unapply">unapply</a><span class="delimiter">(</span><a title="play.api.mvc.Result" id="play.core.server.netty.NettyResultStreamer.EndOfBodyInProtocol.unapply.result">result</a>: <a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result" title="play.api.mvc.Result">Result</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <span class="keyword">import</span> <a href="#play.core.server.netty.NettyResultStreamer.EndOfBodyInProtocol.unapply.result" title="play.api.mvc.Result">result</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.header" title="=&gt; play.api.mvc.ResponseHeader">header</a>.headers
      <a href="../../../api/mvc/Results.scala.html#play.api.mvc;ResponseHeader.headers" title="=&gt; Map[String,String]">headers</a>.<span title="(key: String)Boolean">contains</span><span class="delimiter">(</span><span title="String(&quot;Transfer-Encoding&quot;)">TRANSFER_ENCODING</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="../../../api/mvc/Results.scala.html#play.api.mvc;ResponseHeader.headers" title="=&gt; Map[String,String]">headers</a>.<span title="(key: String)Boolean">contains</span><span class="delimiter">(</span><span title="String(&quot;Content-Length&quot;)">CONTENT_LENGTH</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Extractor object that determines whether the result specifies that the connection should be closed
   */</span>
  <span class="keyword">object</span> <a title="play.core.server.netty.NettyResultStreamer.CloseConnection.type" id="play.core.server.netty.NettyResultStreamer.CloseConnection">CloseConnection</a> <a href="#play.core.server.netty.NettyResultStreamer.CloseConnection" title="play.core.server.netty.NettyResultStreamer.CloseConnection.type" class="delimiter">{</a>
    <span class="keyword">def</span> <a title="(result: play.api.mvc.Result)Boolean" id="play.core.server.netty.NettyResultStreamer.CloseConnection.unapply">unapply</a><span class="delimiter">(</span><a title="play.api.mvc.Result" id="play.core.server.netty.NettyResultStreamer.CloseConnection.unapply.result">result</a>: <a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result" title="play.api.mvc.Result">Result</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#play.core.server.netty.NettyResultStreamer.CloseConnection.unapply.result" title="play.api.mvc.Result">result</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.connection" title="=&gt; play.api.mvc.HttpConnection.Connection">connection</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../api/mvc/Results.scala.html#play.api.mvc.HttpConnection" title="play.api.mvc.HttpConnection.type">HttpConnection</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc.HttpConnection.Close" title="=&gt; play.api.mvc.HttpConnection.Value">Close</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Extractor object that determines whether the result uses a transfer encoding
   */</span>
  <span class="keyword">object</span> <a title="play.core.server.netty.NettyResultStreamer.UsesTransferEncoding.type" id="play.core.server.netty.NettyResultStreamer.UsesTransferEncoding">UsesTransferEncoding</a> <a href="#play.core.server.netty.NettyResultStreamer.UsesTransferEncoding" title="play.core.server.netty.NettyResultStreamer.UsesTransferEncoding.type" class="delimiter">{</a>
    <span class="keyword">def</span> <a title="(result: play.api.mvc.Result)Boolean" id="play.core.server.netty.NettyResultStreamer.UsesTransferEncoding.unapply">unapply</a><span class="delimiter">(</span><a title="play.api.mvc.Result" id="play.core.server.netty.NettyResultStreamer.UsesTransferEncoding.unapply.result">result</a>: <a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result" title="play.api.mvc.Result">Result</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#play.core.server.netty.NettyResultStreamer.UsesTransferEncoding.unapply.result" title="play.api.mvc.Result">result</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;Result.header" title="=&gt; play.api.mvc.ResponseHeader">header</a>.<a href="../../../api/mvc/Results.scala.html#play.api.mvc;ResponseHeader.headers" title="=&gt; Map[String,String]">headers</a>.<span title="(key: String)Boolean">contains</span><span class="delimiter">(</span><span title="String(&quot;Transfer-Encoding&quot;)">TRANSFER_ENCODING</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span title="AnyRef" class="delimiter">}</span>

        </pre>
    </body>
</html>
