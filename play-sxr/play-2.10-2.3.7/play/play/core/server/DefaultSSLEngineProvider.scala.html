<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>play/play/core/server/DefaultSSLEngineProvider.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> play.core.server

<span class="keyword">import</span> play.server.api.SSLEngineProvider
<span class="keyword">import</span> play.core.ApplicationProvider
<span class="keyword">import</span> javax.net.ssl.<span class="delimiter">{</span> TrustManager, KeyManagerFactory, SSLEngine, SSLContext <span class="delimiter">}</span>
<span class="keyword">import</span> java.security.KeyStore
<span class="keyword">import</span> java.io.<span class="delimiter">{</span> FileInputStream, File <span class="delimiter">}</span>
<span class="keyword">import</span> play.api.Play
<span class="keyword">import</span> play.core.server.netty.FakeKeyStore
<span class="keyword">import</span> scala.util.control.NonFatal
<span class="keyword">import</span> scala.util.<span class="delimiter">{</span> Try, Failure, Success <span class="delimiter">}</span>
<span class="keyword">import</span> play.utils.PlayIO

<span class="comment">/**
 * This class calls sslContext.createSSLEngine() with no parameters and returns the result.
 */</span>
<span class="keyword">class</span> <a title="class DefaultSSLEngineProvider extends Object with play.server.api.SSLEngineProvider" id="play.core.server;DefaultSSLEngineProvider">DefaultSSLEngineProvider</a><a href="#play.core.server;DefaultSSLEngineProvider" title="play.core.server.DefaultSSLEngineProvider" class="delimiter">(</a><a title="play.core.ApplicationProvider" id="play.core.server;DefaultSSLEngineProvider.appProvider">appProvider</a>: <a href="../system/ApplicationProvider.scala.html#play.core;ApplicationProvider" title="play.core.ApplicationProvider">ApplicationProvider</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../server/api/SSLEngineProvider.scala.html#play.server.api;SSLEngineProvider" title="play.server.api.SSLEngineProvider">SSLEngineProvider</a> <span class="delimiter">{</span>

  <span class="keyword">val</span> <a title="javax.net.ssl.SSLContext" id="play.core.server;DefaultSSLEngineProvider.sslContext">sslContext</a>: <span title="javax.net.ssl.SSLContext">SSLContext</span> = <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext" title="(applicationProvider: play.core.ApplicationProvider)javax.net.ssl.SSLContext">createSSLContext</a><span class="delimiter">(</span><a href="#play.core.server;DefaultSSLEngineProvider.appProvider" title="play.core.ApplicationProvider">appProvider</a><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()javax.net.ssl.SSLEngine" id="play.core.server;DefaultSSLEngineProvider.createSSLEngine">createSSLEngine</a>: <span title="javax.net.ssl.SSLEngine">SSLEngine</span> = <span class="delimiter">{</span>
    <a href="#play.core.server;DefaultSSLEngineProvider.sslContext" title="=&gt; javax.net.ssl.SSLContext">sslContext</a>.<span title="()javax.net.ssl.SSLEngine">createSSLEngine</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(applicationProvider: play.core.ApplicationProvider)javax.net.ssl.SSLContext" id="play.core.server;DefaultSSLEngineProvider.createSSLContext">createSSLContext</a><span class="delimiter">(</span><a title="play.core.ApplicationProvider" id="play.core.server;DefaultSSLEngineProvider.createSSLContext.applicationProvider">applicationProvider</a>: <a href="../system/ApplicationProvider.scala.html#play.core;ApplicationProvider" title="play.core.ApplicationProvider">ApplicationProvider</a><span class="delimiter">)</span>: <span title="javax.net.ssl.SSLContext">SSLContext</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.util.Try[javax.net.ssl.KeyManagerFactory]" id="play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory">keyManagerFactory</a>: <span title="scala.util.Try[javax.net.ssl.KeyManagerFactory]">Try</span><span class="delimiter">[</span>KeyManagerFactory<span class="delimiter">]</span> = <span title="(x: String)Option[String]">Option</span><span class="delimiter">(</span><span title="System.type">System</span>.<span title="(x$1: String)String">getProperty</span><span class="delimiter">(</span><span title="String(&quot;https.keyStore&quot;)" class="string">&quot;https.keyStore&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="scala.util.Try[javax.net.ssl.KeyManagerFactory]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="String" id="play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.path">path</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="comment">// Load the configured key store</span>
        <span class="keyword">val</span> <a title="java.security.KeyStore" id="play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.keyStore">keyStore</a> = <span title="java.security.KeyStore.type">KeyStore</span>.<span title="(x$1: String)java.security.KeyStore">getInstance</span><span class="delimiter">(</span><span title="System.type">System</span>.<span title="(x$1: String, x$2: String)String">getProperty</span><span class="delimiter">(</span><span title="String(&quot;https.keyStoreType&quot;)" class="string">&quot;https.keyStoreType&quot;</span>, <span title="String(&quot;JKS&quot;)" class="string">&quot;JKS&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Array[Char]" id="play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.password">password</a> = <span title="System.type">System</span>.<span title="(x$1: String, x$2: String)String">getProperty</span><span class="delimiter">(</span><span title="String(&quot;https.keyStorePassword&quot;)" class="string">&quot;https.keyStorePassword&quot;</span>, <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>.<span title="()Array[Char]">toCharArray</span>
        <span class="keyword">val</span> <a title="String" id="play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.algorithm">algorithm</a> = <span title="System.type">System</span>.<span title="(x$1: String, x$2: String)String">getProperty</span><span class="delimiter">(</span><span title="String(&quot;https.keyStoreAlgorithm&quot;)" class="string">&quot;https.keyStoreAlgorithm&quot;</span>, <span title="javax.net.ssl.KeyManagerFactory.type">KeyManagerFactory</span>.<span title="()String">getDefaultAlgorithm</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="java.io.File" id="play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.file">file</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.path" title="String">path</a><span class="delimiter">)</span>
        <span title="scala.util.Try[javax.net.ssl.KeyManagerFactory]" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.file" title="java.io.File">file</a>.<span title="()Boolean">isFile</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="java.io.FileInputStream" id="play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.in">in</a> = <span title="(x$1: java.io.File)java.io.FileInputStream" class="keyword">new</span> <span title="java.io.FileInputStream">FileInputStream</span><span class="delimiter">(</span><a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.file" title="java.io.File">file</a><span class="delimiter">)</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.keyStore" title="java.security.KeyStore">keyStore</a>.<span title="(x$1: java.io.InputStream, x$2: Array[Char])Unit">load</span><span class="delimiter">(</span><a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.in" title="java.io.FileInputStream">in</a>, <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.password" title="Array[Char]">password</a><span class="delimiter">)</span>
            <a href="../../api/Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../../api/Play.scala.html#play.api.Play.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../api/Logger.scala.html#play.api;LoggerLike.debug(83d3728a3c)" title="(message: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Using HTTPS keystore at &quot;)" class="string">&quot;Using HTTPS keystore at &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.file" title="java.io.File">file</a>.<span title="()String">getAbsolutePath</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="javax.net.ssl.KeyManagerFactory" id="play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.kmf">kmf</a> = <span title="javax.net.ssl.KeyManagerFactory.type">KeyManagerFactory</span>.<span title="(x$1: String)javax.net.ssl.KeyManagerFactory">getInstance</span><span class="delimiter">(</span><a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.algorithm" title="String">algorithm</a><span class="delimiter">)</span>
            <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.kmf" title="javax.net.ssl.KeyManagerFactory">kmf</a>.<span title="(x$1: java.security.KeyStore, x$2: Array[Char])Unit">init</span><span class="delimiter">(</span><a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.keyStore" title="java.security.KeyStore">keyStore</a>, <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.password" title="Array[Char]">password</a><span class="delimiter">)</span>
            <span title="(value: javax.net.ssl.KeyManagerFactory)scala.util.Success[javax.net.ssl.KeyManagerFactory]">Success</span><span class="delimiter">(</span><a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.kmf" title="javax.net.ssl.KeyManagerFactory">kmf</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.e">e</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
              <span title="(exception: Throwable)scala.util.Failure[Nothing]">Failure</span><span class="delimiter">(</span><span title="(x$1: String, x$2: Throwable)Exception" class="keyword">new</span> <span title="Exception">Exception</span><span class="delimiter">(</span><span title="String(&quot;Error loading HTTPS keystore from &quot;)" class="string">&quot;Error loading HTTPS keystore from &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.file" title="java.io.File">file</a>.<span title="()String">getAbsolutePath</span>, <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.e" title="Throwable">e</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
            <a href="../../utils/PlayIO.scala.html#play.utils.PlayIO" title="play.utils.PlayIO.type">PlayIO</a>.<a href="../../utils/PlayIO.scala.html#play.utils.PlayIO.closeQuietly" title="(closeable: java.io.Closeable)Unit">closeQuietly</a><span class="delimiter">(</span><a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.in" title="java.io.FileInputStream">in</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="(exception: Throwable)scala.util.Failure[Nothing]">Failure</span><span class="delimiter">(</span><span title="(x$1: String)Exception" class="keyword">new</span> <span title="Exception">Exception</span><span class="delimiter">(</span><span title="String(&quot;Unable to find HTTPS keystore at \&quot;&quot;)" class="string">&quot;Unable to find HTTPS keystore at \&quot;&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory.file" title="java.io.File">file</a>.<span title="()String">getAbsolutePath</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="None.type">None</span> =&gt; <span class="delimiter">{</span>
        <span class="comment">// Load a generated key store</span>
        <a href="../../api/Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../../api/Play.scala.html#play.api.Play.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../api/Logger.scala.html#play.api;LoggerLike.warn(83d3728a3c)" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="String(&quot;Using generated key with self signed certificate for HTTPS. This should not be used in production.&quot;)" class="string">&quot;Using generated key with self signed certificate for HTTPS. This should not be used in production.&quot;</span><span class="delimiter">)</span>
        <a href="netty/FakeKeyStore.scala.html#play.core.server.netty.FakeKeyStore" title="play.core.server.netty.FakeKeyStore.type">FakeKeyStore</a>.<a href="netty/FakeKeyStore.scala.html#play.core.server.netty.FakeKeyStore.keyManagerFactory" title="(appPath: java.io.File)scala.util.Try[javax.net.ssl.KeyManagerFactory]">keyManagerFactory</a><span class="delimiter">(</span><a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.applicationProvider" title="play.core.ApplicationProvider">applicationProvider</a>.<a href="../system/ApplicationProvider.scala.html#play.core;ApplicationProvider.path" title="=&gt; java.io.File">path</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.keyManagerFactory" title="scala.util.Try[javax.net.ssl.KeyManagerFactory]">keyManagerFactory</a>.<span title="(f: javax.net.ssl.KeyManagerFactory =&gt; javax.net.ssl.SSLContext)scala.util.Try[javax.net.ssl.SSLContext]">map</span> <span class="delimiter">{</span> <a title="javax.net.ssl.KeyManagerFactory" id="play.core.server;DefaultSSLEngineProvider.createSSLContext.$anonfun.kmf">kmf</a> =&gt;
      <span class="comment">// Load the configured trust manager</span>
      <span class="keyword">val</span> <a title="Array[javax.net.ssl.TrustManager]" id="play.core.server;DefaultSSLEngineProvider.createSSLContext.$anonfun.tm">tm</a> = <span title="(x: String)Option[String]">Option</span><span class="delimiter">(</span><span title="System.type">System</span>.<span title="(x$1: String)String">getProperty</span><span class="delimiter">(</span><span title="String(&quot;https.trustStore&quot;)" class="string">&quot;https.trustStore&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: String =&gt; Array[javax.net.ssl.TrustManager])Option[Array[javax.net.ssl.TrustManager]]">map</span> <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.$anonfun.tm.$anonfun.x0$1" title="Array[javax.net.ssl.TrustManager]" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="String(&quot;noCA&quot;)" class="string">&quot;noCA&quot;</span> =&gt; <span class="delimiter">{</span>
          <a href="../../api/Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../../api/Play.scala.html#play.api.Play.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../api/Logger.scala.html#play.api;LoggerLike.warn(83d3728a3c)" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span class="string">&quot;HTTPS configured with no client &quot;</span> <span title="String(&quot;HTTPS configured with no client side CA verification. Requires http://webid.info/ for client certificate verification.&quot;)">+</span>
            <span class="string">&quot;side CA verification. Requires http://webid.info/ for client certificate verification.&quot;</span><span class="delimiter">)</span>
          <span title="[T](xs: T*)(implicit evidence$2: scala.reflect.ClassTag[T])Array[T]">Array</span><span title="(xs: javax.net.ssl.TrustManager*)(implicit evidence$2: scala.reflect.ClassTag[javax.net.ssl.TrustManager])Array[javax.net.ssl.TrustManager]" class="delimiter">[</span><span title="javax.net.ssl.TrustManager">TrustManager</span><span class="delimiter">]</span><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[javax.net.ssl.TrustManager]" class="delimiter">(</span><a href="NettyServer.scala.html#play.core.server.noCATrustManager" title="play.core.server.noCATrustManager.type">noCATrustManager</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> _ =&gt; <span class="delimiter">{</span>
          <a href="../../api/Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../../api/Play.scala.html#play.api.Play.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../api/Logger.scala.html#play.api;LoggerLike.debug(83d3728a3c)" title="(message: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Using default trust store for client side CA verification&quot;)" class="string">&quot;Using default trust store for client side CA verification&quot;</span><span class="delimiter">)</span>
          <span title="Null(null)" class="keyword">null</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>.<span title="(default: =&gt; Array[javax.net.ssl.TrustManager])Array[javax.net.ssl.TrustManager]">getOrElse</span> <span class="delimiter">{</span>
        <a href="../../api/Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../../api/Play.scala.html#play.api.Play.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../api/Logger.scala.html#play.api;LoggerLike.debug(83d3728a3c)" title="(message: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Using default trust store for client side CA verification&quot;)" class="string">&quot;Using default trust store for client side CA verification&quot;</span><span class="delimiter">)</span>
        <span title="Null(null)" class="keyword">null</span>
      <span class="delimiter">}</span>

      <span class="comment">// Configure the SSL context</span>
      <span class="keyword">val</span> <a title="javax.net.ssl.SSLContext" id="play.core.server;DefaultSSLEngineProvider.createSSLContext.$anonfun.sslContext">sslContext</a> = <span title="javax.net.ssl.SSLContext.type">SSLContext</span>.<span title="(x$1: String)javax.net.ssl.SSLContext">getInstance</span><span class="delimiter">(</span><span title="String(&quot;TLS&quot;)" class="string">&quot;TLS&quot;</span><span class="delimiter">)</span>
      <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.$anonfun.sslContext" title="javax.net.ssl.SSLContext">sslContext</a>.<span title="(x$1: Array[javax.net.ssl.KeyManager], x$2: Array[javax.net.ssl.TrustManager], x$3: java.security.SecureRandom)Unit">init</span><span class="delimiter">(</span><a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.$anonfun.kmf" title="javax.net.ssl.KeyManagerFactory">kmf</a>.<span title="()Array[javax.net.ssl.KeyManager]">getKeyManagers</span>, <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.$anonfun.tm" title="Array[javax.net.ssl.TrustManager]">tm</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
      <a href="#play.core.server;DefaultSSLEngineProvider.createSSLContext.$anonfun.sslContext" title="javax.net.ssl.SSLContext">sslContext</a>
    <span class="delimiter">}</span>.<span title="=&gt; javax.net.ssl.SSLContext">get</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
