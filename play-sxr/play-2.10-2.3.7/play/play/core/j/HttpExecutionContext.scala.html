<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>play/play/core/j/HttpExecutionContext.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2009-2013 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> play.core.j

<span class="keyword">import</span> play.mvc.Http
<span class="keyword">import</span> scala.concurrent.<span class="delimiter">{</span> ExecutionContext, ExecutionContextExecutor <span class="delimiter">}</span>

<span class="keyword">object</span> <a title="play.core.j.HttpExecutionContext.type" id="play.core.j.HttpExecutionContext">HttpExecutionContext</a> <a href="#play.core.j.HttpExecutionContext" title="play.core.j.HttpExecutionContext.type" class="delimiter">{</a>

  <span class="comment">/**
   * Create an HttpExecutionContext with values from the current thread.
   */</span>
  <span class="keyword">def</span> <a title="(delegate: scala.concurrent.ExecutionContext)scala.concurrent.ExecutionContextExecutor" id="play.core.j.HttpExecutionContext.fromThread">fromThread</a><span class="delimiter">(</span><a title="scala.concurrent.ExecutionContext" id="play.core.j.HttpExecutionContext.fromThread.delegate">delegate</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span>: <span title="scala.concurrent.ExecutionContextExecutor">ExecutionContextExecutor</span> =
    <span title="play.core.j.HttpExecutionContext" class="keyword">new</span> <a href="#play.core.j;HttpExecutionContext" title="play.core.j.HttpExecutionContext">HttpExecutionContext</a><span class="delimiter">(</span><span title="Thread.type">Thread</span>.<span title="()Thread">currentThread</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()ClassLoader">getContextClassLoader</span><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="../../mvc/Http.java.html#play.mvc.Http" title="play.mvc.Http.type">Http</a>.<a href="../../mvc/Http.java.html#play.mvc.Http.Context" title="play.mvc.Http.Context.type">Context</a>.<a href="../../mvc/Http.java.html#play.mvc.Http.Context.current" title="ThreadLocal[play.mvc.Http.Context]">current</a>.<span title="()play.mvc.Http.Context">get</span><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#play.core.j.HttpExecutionContext.fromThread.delegate" title="scala.concurrent.ExecutionContext">delegate</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Create an ExecutionContext that will, when prepared, be created with values from that thread.
   */</span>
  <span class="keyword">def</span> <a title="(delegate: scala.concurrent.ExecutionContext)scala.concurrent.ExecutionContext" id="play.core.j.HttpExecutionContext.unprepared">unprepared</a><span class="delimiter">(</span><a title="scala.concurrent.ExecutionContext" id="play.core.j.HttpExecutionContext.unprepared.delegate">delegate</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span> = <a href="#play.core.j.HttpExecutionContext.unprepared;$anon" title="scala.concurrent.ExecutionContext" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with scala.concurrent.ExecutionContext" id="play.core.j.HttpExecutionContext.unprepared;$anon">ExecutionContext</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(runnable: Runnable)Unit" id="play.core.j.HttpExecutionContext.unprepared;$anon.execute">execute</a><span class="delimiter">(</span><a title="Runnable" id="play.core.j.HttpExecutionContext.unprepared;$anon.execute.runnable">runnable</a>: <span title="Runnable">Runnable</span><span class="delimiter">)</span> = <a href="#play.core.j.HttpExecutionContext.unprepared.delegate" title="scala.concurrent.ExecutionContext">delegate</a>.<span title="(runnable: Runnable)Unit">execute</span><span class="delimiter">(</span><a href="#play.core.j.HttpExecutionContext.unprepared;$anon.execute.runnable" title="Runnable">runnable</a><span class="delimiter">)</span> <span class="comment">// FIXME: Make calling this an error once SI-7383 is fixed</span>
    <span class="keyword">def</span> <a title="(t: Throwable)Unit" id="play.core.j.HttpExecutionContext.unprepared;$anon.reportFailure">reportFailure</a><span class="delimiter">(</span><a title="Throwable" id="play.core.j.HttpExecutionContext.unprepared;$anon.reportFailure.t">t</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span> = <a href="#play.core.j.HttpExecutionContext.unprepared.delegate" title="scala.concurrent.ExecutionContext">delegate</a>.<span title="(t: Throwable)Unit">reportFailure</span><span class="delimiter">(</span><a href="#play.core.j.HttpExecutionContext.unprepared;$anon.reportFailure.t" title="Throwable">t</a><span class="delimiter">)</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()scala.concurrent.ExecutionContext" id="play.core.j.HttpExecutionContext.unprepared;$anon.prepare">prepare</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span> = <a href="#play.core.j.HttpExecutionContext.fromThread" title="(delegate: scala.concurrent.ExecutionContext)scala.concurrent.ExecutionContextExecutor">fromThread</a><span class="delimiter">(</span><a href="#play.core.j.HttpExecutionContext.unprepared.delegate" title="scala.concurrent.ExecutionContext">delegate</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Manages execution to ensure that the given context ClassLoader and Http.Context are set correctly
 * in the current thread. Actual execution is performed by a delegate ExecutionContext.
 */</span>
<span title="AnyRef" class="keyword">class</span> <a title="class HttpExecutionContext extends AnyRef with scala.concurrent.ExecutionContextExecutor" id="play.core.j;HttpExecutionContext">HttpExecutionContext</a><a href="#play.core.j;HttpExecutionContext" title="play.core.j.HttpExecutionContext" class="delimiter">(</a><a title="ClassLoader" id="play.core.j;HttpExecutionContext.contextClassLoader">contextClassLoader</a>: <span title="ClassLoader">ClassLoader</span>, <a title="play.mvc.Http.Context" id="play.core.j;HttpExecutionContext.httpContext">httpContext</a>: Http.<a href="../../mvc/Http.java.html#play.mvc.Http;Context" title="play.mvc.Http.Context">Context</a>, <a title="scala.concurrent.ExecutionContext" id="play.core.j;HttpExecutionContext.delegate">delegate</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="scala.concurrent.ExecutionContextExecutor">ExecutionContextExecutor</span> <span class="delimiter">{</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(runnable: Runnable)Unit" id="play.core.j;HttpExecutionContext.execute">execute</a><span class="delimiter">(</span><a title="Runnable" id="play.core.j;HttpExecutionContext.execute.runnable">runnable</a>: <span title="Runnable">Runnable</span><span class="delimiter">)</span> = <a href="#play.core.j;HttpExecutionContext.delegate" title="scala.concurrent.ExecutionContext">delegate</a>.<span title="(runnable: Runnable)Unit">execute</span><span class="delimiter">(</span><a href="#play.core.j;HttpExecutionContext.execute;$anon" title="Runnable" class="keyword">new</a> <a title="anonymous class $anon extends Object with Runnable" id="play.core.j;HttpExecutionContext.execute;$anon">Runnable</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="()Unit" id="play.core.j;HttpExecutionContext.execute;$anon.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Thread" id="play.core.j;HttpExecutionContext.execute;$anon.run.thread">thread</a> = <span title="Thread.type">Thread</span>.<span title="()Thread">currentThread</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ClassLoader" id="play.core.j;HttpExecutionContext.execute;$anon.run.oldContextClassLoader">oldContextClassLoader</a> = <a href="#play.core.j;HttpExecutionContext.execute;$anon.run.thread" title="Thread">thread</a>.<span title="()ClassLoader">getContextClassLoader</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="play.mvc.Http.Context" id="play.core.j;HttpExecutionContext.execute;$anon.run.oldHttpContext">oldHttpContext</a> = <a href="../../mvc/Http.java.html#play.mvc.Http" title="play.mvc.Http.type">Http</a>.<a href="../../mvc/Http.java.html#play.mvc.Http.Context" title="play.mvc.Http.Context.type">Context</a>.<a href="../../mvc/Http.java.html#play.mvc.Http.Context.current" title="ThreadLocal[play.mvc.Http.Context]">current</a>.<span title="()play.mvc.Http.Context">get</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#play.core.j;HttpExecutionContext.execute;$anon.run.thread" title="Thread">thread</a>.<span title="(x$1: ClassLoader)Unit">setContextClassLoader</span><span class="delimiter">(</span><a href="#play.core.j;HttpExecutionContext.contextClassLoader" title="ClassLoader">contextClassLoader</a><span class="delimiter">)</span>
      <a href="../../mvc/Http.java.html#play.mvc.Http" title="play.mvc.Http.type">Http</a>.<a href="../../mvc/Http.java.html#play.mvc.Http.Context" title="play.mvc.Http.Context.type">Context</a>.<a href="../../mvc/Http.java.html#play.mvc.Http.Context.current" title="ThreadLocal[play.mvc.Http.Context]">current</a>.<span title="(x$1: play.mvc.Http.Context)Unit">set</span><span class="delimiter">(</span><a href="#play.core.j;HttpExecutionContext.httpContext" title="play.mvc.Http.Context">httpContext</a><span class="delimiter">)</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#play.core.j;HttpExecutionContext.execute.runnable" title="Runnable">runnable</a>.<span title="()Unit">run</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
        <a href="#play.core.j;HttpExecutionContext.execute;$anon.run.thread" title="Thread">thread</a>.<span title="(x$1: ClassLoader)Unit">setContextClassLoader</span><span class="delimiter">(</span><a href="#play.core.j;HttpExecutionContext.execute;$anon.run.oldContextClassLoader" title="ClassLoader">oldContextClassLoader</a><span class="delimiter">)</span>
        <a href="../../mvc/Http.java.html#play.mvc.Http" title="play.mvc.Http.type">Http</a>.<a href="../../mvc/Http.java.html#play.mvc.Http.Context" title="play.mvc.Http.Context.type">Context</a>.<a href="../../mvc/Http.java.html#play.mvc.Http.Context.current" title="ThreadLocal[play.mvc.Http.Context]">current</a>.<span title="(x$1: play.mvc.Http.Context)Unit">set</span><span class="delimiter">(</span><a href="#play.core.j;HttpExecutionContext.execute;$anon.run.oldHttpContext" title="play.mvc.Http.Context">oldHttpContext</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(t: Throwable)Unit" id="play.core.j;HttpExecutionContext.reportFailure">reportFailure</a><span class="delimiter">(</span><a title="Throwable" id="play.core.j;HttpExecutionContext.reportFailure.t">t</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span> = <a href="#play.core.j;HttpExecutionContext.delegate" title="scala.concurrent.ExecutionContext">delegate</a>.<span title="(t: Throwable)Unit">reportFailure</span><span class="delimiter">(</span><a href="#play.core.j;HttpExecutionContext.reportFailure.t" title="Throwable">t</a><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()scala.concurrent.ExecutionContext" id="play.core.j;HttpExecutionContext.prepare">prepare</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.concurrent.ExecutionContext" id="play.core.j;HttpExecutionContext.prepare.delegatePrepared">delegatePrepared</a> = <a href="#play.core.j;HttpExecutionContext.delegate" title="scala.concurrent.ExecutionContext">delegate</a>.<span title="()scala.concurrent.ExecutionContext">prepare</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="play.core.j.HttpExecutionContext" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.core.j;HttpExecutionContext.prepare.delegatePrepared" title="scala.concurrent.ExecutionContext">delegatePrepared</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#play.core.j;HttpExecutionContext.delegate" title="scala.concurrent.ExecutionContext">delegate</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#play.core.j;HttpExecutionContext" title="play.core.j.HttpExecutionContext" class="keyword">this</a>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span title="play.core.j.HttpExecutionContext" class="keyword">new</span> <a href="#play.core.j;HttpExecutionContext" title="play.core.j.HttpExecutionContext">HttpExecutionContext</a><span class="delimiter">(</span><a href="#play.core.j;HttpExecutionContext.contextClassLoader" title="ClassLoader">contextClassLoader</a>, <a href="#play.core.j;HttpExecutionContext.httpContext" title="play.mvc.Http.Context">httpContext</a>, <a href="#play.core.j;HttpExecutionContext.prepare.delegatePrepared" title="scala.concurrent.ExecutionContext">delegatePrepared</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>
