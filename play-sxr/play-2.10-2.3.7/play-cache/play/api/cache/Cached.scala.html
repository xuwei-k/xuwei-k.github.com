<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>play-cache/play/api/cache/Cached.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2009-2013 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> play.api.cache

<span class="keyword">import</span> play.api._
<span class="keyword">import</span> play.api.mvc._
<span class="keyword">import</span> play.api.libs.iteratee.<span class="delimiter">{</span> Iteratee, Done <span class="delimiter">}</span>
<span class="keyword">import</span> play.api.http.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<span class="delimiter">{</span> IF_NONE_MATCH, ETAG, EXPIRES <span class="delimiter">}</span>
<span class="keyword">import</span> play.api.mvc.<a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc.Results" title="play.api.mvc.Results.type">Results</a>.NotModified

<span class="keyword">import</span> play.core.<a href="../../../../play/play/core/system/Execution.scala.html#play.core.Execution" title="play.core.Execution.type">Execution</a>.<a href="../../../../play/play/core/system/Execution.scala.html#play.core.Execution.Implicits" title="play.core.Execution.Implicits.type">Implicits</a>.internalContext

<span class="keyword">import</span> scala.concurrent.duration._

<span class="comment">/**
 * Cache an action.
 *
 * Uses both server and client caches:
 *
 *  - Adds an `Expires` header to the response, so clients can cache response content ;
 *  - Adds an `Etag` header to the response, so clients can cache response content and ask the server for freshness ;
 *  - Cache the result on the server, so the underlying action is not computed at each call.
 *
 * @param key Compute a key from the request header
 * @param caching A callback to get the number of seconds to cache results for
 */</span>
<span class="keyword">case class</span> <a title="class Cached extends AnyRef with Product with Serializable" id="play.api.cache;Cached">Cached</a><a href="#play.api.cache;Cached" title="Product" class="delimiter">(</a><a title="play.api.mvc.RequestHeader =&gt; String" id="play.api.cache;Cached.key">key</a>: RequestHeader =&gt; String, <a title="PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration]" id="play.api.cache;Cached.caching">caching</a>: <span title="PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration]">PartialFunction</span><span class="delimiter">[</span>ResponseHeader, Duration<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#play.api.cache.Cached.readResolve" title="play.api.cache.Cached.type">Cached</a>._

  <span class="keyword">def</span> <a title="(action: play.api.mvc.EssentialAction)(implicit app: play.api.Application)play.api.mvc.EssentialAction" id="play.api.cache;Cached.apply">apply</a><span class="delimiter">(</span><a title="play.api.mvc.EssentialAction" id="play.api.cache;Cached.apply.action">action</a>: <a href="../../../../play/play/api/mvc/Action.scala.html#play.api.mvc;EssentialAction" title="play.api.mvc.EssentialAction">EssentialAction</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="play.api.Application" id="play.api.cache;Cached.apply.app">app</a>: <a href="../../../../play/play/api/Application.scala.html#play.api;Application" title="play.api.Application">Application</a><span class="delimiter">)</span> = <a href="#play.api.cache;Cached.build" title="(action: play.api.mvc.EssentialAction)(implicit app: play.api.Application)play.api.mvc.EssentialAction">build</a><a href="#play.api.cache;Cached.apply.app" title="play.api.Application" class="delimiter">(</a><a href="#play.api.cache;Cached.apply.action" title="play.api.mvc.EssentialAction">action</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Compose the cache with an action
   */</span>
  <span class="keyword">def</span> <a title="(action: play.api.mvc.EssentialAction)(implicit app: play.api.Application)play.api.mvc.EssentialAction" id="play.api.cache;Cached.build">build</a><span class="delimiter">(</span><a title="play.api.mvc.EssentialAction" id="play.api.cache;Cached.build.action">action</a>: <a href="../../../../play/play/api/mvc/Action.scala.html#play.api.mvc;EssentialAction" title="play.api.mvc.EssentialAction">EssentialAction</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="play.api.Application" id="play.api.cache;Cached.build.app">app</a>: <a href="../../../../play/play/api/Application.scala.html#play.api;Application" title="play.api.Application">Application</a><span class="delimiter">)</span> = <a href="../../../../play/play/api/mvc/Action.scala.html#play.api.mvc.EssentialAction.apply" title="(f: play.api.mvc.RequestHeader =&gt; play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result])play.api.mvc.EssentialAction">EssentialAction</a> <span class="delimiter">{</span> <a title="play.api.mvc.RequestHeader" id="play.api.cache;Cached.build.$anonfun.request">request</a> =&gt;
    <span class="keyword">val</span> <a title="String" id="play.api.cache;Cached.build.$anonfun.resultKey">resultKey</a> = <a href="#play.api.cache;Cached.key" title="(v1: play.api.mvc.RequestHeader)String">key</a><span class="delimiter">(</span><a href="#play.api.cache;Cached.build.$anonfun.request" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="String" id="play.api.cache;Cached.build.$anonfun.etagKey">etagKey</a> = <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;&quot;)">$</span><a href="#play.api.cache;Cached.build.$anonfun.resultKey" title="String">resultKey</a><span title="String(&quot;-etag&quot;)" class="string">-etag&quot;</span>

    <span class="comment">// Has the client a version of the resource as fresh as the last one we served?</span>
    <span class="keyword">val</span> <a title="Option[play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]]" id="play.api.cache;Cached.build.$anonfun.notModified">notModified</a> = <span class="keyword">for</span> <span class="delimiter">{</span>
      <a title="String" id="play.api.cache;Cached.build.$anonfun.notModified.$anonfun.requestEtag">requestEtag</a> &lt;- <a href="#play.api.cache;Cached.build.$anonfun.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.headers" title="=&gt; play.api.mvc.Headers">headers</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;Headers.get" title="(key: String)Option[String]">get</a><span title="(f: String =&gt; Option[play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]])Option[play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]]" class="delimiter">(</span><a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.IF_NONE_MATCH" title="=&gt; String">IF_NONE_MATCH</a><span class="delimiter">)</span>
      <a title="String" id="play.api.cache;Cached.build.$anonfun.notModified.$anonfun.$anonfun.etag">etag</a> &lt;- <a href="Cache.scala.html#play.api.cache.Cache" title="play.api.cache.Cache.type">Cache</a>.<a href="Cache.scala.html#play.api.cache.Cache.getAs" title="[T](key: String)(implicit app: play.api.Application, implicit ct: scala.reflect.ClassTag[T])Option[T]">getAs</a><span title="(key: String)(implicit app: play.api.Application, implicit ct: scala.reflect.ClassTag[String])Option[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span><a href="#play.api.cache;Cached.build.app" title="(f: String =&gt; play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result])Option[play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]]" class="delimiter">(</a><a href="#play.api.cache;Cached.build.$anonfun.etagKey" title="String">etagKey</a><span class="delimiter">)</span>
      <span class="keyword">if</span> <a href="#play.api.cache;Cached.build.$anonfun.notModified.$anonfun.requestEtag" title="String">requestEtag</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="String(&quot;*&quot;)" class="string">&quot;*&quot;</span> <span title="(x: Boolean)Boolean">||</span> <a href="#play.api.cache;Cached.build.$anonfun.notModified.$anonfun.$anonfun.etag" title="String">etag</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#play.api.cache;Cached.build.$anonfun.notModified.$anonfun.requestEtag" title="String">requestEtag</a>
    <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Done.apply" title="[E, A](a: A, e: play.api.libs.iteratee.Input[E])play.api.libs.iteratee.Iteratee[E,A]">Done</a><a href="../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Done.apply$default$2" title="(a: play.api.mvc.Result, e: play.api.libs.iteratee.Input[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]" class="delimiter">[</a><span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Result" title="play.api.mvc.Result">Result</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Results.NotModified" title="=&gt; play.api.mvc.Result">NotModified</a><span class="delimiter">)</span>

    <a href="#play.api.cache;Cached.build.$anonfun.notModified" title="Option[play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]]">notModified</a>.<span title="(alternative: =&gt; Option[play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]])Option[play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]]">orElse</span> <span class="delimiter">{</span>
      <span class="comment">// Otherwise try to serve the resource from the cache, if it has not yet expired</span>
      <a href="Cache.scala.html#play.api.cache.Cache" title="play.api.cache.Cache.type">Cache</a>.<a href="Cache.scala.html#play.api.cache.Cache.getAs" title="[T](key: String)(implicit app: play.api.Application, implicit ct: scala.reflect.ClassTag[T])Option[T]">getAs</a><span title="(key: String)(implicit app: play.api.Application, implicit ct: scala.reflect.ClassTag[play.api.mvc.Result])Option[play.api.mvc.Result]" class="delimiter">[</span><a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Result" title="play.api.mvc.Result">Result</a><span class="delimiter">]</span><a href="#play.api.cache;Cached.build.app" title="play.api.Application" class="delimiter">(</a><a href="#play.api.cache;Cached.build.$anonfun.resultKey" title="String">resultKey</a><span class="delimiter">)</span>.<span title="(f: play.api.mvc.Result =&gt; play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result])Option[play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]]">map</span><span class="delimiter">(</span><a href="../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Done.apply" title="[E, A](a: A, e: play.api.libs.iteratee.Input[E])play.api.libs.iteratee.Iteratee[E,A]">Done</a><a href="../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Done.apply$default$2" title="(a: play.api.mvc.Result, e: play.api.libs.iteratee.Input[Array[Byte]])play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]" class="delimiter">[</a><span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Result" title="play.api.mvc.Result">Result</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="#play.api.cache;Cached.build.$anonfun.$anonfun.x$1" title="play.api.mvc.Result">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="(default: =&gt; play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result])play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]">getOrElse</span> <span class="delimiter">{</span>
      <span class="comment">// The resource was not in the cache, we have to run the underlying action</span>
      <span class="keyword">val</span> <a title="play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]" id="play.api.cache;Cached.build.$anonfun.iterateeResult">iterateeResult</a> = <a href="#play.api.cache;Cached.build.action" title="(v1: play.api.mvc.RequestHeader)play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]">action</a><span class="delimiter">(</span><a href="#play.api.cache;Cached.build.$anonfun.request" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span>

      <span class="comment">// Add cache information to the response, so clients can cache its content</span>
      <a href="#play.api.cache;Cached.build.$anonfun.iterateeResult" title="play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]">iterateeResult</a>.<a href="../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee.map" title="(f: play.api.mvc.Result =&gt; play.api.mvc.Result)(implicit ec: scala.concurrent.ExecutionContext)play.api.libs.iteratee.Iteratee[Array[Byte],play.api.mvc.Result]">map</a><a href="../../../../play/play/core/system/Execution.scala.html#play.core.Execution.Implicits.internalContext" title="=&gt; scala.concurrent.ExecutionContext" class="delimiter">(</a><a href="#play.api.cache;Cached.handleResult" title="(result: play.api.mvc.Result, etagKey: String, resultKey: String, app: play.api.Application)play.api.mvc.Result">handleResult</a><span class="delimiter">(</span><a href="#play.api.cache;Cached.build.$anonfun.$anonfun.x$2" title="play.api.mvc.Result">_</a>, <a href="#play.api.cache;Cached.build.$anonfun.etagKey" title="String">etagKey</a>, <a href="#play.api.cache;Cached.build.$anonfun.resultKey" title="String">resultKey</a>, <a href="#play.api.cache;Cached.build.app" title="play.api.Application">app</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Eternity is one year long. Duration zero means eternity.
   */</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration]" id="play.api.cache;Cached.cachingWithEternity">cachingWithEternity</a> = <a href="#play.api.cache;Cached.caching" title="=&gt; PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration]">caching</a>.<span title="(k: scala.concurrent.duration.Duration =&gt; scala.concurrent.duration.Duration)PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration]">andThen</span> <span class="delimiter">{</span> <a title="scala.concurrent.duration.Duration" id="play.api.cache;Cached.cachingWithEternity.$anonfun.duration">duration</a> =&gt;
    <span title="scala.concurrent.duration.Duration" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.cache.Cached.DurationEmpty" title="implicit play.api.cache.Cached.DurationEmpty : (d: scala.concurrent.duration.Duration)play.api.cache.Cached.DurationEmpty">duration</a>.<a href="#play.api.cache.Cached;DurationEmpty.zero" title="()Boolean">zero</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(length: Long, unit: scala.concurrent.duration.TimeUnit)scala.concurrent.duration.FiniteDuration">Duration</span><span class="delimiter">(</span><span class="int">60</span> * <span class="int">60</span> * <span class="int">24</span> <span title="Long(31536000L)">*</span> <span class="int">365</span>, <span title="java.util.concurrent.TimeUnit(SECONDS)">SECONDS</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#play.api.cache;Cached.cachingWithEternity.$anonfun.duration" title="scala.concurrent.duration.Duration">duration</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(result: play.api.mvc.Result, etagKey: String, resultKey: String, app: play.api.Application)play.api.mvc.Result" id="play.api.cache;Cached.handleResult">handleResult</a><span class="delimiter">(</span><a title="play.api.mvc.Result" id="play.api.cache;Cached.handleResult.result">result</a>: <a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Result" title="play.api.mvc.Result">Result</a>, <a title="String" id="play.api.cache;Cached.handleResult.etagKey">etagKey</a>: <span title="String">String</span>, <a title="String" id="play.api.cache;Cached.handleResult.resultKey">resultKey</a>: <span title="String">String</span>, <a title="play.api.Application" id="play.api.cache;Cached.handleResult.app">app</a>: <a href="../../../../play/play/api/Application.scala.html#play.api;Application" title="play.api.Application">Application</a><span class="delimiter">)</span>: <a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Result" title="play.api.mvc.Result">Result</a> = <span class="delimiter">{</span>
    <a href="#play.api.cache;Cached.cachingWithEternity" title="=&gt; PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration]">cachingWithEternity</a>.<span title="(k: scala.concurrent.duration.Duration =&gt; play.api.mvc.Result)PartialFunction[play.api.mvc.ResponseHeader,play.api.mvc.Result]">andThen</span> <span class="delimiter">{</span> <a title="scala.concurrent.duration.Duration" id="play.api.cache;Cached.handleResult.$anonfun.duration">duration</a> =&gt;
      <span class="comment">// Format expiration date according to http standard</span>
      <span class="keyword">val</span> <a title="String" id="play.api.cache;Cached.handleResult.$anonfun.expirationDate">expirationDate</a> = http.<a href="../../../../play/play/api/http/package.scala.html#play.api.http.package.dateFormat" title="=&gt; org.joda.time.format.DateTimeFormatter">dateFormat</a>.<span title="(x$1: Long)String">print</span><span class="delimiter">(</span><span title="System.type">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Long)Long">+</span> <a href="#play.api.cache;Cached.handleResult.$anonfun.duration" title="scala.concurrent.duration.Duration">duration</a>.<span title="=&gt; Long">toMillis</span><span class="delimiter">)</span>
      <span class="comment">// Generate a fresh ETAG for it</span>
      <span class="keyword">val</span> <a title="String" id="play.api.cache;Cached.handleResult.$anonfun.etag">etag</a> = <a href="#play.api.cache;Cached.handleResult.$anonfun.expirationDate" title="String">expirationDate</a> <span class="comment">// Use the expiration date as ETAG</span>

      <span class="keyword">val</span> <a title="play.api.mvc.Result" id="play.api.cache;Cached.handleResult.$anonfun.resultWithHeaders">resultWithHeaders</a> = <a href="#play.api.cache;Cached.handleResult.result" title="play.api.mvc.Result">result</a>.<a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Result.withHeaders" title="(headers: (String, String)*)play.api.mvc.Result">withHeaders</a><span class="delimiter">(</span><a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ETAG" title="(x: String)ArrowAssoc[String]">ETAG</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#play.api.cache;Cached.handleResult.$anonfun.etag" title="String">etag</a>, <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.EXPIRES" title="(x: String)ArrowAssoc[String]">EXPIRES</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#play.api.cache;Cached.handleResult.$anonfun.expirationDate" title="String">expirationDate</a><span class="delimiter">)</span>

      <span class="comment">// Cache the new ETAG of the resource</span>
      <a href="Cache.scala.html#play.api.cache.Cache" title="play.api.cache.Cache.type">Cache</a>.<a href="Cache.scala.html#play.api.cache.Cache.set(18632c5db8)" title="(key: String, value: Any, expiration: scala.concurrent.duration.Duration)(implicit app: play.api.Application)Unit">set</a><span class="delimiter">(</span><a href="#play.api.cache;Cached.handleResult.etagKey" title="String">etagKey</a>, <a href="#play.api.cache;Cached.handleResult.$anonfun.etag" title="String">etag</a>, <a href="#play.api.cache;Cached.handleResult.$anonfun.duration" title="scala.concurrent.duration.Duration">duration</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#play.api.cache;Cached.handleResult.app" title="play.api.Application">app</a><span class="delimiter">)</span>
      <span class="comment">// Cache the new Result of the resource</span>
      <a href="Cache.scala.html#play.api.cache.Cache" title="play.api.cache.Cache.type">Cache</a>.<a href="Cache.scala.html#play.api.cache.Cache.set(18632c5db8)" title="(key: String, value: Any, expiration: scala.concurrent.duration.Duration)(implicit app: play.api.Application)Unit">set</a><span class="delimiter">(</span><a href="#play.api.cache;Cached.handleResult.resultKey" title="String">resultKey</a>, <a href="#play.api.cache;Cached.handleResult.$anonfun.resultWithHeaders" title="play.api.mvc.Result">resultWithHeaders</a>, <a href="#play.api.cache;Cached.handleResult.$anonfun.duration" title="scala.concurrent.duration.Duration">duration</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#play.api.cache;Cached.handleResult.app" title="play.api.Application">app</a><span class="delimiter">)</span>

      <a href="#play.api.cache;Cached.handleResult.$anonfun.resultWithHeaders" title="play.api.mvc.Result">resultWithHeaders</a>
    <span class="delimiter">}</span>.<span title="(x: play.api.mvc.ResponseHeader, default: play.api.mvc.ResponseHeader =&gt; play.api.mvc.Result)play.api.mvc.Result">applyOrElse</span><span class="delimiter">(</span><a href="#play.api.cache;Cached.handleResult.result" title="play.api.mvc.Result">result</a>.<a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Result.header" title="=&gt; play.api.mvc.ResponseHeader">header</a>, <span class="delimiter">(</span>_: <a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;ResponseHeader" title="play.api.mvc.ResponseHeader">ResponseHeader</a><span class="delimiter">)</span> =&gt; <a href="#play.api.cache;Cached.handleResult.result" title="play.api.mvc.Result">result</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Whether this cache should cache the specified response if the status code match
   * This method will cache the result forever
   */</span>
  <span class="keyword">def</span> <a title="(status: Int)play.api.cache.Cached" id="play.api.cache;Cached.includeStatus(29be889a2b)">includeStatus</a><span class="delimiter">(</span><a title="Int" id="play.api.cache;Cached.includeStatus(29be889a2b).status">status</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a> = <a href="#play.api.cache;Cached.includeStatus(ae621c190d)" title="(status: Int, duration: scala.concurrent.duration.Duration)play.api.cache.Cached">includeStatus</a><span class="delimiter">(</span><a href="#play.api.cache;Cached.includeStatus(29be889a2b).status" title="Int">status</a>, <span title="scala.concurrent.duration.Duration.type">Duration</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">Zero</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Whether this cache should cache the specified response if the status code match
   * This method will cache the result for duration seconds
   *
   * @param status the status code to check
   * @param duration the number of seconds to cache the result for
   */</span>
  <span class="keyword">def</span> <a title="(status: Int, duration: Int)play.api.cache.Cached" id="play.api.cache;Cached.includeStatus(97f6aeae3c)">includeStatus</a><span class="delimiter">(</span><a title="Int" id="play.api.cache;Cached.includeStatus(97f6aeae3c).status">status</a>: <span title="Int">Int</span>, <a title="Int" id="play.api.cache;Cached.includeStatus(97f6aeae3c).duration">duration</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a> = <a href="#play.api.cache;Cached.includeStatus(ae621c190d)" title="(status: Int, duration: scala.concurrent.duration.Duration)play.api.cache.Cached">includeStatus</a><span class="delimiter">(</span><a href="#play.api.cache;Cached.includeStatus(97f6aeae3c).status" title="Int">status</a>, <span title="(length: Long, unit: scala.concurrent.duration.TimeUnit)scala.concurrent.duration.FiniteDuration">Duration</span><span class="delimiter">(</span><a href="#play.api.cache;Cached.includeStatus(97f6aeae3c).duration" title="=&gt; Long">duration</a>, <span title="java.util.concurrent.TimeUnit(SECONDS)">SECONDS</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Whether this cache should cache the specified response if the status code match
   * This method will cache the result for duration seconds
   *
   * @param status the status code to check
   * @param duration how long should we cache the result for
   */</span>
  <span class="keyword">def</span> <a title="(status: Int, duration: scala.concurrent.duration.Duration)play.api.cache.Cached" id="play.api.cache;Cached.includeStatus(ae621c190d)">includeStatus</a><span class="delimiter">(</span><a title="Int" id="play.api.cache;Cached.includeStatus(ae621c190d).status">status</a>: <span title="Int">Int</span>, <a title="scala.concurrent.duration.Duration" id="play.api.cache;Cached.includeStatus(ae621c190d).duration">duration</a>: <span title="scala.concurrent.duration.Duration">Duration</span><span class="delimiter">)</span>: <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a> = <a href="#play.api.cache;Cached" title="Cached.this.type" class="keyword">this</a>.<a href="#play.api.cache;Cached.key" title="play.api.mvc.RequestHeader =&gt; String @scala.reflect.internal.annotations.uncheckedBounds" id="play.api.cache;Cached.includeStatus(ae621c190d).x$7">copy</a><span class="delimiter">(</span>caching = <a href="#play.api.cache;Cached.caching" title="=&gt; PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration]">caching</a>.<span title="(that: PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration])PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration]">orElse</span> <a title="PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration] @scala.reflect.internal.annotations.uncheckedBounds" id="play.api.cache;Cached.includeStatus(ae621c190d).x$6;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> <a title="play.api.mvc.ResponseHeader" id="play.api.cache;Cached.includeStatus(ae621c190d).x$6;$anonfun.isDefinedAt.e">e</a> <span class="keyword">if</span> <a href="#play.api.cache;Cached.includeStatus(ae621c190d).x$6;$anonfun.isDefinedAt.e" title="play.api.mvc.ResponseHeader">e</a>.<a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;ResponseHeader.status" title="=&gt; Int">status</a> <span title="(x: Int)Boolean">==</span> <a href="#play.api.cache;Cached.includeStatus(ae621c190d).status" title="Int">status</a> =&gt; <span class="delimiter">{</span>
      <a href="#play.api.cache;Cached.includeStatus(ae621c190d).duration" title="scala.concurrent.duration.Duration">duration</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span><span class="delimiter">)</span>

  <span class="comment">/**
   * The returned cache will store all responses whatever they may contain
   * @param duration how long we should store responses
   */</span>
  <span class="keyword">def</span> <a title="(duration: scala.concurrent.duration.Duration)play.api.cache.Cached" id="play.api.cache;Cached.default(576b4d3476)">default</a><span class="delimiter">(</span><a title="scala.concurrent.duration.Duration" id="play.api.cache;Cached.default(576b4d3476).duration">duration</a>: <span title="scala.concurrent.duration.Duration">Duration</span><span class="delimiter">)</span>: <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a> = <a href="#play.api.cache;Cached.compose" title="(alternative: PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration])play.api.cache.Cached">compose</a><span class="delimiter">(</span><span title="(f: play.api.mvc.ResponseHeader =&gt; scala.concurrent.duration.Duration)PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration]">PartialFunction</span><span class="delimiter">(</span><span class="delimiter">(</span>_: <a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;ResponseHeader" title="play.api.mvc.ResponseHeader">ResponseHeader</a><span class="delimiter">)</span> =&gt; <a href="#play.api.cache;Cached.default(576b4d3476).duration" title="scala.concurrent.duration.Duration">duration</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * The returned cache will store all responses whatever they may contain
   * @param duration the number of seconds we should store responses
   */</span>
  <span class="keyword">def</span> <a title="(duration: Int)play.api.cache.Cached" id="play.api.cache;Cached.default(b51e2e250a)">default</a><span class="delimiter">(</span><a title="Int" id="play.api.cache;Cached.default(b51e2e250a).duration">duration</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a> = <a href="#play.api.cache;Cached.default(576b4d3476)" title="(duration: scala.concurrent.duration.Duration)play.api.cache.Cached">default</a><span class="delimiter">(</span><span title="(length: Long, unit: scala.concurrent.duration.TimeUnit)scala.concurrent.duration.FiniteDuration">Duration</span><span class="delimiter">(</span><a href="#play.api.cache;Cached.default(b51e2e250a).duration" title="=&gt; Long">duration</a>, <span title="java.util.concurrent.TimeUnit(SECONDS)">SECONDS</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Compose the cache with new caching function
   * @param alternative a closure getting the reponseheader and returning the duration
   *        we should cache for
   */</span>
  <span class="keyword">def</span> <a title="(alternative: PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration])play.api.cache.Cached" id="play.api.cache;Cached.compose">compose</a><span class="delimiter">(</span><a title="PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration]" id="play.api.cache;Cached.compose.alternative">alternative</a>: <span title="PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration]">PartialFunction</span><span class="delimiter">[</span>ResponseHeader, Duration<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a> = <a href="#play.api.cache;Cached" title="Cached.this.type" class="keyword">this</a>.<a href="#play.api.cache;Cached.key" title="play.api.mvc.RequestHeader =&gt; String @scala.reflect.internal.annotations.uncheckedBounds" id="play.api.cache;Cached.compose.x$9">copy</a><span class="delimiter">(</span>caching = <a href="#play.api.cache;Cached.caching" title="=&gt; PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration]">caching</a>.<span title="(that: PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration])PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration]">orElse</span><a title="PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration] @scala.reflect.internal.annotations.uncheckedBounds" id="play.api.cache;Cached.compose.x$8" class="delimiter">(</a><a href="#play.api.cache;Cached.compose.alternative" title="PartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration]">alternative</a><span class="delimiter">)</span><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="play.api.cache.Cached.type" id="play.api.cache.Cached.readResolve">Cached</a> <a href="#play.api.cache.Cached.readResolve" title="play.api.cache.Cached.type" class="delimiter">{</a>

  <span class="comment">/**
   * Convenient implicit class for adding a zero method to Duration
   */</span>
  <span class="keyword">private</span> <span class="keyword">implicit</span> <span class="keyword">class</span> <a title="class DurationEmpty extends AnyRef" id="play.api.cache.Cached.DurationEmpty">DurationEmpty</a><a href="#play.api.cache.Cached.DurationEmpty" title="play.api.cache.Cached.DurationEmpty" class="delimiter">(</a><a title="scala.concurrent.duration.Duration" id="play.api.cache.Cached.DurationEmpty.d">d</a>: <span title="scala.concurrent.duration.Duration">Duration</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="comment">/**
     * This tests if the duration is currently zero
     * @returns boolean checking whether the duration is zero or not
     */</span>
    <span class="keyword">def</span> <a title="()Boolean" id="play.api.cache.Cached;DurationEmpty.zero">zero</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#play.api.cache.Cached.DurationEmpty.d" title="scala.concurrent.duration.Duration">d</a>.<span title="()scala.concurrent.duration.Duration">neg</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Any)Boolean">equals</span><span class="delimiter">(</span><a href="#play.api.cache.Cached.DurationEmpty.d" title="scala.concurrent.duration.Duration">d</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Cache an action.
   *
   * @param key Compute a key from the request header
   */</span>
  <span class="keyword">def</span> <a title="(key: play.api.mvc.RequestHeader =&gt; String)play.api.cache.Cached" id="play.api.cache.Cached.apply(02f29a19d7)">apply</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader =&gt; String" id="play.api.cache.Cached.apply(02f29a19d7).key">key</a>: RequestHeader =&gt; String<span class="delimiter">)</span>: <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a> = <span class="delimiter">{</span>
    <a href="#play.api.cache.Cached.apply(0eeb5a34a9)" title="(key: play.api.mvc.RequestHeader =&gt; String, duration: Int)play.api.cache.Cached">apply</a><span class="delimiter">(</span><a href="#play.api.cache.Cached.apply(02f29a19d7).key" title="play.api.mvc.RequestHeader =&gt; String">key</a>, duration = <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Cache an action.
   *
   * @param key Cache key
   */</span>
  <span class="keyword">def</span> <a title="(key: String)play.api.cache.Cached" id="play.api.cache.Cached.apply(2fbef16f98)">apply</a><span class="delimiter">(</span><a title="String" id="play.api.cache.Cached.apply(2fbef16f98).key">key</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a> = <span class="delimiter">{</span>
    <a href="#play.api.cache.Cached.apply(0eeb5a34a9)" title="(key: play.api.mvc.RequestHeader =&gt; String, duration: Int)play.api.cache.Cached">apply</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader" id="play.api.cache.Cached.apply(2fbef16f98).$anonfun.x$5">_</a> =&gt; <a href="#play.api.cache.Cached.apply(2fbef16f98).key" title="String">key</a>, duration = <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Cache an action.
   *
   * @param key Cache key
   * @param duration Cache duration (in seconds)
   */</span>
  <span class="keyword">def</span> <a title="(key: play.api.mvc.RequestHeader =&gt; String, duration: Int)play.api.cache.Cached" id="play.api.cache.Cached.apply(0eeb5a34a9)">apply</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader =&gt; String" id="play.api.cache.Cached.apply(0eeb5a34a9).key">key</a>: RequestHeader =&gt; String, <a title="Int" id="play.api.cache.Cached.apply(0eeb5a34a9).duration">duration</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a> = <span class="delimiter">{</span>
    <span title="play.api.cache.Cached" class="keyword">new</span> <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a><span class="delimiter">(</span><a href="#play.api.cache.Cached.apply(0eeb5a34a9).key" title="play.api.mvc.RequestHeader =&gt; String">key</a>, <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[play.api.mvc.ResponseHeader,scala.concurrent.duration.Duration] with Serializable" id="play.api.cache.Cached.apply(0eeb5a34a9);$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>_: <a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;ResponseHeader" title="play.api.mvc.ResponseHeader">ResponseHeader</a><span class="delimiter">)</span> =&gt; <span title="(length: Long, unit: scala.concurrent.duration.TimeUnit)scala.concurrent.duration.FiniteDuration">Duration</span><span title="Boolean(true)" class="delimiter">(</span><a href="#play.api.cache.Cached.apply(0eeb5a34a9).duration" title="=&gt; Long">duration</a>, <span title="java.util.concurrent.TimeUnit(SECONDS)">SECONDS</span><span class="delimiter">)</span> <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * A cached instance caching nothing
   * Useful for composition
   */</span>
  <span class="keyword">def</span> <a title="(key: play.api.mvc.RequestHeader =&gt; String)play.api.cache.Cached" id="play.api.cache.Cached.empty">empty</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader =&gt; String" id="play.api.cache.Cached.empty.key">key</a>: RequestHeader =&gt; String<span class="delimiter">)</span>: <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a> = <span title="play.api.cache.Cached" class="keyword">new</span> <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a><span class="delimiter">(</span><a href="#play.api.cache.Cached.empty.key" title="play.api.mvc.RequestHeader =&gt; String">key</a>, <span title="PartialFunction.type">PartialFunction</span>.<span title="PartialFunction[Any,Nothing]">empty</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Caches everything, forever
   */</span>
  <span class="keyword">def</span> <a title="(key: play.api.mvc.RequestHeader =&gt; String)play.api.cache.Cached" id="play.api.cache.Cached.everything(02f29a19d7)">everything</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader =&gt; String" id="play.api.cache.Cached.everything(02f29a19d7).key">key</a>: RequestHeader =&gt; String<span class="delimiter">)</span>: <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a> = <a href="#play.api.cache.Cached.empty" title="(key: play.api.mvc.RequestHeader =&gt; String)play.api.cache.Cached">empty</a><span class="delimiter">(</span><a href="#play.api.cache.Cached.everything(02f29a19d7).key" title="play.api.mvc.RequestHeader =&gt; String">key</a><span class="delimiter">)</span>.<a href="#play.api.cache;Cached.default(b51e2e250a)" title="(duration: Int)play.api.cache.Cached">default</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Caches everything for the specified seconds
   */</span>
  <span class="keyword">def</span> <a title="(key: play.api.mvc.RequestHeader =&gt; String, duration: Int)play.api.cache.Cached" id="play.api.cache.Cached.everything(0eeb5a34a9)">everything</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader =&gt; String" id="play.api.cache.Cached.everything(0eeb5a34a9).key">key</a>: RequestHeader =&gt; String, <a title="Int" id="play.api.cache.Cached.everything(0eeb5a34a9).duration">duration</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a> = <a href="#play.api.cache.Cached.empty" title="(key: play.api.mvc.RequestHeader =&gt; String)play.api.cache.Cached">empty</a><span class="delimiter">(</span><a href="#play.api.cache.Cached.everything(0eeb5a34a9).key" title="play.api.mvc.RequestHeader =&gt; String">key</a><span class="delimiter">)</span>.<a href="#play.api.cache;Cached.default(b51e2e250a)" title="(duration: Int)play.api.cache.Cached">default</a><span class="delimiter">(</span><a href="#play.api.cache.Cached.everything(0eeb5a34a9).duration" title="Int">duration</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Caches the specified status, for the specified number of seconds
   */</span>
  <span class="keyword">def</span> <a title="(key: play.api.mvc.RequestHeader =&gt; String, status: Int, duration: Int)play.api.cache.Cached" id="play.api.cache.Cached.status(fc17853808)">status</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader =&gt; String" id="play.api.cache.Cached.status(fc17853808).key">key</a>: RequestHeader =&gt; String, <a title="Int" id="play.api.cache.Cached.status(fc17853808).status">status</a>: <span title="Int">Int</span>, <a title="Int" id="play.api.cache.Cached.status(fc17853808).duration">duration</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a> = <a href="#play.api.cache.Cached.empty" title="(key: play.api.mvc.RequestHeader =&gt; String)play.api.cache.Cached">empty</a><span class="delimiter">(</span><a href="#play.api.cache.Cached.status(fc17853808).key" title="play.api.mvc.RequestHeader =&gt; String">key</a><span class="delimiter">)</span>.<a href="#play.api.cache;Cached.includeStatus(ae621c190d)" title="(status: Int, duration: scala.concurrent.duration.Duration)play.api.cache.Cached">includeStatus</a><span class="delimiter">(</span><a href="#play.api.cache.Cached.status(fc17853808).status" title="Int">status</a>, <span title="(length: Long, unit: scala.concurrent.duration.TimeUnit)scala.concurrent.duration.FiniteDuration">Duration</span><span class="delimiter">(</span><a href="#play.api.cache.Cached.status(fc17853808).duration" title="=&gt; Long">duration</a>, <span title="java.util.concurrent.TimeUnit(SECONDS)">SECONDS</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Caches the specified status forever
   */</span>
  <span class="keyword">def</span> <a title="(key: play.api.mvc.RequestHeader =&gt; String, status: Int)play.api.cache.Cached" id="play.api.cache.Cached.status(2664435dcc)">status</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader =&gt; String" id="play.api.cache.Cached.status(2664435dcc).key">key</a>: RequestHeader =&gt; String, <a title="Int" id="play.api.cache.Cached.status(2664435dcc).status">status</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="#play.api.cache;Cached" title="play.api.cache.Cached">Cached</a> = <a href="#play.api.cache.Cached.empty" title="(key: play.api.mvc.RequestHeader =&gt; String)play.api.cache.Cached">empty</a><span class="delimiter">(</span><a href="#play.api.cache.Cached.status(2664435dcc).key" title="play.api.mvc.RequestHeader =&gt; String">key</a><span class="delimiter">)</span>.<a href="#play.api.cache;Cached.includeStatus(29be889a2b)" title="(status: Int)play.api.cache.Cached">includeStatus</a><span class="delimiter">(</span><a href="#play.api.cache.Cached.status(2664435dcc).status" title="Int">status</a><span class="delimiter">)</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
