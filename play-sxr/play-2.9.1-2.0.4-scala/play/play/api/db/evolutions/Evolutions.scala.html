<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>play/play/api/db/evolutions/Evolutions.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> play.api.db.evolutions

<span class="keyword">import</span> java.io._

<span class="keyword">import</span> scalax.file._
<span class="keyword">import</span> scalax.io.<span title="object scalax.io.JavaConverters">JavaConverters</span>._

<span class="keyword">import</span> play.core._

<span class="keyword">import</span> play.api._
<span class="keyword">import</span> play.api.db._
<span class="keyword">import</span> play.api.libs._
<span class="keyword">import</span> play.api.libs.<a href="../../libs/Codecs.scala.html#13287" title="object play.api.libs.Codecs">Codecs</a>._
<span class="keyword">import</span> javax.sql.DataSource
<span class="keyword">import</span> java.sql.<span class="delimiter">{</span>Statement, Date, Connection, SQLException<span class="delimiter">}</span>
<span class="keyword">import</span> scala.util.control.<span title="object scala.util.control.Exception">Exception</span>._

<span class="comment">/**
 * An SQL evolution - database changes associated with a software version.
 *
 * An evolution includes ‘up’ changes, to upgrade to to the version, as well as ‘down’ changes, to downgrade the database
 * to the previous version.
 *
 * @param revision revision number
 * @param sql_up the SQL statements for UP application
 * @param sql_down the SQL statements for DOWN application
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>evolutions<span class="delimiter">]</span> case <span class="keyword">class</span> <a title="class Evolution extends java.lang.Object with ScalaObject with Product with Serializable" id="164562">Evolution</a><a href="#164562" title="ScalaObject" class="delimiter">(</a><a title="Int" id="161648">revision</a>: <span title="Int">Int</span>, <a title="String" id="161649">sql_up</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a title="String" id="161650">sql_down</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="comment">/**
   * Revision hash, automatically computed from the SQL content.
   */</span>
  <span class="keyword">val</span> <a title="String" id="159276">hash</a> = <a href="../../libs/Codecs.scala.html#72634" title="(text: String)String">sha1</a><span class="delimiter">(</span><a href="#161650" title="=&gt; String">sql_down</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161649" title="=&gt; String">sql_up</a><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * A Script to run on the database.
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>evolutions<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait Script extends java.lang.Object" id="12735">Script</a> <span title="java.lang.Object" class="delimiter">{</span>

  <span class="comment">/**
   * Original evolution.
   */</span>
  <span class="keyword">val</span> <a title="=&gt; play.api.db.evolutions.Evolution" id="159365">evolution</a>: <a href="#164562" title="play.api.db.evolutions.Evolution">Evolution</a>

  <span class="comment">/**
   * SQL to be run.
   */</span>
  <span class="keyword">val</span> <a title="=&gt; String" id="159366">sql</a>: <span title="String">String</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * An UP Script to run on the database.
 *
 * @param evolution the original evolution
 * @param sql the SQL to be run
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>evolutions<span class="delimiter">]</span> case <span class="keyword">class</span> <a title="class UpScript extends java.lang.Object with play.api.db.evolutions.Script with ScalaObject with Product with Serializable" id="164570">UpScript</a><a href="#164570" title="ScalaObject" class="delimiter">(</a><a title="play.api.db.evolutions.Evolution" id="161453">evolution</a>: <a href="#164562" title="play.api.db.evolutions.Evolution">Evolution</a>, <a title="String" id="161454">sql</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#12735" title="play.api.db.evolutions.Script">Script</a>

<span class="comment">/**
 * A DOWN Script to run on the database.
 *
 * @param evolution the original evolution
 * @param sql the SQL to be run
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>evolutions<span class="delimiter">]</span> case <span class="keyword">class</span> <a title="class DownScript extends java.lang.Object with play.api.db.evolutions.Script with ScalaObject with Product with Serializable" id="164546">DownScript</a><a href="#164546" title="ScalaObject" class="delimiter">(</a><a title="play.api.db.evolutions.Evolution" id="161535">evolution</a>: <a href="#164562" title="play.api.db.evolutions.Evolution">Evolution</a>, <a title="String" id="161536">sql</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#12735" title="play.api.db.evolutions.Script">Script</a>

<span class="comment">/**
 * Defines Evolutions utilities functions.
 */</span>
<span class="keyword">object</span> <a title="object play.api.db.evolutions.Evolutions" id="12799">Evolutions</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="comment">/**
   * Updates a local (file-based) evolution script.
   */</span>
  <span class="keyword">def</span> <a title="(db: String, revision: Int, comment: String, ups: String, downs: String)(implicit application: play.api.Application)Unit" id="159515">updateEvolutionScript</a><span class="delimiter">(</span><a title="String" id="159534">db</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;default&quot;)" class="string">&quot;default&quot;</span>, <a title="Int" id="159535">revision</a>: <span title="Int">Int</span> = <span title="Int(1)" class="int">1</span>, <a title="String" id="159536">comment</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;Generated&quot;)" class="string">&quot;Generated&quot;</span>, <a title="String" id="159530">ups</a>: <span title="String">String</span>, <a title="String" id="159531">downs</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="play.api.Application" id="159532">application</a>: <a href="../../Application.scala.html#10686" title="play.api.Application">Application</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">import</span> play.api.libs._

    <span class="keyword">val</span> <a title="java.io.File" id="159538">evolutions</a> = <a href="#159532" title="play.api.Application">application</a>.<a href="../../Application.scala.html#67480" title="(relativePath: String)java.io.File">getFile</a><span class="delimiter">(</span><span title="java.lang.String(&quot;conf/evolutions/&quot;)" class="string">&quot;conf/evolutions/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159534" title="String">db</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159535" title="Int">revision</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.sql&quot;)" class="string">&quot;.sql&quot;</span><span class="delimiter">)</span>;
    <a href="../../libs/Files.scala.html#13332" title="object play.api.libs.Files">Files</a>.<a href="../../libs/Files.scala.html#105831" title="(path: java.io.File)scalax.file.Path">createDirectory</a><span class="delimiter">(</span><a href="#159532" title="play.api.Application">application</a>.<a href="../../Application.scala.html#67480" title="(relativePath: String)java.io.File">getFile</a><span class="delimiter">(</span><span title="java.lang.String(&quot;conf/evolutions/&quot;)" class="string">&quot;conf/evolutions/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159534" title="String">db</a><span class="delimiter">)</span><span class="delimiter">)</span>;
    <a href="../../libs/Files.scala.html#13332" title="object play.api.libs.Files">Files</a>.<a href="../../libs/Files.scala.html#105832" title="(path: java.io.File, content: String)Unit">writeFileIfChanged</a><span class="delimiter">(</span><a href="#159538" title="java.io.File">evolutions</a>,
      <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;|# --- %s
               |
               |# --- !Ups
               |%s
               |
               |# --- !Downs
               |%s
               |
               |&quot;&quot;&quot;</span>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">stripMargin</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#159536" title="String">comment</a>, <a href="#159530" title="String">ups</a>, <a href="#159531" title="String">downs</a><span class="delimiter">)</span><span class="delimiter">)</span>;
  <span class="delimiter">}</span>

  <span class="comment">// --</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sql: String)(implicit c: java.sql.Connection)java.sql.ResultSet" id="159516">executeQuery</a><span class="delimiter">(</span><a title="String" id="159559">sql</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="java.sql.Connection" id="159560">c</a>: <span title="java.sql.Connection">Connection</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#159560" title="java.sql.Connection">c</a>.<span title="()java.sql.Statement">createStatement</span>.<span title="(x$1: java.lang.String)java.sql.ResultSet">executeQuery</span><span class="delimiter">(</span><a href="#159559" title="String">sql</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sql: String)(implicit c: java.sql.Connection)Boolean" id="159517">execute</a><span class="delimiter">(</span><a title="String" id="159565">sql</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="java.sql.Connection" id="159566">c</a>: <span title="java.sql.Connection">Connection</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#159566" title="java.sql.Connection">c</a>.<span title="()java.sql.Statement">createStatement</span>.<span title="(x$1: java.lang.String)Boolean">execute</span><span class="delimiter">(</span><a href="#159565" title="String">sql</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sql: String)(implicit c: java.sql.Connection)java.sql.PreparedStatement" id="159518">prepare</a><span class="delimiter">(</span><a title="String" id="159573">sql</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="java.sql.Connection" id="159574">c</a>: <span title="java.sql.Connection">Connection</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#159574" title="java.sql.Connection">c</a>.<span title="(x$1: java.lang.String)java.sql.PreparedStatement">prepareStatement</span><span class="delimiter">(</span><a href="#159573" title="String">sql</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">// --</span>

  <span class="comment">/**
   * Resolves evolution conflicts.
   *
   * @param api the `DBApi` to use
   * @param db the database name
   * @param revision the revision to mark as resolved
   */</span>
  <span class="keyword">def</span> <a title="(api: play.api.db.DBApi, db: String, revision: Int)Unit" id="159519">resolve</a><span class="delimiter">(</span><a title="play.api.db.DBApi" id="159579">api</a>: <a href="../DB.scala.html#12569" title="play.api.db.DBApi">DBApi</a>, <a title="String" id="159580">db</a>: <span title="String">String</span>, <a title="Int" id="159581">revision</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="java.sql.Connection" id="159583">connection</a> = <a href="#159579" title="play.api.db.DBApi">api</a>.<a href="../DB.scala.html#155363" title="(name: String, autocommit: Boolean)java.sql.Connection">getConnection</a><span class="delimiter">(</span><a href="#159580" title="String">db</a>, autocommit = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#159517" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#159583" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;update play_evolutions set state = \'applied\' where state = \'applying_up\' and id = &quot;)" class="string">&quot;update play_evolutions set state = 'applied' where state = 'applying_up' and id = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159581" title="Int">revision</a><span class="delimiter">)</span>;
      <a href="#159517" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#159583" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;delete from play_evolutions where state = \'applying_down\' and id = &quot;)" class="string">&quot;delete from play_evolutions where state = 'applying_down' and id = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159581" title="Int">revision</a><span class="delimiter">)</span>;
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#159583" title="java.sql.Connection">connection</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Checks the evolutions state.
   *
   * @param api the `DBApi` to use
   * @param db the database name
   * @throws an error if the database is in an inconsistent state
   */</span>
  <span class="keyword">def</span> <a title="(api: play.api.db.DBApi, db: String)Unit" id="159520">checkEvolutionsState</a><span class="delimiter">(</span><a title="play.api.db.DBApi" id="159584">api</a>: <a href="../DB.scala.html#12569" title="play.api.db.DBApi">DBApi</a>, <a title="String" id="159585">db</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="java.sql.Connection" id="159587">connection</a> = <a href="#159584" title="play.api.db.DBApi">api</a>.<a href="../DB.scala.html#155363" title="(name: String, autocommit: Boolean)java.sql.Connection">getConnection</a><span class="delimiter">(</span><a href="#159585" title="String">db</a>, autocommit = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>

      <span class="keyword">val</span> <a title="java.sql.ResultSet" id="159588">problem</a> = <a href="#159516" title="(sql: String)(implicit c: java.sql.Connection)java.sql.ResultSet">executeQuery</a><a href="#159587" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;select id, hash, apply_script, revert_script, state, last_problem from play_evolutions where state like \'applying_%\'&quot;)" class="string">&quot;select id, hash, apply_script, revert_script, state, last_problem from play_evolutions where state like 'applying_%'&quot;</span><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#159588" title="java.sql.ResultSet">problem</a>.<span title="()Boolean">next</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Int" id="159589">revision</a> = <a href="#159588" title="java.sql.ResultSet">problem</a>.<span title="(x$1: java.lang.String)Int">getInt</span><span class="delimiter">(</span><span title="java.lang.String(&quot;id&quot;)" class="string">&quot;id&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="java.lang.String" id="159590">state</a> = <a href="#159588" title="java.sql.ResultSet">problem</a>.<span title="(x$1: java.lang.String)java.lang.String">getString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;state&quot;)" class="string">&quot;state&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="java.lang.String" id="159591">hash</a> = <a href="#159588" title="java.sql.ResultSet">problem</a>.<span title="(x$1: java.lang.String)java.lang.String">getString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;hash&quot;)" class="string">&quot;hash&quot;</span><span class="delimiter">)</span>.<span title="(x$1: Int, x$2: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <span title="Int(7)" class="int">7</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="java.lang.String" id="159592">script</a> = <a href="#159590" title="java.lang.String">state</a> <span title="java.lang.String" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="java.lang.String" class="string">&quot;applying_up&quot;</span> =&gt; <a href="#159588" title="java.sql.ResultSet">problem</a>.<span title="(x$1: java.lang.String)java.lang.String">getString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;apply_script&quot;)" class="string">&quot;apply_script&quot;</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="java.lang.String">_</span> =&gt; <a href="#159588" title="java.sql.ResultSet">problem</a>.<span title="(x$1: java.lang.String)java.lang.String">getString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;revert_script&quot;)" class="string">&quot;revert_script&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="java.lang.String" id="159593">error</a> = <a href="#159588" title="java.sql.ResultSet">problem</a>.<span title="(x$1: java.lang.String)java.lang.String">getString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;last_problem&quot;)" class="string">&quot;last_problem&quot;</span><span class="delimiter">)</span>

        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#159592" title="java.lang.String">script</a><span class="delimiter">)</span>
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#159593" title="java.lang.String">error</a><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="java.lang.String" id="159594">humanScript</a> = <span title="java.lang.String(&quot;# --- Rev:&quot;)" class="string">&quot;# --- Rev:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159589" title="Int">revision</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#159590" title="java.lang.String">state</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;applying_up&quot;)" class="string">&quot;applying_up&quot;</span><span class="delimiter">)</span> <span title="java.lang.String(&quot;Ups&quot;)" class="string">&quot;Ups&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;Downs&quot;)" class="string">&quot;Downs&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; - &quot;)" class="string">&quot; - &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159591" title="java.lang.String">hash</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012\012&quot;)" class="string">&quot;\n\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159592" title="java.lang.String">script</a>;

        <span title="Nothing" class="keyword">throw</span> <a href="#164566" title="(db: String, script: String, error: String, rev: Int)play.api.db.evolutions.InconsistentDatabase">InconsistentDatabase</a><span class="delimiter">(</span><a href="#159585" title="String">db</a>, <a href="#159594" title="java.lang.String">humanScript</a>, <a href="#159593" title="java.lang.String">error</a>, <a href="#159589" title="Int">revision</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Nothing" id="159671">e</a>: <a href="#164566" title="play.api.db.evolutions.InconsistentDatabase">InconsistentDatabase</a> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#159671" title="play.api.db.evolutions.InconsistentDatabase">e</a>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#159517" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#159587" title="java.sql.Connection" class="delimiter">(</a>
          <span title="java.lang.String(&quot;\012                    create table play_evolutions (\012                        id int not null primary key, hash varchar(255) not null, \012                        applied_at timestamp not null, \012                        apply_script text, \012                        revert_script text, \012                        state varchar(255), \012                        last_problem text\012                    )\012                &quot;)" class="string">&quot;&quot;&quot;
                    create table play_evolutions (
                        id int not null primary key, hash varchar(255) not null, 
                        applied_at timestamp not null, 
                        apply_script text, 
                        revert_script text, 
                        state varchar(255), 
                        last_problem text
                    )
                &quot;&quot;&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a title="Unit" id="159672">ex</a>: <span title="Exception">Exception</span> =&gt; play.api.<a href="../../Logger.scala.html#10951" title="object play.api.Logger">Logger</a>.<a href="../../Logger.scala.html#81619" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;play_evolutions table already existed&quot;)" class="string">&quot;play_evolutions table already existed&quot;</span><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#159587" title="java.sql.Connection">connection</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  <span class="comment">/**
   * Applies a script to the database.
   *
   * @param api the `DBApi` to use
   * @param db the database name
   * @param script the script to run
   */</span>
  <span class="keyword">def</span> <a title="(api: play.api.db.DBApi, db: String, script: Seq[play.api.db.evolutions.Script])Unit" id="159521">applyScript</a><span class="delimiter">(</span><a title="play.api.db.DBApi" id="159675">api</a>: <a href="../DB.scala.html#12569" title="play.api.db.DBApi">DBApi</a>, <a title="String" id="159676">db</a>: <span title="String">String</span>, <a title="Seq[play.api.db.evolutions.Script]" id="159677">script</a>: <span title="Seq[play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Script<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="java.sql.Connection" id="159679">connection</a> = <a href="#159675" title="play.api.db.DBApi">api</a>.<a href="../DB.scala.html#155363" title="(name: String, autocommit: Boolean)java.sql.Connection">getConnection</a><span class="delimiter">(</span><a href="#159676" title="String">db</a>, autocommit = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

    <a href="#159520" title="(api: play.api.db.DBApi, db: String)Unit">checkEvolutionsState</a><span class="delimiter">(</span><a href="#159675" title="play.api.db.DBApi">api</a>, <a href="#159676" title="String">db</a><span class="delimiter">)</span>

    <span class="keyword">var</span> <a title="Int" id="159680">applying</a> = -<span title="Int(-1)" class="int">1</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>

      <a href="#159677" title="Seq[play.api.db.evolutions.Script]">script</a>.<span title="(f: play.api.db.evolutions.Script =&gt; Boolean)Unit">foreach</span> <span class="delimiter">{</span> <a title="play.api.db.evolutions.Script" id="159697">s</a> =&gt;
        <a href="#159680" title="Int">applying</a> = <a href="#159697" title="play.api.db.evolutions.Script">s</a>.<a href="#159365" title="=&gt; play.api.db.evolutions.Evolution">evolution</a>.<a href="#161648" title="=&gt; Int">revision</a>

        <span class="comment">// Insert into log</span>
        <a href="#159697" title="play.api.db.evolutions.Script">s</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>

          <span class="keyword">case</span> <span title="Boolean">UpScript</span><span class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="159698">e</a>, _<span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="java.sql.PreparedStatement" id="159699">ps</a> = <a href="#159518" title="(sql: String)(implicit c: java.sql.Connection)java.sql.PreparedStatement">prepare</a><a href="#159679" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;insert into play_evolutions values(?, ?, ?, ?, ?, ?, ?)&quot;)" class="string">&quot;insert into play_evolutions values(?, ?, ?, ?, ?, ?, ?)&quot;</span><span class="delimiter">)</span>
            <a href="#159699" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: Int)Unit">setInt</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <a href="#159698" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161648" title="=&gt; Int">revision</a><span class="delimiter">)</span>
            <a href="#159699" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.lang.String)Unit">setString</span><span class="delimiter">(</span><span title="Int(2)" class="int">2</span>, <a href="#159698" title="play.api.db.evolutions.Evolution">e</a>.<a href="#159276" title="=&gt; String">hash</a><span class="delimiter">)</span>
            <a href="#159699" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.sql.Date)Unit">setDate</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span>, <span title="(x$1: Long)java.sql.Date" class="keyword">new</span> <span title="java.sql.Date">Date</span><span class="delimiter">(</span><span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#159699" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.lang.String)Unit">setString</span><span class="delimiter">(</span><span title="Int(4)" class="int">4</span>, <a href="#159698" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161649" title="=&gt; String">sql_up</a><span class="delimiter">)</span>
            <a href="#159699" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.lang.String)Unit">setString</span><span class="delimiter">(</span><span title="Int(5)" class="int">5</span>, <a href="#159698" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161650" title="=&gt; String">sql_down</a><span class="delimiter">)</span>
            <a href="#159699" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.lang.String)Unit">setString</span><span class="delimiter">(</span><span title="Int(6)" class="int">6</span>, <span title="java.lang.String(&quot;applying_up&quot;)" class="string">&quot;applying_up&quot;</span><span class="delimiter">)</span>
            <a href="#159699" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.lang.String)Unit">setString</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
            <a href="#159699" title="java.sql.PreparedStatement">ps</a>.<span title="()Boolean">execute</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Boolean">DownScript</span><span class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="159706">e</a>, _<span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <a href="#159517" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#159679" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;update play_evolutions set state = \'applying_down\' where id = &quot;)" class="string">&quot;update play_evolutions set state = 'applying_down' where id = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159706" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161648" title="=&gt; Int">revision</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="delimiter">}</span>

        <span class="comment">// Execute script</span>
        <a href="#159697" title="play.api.db.evolutions.Script">s</a>.<a href="#159366" title="=&gt; String">sql</a>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;;&quot;)" class="string">&quot;;&quot;</span><span class="delimiter">)</span>.<span title="(f: java.lang.String =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.String],java.lang.String,Array[java.lang.String]])Array[java.lang.String]">map</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><a href="#160154" title="java.lang.String">_</a>.<span title="()java.lang.String">trim</span><span class="delimiter">)</span>.<span title="(f: java.lang.String =&gt; AnyVal)Unit">foreach</span> <a href="#160903" title="AnyVal" class="delimiter">{</a>
          <span class="keyword">case</span> <span title="Unit" class="string">&quot;&quot;</span> =&gt;
          <span class="keyword">case</span> <a title="Boolean" id="160904">statement</a> =&gt; <a href="#159517" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#159679" title="java.sql.Connection" class="delimiter">(</a><a href="#160904" title="java.lang.String">statement</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="comment">// Insert into logs</span>
        <a href="#159697" title="play.api.db.evolutions.Script">s</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>

          <span class="keyword">case</span> <span title="Boolean">UpScript</span><span class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="160918">e</a>, _<span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <a href="#159517" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#159679" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;update play_evolutions set state = \'applied\' where id = &quot;)" class="string">&quot;update play_evolutions set state = 'applied' where id = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160918" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161648" title="=&gt; Int">revision</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Boolean">DownScript</span><span class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="160919">e</a>, _<span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <a href="#159517" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#159679" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;delete from play_evolutions where id = &quot;)" class="string">&quot;delete from play_evolutions where id = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160919" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161648" title="=&gt; Int">revision</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="delimiter">}</span>

      <span class="delimiter">}</span>

    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="160921">e</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="java.lang.String" id="160922">message</a> = <a href="#160921" title="java.lang.Throwable">e</a> <span title="java.lang.String" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="java.lang.String" id="160924">ex</a>: <span title="java.sql.SQLException">SQLException</span> =&gt; <a href="#160924" title="java.sql.SQLException">ex</a>.<span title="()java.lang.String">getMessage</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; [ERROR:&quot;)" class="string">&quot; [ERROR:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160924" title="java.sql.SQLException">ex</a>.<span title="()Int">getErrorCode</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, SQLSTATE:&quot;)" class="string">&quot;, SQLSTATE:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160924" title="java.sql.SQLException">ex</a>.<span title="()java.lang.String">getSQLState</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span>
          <span class="keyword">case</span> <a title="java.lang.String" id="160957">ex</a> =&gt; <a href="#160957" title="java.lang.Throwable">ex</a>.<span title="()java.lang.String">getMessage</span>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="java.sql.PreparedStatement" id="160923">ps</a> = <a href="#159518" title="(sql: String)(implicit c: java.sql.Connection)java.sql.PreparedStatement">prepare</a><a href="#159679" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;update play_evolutions set last_problem = ? where id = ?&quot;)" class="string">&quot;update play_evolutions set last_problem = ? where id = ?&quot;</span><span class="delimiter">)</span>
        <a href="#160923" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.lang.String)Unit">setString</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <a href="#160922" title="java.lang.String">message</a><span class="delimiter">)</span>
        <a href="#160923" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: Int)Unit">setInt</span><span class="delimiter">(</span><span title="Int(2)" class="int">2</span>, <a href="#159680" title="Int">applying</a><span class="delimiter">)</span>
        <a href="#160923" title="java.sql.PreparedStatement">ps</a>.<span title="()Boolean">execute</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#159679" title="java.sql.Connection">connection</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  <span class="comment">/**
   * Translates an evolution script to something human-readable.
   *
   * @param scripts the script
   * @return a formatted script
   */</span>
  <span class="keyword">def</span> <a title="(script: Seq[play.api.db.evolutions.Script])String" id="159522">toHumanReadableScript</a><span class="delimiter">(</span><a title="Seq[play.api.db.evolutions.Script]" id="160960">script</a>: <span title="Seq[play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Script<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="160962">txt</a> = <a href="#160960" title="Seq[play.api.db.evolutions.Script]">script</a>.<span title="(f: play.api.db.evolutions.Script =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Script],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span> <a href="#160979" title="java.lang.String" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="java.lang.String">UpScript</span><span class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="160980">ev</a>, <a title="String" id="160981">sql</a><span class="delimiter">)</span> =&gt; <span title="java.lang.String(&quot;# --- Rev:&quot;)" class="string">&quot;# --- Rev:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160980" title="play.api.db.evolutions.Evolution">ev</a>.<a href="#161648" title="=&gt; Int">revision</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;,Ups - &quot;)" class="string">&quot;,Ups - &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160980" title="play.api.db.evolutions.Evolution">ev</a>.<a href="#159276" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">hash</a>.<span title="(n: Int)String">take</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160981" title="String">sql</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>
      <span class="keyword">case</span> <span title="java.lang.String">DownScript</span><span class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="161094">ev</a>, <a title="String" id="161095">sql</a><span class="delimiter">)</span> =&gt; <span title="java.lang.String(&quot;# --- Rev:&quot;)" class="string">&quot;# --- Rev:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161094" title="play.api.db.evolutions.Evolution">ev</a>.<a href="#161648" title="=&gt; Int">revision</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;,Downs - &quot;)" class="string">&quot;,Downs - &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161094" title="play.api.db.evolutions.Evolution">ev</a>.<a href="#159276" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">hash</a>.<span title="(n: Int)String">take</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161095" title="String">sql</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>
    <span class="delimiter">}</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>

    <a href="#160960" title="Seq[play.api.db.evolutions.Script]">script</a>.<span title="(p: play.api.db.evolutions.Script =&gt; Boolean)Option[play.api.db.evolutions.Script]">find</span> <a href="#161235" title="Boolean" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Boolean(true)">DownScript</span><span class="delimiter">(</span>_, _<span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
      <span class="keyword">case</span> <span title="Boolean(false)">UpScript</span><span class="delimiter">(</span>_, _<span class="delimiter">)</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>.<span title="(f: play.api.db.evolutions.Script =&gt; java.lang.String)Option[java.lang.String]">map</span><span class="delimiter">(</span><a title="play.api.db.evolutions.Script" id="161240">_</a> =&gt; <span title="java.lang.String(&quot;# !!! WARNING! This script contains DOWNS evolutions that are likely destructives\012\012&quot;)" class="string">&quot;# !!! WARNING! This script contains DOWNS evolutions that are likely destructives\n\n&quot;</span><span class="delimiter">)</span>.<span title="(default: =&gt; java.lang.String)java.lang.String">getOrElse</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160962" title="String">txt</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Computes the evolution script.
   *
   * @param api the `DBApi` to use
   * @param applicationPath the application path
   * @param db the database name
   */</span>
  <span class="keyword">def</span> <a title="(api: play.api.db.DBApi, path: java.io.File, applicationClassloader: java.lang.ClassLoader, db: String)Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]" id="159523">evolutionScript</a><span class="delimiter">(</span><a title="play.api.db.DBApi" id="161247">api</a>: <a href="../DB.scala.html#12569" title="play.api.db.DBApi">DBApi</a>, <a title="java.io.File" id="161248">path</a>: <span title="java.io.File">File</span>, <a title="java.lang.ClassLoader" id="161249">applicationClassloader</a>: <span title="java.lang.ClassLoader">ClassLoader</span>, <a title="String" id="161250">db</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Product <span class="keyword">with</span> Serializable <span class="keyword">with</span> Script<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.Evolution]" id="161253">application</a> = <a href="#159525" title="(path: java.io.File, applicationClassloader: java.lang.ClassLoader, db: String)Seq[play.api.db.evolutions.Evolution]">applicationEvolutions</a><span class="delimiter">(</span><a href="#161248" title="java.io.File">path</a>, <a href="#161249" title="java.lang.ClassLoader">applicationClassloader</a>, <a href="#161250" title="String">db</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.Evolution]" id="161254">database</a> = <a href="#159524" title="(api: play.api.db.DBApi, db: String)Seq[play.api.db.evolutions.Evolution]">databaseEvolutions</a><span class="delimiter">(</span><a href="#161247" title="play.api.db.DBApi">api</a>, <a href="#161250" title="String">db</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a href="#161256" title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])" class="delimiter">(</a><a href="#161255" title="Seq[play.api.db.evolutions.Evolution]" id="161256">nonConflictingDowns</a>, <a href="#161255" title="Seq[play.api.db.evolutions.Evolution]" id="161257">dRest</a><span class="delimiter">)</span> = <a href="#161254" title="Seq[play.api.db.evolutions.Evolution]">database</a>.<span title="(p: play.api.db.evolutions.Evolution =&gt; Boolean)(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])">span</span><span title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution]) @unchecked" class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="161276">e</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#161253" title="Seq[play.api.db.evolutions.Evolution]">application</a>.<span title="=&gt; Option[play.api.db.evolutions.Evolution]">headOption</span>.<span title="(p: play.api.db.evolutions.Evolution =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#161276" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161648" title="=&gt; Int">revision</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="#161279" title="play.api.db.evolutions.Evolution">_</a>.<a href="#161648" title="=&gt; Int">revision</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a href="#161259" title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])" class="delimiter">(</a><a href="#161258" title="Seq[play.api.db.evolutions.Evolution]" id="161259">nonConflictingUps</a>, <a href="#161258" title="Seq[play.api.db.evolutions.Evolution]" id="161260">uRest</a><span class="delimiter">)</span> = <a href="#161253" title="Seq[play.api.db.evolutions.Evolution]">application</a>.<span title="(p: play.api.db.evolutions.Evolution =&gt; Boolean)(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])">span</span><span title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution]) @unchecked" class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="161299">e</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#161254" title="Seq[play.api.db.evolutions.Evolution]">database</a>.<span title="=&gt; Option[play.api.db.evolutions.Evolution]">headOption</span>.<span title="(p: play.api.db.evolutions.Evolution =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#161301" title="play.api.db.evolutions.Evolution">_</a>.<a href="#161648" title="=&gt; Int">revision</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#161299" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161648" title="=&gt; Int">revision</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a href="#161262" title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])" class="delimiter">(</a><a href="#161261" title="Seq[play.api.db.evolutions.Evolution]" id="161262">conflictingDowns</a>, <a href="#161261" title="Seq[play.api.db.evolutions.Evolution]" id="161263">conflictingUps</a><span class="delimiter">)</span> = <a href="#161257" title="Seq[play.api.db.evolutions.Evolution]">dRest</a>.<span title="(that: scala.collection.GenIterable[play.api.db.evolutions.Evolution])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution),Seq[(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)]])Seq[(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)]">zip</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution),Seq[(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)]]" class="delimiter">(</span><a href="#161260" title="Seq[play.api.db.evolutions.Evolution]">uRest</a><span class="delimiter">)</span>.<span title="(p: (play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution) =&gt; Boolean)Seq[(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)]">takeWhile</span> <a href="#161368" title="Boolean" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Boolean" class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="161371">down</a>, <a title="play.api.db.evolutions.Evolution" id="161372">up</a><span class="delimiter">)</span> =&gt; <a href="#161371" title="play.api.db.evolutions.Evolution">down</a>.<a href="#159276" title="=&gt; String">hash</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#161372" title="play.api.db.evolutions.Evolution">up</a>.<a href="#159276" title="=&gt; String">hash</a>
    <span class="delimiter">}</span>.<span title="(implicit asPair: (play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution) =&gt; (play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution))(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])">unzip</span>

    <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.UpScript]" id="161264">ups</a> = <span class="delimiter">(</span><a href="#161259" title="Seq[play.api.db.evolutions.Evolution]">nonConflictingUps</a> <span title="(that: scala.collection.GenTraversableOnce[play.api.db.evolutions.Evolution])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],play.api.db.evolutions.Evolution,Seq[play.api.db.evolutions.Evolution]])Seq[play.api.db.evolutions.Evolution]">++</span> <a href="#161263" title="Seq[play.api.db.evolutions.Evolution]">conflictingUps</a><span class="delimiter">)</span>.<span title="=&gt; Seq[play.api.db.evolutions.Evolution]">reverse</span>.<span title="(f: play.api.db.evolutions.Evolution =&gt; play.api.db.evolutions.UpScript)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],play.api.db.evolutions.UpScript,Seq[play.api.db.evolutions.UpScript]])Seq[play.api.db.evolutions.UpScript]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,play.api.db.evolutions.UpScript,Seq[play.api.db.evolutions.UpScript]]" class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="161452">e</a> =&gt; <a href="#164570" title="(evolution: play.api.db.evolutions.Evolution, sql: String)play.api.db.evolutions.UpScript">UpScript</a><span class="delimiter">(</span><a href="#161452" title="play.api.db.evolutions.Evolution">e</a>, <a href="#161452" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161649" title="=&gt; String">sql_up</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.DownScript]" id="161265">downs</a> = <span class="delimiter">(</span><a href="#161256" title="Seq[play.api.db.evolutions.Evolution]">nonConflictingDowns</a> <span title="(that: scala.collection.GenTraversableOnce[play.api.db.evolutions.Evolution])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],play.api.db.evolutions.Evolution,Seq[play.api.db.evolutions.Evolution]])Seq[play.api.db.evolutions.Evolution]">++</span> <a href="#161262" title="Seq[play.api.db.evolutions.Evolution]">conflictingDowns</a><span class="delimiter">)</span>.<span title="(f: play.api.db.evolutions.Evolution =&gt; play.api.db.evolutions.DownScript)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],play.api.db.evolutions.DownScript,Seq[play.api.db.evolutions.DownScript]])Seq[play.api.db.evolutions.DownScript]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,play.api.db.evolutions.DownScript,Seq[play.api.db.evolutions.DownScript]]" class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="161534">e</a> =&gt; <a href="#164546" title="(evolution: play.api.db.evolutions.Evolution, sql: String)play.api.db.evolutions.DownScript">DownScript</a><span class="delimiter">(</span><a href="#161534" title="play.api.db.evolutions.Evolution">e</a>, <a href="#161534" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161650" title="=&gt; String">sql_down</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <a href="#161265" title="Seq[play.api.db.evolutions.DownScript]">downs</a> <span title="(that: scala.collection.GenTraversableOnce[Product with Serializable with play.api.db.evolutions.Script])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.DownScript],Product with Serializable with play.api.db.evolutions.Script,Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]])Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">++</span> <a href="#161264" title="Seq[play.api.db.evolutions.UpScript]">ups</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Reads evolutions from the database.
   *
   * @param api the `DBApi` to use
   * @param db the database name
   */</span>
  <span class="keyword">def</span> <a title="(api: play.api.db.DBApi, db: String)Seq[play.api.db.evolutions.Evolution]" id="159524">databaseEvolutions</a><span class="delimiter">(</span><a title="play.api.db.DBApi" id="161270">api</a>: <a href="../DB.scala.html#12569" title="play.api.db.DBApi">DBApi</a>, <a title="String" id="161271">db</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Seq[play.api.db.evolutions.Evolution]">Seq</span><span class="delimiter">[</span>Evolution<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="java.sql.Connection" id="161620">connection</a> = <a href="#161270" title="play.api.db.DBApi">api</a>.<a href="../DB.scala.html#155363" title="(name: String, autocommit: Boolean)java.sql.Connection">getConnection</a><span class="delimiter">(</span><a href="#161271" title="String">db</a>, autocommit = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

    <a href="#159520" title="(api: play.api.db.DBApi, db: String)Unit">checkEvolutionsState</a><span class="delimiter">(</span><a href="#161270" title="play.api.db.DBApi">api</a>, <a href="#161271" title="String">db</a><span class="delimiter">)</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>

      <a href="../../libs/Collections.scala.html#13371" title="object play.api.libs.Collections">Collections</a>.<a href="../../libs/Collections.scala.html#161622" title="(seed: java.sql.ResultSet)(f: java.sql.ResultSet =&gt; Option[(java.sql.ResultSet, play.api.db.evolutions.Evolution)])Seq[play.api.db.evolutions.Evolution]">unfoldLeft</a><span class="delimiter">(</span><a href="#159516" title="(sql: String)(implicit c: java.sql.Connection)java.sql.ResultSet">executeQuery</a><a href="#161620" title="java.sql.Connection" class="delimiter">(</a>
        <span title="java.lang.String(&quot;\012                    select id, hash, apply_script, revert_script from play_evolutions order by id\012                &quot;)" class="string">&quot;&quot;&quot;
                    select id, hash, apply_script, revert_script from play_evolutions order by id
                &quot;&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="java.sql.ResultSet" id="161641">rs</a> =&gt;
        <a href="#161641" title="java.sql.ResultSet">rs</a>.<span title="()Boolean">next</span> <span title="Option[(java.sql.ResultSet, play.api.db.evolutions.Evolution)]" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="None.type" class="keyword">false</span> =&gt; <span title="object None">None</span>
          <span class="keyword">case</span> <span title="Some[(java.sql.ResultSet, play.api.db.evolutions.Evolution)]" class="keyword">true</span> =&gt; <span class="delimiter">{</span>
            <span title="(x: (java.sql.ResultSet, play.api.db.evolutions.Evolution))Some[(java.sql.ResultSet, play.api.db.evolutions.Evolution)]">Some</span><span title="(_1: java.sql.ResultSet, _2: play.api.db.evolutions.Evolution)(java.sql.ResultSet, play.api.db.evolutions.Evolution)" class="delimiter">(</span><a href="#161641" title="java.sql.ResultSet">rs</a>, <a href="#164562" title="(revision: Int, sql_up: String, sql_down: String)play.api.db.evolutions.Evolution">Evolution</a><span class="delimiter">(</span>
              <a href="#161641" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)Int">getInt</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>,
              <a href="#161641" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)java.lang.String">getString</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>,
              <a href="#161641" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)java.lang.String">getString</span><span class="delimiter">(</span><span title="Int(4)" class="int">4</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#161620" title="java.sql.Connection">connection</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Reads the evolutions from the application.
   *
   * @param db the database name
   */</span>
  <span class="keyword">def</span> <a title="(path: java.io.File, applicationClassloader: java.lang.ClassLoader, db: String)Seq[play.api.db.evolutions.Evolution]" id="159525">applicationEvolutions</a><span class="delimiter">(</span><a title="java.io.File" id="161266">path</a>: <span title="java.io.File">File</span>, <a title="java.lang.ClassLoader" id="161267">applicationClassloader</a>: <span title="java.lang.ClassLoader">ClassLoader</span>, <a title="String" id="161268">db</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Seq[play.api.db.evolutions.Evolution]">Seq</span><span class="delimiter">[</span>Evolution<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="161677">upsMarker</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;^#.*!Ups.*$&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
    <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="161678">downsMarker</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;^#.*!Downs.*$&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>

    <span class="keyword">val</span> <a title="java.lang.String" id="161679">UPS</a> = <span title="java.lang.String(&quot;UPS&quot;)" class="string">&quot;UPS&quot;</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="161680">DOWNS</a> = <span title="java.lang.String(&quot;DOWNS&quot;)" class="string">&quot;DOWNS&quot;</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="161681">UNKNOWN</a> = <span title="java.lang.String(&quot;UNKNOWN&quot;)" class="string">&quot;UNKNOWN&quot;</span>

    <span class="keyword">val</span> <a title="PartialFunction[String,String]" id="161682">mapUpsAndDowns</a>: <span title="PartialFunction[String,String]">PartialFunction</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span> = <a href="#161691" title="String" class="delimiter">{</a>
      <span class="keyword">case</span> <a href="#161677" title="java.lang.String">upsMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#161679" title="java.lang.String">UPS</a>
      <span class="keyword">case</span> <a href="#161678" title="java.lang.String">downsMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#161680" title="java.lang.String">DOWNS</a>
      <span class="keyword">case</span> <span title="java.lang.String">_</span> =&gt; <a href="#161681" title="java.lang.String">UNKNOWN</a>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="PartialFunction[String,Boolean]" id="161683">isMarker</a>: <span title="PartialFunction[String,Boolean]">PartialFunction</span><span class="delimiter">[</span>String, Boolean<span class="delimiter">]</span> = <a href="#161695" title="Boolean" class="delimiter">{</a>
      <span class="keyword">case</span> <a href="#161677" title="Boolean(true)">upsMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
      <span class="keyword">case</span> <a href="#161678" title="Boolean(true)">downsMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
      <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>

    <a href="../../libs/Collections.scala.html#13371" title="object play.api.libs.Collections">Collections</a>.<a href="../../libs/Collections.scala.html#161622" title="(seed: Int)(f: Int =&gt; Option[(Int, (Int, java.lang.String))])Seq[(Int, java.lang.String)]">unfoldLeft</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="Int" id="161707">revision</a> =&gt;
      <span title="(x: java.io.File)Option[java.io.File]">Option</span><span class="delimiter">(</span><span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#161266" title="java.io.File">path</a>, <span title="java.lang.String(&quot;conf/evolutions/&quot;)" class="string">&quot;conf/evolutions/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161268" title="String">db</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161707" title="Int">revision</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.sql&quot;)" class="string">&quot;.sql&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(p: java.io.File =&gt; Boolean)Option[java.io.File]">filter</span><span class="delimiter">(</span><a href="#161717" title="java.io.File">_</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span>.<span title="(f: java.io.File =&gt; java.io.FileInputStream)Option[java.io.FileInputStream]">map</span><span class="delimiter">(</span><span title="(x$1: java.io.File)java.io.FileInputStream" class="keyword">new</span> <span title="java.io.FileInputStream">FileInputStream</span><span class="delimiter">(</span><a href="#161722" title="java.io.File">_</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(alternative: =&gt; Option[java.io.InputStream])Option[java.io.InputStream]">orElse</span> <span class="delimiter">{</span>
        <span title="(x: java.io.InputStream)Option[java.io.InputStream]">Option</span><span class="delimiter">(</span><a href="#161267" title="java.lang.ClassLoader">applicationClassloader</a>.<span title="(x$1: java.lang.String)java.io.InputStream">getResourceAsStream</span><span class="delimiter">(</span><span title="java.lang.String(&quot;evolutions/&quot;)" class="string">&quot;evolutions/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161268" title="String">db</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161707" title="Int">revision</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.sql&quot;)" class="string">&quot;.sql&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>.<span title="(f: java.io.InputStream =&gt; (Int, (Int, java.lang.String)))Option[(Int, (Int, java.lang.String))]">map</span> <span class="delimiter">{</span> <a title="java.io.InputStream" id="161775">stream</a> =&gt;
        <span title="(_1: Int, _2: (Int, java.lang.String))(Int, (Int, java.lang.String))" class="delimiter">(</span><a href="#161707" title="Int">revision</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <span title="(_1: Int, _2: java.lang.String)(Int, java.lang.String)" class="delimiter">(</span><a href="#161707" title="Int">revision</a>, <a href="#161775" title="(src: java.io.InputStream)(implicit converter: scalax.io.JavaConverters.AsInputConverter[java.io.InputStream])scalax.io.JavaConverters.AsInput">stream</a>.<a title="scalax.io.Input" id="161803">asInput</a>.<a href="#161803" title="scalax.io.Codec" id="161804">slurpString</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>.<span title="(f: (Int, java.lang.String) =&gt; Int)(implicit ord: scala.math.Ordering[Int])Seq[(Int, java.lang.String)]">sortBy</span><span title="object scala.math.Ordering.Int" class="delimiter">(</span><a href="#161818" title="(Int, java.lang.String)">_</a>.<span title="=&gt; Int">_1</span><span class="delimiter">)</span>.<span title="(f: (Int, java.lang.String) =&gt; play.api.db.evolutions.Evolution)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Int, java.lang.String)],play.api.db.evolutions.Evolution,Seq[play.api.db.evolutions.Evolution]])Seq[play.api.db.evolutions.Evolution]">map</span> <a href="#161897" title="play.api.db.evolutions.Evolution" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="play.api.db.evolutions.Evolution" class="delimiter">(</span><a title="Int" id="161900">revision</a>, <a title="java.lang.String" id="161901">script</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>

        <span class="keyword">val</span> <a title="scala.collection.immutable.Map[java.lang.String,java.lang.String]" id="161902">parsed</a> = <a href="../../libs/Collections.scala.html#13371" title="object play.api.libs.Collections">Collections</a>.<a href="../../libs/Collections.scala.html#161622" title="(seed: (java.lang.String, List[java.lang.String]))(f: (java.lang.String, List[java.lang.String]) =&gt; Option[((java.lang.String, List[java.lang.String]), (java.lang.String, String))])Seq[(java.lang.String, String)]">unfoldLeft</a><span class="delimiter">(</span><span title="(_1: java.lang.String, _2: List[java.lang.String])(java.lang.String, List[java.lang.String])" class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a href="#161901" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">script</a>.<span title="(separator: Char)Array[String]">split</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><span title="Char(\'\\n\')" class="char">'\n'</span><span class="delimiter">)</span>.<span title="=&gt; List[String]">toList</span>.<span title="(f: String =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],java.lang.String,List[java.lang.String]])List[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,java.lang.String,List[java.lang.String]]" class="delimiter">(</span><a href="#162057" title="String">_</a>.<span title="()java.lang.String">trim</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#162095" title="Option[((String, List[java.lang.String]), (java.lang.String, String))]" class="delimiter">{</a>
          <span class="keyword">case</span> <span title="None.type" class="delimiter">(</span>_, <span title="object Nil">Nil</span><span class="delimiter">)</span> =&gt; <span title="object None">None</span>
          <span class="keyword">case</span> <span title="Some[((String, List[java.lang.String]), (java.lang.String, String))]" class="delimiter">(</span><a title="java.lang.String" id="162100">context</a>, <a title="List[java.lang.String]" id="162101">lines</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <span class="keyword">val</span> <a href="#162103" title="(List[java.lang.String], List[java.lang.String])" class="delimiter">(</a><a href="#162102" title="List[java.lang.String]" id="162103">some</a>, <a href="#162102" title="List[java.lang.String]" id="162104">next</a><span class="delimiter">)</span> = <a href="#162101" title="List[java.lang.String]">lines</a>.<span title="(p: java.lang.String =&gt; Boolean)(List[java.lang.String], List[java.lang.String])">span</span><span title="(List[java.lang.String], List[java.lang.String]) @unchecked" class="delimiter">(</span><a title="java.lang.String" id="162110">l</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#161683" title="(v1: String)Boolean">isMarker</a><span class="delimiter">(</span><a href="#162110" title="java.lang.String">l</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span title="(x: ((String, List[java.lang.String]), (java.lang.String, String)))Some[((String, List[java.lang.String]), (java.lang.String, String))]">Some</span><span class="delimiter">(</span><span title="(_1: (String, List[java.lang.String]), _2: (java.lang.String, String))((String, List[java.lang.String]), (java.lang.String, String))" class="delimiter">(</span><a href="#162104" title="List[java.lang.String]">next</a>.<span title="=&gt; Option[java.lang.String]">headOption</span>.<span title="(f: java.lang.String =&gt; (String, List[java.lang.String]))Option[(String, List[java.lang.String])]">map</span><span class="delimiter">(</span><a title="java.lang.String" id="162132">c</a> =&gt; <span title="(_1: String, _2: List[java.lang.String])(String, List[java.lang.String])" class="delimiter">(</span><a href="#161682" title="(v1: String)String">mapUpsAndDowns</a><span class="delimiter">(</span><a href="#162132" title="java.lang.String">c</a><span class="delimiter">)</span>, <a href="#162104" title="List[java.lang.String]">next</a>.<span title="=&gt; List[java.lang.String]">tail</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; (String, List[java.lang.String]))(String, List[java.lang.String])">getOrElse</span><span class="delimiter">(</span><span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;&quot;</span> <span title="(y: scala.collection.immutable.Nil.type)(java.lang.String, scala.collection.immutable.Nil.type)">-&gt;</span> <span title="object Nil">Nil</span><span class="delimiter">)</span>,
              <a href="#162100" title="(x: java.lang.String)ArrowAssoc[java.lang.String]">context</a> <span title="(y: String)(java.lang.String, String)">-&gt;</span> <a href="#162103" title="List[java.lang.String]">some</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>.<span title="=&gt; Seq[(java.lang.String, String)]">reverse</span>.<span title="(n: Int)Seq[(java.lang.String, String)]">drop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(f: (java.lang.String, String) =&gt; java.lang.String)scala.collection.immutable.Map[java.lang.String,Seq[(java.lang.String, String)]]">groupBy</span><span class="delimiter">(</span><a title="(java.lang.String, String)" id="162210">i</a> =&gt; <a href="#162210" title="(java.lang.String, String)">i</a>.<span title="=&gt; java.lang.String">_1</span><span class="delimiter">)</span>.<span title="(f: Seq[(java.lang.String, String)] =&gt; java.lang.String)scala.collection.immutable.Map[java.lang.String,java.lang.String]">mapValues</span> <span class="delimiter">{</span> <a href="#162226" title="Seq[(java.lang.String, String)]">_</a>.<span title="(f: (java.lang.String, String) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(java.lang.String, String)],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#162243" title="(java.lang.String, String)">_</a>.<span title="=&gt; String">_2</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>.<span title="()java.lang.String">trim</span> <span class="delimiter">}</span>

        <a href="#164562" title="(revision: Int, sql_up: String, sql_down: String)play.api.db.evolutions.Evolution">Evolution</a><span class="delimiter">(</span>
          <a href="#161900" title="Int">revision</a>,
          <a href="#161902" title="scala.collection.immutable.Map[java.lang.String,java.lang.String]">parsed</a>.<span title="(key: java.lang.String)Option[java.lang.String]">get</span><span class="delimiter">(</span><a href="#161679" title="java.lang.String">UPS</a><span class="delimiter">)</span>.<span title="(default: =&gt; java.lang.String)java.lang.String">getOrElse</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>,
          <a href="#161902" title="scala.collection.immutable.Map[java.lang.String,java.lang.String]">parsed</a>.<span title="(key: java.lang.String)Option[java.lang.String]">get</span><span class="delimiter">(</span><a href="#161680" title="java.lang.String">DOWNS</a><span class="delimiter">)</span>.<span title="(default: =&gt; java.lang.String)java.lang.String">getOrElse</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>.<span title="=&gt; Seq[play.api.db.evolutions.Evolution]">reverse</span>

  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Play Evolutions plugin.
 */</span>
<span class="keyword">class</span> <a title="class EvolutionsPlugin extends java.lang.Object with play.api.Plugin with ScalaObject" id="12834">EvolutionsPlugin</a><a href="#12834" title="ScalaObject" class="delimiter">(</a><a title="play.api.Application" id="162326">app</a>: <a href="../../Application.scala.html#10686" title="play.api.Application">Application</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../Plugins.scala.html#10767" title="play.api.Plugin">Plugin</a> <span class="delimiter">{</span>

  <span class="keyword">import</span> <a href="#12799" title="object play.api.db.evolutions.Evolutions">Evolutions</a>._

  <span class="comment">/**
   * Is this plugin enabled.
   *
   * {{{
   * evolutionplugin = disabled
   * }}}
   */</span>
  <span class="keyword">override</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Boolean" id="162308">enabled</a> = <a href="#162326" title="play.api.Application">app</a>.<a href="../../Application.scala.html#67468" title="=&gt; play.api.Configuration">configuration</a>.<a href="../../Configuration.scala.html#67751" title="(path: String)Option[play.api.Configuration]">getConfig</a><span class="delimiter">(</span><span title="java.lang.String(&quot;db&quot;)" class="string">&quot;db&quot;</span><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">{</span>
    <span title="=&gt; Boolean">!</span><a href="#162326" title="play.api.Application">app</a>.<a href="../../Application.scala.html#67468" title="play.api.Configuration" id="162316">configuration</a>.<a href="../../Configuration.scala.html#77639" title="Option[Set[String]]" id="162318">getString</a><span class="delimiter">(</span><a title="java.lang.String(&quot;evolutionplugin&quot;)" id="162317" class="string">&quot;evolutionplugin&quot;</a><span class="delimiter">)</span>.<span title="(p: String =&gt; Boolean)Option[String]">filter</span><span class="delimiter">(</span><a href="#162321" title="String">_</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;disabled&quot;)" class="string">&quot;disabled&quot;</span><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Checks the evolutions state.
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="162309">onStart</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.db.DBApi" id="162328">api</a> = <a href="#162326" title="play.api.Application">app</a>.<a href="../../Application.scala.html#67474" title="[T](implicit m: Manifest[T])Option[T]">plugin</a><span title="(implicit m: Manifest[play.api.db.DBPlugin])Option[play.api.db.DBPlugin]" class="delimiter">[</span><a href="../DB.scala.html#12575" title="play.api.db.DBPlugin">DBPlugin</a><span class="delimiter">]</span>.<span title="(f: play.api.db.DBPlugin =&gt; play.api.db.DBApi)Option[play.api.db.DBApi]">map</span><span class="delimiter">(</span><a href="#162354" title="play.api.db.DBPlugin">_</a>.<a href="../DB.scala.html#155856" title="=&gt; play.api.db.DBApi">api</a><span class="delimiter">)</span>.<span title="(default: =&gt; play.api.db.DBApi)play.api.db.DBApi">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.Exception" class="keyword">new</span> <span title="java.lang.Exception">Exception</span><span class="delimiter">(</span><span title="java.lang.String(&quot;there should be a database plugin registered at this point but looks like it\'s not available, so evolution won\'t work. Please make sure you register a db plugin properly&quot;)" class="string">&quot;there should be a database plugin registered at this point but looks like it's not available, so evolution won't work. Please make sure you register a db plugin properly&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#162328" title="play.api.db.DBApi">api</a>.<a href="../DB.scala.html#155359" title="=&gt; List[(javax.sql.DataSource, String)]">datasources</a>.<span title="(f: (javax.sql.DataSource, String) =&gt; Unit)Unit">foreach</span> <a href="#162384" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="javax.sql.DataSource" id="162387">ds</a>, <a title="String" id="162388">db</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#162310" title="(ds: javax.sql.DataSource)(block: =&gt; Unit)Unit">withLock</a><span class="delimiter">(</span><a href="#162387" title="javax.sql.DataSource">ds</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]" id="162392">script</a> = <a href="#159523" title="(api: play.api.db.DBApi, path: java.io.File, applicationClassloader: java.lang.ClassLoader, db: String)Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">evolutionScript</a><span class="delimiter">(</span><a href="#162328" title="play.api.db.DBApi">api</a>, <a href="#162326" title="play.api.Application">app</a>.<a href="../../Application.scala.html#67447" title="=&gt; java.io.File">path</a>, <a href="#162326" title="play.api.Application">app</a>.<a href="../../Application.scala.html#67449" title="=&gt; java.lang.ClassLoader">classloader</a>, <a href="#162388" title="String">db</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#162392" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#162326" title="play.api.Application">app</a>.<a href="../../Application.scala.html#67453" title="=&gt; play.api.Mode.Mode">mode</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a href="../../Play.scala.html#10864" title="Unit">Mode</a>.<a href="../../Play.scala.html#67655" title="=&gt; play.api.Mode.Value">Test</a> =&gt; <a href="#12799" title="object play.api.db.evolutions.Evolutions">Evolutions</a>.<a href="#159521" title="(api: play.api.db.DBApi, db: String, script: Seq[play.api.db.evolutions.Script])Unit">applyScript</a><span class="delimiter">(</span><a href="#162328" title="play.api.db.DBApi">api</a>, <a href="#162388" title="String">db</a>, <a href="#162392" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../../Play.scala.html#10864" title="Unit">Mode</a>.<a href="../../Play.scala.html#67651" title="=&gt; play.api.Mode.Value">Dev</a> <span class="keyword">if</span> <a href="#162326" title="play.api.Application">app</a>.<a href="../../Application.scala.html#67468" title="=&gt; play.api.Configuration">configuration</a>.<a href="../../Configuration.scala.html#67748" title="(path: String)Option[Boolean]">getBoolean</a><span class="delimiter">(</span><span title="java.lang.String(&quot;applyEvolutions.&quot;)" class="string">&quot;applyEvolutions.&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#162388" title="String">db</a><span class="delimiter">)</span>.<span title="(p: Boolean =&gt; Boolean)Option[Boolean]">filter</span><span class="delimiter">(</span><a href="#162395" title="Boolean">_</a> <span title="(x: Boolean)Boolean">==</span> <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span> =&gt; <a href="#12799" title="object play.api.db.evolutions.Evolutions">Evolutions</a>.<a href="#159521" title="(api: play.api.db.DBApi, db: String, script: Seq[play.api.db.evolutions.Script])Unit">applyScript</a><span class="delimiter">(</span><a href="#162328" title="play.api.db.DBApi">api</a>, <a href="#162388" title="String">db</a>, <a href="#162392" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../../Play.scala.html#10864" title="Unit">Mode</a>.<a href="../../Play.scala.html#67653" title="=&gt; play.api.Mode.Value">Prod</a> <span class="keyword">if</span> <a href="#162326" title="play.api.Application">app</a>.<a href="../../Application.scala.html#67468" title="=&gt; play.api.Configuration">configuration</a>.<a href="../../Configuration.scala.html#67748" title="(path: String)Option[Boolean]">getBoolean</a><span class="delimiter">(</span><span title="java.lang.String(&quot;applyEvolutions.&quot;)" class="string">&quot;applyEvolutions.&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#162388" title="String">db</a><span class="delimiter">)</span>.<span title="(p: Boolean =&gt; Boolean)Option[Boolean]">filter</span><span class="delimiter">(</span><a href="#162401" title="Boolean">_</a> <span title="(x: Boolean)Boolean">==</span> <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span> =&gt; <a href="#12799" title="object play.api.db.evolutions.Evolutions">Evolutions</a>.<a href="#159521" title="(api: play.api.db.DBApi, db: String, script: Seq[play.api.db.evolutions.Script])Unit">applyScript</a><span class="delimiter">(</span><a href="#162328" title="play.api.db.DBApi">api</a>, <a href="#162388" title="String">db</a>, <a href="#162392" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../../Play.scala.html#10864" title="Nothing">Mode</a>.<a href="../../Play.scala.html#67653" title="=&gt; play.api.Mode.Value">Prod</a> =&gt; <span class="delimiter">{</span>
                <a href="../../Logger.scala.html#81627" title="(name: String)play.api.Logger">Logger</a><span class="delimiter">(</span><span title="java.lang.String(&quot;play&quot;)" class="string">&quot;play&quot;</span><span class="delimiter">)</span>.<a href="../../Logger.scala.html#81619" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Your production database [&quot;)" class="string">&quot;Your production database [&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#162388" title="String">db</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;] needs evolutions! \012\012&quot;)" class="string">&quot;] needs evolutions! \n\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159522" title="(script: Seq[play.api.db.evolutions.Script])String">toHumanReadableScript</a><span class="delimiter">(</span><a href="#162392" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="../../Logger.scala.html#81627" title="(name: String)play.api.Logger">Logger</a><span class="delimiter">(</span><span title="java.lang.String(&quot;play&quot;)" class="string">&quot;play&quot;</span><span class="delimiter">)</span>.<a href="../../Logger.scala.html#81619" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Run with -DapplyEvolutions.&quot;)" class="string">&quot;Run with -DapplyEvolutions.&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#162388" title="String">db</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;=true if you want to run them automatically (be careful)&quot;)" class="string">&quot;=true if you want to run them automatically (be careful)&quot;</span><span class="delimiter">)</span>

                <span title="Nothing" class="keyword">throw</span> <a href="#164550" title="(db: String, script: String)play.api.db.evolutions.InvalidDatabaseRevision">InvalidDatabaseRevision</a><span class="delimiter">(</span><a href="#162388" title="String">db</a>, <a href="#159522" title="(script: Seq[play.api.db.evolutions.Script])String">toHumanReadableScript</a><span class="delimiter">(</span><a href="#162392" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
              <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#164550" title="(db: String, script: String)play.api.db.evolutions.InvalidDatabaseRevision">InvalidDatabaseRevision</a><span class="delimiter">(</span><a href="#162388" title="String">db</a>, <a href="#159522" title="(script: Seq[play.api.db.evolutions.Script])String">toHumanReadableScript</a><span class="delimiter">(</span><a href="#162392" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(ds: javax.sql.DataSource)(block: =&gt; Unit)Unit" id="162310">withLock</a><span class="delimiter">(</span><a title="javax.sql.DataSource" id="162389">ds</a>: <span title="javax.sql.DataSource">DataSource</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; Unit" id="162390">block</a>: =&gt; Unit<span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#162326" title="play.api.Application">app</a>.<a href="../../Application.scala.html#67468" title="=&gt; play.api.Configuration">configuration</a>.<a href="../../Configuration.scala.html#67748" title="(path: String)Option[Boolean]">getBoolean</a><span class="delimiter">(</span><span title="java.lang.String(&quot;evolutions.use.locks&quot;)" class="string">&quot;evolutions.use.locks&quot;</span><span class="delimiter">)</span>.<span title="(p: Boolean =&gt; Boolean)Option[Boolean]">filter</span><span class="delimiter">(</span><a href="#162460" title="Boolean">_</a> <span title="(x: Boolean)Boolean">==</span> <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.sql.Connection" id="162465">c</a> = <a href="#162389" title="javax.sql.DataSource">ds</a>.<span title="()java.sql.Connection">getConnection</span>
      <a href="#162465" title="java.sql.Connection">c</a>.<span title="(x$1: Boolean)Unit">setAutoCommit</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.sql.Statement" id="162466">s</a> = <a href="#162465" title="java.sql.Connection">c</a>.<span title="()java.sql.Statement">createStatement</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#162311" title="(c: java.sql.Connection, s: java.sql.Statement)Unit">createLockTableIfNecessary</a><span class="delimiter">(</span><a href="#162465" title="java.sql.Connection">c</a>, <a href="#162466" title="java.sql.Statement">s</a><span class="delimiter">)</span>
      <a href="#162312" title="(c: java.sql.Connection, s: java.sql.Statement, attempts: Int)Unit">lock</a><span class="delimiter">(</span><a href="#162465" title="java.sql.Connection">c</a>, <a href="#162466" title="java.sql.Statement">s</a><span class="delimiter">)</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#162390" title="=&gt; Unit">block</a>
      <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
        <a href="#162313" title="(c: java.sql.Connection, s: java.sql.Statement)Unit">unlock</a><span class="delimiter">(</span><a href="#162465" title="java.sql.Connection">c</a>, <a href="#162466" title="java.sql.Statement">s</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#162390" title="=&gt; Unit">block</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(c: java.sql.Connection, s: java.sql.Statement)Unit" id="162311">createLockTableIfNecessary</a><span class="delimiter">(</span><a title="java.sql.Connection" id="162471">c</a>: <span title="java.sql.Connection">Connection</span>, <a title="java.sql.Statement" id="162472">s</a>: <span title="java.sql.Statement">Statement</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.sql.ResultSet" id="162484">r</a> = <a href="#162472" title="java.sql.Statement">s</a>.<span title="(x$1: java.lang.String)java.sql.ResultSet">executeQuery</span><span class="delimiter">(</span><span title="java.lang.String(&quot;select lock from play_evolutions_lock&quot;)" class="string">&quot;select lock from play_evolutions_lock&quot;</span><span class="delimiter">)</span>
      <a href="#162484" title="java.sql.ResultSet">r</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="162485">e</a>: <span title="java.sql.SQLException">SQLException</span> =&gt;
        <a href="#162471" title="java.sql.Connection">c</a>.<span title="()Unit">rollback</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#162472" title="java.sql.Statement">s</a>.<span title="(x$1: java.lang.String)Boolean">execute</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012        create table play_evolutions_lock (\012          lock int not null primary key\012        )\012        &quot;)" class="string">&quot;&quot;&quot;
        create table play_evolutions_lock (
          lock int not null primary key
        )
        &quot;&quot;&quot;</span><span class="delimiter">)</span>
        <a href="#162472" title="java.sql.Statement">s</a>.<span title="(x$1: java.lang.String)Int">executeUpdate</span><span title="Unit" class="delimiter">(</span><span title="java.lang.String(&quot;insert into play_evolutions_lock (lock) values (1)&quot;)" class="string">&quot;insert into play_evolutions_lock (lock) values (1)&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(c: java.sql.Connection, s: java.sql.Statement, attempts: Int)Unit" id="162312">lock</a><span class="delimiter">(</span><a title="java.sql.Connection" id="162474">c</a>: <span title="java.sql.Connection">Connection</span>, <a title="java.sql.Statement" id="162475">s</a>: <span title="java.sql.Statement">Statement</span>, <a title="Int" id="162478">attempts</a>: <span title="Int">Int</span> = <span title="Int(5)" class="int">5</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#162475" title="java.sql.Statement">s</a>.<span title="(x$1: java.lang.String)java.sql.ResultSet">executeQuery</span><span title="Unit" class="delimiter">(</span><span title="java.lang.String(&quot;select lock from play_evolutions_lock where lock = 1 for update nowait&quot;)" class="string">&quot;select lock from play_evolutions_lock where lock = 1 for update nowait&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="162492">e</a>: <span title="java.sql.SQLException">SQLException</span> =&gt;
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#162478" title="Int">attempts</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <a href="#162492" title="java.sql.SQLException">e</a>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="../../Logger.scala.html#81627" title="(name: String)play.api.Logger">Logger</a><span class="delimiter">(</span><span title="java.lang.String(&quot;play&quot;)" class="string">&quot;play&quot;</span><span class="delimiter">)</span>.<a href="../../Logger.scala.html#81619" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Exception while attempting to lock evolutions (other node probably has lock), sleeping for 1 sec&quot;)" class="string">&quot;Exception while attempting to lock evolutions (other node probably has lock), sleeping for 1 sec&quot;</span><span class="delimiter">)</span>
          <a href="#162474" title="java.sql.Connection">c</a>.<span title="()Unit">rollback</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(1000L)" class="int">1000</span><span class="delimiter">)</span>
          <a href="#162312" title="(c: java.sql.Connection, s: java.sql.Statement, attempts: Int)Unit">lock</a><span class="delimiter">(</span><a href="#162474" title="java.sql.Connection">c</a>, <a href="#162475" title="java.sql.Statement">s</a>, <a href="#162478" title="Int">attempts</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(c: java.sql.Connection, s: java.sql.Statement)Unit" id="162313">unlock</a><span class="delimiter">(</span><a title="java.sql.Connection" id="162481">c</a>: <span title="java.sql.Connection">Connection</span>, <a title="java.sql.Statement" id="162482">s</a>: <span title="java.sql.Statement">Statement</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="(exceptions: Class[_]*)util.control.Exception.Catch[Unit]">ignoring</span><span title="(body: =&gt; Unit)Unit" class="delimiter">(</span>classOf<span title="java.lang.Class[java.sql.SQLException](classOf[java.sql.SQLException])" class="delimiter">[</span>SQLException<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#162482" title="java.sql.Statement">s</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="(exceptions: Class[_]*)util.control.Exception.Catch[Unit]">ignoring</span><span title="(body: =&gt; Unit)Unit" class="delimiter">(</span>classOf<span title="java.lang.Class[java.sql.SQLException](classOf[java.sql.SQLException])" class="delimiter">[</span>SQLException<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#162481" title="java.sql.Connection">c</a>.<span title="()Unit">commit</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="(exceptions: Class[_]*)util.control.Exception.Catch[Unit]">ignoring</span><span title="(body: =&gt; Unit)Unit" class="delimiter">(</span>classOf<span title="java.lang.Class[java.sql.SQLException](classOf[java.sql.SQLException])" class="delimiter">[</span>SQLException<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#162481" title="java.sql.Connection">c</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Can be used to run off-line evolutions, i.e. outside a running application.
 */</span>
<span class="keyword">object</span> <a title="object play.api.db.evolutions.OfflineEvolutions" id="12892">OfflineEvolutions</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="comment">/**
   * Computes and applies an evolutions script.
   *
   * @param classloader the classloader used to load the driver
   * @param dbName the database name
   */</span>
  <span class="keyword">def</span> <a title="(appPath: java.io.File, classloader: java.lang.ClassLoader, dbName: String)Unit" id="72201">applyScript</a><span class="delimiter">(</span><a title="java.io.File" id="72203">appPath</a>: <span title="java.io.File">File</span>, <a title="java.lang.ClassLoader" id="72204">classloader</a>: <span title="java.lang.ClassLoader">ClassLoader</span>, <a title="String" id="72205">dbName</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>

    <span class="keyword">import</span> play.api._

    <span class="keyword">val</span> <a title="play.api.Configuration" id="163103">c</a> = <a href="../../Configuration.scala.html#10960" title="object play.api.Configuration">Configuration</a>.<a href="../../Configuration.scala.html#67761" title="(appPath: java.io.File, mode: play.api.Mode.Mode)play.api.Configuration">load</a><span class="delimiter">(</span><a href="#72203" title="java.io.File">appPath</a><span class="delimiter">)</span>.<a href="../../Configuration.scala.html#67751" title="(path: String)Option[play.api.Configuration]">getConfig</a><span class="delimiter">(</span><span title="java.lang.String(&quot;db&quot;)" class="string">&quot;db&quot;</span><span class="delimiter">)</span>.<span title="=&gt; play.api.Configuration">get</span>

    <span class="keyword">val</span> <a title="play.api.db.BoneCPApi" id="163104">dbApi</a> = <span title="play.api.db.BoneCPApi" class="keyword">new</span> <a href="../DB.scala.html#12665" title="play.api.db.BoneCPApi">BoneCPApi</a><span class="delimiter">(</span><a href="#163103" title="play.api.Configuration">c</a>, <a href="#72204" title="java.lang.ClassLoader">classloader</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]" id="163105">script</a> = <a href="#12799" title="object play.api.db.evolutions.Evolutions">Evolutions</a>.<a href="#159523" title="(api: play.api.db.DBApi, path: java.io.File, applicationClassloader: java.lang.ClassLoader, db: String)Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">evolutionScript</a><span class="delimiter">(</span><a href="#163104" title="play.api.db.BoneCPApi">dbApi</a>, <a href="#72203" title="java.io.File">appPath</a>, <a href="#72204" title="java.lang.ClassLoader">classloader</a>, <a href="#72205" title="String">dbName</a><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="../../Play.scala.html#10906" title="object play.api.Play">Play</a>.<a href="../../Play.scala.html#71744" title="=&gt; Option[play.api.Application]">maybeApplication</a>.<span title="(p: play.api.Application =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#163108" title="play.api.Application">_</a>.<a href="../../Application.scala.html#67453" title="=&gt; play.api.Mode.Mode">mode</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../Play.scala.html#10864" title="object play.api.Mode">Mode</a>.<a href="../../Play.scala.html#67655" title="=&gt; play.api.Mode.Value">Test</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../Logger.scala.html#81627" title="(name: String)play.api.Logger">Logger</a><span class="delimiter">(</span><span title="java.lang.String(&quot;play&quot;)" class="string">&quot;play&quot;</span><span class="delimiter">)</span>.<a href="../../Logger.scala.html#81619" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Applying evolution script for database \'&quot;)" class="string">&quot;Applying evolution script for database '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#72205" title="String">dbName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\':\012\012&quot;)" class="string">&quot;':\n\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#12799" title="object play.api.db.evolutions.Evolutions">Evolutions</a>.<a href="#159522" title="(script: Seq[play.api.db.evolutions.Script])String">toHumanReadableScript</a><span class="delimiter">(</span><a href="#163105" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#12799" title="object play.api.db.evolutions.Evolutions">Evolutions</a>.<a href="#159521" title="(api: play.api.db.DBApi, db: String, script: Seq[play.api.db.evolutions.Script])Unit">applyScript</a><span class="delimiter">(</span><a href="#163104" title="play.api.db.BoneCPApi">dbApi</a>, <a href="#72205" title="String">dbName</a>, <a href="#163105" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span>

  <span class="delimiter">}</span>

  <span class="comment">/**
   * Resolve an inconsistent evolution..
   *
   * @param classloader the classloader used to load the driver
   * @param dbName the database name
   */</span>
  <span class="keyword">def</span> <a title="(appPath: java.io.File, classloader: java.lang.ClassLoader, dbName: String, revision: Int)Unit" id="72202">resolve</a><span class="delimiter">(</span><a title="java.io.File" id="163127">appPath</a>: <span title="java.io.File">File</span>, <a title="java.lang.ClassLoader" id="163128">classloader</a>: <span title="java.lang.ClassLoader">ClassLoader</span>, <a title="String" id="163129">dbName</a>: <span title="String">String</span>, <a title="Int" id="163130">revision</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span>

    <span class="keyword">import</span> play.api._

    <span class="keyword">val</span> <a title="play.api.Configuration" id="163133">c</a> = <a href="../../Configuration.scala.html#10960" title="object play.api.Configuration">Configuration</a>.<a href="../../Configuration.scala.html#67761" title="(appPath: java.io.File, mode: play.api.Mode.Mode)play.api.Configuration">load</a><span class="delimiter">(</span><a href="#163127" title="java.io.File">appPath</a><span class="delimiter">)</span>.<a href="../../Configuration.scala.html#67751" title="(path: String)Option[play.api.Configuration]">getConfig</a><span class="delimiter">(</span><span title="java.lang.String(&quot;db&quot;)" class="string">&quot;db&quot;</span><span class="delimiter">)</span>.<span title="=&gt; play.api.Configuration">get</span>

    <span class="keyword">val</span> <a title="play.api.db.BoneCPApi" id="163134">dbApi</a> = <span title="play.api.db.BoneCPApi" class="keyword">new</span> <a href="../DB.scala.html#12665" title="play.api.db.BoneCPApi">BoneCPApi</a><span class="delimiter">(</span><a href="#163133" title="play.api.Configuration">c</a>, <a href="#163128" title="java.lang.ClassLoader">classloader</a><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="../../Play.scala.html#10906" title="object play.api.Play">Play</a>.<a href="../../Play.scala.html#71744" title="=&gt; Option[play.api.Application]">maybeApplication</a>.<span title="(p: play.api.Application =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#163136" title="play.api.Application">_</a>.<a href="../../Application.scala.html#67453" title="=&gt; play.api.Mode.Mode">mode</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../Play.scala.html#10864" title="object play.api.Mode">Mode</a>.<a href="../../Play.scala.html#67655" title="=&gt; play.api.Mode.Value">Test</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../Logger.scala.html#81627" title="(name: String)play.api.Logger">Logger</a><span class="delimiter">(</span><span title="java.lang.String(&quot;play&quot;)" class="string">&quot;play&quot;</span><span class="delimiter">)</span>.<a href="../../Logger.scala.html#81619" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Resolving evolution [&quot;)" class="string">&quot;Resolving evolution [&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#163130" title="Int">revision</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;] for database \'&quot;)" class="string">&quot;] for database '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#163129" title="String">dbName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\'&quot;)" class="string">&quot;'&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#12799" title="object play.api.db.evolutions.Evolutions">Evolutions</a>.<a href="#159519" title="(api: play.api.db.DBApi, db: String, revision: Int)Unit">resolve</a><span class="delimiter">(</span><a href="#163134" title="play.api.db.BoneCPApi">dbApi</a>, <a href="#163129" title="String">dbName</a>, <a href="#163130" title="Int">revision</a><span class="delimiter">)</span>

  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Exception thrown when the database is not up to date.
 *
 * @param db the database name
 * @param script the script to be run to resolve the conflict.
 */</span>
case <span class="keyword">class</span> <a title="class InvalidDatabaseRevision extends play.api.PlayException with play.api.PlayException.ExceptionAttachment with play.api.PlayException.RichDescription with ScalaObject with Product with Serializable" id="164550">InvalidDatabaseRevision</a><a href="#164550" title="ScalaObject" class="delimiter">(</a><a title="String" id="162451">db</a>: <span title="String">String</span>, <a title="String" id="162452">script</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../Exceptions.scala.html#10962" title="play.api.PlayException">PlayException</a><span class="delimiter">(</span>
  <span title="java.lang.String(&quot;Database \'&quot;)" class="string">&quot;Database '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#162451" title="String">db</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\' needs evolution!&quot;)" class="string">&quot;' needs evolution!&quot;</span>,
  <span title="java.lang.String(&quot;An SQL script need to be run on your database.&quot;)" class="string">&quot;An SQL script need to be run on your database.&quot;</span>,
  <span title="object None">None</span><span class="delimiter">)</span> <span class="keyword">with</span> PlayException.<a href="../../Exceptions.scala.html#81025" title="play.api.PlayException.ExceptionAttachment">ExceptionAttachment</a> <span class="keyword">with</span> PlayException.<a href="../../Exceptions.scala.html#81026" title="play.api.PlayException.RichDescription">RichDescription</a> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="162444">subTitle</a> = <span title="java.lang.String(&quot;This SQL script must be run:&quot;)" class="string">&quot;This SQL script must be run:&quot;</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="162445">content</a> = <a href="#162452" title="=&gt; String">script</a>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="162446">javascript</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;
        document.location = '/@evolutions/apply/%s?redirect=' + encodeURIComponent(location)
    &quot;&quot;&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#162451" title="=&gt; String">db</a><span class="delimiter">)</span>.<span title="()java.lang.String">trim</span>

  <span class="keyword">def</span> <a title="=&gt; String" id="162448">htmlDescription</a> = <span class="delimiter">{</span>

    &lt;<a title="scala.xml.NodeBuffer" id="163434">span</a>&gt;<span title="scala.xml.Text">An</span> SQL script will be run on your database -&lt;/span&gt;
    &lt;<a title="scala.xml.MetaData" id="163587">input</a> name=<span title="scala.xml.Text" class="string">&quot;evolution-button&quot;</span> <span class="keyword">type</span>=<span title="scala.xml.Text" class="string">&quot;button&quot;</span> value=<span title="scala.xml.Text" class="string">&quot;Apply this script now!&quot;</span> onclick=<span class="delimiter">{</span> <a href="#162446" title="=&gt; java.lang.String">javascript</a> <span class="delimiter">}</span>/&gt;

  <span class="delimiter">}</span>.<span title="(f: scala.xml.Node =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[scala.xml.Node],String,scala.collection.mutable.ArrayBuffer[String]])scala.collection.mutable.ArrayBuffer[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,String,scala.collection.mutable.ArrayBuffer[String]]" class="delimiter">(</span><a href="#163737" title="scala.xml.Node">_</a>.<span title="()String">toString</span><span class="delimiter">)</span>.<span title="=&gt; String">mkString</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Exception thrown when the database is in inconsistent state.
 *
 * @param db the database name
 */</span>
case <span class="keyword">class</span> <a title="class InconsistentDatabase extends play.api.PlayException with play.api.PlayException.ExceptionAttachment with play.api.PlayException.RichDescription with ScalaObject with Product with Serializable" id="164566">InconsistentDatabase</a><a href="#164566" title="ScalaObject" class="delimiter">(</a><a title="String" id="159658">db</a>: <span title="String">String</span>, <a title="String" id="159659">script</a>: <span title="String">String</span>, <a title="String" id="159660">error</a>: <span title="String">String</span>, <a title="Int" id="159661">rev</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../Exceptions.scala.html#10962" title="play.api.PlayException">PlayException</a><span class="delimiter">(</span>
  <span title="java.lang.String(&quot;Database \'&quot;)" class="string">&quot;Database '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159658" title="String">db</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\' is in inconsistent state!&quot;)" class="string">&quot;' is in inconsistent state!&quot;</span>,
  <span title="java.lang.String(&quot;An evolution has not been applied properly. Please check the problem and resolve it manually before marking it as resolved.&quot;)" class="string">&quot;An evolution has not been applied properly. Please check the problem and resolve it manually before marking it as resolved.&quot;</span>,
  <span title="object None">None</span><span class="delimiter">)</span> <span class="keyword">with</span> PlayException.<a href="../../Exceptions.scala.html#81025" title="play.api.PlayException.ExceptionAttachment">ExceptionAttachment</a> <span class="keyword">with</span> PlayException.<a href="../../Exceptions.scala.html#81026" title="play.api.PlayException.RichDescription">RichDescription</a> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="159651">subTitle</a> = <span title="java.lang.String(&quot;We got the following error: &quot;)" class="string">&quot;We got the following error: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159660" title="=&gt; String">error</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, while trying to run this SQL script:&quot;)" class="string">&quot;, while trying to run this SQL script:&quot;</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="159652">content</a> = <a href="#159659" title="=&gt; String">script</a>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="159653">javascript</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;
        document.location = '/@evolutions/resolve/%s/%s?redirect=' + encodeURIComponent(location)
    &quot;&quot;&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#159658" title="=&gt; String">db</a>, <a href="#159661" title="=&gt; Int">rev</a><span class="delimiter">)</span>.<span title="()java.lang.String">trim</span>

  <span class="keyword">def</span> <a title="=&gt; String" id="159655">htmlDescription</a>: <span title="String">String</span> = <span class="delimiter">{</span>

    &lt;<a title="scala.xml.NodeBuffer" id="164381">span</a>&gt;<span title="scala.xml.Text">An</span> evolution has not been applied properly. Please check the problem and resolve it manually before making it as resolved -&lt;/span&gt;
    &lt;<a title="scala.xml.MetaData" id="164382">input</a> name=<span title="scala.xml.Text" class="string">&quot;evolution-button&quot;</span> <span class="keyword">type</span>=<span title="scala.xml.Text" class="string">&quot;button&quot;</span> value=<span title="scala.xml.Text" class="string">&quot;Mark it resolved&quot;</span> onclick=<span class="delimiter">{</span> <a href="#159653" title="=&gt; java.lang.String">javascript</a> <span class="delimiter">}</span>/&gt;

  <span class="delimiter">}</span>.<span title="(f: scala.xml.Node =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[scala.xml.Node],String,scala.collection.mutable.ArrayBuffer[String]])scala.collection.mutable.ArrayBuffer[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,String,scala.collection.mutable.ArrayBuffer[String]]" class="delimiter">(</span><a href="#164418" title="scala.xml.Node">_</a>.<span title="()String">toString</span><span class="delimiter">)</span>.<span title="=&gt; String">mkString</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>