<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>play/play/api/db/evolutions/Evolutions.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> play.api.db.evolutions

<span class="keyword">import</span> java.io._

<span class="keyword">import</span> scalax.file._
<span class="keyword">import</span> scalax.io.<span title="object scalax.io.JavaConverters">JavaConverters</span>._

<span class="keyword">import</span> play.core._

<span class="keyword">import</span> play.api._
<span class="keyword">import</span> play.api.db._
<span class="keyword">import</span> play.api.libs._
<span class="keyword">import</span> play.api.libs.<a href="../../libs/Codecs.scala.html#13055" title="object play.api.libs.Codecs">Codecs</a>._
<span class="keyword">import</span> javax.sql.DataSource
<span class="keyword">import</span> java.sql.<span class="delimiter">{</span>Statement, Date, Connection, SQLException<span class="delimiter">}</span>
<span class="keyword">import</span> scala.util.control.<span title="object scala.util.control.Exception">Exception</span>._

<span class="comment">/**
 * An SQL evolution - database changes associated with a software version.
 *
 * An evolution includes ‘up’ changes, to upgrade to to the version, as well as ‘down’ changes, to downgrade the database
 * to the previous version.
 *
 * @param revision revision number
 * @param sql_up the SQL statements for UP application
 * @param sql_down the SQL statements for DOWN application
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>evolutions<span class="delimiter">]</span> case <span class="keyword">class</span> <a title="class Evolution extends java.lang.Object with ScalaObject with Product with Serializable" id="163977">Evolution</a><a href="#163977" title="ScalaObject" class="delimiter">(</a><a title="Int" id="161256">revision</a>: <span title="Int">Int</span>, <a title="String" id="161257">sql_up</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a title="String" id="161258">sql_down</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="comment">/**
   * Revision hash, automatically computed from the SQL content.
   */</span>
  <span class="keyword">val</span> <a title="String" id="158884">hash</a> = <a href="../../libs/Codecs.scala.html#73635" title="(text: String)String">sha1</a><span class="delimiter">(</span><a href="#161258" title="=&gt; String">sql_down</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161257" title="=&gt; String">sql_up</a><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * A Script to run on the database.
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>evolutions<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait Script extends java.lang.Object" id="12503">Script</a> <span title="java.lang.Object" class="delimiter">{</span>

  <span class="comment">/**
   * Original evolution.
   */</span>
  <span class="keyword">val</span> <a title="=&gt; play.api.db.evolutions.Evolution" id="158973">evolution</a>: <a href="#163977" title="play.api.db.evolutions.Evolution">Evolution</a>

  <span class="comment">/**
   * SQL to be run.
   */</span>
  <span class="keyword">val</span> <a title="=&gt; String" id="158974">sql</a>: <span title="String">String</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * An UP Script to run on the database.
 *
 * @param evolution the original evolution
 * @param sql the SQL to be run
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>evolutions<span class="delimiter">]</span> case <span class="keyword">class</span> <a title="class UpScript extends java.lang.Object with play.api.db.evolutions.Script with ScalaObject with Product with Serializable" id="163985">UpScript</a><a href="#163985" title="ScalaObject" class="delimiter">(</a><a title="play.api.db.evolutions.Evolution" id="161061">evolution</a>: <a href="#163977" title="play.api.db.evolutions.Evolution">Evolution</a>, <a title="String" id="161062">sql</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#12503" title="play.api.db.evolutions.Script">Script</a>

<span class="comment">/**
 * A DOWN Script to run on the database.
 *
 * @param evolution the original evolution
 * @param sql the SQL to be run
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>evolutions<span class="delimiter">]</span> case <span class="keyword">class</span> <a title="class DownScript extends java.lang.Object with play.api.db.evolutions.Script with ScalaObject with Product with Serializable" id="163961">DownScript</a><a href="#163961" title="ScalaObject" class="delimiter">(</a><a title="play.api.db.evolutions.Evolution" id="161143">evolution</a>: <a href="#163977" title="play.api.db.evolutions.Evolution">Evolution</a>, <a title="String" id="161144">sql</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#12503" title="play.api.db.evolutions.Script">Script</a>

<span class="comment">/**
 * Defines Evolutions utilities functions.
 */</span>
<span class="keyword">object</span> <a title="object play.api.db.evolutions.Evolutions" id="12567">Evolutions</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="comment">/**
   * Updates a local (file-based) evolution script.
   */</span>
  <span class="keyword">def</span> <a title="(db: String, revision: Int, comment: String, ups: String, downs: String)(implicit application: play.api.Application)Unit" id="159123">updateEvolutionScript</a><span class="delimiter">(</span><a title="String" id="159142">db</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;default&quot;)" class="string">&quot;default&quot;</span>, <a title="Int" id="159143">revision</a>: <span title="Int">Int</span> = <span title="Int(1)" class="int">1</span>, <a title="String" id="159144">comment</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;Generated&quot;)" class="string">&quot;Generated&quot;</span>, <a title="String" id="159138">ups</a>: <span title="String">String</span>, <a title="String" id="159139">downs</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="play.api.Application" id="159140">application</a>: <a href="../../Application.scala.html#10388" title="play.api.Application">Application</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">import</span> play.api.libs._

    <span class="keyword">val</span> <a title="java.io.File" id="159146">evolutions</a> = <a href="#159140" title="play.api.Application">application</a>.<a href="../../Application.scala.html#68072" title="(relativePath: String)java.io.File">getFile</a><span class="delimiter">(</span><span title="java.lang.String(&quot;conf/evolutions/&quot;)" class="string">&quot;conf/evolutions/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159142" title="String">db</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159143" title="Int">revision</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.sql&quot;)" class="string">&quot;.sql&quot;</span><span class="delimiter">)</span>;
    <a href="../../libs/Files.scala.html#13100" title="object play.api.libs.Files">Files</a>.<a href="../../libs/Files.scala.html#105486" title="(path: java.io.File)scalax.file.Path">createDirectory</a><span class="delimiter">(</span><a href="#159140" title="play.api.Application">application</a>.<a href="../../Application.scala.html#68072" title="(relativePath: String)java.io.File">getFile</a><span class="delimiter">(</span><span title="java.lang.String(&quot;conf/evolutions/&quot;)" class="string">&quot;conf/evolutions/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159142" title="String">db</a><span class="delimiter">)</span><span class="delimiter">)</span>;
    <a href="../../libs/Files.scala.html#13100" title="object play.api.libs.Files">Files</a>.<a href="../../libs/Files.scala.html#105487" title="(path: java.io.File, content: String)Unit">writeFileIfChanged</a><span class="delimiter">(</span><a href="#159146" title="java.io.File">evolutions</a>,
      <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;|# --- %s
               |
               |# --- !Ups
               |%s
               |
               |# --- !Downs
               |%s
               |
               |&quot;&quot;&quot;</span>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">stripMargin</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#159144" title="String">comment</a>, <a href="#159138" title="String">ups</a>, <a href="#159139" title="String">downs</a><span class="delimiter">)</span><span class="delimiter">)</span>;
  <span class="delimiter">}</span>

  <span class="comment">// --</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sql: String)(implicit c: java.sql.Connection)java.sql.ResultSet" id="159124">executeQuery</a><span class="delimiter">(</span><a title="String" id="159167">sql</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="java.sql.Connection" id="159168">c</a>: <span title="java.sql.Connection">Connection</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#159168" title="java.sql.Connection">c</a>.<span title="()java.sql.Statement">createStatement</span>.<span title="(x$1: java.lang.String)java.sql.ResultSet">executeQuery</span><span class="delimiter">(</span><a href="#159167" title="String">sql</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sql: String)(implicit c: java.sql.Connection)Boolean" id="159125">execute</a><span class="delimiter">(</span><a title="String" id="159173">sql</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="java.sql.Connection" id="159174">c</a>: <span title="java.sql.Connection">Connection</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#159174" title="java.sql.Connection">c</a>.<span title="()java.sql.Statement">createStatement</span>.<span title="(x$1: java.lang.String)Boolean">execute</span><span class="delimiter">(</span><a href="#159173" title="String">sql</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sql: String)(implicit c: java.sql.Connection)java.sql.PreparedStatement" id="159126">prepare</a><span class="delimiter">(</span><a title="String" id="159181">sql</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="java.sql.Connection" id="159182">c</a>: <span title="java.sql.Connection">Connection</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#159182" title="java.sql.Connection">c</a>.<span title="(x$1: java.lang.String)java.sql.PreparedStatement">prepareStatement</span><span class="delimiter">(</span><a href="#159181" title="String">sql</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">// --</span>

  <span class="comment">/**
   * Resolves evolution conflicts.
   *
   * @param api the `DBApi` to use
   * @param db the database name
   * @param revision the revision to mark as resolved
   */</span>
  <span class="keyword">def</span> <a title="(api: play.api.db.DBApi, db: String, revision: Int)Unit" id="159127">resolve</a><span class="delimiter">(</span><a title="play.api.db.DBApi" id="159187">api</a>: <a href="../DB.scala.html#12337" title="play.api.db.DBApi">DBApi</a>, <a title="String" id="159188">db</a>: <span title="String">String</span>, <a title="Int" id="159189">revision</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="java.sql.Connection" id="159191">connection</a> = <a href="#159187" title="play.api.db.DBApi">api</a>.<a href="../DB.scala.html#154993" title="(name: String, autocommit: Boolean)java.sql.Connection">getConnection</a><span class="delimiter">(</span><a href="#159188" title="String">db</a>, autocommit = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#159125" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#159191" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;update play_evolutions set state = \'applied\' where state = \'applying_up\' and id = &quot;)" class="string">&quot;update play_evolutions set state = 'applied' where state = 'applying_up' and id = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159189" title="Int">revision</a><span class="delimiter">)</span>;
      <a href="#159125" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#159191" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;delete from play_evolutions where state = \'applying_down\' and id = &quot;)" class="string">&quot;delete from play_evolutions where state = 'applying_down' and id = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159189" title="Int">revision</a><span class="delimiter">)</span>;
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#159191" title="java.sql.Connection">connection</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Checks the evolutions state.
   *
   * @param api the `DBApi` to use
   * @param db the database name
   * @throws an error if the database is in an inconsistent state
   */</span>
  <span class="keyword">def</span> <a title="(api: play.api.db.DBApi, db: String)Unit" id="159128">checkEvolutionsState</a><span class="delimiter">(</span><a title="play.api.db.DBApi" id="159192">api</a>: <a href="../DB.scala.html#12337" title="play.api.db.DBApi">DBApi</a>, <a title="String" id="159193">db</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="java.sql.Connection" id="159195">connection</a> = <a href="#159192" title="play.api.db.DBApi">api</a>.<a href="../DB.scala.html#154993" title="(name: String, autocommit: Boolean)java.sql.Connection">getConnection</a><span class="delimiter">(</span><a href="#159193" title="String">db</a>, autocommit = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>

      <span class="keyword">val</span> <a title="java.sql.ResultSet" id="159196">problem</a> = <a href="#159124" title="(sql: String)(implicit c: java.sql.Connection)java.sql.ResultSet">executeQuery</a><a href="#159195" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;select id, hash, apply_script, revert_script, state, last_problem from play_evolutions where state like \'applying_%\'&quot;)" class="string">&quot;select id, hash, apply_script, revert_script, state, last_problem from play_evolutions where state like 'applying_%'&quot;</span><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#159196" title="java.sql.ResultSet">problem</a>.<span title="()Boolean">next</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Int" id="159197">revision</a> = <a href="#159196" title="java.sql.ResultSet">problem</a>.<span title="(x$1: java.lang.String)Int">getInt</span><span class="delimiter">(</span><span title="java.lang.String(&quot;id&quot;)" class="string">&quot;id&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="java.lang.String" id="159198">state</a> = <a href="#159196" title="java.sql.ResultSet">problem</a>.<span title="(x$1: java.lang.String)java.lang.String">getString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;state&quot;)" class="string">&quot;state&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="java.lang.String" id="159199">hash</a> = <a href="#159196" title="java.sql.ResultSet">problem</a>.<span title="(x$1: java.lang.String)java.lang.String">getString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;hash&quot;)" class="string">&quot;hash&quot;</span><span class="delimiter">)</span>.<span title="(x$1: Int, x$2: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <span title="Int(7)" class="int">7</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="java.lang.String" id="159200">script</a> = <a href="#159198" title="java.lang.String">state</a> <span title="java.lang.String" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="java.lang.String" class="string">&quot;applying_up&quot;</span> =&gt; <a href="#159196" title="java.sql.ResultSet">problem</a>.<span title="(x$1: java.lang.String)java.lang.String">getString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;apply_script&quot;)" class="string">&quot;apply_script&quot;</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="java.lang.String">_</span> =&gt; <a href="#159196" title="java.sql.ResultSet">problem</a>.<span title="(x$1: java.lang.String)java.lang.String">getString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;revert_script&quot;)" class="string">&quot;revert_script&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="java.lang.String" id="159201">error</a> = <a href="#159196" title="java.sql.ResultSet">problem</a>.<span title="(x$1: java.lang.String)java.lang.String">getString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;last_problem&quot;)" class="string">&quot;last_problem&quot;</span><span class="delimiter">)</span>

        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#159200" title="java.lang.String">script</a><span class="delimiter">)</span>
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#159201" title="java.lang.String">error</a><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="java.lang.String" id="159202">humanScript</a> = <span title="java.lang.String(&quot;# --- Rev:&quot;)" class="string">&quot;# --- Rev:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159197" title="Int">revision</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#159198" title="java.lang.String">state</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;applying_up&quot;)" class="string">&quot;applying_up&quot;</span><span class="delimiter">)</span> <span title="java.lang.String(&quot;Ups&quot;)" class="string">&quot;Ups&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;Downs&quot;)" class="string">&quot;Downs&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; - &quot;)" class="string">&quot; - &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159199" title="java.lang.String">hash</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012\012&quot;)" class="string">&quot;\n\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159200" title="java.lang.String">script</a>;

        <span title="Nothing" class="keyword">throw</span> <a href="#163981" title="(db: String, script: String, error: String, rev: Int)play.api.db.evolutions.InconsistentDatabase">InconsistentDatabase</a><span class="delimiter">(</span><a href="#159193" title="String">db</a>, <a href="#159202" title="java.lang.String">humanScript</a>, <a href="#159201" title="java.lang.String">error</a>, <a href="#159197" title="Int">revision</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Nothing" id="159279">e</a>: <a href="#163981" title="play.api.db.evolutions.InconsistentDatabase">InconsistentDatabase</a> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#159279" title="play.api.db.evolutions.InconsistentDatabase">e</a>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#159125" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#159195" title="java.sql.Connection" class="delimiter">(</a>
          <span title="java.lang.String(&quot;\012                    create table play_evolutions (\012                        id int not null primary key, hash varchar(255) not null, \012                        applied_at timestamp not null, \012                        apply_script text, \012                        revert_script text, \012                        state varchar(255), \012                        last_problem text\012                    )\012                &quot;)" class="string">&quot;&quot;&quot;
                    create table play_evolutions (
                        id int not null primary key, hash varchar(255) not null, 
                        applied_at timestamp not null, 
                        apply_script text, 
                        revert_script text, 
                        state varchar(255), 
                        last_problem text
                    )
                &quot;&quot;&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a title="Unit" id="159280">ex</a>: <span title="Exception">Exception</span> =&gt; play.api.<a href="../../Logger.scala.html#10653" title="object play.api.Logger">Logger</a>.<a href="../../Logger.scala.html#82388" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;play_evolutions table already existed&quot;)" class="string">&quot;play_evolutions table already existed&quot;</span><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#159195" title="java.sql.Connection">connection</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  <span class="comment">/**
   * Applies a script to the database.
   *
   * @param api the `DBApi` to use
   * @param db the database name
   * @param script the script to run
   */</span>
  <span class="keyword">def</span> <a title="(api: play.api.db.DBApi, db: String, script: Seq[play.api.db.evolutions.Script])Unit" id="159129">applyScript</a><span class="delimiter">(</span><a title="play.api.db.DBApi" id="159283">api</a>: <a href="../DB.scala.html#12337" title="play.api.db.DBApi">DBApi</a>, <a title="String" id="159284">db</a>: <span title="String">String</span>, <a title="Seq[play.api.db.evolutions.Script]" id="159285">script</a>: <span title="Seq[play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Script<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="java.sql.Connection" id="159287">connection</a> = <a href="#159283" title="play.api.db.DBApi">api</a>.<a href="../DB.scala.html#154993" title="(name: String, autocommit: Boolean)java.sql.Connection">getConnection</a><span class="delimiter">(</span><a href="#159284" title="String">db</a>, autocommit = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

    <a href="#159128" title="(api: play.api.db.DBApi, db: String)Unit">checkEvolutionsState</a><span class="delimiter">(</span><a href="#159283" title="play.api.db.DBApi">api</a>, <a href="#159284" title="String">db</a><span class="delimiter">)</span>

    <span class="keyword">var</span> <a title="Int" id="159288">applying</a> = -<span title="Int(-1)" class="int">1</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>

      <a href="#159285" title="Seq[play.api.db.evolutions.Script]">script</a>.<span title="(f: play.api.db.evolutions.Script =&gt; Boolean)Unit">foreach</span> <span class="delimiter">{</span> <a title="play.api.db.evolutions.Script" id="159305">s</a> =&gt;
        <a href="#159288" title="Int">applying</a> = <a href="#159305" title="play.api.db.evolutions.Script">s</a>.<a href="#158973" title="=&gt; play.api.db.evolutions.Evolution">evolution</a>.<a href="#161256" title="=&gt; Int">revision</a>

        <span class="comment">// Insert into log</span>
        <a href="#159305" title="play.api.db.evolutions.Script">s</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>

          <span class="keyword">case</span> <span title="Boolean">UpScript</span><span class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="159306">e</a>, _<span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="java.sql.PreparedStatement" id="159307">ps</a> = <a href="#159126" title="(sql: String)(implicit c: java.sql.Connection)java.sql.PreparedStatement">prepare</a><a href="#159287" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;insert into play_evolutions values(?, ?, ?, ?, ?, ?, ?)&quot;)" class="string">&quot;insert into play_evolutions values(?, ?, ?, ?, ?, ?, ?)&quot;</span><span class="delimiter">)</span>
            <a href="#159307" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: Int)Unit">setInt</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <a href="#159306" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161256" title="=&gt; Int">revision</a><span class="delimiter">)</span>
            <a href="#159307" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.lang.String)Unit">setString</span><span class="delimiter">(</span><span title="Int(2)" class="int">2</span>, <a href="#159306" title="play.api.db.evolutions.Evolution">e</a>.<a href="#158884" title="=&gt; String">hash</a><span class="delimiter">)</span>
            <a href="#159307" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.sql.Date)Unit">setDate</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span>, <span title="(x$1: Long)java.sql.Date" class="keyword">new</span> <span title="java.sql.Date">Date</span><span class="delimiter">(</span><span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#159307" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.lang.String)Unit">setString</span><span class="delimiter">(</span><span title="Int(4)" class="int">4</span>, <a href="#159306" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161257" title="=&gt; String">sql_up</a><span class="delimiter">)</span>
            <a href="#159307" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.lang.String)Unit">setString</span><span class="delimiter">(</span><span title="Int(5)" class="int">5</span>, <a href="#159306" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161258" title="=&gt; String">sql_down</a><span class="delimiter">)</span>
            <a href="#159307" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.lang.String)Unit">setString</span><span class="delimiter">(</span><span title="Int(6)" class="int">6</span>, <span title="java.lang.String(&quot;applying_up&quot;)" class="string">&quot;applying_up&quot;</span><span class="delimiter">)</span>
            <a href="#159307" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.lang.String)Unit">setString</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
            <a href="#159307" title="java.sql.PreparedStatement">ps</a>.<span title="()Boolean">execute</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Boolean">DownScript</span><span class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="159314">e</a>, _<span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <a href="#159125" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#159287" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;update play_evolutions set state = \'applying_down\' where id = &quot;)" class="string">&quot;update play_evolutions set state = 'applying_down' where id = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159314" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161256" title="=&gt; Int">revision</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="delimiter">}</span>

        <span class="comment">// Execute script</span>
        <a href="#159305" title="play.api.db.evolutions.Script">s</a>.<a href="#158974" title="=&gt; String">sql</a>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;;&quot;)" class="string">&quot;;&quot;</span><span class="delimiter">)</span>.<span title="(f: java.lang.String =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.String],java.lang.String,Array[java.lang.String]])Array[java.lang.String]">map</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><a href="#159762" title="java.lang.String">_</a>.<span title="()java.lang.String">trim</span><span class="delimiter">)</span>.<span title="(f: java.lang.String =&gt; AnyVal)Unit">foreach</span> <a href="#160511" title="AnyVal" class="delimiter">{</a>
          <span class="keyword">case</span> <span title="Unit" class="string">&quot;&quot;</span> =&gt;
          <span class="keyword">case</span> <a title="Boolean" id="160512">statement</a> =&gt; <a href="#159125" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#159287" title="java.sql.Connection" class="delimiter">(</a><a href="#160512" title="java.lang.String">statement</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="comment">// Insert into logs</span>
        <a href="#159305" title="play.api.db.evolutions.Script">s</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>

          <span class="keyword">case</span> <span title="Boolean">UpScript</span><span class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="160526">e</a>, _<span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <a href="#159125" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#159287" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;update play_evolutions set state = \'applied\' where id = &quot;)" class="string">&quot;update play_evolutions set state = 'applied' where id = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160526" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161256" title="=&gt; Int">revision</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Boolean">DownScript</span><span class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="160527">e</a>, _<span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <a href="#159125" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#159287" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;delete from play_evolutions where id = &quot;)" class="string">&quot;delete from play_evolutions where id = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160527" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161256" title="=&gt; Int">revision</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="delimiter">}</span>

      <span class="delimiter">}</span>

    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="160529">e</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="java.lang.String" id="160530">message</a> = <a href="#160529" title="java.lang.Throwable">e</a> <span title="java.lang.String" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="java.lang.String" id="160532">ex</a>: <span title="java.sql.SQLException">SQLException</span> =&gt; <a href="#160532" title="java.sql.SQLException">ex</a>.<span title="()java.lang.String">getMessage</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; [ERROR:&quot;)" class="string">&quot; [ERROR:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160532" title="java.sql.SQLException">ex</a>.<span title="()Int">getErrorCode</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, SQLSTATE:&quot;)" class="string">&quot;, SQLSTATE:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160532" title="java.sql.SQLException">ex</a>.<span title="()java.lang.String">getSQLState</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span>
          <span class="keyword">case</span> <a title="java.lang.String" id="160565">ex</a> =&gt; <a href="#160565" title="java.lang.Throwable">ex</a>.<span title="()java.lang.String">getMessage</span>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="java.sql.PreparedStatement" id="160531">ps</a> = <a href="#159126" title="(sql: String)(implicit c: java.sql.Connection)java.sql.PreparedStatement">prepare</a><a href="#159287" title="java.sql.Connection" class="delimiter">(</a><span title="java.lang.String(&quot;update play_evolutions set last_problem = ? where id = ?&quot;)" class="string">&quot;update play_evolutions set last_problem = ? where id = ?&quot;</span><span class="delimiter">)</span>
        <a href="#160531" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.lang.String)Unit">setString</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <a href="#160530" title="java.lang.String">message</a><span class="delimiter">)</span>
        <a href="#160531" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: Int)Unit">setInt</span><span class="delimiter">(</span><span title="Int(2)" class="int">2</span>, <a href="#159288" title="Int">applying</a><span class="delimiter">)</span>
        <a href="#160531" title="java.sql.PreparedStatement">ps</a>.<span title="()Boolean">execute</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#159287" title="java.sql.Connection">connection</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  <span class="comment">/**
   * Translates an evolution script to something human-readable.
   *
   * @param scripts the script
   * @return a formatted script
   */</span>
  <span class="keyword">def</span> <a title="(script: Seq[play.api.db.evolutions.Script])String" id="159130">toHumanReadableScript</a><span class="delimiter">(</span><a title="Seq[play.api.db.evolutions.Script]" id="160568">script</a>: <span title="Seq[play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Script<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="160570">txt</a> = <a href="#160568" title="Seq[play.api.db.evolutions.Script]">script</a>.<span title="(f: play.api.db.evolutions.Script =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Script],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span> <a href="#160587" title="java.lang.String" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="java.lang.String">UpScript</span><span class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="160588">ev</a>, <a title="String" id="160589">sql</a><span class="delimiter">)</span> =&gt; <span title="java.lang.String(&quot;# --- Rev:&quot;)" class="string">&quot;# --- Rev:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160588" title="play.api.db.evolutions.Evolution">ev</a>.<a href="#161256" title="=&gt; Int">revision</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;,Ups - &quot;)" class="string">&quot;,Ups - &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160588" title="play.api.db.evolutions.Evolution">ev</a>.<a href="#158884" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">hash</a>.<span title="(n: Int)String">take</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160589" title="String">sql</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>
      <span class="keyword">case</span> <span title="java.lang.String">DownScript</span><span class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="160702">ev</a>, <a title="String" id="160703">sql</a><span class="delimiter">)</span> =&gt; <span title="java.lang.String(&quot;# --- Rev:&quot;)" class="string">&quot;# --- Rev:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160702" title="play.api.db.evolutions.Evolution">ev</a>.<a href="#161256" title="=&gt; Int">revision</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;,Downs - &quot;)" class="string">&quot;,Downs - &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160702" title="play.api.db.evolutions.Evolution">ev</a>.<a href="#158884" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">hash</a>.<span title="(n: Int)String">take</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160703" title="String">sql</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>
    <span class="delimiter">}</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>

    <a href="#160568" title="Seq[play.api.db.evolutions.Script]">script</a>.<span title="(p: play.api.db.evolutions.Script =&gt; Boolean)Option[play.api.db.evolutions.Script]">find</span> <a href="#160843" title="Boolean" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Boolean(true)">DownScript</span><span class="delimiter">(</span>_, _<span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
      <span class="keyword">case</span> <span title="Boolean(false)">UpScript</span><span class="delimiter">(</span>_, _<span class="delimiter">)</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>.<span title="(f: play.api.db.evolutions.Script =&gt; java.lang.String)Option[java.lang.String]">map</span><span class="delimiter">(</span><a title="play.api.db.evolutions.Script" id="160848">_</a> =&gt; <span title="java.lang.String(&quot;# !!! WARNING! This script contains DOWNS evolutions that are likely destructives\012\012&quot;)" class="string">&quot;# !!! WARNING! This script contains DOWNS evolutions that are likely destructives\n\n&quot;</span><span class="delimiter">)</span>.<span title="(default: =&gt; java.lang.String)java.lang.String">getOrElse</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160570" title="String">txt</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Computes the evolution script.
   *
   * @param api the `DBApi` to use
   * @param applicationPath the application path
   * @param db the database name
   */</span>
  <span class="keyword">def</span> <a title="(api: play.api.db.DBApi, path: java.io.File, applicationClassloader: java.lang.ClassLoader, db: String)Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]" id="159131">evolutionScript</a><span class="delimiter">(</span><a title="play.api.db.DBApi" id="160855">api</a>: <a href="../DB.scala.html#12337" title="play.api.db.DBApi">DBApi</a>, <a title="java.io.File" id="160856">path</a>: <span title="java.io.File">File</span>, <a title="java.lang.ClassLoader" id="160857">applicationClassloader</a>: <span title="java.lang.ClassLoader">ClassLoader</span>, <a title="String" id="160858">db</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Product <span class="keyword">with</span> Serializable <span class="keyword">with</span> Script<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.Evolution]" id="160861">application</a> = <a href="#159133" title="(path: java.io.File, applicationClassloader: java.lang.ClassLoader, db: String)Seq[play.api.db.evolutions.Evolution]">applicationEvolutions</a><span class="delimiter">(</span><a href="#160856" title="java.io.File">path</a>, <a href="#160857" title="java.lang.ClassLoader">applicationClassloader</a>, <a href="#160858" title="String">db</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.Evolution]" id="160862">database</a> = <a href="#159132" title="(api: play.api.db.DBApi, db: String)Seq[play.api.db.evolutions.Evolution]">databaseEvolutions</a><span class="delimiter">(</span><a href="#160855" title="play.api.db.DBApi">api</a>, <a href="#160858" title="String">db</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a href="#160864" title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])" class="delimiter">(</a><a href="#160863" title="Seq[play.api.db.evolutions.Evolution]" id="160864">nonConflictingDowns</a>, <a href="#160863" title="Seq[play.api.db.evolutions.Evolution]" id="160865">dRest</a><span class="delimiter">)</span> = <a href="#160862" title="Seq[play.api.db.evolutions.Evolution]">database</a>.<span title="(p: play.api.db.evolutions.Evolution =&gt; Boolean)(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])">span</span><span title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution]) @unchecked" class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="160884">e</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#160861" title="Seq[play.api.db.evolutions.Evolution]">application</a>.<span title="=&gt; Option[play.api.db.evolutions.Evolution]">headOption</span>.<span title="(p: play.api.db.evolutions.Evolution =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#160884" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161256" title="=&gt; Int">revision</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="#160887" title="play.api.db.evolutions.Evolution">_</a>.<a href="#161256" title="=&gt; Int">revision</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a href="#160867" title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])" class="delimiter">(</a><a href="#160866" title="Seq[play.api.db.evolutions.Evolution]" id="160867">nonConflictingUps</a>, <a href="#160866" title="Seq[play.api.db.evolutions.Evolution]" id="160868">uRest</a><span class="delimiter">)</span> = <a href="#160861" title="Seq[play.api.db.evolutions.Evolution]">application</a>.<span title="(p: play.api.db.evolutions.Evolution =&gt; Boolean)(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])">span</span><span title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution]) @unchecked" class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="160907">e</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#160862" title="Seq[play.api.db.evolutions.Evolution]">database</a>.<span title="=&gt; Option[play.api.db.evolutions.Evolution]">headOption</span>.<span title="(p: play.api.db.evolutions.Evolution =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#160909" title="play.api.db.evolutions.Evolution">_</a>.<a href="#161256" title="=&gt; Int">revision</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#160907" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161256" title="=&gt; Int">revision</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a href="#160870" title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])" class="delimiter">(</a><a href="#160869" title="Seq[play.api.db.evolutions.Evolution]" id="160870">conflictingDowns</a>, <a href="#160869" title="Seq[play.api.db.evolutions.Evolution]" id="160871">conflictingUps</a><span class="delimiter">)</span> = <a href="#160865" title="Seq[play.api.db.evolutions.Evolution]">dRest</a>.<span title="(that: scala.collection.GenIterable[play.api.db.evolutions.Evolution])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution),Seq[(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)]])Seq[(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)]">zip</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution),Seq[(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)]]" class="delimiter">(</span><a href="#160868" title="Seq[play.api.db.evolutions.Evolution]">uRest</a><span class="delimiter">)</span>.<span title="(p: (play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution) =&gt; Boolean)Seq[(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)]">takeWhile</span> <a href="#160976" title="Boolean" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Boolean" class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="160979">down</a>, <a title="play.api.db.evolutions.Evolution" id="160980">up</a><span class="delimiter">)</span> =&gt; <a href="#160979" title="play.api.db.evolutions.Evolution">down</a>.<a href="#158884" title="=&gt; String">hash</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#160980" title="play.api.db.evolutions.Evolution">up</a>.<a href="#158884" title="=&gt; String">hash</a>
    <span class="delimiter">}</span>.<span title="(implicit asPair: (play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution) =&gt; (play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution))(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])">unzip</span>

    <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.UpScript]" id="160872">ups</a> = <span class="delimiter">(</span><a href="#160867" title="Seq[play.api.db.evolutions.Evolution]">nonConflictingUps</a> <span title="(that: scala.collection.GenTraversableOnce[play.api.db.evolutions.Evolution])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],play.api.db.evolutions.Evolution,Seq[play.api.db.evolutions.Evolution]])Seq[play.api.db.evolutions.Evolution]">++</span> <a href="#160871" title="Seq[play.api.db.evolutions.Evolution]">conflictingUps</a><span class="delimiter">)</span>.<span title="=&gt; Seq[play.api.db.evolutions.Evolution]">reverse</span>.<span title="(f: play.api.db.evolutions.Evolution =&gt; play.api.db.evolutions.UpScript)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],play.api.db.evolutions.UpScript,Seq[play.api.db.evolutions.UpScript]])Seq[play.api.db.evolutions.UpScript]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,play.api.db.evolutions.UpScript,Seq[play.api.db.evolutions.UpScript]]" class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="161060">e</a> =&gt; <a href="#163985" title="(evolution: play.api.db.evolutions.Evolution, sql: String)play.api.db.evolutions.UpScript">UpScript</a><span class="delimiter">(</span><a href="#161060" title="play.api.db.evolutions.Evolution">e</a>, <a href="#161060" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161257" title="=&gt; String">sql_up</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.DownScript]" id="160873">downs</a> = <span class="delimiter">(</span><a href="#160864" title="Seq[play.api.db.evolutions.Evolution]">nonConflictingDowns</a> <span title="(that: scala.collection.GenTraversableOnce[play.api.db.evolutions.Evolution])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],play.api.db.evolutions.Evolution,Seq[play.api.db.evolutions.Evolution]])Seq[play.api.db.evolutions.Evolution]">++</span> <a href="#160870" title="Seq[play.api.db.evolutions.Evolution]">conflictingDowns</a><span class="delimiter">)</span>.<span title="(f: play.api.db.evolutions.Evolution =&gt; play.api.db.evolutions.DownScript)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],play.api.db.evolutions.DownScript,Seq[play.api.db.evolutions.DownScript]])Seq[play.api.db.evolutions.DownScript]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,play.api.db.evolutions.DownScript,Seq[play.api.db.evolutions.DownScript]]" class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="161142">e</a> =&gt; <a href="#163961" title="(evolution: play.api.db.evolutions.Evolution, sql: String)play.api.db.evolutions.DownScript">DownScript</a><span class="delimiter">(</span><a href="#161142" title="play.api.db.evolutions.Evolution">e</a>, <a href="#161142" title="play.api.db.evolutions.Evolution">e</a>.<a href="#161258" title="=&gt; String">sql_down</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <a href="#160873" title="Seq[play.api.db.evolutions.DownScript]">downs</a> <span title="(that: scala.collection.GenTraversableOnce[Product with Serializable with play.api.db.evolutions.Script])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.DownScript],Product with Serializable with play.api.db.evolutions.Script,Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]])Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">++</span> <a href="#160872" title="Seq[play.api.db.evolutions.UpScript]">ups</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Reads evolutions from the database.
   *
   * @param api the `DBApi` to use
   * @param db the database name
   */</span>
  <span class="keyword">def</span> <a title="(api: play.api.db.DBApi, db: String)Seq[play.api.db.evolutions.Evolution]" id="159132">databaseEvolutions</a><span class="delimiter">(</span><a title="play.api.db.DBApi" id="160878">api</a>: <a href="../DB.scala.html#12337" title="play.api.db.DBApi">DBApi</a>, <a title="String" id="160879">db</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Seq[play.api.db.evolutions.Evolution]">Seq</span><span class="delimiter">[</span>Evolution<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="java.sql.Connection" id="161228">connection</a> = <a href="#160878" title="play.api.db.DBApi">api</a>.<a href="../DB.scala.html#154993" title="(name: String, autocommit: Boolean)java.sql.Connection">getConnection</a><span class="delimiter">(</span><a href="#160879" title="String">db</a>, autocommit = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

    <a href="#159128" title="(api: play.api.db.DBApi, db: String)Unit">checkEvolutionsState</a><span class="delimiter">(</span><a href="#160878" title="play.api.db.DBApi">api</a>, <a href="#160879" title="String">db</a><span class="delimiter">)</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>

      <a href="../../libs/Collections.scala.html#13139" title="object play.api.libs.Collections">Collections</a>.<a href="../../libs/Collections.scala.html#161230" title="(seed: java.sql.ResultSet)(f: java.sql.ResultSet =&gt; Option[(java.sql.ResultSet, play.api.db.evolutions.Evolution)])Seq[play.api.db.evolutions.Evolution]">unfoldLeft</a><span class="delimiter">(</span><a href="#159124" title="(sql: String)(implicit c: java.sql.Connection)java.sql.ResultSet">executeQuery</a><a href="#161228" title="java.sql.Connection" class="delimiter">(</a>
        <span title="java.lang.String(&quot;\012                    select id, hash, apply_script, revert_script from play_evolutions order by id\012                &quot;)" class="string">&quot;&quot;&quot;
                    select id, hash, apply_script, revert_script from play_evolutions order by id
                &quot;&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="java.sql.ResultSet" id="161249">rs</a> =&gt;
        <a href="#161249" title="java.sql.ResultSet">rs</a>.<span title="()Boolean">next</span> <span title="Option[(java.sql.ResultSet, play.api.db.evolutions.Evolution)]" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="None.type" class="keyword">false</span> =&gt; <span title="object None">None</span>
          <span class="keyword">case</span> <span title="Some[(java.sql.ResultSet, play.api.db.evolutions.Evolution)]" class="keyword">true</span> =&gt; <span class="delimiter">{</span>
            <span title="(x: (java.sql.ResultSet, play.api.db.evolutions.Evolution))Some[(java.sql.ResultSet, play.api.db.evolutions.Evolution)]">Some</span><span title="(_1: java.sql.ResultSet, _2: play.api.db.evolutions.Evolution)(java.sql.ResultSet, play.api.db.evolutions.Evolution)" class="delimiter">(</span><a href="#161249" title="java.sql.ResultSet">rs</a>, <a href="#163977" title="(revision: Int, sql_up: String, sql_down: String)play.api.db.evolutions.Evolution">Evolution</a><span class="delimiter">(</span>
              <a href="#161249" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)Int">getInt</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>,
              <a href="#161249" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)java.lang.String">getString</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>,
              <a href="#161249" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)java.lang.String">getString</span><span class="delimiter">(</span><span title="Int(4)" class="int">4</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#161228" title="java.sql.Connection">connection</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Reads the evolutions from the application.
   *
   * @param db the database name
   */</span>
  <span class="keyword">def</span> <a title="(path: java.io.File, applicationClassloader: java.lang.ClassLoader, db: String)Seq[play.api.db.evolutions.Evolution]" id="159133">applicationEvolutions</a><span class="delimiter">(</span><a title="java.io.File" id="160874">path</a>: <span title="java.io.File">File</span>, <a title="java.lang.ClassLoader" id="160875">applicationClassloader</a>: <span title="java.lang.ClassLoader">ClassLoader</span>, <a title="String" id="160876">db</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Seq[play.api.db.evolutions.Evolution]">Seq</span><span class="delimiter">[</span>Evolution<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="161285">upsMarker</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;^#.*!Ups.*$&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
    <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="161286">downsMarker</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;^#.*!Downs.*$&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>

    <span class="keyword">val</span> <a title="java.lang.String" id="161287">UPS</a> = <span title="java.lang.String(&quot;UPS&quot;)" class="string">&quot;UPS&quot;</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="161288">DOWNS</a> = <span title="java.lang.String(&quot;DOWNS&quot;)" class="string">&quot;DOWNS&quot;</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="161289">UNKNOWN</a> = <span title="java.lang.String(&quot;UNKNOWN&quot;)" class="string">&quot;UNKNOWN&quot;</span>

    <span class="keyword">val</span> <a title="PartialFunction[String,String]" id="161290">mapUpsAndDowns</a>: <span title="PartialFunction[String,String]">PartialFunction</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span> = <a href="#161299" title="String" class="delimiter">{</a>
      <span class="keyword">case</span> <a href="#161285" title="java.lang.String">upsMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#161287" title="java.lang.String">UPS</a>
      <span class="keyword">case</span> <a href="#161286" title="java.lang.String">downsMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#161288" title="java.lang.String">DOWNS</a>
      <span class="keyword">case</span> <span title="java.lang.String">_</span> =&gt; <a href="#161289" title="java.lang.String">UNKNOWN</a>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="PartialFunction[String,Boolean]" id="161291">isMarker</a>: <span title="PartialFunction[String,Boolean]">PartialFunction</span><span class="delimiter">[</span>String, Boolean<span class="delimiter">]</span> = <a href="#161303" title="Boolean" class="delimiter">{</a>
      <span class="keyword">case</span> <a href="#161285" title="Boolean(true)">upsMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
      <span class="keyword">case</span> <a href="#161286" title="Boolean(true)">downsMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
      <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>

    <a href="../../libs/Collections.scala.html#13139" title="object play.api.libs.Collections">Collections</a>.<a href="../../libs/Collections.scala.html#161230" title="(seed: Int)(f: Int =&gt; Option[(Int, (Int, java.lang.String))])Seq[(Int, java.lang.String)]">unfoldLeft</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="Int" id="161315">revision</a> =&gt;
      <span title="(x: java.io.File)Option[java.io.File]">Option</span><span class="delimiter">(</span><span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#160874" title="java.io.File">path</a>, <span title="java.lang.String(&quot;conf/evolutions/&quot;)" class="string">&quot;conf/evolutions/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160876" title="String">db</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161315" title="Int">revision</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.sql&quot;)" class="string">&quot;.sql&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(p: java.io.File =&gt; Boolean)Option[java.io.File]">filter</span><span class="delimiter">(</span><a href="#161325" title="java.io.File">_</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span>.<span title="(f: java.io.File =&gt; java.io.FileInputStream)Option[java.io.FileInputStream]">map</span><span class="delimiter">(</span><span title="(x$1: java.io.File)java.io.FileInputStream" class="keyword">new</span> <span title="java.io.FileInputStream">FileInputStream</span><span class="delimiter">(</span><a href="#161330" title="java.io.File">_</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(alternative: =&gt; Option[java.io.InputStream])Option[java.io.InputStream]">orElse</span> <span class="delimiter">{</span>
        <span title="(x: java.io.InputStream)Option[java.io.InputStream]">Option</span><span class="delimiter">(</span><a href="#160875" title="java.lang.ClassLoader">applicationClassloader</a>.<span title="(x$1: java.lang.String)java.io.InputStream">getResourceAsStream</span><span class="delimiter">(</span><span title="java.lang.String(&quot;evolutions/&quot;)" class="string">&quot;evolutions/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#160876" title="String">db</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161315" title="Int">revision</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.sql&quot;)" class="string">&quot;.sql&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>.<span title="(f: java.io.InputStream =&gt; (Int, (Int, java.lang.String)))Option[(Int, (Int, java.lang.String))]">map</span> <span class="delimiter">{</span> <a title="java.io.InputStream" id="161383">stream</a> =&gt;
        <span title="(_1: Int, _2: (Int, java.lang.String))(Int, (Int, java.lang.String))" class="delimiter">(</span><a href="#161315" title="Int">revision</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <span title="(_1: Int, _2: java.lang.String)(Int, java.lang.String)" class="delimiter">(</span><a href="#161315" title="Int">revision</a>, <a href="#161383" title="(src: java.io.InputStream)(implicit converter: scalax.io.JavaConverters.AsInputConverter[java.io.InputStream])scalax.io.JavaConverters.AsInput">stream</a>.<a title="scalax.io.Input" id="161411">asInput</a>.<a href="#161411" title="scalax.io.Codec" id="161412">slurpString</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>.<span title="(f: (Int, java.lang.String) =&gt; Int)(implicit ord: scala.math.Ordering[Int])Seq[(Int, java.lang.String)]">sortBy</span><span title="object scala.math.Ordering.Int" class="delimiter">(</span><a href="#161426" title="(Int, java.lang.String)">_</a>.<span title="=&gt; Int">_1</span><span class="delimiter">)</span>.<span title="(f: (Int, java.lang.String) =&gt; play.api.db.evolutions.Evolution)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Int, java.lang.String)],play.api.db.evolutions.Evolution,Seq[play.api.db.evolutions.Evolution]])Seq[play.api.db.evolutions.Evolution]">map</span> <a href="#161505" title="play.api.db.evolutions.Evolution" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="play.api.db.evolutions.Evolution" class="delimiter">(</span><a title="Int" id="161508">revision</a>, <a title="java.lang.String" id="161509">script</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>

        <span class="keyword">val</span> <a title="scala.collection.immutable.Map[java.lang.String,java.lang.String]" id="161510">parsed</a> = <a href="../../libs/Collections.scala.html#13139" title="object play.api.libs.Collections">Collections</a>.<a href="../../libs/Collections.scala.html#161230" title="(seed: (java.lang.String, List[java.lang.String]))(f: (java.lang.String, List[java.lang.String]) =&gt; Option[((java.lang.String, List[java.lang.String]), (java.lang.String, String))])Seq[(java.lang.String, String)]">unfoldLeft</a><span class="delimiter">(</span><span title="(_1: java.lang.String, _2: List[java.lang.String])(java.lang.String, List[java.lang.String])" class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a href="#161509" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">script</a>.<span title="(separator: Char)Array[String]">split</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><span title="Char(\'\\n\')" class="char">'\n'</span><span class="delimiter">)</span>.<span title="=&gt; List[String]">toList</span>.<span title="(f: String =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],java.lang.String,List[java.lang.String]])List[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,java.lang.String,List[java.lang.String]]" class="delimiter">(</span><a href="#161665" title="String">_</a>.<span title="()java.lang.String">trim</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#161703" title="Option[((String, List[java.lang.String]), (java.lang.String, String))]" class="delimiter">{</a>
          <span class="keyword">case</span> <span title="None.type" class="delimiter">(</span>_, <span title="object Nil">Nil</span><span class="delimiter">)</span> =&gt; <span title="object None">None</span>
          <span class="keyword">case</span> <span title="Some[((String, List[java.lang.String]), (java.lang.String, String))]" class="delimiter">(</span><a title="java.lang.String" id="161708">context</a>, <a title="List[java.lang.String]" id="161709">lines</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <span class="keyword">val</span> <a href="#161711" title="(List[java.lang.String], List[java.lang.String])" class="delimiter">(</a><a href="#161710" title="List[java.lang.String]" id="161711">some</a>, <a href="#161710" title="List[java.lang.String]" id="161712">next</a><span class="delimiter">)</span> = <a href="#161709" title="List[java.lang.String]">lines</a>.<span title="(p: java.lang.String =&gt; Boolean)(List[java.lang.String], List[java.lang.String])">span</span><span title="(List[java.lang.String], List[java.lang.String]) @unchecked" class="delimiter">(</span><a title="java.lang.String" id="161718">l</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#161291" title="(v1: String)Boolean">isMarker</a><span class="delimiter">(</span><a href="#161718" title="java.lang.String">l</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span title="(x: ((String, List[java.lang.String]), (java.lang.String, String)))Some[((String, List[java.lang.String]), (java.lang.String, String))]">Some</span><span class="delimiter">(</span><span title="(_1: (String, List[java.lang.String]), _2: (java.lang.String, String))((String, List[java.lang.String]), (java.lang.String, String))" class="delimiter">(</span><a href="#161712" title="List[java.lang.String]">next</a>.<span title="=&gt; Option[java.lang.String]">headOption</span>.<span title="(f: java.lang.String =&gt; (String, List[java.lang.String]))Option[(String, List[java.lang.String])]">map</span><span class="delimiter">(</span><a title="java.lang.String" id="161740">c</a> =&gt; <span title="(_1: String, _2: List[java.lang.String])(String, List[java.lang.String])" class="delimiter">(</span><a href="#161290" title="(v1: String)String">mapUpsAndDowns</a><span class="delimiter">(</span><a href="#161740" title="java.lang.String">c</a><span class="delimiter">)</span>, <a href="#161712" title="List[java.lang.String]">next</a>.<span title="=&gt; List[java.lang.String]">tail</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; (String, List[java.lang.String]))(String, List[java.lang.String])">getOrElse</span><span class="delimiter">(</span><span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;&quot;</span> <span title="(y: scala.collection.immutable.Nil.type)(java.lang.String, scala.collection.immutable.Nil.type)">-&gt;</span> <span title="object Nil">Nil</span><span class="delimiter">)</span>,
              <a href="#161708" title="(x: java.lang.String)ArrowAssoc[java.lang.String]">context</a> <span title="(y: String)(java.lang.String, String)">-&gt;</span> <a href="#161711" title="List[java.lang.String]">some</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>.<span title="=&gt; Seq[(java.lang.String, String)]">reverse</span>.<span title="(n: Int)Seq[(java.lang.String, String)]">drop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(f: (java.lang.String, String) =&gt; java.lang.String)scala.collection.immutable.Map[java.lang.String,Seq[(java.lang.String, String)]]">groupBy</span><span class="delimiter">(</span><a title="(java.lang.String, String)" id="161818">i</a> =&gt; <a href="#161818" title="(java.lang.String, String)">i</a>.<span title="=&gt; java.lang.String">_1</span><span class="delimiter">)</span>.<span title="(f: Seq[(java.lang.String, String)] =&gt; java.lang.String)scala.collection.immutable.Map[java.lang.String,java.lang.String]">mapValues</span> <span class="delimiter">{</span> <a href="#161834" title="Seq[(java.lang.String, String)]">_</a>.<span title="(f: (java.lang.String, String) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(java.lang.String, String)],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#161851" title="(java.lang.String, String)">_</a>.<span title="=&gt; String">_2</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>.<span title="()java.lang.String">trim</span> <span class="delimiter">}</span>

        <a href="#163977" title="(revision: Int, sql_up: String, sql_down: String)play.api.db.evolutions.Evolution">Evolution</a><span class="delimiter">(</span>
          <a href="#161508" title="Int">revision</a>,
          <a href="#161510" title="scala.collection.immutable.Map[java.lang.String,java.lang.String]">parsed</a>.<span title="(key: java.lang.String)Option[java.lang.String]">get</span><span class="delimiter">(</span><a href="#161287" title="java.lang.String">UPS</a><span class="delimiter">)</span>.<span title="(default: =&gt; java.lang.String)java.lang.String">getOrElse</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>,
          <a href="#161510" title="scala.collection.immutable.Map[java.lang.String,java.lang.String]">parsed</a>.<span title="(key: java.lang.String)Option[java.lang.String]">get</span><span class="delimiter">(</span><a href="#161288" title="java.lang.String">DOWNS</a><span class="delimiter">)</span>.<span title="(default: =&gt; java.lang.String)java.lang.String">getOrElse</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>.<span title="=&gt; Seq[play.api.db.evolutions.Evolution]">reverse</span>

  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Play Evolutions plugin.
 */</span>
<span class="keyword">class</span> <a title="class EvolutionsPlugin extends java.lang.Object with play.api.Plugin with ScalaObject" id="12602">EvolutionsPlugin</a><a href="#12602" title="ScalaObject" class="delimiter">(</a><a title="play.api.Application" id="161934">app</a>: <a href="../../Application.scala.html#10388" title="play.api.Application">Application</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../Plugins.scala.html#10469" title="play.api.Plugin">Plugin</a> <span class="delimiter">{</span>

  <span class="keyword">import</span> <a href="#12567" title="object play.api.db.evolutions.Evolutions">Evolutions</a>._

  <span class="comment">/**
   * Is this plugin enabled.
   *
   * {{{
   * evolutionplugin = disabled
   * }}}
   */</span>
  <span class="keyword">override</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Boolean" id="161916">enabled</a> = <a href="#161934" title="play.api.Application">app</a>.<a href="../../Application.scala.html#68060" title="=&gt; play.api.Configuration">configuration</a>.<a href="../../Configuration.scala.html#68343" title="(path: String)Option[play.api.Configuration]">getConfig</a><span class="delimiter">(</span><span title="java.lang.String(&quot;db&quot;)" class="string">&quot;db&quot;</span><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">{</span>
    <span title="=&gt; Boolean">!</span><a href="#161934" title="play.api.Application">app</a>.<a href="../../Application.scala.html#68060" title="play.api.Configuration" id="161924">configuration</a>.<a href="../../Configuration.scala.html#78646" title="Option[Set[String]]" id="161926">getString</a><span class="delimiter">(</span><a title="java.lang.String(&quot;evolutionplugin&quot;)" id="161925" class="string">&quot;evolutionplugin&quot;</a><span class="delimiter">)</span>.<span title="(p: String =&gt; Boolean)Option[String]">filter</span><span class="delimiter">(</span><a href="#161929" title="String">_</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;disabled&quot;)" class="string">&quot;disabled&quot;</span><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Checks the evolutions state.
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="161917">onStart</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.db.DBApi" id="161936">api</a> = <a href="#161934" title="play.api.Application">app</a>.<a href="../../Application.scala.html#68066" title="[T](implicit m: Manifest[T])Option[T]">plugin</a><span title="(implicit m: Manifest[play.api.db.DBPlugin])Option[play.api.db.DBPlugin]" class="delimiter">[</span><a href="../DB.scala.html#12343" title="play.api.db.DBPlugin">DBPlugin</a><span class="delimiter">]</span>.<span title="(f: play.api.db.DBPlugin =&gt; play.api.db.DBApi)Option[play.api.db.DBApi]">map</span><span class="delimiter">(</span><a href="#161962" title="play.api.db.DBPlugin">_</a>.<a href="../DB.scala.html#155479" title="=&gt; play.api.db.DBApi">api</a><span class="delimiter">)</span>.<span title="(default: =&gt; play.api.db.DBApi)play.api.db.DBApi">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.Exception" class="keyword">new</span> <span title="java.lang.Exception">Exception</span><span class="delimiter">(</span><span title="java.lang.String(&quot;there should be a database plugin registered at this point but looks like it\'s not available, so evolution won\'t work. Please make sure you register a db plugin properly&quot;)" class="string">&quot;there should be a database plugin registered at this point but looks like it's not available, so evolution won't work. Please make sure you register a db plugin properly&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#161936" title="play.api.db.DBApi">api</a>.<a href="../DB.scala.html#154989" title="=&gt; List[(javax.sql.DataSource, String)]">datasources</a>.<span title="(f: (javax.sql.DataSource, String) =&gt; Unit)Unit">foreach</span> <a href="#161992" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="javax.sql.DataSource" id="161995">ds</a>, <a title="String" id="161996">db</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#161918" title="(ds: javax.sql.DataSource)(block: =&gt; Unit)Unit">withLock</a><span class="delimiter">(</span><a href="#161995" title="javax.sql.DataSource">ds</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]" id="162000">script</a> = <a href="#159131" title="(api: play.api.db.DBApi, path: java.io.File, applicationClassloader: java.lang.ClassLoader, db: String)Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">evolutionScript</a><span class="delimiter">(</span><a href="#161936" title="play.api.db.DBApi">api</a>, <a href="#161934" title="play.api.Application">app</a>.<a href="../../Application.scala.html#68039" title="=&gt; java.io.File">path</a>, <a href="#161934" title="play.api.Application">app</a>.<a href="../../Application.scala.html#68041" title="=&gt; java.lang.ClassLoader">classloader</a>, <a href="#161996" title="String">db</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#162000" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#161934" title="play.api.Application">app</a>.<a href="../../Application.scala.html#68045" title="=&gt; play.api.Mode.Mode">mode</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a href="../../Play.scala.html#10566" title="Unit">Mode</a>.<a href="../../Play.scala.html#68247" title="=&gt; play.api.Mode.Value">Test</a> =&gt; <a href="#12567" title="object play.api.db.evolutions.Evolutions">Evolutions</a>.<a href="#159129" title="(api: play.api.db.DBApi, db: String, script: Seq[play.api.db.evolutions.Script])Unit">applyScript</a><span class="delimiter">(</span><a href="#161936" title="play.api.db.DBApi">api</a>, <a href="#161996" title="String">db</a>, <a href="#162000" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../../Play.scala.html#10566" title="Unit">Mode</a>.<a href="../../Play.scala.html#68243" title="=&gt; play.api.Mode.Value">Dev</a> <span class="keyword">if</span> <a href="#161934" title="play.api.Application">app</a>.<a href="../../Application.scala.html#68060" title="=&gt; play.api.Configuration">configuration</a>.<a href="../../Configuration.scala.html#68340" title="(path: String)Option[Boolean]">getBoolean</a><span class="delimiter">(</span><span title="java.lang.String(&quot;applyEvolutions.&quot;)" class="string">&quot;applyEvolutions.&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161996" title="String">db</a><span class="delimiter">)</span>.<span title="(p: Boolean =&gt; Boolean)Option[Boolean]">filter</span><span class="delimiter">(</span><a href="#162003" title="Boolean">_</a> <span title="(x: Boolean)Boolean">==</span> <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span> =&gt; <a href="#12567" title="object play.api.db.evolutions.Evolutions">Evolutions</a>.<a href="#159129" title="(api: play.api.db.DBApi, db: String, script: Seq[play.api.db.evolutions.Script])Unit">applyScript</a><span class="delimiter">(</span><a href="#161936" title="play.api.db.DBApi">api</a>, <a href="#161996" title="String">db</a>, <a href="#162000" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../../Play.scala.html#10566" title="Unit">Mode</a>.<a href="../../Play.scala.html#68245" title="=&gt; play.api.Mode.Value">Prod</a> <span class="keyword">if</span> <a href="#161934" title="play.api.Application">app</a>.<a href="../../Application.scala.html#68060" title="=&gt; play.api.Configuration">configuration</a>.<a href="../../Configuration.scala.html#68340" title="(path: String)Option[Boolean]">getBoolean</a><span class="delimiter">(</span><span title="java.lang.String(&quot;applyEvolutions.&quot;)" class="string">&quot;applyEvolutions.&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161996" title="String">db</a><span class="delimiter">)</span>.<span title="(p: Boolean =&gt; Boolean)Option[Boolean]">filter</span><span class="delimiter">(</span><a href="#162009" title="Boolean">_</a> <span title="(x: Boolean)Boolean">==</span> <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span> =&gt; <a href="#12567" title="object play.api.db.evolutions.Evolutions">Evolutions</a>.<a href="#159129" title="(api: play.api.db.DBApi, db: String, script: Seq[play.api.db.evolutions.Script])Unit">applyScript</a><span class="delimiter">(</span><a href="#161936" title="play.api.db.DBApi">api</a>, <a href="#161996" title="String">db</a>, <a href="#162000" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../../Play.scala.html#10566" title="Nothing">Mode</a>.<a href="../../Play.scala.html#68245" title="=&gt; play.api.Mode.Value">Prod</a> =&gt; <span class="delimiter">{</span>
                <a href="../../Logger.scala.html#82396" title="(name: String)play.api.Logger">Logger</a><span class="delimiter">(</span><span title="java.lang.String(&quot;play&quot;)" class="string">&quot;play&quot;</span><span class="delimiter">)</span>.<a href="../../Logger.scala.html#82388" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Your production database [&quot;)" class="string">&quot;Your production database [&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161996" title="String">db</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;] needs evolutions! \012\012&quot;)" class="string">&quot;] needs evolutions! \n\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159130" title="(script: Seq[play.api.db.evolutions.Script])String">toHumanReadableScript</a><span class="delimiter">(</span><a href="#162000" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="../../Logger.scala.html#82396" title="(name: String)play.api.Logger">Logger</a><span class="delimiter">(</span><span title="java.lang.String(&quot;play&quot;)" class="string">&quot;play&quot;</span><span class="delimiter">)</span>.<a href="../../Logger.scala.html#82388" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Run with -DapplyEvolutions.&quot;)" class="string">&quot;Run with -DapplyEvolutions.&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#161996" title="String">db</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;=true if you want to run them automatically (be careful)&quot;)" class="string">&quot;=true if you want to run them automatically (be careful)&quot;</span><span class="delimiter">)</span>

                <span title="Nothing" class="keyword">throw</span> <a href="#163965" title="(db: String, script: String)play.api.db.evolutions.InvalidDatabaseRevision">InvalidDatabaseRevision</a><span class="delimiter">(</span><a href="#161996" title="String">db</a>, <a href="#159130" title="(script: Seq[play.api.db.evolutions.Script])String">toHumanReadableScript</a><span class="delimiter">(</span><a href="#162000" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
              <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#163965" title="(db: String, script: String)play.api.db.evolutions.InvalidDatabaseRevision">InvalidDatabaseRevision</a><span class="delimiter">(</span><a href="#161996" title="String">db</a>, <a href="#159130" title="(script: Seq[play.api.db.evolutions.Script])String">toHumanReadableScript</a><span class="delimiter">(</span><a href="#162000" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(ds: javax.sql.DataSource)(block: =&gt; Unit)Unit" id="161918">withLock</a><span class="delimiter">(</span><a title="javax.sql.DataSource" id="161997">ds</a>: <span title="javax.sql.DataSource">DataSource</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; Unit" id="161998">block</a>: =&gt; Unit<span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#161934" title="play.api.Application">app</a>.<a href="../../Application.scala.html#68060" title="=&gt; play.api.Configuration">configuration</a>.<a href="../../Configuration.scala.html#68340" title="(path: String)Option[Boolean]">getBoolean</a><span class="delimiter">(</span><span title="java.lang.String(&quot;evolutions.use.locks&quot;)" class="string">&quot;evolutions.use.locks&quot;</span><span class="delimiter">)</span>.<span title="(p: Boolean =&gt; Boolean)Option[Boolean]">filter</span><span class="delimiter">(</span><a href="#162068" title="Boolean">_</a> <span title="(x: Boolean)Boolean">==</span> <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.sql.Connection" id="162073">c</a> = <a href="#161997" title="javax.sql.DataSource">ds</a>.<span title="()java.sql.Connection">getConnection</span>
      <a href="#162073" title="java.sql.Connection">c</a>.<span title="(x$1: Boolean)Unit">setAutoCommit</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.sql.Statement" id="162074">s</a> = <a href="#162073" title="java.sql.Connection">c</a>.<span title="()java.sql.Statement">createStatement</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#161919" title="(c: java.sql.Connection, s: java.sql.Statement)Unit">createLockTableIfNecessary</a><span class="delimiter">(</span><a href="#162073" title="java.sql.Connection">c</a>, <a href="#162074" title="java.sql.Statement">s</a><span class="delimiter">)</span>
      <a href="#161920" title="(c: java.sql.Connection, s: java.sql.Statement, attempts: Int)Unit">lock</a><span class="delimiter">(</span><a href="#162073" title="java.sql.Connection">c</a>, <a href="#162074" title="java.sql.Statement">s</a><span class="delimiter">)</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#161998" title="=&gt; Unit">block</a>
      <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
        <a href="#161921" title="(c: java.sql.Connection, s: java.sql.Statement)Unit">unlock</a><span class="delimiter">(</span><a href="#162073" title="java.sql.Connection">c</a>, <a href="#162074" title="java.sql.Statement">s</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#161998" title="=&gt; Unit">block</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(c: java.sql.Connection, s: java.sql.Statement)Unit" id="161919">createLockTableIfNecessary</a><span class="delimiter">(</span><a title="java.sql.Connection" id="162079">c</a>: <span title="java.sql.Connection">Connection</span>, <a title="java.sql.Statement" id="162080">s</a>: <span title="java.sql.Statement">Statement</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.sql.ResultSet" id="162092">r</a> = <a href="#162080" title="java.sql.Statement">s</a>.<span title="(x$1: java.lang.String)java.sql.ResultSet">executeQuery</span><span class="delimiter">(</span><span title="java.lang.String(&quot;select lock from play_evolutions_lock&quot;)" class="string">&quot;select lock from play_evolutions_lock&quot;</span><span class="delimiter">)</span>
      <a href="#162092" title="java.sql.ResultSet">r</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="162093">e</a>: <span title="java.sql.SQLException">SQLException</span> =&gt;
        <a href="#162079" title="java.sql.Connection">c</a>.<span title="()Unit">rollback</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#162080" title="java.sql.Statement">s</a>.<span title="(x$1: java.lang.String)Boolean">execute</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012        create table play_evolutions_lock (\012          lock int not null primary key\012        )\012        &quot;)" class="string">&quot;&quot;&quot;
        create table play_evolutions_lock (
          lock int not null primary key
        )
        &quot;&quot;&quot;</span><span class="delimiter">)</span>
        <a href="#162080" title="java.sql.Statement">s</a>.<span title="(x$1: java.lang.String)Int">executeUpdate</span><span title="Unit" class="delimiter">(</span><span title="java.lang.String(&quot;insert into play_evolutions_lock (lock) values (1)&quot;)" class="string">&quot;insert into play_evolutions_lock (lock) values (1)&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(c: java.sql.Connection, s: java.sql.Statement, attempts: Int)Unit" id="161920">lock</a><span class="delimiter">(</span><a title="java.sql.Connection" id="162082">c</a>: <span title="java.sql.Connection">Connection</span>, <a title="java.sql.Statement" id="162083">s</a>: <span title="java.sql.Statement">Statement</span>, <a title="Int" id="162086">attempts</a>: <span title="Int">Int</span> = <span title="Int(5)" class="int">5</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#162083" title="java.sql.Statement">s</a>.<span title="(x$1: java.lang.String)java.sql.ResultSet">executeQuery</span><span title="Unit" class="delimiter">(</span><span title="java.lang.String(&quot;select lock from play_evolutions_lock where lock = 1 for update nowait&quot;)" class="string">&quot;select lock from play_evolutions_lock where lock = 1 for update nowait&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="162100">e</a>: <span title="java.sql.SQLException">SQLException</span> =&gt;
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#162086" title="Int">attempts</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <a href="#162100" title="java.sql.SQLException">e</a>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="../../Logger.scala.html#82396" title="(name: String)play.api.Logger">Logger</a><span class="delimiter">(</span><span title="java.lang.String(&quot;play&quot;)" class="string">&quot;play&quot;</span><span class="delimiter">)</span>.<a href="../../Logger.scala.html#82388" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Exception while attempting to lock evolutions (other node probably has lock), sleeping for 1 sec&quot;)" class="string">&quot;Exception while attempting to lock evolutions (other node probably has lock), sleeping for 1 sec&quot;</span><span class="delimiter">)</span>
          <a href="#162082" title="java.sql.Connection">c</a>.<span title="()Unit">rollback</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(1000L)" class="int">1000</span><span class="delimiter">)</span>
          <a href="#161920" title="(c: java.sql.Connection, s: java.sql.Statement, attempts: Int)Unit">lock</a><span class="delimiter">(</span><a href="#162082" title="java.sql.Connection">c</a>, <a href="#162083" title="java.sql.Statement">s</a>, <a href="#162086" title="Int">attempts</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(c: java.sql.Connection, s: java.sql.Statement)Unit" id="161921">unlock</a><span class="delimiter">(</span><a title="java.sql.Connection" id="162089">c</a>: <span title="java.sql.Connection">Connection</span>, <a title="java.sql.Statement" id="162090">s</a>: <span title="java.sql.Statement">Statement</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="(exceptions: Class[_]*)util.control.Exception.Catch[Unit]">ignoring</span><span title="(body: =&gt; Unit)Unit" class="delimiter">(</span>classOf<span title="java.lang.Class[java.sql.SQLException](classOf[java.sql.SQLException])" class="delimiter">[</span>SQLException<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#162090" title="java.sql.Statement">s</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="(exceptions: Class[_]*)util.control.Exception.Catch[Unit]">ignoring</span><span title="(body: =&gt; Unit)Unit" class="delimiter">(</span>classOf<span title="java.lang.Class[java.sql.SQLException](classOf[java.sql.SQLException])" class="delimiter">[</span>SQLException<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#162089" title="java.sql.Connection">c</a>.<span title="()Unit">commit</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="(exceptions: Class[_]*)util.control.Exception.Catch[Unit]">ignoring</span><span title="(body: =&gt; Unit)Unit" class="delimiter">(</span>classOf<span title="java.lang.Class[java.sql.SQLException](classOf[java.sql.SQLException])" class="delimiter">[</span>SQLException<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#162089" title="java.sql.Connection">c</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Can be used to run off-line evolutions, i.e. outside a running application.
 */</span>
<span class="keyword">object</span> <a title="object play.api.db.evolutions.OfflineEvolutions" id="12660">OfflineEvolutions</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="comment">/**
   * Computes and applies an evolutions script.
   *
   * @param classloader the classloader used to load the driver
   * @param dbName the database name
   */</span>
  <span class="keyword">def</span> <a title="(appPath: java.io.File, classloader: java.lang.ClassLoader, dbName: String)Unit" id="73202">applyScript</a><span class="delimiter">(</span><a title="java.io.File" id="73204">appPath</a>: <span title="java.io.File">File</span>, <a title="java.lang.ClassLoader" id="73205">classloader</a>: <span title="java.lang.ClassLoader">ClassLoader</span>, <a title="String" id="73206">dbName</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>

    <span class="keyword">import</span> play.api._

    <span class="keyword">val</span> <a title="play.api.Configuration" id="162518">c</a> = <a href="../../Configuration.scala.html#10662" title="object play.api.Configuration">Configuration</a>.<a href="../../Configuration.scala.html#68353" title="(appPath: java.io.File, mode: play.api.Mode.Mode)play.api.Configuration">load</a><span class="delimiter">(</span><a href="#73204" title="java.io.File">appPath</a><span class="delimiter">)</span>.<a href="../../Configuration.scala.html#68343" title="(path: String)Option[play.api.Configuration]">getConfig</a><span class="delimiter">(</span><span title="java.lang.String(&quot;db&quot;)" class="string">&quot;db&quot;</span><span class="delimiter">)</span>.<span title="=&gt; play.api.Configuration">get</span>

    <span class="keyword">val</span> <a title="play.api.db.BoneCPApi" id="162519">dbApi</a> = <span title="play.api.db.BoneCPApi" class="keyword">new</span> <a href="../DB.scala.html#12433" title="play.api.db.BoneCPApi">BoneCPApi</a><span class="delimiter">(</span><a href="#162518" title="play.api.Configuration">c</a>, <a href="#73205" title="java.lang.ClassLoader">classloader</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]" id="162520">script</a> = <a href="#12567" title="object play.api.db.evolutions.Evolutions">Evolutions</a>.<a href="#159131" title="(api: play.api.db.DBApi, path: java.io.File, applicationClassloader: java.lang.ClassLoader, db: String)Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">evolutionScript</a><span class="delimiter">(</span><a href="#162519" title="play.api.db.BoneCPApi">dbApi</a>, <a href="#73204" title="java.io.File">appPath</a>, <a href="#73205" title="java.lang.ClassLoader">classloader</a>, <a href="#73206" title="String">dbName</a><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="../../Play.scala.html#10608" title="object play.api.Play">Play</a>.<a href="../../Play.scala.html#72745" title="=&gt; Option[play.api.Application]">maybeApplication</a>.<span title="(p: play.api.Application =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#162523" title="play.api.Application">_</a>.<a href="../../Application.scala.html#68045" title="=&gt; play.api.Mode.Mode">mode</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../Play.scala.html#10566" title="object play.api.Mode">Mode</a>.<a href="../../Play.scala.html#68247" title="=&gt; play.api.Mode.Value">Test</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../Logger.scala.html#82396" title="(name: String)play.api.Logger">Logger</a><span class="delimiter">(</span><span title="java.lang.String(&quot;play&quot;)" class="string">&quot;play&quot;</span><span class="delimiter">)</span>.<a href="../../Logger.scala.html#82388" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Applying evolution script for database \'&quot;)" class="string">&quot;Applying evolution script for database '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#73206" title="String">dbName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\':\012\012&quot;)" class="string">&quot;':\n\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#12567" title="object play.api.db.evolutions.Evolutions">Evolutions</a>.<a href="#159130" title="(script: Seq[play.api.db.evolutions.Script])String">toHumanReadableScript</a><span class="delimiter">(</span><a href="#162520" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#12567" title="object play.api.db.evolutions.Evolutions">Evolutions</a>.<a href="#159129" title="(api: play.api.db.DBApi, db: String, script: Seq[play.api.db.evolutions.Script])Unit">applyScript</a><span class="delimiter">(</span><a href="#162519" title="play.api.db.BoneCPApi">dbApi</a>, <a href="#73206" title="String">dbName</a>, <a href="#162520" title="Seq[Product with java.io.Serializable with play.api.db.evolutions.Script]">script</a><span class="delimiter">)</span>

  <span class="delimiter">}</span>

  <span class="comment">/**
   * Resolve an inconsistent evolution..
   *
   * @param classloader the classloader used to load the driver
   * @param dbName the database name
   */</span>
  <span class="keyword">def</span> <a title="(appPath: java.io.File, classloader: java.lang.ClassLoader, dbName: String, revision: Int)Unit" id="73203">resolve</a><span class="delimiter">(</span><a title="java.io.File" id="162542">appPath</a>: <span title="java.io.File">File</span>, <a title="java.lang.ClassLoader" id="162543">classloader</a>: <span title="java.lang.ClassLoader">ClassLoader</span>, <a title="String" id="162544">dbName</a>: <span title="String">String</span>, <a title="Int" id="162545">revision</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span>

    <span class="keyword">import</span> play.api._

    <span class="keyword">val</span> <a title="play.api.Configuration" id="162548">c</a> = <a href="../../Configuration.scala.html#10662" title="object play.api.Configuration">Configuration</a>.<a href="../../Configuration.scala.html#68353" title="(appPath: java.io.File, mode: play.api.Mode.Mode)play.api.Configuration">load</a><span class="delimiter">(</span><a href="#162542" title="java.io.File">appPath</a><span class="delimiter">)</span>.<a href="../../Configuration.scala.html#68343" title="(path: String)Option[play.api.Configuration]">getConfig</a><span class="delimiter">(</span><span title="java.lang.String(&quot;db&quot;)" class="string">&quot;db&quot;</span><span class="delimiter">)</span>.<span title="=&gt; play.api.Configuration">get</span>

    <span class="keyword">val</span> <a title="play.api.db.BoneCPApi" id="162549">dbApi</a> = <span title="play.api.db.BoneCPApi" class="keyword">new</span> <a href="../DB.scala.html#12433" title="play.api.db.BoneCPApi">BoneCPApi</a><span class="delimiter">(</span><a href="#162548" title="play.api.Configuration">c</a>, <a href="#162543" title="java.lang.ClassLoader">classloader</a><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="../../Play.scala.html#10608" title="object play.api.Play">Play</a>.<a href="../../Play.scala.html#72745" title="=&gt; Option[play.api.Application]">maybeApplication</a>.<span title="(p: play.api.Application =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#162551" title="play.api.Application">_</a>.<a href="../../Application.scala.html#68045" title="=&gt; play.api.Mode.Mode">mode</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../Play.scala.html#10566" title="object play.api.Mode">Mode</a>.<a href="../../Play.scala.html#68247" title="=&gt; play.api.Mode.Value">Test</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../Logger.scala.html#82396" title="(name: String)play.api.Logger">Logger</a><span class="delimiter">(</span><span title="java.lang.String(&quot;play&quot;)" class="string">&quot;play&quot;</span><span class="delimiter">)</span>.<a href="../../Logger.scala.html#82388" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Resolving evolution [&quot;)" class="string">&quot;Resolving evolution [&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#162545" title="Int">revision</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;] for database \'&quot;)" class="string">&quot;] for database '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#162544" title="String">dbName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\'&quot;)" class="string">&quot;'&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#12567" title="object play.api.db.evolutions.Evolutions">Evolutions</a>.<a href="#159127" title="(api: play.api.db.DBApi, db: String, revision: Int)Unit">resolve</a><span class="delimiter">(</span><a href="#162549" title="play.api.db.BoneCPApi">dbApi</a>, <a href="#162544" title="String">dbName</a>, <a href="#162545" title="Int">revision</a><span class="delimiter">)</span>

  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Exception thrown when the database is not up to date.
 *
 * @param db the database name
 * @param script the script to be run to resolve the conflict.
 */</span>
case <span class="keyword">class</span> <a title="class InvalidDatabaseRevision extends play.api.PlayException with play.api.PlayException.ExceptionAttachment with play.api.PlayException.RichDescription with ScalaObject with Product with Serializable" id="163965">InvalidDatabaseRevision</a><a href="#163965" title="ScalaObject" class="delimiter">(</a><a title="String" id="162059">db</a>: <span title="String">String</span>, <a title="String" id="162060">script</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../Exceptions.scala.html#10664" title="play.api.PlayException">PlayException</a><span class="delimiter">(</span>
  <span title="java.lang.String(&quot;Database \'&quot;)" class="string">&quot;Database '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#162059" title="String">db</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\' needs evolution!&quot;)" class="string">&quot;' needs evolution!&quot;</span>,
  <span title="java.lang.String(&quot;An SQL script need to be run on your database.&quot;)" class="string">&quot;An SQL script need to be run on your database.&quot;</span>,
  <span title="object None">None</span><span class="delimiter">)</span> <span class="keyword">with</span> PlayException.<a href="../../Exceptions.scala.html#81985" title="play.api.PlayException.ExceptionAttachment">ExceptionAttachment</a> <span class="keyword">with</span> PlayException.<a href="../../Exceptions.scala.html#81986" title="play.api.PlayException.RichDescription">RichDescription</a> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="162052">subTitle</a> = <span title="java.lang.String(&quot;This SQL script must be run:&quot;)" class="string">&quot;This SQL script must be run:&quot;</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="162053">content</a> = <a href="#162060" title="=&gt; String">script</a>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="162054">javascript</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;
        document.location = '/@evolutions/apply/%s?redirect=' + encodeURIComponent(location)
    &quot;&quot;&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#162059" title="=&gt; String">db</a><span class="delimiter">)</span>.<span title="()java.lang.String">trim</span>

  <span class="keyword">def</span> <a title="=&gt; String" id="162056">htmlDescription</a> = <span class="delimiter">{</span>

    &lt;<a title="scala.xml.NodeBuffer" id="162849">span</a>&gt;<span title="scala.xml.Text">An</span> SQL script will be run on your database -&lt;/span&gt;
    &lt;<a title="scala.xml.MetaData" id="163002">input</a> name=<span title="scala.xml.Text" class="string">&quot;evolution-button&quot;</span> <span class="keyword">type</span>=<span title="scala.xml.Text" class="string">&quot;button&quot;</span> value=<span title="scala.xml.Text" class="string">&quot;Apply this script now!&quot;</span> onclick=<span class="delimiter">{</span> <a href="#162054" title="=&gt; java.lang.String">javascript</a> <span class="delimiter">}</span>/&gt;

  <span class="delimiter">}</span>.<span title="(f: scala.xml.Node =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[scala.xml.Node],String,scala.collection.mutable.ArrayBuffer[String]])scala.collection.mutable.ArrayBuffer[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,String,scala.collection.mutable.ArrayBuffer[String]]" class="delimiter">(</span><a href="#163152" title="scala.xml.Node">_</a>.<span title="()String">toString</span><span class="delimiter">)</span>.<span title="=&gt; String">mkString</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Exception thrown when the database is in inconsistent state.
 *
 * @param db the database name
 */</span>
case <span class="keyword">class</span> <a title="class InconsistentDatabase extends play.api.PlayException with play.api.PlayException.ExceptionAttachment with play.api.PlayException.RichDescription with ScalaObject with Product with Serializable" id="163981">InconsistentDatabase</a><a href="#163981" title="ScalaObject" class="delimiter">(</a><a title="String" id="159266">db</a>: <span title="String">String</span>, <a title="String" id="159267">script</a>: <span title="String">String</span>, <a title="String" id="159268">error</a>: <span title="String">String</span>, <a title="Int" id="159269">rev</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../Exceptions.scala.html#10664" title="play.api.PlayException">PlayException</a><span class="delimiter">(</span>
  <span title="java.lang.String(&quot;Database \'&quot;)" class="string">&quot;Database '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159266" title="String">db</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\' is in inconsistent state!&quot;)" class="string">&quot;' is in inconsistent state!&quot;</span>,
  <span title="java.lang.String(&quot;An evolution has not been applied properly. Please check the problem and resolve it manually before marking it as resolved.&quot;)" class="string">&quot;An evolution has not been applied properly. Please check the problem and resolve it manually before marking it as resolved.&quot;</span>,
  <span title="object None">None</span><span class="delimiter">)</span> <span class="keyword">with</span> PlayException.<a href="../../Exceptions.scala.html#81985" title="play.api.PlayException.ExceptionAttachment">ExceptionAttachment</a> <span class="keyword">with</span> PlayException.<a href="../../Exceptions.scala.html#81986" title="play.api.PlayException.RichDescription">RichDescription</a> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="159259">subTitle</a> = <span title="java.lang.String(&quot;We got the following error: &quot;)" class="string">&quot;We got the following error: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#159268" title="=&gt; String">error</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, while trying to run this SQL script:&quot;)" class="string">&quot;, while trying to run this SQL script:&quot;</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="159260">content</a> = <a href="#159267" title="=&gt; String">script</a>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="159261">javascript</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;
        document.location = '/@evolutions/resolve/%s/%s?redirect=' + encodeURIComponent(location)
    &quot;&quot;&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#159266" title="=&gt; String">db</a>, <a href="#159269" title="=&gt; Int">rev</a><span class="delimiter">)</span>.<span title="()java.lang.String">trim</span>

  <span class="keyword">def</span> <a title="=&gt; String" id="159263">htmlDescription</a>: <span title="String">String</span> = <span class="delimiter">{</span>

    &lt;<a title="scala.xml.NodeBuffer" id="163796">span</a>&gt;<span title="scala.xml.Text">An</span> evolution has not been applied properly. Please check the problem and resolve it manually before making it as resolved -&lt;/span&gt;
    &lt;<a title="scala.xml.MetaData" id="163797">input</a> name=<span title="scala.xml.Text" class="string">&quot;evolution-button&quot;</span> <span class="keyword">type</span>=<span title="scala.xml.Text" class="string">&quot;button&quot;</span> value=<span title="scala.xml.Text" class="string">&quot;Mark it resolved&quot;</span> onclick=<span class="delimiter">{</span> <a href="#159261" title="=&gt; java.lang.String">javascript</a> <span class="delimiter">}</span>/&gt;

  <span class="delimiter">}</span>.<span title="(f: scala.xml.Node =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[scala.xml.Node],String,scala.collection.mutable.ArrayBuffer[String]])scala.collection.mutable.ArrayBuffer[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,String,scala.collection.mutable.ArrayBuffer[String]]" class="delimiter">(</span><a href="#163833" title="scala.xml.Node">_</a>.<span title="()String">toString</span><span class="delimiter">)</span>.<span title="=&gt; String">mkString</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>