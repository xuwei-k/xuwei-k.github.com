<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>play/play/api/libs/concurrent/Promise.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> play.api.libs.concurrent

<span class="keyword">import</span> play.core._
<span class="keyword">import</span> play.api._

<span class="keyword">import</span> akka.actor._
<span class="keyword">import</span> akka.actor.<span title="object akka.actor.Actor">Actor</span>._

<span class="keyword">import</span> java.util.concurrent.<span class="delimiter">{</span> TimeUnit <span class="delimiter">}</span>

<span class="keyword">import</span> scala.collection.mutable.Builder
<span class="keyword">import</span> scala.collection._
<span class="keyword">import</span> scala.collection.generic.CanBuildFrom

<span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait PromiseValue[+A] extends java.lang.Object with ScalaObject" id="13292">PromiseValue</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="13537">A</a><span class="delimiter">]</span> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="78453">isDefined</a> = <a href="#13292" title="play.api.libs.concurrent.PromiseValue[A]" class="keyword">this</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a href="#174251" title="Boolean(false)">Waiting</a> =&gt; <span title="Boolean(false)" class="keyword">false</span>; <span class="keyword">case</span> <span title="Boolean(true)">_</span> =&gt; <span title="Boolean(true)" class="keyword">true</span> <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait NotWaiting[+A] extends java.lang.Object with play.api.libs.concurrent.PromiseValue[A] with ScalaObject" id="13313">NotWaiting</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="13538">A</a><span class="delimiter">]</span> <span title="ScalaObject" class="keyword">extends</span> <a href="#13292" title="play.api.libs.concurrent.PromiseValue[A]">PromiseValue</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="comment">/**
   * Return the value or the promise, throw it if it held an exception
   */</span>
  <span class="keyword">def</span> <a title="=&gt; A" id="78455">get</a>: <a href="#13538" title="A">A</a> = <a href="#13313" title="play.api.libs.concurrent.NotWaiting[A]" class="keyword">this</a> <span title="A" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Nothing">Thrown</span><span class="delimiter">(</span><a title="Throwable" id="174176">e</a><span class="delimiter">)</span> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#174176" title="Throwable">e</a>
    <span class="keyword">case</span> <span title="A">Redeemed</span><span class="delimiter">(</span><a title="A" id="174178">a</a><span class="delimiter">)</span> =&gt; <a href="#174178" title="A">a</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[B](onError: Throwable =&gt; B, onSuccess: A =&gt; B)B" id="78456">fold</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="78458">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Throwable =&gt; B" id="174179">onError</a>: Throwable =&gt; B, <a title="A =&gt; B" id="174180">onSuccess</a>: A =&gt; B<span class="delimiter">)</span>: <a href="#78458" title="B">B</a> = <a href="#13313" title="play.api.libs.concurrent.NotWaiting[A]" class="keyword">this</a> <span title="B" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="B">Thrown</span><span class="delimiter">(</span><a title="Throwable" id="174184">e</a><span class="delimiter">)</span> =&gt; <a href="#174179" title="(v1: Throwable)B">onError</a><span class="delimiter">(</span><a href="#174184" title="Throwable">e</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="B">Redeemed</span><span class="delimiter">(</span><a title="A" id="174187">r</a><span class="delimiter">)</span> =&gt; <a href="#174180" title="(v1: A)B">onSuccess</a><span class="delimiter">(</span><a href="#174187" title="A">r</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

case <span class="keyword">class</span> <a title="class Thrown extends java.lang.Object with play.api.libs.concurrent.NotWaiting[Nothing] with ScalaObject with Product with Serializable" id="176806">Thrown</a><a href="#176806" title="ScalaObject" class="delimiter">(</a><a title="Throwable" id="173465">e</a>: scala.<span title="Throwable">Throwable</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#13313" title="play.api.libs.concurrent.NotWaiting[Nothing]">NotWaiting</a><span class="delimiter">[</span>Nothing<span class="delimiter">]</span>
case <span class="keyword">class</span> <a title="class Redeemed[+A] extends java.lang.Object with play.api.libs.concurrent.NotWaiting[A] with ScalaObject with Product with Serializable" id="176802">Redeemed</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="102870">A</a><span class="delimiter">]</span><a href="#176802" title="ScalaObject" class="delimiter">(</a><a title="A" id="173510">a</a>: <a href="#102870" title="A">A</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#13313" title="play.api.libs.concurrent.NotWaiting[A]">NotWaiting</a><span class="delimiter">[</span>A<span class="delimiter">]</span>
case <span class="keyword">object</span> <a href="#174246" title="object play.api.libs.concurrent.Waiting" id="174251">Waiting</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#13292" title="play.api.libs.concurrent.PromiseValue[Nothing]">PromiseValue</a><span class="delimiter">[</span>Nothing<span class="delimiter">]</span>

<span class="keyword">trait</span> <a title="trait Promise[+A] extends java.lang.Object with ScalaObject" id="13304">Promise</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="13540">A</a><span class="delimiter">]</span> <span title="ScalaObject" class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(k: A =&gt; Unit)Unit" id="77003">onRedeem</a><span class="delimiter">(</span><a title="A =&gt; Unit" id="173441">k</a>: A =&gt; Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span>

  <span class="keyword">def</span> <a title="[AA &gt;: A](pf: PartialFunction[Throwable,AA])play.api.libs.concurrent.Promise[AA]" id="77004">recover</a> <span class="delimiter">[</span><a title="&gt;: A &lt;: Any" id="77006">AA</a> &gt;: A<span class="delimiter">]</span> <span class="delimiter">(</span><a title="PartialFunction[Throwable,AA]" id="174254">pf</a>: <span title="PartialFunction[Throwable,AA]">PartialFunction</span><span class="delimiter">[</span>Throwable, AA<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[AA]">Promise</a><span class="delimiter">[</span>AA<span class="delimiter">]</span> = <a href="#77010" title="(k: play.api.libs.concurrent.NotWaiting[A] =&gt; AA)play.api.libs.concurrent.Promise[AA]">extend1</a><a href="#174260" title="AA" class="delimiter">{</a>
    <span class="keyword">case</span> <span title="AA">Thrown</span><span class="delimiter">(</span><a title="Throwable" id="174261">e</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#174254" title="PartialFunction[Throwable,AA]">pf</a>.<span title="(x: Throwable)Boolean">isDefinedAt</span><span class="delimiter">(</span><a href="#174261" title="Throwable">e</a><span class="delimiter">)</span> =&gt; <a href="#174254" title="(v1: Throwable)AA">pf</a><span class="delimiter">(</span><a href="#174261" title="Throwable">e</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="Nothing">Thrown</span><span class="delimiter">(</span><a title="Throwable" id="174264">e</a><span class="delimiter">)</span> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#174264" title="Throwable">e</a>
    <span class="keyword">case</span> <span title="A">Redeemed</span><span class="delimiter">(</span><a title="A" id="174266">a</a><span class="delimiter">)</span> =&gt; <a href="#174266" title="A">a</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[B](k: play.api.libs.concurrent.Promise[A] =&gt; B)play.api.libs.concurrent.Promise[B]" id="77007">extend</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="77009">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A] =&gt; B" id="173481">k</a>: <span title="play.api.libs.concurrent.Promise[A] =&gt; B">Function1</span><span class="delimiter">[</span>Promise<span class="delimiter">[</span>A<span class="delimiter">]</span>, B<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="[B](k: play.api.libs.concurrent.NotWaiting[A] =&gt; B)play.api.libs.concurrent.Promise[B]" id="77010">extend1</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="77012">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.libs.concurrent.NotWaiting[A] =&gt; B" id="102858">k</a>: <span title="play.api.libs.concurrent.NotWaiting[A] =&gt; B">Function1</span><span class="delimiter">[</span>NotWaiting<span class="delimiter">[</span>A<span class="delimiter">]</span>, B<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span> = <a href="#77007" title="[B](k: play.api.libs.concurrent.Promise[A] =&gt; B)play.api.libs.concurrent.Promise[B]">extend</a><span title="(k: play.api.libs.concurrent.Promise[A] =&gt; B)play.api.libs.concurrent.Promise[B]" class="delimiter">[</span><a href="#77012" title="B">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A]" id="174270">p</a> =&gt; <a href="#102858" title="(v1: play.api.libs.concurrent.NotWaiting[A])B">k</a><span class="delimiter">(</span><a href="#174270" title="play.api.libs.concurrent.Promise[A]">p</a>.<a href="#77013" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">value</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; play.api.libs.concurrent.NotWaiting[A]" id="77013">value</a> = <a href="#77014" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">await</a>

  <span class="keyword">def</span> <a title="=&gt; play.api.libs.concurrent.NotWaiting[A]" id="77014">await</a>: <a href="#13313" title="play.api.libs.concurrent.NotWaiting[A]">NotWaiting</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <a href="#77015" title="(timeout: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.NotWaiting[A]">await</a><span class="delimiter">(</span><span title="Long(5000L)" class="int">5000</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(timeout: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.NotWaiting[A]" id="77015">await</a><span class="delimiter">(</span><a title="Long" id="78459">timeout</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="78462">unit</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span> = TimeUnit.<span title="java.util.concurrent.TimeUnit(value MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>: <a href="#13313" title="play.api.libs.concurrent.NotWaiting[A]">NotWaiting</a><span class="delimiter">[</span>A<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="(p: A =&gt; Boolean)play.api.libs.concurrent.Promise[A]" id="77016">filter</a><span class="delimiter">(</span><a title="A =&gt; Boolean" id="173717">p</a>: A =&gt; Boolean<span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="[B](f: A =&gt; B)play.api.libs.concurrent.Promise[B]" id="77017">map</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="77019">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A =&gt; B" id="102815">f</a>: A =&gt; B<span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="[B](f: A =&gt; play.api.libs.concurrent.Promise[B])play.api.libs.concurrent.Promise[B]" id="77020">flatMap</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="77022">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A =&gt; play.api.libs.concurrent.Promise[B]" id="77029">f</a>: A =&gt; Promise<span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="[B](other: play.api.libs.concurrent.Promise[B])play.api.libs.concurrent.Promise[Either[A,B]]" id="77023">or</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="77025">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[B]" id="174276">other</a>: <a href="#13304" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[Either[A,B]]">Promise</a><span class="delimiter">[</span>Either<span class="delimiter">[</span>A, B<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">import</span> scala.concurrent.stm._

    <span class="keyword">val</span> <a title="Promise extends play.api.libs.concurrent.Promise[Either[A,B]] with play.api.libs.concurrent.Redeemable[Either[A,B]]" id="174280">p</a> = <a href="#79471" title="[A]()play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]">Promise</a><span title="()play.api.libs.concurrent.Promise[Either[A,B]] with play.api.libs.concurrent.Redeemable[Either[A,B]]" class="delimiter">[</span><span title="Either[A,B]">Either</span><span class="delimiter">[</span>A, B<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.concurrent.stm.Ref[Boolean]" id="174281">ref</a> = <span title="(initialValue: Boolean)scala.concurrent.stm.Ref[Boolean]">Ref</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
    <a href="#13304" title="Promise.this.type" class="keyword">this</a>.<a href="#77010" title="(k: play.api.libs.concurrent.NotWaiting[A] =&gt; Unit)play.api.libs.concurrent.Promise[Unit]">extend1</a> <span class="delimiter">{</span> <a title="play.api.libs.concurrent.NotWaiting[A]" id="174880">v</a> =&gt;
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#174281" title="scala.concurrent.stm.Ref[Boolean]">ref</a>.<span title="()Boolean">single</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Boolean" id="174969">iRedeemed</a> = <a href="#174281" title="scala.concurrent.stm.Ref[Boolean]">ref</a>.<span title="=&gt; scala.concurrent.stm.Ref.View[Boolean]">single</span>.<span title="(f: Boolean =&gt; Boolean)Boolean">getAndTransform</span><span class="delimiter">(</span><a title="Boolean" id="174972">_</a> =&gt; <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span> <a href="#174969" title="Boolean">iRedeemed</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#174880" title="play.api.libs.concurrent.NotWaiting[A]">v</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit">Redeemed</span><span class="delimiter">(</span><a title="A" id="174974">a</a><span class="delimiter">)</span> =&gt;
            <a href="#174280" title="Promise extends play.api.libs.concurrent.Promise[Either[A,B]] with play.api.libs.concurrent.Redeemable[Either[A,B]]">p</a>.<a href="#102784" title="(a: =&gt; Either[A,B])Unit">redeem</a><span class="delimiter">(</span><span title="(a: A)Left[A,Nothing]">Left</span><span class="delimiter">(</span><a href="#174974" title="A">a</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit">Thrown</span><span class="delimiter">(</span><a title="Throwable" id="174980">e</a><span class="delimiter">)</span> =&gt;
            <a href="#174280" title="Promise extends play.api.libs.concurrent.Promise[Either[A,B]] with play.api.libs.concurrent.Redeemable[Either[A,B]]">p</a>.<a href="#102785" title="(t: Throwable)Unit">throwing</a><span class="delimiter">(</span><a href="#174980" title="Throwable">e</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
                        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#174276" title="play.api.libs.concurrent.Promise[B]">other</a>.<a href="#77010" title="(k: play.api.libs.concurrent.NotWaiting[B] =&gt; Unit)play.api.libs.concurrent.Promise[Unit]">extend1</a> <span class="delimiter">{</span> <a title="play.api.libs.concurrent.NotWaiting[B]" id="174986">v</a> =&gt;
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#174281" title="scala.concurrent.stm.Ref[Boolean]">ref</a>.<span title="()Boolean">single</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Boolean" id="174987">iRedeemed</a> = <a href="#174281" title="scala.concurrent.stm.Ref[Boolean]">ref</a>.<span title="=&gt; scala.concurrent.stm.Ref.View[Boolean]">single</span>.<span title="(f: Boolean =&gt; Boolean)Boolean">getAndTransform</span><span class="delimiter">(</span><a title="Boolean" id="174989">_</a> =&gt; <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span> <a href="#174987" title="Boolean">iRedeemed</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#174986" title="play.api.libs.concurrent.NotWaiting[B]">v</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit">Redeemed</span><span class="delimiter">(</span><a title="B" id="174991">a</a><span class="delimiter">)</span> =&gt;
            <a href="#174280" title="Promise extends play.api.libs.concurrent.Promise[Either[A,B]] with play.api.libs.concurrent.Redeemable[Either[A,B]]">p</a>.<a href="#102784" title="(a: =&gt; Either[A,B])Unit">redeem</a><span class="delimiter">(</span><span title="(b: B)Right[Nothing,B]">Right</span><span class="delimiter">(</span><a href="#174991" title="B">a</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit">Thrown</span><span class="delimiter">(</span><a title="Throwable" id="174996">e</a><span class="delimiter">)</span> =&gt;
            <a href="#174280" title="Promise extends play.api.libs.concurrent.Promise[Either[A,B]] with play.api.libs.concurrent.Redeemable[Either[A,B]]">p</a>.<a href="#102785" title="(t: Throwable)Unit">throwing</a><span class="delimiter">(</span><a href="#174996" title="Throwable">e</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
                        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#174280" title="Promise extends play.api.libs.concurrent.Promise[Either[A,B]] with play.api.libs.concurrent.Redeemable[Either[A,B]]">p</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[B](message: =&gt; B, duration: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.Promise[Either[A,B]]" id="77026">orTimeout</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="175004">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; B" id="174998">message</a>: =&gt; B, <a title="Long" id="174999">duration</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="175002">unit</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span> = TimeUnit.<span title="java.util.concurrent.TimeUnit(value MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[Either[A,B]]">Promise</a><span class="delimiter">[</span>Either<span class="delimiter">[</span>A, B<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#77023" title="(other: play.api.libs.concurrent.Promise[B])play.api.libs.concurrent.Promise[Either[A,B]]">or</a><span class="delimiter">(</span><a href="#13305" title="object play.api.libs.concurrent.Promise">Promise</a>.<a href="#79477" title="(message: =&gt; B, duration: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.Promise[B]">timeout</a><span class="delimiter">(</span><a href="#174998" title="=&gt; B">message</a>, <a href="#174999" title="Long">duration</a>, <a href="#175002" title="java.util.concurrent.TimeUnit">unit</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait Redeemable[-A] extends java.lang.Object" id="13448">Redeemable</a><span class="delimiter">[</span>-<a title="&gt;: Nothing &lt;: Any" id="13541">A</a><span class="delimiter">]</span> <span title="java.lang.Object" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(a: =&gt; A)Unit" id="102784">redeem</a><span class="delimiter">(</span><a title="=&gt; A" id="102805">a</a>: =&gt; A<span class="delimiter">)</span>: <span title="Unit">Unit</span>
  <span class="keyword">def</span> <a title="(t: Throwable)Unit" id="102785">throwing</a><span class="delimiter">(</span><a title="Throwable" id="173773">t</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>: <span title="Unit">Unit</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class STMPromise[A] extends java.lang.Object with play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A] with ScalaObject" id="13409">STMPromise</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="13542">A</a><span class="delimiter">]</span> <a href="#13409" title="ScalaObject" class="keyword">extends</a> <a href="#13304" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#13448" title="play.api.libs.concurrent.Redeemable[A]">Redeemable</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> scala.concurrent.stm._

  <span class="keyword">val</span> <a title="scala.concurrent.stm.Ref[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]" id="175047">actions</a>: <span title="scala.concurrent.stm.Ref[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]">Ref</span><span class="delimiter">[</span>List<span class="delimiter">[</span>Promise<span class="delimiter">[</span>A<span class="delimiter">]</span> =&gt; Unit<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="(initialValue: List[play.api.libs.concurrent.Promise[A] =&gt; Unit])(implicit om: scala.reflect.OptManifest[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]])scala.concurrent.stm.Ref[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]">Ref</span><span title="(clazz: java.lang.Class[_], arg1: scala.reflect.OptManifest[_], args: scala.reflect.OptManifest[_]*)scala.reflect.ClassManifest[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]" class="delimiter">(</span>List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="scala.concurrent.stm.Ref[play.api.libs.concurrent.PromiseValue[A]]" id="175050">redeemed</a>: <span title="scala.concurrent.stm.Ref[play.api.libs.concurrent.PromiseValue[A]]">Ref</span><span class="delimiter">[</span>PromiseValue<span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="(initialValue: play.api.libs.concurrent.PromiseValue[A])(implicit om: scala.reflect.OptManifest[play.api.libs.concurrent.PromiseValue[A]])scala.concurrent.stm.Ref[play.api.libs.concurrent.PromiseValue[A]]">Ref</span><span title="(clazz: java.lang.Class[_], arg1: scala.reflect.OptManifest[_], args: scala.reflect.OptManifest[_]*)scala.reflect.ClassManifest[play.api.libs.concurrent.PromiseValue[A]]" class="delimiter">(</span><a href="#174251" title="object play.api.libs.concurrent.Waiting">Waiting</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="[B](k: play.api.libs.concurrent.Promise[A] =&gt; B)play.api.libs.concurrent.Promise[B]" id="175052">extend</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="175054">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A] =&gt; B" id="175234">k</a>: <span title="play.api.libs.concurrent.Promise[A] =&gt; B">Function1</span><span class="delimiter">[</span>Promise<span class="delimiter">[</span>A<span class="delimiter">]</span>, B<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.libs.concurrent.STMPromise[B]" id="175240">result</a> = <span title="play.api.libs.concurrent.STMPromise[B]" class="keyword">new</span> <a href="#13409" title="play.api.libs.concurrent.STMPromise[B]">STMPromise</a><span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#175060" title="(k: play.api.libs.concurrent.Promise[A] =&gt; Unit)Unit">addAction</a><span class="delimiter">{</span> <a title="play.api.libs.concurrent.Promise[A]" id="175244">p</a> =&gt;
      <span class="keyword">val</span> <a title="Either[Throwable,B]" id="175245">bOrExc</a> = scala.util.control.<span title="object scala.util.control.Exception">Exception</span>.<span title="[T]=&gt; util.control.Exception.Catch[T]">allCatch</span><span title="util.control.Exception.Catch[B]" class="delimiter">[</span><a href="#175054" title="B">B</a><span class="delimiter">]</span>.<span title="(body: =&gt; B)Either[Throwable,B]">either</span><span class="delimiter">(</span><a href="#175234" title="(v1: play.api.libs.concurrent.Promise[A])B">k</a><span class="delimiter">(</span><a href="#175244" title="play.api.libs.concurrent.Promise[A]">p</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#175245" title="Either[Throwable,B]">bOrExc</a>.<span title="(fa: Throwable =&gt; Unit, fb: B =&gt; Unit)Unit">fold</span><span class="delimiter">(</span> <a title="Throwable" id="175258">e</a> =&gt; <a href="#175240" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#175066" title="(t: Throwable)Unit">throwing</a><span class="delimiter">(</span><a href="#175258" title="Throwable">e</a><span class="delimiter">)</span>, <a title="B" id="175262">b</a> =&gt; <a href="#175240" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#175065" title="(body: =&gt; B)Unit">redeem</a><span class="delimiter">(</span><a href="#175262" title="B">b</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#175240" title="play.api.libs.concurrent.STMPromise[B]">result</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(p: A =&gt; Boolean)play.api.libs.concurrent.Promise[A]" id="175055">filter</a><span class="delimiter">(</span><a title="A =&gt; Boolean" id="175270">p</a>: A =&gt; Boolean<span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.libs.concurrent.STMPromise[A]" id="175273">result</a> = <span title="play.api.libs.concurrent.STMPromise[A]" class="keyword">new</span> <a href="#13409" title="play.api.libs.concurrent.STMPromise[A]">STMPromise</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#175059" title="(k: A =&gt; Unit)Unit">onRedeem</a><span class="delimiter">(</span><a title="A" id="175278">a</a> =&gt; <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#175270" title="(v1: A)Boolean">p</a><span class="delimiter">(</span><a href="#175278" title="A">a</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#175273" title="play.api.libs.concurrent.STMPromise[A]">result</a>.<a href="#175065" title="(body: =&gt; A)Unit">redeem</a><span class="delimiter">(</span><a href="#175278" title="A">a</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#175273" title="play.api.libs.concurrent.STMPromise[A]">result</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[B](p: PartialFunction[A,B])play.api.libs.concurrent.STMPromise[B]" id="175056">collect</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="175058">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="PartialFunction[A,B]" id="175281">p</a>: <span title="PartialFunction[A,B]">PartialFunction</span><span class="delimiter">[</span>A, B<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.libs.concurrent.STMPromise[B]" id="175284">result</a> = <span title="play.api.libs.concurrent.STMPromise[B]" class="keyword">new</span> <a href="#13409" title="play.api.libs.concurrent.STMPromise[B]">STMPromise</a><span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#175059" title="(k: A =&gt; Unit)Unit">onRedeem</a><span class="delimiter">(</span><a title="A" id="175286">a</a> =&gt; <a href="#175281" title="PartialFunction[A,B]">p</a>.<span title="(v1: A)Option[B]">lift</span><span class="delimiter">(</span><a href="#175286" title="A">a</a><span class="delimiter">)</span>.<span title="(f: B =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#175284" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#175065" title="(body: =&gt; B)Unit">redeem</a><span class="delimiter">(</span><a href="#175292" title="B">_</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#175284" title="play.api.libs.concurrent.STMPromise[B]">result</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(k: A =&gt; Unit)Unit" id="175059">onRedeem</a><span class="delimiter">(</span><a title="A =&gt; Unit" id="175274">k</a>: A =&gt; Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#175060" title="(k: play.api.libs.concurrent.Promise[A] =&gt; Unit)Unit">addAction</a><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A]" id="175298">p</a> =&gt; <a href="#175298" title="play.api.libs.concurrent.Promise[A]">p</a>.<a href="#77013" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">value</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span> <span class="keyword">case</span> <span title="Unit">Redeemed</span><span class="delimiter">(</span><a title="A" id="175300">a</a><span class="delimiter">)</span> =&gt; <a href="#175274" title="(v1: A)Unit">k</a><span class="delimiter">(</span><a href="#175300" title="A">a</a><span class="delimiter">)</span>; <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(k: play.api.libs.concurrent.Promise[A] =&gt; Unit)Unit" id="175060">addAction</a><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A] =&gt; Unit" id="175241">k</a>: Promise<span class="delimiter">[</span>A<span class="delimiter">]</span> =&gt; Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#175050" title="=&gt; scala.concurrent.stm.Ref[play.api.libs.concurrent.PromiseValue[A]]">redeemed</a>.<span title="()play.api.libs.concurrent.PromiseValue[A]">single</span><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="#78453" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#175062" title="(a: play.api.libs.concurrent.STMPromise[A], k: play.api.libs.concurrent.STMPromise[A] =&gt; Unit)Unit">invoke</a><span class="delimiter">(</span><a href="#13409" title="play.api.libs.concurrent.STMPromise[A]" class="keyword">this</a>, <a href="#175241" title="play.api.libs.concurrent.Promise[A] =&gt; Unit">k</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Boolean" id="175313">ok</a>: <span title="Boolean">Boolean</span> = <span title="(block: scala.concurrent.stm.InTxn =&gt; Boolean)(implicit mt: scala.concurrent.stm.MaybeTxn)Boolean">atomic</span> <span title="=&gt; scala.concurrent.stm.TxnUnknown.type" class="delimiter">{</span> <span class="keyword">implicit</span> <a title="scala.concurrent.stm.InTxn" id="175372">txn</a> =&gt;
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#175050" title="()(implicit txn: scala.concurrent.stm.InTxn)play.api.libs.concurrent.PromiseValue[A]">redeemed</a><a href="#175372" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><span class="delimiter">)</span>.<a href="#78453" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#175047" title="(v: List[play.api.libs.concurrent.Promise[A] =&gt; Unit])(implicit txn: scala.concurrent.stm.InTxn)Unit">actions</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#175047" title="()(implicit txn: scala.concurrent.stm.InTxn)List[play.api.libs.concurrent.Promise[A] =&gt; Unit]">actions</a><a href="#175372" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><span class="delimiter">)</span> <span title="(elem: play.api.libs.concurrent.Promise[A] =&gt; Unit)(implicit bf: scala.collection.generic.CanBuildFrom[List[play.api.libs.concurrent.Promise[A] =&gt; Unit],play.api.libs.concurrent.Promise[A] =&gt; Unit,List[play.api.libs.concurrent.Promise[A] =&gt; Unit]])List[play.api.libs.concurrent.Promise[A] =&gt; Unit]">:+</span> <a href="#175241" title="play.api.libs.concurrent.Promise[A] =&gt; Unit">k</a>; <span title="Boolean(true)" class="keyword">true</span> <span class="delimiter">}</span>
        <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#175313" title="Boolean">ok</a><span class="delimiter">)</span> <a href="#175062" title="(a: play.api.libs.concurrent.STMPromise[A], k: play.api.libs.concurrent.STMPromise[A] =&gt; Unit)Unit">invoke</a><span class="delimiter">(</span><a href="#13409" title="play.api.libs.concurrent.STMPromise[A]" class="keyword">this</a>, <a href="#175241" title="play.api.libs.concurrent.Promise[A] =&gt; Unit">k</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(timeout: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.NotWaiting[A]" id="175061">await</a><span class="delimiter">(</span><a title="Long" id="175436">timeout</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="175440">unit</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span> = TimeUnit.<span title="java.util.concurrent.TimeUnit(value MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>: <a href="#13313" title="play.api.libs.concurrent.NotWaiting[A]">NotWaiting</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="(block: scala.concurrent.stm.InTxn =&gt; play.api.libs.concurrent.NotWaiting[A])(implicit mt: scala.concurrent.stm.MaybeTxn)play.api.libs.concurrent.NotWaiting[A]">atomic</span> <span title="=&gt; scala.concurrent.stm.TxnUnknown.type" class="delimiter">{</span> <span class="keyword">implicit</span> <a title="scala.concurrent.stm.InTxn" id="175444">txn</a> =&gt;
      <span title="play.api.libs.concurrent.NotWaiting[A]" class="keyword">if</span> <span class="delimiter">(</span><a href="#175050" title="()(implicit txn: scala.concurrent.stm.InTxn)play.api.libs.concurrent.PromiseValue[A]">redeemed</a><a href="#175444" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#174251" title="object play.api.libs.concurrent.Waiting">Waiting</a><span class="delimiter">)</span> <a href="#175050" title="()(implicit txn: scala.concurrent.stm.InTxn)play.api.libs.concurrent.PromiseValue[A]">redeemed</a><a href="#175444" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="play.api.libs.concurrent.NotWaiting[A]" class="delimiter">[</span><a href="#13313" title="play.api.libs.concurrent.NotWaiting[A]">NotWaiting</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">]</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span title="(timeout: Long, unit: scala.actors.threadpool.TimeUnit)(implicit txn: scala.concurrent.stm.InTxn)Unit">retryFor</span><a href="#175444" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><a href="#175440" title="java.util.concurrent.TimeUnit">unit</a>.<span title="(x$1: Long)Long">toNanos</span><span class="delimiter">(</span><a href="#175436" title="Long">timeout</a><span class="delimiter">)</span>, scala.actors.threadpool.<span title="object scala.actors.threadpool.TimeUnit">TimeUnit</span>.<span title="scala.actors.threadpool.TimeUnit">NANOSECONDS</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.util.concurrent.TimeoutException" class="keyword">new</span> java.util.concurrent.<span title="java.util.concurrent.TimeoutException">TimeoutException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Promise timed out after &quot;)" class="string">&quot;Promise timed out after &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#175436" title="Long">timeout</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; : &quot;)" class="string">&quot; : &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#175440" title="java.util.concurrent.TimeUnit">unit</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](a: T, k: T =&gt; Unit)Unit" id="175062">invoke</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="175064">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="T" id="175303">a</a>: <a href="#175064" title="T">T</a>, <a title="T =&gt; Unit" id="175304">k</a>: T =&gt; Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = akka.dispatch.<span title="(body: =&gt; Unit)(implicit executor: akka.dispatch.ExecutionContext)akka.dispatch.Future[Unit]">Future</span><span class="delimiter">{</span> <a href="#175304" title="(v1: T)Unit">k</a><span class="delimiter">(</span><a href="#175303" title="T">a</a><span class="delimiter">)</span> <span class="delimiter">}</span><span title="Unit" class="delimiter">(</span>play.core.<a href="../../../core/system/Invoker.scala.html#17864" title="object play.core.Invoker">Invoker</a>.<a href="../../../core/system/Invoker.scala.html#79778" title="=&gt; akka.dispatch.MessageDispatcher">promiseDispatcher</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(body: =&gt; A)Unit" id="175065">redeem</a><span class="delimiter">(</span><a title="=&gt; A" id="175263">body</a>: =&gt; A<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Either[Throwable,A]" id="176201">result</a> = scala.util.control.<span title="object scala.util.control.Exception">Exception</span>.<span title="[T]=&gt; util.control.Exception.Catch[T]">allCatch</span><span title="util.control.Exception.Catch[A]" class="delimiter">[</span><a href="#13542" title="A">A</a><span class="delimiter">]</span>.<span title="(body: =&gt; A)Either[Throwable,A]">either</span><span class="delimiter">(</span><a href="#175263" title="=&gt; A">body</a><span class="delimiter">)</span>
    <span title="(block: scala.concurrent.stm.InTxn =&gt; Unit)(implicit mt: scala.concurrent.stm.MaybeTxn)Unit">atomic</span> <span title="=&gt; scala.concurrent.stm.TxnUnknown.type" class="delimiter">{</span> <span class="keyword">implicit</span> <a title="scala.concurrent.stm.InTxn" id="176210">txn</a> =&gt;
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#175050" title="()(implicit txn: scala.concurrent.stm.InTxn)play.api.libs.concurrent.PromiseValue[A]">redeemed</a><a href="#176210" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><span class="delimiter">)</span>.<a href="#78453" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span> sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;already redeemed&quot;)" class="string">&quot;already redeemed&quot;</span><span class="delimiter">)</span>
      <a href="#175050" title="(v: play.api.libs.concurrent.PromiseValue[A])(implicit txn: scala.concurrent.stm.InTxn)Unit">redeemed</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#176201" title="Either[Throwable,A]">result</a>.<span title="(fa: Throwable =&gt; Product with play.api.libs.concurrent.NotWaiting[A] with Serializable, fb: A =&gt; Product with play.api.libs.concurrent.NotWaiting[A] with Serializable)Product with play.api.libs.concurrent.NotWaiting[A] with Serializable">fold</span><span class="delimiter">(</span><a href="#176806" title="(e: Throwable)play.api.libs.concurrent.Thrown">Thrown</a><span class="delimiter">(</span><a href="#176219" title="Throwable">_</a><span class="delimiter">)</span>, <a href="#176802" title="(a: A)play.api.libs.concurrent.Redeemed[A]">Redeemed</a><span class="delimiter">(</span><a href="#176222" title="A">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#175047" title="=&gt; scala.concurrent.stm.Ref[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]">actions</a>.<span title="=&gt; scala.concurrent.stm.Ref.View[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]">single</span>.<span title="(v: List[play.api.libs.concurrent.Promise[A] =&gt; Unit])List[play.api.libs.concurrent.Promise[A] =&gt; Unit]">swap</span><span class="delimiter">(</span>List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: play.api.libs.concurrent.Promise[A] =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#175062" title="(a: play.api.libs.concurrent.STMPromise[A], k: play.api.libs.concurrent.STMPromise[A] =&gt; Unit)Unit">invoke</a><span class="delimiter">(</span><a href="#13409" title="play.api.libs.concurrent.STMPromise[A]" class="keyword">this</a>, <a href="#176270" title="play.api.libs.concurrent.Promise[A] =&gt; Unit">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(t: Throwable)Unit" id="175066">throwing</a><span class="delimiter">(</span><a title="Throwable" id="175259">t</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="(block: scala.concurrent.stm.InTxn =&gt; Unit)(implicit mt: scala.concurrent.stm.MaybeTxn)Unit">atomic</span> <span title="=&gt; scala.concurrent.stm.TxnUnknown.type" class="delimiter">{</span> <span class="keyword">implicit</span> <a title="scala.concurrent.stm.InTxn" id="176280">txn</a> =&gt;
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#175050" title="()(implicit txn: scala.concurrent.stm.InTxn)play.api.libs.concurrent.PromiseValue[A]">redeemed</a><a href="#176280" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><span class="delimiter">)</span>.<a href="#78453" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span> sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;already redeemed&quot;)" class="string">&quot;already redeemed&quot;</span><span class="delimiter">)</span>
      <a href="#175050" title="(v: play.api.libs.concurrent.PromiseValue[A])(implicit txn: scala.concurrent.stm.InTxn)Unit">redeemed</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#176806" title="(e: Throwable)play.api.libs.concurrent.Thrown">Thrown</a><span class="delimiter">(</span><a href="#175259" title="Throwable">t</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#175047" title="=&gt; scala.concurrent.stm.Ref[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]">actions</a>.<span title="=&gt; scala.concurrent.stm.Ref.View[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]">single</span>.<span title="(v: List[play.api.libs.concurrent.Promise[A] =&gt; Unit])List[play.api.libs.concurrent.Promise[A] =&gt; Unit]">swap</span><span class="delimiter">(</span>List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: play.api.libs.concurrent.Promise[A] =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#175062" title="(a: play.api.libs.concurrent.STMPromise[A], k: play.api.libs.concurrent.STMPromise[A] =&gt; Unit)Unit">invoke</a><span class="delimiter">(</span><a href="#13409" title="play.api.libs.concurrent.STMPromise[A]" class="keyword">this</a>, <a href="#176310" title="play.api.libs.concurrent.Promise[A] =&gt; Unit">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[B](f: A =&gt; B)play.api.libs.concurrent.Promise[B]" id="175067">map</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="175069">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A =&gt; B" id="176317">f</a>: A =&gt; B<span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.libs.concurrent.STMPromise[B]" id="176323">result</a> = <span title="play.api.libs.concurrent.STMPromise[B]" class="keyword">new</span> <a href="#13409" title="play.api.libs.concurrent.STMPromise[B]">STMPromise</a><span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#13409" title="STMPromise.this.type" class="keyword">this</a>.<a href="#175060" title="(k: play.api.libs.concurrent.Promise[A] =&gt; Unit)Unit">addAction</a><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A]" id="176325">p</a> =&gt; <a href="#176325" title="play.api.libs.concurrent.Promise[A]">p</a>.<a href="#77013" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">value</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Redeemed</span><span class="delimiter">(</span><a title="A" id="176327">a</a><span class="delimiter">)</span> =&gt; <a href="#176323" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#175065" title="(body: =&gt; B)Unit">redeem</a><span class="delimiter">(</span><a href="#176317" title="(v1: A)B">f</a><span class="delimiter">(</span><a href="#176327" title="A">a</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">Thrown</span><span class="delimiter">(</span><a title="Throwable" id="176331">e</a><span class="delimiter">)</span> =&gt; <a href="#176323" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#175065" title="(body: =&gt; B)Unit">redeem</a><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="#176331" title="Throwable">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#176323" title="play.api.libs.concurrent.STMPromise[B]">result</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[B](f: A =&gt; play.api.libs.concurrent.Promise[B])play.api.libs.concurrent.STMPromise[B]" id="175070">flatMap</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="175072">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A =&gt; play.api.libs.concurrent.Promise[B]" id="176332">f</a>: A =&gt; Promise<span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.libs.concurrent.STMPromise[B]" id="176341">result</a> = <span title="play.api.libs.concurrent.STMPromise[B]" class="keyword">new</span> <a href="#13409" title="play.api.libs.concurrent.STMPromise[B]">STMPromise</a><span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#13409" title="STMPromise.this.type" class="keyword">this</a>.<a href="#175060" title="(k: play.api.libs.concurrent.Promise[A] =&gt; Unit)Unit">addAction</a><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A]" id="176343">p</a> =&gt; <a href="#176343" title="play.api.libs.concurrent.Promise[A]">p</a>.<a href="#77013" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">value</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Redeemed</span><span class="delimiter">(</span><a title="A" id="176345">a</a><span class="delimiter">)</span> =&gt;
       <span class="delimiter">(</span><span class="keyword">try</span><span class="delimiter">{</span> 
         <a href="#176332" title="(v1: A)play.api.libs.concurrent.Promise[B]">f</a><span class="delimiter">(</span><a href="#176345" title="A">a</a><span class="delimiter">)</span>
       <span class="delimiter">}</span> <span class="keyword">catch</span><span class="delimiter">{</span>
         <span class="keyword">case</span> <a title="play.api.libs.concurrent.Promise[B]" id="176347">e</a> =&gt;
           <a href="#13305" title="object play.api.libs.concurrent.Promise">Promise</a>.<a href="#79468" title="[A](a: =&gt; A)play.api.libs.concurrent.Promise[A]">pure</a><span title="(a: =&gt; B)play.api.libs.concurrent.Promise[B]" class="delimiter">[</span><a href="#175072" title="B">B</a><span class="delimiter">]</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="#176347" title="java.lang.Throwable">e</a><span class="delimiter">)</span>
       <span class="delimiter">}</span><span class="delimiter">)</span>.<a href="#77007" title="(k: play.api.libs.concurrent.Promise[B] =&gt; Unit)play.api.libs.concurrent.Promise[Unit]">extend</a><span title="Unit" class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[B]" id="176353">ip</a> =&gt; <a href="#176353" title="play.api.libs.concurrent.Promise[B]">ip</a>.<a href="#77013" title="=&gt; play.api.libs.concurrent.NotWaiting[B]">value</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit">Redeemed</span><span class="delimiter">(</span><a title="B" id="176355">a</a><span class="delimiter">)</span> =&gt; <a href="#176341" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#175065" title="(body: =&gt; B)Unit">redeem</a><span class="delimiter">(</span><a href="#176355" title="B">a</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit">Thrown</span><span class="delimiter">(</span><a title="Throwable" id="176358">e</a><span class="delimiter">)</span> =&gt; <a href="#176341" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#175065" title="(body: =&gt; B)Unit">redeem</a><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="#176358" title="Throwable">e</a><span class="delimiter">)</span>

        <span class="delimiter">}</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">Thrown</span><span class="delimiter">(</span><a title="Throwable" id="176360">e</a><span class="delimiter">)</span> =&gt; <a href="#176341" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#175065" title="(body: =&gt; B)Unit">redeem</a><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="#176360" title="Throwable">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#176341" title="play.api.libs.concurrent.STMPromise[B]">result</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object play.api.libs.concurrent.PurePromise" id="13500">PurePromise</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="keyword">def</span> <a title="[A](lazyA: =&gt; A)play.api.libs.concurrent.Promise[A]" id="176365">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="176367">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; A" id="176369">lazyA</a>: =&gt; A<span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = 
    <span class="delimiter">(</span><a href="package.scala.html#23373" title="(future: akka.dispatch.Future[_17])play.api.libs.concurrent.AkkaFuture[_17]" class="keyword">try</a> <span class="delimiter">(</span>akka.dispatch.<span title="object akka.dispatch.Promise">Promise</span>.<span title="(result: A)(implicit executor: akka.dispatch.ExecutionContext)akka.dispatch.Promise[A]">successful</span><span class="delimiter">(</span><a href="#176369" title="=&gt; A">lazyA</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#13305" title="object play.api.libs.concurrent.Promise">Promise</a>.<a href="#79466" title="=&gt; akka.actor.ActorSystem">system</a>.<span title="=&gt; akka.dispatch.MessageDispatcher">dispatcher</span><span class="delimiter">)</span><span class="delimiter">)</span>
     <span class="keyword">catch</span><span class="delimiter">{</span> <span class="keyword">case</span> <a title="akka.dispatch.Promise[Nothing]" id="176412">e</a> =&gt; akka.dispatch.<span title="object akka.dispatch.Promise">Promise</span>.<span title="(exception: Throwable)(implicit executor: akka.dispatch.ExecutionContext)akka.dispatch.Promise[Nothing]">failed</span><span class="delimiter">(</span><a href="#176412" title="java.lang.Throwable">e</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#13305" title="object play.api.libs.concurrent.Promise">Promise</a>.<a href="#79466" title="=&gt; akka.actor.ActorSystem">system</a>.<span title="=&gt; akka.dispatch.MessageDispatcher">dispatcher</span><span class="delimiter">)</span><span class="delimiter">}</span><span class="delimiter">)</span>.<a href="Akka.scala.html#75713" title="=&gt; play.api.libs.concurrent.Promise[_17]">asPromise</a>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object play.api.libs.concurrent.Promise" id="13305">Promise</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">def</span> <a title="[T](t: =&gt; T)play.api.libs.concurrent.Promise[T]" id="79463">invoke</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="79465">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; T" id="176594">t</a>: =&gt; T<span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[T]">Promise</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = akka.dispatch.<span title="(body: =&gt; T)(implicit executor: akka.dispatch.ExecutionContext)akka.dispatch.Future[T]">Future</span> <span class="delimiter">{</span> <a href="#176594" title="=&gt; T">t</a> <span class="delimiter">}</span><a href="package.scala.html#23373" title="(future: akka.dispatch.Future[T])play.api.libs.concurrent.AkkaFuture[T]" class="delimiter">(</a><a href="#13305" title="object play.api.libs.concurrent.Promise">Promise</a>.<a href="#79466" title="=&gt; akka.actor.ActorSystem">system</a>.<span title="=&gt; akka.dispatch.MessageDispatcher">dispatcher</span><span class="delimiter">)</span>.<a href="Akka.scala.html#75713" title="=&gt; play.api.libs.concurrent.Promise[T]">asPromise</a>
  
  <span class="comment">/*private [concurrent] lazy val defaultTimeout = 
    Duration(system.settings.config.getMilliseconds(&quot;promise.akka.actor.typed.timeout&quot;), TimeUnit.MILLISECONDS).toMillis */</span>

  <span class="keyword">private</span> <span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="akka.actor.ActorSystem" id="79467">system</a> = <span title="(name: String)akka.actor.ActorSystem">ActorSystem</span><span class="delimiter">(</span><span title="java.lang.String(&quot;promise&quot;)" class="string">&quot;promise&quot;</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="[A](a: =&gt; A)play.api.libs.concurrent.Promise[A]" id="79468">pure</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="79470">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; A" id="102807">a</a>: =&gt; A<span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <a href="#176365" title="(lazyA: =&gt; A)play.api.libs.concurrent.Promise[A]">PurePromise</a><span class="delimiter">(</span><a href="#102807" title="=&gt; A">a</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="[A]()play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]" id="79471">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="79473">A</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="#102780" title="Promise extends play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="keyword">with</span> Redeemable<span class="delimiter">[</span>A<span class="delimiter">]</span> = <span title="play.api.libs.concurrent.STMPromise[A]" class="keyword">new</span> <a href="#13409" title="play.api.libs.concurrent.STMPromise[A]">STMPromise</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="[A](message: A, duration: akka.util.Duration)play.api.libs.concurrent.Promise[A]" id="79474">timeout</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="79476">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A" id="175026">message</a>: <a href="#79476" title="A">A</a>, <a title="akka.util.Duration" id="175027">duration</a>: akka.util.<span title="akka.util.Duration">Duration</span><span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#79477" title="(message: =&gt; A, duration: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.Promise[A]">timeout</a><span class="delimiter">(</span><a href="#175026" title="A">message</a>, <a href="#175027" title="akka.util.Duration">duration</a>.<span title="=&gt; Long">toMillis</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[A](message: =&gt; A, duration: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.Promise[A]" id="79477">timeout</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="175018">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; A" id="175012">message</a>: =&gt; A, <a title="Long" id="175013">duration</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="175016">unit</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span> = TimeUnit.<span title="java.util.concurrent.TimeUnit(value MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Promise extends play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]" id="176646">p</a> = <a href="#79471" title="[A]()play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]">Promise</a><span title="()play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]" class="delimiter">[</span><a href="#175018" title="A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    play.core.<a href="../../../core/system/Invoker.scala.html#17864" title="object play.core.Invoker">Invoker</a>.<a href="../../../core/system/Invoker.scala.html#79777" title="=&gt; akka.actor.ActorSystem">system</a>.<span title="=&gt; akka.actor.Scheduler">scheduler</span>.<span title="(delay: akka.util.Duration)(f: =&gt; Unit)akka.actor.Cancellable">scheduleOnce</span><span class="delimiter">(</span>akka.util.<span title="(length: Long, unit: java.util.concurrent.TimeUnit)akka.util.FiniteDuration">Duration</span><span class="delimiter">(</span><a href="#175013" title="Long">duration</a>, <a href="#175016" title="java.util.concurrent.TimeUnit">unit</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#176646" title="Promise extends play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]">p</a>.<a href="#102784" title="(a: =&gt; A)Unit">redeem</a><span class="delimiter">(</span><a href="#175012" title="=&gt; A">message</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#176646" title="Promise extends play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]">p</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[A](in: Option[play.api.libs.concurrent.Promise[A]])play.api.libs.concurrent.Promise[Option[A]]" id="79480">sequence</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="79482">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Option[play.api.libs.concurrent.Promise[A]]" id="176685">in</a>: <span title="Option[play.api.libs.concurrent.Promise[A]]">Option</span><span class="delimiter">[</span>Promise<span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[Option[A]]">Promise</a><span class="delimiter">[</span>Option<span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#176685" title="Option[play.api.libs.concurrent.Promise[A]]">in</a>.<span title="(f: play.api.libs.concurrent.Promise[A] =&gt; play.api.libs.concurrent.Promise[Some[A]])Option[play.api.libs.concurrent.Promise[Some[A]]]">map</span> <span class="delimiter">{</span> <a title="play.api.libs.concurrent.Promise[A]" id="176692">p</a> =&gt; <a href="#176692" title="play.api.libs.concurrent.Promise[A]">p</a>.<a href="#77017" title="(f: A =&gt; Some[A])play.api.libs.concurrent.Promise[Some[A]]">map</a><span class="delimiter">{</span> <a title="A" id="176697">v</a> =&gt; <span title="(x: A)Some[A]">Some</span><span class="delimiter">(</span><a href="#176697" title="A">v</a><span class="delimiter">)</span><span class="delimiter">}</span><span class="delimiter">}</span>.<span title="(default: =&gt; play.api.libs.concurrent.Promise[Option[A]])play.api.libs.concurrent.Promise[Option[A]]">getOrElse</span> <span class="delimiter">{</span> <a href="#13305" title="object play.api.libs.concurrent.Promise">Promise</a>.<a href="#79468" title="(a: =&gt; None.type)play.api.libs.concurrent.Promise[None.type]">pure</a><span class="delimiter">(</span><span title="object None">None</span><span class="delimiter">)</span><span class="delimiter">}</span>
  
  <span class="keyword">def</span> <a title="[B, M[_]](in: M[play.api.libs.concurrent.Promise[B]])(implicit toTraversableLike: M[play.api.libs.concurrent.Promise[B]] =&gt; scala.collection.TraversableLike[play.api.libs.concurrent.Promise[B],M[play.api.libs.concurrent.Promise[B]]], implicit cbf: scala.collection.generic.CanBuildFrom[M[play.api.libs.concurrent.Promise[B]],B,M[B]])play.api.libs.concurrent.Promise[M[B]]" id="79483">sequence</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="79486">B</a>, <a title="[_]&gt;: Nothing &lt;: Any" id="79487">M</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="176739">_</a><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a title="M[play.api.libs.concurrent.Promise[B]]" id="176736">in</a>: <a href="#79487" title="M[play.api.libs.concurrent.Promise[B]]">M</a><span class="delimiter">[</span>Promise<span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="M[play.api.libs.concurrent.Promise[B]] =&gt; scala.collection.TraversableLike[play.api.libs.concurrent.Promise[B],M[play.api.libs.concurrent.Promise[B]]]" id="176737">toTraversableLike</a> : M<span class="delimiter">[</span>Promise<span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">]</span> =&gt; TraversableLike<span class="delimiter">[</span>Promise<span class="delimiter">[</span>B<span class="delimiter">]</span>, M<span class="delimiter">[</span>Promise<span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>, <a title="scala.collection.generic.CanBuildFrom[M[play.api.libs.concurrent.Promise[B]],B,M[B]]" id="176738">cbf</a>: <span title="scala.collection.generic.CanBuildFrom[M[play.api.libs.concurrent.Promise[B]],B,M[B]]">CanBuildFrom</span><span class="delimiter">[</span>M<span class="delimiter">[</span>Promise<span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">]</span>, B, M<span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13304" title="play.api.libs.concurrent.Promise[M[B]]">Promise</a><span class="delimiter">[</span>M<span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span> 
    <a href="#176737" title="(v1: M[play.api.libs.concurrent.Promise[B]])scala.collection.TraversableLike[play.api.libs.concurrent.Promise[B],M[play.api.libs.concurrent.Promise[B]]]">toTraversableLike</a><span class="delimiter">(</span><a href="#176736" title="M[play.api.libs.concurrent.Promise[B]]">in</a><span class="delimiter">)</span>.<span title="(z: play.api.libs.concurrent.Promise[scala.collection.mutable.Builder[B,M[B]]])(op: (play.api.libs.concurrent.Promise[scala.collection.mutable.Builder[B,M[B]]], play.api.libs.concurrent.Promise[B]) =&gt; play.api.libs.concurrent.Promise[scala.collection.mutable.Builder[B,M[B]]])play.api.libs.concurrent.Promise[scala.collection.mutable.Builder[B,M[B]]]">foldLeft</span><span class="delimiter">(</span><a href="#13305" title="object play.api.libs.concurrent.Promise">Promise</a>.<a href="#79468" title="(a: =&gt; scala.collection.mutable.Builder[B,M[B]])play.api.libs.concurrent.Promise[scala.collection.mutable.Builder[B,M[B]]]">pure</a><span class="delimiter">(</span><a href="#176738" title="(from: M[play.api.libs.concurrent.Promise[B]])scala.collection.mutable.Builder[B,M[B]]">cbf</a><span class="delimiter">(</span><a href="#176736" title="M[play.api.libs.concurrent.Promise[B]]">in</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[scala.collection.mutable.Builder[B,M[B]]]" id="176769">fr</a>, fa : <a href="#13304" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; <span class="keyword">for</span> <span class="delimiter">(</span><a title="scala.collection.mutable.Builder[B,M[B]]" id="176775">r</a> &lt;- <a href="#77020" title="(f: scala.collection.mutable.Builder[B,M[B]] =&gt; play.api.libs.concurrent.Promise[scala.collection.mutable.Builder[B,M[B]]])play.api.libs.concurrent.Promise[scala.collection.mutable.Builder[B,M[B]]]">fr</a>; <a title="B" id="176780">a</a> &lt;- <a href="#77017" title="(f: B =&gt; scala.collection.mutable.Builder[B,M[B]])play.api.libs.concurrent.Promise[scala.collection.mutable.Builder[B,M[B]]]">fa</a><span class="delimiter">)</span> <span class="keyword">yield</span> <span class="delimiter">(</span><a href="#176775" title="scala.collection.mutable.Builder[B,M[B]]">r</a> <span title="(elem: B)r.type">+=</span> <a href="#176780" title="B">a</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#77017" title="(f: scala.collection.mutable.Builder[B,M[B]] =&gt; M[B])play.api.libs.concurrent.Promise[M[B]]">map</a><span class="delimiter">(</span><a href="#176794" title="scala.collection.mutable.Builder[B,M[B]]">_</a>.<span title="()M[B]">result</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>