<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>play/play/core/server/netty/WebSocketHandler.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> play.core.server.netty

<span class="keyword">import</span> org.jboss.netty.buffer._
<span class="keyword">import</span> org.jboss.netty.channel._
<span class="keyword">import</span> org.jboss.netty.bootstrap._
<span class="keyword">import</span> org.jboss.netty.channel.<span title="object org.jboss.netty.channel.Channels">Channels</span>._
<span class="keyword">import</span> org.jboss.netty.handler.codec.http._
<span class="keyword">import</span> org.jboss.netty.channel.socket.nio._
<span class="keyword">import</span> org.jboss.netty.handler.stream._
<span class="keyword">import</span> org.jboss.netty.handler.codec.http.<span title="object org.jboss.netty.handler.codec.http.HttpHeaders">HttpHeaders</span>._
<span class="keyword">import</span> org.jboss.netty.handler.codec.http.<span title="object org.jboss.netty.handler.codec.http.HttpHeaders">HttpHeaders</span>.<span title="object org.jboss.netty.handler.codec.http.HttpHeaders.Names">Names</span>._
<span class="keyword">import</span> org.jboss.netty.handler.codec.http.<span title="object org.jboss.netty.handler.codec.http.HttpHeaders">HttpHeaders</span>.<span title="object org.jboss.netty.handler.codec.http.HttpHeaders.Values">Values</span>._
<span class="keyword">import</span> org.jboss.netty.handler.codec.http.websocketx._
<span class="keyword">import</span> org.jboss.netty.channel.group._
<span class="keyword">import</span> java.util.concurrent._
<span class="keyword">import</span> play.core._
<span class="keyword">import</span> play.core.server.websocket.WebSocketHandshake
<span class="keyword">import</span> play.api._
<span class="keyword">import</span> play.api.mvc._
<span class="keyword">import</span> play.api.libs.iteratee._
<span class="keyword">import</span> play.api.libs.iteratee.<a href="../../../api/libs/iteratee/Iteratee.scala.html#14415" title="object play.api.libs.iteratee.Input">Input</a>._
<span class="keyword">import</span> play.api.libs.concurrent._
<span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConverters">JavaConverters</span>._

<span class="keyword">private</span><span class="delimiter">[</span>server<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait WebSocketHandler extends java.lang.Object with ScalaObject" id="20668">WebSocketHandler</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="[A](frameFormatter: play.api.mvc.WebSocket.FrameFormatter[A])(java.lang.Object with play.api.libs.iteratee.Enumerator[A]{val iterateeAgent: play.core.Agent.Operations[Option[play.api.libs.iteratee.Iteratee[A,Any]]]; def frameReceived(ctx: org.jboss.netty.channel.ChannelHandlerContext,input: play.api.libs.iteratee.Input[A]): Unit}, org.jboss.netty.channel.SimpleChannelUpstreamHandler)" id="325099">newWebSocketInHandler</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="325101">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.mvc.WebSocket.FrameFormatter[A]" id="330697">frameFormatter</a>: play.api.mvc.WebSocket.<a href="../../../api/mvc/WebSocket.scala.html#242212" title="play.api.mvc.WebSocket.FrameFormatter[A]">FrameFormatter</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="play.core.server.websocket.FrameFormatter[A]" id="330700">nettyFrameFormatter</a> = <a href="#330697" title="play.api.mvc.WebSocket.FrameFormatter[A]">frameFormatter</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="play.core.server.websocket.FrameFormatter[A]" class="delimiter">[</span>play.core.server.websocket.<a href="../websocket/Frame.scala.html#20909" title="play.core.server.websocket.FrameFormatter[A]">FrameFormatter</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">]</span>

    <span class="keyword">val</span> <a title="enumerator extends java.lang.Object with play.api.libs.iteratee.Enumerator[A]" id="330701">enumerator</a> = <a href="#330702" title="java.lang.Object with play.api.libs.iteratee.Enumerator[A]{val iterateeAgent: play.core.Agent.Operations[Option[play.api.libs.iteratee.Iteratee[A,Any]]]; def frameReceived(ctx: org.jboss.netty.channel.ChannelHandlerContext,input: play.api.libs.iteratee.Input[A]): Unit}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with play.api.libs.iteratee.Enumerator[A]" id="330702">Enumerator</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="play.core.Agent.Operations[Option[play.api.libs.iteratee.Iteratee[A,Any]]]" id="330704">iterateeAgent</a> = <a href="../../system/Invoker.scala.html#330715" title="[A](a: A)play.core.Agent.Operations[A]">Agent</a><span title="(a: Option[play.api.libs.iteratee.Iteratee[A,Any]])play.core.Agent.Operations[Option[play.api.libs.iteratee.Iteratee[A,Any]]]" class="delimiter">[</span><span title="Option[play.api.libs.iteratee.Iteratee[A,Any]]">Option</span><span class="delimiter">[</span>Iteratee<span class="delimiter">[</span>A, Any<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="object None">None</span><span class="delimiter">)</span>
      <span class="keyword">private</span> <span class="keyword">val</span> <a title="$anon extends play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]] with play.api.libs.concurrent.Redeemable[play.api.libs.iteratee.Iteratee[A,Any]]" id="330706">promise</a>: <a href="#330753" title="$anon extends play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]] with play.api.libs.concurrent.Redeemable[play.api.libs.iteratee.Iteratee[A,Any]]">Promise</a><span class="delimiter">[</span>Iteratee<span class="delimiter">[</span>A, Any<span class="delimiter">]</span><span class="delimiter">]</span> <span class="keyword">with</span> Redeemable<span class="delimiter">[</span>Iteratee<span class="delimiter">[</span>A, Any<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="../../../api/libs/concurrent/Promise.scala.html#79471" title="[A]()play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]">Promise</a><span title="()play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]] with play.api.libs.concurrent.Redeemable[play.api.libs.iteratee.Iteratee[A,Any]]" class="delimiter">[</span><a href="../../../api/libs/iteratee/Iteratee.scala.html#14381" title="play.api.libs.iteratee.Iteratee[A,Any]">Iteratee</a><span class="delimiter">[</span>A, Any<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="[R](i: play.api.libs.iteratee.Iteratee[A,R])play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,R]]" id="330708">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="330710">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.libs.iteratee.Iteratee[A,R]" id="330724">i</a>: <a href="../../../api/libs/iteratee/Iteratee.scala.html#14381" title="play.api.libs.iteratee.Iteratee[A,R]">Iteratee</a><span class="delimiter">[</span>A, R<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
        <a href="#330704" title="=&gt; play.core.Agent.Operations[Option[play.api.libs.iteratee.Iteratee[A,Any]]]">iterateeAgent</a>.<a href="../../system/Invoker.scala.html#330738" title="(action: Option[play.api.libs.iteratee.Iteratee[A,Any]] =&gt; Option[play.api.libs.iteratee.Iteratee[A,Any]])Unit">send</a><span class="delimiter">(</span><a href="#330744" title="Option[play.api.libs.iteratee.Iteratee[A,Any]]">_</a>.<span title="(alternative: =&gt; Option[play.api.libs.iteratee.Iteratee[A,Any]])Option[play.api.libs.iteratee.Iteratee[A,Any]]">orElse</span><span class="delimiter">(</span><span title="(x: play.api.libs.iteratee.Iteratee[A,Any])Some[play.api.libs.iteratee.Iteratee[A,Any]]">Some</span><span class="delimiter">(</span><a href="#330724" title="play.api.libs.iteratee.Iteratee[A,R]">i</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="play.api.libs.iteratee.Iteratee[A,Any]" class="delimiter">[</span><a href="../../../api/libs/iteratee/Iteratee.scala.html#14381" title="play.api.libs.iteratee.Iteratee[A,Any]">Iteratee</a><span class="delimiter">[</span>A, Any<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#330706" title="=&gt; play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]] with play.api.libs.concurrent.Redeemable[play.api.libs.iteratee.Iteratee[A,Any]]">promise</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,R]]" class="delimiter">[</span><a href="../../../api/libs/concurrent/Promise.scala.html#13304" title="play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,R]]">Promise</a><span class="delimiter">[</span>Iteratee<span class="delimiter">[</span>A, R<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, input: play.api.libs.iteratee.Input[A])Unit" id="330711">frameReceived</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="330756">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="play.api.libs.iteratee.Input[A]" id="330757">input</a>: <a href="../../../api/libs/iteratee/Iteratee.scala.html#14414" title="play.api.libs.iteratee.Input[A]">Input</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#330704" title="=&gt; play.core.Agent.Operations[Option[play.api.libs.iteratee.Iteratee[A,Any]]]">iterateeAgent</a>.<a href="../../system/Invoker.scala.html#330738" title="(action: Option[play.api.libs.iteratee.Iteratee[A,Any]] =&gt; Option[play.api.libs.iteratee.Iteratee[A,Any]])Unit">send</a><span class="delimiter">(</span><a title="Option[play.api.libs.iteratee.Iteratee[A,Any]]" id="330764">iteratee</a> =&gt;
          <a href="#330764" title="Option[play.api.libs.iteratee.Iteratee[A,Any]]">iteratee</a>.<span title="(f: play.api.libs.iteratee.Iteratee[A,Any] =&gt; play.api.libs.iteratee.Iteratee[A,Any])Option[play.api.libs.iteratee.Iteratee[A,Any]]">map</span><span class="delimiter">(</span><a title="play.api.libs.iteratee.Iteratee[A,Any]" id="330769">it</a> =&gt; <a href="#330769" title="play.api.libs.iteratee.Iteratee[A,Any]">it</a>.<a href="../../../api/libs/iteratee/Iteratee.scala.html#75095" title="(done: (Any, play.api.libs.iteratee.Input[A]) =&gt; play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]], cont: play.api.libs.iteratee.Input[A] =&gt; play.api.libs.iteratee.Iteratee[A,Any] =&gt; play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]], error: (String, play.api.libs.iteratee.Input[A]) =&gt; play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]])play.api.libs.iteratee.Iteratee[A,Any]">flatFold</a><span class="delimiter">(</span>
            <span class="delimiter">(</span><a title="Any" id="330779">a</a>, <a title="play.api.libs.iteratee.Input[A]" id="330780">e</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span> sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Getting messages on a supposedly closed socket? frame: &quot;)" class="string">&quot;Getting messages on a supposedly closed socket? frame: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#330757" title="play.api.libs.iteratee.Input[A]">input</a><span class="delimiter">)</span> <span class="delimiter">}</span>,
            <a title="play.api.libs.iteratee.Input[A] =&gt; play.api.libs.iteratee.Iteratee[A,Any]" id="330782">k</a> =&gt; <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="play.api.libs.iteratee.Iteratee[A,Any]" id="330783">next</a> = <a href="#330782" title="(v1: play.api.libs.iteratee.Input[A])play.api.libs.iteratee.Iteratee[A,Any]">k</a><span class="delimiter">(</span><a href="#330757" title="play.api.libs.iteratee.Input[A]">input</a><span class="delimiter">)</span>
              <a href="#330783" title="play.api.libs.iteratee.Iteratee[A,Any]">next</a>.<a href="../../../api/libs/iteratee/Iteratee.scala.html#75084" title="(done: (Any, play.api.libs.iteratee.Input[A]) =&gt; play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]], cont: play.api.libs.iteratee.Input[A] =&gt; play.api.libs.iteratee.Iteratee[A,Any] =&gt; play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]], error: (String, play.api.libs.iteratee.Input[A]) =&gt; play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]])play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]">fold</a><span class="delimiter">(</span>
                <span class="delimiter">(</span><a title="Any" id="330793">a</a>, <a title="play.api.libs.iteratee.Input[A]" id="330794">e</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
                  <a href="#330704" title="=&gt; play.core.Agent.Operations[Option[play.api.libs.iteratee.Iteratee[A,Any]]]">iterateeAgent</a>.<a href="../../system/Invoker.scala.html#330739" title="()Unit">close</a><span class="delimiter">(</span><span class="delimiter">)</span>
                  <a href="#330756" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()org.jboss.netty.channel.ChannelFuture">disconnect</span><span class="delimiter">(</span><span class="delimiter">)</span>;
                  <a href="#330706" title="=&gt; play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]] with play.api.libs.concurrent.Redeemable[play.api.libs.iteratee.Iteratee[A,Any]]">promise</a>.<a href="../../../api/libs/concurrent/Promise.scala.html#102784" title="(a: =&gt; play.api.libs.iteratee.Iteratee[A,Any])Unit">redeem</a><span class="delimiter">(</span><a href="#330783" title="play.api.libs.iteratee.Iteratee[A,Any]">next</a><span class="delimiter">)</span>;
                  <a href="../../../api/Logger.scala.html#82396" title="(name: String)play.api.Logger">Logger</a><span class="delimiter">(</span><span title="java.lang.String(&quot;play&quot;)" class="string">&quot;play&quot;</span><span class="delimiter">)</span>.<a href="../../../api/Logger.scala.html#82382" title="(message: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="java.lang.String(&quot;cleaning for channel &quot;)" class="string">&quot;cleaning for channel &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#330756" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
                  <a href="../../../api/libs/concurrent/Promise.scala.html#13305" title="object play.api.libs.concurrent.Promise">Promise</a>.<a href="../../../api/libs/concurrent/Promise.scala.html#79468" title="(a: =&gt; play.api.libs.iteratee.Iteratee[A,Any])play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]">pure</a><span class="delimiter">(</span><a href="#330783" title="play.api.libs.iteratee.Iteratee[A,Any]">next</a><span class="delimiter">)</span>
                <span class="delimiter">}</span>,
                <a title="play.api.libs.iteratee.Input[A] =&gt; play.api.libs.iteratee.Iteratee[A,Any]" id="330815">_</a> =&gt; <a href="../../../api/libs/concurrent/Promise.scala.html#13305" title="object play.api.libs.concurrent.Promise">Promise</a>.<a href="../../../api/libs/concurrent/Promise.scala.html#79468" title="(a: =&gt; play.api.libs.iteratee.Iteratee[A,Any])play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]">pure</a><span class="delimiter">(</span><a href="#330783" title="play.api.libs.iteratee.Iteratee[A,Any]">next</a><span class="delimiter">)</span>,
                <span class="delimiter">(</span><a title="String" id="330820">msg</a>, <a title="play.api.libs.iteratee.Input[A]" id="330821">e</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span> <span class="comment">/* deal with error, maybe close the socket */</span> <a href="../../../api/libs/concurrent/Promise.scala.html#13305" title="object play.api.libs.concurrent.Promise">Promise</a>.<a href="../../../api/libs/concurrent/Promise.scala.html#79468" title="(a: =&gt; play.api.libs.iteratee.Iteratee[A,Any])play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]">pure</a><span class="delimiter">(</span><a href="#330783" title="play.api.libs.iteratee.Iteratee[A,Any]">next</a><span class="delimiter">)</span> <span class="delimiter">}</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>,
            <span class="delimiter">(</span><a title="String" id="330829">err</a>, <a title="play.api.libs.iteratee.Input[A]" id="330830">e</a><span class="delimiter">)</span> =&gt; <span class="comment">/* handle error, maybe close the socket */</span> <a href="../../../api/libs/concurrent/Promise.scala.html#13305" title="object play.api.libs.concurrent.Promise">Promise</a>.<a href="../../../api/libs/concurrent/Promise.scala.html#79468" title="(a: =&gt; play.api.libs.iteratee.Iteratee[A,Any])play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]">pure</a><span class="delimiter">(</span><a href="#330769" title="play.api.libs.iteratee.Iteratee[A,Any]">it</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span title="(_1: java.lang.Object with play.api.libs.iteratee.Enumerator[A]{val iterateeAgent: play.core.Agent.Operations[Option[play.api.libs.iteratee.Iteratee[A,Any]]]; def frameReceived(ctx: org.jboss.netty.channel.ChannelHandlerContext,input: play.api.libs.iteratee.Input[A]): Unit}, _2: org.jboss.netty.channel.SimpleChannelUpstreamHandler)(java.lang.Object with play.api.libs.iteratee.Enumerator[A]{val iterateeAgent: play.core.Agent.Operations[Option[play.api.libs.iteratee.Iteratee[A,Any]]]; def frameReceived(ctx: org.jboss.netty.channel.ChannelHandlerContext,input: play.api.libs.iteratee.Input[A]): Unit}, org.jboss.netty.channel.SimpleChannelUpstreamHandler)" class="delimiter">(</span><a href="#330701" title="enumerator extends java.lang.Object with play.api.libs.iteratee.Enumerator[A]">enumerator</a>,
      <a href="#330870" title="org.jboss.netty.channel.SimpleChannelUpstreamHandler" class="keyword">new</a> <a title="anonymous class $anon extends org.jboss.netty.channel.SimpleChannelUpstreamHandler" id="330870">SimpleChannelUpstreamHandler</a> <span class="delimiter">{</span>

        <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.MessageEvent)Unit" id="330872">messageReceived</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="330875">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.MessageEvent" id="330876">e</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#330876" title="org.jboss.netty.channel.MessageEvent">e</a>.<span title="()java.lang.Object">getMessage</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="Unit" id="330882">frame</a>: <span title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">WebSocketFrame</span> <span class="keyword">if</span> <a href="#330700" title="play.core.server.websocket.FrameFormatter[A]">nettyFrameFormatter</a>.<a href="../websocket/Frame.scala.html#242327" title="=&gt; PartialFunction[org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame,A]">fromFrame</a>.<span title="(x: org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame)Boolean">isDefinedAt</span><span class="delimiter">(</span><a href="#330882" title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">frame</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
              <a href="#330701" title="enumerator extends java.lang.Object with play.api.libs.iteratee.Enumerator[A]">enumerator</a>.<a href="#330863" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, input: play.api.libs.iteratee.Input[A])Unit">frameReceived</a><span class="delimiter">(</span><a href="#330875" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="../../../api/libs/iteratee/Iteratee.scala.html#75164" title="(e: A)play.api.libs.iteratee.Input.El[A]">El</a><span class="delimiter">(</span><a href="#330700" title="play.core.server.websocket.FrameFormatter[A]">nettyFrameFormatter</a>.<a href="../websocket/Frame.scala.html#242327" title="(v1: org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame)A">fromFrame</a><span class="delimiter">(</span><a href="#330882" title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">frame</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <span class="keyword">case</span> <a title="Unit" id="330888">frame</a>: <span title="org.jboss.netty.handler.codec.http.websocketx.CloseWebSocketFrame">CloseWebSocketFrame</span> =&gt; <span class="delimiter">{</span> <a href="#330875" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()org.jboss.netty.channel.ChannelFuture">disconnect</span><span class="delimiter">(</span><span class="delimiter">)</span>; <a href="#330701" title="enumerator extends java.lang.Object with play.api.libs.iteratee.Enumerator[A]">enumerator</a>.<a href="#330863" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, input: play.api.libs.iteratee.Input[A])Unit">frameReceived</a><span class="delimiter">(</span><a href="#330875" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="../../../api/libs/iteratee/Iteratee.scala.html#67191" title="object play.api.libs.iteratee.Input.EOF">EOF</a><span class="delimiter">)</span> <span class="delimiter">}</span>
            <span class="keyword">case</span> <a title="Unit" id="330908">frame</a>: <span title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">WebSocketFrame</span> =&gt; <span class="comment">//</span>
            <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span class="comment">//</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.ExceptionEvent)Unit" id="330873">exceptionCaught</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="330877">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.ExceptionEvent" id="330878">e</a>: <span title="org.jboss.netty.channel.ExceptionEvent">ExceptionEvent</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#330878" title="org.jboss.netty.channel.ExceptionEvent">e</a>.<span title="()java.lang.Throwable">getCause</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Unit">printStackTrace</span><span class="delimiter">(</span><span class="delimiter">)</span>;
          <a href="#330878" title="org.jboss.netty.channel.ExceptionEvent">e</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()org.jboss.netty.channel.ChannelFuture">close</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>

        <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.ChannelStateEvent)Unit" id="330874">channelDisconnected</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="330879">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.ChannelStateEvent" id="330880">e</a>: <span title="org.jboss.netty.channel.ChannelStateEvent">ChannelStateEvent</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#330701" title="enumerator extends java.lang.Object with play.api.libs.iteratee.Enumerator[A]">enumerator</a>.<a href="#330863" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, input: play.api.libs.iteratee.Input[A])Unit">frameReceived</a><span class="delimiter">(</span><a href="#330879" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="../../../api/libs/iteratee/Iteratee.scala.html#67191" title="object play.api.libs.iteratee.Input.EOF">EOF</a><span class="delimiter">)</span>
          <a href="../../../api/Logger.scala.html#82396" title="(name: String)play.api.Logger">Logger</a><span class="delimiter">(</span><span title="java.lang.String(&quot;play&quot;)" class="string">&quot;play&quot;</span><span class="delimiter">)</span>.<a href="../../../api/Logger.scala.html#82382" title="(message: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="java.lang.String(&quot;disconnected socket&quot;)" class="string">&quot;disconnected socket&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      <span class="delimiter">}</span><span class="delimiter">)</span>

  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[A](ctx: org.jboss.netty.channel.ChannelHandlerContext, req: org.jboss.netty.handler.codec.http.HttpRequest, e: org.jboss.netty.channel.MessageEvent)(frameFormatter: play.api.mvc.WebSocket.FrameFormatter[A])play.api.libs.iteratee.Enumerator[A]" id="325102">websocketHandshake</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="325104">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="330339">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.handler.codec.http.HttpRequest" id="330340">req</a>: <span title="org.jboss.netty.handler.codec.http.HttpRequest">HttpRequest</span>, <a title="org.jboss.netty.channel.MessageEvent" id="330341">e</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="play.api.mvc.WebSocket.FrameFormatter[A]" id="330342">frameFormatter</a>: play.api.mvc.WebSocket.<a href="../../../api/mvc/WebSocket.scala.html#242212" title="play.api.mvc.WebSocket.FrameFormatter[A]">FrameFormatter</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../api/libs/iteratee/Iteratee.scala.html#14120" title="play.api.libs.iteratee.Enumerator[A]">Enumerator</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <a href="../websocket/WebSocketHandshake.scala.html#20946" title="object play.core.server.websocket.WebSocketHandshake">WebSocketHandshake</a>.<a href="../websocket/WebSocketHandshake.scala.html#330957" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, req: org.jboss.netty.handler.codec.http.HttpRequest)Unit">shake</a><span class="delimiter">(</span><a href="#330339" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#330340" title="org.jboss.netty.handler.codec.http.HttpRequest">req</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a href="#330952" title="(java.lang.Object with play.api.libs.iteratee.Enumerator[A]{val iterateeAgent: play.core.Agent.Operations[Option[play.api.libs.iteratee.Iteratee[A,Any]]]; def frameReceived(ctx: org.jboss.netty.channel.ChannelHandlerContext,input: play.api.libs.iteratee.Input[A]): Unit}, org.jboss.netty.channel.SimpleChannelUpstreamHandler)" class="delimiter">(</a><a href="#330951" title="enumerator extends java.lang.Object with play.api.libs.iteratee.Enumerator[A]" id="330952">enumerator</a>, <a href="#330951" title="newWebSocketInHandler extends org.jboss.netty.channel.SimpleChannelUpstreamHandler" id="330953">handler</a><span class="delimiter">)</span> = <a href="#325099" title="(frameFormatter: play.api.mvc.WebSocket.FrameFormatter[A])(java.lang.Object with play.api.libs.iteratee.Enumerator[A]{val iterateeAgent: play.core.Agent.Operations[Option[play.api.libs.iteratee.Iteratee[A,Any]]]; def frameReceived(ctx: org.jboss.netty.channel.ChannelHandlerContext,input: play.api.libs.iteratee.Input[A]): Unit}, org.jboss.netty.channel.SimpleChannelUpstreamHandler)">newWebSocketInHandler</a><span title="(java.lang.Object with play.api.libs.iteratee.Enumerator[A]{val iterateeAgent: play.core.Agent.Operations[Option[play.api.libs.iteratee.Iteratee[A,Any]]]; def frameReceived(ctx: org.jboss.netty.channel.ChannelHandlerContext,input: play.api.libs.iteratee.Input[A]): Unit}, org.jboss.netty.channel.SimpleChannelUpstreamHandler) @unchecked" class="delimiter">(</span><a href="#330342" title="play.api.mvc.WebSocket.FrameFormatter[A]">frameFormatter</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.jboss.netty.channel.ChannelPipeline" id="330954">p</a>: <span title="org.jboss.netty.channel.ChannelPipeline">ChannelPipeline</span> = <a href="#330339" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()org.jboss.netty.channel.ChannelPipeline">getPipeline</span><span class="delimiter">(</span><span class="delimiter">)</span>;
    <a href="#330954" title="org.jboss.netty.channel.ChannelPipeline">p</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String, x$3: org.jboss.netty.channel.ChannelHandler)org.jboss.netty.channel.ChannelHandler">replace</span><span class="delimiter">(</span><span title="java.lang.String(&quot;handler&quot;)" class="string">&quot;handler&quot;</span>, <span title="java.lang.String(&quot;handler&quot;)" class="string">&quot;handler&quot;</span>, <a href="#330953" title="newWebSocketInHandler extends org.jboss.netty.channel.SimpleChannelUpstreamHandler">handler</a><span class="delimiter">)</span>;
    <a href="#330952" title="enumerator extends java.lang.Object with play.api.libs.iteratee.Enumerator[A]">enumerator</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(req: org.jboss.netty.handler.codec.http.HttpRequest)java.lang.Object with play.core.server.WebSocketable" id="325105">websocketable</a><span class="delimiter">(</span><a title="org.jboss.netty.handler.codec.http.HttpRequest" id="328754">req</a>: <span title="org.jboss.netty.handler.codec.http.HttpRequest">HttpRequest</span><span class="delimiter">)</span> = <a href="#328757" title="java.lang.Object with play.core.server.WebSocketable" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with play.core.server.WebSocketable" id="328757">server</a>.<a href="../Server.scala.html#20293" title="play.core.server.WebSocketable">WebSocketable</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="328759">check</a> =
      HttpHeaders.Values.<span title="java.lang.String(&quot;WebSocket&quot;)">WEBSOCKET</span>.<span title="(x$1: java.lang.String)Boolean">equalsIgnoreCase</span><span class="delimiter">(</span><a href="#328754" title="org.jboss.netty.handler.codec.http.HttpRequest">req</a>.<span title="(x$1: java.lang.String)java.lang.String">getHeader</span><span class="delimiter">(</span>HttpHeaders.Names.<span title="java.lang.String(&quot;Upgrade&quot;)">UPGRADE</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(header: String)java.lang.String" id="328760">getHeader</a><span class="delimiter">(</span><a title="String" id="328764">header</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#328754" title="org.jboss.netty.handler.codec.http.HttpRequest">req</a>.<span title="(x$1: java.lang.String)java.lang.String">getHeader</span><span class="delimiter">(</span><a href="#328764" title="String">header</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>