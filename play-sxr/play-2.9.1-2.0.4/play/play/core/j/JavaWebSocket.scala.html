<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>play/play/core/j/JavaWebSocket.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> play.core.j

<span class="keyword">import</span> play.api.mvc._
<span class="keyword">import</span> play.mvc.<span class="delimiter">{</span> Action =&gt; JAction, Result =&gt; JResult <span class="delimiter">}</span>
<span class="keyword">import</span> play.mvc.<a href="../../mvc/Http.java.html#21656" title="object play.mvc.Http">Http</a>.<span class="delimiter">{</span> Context =&gt; JContext, Request =&gt; JRequest, RequestBody =&gt; JBody, Cookies =&gt; JCookies, Cookie =&gt; JCookie <span class="delimiter">}</span>
<span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConverters">JavaConverters</span>._

<span class="comment">/**
 * handles a scala websocket in a Java Context
 */</span>
<span class="keyword">object</span> <a title="object play.core.j.JavaWebSocket" id="19808">JavaWebSocket</a> <span title="ScalaObject" class="keyword">extends</span> <a href="JavaHelpers.scala.html#20008" title="play.core.j.JavaHelpers">JavaHelpers</a> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="[A](retrieveWebSocket: =&gt; play.mvc.WebSocket[A])(implicit frameFormatter: play.api.mvc.WebSocket.FrameFormatter[A])play.api.mvc.WebSocket[A]" id="308746">webSocketWrapper</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="308748">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; play.mvc.WebSocket[A]" id="308778">retrieveWebSocket</a>: =&gt; play.mvc.WebSocket<span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="play.api.mvc.WebSocket.FrameFormatter[A]" id="308779">frameFormatter</a>: play.api.mvc.WebSocket.<a href="../../api/mvc/WebSocket.scala.html#242212" title="play.api.mvc.WebSocket.FrameFormatter[A]">FrameFormatter</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../api/mvc/WebSocket.scala.html#16868" title="play.api.mvc.WebSocket[A]">WebSocket</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <a href="../../api/mvc/WebSocket.scala.html#242225" title="[A](f: play.api.mvc.RequestHeader =&gt; (play.api.libs.iteratee.Enumerator[A], play.api.libs.iteratee.Iteratee[A,Unit]) =&gt; Unit)(implicit frameFormatter: play.api.mvc.WebSocket.FrameFormatter[A])play.api.mvc.WebSocket[A]">WebSocket</a><span title="(f: play.api.mvc.RequestHeader =&gt; (play.api.libs.iteratee.Enumerator[A], play.api.libs.iteratee.Iteratee[A,Unit]) =&gt; Unit)(implicit frameFormatter: play.api.mvc.WebSocket.FrameFormatter[A])play.api.mvc.WebSocket[A]" class="delimiter">[</span><a href="#308748" title="A">A</a><span class="delimiter">]</span> <a href="#308779" title="play.api.mvc.WebSocket.FrameFormatter[A]" class="delimiter">{</a> <a title="play.api.mvc.RequestHeader" id="308789">request</a> =&gt;
    <span class="delimiter">(</span><a title="play.api.libs.iteratee.Enumerator[A]" id="308791">in</a>, <a title="play.api.libs.iteratee.Iteratee[A,Unit]" id="308792">out</a><span class="delimiter">)</span> =&gt;

      <span class="keyword">import</span> play.api.libs.iteratee._

      <span class="keyword">val</span> <a title="play.mvc.WebSocket[A]" id="308794">javaWebSocket</a> = <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="../../mvc/Http.java.html#82033" title="object play.mvc.Http.Context">JContext</a>.<a href="../../mvc/Http.java.html#243779" title="java.lang.ThreadLocal[play.mvc.Http.Context]">current</a>.<span title="(x$1: play.mvc.Http.Context)Unit">set</span><span class="delimiter">(</span><a href="JavaHelpers.scala.html#300675" title="(req: play.api.mvc.RequestHeader)play.mvc.Http.Context">createJavaContext</a><span class="delimiter">(</span><a href="#308789" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#308778" title="=&gt; play.mvc.WebSocket[A]">retrieveWebSocket</a>
      <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
        <a href="../../mvc/Http.java.html#82033" title="object play.mvc.Http.Context">JContext</a>.<a href="../../mvc/Http.java.html#243779" title="java.lang.ThreadLocal[play.mvc.Http.Context]">current</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="play.api.libs.iteratee.PushEnumerator[A]" id="308795">enumerator</a> = <a href="../../api/libs/iteratee/Iteratee.scala.html#14121" title="object play.api.libs.iteratee.Enumerator">Enumerator</a>.<a href="../../api/libs/iteratee/Iteratee.scala.html#102721" title="[E](onStart: =&gt; Unit, onComplete: =&gt; Unit, onError: (String, play.api.libs.iteratee.Input[E]) =&gt; Unit)play.api.libs.iteratee.PushEnumerator[E]">imperative</a><a href="../../api/libs/iteratee/Iteratee.scala.html#182847" title="(onStart: =&gt; Unit, onComplete: =&gt; Unit, onError: (String, play.api.libs.iteratee.Input[A]) =&gt; Unit)play.api.libs.iteratee.PushEnumerator[A]" class="delimiter">[</a><a href="#308748" title="A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="socketOut extends java.lang.Object with play.mvc.WebSocket.Out[A]" id="308796">socketOut</a> = <a href="#308811" title="java.lang.Object with play.mvc.WebSocket.Out[A]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with play.mvc.WebSocket.Out[A]" id="308811">play</a>.mvc.WebSocket.<a href="../../mvc/WebSocket.java.html#308815" title="play.mvc.WebSocket.Out[A]">Out</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="delimiter">{</span>

        <span class="keyword">def</span> <a title="(frame: A)Unit" id="308825">write</a><span class="delimiter">(</span><a title="A" id="308827">frame</a>: <a href="#308748" title="A">A</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#308795" title="play.api.libs.iteratee.PushEnumerator[A]">enumerator</a>.<a href="../../api/libs/iteratee/Iteratee.scala.html#182873" title="(item: A)Boolean">push</a><span title="Unit" class="delimiter">(</span><a href="#308827" title="A">frame</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">def</span> <a title="()Unit" id="308826">close</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#308795" title="play.api.libs.iteratee.PushEnumerator[A]">enumerator</a>.<a href="../../api/libs/iteratee/Iteratee.scala.html#182872" title="()Unit">close</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="play.mvc.WebSocket.In[A]" id="308797">socketIn</a> = <span title="play.mvc.WebSocket.In[A]" class="keyword">new</span> play.mvc.WebSocket.<a href="../../mvc/WebSocket.java.html#308819" title="play.mvc.WebSocket.In[A]">In</a><span class="delimiter">[</span>A<span class="delimiter">]</span>

      <a href="#308791" title="play.api.libs.iteratee.Enumerator[A]">in</a> <a href="../../api/libs/iteratee/Iteratee.scala.html#74914" title="(i: play.api.libs.iteratee.Iteratee[A,Unit])play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Unit]]">|&gt;&gt;</a> <span class="delimiter">{</span>
        <a href="../../api/libs/iteratee/Iteratee.scala.html#14382" title="object play.api.libs.iteratee.Iteratee">Iteratee</a>.<a href="../../api/libs/iteratee/Iteratee.scala.html#75635" title="[E](f: E =&gt; Unit)play.api.libs.iteratee.Iteratee[E,Unit]">foreach</a><span title="(f: A =&gt; Unit)play.api.libs.iteratee.Iteratee[A,Unit]" class="delimiter">[</span><a href="#308748" title="A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A" id="308858">msg</a> =&gt; <a href="#308797" title="play.mvc.WebSocket.In[A]">socketIn</a>.<a href="../../mvc/WebSocket.java.html#308849" title="(l: java.util.List[play.libs.F.Callback[A]])collection.JavaConverters.AsScala[scala.collection.mutable.Buffer[play.libs.F.Callback[A]]]">callbacks</a>.<span title="=&gt; scala.collection.mutable.Buffer[play.libs.F.Callback[A]]">asScala</span>.<span title="(f: play.libs.F.Callback[A] =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#308928" title="play.libs.F.Callback[A]">_</a>.<a href="../../libs/F.java.html#308876" title="(a: A)Unit">invoke</a><span class="delimiter">(</span><a href="#308858" title="A">msg</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../api/libs/iteratee/Iteratee.scala.html#75100" title="(f: Unit =&gt; Unit)play.api.libs.iteratee.Iteratee[A,Unit]">mapDone</a> <span class="delimiter">{</span> <a title="Unit" id="308936">_</a> =&gt;
          <a href="#308797" title="play.mvc.WebSocket.In[A]">socketIn</a>.<a href="../../mvc/WebSocket.java.html#308850" title="(l: java.util.List[play.libs.F.Callback0])collection.JavaConverters.AsScala[scala.collection.mutable.Buffer[play.libs.F.Callback0]]">closeCallbacks</a>.<span title="=&gt; scala.collection.mutable.Buffer[play.libs.F.Callback0]">asScala</span>.<span title="(f: play.libs.F.Callback0 =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#309002" title="play.libs.F.Callback0">_</a>.<a href="../../libs/F.java.html#308952" title="()Unit">invoke</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <a href="#308795" title="play.api.libs.iteratee.PushEnumerator[A]">enumerator</a> <a href="../../api/libs/iteratee/Iteratee.scala.html#74914" title="(i: play.api.libs.iteratee.Iteratee[A,Unit])play.api.libs.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Unit]]">|&gt;&gt;</a> <a href="#308792" title="play.api.libs.iteratee.Iteratee[A,Unit]">out</a>

      <a href="#308794" title="play.mvc.WebSocket[A]">javaWebSocket</a>.<a href="../../mvc/WebSocket.java.html#308785" title="(in: play.mvc.WebSocket.In[A], out: play.mvc.WebSocket.Out[A])Unit">onReady</a><span class="delimiter">(</span><a href="#308797" title="play.mvc.WebSocket.In[A]">socketIn</a>, <a href="#308796" title="socketOut extends java.lang.Object with play.mvc.WebSocket.Out[A]">socketOut</a><span class="delimiter">)</span>

  <span class="delimiter">}</span>

  <span class="comment">// -- Bytes</span>

  <span class="keyword">def</span> <a title="(retrieveWebSocket: =&gt; play.mvc.WebSocket[Array[Byte]])play.api.mvc.Handler" id="308749">ofBytes</a><span class="delimiter">(</span><a title="=&gt; play.mvc.WebSocket[Array[Byte]]" id="309014">retrieveWebSocket</a>: =&gt; play.mvc.WebSocket<span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../api/mvc/Action.scala.html#16586" title="play.api.mvc.Handler">Handler</a> = <a href="#308746" title="[A](retrieveWebSocket: =&gt; play.mvc.WebSocket[A])(implicit frameFormatter: play.api.mvc.WebSocket.FrameFormatter[A])play.api.mvc.WebSocket[A]">webSocketWrapper</a><span title="(retrieveWebSocket: =&gt; play.mvc.WebSocket[Array[Byte]])(implicit frameFormatter: play.api.mvc.WebSocket.FrameFormatter[Array[Byte]])play.api.mvc.WebSocket[Array[Byte]]" class="delimiter">[</span><span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><a href="../../api/mvc/WebSocket.scala.html#242304" title="=&gt; play.api.mvc.WebSocket.FrameFormatter[Array[Byte]]" class="delimiter">(</a><a href="#309014" title="=&gt; play.mvc.WebSocket[Array[Byte]]">retrieveWebSocket</a><span class="delimiter">)</span>

  <span class="comment">// -- String</span>

  <span class="keyword">def</span> <a title="(retrieveWebSocket: =&gt; play.mvc.WebSocket[String])play.api.mvc.Handler" id="308750">ofString</a><span class="delimiter">(</span><a title="=&gt; play.mvc.WebSocket[String]" id="309019">retrieveWebSocket</a>: =&gt; play.mvc.WebSocket<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../api/mvc/Action.scala.html#16586" title="play.api.mvc.Handler">Handler</a> = <a href="#308746" title="[A](retrieveWebSocket: =&gt; play.mvc.WebSocket[A])(implicit frameFormatter: play.api.mvc.WebSocket.FrameFormatter[A])play.api.mvc.WebSocket[A]">webSocketWrapper</a><span title="(retrieveWebSocket: =&gt; play.mvc.WebSocket[String])(implicit frameFormatter: play.api.mvc.WebSocket.FrameFormatter[String])play.api.mvc.WebSocket[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span><a href="../../api/mvc/WebSocket.scala.html#242302" title="=&gt; play.api.mvc.WebSocket.FrameFormatter[String]" class="delimiter">(</a><a href="#309019" title="=&gt; play.mvc.WebSocket[String]">retrieveWebSocket</a><span class="delimiter">)</span>

  <span class="comment">// -- Json (JsonNode)</span>

  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="play.api.mvc.WebSocket.FrameFormatter[org.codehaus.jackson.JsonNode]" id="308751">jsonFrame</a> = play.api.mvc.<a href="../../api/mvc/WebSocket.scala.html#16869" title="object play.api.mvc.WebSocket">WebSocket</a>.<a href="../../api/mvc/WebSocket.scala.html#242214" title="object play.api.mvc.WebSocket.FrameFormatter">FrameFormatter</a>.<a href="../../api/mvc/WebSocket.scala.html#242302" title="=&gt; play.api.mvc.WebSocket.FrameFormatter[String]">stringFrame</a>.<a href="../../api/mvc/WebSocket.scala.html#242231" title="(fba: org.codehaus.jackson.JsonNode =&gt; String, fab: String =&gt; org.codehaus.jackson.JsonNode)play.api.mvc.WebSocket.FrameFormatter[org.codehaus.jackson.JsonNode]">transform</a><span class="delimiter">(</span>
    play.libs.<a href="../../libs/Json.java.html#21467" title="object play.libs.Json">Json</a>.<a href="../../libs/Json.java.html#308766" title="(json: org.codehaus.jackson.JsonNode)java.lang.String">stringify</a>, play.libs.<a href="../../libs/Json.java.html#21467" title="object play.libs.Json">Json</a>.<a href="../../libs/Json.java.html#308767" title="(src: java.lang.String)org.codehaus.jackson.JsonNode">parse</a>
  <span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(retrieveWebSocket: =&gt; play.mvc.WebSocket[org.codehaus.jackson.JsonNode])play.api.mvc.Handler" id="308753">ofJson</a><span class="delimiter">(</span><a title="=&gt; play.mvc.WebSocket[org.codehaus.jackson.JsonNode]" id="309023">retrieveWebSocket</a>: =&gt; play.mvc.WebSocket<span class="delimiter">[</span>org.codehaus.jackson.JsonNode<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../api/mvc/Action.scala.html#16586" title="play.api.mvc.Handler">Handler</a> = <a href="#308746" title="[A](retrieveWebSocket: =&gt; play.mvc.WebSocket[A])(implicit frameFormatter: play.api.mvc.WebSocket.FrameFormatter[A])play.api.mvc.WebSocket[A]">webSocketWrapper</a><span title="(retrieveWebSocket: =&gt; play.mvc.WebSocket[org.codehaus.jackson.JsonNode])(implicit frameFormatter: play.api.mvc.WebSocket.FrameFormatter[org.codehaus.jackson.JsonNode])play.api.mvc.WebSocket[org.codehaus.jackson.JsonNode]" class="delimiter">[</span>org.codehaus.jackson.<span title="org.codehaus.jackson.JsonNode">JsonNode</span><span class="delimiter">]</span><a href="#308751" title="=&gt; play.api.mvc.WebSocket.FrameFormatter[org.codehaus.jackson.JsonNode]" class="delimiter">(</a><a href="#309023" title="=&gt; play.mvc.WebSocket[org.codehaus.jackson.JsonNode]">retrieveWebSocket</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>