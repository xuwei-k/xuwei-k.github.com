<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>play-server/play/core/server/ProdServerStart.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> play.core.server

<span class="keyword">import</span> java.io._
<span class="keyword">import</span> java.util.Properties
<span class="keyword">import</span> play.api._
<span class="keyword">import</span> play.core._
<span class="keyword">import</span> play.core.server._
<span class="keyword">import</span> play.utils.Threads
<span class="keyword">import</span> scala.util.control.NonFatal
<span class="keyword">import</span> scala.util.Success

<span class="comment">/**
 * Used to start servers in 'prod' mode, the mode that is
 * used in production. The application is loaded and started
 * immediately.
 */</span>
<span class="keyword">object</span> <a title="play.core.server.ProdServerStart.type" id="play.core.server.ProdServerStart">ProdServerStart</a> <a href="#play.core.server.ProdServerStart" title="play.core.server.ProdServerStart.type" class="delimiter">{</a>

  <span class="comment">/**
   * Start a prod mode server from the command line.
   */</span>
  <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="play.core.server.ProdServerStart.main">main</a><span class="delimiter">(</span><a title="Array[String]" id="play.core.server.ProdServerStart.main.args">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.core.server.RealServerProcess" id="play.core.server.ProdServerStart.main.process">process</a> = <span title="play.core.server.RealServerProcess" class="keyword">new</span> <a href="ServerProcess.scala.html#play.core.server;RealServerProcess" title="play.core.server.RealServerProcess">RealServerProcess</a><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.main.args" title="(xs: Array[String])scala.collection.mutable.WrappedArray[String]">args</a><span class="delimiter">)</span>
    <a href="#play.core.server.ProdServerStart.start" title="(process: play.core.server.ServerProcess)play.core.server.ServerWithStop">start</a><span title="Unit" class="delimiter">(</span><a href="#play.core.server.ProdServerStart.main.process" title="play.core.server.RealServerProcess">process</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Starts a Play server and application for the given process. The settings
   * for the server are based on values passed on the command line and in
   * various system properties. Crash out by exiting the given process if there
   * are any problems.
   * @param process The process (real or abstract) to use for starting the
   * server.
   */</span>
  <span class="keyword">def</span> <a title="(process: play.core.server.ServerProcess)play.core.server.ServerWithStop" id="play.core.server.ProdServerStart.start">start</a><span class="delimiter">(</span><a title="play.core.server.ServerProcess" id="play.core.server.ProdServerStart.start.process">process</a>: <a href="ServerProcess.scala.html#play.core.server;ServerProcess" title="play.core.server.ServerProcess">ServerProcess</a><span class="delimiter">)</span>: <span title="play.core.server.ServerWithStop">ServerWithStop</span> = <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>

      <span class="comment">// Read settings</span>
      <span class="keyword">val</span> <a title="play.core.server.ServerConfig" id="play.core.server.ProdServerStart.start.config">config</a>: <a href="ServerConfig.scala.html#play.core.server;ServerConfig" title="play.core.server.ServerConfig">ServerConfig</a> = <a href="#play.core.server.ProdServerStart.readServerConfigSettings" title="(process: play.core.server.ServerProcess)play.core.server.ServerConfig">readServerConfigSettings</a><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.start.process" title="play.core.server.ServerProcess">process</a><span class="delimiter">)</span>

      <span class="comment">// Create a PID file before we do any real work</span>
      <span class="keyword">val</span> <a title="Option[java.io.File]" id="play.core.server.ProdServerStart.start.pidFile">pidFile</a> = <a href="#play.core.server.ProdServerStart.createPidFile" title="(process: play.core.server.ServerProcess, configuration: play.api.Configuration)Option[java.io.File]">createPidFile</a><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.start.process" title="play.core.server.ServerProcess">process</a>, <a href="#play.core.server.ProdServerStart.start.config" title="play.core.server.ServerConfig">config</a>.<a href="ServerConfig.scala.html#play.core.server;ServerConfig.configuration" title="=&gt; play.api.Configuration">configuration</a><span class="delimiter">)</span>

      <span class="comment">// Start the application</span>
      <span class="keyword">val</span> <a title="play.api.Application" id="play.core.server.ProdServerStart.start.application">application</a>: <a href="../../../../play/play/api/Application.scala.html#play.api;Application" title="play.api.Application">Application</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="play.api.Environment" id="play.core.server.ProdServerStart.start.application.environment">environment</a> = <a href="../../../../play/play/api/Environment.scala.html#play.api;Environment" title="(rootPath: java.io.File, classLoader: ClassLoader, mode: play.api.Mode.Mode)play.api.Environment">Environment</a><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.start.config" title="play.core.server.ServerConfig">config</a>.<a href="ServerConfig.scala.html#play.core.server;ServerConfig.rootDir" title="=&gt; java.io.File">rootDir</a>, <a href="#play.core.server.ProdServerStart.start.process" title="play.core.server.ServerProcess">process</a>.<a href="ServerProcess.scala.html#play.core.server;ServerProcess.classLoader" title="=&gt; ClassLoader">classLoader</a>, <a href="../../../../play/play/api/Play.scala.html#play.api.Mode" title="play.api.Mode.type">Mode</a>.<a href="../../../../play/play/api/Play.scala.html#play.api.Mode.Prod" title="=&gt; play.api.Mode.Value">Prod</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="play.api.ApplicationLoader.Context" id="play.core.server.ProdServerStart.start.application.context">context</a> = <a href="../../../../play/play/api/ApplicationLoader.scala.html#play.api.ApplicationLoader" title="play.api.ApplicationLoader.type">ApplicationLoader</a>.<a href="../../../../play/play/api/ApplicationLoader.scala.html#play.api.ApplicationLoader.createContext" title="(environment: play.api.Environment, initialSettings: Map[String,AnyRef], sourceMapper: Option[play.core.SourceMapper], webCommands: play.core.WebCommands)play.api.ApplicationLoader.Context">createContext</a><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.start.application.environment" title="play.api.Environment">environment</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="play.api.ApplicationLoader" id="play.core.server.ProdServerStart.start.application.loader">loader</a> = <a href="../../../../play/play/api/ApplicationLoader.scala.html#play.api.ApplicationLoader.apply" title="(context: play.api.ApplicationLoader.Context)play.api.ApplicationLoader">ApplicationLoader</a><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.start.application.context" title="play.api.ApplicationLoader.Context">context</a><span class="delimiter">)</span>
        <a href="#play.core.server.ProdServerStart.start.application.loader" title="play.api.ApplicationLoader">loader</a>.<a href="../../../../play/play/api/ApplicationLoader.scala.html#play.api;ApplicationLoader.load" title="(context: play.api.ApplicationLoader.Context)play.api.Application">load</a><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.start.application.context" title="play.api.ApplicationLoader.Context">context</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="../../../../play/play/api/Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../../../../play/play/api/Play.scala.html#play.api.Play.start" title="(app: play.api.Application)Unit">start</a><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.start.application" title="play.api.Application">application</a><span class="delimiter">)</span>

      <span class="comment">// Start the server</span>
      <span class="keyword">val</span> <a title="play.core.server.ServerProvider" id="play.core.server.ProdServerStart.start.serverProvider">serverProvider</a>: <a href="ServerProvider.scala.html#play.core.server;ServerProvider" title="play.core.server.ServerProvider">ServerProvider</a> = <a href="ServerProvider.scala.html#play.core.server.ServerProvider" title="play.core.server.ServerProvider.type">ServerProvider</a>.<a href="ServerProvider.scala.html#play.core.server.ServerProvider.fromConfiguration" title="(classLoader: ClassLoader, configuration: play.api.Configuration)play.core.server.ServerProvider">fromConfiguration</a><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.start.process" title="play.core.server.ServerProcess">process</a>.<a href="ServerProcess.scala.html#play.core.server;ServerProcess.classLoader" title="=&gt; ClassLoader">classLoader</a>, <a href="#play.core.server.ProdServerStart.start.config" title="play.core.server.ServerConfig">config</a>.<a href="ServerConfig.scala.html#play.core.server;ServerConfig.configuration" title="=&gt; play.api.Configuration">configuration</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="play.core.server.Server" id="play.core.server.ProdServerStart.start.server">server</a> = <a href="#play.core.server.ProdServerStart.start.serverProvider" title="play.core.server.ServerProvider">serverProvider</a>.<a href="ServerProvider.scala.html#play.core.server;ServerProvider.createServer(e55918b811)" title="(config: play.core.server.ServerConfig, app: play.api.Application)play.core.server.Server">createServer</a><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.start.config" title="play.core.server.ServerConfig">config</a>, <a href="#play.core.server.ProdServerStart.start.application" title="play.api.Application">application</a><span class="delimiter">)</span>
      <a href="#play.core.server.ProdServerStart.start.process" title="play.core.server.ServerProcess">process</a>.<a href="ServerProcess.scala.html#play.core.server;ServerProcess.addShutdownHook" title="(hook: =&gt; Unit)Unit">addShutdownHook</a> <span class="delimiter">{</span>
        <a href="#play.core.server.ProdServerStart.start.server" title="play.core.server.Server">server</a>.<a href="Server.scala.html#play.core.server;Server.stop" title="()Unit">stop</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#play.core.server.ProdServerStart.start.pidFile" title="Option[java.io.File]">pidFile</a>.<span title="(f: java.io.File =&gt; Boolean)Unit">foreach</span><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.start.$anonfun.x$1" title="java.io.File">_</a>.<span title="()Boolean">delete</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#play.core.server.ProdServerStart.start.pidFile" title="Option[java.io.File]">pidFile</a>.<span title="(p: java.io.File =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.start.$anonfun.x$2" title="java.io.File">_</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span>, <span title="String(&quot;PID file should not exist!&quot;)" class="string">&quot;PID file should not exist!&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#play.core.server.ProdServerStart.start.server" title="play.core.server.Server">server</a>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> ServerStartException<span class="delimiter">(</span><a title="String" id="play.core.server.ProdServerStart.start.message">message</a>, <a title="Option[Throwable]" id="play.core.server.ProdServerStart.start.cause">cause</a><span class="delimiter">)</span> =&gt;
        <a href="#play.core.server.ProdServerStart.start.process" title="play.core.server.ServerProcess">process</a>.<a href="ServerProcess.scala.html#play.core.server;ServerProcess.exit" title="(message: String, cause: Option[Throwable], returnCode: Int)Nothing">exit</a><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.start.message" title="String">message</a>, <a href="#play.core.server.ProdServerStart.start.cause" title="Option[Throwable]">cause</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#play.core.server.ProdServerStart.start.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="play.core.server.ProdServerStart.start.e">e</a><span class="delimiter">)</span> =&gt;
        <a href="#play.core.server.ProdServerStart.start.process" title="play.core.server.ServerProcess">process</a>.<a href="ServerProcess.scala.html#play.core.server;ServerProcess.exit" title="(message: String, cause: Option[Throwable], returnCode: Int)Nothing">exit</a><span class="delimiter">(</span><span title="String(&quot;Oops, cannot start the server.&quot;)" class="string">&quot;Oops, cannot start the server.&quot;</span>, cause = <span title="(x: Throwable)Some[Throwable]">Some</span><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.start.e" title="Throwable">e</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Read the server config from the current process's command
   * line args and system properties.
   */</span>
  <span class="keyword">def</span> <a title="(process: play.core.server.ServerProcess)play.core.server.ServerConfig" id="play.core.server.ProdServerStart.readServerConfigSettings">readServerConfigSettings</a><span class="delimiter">(</span><a title="play.core.server.ServerProcess" id="play.core.server.ProdServerStart.readServerConfigSettings.process">process</a>: <a href="ServerProcess.scala.html#play.core.server;ServerProcess" title="play.core.server.ServerProcess">ServerProcess</a><span class="delimiter">)</span>: <a href="ServerConfig.scala.html#play.core.server;ServerConfig" title="play.core.server.ServerConfig">ServerConfig</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.Configuration" id="play.core.server.ProdServerStart.readServerConfigSettings.configuration">configuration</a>: <a href="../../../../play/play/api/Configuration.scala.html#play.api;Configuration" title="play.api.Configuration">Configuration</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Option[java.io.File]" id="play.core.server.ProdServerStart.readServerConfigSettings.configuration.rootDirArg">rootDirArg</a>: <span title="Option[java.io.File]">Option</span><span class="delimiter">[</span>File<span class="delimiter">]</span> = <a href="#play.core.server.ProdServerStart.readServerConfigSettings.process" title="play.core.server.ServerProcess">process</a>.<a href="ServerProcess.scala.html#play.core.server;ServerProcess.args" title="=&gt; Seq[String]">args</a>.<span title="=&gt; Option[String]">headOption</span>.<span title="(f: String =&gt; java.io.File)Option[java.io.File]">map</span><span class="delimiter">(</span><span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.readServerConfigSettings.configuration.rootDirArg.$anonfun.x$3" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.immutable.Map[String,String]" id="play.core.server.ProdServerStart.readServerConfigSettings.configuration.rootDirConfig">rootDirConfig</a> = <a href="#play.core.server.ProdServerStart.readServerConfigSettings.configuration.rootDirArg" title="Option[java.io.File]">rootDirArg</a>.<span title="(ifEmpty: =&gt; scala.collection.immutable.Map[String,String])(f: java.io.File =&gt; scala.collection.immutable.Map[String,String])scala.collection.immutable.Map[String,String]">fold</span><span class="delimiter">(</span><span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[String,String]" class="delimiter">[</span><span title="String">String</span>, <span title="String">String</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="java.io.File" id="play.core.server.ProdServerStart.readServerConfigSettings.configuration.rootDirConfig.$anonfun.dir">dir</a> =&gt; <a href="ServerConfig.scala.html#play.core.server.ServerConfig" title="play.core.server.ServerConfig.type">ServerConfig</a>.<a href="ServerConfig.scala.html#play.core.server.ServerConfig.rootDirConfig" title="(rootDir: java.io.File)Map[String,String]">rootDirConfig</a><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.readServerConfigSettings.configuration.rootDirConfig.$anonfun.dir" title="java.io.File">dir</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../../../../play/play/api/Configuration.scala.html#play.api.Configuration" title="play.api.Configuration.type">Configuration</a>.<a href="../../../../play/play/api/Configuration.scala.html#play.api.Configuration.load(f566f92257)" title="(classLoader: ClassLoader, properties: java.util.Properties, directSettings: Map[String,AnyRef], allowMissingApplicationConf: Boolean)play.api.Configuration">load</a><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.readServerConfigSettings.process" title="play.core.server.ServerProcess">process</a>.<a href="ServerProcess.scala.html#play.core.server;ServerProcess.classLoader" title="=&gt; ClassLoader">classLoader</a>, <a href="#play.core.server.ProdServerStart.readServerConfigSettings.process" title="play.core.server.ServerProcess">process</a>.<a href="ServerProcess.scala.html#play.core.server;ServerProcess.properties" title="=&gt; java.util.Properties">properties</a>, <a href="#play.core.server.ProdServerStart.readServerConfigSettings.configuration.rootDirConfig" title="scala.collection.immutable.Map[String,String]">rootDirConfig</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="java.io.File" id="play.core.server.ProdServerStart.readServerConfigSettings.rootDir">rootDir</a>: <span title="java.io.File">File</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="play.core.server.ProdServerStart.readServerConfigSettings.rootDir.path">path</a> = <a href="#play.core.server.ProdServerStart.readServerConfigSettings.configuration" title="play.api.Configuration">configuration</a>.<a href="../../../../play/play/api/Configuration.scala.html#play.api;Configuration.getString" title="(path: String, validValues: Option[Set[String]])Option[String]">getString</a><span class="delimiter">(</span><span title="String(&quot;play.server.dir&quot;)" class="string">&quot;play.server.dir&quot;</span><span class="delimiter">)</span>.<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="ServerStartException.scala.html#play.core.server;ServerStartException" title="(message: String, cause: Option[Throwable])play.core.server.ServerStartException">ServerStartException</a><span class="delimiter">(</span><span title="String(&quot;No root server path supplied&quot;)" class="string">&quot;No root server path supplied&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.io.File" id="play.core.server.ProdServerStart.readServerConfigSettings.rootDir.file">file</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.readServerConfigSettings.rootDir.path" title="String">path</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.readServerConfigSettings.rootDir.file" title="java.io.File">file</a>.<span title="()Boolean">exists</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#play.core.server.ProdServerStart.readServerConfigSettings.rootDir.file" title="java.io.File">file</a>.<span title="()Boolean">isDirectory</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Nothing" class="keyword">throw</span> <a href="ServerStartException.scala.html#play.core.server;ServerStartException" title="(message: String, cause: Option[Throwable])play.core.server.ServerStartException">ServerStartException</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Bad root server path: &quot;)">Bad root server path: $</span><a href="#play.core.server.ProdServerStart.readServerConfigSettings.rootDir.path" title="String">path</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#play.core.server.ProdServerStart.readServerConfigSettings.rootDir.file" title="java.io.File">file</a>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="Option[Int]" id="play.core.server.ProdServerStart.readServerConfigSettings.httpPort">httpPort</a> = <a href="#play.core.server.ProdServerStart.readServerConfigSettings.configuration" title="play.api.Configuration">configuration</a>.<a href="../../../../play/play/api/Configuration.scala.html#play.api;Configuration.getString" title="(path: String, validValues: Option[Set[String]])Option[String]">getString</a><span class="delimiter">(</span><span title="String(&quot;play.server.http.port&quot;)" class="string">&quot;play.server.http.port&quot;</span><span class="delimiter">)</span>.<span title="(f: String =&gt; Option[Int])Option[Int]">flatMap</span> <a href="#play.core.server.ProdServerStart.readServerConfigSettings.httpPort.$anonfun.x0$1" title="Option[Int]" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="String(&quot;disabled&quot;)" class="string">&quot;disabled&quot;</span> =&gt; <span title="None.type">None</span>
      <span class="keyword">case</span> <a title="String" id="play.core.server.ProdServerStart.readServerConfigSettings.httpPort.$anonfun.str">str</a> =&gt;
        <span class="keyword">val</span> <a title="Int" id="play.core.server.ProdServerStart.readServerConfigSettings.httpPort.$anonfun.i">i</a> = <span class="keyword">try</span> <span title="Integer.type">Integer</span>.<span title="(x$1: String)Int">parseInt</span><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.readServerConfigSettings.httpPort.$anonfun.str" title="String">str</a><span class="delimiter">)</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> _: <span title="NumberFormatException">NumberFormatException</span> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="ServerStartException.scala.html#play.core.server;ServerStartException" title="(message: String, cause: Option[Throwable])play.core.server.ServerStartException">ServerStartException</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Invalid HTTP port: &quot;)">Invalid HTTP port: $</span><a href="#play.core.server.ProdServerStart.readServerConfigSettings.httpPort.$anonfun.str" title="String">str</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.readServerConfigSettings.httpPort.$anonfun.i" title="Int">i</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="Option[Int]" id="play.core.server.ProdServerStart.readServerConfigSettings.httpsPort">httpsPort</a> = <a href="#play.core.server.ProdServerStart.readServerConfigSettings.configuration" title="play.api.Configuration">configuration</a>.<a href="../../../../play/play/api/Configuration.scala.html#play.api;Configuration.getInt" title="(path: String)Option[Int]">getInt</a><span class="delimiter">(</span><span title="String(&quot;play.server.https.port&quot;)" class="string">&quot;play.server.https.port&quot;</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.readServerConfigSettings.httpPort" title="Option[Int]">httpPort</a> <span title="(alternative: =&gt; Option[Int])Option[Int]">orElse</span> <a href="#play.core.server.ProdServerStart.readServerConfigSettings.httpsPort" title="Option[Int]">httpsPort</a><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <a href="ServerStartException.scala.html#play.core.server;ServerStartException" title="(message: String, cause: Option[Throwable])play.core.server.ServerStartException">ServerStartException</a><span class="delimiter">(</span><span title="String(&quot;Must provide either an HTTP or HTTPS port&quot;)" class="string">&quot;Must provide either an HTTP or HTTPS port&quot;</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="String" id="play.core.server.ProdServerStart.readServerConfigSettings.address">address</a> = <a href="#play.core.server.ProdServerStart.readServerConfigSettings.configuration" title="play.api.Configuration">configuration</a>.<a href="../../../../play/play/api/Configuration.scala.html#play.api;Configuration.getString" title="(path: String, validValues: Option[Set[String]])Option[String]">getString</a><span class="delimiter">(</span><span title="String(&quot;play.server.http.address&quot;)" class="string">&quot;play.server.http.address&quot;</span><span class="delimiter">)</span>.<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><span title="String(&quot;0.0.0.0&quot;)" class="string">&quot;0.0.0.0&quot;</span><span class="delimiter">)</span>

    <a href="ServerConfig.scala.html#play.core.server;ServerConfig" title="(rootDir: java.io.File, port: Option[Int], sslPort: Option[Int], address: String, mode: play.api.Mode.Mode, properties: java.util.Properties, configuration: play.api.Configuration)play.core.server.ServerConfig">ServerConfig</a><span class="delimiter">(</span>
      rootDir = <a href="#play.core.server.ProdServerStart.readServerConfigSettings.rootDir" title="java.io.File">rootDir</a>,
      port = <a href="#play.core.server.ProdServerStart.readServerConfigSettings.httpPort" title="Option[Int]">httpPort</a>,
      sslPort = <a href="#play.core.server.ProdServerStart.readServerConfigSettings.httpsPort" title="Option[Int]">httpsPort</a>,
      address = <a href="#play.core.server.ProdServerStart.readServerConfigSettings.address" title="String">address</a>,
      mode = <a href="../../../../play/play/api/Play.scala.html#play.api.Mode" title="play.api.Mode.type">Mode</a>.<a href="../../../../play/play/api/Play.scala.html#play.api.Mode.Prod" title="=&gt; play.api.Mode.Value">Prod</a>,
      properties = <a href="#play.core.server.ProdServerStart.readServerConfigSettings.process" title="play.core.server.ServerProcess">process</a>.<a href="ServerProcess.scala.html#play.core.server;ServerProcess.properties" title="=&gt; java.util.Properties">properties</a>,
      configuration = <a href="#play.core.server.ProdServerStart.readServerConfigSettings.configuration" title="play.api.Configuration">configuration</a>
    <span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Create a pid file for the current process, and register a hook
   * to delete the file on process termination.
   */</span>
  <span class="keyword">def</span> <a title="(process: play.core.server.ServerProcess, configuration: play.api.Configuration)Option[java.io.File]" id="play.core.server.ProdServerStart.createPidFile">createPidFile</a><span class="delimiter">(</span><a title="play.core.server.ServerProcess" id="play.core.server.ProdServerStart.createPidFile.process">process</a>: <a href="ServerProcess.scala.html#play.core.server;ServerProcess" title="play.core.server.ServerProcess">ServerProcess</a>, <a title="play.api.Configuration" id="play.core.server.ProdServerStart.createPidFile.configuration">configuration</a>: <a href="../../../../play/play/api/Configuration.scala.html#play.api;Configuration" title="play.api.Configuration">Configuration</a><span class="delimiter">)</span>: <span title="Option[java.io.File]">Option</span><span class="delimiter">[</span>File<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="play.core.server.ProdServerStart.createPidFile.pidFilePath">pidFilePath</a> = <a href="#play.core.server.ProdServerStart.createPidFile.configuration" title="play.api.Configuration">configuration</a>.<a href="../../../../play/play/api/Configuration.scala.html#play.api;Configuration.getString" title="(path: String, validValues: Option[Set[String]])Option[String]">getString</a><span class="delimiter">(</span><span title="String(&quot;play.server.pidfile.path&quot;)" class="string">&quot;play.server.pidfile.path&quot;</span><span class="delimiter">)</span>.<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="ServerStartException.scala.html#play.core.server;ServerStartException" title="(message: String, cause: Option[Throwable])play.core.server.ServerStartException">ServerStartException</a><span class="delimiter">(</span><span title="String(&quot;Pid file path not configured&quot;)" class="string">&quot;Pid file path not configured&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="Option[java.io.File]" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.createPidFile.pidFilePath" title="String">pidFilePath</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="String(&quot;/dev/null&quot;)" class="string">&quot;/dev/null&quot;</span><span class="delimiter">)</span> <span title="None.type">None</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.io.File" id="play.core.server.ProdServerStart.createPidFile.pidFile">pidFile</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.createPidFile.pidFilePath" title="String">pidFilePath</a><span class="delimiter">)</span>.<span title="()java.io.File">getAbsoluteFile</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.createPidFile.pidFile" title="java.io.File">pidFile</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Nothing" class="keyword">throw</span> <a href="ServerStartException.scala.html#play.core.server;ServerStartException" title="(message: String, cause: Option[Throwable])play.core.server.ServerStartException">ServerStartException</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;This application is already running (Or delete &quot;)">This application is already running (Or delete $</span><span class="delimiter">{</span><a href="#play.core.server.ProdServerStart.createPidFile.pidFile" title="java.io.File">pidFile</a>.<span title="()String">getPath</span><span class="delimiter">}</span><span title="String(&quot; file).&quot;)" class="string"> file).&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="String" id="play.core.server.ProdServerStart.createPidFile.pid">pid</a> = <a href="#play.core.server.ProdServerStart.createPidFile.process" title="play.core.server.ServerProcess">process</a>.<a href="ServerProcess.scala.html#play.core.server;ServerProcess.pid" title="=&gt; Option[String]">pid</a> <span title="(default: =&gt; String)String">getOrElse</span> <span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="ServerStartException.scala.html#play.core.server;ServerStartException" title="(message: String, cause: Option[Throwable])play.core.server.ServerStartException">ServerStartException</a><span class="delimiter">(</span><span title="String(&quot;Couldn\'t determine current process\'s pid&quot;)" class="string">&quot;Couldn't determine current process's pid&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.io.FileOutputStream" id="play.core.server.ProdServerStart.createPidFile.out">out</a> = <span title="(x$1: java.io.File)java.io.FileOutputStream" class="keyword">new</span> <span title="java.io.FileOutputStream">FileOutputStream</span><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.createPidFile.pidFile" title="java.io.File">pidFile</a><span class="delimiter">)</span>
      <span class="keyword">try</span> <a href="#play.core.server.ProdServerStart.createPidFile.out" title="java.io.FileOutputStream">out</a>.<span title="(x$1: Array[Byte])Unit">write</span><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.createPidFile.pid" title="String">pid</a>.<span title="()Array[Byte]">getBytes</span><span class="delimiter">)</span> <span class="keyword">finally</span> <a href="#play.core.server.ProdServerStart.createPidFile.out" title="java.io.FileOutputStream">out</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>

      <span title="(x: java.io.File)Some[java.io.File]">Some</span><span class="delimiter">(</span><a href="#play.core.server.ProdServerStart.createPidFile.pidFile" title="java.io.File">pidFile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>
        </pre>
    </body>
</html>
