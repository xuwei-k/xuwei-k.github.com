<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>play-jdbc-evolutions/play/api/db/evolutions/Evolutions.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> play.api.db.evolutions

<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> java.nio.file._
<span class="keyword">import</span> java.nio.charset.Charset

<span class="keyword">import</span> play.api.<span class="delimiter">{</span> Application, Configuration, Environment, Logger, Mode, Play <span class="delimiter">}</span>
<span class="keyword">import</span> play.api.db.<span class="delimiter">{</span> DBApi, Database <span class="delimiter">}</span>
<span class="keyword">import</span> play.api.inject.DefaultApplicationLifecycle
<span class="keyword">import</span> play.api.libs.<a href="../../../../../play/play/api/libs/Codecs.scala.html#play.api.libs.Codecs" title="play.api.libs.Codecs.type">Codecs</a>.sha1
<span class="keyword">import</span> play.core.DefaultWebCommands
<span class="keyword">import</span> play.utils.PlayIO

<span class="comment">/**
 * An SQL evolution - database changes associated with a software version.
 *
 * An evolution includes ‘up’ changes, to upgrade to the next version, as well
 * as ‘down’ changes, to downgrade the database to the previous version.
 *
 * @param revision revision number
 * @param sql_up the SQL statements for UP application
 * @param sql_down the SQL statements for DOWN application
 */</span>
<span class="keyword">case class</span> <a title="class Evolution extends AnyRef with Product with Serializable" id="play.api.db.evolutions.Evolution.readResolve">Evolution</a><a href="#play.api.db.evolutions.Evolution.readResolve" title="Product" class="delimiter">(</a><a title="Int" id="play.api.db.evolutions;Evolution.revision">revision</a>: <span title="Int">Int</span>, <a title="String" id="play.api.db.evolutions.Evolution.apply$default$2">sql_up</a>: <span title="String">String</span> = <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a title="String" id="play.api.db.evolutions.Evolution.apply$default$3">sql_down</a>: <span title="String">String</span> = <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="comment">/**
   * Revision hash, automatically computed from the SQL content.
   */</span>
  <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;Evolution.hash">hash</a> = <a href="../../../../../play/play/api/libs/Codecs.scala.html#play.api.libs.Codecs.sha1(d814a8dff5)" title="(text: String)String">sha1</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolution.apply$default$3" title="=&gt; String">sql_down</a>.<span title="()String">trim</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions.Evolution.apply$default$2" title="=&gt; String">sql_up</a>.<span title="()String">trim</span><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * A Script to run on the database.
 */</span>
<span class="keyword">trait</span> <a title="trait Script extends AnyRef" id="play.api.db.evolutions;Script">Script</a> <span title="Unit" class="delimiter">{</span>

  <span class="comment">/**
   * Original evolution.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; play.api.db.evolutions.Evolution" id="play.api.db.evolutions;Script.evolution">evolution</a>: <a href="#play.api.db.evolutions.Evolution.readResolve" title="play.api.db.evolutions.Evolution">Evolution</a>

  <span class="comment">/**
   * The complete SQL to be run.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="play.api.db.evolutions;Script.sql">sql</a>: <span title="String">String</span>

  <span class="comment">/**
   * The sql string separated into constituent &quot;;&quot;-delimited statements.
   *
   * Any &quot;;;&quot; found in the sql are escaped to &quot;;&quot;.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Seq[String]" id="play.api.db.evolutions;Script.statements">statements</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="comment">// Regex matches on semicolons that neither precede nor follow other semicolons</span>
    <a href="#play.api.db.evolutions;Script.sql" title="=&gt; String">sql</a>.<span title="(x$1: String)Array[String]">split</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><span title="String(&quot;(?&lt;!;);(?!;)&quot;)" class="string">&quot;(?&lt;!;);(?!;)&quot;</span><span class="delimiter">)</span>.<span title="(f: String =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Array[String],String,Array[String]])Array[String]">map</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><a href="#play.api.db.evolutions;Script.statements.$anonfun.x$1" title="String">_</a>.<span title="()String">trim</span>.<span title="(x$1: CharSequence, x$2: CharSequence)String">replace</span><span class="delimiter">(</span><span title="String(&quot;;;&quot;)" class="string">&quot;;;&quot;</span>, <span title="String(&quot;;&quot;)" class="string">&quot;;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(p: String =&gt; Boolean)Array[String]">filter</span><span title="(xs: Array[String])scala.collection.mutable.WrappedArray[String]" class="delimiter">(</span><a href="#play.api.db.evolutions;Script.statements.$anonfun.x$2" title="String">_</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * An UP Script to run on the database.
 *
 * @param evolution the original evolution
 */</span>
<span title="AnyRef" class="keyword">case class</span> <a title="class UpScript extends AnyRef with play.api.db.evolutions.Script with Product with Serializable" id="play.api.db.evolutions.UpScript.readResolve">UpScript</a><a href="#play.api.db.evolutions.UpScript.readResolve" title="Product" class="delimiter">(</a><a title="play.api.db.evolutions.Evolution" id="play.api.db.evolutions;UpScript.evolution">evolution</a>: <a href="#play.api.db.evolutions.Evolution.readResolve" title="play.api.db.evolutions.Evolution">Evolution</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#play.api.db.evolutions;Script" title="play.api.db.evolutions.Script">Script</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="play.api.db.evolutions;UpScript.sql">sql</a>: <span title="String">String</span> = <a href="#play.api.db.evolutions;UpScript.evolution" title="=&gt; play.api.db.evolutions.Evolution">evolution</a>.<a href="#play.api.db.evolutions.Evolution.apply$default$2" title="=&gt; String">sql_up</a>
<span class="delimiter">}</span>

<span class="comment">/**
 * A DOWN Script to run on the database.
 *
 * @param evolution the original evolution
 */</span>
<span class="keyword">case class</span> <a title="class DownScript extends AnyRef with play.api.db.evolutions.Script with Product with Serializable" id="play.api.db.evolutions.DownScript.readResolve">DownScript</a><a href="#play.api.db.evolutions.DownScript.readResolve" title="Product" class="delimiter">(</a><a title="play.api.db.evolutions.Evolution" id="play.api.db.evolutions;DownScript.evolution">evolution</a>: <a href="#play.api.db.evolutions.Evolution.readResolve" title="play.api.db.evolutions.Evolution">Evolution</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#play.api.db.evolutions;Script" title="play.api.db.evolutions.Script">Script</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="play.api.db.evolutions;DownScript.sql">sql</a>: <span title="String">String</span> = <a href="#play.api.db.evolutions;DownScript.evolution" title="=&gt; play.api.db.evolutions.Evolution">evolution</a>.<a href="#play.api.db.evolutions.Evolution.apply$default$3" title="=&gt; String">sql_down</a>
<span class="delimiter">}</span>

<span class="comment">/**
 * Defines database url patterns.
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>evolutions<span class="delimiter">]</span> <span class="keyword">object</span> <a title="play.api.db.evolutions.DatabaseUrlPatterns.type" id="play.api.db.evolutions.DatabaseUrlPatterns">DatabaseUrlPatterns</a> <a href="#play.api.db.evolutions.DatabaseUrlPatterns" title="play.api.db.evolutions.DatabaseUrlPatterns.type" class="delimiter">{</a>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="play.api.db.evolutions.DatabaseUrlPatterns.SqlServerJdbcUrl">SqlServerJdbcUrl</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;^jdbc:sqlserver:.*&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="play.api.db.evolutions.DatabaseUrlPatterns.OracleJdbcUrl">OracleJdbcUrl</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;^jdbc:oracle:.*&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="play.api.db.evolutions.DatabaseUrlPatterns.MysqlJdbcUrl">MysqlJdbcUrl</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;^(jdbc:)?mysql:.*&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Defines Evolutions utilities functions.
 */</span>
<span title="AnyRef" class="keyword">object</span> <a title="play.api.db.evolutions.Evolutions.type" id="play.api.db.evolutions.Evolutions">Evolutions</a> <a href="#play.api.db.evolutions.Evolutions" title="play.api.db.evolutions.Evolutions.type" class="delimiter">{</a>

  <span class="comment">/**
   * Default evolutions directory location.
   */</span>
  <span class="keyword">def</span> <a title="(db: String)String" id="play.api.db.evolutions.Evolutions.directoryName">directoryName</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions.Evolutions.directoryName.db">db</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;conf/evolutions/&quot;)">conf/evolutions/$</span><span class="delimiter">{</span><a href="#play.api.db.evolutions.Evolutions.directoryName.db" title="String">db</a><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;</span>

  <span class="comment">/**
   * Default evolution file location.
   */</span>
  <span class="keyword">def</span> <a title="(db: String, revision: Int)String" id="play.api.db.evolutions.Evolutions.fileName">fileName</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions.Evolutions.fileName.db">db</a>: <span title="String">String</span>, <a title="Int" id="play.api.db.evolutions.Evolutions.fileName.revision">revision</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;&quot;)">$</span><span class="delimiter">{</span><a href="#play.api.db.evolutions.Evolutions.directoryName" title="(db: String)String">directoryName</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.fileName.db" title="String">db</a><span class="delimiter">)</span><span class="delimiter">}</span><span title="String(&quot;/&quot;)">/$</span><span class="delimiter">{</span><a href="#play.api.db.evolutions.Evolutions.fileName.revision" title="Int">revision</a><span class="delimiter">}</span><span title="String(&quot;.sql&quot;)" class="string">.sql&quot;</span>

  <span class="comment">/**
   * Default evolution resource name.
   */</span>
  <span class="keyword">def</span> <a title="(db: String, revision: Int)String" id="play.api.db.evolutions.Evolutions.resourceName">resourceName</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions.Evolutions.resourceName.db">db</a>: <span title="String">String</span>, <a title="Int" id="play.api.db.evolutions.Evolutions.resourceName.revision">revision</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;evolutions/&quot;)">evolutions/$</span><span class="delimiter">{</span><a href="#play.api.db.evolutions.Evolutions.resourceName.db" title="String">db</a><span class="delimiter">}</span><span title="String(&quot;/&quot;)">/$</span><span class="delimiter">{</span><a href="#play.api.db.evolutions.Evolutions.resourceName.revision" title="Int">revision</a><span class="delimiter">}</span><span title="String(&quot;.sql&quot;)" class="string">.sql&quot;</span>

  <span class="comment">/**
   * Apply pending evolutions for the given DB.
   */</span>
  <span class="keyword">def</span> <a title="(dbName: String, path: java.io.File, autocommit: Boolean)Unit" id="play.api.db.evolutions.Evolutions.applyFor">applyFor</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions.Evolutions.applyFor.dbName">dbName</a>: <span title="String">String</span>, <a title="java.io.File" id="play.api.db.evolutions.Evolutions.applyFor$default$2">path</a>: java.io.<span title="java.io.File">File</span> = <span title="java.io.File" class="keyword">new</span> java.io.<span title="java.io.File">File</span><span class="delimiter">(</span><span title="String(&quot;.&quot;)" class="string">&quot;.&quot;</span><span class="delimiter">)</span>, <a title="Boolean" id="play.api.db.evolutions.Evolutions.applyFor$default$3">autocommit</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.db.evolutions.EvolutionsApi" id="play.api.db.evolutions.Evolutions.applyFor.evolutions">evolutions</a> = <a href="../../../../../play/play/api/Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../../../../../play/play/api/Play.scala.html#play.api.Play.current" title="=&gt; play.api.Application">current</a>.<a href="../../../../../play/play/api/Application.scala.html#play.api;Application.injector" title="=&gt; play.api.inject.Injector">injector</a>.<a href="../../../../../play/play/api/inject/Injector.scala.html#play.api.inject;Injector.instanceOf(ffe51818f2)" title="[T](implicit evidence$1: scala.reflect.ClassTag[T])T">instanceOf</a><span title="(implicit evidence$1: scala.reflect.ClassTag[play.api.db.evolutions.EvolutionsApi])play.api.db.evolutions.EvolutionsApi" class="delimiter">[</span><a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi" title="play.api.db.evolutions.EvolutionsApi">EvolutionsApi</a><span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions.Evolutions.applyFor.scripts">scripts</a> = <a href="#play.api.db.evolutions.Evolutions.applyFor.evolutions" title="play.api.db.evolutions.EvolutionsApi">evolutions</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi.scripts(a24908cd1f)" title="(db: String, reader: play.api.db.evolutions.EvolutionsReader)Seq[play.api.db.evolutions.Script]">scripts</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.applyFor.dbName" title="String">dbName</a>, <span title="play.api.db.evolutions.EnvironmentEvolutionsReader" class="keyword">new</span> <a href="EvolutionsApi.scala.html#play.api.db.evolutions;EnvironmentEvolutionsReader" title="play.api.db.evolutions.EnvironmentEvolutionsReader">EnvironmentEvolutionsReader</a><span class="delimiter">(</span><a href="../../../../../play/play/api/Environment.scala.html#play.api.Environment" title="play.api.Environment.type">Environment</a>.<a href="../../../../../play/play/api/Environment.scala.html#play.api.Environment.simple" title="(path: java.io.File, mode: play.api.Mode.Mode)play.api.Environment">simple</a><span class="delimiter">(</span>path = <a href="#play.api.db.evolutions.Evolutions.applyFor$default$2" title="java.io.File">path</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#play.api.db.evolutions.Evolutions.applyFor.evolutions" title="play.api.db.evolutions.EvolutionsApi">evolutions</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi.evolve" title="(db: String, scripts: Seq[play.api.db.evolutions.Script], autocommit: Boolean)Unit">evolve</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.applyFor.dbName" title="String">dbName</a>, <a href="#play.api.db.evolutions.Evolutions.applyFor.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a>, <a href="#play.api.db.evolutions.Evolutions.applyFor$default$3" title="Boolean">autocommit</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Updates a local (file-based) evolution script.
   */</span>
  <span class="keyword">def</span> <a title="(db: String, revision: Int, comment: String, ups: String, downs: String)(implicit application: play.api.Application)Unit" id="play.api.db.evolutions.Evolutions.updateEvolutionScript">updateEvolutionScript</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions.Evolutions.updateEvolutionScript$default$1">db</a>: <span title="String">String</span> = <span title="String(&quot;default&quot;)" class="string">&quot;default&quot;</span>, <a title="Int" id="play.api.db.evolutions.Evolutions.updateEvolutionScript$default$2">revision</a>: <span title="Int">Int</span> = <span title="Int(1)" class="int">1</span>, <a title="String" id="play.api.db.evolutions.Evolutions.updateEvolutionScript$default$3">comment</a>: <span title="String">String</span> = <span title="String(&quot;Generated&quot;)" class="string">&quot;Generated&quot;</span>, <a title="String" id="play.api.db.evolutions.Evolutions.updateEvolutionScript.ups">ups</a>: <span title="String">String</span>, <a title="String" id="play.api.db.evolutions.Evolutions.updateEvolutionScript.downs">downs</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="play.api.Application" id="play.api.db.evolutions.Evolutions.updateEvolutionScript.application">application</a>: <a href="../../../../../play/play/api/Application.scala.html#play.api;Application" title="play.api.Application">Application</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.Environment" id="play.api.db.evolutions.Evolutions.updateEvolutionScript.environment">environment</a> = <a href="#play.api.db.evolutions.Evolutions.updateEvolutionScript.application" title="play.api.Application">application</a>.<a href="../../../../../play/play/api/Application.scala.html#play.api;Application.injector" title="=&gt; play.api.inject.Injector">injector</a>.<a href="../../../../../play/play/api/inject/Injector.scala.html#play.api.inject;Injector.instanceOf(ffe51818f2)" title="[T](implicit evidence$1: scala.reflect.ClassTag[T])T">instanceOf</a><span title="(implicit evidence$1: scala.reflect.ClassTag[play.api.Environment])play.api.Environment" class="delimiter">[</span><a href="../../../../../play/play/api/Environment.scala.html#play.api;Environment" title="play.api.Environment">Environment</a><span class="delimiter">]</span>

    <span class="keyword">val</span> <a title="java.io.File" id="play.api.db.evolutions.Evolutions.updateEvolutionScript.evolutions">evolutions</a> = <a href="#play.api.db.evolutions.Evolutions.updateEvolutionScript.environment" title="play.api.Environment">environment</a>.<a href="../../../../../play/play/api/Environment.scala.html#play.api;Environment.getFile" title="(relativePath: String)java.io.File">getFile</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.fileName" title="(db: String, revision: Int)String">fileName</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.updateEvolutionScript$default$1" title="String">db</a>, <a href="#play.api.db.evolutions.Evolutions.updateEvolutionScript$default$2" title="Int">revision</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="java.nio.file.Files.type">Files</span>.<span title="(x$1: java.nio.file.Path, x$2: &lt;repeated...&gt;[java.nio.file.attribute.FileAttribute[_]])java.nio.file.Path">createDirectory</span><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.updateEvolutionScript.environment" title="play.api.Environment">environment</a>.<a href="../../../../../play/play/api/Environment.scala.html#play.api;Environment.getFile" title="(relativePath: String)java.io.File">getFile</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.directoryName" title="(db: String)String">directoryName</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.updateEvolutionScript$default$1" title="String">db</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="()java.nio.file.Path">toPath</span><span class="delimiter">)</span>
    <a href="#play.api.db.evolutions.Evolutions.writeFileIfChanged" title="(path: java.io.File, content: String)Unit">writeFileIfChanged</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.updateEvolutionScript.evolutions" title="java.io.File">evolutions</a>,
      <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;|# --- %s
         |
         |# --- !Ups
         |%s
         |
         |# --- !Downs
         |%s
         |
         |&quot;&quot;&quot;</span>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">stripMargin</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.updateEvolutionScript$default$3" title="String">comment</a>, <a href="#play.api.db.evolutions.Evolutions.updateEvolutionScript.ups" title="String">ups</a>, <a href="#play.api.db.evolutions.Evolutions.updateEvolutionScript.downs" title="String">downs</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(path: java.io.File, content: String)Unit" id="play.api.db.evolutions.Evolutions.writeFileIfChanged">writeFileIfChanged</a><span class="delimiter">(</span><a title="java.io.File" id="play.api.db.evolutions.Evolutions.writeFileIfChanged.path">path</a>: <span title="java.io.File">File</span>, <a title="String" id="play.api.db.evolutions.Evolutions.writeFileIfChanged.content">content</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.writeFileIfChanged.content" title="String">content</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../../../play/play/utils/PlayIO.scala.html#play.utils.PlayIO" title="play.utils.PlayIO.type">PlayIO</a>.<a href="../../../../../play/play/utils/PlayIO.scala.html#play.utils.PlayIO.readFileAsString" title="(file: java.io.File)(implicit codec: scala.io.Codec)String">readFileAsString</a><span title="=&gt; scala.io.Codec" class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.writeFileIfChanged.path" title="java.io.File">path</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#play.api.db.evolutions.Evolutions.writeFile" title="(destination: java.io.File, content: String)Unit">writeFile</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.writeFileIfChanged.path" title="java.io.File">path</a>, <a href="#play.api.db.evolutions.Evolutions.writeFileIfChanged.content" title="String">content</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(destination: java.io.File, content: String)Unit" id="play.api.db.evolutions.Evolutions.writeFile">writeFile</a><span class="delimiter">(</span><a title="java.io.File" id="play.api.db.evolutions.Evolutions.writeFile.destination">destination</a>: <span title="java.io.File">File</span>, <a title="String" id="play.api.db.evolutions.Evolutions.writeFile.content">content</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="java.nio.file.Files.type">Files</span>.<span title="(x$1: java.nio.file.Path, x$2: Array[Byte], x$3: &lt;repeated...&gt;[java.nio.file.OpenOption])java.nio.file.Path">write</span><span title="Unit" class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.writeFile.destination" title="java.io.File">destination</a>.<span title="()java.nio.file.Path">toPath</span>, <a href="#play.api.db.evolutions.Evolutions.writeFile.content" title="String">content</a>.<span title="(x$1: java.nio.charset.Charset)Array[Byte]">getBytes</span><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.utf8" title="=&gt; java.nio.charset.Charset">utf8</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.nio.charset.Charset" id="play.api.db.evolutions.Evolutions.utf8">utf8</a> = <span title="java.nio.charset.Charset.type">Charset</span>.<span title="(x$1: String)java.nio.charset.Charset">forName</span><span class="delimiter">(</span><span title="String(&quot;UTF8&quot;)" class="string">&quot;UTF8&quot;</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Translates evolution scripts into something human-readable.
   *
   * @param scripts the evolution scripts
   * @return a formatted script
   */</span>
  <span class="keyword">def</span> <a title="(scripts: Seq[play.api.db.evolutions.Script])String" id="play.api.db.evolutions.Evolutions.toHumanReadableScript">toHumanReadableScript</a><span class="delimiter">(</span><a title="Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions.Evolutions.toHumanReadableScript.scripts">scripts</a>: <span title="Seq[play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Script<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions.Evolutions.toHumanReadableScript.txt">txt</a> = <a href="#play.api.db.evolutions.Evolutions.toHumanReadableScript.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a>.<span title="(f: play.api.db.evolutions.Script =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Script],String,Seq[String]])Seq[String]">map</span> <a href="#play.api.db.evolutions.Evolutions.toHumanReadableScript.txt.$anonfun.x0$1" title="String" class="delimiter">{</a>
      <span class="keyword">case</span> UpScript<span class="delimiter">(</span><span title="play.api.db.evolutions.Evolution">ev</span><span class="delimiter">)</span> =&gt; <span title="String(&quot;# --- Rev:&quot;)" class="string">&quot;# --- Rev:&quot;</span> <span title="(x$1: Any)String">+</span> <span title="play.api.db.evolutions.Evolution">ev</span>.<a href="#play.api.db.evolutions;Evolution.revision" title="=&gt; Int">revision</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;,Ups - &quot;)" class="string">&quot;,Ups - &quot;</span> <span title="(x$1: Any)String">+</span> <span title="play.api.db.evolutions.Evolution">ev</span>.<a href="#play.api.db.evolutions;Evolution.hash" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">hash</a>.<span title="(n: Int)String">take</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span> <span title="(x$1: Any)String">+</span> <span title="play.api.db.evolutions.Evolution">ev</span>.<a href="#play.api.db.evolutions.Evolution.apply$default$2" title="=&gt; String">sql_up</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span>
      <span class="keyword">case</span> DownScript<span class="delimiter">(</span><span title="play.api.db.evolutions.Evolution">ev</span><span class="delimiter">)</span> =&gt; <span title="String(&quot;# --- Rev:&quot;)" class="string">&quot;# --- Rev:&quot;</span> <span title="(x$1: Any)String">+</span> <span title="play.api.db.evolutions.Evolution">ev</span>.<a href="#play.api.db.evolutions;Evolution.revision" title="=&gt; Int">revision</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;,Downs - &quot;)" class="string">&quot;,Downs - &quot;</span> <span title="(x$1: Any)String">+</span> <span title="play.api.db.evolutions.Evolution">ev</span>.<a href="#play.api.db.evolutions;Evolution.hash" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">hash</a>.<span title="(n: Int)String">take</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span> <span title="(x$1: Any)String">+</span> <span title="play.api.db.evolutions.Evolution">ev</span>.<a href="#play.api.db.evolutions.Evolution.apply$default$3" title="=&gt; String">sql_down</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span>
    <span class="delimiter">}</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions.Evolutions.toHumanReadableScript.hasDownWarning">hasDownWarning</a> =
      <span title="String(&quot;# !!! WARNING! This script contains DOWNS evolutions that are likely destructives\n\n&quot;)" class="string">&quot;# !!! WARNING! This script contains DOWNS evolutions that are likely destructives\n\n&quot;</span>

    <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.toHumanReadableScript.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a>.<span title="(p: play.api.db.evolutions.Script =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.toHumanReadableScript.$anonfun.x$3" title="play.api.db.evolutions.Script">_</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="#play.api.db.evolutions.DownScript.readResolve" title="play.api.db.evolutions.DownScript">DownScript</a><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#play.api.db.evolutions.Evolutions.toHumanReadableScript.hasDownWarning" title="String">hasDownWarning</a> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions.Evolutions.toHumanReadableScript.txt" title="String">txt</a> <span class="keyword">else</span> <a href="#play.api.db.evolutions.Evolutions.toHumanReadableScript.txt" title="String">txt</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   *
   * Compare two evolution sequences.
   *
   * @param downs the seq of downs
   * @param ups the seq of ups
   * @return the downs and ups to run to have the db synced to the current stage
   */</span>
  <span class="keyword">def</span> <a title="(downs: Seq[play.api.db.evolutions.Evolution], ups: Seq[play.api.db.evolutions.Evolution])(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])" id="play.api.db.evolutions.Evolutions.conflictings">conflictings</a><span class="delimiter">(</span><a title="Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions.Evolutions.conflictings.downs">downs</a>: <span title="Seq[play.api.db.evolutions.Evolution]">Seq</span><span class="delimiter">[</span>Evolution<span class="delimiter">]</span>, <a title="Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions.Evolutions.conflictings.ups">ups</a>: <span title="Seq[play.api.db.evolutions.Evolution]">Seq</span><span class="delimiter">[</span>Evolution<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])" class="delimiter">(</span>Seq<span class="delimiter">[</span>Evolution<span class="delimiter">]</span>, Seq<span class="delimiter">[</span>Evolution<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="#play.api.db.evolutions.Evolutions.conflictings.downs" title="Seq[play.api.db.evolutions.Evolution]">downs</a>.<span title="(that: scala.collection.GenIterable[play.api.db.evolutions.Evolution])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution),Seq[(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)]])Seq[(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)]">zip</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution),Seq[(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)]]" class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.conflictings.ups" title="Seq[play.api.db.evolutions.Evolution]">ups</a><span class="delimiter">)</span>.<span title="=&gt; Seq[(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)]">reverse</span>.<span title="(p: ((play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)) =&gt; Boolean)Seq[(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)]">dropWhile</span> <a href="#play.api.db.evolutions.Evolutions.conflictings.$anonfun.x0$2" title="Boolean" class="delimiter">{</a>
      <span class="keyword">case</span> <span class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="play.api.db.evolutions.Evolutions.conflictings.$anonfun.down">down</a>, <a title="play.api.db.evolutions.Evolution" id="play.api.db.evolutions.Evolutions.conflictings.$anonfun.up">up</a><span class="delimiter">)</span> =&gt; <a href="#play.api.db.evolutions.Evolutions.conflictings.$anonfun.down" title="play.api.db.evolutions.Evolution">down</a>.<a href="#play.api.db.evolutions;Evolution.hash" title="=&gt; String">hash</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#play.api.db.evolutions.Evolutions.conflictings.$anonfun.up" title="play.api.db.evolutions.Evolution">up</a>.<a href="#play.api.db.evolutions;Evolution.hash" title="=&gt; String">hash</a>
    <span class="delimiter">}</span>.<span title="=&gt; Seq[(play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)]">reverse</span>.<span title="(implicit asPair: ((play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution)) =&gt; (play.api.db.evolutions.Evolution, play.api.db.evolutions.Evolution))(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])">unzip</span>

  <span class="comment">/**
   * Apply evolutions for the given database.
   *
   * @param database The database to apply the evolutions to.
   * @param evolutionsReader The reader to read the evolutions.
   * @param autocommit Whether to use autocommit or not, evolutions will be manually committed if false.
   */</span>
  <span class="keyword">def</span> <a title="(database: play.api.db.Database, evolutionsReader: play.api.db.evolutions.EvolutionsReader, autocommit: Boolean)Unit" id="play.api.db.evolutions.Evolutions.applyEvolutions">applyEvolutions</a><span class="delimiter">(</span><a title="play.api.db.Database" id="play.api.db.evolutions.Evolutions.applyEvolutions.database">database</a>: <a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database" title="play.api.db.Database">Database</a>, <a title="play.api.db.evolutions.EvolutionsReader" id="play.api.db.evolutions.Evolutions.applyEvolutions$default$2">evolutionsReader</a>: <a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsReader" title="play.api.db.evolutions.EvolutionsReader">EvolutionsReader</a> = <a href="EvolutionsApi.scala.html#play.api.db.evolutions.ThisClassLoaderEvolutionsReader" title="play.api.db.evolutions.ThisClassLoaderEvolutionsReader.type">ThisClassLoaderEvolutionsReader</a>,
    <a title="Boolean" id="play.api.db.evolutions.Evolutions.applyEvolutions$default$3">autocommit</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.db.evolutions.DatabaseEvolutions" id="play.api.db.evolutions.Evolutions.applyEvolutions.dbEvolutions">dbEvolutions</a> = <span title="play.api.db.evolutions.DatabaseEvolutions" class="keyword">new</span> <a href="EvolutionsApi.scala.html#play.api.db.evolutions;DatabaseEvolutions" title="play.api.db.evolutions.DatabaseEvolutions">DatabaseEvolutions</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.applyEvolutions.database" title="play.api.db.Database">database</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions.Evolutions.applyEvolutions.evolutions">evolutions</a> = <a href="#play.api.db.evolutions.Evolutions.applyEvolutions.dbEvolutions" title="play.api.db.evolutions.DatabaseEvolutions">dbEvolutions</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;DatabaseEvolutions.scripts(0b93af615d)" title="(reader: play.api.db.evolutions.EvolutionsReader)Seq[play.api.db.evolutions.Script]">scripts</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.applyEvolutions$default$2" title="play.api.db.evolutions.EvolutionsReader">evolutionsReader</a><span class="delimiter">)</span>
    <a href="#play.api.db.evolutions.Evolutions.applyEvolutions.dbEvolutions" title="play.api.db.evolutions.DatabaseEvolutions">dbEvolutions</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;DatabaseEvolutions.evolve" title="(scripts: Seq[play.api.db.evolutions.Script], autocommit: Boolean)Unit">evolve</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.applyEvolutions.evolutions" title="Seq[play.api.db.evolutions.Script]">evolutions</a>, <a href="#play.api.db.evolutions.Evolutions.applyEvolutions$default$3" title="Boolean">autocommit</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Cleanup evolutions for the given database.
   *
   * This will leave the database in the original state it was before evolutions were applied, by running the down
   * scripts for all the evolutions that have been previously applied to the database.
   *
   * @param database The database to clean the evolutions for.
   * @param autocommit Whether to use atocommit or not, evolutions will be manually committed if false.
   */</span>
  <span class="keyword">def</span> <a title="(database: play.api.db.Database, autocommit: Boolean)Unit" id="play.api.db.evolutions.Evolutions.cleanupEvolutions">cleanupEvolutions</a><span class="delimiter">(</span><a title="play.api.db.Database" id="play.api.db.evolutions.Evolutions.cleanupEvolutions.database">database</a>: <a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database" title="play.api.db.Database">Database</a>, <a title="Boolean" id="play.api.db.evolutions.Evolutions.cleanupEvolutions$default$2">autocommit</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.db.evolutions.DatabaseEvolutions" id="play.api.db.evolutions.Evolutions.cleanupEvolutions.dbEvolutions">dbEvolutions</a> = <span title="play.api.db.evolutions.DatabaseEvolutions" class="keyword">new</span> <a href="EvolutionsApi.scala.html#play.api.db.evolutions;DatabaseEvolutions" title="play.api.db.evolutions.DatabaseEvolutions">DatabaseEvolutions</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.cleanupEvolutions.database" title="play.api.db.Database">database</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions.Evolutions.cleanupEvolutions.evolutions">evolutions</a> = <a href="#play.api.db.evolutions.Evolutions.cleanupEvolutions.dbEvolutions" title="play.api.db.evolutions.DatabaseEvolutions">dbEvolutions</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;DatabaseEvolutions.resetScripts" title="()Seq[play.api.db.evolutions.Script]">resetScripts</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#play.api.db.evolutions.Evolutions.cleanupEvolutions.dbEvolutions" title="play.api.db.evolutions.DatabaseEvolutions">dbEvolutions</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;DatabaseEvolutions.evolve" title="(scripts: Seq[play.api.db.evolutions.Script], autocommit: Boolean)Unit">evolve</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.cleanupEvolutions.evolutions" title="Seq[play.api.db.evolutions.Script]">evolutions</a>, <a href="#play.api.db.evolutions.Evolutions.cleanupEvolutions$default$2" title="Boolean">autocommit</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Execute the following code block with the evolutions for the database, cleaning up afterwards by running the downs.
   *
   * @param database The database to execute the evolutions on
   * @param evolutionsReader The evolutions reader to use.  Defaults to reading evolutions from the evolution readers own classloader.
   * @param autocommit Whether to use autocommit or not, evolutions will be manually committed if false.
   * @param block The block to execute
   */</span>
  <span class="keyword">def</span> <a title="[T](database: play.api.db.Database, evolutionsReader: play.api.db.evolutions.EvolutionsReader, autocommit: Boolean)(block: =&gt; T)T" id="play.api.db.evolutions.Evolutions.withEvolutions">withEvolutions</a><span class="delimiter">[</span><a title="" id="play.api.db.evolutions.Evolutions.withEvolutions$default$3;T">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.db.Database" id="play.api.db.evolutions.Evolutions.withEvolutions.database">database</a>: <a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database" title="play.api.db.Database">Database</a>, <a title="play.api.db.evolutions.EvolutionsReader" id="play.api.db.evolutions.Evolutions.withEvolutions$default$2">evolutionsReader</a>: <a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsReader" title="play.api.db.evolutions.EvolutionsReader">EvolutionsReader</a> = <a href="EvolutionsApi.scala.html#play.api.db.evolutions.ThisClassLoaderEvolutionsReader" title="play.api.db.evolutions.ThisClassLoaderEvolutionsReader.type">ThisClassLoaderEvolutionsReader</a>,
    <a title="Boolean" id="play.api.db.evolutions.Evolutions.withEvolutions$default$3">autocommit</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; T" id="play.api.db.evolutions.Evolutions.withEvolutions.block">block</a>: =&gt; T<span class="delimiter">)</span>: <a href="#play.api.db.evolutions.Evolutions.withEvolutions$default$3;T" title="T">T</a> = <span class="delimiter">{</span>
    <a href="#play.api.db.evolutions.Evolutions.applyEvolutions" title="(database: play.api.db.Database, evolutionsReader: play.api.db.evolutions.EvolutionsReader, autocommit: Boolean)Unit">applyEvolutions</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.withEvolutions.database" title="play.api.db.Database">database</a>, <a href="#play.api.db.evolutions.Evolutions.withEvolutions$default$2" title="play.api.db.evolutions.EvolutionsReader">evolutionsReader</a>, <a href="#play.api.db.evolutions.Evolutions.withEvolutions$default$3" title="Boolean">autocommit</a><span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#play.api.db.evolutions.Evolutions.withEvolutions.block" title="=&gt; T">block</a>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#play.api.db.evolutions.Evolutions.cleanupEvolutions" title="(database: play.api.db.Database, autocommit: Boolean)Unit">cleanupEvolutions</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.Evolutions.withEvolutions.database" title="play.api.db.Database">database</a>, <a href="#play.api.db.evolutions.Evolutions.withEvolutions$default$3" title="Boolean">autocommit</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Exception" id="play.api.db.evolutions.Evolutions.withEvolutions.e">e</a>: <span title="Exception">Exception</span> =&gt;
          <a href="../../../../../play/play/api/Logger.scala.html#play.api.Logger" title="play.api.Logger.type">Logger</a>.<a href="../../../../../play/play/api/Logger.scala.html#play.api;LoggerLike.warn(804ef4765b)" title="(message: =&gt; String, error: =&gt; Throwable)Unit">warn</a><span class="delimiter">(</span><span title="String(&quot;Error resetting evolutions&quot;)" class="string">&quot;Error resetting evolutions&quot;</span>, <a href="#play.api.db.evolutions.Evolutions.withEvolutions.e" title="Exception">e</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Can be used to run off-line evolutions, i.e. outside a running application.
 */</span>
<span title="AnyRef" class="keyword">object</span> <a title="play.api.db.evolutions.OfflineEvolutions.type" id="play.api.db.evolutions.OfflineEvolutions">OfflineEvolutions</a> <a href="#play.api.db.evolutions.OfflineEvolutions" title="play.api.db.evolutions.OfflineEvolutions.type" class="delimiter">{</a>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="play.api.Logger" id="play.api.db.evolutions.OfflineEvolutions.logger">logger</a> = <a href="../../../../../play/play/api/Logger.scala.html#play.api.Logger.apply(1f619881c1)" title="(clazz: Class[?0])play.api.Logger">Logger</a><span class="delimiter">(</span><span class="keyword">this</span>.<span title="()Class[_]">getClass</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="play.api.db.evolutions.OfflineEvolutions.isTest">isTest</a>: <span title="Boolean">Boolean</span> = <a href="../../../../../play/play/api/Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../../../../../play/play/api/Play.scala.html#play.api.Play.maybeApplication" title="=&gt; Option[play.api.Application]">maybeApplication</a>.<span title="(p: play.api.Application =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#play.api.db.evolutions.OfflineEvolutions.isTest.$anonfun.x$4" title="play.api.Application">_</a>.<a href="../../../../../play/play/api/Application.scala.html#play.api;Application.mode" title="=&gt; play.api.Mode.Mode">mode</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../../play/play/api/Play.scala.html#play.api.Mode" title="play.api.Mode.type">Mode</a>.<a href="../../../../../play/play/api/Play.scala.html#play.api.Mode.Test" title="=&gt; play.api.Mode.Value">Test</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(appPath: java.io.File, classloader: ClassLoader, dbApi: play.api.db.DBApi)play.api.db.evolutions.EvolutionsComponents" id="play.api.db.evolutions.OfflineEvolutions.getEvolutions">getEvolutions</a><span class="delimiter">(</span><a title="java.io.File" id="play.api.db.evolutions.OfflineEvolutions.getEvolutions.appPath">appPath</a>: <span title="java.io.File">File</span>, <a title="ClassLoader" id="play.api.db.evolutions.OfflineEvolutions.getEvolutions.classloader">classloader</a>: <span title="ClassLoader">ClassLoader</span>, <a title="play.api.db.DBApi" id="play.api.db.evolutions.OfflineEvolutions.getEvolutions.dbApi">dbApi</a>: <a href="../../../../../play-jdbc-api/play/api/db/DBApi.scala.html#play.api.db;DBApi" title="play.api.db.DBApi">DBApi</a><span class="delimiter">)</span>: <a href="EvolutionsModule.scala.html#play.api.db.evolutions;EvolutionsComponents" title="play.api.db.evolutions.EvolutionsComponents">EvolutionsComponents</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.db.DBApi" id="play.api.db.evolutions.OfflineEvolutions.getEvolutions._dbApi">_dbApi</a> = <a href="#play.api.db.evolutions.OfflineEvolutions.getEvolutions.dbApi" title="play.api.db.DBApi">dbApi</a>
    <a href="#play.api.db.evolutions.OfflineEvolutions.getEvolutions;$anon" title="play.api.db.evolutions.EvolutionsComponents{}" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with play.api.db.evolutions.EvolutionsComponents" id="play.api.db.evolutions.OfflineEvolutions.getEvolutions;$anon">EvolutionsComponents</a> <span class="delimiter">{</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="play.api.Environment" id="play.api.db.evolutions.OfflineEvolutions.getEvolutions;$anon.environment">environment</a> = <a href="../../../../../play/play/api/Environment.scala.html#play.api;Environment" title="(rootPath: java.io.File, classLoader: ClassLoader, mode: play.api.Mode.Mode)play.api.Environment">Environment</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.OfflineEvolutions.getEvolutions.appPath" title="java.io.File">appPath</a>, <a href="#play.api.db.evolutions.OfflineEvolutions.getEvolutions.classloader" title="ClassLoader">classloader</a>, <a href="../../../../../play/play/api/Play.scala.html#play.api.Mode" title="play.api.Mode.type">Mode</a>.<a href="../../../../../play/play/api/Play.scala.html#play.api.Mode.Dev" title="=&gt; play.api.Mode.Value">Dev</a><span class="delimiter">)</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="play.api.Configuration" id="play.api.db.evolutions.OfflineEvolutions.getEvolutions;$anon.configuration">configuration</a> = <a href="../../../../../play/play/api/Configuration.scala.html#play.api.Configuration" title="play.api.Configuration.type">Configuration</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api.Configuration.load(cf1e152751)" title="(appPath: java.io.File, mode: play.api.Mode.Mode, devSettings: Map[String,AnyRef])play.api.Configuration">load</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.OfflineEvolutions.getEvolutions.appPath" title="java.io.File">appPath</a><span class="delimiter">)</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="play.api.inject.DefaultApplicationLifecycle" id="play.api.db.evolutions.OfflineEvolutions.getEvolutions;$anon.applicationLifecycle">applicationLifecycle</a> = <span title="play.api.inject.DefaultApplicationLifecycle" class="keyword">new</span> <a href="../../../../../play/play/api/inject/ApplicationLifecycle.scala.html#play.api.inject;DefaultApplicationLifecycle" title="play.api.inject.DefaultApplicationLifecycle">DefaultApplicationLifecycle</a>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="play.api.db.evolutions.DynamicEvolutions" id="play.api.db.evolutions.OfflineEvolutions.getEvolutions;$anon.dynamicEvolutions">dynamicEvolutions</a> = <span title="play.api.db.evolutions.DynamicEvolutions" class="keyword">new</span> <a href="ApplicationEvolutions.scala.html#play.api.db.evolutions;DynamicEvolutions" title="play.api.db.evolutions.DynamicEvolutions">DynamicEvolutions</a>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="play.api.db.DBApi" id="play.api.db.evolutions.OfflineEvolutions.getEvolutions;$anon.dbApi">dbApi</a>: <a href="../../../../../play-jdbc-api/play/api/db/DBApi.scala.html#play.api.db;DBApi" title="play.api.db.DBApi">DBApi</a> = <a href="#play.api.db.evolutions.OfflineEvolutions.getEvolutions._dbApi" title="play.api.db.DBApi">_dbApi</a>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="play.core.DefaultWebCommands" id="play.api.db.evolutions.OfflineEvolutions.getEvolutions;$anon.webCommands">webCommands</a> = <span title="play.core.DefaultWebCommands" class="keyword">new</span> <a href="../../../../../play/play/core/system/WebCommands.scala.html#play.core;DefaultWebCommands" title="play.core.DefaultWebCommands">DefaultWebCommands</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Computes and applies an evolutions script.
   *
   * @param appPath the application path
   * @param classloader the classloader used to load the driver
   * @param dbName the database name
   * @param dbApi the database api for managing application databases
   */</span>
  <span class="keyword">def</span> <a title="(appPath: java.io.File, classloader: ClassLoader, dbApi: play.api.db.DBApi, dbName: String, autocommit: Boolean)Unit" id="play.api.db.evolutions.OfflineEvolutions.applyScript">applyScript</a><span class="delimiter">(</span><a title="java.io.File" id="play.api.db.evolutions.OfflineEvolutions.applyScript.appPath">appPath</a>: <span title="java.io.File">File</span>, <a title="ClassLoader" id="play.api.db.evolutions.OfflineEvolutions.applyScript.classloader">classloader</a>: <span title="ClassLoader">ClassLoader</span>, <a title="play.api.db.DBApi" id="play.api.db.evolutions.OfflineEvolutions.applyScript.dbApi">dbApi</a>: <a href="../../../../../play-jdbc-api/play/api/db/DBApi.scala.html#play.api.db;DBApi" title="play.api.db.DBApi">DBApi</a>, <a title="String" id="play.api.db.evolutions.OfflineEvolutions.applyScript.dbName">dbName</a>: <span title="String">String</span>, <a title="Boolean" id="play.api.db.evolutions.OfflineEvolutions.applyScript$default$5">autocommit</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.db.evolutions.EvolutionsComponents" id="play.api.db.evolutions.OfflineEvolutions.applyScript.evolutions">evolutions</a> = <a href="#play.api.db.evolutions.OfflineEvolutions.getEvolutions" title="(appPath: java.io.File, classloader: ClassLoader, dbApi: play.api.db.DBApi)play.api.db.evolutions.EvolutionsComponents">getEvolutions</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.OfflineEvolutions.applyScript.appPath" title="java.io.File">appPath</a>, <a href="#play.api.db.evolutions.OfflineEvolutions.applyScript.classloader" title="ClassLoader">classloader</a>, <a href="#play.api.db.evolutions.OfflineEvolutions.applyScript.dbApi" title="play.api.db.DBApi">dbApi</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions.OfflineEvolutions.applyScript.scripts">scripts</a> = <a href="#play.api.db.evolutions.OfflineEvolutions.applyScript.evolutions" title="play.api.db.evolutions.EvolutionsComponents">evolutions</a>.<a href="EvolutionsModule.scala.html#play.api.db.evolutions;EvolutionsComponents.evolutionsApi" title="=&gt; play.api.db.evolutions.EvolutionsApi">evolutionsApi</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi.scripts(a24908cd1f)" title="(db: String, reader: play.api.db.evolutions.EvolutionsReader)Seq[play.api.db.evolutions.Script]">scripts</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.OfflineEvolutions.applyScript.dbName" title="String">dbName</a>, <a href="#play.api.db.evolutions.OfflineEvolutions.applyScript.evolutions" title="play.api.db.evolutions.EvolutionsComponents">evolutions</a>.<a href="EvolutionsModule.scala.html#play.api.db.evolutions;EvolutionsComponents.evolutionsReader" title="=&gt; play.api.db.evolutions.EvolutionsReader">evolutionsReader</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#play.api.db.evolutions.OfflineEvolutions.isTest" title="=&gt; Boolean">isTest</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#play.api.db.evolutions.OfflineEvolutions.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../../../play/play/api/Logger.scala.html#play.api;LoggerLike.warn(83d3728a3c)" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="String(&quot;Applying evolution scripts for database \'&quot;)" class="string">&quot;Applying evolution scripts for database '&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions.OfflineEvolutions.applyScript.dbName" title="String">dbName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\':\n\n&quot;)" class="string">&quot;':\n\n&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions.Evolutions" title="play.api.db.evolutions.Evolutions.type">Evolutions</a>.<a href="#play.api.db.evolutions.Evolutions.toHumanReadableScript" title="(scripts: Seq[play.api.db.evolutions.Script])String">toHumanReadableScript</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.OfflineEvolutions.applyScript.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#play.api.db.evolutions.OfflineEvolutions.applyScript.evolutions" title="play.api.db.evolutions.EvolutionsComponents">evolutions</a>.<a href="EvolutionsModule.scala.html#play.api.db.evolutions;EvolutionsComponents.evolutionsApi" title="=&gt; play.api.db.evolutions.EvolutionsApi">evolutionsApi</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi.evolve" title="(db: String, scripts: Seq[play.api.db.evolutions.Script], autocommit: Boolean)Unit">evolve</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.OfflineEvolutions.applyScript.dbName" title="String">dbName</a>, <a href="#play.api.db.evolutions.OfflineEvolutions.applyScript.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a>, <a href="#play.api.db.evolutions.OfflineEvolutions.applyScript$default$5" title="Boolean">autocommit</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Resolve an inconsistent evolution.
   *
   * @param appPath the application path
   * @param classloader the classloader used to load the driver
   * @param dbApi the database api for managing application databases
   * @param dbName the database name
   * @param revision the revision
   */</span>
  <span class="keyword">def</span> <a title="(appPath: java.io.File, classloader: ClassLoader, dbApi: play.api.db.DBApi, dbName: String, revision: Int)Unit" id="play.api.db.evolutions.OfflineEvolutions.resolve">resolve</a><span class="delimiter">(</span><a title="java.io.File" id="play.api.db.evolutions.OfflineEvolutions.resolve.appPath">appPath</a>: <span title="java.io.File">File</span>, <a title="ClassLoader" id="play.api.db.evolutions.OfflineEvolutions.resolve.classloader">classloader</a>: <span title="ClassLoader">ClassLoader</span>, <a title="play.api.db.DBApi" id="play.api.db.evolutions.OfflineEvolutions.resolve.dbApi">dbApi</a>: <a href="../../../../../play-jdbc-api/play/api/db/DBApi.scala.html#play.api.db;DBApi" title="play.api.db.DBApi">DBApi</a>, <a title="String" id="play.api.db.evolutions.OfflineEvolutions.resolve.dbName">dbName</a>: <span title="String">String</span>, <a title="Int" id="play.api.db.evolutions.OfflineEvolutions.resolve.revision">revision</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.db.evolutions.EvolutionsComponents" id="play.api.db.evolutions.OfflineEvolutions.resolve.evolutions">evolutions</a> = <a href="#play.api.db.evolutions.OfflineEvolutions.getEvolutions" title="(appPath: java.io.File, classloader: ClassLoader, dbApi: play.api.db.DBApi)play.api.db.evolutions.EvolutionsComponents">getEvolutions</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.OfflineEvolutions.resolve.appPath" title="java.io.File">appPath</a>, <a href="#play.api.db.evolutions.OfflineEvolutions.resolve.classloader" title="ClassLoader">classloader</a>, <a href="#play.api.db.evolutions.OfflineEvolutions.resolve.dbApi" title="play.api.db.DBApi">dbApi</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#play.api.db.evolutions.OfflineEvolutions.isTest" title="=&gt; Boolean">isTest</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#play.api.db.evolutions.OfflineEvolutions.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../../../play/play/api/Logger.scala.html#play.api;LoggerLike.warn(83d3728a3c)" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="String(&quot;Resolving evolution [&quot;)" class="string">&quot;Resolving evolution [&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions.OfflineEvolutions.resolve.revision" title="Int">revision</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;] for database \'&quot;)" class="string">&quot;] for database '&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions.OfflineEvolutions.resolve.dbName" title="String">dbName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\'&quot;)" class="string">&quot;'&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#play.api.db.evolutions.OfflineEvolutions.resolve.evolutions" title="play.api.db.evolutions.EvolutionsComponents">evolutions</a>.<a href="EvolutionsModule.scala.html#play.api.db.evolutions;EvolutionsComponents.evolutionsApi" title="=&gt; play.api.db.evolutions.EvolutionsApi">evolutionsApi</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi.resolve" title="(db: String, revision: Int)Unit">resolve</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.OfflineEvolutions.resolve.dbName" title="String">dbName</a>, <a href="#play.api.db.evolutions.OfflineEvolutions.resolve.revision" title="Int">revision</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
