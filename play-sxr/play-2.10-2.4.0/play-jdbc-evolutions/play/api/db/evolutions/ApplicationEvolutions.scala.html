<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>play-jdbc-evolutions/play/api/db/evolutions/ApplicationEvolutions.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> play.api.db.evolutions

<span class="keyword">import</span> java.sql.<span class="delimiter">{</span> Statement, Connection, SQLException <span class="delimiter">}</span>
<span class="keyword">import</span> javax.inject.<span class="delimiter">{</span> Inject, Provider, Singleton <span class="delimiter">}</span>

<span class="keyword">import</span> scala.util.control.<span title="scala.util.control.Exception.type">Exception</span>.ignoring

<span class="keyword">import</span> play.api.db.<span class="delimiter">{</span> Database, DBApi <span class="delimiter">}</span>
<span class="keyword">import</span> play.api._
<span class="keyword">import</span> play.core.<span class="delimiter">{</span> HandleWebCommandSupport, WebCommands <span class="delimiter">}</span>

<span class="keyword">import</span> play.api.db.evolutions.<a href="Evolutions.scala.html#play.api.db.evolutions.DatabaseUrlPatterns" title="play.api.db.evolutions.DatabaseUrlPatterns.type">DatabaseUrlPatterns</a>._

<span class="comment">/**
 * Run evolutions on application startup. Automatically runs on construction.
 */</span>
@Singleton
<span class="keyword">class</span> <a title="class ApplicationEvolutions extends AnyRef" id="play.api.db.evolutions;ApplicationEvolutions">ApplicationEvolutions</a> @Inject<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">(</span>
    <a title="play.api.db.evolutions.EvolutionsConfig" id="play.api.db.evolutions;ApplicationEvolutions.config">config</a>: <a href="#play.api.db.evolutions;EvolutionsConfig" title="play.api.db.evolutions.EvolutionsConfig">EvolutionsConfig</a>,
    <a title="play.api.db.evolutions.EvolutionsReader" id="play.api.db.evolutions;ApplicationEvolutions.reader">reader</a>: <a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsReader" title="play.api.db.evolutions.EvolutionsReader">EvolutionsReader</a>,
    <a title="play.api.db.evolutions.EvolutionsApi" id="play.api.db.evolutions;ApplicationEvolutions.evolutions">evolutions</a>: <a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi" title="play.api.db.evolutions.EvolutionsApi">EvolutionsApi</a>,
    <a title="play.api.db.evolutions.DynamicEvolutions" id="play.api.db.evolutions;ApplicationEvolutions.dynamicEvolutions">dynamicEvolutions</a>: <a href="#play.api.db.evolutions;DynamicEvolutions" title="play.api.db.evolutions.DynamicEvolutions">DynamicEvolutions</a>,
    <a title="play.api.db.DBApi" id="play.api.db.evolutions;ApplicationEvolutions.dbApi">dbApi</a>: <a href="../../../../../play-jdbc-api/play/api/db/DBApi.scala.html#play.api.db;DBApi" title="play.api.db.DBApi">DBApi</a>,
    <a title="play.api.Environment" id="play.api.db.evolutions;ApplicationEvolutions.environment">environment</a>: <a href="../../../../../play/play/api/Environment.scala.html#play.api;Environment" title="play.api.Environment">Environment</a>,
    <a title="play.core.WebCommands" id="play.api.db.evolutions;ApplicationEvolutions.webCommands">webCommands</a>: <a href="../../../../../play/play/core/system/WebCommands.scala.html#play.core;WebCommands" title="play.core.WebCommands">WebCommands</a><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="play.api.Logger" id="play.api.db.evolutions;ApplicationEvolutions.logger">logger</a> = <a href="../../../../../play/play/api/Logger.scala.html#play.api.Logger.apply(1f619881c1)" title="(clazz: Class[play.api.db.evolutions.ApplicationEvolutions])play.api.Logger">Logger</a><span class="delimiter">(</span>classOf<span title="Class[play.api.db.evolutions.ApplicationEvolutions](classOf[play.api.db.evolutions.ApplicationEvolutions])" class="delimiter">[</span>ApplicationEvolutions<span class="delimiter">]</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Checks the evolutions state. Called on construction.
   */</span>
  <span class="keyword">def</span> <a title="()Unit" id="play.api.db.evolutions;ApplicationEvolutions.start">start</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>

    <a href="#play.api.db.evolutions;ApplicationEvolutions.webCommands" title="play.core.WebCommands">webCommands</a>.<a href="../../../../../play/play/core/system/WebCommands.scala.html#play.core;WebCommands.addHandler" title="(handler: play.core.HandleWebCommandSupport)Unit">addHandler</a><span class="delimiter">(</span><span title="play.api.db.evolutions.EvolutionsWebCommands" class="keyword">new</span> <a href="#play.api.db.evolutions;EvolutionsWebCommands" title="play.api.db.evolutions.EvolutionsWebCommands">EvolutionsWebCommands</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.evolutions" title="play.api.db.evolutions.EvolutionsApi">evolutions</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.reader" title="play.api.db.evolutions.EvolutionsReader">reader</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.config" title="play.api.db.evolutions.EvolutionsConfig">config</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="comment">// allow db modules to write evolution files</span>
    <a href="#play.api.db.evolutions;ApplicationEvolutions.dynamicEvolutions" title="play.api.db.evolutions.DynamicEvolutions">dynamicEvolutions</a>.<a href="#play.api.db.evolutions;DynamicEvolutions.create" title="()Unit">create</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <a href="#play.api.db.evolutions;ApplicationEvolutions.dbApi" title="play.api.db.DBApi">dbApi</a>.<a href="../../../../../play-jdbc-api/play/api/db/DBApi.scala.html#play.api.db;DBApi.databases" title="()Seq[play.api.db.Database]">databases</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(f: play.api.db.Database =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions" title="(database: play.api.db.Database)Unit">runEvolutions</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(database: play.api.db.Database)Unit" id="play.api.db.evolutions;ApplicationEvolutions.runEvolutions">runEvolutions</a><span class="delimiter">(</span><a title="play.api.db.Database" id="play.api.db.evolutions;ApplicationEvolutions.runEvolutions.database">database</a>: <a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database" title="play.api.db.Database">Database</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db">db</a> = <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.database" title="play.api.db.Database">database</a>.<a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database.name" title="=&gt; String">name</a>
    <span class="keyword">val</span> <a title="play.api.db.evolutions.EvolutionsDatasourceConfig" id="play.api.db.evolutions;ApplicationEvolutions.runEvolutions.dbConfig">dbConfig</a> = <a href="#play.api.db.evolutions;ApplicationEvolutions.config" title="play.api.db.evolutions.EvolutionsConfig">config</a>.<a href="#play.api.db.evolutions;EvolutionsConfig.forDatasource" title="(db: String)play.api.db.evolutions.EvolutionsDatasourceConfig">forDatasource</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db" title="String">db</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.dbConfig" title="play.api.db.evolutions.EvolutionsDatasourceConfig">dbConfig</a>.<a href="#play.api.db.evolutions;EvolutionsDatasourceConfig.enabled" title="=&gt; Boolean">enabled</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#play.api.db.evolutions;ApplicationEvolutions.withLock" title="(db: play.api.db.Database, dbConfig: play.api.db.evolutions.EvolutionsDatasourceConfig)(block: =&gt; Unit)Unit">withLock</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.database" title="play.api.db.Database">database</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.dbConfig" title="play.api.db.evolutions.EvolutionsDatasourceConfig">dbConfig</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions;ApplicationEvolutions.runEvolutions.scripts">scripts</a> = <a href="#play.api.db.evolutions;ApplicationEvolutions.evolutions" title="play.api.db.evolutions.EvolutionsApi">evolutions</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi.scripts(a24908cd1f)" title="(db: String, reader: play.api.db.evolutions.EvolutionsReader)Seq[play.api.db.evolutions.Script]">scripts</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db" title="String">db</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.reader" title="play.api.db.evolutions.EvolutionsReader">reader</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Boolean" id="play.api.db.evolutions;ApplicationEvolutions.runEvolutions.hasDown">hasDown</a> = <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a>.<span title="(p: play.api.db.evolutions.Script =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.hasDown.$anonfun.x$1" title="play.api.db.evolutions.Script">_</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="Evolutions.scala.html#play.api.db.evolutions;DownScript" title="play.api.db.evolutions.DownScript">DownScript</a><span class="delimiter">]</span><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="Boolean" id="play.api.db.evolutions;ApplicationEvolutions.runEvolutions.autocommit">autocommit</a> = <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.dbConfig" title="play.api.db.evolutions.EvolutionsDatasourceConfig">dbConfig</a>.<a href="#play.api.db.evolutions;EvolutionsDatasourceConfig.autocommit" title="=&gt; Boolean">autocommit</a>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>

          <span class="keyword">import</span> <a href="Evolutions.scala.html#play.api.db.evolutions.Evolutions" title="play.api.db.evolutions.Evolutions.type">Evolutions</a>.toHumanReadableScript

          <a href="#play.api.db.evolutions;ApplicationEvolutions.environment" title="play.api.Environment">environment</a>.<a href="../../../../../play/play/api/Environment.scala.html#play.api;Environment.mode" title="=&gt; play.api.Mode.Mode">mode</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="../../../../../play/play/api/Play.scala.html#play.api.Mode" title="play.api.Mode.type">Mode</a>.<a href="../../../../../play/play/api/Play.scala.html#play.api.Mode.Test" title="=&gt; play.api.Mode.Value">Test</a> =&gt; <a href="#play.api.db.evolutions;ApplicationEvolutions.evolutions" title="play.api.db.evolutions.EvolutionsApi">evolutions</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi.evolve" title="(db: String, scripts: Seq[play.api.db.evolutions.Script], autocommit: Boolean)Unit">evolve</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db" title="String">db</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.autocommit" title="Boolean">autocommit</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../../../../../play/play/api/Play.scala.html#play.api.Mode" title="play.api.Mode.type">Mode</a>.<a href="../../../../../play/play/api/Play.scala.html#play.api.Mode.Dev" title="=&gt; play.api.Mode.Value">Dev</a> <span class="keyword">if</span> <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.dbConfig" title="play.api.db.evolutions.EvolutionsDatasourceConfig">dbConfig</a>.<a href="#play.api.db.evolutions;EvolutionsDatasourceConfig.autoApply" title="=&gt; Boolean">autoApply</a> =&gt; <a href="#play.api.db.evolutions;ApplicationEvolutions.evolutions" title="play.api.db.evolutions.EvolutionsApi">evolutions</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi.evolve" title="(db: String, scripts: Seq[play.api.db.evolutions.Script], autocommit: Boolean)Unit">evolve</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db" title="String">db</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.autocommit" title="Boolean">autocommit</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../../../../../play/play/api/Play.scala.html#play.api.Mode" title="play.api.Mode.type">Mode</a>.<a href="../../../../../play/play/api/Play.scala.html#play.api.Mode.Prod" title="=&gt; play.api.Mode.Value">Prod</a> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.hasDown" title="Boolean">hasDown</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.dbConfig" title="play.api.db.evolutions.EvolutionsDatasourceConfig">dbConfig</a>.<a href="#play.api.db.evolutions;EvolutionsDatasourceConfig.autoApply" title="=&gt; Boolean">autoApply</a> =&gt; <a href="#play.api.db.evolutions;ApplicationEvolutions.evolutions" title="play.api.db.evolutions.EvolutionsApi">evolutions</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi.evolve" title="(db: String, scripts: Seq[play.api.db.evolutions.Script], autocommit: Boolean)Unit">evolve</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db" title="String">db</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.autocommit" title="Boolean">autocommit</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../../../../../play/play/api/Play.scala.html#play.api.Mode" title="play.api.Mode.type">Mode</a>.<a href="../../../../../play/play/api/Play.scala.html#play.api.Mode.Prod" title="=&gt; play.api.Mode.Value">Prod</a> <span class="keyword">if</span> <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.hasDown" title="Boolean">hasDown</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.dbConfig" title="play.api.db.evolutions.EvolutionsDatasourceConfig">dbConfig</a>.<a href="#play.api.db.evolutions;EvolutionsDatasourceConfig.autoApply" title="=&gt; Boolean">autoApply</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.dbConfig" title="play.api.db.evolutions.EvolutionsDatasourceConfig">dbConfig</a>.<a href="#play.api.db.evolutions;EvolutionsDatasourceConfig.autoApplyDowns" title="=&gt; Boolean">autoApplyDowns</a> =&gt; <a href="#play.api.db.evolutions;ApplicationEvolutions.evolutions" title="play.api.db.evolutions.EvolutionsApi">evolutions</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi.evolve" title="(db: String, scripts: Seq[play.api.db.evolutions.Script], autocommit: Boolean)Unit">evolve</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db" title="String">db</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.autocommit" title="Boolean">autocommit</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../../../../../play/play/api/Play.scala.html#play.api.Mode" title="play.api.Mode.type">Mode</a>.<a href="../../../../../play/play/api/Play.scala.html#play.api.Mode.Prod" title="=&gt; play.api.Mode.Value">Prod</a> <span class="keyword">if</span> <a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.hasDown" title="Boolean">hasDown</a> =&gt;
              <a href="#play.api.db.evolutions;ApplicationEvolutions.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../../../play/play/api/Logger.scala.html#play.api;LoggerLike.warn(83d3728a3c)" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Your production database [&quot;)">Your production database [$</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db" title="String">db</a><span title="String(&quot;] needs evolutions, including downs! \\n\\n&quot;)">] needs evolutions, including downs! \n\n$</span><span class="delimiter">{</span><a href="Evolutions.scala.html#play.api.db.evolutions.Evolutions.toHumanReadableScript" title="(scripts: Seq[play.api.db.evolutions.Script])String">toHumanReadableScript</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a><span class="delimiter">)</span><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
              <a href="#play.api.db.evolutions;ApplicationEvolutions.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../../../play/play/api/Logger.scala.html#play.api;LoggerLike.warn(83d3728a3c)" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Run with -Dplay.evolutions.db.&quot;)">Run with -Dplay.evolutions.db.$</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db" title="String">db</a><span title="String(&quot;.autoApply=true and -Dplay.evolutions.db.&quot;)">.autoApply=true and -Dplay.evolutions.db.$</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db" title="String">db</a><span title="String(&quot;.autoApplyDowns=true if you want to run them automatically, including downs (be careful, especially if your down evolutions drop existing data)&quot;)" class="string">.autoApplyDowns=true if you want to run them automatically, including downs (be careful, especially if your down evolutions drop existing data)&quot;</span><span class="delimiter">)</span>

              <span title="Nothing" class="keyword">throw</span> <a href="#play.api.db.evolutions.InvalidDatabaseRevision.readResolve" title="(db: String, script: String)play.api.db.evolutions.InvalidDatabaseRevision">InvalidDatabaseRevision</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db" title="String">db</a>, <a href="Evolutions.scala.html#play.api.db.evolutions.Evolutions.toHumanReadableScript" title="(scripts: Seq[play.api.db.evolutions.Script])String">toHumanReadableScript</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a><span class="delimiter">)</span><span class="delimiter">)</span>

            <span class="keyword">case</span> <a href="../../../../../play/play/api/Play.scala.html#play.api.Mode" title="play.api.Mode.type">Mode</a>.<a href="../../../../../play/play/api/Play.scala.html#play.api.Mode.Prod" title="=&gt; play.api.Mode.Value">Prod</a> =&gt;
              <a href="#play.api.db.evolutions;ApplicationEvolutions.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../../../play/play/api/Logger.scala.html#play.api;LoggerLike.warn(83d3728a3c)" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Your production database [&quot;)">Your production database [$</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db" title="String">db</a><span title="String(&quot;] needs evolutions! \\n\\n&quot;)">] needs evolutions! \n\n$</span><span class="delimiter">{</span><a href="Evolutions.scala.html#play.api.db.evolutions.Evolutions.toHumanReadableScript" title="(scripts: Seq[play.api.db.evolutions.Script])String">toHumanReadableScript</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a><span class="delimiter">)</span><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
              <a href="#play.api.db.evolutions;ApplicationEvolutions.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../../../play/play/api/Logger.scala.html#play.api;LoggerLike.warn(83d3728a3c)" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Run with -Dplay.evolutions.db.&quot;)">Run with -Dplay.evolutions.db.$</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db" title="String">db</a><span title="String(&quot;.autoApply=true if you want to run them automatically (be careful)&quot;)" class="string">.autoApply=true if you want to run them automatically (be careful)&quot;</span><span class="delimiter">)</span>

              <span title="Nothing" class="keyword">throw</span> <a href="#play.api.db.evolutions.InvalidDatabaseRevision.readResolve" title="(db: String, script: String)play.api.db.evolutions.InvalidDatabaseRevision">InvalidDatabaseRevision</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db" title="String">db</a>, <a href="Evolutions.scala.html#play.api.db.evolutions.Evolutions.toHumanReadableScript" title="(scripts: Seq[play.api.db.evolutions.Script])String">toHumanReadableScript</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a><span class="delimiter">)</span><span class="delimiter">)</span>

            <span class="keyword">case</span> _ =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#play.api.db.evolutions.InvalidDatabaseRevision.readResolve" title="(db: String, script: String)play.api.db.evolutions.InvalidDatabaseRevision">InvalidDatabaseRevision</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.db" title="String">db</a>, <a href="Evolutions.scala.html#play.api.db.evolutions.Evolutions.toHumanReadableScript" title="(scripts: Seq[play.api.db.evolutions.Script])String">toHumanReadableScript</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.runEvolutions.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(db: play.api.db.Database, dbConfig: play.api.db.evolutions.EvolutionsDatasourceConfig)(block: =&gt; Unit)Unit" id="play.api.db.evolutions;ApplicationEvolutions.withLock">withLock</a><span class="delimiter">(</span><a title="play.api.db.Database" id="play.api.db.evolutions;ApplicationEvolutions.withLock.db">db</a>: <a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database" title="play.api.db.Database">Database</a>, <a title="play.api.db.evolutions.EvolutionsDatasourceConfig" id="play.api.db.evolutions;ApplicationEvolutions.withLock.dbConfig">dbConfig</a>: <a href="#play.api.db.evolutions;EvolutionsDatasourceConfig" title="play.api.db.evolutions.EvolutionsDatasourceConfig">EvolutionsDatasourceConfig</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; Unit" id="play.api.db.evolutions;ApplicationEvolutions.withLock.block">block</a>: =&gt; Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.dbConfig" title="play.api.db.evolutions.EvolutionsDatasourceConfig">dbConfig</a>.<a href="#play.api.db.evolutions;EvolutionsDatasourceConfig.useLocks" title="=&gt; Boolean">useLocks</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="javax.sql.DataSource" id="play.api.db.evolutions;ApplicationEvolutions.withLock.ds">ds</a> = <a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.db" title="play.api.db.Database">db</a>.<a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database.dataSource" title="=&gt; javax.sql.DataSource">dataSource</a>
      <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;ApplicationEvolutions.withLock.url">url</a> = <a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.db" title="play.api.db.Database">db</a>.<a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database.url" title="=&gt; String">url</a>
      <span class="keyword">val</span> <a title="java.sql.Connection" id="play.api.db.evolutions;ApplicationEvolutions.withLock.c">c</a> = <a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.ds" title="javax.sql.DataSource">ds</a>.<span title="()java.sql.Connection">getConnection</span>
      <a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.c" title="java.sql.Connection">c</a>.<span title="(x$1: Boolean)Unit">setAutoCommit</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.sql.Statement" id="play.api.db.evolutions;ApplicationEvolutions.withLock.s">s</a> = <a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.c" title="java.sql.Connection">c</a>.<span title="()java.sql.Statement">createStatement</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary" title="(url: String, c: java.sql.Connection, s: java.sql.Statement)Unit">createLockTableIfNecessary</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.url" title="String">url</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.c" title="java.sql.Connection">c</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.s" title="java.sql.Statement">s</a><span class="delimiter">)</span>
      <a href="#play.api.db.evolutions;ApplicationEvolutions.lock" title="(url: String, c: java.sql.Connection, s: java.sql.Statement, attempts: Int)Unit">lock</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.url" title="String">url</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.c" title="java.sql.Connection">c</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.s" title="java.sql.Statement">s</a><span class="delimiter">)</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.block" title="=&gt; Unit">block</a>
      <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
        <a href="#play.api.db.evolutions;ApplicationEvolutions.unlock" title="(c: java.sql.Connection, s: java.sql.Statement)Unit">unlock</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.c" title="java.sql.Connection">c</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.s" title="java.sql.Statement">s</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#play.api.db.evolutions;ApplicationEvolutions.withLock.block" title="=&gt; Unit">block</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(url: String, c: java.sql.Connection, s: java.sql.Statement)Unit" id="play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary">createLockTableIfNecessary</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.url">url</a>: <span title="String">String</span>, <a title="java.sql.Connection" id="play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.c">c</a>: <span title="java.sql.Connection">Connection</span>, <a title="java.sql.Statement" id="play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.s">s</a>: <span title="java.sql.Statement">Statement</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#play.api.db.evolutions.ApplicationEvolutions" title="play.api.db.evolutions.ApplicationEvolutions.type">ApplicationEvolutions</a>._
    <span class="keyword">val</span> <a href="#play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.selectScript" title="(String, String, String)" class="delimiter">(</a><a href="#play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.x$2" title="String" id="play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.selectScript">selectScript</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.x$2" title="String" id="play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.createScript">createScript</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.x$2" title="String" id="play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.insertScript">insertScript</a><span class="delimiter">)</span> = <a href="#play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.url" title="String">url</a> <span title="(String, String, String)" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="Evolutions.scala.html#play.api.db.evolutions.DatabaseUrlPatterns.OracleJdbcUrl" title="(target: Any)Option[List[String]]">OracleJdbcUrl</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt;
        <span title="(_1: String, _2: String, _3: String)(String, String, String)" class="delimiter">(</span><a href="#play.api.db.evolutions.ApplicationEvolutions.SelectPlayEvolutionsLockSql" title="=&gt; String">SelectPlayEvolutionsLockSql</a>, <a href="#play.api.db.evolutions.ApplicationEvolutions.CreatePlayEvolutionsLockOracleSql" title="=&gt; String">CreatePlayEvolutionsLockOracleSql</a>, <a href="#play.api.db.evolutions.ApplicationEvolutions.InsertIntoPlayEvolutionsLockSql" title="=&gt; String">InsertIntoPlayEvolutionsLockSql</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="Evolutions.scala.html#play.api.db.evolutions.DatabaseUrlPatterns.MysqlJdbcUrl" title="(target: Any)Option[List[String]]">MysqlJdbcUrl</a><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
        <span title="(_1: String, _2: String, _3: String)(String, String, String)" class="delimiter">(</span><a href="#play.api.db.evolutions.ApplicationEvolutions.SelectPlayEvolutionsLockMysqlSql" title="=&gt; String">SelectPlayEvolutionsLockMysqlSql</a>, <a href="#play.api.db.evolutions.ApplicationEvolutions.CreatePlayEvolutionsLockMysqlSql" title="=&gt; String">CreatePlayEvolutionsLockMysqlSql</a>, <a href="#play.api.db.evolutions.ApplicationEvolutions.InsertIntoPlayEvolutionsLockMysqlSql" title="=&gt; String">InsertIntoPlayEvolutionsLockMysqlSql</a><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt;
        <span title="(_1: String, _2: String, _3: String)(String, String, String)" class="delimiter">(</span><a href="#play.api.db.evolutions.ApplicationEvolutions.SelectPlayEvolutionsLockSql" title="=&gt; String">SelectPlayEvolutionsLockSql</a>, <a href="#play.api.db.evolutions.ApplicationEvolutions.CreatePlayEvolutionsLockSql" title="=&gt; String">CreatePlayEvolutionsLockSql</a>, <a href="#play.api.db.evolutions.ApplicationEvolutions.InsertIntoPlayEvolutionsLockSql" title="=&gt; String">InsertIntoPlayEvolutionsLockSql</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.sql.ResultSet" id="play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.r">r</a> = <a href="#play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.s" title="java.sql.Statement">s</a>.<span title="(x$1: String)java.sql.ResultSet">executeQuery</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.selectScript" title="String">selectScript</a><span class="delimiter">)</span>
      <a href="#play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.r" title="java.sql.ResultSet">r</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="java.sql.SQLException" id="play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.e">e</a>: <span title="java.sql.SQLException">SQLException</span> =&gt;
        <a href="#play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.c" title="java.sql.Connection">c</a>.<span title="()Unit">rollback</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.s" title="java.sql.Statement">s</a>.<span title="(x$1: String)Boolean">execute</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.createScript" title="String">createScript</a><span class="delimiter">)</span>
        <a href="#play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.s" title="java.sql.Statement">s</a>.<span title="(x$1: String)Int">executeUpdate</span><span title="Unit" class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.createLockTableIfNecessary.insertScript" title="String">insertScript</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(url: String, c: java.sql.Connection, s: java.sql.Statement, attempts: Int)Unit" id="play.api.db.evolutions;ApplicationEvolutions.lock">lock</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;ApplicationEvolutions.lock.url">url</a>: <span title="String">String</span>, <a title="java.sql.Connection" id="play.api.db.evolutions;ApplicationEvolutions.lock.c">c</a>: <span title="java.sql.Connection">Connection</span>, <a title="java.sql.Statement" id="play.api.db.evolutions;ApplicationEvolutions.lock.s">s</a>: <span title="java.sql.Statement">Statement</span>, <a title="Int" id="play.api.db.evolutions;ApplicationEvolutions.lock$default$4">attempts</a>: <span title="Int">Int</span> = <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#play.api.db.evolutions.ApplicationEvolutions" title="play.api.db.evolutions.ApplicationEvolutions.type">ApplicationEvolutions</a>._
    <span class="keyword">val</span> <a title="List[String]" id="play.api.db.evolutions;ApplicationEvolutions.lock.lockScripts">lockScripts</a> = <a href="#play.api.db.evolutions;ApplicationEvolutions.lock.url" title="String">url</a> <span title="List[String]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="Evolutions.scala.html#play.api.db.evolutions.DatabaseUrlPatterns.MysqlJdbcUrl" title="(target: Any)Option[List[String]]">MysqlJdbcUrl</a><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="#play.api.db.evolutions.ApplicationEvolutions.lockPlayEvolutionsLockMysqlSqls" title="=&gt; List[String]">lockPlayEvolutionsLockMysqlSqls</a>
      <span class="keyword">case</span> _ =&gt; <a href="#play.api.db.evolutions.ApplicationEvolutions.lockPlayEvolutionsLockSqls" title="=&gt; List[String]">lockPlayEvolutionsLockSqls</a>
    <span class="delimiter">}</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;ApplicationEvolutions.lock.$anonfun.script">script</a> &lt;- <a href="#play.api.db.evolutions;ApplicationEvolutions.lock.lockScripts" title="(f: String =&gt; java.sql.ResultSet)Unit">lockScripts</a><span class="delimiter">)</span> <a href="#play.api.db.evolutions;ApplicationEvolutions.lock.s" title="java.sql.Statement">s</a>.<span title="(x$1: String)java.sql.ResultSet">executeQuery</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.lock.$anonfun.script" title="String">script</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="java.sql.SQLException" id="play.api.db.evolutions;ApplicationEvolutions.lock.e">e</a>: <span title="java.sql.SQLException">SQLException</span> =&gt;
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.lock$default$4" title="Int">attempts</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <a href="#play.api.db.evolutions;ApplicationEvolutions.lock.e" title="java.sql.SQLException">e</a>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#play.api.db.evolutions;ApplicationEvolutions.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../../../play/play/api/Logger.scala.html#play.api;LoggerLike.warn(83d3728a3c)" title="(message: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="String(&quot;Exception while attempting to lock evolutions (other node probably has lock), sleeping for 1 sec&quot;)" class="string">&quot;Exception while attempting to lock evolutions (other node probably has lock), sleeping for 1 sec&quot;</span><span class="delimiter">)</span>
          <a href="#play.api.db.evolutions;ApplicationEvolutions.lock.c" title="java.sql.Connection">c</a>.<span title="()Unit">rollback</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span title="Thread.type">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(1000L)" class="int">1000</span><span class="delimiter">)</span>
          <a href="#play.api.db.evolutions;ApplicationEvolutions.lock" title="(url: String, c: java.sql.Connection, s: java.sql.Statement, attempts: Int)Unit">lock</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.lock.url" title="String">url</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.lock.c" title="java.sql.Connection">c</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.lock.s" title="java.sql.Statement">s</a>, <a href="#play.api.db.evolutions;ApplicationEvolutions.lock$default$4" title="Int">attempts</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(c: java.sql.Connection, s: java.sql.Statement)Unit" id="play.api.db.evolutions;ApplicationEvolutions.unlock">unlock</a><span class="delimiter">(</span><a title="java.sql.Connection" id="play.api.db.evolutions;ApplicationEvolutions.unlock.c">c</a>: <span title="java.sql.Connection">Connection</span>, <a title="java.sql.Statement" id="play.api.db.evolutions;ApplicationEvolutions.unlock.s">s</a>: <span title="java.sql.Statement">Statement</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="(exceptions: Class[_]*)util.control.Exception.Catch[Unit]">ignoring</span><span title="(body: =&gt; Unit)Unit" class="delimiter">(</span>classOf<span title="Class[java.sql.SQLException](classOf[java.sql.SQLException])" class="delimiter">[</span>SQLException<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.unlock.s" title="java.sql.Statement">s</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="(exceptions: Class[_]*)util.control.Exception.Catch[Unit]">ignoring</span><span title="(body: =&gt; Unit)Unit" class="delimiter">(</span>classOf<span title="Class[java.sql.SQLException](classOf[java.sql.SQLException])" class="delimiter">[</span>SQLException<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.unlock.c" title="java.sql.Connection">c</a>.<span title="()Unit">commit</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="(exceptions: Class[_]*)util.control.Exception.Catch[Unit]">ignoring</span><span title="(body: =&gt; Unit)Unit" class="delimiter">(</span>classOf<span title="Class[java.sql.SQLException](classOf[java.sql.SQLException])" class="delimiter">[</span>SQLException<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;ApplicationEvolutions.unlock.c" title="java.sql.Connection">c</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <a href="#play.api.db.evolutions;ApplicationEvolutions.start" title="()Unit">start</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="comment">// on construction</span>
<span class="delimiter">}</span>

<span title="AnyRef" class="keyword">private</span> <span class="keyword">object</span> <a title="play.api.db.evolutions.ApplicationEvolutions.type" id="play.api.db.evolutions.ApplicationEvolutions">ApplicationEvolutions</a> <a href="#play.api.db.evolutions.ApplicationEvolutions" title="play.api.db.evolutions.ApplicationEvolutions.type" class="delimiter">{</a>

  <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions.ApplicationEvolutions.SelectPlayEvolutionsLockSql">SelectPlayEvolutionsLockSql</a> =
    <span title="String(&quot;\n      select lock from play_evolutions_lock\n    &quot;)" class="string">&quot;&quot;&quot;
      select lock from play_evolutions_lock
    &quot;&quot;&quot;</span>

  <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions.ApplicationEvolutions.SelectPlayEvolutionsLockMysqlSql">SelectPlayEvolutionsLockMysqlSql</a> =
    <span title="String(&quot;\n      select `lock` from play_evolutions_lock\n    &quot;)" class="string">&quot;&quot;&quot;
      select `lock` from play_evolutions_lock
    &quot;&quot;&quot;</span>

  <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions.ApplicationEvolutions.CreatePlayEvolutionsLockSql">CreatePlayEvolutionsLockSql</a> =
    <span title="String(&quot;\n      create table play_evolutions_lock (\n        lock int not null primary key\n      )\n    &quot;)" class="string">&quot;&quot;&quot;
      create table play_evolutions_lock (
        lock int not null primary key
      )
    &quot;&quot;&quot;</span>

  <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions.ApplicationEvolutions.CreatePlayEvolutionsLockMysqlSql">CreatePlayEvolutionsLockMysqlSql</a> =
    <span title="String(&quot;\n      create table play_evolutions_lock (\n        `lock` int not null primary key\n      )\n    &quot;)" class="string">&quot;&quot;&quot;
      create table play_evolutions_lock (
        `lock` int not null primary key
      )
    &quot;&quot;&quot;</span>

  <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions.ApplicationEvolutions.CreatePlayEvolutionsLockOracleSql">CreatePlayEvolutionsLockOracleSql</a> =
    <span title="String(&quot;\n      CREATE TABLE play_evolutions_lock (\n        lock Number(10,0) Not Null Enable,\n        CONSTRAINT play_evolutions_lock_pk PRIMARY KEY (lock)\n      )\n    &quot;)" class="string">&quot;&quot;&quot;
      CREATE TABLE play_evolutions_lock (
        lock Number(10,0) Not Null Enable,
        CONSTRAINT play_evolutions_lock_pk PRIMARY KEY (lock)
      )
    &quot;&quot;&quot;</span>

  <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions.ApplicationEvolutions.InsertIntoPlayEvolutionsLockSql">InsertIntoPlayEvolutionsLockSql</a> =
    <span title="String(&quot;\n      insert into play_evolutions_lock (lock) values (1)\n    &quot;)" class="string">&quot;&quot;&quot;
      insert into play_evolutions_lock (lock) values (1)
    &quot;&quot;&quot;</span>

  <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions.ApplicationEvolutions.InsertIntoPlayEvolutionsLockMysqlSql">InsertIntoPlayEvolutionsLockMysqlSql</a> =
    <span title="String(&quot;\n      insert into play_evolutions_lock (`lock`) values (1)\n    &quot;)" class="string">&quot;&quot;&quot;
      insert into play_evolutions_lock (`lock`) values (1)
    &quot;&quot;&quot;</span>

  <span class="keyword">val</span> <a title="List[String]" id="play.api.db.evolutions.ApplicationEvolutions.lockPlayEvolutionsLockSqls">lockPlayEvolutionsLockSqls</a> =
    <span title="(xs: String*)List[String]">List</span><span class="delimiter">(</span>
      <span title="String(&quot;\n        select lock from play_evolutions_lock where lock = 1 for update nowait\n      &quot;)" class="string">&quot;&quot;&quot;
        select lock from play_evolutions_lock where lock = 1 for update nowait
      &quot;&quot;&quot;</span>
    <span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="List[String]" id="play.api.db.evolutions.ApplicationEvolutions.lockPlayEvolutionsLockMysqlSqls">lockPlayEvolutionsLockMysqlSqls</a> =
    <span title="(xs: String*)List[String]">List</span><span class="delimiter">(</span>
      <span title="String(&quot;\n        set innodb_lock_wait_timeout = 1\n      &quot;)" class="string">&quot;&quot;&quot;
        set innodb_lock_wait_timeout = 1
      &quot;&quot;&quot;</span>,
      <span title="String(&quot;\n        select `lock` from play_evolutions_lock where `lock` = 1 for update\n      &quot;)" class="string">&quot;&quot;&quot;
        select `lock` from play_evolutions_lock where `lock` = 1 for update
      &quot;&quot;&quot;</span>
    <span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Evolutions configuration for a given datasource.
 */</span>
<span title="AnyRef" class="keyword">trait</span> <a title="trait EvolutionsDatasourceConfig extends AnyRef" id="play.api.db.evolutions;EvolutionsDatasourceConfig">EvolutionsDatasourceConfig</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="play.api.db.evolutions;EvolutionsDatasourceConfig.enabled">enabled</a>: <span title="Boolean">Boolean</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="play.api.db.evolutions;EvolutionsDatasourceConfig.autocommit">autocommit</a>: <span title="Boolean">Boolean</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="play.api.db.evolutions;EvolutionsDatasourceConfig.useLocks">useLocks</a>: <span title="Boolean">Boolean</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="play.api.db.evolutions;EvolutionsDatasourceConfig.autoApply">autoApply</a>: <span title="Boolean">Boolean</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="play.api.db.evolutions;EvolutionsDatasourceConfig.autoApplyDowns">autoApplyDowns</a>: <span title="Boolean">Boolean</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Evolutions configuration for all datasources.
 */</span>
<span title="AnyRef" class="keyword">trait</span> <a title="trait EvolutionsConfig extends AnyRef" id="play.api.db.evolutions;EvolutionsConfig">EvolutionsConfig</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(db: String)play.api.db.evolutions.EvolutionsDatasourceConfig" id="play.api.db.evolutions;EvolutionsConfig.forDatasource">forDatasource</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;EvolutionsConfig.forDatasource.db">db</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#play.api.db.evolutions;EvolutionsDatasourceConfig" title="play.api.db.evolutions.EvolutionsDatasourceConfig">EvolutionsDatasourceConfig</a>
<span class="delimiter">}</span>

<span class="comment">/**
 * Default evolutions datasource configuration.
 */</span>
<span title="AnyRef" class="keyword">case class</span> <a title="class DefaultEvolutionsDatasourceConfig extends AnyRef with play.api.db.evolutions.EvolutionsDatasourceConfig with Product with Serializable" id="play.api.db.evolutions.DefaultEvolutionsDatasourceConfig.readResolve">DefaultEvolutionsDatasourceConfig</a><a href="#play.api.db.evolutions.DefaultEvolutionsDatasourceConfig.readResolve" title="Product" class="delimiter">(</a>
  <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsDatasourceConfig.enabled">enabled</a>: <span title="Boolean">Boolean</span>,
  <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsDatasourceConfig.autocommit">autocommit</a>: <span title="Boolean">Boolean</span>,
  <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsDatasourceConfig.useLocks">useLocks</a>: <span title="Boolean">Boolean</span>,
  <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsDatasourceConfig.autoApply">autoApply</a>: <span title="Boolean">Boolean</span>,
  <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsDatasourceConfig.autoApplyDowns">autoApplyDowns</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#play.api.db.evolutions;EvolutionsDatasourceConfig" title="play.api.db.evolutions.EvolutionsDatasourceConfig">EvolutionsDatasourceConfig</a>

<span class="comment">/**
 * Default evolutions configuration.
 */</span>
<span class="keyword">class</span> <a title="class DefaultEvolutionsConfig extends AnyRef with play.api.db.evolutions.EvolutionsConfig" id="play.api.db.evolutions;DefaultEvolutionsConfig">DefaultEvolutionsConfig</a><a href="#play.api.db.evolutions;DefaultEvolutionsConfig" title="play.api.db.evolutions.DefaultEvolutionsConfig" class="delimiter">(</a><a title="play.api.db.evolutions.EvolutionsDatasourceConfig" id="play.api.db.evolutions;DefaultEvolutionsConfig.defaultDatasourceConfig">defaultDatasourceConfig</a>: <a href="#play.api.db.evolutions;EvolutionsDatasourceConfig" title="play.api.db.evolutions.EvolutionsDatasourceConfig">EvolutionsDatasourceConfig</a>,
    <a title="Map[String,play.api.db.evolutions.EvolutionsDatasourceConfig]" id="play.api.db.evolutions;DefaultEvolutionsConfig.datasources">datasources</a>: <span title="Map[String,play.api.db.evolutions.EvolutionsDatasourceConfig]">Map</span><span class="delimiter">[</span>String, EvolutionsDatasourceConfig<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#play.api.db.evolutions;EvolutionsConfig" title="play.api.db.evolutions.EvolutionsConfig">EvolutionsConfig</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(db: String)play.api.db.evolutions.EvolutionsDatasourceConfig" id="play.api.db.evolutions;DefaultEvolutionsConfig.forDatasource">forDatasource</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;DefaultEvolutionsConfig.forDatasource.db">db</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfig.datasources" title="Map[String,play.api.db.evolutions.EvolutionsDatasourceConfig]">datasources</a>.<span title="(key: String, default: =&gt; play.api.db.evolutions.EvolutionsDatasourceConfig)play.api.db.evolutions.EvolutionsDatasourceConfig">getOrElse</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfig.forDatasource.db" title="String">db</a>, <a href="#play.api.db.evolutions;DefaultEvolutionsConfig.defaultDatasourceConfig" title="play.api.db.evolutions.EvolutionsDatasourceConfig">defaultDatasourceConfig</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * A provider that creates an EvolutionsConfig from the play.api.Configuration.
 */</span>
@Singleton
<span class="keyword">class</span> <a title="class DefaultEvolutionsConfigParser extends Object with javax.inject.Provider[play.api.db.evolutions.EvolutionsConfig]" id="play.api.db.evolutions;DefaultEvolutionsConfigParser">DefaultEvolutionsConfigParser</a> @Inject<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">(</span><a title="play.api.Configuration" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.configuration">configuration</a>: <a href="../../../../../play/play/api/Configuration.scala.html#play.api;Configuration" title="play.api.Configuration">Configuration</a><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="javax.inject.Provider[play.api.db.evolutions.EvolutionsConfig]">Provider</span><span class="delimiter">[</span>EvolutionsConfig<span class="delimiter">]</span> <span class="delimiter">{</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="play.api.Logger" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.logger">logger</a> = <a href="../../../../../play/play/api/Logger.scala.html#play.api.Logger.apply(1f619881c1)" title="(clazz: Class[play.api.db.evolutions.DefaultEvolutionsConfigParser])play.api.Logger">Logger</a><span class="delimiter">(</span>classOf<span title="Class[play.api.db.evolutions.DefaultEvolutionsConfigParser](classOf[play.api.db.evolutions.DefaultEvolutionsConfigParser])" class="delimiter">[</span>DefaultEvolutionsConfigParser<span class="delimiter">]</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()play.api.db.evolutions.EvolutionsConfig" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.get">get</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse" title="()play.api.db.evolutions.EvolutionsConfig">parse</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()play.api.db.evolutions.EvolutionsConfig" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse">parse</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="#play.api.db.evolutions;EvolutionsConfig" title="play.api.db.evolutions.EvolutionsConfig">EvolutionsConfig</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.PlayConfig" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.rootConfig">rootConfig</a> = <a href="../../../../../play/play/api/Configuration.scala.html#play.api.PlayConfig.apply(a5709ffad5)" title="(configuration: play.api.Configuration)play.api.PlayConfig">PlayConfig</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.configuration" title="play.api.Configuration">configuration</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="play.api.PlayConfig" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.config">config</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.rootConfig" title="play.api.PlayConfig">rootConfig</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.get" title="[A](path: String)(implicit loader: play.api.ConfigLoader[A])A">get</a><span title="(path: String)(implicit loader: play.api.ConfigLoader[play.api.PlayConfig])play.api.PlayConfig" class="delimiter">[</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig" title="play.api.PlayConfig">PlayConfig</a><span class="delimiter">]</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api.ConfigLoader.playConfigLoader" title="=&gt; play.api.ConfigLoader[play.api.PlayConfig]" class="delimiter">(</a><span title="String(&quot;play.evolutions&quot;)" class="string">&quot;play.evolutions&quot;</span><span class="delimiter">)</span>

    <span class="comment">// Since the evolutions config was completely inverted and has changed massively, we have our own deprecated</span>
    <span class="comment">// implementation that reads deprecated keys from the root config, otherwise reads from the passed in config</span>
    <span class="keyword">def</span> <a title="[A](config: play.api.PlayConfig, baseKey: =&gt; String, path: String, deprecated: String)(implicit evidence$1: play.api.ConfigLoader[A])A" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated">getDeprecated</a><span class="delimiter">[</span><a title="" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated;A">A</a>: ConfigLoader<span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.PlayConfig" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated.config">config</a>: <a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig" title="play.api.PlayConfig">PlayConfig</a>, <a title="=&gt; String" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated.baseKey">baseKey</a>: =&gt; String, <a title="String" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated.path">path</a>: <span title="String">String</span>, <a title="String" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated.deprecated">deprecated</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated;A" title="A">A</a> = <span class="delimiter">{</span>
      <span title="A" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.rootConfig" title="play.api.PlayConfig">rootConfig</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.underlying" title="=&gt; com.typesafe.config.Config">underlying</a>.<span title="(x$1: String)Boolean">hasPath</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated.deprecated" title="String">deprecated</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.rootConfig" title="play.api.PlayConfig">rootConfig</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.reportDeprecation" title="(path: String, deprecated: String)Unit">reportDeprecation</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;&quot;)">$</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated.baseKey" title="=&gt; String">baseKey</a><span title="String(&quot;.&quot;)">.$</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated.path" title="String">path</a><span title="String(&quot;&quot;)" class="string">&quot;</span>, <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated.deprecated" title="String">deprecated</a><span class="delimiter">)</span>
        <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.rootConfig" title="play.api.PlayConfig">rootConfig</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.get" title="[A](path: String)(implicit loader: play.api.ConfigLoader[A])A">get</a><span title="(path: String)(implicit loader: play.api.ConfigLoader[A])A" class="delimiter">[</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated;A" title="A">A</a><span class="delimiter">]</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated.evidence$1" title="play.api.ConfigLoader[A]" class="delimiter">(</a><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated.deprecated" title="String">deprecated</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated.config" title="play.api.PlayConfig">config</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.get" title="[A](path: String)(implicit loader: play.api.ConfigLoader[A])A">get</a><span title="(path: String)(implicit loader: play.api.ConfigLoader[A])A" class="delimiter">[</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated;A" title="A">A</a><span class="delimiter">]</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated.evidence$1" title="play.api.ConfigLoader[A]" class="delimiter">(</a><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated.path" title="String">path</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">// Find all the defined datasources, both using the old format, and the new format</span>
    <span class="keyword">def</span> <a title="(path: String)Set[String]" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.loadDatasources">loadDatasources</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.loadDatasources.path">path</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span title="Set[String]" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.rootConfig" title="play.api.PlayConfig">rootConfig</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.underlying" title="=&gt; com.typesafe.config.Config">underlying</a>.<span title="(x$1: String)Boolean">hasPath</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.loadDatasources.path" title="String">path</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.rootConfig" title="play.api.PlayConfig">rootConfig</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.get" title="[A](path: String)(implicit loader: play.api.ConfigLoader[A])A">get</a><span title="(path: String)(implicit loader: play.api.ConfigLoader[play.api.PlayConfig])play.api.PlayConfig" class="delimiter">[</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig" title="play.api.PlayConfig">PlayConfig</a><span class="delimiter">]</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api.ConfigLoader.playConfigLoader" title="=&gt; play.api.ConfigLoader[play.api.PlayConfig]" class="delimiter">(</a><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.loadDatasources.path" title="String">path</a><span class="delimiter">)</span>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.subKeys" title="=&gt; Set[String]">subKeys</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.immutable.Set[A]">empty</span><span title="scala.collection.immutable.Set[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.Set[String]" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasources">datasources</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.config" title="play.api.PlayConfig">config</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.get" title="[A](path: String)(implicit loader: play.api.ConfigLoader[A])A">get</a><span title="(path: String)(implicit loader: play.api.ConfigLoader[play.api.PlayConfig])play.api.PlayConfig" class="delimiter">[</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig" title="play.api.PlayConfig">PlayConfig</a><span class="delimiter">]</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api.ConfigLoader.playConfigLoader" title="=&gt; play.api.ConfigLoader[play.api.PlayConfig]" class="delimiter">(</a><span title="String(&quot;db&quot;)" class="string">&quot;db&quot;</span><span class="delimiter">)</span>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.subKeys" title="=&gt; Set[String]">subKeys</a> <span title="(elems: scala.collection.GenTraversableOnce[String])scala.collection.immutable.Set[String]">++</span>
      <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.loadDatasources" title="(path: String)Set[String]">loadDatasources</a><span class="delimiter">(</span><span title="String(&quot;applyEvolutions&quot;)" class="string">&quot;applyEvolutions&quot;</span><span class="delimiter">)</span> <span title="(elems: scala.collection.GenTraversableOnce[String])scala.collection.immutable.Set[String]">++</span>
      <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.loadDatasources" title="(path: String)Set[String]">loadDatasources</a><span class="delimiter">(</span><span title="String(&quot;applyDownEvolutions&quot;)" class="string">&quot;applyDownEvolutions&quot;</span><span class="delimiter">)</span>

    <span class="comment">// Load defaults</span>
    <span class="keyword">val</span> <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.enabled">enabled</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.config" title="play.api.PlayConfig">config</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.get" title="[A](path: String)(implicit loader: play.api.ConfigLoader[A])A">get</a><span title="(path: String)(implicit loader: play.api.ConfigLoader[Boolean])Boolean" class="delimiter">[</span><span title="Boolean">Boolean</span><span class="delimiter">]</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api.ConfigLoader.booleanLoader" title="=&gt; play.api.ConfigLoader[Boolean]" class="delimiter">(</a><span title="String(&quot;enabled&quot;)" class="string">&quot;enabled&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.autocommit">autocommit</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated" title="[A](config: play.api.PlayConfig, baseKey: =&gt; String, path: String, deprecated: String)(implicit evidence$1: play.api.ConfigLoader[A])A">getDeprecated</a><span title="(config: play.api.PlayConfig, baseKey: =&gt; String, path: String, deprecated: String)(implicit evidence$1: play.api.ConfigLoader[Boolean])Boolean" class="delimiter">[</span><span title="Boolean">Boolean</span><span class="delimiter">]</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api.ConfigLoader.booleanLoader" title="=&gt; play.api.ConfigLoader[Boolean]" class="delimiter">(</a><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.config" title="play.api.PlayConfig">config</a>, <span title="String(&quot;play.evolutions&quot;)" class="string">&quot;play.evolutions&quot;</span>, <span title="String(&quot;autocommit&quot;)" class="string">&quot;autocommit&quot;</span>, <span title="String(&quot;evolutions.autocommit&quot;)" class="string">&quot;evolutions.autocommit&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.useLocks">useLocks</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated" title="[A](config: play.api.PlayConfig, baseKey: =&gt; String, path: String, deprecated: String)(implicit evidence$1: play.api.ConfigLoader[A])A">getDeprecated</a><span title="(config: play.api.PlayConfig, baseKey: =&gt; String, path: String, deprecated: String)(implicit evidence$1: play.api.ConfigLoader[Boolean])Boolean" class="delimiter">[</span><span title="Boolean">Boolean</span><span class="delimiter">]</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api.ConfigLoader.booleanLoader" title="=&gt; play.api.ConfigLoader[Boolean]" class="delimiter">(</a><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.config" title="play.api.PlayConfig">config</a>, <span title="String(&quot;play.evolutions&quot;)" class="string">&quot;play.evolutions&quot;</span>, <span title="String(&quot;useLocks&quot;)" class="string">&quot;useLocks&quot;</span>, <span title="String(&quot;evolutions.use.locks&quot;)" class="string">&quot;evolutions.use.locks&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.autoApply">autoApply</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.config" title="play.api.PlayConfig">config</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.get" title="[A](path: String)(implicit loader: play.api.ConfigLoader[A])A">get</a><span title="(path: String)(implicit loader: play.api.ConfigLoader[Boolean])Boolean" class="delimiter">[</span><span title="Boolean">Boolean</span><span class="delimiter">]</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api.ConfigLoader.booleanLoader" title="=&gt; play.api.ConfigLoader[Boolean]" class="delimiter">(</a><span title="String(&quot;autoApply&quot;)" class="string">&quot;autoApply&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.autoApplyDowns">autoApplyDowns</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.config" title="play.api.PlayConfig">config</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.get" title="[A](path: String)(implicit loader: play.api.ConfigLoader[A])A">get</a><span title="(path: String)(implicit loader: play.api.ConfigLoader[Boolean])Boolean" class="delimiter">[</span><span title="Boolean">Boolean</span><span class="delimiter">]</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api.ConfigLoader.booleanLoader" title="=&gt; play.api.ConfigLoader[Boolean]" class="delimiter">(</a><span title="String(&quot;autoApplyDowns&quot;)" class="string">&quot;autoApplyDowns&quot;</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="play.api.db.evolutions.DefaultEvolutionsDatasourceConfig" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.defaultConfig">defaultConfig</a> = <span title="play.api.db.evolutions.DefaultEvolutionsDatasourceConfig" class="keyword">new</span> <a href="#play.api.db.evolutions.DefaultEvolutionsDatasourceConfig.readResolve" title="play.api.db.evolutions.DefaultEvolutionsDatasourceConfig">DefaultEvolutionsDatasourceConfig</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.enabled" title="Boolean">enabled</a>, <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.autocommit" title="Boolean">autocommit</a>, <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.useLocks" title="Boolean">useLocks</a>, <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.autoApply" title="Boolean">autoApply</a>,
      <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.autoApplyDowns" title="Boolean">autoApplyDowns</a><span class="delimiter">)</span>

    <span class="comment">// Load config specific to datasources</span>
    <span class="comment">// Since not all the datasources will necessarily appear in the db map, because some will come from deprecated</span>
    <span class="comment">// configuration, we create a map of them to the default config, and then override any of them with the ones</span>
    <span class="comment">// from db.</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[String,play.api.PlayConfig]" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfigMap">datasourceConfigMap</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasources" title="scala.collection.immutable.Set[String]">datasources</a>.<span title="(f: String =&gt; (String, play.api.PlayConfig))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set[String],(String, play.api.PlayConfig),scala.collection.immutable.Set[(String, play.api.PlayConfig)]])scala.collection.immutable.Set[(String, play.api.PlayConfig)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set.Coll,(String, play.api.PlayConfig),scala.collection.immutable.Set[(String, play.api.PlayConfig)]]" class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfigMap.$anonfun.x$3" title="(x: String)ArrowAssoc[String]">_</a> <span title="(y: play.api.PlayConfig)(String, play.api.PlayConfig)">-&gt;</span> <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.config" title="play.api.PlayConfig">config</a><span class="delimiter">)</span>.<span title="(implicit ev: &lt;:&lt;[(String, play.api.PlayConfig),(String, play.api.PlayConfig)])scala.collection.immutable.Map[String,play.api.PlayConfig]">toMap</span> <span title="(xs: scala.collection.GenTraversableOnce[(String, play.api.PlayConfig)])scala.collection.immutable.Map[String,play.api.PlayConfig]">++</span> <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.config" title="play.api.PlayConfig">config</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.getPrototypedMap" title="(path: String, prototypePath: String)Map[String,play.api.PlayConfig]">getPrototypedMap</a><span class="delimiter">(</span><span title="String(&quot;db&quot;)" class="string">&quot;db&quot;</span>, <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[String,play.api.db.evolutions.DefaultEvolutionsDatasourceConfig]" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig">datasourceConfig</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfigMap" title="scala.collection.immutable.Map[String,play.api.PlayConfig]">datasourceConfigMap</a>.<span title="(f: ((String, play.api.PlayConfig)) =&gt; (String, play.api.db.evolutions.DefaultEvolutionsDatasourceConfig))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[String,play.api.PlayConfig],(String, play.api.db.evolutions.DefaultEvolutionsDatasourceConfig),scala.collection.immutable.Map[String,play.api.db.evolutions.DefaultEvolutionsDatasourceConfig]])scala.collection.immutable.Map[String,play.api.db.evolutions.DefaultEvolutionsDatasourceConfig]">map</span> <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.x0$1" title="(String, play.api.db.evolutions.DefaultEvolutionsDatasourceConfig)" class="delimiter">{</a>
      <span class="keyword">case</span> <span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.datasource">datasource</a>, <a title="play.api.PlayConfig" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.dsConfig">dsConfig</a><span class="delimiter">)</span> =&gt;
        <span class="keyword">val</span> <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.enabled">enabled</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.dsConfig" title="play.api.PlayConfig">dsConfig</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.get" title="[A](path: String)(implicit loader: play.api.ConfigLoader[A])A">get</a><span title="(path: String)(implicit loader: play.api.ConfigLoader[Boolean])Boolean" class="delimiter">[</span><span title="Boolean">Boolean</span><span class="delimiter">]</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api.ConfigLoader.booleanLoader" title="=&gt; play.api.ConfigLoader[Boolean]" class="delimiter">(</a><span title="String(&quot;enabled&quot;)" class="string">&quot;enabled&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.autocommit">autocommit</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.dsConfig" title="play.api.PlayConfig">dsConfig</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.get" title="[A](path: String)(implicit loader: play.api.ConfigLoader[A])A">get</a><span title="(path: String)(implicit loader: play.api.ConfigLoader[Boolean])Boolean" class="delimiter">[</span><span title="Boolean">Boolean</span><span class="delimiter">]</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api.ConfigLoader.booleanLoader" title="=&gt; play.api.ConfigLoader[Boolean]" class="delimiter">(</a><span title="String(&quot;autocommit&quot;)" class="string">&quot;autocommit&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.useLocks">useLocks</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.dsConfig" title="play.api.PlayConfig">dsConfig</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;PlayConfig.get" title="[A](path: String)(implicit loader: play.api.ConfigLoader[A])A">get</a><span title="(path: String)(implicit loader: play.api.ConfigLoader[Boolean])Boolean" class="delimiter">[</span><span title="Boolean">Boolean</span><span class="delimiter">]</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api.ConfigLoader.booleanLoader" title="=&gt; play.api.ConfigLoader[Boolean]" class="delimiter">(</a><span title="String(&quot;useLocks&quot;)" class="string">&quot;useLocks&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.autoApply">autoApply</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated" title="[A](config: play.api.PlayConfig, baseKey: =&gt; String, path: String, deprecated: String)(implicit evidence$1: play.api.ConfigLoader[A])A">getDeprecated</a><span title="(config: play.api.PlayConfig, baseKey: =&gt; String, path: String, deprecated: String)(implicit evidence$1: play.api.ConfigLoader[Boolean])Boolean" class="delimiter">[</span><span title="Boolean">Boolean</span><span class="delimiter">]</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api.ConfigLoader.booleanLoader" title="=&gt; play.api.ConfigLoader[Boolean]" class="delimiter">(</a><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.dsConfig" title="play.api.PlayConfig">dsConfig</a>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;play.evolutions.db.&quot;)">play.evolutions.db.$</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.datasource" title="String">datasource</a><span title="String(&quot;&quot;)" class="string">&quot;</span>, <span title="String(&quot;autoApply&quot;)" class="string">&quot;autoApply&quot;</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;applyEvolutions.&quot;)">applyEvolutions.$</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.datasource" title="String">datasource</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.autoApplyDowns">autoApplyDowns</a> = <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.getDeprecated" title="[A](config: play.api.PlayConfig, baseKey: =&gt; String, path: String, deprecated: String)(implicit evidence$1: play.api.ConfigLoader[A])A">getDeprecated</a><span title="(config: play.api.PlayConfig, baseKey: =&gt; String, path: String, deprecated: String)(implicit evidence$1: play.api.ConfigLoader[Boolean])Boolean" class="delimiter">[</span><span title="Boolean">Boolean</span><span class="delimiter">]</span><a href="../../../../../play/play/api/Configuration.scala.html#play.api.ConfigLoader.booleanLoader" title="=&gt; play.api.ConfigLoader[Boolean]" class="delimiter">(</a><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.dsConfig" title="play.api.PlayConfig">dsConfig</a>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;play.evolutions.db.&quot;)">play.evolutions.db.$</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.datasource" title="String">datasource</a><span title="String(&quot;&quot;)" class="string">&quot;</span>, <span title="String(&quot;autoApplyDowns&quot;)" class="string">&quot;autoApplyDowns&quot;</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;applyDownEvolutions.&quot;)">applyDownEvolutions.$</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.datasource" title="String">datasource</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
        <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.datasource" title="(x: String)ArrowAssoc[String]">datasource</a> <span title="(y: play.api.db.evolutions.DefaultEvolutionsDatasourceConfig)(String, play.api.db.evolutions.DefaultEvolutionsDatasourceConfig)">-&gt;</span> <span title="play.api.db.evolutions.DefaultEvolutionsDatasourceConfig" class="keyword">new</span> <a href="#play.api.db.evolutions.DefaultEvolutionsDatasourceConfig.readResolve" title="play.api.db.evolutions.DefaultEvolutionsDatasourceConfig">DefaultEvolutionsDatasourceConfig</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.enabled" title="Boolean">enabled</a>, <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.autocommit" title="Boolean">autocommit</a>, <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.useLocks" title="Boolean">useLocks</a>, <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.autoApply" title="Boolean">autoApply</a>, <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig.$anonfun.autoApplyDowns" title="Boolean">autoApplyDowns</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="(implicit ev: &lt;:&lt;[(String, play.api.db.evolutions.DefaultEvolutionsDatasourceConfig),(String, play.api.db.evolutions.DefaultEvolutionsDatasourceConfig)])scala.collection.immutable.Map[String,play.api.db.evolutions.DefaultEvolutionsDatasourceConfig]">toMap</span>

    <span title="play.api.db.evolutions.DefaultEvolutionsConfig" class="keyword">new</span> <a href="#play.api.db.evolutions;DefaultEvolutionsConfig" title="play.api.db.evolutions.DefaultEvolutionsConfig">DefaultEvolutionsConfig</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.defaultConfig" title="play.api.db.evolutions.DefaultEvolutionsDatasourceConfig">defaultConfig</a>, <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.parse.datasourceConfig" title="scala.collection.immutable.Map[String,play.api.db.evolutions.DefaultEvolutionsDatasourceConfig]">datasourceConfig</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Convert configuration sections of key-boolean pairs to a set of enabled keys.
   */</span>
  <span class="keyword">def</span> <a title="(configuration: play.api.Configuration, section: String)Set[String]" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.enabledKeys">enabledKeys</a><span class="delimiter">(</span><a title="play.api.Configuration" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.enabledKeys.configuration">configuration</a>: <a href="../../../../../play/play/api/Configuration.scala.html#play.api;Configuration" title="play.api.Configuration">Configuration</a>, <a title="String" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.enabledKeys.section">section</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Set[String]">Set</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.enabledKeys.configuration" title="play.api.Configuration">configuration</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;Configuration.getConfig" title="(path: String)Option[play.api.Configuration]">getConfig</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.enabledKeys.section" title="String">section</a><span class="delimiter">)</span>.<span title="(ifEmpty: =&gt; scala.collection.immutable.Set[String])(f: play.api.Configuration =&gt; scala.collection.immutable.Set[String])scala.collection.immutable.Set[String]">fold</span><span class="delimiter">(</span><span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.immutable.Set[A]">empty</span><span title="scala.collection.immutable.Set[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="play.api.Configuration" id="play.api.db.evolutions;DefaultEvolutionsConfigParser.enabledKeys.$anonfun.conf">conf</a> =&gt;
      <a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.enabledKeys.$anonfun.conf" title="play.api.Configuration">conf</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;Configuration.keys" title="=&gt; Set[String]">keys</a>.<span title="(p: String =&gt; Boolean)scala.collection.immutable.Set[String]">filter</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.enabledKeys.$anonfun.conf" title="play.api.Configuration">conf</a>.<a href="../../../../../play/play/api/Configuration.scala.html#play.api;Configuration.getBoolean" title="(path: String)Option[Boolean]">getBoolean</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsConfigParser.enabledKeys.$anonfun.$anonfun.x$4" title="String">_</a><span class="delimiter">)</span>.<span title="(default: =&gt; Boolean)Boolean">getOrElse</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Default implementation for optional dynamic evolutions.
 */</span>
@Singleton
<span class="keyword">class</span> <a title="class DynamicEvolutions extends AnyRef" id="play.api.db.evolutions;DynamicEvolutions">DynamicEvolutions</a> <a href="#play.api.db.evolutions;DynamicEvolutions" title="play.api.db.evolutions.DynamicEvolutions" class="delimiter">{</a>
  <span class="keyword">def</span> <a title="()Unit" id="play.api.db.evolutions;DynamicEvolutions.create">create</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Web command handler for applying evolutions on application start.
 */</span>
@Singleton
<span class="keyword">class</span> <a title="class EvolutionsWebCommands extends AnyRef with play.core.HandleWebCommandSupport" id="play.api.db.evolutions;EvolutionsWebCommands">EvolutionsWebCommands</a> @Inject<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">(</span><a title="play.api.db.evolutions.EvolutionsApi" id="play.api.db.evolutions;EvolutionsWebCommands.evolutions">evolutions</a>: <a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi" title="play.api.db.evolutions.EvolutionsApi">EvolutionsApi</a>, <a title="play.api.db.evolutions.EvolutionsReader" id="play.api.db.evolutions;EvolutionsWebCommands.reader">reader</a>: <a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsReader" title="play.api.db.evolutions.EvolutionsReader">EvolutionsReader</a>, <a title="play.api.db.evolutions.EvolutionsConfig" id="play.api.db.evolutions;EvolutionsWebCommands.config">config</a>: <a href="#play.api.db.evolutions;EvolutionsConfig" title="play.api.db.evolutions.EvolutionsConfig">EvolutionsConfig</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../../play/play/core/ApplicationProvider.scala.html#play.core;HandleWebCommandSupport" title="play.core.HandleWebCommandSupport">HandleWebCommandSupport</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(request: play.api.mvc.RequestHeader, buildLink: play.core.BuildLink, path: java.io.File)Option[play.api.mvc.Result]" id="play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand">handleWebCommand</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader" id="play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.request">request</a>: play.api.mvc.<a href="../../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a>, <a title="play.core.BuildLink" id="play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.buildLink">buildLink</a>: play.core.<span title="play.core.BuildLink">BuildLink</span>, <a title="java.io.File" id="play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.path">path</a>: java.io.<span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="Option[play.api.mvc.Result]">Option</span><span class="delimiter">[</span>play.api.mvc.Result<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.applyEvolutions">applyEvolutions</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;/@evolutions/apply/([a-zA-Z0-9_]+)&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
    <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.resolveEvolutions">resolveEvolutions</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;/@evolutions/resolve/([a-zA-Z0-9_]+)/([0-9]+)&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>

    <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.redirectUrl">redirectUrl</a> = <a href="#play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.queryString" title="=&gt; Map[String,Seq[String]]">queryString</a>.<span title="(key: String)Option[Seq[String]]">get</span><span class="delimiter">(</span><span title="String(&quot;redirect&quot;)" class="string">&quot;redirect&quot;</span><span class="delimiter">)</span>.<span title="(p: Seq[String] =&gt; Boolean)Option[Seq[String]]">filterNot</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.redirectUrl.$anonfun.x$5" title="Seq[String]">_</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>.<span title="(f: Seq[String] =&gt; String)Option[String]">map</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.redirectUrl.$anonfun.x$6" title="Seq[String]">_</a>.<span title="=&gt; String">head</span><span class="delimiter">)</span>.<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span>

    <a href="#play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.path" title="=&gt; String">path</a> <span title="Option[play.api.mvc.Result]" class="keyword">match</span> <span class="delimiter">{</span>

      <span class="keyword">case</span> <a href="#play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.applyEvolutions" title="(target: Any)Option[List[String]]">applyEvolutions</a><span class="delimiter">(</span><span title="String">db</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span title="(x: play.api.mvc.Result)Some[play.api.mvc.Result]">Some</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.scripts">scripts</a> = <a href="#play.api.db.evolutions;EvolutionsWebCommands.evolutions" title="play.api.db.evolutions.EvolutionsApi">evolutions</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi.scripts(a24908cd1f)" title="(db: String, reader: play.api.db.evolutions.EvolutionsReader)Seq[play.api.db.evolutions.Script]">scripts</a><span class="delimiter">(</span><span title="String">db</span>, <a href="#play.api.db.evolutions;EvolutionsWebCommands.reader" title="play.api.db.evolutions.EvolutionsReader">reader</a><span class="delimiter">)</span>
          <a href="#play.api.db.evolutions;EvolutionsWebCommands.evolutions" title="play.api.db.evolutions.EvolutionsApi">evolutions</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi.evolve" title="(db: String, scripts: Seq[play.api.db.evolutions.Script], autocommit: Boolean)Unit">evolve</a><span class="delimiter">(</span><span title="String">db</span>, <a href="#play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a>, <a href="#play.api.db.evolutions;EvolutionsWebCommands.config" title="play.api.db.evolutions.EvolutionsConfig">config</a>.<a href="#play.api.db.evolutions;EvolutionsConfig.forDatasource" title="(db: String)play.api.db.evolutions.EvolutionsDatasourceConfig">forDatasource</a><span class="delimiter">(</span><span title="String">db</span><span class="delimiter">)</span>.<a href="#play.api.db.evolutions;EvolutionsDatasourceConfig.autocommit" title="=&gt; Boolean">autocommit</a><span class="delimiter">)</span>
          <a href="#play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.buildLink" title="play.core.BuildLink">buildLink</a>.<span title="()Unit">forceReload</span><span class="delimiter">(</span><span class="delimiter">)</span>
          play.api.mvc.<a href="../../../../../play/play/api/mvc/Results.scala.html#play.api.mvc.Results" title="play.api.mvc.Results.type">Results</a>.<a href="../../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Results.Redirect(9f73d12c5d)" title="(url: String, queryString: Map[String,Seq[String]], status: Int)play.api.mvc.Result">Redirect</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.redirectUrl" title="=&gt; String">redirectUrl</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">case</span> <a href="#play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.resolveEvolutions" title="(target: Any)Option[List[String]]">resolveEvolutions</a><span class="delimiter">(</span><span title="String">db</span>, <a title="String" id="play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.rev">rev</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span title="(x: play.api.mvc.Result)Some[play.api.mvc.Result]">Some</span> <span class="delimiter">{</span>
          <a href="#play.api.db.evolutions;EvolutionsWebCommands.evolutions" title="play.api.db.evolutions.EvolutionsApi">evolutions</a>.<a href="EvolutionsApi.scala.html#play.api.db.evolutions;EvolutionsApi.resolve" title="(db: String, revision: Int)Unit">resolve</a><span class="delimiter">(</span><span title="String">db</span>, <a href="#play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.rev" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">rev</a>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span>
          <a href="#play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.buildLink" title="play.core.BuildLink">buildLink</a>.<span title="()Unit">forceReload</span><span class="delimiter">(</span><span class="delimiter">)</span>
          play.api.mvc.<a href="../../../../../play/play/api/mvc/Results.scala.html#play.api.mvc.Results" title="play.api.mvc.Results.type">Results</a>.<a href="../../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Results.Redirect(9f73d12c5d)" title="(url: String, queryString: Map[String,Seq[String]], status: Int)play.api.mvc.Result">Redirect</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;EvolutionsWebCommands.handleWebCommand.redirectUrl" title="=&gt; String">redirectUrl</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">case</span> _ =&gt; <span title="None.type">None</span>

    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Exception thrown when the database is not up to date.
 *
 * @param db the database name
 * @param script the script to be run to resolve the conflict.
 */</span>
<span class="keyword">case class</span> <a title="class InvalidDatabaseRevision extends play.api.PlayException.RichDescription with Product with Serializable" id="play.api.db.evolutions.InvalidDatabaseRevision.readResolve">InvalidDatabaseRevision</a><a href="../../../../../play-exceptions/play/api/PlayException.java.html#play.api.PlayException;RichDescription.<init>(12aa1e1a0c)" title="Product" class="delimiter">(</a><a title="String" id="play.api.db.evolutions;InvalidDatabaseRevision.db">db</a>: <span title="String">String</span>, <a title="String" id="play.api.db.evolutions;InvalidDatabaseRevision.script">script</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../../play-exceptions/play/api/PlayException.java.html#play.api.PlayException" title="play.api.PlayException.type">PlayException</a>.<a href="../../../../../play-exceptions/play/api/PlayException.java.html#play.api.PlayException;RichDescription" title="play.api.PlayException.RichDescription">RichDescription</a><span class="delimiter">(</span>
  <span title="String(&quot;Database \'&quot;)" class="string">&quot;Database '&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions;InvalidDatabaseRevision.db" title="String">db</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\' needs evolution!&quot;)" class="string">&quot;' needs evolution!&quot;</span>,
  <span title="String(&quot;An SQL script need to be run on your database.&quot;)" class="string">&quot;An SQL script need to be run on your database.&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="()String" id="play.api.db.evolutions;InvalidDatabaseRevision.subTitle">subTitle</a> = <span title="String(&quot;This SQL script must be run:&quot;)" class="string">&quot;This SQL script must be run:&quot;</span>
  <span class="keyword">def</span> <a title="()String" id="play.api.db.evolutions;InvalidDatabaseRevision.content">content</a> = <a href="#play.api.db.evolutions;InvalidDatabaseRevision.script" title="=&gt; String">script</a>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;InvalidDatabaseRevision.javascript">javascript</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;
        document.location = '/@evolutions/apply/%s?redirect=' + encodeURIComponent(location)
    &quot;&quot;&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;InvalidDatabaseRevision.db" title="=&gt; String">db</a><span class="delimiter">)</span>.<span title="()String">trim</span>

  <span class="keyword">def</span> <a title="()String" id="play.api.db.evolutions;InvalidDatabaseRevision.htmlDescription">htmlDescription</a> = <span class="delimiter">{</span>

    <span class="delimiter">&lt;span&gt;An SQL script will be run on your database -&lt;/span&gt;
    &lt;input name=&quot;evolution-button&quot; type=&quot;button&quot; value=&quot;Apply this script now!&quot; onclick={</span> <a href="#play.api.db.evolutions;InvalidDatabaseRevision.javascript" title="=&gt; String">javascript</a> }/&gt;

  <span class="delimiter">}</span>.<span title="=&gt; String">mkString</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
