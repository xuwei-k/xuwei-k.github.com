<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>play-jdbc-evolutions/play/api/db/evolutions/EvolutionsApi.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> play.api.db.evolutions

<span class="keyword">import</span> java.io.<span class="delimiter">{</span> InputStream, FileInputStream <span class="delimiter">}</span>
<span class="keyword">import</span> java.sql.<span class="delimiter">{</span> Connection, Date, PreparedStatement, ResultSet, SQLException <span class="delimiter">}</span>
<span class="keyword">import</span> javax.inject.<span class="delimiter">{</span> Inject, Singleton <span class="delimiter">}</span>

<span class="keyword">import</span> scala.io.Codec
<span class="keyword">import</span> scala.util.control.NonFatal

<span class="keyword">import</span> play.api.db.<span class="delimiter">{</span> Database, DBApi <span class="delimiter">}</span>
<span class="keyword">import</span> play.api.libs.Collections
<span class="keyword">import</span> play.api.<span class="delimiter">{</span> Environment, Logger, PlayException <span class="delimiter">}</span>
<span class="keyword">import</span> play.utils.PlayIO

<span class="comment">/**
 * Evolutions API.
 */</span>
<span class="keyword">trait</span> <a title="trait EvolutionsApi extends AnyRef" id="play.api.db.evolutions;EvolutionsApi">EvolutionsApi</a> <span class="delimiter">{</span>

  <span class="comment">/**
   * Create evolution scripts.
   *
   * @param db the database name
   * @param evolutions the evolutions for the application
   * @return evolution scripts
   */</span>
  <span class="keyword">def</span> <a title="(db: String, evolutions: Seq[play.api.db.evolutions.Evolution])Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions;EvolutionsApi.scripts(b1ee944445)">scripts</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;EvolutionsApi.scripts(b1ee944445).db">db</a>: <span title="String">String</span>, <a title="Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;EvolutionsApi.scripts(b1ee944445).evolutions">evolutions</a>: <span title="Seq[play.api.db.evolutions.Evolution]">Seq</span><span class="delimiter">[</span>Evolution<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Seq[play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Script<span class="delimiter">]</span>

  <span class="comment">/**
   * Create evolution scripts.
   *
   * @param db the database name
   * @param reader evolution file reader
   * @return evolution scripts
   */</span>
  <span class="keyword">def</span> <a title="(db: String, reader: play.api.db.evolutions.EvolutionsReader)Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions;EvolutionsApi.scripts(a24908cd1f)">scripts</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;EvolutionsApi.scripts(a24908cd1f).db">db</a>: <span title="String">String</span>, <a title="play.api.db.evolutions.EvolutionsReader" id="play.api.db.evolutions;EvolutionsApi.scripts(a24908cd1f).reader">reader</a>: <a href="#play.api.db.evolutions;EvolutionsReader" title="play.api.db.evolutions.EvolutionsReader">EvolutionsReader</a><span class="delimiter">)</span>: <span title="Seq[play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Script<span class="delimiter">]</span>

  <span class="comment">/**
   * Get all scripts necessary to reset the database state to its initial state.
   *
   * @param db the database name
   * @return evolution scripts
   */</span>
  <span class="keyword">def</span> <a title="(db: String)Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions;EvolutionsApi.resetScripts">resetScripts</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;EvolutionsApi.resetScripts.db">db</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Seq[play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Script<span class="delimiter">]</span>

  <span class="comment">/**
   * Apply evolution scripts to the database.
   *
   * @param db the database name
   * @param scripts the evolution scripts to run
   * @param autocommit determines whether the connection uses autocommit
   */</span>
  <span class="keyword">def</span> <a title="(db: String, scripts: Seq[play.api.db.evolutions.Script], autocommit: Boolean)Unit" id="play.api.db.evolutions;EvolutionsApi.evolve">evolve</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;EvolutionsApi.evolve.db">db</a>: <span title="String">String</span>, <a title="Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions;EvolutionsApi.evolve.scripts">scripts</a>: <span title="Seq[play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Script<span class="delimiter">]</span>, <a title="Boolean" id="play.api.db.evolutions;EvolutionsApi.evolve.autocommit">autocommit</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span>

  <span class="comment">/**
   * Resolve evolution conflicts.
   *
   * @param db the database name
   * @param revision the revision to mark as resolved
   */</span>
  <span class="keyword">def</span> <a title="(db: String, revision: Int)Unit" id="play.api.db.evolutions;EvolutionsApi.resolve">resolve</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;EvolutionsApi.resolve.db">db</a>: <span title="String">String</span>, <a title="Int" id="play.api.db.evolutions;EvolutionsApi.resolve.revision">revision</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Default implementation of the evolutions API.
 */</span>
@Singleton
<span class="keyword">class</span> <a title="class DefaultEvolutionsApi extends AnyRef with play.api.db.evolutions.EvolutionsApi" id="play.api.db.evolutions;DefaultEvolutionsApi">DefaultEvolutionsApi</a> @Inject<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">(</span><a title="play.api.db.DBApi" id="play.api.db.evolutions;DefaultEvolutionsApi.dbApi">dbApi</a>: <a href="../../../../../play-jdbc-api/play/api/db/DBApi.scala.html#play.api.db;DBApi" title="play.api.db.DBApi">DBApi</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#play.api.db.evolutions;EvolutionsApi" title="play.api.db.evolutions.EvolutionsApi">EvolutionsApi</a> <span class="delimiter">{</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(name: String)play.api.db.evolutions.DatabaseEvolutions" id="play.api.db.evolutions;DefaultEvolutionsApi.databaseEvolutions">databaseEvolutions</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;DefaultEvolutionsApi.databaseEvolutions.name">name</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="play.api.db.evolutions.DatabaseEvolutions" class="keyword">new</span> <a href="#play.api.db.evolutions;DatabaseEvolutions" title="play.api.db.evolutions.DatabaseEvolutions">DatabaseEvolutions</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsApi.dbApi" title="play.api.db.DBApi">dbApi</a>.<a href="../../../../../play-jdbc-api/play/api/db/DBApi.scala.html#play.api.db;DBApi.database" title="(name: String)play.api.db.Database">database</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsApi.databaseEvolutions.name" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(db: String, evolutions: Seq[play.api.db.evolutions.Evolution])Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions;DefaultEvolutionsApi.scripts(b1ee944445)">scripts</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;DefaultEvolutionsApi.scripts(b1ee944445).db">db</a>: <span title="String">String</span>, <a title="Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;DefaultEvolutionsApi.scripts(b1ee944445).evolutions">evolutions</a>: <span title="Seq[play.api.db.evolutions.Evolution]">Seq</span><span class="delimiter">[</span>Evolution<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#play.api.db.evolutions;DefaultEvolutionsApi.databaseEvolutions" title="(name: String)play.api.db.evolutions.DatabaseEvolutions">databaseEvolutions</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsApi.scripts(b1ee944445).db" title="String">db</a><span class="delimiter">)</span>.<a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672)" title="(evolutions: Seq[play.api.db.evolutions.Evolution])Seq[play.api.db.evolutions.Script]">scripts</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsApi.scripts(b1ee944445).evolutions" title="Seq[play.api.db.evolutions.Evolution]">evolutions</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(db: String, reader: play.api.db.evolutions.EvolutionsReader)Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions;DefaultEvolutionsApi.scripts(a24908cd1f)">scripts</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;DefaultEvolutionsApi.scripts(a24908cd1f).db">db</a>: <span title="String">String</span>, <a title="play.api.db.evolutions.EvolutionsReader" id="play.api.db.evolutions;DefaultEvolutionsApi.scripts(a24908cd1f).reader">reader</a>: <a href="#play.api.db.evolutions;EvolutionsReader" title="play.api.db.evolutions.EvolutionsReader">EvolutionsReader</a><span class="delimiter">)</span> = <a href="#play.api.db.evolutions;DefaultEvolutionsApi.databaseEvolutions" title="(name: String)play.api.db.evolutions.DatabaseEvolutions">databaseEvolutions</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsApi.scripts(a24908cd1f).db" title="String">db</a><span class="delimiter">)</span>.<a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(0b93af615d)" title="(reader: play.api.db.evolutions.EvolutionsReader)Seq[play.api.db.evolutions.Script]">scripts</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsApi.scripts(a24908cd1f).reader" title="play.api.db.evolutions.EvolutionsReader">reader</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(db: String)Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions;DefaultEvolutionsApi.resetScripts">resetScripts</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;DefaultEvolutionsApi.resetScripts.db">db</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#play.api.db.evolutions;DefaultEvolutionsApi.databaseEvolutions" title="(name: String)play.api.db.evolutions.DatabaseEvolutions">databaseEvolutions</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsApi.resetScripts.db" title="String">db</a><span class="delimiter">)</span>.<a href="#play.api.db.evolutions;DatabaseEvolutions.resetScripts" title="()Seq[play.api.db.evolutions.Script]">resetScripts</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(db: String, scripts: Seq[play.api.db.evolutions.Script], autocommit: Boolean)Unit" id="play.api.db.evolutions;DefaultEvolutionsApi.evolve">evolve</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;DefaultEvolutionsApi.evolve.db">db</a>: <span title="String">String</span>, <a title="Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions;DefaultEvolutionsApi.evolve.scripts">scripts</a>: <span title="Seq[play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Script<span class="delimiter">]</span>, <a title="Boolean" id="play.api.db.evolutions;DefaultEvolutionsApi.evolve.autocommit">autocommit</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> = <a href="#play.api.db.evolutions;DefaultEvolutionsApi.databaseEvolutions" title="(name: String)play.api.db.evolutions.DatabaseEvolutions">databaseEvolutions</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsApi.evolve.db" title="String">db</a><span class="delimiter">)</span>.<a href="#play.api.db.evolutions;DatabaseEvolutions.evolve" title="(scripts: Seq[play.api.db.evolutions.Script], autocommit: Boolean)Unit">evolve</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsApi.evolve.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a>, <a href="#play.api.db.evolutions;DefaultEvolutionsApi.evolve.autocommit" title="Boolean">autocommit</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(db: String, revision: Int)Unit" id="play.api.db.evolutions;DefaultEvolutionsApi.resolve">resolve</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;DefaultEvolutionsApi.resolve.db">db</a>: <span title="String">String</span>, <a title="Int" id="play.api.db.evolutions;DefaultEvolutionsApi.resolve.revision">revision</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <a href="#play.api.db.evolutions;DefaultEvolutionsApi.databaseEvolutions" title="(name: String)play.api.db.evolutions.DatabaseEvolutions">databaseEvolutions</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsApi.resolve.db" title="String">db</a><span class="delimiter">)</span>.<a href="#play.api.db.evolutions;DatabaseEvolutions.resolve" title="(revision: Int)Unit">resolve</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DefaultEvolutionsApi.resolve.revision" title="Int">revision</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Evolutions for a particular database.
 */</span>
<span class="keyword">class</span> <a title="class DatabaseEvolutions extends AnyRef" id="play.api.db.evolutions;DatabaseEvolutions">DatabaseEvolutions</a><a href="#play.api.db.evolutions;DatabaseEvolutions" title="play.api.db.evolutions.DatabaseEvolutions" class="delimiter">(</a><a title="play.api.db.Database" id="play.api.db.evolutions;DatabaseEvolutions.database">database</a>: <a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database" title="play.api.db.Database">Database</a><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">import</span> <a href="#play.api.db.evolutions.DefaultEvolutionsApi" title="play.api.db.evolutions.DefaultEvolutionsApi.type">DefaultEvolutionsApi</a>._
  <span class="keyword">import</span> <a href="Evolutions.scala.html#play.api.db.evolutions.DatabaseUrlPatterns" title="play.api.db.evolutions.DatabaseUrlPatterns.type">DatabaseUrlPatterns</a>._

  <span class="keyword">def</span> <a title="(evolutions: Seq[play.api.db.evolutions.Evolution])Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672)">scripts</a><span class="delimiter">(</span><a title="Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).evolutions">evolutions</a>: <span title="Seq[play.api.db.evolutions.Evolution]">Seq</span><span class="delimiter">[</span>Evolution<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Seq[play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Script<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="Seq[play.api.db.evolutions.Script]" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).evolutions" title="Seq[play.api.db.evolutions.Evolution]">evolutions</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).application">application</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).evolutions" title="Seq[play.api.db.evolutions.Evolution]">evolutions</a>.<span title="=&gt; Seq[play.api.db.evolutions.Evolution]">reverse</span>
      <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).database">database</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.databaseEvolutions" title="()Seq[play.api.db.evolutions.Evolution]">databaseEvolutions</a><span class="delimiter">(</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).nonConflictingDowns" title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])" class="delimiter">(</a><a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).x$2" title="Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).nonConflictingDowns">nonConflictingDowns</a>, <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).x$2" title="Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).dRest">dRest</a><span class="delimiter">)</span> = <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).database" title="Seq[play.api.db.evolutions.Evolution]">database</a>.<span title="(p: play.api.db.evolutions.Evolution =&gt; Boolean)(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])">span</span><span title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution]) @unchecked" class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).x$2.$anonfun.e">e</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).application" title="Seq[play.api.db.evolutions.Evolution]">application</a>.<span title="=&gt; Option[play.api.db.evolutions.Evolution]">headOption</span>.<span title="(p: play.api.db.evolutions.Evolution =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).x$2.$anonfun.e" title="play.api.db.evolutions.Evolution">e</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.revision" title="=&gt; Int">revision</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).x$2.$anonfun.$anonfun.x$1" title="play.api.db.evolutions.Evolution">_</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.revision" title="=&gt; Int">revision</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).nonConflictingUps" title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])" class="delimiter">(</a><a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).x$4" title="Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).nonConflictingUps">nonConflictingUps</a>, <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).x$4" title="Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).uRest">uRest</a><span class="delimiter">)</span> = <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).application" title="Seq[play.api.db.evolutions.Evolution]">application</a>.<span title="(p: play.api.db.evolutions.Evolution =&gt; Boolean)(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])">span</span><span title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution]) @unchecked" class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).x$4.$anonfun.e">e</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).database" title="Seq[play.api.db.evolutions.Evolution]">database</a>.<span title="=&gt; Option[play.api.db.evolutions.Evolution]">headOption</span>.<span title="(p: play.api.db.evolutions.Evolution =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).x$4.$anonfun.$anonfun.x$3" title="play.api.db.evolutions.Evolution">_</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.revision" title="=&gt; Int">revision</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).x$4.$anonfun.e" title="play.api.db.evolutions.Evolution">e</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.revision" title="=&gt; Int">revision</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).conflictingDowns" title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])" class="delimiter">(</a><a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).x$5" title="Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).conflictingDowns">conflictingDowns</a>, <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).x$5" title="Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).conflictingUps">conflictingUps</a><span class="delimiter">)</span> = <a href="Evolutions.scala.html#play.api.db.evolutions.Evolutions" title="play.api.db.evolutions.Evolutions.type">Evolutions</a>.<a href="Evolutions.scala.html#play.api.db.evolutions.Evolutions.conflictings" title="(downs: Seq[play.api.db.evolutions.Evolution], ups: Seq[play.api.db.evolutions.Evolution])(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution])">conflictings</a><span title="(Seq[play.api.db.evolutions.Evolution], Seq[play.api.db.evolutions.Evolution]) @unchecked" class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).dRest" title="Seq[play.api.db.evolutions.Evolution]">dRest</a>, <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).uRest" title="Seq[play.api.db.evolutions.Evolution]">uRest</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.UpScript]" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).ups">ups</a> = <span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).nonConflictingUps" title="Seq[play.api.db.evolutions.Evolution]">nonConflictingUps</a> <span title="(that: scala.collection.GenTraversableOnce[play.api.db.evolutions.Evolution])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],play.api.db.evolutions.Evolution,Seq[play.api.db.evolutions.Evolution]])Seq[play.api.db.evolutions.Evolution]">++</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).conflictingUps" title="Seq[play.api.db.evolutions.Evolution]">conflictingUps</a><span class="delimiter">)</span>.<span title="(f: play.api.db.evolutions.Evolution =&gt; play.api.db.evolutions.UpScript)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],play.api.db.evolutions.UpScript,Seq[play.api.db.evolutions.UpScript]])Seq[play.api.db.evolutions.UpScript]">reverseMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,play.api.db.evolutions.UpScript,Seq[play.api.db.evolutions.UpScript]]" class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).ups.$anonfun.e">e</a> =&gt; <a href="Evolutions.scala.html#play.api.db.evolutions;UpScript" title="(evolution: play.api.db.evolutions.Evolution)play.api.db.evolutions.UpScript">UpScript</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).ups.$anonfun.e" title="play.api.db.evolutions.Evolution">e</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.DownScript]" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).downs">downs</a> = <span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).nonConflictingDowns" title="Seq[play.api.db.evolutions.Evolution]">nonConflictingDowns</a> <span title="(that: scala.collection.GenTraversableOnce[play.api.db.evolutions.Evolution])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],play.api.db.evolutions.Evolution,Seq[play.api.db.evolutions.Evolution]])Seq[play.api.db.evolutions.Evolution]">++</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).conflictingDowns" title="Seq[play.api.db.evolutions.Evolution]">conflictingDowns</a><span class="delimiter">)</span>.<span title="(f: play.api.db.evolutions.Evolution =&gt; play.api.db.evolutions.DownScript)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],play.api.db.evolutions.DownScript,Seq[play.api.db.evolutions.DownScript]])Seq[play.api.db.evolutions.DownScript]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,play.api.db.evolutions.DownScript,Seq[play.api.db.evolutions.DownScript]]" class="delimiter">(</span><a title="play.api.db.evolutions.Evolution" id="play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).downs.$anonfun.e">e</a> =&gt; <a href="Evolutions.scala.html#play.api.db.evolutions;DownScript" title="(evolution: play.api.db.evolutions.Evolution)play.api.db.evolutions.DownScript">DownScript</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).downs.$anonfun.e" title="play.api.db.evolutions.Evolution">e</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).downs" title="Seq[play.api.db.evolutions.DownScript]">downs</a> <span title="(that: scala.collection.GenTraversableOnce[Product with Serializable with play.api.db.evolutions.Script])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.DownScript],Product with Serializable with play.api.db.evolutions.Script,Seq[play.api.db.evolutions.Script]])Seq[play.api.db.evolutions.Script]">++</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672).ups" title="Seq[play.api.db.evolutions.UpScript]">ups</a>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="scala.collection.immutable.Nil.type">Nil</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(reader: play.api.db.evolutions.EvolutionsReader)Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions;DatabaseEvolutions.scripts(0b93af615d)">scripts</a><span class="delimiter">(</span><a title="play.api.db.evolutions.EvolutionsReader" id="play.api.db.evolutions;DatabaseEvolutions.scripts(0b93af615d).reader">reader</a>: <a href="#play.api.db.evolutions;EvolutionsReader" title="play.api.db.evolutions.EvolutionsReader">EvolutionsReader</a><span class="delimiter">)</span>: <span title="Seq[play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Script<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(3c0c2d7672)" title="(evolutions: Seq[play.api.db.evolutions.Evolution])Seq[play.api.db.evolutions.Script]">scripts</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.scripts(0b93af615d).reader" title="play.api.db.evolutions.EvolutionsReader">reader</a>.<a href="#play.api.db.evolutions;EvolutionsReader.evolutions" title="(db: String)Seq[play.api.db.evolutions.Evolution]">evolutions</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.database" title="play.api.db.Database">database</a>.<a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database.name" title="=&gt; String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Read evolutions from the database.
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;DatabaseEvolutions.databaseEvolutions">databaseEvolutions</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Seq[play.api.db.evolutions.Evolution]">Seq</span><span class="delimiter">[</span>Evolution<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="java.sql.Connection" id="play.api.db.evolutions;DatabaseEvolutions.databaseEvolutions.connection">connection</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.database" title="play.api.db.Database">database</a>.<a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database.getConnection(e18b5a337c)" title="(autocommit: Boolean)java.sql.Connection">getConnection</a><span class="delimiter">(</span>autocommit = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

    <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState" title="()Unit">checkEvolutionsState</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>

      <a href="../../../../../play/play/api/libs/Collections.scala.html#play.api.libs.Collections" title="play.api.libs.Collections.type">Collections</a>.<a href="../../../../../play/play/api/libs/Collections.scala.html#play.api.libs.Collections.unfoldLeft" title="(seed: java.sql.ResultSet)(f: java.sql.ResultSet =&gt; Option[(java.sql.ResultSet, play.api.db.evolutions.Evolution)])Seq[play.api.db.evolutions.Evolution]">unfoldLeft</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.executeQuery" title="(sql: String)(implicit c: java.sql.Connection)java.sql.ResultSet">executeQuery</a><a href="#play.api.db.evolutions;DatabaseEvolutions.databaseEvolutions.connection" title="java.sql.Connection" class="delimiter">(</a>
        <span title="String(&quot;\n            select id, hash, apply_script, revert_script from play_evolutions order by id\n        &quot;)" class="string">&quot;&quot;&quot;
            select id, hash, apply_script, revert_script from play_evolutions order by id
        &quot;&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="java.sql.ResultSet" id="play.api.db.evolutions;DatabaseEvolutions.databaseEvolutions.$anonfun.rs">rs</a> =&gt;
        <a href="#play.api.db.evolutions;DatabaseEvolutions.databaseEvolutions.$anonfun.rs" title="java.sql.ResultSet">rs</a>.<span title="()Boolean">next</span> <span title="Option[(java.sql.ResultSet, play.api.db.evolutions.Evolution)]" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Boolean(false)" class="keyword">false</span> =&gt; <span title="None.type">None</span>
          <span class="keyword">case</span> <span title="Boolean(true)" class="keyword">true</span> =&gt; <span class="delimiter">{</span>
            <span title="(x: (java.sql.ResultSet, play.api.db.evolutions.Evolution))Some[(java.sql.ResultSet, play.api.db.evolutions.Evolution)]">Some</span><span class="delimiter">(</span><span title="(_1: java.sql.ResultSet, _2: play.api.db.evolutions.Evolution)(java.sql.ResultSet, play.api.db.evolutions.Evolution)" class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.databaseEvolutions.$anonfun.rs" title="java.sql.ResultSet">rs</a>, <a href="Evolutions.scala.html#play.api.db.evolutions;Evolution" title="(revision: Int, sql_up: String, sql_down: String)play.api.db.evolutions.Evolution">Evolution</a><span class="delimiter">(</span>
              <a href="#play.api.db.evolutions;DatabaseEvolutions.databaseEvolutions.$anonfun.rs" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)Int">getInt</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>,
              <span title="(x: String)Option[String]">Option</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.databaseEvolutions.$anonfun.rs" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)String">getString</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(default: =&gt; String)String">getOrElse</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>,
              <span title="(x: String)Option[String]">Option</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.databaseEvolutions.$anonfun.rs" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)String">getString</span><span class="delimiter">(</span><span title="Int(4)" class="int">4</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(default: =&gt; String)String">getOrElse</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#play.api.db.evolutions;DatabaseEvolutions.databaseEvolutions.connection" title="java.sql.Connection">connection</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(scripts: Seq[play.api.db.evolutions.Script], autocommit: Boolean)Unit" id="play.api.db.evolutions;DatabaseEvolutions.evolve">evolve</a><span class="delimiter">(</span><a title="Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions;DatabaseEvolutions.evolve.scripts">scripts</a>: <span title="Seq[play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Script<span class="delimiter">]</span>, <a title="Boolean" id="play.api.db.evolutions;DatabaseEvolutions.evolve.autocommit">autocommit</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(script: play.api.db.evolutions.Script)(implicit conn: java.sql.Connection)Unit" id="play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore">logBefore</a><span class="delimiter">(</span><a title="play.api.db.evolutions.Script" id="play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore.script">script</a>: <a href="Evolutions.scala.html#play.api.db.evolutions;Script" title="play.api.db.evolutions.Script">Script</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="java.sql.Connection" id="play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore.conn">conn</a>: <span title="java.sql.Connection">Connection</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
      <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore.script" title="play.api.db.evolutions.Script">script</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> UpScript<span class="delimiter">(</span><span title="play.api.db.evolutions.Evolution">e</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="java.sql.PreparedStatement" id="play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore.ps">ps</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.prepare" title="(sql: String)(implicit c: java.sql.Connection)java.sql.PreparedStatement">prepare</a><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore.conn" title="java.sql.Connection" class="delimiter">(</a><span title="String(&quot;insert into play_evolutions values(?, ?, ?, ?, ?, ?, ?)&quot;)" class="string">&quot;insert into play_evolutions values(?, ?, ?, ?, ?, ?, ?)&quot;</span><span class="delimiter">)</span>
          <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore.ps" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: Int)Unit">setInt</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <span title="play.api.db.evolutions.Evolution">e</span>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.revision" title="=&gt; Int">revision</a><span class="delimiter">)</span>
          <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore.ps" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: String)Unit">setString</span><span class="delimiter">(</span><span title="Int(2)" class="int">2</span>, <span title="play.api.db.evolutions.Evolution">e</span>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.hash" title="=&gt; String">hash</a><span class="delimiter">)</span>
          <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore.ps" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: java.sql.Date)Unit">setDate</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span>, <span title="(x$1: Long)java.sql.Date" class="keyword">new</span> <span title="java.sql.Date">Date</span><span class="delimiter">(</span><span title="System.type">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore.ps" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: String)Unit">setString</span><span class="delimiter">(</span><span title="Int(4)" class="int">4</span>, <span title="play.api.db.evolutions.Evolution">e</span>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.sql_up" title="=&gt; String">sql_up</a><span class="delimiter">)</span>
          <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore.ps" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: String)Unit">setString</span><span class="delimiter">(</span><span title="Int(5)" class="int">5</span>, <span title="play.api.db.evolutions.Evolution">e</span>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.sql_down" title="=&gt; String">sql_down</a><span class="delimiter">)</span>
          <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore.ps" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: String)Unit">setString</span><span class="delimiter">(</span><span title="Int(6)" class="int">6</span>, <span title="String(&quot;applying_up&quot;)" class="string">&quot;applying_up&quot;</span><span class="delimiter">)</span>
          <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore.ps" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: String)Unit">setString</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span>, <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
          <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore.ps" title="java.sql.PreparedStatement">ps</a>.<span title="()Boolean">execute</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> DownScript<span class="delimiter">(</span><span title="play.api.db.evolutions.Evolution">e</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <a href="#play.api.db.evolutions;DatabaseEvolutions.execute" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore.conn" title="java.sql.Connection" class="delimiter">(</a><span title="String(&quot;update play_evolutions set state = \'applying_down\' where id = &quot;)" class="string">&quot;update play_evolutions set state = 'applying_down' where id = &quot;</span> <span title="(x$1: Any)String">+</span> <span title="play.api.db.evolutions.Evolution">e</span>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.revision" title="=&gt; Int">revision</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(script: play.api.db.evolutions.Script)(implicit conn: java.sql.Connection)Boolean" id="play.api.db.evolutions;DatabaseEvolutions.evolve.logAfter">logAfter</a><span class="delimiter">(</span><a title="play.api.db.evolutions.Script" id="play.api.db.evolutions;DatabaseEvolutions.evolve.logAfter.script">script</a>: <a href="Evolutions.scala.html#play.api.db.evolutions;Script" title="play.api.db.evolutions.Script">Script</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="java.sql.Connection" id="play.api.db.evolutions;DatabaseEvolutions.evolve.logAfter.conn">conn</a>: <span title="java.sql.Connection">Connection</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logAfter.script" title="play.api.db.evolutions.Script">script</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> UpScript<span class="delimiter">(</span><span title="play.api.db.evolutions.Evolution">e</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <a href="#play.api.db.evolutions;DatabaseEvolutions.execute" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logAfter.conn" title="java.sql.Connection" class="delimiter">(</a><span title="String(&quot;update play_evolutions set state = \'applied\' where id = &quot;)" class="string">&quot;update play_evolutions set state = 'applied' where id = &quot;</span> <span title="(x$1: Any)String">+</span> <span title="play.api.db.evolutions.Evolution">e</span>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.revision" title="=&gt; Int">revision</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> DownScript<span class="delimiter">(</span><span title="play.api.db.evolutions.Evolution">e</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <a href="#play.api.db.evolutions;DatabaseEvolutions.execute" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logAfter.conn" title="java.sql.Connection" class="delimiter">(</a><span title="String(&quot;delete from play_evolutions where id = &quot;)" class="string">&quot;delete from play_evolutions where id = &quot;</span> <span title="(x$1: Any)String">+</span> <span title="play.api.db.evolutions.Evolution">e</span>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.revision" title="=&gt; Int">revision</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(message: String, revision: Int)(implicit conn: java.sql.Connection)Boolean" id="play.api.db.evolutions;DatabaseEvolutions.evolve.updateLastProblem">updateLastProblem</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;DatabaseEvolutions.evolve.updateLastProblem.message">message</a>: <span title="String">String</span>, <a title="Int" id="play.api.db.evolutions;DatabaseEvolutions.evolve.updateLastProblem.revision">revision</a>: <span title="Int">Int</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="java.sql.Connection" id="play.api.db.evolutions;DatabaseEvolutions.evolve.updateLastProblem.conn">conn</a>: <span title="java.sql.Connection">Connection</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.sql.PreparedStatement" id="play.api.db.evolutions;DatabaseEvolutions.evolve.updateLastProblem.ps">ps</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.prepare" title="(sql: String)(implicit c: java.sql.Connection)java.sql.PreparedStatement">prepare</a><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.updateLastProblem.conn" title="java.sql.Connection" class="delimiter">(</a><span title="String(&quot;update play_evolutions set last_problem = ? where id = ?&quot;)" class="string">&quot;update play_evolutions set last_problem = ? where id = ?&quot;</span><span class="delimiter">)</span>
      <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.updateLastProblem.ps" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: String)Unit">setString</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.updateLastProblem.message" title="String">message</a><span class="delimiter">)</span>
      <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.updateLastProblem.ps" title="java.sql.PreparedStatement">ps</a>.<span title="(x$1: Int, x$2: Int)Unit">setInt</span><span class="delimiter">(</span><span title="Int(2)" class="int">2</span>, <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.updateLastProblem.revision" title="Int">revision</a><span class="delimiter">)</span>
      <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.updateLastProblem.ps" title="java.sql.PreparedStatement">ps</a>.<span title="()Boolean">execute</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="java.sql.Connection" id="play.api.db.evolutions;DatabaseEvolutions.evolve.connection">connection</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.database" title="play.api.db.Database">database</a>.<a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database.getConnection(e18b5a337c)" title="(autocommit: Boolean)java.sql.Connection">getConnection</a><span class="delimiter">(</span>autocommit = <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.autocommit" title="Boolean">autocommit</a><span class="delimiter">)</span>
    <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState" title="()Unit">checkEvolutionsState</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">var</span> <a title="Int" id="play.api.db.evolutions;DatabaseEvolutions.evolve.applying">applying</a> = -<span title="Int(-1)" class="int">1</span>
    <span class="keyword">var</span> <a title="play.api.db.evolutions.Script" id="play.api.db.evolutions;DatabaseEvolutions.evolve.lastScript">lastScript</a>: <a href="Evolutions.scala.html#play.api.db.evolutions;Script" title="play.api.db.evolutions.Script">Script</a> = <span title="Null(null)" class="keyword">null</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>

      <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.scripts" title="Seq[play.api.db.evolutions.Script]">scripts</a>.<span title="(f: play.api.db.evolutions.Script =&gt; Boolean)Unit">foreach</span> <span class="delimiter">{</span> <a title="play.api.db.evolutions.Script" id="play.api.db.evolutions;DatabaseEvolutions.evolve.$anonfun.script">script</a> =&gt;
        <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.lastScript" title="play.api.db.evolutions.Script">lastScript</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.$anonfun.script" title="play.api.db.evolutions.Script">script</a>
        <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.applying" title="Int">applying</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.$anonfun.script" title="play.api.db.evolutions.Script">script</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Script.evolution" title="=&gt; play.api.db.evolutions.Evolution">evolution</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.revision" title="=&gt; Int">revision</a>
        <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logBefore" title="(script: play.api.db.evolutions.Script)(implicit conn: java.sql.Connection)Unit">logBefore</a><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.connection" title="java.sql.Connection" class="delimiter">(</a><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.$anonfun.script" title="play.api.db.evolutions.Script">script</a><span class="delimiter">)</span>
        <span class="comment">// Execute script</span>
        <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.$anonfun.script" title="play.api.db.evolutions.Script">script</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Script.statements" title="=&gt; Seq[String]">statements</a>.<span title="(f: String =&gt; Boolean)Unit">foreach</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.execute" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><span class="delimiter">)</span>
        <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.logAfter" title="(script: play.api.db.evolutions.Script)(implicit conn: java.sql.Connection)Boolean">logAfter</a><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.connection" title="java.sql.Connection" class="delimiter">(</a><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.$anonfun.script" title="play.api.db.evolutions.Script">script</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.autocommit" title="Boolean">autocommit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.connection" title="java.sql.Connection">connection</a>.<span title="()Unit">commit</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="play.api.db.evolutions;DatabaseEvolutions.evolve.e">e</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;DatabaseEvolutions.evolve.message">message</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.e" title="Throwable">e</a> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="java.sql.SQLException">ex</span>: <span title="java.sql.SQLException">SQLException</span> =&gt; <span title="java.sql.SQLException">ex</span>.<span title="()String">getMessage</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; [ERROR:&quot;)" class="string">&quot; [ERROR:&quot;</span> <span title="(x$1: Any)String">+</span> <span title="java.sql.SQLException">ex</span>.<span title="()Int">getErrorCode</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot;, SQLSTATE:&quot;)" class="string">&quot;, SQLSTATE:&quot;</span> <span title="(x$1: Any)String">+</span> <span title="java.sql.SQLException">ex</span>.<span title="()String">getSQLState</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot;]&quot;)" class="string">&quot;]&quot;</span>
          <span class="keyword">case</span> <span title="Throwable">ex</span> =&gt; <span title="Throwable">ex</span>.<span title="()String">getMessage</span>
        <span class="delimiter">}</span>
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.autocommit" title="Boolean">autocommit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#play.api.db.evolutions.DefaultEvolutionsApi.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../../../play/play/api/Logger.scala.html#play.api;LoggerLike.error(83d3728a3c)" title="(message: =&gt; String)Unit">error</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.message" title="String">message</a><span class="delimiter">)</span>

          <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.connection" title="java.sql.Connection">connection</a>.<span title="()Unit">rollback</span><span class="delimiter">(</span><span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;DatabaseEvolutions.evolve.humanScript">humanScript</a> = <span title="String(&quot;# --- Rev:&quot;)" class="string">&quot;# --- Rev:&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.lastScript" title="play.api.db.evolutions.Script">lastScript</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Script.evolution" title="=&gt; play.api.db.evolutions.Evolution">evolution</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.revision" title="=&gt; Int">revision</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span><span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.lastScript" title="play.api.db.evolutions.Script">lastScript</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="Evolutions.scala.html#play.api.db.evolutions;UpScript" title="play.api.db.evolutions.UpScript">UpScript</a><span class="delimiter">]</span><span class="delimiter">)</span> <span title="String(&quot;Ups&quot;)" class="string">&quot;Ups&quot;</span> <span class="keyword">else</span> <span title="String(&quot;Downs&quot;)" class="string">&quot;Downs&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; - &quot;)" class="string">&quot; - &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.lastScript" title="play.api.db.evolutions.Script">lastScript</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Script.evolution" title="=&gt; play.api.db.evolutions.Evolution">evolution</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.hash" title="=&gt; String">hash</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\n\n&quot;)" class="string">&quot;\n\n&quot;</span> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span><span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.lastScript" title="play.api.db.evolutions.Script">lastScript</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="Evolutions.scala.html#play.api.db.evolutions;UpScript" title="play.api.db.evolutions.UpScript">UpScript</a><span class="delimiter">]</span><span class="delimiter">)</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.lastScript" title="play.api.db.evolutions.Script">lastScript</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Script.evolution" title="=&gt; play.api.db.evolutions.Evolution">evolution</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.sql_up" title="=&gt; String">sql_up</a> <span class="keyword">else</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.lastScript" title="play.api.db.evolutions.Script">lastScript</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Script.evolution" title="=&gt; play.api.db.evolutions.Evolution">evolution</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.sql_down" title="=&gt; String">sql_down</a><span class="delimiter">)</span>

          <span title="Nothing" class="keyword">throw</span> <a href="#play.api.db.evolutions.InconsistentDatabase.readResolve" title="(db: String, script: String, error: String, rev: Int)play.api.db.evolutions.InconsistentDatabase">InconsistentDatabase</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.database" title="play.api.db.Database">database</a>.<a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database.name" title="=&gt; String">name</a>, <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.humanScript" title="String">humanScript</a>, <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.message" title="String">message</a>, <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.lastScript" title="play.api.db.evolutions.Script">lastScript</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Script.evolution" title="=&gt; play.api.db.evolutions.Evolution">evolution</a>.<a href="Evolutions.scala.html#play.api.db.evolutions;Evolution.revision" title="=&gt; Int">revision</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.updateLastProblem" title="(message: String, revision: Int)(implicit conn: java.sql.Connection)Boolean">updateLastProblem</a><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.connection" title="java.sql.Connection" class="delimiter">(</a><a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.message" title="String">message</a>, <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.applying" title="Int">applying</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#play.api.db.evolutions;DatabaseEvolutions.evolve.connection" title="java.sql.Connection">connection</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState" title="()Unit">checkEvolutionsState</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Checks the evolutions state in the database.
   *
   * @throws NonFatal error if the database is in an inconsistent state
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState">checkEvolutionsState</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="()(implicit conn: java.sql.Connection)Unit" id="play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.createPlayEvolutionsTable">createPlayEvolutionsTable</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="java.sql.Connection" id="play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.createPlayEvolutionsTable.conn">conn</a>: <span title="java.sql.Connection">Connection</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.createPlayEvolutionsTable.createScript">createScript</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.database" title="play.api.db.Database">database</a>.<a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database.url" title="=&gt; String">url</a> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="Evolutions.scala.html#play.api.db.evolutions.DatabaseUrlPatterns.SqlServerJdbcUrl" title="(target: Any)Option[List[String]]">SqlServerJdbcUrl</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#play.api.db.evolutions.DefaultEvolutionsApi.CreatePlayEvolutionsSqlServerSql" title="=&gt; String">CreatePlayEvolutionsSqlServerSql</a>
          <span class="keyword">case</span> <a href="Evolutions.scala.html#play.api.db.evolutions.DatabaseUrlPatterns.OracleJdbcUrl" title="(target: Any)Option[List[String]]">OracleJdbcUrl</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#play.api.db.evolutions.DefaultEvolutionsApi.CreatePlayEvolutionsOracleSql" title="=&gt; String">CreatePlayEvolutionsOracleSql</a>
          <span class="keyword">case</span> <a href="Evolutions.scala.html#play.api.db.evolutions.DatabaseUrlPatterns.MysqlJdbcUrl" title="(target: Any)Option[List[String]]">MysqlJdbcUrl</a><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="#play.api.db.evolutions.DefaultEvolutionsApi.CreatePlayEvolutionsMySql" title="=&gt; String">CreatePlayEvolutionsMySql</a>
          <span class="keyword">case</span> _ =&gt; <a href="#play.api.db.evolutions.DefaultEvolutionsApi.CreatePlayEvolutionsSql" title="=&gt; String">CreatePlayEvolutionsSql</a>
        <span class="delimiter">}</span>

        <a href="#play.api.db.evolutions;DatabaseEvolutions.execute" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.createPlayEvolutionsTable.conn" title="java.sql.Connection" class="delimiter">(</a><a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.createPlayEvolutionsTable.createScript" title="String">createScript</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.createPlayEvolutionsTable.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.createPlayEvolutionsTable.ex">ex</a><span class="delimiter">)</span> =&gt; <a href="#play.api.db.evolutions.DefaultEvolutionsApi.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../../../play/play/api/Logger.scala.html#play.api;LoggerLike.warn(804ef4765b)" title="(message: =&gt; String, error: =&gt; Throwable)Unit">warn</a><span class="delimiter">(</span><span title="String(&quot;could not create play_evolutions table&quot;)" class="string">&quot;could not create play_evolutions table&quot;</span>, <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.createPlayEvolutionsTable.ex" title="Throwable">ex</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="java.sql.Connection" id="play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.connection">connection</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.database" title="play.api.db.Database">database</a>.<a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database.getConnection(e18b5a337c)" title="(autocommit: Boolean)java.sql.Connection">getConnection</a><span class="delimiter">(</span>autocommit = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.sql.ResultSet" id="play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.problem">problem</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.executeQuery" title="(sql: String)(implicit c: java.sql.Connection)java.sql.ResultSet">executeQuery</a><a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.connection" title="java.sql.Connection" class="delimiter">(</a><span title="String(&quot;select id, hash, apply_script, revert_script, state, last_problem from play_evolutions where state like \'applying_%\'&quot;)" class="string">&quot;select id, hash, apply_script, revert_script, state, last_problem from play_evolutions where state like 'applying_%'&quot;</span><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.problem" title="java.sql.ResultSet">problem</a>.<span title="()Boolean">next</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Int" id="play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.revision">revision</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.problem" title="java.sql.ResultSet">problem</a>.<span title="(x$1: String)Int">getInt</span><span class="delimiter">(</span><span title="String(&quot;id&quot;)" class="string">&quot;id&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.state">state</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.problem" title="java.sql.ResultSet">problem</a>.<span title="(x$1: String)String">getString</span><span class="delimiter">(</span><span title="String(&quot;state&quot;)" class="string">&quot;state&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.hash">hash</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.problem" title="java.sql.ResultSet">problem</a>.<span title="(x$1: String)String">getString</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="delimiter">(</span><span title="String(&quot;hash&quot;)" class="string">&quot;hash&quot;</span><span class="delimiter">)</span>.<span title="(n: Int)String">take</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.script">script</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.state" title="String">state</a> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="String(&quot;applying_up&quot;)" class="string">&quot;applying_up&quot;</span> =&gt; <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.problem" title="java.sql.ResultSet">problem</a>.<span title="(x$1: String)String">getString</span><span class="delimiter">(</span><span title="String(&quot;apply_script&quot;)" class="string">&quot;apply_script&quot;</span><span class="delimiter">)</span>
          <span class="keyword">case</span> _ =&gt; <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.problem" title="java.sql.ResultSet">problem</a>.<span title="(x$1: String)String">getString</span><span class="delimiter">(</span><span title="String(&quot;revert_script&quot;)" class="string">&quot;revert_script&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.error">error</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.problem" title="java.sql.ResultSet">problem</a>.<span title="(x$1: String)String">getString</span><span class="delimiter">(</span><span title="String(&quot;last_problem&quot;)" class="string">&quot;last_problem&quot;</span><span class="delimiter">)</span>

        <a href="#play.api.db.evolutions.DefaultEvolutionsApi.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../../../play/play/api/Logger.scala.html#play.api;LoggerLike.error(83d3728a3c)" title="(message: =&gt; String)Unit">error</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.error" title="String">error</a><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.humanScript">humanScript</a> = <span title="String(&quot;# --- Rev:&quot;)" class="string">&quot;# --- Rev:&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.revision" title="Int">revision</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span><span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.state" title="String">state</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="String(&quot;applying_up&quot;)" class="string">&quot;applying_up&quot;</span><span class="delimiter">)</span> <span title="String(&quot;Ups&quot;)" class="string">&quot;Ups&quot;</span> <span class="keyword">else</span> <span title="String(&quot;Downs&quot;)" class="string">&quot;Downs&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; - &quot;)" class="string">&quot; - &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.hash" title="String">hash</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\n\n&quot;)" class="string">&quot;\n\n&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.script" title="String">script</a>

        <span title="Nothing" class="keyword">throw</span> <a href="#play.api.db.evolutions.InconsistentDatabase.readResolve" title="(db: String, script: String, error: String, rev: Int)play.api.db.evolutions.InconsistentDatabase">InconsistentDatabase</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.database" title="play.api.db.Database">database</a>.<a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database.name" title="=&gt; String">name</a>, <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.humanScript" title="String">humanScript</a>, <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.error" title="String">error</a>, <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.revision" title="Int">revision</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="play.api.db.evolutions.InconsistentDatabase" id="play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.e">e</a>: <a href="#play.api.db.evolutions.InconsistentDatabase.readResolve" title="play.api.db.evolutions.InconsistentDatabase">InconsistentDatabase</a> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.e" title="play.api.db.evolutions.InconsistentDatabase">e</a>
      <span class="keyword">case</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.createPlayEvolutionsTable" title="()(implicit conn: java.sql.Connection)Unit">createPlayEvolutionsTable</a><a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.connection" title="java.sql.Connection" class="delimiter">(</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#play.api.db.evolutions;DatabaseEvolutions.checkEvolutionsState.connection" title="java.sql.Connection">connection</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Seq[play.api.db.evolutions.Script]" id="play.api.db.evolutions;DatabaseEvolutions.resetScripts">resetScripts</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Seq[play.api.db.evolutions.Script]">Seq</span><span class="delimiter">[</span>Script<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;DatabaseEvolutions.resetScripts.appliedEvolutions">appliedEvolutions</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.databaseEvolutions" title="()Seq[play.api.db.evolutions.Evolution]">databaseEvolutions</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#play.api.db.evolutions;DatabaseEvolutions.resetScripts.appliedEvolutions" title="Seq[play.api.db.evolutions.Evolution]">appliedEvolutions</a>.<span title="(f: play.api.db.evolutions.Evolution =&gt; play.api.db.evolutions.DownScript)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[play.api.db.evolutions.Evolution],play.api.db.evolutions.DownScript,Seq[play.api.db.evolutions.Script]])Seq[play.api.db.evolutions.Script]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,play.api.db.evolutions.DownScript,Seq[play.api.db.evolutions.DownScript]]" class="delimiter">(</span><a href="Evolutions.scala.html#play.api.db.evolutions.DownScript" title="play.api.db.evolutions.DownScript.type">DownScript</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(revision: Int)Unit" id="play.api.db.evolutions;DatabaseEvolutions.resolve">resolve</a><span class="delimiter">(</span><a title="Int" id="play.api.db.evolutions;DatabaseEvolutions.resolve.revision">revision</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="java.sql.Connection" id="play.api.db.evolutions;DatabaseEvolutions.resolve.connection">connection</a> = <a href="#play.api.db.evolutions;DatabaseEvolutions.database" title="play.api.db.Database">database</a>.<a href="../../../../../play-jdbc-api/play/api/db/Database.scala.html#play.api.db;Database.getConnection(e18b5a337c)" title="(autocommit: Boolean)java.sql.Connection">getConnection</a><span class="delimiter">(</span>autocommit = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#play.api.db.evolutions;DatabaseEvolutions.execute" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#play.api.db.evolutions;DatabaseEvolutions.resolve.connection" title="java.sql.Connection" class="delimiter">(</a><span title="String(&quot;update play_evolutions set state = \'applied\' where state = \'applying_up\' and id = &quot;)" class="string">&quot;update play_evolutions set state = 'applied' where state = 'applying_up' and id = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.resolve.revision" title="Int">revision</a><span class="delimiter">)</span>
      <a href="#play.api.db.evolutions;DatabaseEvolutions.execute" title="(sql: String)(implicit c: java.sql.Connection)Boolean">execute</a><a href="#play.api.db.evolutions;DatabaseEvolutions.resolve.connection" title="java.sql.Connection" class="delimiter">(</a><span title="String(&quot;delete from play_evolutions where state = \'applying_down\' and id = &quot;)" class="string">&quot;delete from play_evolutions where state = 'applying_down' and id = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions;DatabaseEvolutions.resolve.revision" title="Int">revision</a><span class="delimiter">)</span>;
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#play.api.db.evolutions;DatabaseEvolutions.resolve.connection" title="java.sql.Connection">connection</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">// SQL helpers</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sql: String)(implicit c: java.sql.Connection)java.sql.ResultSet" id="play.api.db.evolutions;DatabaseEvolutions.executeQuery">executeQuery</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;DatabaseEvolutions.executeQuery.sql">sql</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="java.sql.Connection" id="play.api.db.evolutions;DatabaseEvolutions.executeQuery.c">c</a>: <span title="java.sql.Connection">Connection</span><span class="delimiter">)</span>: <span title="java.sql.ResultSet">ResultSet</span> = <span class="delimiter">{</span>
    <a href="#play.api.db.evolutions;DatabaseEvolutions.executeQuery.c" title="java.sql.Connection">c</a>.<span title="()java.sql.Statement">createStatement</span>.<span title="(x$1: String)java.sql.ResultSet">executeQuery</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.executeQuery.sql" title="String">sql</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sql: String)(implicit c: java.sql.Connection)Boolean" id="play.api.db.evolutions;DatabaseEvolutions.execute">execute</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;DatabaseEvolutions.execute.sql">sql</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="java.sql.Connection" id="play.api.db.evolutions;DatabaseEvolutions.execute.c">c</a>: <span title="java.sql.Connection">Connection</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <a href="#play.api.db.evolutions;DatabaseEvolutions.execute.c" title="java.sql.Connection">c</a>.<span title="()java.sql.Statement">createStatement</span>.<span title="(x$1: String)Boolean">execute</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.execute.sql" title="String">sql</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sql: String)(implicit c: java.sql.Connection)java.sql.PreparedStatement" id="play.api.db.evolutions;DatabaseEvolutions.prepare">prepare</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;DatabaseEvolutions.prepare.sql">sql</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="java.sql.Connection" id="play.api.db.evolutions;DatabaseEvolutions.prepare.c">c</a>: <span title="java.sql.Connection">Connection</span><span class="delimiter">)</span>: <span title="java.sql.PreparedStatement">PreparedStatement</span> = <span class="delimiter">{</span>
    <a href="#play.api.db.evolutions;DatabaseEvolutions.prepare.c" title="java.sql.Connection">c</a>.<span title="(x$1: String)java.sql.PreparedStatement">prepareStatement</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;DatabaseEvolutions.prepare.sql" title="String">sql</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span title="AnyRef" class="keyword">private</span> <span class="keyword">object</span> <a title="play.api.db.evolutions.DefaultEvolutionsApi.type" id="play.api.db.evolutions.DefaultEvolutionsApi">DefaultEvolutionsApi</a> <a href="#play.api.db.evolutions.DefaultEvolutionsApi" title="play.api.db.evolutions.DefaultEvolutionsApi.type" class="delimiter">{</a>

  <span class="keyword">val</span> <a title="play.api.Logger" id="play.api.db.evolutions.DefaultEvolutionsApi.logger">logger</a> = <a href="../../../../../play/play/api/Logger.scala.html#play.api.Logger.apply(1f619881c1)" title="(clazz: Class[play.api.db.evolutions.DefaultEvolutionsApi])play.api.Logger">Logger</a><span class="delimiter">(</span>classOf<span title="Class[play.api.db.evolutions.DefaultEvolutionsApi](classOf[play.api.db.evolutions.DefaultEvolutionsApi])" class="delimiter">[</span>DefaultEvolutionsApi<span class="delimiter">]</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions.DefaultEvolutionsApi.CreatePlayEvolutionsSql">CreatePlayEvolutionsSql</a> =
    <span title="String(&quot;\n      create table play_evolutions (\n          id int not null primary key,\n          hash varchar(255) not null,\n          applied_at timestamp not null,\n          apply_script text,\n          revert_script text,\n          state varchar(255),\n          last_problem text\n      )\n    &quot;)" class="string">&quot;&quot;&quot;
      create table play_evolutions (
          id int not null primary key,
          hash varchar(255) not null,
          applied_at timestamp not null,
          apply_script text,
          revert_script text,
          state varchar(255),
          last_problem text
      )
    &quot;&quot;&quot;</span>

  <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions.DefaultEvolutionsApi.CreatePlayEvolutionsSqlServerSql">CreatePlayEvolutionsSqlServerSql</a> =
    <span title="String(&quot;\n      create table play_evolutions (\n          id int not null primary key,\n          hash varchar(255) not null,\n          applied_at datetime not null,\n          apply_script text,\n          revert_script text,\n          state varchar(255),\n          last_problem text\n      )\n    &quot;)" class="string">&quot;&quot;&quot;
      create table play_evolutions (
          id int not null primary key,
          hash varchar(255) not null,
          applied_at datetime not null,
          apply_script text,
          revert_script text,
          state varchar(255),
          last_problem text
      )
    &quot;&quot;&quot;</span>

  <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions.DefaultEvolutionsApi.CreatePlayEvolutionsOracleSql">CreatePlayEvolutionsOracleSql</a> =
    <span title="String(&quot;\n      CREATE TABLE play_evolutions (\n          id Number(10,0) Not Null Enable,\n          hash VARCHAR2(255 Byte),\n          applied_at Timestamp Not Null,\n          apply_script clob,\n          revert_script clob,\n          state Varchar2(255),\n          last_problem clob,\n          CONSTRAINT play_evolutions_pk PRIMARY KEY (id)\n      )\n    &quot;)" class="string">&quot;&quot;&quot;
      CREATE TABLE play_evolutions (
          id Number(10,0) Not Null Enable,
          hash VARCHAR2(255 Byte),
          applied_at Timestamp Not Null,
          apply_script clob,
          revert_script clob,
          state Varchar2(255),
          last_problem clob,
          CONSTRAINT play_evolutions_pk PRIMARY KEY (id)
      )
    &quot;&quot;&quot;</span>

  <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions.DefaultEvolutionsApi.CreatePlayEvolutionsMySql">CreatePlayEvolutionsMySql</a> =
    <span title="String(&quot;\n      CREATE TABLE play_evolutions (\n          id int not null primary key,\n          hash varchar(255) not null,\n          applied_at timestamp not null,\n          apply_script mediumtext,\n          revert_script mediumtext,\n          state varchar(255),\n          last_problem mediumtext\n      )\n    &quot;)" class="string">&quot;&quot;&quot;
      CREATE TABLE play_evolutions (
          id int not null primary key,
          hash varchar(255) not null,
          applied_at timestamp not null,
          apply_script mediumtext,
          revert_script mediumtext,
          state varchar(255),
          last_problem mediumtext
      )
    &quot;&quot;&quot;</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Reader for evolutions
 */</span>
<span title="AnyRef" class="keyword">trait</span> <a title="trait EvolutionsReader extends AnyRef" id="play.api.db.evolutions;EvolutionsReader">EvolutionsReader</a> <span class="delimiter">{</span>
  <span class="comment">/**
   * Read the evolutions for the given db
   */</span>
  <span class="keyword">def</span> <a title="(db: String)Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;EvolutionsReader.evolutions">evolutions</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;EvolutionsReader.evolutions.db">db</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Seq[play.api.db.evolutions.Evolution]">Seq</span><span class="delimiter">[</span>Evolution<span class="delimiter">]</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Evolutions reader that reads evolutions from resources, for example, the file system or the classpath
 */</span>
<span title="AnyRef" class="keyword">abstract</span> <span class="keyword">class</span> <a title="class ResourceEvolutionsReader extends AnyRef with play.api.db.evolutions.EvolutionsReader" id="play.api.db.evolutions;ResourceEvolutionsReader">ResourceEvolutionsReader</a> <a href="#play.api.db.evolutions;ResourceEvolutionsReader" title="play.api.db.evolutions.ResourceEvolutionsReader" class="keyword">extends</a> <a href="#play.api.db.evolutions;EvolutionsReader" title="play.api.db.evolutions.EvolutionsReader">EvolutionsReader</a> <span class="delimiter">{</span>

  <span class="comment">/**
   * Load the evolutions resource for the given database and revision.
   *
   * @return An InputStream to consume the resource, if such a resource exists.
   */</span>
  <span class="keyword">def</span> <a title="(db: String, revision: Int)Option[java.io.InputStream]" id="play.api.db.evolutions;ResourceEvolutionsReader.loadResource">loadResource</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;ResourceEvolutionsReader.loadResource.db">db</a>: <span title="String">String</span>, <a title="Int" id="play.api.db.evolutions;ResourceEvolutionsReader.loadResource.revision">revision</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Option[java.io.InputStream]">Option</span><span class="delimiter">[</span>InputStream<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="(db: String)Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions">evolutions</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.db">db</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Seq[play.api.db.evolutions.Evolution]">Seq</span><span class="delimiter">[</span>Evolution<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.upsMarker">upsMarker</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;^#.*!Ups.*$&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
    <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.downsMarker">downsMarker</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;^#.*!Downs.*$&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>

    <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.UPS">UPS</a> = <span title="String(&quot;UPS&quot;)" class="string">&quot;UPS&quot;</span>
    <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.DOWNS">DOWNS</a> = <span title="String(&quot;DOWNS&quot;)" class="string">&quot;DOWNS&quot;</span>
    <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.UNKNOWN">UNKNOWN</a> = <span title="String(&quot;UNKNOWN&quot;)" class="string">&quot;UNKNOWN&quot;</span>

    <span class="keyword">val</span> <a title="PartialFunction[String,String]" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.mapUpsAndDowns">mapUpsAndDowns</a>: <span title="PartialFunction[String,String]">PartialFunction</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[String,String] with Serializable" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.mapUpsAndDowns;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.upsMarker" title="(target: Any)Option[List[String]]">upsMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.UPS" title="String">UPS</a>
      <span class="keyword">case</span> <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.downsMarker" title="(target: Any)Option[List[String]]">downsMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.DOWNS" title="String">DOWNS</a>
      <span class="keyword">case</span> _ =&gt; <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.UNKNOWN" title="String">UNKNOWN</a>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="PartialFunction[String,Boolean]" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.isMarker">isMarker</a>: <span title="PartialFunction[String,Boolean]">PartialFunction</span><span class="delimiter">[</span>String, Boolean<span class="delimiter">]</span> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[String,Boolean] with Serializable" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.isMarker;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.upsMarker" title="(target: Any)Option[List[String]]">upsMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
      <span class="keyword">case</span> <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.downsMarker" title="(target: Any)Option[List[String]]">downsMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
      <span class="keyword">case</span> _ =&gt; <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>

    <a href="../../../../../play/play/api/libs/Collections.scala.html#play.api.libs.Collections" title="play.api.libs.Collections.type">Collections</a>.<a href="../../../../../play/play/api/libs/Collections.scala.html#play.api.libs.Collections.unfoldLeft" title="(seed: Int)(f: Int =&gt; Option[(Int, (Int, String))])Seq[(Int, String)]">unfoldLeft</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span title="Int">revision</span> =&gt;
      <a href="#play.api.db.evolutions;ResourceEvolutionsReader.loadResource" title="(db: String, revision: Int)Option[java.io.InputStream]">loadResource</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.db" title="String">db</a>, <span title="Int">revision</span><span class="delimiter">)</span>.<span title="(f: java.io.InputStream =&gt; (Int, (Int, String)))Option[(Int, (Int, String))]">map</span> <span class="delimiter">{</span> <a title="java.io.InputStream" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.$anonfun.stream">stream</a> =&gt;
        <span title="(_1: Int, _2: (Int, String))(Int, (Int, String))" class="delimiter">(</span><span title="Int">revision</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <span title="(_1: Int, _2: String)(Int, String)" class="delimiter">(</span><span title="Int">revision</span>, <a href="../../../../../play/play/utils/PlayIO.scala.html#play.utils.PlayIO" title="play.utils.PlayIO.type">PlayIO</a>.<a href="../../../../../play/play/utils/PlayIO.scala.html#play.utils.PlayIO.readStreamAsString" title="(stream: java.io.InputStream)(implicit codec: scala.io.Codec)String">readStreamAsString</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.$anonfun.stream" title="java.io.InputStream">stream</a><span class="delimiter">)</span><span class="delimiter">(</span><span title="scala.io.Codec.type">Codec</span>.<span title="=&gt; scala.io.Codec">UTF8</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>.<span title="(f: ((Int, String)) =&gt; Int)(implicit ord: scala.math.Ordering[Int])Seq[(Int, String)]">sortBy</span><span title="scala.math.Ordering.Int.type" class="delimiter">(</span><a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.x$6" title="(Int, String)">_</a>.<span title="=&gt; Int">_1</span><span class="delimiter">)</span>.<span title="(f: ((Int, String)) =&gt; play.api.db.evolutions.Evolution)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Int, String)],play.api.db.evolutions.Evolution,Seq[play.api.db.evolutions.Evolution]])Seq[play.api.db.evolutions.Evolution]">map</span> <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.x0$1" title="play.api.db.evolutions.Evolution" class="delimiter">{</a>
      <span class="keyword">case</span> <span class="delimiter">(</span><span title="Int">revision</span>, <a title="String" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.script">script</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>

        <span class="keyword">val</span> <a title="scala.collection.immutable.Map[String,String]" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed">parsed</a> = <a href="../../../../../play/play/api/libs/Collections.scala.html#play.api.libs.Collections" title="play.api.libs.Collections.type">Collections</a>.<a href="../../../../../play/play/api/libs/Collections.scala.html#play.api.libs.Collections.unfoldLeft" title="(seed: (String, List[String]))(f: ((String, List[String])) =&gt; Option[((String, List[String]), (String, String))])Seq[(String, String)]">unfoldLeft</a><span class="delimiter">(</span><span title="(_1: String, _2: List[String])(String, List[String])" class="delimiter">(</span><span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.script" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">script</a>.<span title="(separator: Char)Array[String]">split</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><span title="Char('\n')" class="char">'\n'</span><span class="delimiter">)</span>.<span title="=&gt; List[String]">toList</span>.<span title="(f: String =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],String,List[String]])List[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.x$7" title="String">_</a>.<span title="()String">trim</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.x0$2" title="Option[((String, List[String]), (String, String))]" class="delimiter">{</a>
          <span class="keyword">case</span> <span class="delimiter">(</span>_, <span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span> =&gt; <span title="None.type">None</span>
          <span class="keyword">case</span> <span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.context">context</a>, <a title="List[String]" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.lines">lines</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <span class="keyword">val</span> <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.some" title="(List[String], List[String])" class="delimiter">(</a><a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.x$8" title="List[String]" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.some">some</a>, <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.x$8" title="List[String]" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.next">next</a><span class="delimiter">)</span> = <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.lines" title="List[String]">lines</a>.<span title="(p: String =&gt; Boolean)(List[String], List[String])">span</span><span title="(List[String], List[String]) @unchecked" class="delimiter">(</span><a title="String" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.x$8.$anonfun.l">l</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.isMarker" title="(v1: String)Boolean">isMarker</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.x$8.$anonfun.l" title="String">l</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span title="(x: ((String, List[String]), (String, String)))Some[((String, List[String]), (String, String))]">Some</span><span class="delimiter">(</span><span title="(_1: (String, List[String]), _2: (String, String))((String, List[String]), (String, String))" class="delimiter">(</span><a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.next" title="List[String]">next</a>.<span title="=&gt; Option[String]">headOption</span>.<span title="(f: String =&gt; (String, List[String]))Option[(String, List[String])]">map</span><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.$anonfun.c">c</a> =&gt; <span title="(_1: String, _2: List[String])(String, List[String])" class="delimiter">(</span><a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.mapUpsAndDowns" title="(v1: String)String">mapUpsAndDowns</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.$anonfun.c" title="String">c</a><span class="delimiter">)</span>, <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.next" title="List[String]">next</a>.<span title="=&gt; List[String]">tail</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; (String, List[String]))(String, List[String])">getOrElse</span><span class="delimiter">(</span><span title="(x: String)ArrowAssoc[String]" class="string">&quot;&quot;</span> <span title="(y: scala.collection.immutable.Nil.type)(String, scala.collection.immutable.Nil.type)">-&gt;</span> <span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span>,
              <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.context" title="(x: String)ArrowAssoc[String]">context</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.some" title="List[String]">some</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>.<span title="=&gt; Seq[(String, String)]">reverse</span>.<span title="(n: Int)Seq[(String, String)]">drop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(f: ((String, String)) =&gt; String)scala.collection.immutable.Map[String,Seq[(String, String)]]">groupBy</span><span class="delimiter">(</span><a title="(String, String)" id="play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.i">i</a> =&gt; <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.i" title="(String, String)">i</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span>.<span title="(f: Seq[(String, String)] =&gt; String)scala.collection.immutable.Map[String,String]">mapValues</span> <span class="delimiter">{</span> <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.x$9" title="Seq[(String, String)]">_</a>.<span title="(f: ((String, String)) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(String, String)],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed.$anonfun.$anonfun.x$10" title="(String, String)">_</a>.<span title="=&gt; String">_2</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>.<span title="()String">trim</span> <span class="delimiter">}</span>

        <a href="Evolutions.scala.html#play.api.db.evolutions;Evolution" title="(revision: Int, sql_up: String, sql_down: String)play.api.db.evolutions.Evolution">Evolution</a><span class="delimiter">(</span>
          <span title="Int">revision</span>,
          <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed" title="scala.collection.immutable.Map[String,String]">parsed</a>.<span title="(key: String, default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.UPS" title="String">UPS</a>, <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>,
          <a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.$anonfun.parsed" title="scala.collection.immutable.Map[String,String]">parsed</a>.<span title="(key: String, default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;ResourceEvolutionsReader.evolutions.DOWNS" title="String">DOWNS</a>, <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Read evolution files from the application environment.
 */</span>
@Singleton
<span class="keyword">class</span> <a title="class EnvironmentEvolutionsReader extends play.api.db.evolutions.ResourceEvolutionsReader" id="play.api.db.evolutions;EnvironmentEvolutionsReader">EnvironmentEvolutionsReader</a> @Inject<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">(</span><a title="play.api.Environment" id="play.api.db.evolutions;EnvironmentEvolutionsReader.environment">environment</a>: <a href="../../../../../play/play/api/Environment.scala.html#play.api;Environment" title="play.api.Environment">Environment</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#play.api.db.evolutions;ResourceEvolutionsReader" title="play.api.db.evolutions.ResourceEvolutionsReader">ResourceEvolutionsReader</a> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(db: String, revision: Int)Option[java.io.InputStream]" id="play.api.db.evolutions;EnvironmentEvolutionsReader.loadResource">loadResource</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;EnvironmentEvolutionsReader.loadResource.db">db</a>: <span title="String">String</span>, <a title="Int" id="play.api.db.evolutions;EnvironmentEvolutionsReader.loadResource.revision">revision</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#play.api.db.evolutions;EnvironmentEvolutionsReader.environment" title="play.api.Environment">environment</a>.<a href="../../../../../play/play/api/Environment.scala.html#play.api;Environment.getExistingFile" title="(relativePath: String)Option[java.io.File]">getExistingFile</a><span class="delimiter">(</span><a href="Evolutions.scala.html#play.api.db.evolutions.Evolutions" title="play.api.db.evolutions.Evolutions.type">Evolutions</a>.<a href="Evolutions.scala.html#play.api.db.evolutions.Evolutions.fileName" title="(db: String, revision: Int)String">fileName</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;EnvironmentEvolutionsReader.loadResource.db" title="String">db</a>, <a href="#play.api.db.evolutions;EnvironmentEvolutionsReader.loadResource.revision" title="Int">revision</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: java.io.File =&gt; java.io.FileInputStream)Option[java.io.FileInputStream]">map</span><span class="delimiter">(</span><span title="(x$1: java.io.File)java.io.FileInputStream" class="keyword">new</span> <span title="java.io.FileInputStream">FileInputStream</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;EnvironmentEvolutionsReader.loadResource.$anonfun.x$11" title="java.io.File">_</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(alternative: =&gt; Option[java.io.InputStream])Option[java.io.InputStream]">orElse</span> <span class="delimiter">{</span>
      <a href="#play.api.db.evolutions;EnvironmentEvolutionsReader.environment" title="play.api.Environment">environment</a>.<a href="../../../../../play/play/api/Environment.scala.html#play.api;Environment.resourceAsStream" title="(name: String)Option[java.io.InputStream]">resourceAsStream</a><span class="delimiter">(</span><a href="Evolutions.scala.html#play.api.db.evolutions.Evolutions" title="play.api.db.evolutions.Evolutions.type">Evolutions</a>.<a href="Evolutions.scala.html#play.api.db.evolutions.Evolutions.resourceName" title="(db: String, revision: Int)String">resourceName</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;EnvironmentEvolutionsReader.loadResource.db" title="String">db</a>, <a href="#play.api.db.evolutions;EnvironmentEvolutionsReader.loadResource.revision" title="Int">revision</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Evolutions reader that reads evolution files from a class loader.
 *
 * @param classLoader The classloader to read from, defaults to the classloader for this class.
 * @param prefix A prefix that gets added to the resource file names, for example, this could be used to namespace
 *               evolutions in different environments to work with different databases.
 */</span>
<span class="keyword">class</span> <a title="class ClassLoaderEvolutionsReader extends play.api.db.evolutions.ResourceEvolutionsReader" id="play.api.db.evolutions;ClassLoaderEvolutionsReader">ClassLoaderEvolutionsReader</a><a href="#play.api.db.evolutions;ClassLoaderEvolutionsReader" title="play.api.db.evolutions.ClassLoaderEvolutionsReader" class="delimiter">(</a><a title="ClassLoader" id="play.api.db.evolutions.ClassLoaderEvolutionsReader.<init>$default$1">classLoader</a>: <span title="ClassLoader">ClassLoader</span> = classOf<span title="Class[play.api.db.evolutions.ClassLoaderEvolutionsReader](classOf[play.api.db.evolutions.ClassLoaderEvolutionsReader])" class="delimiter">[</span>ClassLoaderEvolutionsReader<span class="delimiter">]</span>.<span title="()ClassLoader">getClassLoader</span>,
    <a title="String" id="play.api.db.evolutions.ClassLoaderEvolutionsReader.<init>$default$2">prefix</a>: <span title="String">String</span> = <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#play.api.db.evolutions;ResourceEvolutionsReader" title="play.api.db.evolutions.ResourceEvolutionsReader">ResourceEvolutionsReader</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(db: String, revision: Int)Option[java.io.InputStream]" id="play.api.db.evolutions;ClassLoaderEvolutionsReader.loadResource">loadResource</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;ClassLoaderEvolutionsReader.loadResource.db">db</a>: <span title="String">String</span>, <a title="Int" id="play.api.db.evolutions;ClassLoaderEvolutionsReader.loadResource.revision">revision</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span title="(x: java.io.InputStream)Option[java.io.InputStream]">Option</span><span class="delimiter">(</span><a href="#play.api.db.evolutions.ClassLoaderEvolutionsReader.<init>$default$1" title="ClassLoader">classLoader</a>.<span title="(x$1: String)java.io.InputStream">getResourceAsStream</span><span class="delimiter">(</span><a href="#play.api.db.evolutions.ClassLoaderEvolutionsReader.<init>$default$2" title="String">prefix</a> <span title="(x$1: Any)String">+</span> <a href="Evolutions.scala.html#play.api.db.evolutions.Evolutions" title="play.api.db.evolutions.Evolutions.type">Evolutions</a>.<a href="Evolutions.scala.html#play.api.db.evolutions.Evolutions.resourceName" title="(db: String, revision: Int)String">resourceName</a><span class="delimiter">(</span><a href="#play.api.db.evolutions;ClassLoaderEvolutionsReader.loadResource.db" title="String">db</a>, <a href="#play.api.db.evolutions;ClassLoaderEvolutionsReader.loadResource.revision" title="Int">revision</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Evolutions reader that reads evolution files from a class loader.
 */</span>
<span class="keyword">object</span> <a title="play.api.db.evolutions.ClassLoaderEvolutionsReader.type" id="play.api.db.evolutions.ClassLoaderEvolutionsReader">ClassLoaderEvolutionsReader</a> <a href="#play.api.db.evolutions.ClassLoaderEvolutionsReader" title="play.api.db.evolutions.ClassLoaderEvolutionsReader.type" class="delimiter">{</a>
  <span class="comment">/**
   * Create a class loader evolutions reader for the given prefix.
   */</span>
  <span class="keyword">def</span> <a title="(prefix: String)play.api.db.evolutions.ClassLoaderEvolutionsReader" id="play.api.db.evolutions.ClassLoaderEvolutionsReader.forPrefix">forPrefix</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions.ClassLoaderEvolutionsReader.forPrefix.prefix">prefix</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#play.api.db.evolutions.ClassLoaderEvolutionsReader.<init>$default$1" title="ClassLoader" id="play.api.db.evolutions.ClassLoaderEvolutionsReader.forPrefix.x$13" class="keyword">new</a> <a href="#play.api.db.evolutions.ClassLoaderEvolutionsReader" title="play.api.db.evolutions.ClassLoaderEvolutionsReader.type">ClassLoaderEvolutionsReader</a><span class="delimiter">(</span>prefix = <a href="#play.api.db.evolutions.ClassLoaderEvolutionsReader.forPrefix.prefix" title="String" id="play.api.db.evolutions.ClassLoaderEvolutionsReader.forPrefix.x$12">prefix</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Evolutions reader that reads evolution files from its own classloader.  Only suitable for simple (flat) classloading
 * environments.
 */</span>
<span title="AnyRef" class="keyword">object</span> <a title="play.api.db.evolutions.ThisClassLoaderEvolutionsReader.type" id="play.api.db.evolutions.ThisClassLoaderEvolutionsReader">ThisClassLoaderEvolutionsReader</a> <a href="#play.api.db.evolutions.ThisClassLoaderEvolutionsReader" title="play.api.db.evolutions.ThisClassLoaderEvolutionsReader.type" class="keyword">extends</a> <a href="#play.api.db.evolutions;ClassLoaderEvolutionsReader" title="play.api.db.evolutions.ClassLoaderEvolutionsReader">ClassLoaderEvolutionsReader</a><span class="delimiter">(</span>classOf<span title="Class[play.api.db.evolutions.ClassLoaderEvolutionsReader](classOf[play.api.db.evolutions.ClassLoaderEvolutionsReader])" class="delimiter">[</span>ClassLoaderEvolutionsReader<span class="delimiter">]</span>.<span title="()ClassLoader">getClassLoader</span><span class="delimiter">)</span>

<span class="comment">/**
 * Simple map based implementation of the evolutions reader.
 */</span>
<span class="keyword">class</span> <a title="class SimpleEvolutionsReader extends AnyRef with play.api.db.evolutions.EvolutionsReader" id="play.api.db.evolutions;SimpleEvolutionsReader">SimpleEvolutionsReader</a><a href="#play.api.db.evolutions;SimpleEvolutionsReader" title="play.api.db.evolutions.SimpleEvolutionsReader" class="delimiter">(</a><a title="Map[String,Seq[play.api.db.evolutions.Evolution]]" id="play.api.db.evolutions;SimpleEvolutionsReader.evolutionsMap">evolutionsMap</a>: <span title="Map[String,Seq[play.api.db.evolutions.Evolution]]">Map</span><span class="delimiter">[</span>String, Seq<span class="delimiter">[</span>Evolution<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#play.api.db.evolutions;EvolutionsReader" title="play.api.db.evolutions.EvolutionsReader">EvolutionsReader</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(db: String)Seq[play.api.db.evolutions.Evolution]" id="play.api.db.evolutions;SimpleEvolutionsReader.evolutions">evolutions</a><span class="delimiter">(</span><a title="String" id="play.api.db.evolutions;SimpleEvolutionsReader.evolutions.db">db</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#play.api.db.evolutions;SimpleEvolutionsReader.evolutionsMap" title="Map[String,Seq[play.api.db.evolutions.Evolution]]">evolutionsMap</a>.<span title="(key: String, default: =&gt; Seq[play.api.db.evolutions.Evolution])Seq[play.api.db.evolutions.Evolution]">getOrElse</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;SimpleEvolutionsReader.evolutions.db" title="String">db</a>, <span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Simple map based implementation of the evolutions reader.
 */</span>
<span class="keyword">object</span> <a title="play.api.db.evolutions.SimpleEvolutionsReader.type" id="play.api.db.evolutions.SimpleEvolutionsReader">SimpleEvolutionsReader</a> <a href="#play.api.db.evolutions.SimpleEvolutionsReader" title="play.api.db.evolutions.SimpleEvolutionsReader.type" class="delimiter">{</a>
  <span class="comment">/**
   * Create a simple evolutions reader from the given data.
   *
   * @param data A map of database name to a sequence of evolutions.
   */</span>
  <span class="keyword">def</span> <a title="(data: (String, Seq[play.api.db.evolutions.Evolution])*)play.api.db.evolutions.SimpleEvolutionsReader" id="play.api.db.evolutions.SimpleEvolutionsReader.from">from</a><span class="delimiter">(</span><a title="(String, Seq[play.api.db.evolutions.Evolution])*" id="play.api.db.evolutions.SimpleEvolutionsReader.from.data">data</a>: <span title="(String, Seq[play.api.db.evolutions.Evolution])*" class="delimiter">(</span>String, Seq<span class="delimiter">[</span>Evolution<span class="delimiter">]</span><span class="delimiter">)</span>*<span class="delimiter">)</span> = <span title="play.api.db.evolutions.SimpleEvolutionsReader" class="keyword">new</span> <a href="#play.api.db.evolutions;SimpleEvolutionsReader" title="play.api.db.evolutions.SimpleEvolutionsReader">SimpleEvolutionsReader</a><span class="delimiter">(</span><a href="#play.api.db.evolutions.SimpleEvolutionsReader.from.data" title="(String, Seq[play.api.db.evolutions.Evolution])*">data</a>.<span title="(implicit ev: &lt;:&lt;[(String, Seq[play.api.db.evolutions.Evolution]),(String, Seq[play.api.db.evolutions.Evolution])])scala.collection.immutable.Map[String,Seq[play.api.db.evolutions.Evolution]]">toMap</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Create a simple evolutions reader from the given evolutions for the default database.
   *
   * @param evolutions The evolutions.
   */</span>
  <span class="keyword">def</span> <a title="(evolutions: play.api.db.evolutions.Evolution*)play.api.db.evolutions.SimpleEvolutionsReader" id="play.api.db.evolutions.SimpleEvolutionsReader.forDefault">forDefault</a><span class="delimiter">(</span><a title="play.api.db.evolutions.Evolution*" id="play.api.db.evolutions.SimpleEvolutionsReader.forDefault.evolutions">evolutions</a>: <span title="play.api.db.evolutions.Evolution*">Evolution</span>*<span class="delimiter">)</span> = <span title="play.api.db.evolutions.SimpleEvolutionsReader" class="keyword">new</span> <a href="#play.api.db.evolutions;SimpleEvolutionsReader" title="play.api.db.evolutions.SimpleEvolutionsReader">SimpleEvolutionsReader</a><span class="delimiter">(</span><span title="(elems: (String, Seq[play.api.db.evolutions.Evolution])*)scala.collection.immutable.Map[String,Seq[play.api.db.evolutions.Evolution]]">Map</span><span class="delimiter">(</span><span title="(x: String)ArrowAssoc[String]" class="string">&quot;default&quot;</span> <span title="(y: Seq[play.api.db.evolutions.Evolution])(String, Seq[play.api.db.evolutions.Evolution])">-&gt;</span> <a href="#play.api.db.evolutions.SimpleEvolutionsReader.forDefault.evolutions" title="play.api.db.evolutions.Evolution*">evolutions</a><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Exception thrown when the database is in an inconsistent state.
 *
 * @param db the database name
 * @param script the evolution script
 * @param error an inconsistent state error
 * @param rev the revision
 */</span>
<span title="AnyRef" class="keyword">case class</span> <a title="class InconsistentDatabase extends play.api.PlayException.RichDescription with Product with Serializable" id="play.api.db.evolutions.InconsistentDatabase.readResolve">InconsistentDatabase</a><a href="../../../../../play-exceptions/play/api/PlayException.java.html#play.api.PlayException;RichDescription.<init>(12aa1e1a0c)" title="Product" class="delimiter">(</a><a title="String" id="play.api.db.evolutions;InconsistentDatabase.db">db</a>: <span title="String">String</span>, <a title="String" id="play.api.db.evolutions;InconsistentDatabase.script">script</a>: <span title="String">String</span>, <a title="String" id="play.api.db.evolutions;InconsistentDatabase.error">error</a>: <span title="String">String</span>, <a title="Int" id="play.api.db.evolutions;InconsistentDatabase.rev">rev</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../../play-exceptions/play/api/PlayException.java.html#play.api.PlayException" title="play.api.PlayException.type">PlayException</a>.<a href="../../../../../play-exceptions/play/api/PlayException.java.html#play.api.PlayException;RichDescription" title="play.api.PlayException.RichDescription">RichDescription</a><span class="delimiter">(</span>
  <span title="String(&quot;Database \'&quot;)" class="string">&quot;Database '&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions;InconsistentDatabase.db" title="String">db</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\' is in an inconsistent state!&quot;)" class="string">&quot;' is in an inconsistent state!&quot;</span>,
  <span title="String(&quot;An evolution has not been applied properly. Please check the problem and resolve it manually before marking it as resolved.&quot;)" class="string">&quot;An evolution has not been applied properly. Please check the problem and resolve it manually before marking it as resolved.&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="()String" id="play.api.db.evolutions;InconsistentDatabase.subTitle">subTitle</a> = <span title="String(&quot;We got the following error: &quot;)" class="string">&quot;We got the following error: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.db.evolutions;InconsistentDatabase.error" title="=&gt; String">error</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;, while trying to run this SQL script:&quot;)" class="string">&quot;, while trying to run this SQL script:&quot;</span>
  <span class="keyword">def</span> <a title="()String" id="play.api.db.evolutions;InconsistentDatabase.content">content</a> = <a href="#play.api.db.evolutions;InconsistentDatabase.script" title="=&gt; String">script</a>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="String" id="play.api.db.evolutions;InconsistentDatabase.javascript">javascript</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;
        document.location = '/@evolutions/resolve/%s/%s?redirect=' + encodeURIComponent(location)
    &quot;&quot;&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#play.api.db.evolutions;InconsistentDatabase.db" title="=&gt; String">db</a>, <a href="#play.api.db.evolutions;InconsistentDatabase.rev" title="=&gt; Int">rev</a><span class="delimiter">)</span>.<span title="()String">trim</span>

  <span class="keyword">def</span> <a title="()String" id="play.api.db.evolutions;InconsistentDatabase.htmlDescription">htmlDescription</a>: <span title="String">String</span> = <span class="delimiter">{</span>

    <span class="delimiter">&lt;span&gt;An evolution has not been applied properly. Please check the problem and resolve it manually before marking it as resolved -&lt;/span&gt;
    &lt;input name=&quot;evolution-button&quot; type=&quot;button&quot; value=&quot;Mark it resolved&quot; onclick={</span> <a href="#play.api.db.evolutions;InconsistentDatabase.javascript" title="=&gt; String">javascript</a> }/&gt;

  <span class="delimiter">}</span>.<span title="=&gt; String">mkString</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
