<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>play-netty-server/play/core/server/netty/WebSocketHandler.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> play.core.server.netty

<span class="keyword">import</span> scala.<span title="language.type">language</span>.reflectiveCalls

<span class="keyword">import</span> org.jboss.netty.channel._
<span class="keyword">import</span> org.jboss.netty.handler.codec.http._
<span class="keyword">import</span> org.jboss.netty.handler.codec.http.websocketx._
<span class="keyword">import</span> play.core._
<span class="keyword">import</span> play.core.websocket._
<span class="keyword">import</span> play.core.server.websocket.WebSocketHandshake
<span class="keyword">import</span> play.api._
<span class="keyword">import</span> play.api.mvc.<a href="../../../../../play/play/api/mvc/WebSocket.scala.html#play.api.mvc.WebSocket" title="play.api.mvc.WebSocket.type">WebSocket</a>.FrameFormatter
<span class="keyword">import</span> play.api.libs.iteratee._
<span class="keyword">import</span> play.api.libs.iteratee.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Input" title="play.api.libs.iteratee.Input.type">Input</a>._
<span class="keyword">import</span> scala.concurrent.<span class="delimiter">{</span> Future, Promise <span class="delimiter">}</span>
<span class="keyword">import</span> scala.concurrent.stm._

<span class="keyword">import</span> play.core.<a href="../../../../../play/play/core/system/Execution.scala.html#play.core.Execution" title="play.core.Execution.type">Execution</a>.<a href="../../../../../play/play/core/system/Execution.scala.html#play.core.Execution.Implicits" title="play.core.Execution.Implicits.type">Implicits</a>.internalContext
<span class="keyword">import</span> org.jboss.netty.buffer.<span class="delimiter">{</span> ChannelBuffers, ChannelBuffer <span class="delimiter">}</span>
<span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger

<span class="keyword">private</span><span class="delimiter">[</span>server<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait WebSocketHandler extends AnyRef" id="play.core.server.netty;WebSocketHandler">WebSocketHandler</a> <span title="Unit" class="delimiter">{</span>

  <span class="keyword">import</span> <a href="NettyFuture.scala.html#play.core.server.netty.NettyFuture" title="play.core.server.netty.NettyFuture.type">NettyFuture</a>._
  <span class="keyword">import</span> <a href="#play.core.server.netty.WebSocketHandler" title="play.core.server.netty.WebSocketHandler.type">WebSocketHandler</a>._

  <span class="keyword">val</span> <a title="Int" id="play.core.server.netty;WebSocketHandler.WebSocketNormalClose">WebSocketNormalClose</a> = <span title="Int(1000)" class="int">1000</span>
  <span class="keyword">val</span> <a title="Int" id="play.core.server.netty;WebSocketHandler.WebSocketUnacceptable">WebSocketUnacceptable</a> = <span title="Int(1003)" class="int">1003</span>
  <span class="keyword">val</span> <a title="Int" id="play.core.server.netty;WebSocketHandler.WebSocketMessageTooLong">WebSocketMessageTooLong</a> = <span title="Int(1009)" class="int">1009</span>

  <span class="comment">/**
   * The maximum number of messages allowed to be in flight.  Messages can be up to 64K by default, so this number
   * shouldn't be too high.
   */</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="play.core.server.netty;WebSocketHandler.MaxInFlight">MaxInFlight</a> = <span title="Int(3)" class="int">3</span>

  <span class="keyword">def</span> <a title="[A](frameFormatter: play.api.mvc.WebSocket.FrameFormatter[A], bufferLimit: Long)(play.api.libs.iteratee.Enumerator[A], org.jboss.netty.channel.ChannelHandler)" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler">newWebSocketInHandler</a><span class="delimiter">[</span><a title="" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.mvc.WebSocket.FrameFormatter[A]" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler.frameFormatter">frameFormatter</a>: <a href="../../../../../play/play/api/mvc/WebSocket.scala.html#play.api.mvc.WebSocket;FrameFormatter" title="play.api.mvc.WebSocket.FrameFormatter[A]">FrameFormatter</a><span class="delimiter">[</span>A<span class="delimiter">]</span>, <a title="Long" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler.bufferLimit">bufferLimit</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="(play.api.libs.iteratee.Enumerator[A], org.jboss.netty.channel.ChannelHandler)" class="delimiter">(</span>Enumerator<span class="delimiter">[</span>A<span class="delimiter">]</span>, ChannelHandler<span class="delimiter">)</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="play.core.websocket.BasicFrameFormatter[A]" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler.basicFrameFormatter">basicFrameFormatter</a> = <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.frameFormatter" title="play.api.mvc.WebSocket.FrameFormatter[A]">frameFormatter</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="play.core.websocket.BasicFrameFormatter[A]" class="delimiter">[</span><a href="../../../../../play/play/core/websocket/BasicFrameFormatter.scala.html#play.core.websocket;BasicFrameFormatter" title="play.core.websocket.BasicFrameFormatter[A]">BasicFrameFormatter</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">]</span>

    <span class="keyword">def</span> <a title="(nettyFrame: org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame)A" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler.fromNettyFrame">fromNettyFrame</a><span class="delimiter">(</span><a title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler.fromNettyFrame.nettyFrame">nettyFrame</a>: <span title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">WebSocketFrame</span><span class="delimiter">)</span>: <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;A" title="A">A</a> = <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.fromNettyFrame.nettyFrame" title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">nettyFrame</a> <span title="A" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler.fromNettyFrame.nettyTextFrame">nettyTextFrame</a>: <span title="org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame">TextWebSocketFrame</span> =&gt;
        <span class="keyword">val</span> <span title="play.core.websocket.TextFrame">basicFrame</span> = <a href="../../../../../play/play/core/websocket/BasicFrame.scala.html#play.core.websocket;TextFrame" title="(text: String)play.core.websocket.TextFrame">TextFrame</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.fromNettyFrame.nettyTextFrame" title="org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame">nettyTextFrame</a>.<span title="()String">getText</span><span class="delimiter">)</span>
        <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.basicFrameFormatter" title="play.core.websocket.BasicFrameFormatter[A]">basicFrameFormatter</a>.<a href="../../../../../play/play/core/websocket/BasicFrameFormatter.scala.html#play.core.websocket;BasicFrameFormatter.fromFrame" title="(frame: play.core.websocket.BasicFrame)A">fromFrame</a><span class="delimiter">(</span><span title="play.core.websocket.TextFrame">basicFrame</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler.fromNettyFrame.nettyBinaryFrame">nettyBinaryFrame</a>: <span title="org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame">BinaryWebSocketFrame</span> =&gt;
        <span class="keyword">val</span> <a title="Array[Byte]" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler.fromNettyFrame.bytes">bytes</a> = <a href="#play.core.server.netty;WebSocketHandler.channelBufferToArray" title="(buffer: org.jboss.netty.buffer.ChannelBuffer)Array[Byte]">channelBufferToArray</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.fromNettyFrame.nettyBinaryFrame" title="org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame">nettyBinaryFrame</a>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getBinaryData</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <span title="play.core.websocket.BinaryFrame">basicFrame</span> = <a href="../../../../../play/play/core/websocket/BasicFrame.scala.html#play.core.websocket;BinaryFrame" title="(bytes: Array[Byte])play.core.websocket.BinaryFrame">BinaryFrame</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.fromNettyFrame.bytes" title="Array[Byte]">bytes</a><span class="delimiter">)</span>
        <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.basicFrameFormatter" title="play.core.websocket.BasicFrameFormatter[A]">basicFrameFormatter</a>.<a href="../../../../../play/play/core/websocket/BasicFrameFormatter.scala.html#play.core.websocket;BasicFrameFormatter.fromFrame" title="(frame: play.core.websocket.BasicFrame)A">fromFrame</a><span class="delimiter">(</span><span title="play.core.websocket.BinaryFrame">basicFrame</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(nettyFrame: org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame)Boolean" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler.definedForNettyFrame">definedForNettyFrame</a><span class="delimiter">(</span><a title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler.definedForNettyFrame.nettyFrame">nettyFrame</a>: <span title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">WebSocketFrame</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.definedForNettyFrame.nettyFrame" title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">nettyFrame</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> _: <span title="org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame">TextWebSocketFrame</span> =&gt; <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.basicFrameFormatter" title="play.core.websocket.BasicFrameFormatter[A]">basicFrameFormatter</a>.<a href="../../../../../play/play/core/websocket/BasicFrameFormatter.scala.html#play.core.websocket;BasicFrameFormatter.fromFrameDefined" title="(clazz: Class[_])Boolean">fromFrameDefined</a><span class="delimiter">(</span>classOf<span title="Class[play.core.websocket.TextFrame](classOf[play.core.websocket.TextFrame])" class="delimiter">[</span>TextFrame<span class="delimiter">]</span><span class="delimiter">)</span>
      <span class="keyword">case</span> _: <span title="org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame">BinaryWebSocketFrame</span> =&gt; <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.basicFrameFormatter" title="play.core.websocket.BasicFrameFormatter[A]">basicFrameFormatter</a>.<a href="../../../../../play/play/core/websocket/BasicFrameFormatter.scala.html#play.core.websocket;BasicFrameFormatter.fromFrameDefined" title="(clazz: Class[_])Boolean">fromFrameDefined</a><span class="delimiter">(</span>classOf<span title="Class[play.core.websocket.BinaryFrame](classOf[play.core.websocket.BinaryFrame])" class="delimiter">[</span>BinaryFrame<span class="delimiter">]</span><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt; <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="WebSocketHandler.this.WebSocketEnumerator[A]" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler.enumerator">enumerator</a> = <span title="WebSocketHandler.this.WebSocketEnumerator[A]" class="keyword">new</span> <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator" title="WebSocketHandler.this.WebSocketEnumerator[A]">WebSocketEnumerator</a><span class="delimiter">[</span>A<span class="delimiter">]</span>

    <span title="(_1: WebSocketHandler.this.WebSocketEnumerator[A], _2: org.jboss.netty.channel.SimpleChannelUpstreamHandler{type FrameCreator = org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame})(WebSocketHandler.this.WebSocketEnumerator[A], org.jboss.netty.channel.SimpleChannelUpstreamHandler{type FrameCreator = org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame})" class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.enumerator" title="WebSocketHandler.this.WebSocketEnumerator[A]">enumerator</a>,
      <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon" title="org.jboss.netty.channel.SimpleChannelUpstreamHandler{type FrameCreator = org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame}" class="keyword">new</a> <a title="anonymous class $anon extends org.jboss.netty.channel.SimpleChannelUpstreamHandler" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon">SimpleChannelUpstreamHandler</a> <span class="delimiter">{</span>

        <span class="keyword">type</span> <a title="org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon;FrameCreator">FrameCreator</a> = ChannelBuffer =&gt; WebSocketFrame

        <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[(org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame, org.jboss.netty.buffer.ChannelBuffer)]" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.continuationBuffer_=">continuationBuffer</a>: <span title="Option[(org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame, org.jboss.netty.buffer.ChannelBuffer)]">Option</span><span class="delimiter">[</span><span class="delimiter">(</span>FrameCreator, ChannelBuffer<span class="delimiter">)</span><span class="delimiter">]</span> = <span title="None.type">None</span>

        <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.MessageEvent)Unit" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived">messageReceived</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.ctx">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.MessageEvent" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.e">e</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span><span class="delimiter">)</span> <span class="delimiter">{</span>

          <span class="comment">// Note, protocol violations like mixed up fragmentation are already handled upstream by the netty decoder</span>
          <span title="(_1: Object, _2: Option[(org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame, org.jboss.netty.buffer.ChannelBuffer)])(Object, Option[(org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame, org.jboss.netty.buffer.ChannelBuffer)])" class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.e" title="org.jboss.netty.channel.MessageEvent">e</a>.<span title="()Object">getMessage</span>, <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.continuationBuffer_=" title="=&gt; Option[(org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame, org.jboss.netty.buffer.ChannelBuffer)]">continuationBuffer</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>

            <span class="comment">// message too long</span>
            <span class="keyword">case</span> <span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.ContinuationWebSocketFrame">frame</span>: <span title="org.jboss.netty.handler.codec.http.websocketx.ContinuationWebSocketFrame">ContinuationWebSocketFrame</span>, Some<span class="delimiter">(</span><span class="delimiter">(</span>_, <span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="org.jboss.netty.handler.codec.http.websocketx.ContinuationWebSocketFrame">frame</span>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getBinaryData</span>.<span title="()Int">readableBytes</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span>.<span title="()Int">readableBytes</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Long)Boolean">&gt;</span> <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.bufferLimit" title="Long">bufferLimit</a> =&gt;
              <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, status: Int, reason: String)Unit">closeWebSocket</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#play.core.server.netty;WebSocketHandler.WebSocketMessageTooLong" title="=&gt; Int">WebSocketMessageTooLong</a>, <span title="String(&quot;Fragmented message too long, configured limit is &quot;)" class="string">&quot;Fragmented message too long, configured limit is &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.bufferLimit" title="Long">bufferLimit</a><span class="delimiter">)</span>

            <span class="comment">// non final continuation</span>
            <span class="keyword">case</span> <span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.ContinuationWebSocketFrame">frame</span>: <span title="org.jboss.netty.handler.codec.http.websocketx.ContinuationWebSocketFrame">ContinuationWebSocketFrame</span>, Some<span class="delimiter">(</span><span class="delimiter">(</span>_, <span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><span title="org.jboss.netty.handler.codec.http.websocketx.ContinuationWebSocketFrame">frame</span>.<span title="()Boolean">isFinalFragment</span> =&gt;
              <span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span>.<span title="(x$1: org.jboss.netty.buffer.ChannelBuffer)Unit">writeBytes</span><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.ContinuationWebSocketFrame">frame</span>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getBinaryData</span><span class="delimiter">)</span>

            <span class="comment">// final continuation</span>
            <span class="keyword">case</span> <span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.ContinuationWebSocketFrame">frame</span>: <span title="org.jboss.netty.handler.codec.http.websocketx.ContinuationWebSocketFrame">ContinuationWebSocketFrame</span>, Some<span class="delimiter">(</span><span class="delimiter">(</span><a title="org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.creator">creator</a>, <span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
              <span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span>.<span title="(x$1: org.jboss.netty.buffer.ChannelBuffer)Unit">writeBytes</span><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.ContinuationWebSocketFrame">frame</span>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getBinaryData</span><span class="delimiter">)</span>
              <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.continuationBuffer_=" title="(x$1: Option[(org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame, org.jboss.netty.buffer.ChannelBuffer)])Unit">continuationBuffer</a> = <span title="None.type">None</span>
              <span class="keyword">val</span> <a title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.finalFrame">finalFrame</a> = <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.creator" title="(v1: org.jboss.netty.buffer.ChannelBuffer)org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">creator</a><span class="delimiter">(</span><span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span><span class="delimiter">)</span>
              <span class="keyword">val</span> <a title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.basicFrame">basicFrame</a> = <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.finalFrame" title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">finalFrame</a>
              <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.enumerator" title="WebSocketHandler.this.WebSocketEnumerator[A]">enumerator</a>.<a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, input: play.api.libs.iteratee.Input[A])Unit">frameReceived</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Input;El" title="(e: A)play.api.libs.iteratee.Input.El[A]">El</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.fromNettyFrame" title="(nettyFrame: org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame)A">fromNettyFrame</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.finalFrame" title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">finalFrame</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

            <span class="comment">// fragmented text</span>
            <span class="keyword">case</span> <span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame">frame</span>: <span title="org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame">TextWebSocketFrame</span>, <span title="None.type">None</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><span title="org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame">frame</span>.<span title="()Boolean">isFinalFragment</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.definedForNettyFrame" title="(nettyFrame: org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame)Boolean">definedForNettyFrame</a><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame">frame</span><span class="delimiter">)</span> =&gt;
              <span class="keyword">val</span> <span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span> = <span title="org.jboss.netty.buffer.ChannelBuffers.type">ChannelBuffers</span>.<span title="(x$1: Int)org.jboss.netty.buffer.ChannelBuffer">dynamicBuffer</span><span class="delimiter">(</span><span title="Math.type">Math</span>.<span title="(x$1: Int, x$2: Int)Int">min</span><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame">frame</span>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getBinaryData</span>.<span title="()Int">readableBytes</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Int">*</span> <span title="Int(2)" class="int">2</span>, <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.bufferLimit" title="Long">bufferLimit</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Int" class="delimiter">[</span><span title="Int">Int</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span>.<span title="(x$1: org.jboss.netty.buffer.ChannelBuffer)Unit">writeBytes</span><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame">frame</span>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getBinaryData</span><span class="delimiter">)</span>
              <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.continuationBuffer_=" title="(x$1: Option[(org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame, org.jboss.netty.buffer.ChannelBuffer)])Unit">continuationBuffer</a> = <span title="(x: (org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame, org.jboss.netty.buffer.ChannelBuffer))Some[(org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame, org.jboss.netty.buffer.ChannelBuffer)]">Some</span><span class="delimiter">(</span><span title="(_1: org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame, _2: org.jboss.netty.buffer.ChannelBuffer)(org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame, org.jboss.netty.buffer.ChannelBuffer)" class="delimiter">(</span><span title="org.jboss.netty.buffer.ChannelBuffer">b</span> =&gt; <span title="(x$1: Boolean, x$2: Int, x$3: org.jboss.netty.buffer.ChannelBuffer)org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame">TextWebSocketFrame</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <span title="org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame">frame</span>.<span title="()Int">getRsv</span>, <span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span><span class="delimiter">)</span>, <span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span><span class="delimiter">)</span><span class="delimiter">)</span>

            <span class="comment">// fragmented binary</span>
            <span class="keyword">case</span> <span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame">frame</span>: <span title="org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame">BinaryWebSocketFrame</span>, <span title="None.type">None</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><span title="org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame">frame</span>.<span title="()Boolean">isFinalFragment</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.definedForNettyFrame" title="(nettyFrame: org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame)Boolean">definedForNettyFrame</a><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame">frame</span><span class="delimiter">)</span> =&gt;
              <span class="keyword">val</span> <span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span> = <span title="org.jboss.netty.buffer.ChannelBuffers.type">ChannelBuffers</span>.<span title="(x$1: Int)org.jboss.netty.buffer.ChannelBuffer">dynamicBuffer</span><span class="delimiter">(</span><span title="Math.type">Math</span>.<span title="(x$1: Int, x$2: Int)Int">min</span><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame">frame</span>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getBinaryData</span>.<span title="()Int">readableBytes</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Int">*</span> <span title="Int(2)" class="int">2</span>, <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.bufferLimit" title="Long">bufferLimit</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Int" class="delimiter">[</span><span title="Int">Int</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span>.<span title="(x$1: org.jboss.netty.buffer.ChannelBuffer)Unit">writeBytes</span><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame">frame</span>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getBinaryData</span><span class="delimiter">)</span>
              <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.continuationBuffer_=" title="(x$1: Option[(org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame, org.jboss.netty.buffer.ChannelBuffer)])Unit">continuationBuffer</a> = <span title="(x: (org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame, org.jboss.netty.buffer.ChannelBuffer))Some[(org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame, org.jboss.netty.buffer.ChannelBuffer)]">Some</span><span class="delimiter">(</span><span title="(_1: org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame, _2: org.jboss.netty.buffer.ChannelBuffer)(org.jboss.netty.buffer.ChannelBuffer =&gt; org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame, org.jboss.netty.buffer.ChannelBuffer)" class="delimiter">(</span><span title="org.jboss.netty.buffer.ChannelBuffer">b</span> =&gt; <span title="(x$1: Boolean, x$2: Int, x$3: org.jboss.netty.buffer.ChannelBuffer)org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame">BinaryWebSocketFrame</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <span title="org.jboss.netty.handler.codec.http.websocketx.BinaryWebSocketFrame">frame</span>.<span title="()Int">getRsv</span>, <span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span><span class="delimiter">)</span>, <span title="org.jboss.netty.buffer.ChannelBuffer">buffer</span><span class="delimiter">)</span><span class="delimiter">)</span>

            <span class="comment">// full handleable frame</span>
            <span class="keyword">case</span> <span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">frame</span>: <span title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">WebSocketFrame</span>, <span title="None.type">None</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.definedForNettyFrame" title="(nettyFrame: org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame)Boolean">definedForNettyFrame</a><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">frame</span><span class="delimiter">)</span> =&gt;
              <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.enumerator" title="WebSocketHandler.this.WebSocketEnumerator[A]">enumerator</a>.<a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, input: play.api.libs.iteratee.Input[A])Unit">frameReceived</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Input;El" title="(e: A)play.api.libs.iteratee.Input.El[A]">El</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.fromNettyFrame" title="(nettyFrame: org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame)A">fromNettyFrame</a><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">frame</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

            <span class="comment">// client initiated close</span>
            <span class="keyword">case</span> <span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.CloseWebSocketFrame">frame</span>: <span title="org.jboss.netty.handler.codec.http.websocketx.CloseWebSocketFrame">CloseWebSocketFrame</span>, _<span class="delimiter">)</span> =&gt;
              <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, status: Int, reason: String)Unit">closeWebSocket</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <span title="org.jboss.netty.handler.codec.http.websocketx.CloseWebSocketFrame">frame</span>.<span title="()Int">getStatusCode</span>, <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>

            <span class="comment">// ping!</span>
            <span class="keyword">case</span> <span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.PingWebSocketFrame">frame</span>: <span title="org.jboss.netty.handler.codec.http.websocketx.PingWebSocketFrame">PingWebSocketFrame</span>, _<span class="delimiter">)</span> =&gt;
              <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="(x$1: Any)org.jboss.netty.channel.ChannelFuture">write</span><span title="Unit" class="delimiter">(</span><span title="(x$1: org.jboss.netty.buffer.ChannelBuffer)org.jboss.netty.handler.codec.http.websocketx.PongWebSocketFrame" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.http.websocketx.PongWebSocketFrame">PongWebSocketFrame</span><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.PingWebSocketFrame">frame</span>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getBinaryData</span><span class="delimiter">)</span><span class="delimiter">)</span>

            <span class="comment">// pong!</span>
            <span class="keyword">case</span> <span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.PongWebSocketFrame">frame</span>: <span title="org.jboss.netty.handler.codec.http.websocketx.PongWebSocketFrame">PongWebSocketFrame</span>, _<span class="delimiter">)</span> =&gt; <span class="comment">// ignore</span>

            <span class="comment">// unacceptable frame</span>
            <span class="keyword">case</span> <span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">frame</span>: <span title="org.jboss.netty.handler.codec.http.websocketx.WebSocketFrame">WebSocketFrame</span>, _<span class="delimiter">)</span> =&gt;
              <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, status: Int, reason: String)Unit">closeWebSocket</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.messageReceived.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#play.core.server.netty;WebSocketHandler.WebSocketUnacceptable" title="=&gt; Int">WebSocketUnacceptable</a>, <span title="String(&quot;This WebSocket does not handle frames of that type&quot;)" class="string">&quot;This WebSocket does not handle frames of that type&quot;</span><span class="delimiter">)</span>

            <span class="keyword">case</span> _ =&gt; <span class="comment">//</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.ExceptionEvent)Unit" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.exceptionCaught">exceptionCaught</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.exceptionCaught.ctx">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.ExceptionEvent" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.exceptionCaught.e">e</a>: <span title="org.jboss.netty.channel.ExceptionEvent">ExceptionEvent</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.exceptionCaught.e" title="org.jboss.netty.channel.ExceptionEvent">e</a>.<span title="()Throwable">getCause</span>.<span title="()Unit">printStackTrace</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.exceptionCaught.e" title="org.jboss.netty.channel.ExceptionEvent">e</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="()org.jboss.netty.channel.ChannelFuture">close</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.ChannelStateEvent)Unit" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.channelDisconnected">channelDisconnected</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.channelDisconnected.ctx">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.ChannelStateEvent" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.channelDisconnected.e">e</a>: <span title="org.jboss.netty.channel.ChannelStateEvent">ChannelStateEvent</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.enumerator" title="WebSocketHandler.this.WebSocketEnumerator[A]">enumerator</a>.<a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, input: play.api.libs.iteratee.Input[A])Unit">frameReceived</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.channelDisconnected.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Input.EOF" title="play.api.libs.iteratee.Input.EOF.type">EOF</a><span class="delimiter">)</span>
          <a href="#play.core.server.netty.WebSocketHandler.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../../../play/play/api/Logger.scala.html#play.api;LoggerLike.trace(83d3728a3c)" title="(message: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="String(&quot;disconnected socket&quot;)" class="string">&quot;disconnected socket&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">private</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, status: Int, reason: String)Unit" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket">closeWebSocket</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket.ctx">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="Int" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket.status">status</a>: <span title="Int">Int</span>, <a title="String" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket.reason">reason</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket.reason" title="String">reason</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#play.core.server.netty.WebSocketHandler.logger" title="=&gt; play.api.Logger">logger</a>.<a href="../../../../../play/play/api/Logger.scala.html#play.api;LoggerLike.trace(83d3728a3c)" title="(message: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="String(&quot;Closing WebSocket because &quot;)" class="string">&quot;Closing WebSocket because &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket.reason" title="String">reason</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="()Boolean">isOpen</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">for</span> <span class="delimiter">{</span>
              <a title="org.jboss.netty.channel.Channel" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket.$anonfun._">_</a> &lt;- <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="(x$1: Any)org.jboss.netty.channel.ChannelFuture">write</span><a href="NettyFuture.scala.html#play.core.server.netty.NettyFuture.ToScala" title="implicit play.core.server.netty.NettyFuture.ToScala : (channelFuture: org.jboss.netty.channel.ChannelFuture)play.core.server.netty.NettyFuture.ToScala" class="delimiter">(</a><span title="(x$1: Int, x$2: String)org.jboss.netty.handler.codec.http.websocketx.CloseWebSocketFrame" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.http.websocketx.CloseWebSocketFrame">CloseWebSocketFrame</span><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket.status" title="Int">status</a>, <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket.reason" title="String">reason</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="NettyFuture.scala.html#play.core.server.netty.NettyFuture;ToScala.toScala" title="(f: org.jboss.netty.channel.Channel =&gt; scala.concurrent.Future[Unit])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[Unit]">toScala</a>
              <a title="org.jboss.netty.channel.Channel" id="play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket.$anonfun.$anonfun._">_</a> &lt;- <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="()org.jboss.netty.channel.ChannelFuture">close</span><a href="NettyFuture.scala.html#play.core.server.netty.NettyFuture.ToScala" title="implicit play.core.server.netty.NettyFuture.ToScala : (channelFuture: org.jboss.netty.channel.ChannelFuture)play.core.server.netty.NettyFuture.ToScala" class="delimiter">(</a><span class="delimiter">)</span>.<a href="NettyFuture.scala.html#play.core.server.netty.NettyFuture;ToScala.toScala" title="(f: org.jboss.netty.channel.Channel =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[Unit]">toScala</a>
            <span class="delimiter">}</span> <span class="keyword">yield</span> <span class="delimiter">{</span>
              <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler.enumerator" title="WebSocketHandler.this.WebSocketEnumerator[A]">enumerator</a>.<a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, input: play.api.libs.iteratee.Input[A])Unit">frameReceived</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler;$anon.closeWebSocket.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Input.EOF" title="play.api.libs.iteratee.Input.EOF.type">EOF</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

      <span class="delimiter">}</span><span class="delimiter">)</span>

  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">class</span> <a title="class WebSocketEnumerator[A] extends AnyRef with play.api.libs.iteratee.Enumerator[A]" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator">WebSocketEnumerator</a><span class="delimiter">[</span><a title="" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator;A">A</a><span class="delimiter">]</span> <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator" title="WebSocketHandler.this.WebSocketEnumerator[A]" class="keyword">extends</a> <a href="../../../../../play-iteratees/play/api/libs/iteratee/Enumerator.scala.html#play.api.libs.iteratee;Enumerator" title="play.api.libs.iteratee.Enumerator[A]">Enumerator</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.eventuallyIteratee">eventuallyIteratee</a> = <span title="[T]()scala.concurrent.Promise[T]">Promise</span><span title="()scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]" class="delimiter">[</span><a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee" title="play.api.libs.iteratee.Iteratee[A,Any]">Iteratee</a><span class="delimiter">[</span>A, Any<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="scala.concurrent.stm.Ref[play.api.libs.iteratee.Iteratee[A,Any]]" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.iterateeRef">iterateeRef</a> = <span title="[A](initialValue: A)(implicit om: scala.reflect.OptManifest[A])scala.concurrent.stm.Ref[A]">Ref</span><span title="(initialValue: play.api.libs.iteratee.Iteratee[A,Any])(implicit om: scala.reflect.OptManifest[play.api.libs.iteratee.Iteratee[A,Any]])scala.concurrent.stm.Ref[play.api.libs.iteratee.Iteratee[A,Any]]" class="delimiter">[</span><a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee" title="play.api.libs.iteratee.Iteratee[A,Any]">Iteratee</a><span class="delimiter">[</span>A, Any<span class="delimiter">]</span><span class="delimiter">]</span><span title="(clazz: Class[_], arg1: scala.reflect.OptManifest[_], args: scala.reflect.OptManifest[_]*)scala.reflect.ClassManifest[play.api.libs.iteratee.Iteratee[A,Any]]" class="delimiter">(</span><a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Iteratee" title="play.api.libs.iteratee.Iteratee.type">Iteratee</a>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Iteratee.flatten" title="(i: scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]])play.api.libs.iteratee.Iteratee[A,Any]">flatten</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.eventuallyIteratee" title="=&gt; scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]">eventuallyIteratee</a>.<span title="=&gt; scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]]">future</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.promise">promise</a>: scala.concurrent.<span title="scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]">Promise</span><span class="delimiter">[</span>Iteratee<span class="delimiter">[</span>A, Any<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="[T]()scala.concurrent.Promise[T]">Promise</span><span title="()scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]" class="delimiter">[</span><a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee" title="play.api.libs.iteratee.Iteratee[A,Any]">Iteratee</a><span class="delimiter">[</span>A, Any<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="comment">/**
     * The number of in flight messages.  Incremented every time we receive a message, decremented every time a
     * message is finished being handled.
     */</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.atomic.AtomicInteger" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.inFlight">inFlight</a> = <span title="java.util.concurrent.atomic.AtomicInteger" class="keyword">new</span> <span title="java.util.concurrent.atomic.AtomicInteger">AtomicInteger</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="[R](i: play.api.libs.iteratee.Iteratee[A,R])scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,R]]" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.apply">apply</a><span class="delimiter">[</span><a title="" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.apply;R">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.libs.iteratee.Iteratee[A,R]" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.apply.i">i</a>: <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee" title="play.api.libs.iteratee.Iteratee[A,R]">Iteratee</a><span class="delimiter">[</span>A, R<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.eventuallyIteratee" title="=&gt; scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]">eventuallyIteratee</a>.<span title="(v: play.api.libs.iteratee.Iteratee[A,Any])WebSocketEnumerator.this.eventuallyIteratee.type">success</span><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.apply.i" title="play.api.libs.iteratee.Iteratee[A,R]">i</a><span class="delimiter">)</span>
      <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.promise" title="=&gt; scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]">promise</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,R]]" class="delimiter">[</span>scala.concurrent.<span title="scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,R]]">Promise</span><span class="delimiter">[</span>Iteratee<span class="delimiter">[</span>A, R<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>.<span title="=&gt; scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,R]]">future</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(channel: org.jboss.netty.channel.Channel, readable: Boolean)Unit" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.setReadable">setReadable</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.Channel" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.setReadable.channel">channel</a>: <span title="org.jboss.netty.channel.Channel">Channel</span>, <a title="Boolean" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.setReadable.readable">readable</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.setReadable.channel" title="org.jboss.netty.channel.Channel">channel</a>.<span title="()Boolean">isOpen</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.setReadable.channel" title="org.jboss.netty.channel.Channel">channel</a>.<span title="(x$1: Boolean)org.jboss.netty.channel.ChannelFuture">setReadable</span><span title="Unit" class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.setReadable.readable" title="Boolean">readable</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, input: play.api.libs.iteratee.Input[A])Unit" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived">frameReceived</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.ctx">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="play.api.libs.iteratee.Input[A]" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.input">input</a>: <a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Input" title="play.api.libs.iteratee.Input[A]">Input</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="org.jboss.netty.channel.Channel" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.channel">channel</a> = <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.inFlight" title="=&gt; java.util.concurrent.atomic.AtomicInteger">inFlight</a>.<span title="()Int">incrementAndGet</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;=</span> <a href="#play.core.server.netty;WebSocketHandler.MaxInFlight" title="=&gt; Int">MaxInFlight</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.setReadable" title="(channel: org.jboss.netty.channel.Channel, readable: Boolean)Unit">setReadable</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.channel" title="org.jboss.netty.channel.Channel">channel</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.eventuallyNext">eventuallyNext</a> = <span title="[T]()scala.concurrent.Promise[T]">Promise</span><span title="()scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]" class="delimiter">[</span><a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee" title="play.api.libs.iteratee.Iteratee[A,Any]">Iteratee</a><span class="delimiter">[</span>A, Any<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="play.api.libs.iteratee.Iteratee[A,Any]" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.current">current</a> = <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.iterateeRef" title="=&gt; scala.concurrent.stm.Ref[play.api.libs.iteratee.Iteratee[A,Any]]">iterateeRef</a>.<span title="=&gt; scala.concurrent.stm.Ref.View[play.api.libs.iteratee.Iteratee[A,Any]]">single</span>.<span title="(v: play.api.libs.iteratee.Iteratee[A,Any])play.api.libs.iteratee.Iteratee[A,Any]">swap</span><span class="delimiter">(</span><a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Iteratee" title="play.api.libs.iteratee.Iteratee.type">Iteratee</a>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee.Iteratee.flatten" title="(i: scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]])play.api.libs.iteratee.Iteratee[A,Any]">flatten</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.eventuallyNext" title="scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]">eventuallyNext</a>.<span title="=&gt; scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]]">future</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="play.api.libs.iteratee.Iteratee[A,Any]" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next">next</a> = <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.current" title="play.api.libs.iteratee.Iteratee[A,Any]">current</a>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee.flatFold" title="(done: (Any, play.api.libs.iteratee.Input[A]) =&gt; scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]], cont: (play.api.libs.iteratee.Input[A] =&gt; play.api.libs.iteratee.Iteratee[A,Any]) =&gt; scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]], error: (String, play.api.libs.iteratee.Input[A]) =&gt; scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]])(implicit ec: scala.concurrent.ExecutionContext)play.api.libs.iteratee.Iteratee[A,Any]">flatFold</a><a href="../../../../../play/play/core/system/Execution.scala.html#play.core.Execution.Implicits.internalContext" title="=&gt; scala.concurrent.ExecutionContext" class="delimiter">(</a>
        <span class="delimiter">(</span><a title="Any" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.a">a</a>, <span title="play.api.libs.iteratee.Input[A]">e</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.setReadable" title="(channel: org.jboss.netty.channel.Channel, readable: Boolean)Unit">setReadable</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.channel" title="org.jboss.netty.channel.Channel">channel</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
          <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: play.api.libs.iteratee.Iteratee[A,Any])scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]]">successful</span><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.current" title="play.api.libs.iteratee.Iteratee[A,Any]">current</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>,
        <a title="play.api.libs.iteratee.Input[A] =&gt; play.api.libs.iteratee.Iteratee[A,Any]" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.k">k</a> =&gt; <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.inFlight" title="=&gt; java.util.concurrent.atomic.AtomicInteger">inFlight</a>.<span title="()Int">decrementAndGet</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#play.core.server.netty;WebSocketHandler.MaxInFlight" title="=&gt; Int">MaxInFlight</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.setReadable" title="(channel: org.jboss.netty.channel.Channel, readable: Boolean)Unit">setReadable</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.channel" title="org.jboss.netty.channel.Channel">channel</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">val</span> <a title="play.api.libs.iteratee.Iteratee[A,Any]" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.next">next</a> = <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.k" title="(v1: play.api.libs.iteratee.Input[A])play.api.libs.iteratee.Iteratee[A,Any]">k</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.input" title="play.api.libs.iteratee.Input[A]">input</a><span class="delimiter">)</span>
          <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.next" title="play.api.libs.iteratee.Iteratee[A,Any]">next</a>.<a href="../../../../../play-iteratees/play/api/libs/iteratee/Iteratee.scala.html#play.api.libs.iteratee;Iteratee.fold" title="(folder: play.api.libs.iteratee.Step[A,Any] =&gt; scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]])(implicit ec: scala.concurrent.ExecutionContext)scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]]">fold</a> <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.$anonfun.x0$1" title="scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]]" class="delimiter">{</a>
            <span class="keyword">case</span> Step.Done<span class="delimiter">(</span><a title="Any" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.$anonfun.a">a</a>, <span title="play.api.libs.iteratee.Input[A]">e</span><span class="delimiter">)</span> =&gt;
              <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.promise" title="=&gt; scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]">promise</a>.<span title="(v: play.api.libs.iteratee.Iteratee[A,Any])WebSocketEnumerator.this.promise.type">success</span><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.next" title="play.api.libs.iteratee.Iteratee[A,Any]">next</a><span class="delimiter">)</span>
              <span title="scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.channel" title="org.jboss.netty.channel.Channel">channel</a>.<span title="()Boolean">isOpen</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">for</span> <span class="delimiter">{</span>
                  <a title="org.jboss.netty.channel.Channel" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.$anonfun.$anonfun._">_</a> &lt;- <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.channel" title="org.jboss.netty.channel.Channel">channel</a>.<span title="(x$1: Any)org.jboss.netty.channel.ChannelFuture">write</span><a href="NettyFuture.scala.html#play.core.server.netty.NettyFuture.ToScala" title="implicit play.core.server.netty.NettyFuture.ToScala : (channelFuture: org.jboss.netty.channel.ChannelFuture)play.core.server.netty.NettyFuture.ToScala" class="delimiter">(</a><span title="(x$1: Int, x$2: String)org.jboss.netty.handler.codec.http.websocketx.CloseWebSocketFrame" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.http.websocketx.CloseWebSocketFrame">CloseWebSocketFrame</span><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.WebSocketNormalClose" title="=&gt; Int">WebSocketNormalClose</a>, <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="NettyFuture.scala.html#play.core.server.netty.NettyFuture;ToScala.toScala" title="(f: org.jboss.netty.channel.Channel =&gt; scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]]">toScala</a>
                  <a title="org.jboss.netty.channel.Channel" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.$anonfun.$anonfun.$anonfun._">_</a> &lt;- <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.channel" title="org.jboss.netty.channel.Channel">channel</a>.<span title="()org.jboss.netty.channel.ChannelFuture">close</span><a href="NettyFuture.scala.html#play.core.server.netty.NettyFuture.ToScala" title="implicit play.core.server.netty.NettyFuture.ToScala : (channelFuture: org.jboss.netty.channel.ChannelFuture)play.core.server.netty.NettyFuture.ToScala" class="delimiter">(</a><span class="delimiter">)</span>.<a href="NettyFuture.scala.html#play.core.server.netty.NettyFuture;ToScala.toScala" title="(f: org.jboss.netty.channel.Channel =&gt; play.api.libs.iteratee.Iteratee[A,Any])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]]">toScala</a>
                <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.next" title="play.api.libs.iteratee.Iteratee[A,Any]">next</a>
              <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: play.api.libs.iteratee.Iteratee[A,Any])scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]]">successful</span><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.next" title="play.api.libs.iteratee.Iteratee[A,Any]">next</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>

            <span class="keyword">case</span> Step.Cont<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
              <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: play.api.libs.iteratee.Iteratee[A,Any])scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]]">successful</span><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.next" title="play.api.libs.iteratee.Iteratee[A,Any]">next</a><span class="delimiter">)</span>
            <span class="keyword">case</span> Step.Error<span class="delimiter">(</span><a title="String" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.$anonfun.msg">msg</a>, <span title="play.api.libs.iteratee.Input[A]">e</span><span class="delimiter">)</span> =&gt;
              <span class="comment">/* deal with error, maybe close the socket */</span>
              <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: play.api.libs.iteratee.Iteratee[A,Any])scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]]">successful</span><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.next" title="play.api.libs.iteratee.Iteratee[A,Any]">next</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>,
        <span class="delimiter">(</span><a title="String" id="play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next.$anonfun.err">err</a>, <span title="play.api.libs.iteratee.Input[A]">e</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.setReadable" title="(channel: org.jboss.netty.channel.Channel, readable: Boolean)Unit">setReadable</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.channel" title="org.jboss.netty.channel.Channel">channel</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
          <span class="comment">/* handle error, maybe close the socket */</span>
          <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: play.api.libs.iteratee.Iteratee[A,Any])scala.concurrent.Future[play.api.libs.iteratee.Iteratee[A,Any]]">successful</span><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.current" title="play.api.libs.iteratee.Iteratee[A,Any]">current</a><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>
      <a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.eventuallyNext" title="scala.concurrent.Promise[play.api.libs.iteratee.Iteratee[A,Any]]">eventuallyNext</a>.<span title="(v: play.api.libs.iteratee.Iteratee[A,Any])eventuallyNext.type">success</span><span title="Unit" class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler;WebSocketEnumerator.frameReceived.next" title="play.api.libs.iteratee.Iteratee[A,Any]">next</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(buffer: org.jboss.netty.buffer.ChannelBuffer)Array[Byte]" id="play.core.server.netty;WebSocketHandler.channelBufferToArray">channelBufferToArray</a><span class="delimiter">(</span><a title="org.jboss.netty.buffer.ChannelBuffer" id="play.core.server.netty;WebSocketHandler.channelBufferToArray.buffer">buffer</a>: <span title="org.jboss.netty.buffer.ChannelBuffer">ChannelBuffer</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span title="Array[Byte]" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.channelBufferToArray.buffer" title="org.jboss.netty.buffer.ChannelBuffer">buffer</a>.<span title="()Int">readableBytes</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <a href="#play.core.server.netty;WebSocketHandler.channelBufferToArray.buffer" title="org.jboss.netty.buffer.ChannelBuffer">buffer</a>.<span title="()Int">capacity</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// Use entire backing array</span>
      <a href="#play.core.server.netty;WebSocketHandler.channelBufferToArray.buffer" title="org.jboss.netty.buffer.ChannelBuffer">buffer</a>.<span title="()Array[Byte]">array</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="comment">// Copy relevant bytes only</span>
      <span class="keyword">val</span> <a title="Array[Byte]" id="play.core.server.netty;WebSocketHandler.channelBufferToArray.bytes">bytes</a> = <span title="Array[Byte]" class="keyword">new</span> <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.channelBufferToArray.buffer" title="org.jboss.netty.buffer.ChannelBuffer">buffer</a>.<span title="()Int">readableBytes</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#play.core.server.netty;WebSocketHandler.channelBufferToArray.buffer" title="org.jboss.netty.buffer.ChannelBuffer">buffer</a>.<span title="(x$1: Array[Byte])Unit">readBytes</span><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.channelBufferToArray.bytes" title="Array[Byte]">bytes</a><span class="delimiter">)</span>
      <a href="#play.core.server.netty;WebSocketHandler.channelBufferToArray.bytes" title="Array[Byte]">bytes</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[A](ctx: org.jboss.netty.channel.ChannelHandlerContext, req: org.jboss.netty.handler.codec.http.HttpRequest, e: org.jboss.netty.channel.MessageEvent, bufferLimit: Long)(frameFormatter: play.api.mvc.WebSocket.FrameFormatter[A])play.api.libs.iteratee.Enumerator[A]" id="play.core.server.netty;WebSocketHandler.websocketHandshake">websocketHandshake</a><span class="delimiter">[</span><a title="" id="play.core.server.netty;WebSocketHandler.websocketHandshake;A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="play.core.server.netty;WebSocketHandler.websocketHandshake.ctx">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.handler.codec.http.HttpRequest" id="play.core.server.netty;WebSocketHandler.websocketHandshake.req">req</a>: <span title="org.jboss.netty.handler.codec.http.HttpRequest">HttpRequest</span>, <a title="org.jboss.netty.channel.MessageEvent" id="play.core.server.netty;WebSocketHandler.websocketHandshake.e">e</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span>, <a title="Long" id="play.core.server.netty;WebSocketHandler.websocketHandshake.bufferLimit">bufferLimit</a>: <span title="Long">Long</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="play.api.mvc.WebSocket.FrameFormatter[A]" id="play.core.server.netty;WebSocketHandler.websocketHandshake.frameFormatter">frameFormatter</a>: <a href="../../../../../play/play/api/mvc/WebSocket.scala.html#play.api.mvc.WebSocket;FrameFormatter" title="play.api.mvc.WebSocket.FrameFormatter[A]">FrameFormatter</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../../play-iteratees/play/api/libs/iteratee/Enumerator.scala.html#play.api.libs.iteratee;Enumerator" title="play.api.libs.iteratee.Enumerator[A]">Enumerator</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a href="#play.core.server.netty;WebSocketHandler.websocketHandshake.enumerator" title="(play.api.libs.iteratee.Enumerator[A], org.jboss.netty.channel.ChannelHandler)" class="delimiter">(</a><a href="#play.core.server.netty;WebSocketHandler.websocketHandshake.x$1" title="play.api.libs.iteratee.Enumerator[A]" id="play.core.server.netty;WebSocketHandler.websocketHandshake.enumerator">enumerator</a>, <a href="#play.core.server.netty;WebSocketHandler.websocketHandshake.x$1" title="org.jboss.netty.channel.ChannelHandler" id="play.core.server.netty;WebSocketHandler.websocketHandshake.handler">handler</a><span class="delimiter">)</span> = <a href="#play.core.server.netty;WebSocketHandler.newWebSocketInHandler" title="(frameFormatter: play.api.mvc.WebSocket.FrameFormatter[A], bufferLimit: Long)(play.api.libs.iteratee.Enumerator[A], org.jboss.netty.channel.ChannelHandler)">newWebSocketInHandler</a><span title="(play.api.libs.iteratee.Enumerator[A], org.jboss.netty.channel.ChannelHandler) @unchecked" class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.websocketHandshake.frameFormatter" title="play.api.mvc.WebSocket.FrameFormatter[A]">frameFormatter</a>, <a href="#play.core.server.netty;WebSocketHandler.websocketHandshake.bufferLimit" title="Long">bufferLimit</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.jboss.netty.channel.ChannelPipeline" id="play.core.server.netty;WebSocketHandler.websocketHandshake.p">p</a>: <span title="org.jboss.netty.channel.ChannelPipeline">ChannelPipeline</span> = <a href="#play.core.server.netty;WebSocketHandler.websocketHandshake.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="()org.jboss.netty.channel.ChannelPipeline">getPipeline</span>
    <a href="#play.core.server.netty;WebSocketHandler.websocketHandshake.p" title="org.jboss.netty.channel.ChannelPipeline">p</a>.<span title="(x$1: String, x$2: String, x$3: org.jboss.netty.channel.ChannelHandler)org.jboss.netty.channel.ChannelHandler">replace</span><span class="delimiter">(</span><span title="String(&quot;handler&quot;)" class="string">&quot;handler&quot;</span>, <span title="String(&quot;handler&quot;)" class="string">&quot;handler&quot;</span>, <a href="#play.core.server.netty;WebSocketHandler.websocketHandshake.handler" title="org.jboss.netty.channel.ChannelHandler">handler</a><span class="delimiter">)</span>

    <a href="../websocket/WebSocketHandshake.scala.html#play.core.server.websocket.WebSocketHandshake" title="play.core.server.websocket.WebSocketHandshake.type">WebSocketHandshake</a>.<a href="../websocket/WebSocketHandshake.scala.html#play.core.server.websocket.WebSocketHandshake.shake" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, req: org.jboss.netty.handler.codec.http.HttpRequest, bufferLimit: Long)Unit">shake</a><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.websocketHandshake.ctx" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#play.core.server.netty;WebSocketHandler.websocketHandshake.req" title="org.jboss.netty.handler.codec.http.HttpRequest">req</a>, <a href="#play.core.server.netty;WebSocketHandler.websocketHandshake.bufferLimit" title="Long">bufferLimit</a><span class="delimiter">)</span>
    <a href="#play.core.server.netty;WebSocketHandler.websocketHandshake.enumerator" title="play.api.libs.iteratee.Enumerator[A]">enumerator</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(req: org.jboss.netty.handler.codec.http.HttpRequest)play.core.server.WebSocketable" id="play.core.server.netty;WebSocketHandler.websocketable">websocketable</a><span class="delimiter">(</span><a title="org.jboss.netty.handler.codec.http.HttpRequest" id="play.core.server.netty;WebSocketHandler.websocketable.req">req</a>: <span title="org.jboss.netty.handler.codec.http.HttpRequest">HttpRequest</span><span class="delimiter">)</span> = <a href="#play.core.server.netty;WebSocketHandler.websocketable;$anon" title="play.core.server.WebSocketable" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with play.core.server.WebSocketable" id="play.core.server.netty;WebSocketHandler.websocketable;$anon">server</a>.<a href="../../../../../play-server/play/core/server/Server.scala.html#play.core.server;WebSocketable" title="play.core.server.WebSocketable">WebSocketable</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="play.core.server.netty;WebSocketHandler.websocketable;$anon.check">check</a> = HttpHeaders.Values.<span title="String(&quot;WebSocket&quot;)">WEBSOCKET</span>.<span title="(x$1: String)Boolean">equalsIgnoreCase</span><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.websocketable.req" title="org.jboss.netty.handler.codec.http.HttpRequest">req</a>.<span title="()org.jboss.netty.handler.codec.http.HttpHeaders">headers</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: String)String">get</span><span class="delimiter">(</span>HttpHeaders.Names.<span title="String(&quot;Upgrade&quot;)">UPGRADE</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(header: String)String" id="play.core.server.netty;WebSocketHandler.websocketable;$anon.getHeader">getHeader</a><span class="delimiter">(</span><a title="String" id="play.core.server.netty;WebSocketHandler.websocketable;$anon.getHeader.header">header</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#play.core.server.netty;WebSocketHandler.websocketable.req" title="org.jboss.netty.handler.codec.http.HttpRequest">req</a>.<span title="()org.jboss.netty.handler.codec.http.HttpHeaders">headers</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: String)String">get</span><span class="delimiter">(</span><a href="#play.core.server.netty;WebSocketHandler.websocketable;$anon.getHeader.header" title="String">header</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span title="AnyRef" class="keyword">object</span> <a title="play.core.server.netty.WebSocketHandler.type" id="play.core.server.netty.WebSocketHandler">WebSocketHandler</a> <a href="#play.core.server.netty.WebSocketHandler" title="play.core.server.netty.WebSocketHandler.type" class="delimiter">{</a>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="play.api.Logger" id="play.core.server.netty.WebSocketHandler.logger">logger</a> = <a href="../../../../../play/play/api/Logger.scala.html#play.api.Logger.apply(1f619881c1)" title="(clazz: Class[play.core.server.netty.WebSocketHandler])play.api.Logger">Logger</a><span class="delimiter">(</span>classOf<span title="Class[play.core.server.netty.WebSocketHandler](classOf[play.core.server.netty.WebSocketHandler])" class="delimiter">[</span>WebSocketHandler<span class="delimiter">]</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
