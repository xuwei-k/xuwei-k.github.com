<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>filters-helpers/play/filters/cors/AbstractCORSPolicy.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> play.filters.cors

<span class="keyword">import</span> scala.collection.immutable
<span class="keyword">import</span> scala.concurrent.Future

<span class="keyword">import</span> java.net.<span class="delimiter">{</span> URI, URISyntaxException <span class="delimiter">}</span>

<span class="keyword">import</span> play.api.LoggerLike
<span class="keyword">import</span> play.api.http.<span class="delimiter">{</span> HeaderNames, HttpVerbs <span class="delimiter">}</span>
<span class="keyword">import</span> play.api.mvc.<span class="delimiter">{</span> RequestHeader, Results, Result <span class="delimiter">}</span>

<span class="comment">/**
 * An abstraction for providing [[play.api.mvc.Action]]s and [[play.api.mvc.Filter]]s that support Cross-Origin
 * Resource Sharing (CORS)
 *
 * @see [[http://www.w3.org/TR/cors/ CORS specification]]
 */</span>
<span class="keyword">trait</span> <a title="trait AbstractCORSPolicy extends AnyRef" id="play.filters.cors;AbstractCORSPolicy">AbstractCORSPolicy</a> <span title="Unit" class="delimiter">{</span>

  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="=&gt; play.api.LoggerLike" id="play.filters.cors;AbstractCORSPolicy.logger">logger</a>: <a href="../../../../play/play/api/Logger.scala.html#play.api;LoggerLike" title="play.api.LoggerLike">LoggerLike</a>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; play.filters.cors.CORSConfig" id="play.filters.cors;AbstractCORSPolicy.corsConfig">corsConfig</a>: <a href="CORSConfig.scala.html#play.filters.cors;CORSConfig" title="play.filters.cors.CORSConfig">CORSConfig</a>

  <span class="comment">/**
   * HTTP Methods support by Play
   */</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.immutable.HashSet[String]" id="play.filters.cors;AbstractCORSPolicy.HttpMethods">HttpMethods</a> = <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HttpVerbs" title="play.api.http.HttpVerbs.type">HttpVerbs</a>._
    immutable.<span title="(elems: String*)scala.collection.immutable.HashSet[String]">HashSet</span><span class="delimiter">(</span><a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HttpVerbs.GET" title="=&gt; String">GET</a>, <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HttpVerbs.POST" title="=&gt; String">POST</a>, <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HttpVerbs.PUT" title="=&gt; String">PUT</a>, <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HttpVerbs.PATCH" title="=&gt; String">PATCH</a>, <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HttpVerbs.DELETE" title="=&gt; String">DELETE</a>, <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HttpVerbs.HEAD" title="=&gt; String">HEAD</a>, <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HttpVerbs.OPTIONS" title="=&gt; String">OPTIONS</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(f: () =&gt; scala.concurrent.Future[play.api.mvc.Result], request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]" id="play.filters.cors;AbstractCORSPolicy.filterRequest">filterRequest</a><span class="delimiter">(</span><a title="() =&gt; scala.concurrent.Future[play.api.mvc.Result]" id="play.filters.cors;AbstractCORSPolicy.filterRequest.f">f</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Future<span class="delimiter">[</span>Result<span class="delimiter">]</span>, <a title="play.api.mvc.RequestHeader" id="play.filters.cors;AbstractCORSPolicy.filterRequest.request">request</a>: <a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a><span class="delimiter">)</span>: <span title="scala.concurrent.Future[play.api.mvc.Result]">Future</span><span class="delimiter">[</span>Result<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.headers" title="=&gt; play.api.mvc.Headers">headers</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;Headers.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ORIGIN" title="=&gt; String">ORIGIN</a><span class="delimiter">)</span> <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="None.type">None</span> =&gt;
        <span class="comment">/* http://www.w3.org/TR/cors/#resource-requests
         * § 6.1.1
         * If the Origin header is not present terminate this set of steps.
         */</span>
        <a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.f" title="()scala.concurrent.Future[play.api.mvc.Result]">f</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="String" id="play.filters.cors;AbstractCORSPolicy.filterRequest.originHeader">originHeader</a><span class="delimiter">)</span> =&gt;
        <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.originHeader" title="String">originHeader</a>.<span title="()Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><a href="#play.filters.cors;AbstractCORSPolicy.isValidOrigin" title="(origin: String)Boolean">isValidOrigin</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.originHeader" title="String">originHeader</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#play.filters.cors;AbstractCORSPolicy.handleInvalidCORSRequest" title="(request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">handleInvalidCORSRequest</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.request" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="java.net.URI" id="play.filters.cors;AbstractCORSPolicy.filterRequest.originUri">originUri</a> = <span title="java.net.URI" class="keyword">new</span> <span title="java.net.URI">URI</span><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.originHeader" title="String">originHeader</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="java.net.URI" id="play.filters.cors;AbstractCORSPolicy.filterRequest.hostUri">hostUri</a> = <span title="java.net.URI" class="keyword">new</span> <span title="java.net.URI">URI</span><span class="delimiter">(</span><span title="String(&quot;//&quot;)" class="string">&quot;//&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.host" title="=&gt; String">host</a><span class="delimiter">)</span>
          <a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.originUri" title="java.net.URI">originUri</a>.<span title="()String">getHost</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.hostUri" title="java.net.URI">hostUri</a>.<span title="()String">getHost</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.originUri" title="java.net.URI">originUri</a>.<span title="()Int">getPort</span> <span title="(x: Int)Boolean">==</span> <a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.hostUri" title="java.net.URI">hostUri</a>.<span title="()Int">getPort</span>
        <span class="delimiter">}</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="comment">// HOST and ORIGIN match, so this is a same-origin request, pass through.</span>
          <a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.f" title="()scala.concurrent.Future[play.api.mvc.Result]">f</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="String" id="play.filters.cors;AbstractCORSPolicy.filterRequest.method">method</a> = <a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.method" title="=&gt; String">method</a>
          <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.HttpMethods" title="=&gt; scala.collection.immutable.HashSet[String]">HttpMethods</a>.<span title="(e: String)Boolean">contains</span><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.method" title="String">method</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.method" title="String">method</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HttpVerbs" title="play.api.http.HttpVerbs.type">HttpVerbs</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HttpVerbs.OPTIONS" title="=&gt; String">OPTIONS</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.headers" title="=&gt; play.api.mvc.Headers">headers</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;Headers.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_REQUEST_METHOD" title="=&gt; String">ACCESS_CONTROL_REQUEST_METHOD</a><span class="delimiter">)</span> <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span title="None.type">None</span> =&gt;
                  <a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest" title="(f: () =&gt; scala.concurrent.Future[play.api.mvc.Result], request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">handleCORSRequest</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.f" title="() =&gt; scala.concurrent.Future[play.api.mvc.Result]">f</a>, <a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.request" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span>
                <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="String" id="play.filters.cors;AbstractCORSPolicy.filterRequest.requestMethod">requestMethod</a><span class="delimiter">)</span> =&gt;
                  <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.requestMethod" title="String">requestMethod</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                    <a href="#play.filters.cors;AbstractCORSPolicy.handleInvalidCORSRequest" title="(request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">handleInvalidCORSRequest</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.request" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span>
                  <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                    <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest" title="(request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">handlePreFlightCORSRequest</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.request" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span>
                  <span class="delimiter">}</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
              <a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest" title="(f: () =&gt; scala.concurrent.Future[play.api.mvc.Result], request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">handleCORSRequest</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.f" title="() =&gt; scala.concurrent.Future[play.api.mvc.Result]">f</a>, <a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.request" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="comment">// unrecognized method so invalid request</span>
            <a href="#play.filters.cors;AbstractCORSPolicy.handleInvalidCORSRequest" title="(request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">handleInvalidCORSRequest</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.filterRequest.request" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/* Handles a CORS request
   *
   * @see [[http://www.w3.org/TR/cors/#resource-requests Simple Cross-Origin Request, Actual Request, and Redirects]]
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(f: () =&gt; scala.concurrent.Future[play.api.mvc.Result], request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]" id="play.filters.cors;AbstractCORSPolicy.handleCORSRequest">handleCORSRequest</a><span class="delimiter">(</span><a title="() =&gt; scala.concurrent.Future[play.api.mvc.Result]" id="play.filters.cors;AbstractCORSPolicy.handleCORSRequest.f">f</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Future<span class="delimiter">[</span>Result<span class="delimiter">]</span>, <a title="play.api.mvc.RequestHeader" id="play.filters.cors;AbstractCORSPolicy.handleCORSRequest.request">request</a>: <a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a><span class="delimiter">)</span>: <span title="scala.concurrent.Future[play.api.mvc.Result]">Future</span><span class="delimiter">[</span>Result<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="play.filters.cors;AbstractCORSPolicy.handleCORSRequest.origin">origin</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Option[String]" id="play.filters.cors;AbstractCORSPolicy.handleCORSRequest.origin.originOpt">originOpt</a> = <a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.headers" title="=&gt; play.api.mvc.Headers">headers</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;Headers.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ORIGIN" title="=&gt; String">ORIGIN</a><span class="delimiter">)</span>
      <span title="(assumption: Boolean, message: =&gt; Any)Unit">assume</span><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.origin.originOpt" title="Option[String]">originOpt</a>.<span title="=&gt; Boolean">isDefined</span>, <span title="String(&quot;The presence of the ORIGIN header should guaranteed at this point.&quot;)" class="string">&quot;The presence of the ORIGIN header should guaranteed at this point.&quot;</span><span class="delimiter">)</span>
      <a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.origin.originOpt" title="Option[String]">originOpt</a>.<span title="=&gt; String">get</span>
    <span class="delimiter">}</span>

    <span class="comment">/* http://www.w3.org/TR/cors/#resource-requests
     * § 6.1.2
     * If the value of the Origin header is not a case-sensitive match for
     * any of the values in list of origins, do not set any additional
     * headers and terminate this set of steps.
     */</span>
    <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#play.filters.cors;AbstractCORSPolicy.isOriginAllowed" title="(origin: String)Boolean">isOriginAllowed</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.origin" title="String">origin</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#play.filters.cors;AbstractCORSPolicy.handleInvalidCORSRequest" title="(request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">handleInvalidCORSRequest</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.request" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]" id="play.filters.cors;AbstractCORSPolicy.handleCORSRequest.headerBuilder">headerBuilder</a> = <span title="scala.collection.Seq.type">Seq</span>.<span title="[A]=&gt; scala.collection.mutable.Builder[A,Seq[A]]">newBuilder</span><span title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]" class="delimiter">[</span><span title="(String, String)" class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span>

      <span class="comment">/* http://www.w3.org/TR/cors/#resource-requests
       * § 6.1.3
       */</span>
      <span title="headerBuilder.type" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.corsConfig" title="=&gt; play.filters.cors.CORSConfig">corsConfig</a>.<a href="CORSConfig.scala.html#play.filters.cors;CORSConfig.supportsCredentials" title="=&gt; Boolean">supportsCredentials</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">/* If the resource supports credentials add a single Access-Control-Allow-Origin header,
         * with the value of the Origin header as value, and add a single
         * Access-Control-Allow-Credentials header with the case-sensitive string &quot;true&quot; as value.
         */</span>
        <a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_ALLOW_CREDENTIALS" title="(x: String)ArrowAssoc[String]">ACCESS_CONTROL_ALLOW_CREDENTIALS</a> <span title="(y: String)(String, String)">-&gt;</span> <span title="String(&quot;true&quot;)" class="string">&quot;true&quot;</span>
        <a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_ALLOW_ORIGIN" title="(x: String)ArrowAssoc[String]">ACCESS_CONTROL_ALLOW_ORIGIN</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.origin" title="String">origin</a>
        <span class="comment">/* http://www.w3.org/TR/cors/#resource-implementation
         * § 6.4
         * Resources that wish to enable themselves to be shared with multiple Origins but do
         * not respond uniformly with &quot;*&quot; must in practice generate the Access-Control-Allow-Origin
         * header dynamically in response to every request they wish to allow. As a consequence,
         * authors of such resources should send a Vary: Origin HTTP header or provide other
         * appropriate control directives to prevent caching of such responses, which may be
         * inaccurate if re-used across-origins.
         */</span>
        <a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.VARY" title="(x: String)ArrowAssoc[String]">VARY</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ORIGIN" title="=&gt; String">ORIGIN</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="comment">/* Otherwise, add a single Access-Control-Allow-Origin header,
         * with either the value of the Origin header or the string &quot;*&quot; as value.
         */</span>
        <span title="headerBuilder.type" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.corsConfig" title="=&gt; play.filters.cors.CORSConfig">corsConfig</a>.<a href="CORSConfig.scala.html#play.filters.cors;CORSConfig.anyOriginAllowed" title="=&gt; Boolean">anyOriginAllowed</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_ALLOW_ORIGIN" title="(x: String)ArrowAssoc[String]">ACCESS_CONTROL_ALLOW_ORIGIN</a> <span title="(y: String)(String, String)">-&gt;</span> <span title="String(&quot;*&quot;)" class="string">&quot;*&quot;</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_ALLOW_ORIGIN" title="(x: String)ArrowAssoc[String]">ACCESS_CONTROL_ALLOW_ORIGIN</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.origin" title="String">origin</a>
          <span class="comment">/* http://www.w3.org/TR/cors/#resource-implementation
           * § 6.4
           */</span>
          <a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.VARY" title="(x: String)ArrowAssoc[String]">VARY</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ORIGIN" title="=&gt; String">ORIGIN</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="comment">/* http://www.w3.org/TR/cors/#resource-requests
       * § 6.1.4
       * If the list of exposed headers is not empty add one or more Access-Control-Expose-Headers headers,
       * with as values the header field names given in the list of exposed headers.
       */</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.corsConfig" title="=&gt; play.filters.cors.CORSConfig">corsConfig</a>.<a href="CORSConfig.scala.html#play.filters.cors;CORSConfig.exposedHeaders" title="=&gt; Seq[String]">exposedHeaders</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_EXPOSE_HEADERS" title="(x: String)ArrowAssoc[String]">ACCESS_CONTROL_EXPOSE_HEADERS</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#play.filters.cors;AbstractCORSPolicy.corsConfig" title="=&gt; play.filters.cors.CORSConfig">corsConfig</a>.<a href="CORSConfig.scala.html#play.filters.cors;CORSConfig.exposedHeaders" title="=&gt; Seq[String]">exposedHeaders</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">import</span> play.api.libs.iteratee.<a href="../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution" title="play.api.libs.iteratee.Execution.type">Execution</a>.<a href="../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution.Implicits" title="play.api.libs.iteratee.Execution.Implicits.type">Implicits</a>.trampoline
      <a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.f" title="()scala.concurrent.Future[play.api.mvc.Result]">f</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(f: play.api.mvc.Result =&gt; play.api.mvc.Result)(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[play.api.mvc.Result]">map</span><a href="../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution.Implicits.trampoline" title="=&gt; scala.concurrent.ExecutionContext" class="delimiter">(</a><a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.$anonfun.x$1" title="play.api.mvc.Result">_</a>.<a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Result.withHeaders" title="(headers: (String, String)*)play.api.mvc.Result">withHeaders</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handleCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a>.<span title="()Seq[(String, String)]">result</span><span class="delimiter">(</span><span class="delimiter">)</span>: _*<span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]" id="play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest">handlePreFlightCORSRequest</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader" id="play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.request">request</a>: <a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a><span class="delimiter">)</span>: <span title="scala.concurrent.Future[play.api.mvc.Result]">Future</span><span class="delimiter">[</span>Result<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.origin">origin</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Option[String]" id="play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.origin.originOpt">originOpt</a> = <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.headers" title="=&gt; play.api.mvc.Headers">headers</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;Headers.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ORIGIN" title="=&gt; String">ORIGIN</a><span class="delimiter">)</span>
      <span title="(assumption: Boolean, message: =&gt; Any)Unit">assume</span><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.origin.originOpt" title="Option[String]">originOpt</a>.<span title="=&gt; Boolean">isDefined</span>, <span title="String(&quot;The presence of the ORIGIN header should guaranteed at this point.&quot;)" class="string">&quot;The presence of the ORIGIN header should guaranteed at this point.&quot;</span><span class="delimiter">)</span>
      <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.origin.originOpt" title="Option[String]">originOpt</a>.<span title="=&gt; String">get</span>
    <span class="delimiter">}</span>

    <span class="comment">/* http://www.w3.org/TR/cors/#resource-preflight-requests
     * § 6.2.2
     * If the value of the Origin header is not a case-sensitive match for
     * any of the values in list of origins, do not set any additional
     * headers and terminate this set of steps.
     */</span>
    <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#play.filters.cors;AbstractCORSPolicy.isOriginAllowed" title="(origin: String)Boolean">isOriginAllowed</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.origin" title="String">origin</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#play.filters.cors;AbstractCORSPolicy.handleInvalidCORSRequest" title="(request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">handleInvalidCORSRequest</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.request" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.headers" title="=&gt; play.api.mvc.Headers">headers</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;Headers.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_REQUEST_METHOD" title="=&gt; String">ACCESS_CONTROL_REQUEST_METHOD</a><span class="delimiter">)</span> <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="None.type">None</span> =&gt;
          <span class="comment">/* http://www.w3.org/TR/cors/#resource-preflight-requests
           * § 6.2.3
           * If there is no Access-Control-Request-Method header or if
           * parsing failed, do not set any additional headers and
           * terminate this set of steps.
           */</span>
          <a href="#play.filters.cors;AbstractCORSPolicy.handleInvalidCORSRequest" title="(request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">handleInvalidCORSRequest</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.request" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span>
        <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="String" id="play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.requestMethod">requestMethod</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="String" id="play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.accessControlRequestMethod">accessControlRequestMethod</a> = <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.requestMethod" title="String">requestMethod</a>.<span title="()String">trim</span>
          <span class="keyword">val</span> <a title="String =&gt; Boolean" id="play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.methodPredicate">methodPredicate</a> = <a href="#play.filters.cors;AbstractCORSPolicy.corsConfig" title="=&gt; play.filters.cors.CORSConfig">corsConfig</a>.<a href="CORSConfig.scala.html#play.filters.cors;CORSConfig.isHttpMethodAllowed" title="=&gt; String =&gt; Boolean">isHttpMethodAllowed</a> <span class="comment">// call def to get function val</span>
          <span class="comment">/* http://www.w3.org/TR/cors/#resource-preflight-requests
           * § 6.2.5
           * If method is not a case-sensitive match for any of the
           * values in list of methods do not set any additional
           * headers and terminate this set of steps.
           */</span>
          <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#play.filters.cors;AbstractCORSPolicy.HttpMethods" title="=&gt; scala.collection.immutable.HashSet[String]">HttpMethods</a>.<span title="(e: String)Boolean">contains</span><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.accessControlRequestMethod" title="String">accessControlRequestMethod</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span>
            <span title="=&gt; Boolean">!</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.methodPredicate" title="(v1: String)Boolean">methodPredicate</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.accessControlRequestMethod" title="String">accessControlRequestMethod</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#play.filters.cors;AbstractCORSPolicy.handleInvalidCORSRequest" title="(request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">handleInvalidCORSRequest</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.request" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="comment">/* http://www.w3.org/TR/cors/#resource-preflight-requests
             * § 6.2.4
             * Let header field-names be the values as result of parsing
             * the Access-Control-Request-Headers headers.
             * If there are no Access-Control-Request-Headers headers
             * let header field-names be the empty list.
             */</span>
            <span class="keyword">val</span> <a title="List[String]" id="play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.accessControlRequestHeaders">accessControlRequestHeaders</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
              <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.headers" title="=&gt; play.api.mvc.Headers">headers</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;Headers.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_REQUEST_HEADERS" title="=&gt; String">ACCESS_CONTROL_REQUEST_HEADERS</a><span class="delimiter">)</span> <span title="List[String]" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span title="None.type">None</span> =&gt; <span title="scala.collection.immutable.List.type">List</span>.<span title="[A]=&gt; List[A]">empty</span><span title="List[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span>
                <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="String" id="play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.accessControlRequestHeaders.headerVal">headerVal</a><span class="delimiter">)</span> =&gt;
                  <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.accessControlRequestHeaders.headerVal" title="String">headerVal</a>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">trim</span>.<span title="(separator: Char)Array[String]">split</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><span title="Char(',')" class="char">','</span><span class="delimiter">)</span>.<span title="(f: String =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Array[String],String,List[String]])List[String]">map</span><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.accessControlRequestHeaders.$anonfun.x$2" title="String">_</a>.<span title="()String">trim</span>.<span title="()String">toLowerCase</span><span class="delimiter">)</span><span class="delimiter">(</span>collection.<span title="(implicit b: scala.collection.generic.CanBuildFrom[Nothing,String,List[String]])scala.collection.generic.CanBuildFrom[Array[String],String,List[String]]">breakOut</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>

            <span class="keyword">val</span> <a title="String =&gt; Boolean" id="play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.headerPredicate">headerPredicate</a> = <a href="#play.filters.cors;AbstractCORSPolicy.corsConfig" title="=&gt; play.filters.cors.CORSConfig">corsConfig</a>.<a href="CORSConfig.scala.html#play.filters.cors;CORSConfig.isHttpHeaderAllowed" title="=&gt; String =&gt; Boolean">isHttpHeaderAllowed</a> <span class="comment">// call def to get function val</span>
            <span class="comment">/* http://www.w3.org/TR/cors/#resource-preflight-requests
             * § 6.2.6
             * If any of the header field-names is not a ASCII case-insensitive
             * match for any of the values in list of headers do not
             * set any additional headers and terminate this set of steps.
             */</span>
            <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.accessControlRequestHeaders" title="List[String]">accessControlRequestHeaders</a>.<span title="(p: String =&gt; Boolean)Boolean">forall</span><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.headerPredicate" title="(v1: String)Boolean">headerPredicate</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.$anonfun.x$3" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#play.filters.cors;AbstractCORSPolicy.handleInvalidCORSRequest" title="(request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">handleInvalidCORSRequest</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.request" title="play.api.mvc.RequestHeader">request</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]" id="play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.headerBuilder">headerBuilder</a> = <span title="scala.collection.Seq.type">Seq</span>.<span title="[A]=&gt; scala.collection.mutable.Builder[A,Seq[A]]">newBuilder</span><span title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]" class="delimiter">[</span><span title="(String, String)" class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span>

              <span class="comment">/* http://www.w3.org/TR/cors/#resource-preflight-requests
               * § 6.2.7
               */</span>
              <span title="headerBuilder.type" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.corsConfig" title="=&gt; play.filters.cors.CORSConfig">corsConfig</a>.<a href="CORSConfig.scala.html#play.filters.cors;CORSConfig.supportsCredentials" title="=&gt; Boolean">supportsCredentials</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="comment">/* If the resource supports credentials add a single Access-Control-Allow-Origin header,
                 * with the value of the Origin header as value, and add a single
                 * Access-Control-Allow-Credentials header with the case-sensitive string &quot;true&quot; as value.
                 */</span>
                <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_ALLOW_CREDENTIALS" title="(x: String)ArrowAssoc[String]">ACCESS_CONTROL_ALLOW_CREDENTIALS</a> <span title="(y: String)(String, String)">-&gt;</span> <span title="String(&quot;true&quot;)" class="string">&quot;true&quot;</span>
                <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_ALLOW_ORIGIN" title="(x: String)ArrowAssoc[String]">ACCESS_CONTROL_ALLOW_ORIGIN</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.origin" title="String">origin</a>

                <span class="comment">/* http://www.w3.org/TR/cors/#resource-implementation
                 * § 6.4
                 * Resources that wish to enable themselves to be shared with multiple Origins but do
                 * not respond uniformly with &quot;*&quot; must in practice generate the Access-Control-Allow-Origin
                 * header dynamically in response to every request they wish to allow. As a consequence,
                 * authors of such resources should send a Vary: Origin HTTP header or provide other
                 * appropriate control directives to prevent caching of such responses, which may be
                 * inaccurate if re-used across-origins.
                 */</span>
                <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.VARY" title="(x: String)ArrowAssoc[String]">VARY</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ORIGIN" title="=&gt; String">ORIGIN</a>
              <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                <span class="comment">/* Otherwise, add a single Access-Control-Allow-Origin header,
                 * with either the value of the Origin header or the string &quot;*&quot; as value.
                 */</span>
                <span title="headerBuilder.type" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.corsConfig" title="=&gt; play.filters.cors.CORSConfig">corsConfig</a>.<a href="CORSConfig.scala.html#play.filters.cors;CORSConfig.anyOriginAllowed" title="=&gt; Boolean">anyOriginAllowed</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_ALLOW_ORIGIN" title="(x: String)ArrowAssoc[String]">ACCESS_CONTROL_ALLOW_ORIGIN</a> <span title="(y: String)(String, String)">-&gt;</span> <span title="String(&quot;*&quot;)" class="string">&quot;*&quot;</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                  <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_ALLOW_ORIGIN" title="(x: String)ArrowAssoc[String]">ACCESS_CONTROL_ALLOW_ORIGIN</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.origin" title="String">origin</a>
                  <span class="comment">/* http://www.w3.org/TR/cors/#resource-implementation
                   * § 6.4
                   */</span>
                  <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.VARY" title="(x: String)ArrowAssoc[String]">VARY</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ORIGIN" title="=&gt; String">ORIGIN</a>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>

              <span class="comment">/* http://www.w3.org/TR/cors/#resource-preflight-requests
               * § 6.2.8
               * Optionally add a single Access-Control-Max-Age header with as value the amount
               * of seconds the user agent is allowed to cache the result of the request.
               */</span>
              <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.corsConfig" title="=&gt; play.filters.cors.CORSConfig">corsConfig</a>.<a href="CORSConfig.scala.html#play.filters.cors;CORSConfig.preflightMaxAge" title="=&gt; scala.concurrent.duration.Duration">preflightMaxAge</a>.<span title="=&gt; Long">toSeconds</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_MAX_AGE" title="(x: String)ArrowAssoc[String]">ACCESS_CONTROL_MAX_AGE</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#play.filters.cors;AbstractCORSPolicy.corsConfig" title="=&gt; play.filters.cors.CORSConfig">corsConfig</a>.<a href="CORSConfig.scala.html#play.filters.cors;CORSConfig.preflightMaxAge" title="=&gt; scala.concurrent.duration.Duration">preflightMaxAge</a>.<span title="=&gt; Long">toSeconds</span>.<span title="()String">toString</span>
              <span class="delimiter">}</span>

              <span class="comment">/* http://www.w3.org/TR/cors/#resource-preflight-requests
               * § 6.2.9
               * Add one or more Access-Control-Allow-Methods headers consisting of (a subset of)
               * the list of methods.
               * Note: If a method is a simple method it does not need to be listed,
               * but this is not prohibited.
               * Note: Since the list of methods can be unbounded, simply returning the method
               * indicated by Access-Control-Request-Method (if supported) can be enough.
               */</span>
              <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_ALLOW_METHODS" title="(x: String)ArrowAssoc[String]">ACCESS_CONTROL_ALLOW_METHODS</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.accessControlRequestMethod" title="String">accessControlRequestMethod</a>

              <span class="comment">/* http://www.w3.org/TR/cors/#resource-preflight-requests
               * § 6.2.9
               * If each of the header field-names is a simple header and none is Content-Type,
               * this step may be skipped.
               * Add one or more Access-Control-Allow-Headers headers consisting of
               * (a subset of) the list of headers.
               * Note: If a header field name is a simple header and is not Content-Type,
               * it is not required to be listed. Content-Type is to be listed as only a subset
               * of its values makes it qualify as simple header.
               * Note: Since the list of headers can be unbounded, simply returning supported
               * headers from Access-Control-Allow-Headers can be enough.
               */</span>
              <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.accessControlRequestHeaders" title="List[String]">accessControlRequestHeaders</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a> <span title="(elem: (String, String))headerBuilder.type">+=</span> <a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_ALLOW_HEADERS" title="(x: String)ArrowAssoc[String]">ACCESS_CONTROL_ALLOW_HEADERS</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.accessControlRequestHeaders" title="List[String]">accessControlRequestHeaders</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>

              <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: play.api.mvc.Result)scala.concurrent.Future[play.api.mvc.Result]">successful</span> <span class="delimiter">{</span>
                <a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc.Results" title="play.api.mvc.Results.type">Results</a>.<a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Results.Ok" title="=&gt; play.api.mvc.Results.Status">Ok</a>.<a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Result.withHeaders" title="(headers: (String, String)*)play.api.mvc.Result">withHeaders</a><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.handlePreFlightCORSRequest.headerBuilder" title="scala.collection.mutable.Builder[(String, String),Seq[(String, String)]]">headerBuilder</a>.<span title="()Seq[(String, String)]">result</span><span class="delimiter">(</span><span class="delimiter">)</span>: _*<span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]" id="play.filters.cors;AbstractCORSPolicy.handleInvalidCORSRequest">handleInvalidCORSRequest</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader" id="play.filters.cors;AbstractCORSPolicy.handleInvalidCORSRequest.request">request</a>: <a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a><span class="delimiter">)</span>: <span title="scala.concurrent.Future[play.api.mvc.Result]">Future</span><span class="delimiter">[</span>Result<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#play.filters.cors;AbstractCORSPolicy.logger" title="=&gt; play.api.LoggerLike">logger</a>.<a href="../../../../play/play/api/Logger.scala.html#play.api;LoggerLike.trace(83d3728a3c)" title="(message: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;&quot;&quot;<span title="String(&quot;Invalid CORS request;Origin=&quot;)">Invalid CORS request;Origin=$</span><span class="delimiter">{</span><a href="#play.filters.cors;AbstractCORSPolicy.handleInvalidCORSRequest.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.headers" title="=&gt; play.api.mvc.Headers">headers</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;Headers.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ORIGIN" title="=&gt; String">ORIGIN</a><span class="delimiter">)</span><span class="delimiter">}</span><span title="String(&quot;;Method=&quot;)">;Method=$</span><span class="delimiter">{</span><a href="#play.filters.cors;AbstractCORSPolicy.handleInvalidCORSRequest.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.method" title="=&gt; String">method</a><span class="delimiter">}</span><span title="String(&quot;;&quot;)">;$</span><span class="delimiter">{</span><a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_REQUEST_HEADERS" title="=&gt; String">ACCESS_CONTROL_REQUEST_HEADERS</a><span class="delimiter">}</span><span title="String(&quot;=&quot;)">=$</span><span class="delimiter">{</span><a href="#play.filters.cors;AbstractCORSPolicy.handleInvalidCORSRequest.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;RequestHeader.headers" title="=&gt; play.api.mvc.Headers">headers</a>.<a href="../../../../play/play/api/mvc/Http.scala.html#play.api.mvc;Headers.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http.HeaderNames" title="play.api.http.HeaderNames.type">HeaderNames</a>.<a href="../../../../play/play/api/http/StandardValues.scala.html#play.api.http;HeaderNames.ACCESS_CONTROL_REQUEST_HEADERS" title="=&gt; String">ACCESS_CONTROL_REQUEST_HEADERS</a><span class="delimiter">)</span><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;&quot;&quot;</span><span class="delimiter">)</span>
    <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: play.api.mvc.Results.Status)scala.concurrent.Future[play.api.mvc.Results.Status]">successful</span><span class="delimiter">(</span><a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc.Results" title="play.api.mvc.Results.type">Results</a>.<a href="../../../../play/play/api/mvc/Results.scala.html#play.api.mvc;Results.Forbidden" title="=&gt; play.api.mvc.Results.Status">Forbidden</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(origin: String)Boolean" id="play.filters.cors;AbstractCORSPolicy.isOriginAllowed">isOriginAllowed</a><span class="delimiter">(</span><a title="String" id="play.filters.cors;AbstractCORSPolicy.isOriginAllowed.origin">origin</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <a href="#play.filters.cors;AbstractCORSPolicy.corsConfig" title="=&gt; play.filters.cors.CORSConfig">corsConfig</a>.<a href="CORSConfig.scala.html#play.filters.cors;CORSConfig.anyOriginAllowed" title="=&gt; Boolean">anyOriginAllowed</a> <span title="(x: Boolean)Boolean">||</span> <a href="#play.filters.cors;AbstractCORSPolicy.corsConfig" title="=&gt; play.filters.cors.CORSConfig">corsConfig</a>.<a href="CORSConfig.scala.html#play.filters.cors;CORSConfig.allowedOrigins" title="=&gt; Set[String]">allowedOrigins</a>.<span title="(elem: String)Boolean">contains</span><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.isOriginAllowed.origin" title="String">origin</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">// http://tools.ietf.org/html/rfc6454#section-7.1</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(origin: String)Boolean" id="play.filters.cors;AbstractCORSPolicy.isValidOrigin">isValidOrigin</a><span class="delimiter">(</span><a title="String" id="play.filters.cors;AbstractCORSPolicy.isValidOrigin.origin">origin</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="comment">// Checks for encoded characters. Helps prevent CRLF injection.</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.isValidOrigin.origin" title="String">origin</a>.<span title="(x$1: CharSequence)Boolean">contains</span><span class="delimiter">(</span><span title="String(&quot;%&quot;)" class="string">&quot;%&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <span title="java.net.URI" class="keyword">new</span> <span title="java.net.URI">URI</span><span class="delimiter">(</span><a href="#play.filters.cors;AbstractCORSPolicy.isValidOrigin.origin" title="String">origin</a><span class="delimiter">)</span>.<span title="()String">getScheme</span> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> _: <span title="java.net.URISyntaxException">URISyntaxException</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
