<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>play/play/api/controllers/Assets.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> controllers

<span class="keyword">import</span> play.api._
<span class="keyword">import</span> play.api.mvc._
<span class="keyword">import</span> play.api.libs._
<span class="keyword">import</span> play.api.libs.iteratee._
<span class="keyword">import</span> java.io._
<span class="keyword">import</span> java.net.<span class="delimiter">{</span> URL, URLConnection, JarURLConnection <span class="delimiter">}</span>
<span class="keyword">import</span> org.joda.time.format.<span class="delimiter">{</span> DateTimeFormatter, DateTimeFormat <span class="delimiter">}</span>
<span class="keyword">import</span> org.joda.time.DateTimeZone
<span class="keyword">import</span> play.utils.<span class="delimiter">{</span> Resources, InvalidUriEncodingException, UriEncoding <span class="delimiter">}</span>
<span class="keyword">import</span> scala.concurrent.<span class="delimiter">{</span> ExecutionContext, Promise, Future, blocking <span class="delimiter">}</span>
<span class="keyword">import</span> scala.util.control.NonFatal
<span class="keyword">import</span> scala.util.<span class="delimiter">{</span> Success, Failure <span class="delimiter">}</span>
<span class="keyword">import</span> java.util.Date
<span class="keyword">import</span> java.util.regex.Pattern
<span class="keyword">import</span> play.api.libs.iteratee.<a href="../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution" title="play.api.libs.iteratee.Execution.type">Execution</a>.Implicits
<span class="keyword">import</span> play.api.http.<span class="delimiter">{</span> LazyHttpErrorHandler, HttpErrorHandler, ContentTypes <span class="delimiter">}</span>
<span class="keyword">import</span> scala.collection.concurrent.TrieMap
<span class="keyword">import</span> play.core.routing.ReverseRouteContext
<span class="keyword">import</span> scala.io.Source
<span class="keyword">import</span> javax.inject.<span class="delimiter">{</span> Inject, Singleton <span class="delimiter">}</span>

<span class="comment">/*
 * A map designed to prevent the &quot;thundering herds&quot; issue.
 *
 * This could be factored out into its own thing, improved and made available more widely. We could also
 * use spray-cache once it has been re-worked into the Akka code base.
 *
 * The essential mechanics of the cache are that all asset requests are remembered, unless their lookup fails or if
 * the asset doesn't exist, in which case we don't remember them in order to avoid an exploit where we would otherwise
 * run out of memory.
 *
 * The population function is executed using the passed-in execution context
 * which may mean that it is on a separate thread thus permitting long running operations to occur. Other threads
 * requiring the same resource will be given the future of the result immediately.
 *
 * There are no explicit bounds on the cache as it isn't considered likely that the number of distinct asset requests would
 * result in an overflow of memory. Bounds are implied given the number of distinct assets that are available to be
 * served by the project.
 *
 * Instead of a SelfPopulatingMap, a better strategy would be to furnish the assets controller with all of the asset
 * information on startup. This shouldn't be that difficult as sbt-web has that information available. Such an
 * approach would result in an immutable map being used which in theory should be faster.
 */</span>
<span class="keyword">private</span> <span class="keyword">class</span> <a title="class SelfPopulatingMap[K, V] extends AnyRef" id="controllers;SelfPopulatingMap">SelfPopulatingMap</a><span class="delimiter">[</span><a title="" id="controllers;SelfPopulatingMap;K">K</a>, <a title="" id="controllers;SelfPopulatingMap;V">V</a><span class="delimiter">]</span> <a href="#controllers;SelfPopulatingMap" title="controllers.SelfPopulatingMap[K,V]" class="delimiter">{</a>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.concurrent.TrieMap[K,scala.concurrent.Future[Option[V]]]" id="controllers;SelfPopulatingMap.store">store</a> = <span title="[A, B](elems: (A, B)*)scala.collection.concurrent.TrieMap[A,B]">TrieMap</span><span title="(elems: (K, scala.concurrent.Future[Option[V]])*)scala.collection.concurrent.TrieMap[K,scala.concurrent.Future[Option[V]]]" class="delimiter">[</span><a href="#controllers;SelfPopulatingMap;K" title="K">K</a>, <span title="scala.concurrent.Future[Option[V]]">Future</span><span class="delimiter">[</span>Option<span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(k: K)(pf: K =&gt; Option[V])(implicit ec: scala.concurrent.ExecutionContext)scala.concurrent.Future[Option[V]]" id="controllers;SelfPopulatingMap.putIfAbsent">putIfAbsent</a><span class="delimiter">(</span><a title="K" id="controllers;SelfPopulatingMap.putIfAbsent.k">k</a>: <a href="#controllers;SelfPopulatingMap;K" title="K">K</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="K =&gt; Option[V]" id="controllers;SelfPopulatingMap.putIfAbsent.pf">pf</a>: K =&gt; Option<span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.ExecutionContext" id="controllers;SelfPopulatingMap.putIfAbsent.ec">ec</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Option[V]]">Future</span><span class="delimiter">[</span>Option<span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.concurrent.Promise[Option[V]]" id="controllers;SelfPopulatingMap.putIfAbsent.p">p</a> = <span title="[T]()scala.concurrent.Promise[T]">Promise</span><span title="()scala.concurrent.Promise[Option[V]]" class="delimiter">[</span><span title="Option[V]">Option</span><span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#controllers;SelfPopulatingMap.store" title="=&gt; scala.collection.concurrent.TrieMap[K,scala.concurrent.Future[Option[V]]]">store</a>.<span title="(k: K, v: scala.concurrent.Future[Option[V]])Option[scala.concurrent.Future[Option[V]]]">putIfAbsent</span><span class="delimiter">(</span><a href="#controllers;SelfPopulatingMap.putIfAbsent.k" title="K">k</a>, <a href="#controllers;SelfPopulatingMap.putIfAbsent.p" title="=&gt; scala.concurrent.Promise[Option[V]]">p</a>.<span title="=&gt; scala.concurrent.Future[Option[V]]">future</span><span class="delimiter">)</span> <span title="scala.concurrent.Future[Option[V]]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="scala.concurrent.Future[Option[V]]">f</span><span class="delimiter">)</span> =&gt; <span title="scala.concurrent.Future[Option[V]]">f</span>
      <span class="keyword">case</span> <span title="None.type">None</span> =&gt;
        <span class="keyword">val</span> <span title="scala.concurrent.Future[Option[V]]">f</span> = <span title="(body: =&gt; Option[V])(implicit execctx: scala.concurrent.ExecutionContext)scala.concurrent.Future[Option[V]]">Future</span><span class="delimiter">(</span><a href="#controllers;SelfPopulatingMap.putIfAbsent.pf" title="(v1: K)Option[V]">pf</a><span class="delimiter">(</span><a href="#controllers;SelfPopulatingMap.putIfAbsent.k" title="K">k</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#controllers;SelfPopulatingMap.putIfAbsent.ec" title="scala.concurrent.ExecutionContext">ec</a>.<span title="()scala.concurrent.ExecutionContext">prepare</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="scala.concurrent.Future[Option[V]]">f</span>.<span title="(func: scala.util.Try[Option[V]] =&gt; Any)(implicit executor: scala.concurrent.ExecutionContext)Unit">onComplete</span> <a href="#controllers;SelfPopulatingMap.putIfAbsent.$anonfun.x0$1" title="Any" class="delimiter">{</a>
          <span class="keyword">case</span> Failure<span class="delimiter">(</span>_<span class="delimiter">)</span> | Success<span class="delimiter">(</span><span title="None.type">None</span><span class="delimiter">)</span> =&gt; <a href="#controllers;SelfPopulatingMap.store" title="=&gt; scala.collection.concurrent.TrieMap[K,scala.concurrent.Future[Option[V]]]">store</a>.<span title="(k: K)Option[scala.concurrent.Future[Option[V]]]">remove</span><span class="delimiter">(</span><a href="#controllers;SelfPopulatingMap.putIfAbsent.k" title="K">k</a><span class="delimiter">)</span>
          <span class="keyword">case</span> _ =&gt; <span class="comment">// Do nothing, the asset was successfully found and is now cached</span>
        <span class="delimiter">}</span>
        <a href="#controllers;SelfPopulatingMap.putIfAbsent.p" title="=&gt; scala.concurrent.Promise[Option[V]]">p</a>.<span title="(other: scala.concurrent.Future[Option[V]])p.type">completeWith</span><span class="delimiter">(</span><span title="scala.concurrent.Future[Option[V]]">f</span><span class="delimiter">)</span>
        <a href="#controllers;SelfPopulatingMap.putIfAbsent.p" title="=&gt; scala.concurrent.Promise[Option[V]]">p</a>.<span title="=&gt; scala.concurrent.Future[Option[V]]">future</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/*
 * Retains meta information regarding an asset that can be readily cached.
 */</span>
<span title="AnyRef" class="keyword">private</span><span class="delimiter">[</span>controllers<span class="delimiter">]</span> <span class="keyword">object</span> <a title="controllers.AssetInfo.type" id="controllers.AssetInfo">AssetInfo</a> <a href="#controllers.AssetInfo" title="controllers.AssetInfo.type" class="delimiter">{</a>

  <span class="keyword">def</span> <a title="[T](lookup: play.api.Configuration =&gt; Option[T])Option[T]" id="controllers.AssetInfo.config">config</a><span class="delimiter">[</span><a title="" id="controllers.AssetInfo.config;T">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.Configuration =&gt; Option[T]" id="controllers.AssetInfo.config.lookup">lookup</a>: Configuration =&gt; Option<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[T]">Option</span><span class="delimiter">[</span>T<span class="delimiter">]</span> = <span class="keyword">for</span> <span class="delimiter">{</span>
    <a title="play.api.Application" id="controllers.AssetInfo.config.$anonfun.app">app</a> &lt;- <a href="../Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../Play.scala.html#play.api.Play.maybeApplication" title="(f: play.api.Application =&gt; Option[T])Option[T]">maybeApplication</a>
    <a title="T" id="controllers.AssetInfo.config.$anonfun.$anonfun.value">value</a> &lt;- <a href="#controllers.AssetInfo.config.lookup" title="(v1: play.api.Configuration)Option[T]">lookup</a><span title="(f: T =&gt; T)Option[T]" class="delimiter">(</span><a href="#controllers.AssetInfo.config.$anonfun.app" title="play.api.Application">app</a>.<a href="../Application.scala.html#play.api;Application.configuration" title="=&gt; play.api.Configuration">configuration</a><span class="delimiter">)</span>
  <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#controllers.AssetInfo.config.$anonfun.$anonfun.value" title="T">value</a>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="controllers.AssetInfo.isDev">isDev</a> = <a href="../Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../Play.scala.html#play.api.Play.maybeApplication" title="=&gt; Option[play.api.Application]">maybeApplication</a>.<span title="(ifEmpty: =&gt; Boolean)(f: play.api.Application =&gt; Boolean)Boolean">fold</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#controllers.AssetInfo.isDev.$anonfun.x$1" title="play.api.Application">_</a>.<a href="../Application.scala.html#play.api;Application.mode" title="=&gt; play.api.Mode.Mode">mode</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../Play.scala.html#play.api.Mode" title="play.api.Mode.type">Mode</a>.<a href="../Play.scala.html#play.api.Mode.Dev" title="=&gt; play.api.Mode.Value">Dev</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="controllers.AssetInfo.isProd">isProd</a> = <a href="../Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../Play.scala.html#play.api.Play.maybeApplication" title="=&gt; Option[play.api.Application]">maybeApplication</a>.<span title="(ifEmpty: =&gt; Boolean)(f: play.api.Application =&gt; Boolean)Boolean">fold</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#controllers.AssetInfo.isProd.$anonfun.x$2" title="play.api.Application">_</a>.<a href="../Application.scala.html#play.api;Application.mode" title="=&gt; play.api.Mode.Mode">mode</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../Play.scala.html#play.api.Mode" title="play.api.Mode.type">Mode</a>.<a href="../Play.scala.html#play.api.Mode.Prod" title="=&gt; play.api.Mode.Value">Prod</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(name: String)Option[java.net.URL]" id="controllers.AssetInfo.resource">resource</a><span class="delimiter">(</span><a title="String" id="controllers.AssetInfo.resource.name">name</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[java.net.URL]">Option</span><span class="delimiter">[</span>URL<span class="delimiter">]</span> = <span class="keyword">for</span> <span class="delimiter">{</span>
    <a title="play.api.Application" id="controllers.AssetInfo.resource.$anonfun.app">app</a> &lt;- <a href="../Play.scala.html#play.api.Play" title="play.api.Play.type">Play</a>.<a href="../Play.scala.html#play.api.Play.maybeApplication" title="(f: play.api.Application =&gt; Option[java.net.URL])Option[java.net.URL]">maybeApplication</a>
    <a title="java.net.URL" id="controllers.AssetInfo.resource.$anonfun.$anonfun.resource">resource</a> &lt;- <a href="#controllers.AssetInfo.resource.$anonfun.app" title="play.api.Application">app</a>.<a href="../Application.scala.html#play.api;Application.resource" title="(name: String)Option[java.net.URL]">resource</a><span title="(f: java.net.URL =&gt; java.net.URL)Option[java.net.URL]" class="delimiter">(</span><a href="#controllers.AssetInfo.resource.name" title="String">name</a><span class="delimiter">)</span>
  <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#controllers.AssetInfo.resource.$anonfun.$anonfun.resource" title="java.net.URL">resource</a>

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="String" id="controllers.AssetInfo.defaultCharSet">defaultCharSet</a> = <a href="#controllers.AssetInfo.config" title="(lookup: play.api.Configuration =&gt; Option[String])Option[String]">config</a><span class="delimiter">(</span><a href="#controllers.AssetInfo.defaultCharSet.$anonfun.x$3" title="play.api.Configuration">_</a>.<a href="../Configuration.scala.html#play.api;Configuration.getString" title="(path: String, validValues: Option[Set[String]])Option[String]">getString</a><span class="delimiter">(</span><span title="String(&quot;default.charset&quot;)" class="string">&quot;default.charset&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><span title="String(&quot;utf-8&quot;)" class="string">&quot;utf-8&quot;</span><span class="delimiter">)</span>

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="String" id="controllers.AssetInfo.defaultCacheControl">defaultCacheControl</a> = <a href="#controllers.AssetInfo.config" title="(lookup: play.api.Configuration =&gt; Option[String])Option[String]">config</a><span class="delimiter">(</span><a href="#controllers.AssetInfo.defaultCacheControl.$anonfun.x$4" title="play.api.Configuration">_</a>.<a href="../Configuration.scala.html#play.api;Configuration.getString" title="(path: String, validValues: Option[Set[String]])Option[String]">getString</a><span class="delimiter">(</span><span title="String(&quot;assets.defaultCache&quot;)" class="string">&quot;assets.defaultCache&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><span title="String(&quot;public, max-age=3600&quot;)" class="string">&quot;public, max-age=3600&quot;</span><span class="delimiter">)</span>

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="String" id="controllers.AssetInfo.aggressiveCacheControl">aggressiveCacheControl</a> = <a href="#controllers.AssetInfo.config" title="(lookup: play.api.Configuration =&gt; Option[String])Option[String]">config</a><span class="delimiter">(</span><a href="#controllers.AssetInfo.aggressiveCacheControl.$anonfun.x$5" title="play.api.Configuration">_</a>.<a href="../Configuration.scala.html#play.api;Configuration.getString" title="(path: String, validValues: Option[Set[String]])Option[String]">getString</a><span class="delimiter">(</span><span title="String(&quot;assets.aggressiveCache&quot;)" class="string">&quot;assets.aggressiveCache&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><span title="String(&quot;public, max-age=31536000&quot;)" class="string">&quot;public, max-age=31536000&quot;</span><span class="delimiter">)</span>

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="String" id="controllers.AssetInfo.digestAlgorithm">digestAlgorithm</a> = <a href="#controllers.AssetInfo.config" title="(lookup: play.api.Configuration =&gt; Option[String])Option[String]">config</a><span class="delimiter">(</span><a href="#controllers.AssetInfo.digestAlgorithm.$anonfun.x$6" title="play.api.Configuration">_</a>.<a href="../Configuration.scala.html#play.api;Configuration.getString" title="(path: String, validValues: Option[Set[String]])Option[String]">getString</a><span class="delimiter">(</span><span title="String(&quot;assets.digest.algorithm&quot;)" class="string">&quot;assets.digest.algorithm&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><span title="String(&quot;md5&quot;)" class="string">&quot;md5&quot;</span><span class="delimiter">)</span>

  <span class="keyword">import</span> <a href="../mvc/Results.scala.html#play.api.mvc.ResponseHeader" title="play.api.mvc.ResponseHeader.type">ResponseHeader</a>.basicDateFormatPattern

  <span class="keyword">val</span> <a title="org.joda.time.format.DateTimeFormatter" id="controllers.AssetInfo.standardDateParserWithoutTZ">standardDateParserWithoutTZ</a>: <span title="org.joda.time.format.DateTimeFormatter">DateTimeFormatter</span> =
    <span title="org.joda.time.format.DateTimeFormat.type">DateTimeFormat</span>.<span title="(x$1: String)org.joda.time.format.DateTimeFormatter">forPattern</span><span class="delimiter">(</span><a href="../mvc/Results.scala.html#play.api.mvc.ResponseHeader.basicDateFormatPattern" title="=&gt; String">basicDateFormatPattern</a><span class="delimiter">)</span>.<span title="(x$1: java.util.Locale)org.joda.time.format.DateTimeFormatter">withLocale</span><span class="delimiter">(</span>java.util.<span title="java.util.Locale.type">Locale</span>.<span title="java.util.Locale">ENGLISH</span><span class="delimiter">)</span>.<span title="(x$1: org.joda.time.DateTimeZone)org.joda.time.format.DateTimeFormatter">withZone</span><span class="delimiter">(</span><span title="org.joda.time.DateTimeZone.type">DateTimeZone</span>.<span title="org.joda.time.DateTimeZone">UTC</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="org.joda.time.format.DateTimeFormatter" id="controllers.AssetInfo.alternativeDateFormatWithTZOffset">alternativeDateFormatWithTZOffset</a>: <span title="org.joda.time.format.DateTimeFormatter">DateTimeFormatter</span> =
    <span title="org.joda.time.format.DateTimeFormat.type">DateTimeFormat</span>.<span title="(x$1: String)org.joda.time.format.DateTimeFormatter">forPattern</span><span class="delimiter">(</span><span title="String(&quot;EEE MMM dd yyyy HH:mm:ss \'GMT\'Z&quot;)" class="string">&quot;EEE MMM dd yyyy HH:mm:ss 'GMT'Z&quot;</span><span class="delimiter">)</span>.<span title="(x$1: java.util.Locale)org.joda.time.format.DateTimeFormatter">withLocale</span><span class="delimiter">(</span>java.util.<span title="java.util.Locale.type">Locale</span>.<span title="java.util.Locale">ENGLISH</span><span class="delimiter">)</span>.<span title="(x$1: org.joda.time.DateTimeZone)org.joda.time.format.DateTimeFormatter">withZone</span><span class="delimiter">(</span><span title="org.joda.time.DateTimeZone.type">DateTimeZone</span>.<span title="org.joda.time.DateTimeZone">UTC</span><span class="delimiter">)</span>.<span title="()org.joda.time.format.DateTimeFormatter">withOffsetParsed</span>

  <span class="comment">/**
   * A regex to find two types of date format. This regex silently ignores any
   * trailing info such as extra header attributes (&quot;; length=123&quot;) or
   * timezone names (&quot;(Pacific Standard Time&quot;).
   * - &quot;Sat, 18 Oct 2014 20:41:26&quot; and &quot;Sat, 29 Oct 1994 19:43:31 GMT&quot; use the first
   *   matcher. (The &quot; GMT&quot; is discarded to give them the same format.)
   * - &quot;Wed Jan 07 2015 22:54:20 GMT-0800&quot; uses the second matcher.
   */</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.regex.Pattern" id="controllers.AssetInfo.dateRecognizer">dateRecognizer</a> = <span title="java.util.regex.Pattern.type">Pattern</span>.<span title="(x$1: String)java.util.regex.Pattern">compile</span><span class="delimiter">(</span>
    <span class="string">&quot;&quot;&quot;^(((\w\w\w, \d\d \w\w\w \d\d\d\d \d\d:\d\d:\d\d)(( GMT)?))|&quot;&quot;&quot;</span> <span title="String(&quot;^(((\\w\\w\\w, \\d\\d \\w\\w\\w \\d\\d\\d\\d \\d\\d:\\d\\d:\\d\\d)(( GMT)?))|(\\w\\w\\w \\w\\w\\w \\d\\d \\d\\d\\d\\d \\d\\d:\\d\\d:\\d\\d GMT.\\d\\d\\d\\d))(\\b.*)&quot;)">+</span>
      <span class="string">&quot;&quot;&quot;(\w\w\w \w\w\w \d\d \d\d\d\d \d\d:\d\d:\d\d GMT.\d\d\d\d))(\b.*)&quot;&quot;&quot;</span><span class="delimiter">)</span>

  <span class="comment">/*
   * jodatime does not parse timezones, so we handle that manually
   */</span>
  <span class="keyword">def</span> <a title="(date: String)Option[java.util.Date]" id="controllers.AssetInfo.parseModifiedDate">parseModifiedDate</a><span class="delimiter">(</span><a title="String" id="controllers.AssetInfo.parseModifiedDate.date">date</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[java.util.Date]">Option</span><span class="delimiter">[</span>Date<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.util.regex.Matcher" id="controllers.AssetInfo.parseModifiedDate.matcher">matcher</a> = <a href="#controllers.AssetInfo.dateRecognizer" title="=&gt; java.util.regex.Pattern">dateRecognizer</a>.<span title="(x$1: CharSequence)java.util.regex.Matcher">matcher</span><span class="delimiter">(</span><a href="#controllers.AssetInfo.parseModifiedDate.date" title="String">date</a><span class="delimiter">)</span>
    <span title="Option[java.util.Date]" class="keyword">if</span> <span class="delimiter">(</span><a href="#controllers.AssetInfo.parseModifiedDate.matcher" title="java.util.regex.Matcher">matcher</a>.<span title="()Boolean">matches</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="controllers.AssetInfo.parseModifiedDate.standardDate">standardDate</a> = <a href="#controllers.AssetInfo.parseModifiedDate.matcher" title="java.util.regex.Matcher">matcher</a>.<span title="(x$1: Int)String">group</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <span title="Some[java.util.Date]" class="keyword">if</span> <span class="delimiter">(</span><a href="#controllers.AssetInfo.parseModifiedDate.standardDate" title="String">standardDate</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="(x: java.util.Date)Some[java.util.Date]">Some</span><span class="delimiter">(</span><a href="#controllers.AssetInfo.standardDateParserWithoutTZ" title="=&gt; org.joda.time.format.DateTimeFormatter">standardDateParserWithoutTZ</a>.<span title="(x$1: String)org.joda.time.DateTime">parseDateTime</span><span class="delimiter">(</span><a href="#controllers.AssetInfo.parseModifiedDate.standardDate" title="String">standardDate</a><span class="delimiter">)</span>.<span title="()java.util.Date">toDate</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="String" id="controllers.AssetInfo.parseModifiedDate.alternativeDate">alternativeDate</a> = <a href="#controllers.AssetInfo.parseModifiedDate.matcher" title="java.util.regex.Matcher">matcher</a>.<span title="(x$1: Int)String">group</span><span class="delimiter">(</span><span title="Int(6)" class="int">6</span><span class="delimiter">)</span> <span class="comment">// Cannot be null otherwise match would have failed</span>
          <span title="(x: java.util.Date)Some[java.util.Date]">Some</span><span class="delimiter">(</span><a href="#controllers.AssetInfo.alternativeDateFormatWithTZOffset" title="=&gt; org.joda.time.format.DateTimeFormatter">alternativeDateFormatWithTZOffset</a>.<span title="(x$1: String)org.joda.time.DateTime">parseDateTime</span><span class="delimiter">(</span><a href="#controllers.AssetInfo.parseModifiedDate.alternativeDate" title="String">alternativeDate</a><span class="delimiter">)</span>.<span title="()java.util.Date">toDate</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="IllegalArgumentException" id="controllers.AssetInfo.parseModifiedDate.e">e</a>: <span title="IllegalArgumentException">IllegalArgumentException</span> =&gt;
          <a href="../Logger.scala.html#play.api.Logger" title="play.api.Logger.type">Logger</a>.<a href="../Logger.scala.html#play.api;LoggerLike.debug(804ef4765b)" title="(message: =&gt; String, error: =&gt; Throwable)Unit">debug</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;An invalid date was received: couldn\'t parse: &quot;)">An invalid date was received: couldn't parse: $</span><a href="#controllers.AssetInfo.parseModifiedDate.date" title="String">date</a><span title="String(&quot;&quot;)" class="string">&quot;</span>, <a href="#controllers.AssetInfo.parseModifiedDate.e" title="IllegalArgumentException">e</a><span class="delimiter">)</span>
          <span title="None.type">None</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="../Logger.scala.html#play.api.Logger" title="play.api.Logger.type">Logger</a>.<a href="../Logger.scala.html#play.api;LoggerLike.debug(83d3728a3c)" title="(message: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;An invalid date was received: unrecognized format: &quot;)">An invalid date was received: unrecognized format: $</span><a href="#controllers.AssetInfo.parseModifiedDate.date" title="String">date</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
      <span title="None.type">None</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/*
 * Retain meta information regarding an asset.
 */</span>
<span title="AnyRef" class="keyword">private</span><span class="delimiter">[</span>controllers<span class="delimiter">]</span> <span class="keyword">class</span> <a title="class AssetInfo extends AnyRef" id="controllers;AssetInfo">AssetInfo</a><a href="#controllers;AssetInfo" title="controllers.AssetInfo" class="delimiter">(</a>
    <span class="keyword">val</span> <a title="String" id="controllers;AssetInfo.name">name</a>: <span title="String">String</span>,
    <span class="keyword">val</span> <a title="java.net.URL" id="controllers;AssetInfo.url">url</a>: <span title="java.net.URL">URL</span>,
    <span class="keyword">val</span> <a title="Option[java.net.URL]" id="controllers;AssetInfo.gzipUrl">gzipUrl</a>: <span title="Option[java.net.URL]">Option</span><span class="delimiter">[</span>URL<span class="delimiter">]</span>,
    <span class="keyword">val</span> <a title="Option[String]" id="controllers;AssetInfo.digest">digest</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">import</span> <a href="#controllers.AssetInfo" title="controllers.AssetInfo.type">AssetInfo</a>._
  <span class="keyword">import</span> <a href="../mvc/Results.scala.html#play.api.mvc.ResponseHeader" title="play.api.mvc.ResponseHeader.type">ResponseHeader</a>._

  <span class="keyword">def</span> <a title="(mimeType: String)String" id="controllers;AssetInfo.addCharsetIfNeeded">addCharsetIfNeeded</a><span class="delimiter">(</span><a title="String" id="controllers;AssetInfo.addCharsetIfNeeded.mimeType">mimeType</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> =
    <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="../libs/MimeTypes.scala.html#play.api.libs.MimeTypes" title="play.api.libs.MimeTypes.type">MimeTypes</a>.<a href="../libs/MimeTypes.scala.html#play.api.libs.MimeTypes.isText" title="(mimeType: String)Boolean">isText</a><span class="delimiter">(</span><a href="#controllers;AssetInfo.addCharsetIfNeeded.mimeType" title="String">mimeType</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;&quot;)">$</span><a href="#controllers;AssetInfo.addCharsetIfNeeded.mimeType" title="String">mimeType</a><span title="String(&quot;; charset=&quot;)">; charset=$</span><a href="#controllers.AssetInfo.defaultCharSet" title="=&gt; String">defaultCharSet</a><span title="String(&quot;&quot;)" class="string">&quot;</span> <span class="keyword">else</span> <a href="#controllers;AssetInfo.addCharsetIfNeeded.mimeType" title="String">mimeType</a>

  <span class="keyword">val</span> <a title="Option[String]" id="controllers;AssetInfo.configuredCacheControl">configuredCacheControl</a> = <a href="#controllers.AssetInfo.config" title="(lookup: play.api.Configuration =&gt; Option[String])Option[String]">config</a><span class="delimiter">(</span><a href="#controllers;AssetInfo.configuredCacheControl.$anonfun.x$7" title="play.api.Configuration">_</a>.<a href="../Configuration.scala.html#play.api;Configuration.getString" title="(path: String, validValues: Option[Set[String]])Option[String]">getString</a><span class="delimiter">(</span><span title="String(&quot;\&quot;assets.cache.&quot;)" class="string">&quot;\&quot;assets.cache.&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#controllers;AssetInfo.name" title="=&gt; String">name</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(aggressiveCaching: Boolean)String" id="controllers;AssetInfo.cacheControl">cacheControl</a><span class="delimiter">(</span><a title="Boolean" id="controllers;AssetInfo.cacheControl.aggressiveCaching">aggressiveCaching</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <a href="#controllers;AssetInfo.configuredCacheControl" title="=&gt; Option[String]">configuredCacheControl</a>.<span title="(default: =&gt; String)String">getOrElse</span> <span class="delimiter">{</span>
      <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#controllers.AssetInfo.isProd" title="=&gt; Boolean">isProd</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#controllers;AssetInfo.cacheControl.aggressiveCaching" title="Boolean">aggressiveCaching</a><span class="delimiter">)</span> <a href="#controllers.AssetInfo.aggressiveCacheControl" title="=&gt; String">aggressiveCacheControl</a> <span class="keyword">else</span> <a href="#controllers.AssetInfo.defaultCacheControl" title="=&gt; String">defaultCacheControl</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span title="String(&quot;no-cache&quot;)" class="string">&quot;no-cache&quot;</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">val</span> <a title="Option[String]" id="controllers;AssetInfo.lastModified">lastModified</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="[T &lt;: java.net.URLConnection](f: T =&gt; Long)Option[String]" id="controllers;AssetInfo.lastModified.getLastModified">getLastModified</a><span class="delimiter">[</span><a title=" &lt;: java.net.URLConnection" id="controllers;AssetInfo.lastModified.getLastModified;T">T</a> &lt;: URLConnection<span class="delimiter">]</span><span class="delimiter">(</span><a title="T =&gt; Long" id="controllers;AssetInfo.lastModified.getLastModified.f">f</a>: <span class="delimiter">(</span>T<span class="delimiter">)</span> =&gt; Long<span class="delimiter">)</span>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span title="(x: java.net.URLConnection)Option[java.net.URLConnection]">Option</span><span class="delimiter">(</span><a href="#controllers;AssetInfo.url" title="=&gt; java.net.URL">url</a>.<span title="()java.net.URLConnection">openConnection</span><span class="delimiter">)</span>.<span title="(f: java.net.URLConnection =&gt; Long)Option[Long]">map</span> <a href="#controllers;AssetInfo.lastModified.getLastModified.$anonfun.x0$2" title="Long" class="delimiter">{</a>
        <span class="keyword">case</span> <a title="T @unchecked" id="controllers;AssetInfo.lastModified.getLastModified.$anonfun.urlConnection">urlConnection</a>: T @<a href="#controllers;AssetInfo.lastModified.getLastModified;T" title="T @unchecked">unchecked</a> =&gt;
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <a href="#controllers;AssetInfo.lastModified.getLastModified.f" title="(v1: T)Long">f</a><span class="delimiter">(</span><a href="#controllers;AssetInfo.lastModified.getLastModified.$anonfun.urlConnection" title="T @unchecked">urlConnection</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
            <a href="../../utils/Resources.scala.html#play.utils.Resources" title="play.utils.Resources.type">Resources</a>.<a href="../../utils/Resources.scala.html#play.utils.Resources.closeUrlConnection" title="(connection: java.net.URLConnection)Unit">closeUrlConnection</a><span class="delimiter">(</span><a href="#controllers;AssetInfo.lastModified.getLastModified.$anonfun.urlConnection" title="T @unchecked">urlConnection</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>.<span title="(p: Long =&gt; Boolean)Option[Long]">filterNot</span><span class="delimiter">(</span><a href="#controllers;AssetInfo.lastModified.getLastModified.$anonfun.x$8" title="Long">_</a> <span title="(x: Int)Boolean">==</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span>.<span title="(f: Long =&gt; String)Option[String]">map</span><span class="delimiter">(</span><a href="../mvc/Results.scala.html#play.api.mvc.ResponseHeader.httpDateFormat" title="=&gt; org.joda.time.format.DateTimeFormatter">httpDateFormat</a>.<a href="#controllers;AssetInfo.lastModified.getLastModified.$anonfun.x$1" title="(x$1: Long)String">print</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#controllers;AssetInfo.url" title="=&gt; java.net.URL">url</a>.<span title="()String">getProtocol</span> <span title="Option[String]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="String(&quot;file&quot;)" class="string">&quot;file&quot;</span> =&gt; <span title="(x: String)Some[String]">Some</span><span class="delimiter">(</span><a href="../mvc/Results.scala.html#play.api.mvc.ResponseHeader.httpDateFormat" title="=&gt; org.joda.time.format.DateTimeFormatter">httpDateFormat</a>.<span title="(x$1: Long)String">print</span><span class="delimiter">(</span><span title="(x$1: java.net.URI)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#controllers;AssetInfo.url" title="=&gt; java.net.URL">url</a>.<span title="()java.net.URI">toURI</span><span class="delimiter">)</span>.<span title="()Long">lastModified</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="String(&quot;jar&quot;)" class="string">&quot;jar&quot;</span> =&gt; <a href="#controllers;AssetInfo.lastModified.getLastModified" title="[T &lt;: java.net.URLConnection](f: T =&gt; Long)Option[String]">getLastModified</a><span title="(f: java.net.JarURLConnection =&gt; Long)Option[String]" class="delimiter">[</span><span title="java.net.JarURLConnection">JarURLConnection</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="java.net.JarURLConnection">c</span> =&gt; <span title="java.net.JarURLConnection">c</span>.<span title="()java.util.jar.JarEntry">getJarEntry</span>.<span title="()Long">getTime</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="String(&quot;bundle&quot;)" class="string">&quot;bundle&quot;</span> =&gt; <a href="#controllers;AssetInfo.lastModified.getLastModified" title="[T &lt;: java.net.URLConnection](f: T =&gt; Long)Option[String]">getLastModified</a><span title="(f: java.net.URLConnection =&gt; Long)Option[String]" class="delimiter">[</span><span title="java.net.URLConnection">URLConnection</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="java.net.URLConnection">c</span> =&gt; <span title="java.net.URLConnection">c</span>.<span title="()Long">getLastModified</span><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt; <span title="None.type">None</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">val</span> <a title="Option[String]" id="controllers;AssetInfo.etag">etag</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> =
    <a href="#controllers;AssetInfo.digest" title="=&gt; Option[String]">digest</a> <span title="(alternative: =&gt; Option[String])Option[String]">orElse</span> <span class="delimiter">{</span> <a href="#controllers;AssetInfo.lastModified" title="=&gt; Option[String]">lastModified</a> <span title="(f: String =&gt; String)Option[String]">map</span> <span class="delimiter">(</span><a title="String" id="controllers;AssetInfo.etag.$anonfun.m">m</a> =&gt; <a href="../libs/Codecs.scala.html#play.api.libs.Codecs" title="play.api.libs.Codecs.type">Codecs</a>.<a href="../libs/Codecs.scala.html#play.api.libs.Codecs.sha1(d814a8dff5)" title="(text: String)String">sha1</a><span class="delimiter">(</span><a href="#controllers;AssetInfo.etag.$anonfun.m" title="String">m</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; -&gt; &quot;)" class="string">&quot; -&gt; &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#controllers;AssetInfo.url" title="=&gt; java.net.URL">url</a>.<span title="()String">toExternalForm</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span> <span title="(f: String =&gt; String)Option[String]">map</span> <span class="delimiter">(</span><span title="String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#controllers;AssetInfo.etag.$anonfun.x$9" title="String">_</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="String" id="controllers;AssetInfo.mimeType">mimeType</a>: <span title="String">String</span> = <a href="../libs/MimeTypes.scala.html#play.api.libs.MimeTypes" title="play.api.libs.MimeTypes.type">MimeTypes</a>.<a href="../libs/MimeTypes.scala.html#play.api.libs.MimeTypes.forFileName" title="(name: String)Option[String]">forFileName</a><span class="delimiter">(</span><a href="#controllers;AssetInfo.name" title="=&gt; String">name</a><span class="delimiter">)</span>.<span title="(ifEmpty: =&gt; String)(f: String =&gt; String)String">fold</span><span class="delimiter">(</span><a href="../http/StandardValues.scala.html#play.api.http.ContentTypes" title="play.api.http.ContentTypes.type">ContentTypes</a>.<a href="../http/StandardValues.scala.html#play.api.http;ContentTypes.BINARY" title="=&gt; String">BINARY</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#controllers;AssetInfo.addCharsetIfNeeded" title="(mimeType: String)String">addCharsetIfNeeded</a><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="Option[java.util.Date]" id="controllers;AssetInfo.parsedLastModified">parsedLastModified</a> = <a href="#controllers;AssetInfo.lastModified" title="=&gt; Option[String]">lastModified</a> <span title="(f: String =&gt; Option[java.util.Date])Option[java.util.Date]">flatMap</span> <a href="#controllers.AssetInfo.parseModifiedDate" title="(date: String)Option[java.util.Date]">parseModifiedDate</a>

  <span class="keyword">def</span> <a title="(gzipAvailable: Boolean)java.net.URL" id="controllers;AssetInfo.url(998a4083b2)">url</a><span class="delimiter">(</span><a title="Boolean" id="controllers;AssetInfo.url(998a4083b2).gzipAvailable">gzipAvailable</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="java.net.URL">URL</span> = <span class="delimiter">{</span>
    <a href="#controllers;AssetInfo.gzipUrl" title="=&gt; Option[java.net.URL]">gzipUrl</a> <span title="java.net.URL" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="java.net.URL" id="controllers;AssetInfo.url(998a4083b2).x">x</a><span class="delimiter">)</span> =&gt; <span title="java.net.URL" class="keyword">if</span> <span class="delimiter">(</span><a href="#controllers;AssetInfo.url(998a4083b2).gzipAvailable" title="Boolean">gzipAvailable</a><span class="delimiter">)</span> <a href="#controllers;AssetInfo.url(998a4083b2).x" title="java.net.URL">x</a> <span class="keyword">else</span> <a href="#controllers;AssetInfo.url" title="=&gt; java.net.URL">url</a>
      <span class="keyword">case</span> <span title="None.type">None</span> =&gt; <a href="#controllers;AssetInfo.url" title="=&gt; java.net.URL">url</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Controller that serves static resources.
 *
 * Resources are searched in the classpath.
 *
 * It handles Last-Modified and ETag header automatically.
 * If a gzipped version of a resource is found (Same resource name with the .gz suffix), it is served instead. If a
 * digest file is available for a given asset then its contents are read and used to supply a digest value. This value will be used for
 * serving up ETag values and for the purposes of reverse routing. For example given &quot;a.js&quot;, if there is an &quot;a.js.md5&quot;
 * file available then the latter contents will be used to determine the Etag value.
 * The reverse router also uses the digest in order to translate any file to the form &amp;lt;digest&amp;gt;-&amp;lt;asset&amp;gt; for
 * example &quot;a.js&quot; may be also found at &quot;d41d8cd98f00b204e9800998ecf8427e-a.js&quot;.
 * If there is no digest file found then digest values for ETags are formed by forming a sha1 digest of the last-modified
 * time.
 *
 * The default digest algorithm to search for is &quot;md5&quot;. You can override this quite easily. For example if the SHA-1
 * algorithm is preferred:
 *
 * {{{
 * &quot;assets.digest.algorithm&quot; = &quot;sha1&quot;
 * }}}
 *
 * You can set a custom Cache directive for a particular resource if needed. For example in your application.conf file:
 *
 * {{{
 * &quot;assets.cache./public/images/logo.png&quot; = &quot;max-age=3600&quot;
 * }}}
 *
 * You can use this controller in any application, just by declaring the appropriate route. For example:
 * {{{
 * GET     /assets/\uFEFF*file               controllers.Assets.at(path=&quot;/public&quot;, file)
 * }}}
 */</span>
<span title="AnyRef" class="keyword">object</span> <a title="controllers.Assets.type" id="controllers.Assets">Assets</a> <a href="#controllers.Assets" title="controllers.Assets.type" class="keyword">extends</a> <a href="#controllers;AssetsBuilder" title="controllers.AssetsBuilder">AssetsBuilder</a><span class="delimiter">(</span><a href="../http/HttpErrorHandler.scala.html#play.api.http.LazyHttpErrorHandler" title="play.api.http.LazyHttpErrorHandler.type">LazyHttpErrorHandler</a><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">import</span> <a href="#controllers.AssetInfo" title="controllers.AssetInfo.type">AssetInfo</a>._

  <span class="comment">// Caching. It is unfortunate that we require both a digestCache and an assetInfo cache given that digest info is</span>
  <span class="comment">// part of asset information. The reason for this is that the assetInfo cache returns a Future[AssetInfo] in order to</span>
  <span class="comment">// avoid any thundering herds issue. The unbind method of the assetPathBindable doesn't support the return of a</span>
  <span class="comment">// Future - unbinds are expected to be blocking. Thus we separate out the caching of a digest from the caching of</span>
  <span class="comment">// full asset information. At least the determination of the digest should be relatively quick (certainly not as</span>
  <span class="comment">// involved as determining the full asset info).</span>

  <span class="keyword">val</span> <a title="scala.collection.concurrent.TrieMap[String,Option[String]]" id="controllers.Assets.digestCache">digestCache</a> = <span title="[A, B](elems: (A, B)*)scala.collection.concurrent.TrieMap[A,B]">TrieMap</span><span title="(elems: (String, Option[String])*)scala.collection.concurrent.TrieMap[String,Option[String]]" class="delimiter">[</span><span title="String">String</span>, <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">private</span><span class="delimiter">[</span>controllers<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(path: String)Option[String]" id="controllers.Assets.digest">digest</a><span class="delimiter">(</span><a title="String" id="controllers.Assets.digest.path">path</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#controllers.Assets.digestCache" title="=&gt; scala.collection.concurrent.TrieMap[String,Option[String]]">digestCache</a>.<span title="(key: String, default: =&gt; Option[String])Option[String]">getOrElse</span><span class="delimiter">(</span><a href="#controllers.Assets.digest.path" title="String">path</a>, <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Option[java.net.URL]" id="controllers.Assets.digest.maybeDigestUrl">maybeDigestUrl</a>: <span title="Option[java.net.URL]">Option</span><span class="delimiter">[</span>URL<span class="delimiter">]</span> = <a href="#controllers.AssetInfo.resource" title="(name: String)Option[java.net.URL]">resource</a><span class="delimiter">(</span><a href="#controllers.Assets.digest.path" title="String">path</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;.&quot;)" class="string">&quot;.&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#controllers.AssetInfo.digestAlgorithm" title="=&gt; String">digestAlgorithm</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Option[String]" id="controllers.Assets.digest.maybeDigest">maybeDigest</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#controllers.Assets.digest.maybeDigestUrl" title="Option[java.net.URL]">maybeDigestUrl</a>.<span title="(f: java.net.URL =&gt; String)Option[String]">map</span><span class="delimiter">(</span><span title="scala.io.Source.type">Source</span>.<span title="(url: java.net.URL)(implicit codec: scala.io.Codec)scala.io.BufferedSource">fromURL</span><span title="=&gt; scala.io.Codec" class="delimiter">(</span><a href="#controllers.Assets.digest.maybeDigest.$anonfun.x$10" title="java.net.URL">_</a><span class="delimiter">)</span>.<span title="=&gt; String">mkString</span><span class="delimiter">)</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#controllers.AssetInfo.isDev" title="=&gt; Boolean">isDev</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#controllers.Assets.digest.maybeDigest" title="Option[String]">maybeDigest</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="#controllers.Assets.digestCache" title="=&gt; scala.collection.concurrent.TrieMap[String,Option[String]]">digestCache</a>.<span title="(key: String, value: Option[String])Option[Option[String]]">put</span><span class="delimiter">(</span><a href="#controllers.Assets.digest.path" title="String">path</a>, <a href="#controllers.Assets.digest.maybeDigest" title="Option[String]">maybeDigest</a><span class="delimiter">)</span>
      <a href="#controllers.Assets.digest.maybeDigest" title="Option[String]">maybeDigest</a>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">// Sames goes for the minified paths cache.</span>
  <span class="keyword">val</span> <a title="scala.collection.concurrent.TrieMap[String,String]" id="controllers.Assets.minifiedPathsCache">minifiedPathsCache</a> = <span title="[A, B](elems: (A, B)*)scala.collection.concurrent.TrieMap[A,B]">TrieMap</span><span title="(elems: (String, String)*)scala.collection.concurrent.TrieMap[String,String]" class="delimiter">[</span><span title="String">String</span>, <span title="String">String</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Boolean" id="controllers.Assets.checkForMinified">checkForMinified</a> = <a href="#controllers.AssetInfo.config" title="(lookup: play.api.Configuration =&gt; Option[Boolean])Option[Boolean]">config</a><span class="delimiter">(</span><a href="#controllers.Assets.checkForMinified.$anonfun.x$11" title="play.api.Configuration">_</a>.<a href="../Configuration.scala.html#play.api;Configuration.getBoolean" title="(path: String)Option[Boolean]">getBoolean</a><span class="delimiter">(</span><span title="String(&quot;assets.checkForMinified&quot;)" class="string">&quot;assets.checkForMinified&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; Boolean)Boolean">getOrElse</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

  <span class="keyword">private</span><span class="delimiter">[</span>controllers<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(path: String)String" id="controllers.Assets.minifiedPath">minifiedPath</a><span class="delimiter">(</span><a title="String" id="controllers.Assets.minifiedPath.path">path</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <a href="#controllers.Assets.minifiedPathsCache" title="=&gt; scala.collection.concurrent.TrieMap[String,String]">minifiedPathsCache</a>.<span title="(key: String, default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><a href="#controllers.Assets.minifiedPath.path" title="String">path</a>, <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(delim: Char)Option[String]" id="controllers.Assets.minifiedPath.minifiedPathFor">minifiedPathFor</a><span class="delimiter">(</span><a title="Char" id="controllers.Assets.minifiedPath.minifiedPathFor.delim">delim</a>: <span title="Char">Char</span><span class="delimiter">)</span>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="String" id="controllers.Assets.minifiedPath.minifiedPathFor.ext">ext</a> = <a href="#controllers.Assets.minifiedPath.path" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">path</a>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">reverse</span>.<span title="(p: Char =&gt; Boolean)String">takeWhile</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="delimiter">(</span><a href="#controllers.Assets.minifiedPath.minifiedPathFor.ext.$anonfun.x$12" title="Char">_</a> <span title="(x: Char)Boolean">!=</span> <span title="Char('.')" class="char">'.'</span><span class="delimiter">)</span>.<span title="=&gt; String">reverse</span>
        <span class="keyword">val</span> <a title="String" id="controllers.Assets.minifiedPath.minifiedPathFor.noextPath">noextPath</a> = <a href="#controllers.Assets.minifiedPath.path" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">path</a>.<span title="(n: Int)String">dropRight</span><span class="delimiter">(</span><a href="#controllers.Assets.minifiedPath.minifiedPathFor.ext" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">ext</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="String" id="controllers.Assets.minifiedPath.minifiedPathFor.minPath">minPath</a> = <a href="#controllers.Assets.minifiedPath.minifiedPathFor.noextPath" title="String">noextPath</a> <span title="(x$1: Any)String">+</span> <a href="#controllers.Assets.minifiedPath.minifiedPathFor.delim" title="Char">delim</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;min.&quot;)" class="string">&quot;min.&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#controllers.Assets.minifiedPath.minifiedPathFor.ext" title="String">ext</a>
        <a href="#controllers.AssetInfo.resource" title="(name: String)Option[java.net.URL]">resource</a><span class="delimiter">(</span><a href="#controllers.Assets.minifiedPath.minifiedPathFor.minPath" title="String">minPath</a><span class="delimiter">)</span>.<span title="(f: java.net.URL =&gt; String)Option[String]">map</span><span class="delimiter">(</span><a title="java.net.URL" id="controllers.Assets.minifiedPath.minifiedPathFor.$anonfun.x$13">_</a> =&gt; <a href="#controllers.Assets.minifiedPath.minifiedPathFor.minPath" title="String">minPath</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="String" id="controllers.Assets.minifiedPath.maybeMinifiedPath">maybeMinifiedPath</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#controllers.Assets.checkForMinified" title="=&gt; Boolean">checkForMinified</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#controllers.Assets.minifiedPath.minifiedPathFor" title="(delim: Char)Option[String]">minifiedPathFor</a><span class="delimiter">(</span><span title="Char('.')" class="char">'.'</span><span class="delimiter">)</span>.<span title="(alternative: =&gt; Option[String])Option[String]">orElse</span><span class="delimiter">(</span><a href="#controllers.Assets.minifiedPath.minifiedPathFor" title="(delim: Char)Option[String]">minifiedPathFor</a><span class="delimiter">(</span><span title="Char('-')" class="char">'-'</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><a href="#controllers.Assets.minifiedPath.path" title="String">path</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#controllers.Assets.minifiedPath.path" title="String">path</a>
      <span class="delimiter">}</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#controllers.AssetInfo.isDev" title="=&gt; Boolean">isDev</a><span class="delimiter">)</span> <a href="#controllers.Assets.minifiedPathsCache" title="=&gt; scala.collection.concurrent.TrieMap[String,String]">minifiedPathsCache</a>.<span title="(key: String, value: String)Option[String]">put</span><span class="delimiter">(</span><a href="#controllers.Assets.minifiedPath.path" title="String">path</a>, <a href="#controllers.Assets.minifiedPath.maybeMinifiedPath" title="String">maybeMinifiedPath</a><span class="delimiter">)</span>
      <a href="#controllers.Assets.minifiedPath.maybeMinifiedPath" title="String">maybeMinifiedPath</a>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>controllers<span class="delimiter">]</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="controllers.SelfPopulatingMap[String,controllers.AssetInfo]" id="controllers.Assets.assetInfoCache">assetInfoCache</a> = <span title="controllers.SelfPopulatingMap[String,controllers.AssetInfo]" class="keyword">new</span> <a href="#controllers;SelfPopulatingMap" title="controllers.SelfPopulatingMap[String,controllers.AssetInfo]">SelfPopulatingMap</a><span class="delimiter">[</span>String, AssetInfo<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(name: String)Option[controllers.AssetInfo]" id="controllers.Assets.assetInfoFromResource">assetInfoFromResource</a><span class="delimiter">(</span><a title="String" id="controllers.Assets.assetInfoFromResource.name">name</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[controllers.AssetInfo]">Option</span><span class="delimiter">[</span>AssetInfo<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="(body: =&gt; Option[controllers.AssetInfo])Option[controllers.AssetInfo]">blocking</span> <span class="delimiter">{</span>
      <span class="keyword">for</span> <span class="delimiter">{</span>
        <a title="java.net.URL" id="controllers.Assets.assetInfoFromResource.$anonfun.url">url</a> &lt;- <a href="#controllers.AssetInfo.resource" title="(name: String)Option[java.net.URL]">resource</a><span title="(f: java.net.URL =&gt; controllers.AssetInfo)Option[controllers.AssetInfo]" class="delimiter">(</span><a href="#controllers.Assets.assetInfoFromResource.name" title="String">name</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">yield</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Option[java.net.URL]" id="controllers.Assets.assetInfoFromResource.$anonfun.gzipUrl">gzipUrl</a>: <span title="Option[java.net.URL]">Option</span><span class="delimiter">[</span>URL<span class="delimiter">]</span> = <a href="#controllers.AssetInfo.resource" title="(name: String)Option[java.net.URL]">resource</a><span class="delimiter">(</span><a href="#controllers.Assets.assetInfoFromResource.name" title="String">name</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;.gz&quot;)" class="string">&quot;.gz&quot;</span><span class="delimiter">)</span>
        <span title="controllers.AssetInfo" class="keyword">new</span> <a href="#controllers;AssetInfo" title="controllers.AssetInfo">AssetInfo</a><span class="delimiter">(</span><a href="#controllers.Assets.assetInfoFromResource.name" title="String">name</a>, <a href="#controllers.Assets.assetInfoFromResource.$anonfun.url" title="java.net.URL">url</a>, <a href="#controllers.Assets.assetInfoFromResource.$anonfun.gzipUrl" title="Option[java.net.URL]">gzipUrl</a>, <a href="#controllers.Assets.digest" title="(path: String)Option[String]">digest</a><span class="delimiter">(</span><a href="#controllers.Assets.assetInfoFromResource.name" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(name: String)scala.concurrent.Future[Option[controllers.AssetInfo]]" id="controllers.Assets.assetInfo">assetInfo</a><span class="delimiter">(</span><a title="String" id="controllers.Assets.assetInfo.name">name</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Option[controllers.AssetInfo]]">Future</span><span class="delimiter">[</span>Option<span class="delimiter">[</span>AssetInfo<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="scala.concurrent.Future[Option[controllers.AssetInfo]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#controllers.AssetInfo.isDev" title="=&gt; Boolean">isDev</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: Option[controllers.AssetInfo])scala.concurrent.Future[Option[controllers.AssetInfo]]">successful</span><span class="delimiter">(</span><a href="#controllers.Assets.assetInfoFromResource" title="(name: String)Option[controllers.AssetInfo]">assetInfoFromResource</a><span class="delimiter">(</span><a href="#controllers.Assets.assetInfo.name" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#controllers.Assets.assetInfoCache" title="=&gt; controllers.SelfPopulatingMap[String,controllers.AssetInfo]">assetInfoCache</a>.<a href="#controllers;SelfPopulatingMap.putIfAbsent" title="(k: String)(pf: String =&gt; Option[controllers.AssetInfo])(implicit ec: scala.concurrent.ExecutionContext)scala.concurrent.Future[Option[controllers.AssetInfo]]">putIfAbsent</a><span class="delimiter">(</span><a href="#controllers.Assets.assetInfo.name" title="String">name</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#controllers.Assets.assetInfoFromResource" title="(name: String)Option[controllers.AssetInfo]">assetInfoFromResource</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution.Implicits" title="play.api.libs.iteratee.Execution.Implicits.type">Implicits</a>.<a href="../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution.Implicits.trampoline" title="=&gt; scala.concurrent.ExecutionContext">trampoline</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>controllers<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(request: play.api.mvc.RequestHeader, name: String)scala.concurrent.Future[Option[(controllers.AssetInfo, Boolean)]]" id="controllers.Assets.assetInfoForRequest">assetInfoForRequest</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader" id="controllers.Assets.assetInfoForRequest.request">request</a>: <a href="../mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a>, <a title="String" id="controllers.Assets.assetInfoForRequest.name">name</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Option[(controllers.AssetInfo, Boolean)]]">Future</span><span class="delimiter">[</span>Option<span class="delimiter">[</span><span class="delimiter">(</span>AssetInfo, Boolean<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Boolean" id="controllers.Assets.assetInfoForRequest.gzipRequested">gzipRequested</a> = <a href="#controllers.Assets.assetInfoForRequest.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../mvc/Http.scala.html#play.api.mvc;RequestHeader.headers" title="=&gt; play.api.mvc.Headers">headers</a>.<a href="../mvc/Http.scala.html#play.api.mvc;Headers.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="../http/StandardValues.scala.html#play.api.http;HeaderNames.ACCEPT_ENCODING" title="=&gt; String">ACCEPT_ENCODING</a><span class="delimiter">)</span>.<span title="(p: String =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#controllers.Assets.assetInfoForRequest.gzipRequested.$anonfun.x$14" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">_</a>.<span title="(separator: Char)Array[String]">split</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><span title="Char(',')" class="char">','</span><span class="delimiter">)</span>.<span title="(p: String =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#controllers.Assets.assetInfoForRequest.gzipRequested.$anonfun.$anonfun.x$15" title="String">_</a>.<span title="()String">trim</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="String(&quot;gzip&quot;)" class="string">&quot;gzip&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#controllers.Assets.assetInfo" title="(name: String)scala.concurrent.Future[Option[controllers.AssetInfo]]">assetInfo</a><span class="delimiter">(</span><a href="#controllers.Assets.assetInfoForRequest.name" title="String">name</a><span class="delimiter">)</span>.<span title="(f: Option[controllers.AssetInfo] =&gt; Option[(controllers.AssetInfo, Boolean)])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[Option[(controllers.AssetInfo, Boolean)]]">map</span><span class="delimiter">(</span><a href="#controllers.Assets.assetInfoForRequest.$anonfun.x$16" title="Option[controllers.AssetInfo]">_</a>.<span title="(f: controllers.AssetInfo =&gt; (controllers.AssetInfo, Boolean))Option[(controllers.AssetInfo, Boolean)]">map</span><span class="delimiter">(</span><a href="#controllers.Assets.assetInfoForRequest.$anonfun.$anonfun.x$17" title="(x: controllers.AssetInfo)ArrowAssoc[controllers.AssetInfo]">_</a> <span title="(y: Boolean)(controllers.AssetInfo, Boolean)">-&gt;</span> <a href="#controllers.Assets.assetInfoForRequest.gzipRequested" title="Boolean">gzipRequested</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution.Implicits" title="play.api.libs.iteratee.Execution.Implicits.type">Implicits</a>.<a href="../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution.Implicits.trampoline" title="=&gt; scala.concurrent.ExecutionContext">trampoline</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * An asset.
   *
   * @param name The name of the asset.
   */</span>
  <span class="keyword">case class</span> <a title="class Asset extends AnyRef with Product with Serializable" id="controllers.Assets;Asset">Asset</a><a href="#controllers.Assets;Asset" title="Product" class="delimiter">(</a><a title="String" id="controllers.Assets;Asset.name">name</a>: <span title="String">String</span><span class="delimiter">)</span>

  <span class="keyword">object</span> <a title="controllers.Assets.Asset.type" id="controllers.Assets.Asset.readResolve">Asset</a> <a href="#controllers.Assets.Asset.readResolve" title="controllers.Assets.Asset.type" class="delimiter">{</a>
    <span class="keyword">import</span> scala.<span title="language.type">language</span>.implicitConversions

    <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit controllers.Assets.Asset.string2Asset : (name: String)controllers.Assets.Asset" id="controllers.Assets.Asset.string2Asset">string2Asset</a><span class="delimiter">(</span><a title="String" id="controllers.Assets.Asset.string2Asset.name">name</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="controllers.Assets.Asset" class="keyword">new</span> <a href="#controllers.Assets;Asset" title="controllers.Assets.Asset">Asset</a><span class="delimiter">(</span><a href="#controllers.Assets.Asset.string2Asset.name" title="String">name</a><span class="delimiter">)</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(rrc: play.core.routing.ReverseRouteContext)String" id="controllers.Assets.Asset.pathFromParams">pathFromParams</a><span class="delimiter">(</span><a title="play.core.routing.ReverseRouteContext" id="controllers.Assets.Asset.pathFromParams.rrc">rrc</a>: <a href="../../core/routing/ReverseRouteContext.scala.html#play.core.routing;ReverseRouteContext" title="play.core.routing.ReverseRouteContext">ReverseRouteContext</a><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
      <a href="#controllers.Assets.Asset.pathFromParams.rrc" title="play.core.routing.ReverseRouteContext">rrc</a>.<a href="../../core/routing/ReverseRouteContext.scala.html#play.core.routing;ReverseRouteContext.fixedParams" title="=&gt; Map[String,Any]">fixedParams</a>.<span title="(key: String, default: =&gt; Any)Any">getOrElse</span><span class="delimiter">(</span><span title="String(&quot;path&quot;)" class="string">&quot;path&quot;</span>,
        <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)RuntimeException" class="keyword">new</span> <span title="RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="String(&quot;Asset path bindable must be used in combination with an action that accepts a path parameter&quot;)" class="string">&quot;Asset path bindable must be used in combination with an action that accepts a path parameter&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">)</span>.<span title="()String">toString</span>
    <span class="delimiter">}</span>

    <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit controllers.Assets.Asset.assetPathBindable : (implicit rrc: play.core.routing.ReverseRouteContext)play.api.mvc.PathBindable[controllers.Assets.Asset]{def bind(key: String,value: String): scala.util.Right[Nothing,controllers.Assets.Asset]}" id="controllers.Assets.Asset.assetPathBindable">assetPathBindable</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="play.core.routing.ReverseRouteContext" id="controllers.Assets.Asset.assetPathBindable.rrc">rrc</a>: <a href="../../core/routing/ReverseRouteContext.scala.html#play.core.routing;ReverseRouteContext" title="play.core.routing.ReverseRouteContext">ReverseRouteContext</a><span class="delimiter">)</span> = <a href="#controllers.Assets.Asset.assetPathBindable;$anon" title="play.api.mvc.PathBindable[controllers.Assets.Asset]" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with play.api.mvc.PathBindable[controllers.Assets.Asset]" id="controllers.Assets.Asset.assetPathBindable;$anon">PathBindable</a><span class="delimiter">[</span>Asset<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(key: String, value: String)scala.util.Right[Nothing,controllers.Assets.Asset]" id="controllers.Assets.Asset.assetPathBindable;$anon.bind">bind</a><span class="delimiter">(</span><a title="String" id="controllers.Assets.Asset.assetPathBindable;$anon.bind.key">key</a>: <span title="String">String</span>, <a title="String" id="controllers.Assets.Asset.assetPathBindable;$anon.bind.value">value</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="(b: controllers.Assets.Asset)scala.util.Right[Nothing,controllers.Assets.Asset]">Right</span><span class="delimiter">(</span><span title="controllers.Assets.Asset" class="keyword">new</span> <a href="#controllers.Assets;Asset" title="controllers.Assets.Asset">Asset</a><span class="delimiter">(</span><a href="#controllers.Assets.Asset.assetPathBindable;$anon.bind.value" title="String">value</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(key: String, value: controllers.Assets.Asset)String" id="controllers.Assets.Asset.assetPathBindable;$anon.unbind">unbind</a><span class="delimiter">(</span><a title="String" id="controllers.Assets.Asset.assetPathBindable;$anon.unbind.key">key</a>: <span title="String">String</span>, <a title="controllers.Assets.Asset" id="controllers.Assets.Asset.assetPathBindable;$anon.unbind.value">value</a>: <a href="#controllers.Assets;Asset" title="controllers.Assets.Asset">Asset</a><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="String" id="controllers.Assets.Asset.assetPathBindable;$anon.unbind.base">base</a> = <a href="#controllers.Assets.Asset.pathFromParams" title="(rrc: play.core.routing.ReverseRouteContext)String">pathFromParams</a><span class="delimiter">(</span><a href="#controllers.Assets.Asset.assetPathBindable.rrc" title="play.core.routing.ReverseRouteContext">rrc</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="String" id="controllers.Assets.Asset.assetPathBindable;$anon.unbind.path">path</a> = <a href="#controllers.Assets.Asset.assetPathBindable;$anon.unbind.base" title="String">base</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#controllers.Assets.Asset.assetPathBindable;$anon.unbind.value" title="controllers.Assets.Asset">value</a>.<a href="#controllers.Assets;Asset.name" title="=&gt; String">name</a>
        <span title="(body: =&gt; String)String">blocking</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="String" id="controllers.Assets.Asset.assetPathBindable;$anon.unbind.minPath">minPath</a> = <a href="#controllers.Assets.minifiedPath" title="(path: String)String">minifiedPath</a><span class="delimiter">(</span><a href="#controllers.Assets.Asset.assetPathBindable;$anon.unbind.path" title="String">path</a><span class="delimiter">)</span>
          <a href="#controllers.Assets.digest" title="(path: String)Option[String]">digest</a><span class="delimiter">(</span><a href="#controllers.Assets.Asset.assetPathBindable;$anon.unbind.minPath" title="String">minPath</a><span class="delimiter">)</span>.<span title="(ifEmpty: =&gt; String)(f: String =&gt; String)String">fold</span><span class="delimiter">(</span><a href="#controllers.Assets.Asset.assetPathBindable;$anon.unbind.minPath" title="String">minPath</a><span class="delimiter">)</span> <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="delimiter">{</span> <a title="String" id="controllers.Assets.Asset.assetPathBindable;$anon.unbind.$anonfun.dgst">dgst</a> =&gt;
            <span class="keyword">val</span> <a title="Int" id="controllers.Assets.Asset.assetPathBindable;$anon.unbind.$anonfun.lastSep">lastSep</a> = <a href="#controllers.Assets.Asset.assetPathBindable;$anon.unbind.minPath" title="String">minPath</a>.<span title="(x$1: String)Int">lastIndexOf</span><span class="delimiter">(</span><span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span>
            <a href="#controllers.Assets.Asset.assetPathBindable;$anon.unbind.minPath" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">minPath</a>.<span title="(n: Int)String">take</span><span class="delimiter">(</span><a href="#controllers.Assets.Asset.assetPathBindable;$anon.unbind.$anonfun.lastSep" title="Int">lastSep</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <a href="#controllers.Assets.Asset.assetPathBindable;$anon.unbind.$anonfun.dgst" title="String">dgst</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;-&quot;)" class="string">&quot;-&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#controllers.Assets.Asset.assetPathBindable;$anon.unbind.minPath" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">minPath</a>.<span title="(n: Int)String">drop</span><span class="delimiter">(</span><a href="#controllers.Assets.Asset.assetPathBindable;$anon.unbind.$anonfun.lastSep" title="Int">lastSep</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>.<span title="(n: Int)String">drop</span><span class="delimiter">(</span><a href="#controllers.Assets.Asset.assetPathBindable;$anon.unbind.base" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">base</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span title="AnyRef" class="delimiter">}</span>

@Singleton
<span class="keyword">class</span> <a title="class Assets extends controllers.AssetsBuilder" id="controllers;Assets">Assets</a> @Inject<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">(</span><a title="play.api.http.HttpErrorHandler" id="controllers;Assets.errorHandler">errorHandler</a>: <a href="../http/HttpErrorHandler.scala.html#play.api.http;HttpErrorHandler" title="play.api.http.HttpErrorHandler">HttpErrorHandler</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#controllers;AssetsBuilder" title="controllers.AssetsBuilder">AssetsBuilder</a><span class="delimiter">(</span><a href="#controllers;Assets.errorHandler" title="play.api.http.HttpErrorHandler">errorHandler</a><span class="delimiter">)</span>

<span class="keyword">class</span> <a title="class AssetsBuilder extends AnyRef with play.api.mvc.Controller" id="controllers;AssetsBuilder">AssetsBuilder</a><a href="#controllers;AssetsBuilder" title="controllers.AssetsBuilder" class="delimiter">(</a><a title="play.api.http.HttpErrorHandler" id="controllers;AssetsBuilder.errorHandler">errorHandler</a>: <a href="../http/HttpErrorHandler.scala.html#play.api.http;HttpErrorHandler" title="play.api.http.HttpErrorHandler">HttpErrorHandler</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../mvc/Controller.scala.html#play.api.mvc;Controller" title="play.api.mvc.Controller">Controller</a> <span class="delimiter">{</span>

  <span class="keyword">import</span> <a href="#controllers.Assets" title="controllers.Assets.type">Assets</a>._
  <span class="keyword">import</span> <a href="#controllers.AssetInfo" title="controllers.AssetInfo.type">AssetInfo</a>._
  <span class="keyword">import</span> <a href="../mvc/Results.scala.html#play.api.mvc.ResponseHeader" title="play.api.mvc.ResponseHeader.type">ResponseHeader</a>._

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(request: play.api.mvc.RequestHeader, assetInfo: controllers.AssetInfo, aggressiveCaching: Boolean)Option[play.api.mvc.Result]" id="controllers;AssetsBuilder.maybeNotModified">maybeNotModified</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader" id="controllers;AssetsBuilder.maybeNotModified.request">request</a>: <a href="../mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a>, <a title="controllers.AssetInfo" id="controllers;AssetsBuilder.maybeNotModified.assetInfo">assetInfo</a>: <a href="#controllers;AssetInfo" title="controllers.AssetInfo">AssetInfo</a>, <a title="Boolean" id="controllers;AssetsBuilder.maybeNotModified.aggressiveCaching">aggressiveCaching</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Option[play.api.mvc.Result]">Option</span><span class="delimiter">[</span>Result<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="comment">// First check etag. Important, if there is an If-None-Match header, we MUST not check the</span>
    <span class="comment">// If-Modified-Since header, regardless of whether If-None-Match matches or not. This is in</span>
    <span class="comment">// accordance with section 14.26 of RFC2616.</span>
    <a href="#controllers;AssetsBuilder.maybeNotModified.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../mvc/Http.scala.html#play.api.mvc;RequestHeader.headers" title="=&gt; play.api.mvc.Headers">headers</a>.<a href="../mvc/Http.scala.html#play.api.mvc;Headers.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="../http/StandardValues.scala.html#play.api.http;HeaderNames.IF_NONE_MATCH" title="=&gt; String">IF_NONE_MATCH</a><span class="delimiter">)</span> <span title="Option[play.api.mvc.Result]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="String" id="controllers;AssetsBuilder.maybeNotModified.etags">etags</a><span class="delimiter">)</span> =&gt;
        <a href="#controllers;AssetsBuilder.maybeNotModified.assetInfo" title="controllers.AssetInfo">assetInfo</a>.<a href="#controllers;AssetInfo.etag" title="=&gt; Option[String]">etag</a>.<span title="(p: String =&gt; Boolean)Option[String]">filter</span><span class="delimiter">(</span><a title="String" id="controllers;AssetsBuilder.maybeNotModified.$anonfun.someEtag">someEtag</a> =&gt; <a href="#controllers;AssetsBuilder.maybeNotModified.etags" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">etags</a>.<span title="(separator: Char)Array[String]">split</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><span title="Char(',')" class="char">','</span><span class="delimiter">)</span>.<span title="(p: String =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.maybeNotModified.$anonfun.$anonfun.x$18" title="String">_</a>.<span title="()String">trim</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#controllers;AssetsBuilder.maybeNotModified.$anonfun.someEtag" title="String">someEtag</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: String =&gt; Option[play.api.mvc.Result])Option[play.api.mvc.Result]">flatMap</span><span class="delimiter">(</span><a title="String" id="controllers;AssetsBuilder.maybeNotModified.$anonfun.x$19">_</a> =&gt; <span title="(x: play.api.mvc.Result)Some[play.api.mvc.Result]">Some</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.cacheableResult" title="(assetInfo: controllers.AssetInfo, aggressiveCaching: Boolean, r: play.api.mvc.Result)play.api.mvc.Result">cacheableResult</a><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.maybeNotModified.assetInfo" title="controllers.AssetInfo">assetInfo</a>, <a href="#controllers;AssetsBuilder.maybeNotModified.aggressiveCaching" title="Boolean">aggressiveCaching</a>, <a href="../mvc/Results.scala.html#play.api.mvc;Results.NotModified" title="=&gt; play.api.mvc.Result">NotModified</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="None.type">None</span> =&gt;
        <span class="keyword">for</span> <span class="delimiter">{</span>
          <a title="String" id="controllers;AssetsBuilder.maybeNotModified.$anonfun.ifModifiedSinceStr">ifModifiedSinceStr</a> &lt;- <a href="#controllers;AssetsBuilder.maybeNotModified.request" title="play.api.mvc.RequestHeader">request</a>.<a href="../mvc/Http.scala.html#play.api.mvc;RequestHeader.headers" title="=&gt; play.api.mvc.Headers">headers</a>.<a href="../mvc/Http.scala.html#play.api.mvc;Headers.get" title="(key: String)Option[String]">get</a><span title="(f: String =&gt; Option[play.api.mvc.Result])Option[play.api.mvc.Result]" class="delimiter">(</span><a href="../http/StandardValues.scala.html#play.api.http;HeaderNames.IF_MODIFIED_SINCE" title="=&gt; String">IF_MODIFIED_SINCE</a><span class="delimiter">)</span>
          <a title="java.util.Date" id="controllers;AssetsBuilder.maybeNotModified.$anonfun.$anonfun.ifModifiedSince">ifModifiedSince</a> &lt;- <a href="#controllers.AssetInfo.parseModifiedDate" title="(date: String)Option[java.util.Date]">parseModifiedDate</a><span title="(f: java.util.Date =&gt; Option[play.api.mvc.Result])Option[play.api.mvc.Result]" class="delimiter">(</span><a href="#controllers;AssetsBuilder.maybeNotModified.$anonfun.ifModifiedSinceStr" title="String">ifModifiedSinceStr</a><span class="delimiter">)</span>
          <a title="java.util.Date" id="controllers;AssetsBuilder.maybeNotModified.$anonfun.$anonfun.$anonfun.lastModified">lastModified</a> &lt;- <a href="#controllers;AssetsBuilder.maybeNotModified.assetInfo" title="controllers.AssetInfo">assetInfo</a>.<a href="#controllers;AssetInfo.parsedLastModified" title="(f: java.util.Date =&gt; play.api.mvc.Result)Option[play.api.mvc.Result]">parsedLastModified</a>
          <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#controllers;AssetsBuilder.maybeNotModified.$anonfun.$anonfun.$anonfun.lastModified" title="java.util.Date">lastModified</a>.<span title="(x$1: java.util.Date)Boolean">after</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.maybeNotModified.$anonfun.$anonfun.ifModifiedSince" title="java.util.Date">ifModifiedSince</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">yield</span> <span class="delimiter">{</span>
          <a href="../mvc/Results.scala.html#play.api.mvc;Results.NotModified" title="=&gt; play.api.mvc.Result">NotModified</a>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[A &lt;: play.api.mvc.Result](assetInfo: controllers.AssetInfo, aggressiveCaching: Boolean, r: A)play.api.mvc.Result" id="controllers;AssetsBuilder.cacheableResult">cacheableResult</a><span class="delimiter">[</span><a title=" &lt;: play.api.mvc.Result" id="controllers;AssetsBuilder.cacheableResult;A">A</a> &lt;: Result<span class="delimiter">]</span><span class="delimiter">(</span><a title="controllers.AssetInfo" id="controllers;AssetsBuilder.cacheableResult.assetInfo">assetInfo</a>: <a href="#controllers;AssetInfo" title="controllers.AssetInfo">AssetInfo</a>, <a title="Boolean" id="controllers;AssetsBuilder.cacheableResult.aggressiveCaching">aggressiveCaching</a>: <span title="Boolean">Boolean</span>, <a title="A" id="controllers;AssetsBuilder.cacheableResult.r">r</a>: <a href="#controllers;AssetsBuilder.cacheableResult;A" title="A">A</a><span class="delimiter">)</span>: <a href="../mvc/Results.scala.html#play.api.mvc;Result" title="play.api.mvc.Result">Result</a> = <span class="delimiter">{</span>

    <span class="keyword">def</span> <a title="(name: String, maybeValue: Option[String], response: play.api.mvc.Result)play.api.mvc.Result" id="controllers;AssetsBuilder.cacheableResult.addHeaderIfValue">addHeaderIfValue</a><span class="delimiter">(</span><a title="String" id="controllers;AssetsBuilder.cacheableResult.addHeaderIfValue.name">name</a>: <span title="String">String</span>, <a title="Option[String]" id="controllers;AssetsBuilder.cacheableResult.addHeaderIfValue.maybeValue">maybeValue</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="play.api.mvc.Result" id="controllers;AssetsBuilder.cacheableResult.addHeaderIfValue.response">response</a>: <a href="../mvc/Results.scala.html#play.api.mvc;Result" title="play.api.mvc.Result">Result</a><span class="delimiter">)</span>: <a href="../mvc/Results.scala.html#play.api.mvc;Result" title="play.api.mvc.Result">Result</a> = <span class="delimiter">{</span>
      <a href="#controllers;AssetsBuilder.cacheableResult.addHeaderIfValue.maybeValue" title="Option[String]">maybeValue</a>.<span title="(ifEmpty: =&gt; play.api.mvc.Result)(f: String =&gt; play.api.mvc.Result)play.api.mvc.Result">fold</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.cacheableResult.addHeaderIfValue.response" title="play.api.mvc.Result">response</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="String" id="controllers;AssetsBuilder.cacheableResult.addHeaderIfValue.$anonfun.v">v</a> =&gt; <a href="#controllers;AssetsBuilder.cacheableResult.addHeaderIfValue.response" title="play.api.mvc.Result">response</a>.<a href="../mvc/Results.scala.html#play.api.mvc;Result.withHeaders" title="(headers: (String, String)*)play.api.mvc.Result">withHeaders</a><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.cacheableResult.addHeaderIfValue.name" title="(x: String)ArrowAssoc[String]">name</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#controllers;AssetsBuilder.cacheableResult.addHeaderIfValue.$anonfun.v" title="String">v</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="play.api.mvc.Result" id="controllers;AssetsBuilder.cacheableResult.r1">r1</a> = <a href="#controllers;AssetsBuilder.cacheableResult.addHeaderIfValue" title="(name: String, maybeValue: Option[String], response: play.api.mvc.Result)play.api.mvc.Result">addHeaderIfValue</a><span class="delimiter">(</span><a href="../http/StandardValues.scala.html#play.api.http;HeaderNames.ETAG" title="=&gt; String">ETAG</a>, <a href="#controllers;AssetsBuilder.cacheableResult.assetInfo" title="controllers.AssetInfo">assetInfo</a>.<a href="#controllers;AssetInfo.etag" title="=&gt; Option[String]">etag</a>, <a href="#controllers;AssetsBuilder.cacheableResult.r" title="A">r</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="play.api.mvc.Result" id="controllers;AssetsBuilder.cacheableResult.r2">r2</a> = <a href="#controllers;AssetsBuilder.cacheableResult.addHeaderIfValue" title="(name: String, maybeValue: Option[String], response: play.api.mvc.Result)play.api.mvc.Result">addHeaderIfValue</a><span class="delimiter">(</span><a href="../http/StandardValues.scala.html#play.api.http;HeaderNames.LAST_MODIFIED" title="=&gt; String">LAST_MODIFIED</a>, <a href="#controllers;AssetsBuilder.cacheableResult.assetInfo" title="controllers.AssetInfo">assetInfo</a>.<a href="#controllers;AssetInfo.lastModified" title="=&gt; Option[String]">lastModified</a>, <a href="#controllers;AssetsBuilder.cacheableResult.r1" title="play.api.mvc.Result">r1</a><span class="delimiter">)</span>

    <a href="#controllers;AssetsBuilder.cacheableResult.r2" title="play.api.mvc.Result">r2</a>.<a href="../mvc/Results.scala.html#play.api.mvc;Result.withHeaders" title="(headers: (String, String)*)play.api.mvc.Result">withHeaders</a><span class="delimiter">(</span><a href="../http/StandardValues.scala.html#play.api.http;HeaderNames.CACHE_CONTROL" title="(x: String)ArrowAssoc[String]">CACHE_CONTROL</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#controllers;AssetsBuilder.cacheableResult.assetInfo" title="controllers.AssetInfo">assetInfo</a>.<a href="#controllers;AssetInfo.cacheControl" title="(aggressiveCaching: Boolean)String">cacheControl</a><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.cacheableResult.aggressiveCaching" title="Boolean">aggressiveCaching</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(file: String, length: Int, mimeType: String, resourceData: play.api.libs.iteratee.Enumerator[Array[Byte]], gzipRequested: Boolean, gzipAvailable: Boolean)play.api.mvc.Result" id="controllers;AssetsBuilder.result">result</a><span class="delimiter">(</span><a title="String" id="controllers;AssetsBuilder.result.file">file</a>: <span title="String">String</span>,
    <a title="Int" id="controllers;AssetsBuilder.result.length">length</a>: <span title="Int">Int</span>,
    <a title="String" id="controllers;AssetsBuilder.result.mimeType">mimeType</a>: <span title="String">String</span>,
    <a title="play.api.libs.iteratee.Enumerator[Array[Byte]]" id="controllers;AssetsBuilder.result.resourceData">resourceData</a>: <a href="../../../../play-iteratees/play/api/libs/iteratee/Enumerator.scala.html#play.api.libs.iteratee;Enumerator" title="play.api.libs.iteratee.Enumerator[Array[Byte]]">Enumerator</a><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>,
    <a title="Boolean" id="controllers;AssetsBuilder.result.gzipRequested">gzipRequested</a>: <span title="Boolean">Boolean</span>,
    <a title="Boolean" id="controllers;AssetsBuilder.result.gzipAvailable">gzipAvailable</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <a href="../mvc/Results.scala.html#play.api.mvc;Result" title="play.api.mvc.Result">Result</a> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="play.api.mvc.Result" id="controllers;AssetsBuilder.result.response">response</a> = <a href="../mvc/Results.scala.html#play.api.mvc;Result" title="(header: play.api.mvc.ResponseHeader, body: play.api.libs.iteratee.Enumerator[Array[Byte]], connection: play.api.mvc.HttpConnection.Connection)play.api.mvc.Result">Result</a><span class="delimiter">(</span>
      <a href="../mvc/Results.scala.html#play.api.mvc.ResponseHeader.apply" title="(status: Int, headers: Map[String,String], reasonPhrase: Option[String])play.api.mvc.ResponseHeader">ResponseHeader</a><span class="delimiter">(</span>
        <a href="../http/StandardValues.scala.html#play.api.http;Status.OK" title="=&gt; Int">OK</a>,
        <span title="(elems: (String, String)*)scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">(</span>
          <a href="../http/StandardValues.scala.html#play.api.http;HeaderNames.CONTENT_LENGTH" title="(x: String)ArrowAssoc[String]">CONTENT_LENGTH</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#controllers;AssetsBuilder.result.length" title="Int">length</a>.<span title="()String">toString</span>,
          <a href="../http/StandardValues.scala.html#play.api.http;HeaderNames.CONTENT_TYPE" title="(x: String)ArrowAssoc[String]">CONTENT_TYPE</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#controllers;AssetsBuilder.result.mimeType" title="String">mimeType</a>
        <span class="delimiter">)</span>
      <span class="delimiter">)</span>,
      <a href="#controllers;AssetsBuilder.result.resourceData" title="play.api.libs.iteratee.Enumerator[Array[Byte]]">resourceData</a><span class="delimiter">)</span>
    <span title="play.api.mvc.Result" class="keyword">if</span> <span class="delimiter">(</span><a href="#controllers;AssetsBuilder.result.gzipRequested" title="Boolean">gzipRequested</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#controllers;AssetsBuilder.result.gzipAvailable" title="Boolean">gzipAvailable</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#controllers;AssetsBuilder.result.response" title="play.api.mvc.Result">response</a>.<a href="../mvc/Results.scala.html#play.api.mvc;Result.withHeaders" title="(headers: (String, String)*)play.api.mvc.Result">withHeaders</a><span class="delimiter">(</span><a href="../http/StandardValues.scala.html#play.api.http;HeaderNames.VARY" title="(x: String)ArrowAssoc[String]">VARY</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="../http/StandardValues.scala.html#play.api.http;HeaderNames.ACCEPT_ENCODING" title="=&gt; String">ACCEPT_ENCODING</a>, <a href="../http/StandardValues.scala.html#play.api.http;HeaderNames.CONTENT_ENCODING" title="(x: String)ArrowAssoc[String]">CONTENT_ENCODING</a> <span title="(y: String)(String, String)">-&gt;</span> <span title="String(&quot;gzip&quot;)" class="string">&quot;gzip&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="play.api.mvc.Result" class="keyword">if</span> <span class="delimiter">(</span><a href="#controllers;AssetsBuilder.result.gzipAvailable" title="Boolean">gzipAvailable</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#controllers;AssetsBuilder.result.response" title="play.api.mvc.Result">response</a>.<a href="../mvc/Results.scala.html#play.api.mvc;Result.withHeaders" title="(headers: (String, String)*)play.api.mvc.Result">withHeaders</a><span class="delimiter">(</span><a href="../http/StandardValues.scala.html#play.api.http;HeaderNames.VARY" title="(x: String)ArrowAssoc[String]">VARY</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="../http/StandardValues.scala.html#play.api.http;HeaderNames.ACCEPT_ENCODING" title="=&gt; String">ACCEPT_ENCODING</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#controllers;AssetsBuilder.result.response" title="play.api.mvc.Result">response</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Generates an `Action` that serves a versioned static resource.
   */</span>
  <span class="keyword">def</span> <a title="(path: String, file: controllers.Assets.Asset)play.api.mvc.Action[play.api.mvc.AnyContent]" id="controllers;AssetsBuilder.versioned">versioned</a><span class="delimiter">(</span><a title="String" id="controllers;AssetsBuilder.versioned.path">path</a>: <span title="String">String</span>, <a title="controllers.Assets.Asset" id="controllers;AssetsBuilder.versioned.file">file</a>: <a href="#controllers.Assets;Asset" title="controllers.Assets.Asset">Asset</a><span class="delimiter">)</span>: <a href="../mvc/Action.scala.html#play.api.mvc;Action" title="play.api.mvc.Action[play.api.mvc.AnyContent]">Action</a><span class="delimiter">[</span>AnyContent<span class="delimiter">]</span> = <a href="../mvc/Action.scala.html#play.api.mvc.Action" title="play.api.mvc.Action.type">Action</a>.<a href="../mvc/Action.scala.html#play.api.mvc;ActionBuilder.async(f309a5941b)" title="(block: play.api.mvc.Request[play.api.mvc.AnyContent] =&gt; scala.concurrent.Future[play.api.mvc.Result])play.api.mvc.Action[play.api.mvc.AnyContent]">async</a> <span class="delimiter">{</span> <span class="keyword">implicit</span> <a title="play.api.mvc.Request[play.api.mvc.AnyContent]" id="controllers;AssetsBuilder.versioned.$anonfun.request">request</a> =&gt;
    <span class="keyword">val</span> <a title="java.io.File" id="controllers;AssetsBuilder.versioned.$anonfun.f">f</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.versioned.file" title="controllers.Assets.Asset">file</a>.<a href="#controllers.Assets;Asset.name" title="=&gt; String">name</a><span class="delimiter">)</span>
    <span class="comment">// We want to detect if it's a fingerprinted asset, because if it's fingerprinted, we can aggressively cache it,</span>
    <span class="comment">// otherwise we can't.</span>
    <span class="keyword">val</span> <a title="String" id="controllers;AssetsBuilder.versioned.$anonfun.requestedDigest">requestedDigest</a> = <a href="#controllers;AssetsBuilder.versioned.$anonfun.f" title="java.io.File">f</a>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">getName</span>.<span title="(p: Char =&gt; Boolean)String">takeWhile</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.versioned.$anonfun.requestedDigest.$anonfun.x$20" title="Char">_</a> <span title="(x: Char)Boolean">!=</span> <span title="Char('-')" class="char">'-'</span><span class="delimiter">)</span>
    <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#controllers;AssetsBuilder.versioned.$anonfun.requestedDigest" title="String">requestedDigest</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="controllers;AssetsBuilder.versioned.$anonfun.bareFile">bareFile</a> = <span title="(x$1: String, x$2: String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.versioned.$anonfun.f" title="java.io.File">f</a>.<span title="()String">getParent</span>, <a href="#controllers;AssetsBuilder.versioned.$anonfun.f" title="java.io.File">f</a>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">getName</span>.<span title="(n: Int)String">drop</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.versioned.$anonfun.requestedDigest" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">requestedDigest</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="()String">getPath</span>
      <span class="keyword">val</span> <a title="String" id="controllers;AssetsBuilder.versioned.$anonfun.bareFullPath">bareFullPath</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.versioned.path" title="String">path</a> <span title="(x$1: Any)String">+</span> <span title="java.io.File.type">File</span>.<span title="String">separator</span> <span title="(x$1: Any)String">+</span> <a href="#controllers;AssetsBuilder.versioned.$anonfun.bareFile" title="String">bareFile</a><span class="delimiter">)</span>.<span title="()String">getPath</span>
      <span title="(body: =&gt; Option[String])Option[String]">blocking</span><span class="delimiter">(</span><a href="#controllers.Assets.digest" title="(path: String)Option[String]">digest</a><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.versioned.$anonfun.bareFullPath" title="String">bareFullPath</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Some<span class="delimiter">(</span><a href="#controllers;AssetsBuilder.versioned.$anonfun.requestedDigest" title="String">`requestedDigest`</a><span class="delimiter">)</span> =&gt; <a href="#controllers;AssetsBuilder.assetAt" title="(path: String, file: String, aggressiveCaching: Boolean)(implicit request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">assetAt</a><a href="#controllers;AssetsBuilder.versioned.$anonfun.request" title="play.api.mvc.Request[play.api.mvc.AnyContent]" class="delimiter">(</a><a href="#controllers;AssetsBuilder.versioned.path" title="String">path</a>, <a href="#controllers;AssetsBuilder.versioned.$anonfun.bareFile" title="String">bareFile</a>, aggressiveCaching = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span class="keyword">case</span> _ =&gt; <a href="#controllers;AssetsBuilder.assetAt" title="(path: String, file: String, aggressiveCaching: Boolean)(implicit request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">assetAt</a><a href="#controllers;AssetsBuilder.versioned.$anonfun.request" title="play.api.mvc.Request[play.api.mvc.AnyContent]" class="delimiter">(</a><a href="#controllers;AssetsBuilder.versioned.path" title="String">path</a>, <a href="#controllers;AssetsBuilder.versioned.file" title="controllers.Assets.Asset">file</a>.<a href="#controllers.Assets;Asset.name" title="=&gt; String">name</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#controllers;AssetsBuilder.assetAt" title="(path: String, file: String, aggressiveCaching: Boolean)(implicit request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">assetAt</a><a href="#controllers;AssetsBuilder.versioned.$anonfun.request" title="play.api.mvc.Request[play.api.mvc.AnyContent]" class="delimiter">(</a><a href="#controllers;AssetsBuilder.versioned.path" title="String">path</a>, <a href="#controllers;AssetsBuilder.versioned.file" title="controllers.Assets.Asset">file</a>.<a href="#controllers.Assets;Asset.name" title="=&gt; String">name</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Generates an `Action` that serves a static resource.
   *
   * @param path the root folder for searching the static resource files, such as `&quot;/public&quot;`. Not URL encoded.
   * @param file the file part extracted from the URL. May be URL encoded (note that %2F decodes to literal /).
   * @param aggressiveCaching if true then an aggressive set of caching directives will be used. Defaults to false.
   */</span>
  <span class="keyword">def</span> <a title="(path: String, file: String, aggressiveCaching: Boolean)play.api.mvc.Action[play.api.mvc.AnyContent]" id="controllers;AssetsBuilder.at">at</a><span class="delimiter">(</span><a title="String" id="controllers;AssetsBuilder.at.path">path</a>: <span title="String">String</span>, <a title="String" id="controllers;AssetsBuilder.at.file">file</a>: <span title="String">String</span>, <a title="Boolean" id="controllers;AssetsBuilder.at$default$3">aggressiveCaching</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>: <a href="../mvc/Action.scala.html#play.api.mvc;Action" title="play.api.mvc.Action[play.api.mvc.AnyContent]">Action</a><span class="delimiter">[</span>AnyContent<span class="delimiter">]</span> = <a href="../mvc/Action.scala.html#play.api.mvc.Action" title="play.api.mvc.Action.type">Action</a>.<a href="../mvc/Action.scala.html#play.api.mvc;ActionBuilder.async(f309a5941b)" title="(block: play.api.mvc.Request[play.api.mvc.AnyContent] =&gt; scala.concurrent.Future[play.api.mvc.Result])play.api.mvc.Action[play.api.mvc.AnyContent]">async</a> <span class="delimiter">{</span> <span class="keyword">implicit</span> <a title="play.api.mvc.Request[play.api.mvc.AnyContent]" id="controllers;AssetsBuilder.at.$anonfun.request">request</a> =&gt;
    <a href="#controllers;AssetsBuilder.assetAt" title="(path: String, file: String, aggressiveCaching: Boolean)(implicit request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]">assetAt</a><a href="#controllers;AssetsBuilder.at.$anonfun.request" title="play.api.mvc.Request[play.api.mvc.AnyContent]" class="delimiter">(</a><a href="#controllers;AssetsBuilder.at.path" title="String">path</a>, <a href="#controllers;AssetsBuilder.at.file" title="String">file</a>, <a href="#controllers;AssetsBuilder.at$default$3" title="Boolean">aggressiveCaching</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(path: String, file: String, aggressiveCaching: Boolean)(implicit request: play.api.mvc.RequestHeader)scala.concurrent.Future[play.api.mvc.Result]" id="controllers;AssetsBuilder.assetAt">assetAt</a><span class="delimiter">(</span><a title="String" id="controllers;AssetsBuilder.assetAt.path">path</a>: <span title="String">String</span>, <a title="String" id="controllers;AssetsBuilder.assetAt.file">file</a>: <span title="String">String</span>, <a title="Boolean" id="controllers;AssetsBuilder.assetAt.aggressiveCaching">aggressiveCaching</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="play.api.mvc.RequestHeader" id="controllers;AssetsBuilder.assetAt.request">request</a>: <a href="../mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a><span class="delimiter">)</span>: <span title="scala.concurrent.Future[play.api.mvc.Result]">Future</span><span class="delimiter">[</span>Result<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution.Implicits" title="play.api.libs.iteratee.Execution.Implicits.type">Implicits</a>.trampoline
    <span class="keyword">val</span> <a title="Option[String]" id="controllers;AssetsBuilder.assetAt.assetName">assetName</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#controllers;AssetsBuilder.resourceNameAt" title="(path: String, file: String)Option[String]">resourceNameAt</a><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.assetAt.path" title="String">path</a>, <a href="#controllers;AssetsBuilder.assetAt.file" title="String">file</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.concurrent.Future[Option[(controllers.AssetInfo, Boolean)]]" id="controllers;AssetsBuilder.assetAt.assetInfoFuture">assetInfoFuture</a>: <span title="scala.concurrent.Future[Option[(controllers.AssetInfo, Boolean)]]">Future</span><span class="delimiter">[</span>Option<span class="delimiter">[</span><span class="delimiter">(</span>AssetInfo, Boolean<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#controllers;AssetsBuilder.assetAt.assetName" title="Option[String]">assetName</a>.<span title="(f: String =&gt; scala.concurrent.Future[Option[(controllers.AssetInfo, Boolean)]])Option[scala.concurrent.Future[Option[(controllers.AssetInfo, Boolean)]]]">map</span> <span class="delimiter">{</span> <a title="String" id="controllers;AssetsBuilder.assetAt.assetInfoFuture.$anonfun.name">name</a> =&gt;
      <a href="#controllers.Assets.assetInfoForRequest" title="(request: play.api.mvc.RequestHeader, name: String)scala.concurrent.Future[Option[(controllers.AssetInfo, Boolean)]]">assetInfoForRequest</a><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.assetAt.request" title="play.api.mvc.RequestHeader">request</a>, <a href="#controllers;AssetsBuilder.assetAt.assetInfoFuture.$anonfun.name" title="String">name</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span title="(default: =&gt; scala.concurrent.Future[Option[(controllers.AssetInfo, Boolean)]])scala.concurrent.Future[Option[(controllers.AssetInfo, Boolean)]]">getOrElse</span> <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: None.type)scala.concurrent.Future[None.type]">successful</span><span class="delimiter">(</span><span title="None.type">None</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="=&gt; scala.concurrent.Future[play.api.mvc.Result]" id="controllers;AssetsBuilder.assetAt.notFound">notFound</a> = <a href="#controllers;AssetsBuilder.errorHandler" title="play.api.http.HttpErrorHandler">errorHandler</a>.<a href="../http/HttpErrorHandler.scala.html#play.api.http;HttpErrorHandler.onClientError" title="(request: play.api.mvc.RequestHeader, statusCode: Int, message: String)scala.concurrent.Future[play.api.mvc.Result]">onClientError</a><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.assetAt.request" title="play.api.mvc.RequestHeader">request</a>, <a href="../http/StandardValues.scala.html#play.api.http;Status.NOT_FOUND" title="=&gt; Int">NOT_FOUND</a>, <span title="String(&quot;Resource not found by Assets controller&quot;)" class="string">&quot;Resource not found by Assets controller&quot;</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="scala.concurrent.Future[play.api.mvc.Result]" id="controllers;AssetsBuilder.assetAt.pendingResult">pendingResult</a>: <span title="scala.concurrent.Future[play.api.mvc.Result]">Future</span><span class="delimiter">[</span>Result<span class="delimiter">]</span> = <a href="#controllers;AssetsBuilder.assetAt.assetInfoFuture" title="scala.concurrent.Future[Option[(controllers.AssetInfo, Boolean)]]">assetInfoFuture</a>.<span title="(f: Option[(controllers.AssetInfo, Boolean)] =&gt; scala.concurrent.Future[play.api.mvc.Result])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[play.api.mvc.Result]">flatMap</span> <a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.x0$3" title="scala.concurrent.Future[play.api.mvc.Result]" class="delimiter">{</a>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><span class="delimiter">(</span><a title="controllers.AssetInfo" id="controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.assetInfo">assetInfo</a>, <a title="Boolean" id="controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.gzipRequested">gzipRequested</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <span class="keyword">val</span> <a title="java.net.URLConnection" id="controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.connection">connection</a> = <a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.assetInfo" title="controllers.AssetInfo">assetInfo</a>.<a href="#controllers;AssetInfo.url(998a4083b2)" title="(gzipAvailable: Boolean)java.net.URL">url</a><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.gzipRequested" title="Boolean">gzipRequested</a><span class="delimiter">)</span>.<span title="()java.net.URLConnection">openConnection</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="comment">// Make sure it's not a directory</span>
        <span title="scala.concurrent.Future[play.api.mvc.Result]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../utils/Resources.scala.html#play.utils.Resources" title="play.utils.Resources.type">Resources</a>.<a href="../../utils/Resources.scala.html#play.utils.Resources.isUrlConnectionADirectory" title="(urlConnection: java.net.URLConnection)Boolean">isUrlConnectionADirectory</a><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.connection" title="java.net.URLConnection">connection</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../utils/Resources.scala.html#play.utils.Resources" title="play.utils.Resources.type">Resources</a>.<a href="../../utils/Resources.scala.html#play.utils.Resources.closeUrlConnection" title="(connection: java.net.URLConnection)Unit">closeUrlConnection</a><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.connection" title="java.net.URLConnection">connection</a><span class="delimiter">)</span>
          <a href="#controllers;AssetsBuilder.assetAt.notFound" title="=&gt; scala.concurrent.Future[play.api.mvc.Result]">notFound</a>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="java.io.InputStream" id="controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.stream">stream</a> = <a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.connection" title="java.net.URLConnection">connection</a>.<span title="()java.io.InputStream">getInputStream</span>
          <span class="keyword">val</span> <a title="Int" id="controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.length">length</a> = <a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.stream" title="java.io.InputStream">stream</a>.<span title="()Int">available</span>
          <span class="keyword">val</span> <a title="play.api.libs.iteratee.Enumerator[Array[Byte]]" id="controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.resourceData">resourceData</a> = <a href="../../../../play-iteratees/play/api/libs/iteratee/Enumerator.scala.html#play.api.libs.iteratee.Enumerator" title="play.api.libs.iteratee.Enumerator.type">Enumerator</a>.<a href="../../../../play-iteratees/play/api/libs/iteratee/Enumerator.scala.html#play.api.libs.iteratee.Enumerator.fromStream" title="(input: java.io.InputStream, chunkSize: Int)(implicit ec: scala.concurrent.ExecutionContext)play.api.libs.iteratee.Enumerator[Array[Byte]]">fromStream</a><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.stream" title="java.io.InputStream">stream</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution.Implicits" title="play.api.libs.iteratee.Execution.Implicits.type">Implicits</a>.<a href="../../../../play-iteratees/play/api/libs/iteratee/Execution.scala.html#play.api.libs.iteratee.Execution.Implicits.defaultExecutionContext" title="=&gt; scala.concurrent.ExecutionContext">defaultExecutionContext</a><span class="delimiter">)</span>

          <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: play.api.mvc.Result)scala.concurrent.Future[play.api.mvc.Result]">successful</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.maybeNotModified" title="(request: play.api.mvc.RequestHeader, assetInfo: controllers.AssetInfo, aggressiveCaching: Boolean)Option[play.api.mvc.Result]">maybeNotModified</a><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.assetAt.request" title="play.api.mvc.RequestHeader">request</a>, <a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.assetInfo" title="controllers.AssetInfo">assetInfo</a>, <a href="#controllers;AssetsBuilder.assetAt.aggressiveCaching" title="Boolean">aggressiveCaching</a><span class="delimiter">)</span>.<span title="(default: =&gt; play.api.mvc.Result)play.api.mvc.Result">getOrElse</span> <span class="delimiter">{</span>
            <a href="#controllers;AssetsBuilder.cacheableResult" title="(assetInfo: controllers.AssetInfo, aggressiveCaching: Boolean, r: play.api.mvc.Result)play.api.mvc.Result">cacheableResult</a><span class="delimiter">(</span>
              <a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.assetInfo" title="controllers.AssetInfo">assetInfo</a>,
              <a href="#controllers;AssetsBuilder.assetAt.aggressiveCaching" title="Boolean">aggressiveCaching</a>,
              <a href="#controllers;AssetsBuilder.result" title="(file: String, length: Int, mimeType: String, resourceData: play.api.libs.iteratee.Enumerator[Array[Byte]], gzipRequested: Boolean, gzipAvailable: Boolean)play.api.mvc.Result">result</a><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.assetAt.file" title="String">file</a>, <a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.length" title="Int">length</a>, <a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.assetInfo" title="controllers.AssetInfo">assetInfo</a>.<a href="#controllers;AssetInfo.mimeType" title="=&gt; String">mimeType</a>, <a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.resourceData" title="play.api.libs.iteratee.Enumerator[Array[Byte]]">resourceData</a>, <a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.gzipRequested" title="Boolean">gzipRequested</a>, <a href="#controllers;AssetsBuilder.assetAt.pendingResult.$anonfun.assetInfo" title="controllers.AssetInfo">assetInfo</a>.<a href="#controllers;AssetInfo.gzipUrl" title="=&gt; Option[java.net.URL]">gzipUrl</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span>
            <span class="delimiter">)</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="None.type">None</span> =&gt; <a href="#controllers;AssetsBuilder.assetAt.notFound" title="=&gt; scala.concurrent.Future[play.api.mvc.Result]">notFound</a>
    <span class="delimiter">}</span>

    <a href="#controllers;AssetsBuilder.assetAt.pendingResult" title="scala.concurrent.Future[play.api.mvc.Result]">pendingResult</a>.<span title="(pf: PartialFunction[Throwable,scala.concurrent.Future[play.api.mvc.Result]])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[play.api.mvc.Result]">recoverWith</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Throwable,scala.concurrent.Future[play.api.mvc.Result]] with Serializable" id="controllers;AssetsBuilder.assetAt;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="play.utils.InvalidUriEncodingException">e</span>: <a href="../../utils/UriEncoding.scala.html#play.utils;InvalidUriEncodingException" title="play.utils.InvalidUriEncodingException">InvalidUriEncodingException</a> =&gt;
        <a href="#controllers;AssetsBuilder.errorHandler" title="play.api.http.HttpErrorHandler">errorHandler</a>.<a href="../http/HttpErrorHandler.scala.html#play.api.http;HttpErrorHandler.onClientError" title="(request: play.api.mvc.RequestHeader, statusCode: Int, message: String)scala.concurrent.Future[play.api.mvc.Result]">onClientError</a><span title="Boolean(true)" class="delimiter">(</span><a href="#controllers;AssetsBuilder.assetAt.request" title="play.api.mvc.RequestHeader">request</a>, <a href="../http/StandardValues.scala.html#play.api.http;Status.BAD_REQUEST" title="=&gt; Int">BAD_REQUEST</a>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Invalid URI encoding for &quot;)">Invalid URI encoding for $</span><a href="#controllers;AssetsBuilder.assetAt.file" title="String">file</a><span title="String(&quot; at &quot;)"> at $</span><a href="#controllers;AssetsBuilder.assetAt.path" title="String">path</a><span title="String(&quot;: &quot;)" class="string">: &quot;</span> <span title="(x$1: Any)String">+</span> <span title="play.utils.InvalidUriEncodingException">e</span>.<span title="()String">getMessage</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#controllers;AssetsBuilder.assetAt;$anonfun.applyOrElse.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><span title="Throwable">e</span><span class="delimiter">)</span> =&gt;
        <span class="comment">// Add a bit more information to the exception for better error reporting later</span>
        <a href="#controllers;AssetsBuilder.errorHandler" title="play.api.http.HttpErrorHandler">errorHandler</a>.<a href="../http/HttpErrorHandler.scala.html#play.api.http;HttpErrorHandler.onServerError" title="(request: play.api.mvc.RequestHeader, exception: Throwable)scala.concurrent.Future[play.api.mvc.Result]">onServerError</a><span title="Boolean(true)" class="delimiter">(</span><a href="#controllers;AssetsBuilder.assetAt.request" title="play.api.mvc.RequestHeader">request</a>, <span title="(x$1: String, x$2: Throwable)RuntimeException" class="keyword">new</span> <span title="RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Unexpected error while serving &quot;)">Unexpected error while serving $</span><a href="#controllers;AssetsBuilder.assetAt.file" title="String">file</a><span title="String(&quot; at &quot;)"> at $</span><a href="#controllers;AssetsBuilder.assetAt.path" title="String">path</a><span title="String(&quot;: &quot;)" class="string">: &quot;</span> <span title="(x$1: Any)String">+</span> <span title="Throwable">e</span>.<span title="()String">getMessage</span>, <span title="Throwable">e</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Get the name of the resource for a static resource. Used by `at`.
   *
   * @param path the root folder for searching the static resource files, such as `&quot;/public&quot;`. Not URL encoded.
   * @param file the file part extracted from the URL. May be URL encoded (note that %2F decodes to literal /).
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>controllers<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(path: String, file: String)Option[String]" id="controllers;AssetsBuilder.resourceNameAt">resourceNameAt</a><span class="delimiter">(</span><a title="String" id="controllers;AssetsBuilder.resourceNameAt.path">path</a>: <span title="String">String</span>, <a title="String" id="controllers;AssetsBuilder.resourceNameAt.file">file</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="controllers;AssetsBuilder.resourceNameAt.decodedFile">decodedFile</a> = <a href="../../utils/UriEncoding.scala.html#play.utils.UriEncoding" title="play.utils.UriEncoding.type">UriEncoding</a>.<a href="../../utils/UriEncoding.scala.html#play.utils.UriEncoding.decodePath" title="(s: String, outputCharset: String)String">decodePath</a><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.resourceNameAt.file" title="String">file</a>, <span title="String(&quot;utf-8&quot;)" class="string">&quot;utf-8&quot;</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(input: String)String" id="controllers;AssetsBuilder.resourceNameAt.dblSlashRemover">dblSlashRemover</a><span class="delimiter">(</span><a title="String" id="controllers;AssetsBuilder.resourceNameAt.dblSlashRemover.input">input</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#controllers;AssetsBuilder.dblSlashPattern" title="=&gt; scala.util.matching.Regex">dblSlashPattern</a>.<span title="(target: CharSequence, replacement: String)String">replaceAllIn</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.resourceNameAt.dblSlashRemover.input" title="String">input</a>, <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="String" id="controllers;AssetsBuilder.resourceNameAt.resourceName">resourceName</a> = <a href="#controllers;AssetsBuilder.resourceNameAt.dblSlashRemover" title="(input: String)String">dblSlashRemover</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;/&quot;)">/$</span><a href="#controllers;AssetsBuilder.resourceNameAt.path" title="String">path</a><span title="String(&quot;/&quot;)">/$</span><a href="#controllers;AssetsBuilder.resourceNameAt.decodedFile" title="String">decodedFile</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.File" id="controllers;AssetsBuilder.resourceNameAt.resourceFile">resourceFile</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.resourceNameAt.resourceName" title="String">resourceName</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.File" id="controllers;AssetsBuilder.resourceNameAt.pathFile">pathFile</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.resourceNameAt.path" title="String">path</a><span class="delimiter">)</span>
    <span title="Option[String]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#controllers;AssetsBuilder.resourceNameAt.resourceFile" title="java.io.File">resourceFile</a>.<span title="()String">getCanonicalPath</span>.<span title="(x$1: String)Boolean">startsWith</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.resourceNameAt.pathFile" title="java.io.File">pathFile</a>.<span title="()String">getCanonicalPath</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="None.type">None</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span title="(x: String)Some[String]">Some</span><span class="delimiter">(</span><a href="#controllers;AssetsBuilder.resourceNameAt.resourceName" title="String">resourceName</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="controllers;AssetsBuilder.dblSlashPattern">dblSlashPattern</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;//+&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
