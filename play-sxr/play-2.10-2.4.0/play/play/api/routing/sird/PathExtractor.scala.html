<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>play/play/api/routing/sird/PathExtractor.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> play.api.routing.sird

<span class="keyword">import</span> java.net.<span class="delimiter">{</span> URL, URI <span class="delimiter">}</span>
<span class="keyword">import</span> java.util.regex.Pattern

<span class="keyword">import</span> play.api.mvc.RequestHeader
<span class="keyword">import</span> play.utils.UriEncoding

<span class="keyword">import</span> scala.collection.concurrent.TrieMap
<span class="keyword">import</span> scala.util.matching.Regex

<span class="comment">/**
 * The path extractor.
 *
 * Supported data types that can be extracted from:
 *   - play.api.mvc.RequestHeader
 *   - String
 *   - java.net.URI
 *   - java.net.URL
 *
 * @param regex The regex that is used to extract the raw parts.
 * @param partDescriptors Descriptors saying whether each part should be decoded or not.
 */</span>
<span class="keyword">class</span> <a title="class PathExtractor extends AnyRef" id="play.api.routing.sird;PathExtractor">PathExtractor</a><a href="#play.api.routing.sird;PathExtractor" title="play.api.routing.sird.PathExtractor" class="delimiter">(</a><a title="scala.util.matching.Regex" id="play.api.routing.sird;PathExtractor.regex">regex</a>: <span title="scala.util.matching.Regex">Regex</span>, <a title="Seq[play.api.routing.sird.PathPart.Value]" id="play.api.routing.sird;PathExtractor.partDescriptors">partDescriptors</a>: <span title="Seq[play.api.routing.sird.PathPart.Value]">Seq</span><span class="delimiter">[</span>PathPart.Value<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(path: String)Option[List[String]]" id="play.api.routing.sird;PathExtractor.unapplySeq(4488911314)">unapplySeq</a><span class="delimiter">(</span><a title="String" id="play.api.routing.sird;PathExtractor.unapplySeq(4488911314).path">path</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[List[String]]">Option</span><span class="delimiter">[</span>List<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#play.api.routing.sird;PathExtractor.extract" title="(path: String)Option[List[String]]">extract</a><span class="delimiter">(</span><a href="#play.api.routing.sird;PathExtractor.unapplySeq(4488911314).path" title="String">path</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(request: play.api.mvc.RequestHeader)Option[List[String]]" id="play.api.routing.sird;PathExtractor.unapplySeq(08ae4b86c8)">unapplySeq</a><span class="delimiter">(</span><a title="play.api.mvc.RequestHeader" id="play.api.routing.sird;PathExtractor.unapplySeq(08ae4b86c8).request">request</a>: <a href="../../mvc/Http.scala.html#play.api.mvc;RequestHeader" title="play.api.mvc.RequestHeader">RequestHeader</a><span class="delimiter">)</span>: <span title="Option[List[String]]">Option</span><span class="delimiter">[</span>List<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#play.api.routing.sird;PathExtractor.extract" title="(path: String)Option[List[String]]">extract</a><span class="delimiter">(</span><a href="#play.api.routing.sird;PathExtractor.unapplySeq(08ae4b86c8).request" title="play.api.mvc.RequestHeader">request</a>.<a href="../../mvc/Http.scala.html#play.api.mvc;RequestHeader.path" title="=&gt; String">path</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(url: java.net.URL)Option[List[String]]" id="play.api.routing.sird;PathExtractor.unapplySeq(c7d68e229d)">unapplySeq</a><span class="delimiter">(</span><a title="java.net.URL" id="play.api.routing.sird;PathExtractor.unapplySeq(c7d68e229d).url">url</a>: <span title="java.net.URL">URL</span><span class="delimiter">)</span>: <span title="Option[List[String]]">Option</span><span class="delimiter">[</span>List<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="(x: String)Option[String]">Option</span><span class="delimiter">(</span><a href="#play.api.routing.sird;PathExtractor.unapplySeq(c7d68e229d).url" title="java.net.URL">url</a>.<span title="()String">getPath</span><span class="delimiter">)</span>.<span title="(f: String =&gt; Option[List[String]])Option[List[String]]">flatMap</span><span class="delimiter">(</span><a href="#play.api.routing.sird;PathExtractor.extract" title="(path: String)Option[List[String]]">extract</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(uri: java.net.URI)Option[List[String]]" id="play.api.routing.sird;PathExtractor.unapplySeq(9cda07013d)">unapplySeq</a><span class="delimiter">(</span><a title="java.net.URI" id="play.api.routing.sird;PathExtractor.unapplySeq(9cda07013d).uri">uri</a>: <span title="java.net.URI">URI</span><span class="delimiter">)</span>: <span title="Option[List[String]]">Option</span><span class="delimiter">[</span>List<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="(x: String)Option[String]">Option</span><span class="delimiter">(</span><a href="#play.api.routing.sird;PathExtractor.unapplySeq(9cda07013d).uri" title="java.net.URI">uri</a>.<span title="()String">getRawPath</span><span class="delimiter">)</span>.<span title="(f: String =&gt; Option[List[String]])Option[List[String]]">flatMap</span><span class="delimiter">(</span><a href="#play.api.routing.sird;PathExtractor.extract" title="(path: String)Option[List[String]]">extract</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(path: String)Option[List[String]]" id="play.api.routing.sird;PathExtractor.extract">extract</a><span class="delimiter">(</span><a title="String" id="play.api.routing.sird;PathExtractor.extract.path">path</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[List[String]]">Option</span><span class="delimiter">[</span>List<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#play.api.routing.sird;PathExtractor.regex" title="scala.util.matching.Regex">regex</a>.<span title="(target: Any)Option[List[String]]">unapplySeq</span><span class="delimiter">(</span><a href="#play.api.routing.sird;PathExtractor.extract.path" title="String">path</a><span class="delimiter">)</span>.<span title="(f: List[String] =&gt; List[String])Option[List[String]]">map</span> <span class="delimiter">{</span> <a title="List[String]" id="play.api.routing.sird;PathExtractor.extract.$anonfun.parts">parts</a> =&gt;
      <a href="#play.api.routing.sird;PathExtractor.extract.$anonfun.parts" title="List[String]">parts</a>.<span title="(that: scala.collection.GenIterable[play.api.routing.sird.PathPart.Value])(implicit bf: scala.collection.generic.CanBuildFrom[List[String],(String, play.api.routing.sird.PathPart.Value),List[(String, play.api.routing.sird.PathPart.Value)]])List[(String, play.api.routing.sird.PathPart.Value)]">zip</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,(String, play.api.routing.sird.PathPart.Value),List[(String, play.api.routing.sird.PathPart.Value)]]" class="delimiter">(</span><a href="#play.api.routing.sird;PathExtractor.partDescriptors" title="Seq[play.api.routing.sird.PathPart.Value]">partDescriptors</a><span class="delimiter">)</span>.<span title="(f: ((String, play.api.routing.sird.PathPart.Value)) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[(String, play.api.routing.sird.PathPart.Value)],String,List[String]])List[String]">map</span> <a href="#play.api.routing.sird;PathExtractor.extract.$anonfun.$anonfun.x0$1" title="String" class="delimiter">{</a>
        <span class="keyword">case</span> <span class="delimiter">(</span><span title="String">part</span>, <a href="#play.api.routing.sird.PathPart" title="play.api.routing.sird.PathPart.type">PathPart</a>.<a href="#play.api.routing.sird.PathPart.Decoded" title="=&gt; play.api.routing.sird.PathPart.Value">Decoded</a><span class="delimiter">)</span> =&gt; <a href="../../../utils/UriEncoding.scala.html#play.utils.UriEncoding" title="play.utils.UriEncoding.type">UriEncoding</a>.<a href="../../../utils/UriEncoding.scala.html#play.utils.UriEncoding.decodePathSegment" title="(s: String, outputCharset: String)String">decodePathSegment</a><span class="delimiter">(</span><span title="String">part</span>, <span title="String(&quot;utf-8&quot;)" class="string">&quot;utf-8&quot;</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span class="delimiter">(</span><span title="String">part</span>, <a href="#play.api.routing.sird.PathPart" title="play.api.routing.sird.PathPart.type">PathPart</a>.<a href="#play.api.routing.sird.PathPart.Raw" title="=&gt; play.api.routing.sird.PathPart.Value">Raw</a><span class="delimiter">)</span> =&gt; <span title="String">part</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span title="AnyRef" class="keyword">object</span> <a title="play.api.routing.sird.PathExtractor.type" id="play.api.routing.sird.PathExtractor">PathExtractor</a> <a href="#play.api.routing.sird.PathExtractor" title="play.api.routing.sird.PathExtractor.type" class="delimiter">{</a>
  <span class="comment">// Memoizes all the routes, so that the route doesn't have to be parsed, and the resulting regex compiled,</span>
  <span class="comment">// on each invocation.</span>
  <span class="comment">// There is a possible memory leak here, especially if RouteContext is instantiated dynamically. But,</span>
  <span class="comment">// under normal usage, there will only be as many entries in this cache as there are usages of this</span>
  <span class="comment">// string interpolator in code - even in a very dynamic classloading environment with many different</span>
  <span class="comment">// strings being interpolated, the chances of this cache ever causing an out of memory error are very</span>
  <span class="comment">// low.</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.concurrent.TrieMap[Seq[String],play.api.routing.sird.PathExtractor]" id="play.api.routing.sird.PathExtractor.cache">cache</a> = <span title="scala.collection.concurrent.TrieMap.type">TrieMap</span>.<span title="[K, V]=&gt; scala.collection.concurrent.TrieMap[K,V]">empty</span><span title="scala.collection.concurrent.TrieMap[Seq[String],play.api.routing.sird.PathExtractor]" class="delimiter">[</span><span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a href="#play.api.routing.sird;PathExtractor" title="play.api.routing.sird.PathExtractor">PathExtractor</a><span class="delimiter">]</span>

  <span class="comment">/**
   * Lookup the PathExtractor from the cache, or create and store a new one if not found.
   */</span>
  <span class="keyword">def</span> <a title="(parts: Seq[String])play.api.routing.sird.PathExtractor" id="play.api.routing.sird.PathExtractor.cached">cached</a><span class="delimiter">(</span><a title="Seq[String]" id="play.api.routing.sird.PathExtractor.cached.parts">parts</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#play.api.routing.sird;PathExtractor" title="play.api.routing.sird.PathExtractor">PathExtractor</a> = <span class="delimiter">{</span>
    <a href="#play.api.routing.sird.PathExtractor.cache" title="=&gt; scala.collection.concurrent.TrieMap[Seq[String],play.api.routing.sird.PathExtractor]">cache</a>.<span title="(key: Seq[String], op: =&gt; play.api.routing.sird.PathExtractor)play.api.routing.sird.PathExtractor">getOrElseUpdate</span><span class="delimiter">(</span><a href="#play.api.routing.sird.PathExtractor.cached.parts" title="Seq[String]">parts</a>, <span class="delimiter">{</span>

      <span class="comment">// &quot;parse&quot; the path</span>
      <span class="keyword">val</span> <a href="#play.api.routing.sird.PathExtractor.cached.regexParts" title="(Seq[String], Seq[play.api.routing.sird.PathPart.Value])" class="delimiter">(</a><a href="#play.api.routing.sird.PathExtractor.cached.x$1" title="Seq[String]" id="play.api.routing.sird.PathExtractor.cached.regexParts">regexParts</a>, <a href="#play.api.routing.sird.PathExtractor.cached.x$1" title="Seq[play.api.routing.sird.PathPart.Value]" id="play.api.routing.sird.PathExtractor.cached.descs">descs</a><span class="delimiter">)</span> = <a href="#play.api.routing.sird.PathExtractor.cached.parts" title="Seq[String]">parts</a>.<span title="=&gt; Seq[String]">tail</span>.<span title="(f: String =&gt; (String, play.api.routing.sird.PathPart.Value))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],(String, play.api.routing.sird.PathPart.Value),Seq[(String, play.api.routing.sird.PathPart.Value)]])Seq[(String, play.api.routing.sird.PathPart.Value)]">map</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(String, play.api.routing.sird.PathPart.Value),Seq[(String, play.api.routing.sird.PathPart.Value)]]" class="delimiter">{</span> <a title="String" id="play.api.routing.sird.PathExtractor.cached.x$1.$anonfun.part">part</a> =&gt;

        <span title="(String, play.api.routing.sird.PathPart.Value)" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.routing.sird.PathExtractor.cached.x$1.$anonfun.part" title="String">part</a>.<span title="(x$1: String)Boolean">startsWith</span><span class="delimiter">(</span><span title="String(&quot;*&quot;)" class="string">&quot;*&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="comment">// It's a .* matcher</span>
          <span title="String(&quot;(.*)&quot;)" class="string">&quot;(.*)&quot;</span> <span title="(x: String)ArrowAssoc[String]">+</span> <span title="java.util.regex.Pattern.type">Pattern</span>.<span title="(x$1: String)String">quote</span><span class="delimiter">(</span><a href="#play.api.routing.sird.PathExtractor.cached.x$1.$anonfun.part" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">part</a>.<span title="(n: Int)String">drop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(y: play.api.routing.sird.PathPart.Value)(String, play.api.routing.sird.PathPart.Value)">-&gt;</span> <a href="#play.api.routing.sird.PathPart" title="play.api.routing.sird.PathPart.type">PathPart</a>.<a href="#play.api.routing.sird.PathPart.Raw" title="=&gt; play.api.routing.sird.PathPart.Value">Raw</a>

        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="(String, play.api.routing.sird.PathPart.Value)" class="keyword">if</span> <span class="delimiter">(</span><a href="#play.api.routing.sird.PathExtractor.cached.x$1.$anonfun.part" title="String">part</a>.<span title="(x$1: String)Boolean">startsWith</span><span class="delimiter">(</span><span title="String(&quot;&lt;&quot;)" class="string">&quot;&lt;&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#play.api.routing.sird.PathExtractor.cached.x$1.$anonfun.part" title="String">part</a>.<span title="(x$1: CharSequence)Boolean">contains</span><span class="delimiter">(</span><span title="String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="comment">// It's a regex matcher</span>
          <span class="keyword">val</span> <a title="Array[String]" id="play.api.routing.sird.PathExtractor.cached.x$1.$anonfun.splitted">splitted</a> = <a href="#play.api.routing.sird.PathExtractor.cached.x$1.$anonfun.part" title="String">part</a>.<span title="(x$1: String, x$2: Int)Array[String]">split</span><span class="delimiter">(</span><span title="String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span>, <span title="Int(2)" class="int">2</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="String" id="play.api.routing.sird.PathExtractor.cached.x$1.$anonfun.regex">regex</a> = <a href="#play.api.routing.sird.PathExtractor.cached.x$1.$anonfun.splitted" title="(i: Int)String">splitted</a><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="(n: Int)String">drop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <span title="String(&quot;(&quot;)" class="string">&quot;(&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#play.api.routing.sird.PathExtractor.cached.x$1.$anonfun.regex" title="String">regex</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span> <span title="(x: String)ArrowAssoc[String]">+</span> <span title="java.util.regex.Pattern.type">Pattern</span>.<span title="(x$1: String)String">quote</span><span class="delimiter">(</span><a href="#play.api.routing.sird.PathExtractor.cached.x$1.$anonfun.splitted" title="(i: Int)String">splitted</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(y: play.api.routing.sird.PathPart.Value)(String, play.api.routing.sird.PathPart.Value)">-&gt;</span> <a href="#play.api.routing.sird.PathPart" title="play.api.routing.sird.PathPart.type">PathPart</a>.<a href="#play.api.routing.sird.PathPart.Raw" title="=&gt; play.api.routing.sird.PathPart.Value">Raw</a>

        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="comment">// It's an ordinary path part matcher</span>
          <span title="String(&quot;([^/]*)&quot;)" class="string">&quot;([^/]*)&quot;</span> <span title="(x: String)ArrowAssoc[String]">+</span> <span title="java.util.regex.Pattern.type">Pattern</span>.<span title="(x$1: String)String">quote</span><span class="delimiter">(</span><a href="#play.api.routing.sird.PathExtractor.cached.x$1.$anonfun.part" title="String">part</a><span class="delimiter">)</span> <span title="(y: play.api.routing.sird.PathPart.Value)(String, play.api.routing.sird.PathPart.Value)">-&gt;</span> <a href="#play.api.routing.sird.PathPart" title="play.api.routing.sird.PathPart.type">PathPart</a>.<a href="#play.api.routing.sird.PathPart.Decoded" title="=&gt; play.api.routing.sird.PathPart.Value">Decoded</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>.<span title="(implicit asPair: ((String, play.api.routing.sird.PathPart.Value)) =&gt; (String, play.api.routing.sird.PathPart.Value))(Seq[String], Seq[play.api.routing.sird.PathPart.Value])">unzip</span>

      <span title="play.api.routing.sird.PathExtractor" class="keyword">new</span> <a href="#play.api.routing.sird;PathExtractor" title="play.api.routing.sird.PathExtractor">PathExtractor</a><span class="delimiter">(</span><a href="#play.api.routing.sird.PathExtractor.cached.regexParts" title="Seq[String]">regexParts</a>.<span title="(start: String, sep: String, end: String)String">mkString</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="delimiter">(</span><span title="java.util.regex.Pattern.type">Pattern</span>.<span title="(x$1: String)String">quote</span><span class="delimiter">(</span><a href="#play.api.routing.sird.PathExtractor.cached.parts" title="Seq[String]">parts</a>.<span title="=&gt; String">head</span><span class="delimiter">)</span>, <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="String(&quot;/?&quot;)" class="string">&quot;/?&quot;</span><span class="delimiter">)</span>.<span title="=&gt; scala.util.matching.Regex">r</span>, <a href="#play.api.routing.sird.PathExtractor.cached.descs" title="Seq[play.api.routing.sird.PathPart.Value]">descs</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * A path part descriptor. Describes whether the path part should be decoded, or left as is.
 */</span>
<span title="AnyRef" class="keyword">private</span> <span class="keyword">object</span> <a title="play.api.routing.sird.PathPart.type" id="play.api.routing.sird.PathPart">PathPart</a> <a href="#play.api.routing.sird.PathPart" title="play.api.routing.sird.PathPart.type" class="keyword">extends</a> <span title="Enumeration">Enumeration</span> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="play.api.routing.sird.PathPart.Value" id="play.api.routing.sird.PathPart.Decoded">Decoded</a>, <a title="play.api.routing.sird.PathPart.Value" id="play.api.routing.sird.PathPart.Raw">Raw</a> = <span title="=&gt; play.api.routing.sird.PathPart.Value">Value</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>
