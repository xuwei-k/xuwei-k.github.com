<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/typechecker/PatMatVirtualiser.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * @author Adriaan Moors
 */

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> typechecker

<span class="keyword">import</span> symtab._
<span class="keyword">import</span> <a href="../symtab/package.scala.html#57302" title="=&gt; reflect.internal.Flags.type">Flags</a>.<span class="delimiter">{</span>MUTABLE, METHOD, LABEL, SYNTHETIC<span class="delimiter">}</span>
<span class="keyword">import</span> <a href="../../../language.scala.html#2216" title="language.type">language</a>.postfixOps

/** Translate pattern matching into method calls (these methods form a zero-plus monad), similar in spirit to how for-comprehensions are compiled.
  *
  * For each case, express all patterns as extractor calls, guards as 0-ary extractors, and sequence them using `flatMap`
  * (lifting the body of the case into the monad using `one`).
  *
  * Cases are combined into a pattern match using the `orElse` combinator (the implicit failure case is expressed using the monad's `zero`).

  * TODO:
  *  - interaction with CPS
  *  - Array patterns
  *  - implement spec more closely (see TODO's)
  *  - DCE
  *  - use TypeTags for type testing
  *
  * (longer-term) TODO:
  *  - user-defined unapplyProd
  *  - recover GADT typing by locally inserting implicit witnesses to type equalities derived from the current case, and considering these witnesses during subtyping (?)
  *  - recover exhaustivity and unreachability checking using a variation on the type-safe builder pattern
  */
<span class="keyword">trait</span> <a title="trait PatMatVirtualiser extends Object with scala.tools.nsc.ast.TreeDSL" id="49395">PatMatVirtualiser</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> ast.<a href="../ast/TreeDSL.scala.html#29480" title="scala.tools.nsc.ast.TreeDSL">TreeDSL</a> <span class="delimiter">{</span> self: Analyzer =&gt;
  <span class="keyword">import</span> <a href="Analyzer.scala.html#560057" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#441641" title="PatMatVirtualiser.this.global.definitions.type">definitions</a>._

  <span class="keyword">val</span> <a title="Int" id="560229">SYNTH_CASE</a> = Flags.CASE <span title="Int(2099200)">|</span> SYNTHETIC

  <span class="keyword">object</span> <a title="PatMatVirtualiser.this.vpmName.type" id="560231">vpmName</a> <a href="#560232" title="PatMatVirtualiser.this.vpmName.type" class="delimiter">{</a>
    <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermName" id="1134610">one</a>       = <a href="../../../reflect/internal/Names.scala.html#440783" title="(s: String)PatMatVirtualiser.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;one&quot;)" class="string">&quot;one&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermName" id="1134612">drop</a>      = <a href="../../../reflect/internal/Names.scala.html#440783" title="(s: String)PatMatVirtualiser.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;drop&quot;)" class="string">&quot;drop&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermName" id="1134614">flatMap</a>   = <a href="../../../reflect/internal/Names.scala.html#440783" title="(s: String)PatMatVirtualiser.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;flatMap&quot;)" class="string">&quot;flatMap&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermName" id="1134616">get</a>       = <a href="../../../reflect/internal/Names.scala.html#440783" title="(s: String)PatMatVirtualiser.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;get&quot;)" class="string">&quot;get&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermName" id="1134618">guard</a>     = <a href="../../../reflect/internal/Names.scala.html#440783" title="(s: String)PatMatVirtualiser.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;guard&quot;)" class="string">&quot;guard&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermName" id="1134620">isEmpty</a>   = <a href="../../../reflect/internal/Names.scala.html#440783" title="(s: String)PatMatVirtualiser.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;isEmpty&quot;)" class="string">&quot;isEmpty&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermName" id="1134622">orElse</a>    = <a href="../../../reflect/internal/Names.scala.html#440783" title="(s: String)PatMatVirtualiser.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;orElse&quot;)" class="string">&quot;orElse&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermName" id="1134624">outer</a>     = <a href="../../../reflect/internal/Names.scala.html#440783" title="(s: String)PatMatVirtualiser.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;&lt;outer&gt;&quot;)" class="string">&quot;&lt;outer&gt;&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermName" id="1134626">runOrElse</a> = <a href="../../../reflect/internal/Names.scala.html#440783" title="(s: String)PatMatVirtualiser.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;runOrElse&quot;)" class="string">&quot;runOrElse&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermName" id="1134628">zero</a>      = <a href="../../../reflect/internal/Names.scala.html#440783" title="(s: String)PatMatVirtualiser.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;zero&quot;)" class="string">&quot;zero&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermName" id="1134630">_match</a>    = <a href="../../../reflect/internal/Names.scala.html#440783" title="(s: String)PatMatVirtualiser.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;__match&quot;)" class="string">&quot;__match&quot;</span><span class="delimiter">)</span> // don't call the val __match, since that will trigger virtual pattern matching...

    <span class="keyword">def</span> <a title="(str: String, i: Int)PatMatVirtualiser.this.global.TermName" id="1134632">counted</a><span class="delimiter">(</span><a title="String" id="1134678">str</a>: <span title="String">String</span>, <a title="Int" id="1134679">i</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span> = <a href="../../../reflect/internal/Names.scala.html#440783" title="(s: String)PatMatVirtualiser.this.global.TermName">newTermName</a><span class="delimiter">(</span><a href="#1134678" title="String">str</a><span title="(x$1: Any)String">+</span><a href="#1134679" title="Int">i</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="PatMatVirtualiser.this.MatchTranslator.type" id="560233">MatchTranslator</a> <a href="#560234" title="PatMatVirtualiser.this.MatchTranslator.type" class="delimiter">{</a>
    <span class="keyword">def</span> <a title="(typer: PatMatVirtualiser.this.Typer)PatMatVirtualiser.this.MatchTranslation with PatMatVirtualiser.this.CodegenCore" id="1134685">apply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.Typer" id="1134687">typer</a>: <a href="Typers.scala.html#560207" title="PatMatVirtualiser.this.Typer">Typer</a><span class="delimiter">)</span>: <a href="#1134688" title="MatchTranslator extends PatMatVirtualiser.this.MatchTranslation with PatMatVirtualiser.this.CodegenCore">MatchTranslation</a> <span class="keyword">with</span> CodegenCore = <span class="delimiter">{</span>
      <span class="keyword">import</span> <a href="#1134687" title="PatMatVirtualiser.this.Typer">typer</a>._
      // typing `_match` to decide which MatchTranslator to create adds 4% to quick.comp.timer
      <a href="Typers.scala.html#560201" title="(context: PatMatVirtualiser.this.Context)PatMatVirtualiser.this.Typer">newTyper</a><a title="PatMatVirtualiser.this.Typer" id="1134735" class="delimiter">(</a><a href="Typers.scala.html#560636" title="=&gt; PatMatVirtualiser.this.Context">context</a>.<a href="Contexts.scala.html#560977" title="(reportAmbiguousErrors: Boolean)PatMatVirtualiser.this.Context">makeImplicit</a><span class="delimiter">(</span>reportAmbiguousErrors = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="Typers.scala.html#562772" title="PatMatVirtualiser.this.global.Tree" id="1134771">silent</a><a href="Typers.scala.html#562820" title="=&gt; PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="#1134737" title="PatMatVirtualiser.this.Typer">_</a>.<a href="Typers.scala.html#560765" title="(tree: PatMatVirtualiser.this.global.Tree, mode: Int, pt: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree">typed</a><a title="PatMatVirtualiser.this.Typer =&gt; PatMatVirtualiser.this.global.Tree" id="1134769" class="delimiter">(</a><a href="../../../reflect/api/Trees.scala.html#427669" title="(name: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="#560231" title="PatMatVirtualiser.this.vpmName.type">vpmName</a>.<a href="#1134630" title="=&gt; PatMatVirtualiser.this.global.TermName">_match</a><span class="delimiter">)</span>, <span title="Int(1)">EXPRmode</span>, <a href="../../../reflect/internal/Types.scala.html#441251" title="PatMatVirtualiser.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>, reportAmbiguousErrors = <a title="Boolean(false)" id="1134770" class="keyword">false</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> SilentResultValue<a href="#1134909" title="MatchTranslator extends PatMatVirtualiser.this.MatchTranslation with PatMatVirtualiser.this.CodegenCore" id="1134911" class="delimiter">(</a>ms<span class="delimiter">)</span> =&gt; <a href="#1134912" title="(x: PatMatVirtualiser.this.MatchTranslation with PatMatVirtualiser.this.CodegenCore)PatMatVirtualiser.this.MatchTranslation with PatMatVirtualiser.this.CodegenCore" class="keyword">new</a> <a href="#560235" title="PatMatVirtualiser.this.PureMatchTranslator">PureMatchTranslator</a><span class="delimiter">(</span><a href="#1134687" title="PatMatVirtualiser.this.Typer">typer</a>, ms<span class="delimiter">)</span>
          <span class="keyword">case</span> _ =&gt; <a href="#1134912" title="(x: PatMatVirtualiser.this.MatchTranslation with PatMatVirtualiser.this.CodegenCore)PatMatVirtualiser.this.MatchTranslation with PatMatVirtualiser.this.CodegenCore" class="keyword">new</a> <a href="#560236" title="PatMatVirtualiser.this.OptimizingMatchTranslator">OptimizingMatchTranslator</a><span class="delimiter">(</span><a href="#1134687" title="PatMatVirtualiser.this.Typer">typer</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">class</span> <a title="class PureMatchTranslator extends Object with PatMatVirtualiser.this.MatchTranslation with PatMatVirtualiser.this.TreeMakers with PatMatVirtualiser.this.PureCodegen" id="560235">PureMatchTranslator</a><a href="#560235" title="PatMatVirtualiser.this.PureMatchTranslator" class="delimiter">(</a><span class="keyword">val</span> <a title="PatMatVirtualiser.this.Typer" id="1134848">typer</a>: <a href="Typers.scala.html#560207" title="PatMatVirtualiser.this.Typer">Typer</a>, <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1134849">matchStrategy</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#560238" title="PatMatVirtualiser.this.MatchTranslation">MatchTranslation</a> <span class="keyword">with</span> <a href="#560240" title="PatMatVirtualiser.this.TreeMakers">TreeMakers</a> <span class="keyword">with</span> <a href="#560243" title="PatMatVirtualiser.this.PureCodegen">PureCodegen</a>
  <span class="keyword">class</span> <a title="class OptimizingMatchTranslator extends Object with PatMatVirtualiser.this.MatchTranslation with PatMatVirtualiser.this.TreeMakers with PatMatVirtualiser.this.MatchOptimizations" id="560236">OptimizingMatchTranslator</a><a href="#560236" title="PatMatVirtualiser.this.OptimizingMatchTranslator" class="delimiter">(</a><span class="keyword">val</span> <a title="PatMatVirtualiser.this.Typer" id="1134907">typer</a>: <a href="Typers.scala.html#560207" title="PatMatVirtualiser.this.Typer">Typer</a><span class="delimiter">)</span>                    <span class="keyword">extends</span> <a href="#560238" title="PatMatVirtualiser.this.MatchTranslation">MatchTranslation</a> <span class="keyword">with</span> <a href="#560240" title="PatMatVirtualiser.this.TreeMakers">TreeMakers</a> <span class="keyword">with</span> <a href="#560250" title="PatMatVirtualiser.this.MatchOptimizations">MatchOptimizations</a>

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// talking to userland
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  /** Interface with user-defined match monad?
   * if there's a `__match` in scope, we use this as the match strategy, assuming it conforms to MatchStrategy as defined below:

       type Matcher[P[_], M[+_], A] = {
         def flatMap[B](f: P[A] =&gt; M[B]): M[B]
         def orElse[B &gt;: A](alternative: =&gt; M[B]): M[B]
       }

       abstract class MatchStrategy[P[_], M[+_]] {
         // runs the matcher on the given input
         def runOrElse[T, U](in: P[T])(matcher: P[T] =&gt; M[U]): P[U]

         def zero: M[Nothing]
         def one[T](x: P[T]): M[T]
         def guard[T](cond: P[Boolean], then: =&gt; P[T]): M[T]
         def isSuccess[T, U](x: P[T])(f: P[T] =&gt; M[U]): P[Boolean] // used for isDefinedAt
       }

   * P and M are derived from one's signature (`def one[T](x: P[T]): M[T]`)


   * if no `__match` is found, we assume the following implementation (and generate optimized code accordingly)

       object __match extends MatchStrategy[({type Id[x] = x})#Id, Option] {
         def zero = None
         def one[T](x: T) = Some(x)
         // NOTE: guard's return type must be of the shape M[T], where M is the monad in which the pattern match should be interpreted
         def guard[T](cond: Boolean, then: =&gt; T): Option[T] = if(cond) Some(then) else None
         def runOrElse[T, U](x: T)(f: T =&gt; Option[U]): U = f(x) getOrElse (throw new MatchError(x))
         def isSuccess[T, U](x: T)(f: T =&gt; Option[U]): Boolean = !f(x).isEmpty
       }

   */
  <span class="keyword">trait</span> <a title="trait MatchMonadInterface extends Object" id="560237">MatchMonadInterface</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="delimiter">{</a>
    <span class="keyword">val</span> <a title="=&gt; PatMatVirtualiser.this.Typer" id="1134690">typer</a>: <a href="Typers.scala.html#560207" title="PatMatVirtualiser.this.Typer">Typer</a>
    <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Symbol" id="1134691">matchOwner</a> = <a href="#1134690" title="=&gt; PatMatVirtualiser.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; PatMatVirtualiser.this.Context">context</a>.<a href="Contexts.scala.html#560856" title="=&gt; PatMatVirtualiser.this.global.Symbol">owner</a>

    <span class="keyword">def</span> <a title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type" id="1134693">inMatchMonad</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Type" id="1134927">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>
    <span class="keyword">def</span> <a title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type" id="1134694">pureType</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Type" id="1134928">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>
    <span class="keyword">final</span> <span class="keyword">def</span> <a title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type" id="1134695">matchMonadResult</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Type" id="1134929">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a> =
      <a href="#1134929" title="PatMatVirtualiser.this.global.Type">tp</a>.<a href="../../../reflect/internal/Types.scala.html#442036" title="(clazz: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Type">baseType</a><span class="delimiter">(</span><a href="#1134696" title="=&gt; PatMatVirtualiser.this.global.Symbol">matchMonadSym</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Types.scala.html#442000" title="=&gt; List[PatMatVirtualiser.this.global.Type]">typeArgs</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> arg <a href="#1134940" title="PatMatVirtualiser.this.global.Type" id="1134942">::</a> <a href="../../../collection/immutable/List.scala.html#11552" title="PatMatVirtualiser.this.global.Type" id="1134944">Nil</a> =&gt; <a href="#1134945" title="(x: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">arg</a>
        <span class="keyword">case</span> _ =&gt; <a href="#1134945" title="(x: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">ErrorType</a>
      <span class="delimiter">}</span>

    <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Symbol" id="1134696">matchMonadSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>
  <span class="delimiter">}</span>

  <span class="keyword">trait</span> <a title="trait MatchTranslation extends Object with PatMatVirtualiser.this.MatchMonadInterface" id="560238">MatchTranslation</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#560237" title="PatMatVirtualiser.this.MatchMonadInterface">MatchMonadInterface</a> <span class="delimiter">{</span> self: TreeMakers <span class="keyword">with</span> CodegenCore =&gt;
    <span class="keyword">import</span> <a href="#1134690" title="=&gt; PatMatVirtualiser.this.Typer">typer</a>.<span class="delimiter">{</span>typed, context, silent, reallyExists<span class="delimiter">}</span>
    // import typer.infer.containsUnchecked

    /** Implement a pattern match by turning its cases (including the implicit failure case)
      * into the corresponding (monadic) extractors, and combining them with the `orElse` combinator.
      *
      * For `scrutinee match { case1 ... caseN }`, the resulting tree has the shape
      * `runOrElse(scrutinee)(x =&gt; translateCase1(x).orElse(translateCase2(x)).....orElse(zero))`
      *
      * NOTE: the resulting tree is not type checked, nor are nested pattern matches transformed
      *   thus, you must typecheck the result (and that will in turn translate nested matches)
      *   this could probably optimized... (but note that the matchStrategy must be solved for each nested patternmatch)
      */
    <span class="keyword">def</span> <a title="(scrut: PatMatVirtualiser.this.global.Tree, cases: List[PatMatVirtualiser.this.global.CaseDef], pt: PatMatVirtualiser.this.global.Type, scrutType: PatMatVirtualiser.this.global.Type, matchFailGenOverride: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree" id="1134700">translateMatch</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1134957">scrut</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="List[PatMatVirtualiser.this.global.CaseDef]" id="1134958">cases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.CaseDef]">List</a><span class="delimiter">[</span>CaseDef<span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Type" id="1134959">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>, <a title="PatMatVirtualiser.this.global.Type" id="1134960">scrutType</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>, <a title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]" id="1134963">matchFailGenOverride</a>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree =&gt; Tree<span class="delimiter">]</span> = <a href="../../../Option.scala.html#2498" title="None.type">None</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      // we don't transform after uncurry
      // (that would require more sophistication when generating trees,
      //  and the only place that emits Matches after typers is for exception handling anyway)
      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="../../../reflect/internal/SymbolTable.scala.html#440593" title="=&gt; scala.reflect.internal.Phase">phase</a>.<a href="../../../reflect/internal/Phase.scala.html#452437" title="=&gt; Int">id</a> <a href="../../../Int.scala.html#57926" title="(x: Int)Boolean">&gt;=</a> <a href="../Global.scala.html#559697" title="=&gt; PatMatVirtualiser.this.global.Run">currentRun</a>.<a href="../Global.scala.html#561327" title="=&gt; scala.tools.nsc.Phase">uncurryPhase</a>.<a href="../../../reflect/internal/Phase.scala.html#452437" title="=&gt; Int">id</a><span class="delimiter">)</span> <a href="../Global.scala.html#559539" title="(msg: =&gt; String)Unit">debugwarn</a><span class="delimiter">(</span><span title="String(&quot;running translateMatch at &quot;)" class="string">&quot;running translateMatch at &quot;</span><span title="(x$1: Any)String">+</span> <a href="../../../reflect/internal/SymbolTable.scala.html#440593" title="=&gt; scala.reflect.internal.Phase">phase</a> <span title="(x$1: Any)String">+</span><span title="String(&quot; on &quot;)" class="string">&quot; on &quot;</span><span title="(x$1: Any)String">+</span> <a href="#1134957" title="PatMatVirtualiser.this.global.Tree">scrut</a> <span title="(x$1: Any)String">+</span><span title="String(&quot; match &quot;)" class="string">&quot; match &quot;</span><span title="(x$1: Any)String">+</span> <a href="#1134958" title="List[PatMatVirtualiser.this.global.CaseDef]">cases</a><span class="delimiter">)</span>
      // println(&quot;translating &quot;+ cases.mkString(&quot;{&quot;, &quot;\n&quot;, &quot;}&quot;))
      <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermSymbol" id="1134964">scrutSym</a>  = <a href="#1134720" title="(pos: PatMatVirtualiser.this.global.Position, tp: PatMatVirtualiser.this.global.Type, prefix: String)PatMatVirtualiser.this.global.TermSymbol">freshSym</a><span class="delimiter">(</span><a href="#1134957" title="PatMatVirtualiser.this.global.Tree">scrut</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a>, <a href="#1134694" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">pureType</a><span class="delimiter">(</span><a href="#1134960" title="PatMatVirtualiser.this.global.Type">scrutType</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../reflect/internal/Symbols.scala.html#443305" title="(mask: Long)PatMatVirtualiser.this.global.TermSymbol">setFlag</a> <a href="../../../Int.scala.html#57875" title="=&gt; Long">SYNTH_CASE</a>
      // pt = Any* occurs when compiling test/files/pos/annotDepMethType.scala  with -Xexperimental
      <a href="#1134832" title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, casesRaw: List[List[MatchTranslation.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type, owner: PatMatVirtualiser.this.global.Symbol, matchFailGenOverride: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree">combineCases</a><span class="delimiter">(</span><a href="#1134957" title="PatMatVirtualiser.this.global.Tree">scrut</a>, <a href="#1134964" title="PatMatVirtualiser.this.global.TermSymbol">scrutSym</a>, <a href="#1134958" title="List[PatMatVirtualiser.this.global.CaseDef]">cases</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: PatMatVirtualiser.this.global.CaseDef =&gt; List[MatchTranslation.this.TreeMaker])(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.CaseDef],List[MatchTranslation.this.TreeMaker],List[List[MatchTranslation.this.TreeMaker]]])List[List[MatchTranslation.this.TreeMaker]]">map</a> <a href="#1134702" title="(scrutSym: PatMatVirtualiser.this.global.Symbol, pt: PatMatVirtualiser.this.global.Type)(caseDef: PatMatVirtualiser.this.global.CaseDef)List[MatchTranslation.this.TreeMaker]">translateCase</a><a href="#1135188" title="PatMatVirtualiser.this.global.CaseDef" class="delimiter">(</a><a href="#1134964" title="PatMatVirtualiser.this.global.TermSymbol">scrutSym</a>, <a href="#1134959" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span>, <a href="#1134959" title="PatMatVirtualiser.this.global.Type">pt</a>, <a href="#1134691" title="=&gt; PatMatVirtualiser.this.global.Symbol">matchOwner</a>, <a href="#1134963" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">matchFailGenOverride</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    // return list of typed CaseDefs that are supported by the backend (typed/bind/wildcard)
    // we don't have a global scrutinee -- the caught exception must be bound in each of the casedefs
    // there's no need to check the scrutinee for null -- &quot;throw null&quot; becomes &quot;throw new NullPointerException&quot;
    // try to simplify to a type-based switch, or fall back to a catch-all case that runs a normal pattern match
    // unlike translateMatch, we type our result before returning it
    <span class="keyword">def</span> <a title="(caseDefs: List[PatMatVirtualiser.this.global.CaseDef], pt: PatMatVirtualiser.this.global.Type, pos: PatMatVirtualiser.this.global.Position)List[PatMatVirtualiser.this.global.CaseDef]" id="1134701">translateTry</a><span class="delimiter">(</span><a title="List[PatMatVirtualiser.this.global.CaseDef]" id="1135223">caseDefs</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.CaseDef]">List</a><span class="delimiter">[</span>CaseDef<span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Type" id="1135224">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>, <a title="PatMatVirtualiser.this.global.Position" id="1135225">pos</a>: <a href="../util/Position.scala.html#52230" title="PatMatVirtualiser.this.global.Position">Position</a><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.CaseDef]">List</a><span class="delimiter">[</span>CaseDef<span class="delimiter">]</span> =
      // if they're already simple enough to be handled by the back-end, we're done
      <span title="List[PatMatVirtualiser.this.global.CaseDef]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1135223" title="List[PatMatVirtualiser.this.global.CaseDef]">caseDefs</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76169" title="(p: PatMatVirtualiser.this.global.CaseDef =&gt; Boolean)Boolean">forall</a> <a href="../ast/Trees.scala.html#559838" title="PatMatVirtualiser.this.global.treeInfo.type">treeInfo</a>.<a href="../../../reflect/internal/TreeInfo.scala.html#501510" title="(cdef: PatMatVirtualiser.this.global.treeInfo.global.CaseDef)Boolean">isCatchCase</a><span class="delimiter">)</span> <a href="#1135223" title="List[PatMatVirtualiser.this.global.CaseDef]">caseDefs</a>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="List[PatMatVirtualiser.this.global.CaseDef]" id="1135235">swatches</a> = <span class="delimiter">{</span> // switch-catches
          <span class="keyword">val</span> <a title="List[(PatMatVirtualiser.this.global.TermSymbol, List[MatchTranslation.this.TreeMaker])]" id="1135237">bindersAndCases</a> = <a href="#1135223" title="List[PatMatVirtualiser.this.global.CaseDef]">caseDefs</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: PatMatVirtualiser.this.global.CaseDef =&gt; (PatMatVirtualiser.this.global.TermSymbol, List[MatchTranslation.this.TreeMaker]))(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.CaseDef],(PatMatVirtualiser.this.global.TermSymbol, List[MatchTranslation.this.TreeMaker]),List[(PatMatVirtualiser.this.global.TermSymbol, List[MatchTranslation.this.TreeMaker])]])List[(PatMatVirtualiser.this.global.TermSymbol, List[MatchTranslation.this.TreeMaker])]">map</a> <span class="delimiter">{</span> <a title="PatMatVirtualiser.this.global.CaseDef" id="1135254">caseDef</a> =&gt;
            // generate a fresh symbol for each case, hoping we'll end up emitting a type-switch (we don't have a global scrut there)
            // if we fail to emit a fine-grained switch, have to do translateCase again with a single scrutSym (TODO: uniformize substitution on treemakers so we can avoid this)
            <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermSymbol" id="1135255">caseScrutSym</a> = <a href="#1134720" title="(pos: PatMatVirtualiser.this.global.Position, tp: PatMatVirtualiser.this.global.Type, prefix: String)PatMatVirtualiser.this.global.TermSymbol">freshSym</a><span class="delimiter">(</span><a href="#1135225" title="PatMatVirtualiser.this.global.Position">pos</a>, <a href="#1134694" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">pureType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442209" title="=&gt; PatMatVirtualiser.this.global.Symbol">ThrowableClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="../../../Tuple2.scala.html#63804" title="(_1: PatMatVirtualiser.this.global.TermSymbol, _2: List[MatchTranslation.this.TreeMaker])(PatMatVirtualiser.this.global.TermSymbol, List[MatchTranslation.this.TreeMaker])" class="delimiter">(</a><a href="#1135255" title="PatMatVirtualiser.this.global.TermSymbol">caseScrutSym</a>, <a href="#1134831" title="(treeMakers: List[MatchTranslation.this.TreeMaker], initial: MatchTranslation.this.Substitution)List[MatchTranslation.this.TreeMaker]">propagateSubstitution</a><span class="delimiter">(</span><a href="#1134702" title="(scrutSym: PatMatVirtualiser.this.global.Symbol, pt: PatMatVirtualiser.this.global.Type)(caseDef: PatMatVirtualiser.this.global.CaseDef)List[MatchTranslation.this.TreeMaker]">translateCase</a><span class="delimiter">(</span><a href="#1135255" title="PatMatVirtualiser.this.global.TermSymbol">caseScrutSym</a>, <a href="#1135224" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1135254" title="PatMatVirtualiser.this.global.CaseDef">caseDef</a><span class="delimiter">)</span>, <a href="#1134785" title="MatchTranslation.this.EmptySubstitution.type">EmptySubstitution</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>

          <span class="keyword">for</span><span class="delimiter">(</span><a title="List[PatMatVirtualiser.this.global.CaseDef]" id="1135338">cases</a> &lt;- <a href="#1134791" title="(bindersAndCases: List[(PatMatVirtualiser.this.global.Symbol, List[MatchTranslation.this.TreeMaker])], pt: PatMatVirtualiser.this.global.Type)Option[List[PatMatVirtualiser.this.global.CaseDef]]">emitTypeSwitch</a><span class="delimiter">(</span><a href="#1135237" title="List[(PatMatVirtualiser.this.global.TermSymbol, List[MatchTranslation.this.TreeMaker])]">bindersAndCases</a>, <a href="#1135224" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span>.<a href="../../../collection/generic/FilterMonadic.scala.html#59077" title="(f: List[PatMatVirtualiser.this.global.CaseDef] =&gt; scala.collection.GenTraversableOnce[PatMatVirtualiser.this.global.CaseDef])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[PatMatVirtualiser.this.global.CaseDef]],PatMatVirtualiser.this.global.CaseDef,List[PatMatVirtualiser.this.global.CaseDef]])List[PatMatVirtualiser.this.global.CaseDef]">toList</a>;
              <span class="keyword">if</span> <a href="#1135338" title="List[PatMatVirtualiser.this.global.CaseDef]">cases</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76169" title="(p: PatMatVirtualiser.this.global.CaseDef =&gt; Boolean)Boolean">forall</a> <a href="../ast/Trees.scala.html#559838" title="PatMatVirtualiser.this.global.treeInfo.type">treeInfo</a>.<a href="../../../reflect/internal/TreeInfo.scala.html#501510" title="(cdef: PatMatVirtualiser.this.global.treeInfo.global.CaseDef)Boolean">isCatchCase</a>; // must check again, since it's not guaranteed -- TODO: can we eliminate this? e.g., a type test could test for a trait or a non-trivial prefix, which are not handled by the back-end
              <a title="PatMatVirtualiser.this.global.CaseDef" id="1135355">cse</a> &lt;- <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: PatMatVirtualiser.this.global.CaseDef =&gt; PatMatVirtualiser.this.global.CaseDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.CaseDef],PatMatVirtualiser.this.global.CaseDef,List[PatMatVirtualiser.this.global.CaseDef]])List[PatMatVirtualiser.this.global.CaseDef]">cases</a><span class="delimiter">)</span> <span class="keyword">yield</span> <a href="#1134834" title="(origOwner: PatMatVirtualiser.this.global.Symbol, pos: PatMatVirtualiser.this.global.Position)PatMatVirtualiser.this.global.Traverser">fixerUpper</a><a href="../../../reflect/api/Trees.scala.html#433540" title="(tree: PatMatVirtualiser.this.global.CaseDef)PatMatVirtualiser.this.global.CaseDef" class="delimiter">(</a><a href="#1134691" title="=&gt; PatMatVirtualiser.this.global.Symbol">matchOwner</a>, <a href="#1135225" title="PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1135355" title="PatMatVirtualiser.this.global.CaseDef">cse</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="PatMatVirtualiser.this.global.CaseDef" class="delimiter">[</span><a href="../../../reflect/api/Trees.scala.html#23628" title="PatMatVirtualiser.this.global.CaseDef">CaseDef</a><span class="delimiter">]</span>
        <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="List[PatMatVirtualiser.this.global.CaseDef]" id="1135236">catches</a> = <span title="List[PatMatVirtualiser.this.global.CaseDef]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1135235" title="List[PatMatVirtualiser.this.global.CaseDef]">swatches</a>.<a href="../../../collection/TraversableOnce.scala.html#59102" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <a href="#1135235" title="List[PatMatVirtualiser.this.global.CaseDef]">swatches</a> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermSymbol" id="1135546">scrutSym</a> = <a href="#1134720" title="(pos: PatMatVirtualiser.this.global.Position, tp: PatMatVirtualiser.this.global.Type, prefix: String)PatMatVirtualiser.this.global.TermSymbol">freshSym</a><span class="delimiter">(</span><a href="#1135225" title="PatMatVirtualiser.this.global.Position">pos</a>, <a href="#1134694" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">pureType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442209" title="=&gt; PatMatVirtualiser.this.global.Symbol">ThrowableClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="List[List[MatchTranslation.this.TreeMaker]]" id="1135547">casesNoSubstOnly</a> = <a href="#1135223" title="List[PatMatVirtualiser.this.global.CaseDef]">caseDefs</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: PatMatVirtualiser.this.global.CaseDef =&gt; List[MatchTranslation.this.TreeMaker])(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.CaseDef],List[MatchTranslation.this.TreeMaker],List[List[MatchTranslation.this.TreeMaker]]])List[List[MatchTranslation.this.TreeMaker]]">map</a> <span class="delimiter">{</span> <a title="PatMatVirtualiser.this.global.CaseDef" id="1135565">caseDef</a> =&gt; <span class="delimiter">(</span><a href="#1134831" title="(treeMakers: List[MatchTranslation.this.TreeMaker], initial: MatchTranslation.this.Substitution)List[MatchTranslation.this.TreeMaker]">propagateSubstitution</a><span class="delimiter">(</span><a href="#1134702" title="(scrutSym: PatMatVirtualiser.this.global.Symbol, pt: PatMatVirtualiser.this.global.Type)(caseDef: PatMatVirtualiser.this.global.CaseDef)List[MatchTranslation.this.TreeMaker]">translateCase</a><span class="delimiter">(</span><a href="#1135546" title="PatMatVirtualiser.this.global.TermSymbol">scrutSym</a>, <a href="#1135224" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1135565" title="PatMatVirtualiser.this.global.CaseDef">caseDef</a><span class="delimiter">)</span>, <a href="#1134785" title="MatchTranslation.this.EmptySubstitution.type">EmptySubstitution</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">}</span>

          <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermSymbol" id="1135548">exSym</a> = <a href="#1134720" title="(pos: PatMatVirtualiser.this.global.Position, tp: PatMatVirtualiser.this.global.Type, prefix: String)PatMatVirtualiser.this.global.TermSymbol">freshSym</a><span class="delimiter">(</span><a href="#1135225" title="PatMatVirtualiser.this.global.Position">pos</a>, <a href="#1134694" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">pureType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442209" title="=&gt; PatMatVirtualiser.this.global.Symbol">ThrowableClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span>, <span title="String(&quot;ex&quot;)" class="string">&quot;ex&quot;</span><span class="delimiter">)</span>

          <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.CaseDef*)List[PatMatVirtualiser.this.global.CaseDef]">List</a><span class="delimiter">(</span>
              <a href="../../../reflect/internal/Positions.scala.html#441889" title="(pos: PatMatVirtualiser.this.global.Position)(tree: PatMatVirtualiser.this.global.CaseDef)PatMatVirtualiser.this.global.CaseDef">atPos</a><span class="delimiter">(</span><a href="#1135225" title="PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="../../../reflect/api/Trees.scala.html#427318" title="(pat: PatMatVirtualiser.this.global.Tree, guard: PatMatVirtualiser.this.global.Tree, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.CaseDef">CaseDef</a><span class="delimiter">(</span>
                  <a href="../../../reflect/internal/Trees.scala.html#441830" title="(sym: PatMatVirtualiser.this.global.Symbol, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Bind">Bind</a><span class="delimiter">(</span><a href="#1135548" title="PatMatVirtualiser.this.global.TermSymbol">exSym</a>, <a href="../../../reflect/api/Trees.scala.html#427669" title="(name: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#445910" title="=&gt; PatMatVirtualiser.this.global.nme.NameType">WILDCARD</a><span class="delimiter">)</span><span class="delimiter">)</span>, // TODO: does this need fixing upping?
                  <a href="../../../reflect/api/Trees.scala.html#23577" title="PatMatVirtualiser.this.global.EmptyTree.type">EmptyTree</a>,
                  <a href="#1134833" title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, casesNoSubstOnly: List[List[MatchTranslation.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type, owner: PatMatVirtualiser.this.global.Symbol, matchFailGenOverride: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree">combineCasesNoSubstOnly</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1135548" title="PatMatVirtualiser.this.global.TermSymbol">exSym</a><span class="delimiter">)</span>, <a href="#1135546" title="PatMatVirtualiser.this.global.TermSymbol">scrutSym</a>, <a href="#1135547" title="List[List[MatchTranslation.this.TreeMaker]]">casesNoSubstOnly</a>, <a href="#1135224" title="PatMatVirtualiser.this.global.Type">pt</a>, <a href="#1134691" title="=&gt; PatMatVirtualiser.this.global.Symbol">matchOwner</a>, <a href="../../../Option.scala.html#64111" title="(x: PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Throw)Some[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Throw]">Some</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1135678">scrut</a> =&gt; <a href="../../../reflect/api/Trees.scala.html#428078" title="(expr: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Throw">Throw</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1135548" title="PatMatVirtualiser.this.global.TermSymbol">exSym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">)</span>
              <span class="delimiter">}</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <a href="#1134690" title="=&gt; PatMatVirtualiser.this.Typer">typer</a>.<a href="Typers.scala.html#560726" title="(cases: List[PatMatVirtualiser.this.global.CaseDef], pattp: PatMatVirtualiser.this.global.Type, pt: PatMatVirtualiser.this.global.Type)List[PatMatVirtualiser.this.global.CaseDef]">typedCases</a><span class="delimiter">(</span><a href="#1135236" title="List[PatMatVirtualiser.this.global.CaseDef]">catches</a>, <a href="../../../reflect/internal/Definitions.scala.html#442209" title="=&gt; PatMatVirtualiser.this.global.Symbol">ThrowableClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>, <a href="../../../reflect/internal/Types.scala.html#441251" title="PatMatVirtualiser.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>



    /**  The translation of `pat if guard =&gt; body` has two aspects:
      *     1) the substitution due to the variables bound by patterns
      *     2) the combination of the extractor calls using `flatMap`.
      *
      * 2) is easy -- it looks like: `translatePattern_1.flatMap(translatePattern_2....flatMap(translatePattern_N.flatMap(translateGuard.flatMap((x_i) =&gt; success(Xbody(x_i)))))...)`
      *     this must be right-leaning tree, as can be seen intuitively by considering the scope of bound variables:
      *     variables bound by pat_1 must be visible from the function inside the left-most flatMap right up to Xbody all the way on the right
      * 1) is tricky because translatePattern_i determines the shape of translatePattern_i+1:
      *    zoom in on `translatePattern_1.flatMap(translatePattern_2)` for example -- it actually looks more like:
      *      `translatePattern_1(x_scrut).flatMap((x_1) =&gt; {y_i -&gt; x_1._i}translatePattern_2)`
      *
      *    `x_1` references the result (inside the monad) of the extractor corresponding to `pat_1`,
      *    this result holds the values for the constructor arguments, which translatePattern_1 has extracted
      *    from the object pointed to by `x_scrut`. The `y_i` are the symbols bound by `pat_1` (in order)
      *    in the scope of the remainder of the pattern, and they must thus be replaced by:
      *      - (for 1-ary unapply) x_1
      *      - (for n-ary unapply, n &gt; 1) selection of the i'th tuple component of `x_1`
      *      - (for unapplySeq) x_1.apply(i)
      *
      *    in the treemakers,
      *
      *    Thus, the result type of `translatePattern_i`'s extractor must conform to `M[(T_1,..., T_n)]`.
      *
      *    Operationally, phase 1) is a foldLeft, since we must consider the depth-first-flattening of
      *    the transformed patterns from left to right. For every pattern ast node, it produces a transformed ast and
      *    a function that will take care of binding and substitution of the next ast (to the right).
      *
      */
    <span class="keyword">def</span> <a title="(scrutSym: PatMatVirtualiser.this.global.Symbol, pt: PatMatVirtualiser.this.global.Type)(caseDef: PatMatVirtualiser.this.global.CaseDef)List[MatchTranslation.this.TreeMaker]" id="1134702">translateCase</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1135031">scrutSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1135032">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.CaseDef" id="1135033">caseDef</a>: <a href="../../../reflect/api/Trees.scala.html#23628" title="PatMatVirtualiser.this.global.CaseDef">CaseDef</a><span class="delimiter">)</span> = <a href="#1135033" title="PatMatVirtualiser.this.global.CaseDef">caseDef</a> <span class="keyword">match</span> <span class="delimiter">{</span> <span class="keyword">case</span> CaseDef<span class="delimiter">(</span>pattern, guard, body<span class="delimiter">)</span> =&gt;
      <a href="#1134703" title="(patBinder: PatMatVirtualiser.this.global.Symbol, patTree: PatMatVirtualiser.this.global.Tree)List[MatchTranslation.this.TreeMaker]">translatePattern</a><span class="delimiter">(</span><a href="#1135031" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a>, pattern<span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#63655" title="(that: scala.collection.GenTraversableOnce[MatchTranslation.this.TreeMaker])(implicit bf: scala.collection.generic.CanBuildFrom[List[MatchTranslation.this.TreeMaker],MatchTranslation.this.TreeMaker,List[MatchTranslation.this.TreeMaker]])List[MatchTranslation.this.TreeMaker]">++</a> <a href="#1134704" title="(guard: PatMatVirtualiser.this.global.Tree)List[MatchTranslation.this.TreeMaker]">translateGuard</a><span class="delimiter">(</span>guard<span class="delimiter">)</span> <a href="#1135183" title="(x: List[MatchTranslation.this.TreeMaker])List[MatchTranslation.this.TreeMaker]">:+</a> <a href="#1134705" title="(body: PatMatVirtualiser.this.global.Tree, matchPt: PatMatVirtualiser.this.global.Type)MatchTranslation.this.TreeMaker">translateBody</a><span class="delimiter">(</span>body, <a href="#1135032" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(patBinder: PatMatVirtualiser.this.global.Symbol, patTree: PatMatVirtualiser.this.global.Tree)List[MatchTranslation.this.TreeMaker]" id="1134703">translatePattern</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1135048">patBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1135049">patTree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[MatchTranslation.this.TreeMaker]">List</a><span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span> = <span class="delimiter">{</span>
      // a list of TreeMakers that encode `patTree`, and a list of arguments for recursive invocations of `translatePattern` to encode its subpatterns
      <span class="keyword">type</span> <a title="(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" id="1135704">TranslationStep</a> = <a href="../../../Tuple2.scala.html#1222" title="(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" class="delimiter">(</a>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span>, List<span class="delimiter">[</span><span class="delimiter">(</span>Symbol, Tree<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span>
      @inline <span class="keyword">def</span> <a title="(treeMakers: List[MatchTranslation.this.TreeMaker], subpats: (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)*)(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" id="1135705">withSubPats</a><span class="delimiter">(</span><a title="List[MatchTranslation.this.TreeMaker]" id="1135714">treeMakers</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[MatchTranslation.this.TreeMaker]">List</a><span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span>, <a title="(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)*" id="1135715">subpats</a>: <span title="(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)*" class="delimiter">(</span>Symbol, Tree<span class="delimiter">)</span>*<span class="delimiter">)</span>: <a href="../../../Tuple2.scala.html#1222" title="(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">TranslationStep</a> = <a href="../../../Tuple2.scala.html#63804" title="(_1: List[MatchTranslation.this.TreeMaker], _2: List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" class="delimiter">(</a><a href="#1135714" title="List[MatchTranslation.this.TreeMaker]">treeMakers</a>, <a href="#1135715" title="(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)*">subpats</a>.<a href="../../../collection/TraversableOnce.scala.html#59174" title="=&gt; List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]">toList</a><span class="delimiter">)</span>
      @inline <span class="keyword">def</span> <a title="(treeMakers: MatchTranslation.this.TreeMaker*)(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" id="1135706">noFurtherSubPats</a><span class="delimiter">(</span><a title="MatchTranslation.this.TreeMaker*" id="1135727">treeMakers</a>: <span title="MatchTranslation.this.TreeMaker*">TreeMaker</span>*<span class="delimiter">)</span>: <a href="../../../Tuple2.scala.html#1222" title="(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">TranslationStep</a> = <a href="../../../Tuple2.scala.html#63804" title="(_1: List[MatchTranslation.this.TreeMaker], _2: scala.collection.immutable.Nil.type)(List[MatchTranslation.this.TreeMaker], scala.collection.immutable.Nil.type)" class="delimiter">(</a><a href="#1135727" title="MatchTranslation.this.TreeMaker*">treeMakers</a>.<a href="../../../collection/TraversableOnce.scala.html#59174" title="=&gt; List[MatchTranslation.this.TreeMaker]">toList</a>, <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Position" id="1135707">pos</a> = <a href="#1135049" title="PatMatVirtualiser.this.global.Tree">patTree</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a>

      <span class="keyword">def</span> <a title="(extractor: MatchTranslation.this.ExtractorCall)(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" id="1135708">translateExtractorPattern</a><span class="delimiter">(</span><a title="MatchTranslation.this.ExtractorCall" id="1135734">extractor</a>: <a href="#1134708" title="MatchTranslation.this.ExtractorCall">ExtractorCall</a><span class="delimiter">)</span>: <a href="../../../Tuple2.scala.html#1222" title="(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">TranslationStep</a> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1135734" title="MatchTranslation.this.ExtractorCall">extractor</a>.<a href="#1135741" title="=&gt; Boolean">isTyped</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <span title="PatMatVirtualiser.this.global.TypeError" class="keyword">new</span> <a href="../../../reflect/internal/Types.scala.html#441578" title="PatMatVirtualiser.this.global.TypeError">TypeError</a><span class="delimiter">(</span><a href="#1135707" title="PatMatVirtualiser.this.global.Position">pos</a>, <span title="String(&quot;Could not typecheck extractor call: &quot;)" class="string">&quot;Could not typecheck extractor call: &quot;</span><span title="(x$1: Any)String">+</span> <a href="#1135734" title="MatchTranslation.this.ExtractorCall">extractor</a><span class="delimiter">)</span>
        // if (extractor.resultInMonad == ErrorType) throw new TypeError(pos, &quot;Unsupported extractor type: &quot;+ extractor.tpe)

        // must use type `tp`, which is provided by extractor's result, not the type expected by binder,
        // as b.info may be based on a Typed type ascription, which has not been taken into account yet by the translation
        // (it will later result in a type test when `tp` is not a subtype of `b.info`)
        // TODO: can we simplify this, together with the Bound case?
        <a href="../../../Tuple2.scala.html#63804" title="(_1: List[PatMatVirtualiser.this.global.Symbol], _2: List[PatMatVirtualiser.this.global.Type])(List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Type])" class="delimiter">(</a><a href="#1135734" title="MatchTranslation.this.ExtractorCall">extractor</a>.<a href="#1135747" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">subPatBinders</a>, <a href="#1135734" title="MatchTranslation.this.ExtractorCall">extractor</a>.<a href="#1135751" title="=&gt; List[PatMatVirtualiser.this.global.Type]">subPatTypes</a><span class="delimiter">)</span>.<a href="../../../Tuple2.scala.html#61522" title="(implicit w1: List[PatMatVirtualiser.this.global.Symbol] =&gt; scala.collection.TraversableLike[PatMatVirtualiser.this.global.Symbol,List[PatMatVirtualiser.this.global.Symbol]], implicit w2: List[PatMatVirtualiser.this.global.Type] =&gt; scala.collection.IterableLike[PatMatVirtualiser.this.global.Type,List[PatMatVirtualiser.this.global.Type]])(List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Type])#Zipped[List[PatMatVirtualiser.this.global.Symbol],PatMatVirtualiser.this.global.Symbol,List[PatMatVirtualiser.this.global.Type],PatMatVirtualiser.this.global.Type]">zipped</a> <a href="../../../Tuple2.scala.html#61569" title="(f: (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type) =&gt; PatMatVirtualiser.this.global.Symbol)Unit">foreach</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction2[PatMatVirtualiser.this.global.Symbol,PatMatVirtualiser.this.global.Type,PatMatVirtualiser.this.global.Symbol] with Serializable" id="1135911" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>b, tp<span class="delimiter">)</span> =&gt; b <a href="#1135931" title="(x: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Symbol">setInfo</a> tp <span class="delimiter">}</span> // println(&quot;changing &quot;+ b +&quot; : &quot;+ b.info +&quot; -&gt; &quot;+ tp);

        // println(&quot;translateExtractorPattern checking parameter type: &quot;+ (patBinder, patBinder.info.widen, extractor.paramType, patBinder.info.widen &lt;:&lt; extractor.paramType))
        // example check: List[Int] &lt;:&lt; ::[Int]
        // TODO: extractor.paramType may contain unbound type params (run/t2800, run/t3530)
        <span class="keyword">val</span> <a href="#1136043" title="(x: (List[MatchTranslation.this.TypeTestTreeMaker], PatMatVirtualiser.this.global.Symbol))(List[MatchTranslation.this.TypeTestTreeMaker], PatMatVirtualiser.this.global.Symbol)" class="delimiter">(</a><a href="../../../Tuple2.scala.html#61506" title="List[MatchTranslation.this.TypeTestTreeMaker]" id="1135769">typeTestTreeMaker</a>, <a href="../../../Tuple2.scala.html#61508" title="PatMatVirtualiser.this.global.Symbol" id="1135770">patBinderOrCasted</a><span class="delimiter">)</span> =
          <a href="#1136042" title="(List[MatchTranslation.this.TypeTestTreeMaker], PatMatVirtualiser.this.global.Symbol)" class="keyword">if</a> <span class="delimiter">(</span><a href="#1134812" title="(tp: PatMatVirtualiser.this.global.Type, pt: PatMatVirtualiser.this.global.Type)Boolean">needsTypeTest</a><span class="delimiter">(</span><a href="#1135048" title="PatMatVirtualiser.this.global.Symbol">patBinder</a>.<a href="../../../reflect/internal/Symbols.scala.html#443427" title="=&gt; PatMatVirtualiser.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#441990" title="=&gt; PatMatVirtualiser.this.global.Type">widen</a>, <a href="#1135734" title="MatchTranslation.this.ExtractorCall">extractor</a>.<a href="#1135745" title="=&gt; PatMatVirtualiser.this.global.Type">paramType</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            // chain a type-testing extractor before the actual extractor call
            // it tests the type, checks the outer pointer and casts to the expected type
            // TODO: the outer check is mandated by the spec for case classes, but we do it for user-defined unapplies as well [SPEC]
            // (the prefix of the argument passed to the unapply must equal the prefix of the type of the binder)
            <span class="keyword">val</span> <a title="MatchTranslation.this.TypeTestTreeMaker" id="1135953">treeMaker</a> = <a href="#1140428" title="(prevBinder: PatMatVirtualiser.this.global.Symbol, nextBinderTp: PatMatVirtualiser.this.global.Type, pos: PatMatVirtualiser.this.global.Position)MatchTranslation.this.TypeTestTreeMaker">TypeTestTreeMaker</a><span class="delimiter">(</span><a href="#1135048" title="PatMatVirtualiser.this.global.Symbol">patBinder</a>, <a href="#1135734" title="MatchTranslation.this.ExtractorCall">extractor</a>.<a href="#1135745" title="=&gt; PatMatVirtualiser.this.global.Type">paramType</a>, <a href="#1135707" title="PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span>
            <a href="../../../Tuple2.scala.html#63804" title="(_1: List[MatchTranslation.this.TypeTestTreeMaker], _2: PatMatVirtualiser.this.global.TermSymbol)(List[MatchTranslation.this.TypeTestTreeMaker], PatMatVirtualiser.this.global.TermSymbol)" class="delimiter">(</a><a href="../../../collection/immutable/List.scala.html#63291" title="(xs: MatchTranslation.this.TypeTestTreeMaker*)List[MatchTranslation.this.TypeTestTreeMaker]">List</a><span class="delimiter">(</span><a href="#1135953" title="MatchTranslation.this.TypeTestTreeMaker">treeMaker</a><span class="delimiter">)</span>, <a href="#1135953" title="MatchTranslation.this.TypeTestTreeMaker">treeMaker</a>.<a href="#1135965" title="=&gt; PatMatVirtualiser.this.global.TermSymbol">nextBinder</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <a href="../../../Tuple2.scala.html#63804" title="(_1: scala.collection.immutable.Nil.type, _2: PatMatVirtualiser.this.global.Symbol)(scala.collection.immutable.Nil.type, PatMatVirtualiser.this.global.Symbol)" class="delimiter">(</a><a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>, <a href="#1135048" title="PatMatVirtualiser.this.global.Symbol">patBinder</a><span class="delimiter">)</span>

        <a href="#1135705" title="(treeMakers: List[MatchTranslation.this.TreeMaker], subpats: (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)*)(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">withSubPats</a><span class="delimiter">(</span><a href="#1135769" title="List[MatchTranslation.this.TypeTestTreeMaker]">typeTestTreeMaker</a> <a href="../../../collection/SeqLike.scala.html#59810" title="(elem: MatchTranslation.this.TreeMaker)(implicit bf: scala.collection.generic.CanBuildFrom[List[MatchTranslation.this.TypeTestTreeMaker],MatchTranslation.this.TreeMaker,List[MatchTranslation.this.TreeMaker]])List[MatchTranslation.this.TreeMaker]">:+</a> <a href="#1135734" title="MatchTranslation.this.ExtractorCall">extractor</a>.<a href="#1135746" title="(binder: PatMatVirtualiser.this.global.Symbol, pos: PatMatVirtualiser.this.global.Position)MatchTranslation.this.TreeMaker">treeMaker</a><span class="delimiter">(</span><a href="#1135770" title="PatMatVirtualiser.this.global.Symbol">patBinderOrCasted</a>, <a href="#1135707" title="PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span>, <a href="#1135734" title="MatchTranslation.this.ExtractorCall">extractor</a>.<a href="#1135749" title="=&gt; List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]">subBindersAndPatterns</a>: _*<span class="delimiter">)</span>
      <span class="delimiter">}</span>


      <span class="keyword">object</span> <a title="MaybeBoundTyped.type" id="1135709">MaybeBoundTyped</a> <a href="#1135710" title="MaybeBoundTyped.type" class="delimiter">{</a>
        /** Decompose the pattern in `tree`, of shape C(p_1, ..., p_N), into a list of N symbols, and a list of its N sub-trees
          * The list of N symbols contains symbols for every bound name as well as the un-named sub-patterns (fresh symbols are generated here for these).
          * The returned type is the one inferred by inferTypedPattern (`owntype`)
          *
          * @arg patBinder  symbol used to refer to the result of the previous pattern's extractor (will later be replaced by the outer tree with the correct tree to refer to that patterns result)
        */
        <span class="keyword">def</span> <a title="(tree: PatMatVirtualiser.this.global.Tree)Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]" id="1136094">unapply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1136096">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]">Option</a><span class="delimiter">[</span><span class="delimiter">(</span>Symbol, Type<span class="delimiter">)</span><span class="delimiter">]</span> = <a href="#1136096" title="PatMatVirtualiser.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          // the Ident subpattern can be ignored, subpatBinder or patBinder tell us all we need to know about it
          <span class="keyword">case</span> <a href="#1135798" title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]" id="1136181">Bound</a><span class="delimiter">(</span>subpatBinder, typed@Typed<a title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]" id="1136155" class="delimiter">(</a>Ident<a title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]" id="1136158" class="delimiter">(</a>_<span class="delimiter">)</span>, tpt<span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> typed.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span> =&gt; <a href="../../../Option.scala.html#64111" title="(x: (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type))Some[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]">Some</a><a href="#1136174" title="(x: Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)])Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]" class="delimiter">(</a><a href="../../../Tuple2.scala.html#63804" title="(_1: PatMatVirtualiser.this.global.Symbol, _2: PatMatVirtualiser.this.global.Type)(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)" class="delimiter">(</a>subpatBinder, typed.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> Bind<a href="#1136151" title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]" id="1136161" class="delimiter">(</a>_, typed@Typed<a title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]" id="1136164" class="delimiter">(</a>Ident<a title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]" id="1136167" class="delimiter">(</a>_<span class="delimiter">)</span>, tpt<span class="delimiter">)</span><span class="delimiter">)</span>             <span class="keyword">if</span> typed.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span> =&gt; <a href="../../../Option.scala.html#64111" title="(x: (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type))Some[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]">Some</a><a href="#1136174" title="(x: Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)])Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]" class="delimiter">(</a><a href="../../../Tuple2.scala.html#63804" title="(_1: PatMatVirtualiser.this.global.Symbol, _2: PatMatVirtualiser.this.global.Type)(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)" class="delimiter">(</a><a href="#1135048" title="PatMatVirtualiser.this.global.Symbol">patBinder</a>, typed.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> Typed<a href="#1136151" title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]" id="1136170" class="delimiter">(</a>Ident<a title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]" id="1136173" class="delimiter">(</a>_<span class="delimiter">)</span>, tpt<span class="delimiter">)</span>                            <span class="keyword">if</span> <a href="#1136096" title="PatMatVirtualiser.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span>  =&gt; <a href="../../../Option.scala.html#64111" title="(x: (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type))Some[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]">Some</a><a href="#1136174" title="(x: Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)])Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]" class="delimiter">(</a><a href="../../../Tuple2.scala.html#63804" title="(_1: PatMatVirtualiser.this.global.Symbol, _2: PatMatVirtualiser.this.global.Type)(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)" class="delimiter">(</a><a href="#1135048" title="PatMatVirtualiser.this.global.Symbol">patBinder</a>, <a href="#1136096" title="PatMatVirtualiser.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> _  =&gt; <a href="#1136174" title="(x: Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)])Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]">None</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a href="#1136497" title="(x: (List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]))(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" class="delimiter">(</a><a href="../../../Tuple2.scala.html#61506" title="List[MatchTranslation.this.TreeMaker]" id="1135712">treeMakers</a>, <a href="../../../Tuple2.scala.html#61508" title="List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]" id="1135713">subpats</a><span class="delimiter">)</span> = <a href="#1135049" title="PatMatVirtualiser.this.global.Tree">patTree</a> <a href="../../../Tuple2.scala.html#1222" title="(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]) @unchecked" class="keyword">match</a> <span class="delimiter">{</span>
        // skip wildcard trees -- no point in checking them
        <span class="keyword">case</span> <a href="#1136186" title="(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">WildcardPattern</a><a title="Unit" id="1136437" class="delimiter">(</a><span class="delimiter">)</span> =&gt; <a href="#1135706" title="(treeMakers: MatchTranslation.this.TreeMaker*)(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">noFurtherSubPats</a><a href="#1136459" title="(x: (List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]))(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" class="delimiter">(</a><span class="delimiter">)</span>
        <span class="keyword">case</span> UnApply<a href="#1136436" title="(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" id="1136439" class="delimiter">(</a>unfun, args<span class="delimiter">)</span> =&gt;
          // TODO: check unargs == args
          // println(&quot;unfun: &quot;+ (unfun.tpe, unfun.symbol.ownerChain, unfun.symbol.info, patBinder.info))
          <a href="#1135708" title="(extractor: MatchTranslation.this.ExtractorCall)(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">translateExtractorPattern</a><a href="#1136459" title="(x: (List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]))(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" class="delimiter">(</a><a href="#1136194" title="(unfun: PatMatVirtualiser.this.global.Tree, args: List[PatMatVirtualiser.this.global.Tree])MatchTranslation.this.ExtractorCall">ExtractorCall</a><span class="delimiter">(</span>unfun, args<span class="delimiter">)</span><span class="delimiter">)</span>

        /** A constructor pattern is of the form c(p1, ..., pn) where n  0.
          It consists of a stable identifier c, followed by element patterns p1, ..., pn.
          The constructor c is a simple or qualified name which denotes a case class (5.3.2).

          If the case class is monomorphic, then it must conform to the expected type of the pattern,
          and the formal parameter types of xs primary constructor (5.3) are taken as the expected types of the element patterns p1, ..., pn.

          If the case class is polymorphic, then its type parameters are instantiated so that the instantiation of c conforms to the expected type of the pattern.
          The instantiated formal parameter types of cs primary constructor are then taken as the expected types of the component patterns p1, ..., pn.

          The pattern matches all objects created from constructor invocations c(v1, ..., vn) where each element pattern pi matches the corresponding value vi .
          A special case arises when cs formal parameter types end in a repeated parameter. This is further discussed in (8.1.9).
        **/
        <span class="keyword">case</span> Apply<a href="#1136436" title="(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" id="1136441" class="delimiter">(</a>fun, args<span class="delimiter">)</span>     =&gt;
          <a href="#1134706" title="MatchTranslation.this.ExtractorCall.type">ExtractorCall</a>.<a href="#1136195" title="(fun: PatMatVirtualiser.this.global.Tree, args: List[PatMatVirtualiser.this.global.Tree])Option[MatchTranslation.this.ExtractorCall]">fromCaseClass</a><span class="delimiter">(</span>fun, args<span class="delimiter">)</span> <a href="../../../Option.scala.html#63820" title="(f: MatchTranslation.this.ExtractorCall =&gt; (List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]))Option[(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])]">map</a> <a href="#1135708" title="(extractor: MatchTranslation.this.ExtractorCall)(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">translateExtractorPattern</a> <a href="#1136459" title="(x: (List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]))(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">getOrElse</a> <span class="delimiter">{</span>
            <a href="../Global.scala.html#559529" title="(msg: String)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;cannot find unapply member for &quot;)" class="string">&quot;cannot find unapply member for &quot;</span><span title="(x$1: Any)String">+</span> fun <span title="(x$1: Any)String">+</span><span title="String(&quot; with args &quot;)" class="string">&quot; with args &quot;</span><span title="(x$1: Any)String">+</span> args<span class="delimiter">)</span>
            <a href="#1135706" title="(treeMakers: MatchTranslation.this.TreeMaker*)(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">noFurtherSubPats</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        /** A typed pattern x : T consists of a pattern variable x and a type pattern T.
            The type of x is the type pattern T, where each type variable and wildcard is replaced by a fresh, unknown type.
            This pattern matches any value matched by the type pattern T (8.2); it binds the variable name to that value.
        **/
        // must treat Typed and Bind together -- we need to know the patBinder of the Bind pattern to get at the actual type
        <span class="keyword">case</span> <a href="#1136094" title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Type)]" id="1136468">MaybeBoundTyped</a><span class="delimiter">(</span>subPatBinder, pt<span class="delimiter">)</span> =&gt;
          // a typed pattern never has any subtrees
          <a href="#1135706" title="(treeMakers: MatchTranslation.this.TreeMaker*)(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">noFurtherSubPats</a><a href="#1136459" title="(x: (List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]))(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" class="delimiter">(</a><a href="#1140459" title="(prevBinder: PatMatVirtualiser.this.global.Symbol, patBinder: PatMatVirtualiser.this.global.Symbol, pt: PatMatVirtualiser.this.global.Type, pos: PatMatVirtualiser.this.global.Position)MatchTranslation.this.TypeAndEqualityTestTreeMaker">TypeAndEqualityTestTreeMaker</a><span class="delimiter">(</span>subPatBinder, <a href="#1135048" title="PatMatVirtualiser.this.global.Symbol">patBinder</a>, pt, <a href="#1135707" title="PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">)</span>

        /** A pattern binder x@p consists of a pattern variable x and a pattern p.
            The type of the variable x is the static type T of the pattern p.
            This pattern matches any value v matched by the pattern p,
            provided the run-time type of v is also an instance of T,  &lt;-- TODO! https://issues.scala-lang.org/browse/SI-1503
            and it binds the variable name to that value.
        **/
        <span class="keyword">case</span> <a href="#1135798" title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]" id="1136472">Bound</a><span class="delimiter">(</span>subpatBinder, p<span class="delimiter">)</span>          =&gt;
          // replace subpatBinder by patBinder (as if the Bind was not there)
          <a href="#1135705" title="(treeMakers: List[MatchTranslation.this.TreeMaker], subpats: (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)*)(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">withSubPats</a><a href="#1136459" title="(x: (List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]))(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" class="delimiter">(</a><a href="../../../collection/immutable/List.scala.html#63291" title="(xs: MatchTranslation.this.SubstOnlyTreeMaker*)List[MatchTranslation.this.SubstOnlyTreeMaker]">List</a><span class="delimiter">(</span><a href="#1140341" title="(prevBinder: PatMatVirtualiser.this.global.Symbol, nextBinder: PatMatVirtualiser.this.global.Symbol)MatchTranslation.this.SubstOnlyTreeMaker">SubstOnlyTreeMaker</a><span class="delimiter">(</span>subpatBinder, <a href="#1135048" title="PatMatVirtualiser.this.global.Symbol">patBinder</a><span class="delimiter">)</span><span class="delimiter">)</span>,
            // must be patBinder, as subpatBinder has the wrong info: even if the bind assumes a better type, this is not guaranteed until we cast
            <a href="../../../Tuple2.scala.html#63804" title="(_1: PatMatVirtualiser.this.global.Symbol, _2: PatMatVirtualiser.this.global.Tree)(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)" class="delimiter">(</a><a href="#1135048" title="PatMatVirtualiser.this.global.Symbol">patBinder</a>, p<span class="delimiter">)</span>
          <span class="delimiter">)</span>

        /** 8.1.4 Literal Patterns
              A literal pattern L matches any value that is equal (in terms of ==) to the literal L.
              The type of L must conform to the expected type of the pattern.

            8.1.5 Stable Identifier Patterns  (a stable identifier r (see 3.1))
              The pattern matches any value v such that r == v (12.1).
              The type of r must conform to the expected type of the pattern.
        **/
        <span class="keyword">case</span> Literal<a href="#1136436" title="(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" id="1136446" class="delimiter">(</a>Constant<span class="delimiter">(</span>_<span class="delimiter">)</span><span class="delimiter">)</span> | Ident<a href="#1136436" title="Boolean" id="1136450" class="delimiter">(</a>_<span class="delimiter">)</span> | Select<a href="#1136436" title="Boolean" id="1136454" class="delimiter">(</a>_, _<span class="delimiter">)</span> =&gt;
          <a href="#1135706" title="(treeMakers: MatchTranslation.this.TreeMaker*)(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">noFurtherSubPats</a><a href="#1136459" title="(x: (List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]))(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" class="delimiter">(</a><a href="#1140487" title="(prevBinder: PatMatVirtualiser.this.global.Symbol, patTree: PatMatVirtualiser.this.global.Tree, pos: PatMatVirtualiser.this.global.Position)MatchTranslation.this.EqualityTestTreeMaker">EqualityTestTreeMaker</a><span class="delimiter">(</span><a href="#1135048" title="PatMatVirtualiser.this.global.Symbol">patBinder</a>, <a href="#1135049" title="PatMatVirtualiser.this.global.Tree">patTree</a>, <a href="#1135707" title="PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">case</span> Alternative<a href="#1136436" title="(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" id="1136456" class="delimiter">(</a>alts<span class="delimiter">)</span>    =&gt;
          <a href="#1135706" title="(treeMakers: MatchTranslation.this.TreeMaker*)(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">noFurtherSubPats</a><a href="#1136459" title="(x: (List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]))(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" class="delimiter">(</a><a href="#1140515" title="(prevBinder: PatMatVirtualiser.this.global.Symbol, altss: List[List[MatchTranslation.this.TreeMaker]], pos: PatMatVirtualiser.this.global.Position)MatchTranslation.this.AlternativesTreeMaker">AlternativesTreeMaker</a><span class="delimiter">(</span><a href="#1135048" title="PatMatVirtualiser.this.global.Symbol">patBinder</a>, alts <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: PatMatVirtualiser.this.global.Tree =&gt; List[MatchTranslation.this.TreeMaker])(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Tree],List[MatchTranslation.this.TreeMaker],List[List[MatchTranslation.this.TreeMaker]]])List[List[MatchTranslation.this.TreeMaker]]">map</a> <span class="delimiter">(</span><a href="#1134703" title="(patBinder: PatMatVirtualiser.this.global.Symbol, patTree: PatMatVirtualiser.this.global.Tree)List[MatchTranslation.this.TreeMaker]">translatePattern</a><span class="delimiter">(</span><a href="#1135048" title="PatMatVirtualiser.this.global.Symbol">patBinder</a>, <a href="#1136399" title="PatMatVirtualiser.this.global.Tree">_</a><span class="delimiter">)</span><span class="delimiter">)</span>, alts.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; PatMatVirtualiser.this.global.Tree">head</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">)</span>

      /* TODO: Paul says about future version: I think this should work, and always intended to implement if I can get away with it.
          case class Foo(x: Int, y: String)
          case class Bar(z: Int)

          def f(x: Any) = x match { case Foo(x, _) | Bar(x) =&gt; x } // x is lub of course.
      */

        <span class="keyword">case</span> Bind<a href="#1136436" title="(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" id="1136458" class="delimiter">(</a>n, p<span class="delimiter">)</span> =&gt; // this happens in certain ill-formed programs, there'll be an error later
          // println(&quot;WARNING: Bind tree with unbound symbol &quot;+ patTree)
          <a href="#1135706" title="(treeMakers: MatchTranslation.this.TreeMaker*)(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">noFurtherSubPats</a><a href="#1136459" title="(x: (List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]))(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" class="delimiter">(</a><span class="delimiter">)</span> // there's no symbol -- something's wrong... don't fail here though (or should we?)

        // case Star(_) | ArrayValue | This =&gt; error(&quot;stone age pattern relics encountered!&quot;)

        <span class="keyword">case</span> _                       =&gt;
          <a href="../Global.scala.html#559529" title="(msg: String)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;unsupported pattern: &quot;)" class="string">&quot;unsupported pattern: &quot;</span><span title="(x$1: Any)String">+</span> <a href="#1135049" title="PatMatVirtualiser.this.global.Tree">patTree</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;(a &quot;)" class="string">&quot;(a &quot;</span><span title="(x$1: Any)String">+</span> <a href="#1135049" title="PatMatVirtualiser.this.global.Tree">patTree</a>.<span title="()Class[_]">getClass</span> <span title="(x$1: Any)String">+</span><span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
          <a href="#1135706" title="(treeMakers: MatchTranslation.this.TreeMaker*)(List[MatchTranslation.this.TreeMaker], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">noFurtherSubPats</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#1135712" title="List[MatchTranslation.this.TreeMaker]">treeMakers</a> <a href="../../../collection/immutable/List.scala.html#63655" title="(that: scala.collection.GenTraversableOnce[MatchTranslation.this.TreeMaker])(implicit bf: scala.collection.generic.CanBuildFrom[List[MatchTranslation.this.TreeMaker],MatchTranslation.this.TreeMaker,List[MatchTranslation.this.TreeMaker]])List[MatchTranslation.this.TreeMaker]">++</a> <a href="#1135713" title="List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]">subpats</a>.<a href="../../../collection/TraversableLike.scala.html#58976" title="(f: ((PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)) =&gt; scala.collection.GenTraversableOnce[MatchTranslation.this.TreeMaker])(implicit bf: scala.collection.generic.CanBuildFrom[List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)],MatchTranslation.this.TreeMaker,List[MatchTranslation.this.TreeMaker]])List[MatchTranslation.this.TreeMaker]">flatMap</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree),List[MatchTranslation.this.TreeMaker]] with Serializable" id="1136543" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>binder, pat<span class="delimiter">)</span> =&gt;
        <a href="#1134703" title="(patBinder: PatMatVirtualiser.this.global.Symbol, patTree: PatMatVirtualiser.this.global.Tree)List[MatchTranslation.this.TreeMaker]">translatePattern</a><a href="#1136551" title="(x: List[MatchTranslation.this.TreeMaker])List[MatchTranslation.this.TreeMaker]" class="delimiter">(</a>binder, pat<span class="delimiter">)</span> // recurse on subpatterns
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(guard: PatMatVirtualiser.this.global.Tree)List[MatchTranslation.this.TreeMaker]" id="1134704">translateGuard</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1135087">guard</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[MatchTranslation.this.TreeMaker]">List</a><span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span> =
      <span title="List[MatchTranslation.this.TreeMaker]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1135087" title="PatMatVirtualiser.this.global.Tree">guard</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/api/Trees.scala.html#23577" title="PatMatVirtualiser.this.global.EmptyTree.type">EmptyTree</a><span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>
      <span class="keyword">else</span> <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: MatchTranslation.this.GuardTreeMaker*)List[MatchTranslation.this.GuardTreeMaker]">List</a><span class="delimiter">(</span><a href="#1140534" title="(guardTree: PatMatVirtualiser.this.global.Tree)MatchTranslation.this.GuardTreeMaker">GuardTreeMaker</a><span class="delimiter">(</span><a href="#1135087" title="PatMatVirtualiser.this.global.Tree">guard</a><span class="delimiter">)</span><span class="delimiter">)</span>

    // TODO: 1) if we want to support a generalisation of Kotlin's patmat continue, must not hard-wire lifting into the monad (which is now done by codegen.one),
    // so that user can generate failure when needed -- use implicit conversion to lift into monad on-demand?
    // to enable this, probably need to move away from Option to a monad specific to pattern-match,
    // so that we can return Option's from a match without ambiguity whether this indicates failure in the monad, or just some result in the monad
    // 2) body.tpe is the type of the body after applying the substitution that represents the solution of GADT type inference
    // need the explicit cast in case our substitutions in the body change the type to something that doesn't take GADT typing into account
    <span class="keyword">def</span> <a title="(body: PatMatVirtualiser.this.global.Tree, matchPt: PatMatVirtualiser.this.global.Type)MatchTranslation.this.TreeMaker" id="1134705">translateBody</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1135151">body</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Type" id="1135152">matchPt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="#1134792" title="MatchTranslation.this.TreeMaker">TreeMaker</a> =
      <a href="#1140316" title="(body: PatMatVirtualiser.this.global.Tree, matchPt: PatMatVirtualiser.this.global.Type)MatchTranslation.this.BodyTreeMaker">BodyTreeMaker</a><span class="delimiter">(</span><a href="#1135151" title="PatMatVirtualiser.this.global.Tree">body</a>, <a href="#1135152" title="PatMatVirtualiser.this.global.Type">matchPt</a><span class="delimiter">)</span>


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// helper methods: they analyze types and trees in isolation, but they are not (directly) concerned with the structure of the overall translation
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    <span class="keyword">object</span> <a title="MatchTranslation.this.ExtractorCall.type" id="1134706">ExtractorCall</a> <a href="#1134707" title="MatchTranslation.this.ExtractorCall.type" class="delimiter">{</a>
      <span class="keyword">def</span> <a title="(unfun: PatMatVirtualiser.this.global.Tree, args: List[PatMatVirtualiser.this.global.Tree])MatchTranslation.this.ExtractorCall" id="1136194">apply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1136197">unfun</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="List[PatMatVirtualiser.this.global.Tree]" id="1136198">args</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#1134708" title="MatchTranslation.this.ExtractorCall">ExtractorCall</a> = <span title="MatchTranslation.this.ExtractorCallRegular" class="keyword">new</span> <a href="#1134710" title="MatchTranslation.this.ExtractorCallRegular">ExtractorCallRegular</a><span class="delimiter">(</span><a href="#1136197" title="PatMatVirtualiser.this.global.Tree">unfun</a>, <a href="#1136198" title="List[PatMatVirtualiser.this.global.Tree]">args</a><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(fun: PatMatVirtualiser.this.global.Tree, args: List[PatMatVirtualiser.this.global.Tree])Option[MatchTranslation.this.ExtractorCall]" id="1136195">fromCaseClass</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1136209">fun</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="List[PatMatVirtualiser.this.global.Tree]" id="1136210">args</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[MatchTranslation.this.ExtractorCall]">Option</a><span class="delimiter">[</span>ExtractorCall<span class="delimiter">]</span> =  <a href="../../../Option.scala.html#64111" title="(x: MatchTranslation.this.ExtractorCallProd)Some[MatchTranslation.this.ExtractorCallProd]">Some</a><span class="delimiter">(</span><span title="MatchTranslation.this.ExtractorCallProd" class="keyword">new</span> <a href="#1134709" title="MatchTranslation.this.ExtractorCallProd">ExtractorCallProd</a><span class="delimiter">(</span><a href="#1136209" title="PatMatVirtualiser.this.global.Tree">fun</a>, <a href="#1136210" title="List[PatMatVirtualiser.this.global.Tree]">args</a><span class="delimiter">)</span><span class="delimiter">)</span>

      // THE PRINCIPLED SLOW PATH -- NOT USED
      // generate a call to the (synthetically generated) extractor of a case class
      // NOTE: it's an apply, not a select, since in general an extractor call may have multiple argument lists (including an implicit one)
      // that we need to preserve, so we supply the scrutinee as Ident(nme.SELECTOR_DUMMY),
      // and replace that dummy by a reference to the actual binder in translateExtractorPattern
      <span class="keyword">def</span> <a title="(fun: PatMatVirtualiser.this.global.Tree, args: List[PatMatVirtualiser.this.global.Tree])Option[MatchTranslation.this.ExtractorCall]" id="1136196">fromCaseClassUnapply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1136706">fun</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="List[PatMatVirtualiser.this.global.Tree]" id="1136707">args</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[MatchTranslation.this.ExtractorCall]">Option</a><span class="delimiter">[</span>ExtractorCall<span class="delimiter">]</span> = <span class="delimiter">{</span>
        // TODO: can we rework the typer so we don't have to do all this twice?
        // undo rewrite performed in (5) of adapt
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1136708">orig</a>      = <a href="#1136706" title="PatMatVirtualiser.this.global.Tree">fun</a> <span class="keyword">match</span> <span class="delimiter">{</span><span class="keyword">case</span> <a href="#1136713" title="PatMatVirtualiser.this.global.Tree" id="1136715">tpt</a>: TypeTree =&gt; tpt.<a href="#1136716" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">original</a> <span class="keyword">case</span> _ =&gt; <a href="#1136716" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">fun</a><span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Symbol" id="1136709">origSym</a>   = <a href="#1136708" title="PatMatVirtualiser.this.global.Tree">orig</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Symbol" id="1136710">extractor</a> = <a href="Unapplies.scala.html#560355" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Symbol">unapplyMember</a><span class="delimiter">(</span><a href="#1136709" title="PatMatVirtualiser.this.global.Symbol">origSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443473" title="(cond: PatMatVirtualiser.this.global.Symbol =&gt; Boolean)PatMatVirtualiser.this.global.Symbol">filter</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1136727">sym</a> =&gt; <a href="Typers.scala.html#560677" title="(sym: PatMatVirtualiser.this.global.Symbol)Boolean">reallyExists</a><span class="delimiter">(</span><a href="Unapplies.scala.html#560355" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Symbol">unapplyMember</a><span class="delimiter">(</span><a href="#1136727" title="PatMatVirtualiser.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span>

        <span title="Option[MatchTranslation.this.ExtractorCall]" class="keyword">if</span><span class="delimiter">(</span><span class="delimiter">(</span><a href="#1136706" title="PatMatVirtualiser.this.global.Tree">fun</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="#1136706" title="PatMatVirtualiser.this.global.Tree">fun</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#441980" title="=&gt; Boolean">isError</a> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#1136710" title="PatMatVirtualiser.this.global.Symbol">extractor</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../../Option.scala.html#2498" title="None.type">None</a>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          // this is a tricky balance: pos/t602.scala, pos/sudoku.scala, run/virtpatmat_alts.scala must all be happy
          // bypass typing at own risk: val extractorCall = Select(orig, extractor) setType caseClassApplyToUnapplyTp(fun.tpe)
          // can't always infer type arguments (pos/t602):
          /*  case class Span[K &lt;: Ordered[K]](low: Option[K]) {
                override def equals(x: Any): Boolean = x match {
                  case Span((low0 @ _)) if low0 equals low =&gt; true
                }
              }*/
          // so... leave undetermined type params floating around if we have to
          // (if we don't infer types, uninstantiated type params show up later: pos/sudoku.scala)
          // (see also run/virtpatmat_alts.scala)
          <span class="keyword">val</span> <a title="List[PatMatVirtualiser.this.global.Symbol]" id="1136729">savedUndets</a> = <a href="Typers.scala.html#560636" title="=&gt; PatMatVirtualiser.this.Context">context</a>.<a href="Contexts.scala.html#560931" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">undetparams</a>
          <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1136730">extractorCall</a> = <span class="keyword">try</span> <span class="delimiter">{</span>
            <a href="Typers.scala.html#560636" title="=&gt; PatMatVirtualiser.this.Context">context</a>.<a href="Contexts.scala.html#560932" title="(ps: List[PatMatVirtualiser.this.global.Symbol])Unit">undetparams</a> = <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>
            <a href="Typers.scala.html#560686" title="(op: PatMatVirtualiser.this.Typer =&gt; PatMatVirtualiser.this.global.Tree, reportAmbiguousErrors: Boolean, newtree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.SilentResult[PatMatVirtualiser.this.global.Tree]">silent</a><span title="PatMatVirtualiser.this.global.Tree" class="delimiter">(</span><a href="#1136740" title="PatMatVirtualiser.this.Typer">_</a>.<a href="Typers.scala.html#560765" title="(tree: PatMatVirtualiser.this.global.Tree, mode: Int, pt: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree">typed</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#427174" title="(fun: PatMatVirtualiser.this.global.Tree, args: List[PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Apply">Apply</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#441840" title="(qualifier: PatMatVirtualiser.this.global.Tree, sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Select">Select</a><span class="delimiter">(</span><a href="#1136708" title="PatMatVirtualiser.this.global.Tree">orig</a>, <a href="#1136710" title="PatMatVirtualiser.this.global.Symbol">extractor</a><span class="delimiter">)</span>, <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.Ident*)List[PatMatVirtualiser.this.global.Ident]">List</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#427669" title="(name: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446209" title="=&gt; PatMatVirtualiser.this.global.nme.NameType">SELECTOR_DUMMY</a><span class="delimiter">)</span> <a href="../../../reflect/api/Trees.scala.html#425062" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Ident">setType</a> <a href="#1136706" title="PatMatVirtualiser.this.global.Tree">fun</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#442006" title="=&gt; PatMatVirtualiser.this.global.Type">finalResultType</a><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="Int(1)">EXPRmode</span>, <a href="../../../reflect/internal/Types.scala.html#441251" title="PatMatVirtualiser.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>, reportAmbiguousErrors = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> SilentResultValue<a href="#1136903" title="PatMatVirtualiser.this.global.Tree" id="1136905" class="delimiter">(</a>extractorCall<span class="delimiter">)</span> =&gt; <a href="#1136906" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">extractorCall</a> // if !extractorCall.containsError()
              <span class="keyword">case</span> _ =&gt;
                // this fails to resolve overloading properly...
                // Apply(typedOperator(Select(orig, extractor)), List(Ident(nme.SELECTOR_DUMMY))) // no need to set the type of the dummy arg, it will be replaced anyway

                // println(&quot;funtpe after = &quot;+ fun.tpe.finalResultType)
                // println(&quot;orig: &quot;+(orig, orig.tpe))
                <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1136814">tgt</a> = <a href="Typers.scala.html#560765" title="(tree: PatMatVirtualiser.this.global.Tree, mode: Int, pt: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree">typed</a><span class="delimiter">(</span><a href="#1136708" title="PatMatVirtualiser.this.global.Tree">orig</a>, EXPRmode | QUALmode <span title="Int(97)">|</span> POLYmode, <a href="Implicits.scala.html#1096334" title="(name: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.global.Type">HasMember</a><span class="delimiter">(</span><a href="#1136710" title="PatMatVirtualiser.this.global.Symbol">extractor</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; extractor.NameType">name</a><span class="delimiter">)</span><span class="delimiter">)</span> // can't specify fun.tpe.finalResultType as the type for the extractor's arg,
                // as it may have been inferred incorrectly (see t602, where it's  com.mosol.sl.Span[Any], instead of  com.mosol.sl.Span[?K])
                // println(&quot;tgt = &quot;+ (tgt, tgt.tpe))
                <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1136815">oper</a> = <a href="Typers.scala.html#560765" title="(tree: PatMatVirtualiser.this.global.Tree, mode: Int, pt: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree">typed</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#427925" title="(qualifier: PatMatVirtualiser.this.global.Tree, name: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.global.Select">Select</a><span class="delimiter">(</span><a href="#1136814" title="PatMatVirtualiser.this.global.Tree">tgt</a>, <a href="#1136710" title="PatMatVirtualiser.this.global.Symbol">extractor</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; extractor.NameType">name</a><span class="delimiter">)</span>, EXPRmode | FUNmode | POLYmode <span title="Int(177)">|</span> TAPPmode, <a href="../../../reflect/internal/Types.scala.html#441251" title="PatMatVirtualiser.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>
                // println(&quot;oper: &quot;+ (oper, oper.tpe))
                <a href="../../../reflect/api/Trees.scala.html#427174" title="(fun: PatMatVirtualiser.this.global.Tree, args: List[PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Apply">Apply</a><span class="delimiter">(</span><a href="#1136815" title="PatMatVirtualiser.this.global.Tree">oper</a>, <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.Ident*)List[PatMatVirtualiser.this.global.Ident]">List</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#427669" title="(name: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446209" title="=&gt; PatMatVirtualiser.this.global.nme.NameType">SELECTOR_DUMMY</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> // no need to set the type of the dummy arg, it will be replaced anyway
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> <span class="keyword">finally</span> <a href="Typers.scala.html#560636" title="=&gt; PatMatVirtualiser.this.Context">context</a>.<a href="Contexts.scala.html#560932" title="(ps: List[PatMatVirtualiser.this.global.Symbol])Unit">undetparams</a> = <a href="#1136729" title="List[PatMatVirtualiser.this.global.Symbol]">savedUndets</a>

          <a href="../../../Option.scala.html#64111" title="(x: MatchTranslation.this.ExtractorCall)Some[MatchTranslation.this.ExtractorCall]">Some</a><span class="delimiter">(</span><a href="#1136194" title="(unfun: PatMatVirtualiser.this.global.Tree, args: List[PatMatVirtualiser.this.global.Tree])MatchTranslation.this.ExtractorCall" class="keyword">this</a><span class="delimiter">(</span><a href="#1136730" title="PatMatVirtualiser.this.global.Tree">extractorCall</a>, <a href="#1136707" title="List[PatMatVirtualiser.this.global.Tree]">args</a><span class="delimiter">)</span><span class="delimiter">)</span> // TODO: simplify spliceApply?
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class ExtractorCall extends Object" id="1134708">ExtractorCall</a><a href="#1134708" title="MatchTranslation.this.ExtractorCall" class="delimiter">(</a><span class="keyword">val</span> <a title="List[PatMatVirtualiser.this.global.Tree]" id="1136663">args</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="1135739">nbSubPats</a> = <a href="#1136663" title="=&gt; List[PatMatVirtualiser.this.global.Tree]">args</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a>

      // everything okay, captain?
      <span class="keyword">def</span> <a title="=&gt; Boolean" id="1135741">isTyped</a>    : <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a>

      <span class="keyword">def</span> <a title="=&gt; Boolean" id="1135742">isSeq</a>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Boolean" id="1135744">lastIsStar</a> = <span class="delimiter">(</span><a href="#1135739" title="=&gt; Int">nbSubPats</a> <a href="../../../Int.scala.html#57919" title="(x: Int)Boolean">&gt;</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../ast/Trees.scala.html#559838" title="PatMatVirtualiser.this.global.treeInfo.type">treeInfo</a>.<a href="../../../reflect/internal/TreeInfo.scala.html#501514" title="(x: PatMatVirtualiser.this.global.treeInfo.global.Tree)Boolean">isStar</a><span class="delimiter">(</span><a href="#1136663" title="=&gt; List[PatMatVirtualiser.this.global.Tree]">args</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76185" title="=&gt; PatMatVirtualiser.this.global.Tree">last</a><span class="delimiter">)</span>

      // to which type should the previous binder be casted?
      <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Type" id="1135745">paramType</a>  : <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>

      // binder has been casted to paramType if necessary
      <span class="keyword">def</span> <a title="(binder: PatMatVirtualiser.this.global.Symbol, pos: PatMatVirtualiser.this.global.Position)MatchTranslation.this.TreeMaker" id="1135746">treeMaker</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1136064">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Position" id="1136065">pos</a>: <a href="../util/Position.scala.html#52230" title="PatMatVirtualiser.this.global.Position">Position</a><span class="delimiter">)</span>: <a href="#1134792" title="MatchTranslation.this.TreeMaker">TreeMaker</a>

      // `subPatBinders` are the variables bound by this pattern in the following patterns
      // subPatBinders are replaced by references to the relevant part of the extractor's result (tuple component, seq element, the result as-is)
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[PatMatVirtualiser.this.global.Symbol]" id="1135748">subPatBinders</a> = <a href="#1136663" title="=&gt; List[PatMatVirtualiser.this.global.Tree]">args</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Symbol)(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Tree],PatMatVirtualiser.this.global.Symbol,List[PatMatVirtualiser.this.global.Symbol]])List[PatMatVirtualiser.this.global.Symbol]">map</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[PatMatVirtualiser.this.global.Tree,PatMatVirtualiser.this.global.Symbol] with Serializable" id="1135795" class="delimiter">{</a>
        <span class="keyword">case</span> <a href="#1135798" title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]" id="1135817">Bound</a><span class="delimiter">(</span>b, p<span class="delimiter">)</span> =&gt; <a href="#1135812" title="(x: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Symbol">b</a>
        <span class="keyword">case</span> p =&gt; <a href="#1134978" title="PatMatVirtualiser.this.global.Type" id="1135808">freshSym</a><a href="#1135812" title="(x: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Symbol" class="delimiter">(</a>p.<a href="../../../reflect/api/Trees.scala.html#425042" title="PatMatVirtualiser.this.global.Position" id="1135806">pos</a>, prefix = <a title="String(&quot;p&quot;)" id="1135807" class="string">&quot;p&quot;</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]" id="1135750">subBindersAndPatterns</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]">List</a><span class="delimiter">[</span><span class="delimiter">(</span>Symbol, Tree<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">(</span><a href="#1135747" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">subPatBinders</a> <a href="../../../collection/IterableLike.scala.html#59486" title="(that: scala.collection.GenIterable[PatMatVirtualiser.this.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Symbol],(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree),List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]])List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]">zip</a> <a href="#1136663" title="=&gt; List[PatMatVirtualiser.this.global.Tree]">args</a><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: ((PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)) =&gt; (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree))(implicit bf: scala.collection.generic.CanBuildFrom[List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)],(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree),List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]])List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]">map</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree),(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)] with Serializable" id="1136996" class="delimiter">{</a>
        <span class="keyword">case</span> <span class="delimiter">(</span>b, <a href="#1135798" title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]" id="1137020">Bound</a><span class="delimiter">(</span>_, p<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#1137015" title="(x: (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree))(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)" class="delimiter">(</a>b, p<span class="delimiter">)</span>
        <span class="keyword">case</span> bp =&gt; <a href="#1137015" title="(x: (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree))(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)">bp</a>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="=&gt; List[PatMatVirtualiser.this.global.Type]" id="1135751">subPatTypes</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Type]">List</a><span class="delimiter">[</span>Type<span class="delimiter">]</span> =
        <span title="List[PatMatVirtualiser.this.global.Type]" class="keyword">if</span><span class="delimiter">(</span><a href="#1135742" title="=&gt; Boolean">isSeq</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> TypeRef<a href="#1137081" title="(PatMatVirtualiser.this.global.Type, List[PatMatVirtualiser.this.global.Type])" id="1137084" class="delimiter">(</a><a href="../../../Tuple2.scala.html#61506" title="PatMatVirtualiser.this.global.Type" id="1137060">pre</a>, <a href="../../../reflect/internal/Definitions.scala.html#442330" title="(PatMatVirtualiser.this.global.Type, List[PatMatVirtualiser.this.global.Type])" id="1137087">SeqClass</a>, <a href="../../../Tuple2.scala.html#61508" title="List[PatMatVirtualiser.this.global.Type]" id="1137061">args</a><span class="delimiter">)</span> = <a href="#1135753" title="=&gt; PatMatVirtualiser.this.global.Type">seqTp</a>
          // do repeated-parameter expansion to match up with the expected number of arguments (in casu, subpatterns)
          <a href="Infer.scala.html#560258" title="(formals: List[PatMatVirtualiser.this.global.Type], nargs: Int, removeByName: Boolean, removeRepeated: Boolean)List[PatMatVirtualiser.this.global.Type]">formalTypes</a><span class="delimiter">(</span><a href="#1135752" title="=&gt; List[PatMatVirtualiser.this.global.Type]">rawSubPatTypes</a>.<a href="../../../collection/TraversableLike.scala.html#59015" title="=&gt; List[PatMatVirtualiser.this.global.Type]">init</a> <a href="../../../collection/SeqLike.scala.html#59810" title="(elem: PatMatVirtualiser.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Type],PatMatVirtualiser.this.global.Type,List[PatMatVirtualiser.this.global.Type]])List[PatMatVirtualiser.this.global.Type]">:+</a> <a href="../../../reflect/internal/Types.scala.html#441371" title="(pre: PatMatVirtualiser.this.global.Type, sym: PatMatVirtualiser.this.global.Symbol, args: List[PatMatVirtualiser.this.global.Type])PatMatVirtualiser.this.global.Type">typeRef</a><span class="delimiter">(</span><a href="#1137060" title="PatMatVirtualiser.this.global.Type">pre</a>, <a href="../../../reflect/internal/Definitions.scala.html#442303" title="=&gt; PatMatVirtualiser.this.global.ClassSymbol">RepeatedParamClass</a>, <a href="#1137061" title="List[PatMatVirtualiser.this.global.Type]">args</a><span class="delimiter">)</span>, <a href="#1135739" title="=&gt; Int">nbSubPats</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#1135752" title="=&gt; List[PatMatVirtualiser.this.global.Type]">rawSubPatTypes</a>

      <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; List[PatMatVirtualiser.this.global.Type]" id="1135752">rawSubPatTypes</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Type]">List</a><span class="delimiter">[</span>Type<span class="delimiter">]</span>

      <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Type" id="1135753">seqTp</a> = <a href="#1135752" title="=&gt; List[PatMatVirtualiser.this.global.Type]">rawSubPatTypes</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76185" title="=&gt; PatMatVirtualiser.this.global.Type">last</a> <a href="../../../reflect/internal/Types.scala.html#442036" title="(clazz: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Type">baseType</a> <a href="../../../reflect/internal/Definitions.scala.html#442330" title="=&gt; PatMatVirtualiser.this.global.ClassSymbol">SeqClass</a>
      <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Symbol" id="1135754">seqLenCmp</a>                = <a href="#1135752" title="=&gt; List[PatMatVirtualiser.this.global.Type]">rawSubPatTypes</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76185" title="=&gt; PatMatVirtualiser.this.global.Type">last</a> <a href="../../../reflect/internal/Types.scala.html#442028" title="(name: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.global.Symbol">member</a> <a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446573" title="=&gt; PatMatVirtualiser.this.global.nme.NameType">lengthCompare</a>
      <span class="keyword">protected</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Int" id="1135756">firstIndexingBinder</a> = <a href="#1135752" title="=&gt; List[PatMatVirtualiser.this.global.Type]">rawSubPatTypes</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span> // rawSubPatTypes.last is the Seq, thus there are `rawSubPatTypes.length - 1` non-seq elements in the tuple
      <span class="keyword">protected</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Int" id="1135758">lastIndexingBinder</a>  = <span title="Int" class="keyword">if</span><span class="delimiter">(</span><a href="#1135743" title="=&gt; Boolean">lastIsStar</a><span class="delimiter">)</span> <a href="#1135739" title="=&gt; Int">nbSubPats</a><a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a><span title="Int(2)" class="int">2</span> <span class="keyword">else</span> <a href="#1135739" title="=&gt; Int">nbSubPats</a><a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a><span title="Int(1)" class="int">1</span>
      <span class="keyword">protected</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Int" id="1135760">expectedLength</a>      = <a href="#1135757" title="=&gt; Int">lastIndexingBinder</a> <a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a> <a href="#1135755" title="=&gt; Int">firstIndexingBinder</a> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span>
      <span class="keyword">protected</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Int" id="1135762">minLenToCheck</a>       = <span title="Int" class="keyword">if</span><span class="delimiter">(</span><a href="#1135743" title="=&gt; Boolean">lastIsStar</a><span class="delimiter">)</span> <span title="Int(1)" class="int">1</span> <span class="keyword">else</span> <span title="Int(0)" class="int">0</span>
      <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree" id="1135763">seqTree</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1137181">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span>  = <a href="#1135764" title="(binder: PatMatVirtualiser.this.global.Symbol)(i: Int)PatMatVirtualiser.this.global.Tree">tupleSel</a><span class="delimiter">(</span><a href="#1137181" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1135755" title="=&gt; Int">firstIndexingBinder</a><a href="../../../Int.scala.html#57948" title="(x: Int)Int">+</a><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(binder: PatMatVirtualiser.this.global.Symbol)(i: Int)PatMatVirtualiser.this.global.Tree" id="1135764">tupleSel</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1137182">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="Int" id="1137183">i</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="#1134723" title="=&gt; MatchTranslation.this.AbsCodegen">codegen</a>.<a href="#1137198" title="(binder: PatMatVirtualiser.this.global.Symbol)(i: Int)PatMatVirtualiser.this.global.Tree">tupleSel</a><span class="delimiter">(</span><a href="#1137182" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1137183" title="Int">i</a><span class="delimiter">)</span>

      // the trees that select the subpatterns on the extractor's result, referenced by `binder`
      // require isSeq
      <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(binder: PatMatVirtualiser.this.global.Symbol)List[PatMatVirtualiser.this.global.Tree]" id="1135765">subPatRefsSeq</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1137201">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="scala.collection.immutable.Range.Inclusive" id="1137202">indexingIndices</a>   = <span class="delimiter">(</span><a href="../../../LowPriorityImplicits.scala.html#8333" title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</a> <a href="../../../runtime/RichInt.scala.html#57856" title="(end: Int)scala.collection.immutable.Range.Inclusive">to</a> <span class="delimiter">(</span><a href="#1135757" title="=&gt; Int">lastIndexingBinder</a><a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a><a href="#1135755" title="=&gt; Int">firstIndexingBinder</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="1137203">nbIndexingIndices</a> = <a href="#1137202" title="scala.collection.immutable.Range.Inclusive">indexingIndices</a>.<a href="../../../collection/immutable/Range.scala.html#69659" title="=&gt; Int">length</a>

        // this error-condition has already been checked by checkStarPatOK:
        //   if(isSeq) assert(firstIndexingBinder + nbIndexingIndices + (if(lastIsStar) 1 else 0) == nbSubPats, &quot;(resultInMonad, ts, subPatTypes, subPats)= &quot;+(resultInMonad, ts, subPatTypes, subPats))
        // there are `firstIndexingBinder` non-seq tuple elements preceding the Seq
        <span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">(</span><a href="../../../LowPriorityImplicits.scala.html#8333" title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</a> <a href="../../../runtime/RichInt.scala.html#57856" title="(end: Int)scala.collection.immutable.Range.Inclusive">to</a> <a href="#1135755" title="=&gt; Int">firstIndexingBinder</a><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Int =&gt; PatMatVirtualiser.this.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Int],PatMatVirtualiser.this.global.Tree,scala.collection.immutable.IndexedSeq[PatMatVirtualiser.this.global.Tree]])scala.collection.immutable.IndexedSeq[PatMatVirtualiser.this.global.Tree]">map</a> <a href="#1135764" title="(binder: PatMatVirtualiser.this.global.Symbol)(i: Int)PatMatVirtualiser.this.global.Tree">tupleSel</a><a href="#1137420" title="Int" class="delimiter">(</a><a href="#1137201" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#58951" title="(that: scala.collection.GenTraversableOnce[PatMatVirtualiser.this.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[PatMatVirtualiser.this.global.Tree],PatMatVirtualiser.this.global.Tree,scala.collection.immutable.IndexedSeq[PatMatVirtualiser.this.global.Tree]])scala.collection.immutable.IndexedSeq[PatMatVirtualiser.this.global.Tree]">++</a>
        // then we have to index the binder that represents the sequence for the remaining subpatterns, except for...
        <span class="delimiter">(</span><a href="#1137202" title="scala.collection.immutable.Range.Inclusive">indexingIndices</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Int =&gt; PatMatVirtualiser.this.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Int],PatMatVirtualiser.this.global.Tree,scala.collection.immutable.IndexedSeq[PatMatVirtualiser.this.global.Tree]])scala.collection.immutable.IndexedSeq[PatMatVirtualiser.this.global.Tree]">map</a> <a href="#1134723" title="=&gt; MatchTranslation.this.AbsCodegen">codegen</a>.<a href="#1137196" title="(tgt: PatMatVirtualiser.this.global.Tree)(i: Int)PatMatVirtualiser.this.global.Tree">index</a><a href="#1137502" title="Int" class="delimiter">(</a><a href="#1135763" title="(binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">seqTree</a><a href="#1137500" title="PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="#1137201" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#58951" title="(that: scala.collection.GenTraversableOnce[PatMatVirtualiser.this.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[PatMatVirtualiser.this.global.Tree],PatMatVirtualiser.this.global.Tree,scala.collection.immutable.IndexedSeq[PatMatVirtualiser.this.global.Tree]])scala.collection.immutable.IndexedSeq[PatMatVirtualiser.this.global.Tree]">++</a>
        // the last one -- if the last subpattern is a sequence wildcard: drop the prefix (indexed by the refs on the line above), return the remainder
        <span class="delimiter">(</span><span title="List[PatMatVirtualiser.this.global.Tree]" class="keyword">if</span><span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1135743" title="=&gt; Boolean">lastIsStar</a><span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a> <span class="keyword">else</span> <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.Tree*)List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">(</span>
          <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span><span class="delimiter">(</span><a href="#1137203" title="Int">nbIndexingIndices</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#1135763" title="(binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">seqTree</a><span class="delimiter">(</span><a href="#1137201" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span>
          <span class="keyword">else</span> <a href="#1134723" title="=&gt; MatchTranslation.this.AbsCodegen">codegen</a>.<a href="#1137195" title="(tgt: PatMatVirtualiser.this.global.Tree)(n: Int)PatMatVirtualiser.this.global.Tree">drop</a><span class="delimiter">(</span><a href="#1135763" title="(binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">seqTree</a><span class="delimiter">(</span><a href="#1137201" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1137203" title="Int">nbIndexingIndices</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../collection/TraversableOnce.scala.html#59174" title="=&gt; List[PatMatVirtualiser.this.global.Tree]">toList</a>
      <span class="delimiter">}</span>

      // the trees that select the subpatterns on the extractor's result, referenced by `binder`
      // require (nbSubPats &gt; 0 &amp;&amp; (!lastIsStar || isSeq))
      <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(binder: PatMatVirtualiser.this.global.Symbol)List[PatMatVirtualiser.this.global.Tree]" id="1135766">subPatRefs</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1137632">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> =
        <span title="List[PatMatVirtualiser.this.global.Tree]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1135739" title="=&gt; Int">nbSubPats</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>
        <span class="keyword">else</span> <span title="List[PatMatVirtualiser.this.global.Tree]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1135742" title="=&gt; Boolean">isSeq</a><span class="delimiter">)</span> <a href="#1135765" title="(binder: PatMatVirtualiser.this.global.Symbol)List[PatMatVirtualiser.this.global.Tree]">subPatRefsSeq</a><span class="delimiter">(</span><a href="#1137632" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span>
        <span class="keyword">else</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="../../../LowPriorityImplicits.scala.html#8333" title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</a> <a href="../../../runtime/RichInt.scala.html#57856" title="(end: Int)scala.collection.immutable.Range.Inclusive">to</a> <a href="#1135739" title="=&gt; Int">nbSubPats</a><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Int =&gt; PatMatVirtualiser.this.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Int],PatMatVirtualiser.this.global.Tree,scala.collection.immutable.IndexedSeq[PatMatVirtualiser.this.global.Tree]])scala.collection.immutable.IndexedSeq[PatMatVirtualiser.this.global.Tree]">map</a> <a href="#1135764" title="(binder: PatMatVirtualiser.this.global.Symbol)(i: Int)PatMatVirtualiser.this.global.Tree">tupleSel</a><a href="#1137736" title="Int" class="delimiter">(</a><a href="#1137632" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../collection/TraversableOnce.scala.html#59174" title="=&gt; List[PatMatVirtualiser.this.global.Tree]">toList</a>

      <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(binder: PatMatVirtualiser.this.global.Symbol)Option[PatMatVirtualiser.this.global.Tree]" id="1135767">lengthGuard</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1137768">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> =
        // no need to check unless it's an unapplySeq and the minimal length is non-trivially satisfied
        <span title="Option[PatMatVirtualiser.this.global.Tree]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1135742" title="=&gt; Boolean">isSeq</a> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#1135759" title="=&gt; Int">expectedLength</a> <a href="../../../Int.scala.html#57905" title="(x: Int)Boolean">&lt;</a> <a href="#1135761" title="=&gt; Int">minLenToCheck</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>
        <span class="keyword">else</span> <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._
          // `binder.lengthCompare(expectedLength)`
          <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Apply" id="1137774">checkExpectedLength</a> = <span class="delimiter">(</span><a href="#1135763" title="(binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">seqTree</a><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods" class="delimiter">(</a><a href="#1137768" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#691675" title="(args: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Apply">DOT</a> <a href="#1135754" title="=&gt; PatMatVirtualiser.this.global.Symbol">seqLenCmp</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#691641" title="(x: Any)PatMatVirtualiser.this.global.Literal">LIT</a><span class="delimiter">(</span><a href="#1135759" title="=&gt; Int">expectedLength</a><span class="delimiter">)</span><span class="delimiter">)</span>

          // the comparison to perform
          // when the last subpattern is a wildcard-star the expectedLength is but a lower bound
          // (otherwise equality is required)
          <span class="keyword">def</span> <a title="=&gt; (PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Tree) =&gt; PatMatVirtualiser.this.global.Tree" id="1137775">compareOp</a>: <span class="delimiter">(</span>Tree, Tree<span class="delimiter">)</span> =&gt; Tree =
            <span title="(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Tree) =&gt; PatMatVirtualiser.this.global.Apply" class="keyword">if</span> <span class="delimiter">(</span><a href="#1135743" title="=&gt; Boolean">lastIsStar</a><span class="delimiter">)</span>  <a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods">_</a> <a href="../ast/TreeDSL.scala.html#691696" title="(other: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Apply">INT_&gt;=</a> <a href="#1137799" title="PatMatVirtualiser.this.global.Tree">_</a>
            <span class="keyword">else</span>             <a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods">_</a> <a href="../ast/TreeDSL.scala.html#691697" title="(other: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Apply">INT_==</a> <a href="#1137808" title="PatMatVirtualiser.this.global.Tree">_</a>

          // `if (binder != null &amp;&amp; $checkExpectedLength [== | &gt;=] 0) then else zero`
          <a href="../../../Option.scala.html#64111" title="(x: PatMatVirtualiser.this.global.Tree)Some[PatMatVirtualiser.this.global.Tree]">Some</a><span class="delimiter">(</span><span class="delimiter">(</span><a href="#1135763" title="(binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">seqTree</a><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods" class="delimiter">(</a><a href="#1137768" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods">ANY_!=</a> <a href="../ast/TreeDSL.scala.html#653591" title="=&gt; PatMatVirtualiser.this.global.Literal">NULL</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#691685" title="(other: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">AND</a> <a href="../../../Function2.scala.html#65847" title="(v1: PatMatVirtualiser.this.global.Tree, v2: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">compareOp</a><span class="delimiter">(</span><a href="#1137774" title="=&gt; PatMatVirtualiser.this.global.Apply">checkExpectedLength</a>, <a href="../ast/TreeDSL.scala.html#653589" title="=&gt; PatMatVirtualiser.this.global.Literal">ZERO</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    // TODO: to be called when there's a def unapplyProd(x: T): U
    // U must have N members _1,..., _N -- the _i are type checked, call their type Ti,
    //
    // for now only used for case classes -- pretending there's an unapplyProd that's the identity (and don't call it)
    <span class="keyword">class</span> <a title="class ExtractorCallProd extends MatchTranslation.this.ExtractorCall" id="1134709">ExtractorCallProd</a><a href="#1134709" title="MatchTranslation.this.ExtractorCallProd" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Tree" id="1136703">fun</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="List[PatMatVirtualiser.this.global.Tree]" id="1136704">args</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134708" title="MatchTranslation.this.ExtractorCall">ExtractorCall</a><span class="delimiter">(</span><a href="#1136704" title="List[PatMatVirtualiser.this.global.Tree]">args</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      // TODO: fix the illegal type bound in pos/t602 -- type inference messes up before we get here:
      /*override def equals(x$1: Any): Boolean = ...
             val o5: Option[com.mosol.sl.Span[Any]] =  // Span[Any] --&gt; Any is not a legal type argument for Span!
      */
      // private val orig            = fun match {case tpt: TypeTree =&gt; tpt.original case _ =&gt; fun}
      // private val origExtractorTp = unapplyMember(orig.symbol.filter(sym =&gt; reallyExists(unapplyMember(sym.tpe))).tpe).tpe
      // private val extractorTp     = if (wellKinded(fun.tpe)) fun.tpe else existentialAbstraction(origExtractorTp.typeParams, origExtractorTp.resultType)
      // println(&quot;ExtractorCallProd: &quot;+ (fun.tpe, existentialAbstraction(origExtractorTp.typeParams, origExtractorTp.resultType)))
      // println(&quot;ExtractorCallProd: &quot;+ (fun.tpe, args map (_.tpe)))
      <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Type" id="1136695">constructorTp</a> = <a href="#1136703" title="PatMatVirtualiser.this.global.Tree">fun</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>

      <span class="keyword">def</span> <a title="=&gt; Boolean" id="1136696">isTyped</a>    = <a href="../../../reflect/internal/Trees.scala.html#441814" title="implicit scala.reflect.internal.Trees.TreeOps : (tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.TreeOps">fun</a>.<a href="../../../reflect/internal/Trees.scala.html#443954" title="=&gt; Boolean">isTyped</a>

      // to which type should the previous binder be casted?
      <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Type" id="1136697">paramType</a>  = <a href="#1136695" title="=&gt; PatMatVirtualiser.this.global.Type">constructorTp</a>.<a href="../../../reflect/internal/Types.scala.html#442006" title="=&gt; PatMatVirtualiser.this.global.Type">finalResultType</a>

      <span class="keyword">def</span> <a title="=&gt; Boolean" id="1136698">isSeq</a>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <a href="#1136699" title="=&gt; List[PatMatVirtualiser.this.global.Type]">rawSubPatTypes</a>.<a href="../../../collection/TraversableOnce.scala.html#59102" title="=&gt; Boolean">nonEmpty</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../reflect/internal/Definitions.scala.html#442310" title="(tp: PatMatVirtualiser.this.global.Type)Boolean">isRepeatedParamType</a><span class="delimiter">(</span><a href="#1136699" title="=&gt; List[PatMatVirtualiser.this.global.Type]">rawSubPatTypes</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76185" title="=&gt; PatMatVirtualiser.this.global.Type">last</a><span class="delimiter">)</span>
      <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; List[PatMatVirtualiser.this.global.Type]" id="1136699">rawSubPatTypes</a> = <a href="#1136695" title="=&gt; PatMatVirtualiser.this.global.Type">constructorTp</a>.<a href="../../../reflect/internal/Types.scala.html#442010" title="=&gt; List[PatMatVirtualiser.this.global.Type]">paramTypes</a>

      // binder has type paramType
      <span class="keyword">def</span> <a title="(binder: PatMatVirtualiser.this.global.Symbol, pos: PatMatVirtualiser.this.global.Position)MatchTranslation.this.TreeMaker" id="1136700">treeMaker</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1137841">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Position" id="1137842">pos</a>: <a href="../util/Position.scala.html#52230" title="PatMatVirtualiser.this.global.Position">Position</a><span class="delimiter">)</span>: <a href="#1134792" title="MatchTranslation.this.TreeMaker">TreeMaker</a> = <span class="delimiter">{</span>
        // checks binder ne null before chaining to the next extractor
        <a href="#1140400" title="(prevBinder: PatMatVirtualiser.this.global.Symbol, extraCond: Option[PatMatVirtualiser.this.global.Tree], localSubstitution: MatchTranslation.this.Substitution)MatchTranslation.this.ProductExtractorTreeMaker">ProductExtractorTreeMaker</a><span class="delimiter">(</span><a href="#1137841" title="PatMatVirtualiser.this.global.Symbol">binder</a>, <a href="#1135767" title="(binder: PatMatVirtualiser.this.global.Symbol)Option[PatMatVirtualiser.this.global.Tree]">lengthGuard</a><span class="delimiter">(</span><a href="#1137841" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span>, <a href="#1137875" title="(from: List[PatMatVirtualiser.this.global.Symbol], to: List[PatMatVirtualiser.this.global.Tree])MatchTranslation.this.Substitution">Substitution</a><span class="delimiter">(</span><a href="#1135747" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">subPatBinders</a>, <a href="#1135766" title="(binder: PatMatVirtualiser.this.global.Symbol)List[PatMatVirtualiser.this.global.Tree]">subPatRefs</a><span class="delimiter">(</span><a href="#1137841" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

/* TODO: remove special case when the following bug is fixed
class Foo(x: Other) { x._1 } // BUG: can't refer to _1 if its defining class has not been type checked yet
case class Other(y: String)
-- this is ok:
case class Other(y: String)
class Foo(x: Other) { x._1 } // no error in this order
*/
      <span class="keyword">override</span> <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(binder: PatMatVirtualiser.this.global.Symbol)(i: Int)PatMatVirtualiser.this.global.Tree" id="1136701">tupleSel</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1137904">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="Int" id="1137905">i</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._
        // reference the (i-1)th case accessor if it exists, otherwise the (i-1)th tuple component
        <span class="keyword">val</span> <a title="List[PatMatVirtualiser.this.global.Symbol]" id="1137907">caseAccs</a> = <a href="#1137904" title="PatMatVirtualiser.this.global.Symbol">binder</a>.<a href="../../../reflect/internal/Symbols.scala.html#443427" title="=&gt; PatMatVirtualiser.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; PatMatVirtualiser.this.global.Symbol">typeSymbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443486" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">caseFieldAccessors</a>
        <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1137907" title="List[PatMatVirtualiser.this.global.Symbol]">caseAccs</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76196" title="(x: Int)Boolean">isDefinedAt</a> <span class="delimiter">(</span><a href="#1137905" title="Int">i</a><a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods" class="delimiter">(</a><a href="#1137904" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#653650" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeFromSelectStart : (ss: PatMatVirtualiser.this.CODE.SelectStart)PatMatVirtualiser.this.global.Select">DOT</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)PatMatVirtualiser.this.global.Symbol">caseAccs</a><span class="delimiter">(</span><a href="#1137905" title="Int">i</a><a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span class="keyword">else</span> <a href="#1134723" title="=&gt; MatchTranslation.this.AbsCodegen">codegen</a>.<a href="#1137198" title="(binder: PatMatVirtualiser.this.global.Symbol)(i: Int)PatMatVirtualiser.this.global.Tree">tupleSel</a><span class="delimiter">(</span><a href="#1137904" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1137905" title="Int">i</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1136702">toString</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="String(&quot;case class &quot;)" class="string">&quot;case class &quot;</span><span title="(x$1: Any)String">+</span> <span class="delimiter">(</span><span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1136695" title="=&gt; PatMatVirtualiser.this.global.Type">constructorTp</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#1136703" title="PatMatVirtualiser.this.global.Tree">fun</a> <span class="keyword">else</span> <a href="#1136697" title="=&gt; PatMatVirtualiser.this.global.Type">paramType</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; PatMatVirtualiser.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span><span title="String(&quot; with arguments &quot;)" class="string">&quot; with arguments &quot;</span><span title="(x$1: Any)String">+</span> <a href="#1136704" title="List[PatMatVirtualiser.this.global.Tree]">args</a>
    <span class="delimiter">}</span>

    <span class="keyword">class</span> <a title="class ExtractorCallRegular extends MatchTranslation.this.ExtractorCall" id="1134710">ExtractorCallRegular</a><a href="#1134710" title="MatchTranslation.this.ExtractorCallRegular" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Tree" id="1136686">extractorCallIncludingDummy</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="List[PatMatVirtualiser.this.global.Tree]" id="1136687">args</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134708" title="MatchTranslation.this.ExtractorCall">ExtractorCall</a><span class="delimiter">(</span><a href="#1136687" title="List[PatMatVirtualiser.this.global.Tree]">args</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> Some<a href="#1138019" title="PatMatVirtualiser.this.global.Tree" id="1138021" class="delimiter">(</a>Apply<a title="PatMatVirtualiser.this.global.Tree" id="1138024" class="delimiter">(</a>extractorCall, _<span class="delimiter">)</span><span class="delimiter">)</span> = <a href="#1136686" title="PatMatVirtualiser.this.global.Tree">extractorCallIncludingDummy</a>.<a href="../../../reflect/api/Trees.scala.html#425080" title="(p: PatMatVirtualiser.this.global.Tree =&gt; Boolean)Option[PatMatVirtualiser.this.global.Tree]">find</a><a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[PatMatVirtualiser.this.global.Tree,Boolean] with Serializable" id="1137948" class="delimiter">{</a> <span class="keyword">case</span> Apply<a href="#1137970" title="Boolean" id="1137974" class="delimiter">(</a>_, <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[PatMatVirtualiser.this.global.Tree]]" id="1137998">List</a><span class="delimiter">(</span>Ident<a title="Boolean" id="1137981" class="delimiter">(</a><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446209" title="Boolean" id="1137984">SELECTOR_DUMMY</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#1137985" title="(x: Boolean)Boolean" class="keyword">true</a> <span class="keyword">case</span> _ =&gt; <a href="#1137985" title="(x: Boolean)Boolean" class="keyword">false</a> <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Type" id="1136672">tpe</a>        = <a href="#1136670" title="=&gt; PatMatVirtualiser.this.global.Tree">extractorCall</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>
      <span class="keyword">def</span> <a title="=&gt; Boolean" id="1136673">isTyped</a>    = <span class="delimiter">(</span><a href="#1136672" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="../../../reflect/internal/Types.scala.html#441256" title="PatMatVirtualiser.this.global.NoType.type">NoType</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../reflect/internal/Trees.scala.html#441814" title="implicit scala.reflect.internal.Trees.TreeOps : (tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.TreeOps">extractorCall</a>.<a href="../../../reflect/internal/Trees.scala.html#443954" title="=&gt; Boolean">isTyped</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#1136681" title="=&gt; PatMatVirtualiser.this.global.Type">resultInMonad</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="../../../reflect/internal/Types.scala.html#441249" title="PatMatVirtualiser.this.global.ErrorType.type">ErrorType</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Type" id="1136674">paramType</a>  = <a href="#1136672" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#442010" title="=&gt; List[PatMatVirtualiser.this.global.Type]">paramTypes</a>.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; PatMatVirtualiser.this.global.Type">head</a>
      <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Type" id="1136675">resultType</a> = <a href="#1136672" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#442006" title="=&gt; PatMatVirtualiser.this.global.Type">finalResultType</a>
      <span class="keyword">def</span> <a title="=&gt; Boolean" id="1136676">isSeq</a>      = <a href="#1136670" title="=&gt; PatMatVirtualiser.this.global.Tree">extractorCall</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; PatMatVirtualiser.this.global.Symbol#NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446713" title="=&gt; PatMatVirtualiser.this.global.nme.NameType">unapplySeq</a>

      <span class="keyword">def</span> <a title="(patBinderOrCasted: PatMatVirtualiser.this.global.Symbol, pos: PatMatVirtualiser.this.global.Position)MatchTranslation.this.TreeMaker" id="1136677">treeMaker</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1138040">patBinderOrCasted</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Position" id="1138041">pos</a>: <a href="../util/Position.scala.html#52230" title="PatMatVirtualiser.this.global.Position">Position</a><span class="delimiter">)</span>: <a href="#1134792" title="MatchTranslation.this.TreeMaker">TreeMaker</a> = <span class="delimiter">{</span>
        // the extractor call (applied to the binder bound by the flatMap corresponding to the previous (i.e., enclosing/outer) pattern)
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1138042">extractorApply</a> = <a href="../../../reflect/internal/Positions.scala.html#441889" title="(pos: PatMatVirtualiser.this.global.Position)(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">atPos</a><span class="delimiter">(</span><a href="#1138041" title="PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1136680" title="(binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">spliceApply</a><span class="delimiter">(</span><a href="#1138040" title="PatMatVirtualiser.this.global.Symbol">patBinderOrCasted</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermSymbol" id="1138043">binder</a>         = <a href="#1134720" title="(pos: PatMatVirtualiser.this.global.Position, tp: PatMatVirtualiser.this.global.Type, prefix: String)PatMatVirtualiser.this.global.TermSymbol">freshSym</a><span class="delimiter">(</span><a href="#1138041" title="PatMatVirtualiser.this.global.Position">pos</a>, <a href="#1134694" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">pureType</a><span class="delimiter">(</span><a href="#1136681" title="=&gt; PatMatVirtualiser.this.global.Type">resultInMonad</a><span class="delimiter">)</span><span class="delimiter">)</span> // can't simplify this when subPatBinders.isEmpty, since UnitClass.tpe is definitely wrong when isSeq, and resultInMonad should always be correct since it comes directly from the extractor's result type
        <a href="#1140372" title="(extractor: PatMatVirtualiser.this.global.Tree, extraCond: Option[PatMatVirtualiser.this.global.Tree], nextBinder: PatMatVirtualiser.this.global.Symbol, localSubstitution: MatchTranslation.this.Substitution)(extractorReturnsBoolean: Boolean)MatchTranslation.this.ExtractorTreeMaker">ExtractorTreeMaker</a><span class="delimiter">(</span><a href="#1138042" title="PatMatVirtualiser.this.global.Tree">extractorApply</a>, <a href="#1135767" title="(binder: PatMatVirtualiser.this.global.Symbol)Option[PatMatVirtualiser.this.global.Tree]">lengthGuard</a><span class="delimiter">(</span><a href="#1138043" title="PatMatVirtualiser.this.global.TermSymbol">binder</a><span class="delimiter">)</span>, <a href="#1138043" title="PatMatVirtualiser.this.global.TermSymbol">binder</a>, <a href="#1137875" title="(from: List[PatMatVirtualiser.this.global.Symbol], to: List[PatMatVirtualiser.this.global.Tree])MatchTranslation.this.Substitution">Substitution</a><span class="delimiter">(</span><a href="#1135747" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">subPatBinders</a>, <a href="#1136679" title="(binder: PatMatVirtualiser.this.global.Symbol)List[PatMatVirtualiser.this.global.Tree]">subPatRefs</a><span class="delimiter">(</span><a href="#1138043" title="PatMatVirtualiser.this.global.TermSymbol">binder</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1136675" title="=&gt; PatMatVirtualiser.this.global.Type">resultType</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; PatMatVirtualiser.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#442857" title="=&gt; PatMatVirtualiser.this.global.ClassSymbol">BooleanClass</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">override</span> <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree" id="1136678">seqTree</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1138098">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> =
        <span title="PatMatVirtualiser.this.global.gen.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1135755" title="=&gt; Int">firstIndexingBinder</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1138098" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span>
        <span class="keyword">else</span> <a href="#1134710" title="MatchTranslation.this.ExtractorCallRegular" class="keyword">super</a>.<a href="#1135763" title="(binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">seqTree</a><span class="delimiter">(</span><a href="#1138098" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span>

      // the trees that select the subpatterns on the extractor's result, referenced by `binder`
      // require (nbSubPats &gt; 0 &amp;&amp; (!lastIsStar || isSeq))
      <span class="keyword">override</span> <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(binder: PatMatVirtualiser.this.global.Symbol)List[PatMatVirtualiser.this.global.Tree]" id="1136679">subPatRefs</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1138091">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> =
        <span title="List[PatMatVirtualiser.this.global.gen.global.Tree]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1136676" title="=&gt; Boolean">isSeq</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1135739" title="=&gt; Int">nbSubPats</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.gen.global.Tree*)List[PatMatVirtualiser.this.global.gen.global.Tree]">List</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1138091" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span><span class="delimiter">)</span> // special case for extractors
        <span class="keyword">else</span> <a href="#1134710" title="MatchTranslation.this.ExtractorCallRegular" class="keyword">super</a>.<a href="#1135766" title="(binder: PatMatVirtualiser.this.global.Symbol)List[PatMatVirtualiser.this.global.Tree]">subPatRefs</a><span class="delimiter">(</span><a href="#1138091" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span>

      <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree" id="1136680">spliceApply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1138049">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
        <span class="keyword">object</span> <a title="splice.type" id="1138118">splice</a> <a href="#1138119" title="splice.type" class="keyword">extends</a> <a href="../ast/Trees.scala.html#559848" title="PatMatVirtualiser.this.global.Transformer">Transformer</a> <span class="delimiter">{</span>
          <span class="keyword">override</span> <span class="keyword">def</span> <a title="(t: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1138121">transform</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1138123">t</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#1138123" title="PatMatVirtualiser.this.global.Tree">t</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> Apply<a href="#1138159" title="PatMatVirtualiser.this.global.Tree" id="1138162" class="delimiter">(</a>x, <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[PatMatVirtualiser.this.global.Tree]]" id="1138184">List</a><span class="delimiter">(</span>Ident<a title="PatMatVirtualiser.this.global.Tree" id="1138169" class="delimiter">(</a><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446209" title="PatMatVirtualiser.this.global.Tree" id="1138172">SELECTOR_DUMMY</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
              <a href="../../../reflect/api/Trees.scala.html#438839" title="=&gt; PatMatVirtualiser.this.global.TreeCopier">treeCopy</a>.<a href="../../../reflect/api/Trees.scala.html#428311" title="(tree: PatMatVirtualiser.this.global.Tree, fun: PatMatVirtualiser.this.global.Tree, args: List[PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Apply">Apply</a><a href="#1138173" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="#1138123" title="PatMatVirtualiser.this.global.Tree">t</a>, x, <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.gen.global.Tree*)List[PatMatVirtualiser.this.global.gen.global.Tree]">List</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1138049" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">case</span> _ =&gt; <span class="keyword">super</span>.<a href="../../../reflect/api/Trees.scala.html#438847" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">transform</a><a href="#1138173" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="#1138123" title="PatMatVirtualiser.this.global.Tree">t</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <a href="#1138118" title="splice.type">splice</a>.<a href="#1138121" title="(t: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1136686" title="PatMatVirtualiser.this.global.Tree">extractorCallIncludingDummy</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      // what's the extractor's result type in the monad?
      // turn an extractor's result type into something `monadTypeToSubPatTypesAndRefs` understands
      <span class="keyword">protected</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Type" id="1136682">resultInMonad</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a> = <span title="PatMatVirtualiser.this.global.Type" class="keyword">if</span><span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="../../../reflect/internal/Types.scala.html#441504" title="(xs: List[_], len: Int)Boolean">hasLength</a><span class="delimiter">(</span><a href="#1136672" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#442010" title="=&gt; List[PatMatVirtualiser.this.global.Type]">paramTypes</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../reflect/internal/Types.scala.html#441249" title="PatMatVirtualiser.this.global.ErrorType.type">ErrorType</a> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span title="PatMatVirtualiser.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1136675" title="=&gt; PatMatVirtualiser.this.global.Type">resultType</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; PatMatVirtualiser.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#442857" title="=&gt; PatMatVirtualiser.this.global.ClassSymbol">BooleanClass</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Definitions.scala.html#442841" title="=&gt; PatMatVirtualiser.this.global.ClassSymbol">UnitClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>
        <span class="keyword">else</span> <a href="#1134695" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">matchMonadResult</a><span class="delimiter">(</span><a href="#1136675" title="=&gt; PatMatVirtualiser.this.global.Type">resultType</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">protected</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[PatMatVirtualiser.this.global.Type]" id="1136684">rawSubPatTypes</a> =
        <span title="List[PatMatVirtualiser.this.global.Type]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1136681" title="=&gt; PatMatVirtualiser.this.global.Type">resultInMonad</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; PatMatVirtualiser.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../reflect/internal/Definitions.scala.html#442841" title="=&gt; PatMatVirtualiser.this.global.ClassSymbol">UnitClass</a><span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>
        <span class="keyword">else</span> <span title="List[PatMatVirtualiser.this.global.Type]" class="keyword">if</span><span class="delimiter">(</span><a href="#1135739" title="=&gt; Int">nbSubPats</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>                    <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.Type*)List[PatMatVirtualiser.this.global.Type]">List</a><span class="delimiter">(</span><a href="#1136681" title="=&gt; PatMatVirtualiser.this.global.Type">resultInMonad</a><span class="delimiter">)</span>
        <span class="keyword">else</span> <a href="../../../reflect/internal/Definitions.scala.html#442502" title="(tpe: PatMatVirtualiser.this.global.Type)List[PatMatVirtualiser.this.global.Type]">getProductArgs</a><span title="List[PatMatVirtualiser.this.global.Type]" class="delimiter">(</span><a href="#1136681" title="=&gt; PatMatVirtualiser.this.global.Type">resultInMonad</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="../../../collection/immutable/List.scala.html#11552" title="List[PatMatVirtualiser.this.global.Type]" id="1138223">Nil</a> =&gt; <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.Type*)List[PatMatVirtualiser.this.global.Type]">List</a><a href="#1138224" title="(x: List[PatMatVirtualiser.this.global.Type])List[PatMatVirtualiser.this.global.Type]" class="delimiter">(</a><a href="#1136681" title="=&gt; PatMatVirtualiser.this.global.Type">resultInMonad</a><span class="delimiter">)</span>
          <span class="keyword">case</span> x   =&gt; <a href="#1138224" title="(x: List[PatMatVirtualiser.this.global.Type])List[PatMatVirtualiser.this.global.Type]">x</a>
        <span class="delimiter">}</span>

      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1136685">toString</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="../../../Predef.scala.html#8576" title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd">extractorCall</a> <a href="../../../runtime/StringAdd.scala.html#60949" title="(other: String)String">+</a><span title="String(&quot;: &quot;)" class="string">&quot;: &quot;</span><span title="(x$1: Any)String">+</span> <a href="#1136670" title="=&gt; PatMatVirtualiser.this.global.Tree">extractorCall</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a> <span title="(x$1: Any)String">+</span><span title="String(&quot; (symbol= &quot;)" class="string">&quot; (symbol= &quot;</span><span title="(x$1: Any)String">+</span> <a href="#1136670" title="=&gt; PatMatVirtualiser.this.global.Tree">extractorCall</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;).&quot;)" class="string">&quot;).&quot;</span>
    <span class="delimiter">}</span>

    /** A conservative approximation of which patterns do not discern anything.
     * They are discarded during the translation.
     */
    <span class="keyword">object</span> <a title="MatchTranslation.this.WildcardPattern.type" id="1134711">WildcardPattern</a> <a href="#1134712" title="MatchTranslation.this.WildcardPattern.type" class="delimiter">{</a>
      <span class="keyword">def</span> <a title="(pat: PatMatVirtualiser.this.global.Tree)Boolean" id="1136186">unapply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1136187">pat</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <a href="#1136187" title="PatMatVirtualiser.this.global.Tree">pat</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Bind<a href="#1138259" title="Boolean" id="1138263" class="delimiter">(</a><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#445910" title="Boolean" id="1138280">WILDCARD</a>, <a href="#1136186" title="Boolean">WildcardPattern</a><a title="Unit" id="1138266" class="delimiter">(</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#1138284" title="(x: Boolean)Boolean" class="keyword">true</a> // don't skip when binding an interesting symbol!
        <span class="keyword">case</span> Ident<a href="#1138259" title="Boolean" id="1138269" class="delimiter">(</a><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#445910" title="Boolean" id="1138281">WILDCARD</a><span class="delimiter">)</span>                   =&gt; <a href="#1138284" title="(x: Boolean)Boolean" class="keyword">true</a>
        <span class="keyword">case</span> Star<a href="#1138259" title="Boolean" id="1138274" class="delimiter">(</a><a href="#1136186" title="Boolean">WildcardPattern</a><a title="Unit" id="1138275" class="delimiter">(</a><span class="delimiter">)</span><span class="delimiter">)</span>               =&gt; <a href="#1138284" title="(x: Boolean)Boolean" class="keyword">true</a>
        <span class="keyword">case</span> <a href="#1138259" title="Boolean" id="1138282">x</a>: Ident                              =&gt; <a href="../ast/Trees.scala.html#559838" title="PatMatVirtualiser.this.global.treeInfo.type">treeInfo</a>.<a href="../../../reflect/internal/TreeInfo.scala.html#501485" title="(pat: PatMatVirtualiser.this.global.treeInfo.global.Tree)Boolean">isVarPattern</a><a href="#1138284" title="(x: Boolean)Boolean" class="delimiter">(</a>x<span class="delimiter">)</span>
        <span class="keyword">case</span> Alternative<a href="#1138259" title="Boolean" id="1138278" class="delimiter">(</a>ps<span class="delimiter">)</span>                       =&gt; ps <a href="#1138284" title="(x: Boolean)Boolean">forall</a> <span class="delimiter">(</span><a href="#1134711" title="MatchTranslation.this.WildcardPattern.type">WildcardPattern</a>.<a href="#1136186" title="(pat: PatMatVirtualiser.this.global.Tree)Boolean">unapply</a><span class="delimiter">(</span><a href="#1138257" title="PatMatVirtualiser.this.global.Tree">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../../../reflect/api/Trees.scala.html#23577" title="Boolean" id="1138283">EmptyTree</a>                             =&gt; <a href="#1138284" title="(x: Boolean)Boolean" class="keyword">true</a>
        <span class="keyword">case</span> _                                     =&gt; <a href="#1138284" title="(x: Boolean)Boolean" class="keyword">false</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">object</span> <a title="MatchTranslation.this.Bound.type" id="1134713">Bound</a> <a href="#1134714" title="MatchTranslation.this.Bound.type" class="delimiter">{</a>
      <span class="keyword">def</span> <a title="(t: PatMatVirtualiser.this.global.Tree)Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]" id="1135798">unapply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1135799">t</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]">Option</a><span class="delimiter">[</span><span class="delimiter">(</span>Symbol, Tree<span class="delimiter">)</span><span class="delimiter">]</span> = <a href="#1135799" title="PatMatVirtualiser.this.global.Tree">t</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> t@Bind<a href="#1138321" title="Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]" id="1138323" class="delimiter">(</a>n, p<span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span>t.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span>t.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> =&gt; // pos/t2429 does not satisfy these conditions
          <a href="../../../Option.scala.html#64111" title="(x: (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree))Some[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]">Some</a><a href="#1138324" title="(x: Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]" class="delimiter">(</a><a href="../../../Tuple2.scala.html#63804" title="(_1: PatMatVirtualiser.this.global.Symbol, _2: PatMatVirtualiser.this.global.Tree)(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)" class="delimiter">(</a>t.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>, p<span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> _ =&gt; <a href="#1138324" title="(x: Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])Option[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]">None</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span title="Object" class="delimiter">}</span>

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// substitution
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  <span class="keyword">trait</span> <a title="trait TypedSubstitution extends Object with PatMatVirtualiser.this.MatchMonadInterface" id="560239">TypedSubstitution</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#560237" title="PatMatVirtualiser.this.MatchMonadInterface">MatchMonadInterface</a> <span class="delimiter">{</span>
    <span class="keyword">object</span> <a title="TypedSubstitution.this.Substitution.type" id="1134782">Substitution</a> <a href="#1134783" title="TypedSubstitution.this.Substitution.type" class="delimiter">{</a>
      <span class="keyword">def</span> <a title="(from: PatMatVirtualiser.this.global.Symbol, to: PatMatVirtualiser.this.global.Tree)TypedSubstitution.this.Substitution" id="1137874">apply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1137882">from</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1137883">to</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span> = <span title="TypedSubstitution.this.Substitution" class="keyword">new</span> <a href="#1134784" title="TypedSubstitution.this.Substitution">Substitution</a><span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.Symbol*)List[PatMatVirtualiser.this.global.Symbol]">List</a><span class="delimiter">(</span><a href="#1137882" title="PatMatVirtualiser.this.global.Symbol">from</a><span class="delimiter">)</span>, <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.Tree*)List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">(</span><a href="#1137883" title="PatMatVirtualiser.this.global.Tree">to</a><span class="delimiter">)</span><span class="delimiter">)</span>
      // requires sameLength(from, to)
      <span class="keyword">def</span> <a title="(from: List[PatMatVirtualiser.this.global.Symbol], to: List[PatMatVirtualiser.this.global.Tree])TypedSubstitution.this.Substitution" id="1137875">apply</a><span class="delimiter">(</span><a title="List[PatMatVirtualiser.this.global.Symbol]" id="1137878">from</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Symbol]">List</a><span class="delimiter">[</span>Symbol<span class="delimiter">]</span>, <a title="List[PatMatVirtualiser.this.global.Tree]" id="1137879">to</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> =
        <span title="TypedSubstitution.this.Substitution" class="keyword">if</span> <span class="delimiter">(</span><a href="#1137878" title="List[PatMatVirtualiser.this.global.Symbol]">from</a> <a href="../../../collection/TraversableOnce.scala.html#59102" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <span title="TypedSubstitution.this.Substitution" class="keyword">new</span> <a href="#1134784" title="TypedSubstitution.this.Substitution">Substitution</a><span class="delimiter">(</span><a href="#1137878" title="List[PatMatVirtualiser.this.global.Symbol]">from</a>, <a href="#1137879" title="List[PatMatVirtualiser.this.global.Tree]">to</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#1134785" title="TypedSubstitution.this.EmptySubstitution.type">EmptySubstitution</a>
    <span class="delimiter">}</span>

    <span class="keyword">class</span> <a title="class Substitution extends Object" id="1134784">Substitution</a><a href="#1134784" title="TypedSubstitution.this.Substitution" class="delimiter">(</a><span class="keyword">val</span> <a title="List[PatMatVirtualiser.this.global.Symbol]" id="1137880">from</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Symbol]">List</a><span class="delimiter">[</span>Symbol<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="List[PatMatVirtualiser.this.global.Tree]" id="1137881">to</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      // We must explicitly type the trees that we replace inside some other tree, since the latter may already have been typed,
      // and will thus not be retyped. This means we might end up with untyped subtrees inside bigger, typed trees.
      <span class="keyword">def</span> <a title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1135272">apply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1138337">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
        // according to -Ystatistics 10% of translateMatch's time is spent in this method...
        // since about half of the typedSubst's end up being no-ops, the check below shaves off 5% of the time spent in typedSubst
        <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1138337" title="PatMatVirtualiser.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425081" title="(p: PatMatVirtualiser.this.global.Tree =&gt; Boolean)Boolean">exists</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[PatMatVirtualiser.this.global.Tree,Boolean] with Serializable" id="1138340" class="delimiter">{</a> <span class="keyword">case</span> i@Ident<a href="#1138347" title="Boolean" id="1138350" class="delimiter">(</a>_<span class="delimiter">)</span> =&gt; <a href="#1137880" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">from</a> <a href="#1138351" title="(x: Boolean)Boolean">contains</a> i.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a> <span class="keyword">case</span> _ =&gt; <a href="#1138351" title="(x: Boolean)Boolean" class="keyword">false</a><span class="delimiter">}</span><span class="delimiter">)</span> <a href="#1138337" title="PatMatVirtualiser.this.global.Tree">tree</a>
        <span class="keyword">else</span> <span class="delimiter">(</span><a href="#1138362" title="PatMatVirtualiser.this.global.Transformer{}" class="keyword">new</a> <a href="../ast/Trees.scala.html#559848" title="anonymous class $anon extends PatMatVirtualiser.this.global.Transformer" id="1138362">Transformer</a> <span class="delimiter">{</span>
          @inline <span class="keyword">private</span> <span class="keyword">def</span> <a title="(to: PatMatVirtualiser.this.global.Tree, origTp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree" id="1138364">typedIfOrigTyped</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1138369">to</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Type" id="1138370">origTp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> =
            <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1138370" title="PatMatVirtualiser.this.global.Type">origTp</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="#1138370" title="PatMatVirtualiser.this.global.Type">origTp</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Types.scala.html#441256" title="PatMatVirtualiser.this.global.NoType.type">NoType</a><span class="delimiter">)</span> <a href="#1138369" title="PatMatVirtualiser.this.global.Tree">to</a>
            // important: only type when actually substing and when original tree was typed
            // (don't need to use origTp as the expected type, though, and can't always do this anyway due to unknown type params stemming from polymorphic extractors)
            <span class="keyword">else</span> <a href="#1134690" title="=&gt; PatMatVirtualiser.this.Typer">typer</a>.<a href="Typers.scala.html#560765" title="(tree: PatMatVirtualiser.this.global.Tree, mode: Int, pt: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree">typed</a><span class="delimiter">(</span><a href="#1138369" title="PatMatVirtualiser.this.global.Tree">to</a>, <span title="Int(1)">EXPRmode</span>, <a href="../../../reflect/internal/Types.scala.html#441251" title="PatMatVirtualiser.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>

          <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1138365">transform</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1138366">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
            <span class="keyword">def</span> <a title="(from: List[PatMatVirtualiser.this.global.Symbol], to: List[PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree" id="1138387">subst</a><span class="delimiter">(</span><a title="List[PatMatVirtualiser.this.global.Symbol]" id="1138388">from</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Symbol]">List</a><span class="delimiter">[</span>Symbol<span class="delimiter">]</span>, <a title="List[PatMatVirtualiser.this.global.Tree]" id="1138389">to</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> =
              <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1138388" title="List[PatMatVirtualiser.this.global.Symbol]">from</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="#1138366" title="PatMatVirtualiser.this.global.Tree">tree</a>
              <span class="keyword">else</span> <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1138366" title="PatMatVirtualiser.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1138388" title="List[PatMatVirtualiser.this.global.Symbol]">from</a>.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; PatMatVirtualiser.this.global.Symbol">head</a><span class="delimiter">)</span> <a href="#1138364" title="(to: PatMatVirtualiser.this.global.Tree, origTp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree">typedIfOrigTyped</a><span class="delimiter">(</span><a href="#1138389" title="List[PatMatVirtualiser.this.global.Tree]">to</a>.<a href="../../../reflect/internal/Trees.scala.html#441814" title="implicit scala.reflect.internal.Trees.TreeOps : (tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.TreeOps">head</a>.<a href="../../../reflect/internal/Trees.scala.html#443961" title="=&gt; PatMatVirtualiser.this.global.Tree">shallowDuplicate</a>, <a href="#1138366" title="PatMatVirtualiser.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span>
              <span class="keyword">else</span> <a href="#1138387" title="(from: List[PatMatVirtualiser.this.global.Symbol], to: List[PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree">subst</a><span class="delimiter">(</span><a href="#1138388" title="List[PatMatVirtualiser.this.global.Symbol]">from</a>.<a href="../../../collection/TraversableLike.scala.html#59012" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">tail</a>, <a href="#1138389" title="List[PatMatVirtualiser.this.global.Tree]">to</a>.<a href="../../../collection/TraversableLike.scala.html#59012" title="=&gt; List[PatMatVirtualiser.this.global.Tree]">tail</a><span class="delimiter">)</span>

            <a href="#1138366" title="PatMatVirtualiser.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> Ident<a href="#1138402" title="PatMatVirtualiser.this.global.Tree" id="1138405" class="delimiter">(</a>_<span class="delimiter">)</span> =&gt; <a href="#1138387" title="(from: List[PatMatVirtualiser.this.global.Symbol], to: List[PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree">subst</a><a href="#1138406" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="#1137880" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">from</a>, <a href="#1137881" title="=&gt; List[PatMatVirtualiser.this.global.Tree]">to</a><span class="delimiter">)</span>
              <span class="keyword">case</span> _        =&gt; <a href="#1138362" title="PatMatVirtualiser.this.global.Transformer{}" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#438847" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">transform</a><a href="#1138406" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="#1138366" title="PatMatVirtualiser.this.global.Tree">tree</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>.<a href="#1138365" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1138337" title="PatMatVirtualiser.this.global.Tree">tree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>


      // the substitution that chains `other` before `this` substitution
      // forall t: Tree. this(other(t)) == (this &gt;&gt; other)(t)
      <span class="keyword">def</span> <a title="(other: TypedSubstitution.this.Substitution)TypedSubstitution.this.Substitution" id="1135273">&gt;&gt;</a><span class="delimiter">(</span><a title="TypedSubstitution.this.Substitution" id="1138414">other</a>: <a href="#1134784" title="TypedSubstitution.this.Substitution">Substitution</a><span class="delimiter">)</span>: <a href="#1134784" title="TypedSubstitution.this.Substitution">Substitution</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a href="#1138549" title="(x: (List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Tree]))(List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Tree])" class="delimiter">(</a><a href="../../../Tuple2.scala.html#61506" title="List[PatMatVirtualiser.this.global.Symbol]" id="1138416">fromFiltered</a>, <a href="../../../Tuple2.scala.html#61508" title="List[PatMatVirtualiser.this.global.Tree]" id="1138417">toFiltered</a><span class="delimiter">)</span> = <a href="../../../Tuple2.scala.html#63804" title="(_1: List[PatMatVirtualiser.this.global.Symbol], _2: List[PatMatVirtualiser.this.global.Tree])(List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Tree])" class="delimiter">(</a><a href="#1137880" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">from</a>, <a href="#1137881" title="=&gt; List[PatMatVirtualiser.this.global.Tree]">to</a><span class="delimiter">)</span>.<a href="../../../Tuple2.scala.html#61522" title="(implicit w1: List[PatMatVirtualiser.this.global.Symbol] =&gt; scala.collection.TraversableLike[PatMatVirtualiser.this.global.Symbol,List[PatMatVirtualiser.this.global.Symbol]], implicit w2: List[PatMatVirtualiser.this.global.Tree] =&gt; scala.collection.IterableLike[PatMatVirtualiser.this.global.Tree,List[PatMatVirtualiser.this.global.Tree]])(List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Tree])#Zipped[List[PatMatVirtualiser.this.global.Symbol],PatMatVirtualiser.this.global.Symbol,List[PatMatVirtualiser.this.global.Tree],PatMatVirtualiser.this.global.Tree]">zipped</a> <a href="../../../Tuple2.scala.html#61562" title="(f: (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree) =&gt; Boolean)(implicit cbf1: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Symbol],PatMatVirtualiser.this.global.Symbol,List[PatMatVirtualiser.this.global.Symbol]], implicit cbf2: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Tree],PatMatVirtualiser.this.global.Tree,List[PatMatVirtualiser.this.global.Tree]])(List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Tree])">filter</a> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1138481">f</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1138482">t</a><span class="delimiter">)</span> =&gt;  <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1138414" title="TypedSubstitution.this.Substitution">other</a>.<a href="#1137880" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">from</a>.<a href="../../../collection/SeqLike.scala.html#59768" title="(elem: Any)Boolean">contains</a><span class="delimiter">(</span><a href="#1138481" title="PatMatVirtualiser.this.global.Symbol">f</a><span class="delimiter">)</span> <span class="delimiter">}</span>
        <span title="TypedSubstitution.this.Substitution" class="keyword">new</span> <a href="#1134784" title="TypedSubstitution.this.Substitution">Substitution</a><span class="delimiter">(</span><a href="#1138414" title="TypedSubstitution.this.Substitution">other</a>.<a href="#1137880" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">from</a> <a href="../../../collection/immutable/List.scala.html#63655" title="(that: scala.collection.GenTraversableOnce[PatMatVirtualiser.this.global.Symbol])(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Symbol],PatMatVirtualiser.this.global.Symbol,List[PatMatVirtualiser.this.global.Symbol]])List[PatMatVirtualiser.this.global.Symbol]">++</a> <a href="#1138416" title="List[PatMatVirtualiser.this.global.Symbol]">fromFiltered</a>, <a href="#1138414" title="TypedSubstitution.this.Substitution">other</a>.<a href="#1137881" title="=&gt; List[PatMatVirtualiser.this.global.Tree]">to</a>.<a href="../../../collection/TraversableLike.scala.html#58971" title="(f: PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Tree],PatMatVirtualiser.this.global.Tree,List[PatMatVirtualiser.this.global.Tree]])List[PatMatVirtualiser.this.global.Tree]">map</a><a href="../../../collection/immutable/List.scala.html#63282" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,PatMatVirtualiser.this.global.Tree,List[PatMatVirtualiser.this.global.Tree]]" class="delimiter">(</a><a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">apply</a><span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#63655" title="(that: scala.collection.GenTraversableOnce[PatMatVirtualiser.this.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Tree],PatMatVirtualiser.this.global.Tree,List[PatMatVirtualiser.this.global.Tree]])List[PatMatVirtualiser.this.global.Tree]">++</a> <a href="#1138417" title="List[PatMatVirtualiser.this.global.Tree]">toFiltered</a><span class="delimiter">)</span> // a quick benchmarking run indicates the `.map(apply)` is not too costly
      <span class="delimiter">}</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1135274">toString</a> = <span class="delimiter">(</span><a href="#1137880" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">from</a> <a href="../../../collection/IterableLike.scala.html#59486" title="(that: scala.collection.GenIterable[PatMatVirtualiser.this.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Symbol],(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree),List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]])List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]">zip</a> <a href="#1137881" title="=&gt; List[PatMatVirtualiser.this.global.Tree]">to</a><span class="delimiter">)</span> <a href="../../../collection/TraversableOnce.scala.html#59189" title="(start: String, sep: String, end: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;Substitution(&quot;)" class="string">&quot;Substitution(&quot;</span>, <span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span>, <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">object</span> <a title="TypedSubstitution.this.EmptySubstitution.type" id="1134785">EmptySubstitution</a> <a href="#1134786" title="TypedSubstitution.this.EmptySubstitution.type" class="keyword">extends</a> <a href="#1134784" title="TypedSubstitution.this.Substitution">Substitution</a><span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>, <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1135276">apply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1138764">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="#1138764" title="PatMatVirtualiser.this.global.Tree">tree</a>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(other: TypedSubstitution.this.Substitution)TypedSubstitution.this.Substitution" id="1135277">&gt;&gt;</a><span class="delimiter">(</span><a title="TypedSubstitution.this.Substitution" id="1138765">other</a>: <a href="#1134784" title="TypedSubstitution.this.Substitution">Substitution</a><span class="delimiter">)</span>: <a href="#1134784" title="TypedSubstitution.this.Substitution">Substitution</a> = <a href="#1138765" title="TypedSubstitution.this.Substitution">other</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// the making of the trees
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  <span class="keyword">trait</span> <a title="trait TreeMakers extends Object with PatMatVirtualiser.this.TypedSubstitution" id="560240">TreeMakers</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#560239" title="PatMatVirtualiser.this.TypedSubstitution">TypedSubstitution</a> <span class="delimiter">{</span> self: CodegenCore =&gt;
    <span class="keyword">def</span> <a title="(prevBinder: PatMatVirtualiser.this.global.Symbol, cases: List[List[TreeMakers.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type)(List[List[TreeMakers.this.TreeMaker]], List[PatMatVirtualiser.this.global.Tree])" id="1134789">optimizeCases</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1138768">prevBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="List[List[TreeMakers.this.TreeMaker]]" id="1138769">cases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[TreeMakers.this.TreeMaker]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Type" id="1138770">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../Tuple2.scala.html#1222" title="(List[List[TreeMakers.this.TreeMaker]], List[PatMatVirtualiser.this.global.Tree])" class="delimiter">(</a>List<span class="delimiter">[</span>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">]</span>, List<span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> =
      <a href="../../../Tuple2.scala.html#63804" title="(_1: List[List[TreeMakers.this.TreeMaker]], _2: scala.collection.immutable.Nil.type)(List[List[TreeMakers.this.TreeMaker]], scala.collection.immutable.Nil.type)" class="delimiter">(</a><a href="#1138769" title="List[List[TreeMakers.this.TreeMaker]]">cases</a>, <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, cases: List[List[TreeMakers.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type, matchFailGenOverride: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])Option[PatMatVirtualiser.this.global.Tree]" id="1134790">emitSwitch</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1138783">scrut</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1138784">scrutSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="List[List[TreeMakers.this.TreeMaker]]" id="1138785">cases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[TreeMakers.this.TreeMaker]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Type" id="1138786">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>, <a title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]" id="1138787">matchFailGenOverride</a>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree =&gt; Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> =
      <a href="../../../Option.scala.html#2498" title="None.type">None</a>

    // for catch (no need to customize match failure)
    <span class="keyword">def</span> <a title="(bindersAndCases: List[(PatMatVirtualiser.this.global.Symbol, List[TreeMakers.this.TreeMaker])], pt: PatMatVirtualiser.this.global.Type)Option[List[PatMatVirtualiser.this.global.CaseDef]]" id="1134791">emitTypeSwitch</a><span class="delimiter">(</span><a title="List[(PatMatVirtualiser.this.global.Symbol, List[TreeMakers.this.TreeMaker])]" id="1135308">bindersAndCases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[(PatMatVirtualiser.this.global.Symbol, List[TreeMakers.this.TreeMaker])]">List</a><span class="delimiter">[</span><span class="delimiter">(</span>Symbol, List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Type" id="1135309">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[List[PatMatVirtualiser.this.global.CaseDef]]">Option</a><span class="delimiter">[</span>List<span class="delimiter">[</span>CaseDef<span class="delimiter">]</span><span class="delimiter">]</span> =
      <a href="../../../Option.scala.html#2498" title="None.type">None</a>

    <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class TreeMaker extends Object" id="1134792">TreeMaker</a> <a href="#1134792" title="TreeMakers.this.TreeMaker" class="delimiter">{</a>
      /** captures the scope and the value of the bindings in patterns
       * important *when* the substitution happens (can't accumulate and do at once after the full matcher has been constructed)
       */
      <span class="keyword">def</span> <a title="=&gt; TreeMakers.this.Substitution" id="1135096">substitution</a>: <a href="#1134784" title="TreeMakers.this.Substitution">Substitution</a> =
        <span title="TreeMakers.this.Substitution" class="keyword">if</span> <span class="delimiter">(</span><a href="#1135099" title="TreeMakers.this.Substitution">currSub</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#1135097" title="=&gt; TreeMakers.this.Substitution">localSubstitution</a>
        <span class="keyword">else</span> <a href="#1135099" title="TreeMakers.this.Substitution">currSub</a>

      <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; TreeMakers.this.Substitution" id="1135097">localSubstitution</a>: <a href="#1134784" title="TreeMakers.this.Substitution">Substitution</a>

      <span class="keyword">private</span><span class="delimiter">[</span>TreeMakers<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(outerSubst: TreeMakers.this.Substitution)Unit" id="1135098">incorporateOuterSubstitution</a><span class="delimiter">(</span><a title="TreeMakers.this.Substitution" id="1138790">outerSubst</a>: <a href="#1134784" title="TreeMakers.this.Substitution">Substitution</a><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#2389" title="Unit">Unit</a> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1135099" title="TreeMakers.this.Substitution">currSub</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;BUG: incorporateOuterSubstitution called more than once for &quot;)" class="string">&quot;BUG: incorporateOuterSubstitution called more than once for &quot;</span><a href="../../../Tuple3.scala.html#64156" title="(x$1: Any)String">+</a> <span class="delimiter">(</span><a href="#1134792" title="TreeMakers.this.TreeMaker" class="keyword">this</a>, <a href="#1135099" title="TreeMakers.this.Substitution">currSub</a>, <a href="#1138790" title="TreeMakers.this.Substitution">outerSubst</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Thread.type">Thread</span>.<span title="()Unit">dumpStack</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">else</span> <a href="#1135099" title="TreeMakers.this.Substitution">currSub</a> = <a href="#1138790" title="TreeMakers.this.Substitution">outerSubst</a> <a href="#1135273" title="(other: TreeMakers.this.Substitution)TreeMakers.this.Substitution">&gt;&gt;</a> <a href="#1135096" title="=&gt; TreeMakers.this.Substitution">substitution</a>
      <span class="delimiter">}</span>
      <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="TreeMakers.this.Substitution" id="1135099">currSub</a>: <a href="#1134784" title="TreeMakers.this.Substitution">Substitution</a> = <span title="Null(null)" class="keyword">null</span>

      // build Tree that chains `next` after the current extractor
      <span class="keyword">def</span> <a title="(next: PatMatVirtualiser.this.global.Tree)(casegen: TreeMakers.this.Casegen)PatMatVirtualiser.this.global.Tree" id="1135100">chainBefore</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1138803">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="TreeMakers.this.Casegen" id="1138804">casegen</a>: <a href="#1134722" title="TreeMakers.this.Casegen">Casegen</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
    <span class="delimiter">}</span>

    <span class="keyword">trait</span> <a title="trait NoNewBinders extends TreeMakers.this.TreeMaker" id="1134793">NoNewBinders</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#1134792" title="TreeMakers.this.TreeMaker">TreeMaker</a> <span class="delimiter">{</span>
      <span class="keyword">protected</span> <span class="keyword">val</span> <a title="TreeMakers.this.Substitution" id="1136367">localSubstitution</a>: <a href="#1134784" title="TreeMakers.this.Substitution">Substitution</a> = <a href="#1134785" title="TreeMakers.this.EmptySubstitution.type">EmptySubstitution</a>
    <span class="delimiter">}</span>

    case <span class="keyword">class</span> <a title="class TrivialTreeMaker extends TreeMakers.this.TreeMaker with TreeMakers.this.NoNewBinders with Product with Serializable" id="1140291">TrivialTreeMaker</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Tree" id="1139868">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134792" title="TreeMakers.this.TreeMaker">TreeMaker</a> <span class="keyword">with</span> <a href="#1134793" title="TreeMakers.this.NoNewBinders">NoNewBinders</a> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(next: PatMatVirtualiser.this.global.Tree)(casegen: TreeMakers.this.Casegen)PatMatVirtualiser.this.global.Tree" id="1138818">chainBefore</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1138823">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="TreeMakers.this.Casegen" id="1138824">casegen</a>: <a href="#1134722" title="TreeMakers.this.Casegen">Casegen</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="#1139868" title="=&gt; PatMatVirtualiser.this.global.Tree">tree</a>
    <span class="delimiter">}</span>

    case <span class="keyword">class</span> <a title="class BodyTreeMaker extends TreeMakers.this.TreeMaker with TreeMakers.this.NoNewBinders with Product with Serializable" id="1140316">BodyTreeMaker</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Tree" id="1136657">body</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Type" id="1136658">matchPt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134792" title="TreeMakers.this.TreeMaker">TreeMaker</a> <span class="keyword">with</span> <a href="#1134793" title="TreeMakers.this.NoNewBinders">NoNewBinders</a> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(next: PatMatVirtualiser.this.global.Tree)(casegen: TreeMakers.this.Casegen)PatMatVirtualiser.this.global.Tree" id="1136654">chainBefore</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1138871">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="TreeMakers.this.Casegen" id="1138872">casegen</a>: <a href="#1134722" title="TreeMakers.this.Casegen">Casegen</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = // assert(next eq EmptyTree)
        <a href="../../../reflect/internal/Positions.scala.html#441889" title="(pos: PatMatVirtualiser.this.global.Position)(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">atPos</a><span class="delimiter">(</span><a href="#1136657" title="=&gt; PatMatVirtualiser.this.global.Tree">body</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1138872" title="TreeMakers.this.Casegen">casegen</a>.<a href="#1138807" title="(res: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">one</a><span class="delimiter">(</span><a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">substitution</a><span class="delimiter">(</span><a href="#1136657" title="=&gt; PatMatVirtualiser.this.global.Tree">body</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> // since SubstOnly treemakers are dropped, need to do it here
    <span class="delimiter">}</span>

    case <span class="keyword">class</span> <a title="class SubstOnlyTreeMaker extends TreeMakers.this.TreeMaker with Product with Serializable" id="1140341">SubstOnlyTreeMaker</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Symbol" id="1136288">prevBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1136289">nextBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134792" title="TreeMakers.this.TreeMaker">TreeMaker</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="TreeMakers.this.Substitution" id="1136283">localSubstitution</a> = <a href="#1137874" title="(from: PatMatVirtualiser.this.global.Symbol, to: PatMatVirtualiser.this.global.Tree)TreeMakers.this.Substitution">Substitution</a><span class="delimiter">(</span><a href="#1136288" title="=&gt; PatMatVirtualiser.this.global.Symbol">prevBinder</a>, <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1136289" title="=&gt; PatMatVirtualiser.this.global.Symbol">nextBinder</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(next: PatMatVirtualiser.this.global.Tree)(casegen: TreeMakers.this.Casegen)PatMatVirtualiser.this.global.Tree" id="1136285">chainBefore</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1138944">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="TreeMakers.this.Casegen" id="1138945">casegen</a>: <a href="#1134722" title="TreeMakers.this.Casegen">Casegen</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">substitution</a><span class="delimiter">(</span><a href="#1138944" title="PatMatVirtualiser.this.global.Tree">next</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class FunTreeMaker extends TreeMakers.this.TreeMaker" id="1134803">FunTreeMaker</a> <a href="#1134803" title="TreeMakers.this.FunTreeMaker" class="keyword">extends</a> <a href="#1134792" title="TreeMakers.this.TreeMaker">TreeMaker</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="=&gt; PatMatVirtualiser.this.global.Symbol" id="1135958">nextBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>
    <span class="delimiter">}</span>

    <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class CondTreeMaker extends TreeMakers.this.FunTreeMaker" id="1134804">CondTreeMaker</a> <a href="#1134804" title="TreeMakers.this.CondTreeMaker" class="keyword">extends</a> <a href="#1134803" title="TreeMakers.this.FunTreeMaker">FunTreeMaker</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="=&gt; PatMatVirtualiser.this.global.Position" id="1135960">pos</a>: <a href="../util/Position.scala.html#52230" title="PatMatVirtualiser.this.global.Position">Position</a>
      <span class="keyword">val</span> <a title="=&gt; PatMatVirtualiser.this.global.Symbol" id="1135961">prevBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>
      <span class="keyword">val</span> <a title="=&gt; PatMatVirtualiser.this.global.Type" id="1135962">nextBinderTp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>
      <span class="keyword">val</span> <a title="=&gt; PatMatVirtualiser.this.global.Tree" id="1135963">cond</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
      <span class="keyword">val</span> <a title="=&gt; PatMatVirtualiser.this.global.Tree" id="1135964">res</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>

      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermSymbol" id="1135966">nextBinder</a> = <a href="#1134720" title="(pos: PatMatVirtualiser.this.global.Position, tp: PatMatVirtualiser.this.global.Type, prefix: String)PatMatVirtualiser.this.global.TermSymbol">freshSym</a><span class="delimiter">(</span><a href="#1135960" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a>, <a href="#1135962" title="=&gt; PatMatVirtualiser.this.global.Type">nextBinderTp</a><span class="delimiter">)</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="TreeMakers.this.Substitution" id="1135968">localSubstitution</a> = <a href="#1137875" title="(from: List[PatMatVirtualiser.this.global.Symbol], to: List[PatMatVirtualiser.this.global.Tree])TreeMakers.this.Substitution">Substitution</a><span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.Symbol*)List[PatMatVirtualiser.this.global.Symbol]">List</a><span class="delimiter">(</span><a href="#1135961" title="=&gt; PatMatVirtualiser.this.global.Symbol">prevBinder</a><span class="delimiter">)</span>, <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.gen.global.Tree*)List[PatMatVirtualiser.this.global.gen.global.Tree]">List</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1135965" title="=&gt; PatMatVirtualiser.this.global.TermSymbol">nextBinder</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(next: PatMatVirtualiser.this.global.Tree)(casegen: TreeMakers.this.Casegen)PatMatVirtualiser.this.global.Tree" id="1135969">chainBefore</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1139019">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="TreeMakers.this.Casegen" id="1139020">casegen</a>: <a href="#1134722" title="TreeMakers.this.Casegen">Casegen</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> =
        <a href="../../../reflect/internal/Positions.scala.html#441889" title="(pos: PatMatVirtualiser.this.global.Position)(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">atPos</a><span class="delimiter">(</span><a href="#1135960" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1139020" title="TreeMakers.this.Casegen">casegen</a>.<a href="#1138809" title="(cond: PatMatVirtualiser.this.global.Tree, res: PatMatVirtualiser.this.global.Tree, nextBinder: PatMatVirtualiser.this.global.Symbol, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">flatMapCond</a><span class="delimiter">(</span><a href="#1135963" title="=&gt; PatMatVirtualiser.this.global.Tree">cond</a>, <a href="#1135964" title="=&gt; PatMatVirtualiser.this.global.Tree">res</a>, <a href="#1135965" title="=&gt; PatMatVirtualiser.this.global.TermSymbol">nextBinder</a>, <a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">substitution</a><span class="delimiter">(</span><a href="#1139019" title="PatMatVirtualiser.this.global.Tree">next</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    /**
     * Make a TreeMaker that will result in an extractor call specified by `extractor`
     * the next TreeMaker (here, we don't know which it'll be) is chained after this one by flatMap'ing
     * a function with binder `nextBinder` over our extractor's result
     * the function's body is determined by the next TreeMaker
     * in this function's body, and all the subsequent ones, references to the symbols in `from` will be replaced by the corresponding tree in `to`
     */
    case <span class="keyword">class</span> <a title="class ExtractorTreeMaker extends TreeMakers.this.FunTreeMaker with Product with Serializable" id="1140372">ExtractorTreeMaker</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Tree" id="1138074">extractor</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="Option[PatMatVirtualiser.this.global.Tree]" id="1138075">extraCond</a>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Symbol" id="1138076">nextBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="TreeMakers.this.Substitution" id="1138077">localSubstitution</a>: <a href="#1134784" title="TreeMakers.this.Substitution">Substitution</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="Boolean" id="1138078">extractorReturnsBoolean</a>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134803" title="TreeMakers.this.FunTreeMaker">FunTreeMaker</a> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(next: PatMatVirtualiser.this.global.Tree)(casegen: TreeMakers.this.Casegen)PatMatVirtualiser.this.global.Tree" id="1138070">chainBefore</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1139044">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="TreeMakers.this.Casegen" id="1139045">casegen</a>: <a href="#1134722" title="TreeMakers.this.Casegen">Casegen</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1139047">condAndNext</a> = <a href="#1138075" title="=&gt; Option[PatMatVirtualiser.this.global.Tree]">extraCond</a> <a href="../../../Option.scala.html#63820" title="(f: PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree)Option[PatMatVirtualiser.this.global.Tree]">map</a> <span class="delimiter">(</span><a href="#1139045" title="TreeMakers.this.Casegen">casegen</a>.<a href="#1138811" title="(c: PatMatVirtualiser.this.global.Tree, then: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">ifThenElseZero</a><span class="delimiter">(</span><a href="#1139052" title="PatMatVirtualiser.this.global.Tree">_</a>, <a href="#1139044" title="PatMatVirtualiser.this.global.Tree">next</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../Option.scala.html#63814" title="(default: =&gt; PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">getOrElse</a> <a href="#1139044" title="PatMatVirtualiser.this.global.Tree">next</a>
        <a href="../../../reflect/internal/Positions.scala.html#441889" title="(pos: PatMatVirtualiser.this.global.Position)(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">atPos</a><span class="delimiter">(</span><a href="#1138074" title="=&gt; PatMatVirtualiser.this.global.Tree">extractor</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span>
          <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1138078" title="Boolean">extractorReturnsBoolean</a><span class="delimiter">)</span> <a href="#1139045" title="TreeMakers.this.Casegen">casegen</a>.<a href="#1138809" title="(cond: PatMatVirtualiser.this.global.Tree, res: PatMatVirtualiser.this.global.Tree, nextBinder: PatMatVirtualiser.this.global.Symbol, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">flatMapCond</a><span class="delimiter">(</span><a href="#1138074" title="=&gt; PatMatVirtualiser.this.global.Tree">extractor</a>, <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653592" title="=&gt; PatMatVirtualiser.this.global.Literal">UNIT</a>, <a href="#1138076" title="=&gt; PatMatVirtualiser.this.global.Symbol">nextBinder</a>, <a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">substitution</a><span class="delimiter">(</span><a href="#1139047" title="PatMatVirtualiser.this.global.Tree">condAndNext</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">else</span> <a href="#1139045" title="TreeMakers.this.Casegen">casegen</a>.<a href="#1138808" title="(prev: PatMatVirtualiser.this.global.Tree, b: PatMatVirtualiser.this.global.Symbol, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">flatMap</a><span class="delimiter">(</span><a href="#1138074" title="=&gt; PatMatVirtualiser.this.global.Tree">extractor</a>, <a href="#1138076" title="=&gt; PatMatVirtualiser.this.global.Symbol">nextBinder</a>, <a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">substitution</a><span class="delimiter">(</span><a href="#1139047" title="PatMatVirtualiser.this.global.Tree">condAndNext</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1138071">toString</a> = <span title="String(&quot;X&quot;)" class="string">&quot;X&quot;</span><a href="../../../Tuple2.scala.html#63804" title="(x$1: Any)String">+</a><span class="delimiter">(</span><a href="#1138074" title="=&gt; PatMatVirtualiser.this.global.Tree">extractor</a>, <a href="#1138076" title="=&gt; PatMatVirtualiser.this.global.Symbol">nextBinder</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    // TODO: allow user-defined unapplyProduct
    case <span class="keyword">class</span> <a title="class ProductExtractorTreeMaker extends TreeMakers.this.TreeMaker with Product with Serializable" id="1140400">ProductExtractorTreeMaker</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Symbol" id="1137861">prevBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="Option[PatMatVirtualiser.this.global.Tree]" id="1137862">extraCond</a>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span>, <a title="TreeMakers.this.Substitution" id="1137863">localSubstitution</a>: <a href="#1134784" title="TreeMakers.this.Substitution">Substitution</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134792" title="TreeMakers.this.TreeMaker">TreeMaker</a> <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._
      <span class="keyword">def</span> <a title="(next: PatMatVirtualiser.this.global.Tree)(casegen: TreeMakers.this.Casegen)PatMatVirtualiser.this.global.Tree" id="1137857">chainBefore</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1139170">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="TreeMakers.this.Casegen" id="1139171">casegen</a>: <a href="#1134722" title="TreeMakers.this.Casegen">Casegen</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Apply" id="1139173">nullCheck</a> = <a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods" class="delimiter">(</a><a href="#1137861" title="=&gt; PatMatVirtualiser.this.global.Symbol">prevBinder</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#691693" title="(other: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Apply">OBJ_NE</a> <a href="../ast/TreeDSL.scala.html#653591" title="=&gt; PatMatVirtualiser.this.global.Literal">NULL</a>
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1139174">cond</a> = <a href="#1137862" title="=&gt; Option[PatMatVirtualiser.this.global.Tree]">extraCond</a> <a href="../../../Option.scala.html#63820" title="(f: PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree)Option[PatMatVirtualiser.this.global.Tree]">map</a> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods">nullCheck</a> <a href="../ast/TreeDSL.scala.html#691685" title="(other: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">AND</a> <a href="#1139187" title="PatMatVirtualiser.this.global.Tree">_</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#63814" title="(default: =&gt; PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">getOrElse</a> <a href="#1139173" title="PatMatVirtualiser.this.global.Apply">nullCheck</a>
        <a href="#1139171" title="TreeMakers.this.Casegen">casegen</a>.<a href="#1138811" title="(c: PatMatVirtualiser.this.global.Tree, then: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">ifThenElseZero</a><span class="delimiter">(</span><a href="#1139174" title="PatMatVirtualiser.this.global.Tree">cond</a>, <a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">substitution</a><span class="delimiter">(</span><a href="#1139170" title="PatMatVirtualiser.this.global.Tree">next</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1137858">toString</a> = <span title="String(&quot;P&quot;)" class="string">&quot;P&quot;</span><a href="../../../Tuple3.scala.html#64156" title="(x$1: Any)String">+</a><span class="delimiter">(</span><a href="#1137861" title="=&gt; PatMatVirtualiser.this.global.Symbol">prevBinder</a>,  <a href="#1137862" title="=&gt; Option[PatMatVirtualiser.this.global.Tree]">extraCond</a> <a href="../../../Option.scala.html#63814" title="(default: =&gt; Object)Object">getOrElse</a> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a href="#1137863" title="=&gt; TreeMakers.this.Substitution">localSubstitution</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    // tack an outer test onto `cond` if binder.info and expectedType warrant it
    <span class="keyword">def</span> <a title="(binder: PatMatVirtualiser.this.global.Symbol, expectedTp: PatMatVirtualiser.this.global.Type)(cond: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1134811">maybeWithOuterCheck</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1139284">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1139285">expectedTp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1139286">cond</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._
      <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span>   <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><span class="delimiter">(</span><span class="delimiter">(</span><a href="#1139285" title="PatMatVirtualiser.this.global.Type">expectedTp</a>.<a href="../../../reflect/internal/Types.scala.html#441997" title="=&gt; PatMatVirtualiser.this.global.Type">prefix</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../reflect/internal/Types.scala.html#441258" title="PatMatVirtualiser.this.global.NoPrefix.type">NoPrefix</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="#1139285" title="PatMatVirtualiser.this.global.Type">expectedTp</a>.<a href="../../../reflect/internal/Types.scala.html#441997" title="=&gt; PatMatVirtualiser.this.global.Type">prefix</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; PatMatVirtualiser.this.global.Symbol">typeSymbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443287" title="=&gt; Boolean">isPackageClass</a><span class="delimiter">)</span>
          <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../reflect/internal/Types.scala.html#441488" title="(patType: PatMatVirtualiser.this.global.Type, selType: PatMatVirtualiser.this.global.Type, currentOwner: PatMatVirtualiser.this.global.Symbol)Boolean">needsOuterTest</a><span class="delimiter">(</span><a href="#1139285" title="PatMatVirtualiser.this.global.Type">expectedTp</a>, <a href="#1139284" title="PatMatVirtualiser.this.global.Symbol">binder</a>.<a href="../../../reflect/internal/Symbols.scala.html#443427" title="=&gt; PatMatVirtualiser.this.global.Type">info</a>, <a href="#1134691" title="=&gt; PatMatVirtualiser.this.global.Symbol">matchOwner</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.gen.global.Tree" id="1139294">expectedPrefix</a> = <a href="#1139285" title="PatMatVirtualiser.this.global.Type">expectedTp</a>.<a href="../../../reflect/internal/Types.scala.html#441997" title="=&gt; PatMatVirtualiser.this.global.Type">prefix</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> ThisType<a href="#1139305" title="PatMatVirtualiser.this.global.gen.global.Tree" id="1139307" class="delimiter">(</a>clazz<span class="delimiter">)</span>  =&gt; <a href="../ast/TreeDSL.scala.html#653641" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">THIS</a><a href="#1139308" title="(x: PatMatVirtualiser.this.global.gen.global.Tree)PatMatVirtualiser.this.global.gen.global.Tree" class="delimiter">(</a>clazz<span class="delimiter">)</span>
          <span class="keyword">case</span> pre              =&gt; <a href="../ast/TreeDSL.scala.html#653644" title="(pre: PatMatVirtualiser.this.global.Type, sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><a href="#1139308" title="(x: PatMatVirtualiser.this.global.gen.global.Tree)PatMatVirtualiser.this.global.gen.global.Tree" class="delimiter">(</a>pre.<a href="../../../reflect/internal/Types.scala.html#441997" title="=&gt; PatMatVirtualiser.this.global.Type">prefix</a>, pre.<a href="../../../reflect/internal/Types.scala.html#441985" title="=&gt; PatMatVirtualiser.this.global.Symbol">termSymbol</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        // ExplicitOuter replaces `Select(q, outerSym) OBJ_EQ expectedPrefix` by `Select(q, outerAccessor(outerSym.owner)) OBJ_EQ expectedPrefix`
        // if there's an outer accessor, otherwise the condition becomes `true` -- TODO: can we improve needsOuterTest so there's always an outerAccessor?
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.MethodSymbol" id="1139295">outer</a> = <a href="#1139285" title="PatMatVirtualiser.this.global.Type">expectedTp</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="PatMatVirtualiser.this.global.Symbol" id="1139320">typeSymbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#453573" title="PatMatVirtualiser.this.global.Position" id="1139323">newMethod</a><span class="delimiter">(</span><a href="#560231" title="PatMatVirtualiser.this.vpmName.type">vpmName</a>.<a href="#1134624" title="PatMatVirtualiser.this.global.TermName" id="1139321">outer</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Symbols.scala.html#443429" title="(info: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.MethodSymbol">setInfo</a> <a href="#1139285" title="PatMatVirtualiser.this.global.Type">expectedTp</a>.<a href="../../../reflect/internal/Types.scala.html#441997" title="=&gt; PatMatVirtualiser.this.global.Type">prefix</a> <a href="../../../reflect/internal/Symbols.scala.html#443305" title="(mask: Long)PatMatVirtualiser.this.global.MethodSymbol">setFlag</a> <span title="Long(2097152L)">SYNTHETIC</span>
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Apply" id="1139296">outerCheck</a> = <span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#441840" title="(qualifier: PatMatVirtualiser.this.global.Tree, sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Select">Select</a><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods" class="delimiter">(</a><a href="#1134723" title="=&gt; TreeMakers.this.AbsCodegen">codegen</a>.<a href="#1137191" title="(b: PatMatVirtualiser.this.global.Symbol, tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree">_asInstanceOf</a><span class="delimiter">(</span><a href="#1139284" title="PatMatVirtualiser.this.global.Symbol">binder</a>, <a href="#1139285" title="PatMatVirtualiser.this.global.Type">expectedTp</a><span class="delimiter">)</span>, <a href="#1139295" title="PatMatVirtualiser.this.global.MethodSymbol">outer</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#691692" title="(other: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Apply">OBJ_EQ</a> <a href="#1139294" title="PatMatVirtualiser.this.global.gen.global.Tree">expectedPrefix</a>

        // first check cond, since that should ensure we're not selecting outer on null
        <a href="#1134723" title="=&gt; TreeMakers.this.AbsCodegen">codegen</a>.<a href="#1137194" title="(a: PatMatVirtualiser.this.global.Tree, b: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">and</a><span class="delimiter">(</span><a href="#1139286" title="PatMatVirtualiser.this.global.Tree">cond</a>, <a href="#1139296" title="PatMatVirtualiser.this.global.Apply">outerCheck</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">else</span>
        <a href="#1139286" title="PatMatVirtualiser.this.global.Tree">cond</a>
    <span class="delimiter">}</span>

    // containsUnchecked: also need to test when erasing pt loses crucial information (maybe we can recover it using a TypeTag)
    <span class="keyword">def</span> <a title="(tp: PatMatVirtualiser.this.global.Type, pt: PatMatVirtualiser.this.global.Type)Boolean" id="1134812">needsTypeTest</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Type" id="1135949">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>, <a title="PatMatVirtualiser.this.global.Type" id="1135950">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><span class="delimiter">(</span><a href="#1135949" title="PatMatVirtualiser.this.global.Type">tp</a> <a href="../../../reflect/internal/Types.scala.html#442058" title="(that: PatMatVirtualiser.this.global.Type)Boolean">&lt;:&lt;</a> <a href="#1135950" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span> // || containsUnchecked(pt)
    // TODO: try to find the TypeTag for the binder's type and the expected type, and if they exists,
    // check that the TypeTag of the binder's type conforms to the TypeTag of the expected type
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(binderToTest: PatMatVirtualiser.this.global.Symbol, expectedTp: PatMatVirtualiser.this.global.Type, disableOuterCheck: Boolean, dynamic: Boolean)PatMatVirtualiser.this.global.Tree" id="1134813">typeTest</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1139357">binderToTest</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1139358">expectedTp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>, <a title="Boolean" id="1139362">disableOuterCheck</a>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span title="Boolean(false)" class="keyword">false</span>, <a title="Boolean" id="1139363">dynamic</a>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._
      // def coreTest =
      <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1139362" title="Boolean">disableOuterCheck</a><span class="delimiter">)</span> <a href="#1134723" title="=&gt; TreeMakers.this.AbsCodegen">codegen</a>.<a href="#1137193" title="(b: PatMatVirtualiser.this.global.Symbol, tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree">_isInstanceOf</a><span class="delimiter">(</span><a href="#1139357" title="PatMatVirtualiser.this.global.Symbol">binderToTest</a>, <a href="#1139358" title="PatMatVirtualiser.this.global.Type">expectedTp</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#1134811" title="(binder: PatMatVirtualiser.this.global.Symbol, expectedTp: PatMatVirtualiser.this.global.Type)(cond: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">maybeWithOuterCheck</a><span class="delimiter">(</span><a href="#1139357" title="PatMatVirtualiser.this.global.Symbol">binderToTest</a>, <a href="#1139358" title="PatMatVirtualiser.this.global.Type">expectedTp</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1134723" title="=&gt; TreeMakers.this.AbsCodegen">codegen</a>.<a href="#1137193" title="(b: PatMatVirtualiser.this.global.Symbol, tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree">_isInstanceOf</a><span class="delimiter">(</span><a href="#1139357" title="PatMatVirtualiser.this.global.Symbol">binderToTest</a>, <a href="#1139358" title="PatMatVirtualiser.this.global.Type">expectedTp</a><span class="delimiter">)</span><span class="delimiter">)</span>
      // [Eugene to Adriaan] use `resolveErasureTag` instead of `findManifest`. please, provide a meaningful position
      // if (opt.experimental &amp;&amp; containsUnchecked(expectedTp)) {
      //   if (dynamic) {
      //     val expectedTpTagTree = findManifest(expectedTp, true)
      //     if (!expectedTpTagTree.isEmpty)
      //       ((expectedTpTagTree DOT &quot;erasure&quot;.toTermName) DOT &quot;isAssignableFrom&quot;.toTermName)(REF(binderToTest) DOT nme.getClass_)
      //     else
      //       coreTest
      //   } else {
      //     val expectedTpTagTree = findManifest(expectedTp, true)
      //     val binderTpTagTree   = findManifest(binderToTest.info, true)
      //     if(!(expectedTpTagTree.isEmpty || binderTpTagTree.isEmpty))
      //       coreTest AND (binderTpTagTree DOT nme.CONFORMS)(expectedTpTagTree)
      //     else
      //       coreTest
      //   }
      // } else coreTest
    <span class="delimiter">}</span>

    // need to substitute since binder may be used outside of the next extractor call (say, in the body of the case)
    case <span class="keyword">class</span> <a title="class TypeTestTreeMaker extends TreeMakers.this.CondTreeMaker with Product with Serializable" id="1140428">TypeTestTreeMaker</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Symbol" id="1135987">prevBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1135988">nextBinderTp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>, <a title="PatMatVirtualiser.this.global.Position" id="1135989">pos</a>: <a href="../util/Position.scala.html#52230" title="PatMatVirtualiser.this.global.Position">Position</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134804" title="TreeMakers.this.CondTreeMaker">CondTreeMaker</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1135980">cond</a> = <a href="#1139362" title="Boolean" id="1139376">typeTest</a><span class="delimiter">(</span><a href="#1135987" title="PatMatVirtualiser.this.global.Symbol" id="1139373">prevBinder</a>, <a href="#1135988" title="PatMatVirtualiser.this.global.Type" id="1139374">nextBinderTp</a>, dynamic = <a title="Boolean(true)" id="1139375" class="keyword">true</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1135982">res</a>  = <a href="#1134723" title="=&gt; TreeMakers.this.AbsCodegen">codegen</a>.<a href="#1137191" title="(b: PatMatVirtualiser.this.global.Symbol, tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree">_asInstanceOf</a><span class="delimiter">(</span><a href="#1135987" title="=&gt; PatMatVirtualiser.this.global.Symbol">prevBinder</a>, <a href="#1135988" title="=&gt; PatMatVirtualiser.this.global.Type">nextBinderTp</a><span class="delimiter">)</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1135984">toString</a> = <span title="String(&quot;TT&quot;)" class="string">&quot;TT&quot;</span><a href="../../../Tuple2.scala.html#63804" title="(x$1: Any)String">+</a><span class="delimiter">(</span><a href="#1135987" title="=&gt; PatMatVirtualiser.this.global.Symbol">prevBinder</a>, <a href="#1135988" title="=&gt; PatMatVirtualiser.this.global.Type">nextBinderTp</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    // implements the run-time aspects of (8.2) (typedPattern has already done the necessary type transformations)
    // TODO: normalize construction, which yields a combination of a EqualityTestTreeMaker (when necessary) and a TypeTestTreeMaker
    case <span class="keyword">class</span> <a title="class TypeAndEqualityTestTreeMaker extends TreeMakers.this.CondTreeMaker with Product with Serializable" id="1140459">TypeAndEqualityTestTreeMaker</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Symbol" id="1136252">prevBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1136253">patBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1136254">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>, <a title="PatMatVirtualiser.this.global.Position" id="1136255">pos</a>: <a href="../util/Position.scala.html#52230" title="PatMatVirtualiser.this.global.Position">Position</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134804" title="TreeMakers.this.CondTreeMaker">CondTreeMaker</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Type" id="1136241">nextBinderTp</a> = <a href="../../../reflect/internal/Types.scala.html#441568" title="(ts: List[PatMatVirtualiser.this.global.Type])PatMatVirtualiser.this.global.Type">glb</a><span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.Type*)List[PatMatVirtualiser.this.global.Type]">List</a><span class="delimiter">(</span><a href="#1136253" title="=&gt; PatMatVirtualiser.this.global.Symbol">patBinder</a>.<a href="../../../reflect/internal/Symbols.scala.html#443427" title="=&gt; PatMatVirtualiser.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#441990" title="=&gt; PatMatVirtualiser.this.global.Type">widen</a>, <a href="#1136254" title="=&gt; PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span><span class="delimiter">)</span>

      /** Type patterns consist of types, type variables, and wildcards. A type pattern T is of one of the following forms:
          - A reference to a class C, p.C, or T#C.
            This type pattern matches any non-null instance of the given class.
            Note that the prefix of the class, if it is given, is relevant for determining class instances.
            For instance, the pattern p.C matches only instances of classes C which were created with the path p as prefix.
            The bottom types scala.Nothing and scala.Null cannot be used as type patterns, because they would match nothing in any case.

          - A singleton type p.type.
            This type pattern matches only the value denoted by the path p
            (that is, a pattern match involved a comparison of the matched value with p using method eq in class AnyRef). // TODO: the actual pattern matcher uses ==, so that's what I'm using for now
            // https://issues.scala-lang.org/browse/SI-4577 &quot;pattern matcher, still disappointing us at equality time&quot;

          - A compound type pattern T1 with ... with Tn where each Ti is a type pat- tern.
            This type pattern matches all values that are matched by each of the type patterns Ti.

          - A parameterized type pattern T[a1,...,an], where the ai are type variable patterns or wildcards _.
            This type pattern matches all values which match T for some arbitrary instantiation of the type variables and wildcards.
            The bounds or alias type of these type variable are determined as described in (8.3).

          - A parameterized type pattern scala.Array[T1], where T1 is a type pattern. // TODO
            This type pattern matches any non-null instance of type scala.Array[U1], where U1 is a type matched by T1.
      **/

      // generate the tree for the run-time test that follows from the fact that
      // a `scrut` of known type `scrutTp` is expected to have type `expectedTp`
      // uses maybeWithOuterCheck to check the type's prefix
      <span class="keyword">private</span> <span class="keyword">def</span> <a title="(patBinder: PatMatVirtualiser.this.global.Symbol, pt: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree" id="1136243">typeAndEqualityTest</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1139464">patBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1139465">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._
         // TODO: `null match { x : T }` will yield a check that (indirectly) tests whether `null ne null`
         // don't bother (so that we don't end up with the warning &quot;comparing values of types Null and Null using `ne' will always yield false&quot;)
        <span class="keyword">def</span> <a title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree" id="1139472">genEqualsAndInstanceOf</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1139476">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
          = <a href="#1134723" title="=&gt; TreeMakers.this.AbsCodegen">codegen</a>.<a href="#1137192" title="(checker: PatMatVirtualiser.this.global.Tree, binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">_equals</a><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods" class="delimiter">(</a><a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1139476" title="PatMatVirtualiser.this.global.Symbol">sym</a><span class="delimiter">)</span>, <a href="#1139464" title="PatMatVirtualiser.this.global.Symbol">patBinder</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#691685" title="(other: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">AND</a> <a href="#1134813" title="(binderToTest: PatMatVirtualiser.this.global.Symbol, expectedTp: PatMatVirtualiser.this.global.Type, disableOuterCheck: Boolean, dynamic: Boolean)PatMatVirtualiser.this.global.Tree">typeTest</a><span class="delimiter">(</span><a href="#1139464" title="PatMatVirtualiser.this.global.Symbol">patBinder</a>, <a href="#1139465" title="PatMatVirtualiser.this.global.Type">pt</a>.<a href="../../../reflect/internal/Types.scala.html#441990" title="=&gt; PatMatVirtualiser.this.global.Type">widen</a>, disableOuterCheck = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

        <span class="keyword">def</span> <a title="(tp: PatMatVirtualiser.this.global.Type)Boolean" id="1139473">isRefTp</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Type" id="1139488">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span> = <a href="#1139488" title="PatMatVirtualiser.this.global.Type">tp</a> <a href="../../../reflect/internal/Types.scala.html#442058" title="(that: PatMatVirtualiser.this.global.Type)Boolean">&lt;:&lt;</a> <a href="../../../reflect/internal/Definitions.scala.html#442177" title="=&gt; PatMatVirtualiser.this.global.AliasTypeSymbol">AnyRefClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>

        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Type" id="1139474">patBinderTp</a> = <a href="#1139464" title="PatMatVirtualiser.this.global.Symbol">patBinder</a>.<a href="../../../reflect/internal/Symbols.scala.html#443427" title="=&gt; PatMatVirtualiser.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#441990" title="=&gt; PatMatVirtualiser.this.global.Type">widen</a>
        <span class="keyword">def</span> <a title="=&gt; Boolean" id="1139475">isMatchUnlessNull</a> = <a href="#1139473" title="(tp: PatMatVirtualiser.this.global.Type)Boolean">isRefTp</a><span class="delimiter">(</span><a href="#1139465" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1134812" title="(tp: PatMatVirtualiser.this.global.Type, pt: PatMatVirtualiser.this.global.Type)Boolean">needsTypeTest</a><span class="delimiter">(</span><a href="#1139474" title="PatMatVirtualiser.this.global.Type">patBinderTp</a>, <a href="#1139465" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span>

        // TODO: [SPEC] type test for Array
        // TODO: use TypeTags to improve tests (for erased types we can do better when we have a TypeTag)
        <a href="#1139465" title="PatMatVirtualiser.this.global.Type">pt</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> SingleType<a href="#1139536" title="PatMatVirtualiser.this.global.Tree" id="1139539" class="delimiter">(</a>_, sym<span class="delimiter">)</span> /*this implies sym.isStable*/ =&gt; <a href="#1139472" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">genEqualsAndInstanceOf</a><a href="#1139555" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a>sym<span class="delimiter">)</span> // TODO: [SPEC] the spec requires `eq` instead of `==` here
            <span class="keyword">case</span> ThisType<a href="#1139536" title="Boolean" id="1139541" class="delimiter">(</a>sym<span class="delimiter">)</span> <span class="keyword">if</span> sym.<a href="../../../reflect/internal/Symbols.scala.html#443270" title="=&gt; Boolean">isModule</a>                    =&gt; <a href="#1139472" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">genEqualsAndInstanceOf</a><a href="#1139555" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a>sym<span class="delimiter">)</span> // must use == to support e.g. List() == Nil
            <span class="keyword">case</span> ThisType<span class="delimiter">(</span>sym<span class="delimiter">)</span>                                    =&gt; <a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods" class="delimiter">(</a><a href="#1139464" title="PatMatVirtualiser.this.global.Symbol">patBinder</a><span class="delimiter">)</span> <a href="#1139555" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">OBJ_EQ</a> <a href="../../../reflect/internal/Trees.scala.html#441838" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">This</a><span class="delimiter">(</span>sym<span class="delimiter">)</span>
            <span class="keyword">case</span> ConstantType<a href="#1139536" title="Boolean" id="1139546" class="delimiter">(</a>Constant<span class="delimiter">(</span><a href="#1139561" title="PatMatVirtualiser.this.global.Tree" id="1139552" class="keyword">null</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#1139473" title="(tp: PatMatVirtualiser.this.global.Type)Boolean">isRefTp</a><span class="delimiter">(</span><a href="#1139474" title="PatMatVirtualiser.this.global.Type">patBinderTp</a><span class="delimiter">)</span> =&gt; <a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods" class="delimiter">(</a><a href="#1139464" title="PatMatVirtualiser.this.global.Symbol">patBinder</a><span class="delimiter">)</span> <a href="#1139555" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">OBJ_EQ</a> <a href="../ast/TreeDSL.scala.html#653591" title="=&gt; PatMatVirtualiser.this.global.Literal">NULL</a>
            <span class="keyword">case</span> ConstantType<span class="delimiter">(</span>const<span class="delimiter">)</span>                              =&gt; <a href="#1134723" title="=&gt; TreeMakers.this.AbsCodegen">codegen</a>.<a href="#1137192" title="(checker: PatMatVirtualiser.this.global.Tree, binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">_equals</a><a href="#1139555" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="../../../reflect/api/Trees.scala.html#432792" title="(value: PatMatVirtualiser.this.global.Constant)PatMatVirtualiser.this.global.Literal">Literal</a><span class="delimiter">(</span>const<span class="delimiter">)</span>, <a href="#1139464" title="PatMatVirtualiser.this.global.Symbol">patBinder</a><span class="delimiter">)</span>
            <span class="keyword">case</span> _ <span class="keyword">if</span> <a href="#1139475" title="=&gt; Boolean">isMatchUnlessNull</a>                           =&gt; <a href="#1134811" title="(binder: PatMatVirtualiser.this.global.Symbol, expectedTp: PatMatVirtualiser.this.global.Type)(cond: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">maybeWithOuterCheck</a><span class="delimiter">(</span><a href="#1139464" title="PatMatVirtualiser.this.global.Symbol">patBinder</a>, <a href="#1139465" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span><a href="#1139555" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods" class="delimiter">(</a><a href="#1139464" title="PatMatVirtualiser.this.global.Symbol">patBinder</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#691693" title="(other: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Apply">OBJ_NE</a> <a href="../ast/TreeDSL.scala.html#653591" title="=&gt; PatMatVirtualiser.this.global.Literal">NULL</a><span class="delimiter">)</span>
            <span class="keyword">case</span> _                                                =&gt; <a href="#1134813" title="(binderToTest: PatMatVirtualiser.this.global.Symbol, expectedTp: PatMatVirtualiser.this.global.Type, disableOuterCheck: Boolean, dynamic: Boolean)PatMatVirtualiser.this.global.Tree">typeTest</a><a href="#1139555" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="#1139464" title="PatMatVirtualiser.this.global.Symbol">patBinder</a>, <a href="#1139465" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1136244">cond</a> = <a href="#1136243" title="(patBinder: PatMatVirtualiser.this.global.Symbol, pt: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree">typeAndEqualityTest</a><span class="delimiter">(</span><a href="#1136253" title="=&gt; PatMatVirtualiser.this.global.Symbol">patBinder</a>, <a href="#1136254" title="=&gt; PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1136246">res</a>  = <a href="#1134723" title="=&gt; TreeMakers.this.AbsCodegen">codegen</a>.<a href="#1137191" title="(b: PatMatVirtualiser.this.global.Symbol, tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree">_asInstanceOf</a><span class="delimiter">(</span><a href="#1136253" title="=&gt; PatMatVirtualiser.this.global.Symbol">patBinder</a>, <a href="#1136241" title="=&gt; PatMatVirtualiser.this.global.Type">nextBinderTp</a><span class="delimiter">)</span>

      // TODO: remove this
      <span class="keyword">def</span> <a title="=&gt; Boolean" id="1136248">isStraightTypeTest</a> = <a href="#1136244" title="=&gt; PatMatVirtualiser.this.global.Tree">cond</a> <span class="keyword">match</span> <span class="delimiter">{</span> <span class="keyword">case</span> TypeApply<a href="#1139579" title="Boolean" id="1139583" class="delimiter">(</a>_, _<span class="delimiter">)</span> =&gt; <a href="#1136244" title="=&gt; PatMatVirtualiser.this.global.Tree">cond</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a> <a href="#1139584" title="(x: Boolean)Boolean">==</a> <a href="../../../reflect/internal/Definitions.scala.html#442553" title="=&gt; PatMatVirtualiser.this.global.MethodSymbol">Any_isInstanceOf</a> <span class="keyword">case</span> _ =&gt; <a href="#1139584" title="(x: Boolean)Boolean" class="keyword">false</a> <span class="delimiter">}</span>

      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1136249">toString</a> = <span title="String(&quot;TET&quot;)" class="string">&quot;TET&quot;</span><a href="../../../Tuple2.scala.html#63804" title="(x$1: Any)String">+</a><span class="delimiter">(</span><a href="#1136253" title="=&gt; PatMatVirtualiser.this.global.Symbol">patBinder</a>, <a href="#1136254" title="=&gt; PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    // need to substitute to deal with existential types -- TODO: deal with existentials better, don't substitute (see RichClass during quick.comp)
    case <span class="keyword">class</span> <a title="class EqualityTestTreeMaker extends TreeMakers.this.CondTreeMaker with Product with Serializable" id="1140487">EqualityTestTreeMaker</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Symbol" id="1136339">prevBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1136340">patTree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Position" id="1136341">pos</a>: <a href="../util/Position.scala.html#52230" title="PatMatVirtualiser.this.global.Position">Position</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134804" title="TreeMakers.this.CondTreeMaker">CondTreeMaker</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Type" id="1136330">nextBinderTp</a> = <a href="#1136339" title="=&gt; PatMatVirtualiser.this.global.Symbol">prevBinder</a>.<a href="../../../reflect/internal/Symbols.scala.html#443427" title="=&gt; PatMatVirtualiser.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#441990" title="=&gt; PatMatVirtualiser.this.global.Type">widen</a>

      // NOTE: generate `patTree == patBinder`, since the extractor must be in control of the equals method (also, patBinder may be null)
      // equals need not be well-behaved, so don't intersect with pattern's (stabilized) type (unlike MaybeBoundTyped's accumType, where it's required)
      <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1136332">cond</a> = <a href="#1134723" title="=&gt; TreeMakers.this.AbsCodegen">codegen</a>.<a href="#1137192" title="(checker: PatMatVirtualiser.this.global.Tree, binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">_equals</a><span class="delimiter">(</span><a href="#1136340" title="=&gt; PatMatVirtualiser.this.global.Tree">patTree</a>, <a href="#1136339" title="=&gt; PatMatVirtualiser.this.global.Symbol">prevBinder</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.gen.global.Tree" id="1136334">res</a>  = <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1136339" title="=&gt; PatMatVirtualiser.this.global.Symbol">prevBinder</a><span class="delimiter">)</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1136336">toString</a> = <span title="String(&quot;ET&quot;)" class="string">&quot;ET&quot;</span><a href="../../../Tuple2.scala.html#63804" title="(x$1: Any)String">+</a><span class="delimiter">(</span><a href="#1136339" title="=&gt; PatMatVirtualiser.this.global.Symbol">prevBinder</a>, <a href="#1136340" title="=&gt; PatMatVirtualiser.this.global.Tree">patTree</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    case <span class="keyword">class</span> <a title="class AlternativesTreeMaker extends TreeMakers.this.TreeMaker with TreeMakers.this.NoNewBinders with Product with Serializable" id="1140515">AlternativesTreeMaker</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Symbol" id="1136371">prevBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <span class="keyword">var</span> <a title="List[List[TreeMakers.this.TreeMaker]]" id="1136372">altss</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[TreeMakers.this.TreeMaker]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Position" id="1136373">pos</a>: <a href="../util/Position.scala.html#52230" title="PatMatVirtualiser.this.global.Position">Position</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134792" title="TreeMakers.this.TreeMaker">TreeMaker</a> <span class="keyword">with</span> <a href="#1134793" title="TreeMakers.this.NoNewBinders">NoNewBinders</a> <span class="delimiter">{</span>
      // don't substitute prevBinder to nextBinder, a set of alternatives does not need to introduce a new binder, simply reuse the previous one

      <span class="keyword">override</span> <span class="keyword">private</span><span class="delimiter">[</span>TreeMakers<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(outerSubst: TreeMakers.this.Substitution)Unit" id="1136364">incorporateOuterSubstitution</a><span class="delimiter">(</span><a title="TreeMakers.this.Substitution" id="1139757">outerSubst</a>: <a href="#1134784" title="TreeMakers.this.Substitution">Substitution</a><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#2389" title="Unit">Unit</a> = <span class="delimiter">{</span>
        <a href="#1140515" title="TreeMakers.this.AlternativesTreeMaker" class="keyword">super</a>.<a href="#1135098" title="(outerSubst: TreeMakers.this.Substitution)Unit">incorporateOuterSubstitution</a><span class="delimiter">(</span><a href="#1139757" title="TreeMakers.this.Substitution">outerSubst</a><span class="delimiter">)</span>
        <a href="#1136372" title="(x$1: List[List[TreeMakers.this.TreeMaker]])Unit">altss</a> = <a href="#1136372" title="=&gt; List[List[TreeMakers.this.TreeMaker]]">altss</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: List[TreeMakers.this.TreeMaker] =&gt; List[TreeMakers.this.TreeMaker])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[TreeMakers.this.TreeMaker]],List[TreeMakers.this.TreeMaker],List[List[TreeMakers.this.TreeMaker]]])List[List[TreeMakers.this.TreeMaker]]">map</a> <span class="delimiter">(</span><a title="List[TreeMakers.this.TreeMaker]" id="1139783">alts</a> =&gt; <a href="#1134831" title="(treeMakers: List[TreeMakers.this.TreeMaker], initial: TreeMakers.this.Substitution)List[TreeMakers.this.TreeMaker]">propagateSubstitution</a><span class="delimiter">(</span><a href="#1139783" title="List[TreeMakers.this.TreeMaker]">alts</a>, <a href="#1135096" title="=&gt; TreeMakers.this.Substitution">substitution</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(next: PatMatVirtualiser.this.global.Tree)(codegenAlt: TreeMakers.this.Casegen)PatMatVirtualiser.this.global.Tree" id="1136365">chainBefore</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1139811">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="TreeMakers.this.Casegen" id="1139812">codegenAlt</a>: <a href="#1134722" title="TreeMakers.this.Casegen">Casegen</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._
        <a href="../../../reflect/internal/Positions.scala.html#441889" title="(pos: PatMatVirtualiser.this.global.Position)(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">atPos</a><span class="delimiter">(</span><a href="#1136373" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">{</span>
          // one alternative may still generate multiple trees (e.g., an extractor call + equality test)
          // (for now,) alternatives may not bind variables (except wildcards), so we don't care about the final substitution built internally by makeTreeMakers
          <span class="keyword">val</span> <a title="List[TreeMakers.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]" id="1139820">combinedAlts</a> = <a href="#1136372" title="=&gt; List[List[TreeMakers.this.TreeMaker]]">altss</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: List[TreeMakers.this.TreeMaker] =&gt; (TreeMakers.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree))(implicit bf: scala.collection.generic.CanBuildFrom[List[List[TreeMakers.this.TreeMaker]],TreeMakers.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree,List[TreeMakers.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]])List[TreeMakers.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]">map</a> <span class="delimiter">(</span><a title="List[TreeMakers.this.TreeMaker]" id="1139841">altTreeMakers</a> =&gt;
            <span class="delimiter">(</span><span class="delimiter">(</span>casegen: <a href="#1134722" title="TreeMakers.this.Casegen">Casegen</a><span class="delimiter">)</span> =&gt; <a href="#1134829" title="(treeMakers: List[TreeMakers.this.TreeMaker])(casegen: TreeMakers.this.Casegen)PatMatVirtualiser.this.global.Tree">combineExtractors</a><span class="delimiter">(</span><a href="#1139841" title="List[TreeMakers.this.TreeMaker]">altTreeMakers</a> <a href="../../../collection/SeqLike.scala.html#59810" title="(elem: TreeMakers.this.TreeMaker)(implicit bf: scala.collection.generic.CanBuildFrom[List[TreeMakers.this.TreeMaker],TreeMakers.this.TreeMaker,List[TreeMakers.this.TreeMaker]])List[TreeMakers.this.TreeMaker]">:+</a> <a href="#1140291" title="(tree: PatMatVirtualiser.this.global.Tree)TreeMakers.this.TrivialTreeMaker">TrivialTreeMaker</a><span class="delimiter">(</span><a href="#1139843" title="TreeMakers.this.Casegen">casegen</a>.<a href="#1138807" title="(res: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">one</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653593" title="=&gt; PatMatVirtualiser.this.global.Literal">TRUE_typed</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1139843" title="TreeMakers.this.Casegen">casegen</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1139821">findAltMatcher</a> = <a href="#1139812" title="TreeMakers.this.Casegen">codegenAlt</a>.<a href="#1137190" title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, restpe: PatMatVirtualiser.this.global.Type)(cases: List[TreeMakers.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree], matchFailGen: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree">matcher</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#23577" title="PatMatVirtualiser.this.global.EmptyTree.type">EmptyTree</a>, <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a>, <a href="../../../reflect/internal/Definitions.scala.html#442857" title="=&gt; PatMatVirtualiser.this.global.ClassSymbol">BooleanClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1139820" title="List[TreeMakers.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]">combinedAlts</a>, <a href="../../../Option.scala.html#64111" title="(x: PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Literal)Some[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Literal]">Some</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1139941">x</a> =&gt; <a href="../ast/TreeDSL.scala.html#653594" title="=&gt; PatMatVirtualiser.this.global.Literal">FALSE_typed</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#1139812" title="TreeMakers.this.Casegen">codegenAlt</a>.<a href="#1138811" title="(c: PatMatVirtualiser.this.global.Tree, then: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">ifThenElseZero</a><span class="delimiter">(</span><a href="#1139821" title="PatMatVirtualiser.this.global.Tree">findAltMatcher</a>, <a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">substitution</a><span class="delimiter">(</span><a href="#1139811" title="PatMatVirtualiser.this.global.Tree">next</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    case <span class="keyword">class</span> <a title="class GuardTreeMaker extends TreeMakers.this.TreeMaker with TreeMakers.this.NoNewBinders with Product with Serializable" id="1140534">GuardTreeMaker</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Tree" id="1136640">guardTree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134792" title="TreeMakers.this.TreeMaker">TreeMaker</a> <span class="keyword">with</span> <a href="#1134793" title="TreeMakers.this.NoNewBinders">NoNewBinders</a> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(next: PatMatVirtualiser.this.global.Tree)(casegen: TreeMakers.this.Casegen)PatMatVirtualiser.this.global.Tree" id="1136636">chainBefore</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1140008">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="TreeMakers.this.Casegen" id="1140009">casegen</a>: <a href="#1134722" title="TreeMakers.this.Casegen">Casegen</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="#1140009" title="TreeMakers.this.Casegen">casegen</a>.<a href="#1138810" title="(cond: PatMatVirtualiser.this.global.Tree, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">flatMapGuard</a><span class="delimiter">(</span><a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">substitution</a><span class="delimiter">(</span><a href="#1136640" title="=&gt; PatMatVirtualiser.this.global.Tree">guardTree</a><span class="delimiter">)</span>, <a href="#1140008" title="PatMatVirtualiser.this.global.Tree">next</a><span class="delimiter">)</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1136637">toString</a> = <span title="String(&quot;G(&quot;)" class="string">&quot;G(&quot;</span><span title="(x$1: Any)String">+</span> <a href="#1136640" title="=&gt; PatMatVirtualiser.this.global.Tree">guardTree</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span>
    <span class="delimiter">}</span>

    // combineExtractors changes the current substitution's of the tree makers in `treeMakers`
    // requires propagateSubstitution(treeMakers) has been called
    <span class="keyword">def</span> <a title="(treeMakers: List[TreeMakers.this.TreeMaker])(casegen: TreeMakers.this.Casegen)PatMatVirtualiser.this.global.Tree" id="1134829">combineExtractors</a><span class="delimiter">(</span><a title="List[TreeMakers.this.TreeMaker]" id="1139844">treeMakers</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[TreeMakers.this.TreeMaker]">List</a><span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="TreeMakers.this.Casegen" id="1139845">casegen</a>: <a href="#1134722" title="TreeMakers.this.Casegen">Casegen</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> =
      <a href="#1139844" title="List[TreeMakers.this.TreeMaker]">treeMakers</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76176" title="(z: PatMatVirtualiser.this.global.Tree)(f: (TreeMakers.this.TreeMaker, PatMatVirtualiser.this.global.Tree) =&gt; PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">foldRight</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#23577" title="PatMatVirtualiser.this.global.EmptyTree.type">EmptyTree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="TreeMakers.this.TreeMaker" id="1140078">a</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1140079">b</a><span class="delimiter">)</span> =&gt; <a href="#1140078" title="TreeMakers.this.TreeMaker">a</a>.<a href="#1135100" title="(next: PatMatVirtualiser.this.global.Tree)(casegen: TreeMakers.this.Casegen)PatMatVirtualiser.this.global.Tree">chainBefore</a><span class="delimiter">(</span><a href="#1140079" title="PatMatVirtualiser.this.global.Tree">b</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1139845" title="TreeMakers.this.Casegen">casegen</a><span class="delimiter">)</span><span class="delimiter">)</span>


    <span class="keyword">def</span> <a title="(makers: List[TreeMakers.this.TreeMaker])List[TreeMakers.this.TreeMaker]" id="1134830">removeSubstOnly</a><span class="delimiter">(</span><a title="List[TreeMakers.this.TreeMaker]" id="1140080">makers</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[TreeMakers.this.TreeMaker]">List</a><span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#1140080" title="List[TreeMakers.this.TreeMaker]">makers</a> <a href="../../../collection/TraversableLike.scala.html#58982" title="(p: TreeMakers.this.TreeMaker =&gt; Boolean)List[TreeMakers.this.TreeMaker]">filterNot</a> <span class="delimiter">(</span><a href="#1140086" title="TreeMakers.this.TreeMaker">_</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="#1140341" title="TreeMakers.this.SubstOnlyTreeMaker">SubstOnlyTreeMaker</a><span class="delimiter">]</span><span class="delimiter">)</span>

    // a foldLeft to accumulate the localSubstitution left-to-right
    // it drops SubstOnly tree makers, since their only goal in life is to propagate substitutions to the next tree maker, which is fullfilled by propagateSubstitution
    <span class="keyword">def</span> <a title="(treeMakers: List[TreeMakers.this.TreeMaker], initial: TreeMakers.this.Substitution)List[TreeMakers.this.TreeMaker]" id="1134831">propagateSubstitution</a><span class="delimiter">(</span><a title="List[TreeMakers.this.TreeMaker]" id="1135260">treeMakers</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[TreeMakers.this.TreeMaker]">List</a><span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span>, <a title="TreeMakers.this.Substitution" id="1135261">initial</a>: <a href="#1134784" title="TreeMakers.this.Substitution">Substitution</a><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[TreeMakers.this.TreeMaker]">List</a><span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="TreeMakers.this.Substitution" id="1140087">accumSubst</a>: <a href="#1134784" title="TreeMakers.this.Substitution">Substitution</a> = <a href="#1135261" title="TreeMakers.this.Substitution">initial</a>
      <a href="#1135260" title="List[TreeMakers.this.TreeMaker]">treeMakers</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: TreeMakers.this.TreeMaker =&gt; Unit)Unit">foreach</a> <span class="delimiter">{</span> <a title="TreeMakers.this.TreeMaker" id="1140107">maker</a> =&gt;
        <a href="#1140107" title="TreeMakers.this.TreeMaker">maker</a> <a href="#1135098" title="(outerSubst: TreeMakers.this.Substitution)Unit">incorporateOuterSubstitution</a> <a href="#1140087" title="TreeMakers.this.Substitution">accumSubst</a>
        <a href="#1140087" title="TreeMakers.this.Substitution">accumSubst</a> = <a href="#1140107" title="TreeMakers.this.TreeMaker">maker</a>.<a href="#1135096" title="=&gt; TreeMakers.this.Substitution">substitution</a>
      <span class="delimiter">}</span>
      <a href="#1134830" title="(makers: List[TreeMakers.this.TreeMaker])List[TreeMakers.this.TreeMaker]">removeSubstOnly</a><span class="delimiter">(</span><a href="#1135260" title="List[TreeMakers.this.TreeMaker]">treeMakers</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    // calls propagateSubstitution on the treemakers
    <span class="keyword">def</span> <a title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, casesRaw: List[List[TreeMakers.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type, owner: PatMatVirtualiser.this.global.Symbol, matchFailGenOverride: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree" id="1134832">combineCases</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1135003">scrut</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1135004">scrutSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="List[List[TreeMakers.this.TreeMaker]]" id="1135005">casesRaw</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[TreeMakers.this.TreeMaker]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Type" id="1135006">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1135007">owner</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]" id="1135008">matchFailGenOverride</a>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree =&gt; Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      // drops SubstOnlyTreeMakers, since their effect is now contained in the TreeMakers that follow them
      <span class="keyword">val</span> <a title="List[List[TreeMakers.this.TreeMaker]]" id="1140109">casesNoSubstOnly</a> = <a href="#1135005" title="List[List[TreeMakers.this.TreeMaker]]">casesRaw</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: List[TreeMakers.this.TreeMaker] =&gt; List[TreeMakers.this.TreeMaker])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[TreeMakers.this.TreeMaker]],List[TreeMakers.this.TreeMaker],List[List[TreeMakers.this.TreeMaker]]])List[List[TreeMakers.this.TreeMaker]]">map</a> <span class="delimiter">(</span><a href="#1134831" title="(treeMakers: List[TreeMakers.this.TreeMaker], initial: TreeMakers.this.Substitution)List[TreeMakers.this.TreeMaker]">propagateSubstitution</a><span class="delimiter">(</span><a href="#1140126" title="List[TreeMakers.this.TreeMaker]">_</a>, <a href="#1134785" title="TreeMakers.this.EmptySubstitution.type">EmptySubstitution</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#1134833" title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, casesNoSubstOnly: List[List[TreeMakers.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type, owner: PatMatVirtualiser.this.global.Symbol, matchFailGenOverride: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree">combineCasesNoSubstOnly</a><span class="delimiter">(</span><a href="#1135003" title="PatMatVirtualiser.this.global.Tree">scrut</a>, <a href="#1135004" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a>, <a href="#1140109" title="List[List[TreeMakers.this.TreeMaker]]">casesNoSubstOnly</a>, <a href="#1135006" title="PatMatVirtualiser.this.global.Type">pt</a>, <a href="#1135007" title="PatMatVirtualiser.this.global.Symbol">owner</a>, <a href="#1135008" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">matchFailGenOverride</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, casesNoSubstOnly: List[List[TreeMakers.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type, owner: PatMatVirtualiser.this.global.Symbol, matchFailGenOverride: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree" id="1134833">combineCasesNoSubstOnly</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1135657">scrut</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1135658">scrutSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="List[List[TreeMakers.this.TreeMaker]]" id="1135659">casesNoSubstOnly</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[TreeMakers.this.TreeMaker]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Type" id="1135660">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1135661">owner</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]" id="1135662">matchFailGenOverride</a>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree =&gt; Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> =
      <a href="#1134834" title="(origOwner: PatMatVirtualiser.this.global.Symbol, pos: PatMatVirtualiser.this.global.Position)PatMatVirtualiser.this.global.Traverser">fixerUpper</a><a href="../../../reflect/api/Trees.scala.html#433540" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="#1135661" title="PatMatVirtualiser.this.global.Symbol">owner</a>, <a href="#1135657" title="PatMatVirtualiser.this.global.Tree">scrut</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Type" id="1140156">ptDefined</a>    = <span title="PatMatVirtualiser.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="Infer.scala.html#560269" title="(tp: PatMatVirtualiser.this.global.Type)Boolean">isFullyDefined</a><span class="delimiter">(</span><a href="#1135660" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#1135660" title="PatMatVirtualiser.this.global.Type">pt</a> <span class="keyword">else</span> <a href="../../../reflect/internal/Types.scala.html#441256" title="PatMatVirtualiser.this.global.NoType.type">NoType</a>
        <span class="keyword">def</span> <a title="=&gt; Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]" id="1140157">matchFailGen</a> = <span class="delimiter">(</span><a href="#1135662" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">matchFailGenOverride</a> <a href="../../../Option.scala.html#63845" title="(alternative: =&gt; Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">orElse</a> <a href="../../../Option.scala.html#64111" title="(x: PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Throw)Some[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Throw]">Some</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653618" title="(arg: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Throw">MATCHERROR</a><span class="delimiter">(</span><a href="#1140166" title="PatMatVirtualiser.this.global.Tree">_</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        // println(&quot;combining cases: &quot;+ (casesNoSubstOnly.map(_.mkString(&quot; &gt;&gt; &quot;)).mkString(&quot;{&quot;, &quot;\n&quot;, &quot;}&quot;)))

        <a href="#1134790" title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, cases: List[List[TreeMakers.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type, matchFailGenOverride: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])Option[PatMatVirtualiser.this.global.Tree]">emitSwitch</a><span class="delimiter">(</span><a href="#1135657" title="PatMatVirtualiser.this.global.Tree">scrut</a>, <a href="#1135658" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a>, <a href="#1135659" title="List[List[TreeMakers.this.TreeMaker]]">casesNoSubstOnly</a>, <a href="#1135660" title="PatMatVirtualiser.this.global.Type">pt</a>, <a href="#1135662" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">matchFailGenOverride</a><span class="delimiter">)</span>.<a href="../../../Option.scala.html#63814" title="(default: =&gt; PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">getOrElse</a><span class="delimiter">{</span>
          <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1135659" title="List[List[TreeMakers.this.TreeMaker]]">casesNoSubstOnly</a> <a href="../../../collection/TraversableOnce.scala.html#59102" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            // before optimizing, check casesNoSubstOnly for presence of a default case,
            // since DCE will eliminate trivial cases like `case _ =&gt;`, even if they're the last one
            // exhaustivity and reachability must be checked before optimization as well
            // TODO: improve notion of trivial/irrefutable -- a trivial type test before the body still makes for a default case
            //   (&quot;trivial&quot; depends on whether we're emitting a straight match or an exception, or more generally, any supertype of scrutSym.tpe is a no-op)
            //   irrefutability checking should use the approximation framework also used for CSE, unreachability and exhaustivity checking
            <span class="keyword">val</span> <a title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]" id="1140174">synthCatchAll</a> =
              <span title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1135659" title="List[List[TreeMakers.this.TreeMaker]]">casesNoSubstOnly</a>.<a href="../../../collection/TraversableOnce.scala.html#59102" title="=&gt; Boolean">nonEmpty</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">{</span>
                    <span class="keyword">val</span> <a title="List[TreeMakers.this.TreeMaker]" id="1140179">nonTrivLast</a> = <a href="#1135659" title="List[List[TreeMakers.this.TreeMaker]]">casesNoSubstOnly</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76185" title="=&gt; List[TreeMakers.this.TreeMaker]">last</a>
                    <a href="#1140179" title="List[TreeMakers.this.TreeMaker]">nonTrivLast</a>.<a href="../../../collection/TraversableOnce.scala.html#59102" title="=&gt; Boolean">nonEmpty</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1140179" title="List[TreeMakers.this.TreeMaker]">nonTrivLast</a>.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; TreeMakers.this.TreeMaker">head</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="#1140316" title="TreeMakers.this.BodyTreeMaker">BodyTreeMaker</a><span class="delimiter">]</span>
                  <span class="delimiter">}</span><span class="delimiter">)</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>
              <span class="keyword">else</span> <a href="#1140157" title="=&gt; Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">matchFailGen</a>

            <span class="keyword">val</span> <a href="#1140192" title="(x: (List[List[TreeMakers.this.TreeMaker]], List[PatMatVirtualiser.this.global.Tree]))(List[List[TreeMakers.this.TreeMaker]], List[PatMatVirtualiser.this.global.Tree])" class="delimiter">(</a><a href="../../../Tuple2.scala.html#61506" title="List[List[TreeMakers.this.TreeMaker]]" id="1140176">cases</a>, <a href="../../../Tuple2.scala.html#61508" title="List[PatMatVirtualiser.this.global.Tree]" id="1140177">toHoist</a><span class="delimiter">)</span> = <a href="#1134789" title="(prevBinder: PatMatVirtualiser.this.global.Symbol, cases: List[List[TreeMakers.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type)(List[List[TreeMakers.this.TreeMaker]], List[PatMatVirtualiser.this.global.Tree])">optimizeCases</a><a href="../../../Tuple2.scala.html#1222" title="(List[List[TreeMakers.this.TreeMaker]], List[PatMatVirtualiser.this.global.Tree]) @unchecked" class="delimiter">(</a><a href="#1135658" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a>, <a href="#1135659" title="List[List[TreeMakers.this.TreeMaker]]">casesNoSubstOnly</a>, <a href="#1135660" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span>

            <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1140178">matchRes</a> = <a href="#1134723" title="=&gt; TreeMakers.this.AbsCodegen">codegen</a>.<a href="#1137190" title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, restpe: PatMatVirtualiser.this.global.Type)(cases: List[TreeMakers.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree], matchFailGen: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree">matcher</a><span class="delimiter">(</span><a href="#1135657" title="PatMatVirtualiser.this.global.Tree">scrut</a>, <a href="#1135658" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a>, <a href="#1135660" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1140176" title="List[List[TreeMakers.this.TreeMaker]]">cases</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: List[TreeMakers.this.TreeMaker] =&gt; (TreeMakers.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree))(implicit bf: scala.collection.generic.CanBuildFrom[List[List[TreeMakers.this.TreeMaker]],TreeMakers.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree,List[TreeMakers.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]])List[TreeMakers.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]">map</a> <a href="#1134829" title="(treeMakers: List[TreeMakers.this.TreeMaker])(casegen: TreeMakers.this.Casegen)PatMatVirtualiser.this.global.Tree">combineExtractors</a>, <a href="#1140174" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">synthCatchAll</a><span class="delimiter">)</span>

            <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1140177" title="List[PatMatVirtualiser.this.global.Tree]">toHoist</a> <a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="#1140178" title="PatMatVirtualiser.this.global.Tree">matchRes</a> <span class="keyword">else</span> <a href="../../../reflect/api/Trees.scala.html#427284" title="(stats: List[PatMatVirtualiser.this.global.Tree], expr: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Block">Block</a><span class="delimiter">(</span><a href="#1140177" title="List[PatMatVirtualiser.this.global.Tree]">toHoist</a>, <a href="#1140178" title="PatMatVirtualiser.this.global.Tree">matchRes</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <a href="#1134723" title="=&gt; TreeMakers.this.AbsCodegen">codegen</a>.<a href="#1137190" title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, restpe: PatMatVirtualiser.this.global.Type)(cases: List[TreeMakers.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree], matchFailGen: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree">matcher</a><span class="delimiter">(</span><a href="#1135657" title="PatMatVirtualiser.this.global.Tree">scrut</a>, <a href="#1135658" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a>, <a href="#1135660" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>, <a href="#1140157" title="=&gt; Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">matchFailGen</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    // TODO: do this during tree construction, but that will require tracking the current owner in treemakers
    // TODO: assign more fine-grained positions
    // fixes symbol nesting, assigns positions
    <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(origOwner: PatMatVirtualiser.this.global.Symbol, pos: PatMatVirtualiser.this.global.Position)PatMatVirtualiser.this.global.Traverser" id="1134834">fixerUpper</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1135356">origOwner</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Position" id="1135357">pos</a>: <a href="../util/Position.scala.html#52230" title="PatMatVirtualiser.this.global.Position">Position</a><span class="delimiter">)</span> = <a href="#1135360" title="PatMatVirtualiser.this.global.Traverser" class="keyword">new</a> <a href="../../../reflect/api/Trees.scala.html#23760" title="anonymous class $anon extends PatMatVirtualiser.this.global.Traverser" id="1135360">Traverser</a> <span class="delimiter">{</span>
      <a href="../../../reflect/api/Trees.scala.html#433533" title="(x$1: PatMatVirtualiser.this.global.Symbol)Unit">currentOwner</a> = <a href="#1135356" title="PatMatVirtualiser.this.global.Symbol">origOwner</a>

      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(t: PatMatVirtualiser.this.global.Tree)Unit" id="1135362">traverse</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1135363">t</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1135363" title="PatMatVirtualiser.this.global.Tree">t</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/api/Trees.scala.html#23577" title="PatMatVirtualiser.this.global.EmptyTree.type">EmptyTree</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1135363" title="PatMatVirtualiser.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Positions.scala.html#441880" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#1135363" title="PatMatVirtualiser.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425044" title="(newpos: PatMatVirtualiser.this.global.Position)t.type">setPos</a><span class="delimiter">(</span><a href="#1135357" title="PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#1135363" title="PatMatVirtualiser.this.global.Tree">t</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> Function<a href="#1135451" title="Boolean" id="1135455" class="delimiter">(</a>_, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="#1135363" title="PatMatVirtualiser.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a> =&gt;
            <a href="#1135363" title="PatMatVirtualiser.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425065" title="(sym: PatMatVirtualiser.this.global.Symbol)Unit">symbol</a> = <a href="../../../reflect/api/Trees.scala.html#433532" title="PatMatVirtualiser.this.global.Symbol" id="1135393">currentOwner</a>.<a href="../../../reflect/internal/Symbols.scala.html#494726" title="Long" id="1135395">newAnonymousFunctionValue</a><span class="delimiter">(</span><a href="#1135363" title="PatMatVirtualiser.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="PatMatVirtualiser.this.global.Position" id="1135394">pos</a><span class="delimiter">)</span>
            // println(&quot;new symbol for &quot;+ (t, t.symbol.ownerChain))
          <span class="keyword">case</span> Function<span class="delimiter">(</span>_, _<span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#1135363" title="PatMatVirtualiser.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; PatMatVirtualiser.this.global.Symbol">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#1135363" title="PatMatVirtualiser.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; PatMatVirtualiser.this.global.Symbol">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1135356" title="PatMatVirtualiser.this.global.Symbol">origOwner</a><span class="delimiter">)</span> =&gt;
            // println(&quot;fundef: &quot;+ (t, t.symbol.ownerChain, currentOwner.ownerChain))
            <a href="#1135363" title="PatMatVirtualiser.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443380" title="(owner: PatMatVirtualiser.this.global.Symbol)Unit">owner</a> = <a href="../../../reflect/api/Trees.scala.html#433532" title="=&gt; PatMatVirtualiser.this.global.Symbol">currentOwner</a>
          <span class="keyword">case</span> <a href="#1135451" title="Unit" id="1135461">d</a> : DefTree <span class="keyword">if</span> <span class="delimiter">(</span>d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><span class="delimiter">(</span>d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; PatMatVirtualiser.this.global.Symbol">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span>d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; PatMatVirtualiser.this.global.Symbol">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1135356" title="PatMatVirtualiser.this.global.Symbol">origOwner</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; // don't indiscriminately change existing owners! (see e.g., pos/t3440, pos/t3534, pos/unapplyContexts2)
            // println(&quot;def: &quot;+ (d, d.symbol.ownerChain, currentOwner.ownerChain))
            <span title="Unit" class="keyword">if</span><span class="delimiter">(</span>d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/HasFlags.scala.html#443593" title="=&gt; Boolean">isLazy</a><span class="delimiter">)</span> <span class="delimiter">{</span> // for lazy val's accessor -- is there no tree??
              <a href="../Global.scala.html#559533" title="(assertion: Boolean, message: =&gt; Any)Unit">assert</a><span class="delimiter">(</span>d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443494" title="=&gt; PatMatVirtualiser.this.global.Symbol">lazyAccessor</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443494" title="=&gt; PatMatVirtualiser.this.global.Symbol">lazyAccessor</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; PatMatVirtualiser.this.global.Symbol">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; PatMatVirtualiser.this.global.Symbol">owner</a>, d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443494" title="=&gt; PatMatVirtualiser.this.global.Symbol">lazyAccessor</a><span class="delimiter">)</span>
              d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443494" title="=&gt; PatMatVirtualiser.this.global.Symbol">lazyAccessor</a>.<a href="../../../reflect/internal/Symbols.scala.html#443380" title="(owner: PatMatVirtualiser.this.global.Symbol)Unit">owner</a> = <a href="../../../reflect/api/Trees.scala.html#433532" title="=&gt; PatMatVirtualiser.this.global.Symbol">currentOwner</a>
            <span class="delimiter">}</span>
            <span title="Unit" class="keyword">if</span><span class="delimiter">(</span>d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443515" title="=&gt; PatMatVirtualiser.this.global.Symbol">moduleClass</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span>
              d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443515" title="=&gt; PatMatVirtualiser.this.global.Symbol">moduleClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443380" title="(owner: PatMatVirtualiser.this.global.Symbol)Unit">owner</a> = <a href="../../../reflect/api/Trees.scala.html#433532" title="=&gt; PatMatVirtualiser.this.global.Symbol">currentOwner</a>

            d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443380" title="(owner: PatMatVirtualiser.this.global.Symbol)Unit">owner</a> = <a href="../../../reflect/api/Trees.scala.html#433532" title="=&gt; PatMatVirtualiser.this.global.Symbol">currentOwner</a>
          // case _ if (t.symbol != NoSymbol) &amp;&amp; (t.symbol ne null) =&gt;
          //   println(&quot;untouched &quot;+ (t, t.getClass, t.symbol.ownerChain, currentOwner.ownerChain))
          <span class="keyword">case</span> _ =&gt;
        <span class="delimiter">}</span>
        <a href="#1135360" title="PatMatVirtualiser.this.global.Traverser" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#433535" title="(tree: PatMatVirtualiser.this.global.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#1135363" title="PatMatVirtualiser.this.global.Tree">t</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      // override def apply
      // println(&quot;before fixerupper: &quot;+ xTree)
      // currentRun.trackerFactory.snapshot()
      // println(&quot;after fixerupper&quot;)
      // currentRun.trackerFactory.snapshot()
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// generate actual trees
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  <span class="keyword">trait</span> <a title="trait CodegenCore extends Object with PatMatVirtualiser.this.MatchMonadInterface" id="560241">CodegenCore</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#560237" title="PatMatVirtualiser.this.MatchMonadInterface">MatchMonadInterface</a> <span class="delimiter">{</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="1134717">ctr</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">def</span> <a title="(prefix: String)PatMatVirtualiser.this.global.TermName" id="1134719">freshName</a><span class="delimiter">(</span><a title="String" id="1134983">prefix</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span><a href="#1134717" title="(x$1: Int)Unit">ctr</a> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>; <a href="#560231" title="PatMatVirtualiser.this.vpmName.type">vpmName</a>.<a href="#1134632" title="(str: String, i: Int)PatMatVirtualiser.this.global.TermName">counted</a><span class="delimiter">(</span><a href="#1134983" title="String">prefix</a>, <a href="#1134717" title="=&gt; Int">ctr</a><span class="delimiter">)</span><span class="delimiter">}</span>

    // assert(owner ne null); assert(owner ne NoSymbol)
    <span class="keyword">def</span> <a title="(pos: PatMatVirtualiser.this.global.Position, tp: PatMatVirtualiser.this.global.Type, prefix: String)PatMatVirtualiser.this.global.TermSymbol" id="1134720">freshSym</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Position" id="1134973">pos</a>: <a href="../util/Position.scala.html#52230" title="PatMatVirtualiser.this.global.Position">Position</a>, <a title="PatMatVirtualiser.this.global.Type" id="1134978">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a> = <a href="../../../reflect/internal/Types.scala.html#441256" title="PatMatVirtualiser.this.global.NoType.type">NoType</a>, <a title="String" id="1134979">prefix</a>: <span title="String">String</span> = <span title="String(&quot;x&quot;)" class="string">&quot;x&quot;</span><span class="delimiter">)</span> =
      <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a>.<a href="../../../reflect/internal/SymbolCreations.scala.html#443670" title="(name: PatMatVirtualiser.this.global.TermName, pos: PatMatVirtualiser.this.global.Position, newFlags: Long)PatMatVirtualiser.this.global.TermSymbol">newTermSymbol</a><span class="delimiter">(</span><a href="#1134719" title="(prefix: String)PatMatVirtualiser.this.global.TermName">freshName</a><span class="delimiter">(</span><a href="#1134979" title="String">prefix</a><span class="delimiter">)</span>, <a href="#1134973" title="PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Symbols.scala.html#443429" title="(info: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.TermSymbol">setInfo</a> <a href="#1134978" title="PatMatVirtualiser.this.global.Type">tp</a>

    // codegen relevant to the structure of the translation (how extractors are combined)
    <span class="keyword">trait</span> <a title="trait AbsCodegen extends Object" id="1134721">AbsCodegen</a> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, restpe: PatMatVirtualiser.this.global.Type)(cases: List[CodegenCore.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree], matchFailGen: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree" id="1137190">matcher</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1139931">scrut</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1139932">scrutSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1139933">restpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="List[CodegenCore.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]" id="1139934">cases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[CodegenCore.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Casegen =&gt; Tree<span class="delimiter">]</span>, <a title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]" id="1139935">matchFailGen</a>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree =&gt; Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>

      // local / context-free
      <span class="keyword">def</span> <a title="(b: PatMatVirtualiser.this.global.Symbol, tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree" id="1137191">_asInstanceOf</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1139340">b</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1139341">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
      <span class="keyword">def</span> <a title="(checker: PatMatVirtualiser.this.global.Tree, binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree" id="1137192">_equals</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1139477">checker</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1139478">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
      <span class="keyword">def</span> <a title="(b: PatMatVirtualiser.this.global.Symbol, tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree" id="1137193">_isInstanceOf</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1139365">b</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1139366">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
      <span class="keyword">def</span> <a title="(a: PatMatVirtualiser.this.global.Tree, b: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1137194">and</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1139353">a</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1139354">b</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
      <span class="keyword">def</span> <a title="(tgt: PatMatVirtualiser.this.global.Tree)(n: Int)PatMatVirtualiser.this.global.Tree" id="1137195">drop</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1137596">tgt</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="Int" id="1137597">n</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
      <span class="keyword">def</span> <a title="(tgt: PatMatVirtualiser.this.global.Tree)(i: Int)PatMatVirtualiser.this.global.Tree" id="1137196">index</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1137497">tgt</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="Int" id="1137498">i</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
      <span class="keyword">def</span> <a title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree" id="1137197">mkZero</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Type" id="1140538">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
      <span class="keyword">def</span> <a title="(binder: PatMatVirtualiser.this.global.Symbol)(i: Int)PatMatVirtualiser.this.global.Tree" id="1137198">tupleSel</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1137199">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="Int" id="1137200">i</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
    <span class="delimiter">}</span>

    // structure
    <span class="keyword">trait</span> <a title="trait Casegen extends Object with CodegenCore.this.AbsCodegen" id="1134722">Casegen</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#1134721" title="CodegenCore.this.AbsCodegen">AbsCodegen</a> <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._
      <span class="keyword">def</span> <a title="(res: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1138807">one</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1138879">res</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>

      <span class="keyword">def</span> <a title="(prev: PatMatVirtualiser.this.global.Tree, b: PatMatVirtualiser.this.global.Symbol, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1138808">flatMap</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1139067">prev</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1139068">b</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1139069">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
      <span class="keyword">def</span> <a title="(cond: PatMatVirtualiser.this.global.Tree, res: PatMatVirtualiser.this.global.Tree, nextBinder: PatMatVirtualiser.this.global.Symbol, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1138809">flatMapCond</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1139026">cond</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1139027">res</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1139028">nextBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1139029">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
      <span class="keyword">def</span> <a title="(cond: PatMatVirtualiser.this.global.Tree, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1138810">flatMapGuard</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1140011">cond</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1140012">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
      <span class="keyword">def</span> <a title="(c: PatMatVirtualiser.this.global.Tree, then: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1138811">ifThenElseZero</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1139053">c</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1139054">then</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="../ast/TreeDSL.scala.html#653636" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.IfStart">IF</a> <span class="delimiter">(</span><a href="#1139053" title="PatMatVirtualiser.this.global.Tree">c</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#691660" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.IfStart">THEN</a> <a href="#1139054" title="PatMatVirtualiser.this.global.Tree">then</a> <a href="../ast/TreeDSL.scala.html#691661" title="(elsep: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.If">ELSE</a> <a href="#1138812" title="=&gt; PatMatVirtualiser.this.global.Tree">zero</a>
      <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Tree" id="1138812">zero</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; CodegenCore.this.AbsCodegen" id="1134723">codegen</a>: <a href="#1134721" title="CodegenCore.this.AbsCodegen">AbsCodegen</a>

    <span class="keyword">def</span> <a title="(tp: PatMatVirtualiser.this.global.Type, pt: PatMatVirtualiser.this.global.Type)Boolean" id="1134724">typesConform</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Type" id="1140546">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>, <a title="PatMatVirtualiser.this.global.Type" id="1140547">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span> = <span class="delimiter">(</span><span class="delimiter">(</span><a href="#1140546" title="PatMatVirtualiser.this.global.Type">tp</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#1140547" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#1140546" title="PatMatVirtualiser.this.global.Type">tp</a> <a href="../../../reflect/internal/Types.scala.html#442058" title="(that: PatMatVirtualiser.this.global.Type)Boolean">&lt;:&lt;</a> <a href="#1140547" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class CommonCodegen extends Object with CodegenCore.this.AbsCodegen" id="1134725">CommonCodegen</a> <a href="#1134725" title="CodegenCore.this.CommonCodegen" class="keyword">extends</a> <a href="#1134721" title="CodegenCore.this.AbsCodegen">AbsCodegen</a> <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._
      <span class="keyword">def</span> <a title="(arg: PatMatVirtualiser.this.global.Symbol, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1140554">fun</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1140567">arg</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1140568">body</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>           = <a href="../../../reflect/api/Trees.scala.html#436558" title="(vparams: List[PatMatVirtualiser.this.global.ValDef], body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Function">Function</a><span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.ValDef*)List[PatMatVirtualiser.this.global.ValDef]">List</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#441818" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#1140567" title="PatMatVirtualiser.this.global.Symbol">arg</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#1140568" title="PatMatVirtualiser.this.global.Tree">body</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(tfun: PatMatVirtualiser.this.global.Tree, args: PatMatVirtualiser.this.global.Type*)PatMatVirtualiser.this.global.Tree" id="1140555">genTypeApply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1140601">tfun</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Type*" id="1140602">args</a>: <span title="PatMatVirtualiser.this.global.Type*">Type</span>*<span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>  = <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span><span class="delimiter">(</span><a href="#1140602" title="PatMatVirtualiser.this.global.Type*">args</a> <a href="../../../collection/SeqLike.scala.html#59768" title="(elem: Any)Boolean">contains</a> <a href="../../../reflect/internal/Types.scala.html#441256" title="PatMatVirtualiser.this.global.NoType.type">NoType</a><span class="delimiter">)</span> <a href="#1140601" title="PatMatVirtualiser.this.global.Tree">tfun</a> <span class="keyword">else</span> <a href="../../../reflect/api/Trees.scala.html#429629" title="(fun: PatMatVirtualiser.this.global.Tree, args: List[PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.TypeApply">TypeApply</a><span class="delimiter">(</span><a href="#1140601" title="PatMatVirtualiser.this.global.Tree">tfun</a>, <a href="#1140602" title="PatMatVirtualiser.this.global.Type*">args</a>.<a href="../../../collection/TraversableOnce.scala.html#59174" title="=&gt; List[PatMatVirtualiser.this.global.Type]">toList</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: PatMatVirtualiser.this.global.Type =&gt; PatMatVirtualiser.this.global.TypeTree)(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Type],PatMatVirtualiser.this.global.TypeTree,List[PatMatVirtualiser.this.global.Tree]])List[PatMatVirtualiser.this.global.Tree]">map</a> <a href="../../../reflect/api/Trees.scala.html#23746" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.TypeTree">TypeTree</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(binder: PatMatVirtualiser.this.global.Symbol)(i: Int)PatMatVirtualiser.this.global.Tree" id="1140556">tupleSel</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1140662">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="Int" id="1140663">i</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>       = <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods" class="delimiter">(</a><a href="#1140662" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#653650" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeFromSelectStart : (ss: PatMatVirtualiser.this.CODE.SelectStart)PatMatVirtualiser.this.global.Select">DOT</a> <a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446911" title="(j: Int)PatMatVirtualiser.this.global.TermName">productAccessorName</a><span class="delimiter">(</span><a href="#1140663" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span> // make tree that accesses the i'th component of the tuple referenced by binder
      <span class="keyword">def</span> <a title="(tgt: PatMatVirtualiser.this.global.Tree)(i: Int)PatMatVirtualiser.this.global.Tree" id="1140557">index</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1140678">tgt</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="Int" id="1140679">i</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>               = <a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods">tgt</a> <a href="../ast/TreeDSL.scala.html#691701" title="(params: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Apply">APPLY</a> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#691641" title="(x: Any)PatMatVirtualiser.this.global.Literal">LIT</a><span class="delimiter">(</span><a href="#1140679" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(tgt: PatMatVirtualiser.this.global.Tree)(n: Int)PatMatVirtualiser.this.global.Tree" id="1140558">drop</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1140695">tgt</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="Int" id="1140696">n</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>                = <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods">tgt</a> <a href="../ast/TreeDSL.scala.html#691675" title="(args: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Apply">DOT</a> <a href="#560231" title="PatMatVirtualiser.this.vpmName.type">vpmName</a>.<a href="#1134612" title="=&gt; PatMatVirtualiser.this.global.TermName">drop</a><span class="delimiter">)</span> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#691641" title="(x: Any)PatMatVirtualiser.this.global.Literal">LIT</a><span class="delimiter">(</span><a href="#1140696" title="Int">n</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(checker: PatMatVirtualiser.this.global.Tree, binder: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree" id="1140559">_equals</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1140709">checker</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1140710">binder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods">checker</a> <a href="../ast/TreeDSL.scala.html#691686" title="(other: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Apply">MEMBER_==</a> <a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1140710" title="PatMatVirtualiser.this.global.Symbol">binder</a><span class="delimiter">)</span>          // NOTE: checker must be the target of the ==, that's the patmat semantics for ya
      <span class="keyword">def</span> <a title="(a: PatMatVirtualiser.this.global.Tree, b: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1140560">and</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1140719">a</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1140720">b</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>                  = <a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods">a</a> <a href="../ast/TreeDSL.scala.html#691685" title="(other: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">AND</a> <a href="#1140720" title="PatMatVirtualiser.this.global.Tree">b</a>

      // drop annotations generated by CPS plugin etc, since its annotationchecker rejects T @cps[U] &lt;: Any
      // let's assume for now annotations don't affect casts, drop them there, and bring them back using the outer Typed tree
      <span class="keyword">private</span> <span class="keyword">def</span> <a title="(t: PatMatVirtualiser.this.global.Tree, tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Typed" id="1140561">mkCast</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1140726">t</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Type" id="1140727">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span> =
        <a href="../../../reflect/api/Trees.scala.html#436785" title="(expr: PatMatVirtualiser.this.global.Tree, tpt: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Typed">Typed</a><span class="delimiter">(</span><a href="../Global.scala.html#559498" title="PatMatVirtualiser.this.global.gen.type">gen</a>.<a href="../../../reflect/internal/TreeGen.scala.html#500051" title="(value: PatMatVirtualiser.this.global.gen.global.Tree, tpe: PatMatVirtualiser.this.global.gen.global.Type, any: Boolean, wrapInApply: Boolean)PatMatVirtualiser.this.global.gen.global.Tree">mkAsInstanceOf</a><span class="delimiter">(</span><a href="#1140726" title="PatMatVirtualiser.this.global.Tree">t</a>, <a href="#1140727" title="PatMatVirtualiser.this.global.Type">tp</a>.<a href="../../../reflect/internal/Types.scala.html#442086" title="=&gt; PatMatVirtualiser.this.global.Type">withoutAnnotations</a>, <span title="Boolean(true)" class="keyword">true</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>, <a href="../../../reflect/api/Trees.scala.html#429772" title="()PatMatVirtualiser.this.global.TypeTree">TypeTree</a><span class="delimiter">(</span><span class="delimiter">)</span> <a href="../../../reflect/api/Trees.scala.html#425062" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.TypeTree">setType</a> <a href="#1140727" title="PatMatVirtualiser.this.global.Type">tp</a><span class="delimiter">)</span>

      // the force is needed mainly to deal with the GADT typing hack (we can't detect it otherwise as tp nor pt need contain an abstract type, we're just casting wildly)
      <span class="keyword">def</span> <a title="(t: PatMatVirtualiser.this.global.Tree, tp: PatMatVirtualiser.this.global.Type, force: Boolean)PatMatVirtualiser.this.global.Tree" id="1140562">_asInstanceOf</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1140750">t</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Type" id="1140751">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>, <a title="Boolean" id="1140754">force</a>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1140754" title="Boolean">force</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#1140750" title="PatMatVirtualiser.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="../../../reflect/internal/Types.scala.html#441256" title="PatMatVirtualiser.this.global.NoType.type">NoType</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../reflect/internal/Trees.scala.html#441814" title="implicit scala.reflect.internal.Trees.TreeOps : (tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.TreeOps">t</a>.<a href="../../../reflect/internal/Trees.scala.html#443954" title="=&gt; Boolean">isTyped</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1134724" title="(tp: PatMatVirtualiser.this.global.Type, pt: PatMatVirtualiser.this.global.Type)Boolean">typesConform</a><span class="delimiter">(</span><a href="#1140750" title="PatMatVirtualiser.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>, <a href="#1140751" title="PatMatVirtualiser.this.global.Type">tp</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#1140750" title="PatMatVirtualiser.this.global.Tree">t</a> <span class="keyword">else</span> <a href="#1140561" title="(t: PatMatVirtualiser.this.global.Tree, tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Typed">mkCast</a><span class="delimiter">(</span><a href="#1140750" title="PatMatVirtualiser.this.global.Tree">t</a>, <a href="#1140751" title="PatMatVirtualiser.this.global.Type">tp</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(b: PatMatVirtualiser.this.global.Symbol, tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree" id="1140563">_asInstanceOf</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1140757">b</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1140758">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1134724" title="(tp: PatMatVirtualiser.this.global.Type, pt: PatMatVirtualiser.this.global.Type)Boolean">typesConform</a><span class="delimiter">(</span><a href="#1140757" title="PatMatVirtualiser.this.global.Symbol">b</a>.<a href="../../../reflect/internal/Symbols.scala.html#443427" title="=&gt; PatMatVirtualiser.this.global.Type">info</a>, <a href="#1140758" title="PatMatVirtualiser.this.global.Type">tp</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1140757" title="PatMatVirtualiser.this.global.Symbol">b</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#1140561" title="(t: PatMatVirtualiser.this.global.Tree, tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Typed">mkCast</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1140757" title="PatMatVirtualiser.this.global.Symbol">b</a><span class="delimiter">)</span>, <a href="#1140758" title="PatMatVirtualiser.this.global.Type">tp</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(b: PatMatVirtualiser.this.global.Symbol, tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree" id="1140564">_isInstanceOf</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1140764">b</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1140765">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="../Global.scala.html#559498" title="PatMatVirtualiser.this.global.gen.type">gen</a>.<a href="../../../reflect/internal/TreeGen.scala.html#500050" title="(value: PatMatVirtualiser.this.global.gen.global.Tree, tpe: PatMatVirtualiser.this.global.gen.global.Type, any: Boolean, wrapInApply: Boolean)PatMatVirtualiser.this.global.gen.global.Tree">mkIsInstanceOf</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1140764" title="PatMatVirtualiser.this.global.Symbol">b</a><span class="delimiter">)</span>, <a href="#1140765" title="PatMatVirtualiser.this.global.Type">tp</a>.<a href="../../../reflect/internal/Types.scala.html#442086" title="=&gt; PatMatVirtualiser.this.global.Type">withoutAnnotations</a>, <span title="Boolean(true)" class="keyword">true</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
      //   if (typesConform(b.info, tpX)) { println(&quot;warning: emitted spurious isInstanceOf: &quot;+(b, tp)); TRUE }

      // duplicated out of frustration with cast generation
      <span class="keyword">def</span> <a title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree" id="1140565">mkZero</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Type" id="1140773">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
        <a href="#1140773" title="PatMatVirtualiser.this.global.Type">tp</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; PatMatVirtualiser.this.global.Symbol">typeSymbol</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="../../../reflect/internal/Definitions.scala.html#442841" title="PatMatVirtualiser.this.global.Tree" id="1140796">UnitClass</a>    =&gt; <a href="../../../reflect/api/Trees.scala.html#432792" title="(value: PatMatVirtualiser.this.global.Constant)PatMatVirtualiser.this.global.Literal">Literal</a><a href="#1140805" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="../../../reflect/internal/Constants.scala.html#443074" title="(value: Any)PatMatVirtualiser.this.global.Constant">Constant</a><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../../../reflect/internal/Definitions.scala.html#442857" title="PatMatVirtualiser.this.global.Tree" id="1140797">BooleanClass</a> =&gt; <a href="../../../reflect/api/Trees.scala.html#432792" title="(value: PatMatVirtualiser.this.global.Constant)PatMatVirtualiser.this.global.Literal">Literal</a><a href="#1140805" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="../../../reflect/internal/Constants.scala.html#443074" title="(value: Any)PatMatVirtualiser.this.global.Constant">Constant</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../../../reflect/internal/Definitions.scala.html#442853" title="PatMatVirtualiser.this.global.Tree" id="1140798">FloatClass</a>   =&gt; <a href="../../../reflect/api/Trees.scala.html#432792" title="(value: PatMatVirtualiser.this.global.Constant)PatMatVirtualiser.this.global.Literal">Literal</a><a href="#1140805" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="../../../reflect/internal/Constants.scala.html#443074" title="(value: Any)PatMatVirtualiser.this.global.Constant">Constant</a><span class="delimiter">(</span><span title="Float(0.0)" class="float">0.0f</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../../../reflect/internal/Definitions.scala.html#442855" title="PatMatVirtualiser.this.global.Tree" id="1140799">DoubleClass</a>  =&gt; <a href="../../../reflect/api/Trees.scala.html#432792" title="(value: PatMatVirtualiser.this.global.Constant)PatMatVirtualiser.this.global.Literal">Literal</a><a href="#1140805" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="../../../reflect/internal/Constants.scala.html#443074" title="(value: Any)PatMatVirtualiser.this.global.Constant">Constant</a><span class="delimiter">(</span><span title="Double(0.0)" class="double">0.0d</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../../../reflect/internal/Definitions.scala.html#442843" title="PatMatVirtualiser.this.global.Tree" id="1140800">ByteClass</a>    =&gt; <a href="../../../reflect/api/Trees.scala.html#432792" title="(value: PatMatVirtualiser.this.global.Constant)PatMatVirtualiser.this.global.Literal">Literal</a><a href="#1140805" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="../../../reflect/internal/Constants.scala.html#443074" title="(value: Any)PatMatVirtualiser.this.global.Constant">Constant</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>.<a href="../../../Int.scala.html#57871" title="=&gt; Byte">toByte</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../../../reflect/internal/Definitions.scala.html#442845" title="PatMatVirtualiser.this.global.Tree" id="1140801">ShortClass</a>   =&gt; <a href="../../../reflect/api/Trees.scala.html#432792" title="(value: PatMatVirtualiser.this.global.Constant)PatMatVirtualiser.this.global.Literal">Literal</a><a href="#1140805" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="../../../reflect/internal/Constants.scala.html#443074" title="(value: Any)PatMatVirtualiser.this.global.Constant">Constant</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>.<a href="../../../Int.scala.html#57872" title="=&gt; Short">toShort</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../../../reflect/internal/Definitions.scala.html#442849" title="PatMatVirtualiser.this.global.Tree" id="1140802">IntClass</a>     =&gt; <a href="../../../reflect/api/Trees.scala.html#432792" title="(value: PatMatVirtualiser.this.global.Constant)PatMatVirtualiser.this.global.Literal">Literal</a><a href="#1140805" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="../../../reflect/internal/Constants.scala.html#443074" title="(value: Any)PatMatVirtualiser.this.global.Constant">Constant</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../../../reflect/internal/Definitions.scala.html#442851" title="PatMatVirtualiser.this.global.Tree" id="1140803">LongClass</a>    =&gt; <a href="../../../reflect/api/Trees.scala.html#432792" title="(value: PatMatVirtualiser.this.global.Constant)PatMatVirtualiser.this.global.Literal">Literal</a><a href="#1140805" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="../../../reflect/internal/Constants.scala.html#443074" title="(value: Any)PatMatVirtualiser.this.global.Constant">Constant</a><span class="delimiter">(</span><span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../../../reflect/internal/Definitions.scala.html#442847" title="PatMatVirtualiser.this.global.Tree" id="1140804">CharClass</a>    =&gt; <a href="../../../reflect/api/Trees.scala.html#432792" title="(value: PatMatVirtualiser.this.global.Constant)PatMatVirtualiser.this.global.Literal">Literal</a><a href="#1140805" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="../../../reflect/internal/Constants.scala.html#443074" title="(value: Any)PatMatVirtualiser.this.global.Constant">Constant</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>.<a href="../../../Int.scala.html#57873" title="=&gt; Char">toChar</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> _            =&gt; <a href="../Global.scala.html#559498" title="PatMatVirtualiser.this.global.gen.type">gen</a>.<a href="../../../reflect/internal/TreeGen.scala.html#500051" title="(value: PatMatVirtualiser.this.global.gen.global.Tree, tpe: PatMatVirtualiser.this.global.gen.global.Type, any: Boolean, wrapInApply: Boolean)PatMatVirtualiser.this.global.gen.global.Tree">mkAsInstanceOf</a><a href="#1140805" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="../../../reflect/api/Trees.scala.html#432792" title="(value: PatMatVirtualiser.this.global.Constant)PatMatVirtualiser.this.global.Literal">Literal</a><span class="delimiter">(</span><a href="../../../reflect/internal/Constants.scala.html#443074" title="(value: Any)PatMatVirtualiser.this.global.Constant">Constant</a><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#1140773" title="PatMatVirtualiser.this.global.Type">tp</a>, any = <span title="Boolean(true)" class="keyword">true</span>, wrapInApply = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span> // the magic incantation is true/false here
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">trait</span> <a title="trait PureMatchMonadInterface extends Object with PatMatVirtualiser.this.MatchMonadInterface" id="560242">PureMatchMonadInterface</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#560237" title="PatMatVirtualiser.this.MatchMonadInterface">MatchMonadInterface</a> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="=&gt; PatMatVirtualiser.this.global.Tree" id="1134840">matchStrategy</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>

    <span class="keyword">def</span> <a title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type" id="1134841">inMatchMonad</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Type" id="1140849">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a> = <a href="../../../reflect/internal/Types.scala.html#441377" title="(tycon: PatMatVirtualiser.this.global.Type, args: List[PatMatVirtualiser.this.global.Type])PatMatVirtualiser.this.global.Type">appliedType</a><span class="delimiter">(</span><a href="#1134846" title="=&gt; PatMatVirtualiser.this.global.Type">oneSig</a>, <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.Type*)List[PatMatVirtualiser.this.global.Type]">List</a><span class="delimiter">(</span><a href="#1140849" title="PatMatVirtualiser.this.global.Type">tp</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../reflect/internal/Types.scala.html#442006" title="=&gt; PatMatVirtualiser.this.global.Type">finalResultType</a>
    <span class="keyword">def</span> <a title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type" id="1134842">pureType</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Type" id="1140868">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>     = <a href="../../../reflect/internal/Types.scala.html#441377" title="(tycon: PatMatVirtualiser.this.global.Type, args: List[PatMatVirtualiser.this.global.Type])PatMatVirtualiser.this.global.Type">appliedType</a><span class="delimiter">(</span><a href="#1134846" title="=&gt; PatMatVirtualiser.this.global.Type">oneSig</a>, <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.Type*)List[PatMatVirtualiser.this.global.Type]">List</a><span class="delimiter">(</span><a href="#1140868" title="PatMatVirtualiser.this.global.Type">tp</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../reflect/internal/Types.scala.html#442010" title="=&gt; List[PatMatVirtualiser.this.global.Type]">paramTypes</a>.<a href="../../../collection/TraversableLike.scala.html#59011" title="=&gt; Option[PatMatVirtualiser.this.global.Type]">headOption</a> <a href="../../../Option.scala.html#63814" title="(default: =&gt; PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">getOrElse</a> <a href="../../../reflect/internal/Types.scala.html#441256" title="PatMatVirtualiser.this.global.NoType.type">NoType</a> // fail gracefully (otherwise we get crashes)
    <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Symbol" id="1134843">matchMonadSym</a>      = <a href="#1134846" title="=&gt; PatMatVirtualiser.this.global.Type">oneSig</a>.<a href="../../../reflect/internal/Types.scala.html#442006" title="=&gt; PatMatVirtualiser.this.global.Type">finalResultType</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; PatMatVirtualiser.this.global.Symbol">typeSymbol</a>

    <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._
    <span class="keyword">def</span> <a title="(n: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.CODE.SelectStart" id="1134845">_match</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Name" id="1140890">n</a>: <a href="../../../reflect/internal/Names.scala.html#440792" title="PatMatVirtualiser.this.global.Name">Name</a><span class="delimiter">)</span>: <a href="../ast/TreeDSL.scala.html#653600" title="PatMatVirtualiser.this.CODE.SelectStart">SelectStart</a> = <a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods">matchStrategy</a> <a href="../ast/TreeDSL.scala.html#691704" title="(member: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.CODE.SelectStart">DOT</a> <a href="#1140890" title="PatMatVirtualiser.this.global.Name">n</a>

    <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Type" id="1134847">oneSig</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a> =
      <a href="#1134690" title="=&gt; PatMatVirtualiser.this.Typer">typer</a>.<a href="Typers.scala.html#560765" title="(tree: PatMatVirtualiser.this.global.Tree, mode: Int, pt: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree">typed</a><span class="delimiter">(</span><a href="#1134845" title="(n: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.CODE.SelectStart">_match</a><a href="../ast/TreeDSL.scala.html#653650" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeFromSelectStart : (ss: PatMatVirtualiser.this.CODE.SelectStart)PatMatVirtualiser.this.global.Select" class="delimiter">(</a><a href="#560231" title="PatMatVirtualiser.this.vpmName.type">vpmName</a>.<a href="#1134610" title="=&gt; PatMatVirtualiser.this.global.TermName">one</a><span class="delimiter">)</span>, EXPRmode | POLYmode | TAPPmode <span title="Int(177)">|</span> FUNmode, <a href="../../../reflect/internal/Types.scala.html#441251" title="PatMatVirtualiser.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>  // TODO: error message
  <span class="delimiter">}</span>

  <span class="keyword">trait</span> <a title="trait PureCodegen extends Object with PatMatVirtualiser.this.CodegenCore with PatMatVirtualiser.this.PureMatchMonadInterface" id="560243">PureCodegen</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#560241" title="PatMatVirtualiser.this.CodegenCore">CodegenCore</a> <span class="keyword">with</span> <a href="#560242" title="PatMatVirtualiser.this.PureMatchMonadInterface">PureMatchMonadInterface</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; PureCodegen.this.AbsCodegen" id="1134836">codegen</a>: <a href="#1134721" title="PureCodegen.this.AbsCodegen">AbsCodegen</a> = <a href="#1134837" title="PureCodegen.this.pureCodegen.type">pureCodegen</a>

    <span class="keyword">object</span> <a title="PureCodegen.this.pureCodegen.type" id="1134837">pureCodegen</a> <a href="#1134838" title="PureCodegen.this.pureCodegen.type" class="keyword">extends</a> <a href="#1134725" title="PureCodegen.this.CommonCodegen">CommonCodegen</a> <span class="keyword">with</span> <a href="#1134722" title="PureCodegen.this.Casegen">Casegen</a> <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._
      //// methods in MatchingStrategy (the monad companion) -- used directly in translation
      // __match.runOrElse(`scrut`)(`scrutSym` =&gt; `matcher`)
      // TODO: consider catchAll, or virtualized matching will break in exception handlers
      <span class="keyword">def</span> <a title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, restpe: PatMatVirtualiser.this.global.Type)(cases: List[PureCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree], matchFailGen: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree" id="1140930">matcher</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1140939">scrut</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1140940">scrutSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1140941">restpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="List[PureCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]" id="1140942">cases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PureCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Casegen =&gt; Tree<span class="delimiter">]</span>, <a title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]" id="1140943">matchFailGen</a>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree =&gt; Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> =
        <a href="#1134845" title="(n: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.CODE.SelectStart">_match</a><a href="../ast/TreeDSL.scala.html#653651" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethodsFromSelectStart : (ss: PatMatVirtualiser.this.CODE.SelectStart)PatMatVirtualiser.this.CODE.TreeMethods" class="delimiter">(</a><a href="#560231" title="PatMatVirtualiser.this.vpmName.type">vpmName</a>.<a href="#1134626" title="=&gt; PatMatVirtualiser.this.global.TermName">runOrElse</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods">APPLY</a> <span class="delimiter">(</span><a href="#1140939" title="PatMatVirtualiser.this.global.Tree">scrut</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#691701" title="(params: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Apply">APPLY</a> <span class="delimiter">(</span><a href="#1140554" title="(arg: PatMatVirtualiser.this.global.Symbol, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">fun</a><span class="delimiter">(</span><a href="#1140940" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a>, <a href="#1140942" title="List[PureCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]">cases</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: (PureCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree) =&gt; PatMatVirtualiser.this.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[PureCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree],PatMatVirtualiser.this.global.Tree,List[PatMatVirtualiser.this.global.Tree]])List[PatMatVirtualiser.this.global.Tree]">map</a> <span class="delimiter">(</span><a title="PureCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree" id="1140986">f</a> =&gt; <a href="../../../Function1.scala.html#59555" title="(v1: PureCodegen.this.Casegen)PatMatVirtualiser.this.global.Tree">f</a><span class="delimiter">(</span><span class="keyword">this</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../collection/LinearSeqOptimized.scala.html#76179" title="(f: (PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Tree) =&gt; PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">reduceLeft</a> <a href="#1140935" title="(thisCase: PatMatVirtualiser.this.global.Tree, elseCase: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">typedOrElse</a><span class="delimiter">)</span><span class="delimiter">)</span>

      // __match.one(`res`)
      <span class="keyword">def</span> <a title="(res: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1140931">one</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1141035">res</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">(</span><a href="#1134845" title="(n: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.CODE.SelectStart">_match</a><a href="../ast/TreeDSL.scala.html#691675" title="(args: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Apply" class="delimiter">(</a><a href="#560231" title="PatMatVirtualiser.this.vpmName.type">vpmName</a>.<a href="#1134610" title="=&gt; PatMatVirtualiser.this.global.TermName">one</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">(</span><a href="#1141035" title="PatMatVirtualiser.this.global.Tree">res</a><span class="delimiter">)</span>
      // __match.zero
      <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Tree" id="1140932">zero</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="#1134845" title="(n: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.CODE.SelectStart">_match</a><a href="../ast/TreeDSL.scala.html#653650" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeFromSelectStart : (ss: PatMatVirtualiser.this.CODE.SelectStart)PatMatVirtualiser.this.global.Select" class="delimiter">(</a><a href="#560231" title="PatMatVirtualiser.this.vpmName.type">vpmName</a>.<a href="#1134628" title="=&gt; PatMatVirtualiser.this.global.TermName">zero</a><span class="delimiter">)</span>
      // __match.guard(`c`, `then`)
      <span class="keyword">def</span> <a title="(c: PatMatVirtualiser.this.global.Tree, then: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1140933">guard</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1141039">c</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1141040">then</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="#1134845" title="(n: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.CODE.SelectStart">_match</a><a href="../ast/TreeDSL.scala.html#653651" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethodsFromSelectStart : (ss: PatMatVirtualiser.this.CODE.SelectStart)PatMatVirtualiser.this.CODE.TreeMethods" class="delimiter">(</a><a href="#560231" title="PatMatVirtualiser.this.vpmName.type">vpmName</a>.<a href="#1134618" title="=&gt; PatMatVirtualiser.this.global.TermName">guard</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#691701" title="(params: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Apply">APPLY</a> <span class="delimiter">(</span><a href="#1141039" title="PatMatVirtualiser.this.global.Tree">c</a>, <a href="#1141040" title="PatMatVirtualiser.this.global.Tree">then</a><span class="delimiter">)</span>

      //// methods in the monad instance -- used directly in translation
      // `prev`.flatMap(`b` =&gt; `next`)
      <span class="keyword">def</span> <a title="(prev: PatMatVirtualiser.this.global.Tree, b: PatMatVirtualiser.this.global.Symbol, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1140934">flatMap</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1141051">prev</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1141052">b</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1141053">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods">prev</a> <a href="../ast/TreeDSL.scala.html#691675" title="(args: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Apply">DOT</a> <a href="#560231" title="PatMatVirtualiser.this.vpmName.type">vpmName</a>.<a href="#1134614" title="=&gt; PatMatVirtualiser.this.global.TermName">flatMap</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1140554" title="(arg: PatMatVirtualiser.this.global.Symbol, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">fun</a><span class="delimiter">(</span><a href="#1141052" title="PatMatVirtualiser.this.global.Symbol">b</a>, <a href="#1141053" title="PatMatVirtualiser.this.global.Tree">next</a><span class="delimiter">)</span><span class="delimiter">)</span>
      // `thisCase`.orElse(`elseCase`)
      <span class="keyword">def</span> <a title="(thisCase: PatMatVirtualiser.this.global.Tree, elseCase: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1140935">typedOrElse</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1141028">thisCase</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1141029">elseCase</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods">thisCase</a> <a href="../ast/TreeDSL.scala.html#653651" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethodsFromSelectStart : (ss: PatMatVirtualiser.this.CODE.SelectStart)PatMatVirtualiser.this.CODE.TreeMethods">DOT</a> <a href="#560231" title="PatMatVirtualiser.this.vpmName.type">vpmName</a>.<a href="#1134622" title="=&gt; PatMatVirtualiser.this.global.TermName">orElse</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#691701" title="(params: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Apply">APPLY</a> <span class="delimiter">(</span><a href="#1141029" title="PatMatVirtualiser.this.global.Tree">elseCase</a><span class="delimiter">)</span>
      //  __match.guard(`cond`, `res`).flatMap(`nextBinder` =&gt; `next`)
      <span class="keyword">def</span> <a title="(cond: PatMatVirtualiser.this.global.Tree, res: PatMatVirtualiser.this.global.Tree, nextBinder: PatMatVirtualiser.this.global.Symbol, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1140936">flatMapCond</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1141088">cond</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1141089">res</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1141090">nextBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1141091">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="#1140934" title="(prev: PatMatVirtualiser.this.global.Tree, b: PatMatVirtualiser.this.global.Symbol, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">flatMap</a><span class="delimiter">(</span><a href="#1140933" title="(c: PatMatVirtualiser.this.global.Tree, then: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">guard</a><span class="delimiter">(</span><a href="#1141088" title="PatMatVirtualiser.this.global.Tree">cond</a>, <a href="#1141089" title="PatMatVirtualiser.this.global.Tree">res</a><span class="delimiter">)</span>, <a href="#1141090" title="PatMatVirtualiser.this.global.Symbol">nextBinder</a>, <a href="#1141091" title="PatMatVirtualiser.this.global.Tree">next</a><span class="delimiter">)</span>
      //  __match.guard(`guardTree`, ()).flatMap((_: P[Unit]) =&gt; `next`)
      <span class="keyword">def</span> <a title="(guardTree: PatMatVirtualiser.this.global.Tree, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1140937">flatMapGuard</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1141093">guardTree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1141094">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="#1140936" title="(cond: PatMatVirtualiser.this.global.Tree, res: PatMatVirtualiser.this.global.Tree, nextBinder: PatMatVirtualiser.this.global.Symbol, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">flatMapCond</a><span class="delimiter">(</span><a href="#1141093" title="PatMatVirtualiser.this.global.Tree">guardTree</a>, <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653592" title="=&gt; PatMatVirtualiser.this.global.Literal">UNIT</a>, <a href="#1134720" title="(pos: PatMatVirtualiser.this.global.Position, tp: PatMatVirtualiser.this.global.Type, prefix: String)PatMatVirtualiser.this.global.TermSymbol">freshSym</a><span class="delimiter">(</span><a href="#1141093" title="PatMatVirtualiser.this.global.Tree">guardTree</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a>, <a href="#1134842" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">pureType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442841" title="=&gt; PatMatVirtualiser.this.global.ClassSymbol">UnitClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#1141094" title="PatMatVirtualiser.this.global.Tree">next</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// OPTIMIZATIONS
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// decisions, decisions
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <span class="keyword">trait</span> <a title="trait TreeMakerApproximation extends Object with PatMatVirtualiser.this.TreeMakers" id="560244">TreeMakerApproximation</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#560240" title="PatMatVirtualiser.this.TreeMakers">TreeMakers</a> <span class="delimiter">{</span> self: CodegenCore =&gt;
    <span class="keyword">object</span> <a title="TreeMakerApproximation.this.Test.type" id="1141152">Test</a> <a href="#1134857" title="TreeMakerApproximation.this.Test.type" class="delimiter">{</a>
      <span class="keyword">var</span> <a title="Int" id="1141101">currId</a> = <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span>
    case <span class="keyword">class</span> <a title="(cond: TreeMakerApproximation.this.Cond, treeMaker: TreeMakerApproximation.this.TreeMaker)TreeMakerApproximation.this.Test" id="1141217">Test</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="TreeMakerApproximation.this.Cond" id="1141189">cond</a>: <a href="#1134861" title="TreeMakerApproximation.this.Cond">Cond</a>, <a title="TreeMakerApproximation.this.TreeMaker" id="1141190">treeMaker</a>: <a href="#1134792" title="TreeMakerApproximation.this.TreeMaker">TreeMaker</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      // def &lt;:&lt;(other: Test) = cond &lt;:&lt; other.cond
      // def andThen_: (prev: List[Test]): List[Test] =
      //   prev.filterNot(this &lt;:&lt; _) :+ this

      <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashSet[TreeMakerApproximation.this.Test]" id="1141111">reusedBy</a> = <a href="../../../collection/mutable/HashSet.scala.html#141566" title="()scala.collection.mutable.HashSet[TreeMakerApproximation.this.Test]" class="keyword">new</a> collection.mutable.<a href="../../../collection/mutable/HashSet.scala.html#13456" title="scala.collection.mutable.HashSet[TreeMakerApproximation.this.Test]">HashSet</a><span class="delimiter">[</span>Test<span class="delimiter">]</span>
      <span class="keyword">var</span> <a title="Option[TreeMakerApproximation.this.Test]" id="1141114">reuses</a>: <a href="../../../Option.scala.html#1510" title="Option[TreeMakerApproximation.this.Test]">Option</a><span class="delimiter">[</span>Test<span class="delimiter">]</span> = <a href="../../../Option.scala.html#2498" title="None.type">None</a>
      <span class="keyword">def</span> <a title="(later: TreeMakerApproximation.this.Test)Unit" id="1141116">registerReuseBy</a><span class="delimiter">(</span><a title="TreeMakerApproximation.this.Test" id="1141164">later</a>: <a href="#1141217" title="TreeMakerApproximation.this.Test">Test</a><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#2389" title="Unit">Unit</a> = <span class="delimiter">{</span>
        <a href="../Global.scala.html#559533" title="(assertion: Boolean, message: =&gt; Any)Unit">assert</a><span class="delimiter">(</span><a href="#1141164" title="TreeMakerApproximation.this.Test">later</a>.<a href="#1141114" title="=&gt; Option[TreeMakerApproximation.this.Test]">reuses</a>.<a href="../../../Option.scala.html#63811" title="=&gt; Boolean">isEmpty</a>, <a href="#1141164" title="TreeMakerApproximation.this.Test">later</a>.<a href="#1141114" title="=&gt; Option[TreeMakerApproximation.this.Test]">reuses</a><span class="delimiter">)</span>
        <a href="#1141111" title="=&gt; scala.collection.mutable.HashSet[TreeMakerApproximation.this.Test]">reusedBy</a> <a href="../../../collection/mutable/HashSet.scala.html#141570" title="(elem: TreeMakerApproximation.this.Test)Test.this.reusedBy.type">+=</a> <a href="#1141164" title="TreeMakerApproximation.this.Test">later</a>
        <a href="#1141164" title="TreeMakerApproximation.this.Test">later</a>.<a href="#1141114" title="(x$1: Option[TreeMakerApproximation.this.Test])Unit">reuses</a> = <a href="../../../Option.scala.html#64111" title="(x: TreeMakerApproximation.this.Test)Some[TreeMakerApproximation.this.Test]">Some</a><span class="delimiter">(</span><a href="#1141217" title="TreeMakerApproximation.this.Test" class="keyword">this</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="Int" id="1141117">id</a> = <span class="delimiter">{</span> <a href="#1141152" title="TreeMakerApproximation.this.Test.type">Test</a>.<a href="#1141101" title="(x$1: Int)Unit">currId</a> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>; <a href="#1141152" title="TreeMakerApproximation.this.Test.type">Test</a>.<a href="#1141101" title="=&gt; Int">currId</a><span class="delimiter">}</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1141119">toString</a> =
        <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1141189" title="=&gt; TreeMakerApproximation.this.Cond">cond</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#1141262" title="TreeMakerApproximation.this.Top.type">Top</a><span class="delimiter">)</span> <span title="String(&quot;T&quot;)" class="string">&quot;T&quot;</span>
        <span class="keyword">else</span> <span title="String" class="keyword">if</span><span class="delimiter">(</span><a href="#1141189" title="=&gt; TreeMakerApproximation.this.Cond">cond</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#1141281" title="TreeMakerApproximation.this.Havoc.type">Havoc</a><span class="delimiter">)</span> <span title="String(&quot;!?&quot;)" class="string">&quot;!?&quot;</span>
        <span class="keyword">else</span> <span title="String(&quot;T&quot;)" class="string">&quot;T&quot;</span><span title="(x$1: Any)String">+</span> <a href="#1141117" title="=&gt; Int">id</a> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span><span title="String" class="keyword">if</span><span class="delimiter">(</span><a href="#1141111" title="=&gt; scala.collection.mutable.HashSet[TreeMakerApproximation.this.Test]">reusedBy</a> <a href="../../../collection/TraversableOnce.scala.html#59102" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <span title="String(&quot;![&quot;)" class="string">&quot;![&quot;</span><span title="(x$1: Any)String">+</span> <a href="#1141190" title="=&gt; TreeMakerApproximation.this.TreeMaker">treeMaker</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;]&quot;)" class="string">&quot;]&quot;</span> <span class="keyword">else</span> <span class="delimiter">(</span><span title="String" class="keyword">if</span><span class="delimiter">(</span><a href="#1141114" title="=&gt; Option[TreeMakerApproximation.this.Test]">reuses</a>.<a href="../../../Option.scala.html#63811" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span title="String(&quot;[&quot;)" class="string">&quot;[&quot;</span><span title="(x$1: Any)String">+</span> <a href="#1141190" title="=&gt; TreeMakerApproximation.this.TreeMaker">treeMaker</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;]&quot;)" class="string">&quot;]&quot;</span> <span class="keyword">else</span>  <span title="String(&quot; cf. T&quot;)" class="string">&quot; cf. T&quot;</span><span title="(x$1: Any)String">+</span><a href="#1141114" title="=&gt; Option[TreeMakerApproximation.this.Test]">reuses</a>.<a href="../../../Option.scala.html#63813" title="=&gt; TreeMakerApproximation.this.Test">get</a>.<a href="#1141117" title="=&gt; Int">id</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">object</span> <a title="TreeMakerApproximation.this.Cond.type" id="1134859">Cond</a> <a href="#1134860" title="TreeMakerApproximation.this.Cond.type" class="delimiter">{</a>
      // def refines(self: Cond, other: Cond): Boolean = (self, other) match {
      //   case (Bottom, _)       =&gt; true
      //   case (Havoc , _)       =&gt; true
      //   case (_         , Top) =&gt; true
      //   case (_         , _)   =&gt; false
      // }
      <span class="keyword">var</span> <a title="Int" id="1141233">currId</a> = <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span>

    <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class Cond extends Object" id="1134861">Cond</a> <a href="#1134861" title="TreeMakerApproximation.this.Cond" class="delimiter">{</a>
      // def testedPath: Tree
      // def &lt;:&lt;(other: Cond) = Cond.refines(this, other)

      <span class="keyword">val</span> <a title="Int" id="1141129">id</a> = <span class="delimiter">{</span> <a href="#1134859" title="TreeMakerApproximation.this.Cond.type">Cond</a>.<a href="#1141233" title="(x$1: Int)Unit">currId</a> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>; <a href="#1134859" title="TreeMakerApproximation.this.Cond.type">Cond</a>.<a href="#1141233" title="=&gt; Int">currId</a><span class="delimiter">}</span>
    <span class="delimiter">}</span>

    // does not contribute any knowledge
    case <span class="keyword">object</span> <a href="#1141248" title="TreeMakerApproximation.this.Top.type" id="1141262">Top</a> <a href="../../../Product.scala.html#304" title="Product" class="keyword">extends</a> <a href="#1134861" title="TreeMakerApproximation.this.Cond">Cond</a>

    // takes away knowledge. e.g., a user-defined guard
    case <span class="keyword">object</span> <a href="#1141267" title="TreeMakerApproximation.this.Havoc.type" id="1141281">Havoc</a> <a href="../../../Product.scala.html#304" title="Product" class="keyword">extends</a> <a href="#1134861" title="TreeMakerApproximation.this.Cond">Cond</a>

    // we know everything! everything!
    // this either means the case is unreachable,
    // or that it is statically known to be picked -- at this point in the decision tree --&gt; no point in emitting further alternatives
    // case object Bottom extends Cond


    <span class="keyword">object</span> <a title="TreeMakerApproximation.this.EqualityCond.type" id="1134866">EqualityCond</a> <a href="#1134867" title="TreeMakerApproximation.this.EqualityCond.type" class="delimiter">{</a>
      <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Tree),TreeMakerApproximation.this.EqualityCond]" id="1141283">uniques</a> = <a href="../../../collection/mutable/HashMap.scala.html#79203" title="()scala.collection.mutable.HashMap[(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Tree),TreeMakerApproximation.this.EqualityCond]" class="keyword">new</a> collection.mutable.<a href="../../../collection/mutable/HashMap.scala.html#12880" title="scala.collection.mutable.HashMap[(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Tree),TreeMakerApproximation.this.EqualityCond]">HashMap</a><span class="delimiter">[</span><span class="delimiter">(</span>Tree, Tree<span class="delimiter">)</span>, EqualityCond<span class="delimiter">]</span>
      <span class="keyword">def</span> <a title="(testedPath: PatMatVirtualiser.this.global.Tree, rhs: PatMatVirtualiser.this.global.Tree)TreeMakerApproximation.this.EqualityCond" id="1141285">apply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1141296">testedPath</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1141297">rhs</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="#1134868" title="TreeMakerApproximation.this.EqualityCond">EqualityCond</a> = <a href="#1141283" title="=&gt; scala.collection.mutable.HashMap[(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Tree),TreeMakerApproximation.this.EqualityCond]">uniques</a> <a href="../../../collection/mutable/MapLike.scala.html#78517" title="(key: (PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Tree), op: =&gt; TreeMakerApproximation.this.EqualityCond)TreeMakerApproximation.this.EqualityCond">getOrElseUpdate</a><span class="delimiter">(</span><a href="../../../Tuple2.scala.html#63804" title="(_1: PatMatVirtualiser.this.global.Tree, _2: PatMatVirtualiser.this.global.Tree)(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Tree)" class="delimiter">(</a><a href="#1141296" title="PatMatVirtualiser.this.global.Tree">testedPath</a>, <a href="#1141297" title="PatMatVirtualiser.this.global.Tree">rhs</a><span class="delimiter">)</span>, <span title="TreeMakerApproximation.this.EqualityCond" class="keyword">new</span> <a href="#1134868" title="TreeMakerApproximation.this.EqualityCond">EqualityCond</a><span class="delimiter">(</span><a href="#1141296" title="PatMatVirtualiser.this.global.Tree">testedPath</a>, <a href="#1141297" title="PatMatVirtualiser.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">class</span> <a title="class EqualityCond extends TreeMakerApproximation.this.Cond" id="1134868">EqualityCond</a><a href="#1134868" title="TreeMakerApproximation.this.EqualityCond" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Tree" id="1141292">testedPath</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1141293">rhs</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134861" title="TreeMakerApproximation.this.Cond">Cond</a> <span class="delimiter">{</span>
      // def negation         = TopCond // inequality doesn't teach us anything
      // do simplification when we know enough about the tree statically:
      //  - collapse equal trees
      //  - accumulate tests when (in)equality not known statically
      //  - become bottom when we statically know this can never match

      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1141291">toString</a> = <a href="../../../Predef.scala.html#8576" title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd">testedPath</a> <a href="../../../runtime/StringAdd.scala.html#60949" title="(other: String)String">+</a><span title="String(&quot; == &quot;)" class="string">&quot; == &quot;</span><span title="(x$1: Any)String">+</span> <a href="#1141293" title="PatMatVirtualiser.this.global.Tree">rhs</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;#&quot;)" class="string">&quot;#&quot;</span><span title="(x$1: Any)String">+</span> <a href="#1141129" title="=&gt; Int">id</a>
    <span class="delimiter">}</span>

    <span class="keyword">object</span> <a title="TreeMakerApproximation.this.TypeCond.type" id="1134869">TypeCond</a> <a href="#1134870" title="TreeMakerApproximation.this.TypeCond.type" class="delimiter">{</a>
      <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Type),TreeMakerApproximation.this.TypeCond]" id="1141315">uniques</a> = <a href="../../../collection/mutable/HashMap.scala.html#79203" title="()scala.collection.mutable.HashMap[(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Type),TreeMakerApproximation.this.TypeCond]" class="keyword">new</a> collection.mutable.<a href="../../../collection/mutable/HashMap.scala.html#12880" title="scala.collection.mutable.HashMap[(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Type),TreeMakerApproximation.this.TypeCond]">HashMap</a><span class="delimiter">[</span><span class="delimiter">(</span>Tree, Type<span class="delimiter">)</span>, TypeCond<span class="delimiter">]</span>
      <span class="keyword">def</span> <a title="(testedPath: PatMatVirtualiser.this.global.Tree, pt: PatMatVirtualiser.this.global.Type)TreeMakerApproximation.this.TypeCond" id="1141317">apply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1141328">testedPath</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Type" id="1141329">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="#1134871" title="TreeMakerApproximation.this.TypeCond">TypeCond</a> = <a href="#1141315" title="=&gt; scala.collection.mutable.HashMap[(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Type),TreeMakerApproximation.this.TypeCond]">uniques</a> <a href="../../../collection/mutable/MapLike.scala.html#78517" title="(key: (PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Type), op: =&gt; TreeMakerApproximation.this.TypeCond)TreeMakerApproximation.this.TypeCond">getOrElseUpdate</a><span class="delimiter">(</span><a href="../../../Tuple2.scala.html#63804" title="(_1: PatMatVirtualiser.this.global.Tree, _2: PatMatVirtualiser.this.global.Type)(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Type)" class="delimiter">(</a><a href="#1141328" title="PatMatVirtualiser.this.global.Tree">testedPath</a>, <a href="#1141329" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span>, <span title="TreeMakerApproximation.this.TypeCond" class="keyword">new</span> <a href="#1134871" title="TreeMakerApproximation.this.TypeCond">TypeCond</a><span class="delimiter">(</span><a href="#1141328" title="PatMatVirtualiser.this.global.Tree">testedPath</a>, <a href="#1141329" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">class</span> <a title="class TypeCond extends TreeMakerApproximation.this.Cond" id="1134871">TypeCond</a><a href="#1134871" title="TreeMakerApproximation.this.TypeCond" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Tree" id="1141324">testedPath</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Type" id="1141325">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134861" title="TreeMakerApproximation.this.Cond">Cond</a> <span class="delimiter">{</span>
      // def negation         = TopCond // inequality doesn't teach us anything
      // do simplification when we know enough about the tree statically:
      //  - collapse equal trees
      //  - accumulate tests when (in)equality not known statically
      //  - become bottom when we statically know this can never match
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1141323">toString</a> = <a href="../../../Predef.scala.html#8576" title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd">testedPath</a> <a href="../../../runtime/StringAdd.scala.html#60949" title="(other: String)String">+</a><span title="String(&quot; &lt;: &quot;)" class="string">&quot; &lt;: &quot;</span><span title="(x$1: Any)String">+</span> <a href="#1141325" title="PatMatVirtualiser.this.global.Type">pt</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;#&quot;)" class="string">&quot;#&quot;</span><span title="(x$1: Any)String">+</span> <a href="#1141129" title="=&gt; Int">id</a>
    <span class="delimiter">}</span>

    <span class="keyword">object</span> <a title="TreeMakerApproximation.this.TypeAndEqualityCond.type" id="1134872">TypeAndEqualityCond</a> <a href="#1134873" title="TreeMakerApproximation.this.TypeAndEqualityCond.type" class="delimiter">{</a>
      <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Type),TreeMakerApproximation.this.TypeAndEqualityCond]" id="1141347">uniques</a> = <a href="../../../collection/mutable/HashMap.scala.html#79203" title="()scala.collection.mutable.HashMap[(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Type),TreeMakerApproximation.this.TypeAndEqualityCond]" class="keyword">new</a> collection.mutable.<a href="../../../collection/mutable/HashMap.scala.html#12880" title="scala.collection.mutable.HashMap[(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Type),TreeMakerApproximation.this.TypeAndEqualityCond]">HashMap</a><span class="delimiter">[</span><span class="delimiter">(</span>Tree, Type<span class="delimiter">)</span>, TypeAndEqualityCond<span class="delimiter">]</span>
      <span class="keyword">def</span> <a title="(testedPath: PatMatVirtualiser.this.global.Tree, pt: PatMatVirtualiser.this.global.Type)TreeMakerApproximation.this.TypeAndEqualityCond" id="1141349">apply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1141360">testedPath</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Type" id="1141361">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="#1134874" title="TreeMakerApproximation.this.TypeAndEqualityCond">TypeAndEqualityCond</a> = <a href="#1141347" title="=&gt; scala.collection.mutable.HashMap[(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Type),TreeMakerApproximation.this.TypeAndEqualityCond]">uniques</a> <a href="../../../collection/mutable/MapLike.scala.html#78517" title="(key: (PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Type), op: =&gt; TreeMakerApproximation.this.TypeAndEqualityCond)TreeMakerApproximation.this.TypeAndEqualityCond">getOrElseUpdate</a><span class="delimiter">(</span><a href="../../../Tuple2.scala.html#63804" title="(_1: PatMatVirtualiser.this.global.Tree, _2: PatMatVirtualiser.this.global.Type)(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Type)" class="delimiter">(</a><a href="#1141360" title="PatMatVirtualiser.this.global.Tree">testedPath</a>, <a href="#1141361" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span>, <span title="TreeMakerApproximation.this.TypeAndEqualityCond" class="keyword">new</span> <a href="#1134874" title="TreeMakerApproximation.this.TypeAndEqualityCond">TypeAndEqualityCond</a><span class="delimiter">(</span><a href="#1141360" title="PatMatVirtualiser.this.global.Tree">testedPath</a>, <a href="#1141361" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">class</span> <a title="class TypeAndEqualityCond extends TreeMakerApproximation.this.Cond" id="1134874">TypeAndEqualityCond</a><a href="#1134874" title="TreeMakerApproximation.this.TypeAndEqualityCond" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Tree" id="1141356">testedPath</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Type" id="1141357">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134861" title="TreeMakerApproximation.this.Cond">Cond</a> <span class="delimiter">{</span>
      // def negation         = TopCond // inequality doesn't teach us anything
      // do simplification when we know enough about the tree statically:
      //  - collapse equal trees
      //  - accumulate tests when (in)equality not known statically
      //  - become bottom when we statically know this can never match
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1141355">toString</a> = <a href="../../../Predef.scala.html#8576" title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd">testedPath</a> <a href="../../../runtime/StringAdd.scala.html#60949" title="(other: String)String">+</a><span title="String(&quot; (&lt;: &amp;&amp; ==) &quot;)" class="string">&quot; (&lt;: &amp;&amp; ==) &quot;</span><span title="(x$1: Any)String">+</span> <a href="#1141357" title="PatMatVirtualiser.this.global.Type">pt</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;#&quot;)" class="string">&quot;#&quot;</span><span title="(x$1: Any)String">+</span> <a href="#1141129" title="=&gt; Int">id</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(root: PatMatVirtualiser.this.global.Symbol, cases: List[List[TreeMakerApproximation.this.TreeMaker]])List[List[TreeMakerApproximation.this.Test]]" id="1134875">approximateMatch</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1141378">root</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="List[List[TreeMakerApproximation.this.TreeMaker]]" id="1141379">cases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[TreeMakerApproximation.this.TreeMaker]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[TreeMakerApproximation.this.Test]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Test<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      // a variable in this set should never be replaced by a tree that &quot;does not consist of a selection on a variable in this set&quot; (intuitively)
      <span class="keyword">val</span> <a title="scala.collection.mutable.HashSet[PatMatVirtualiser.this.global.Symbol]" id="1141381">pointsToBound</a>            = collection.mutable.<a href="../../../collection/generic/GenericCompanion.scala.html#60782" title="(elems: PatMatVirtualiser.this.global.Symbol*)scala.collection.mutable.HashSet[PatMatVirtualiser.this.global.Symbol]">HashSet</a><span class="delimiter">(</span><a href="#1141378" title="PatMatVirtualiser.this.global.Symbol">root</a><span class="delimiter">)</span>

      // the substitution that renames variables to variables in pointsToBound
      <span class="keyword">var</span> <a title="TreeMakerApproximation.this.Substitution" id="1141382">normalize</a>: <a href="#1134784" title="TreeMakerApproximation.this.Substitution">Substitution</a>  = <a href="#1134785" title="TreeMakerApproximation.this.EmptySubstitution.type">EmptySubstitution</a>

      // replaces a variable (in pointsToBound) by a selection on another variable in pointsToBound
      // TODO check:
      //   pointsToBound -- accumSubst.from == Set(root) &amp;&amp; (accumSubst.from.toSet -- pointsToBound) isEmpty
      <span class="keyword">var</span> <a title="TreeMakerApproximation.this.Substitution" id="1141383">accumSubst</a>: <a href="#1134784" title="TreeMakerApproximation.this.Substitution">Substitution</a> = <a href="#1134785" title="TreeMakerApproximation.this.EmptySubstitution.type">EmptySubstitution</a>

      <span class="keyword">val</span> <a title="scala.collection.mutable.HashSet[PatMatVirtualiser.this.global.Tree]" id="1141384">trees</a> = <a href="../../../collection/mutable/HashSet.scala.html#141566" title="()scala.collection.mutable.HashSet[PatMatVirtualiser.this.global.Tree]" class="keyword">new</a> collection.mutable.<a href="../../../collection/mutable/HashSet.scala.html#13456" title="scala.collection.mutable.HashSet[PatMatVirtualiser.this.global.Tree]">HashSet</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span>

      <span class="keyword">def</span> <a title="(tm: TreeMakerApproximation.this.TreeMaker)TreeMakerApproximation.this.Test" id="1141385">approximateTreeMaker</a><span class="delimiter">(</span><a title="TreeMakerApproximation.this.TreeMaker" id="1141390">tm</a>: <a href="#1134792" title="TreeMakerApproximation.this.TreeMaker">TreeMaker</a><span class="delimiter">)</span>: <a href="#1141217" title="TreeMakerApproximation.this.Test">Test</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="TreeMakerApproximation.this.Substitution" id="1141391">subst</a> = <a href="#1141390" title="TreeMakerApproximation.this.TreeMaker">tm</a>.<a href="#1135096" title="=&gt; TreeMakerApproximation.this.Substitution">substitution</a>

        // find part of substitution that replaces bound symbols by new symbols, and reverse that part
        // so that we don't introduce new aliases for existing symbols, thus keeping the set of bound symbols minimal
        <span class="keyword">val</span> <a href="#1141504" title="(x: (List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]))(List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])" class="delimiter">(</a><a href="../../../Tuple2.scala.html#61506" title="List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]" id="1141393">boundSubst</a>, <a href="../../../Tuple2.scala.html#61508" title="List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]" id="1141394">unboundSubst</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#1141391" title="TreeMakerApproximation.this.Substitution">subst</a>.<a href="#1137880" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">from</a> <a href="../../../collection/IterableLike.scala.html#59486" title="(that: scala.collection.GenIterable[PatMatVirtualiser.this.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Symbol],(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree),List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]])List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]">zip</a> <a href="#1141391" title="TreeMakerApproximation.this.Substitution">subst</a>.<a href="#1137881" title="=&gt; List[PatMatVirtualiser.this.global.Tree]">to</a><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#58988" title="(p: ((PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)) =&gt; Boolean)(List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)], List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)])">partition</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree),Boolean] with Serializable" id="1141459" class="delimiter">{</a><span class="keyword">case</span> <span class="delimiter">(</span>f, t<span class="delimiter">)</span> =&gt;
            t.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../../../reflect/api/Trees.scala.html#23710" title="PatMatVirtualiser.this.global.Ident">Ident</a><span class="delimiter">]</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span>t.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <a href="#1141482" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../collection/GenSetLike.scala.html#65156" title="(elem: PatMatVirtualiser.this.global.Symbol)Boolean">pointsToBound</a><span class="delimiter">(</span>f<span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="keyword">val</span> <a href="#1141527" title="(x: (List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Tree]))(List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Tree])" class="delimiter">(</a><a href="../../../Tuple2.scala.html#61506" title="List[PatMatVirtualiser.this.global.Symbol]" id="1141396">boundFrom</a>, <a href="../../../Tuple2.scala.html#61508" title="List[PatMatVirtualiser.this.global.Tree]" id="1141397">boundTo</a><span class="delimiter">)</span> = <a href="#1141393" title="List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]">boundSubst</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#59374" title="(implicit asPair: ((PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)) =&gt; (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree))(List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Tree])">unzip</a>
        <a href="#1141382" title="TreeMakerApproximation.this.Substitution">normalize</a> <a href="#1135273" title="(other: TreeMakerApproximation.this.Substitution)TreeMakerApproximation.this.Substitution">&gt;&gt;=</a> <a href="#1137875" title="(from: List[PatMatVirtualiser.this.global.Symbol], to: List[PatMatVirtualiser.this.global.Tree])TreeMakerApproximation.this.Substitution">Substitution</a><span class="delimiter">(</span><a href="#1141397" title="List[PatMatVirtualiser.this.global.Tree]">boundTo</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Symbol)(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Tree],PatMatVirtualiser.this.global.Symbol,List[PatMatVirtualiser.this.global.Symbol]])List[PatMatVirtualiser.this.global.Symbol]">map</a> <span class="delimiter">(</span><a href="#1141558" title="PatMatVirtualiser.this.global.Tree">_</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a><span class="delimiter">)</span>, <a href="#1141396" title="List[PatMatVirtualiser.this.global.Symbol]">boundFrom</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: PatMatVirtualiser.this.global.Symbol =&gt; PatMatVirtualiser.this.global.gen.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Symbol],PatMatVirtualiser.this.global.gen.global.Tree,List[PatMatVirtualiser.this.global.gen.global.Tree]])List[PatMatVirtualiser.this.global.gen.global.Tree]">map</a> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1141602" title="PatMatVirtualiser.this.global.Symbol">_</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        // println(&quot;normalize: &quot;+ normalize)

        <span class="keyword">val</span> <a href="#1141651" title="(x: (List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Tree]))(List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Tree])" class="delimiter">(</a><a href="../../../Tuple2.scala.html#61506" title="List[PatMatVirtualiser.this.global.Symbol]" id="1141399">unboundFrom</a>, <a href="../../../Tuple2.scala.html#61508" title="List[PatMatVirtualiser.this.global.Tree]" id="1141400">unboundTo</a><span class="delimiter">)</span> = <a href="#1141394" title="List[(PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)]">unboundSubst</a> <a href="../../../collection/generic/GenericTraversableTemplate.scala.html#59374" title="(implicit asPair: ((PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree)) =&gt; (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree))(List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Tree])">unzip</a>
        <span class="keyword">val</span> <a title="TreeMakerApproximation.this.Substitution" id="1141401">okSubst</a> = <a href="#1137875" title="(from: List[PatMatVirtualiser.this.global.Symbol], to: List[PatMatVirtualiser.this.global.Tree])TreeMakerApproximation.this.Substitution">Substitution</a><span class="delimiter">(</span><a href="#1141399" title="List[PatMatVirtualiser.this.global.Symbol]">unboundFrom</a>, <a href="#1141400" title="List[PatMatVirtualiser.this.global.Tree]">unboundTo</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Tree],PatMatVirtualiser.this.global.Tree,List[PatMatVirtualiser.this.global.Tree]])List[PatMatVirtualiser.this.global.Tree]">map</a> <span class="delimiter">(</span><a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">normalize</a><span class="delimiter">(</span><a href="#1141679" title="PatMatVirtualiser.this.global.Tree">_</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> // it's important substitution does not duplicate trees here -- it helps to keep hash consing simple, anyway
        <a href="#1141381" title="scala.collection.mutable.HashSet[PatMatVirtualiser.this.global.Symbol]">pointsToBound</a> <a href="../../../collection/generic/Growable.scala.html#60913" title="(xs: scala.collection.TraversableOnce[PatMatVirtualiser.this.global.Symbol])pointsToBound.type">++=</a> <span class="delimiter">(</span><a href="../../../Tuple2.scala.html#63804" title="(_1: List[PatMatVirtualiser.this.global.Symbol], _2: List[PatMatVirtualiser.this.global.Tree])(List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Tree])" class="delimiter">(</a><a href="#1141401" title="TreeMakerApproximation.this.Substitution">okSubst</a>.<a href="#1137880" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">from</a>, <a href="#1141401" title="TreeMakerApproximation.this.Substitution">okSubst</a>.<a href="#1137881" title="=&gt; List[PatMatVirtualiser.this.global.Tree]">to</a><span class="delimiter">)</span>.<a href="../../../Tuple2.scala.html#61522" title="(implicit w1: List[PatMatVirtualiser.this.global.Symbol] =&gt; scala.collection.TraversableLike[PatMatVirtualiser.this.global.Symbol,List[PatMatVirtualiser.this.global.Symbol]], implicit w2: List[PatMatVirtualiser.this.global.Tree] =&gt; scala.collection.IterableLike[PatMatVirtualiser.this.global.Tree,List[PatMatVirtualiser.this.global.Tree]])(List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Tree])#Zipped[List[PatMatVirtualiser.this.global.Symbol],PatMatVirtualiser.this.global.Symbol,List[PatMatVirtualiser.this.global.Tree],PatMatVirtualiser.this.global.Tree]">zipped</a> <a href="../../../Tuple2.scala.html#61562" title="(f: (PatMatVirtualiser.this.global.Symbol, PatMatVirtualiser.this.global.Tree) =&gt; Boolean)(implicit cbf1: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Symbol],PatMatVirtualiser.this.global.Symbol,List[PatMatVirtualiser.this.global.Symbol]], implicit cbf2: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Tree],PatMatVirtualiser.this.global.Tree,List[PatMatVirtualiser.this.global.Tree]])(List[PatMatVirtualiser.this.global.Symbol], List[PatMatVirtualiser.this.global.Tree])">filter</a> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1141757">f</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1141758">t</a><span class="delimiter">)</span> =&gt; <a href="#1141381" title="scala.collection.mutable.HashSet[PatMatVirtualiser.this.global.Symbol]">pointsToBound</a> <a href="../../../collection/IterableLike.scala.html#59462" title="(p: PatMatVirtualiser.this.global.Symbol =&gt; Boolean)Boolean">exists</a> <span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1141764">sym</a> =&gt; <a href="#1141758" title="PatMatVirtualiser.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425081" title="(p: PatMatVirtualiser.this.global.Tree =&gt; Boolean)Boolean">exists</a><span class="delimiter">(</span><a href="#1141767" title="PatMatVirtualiser.this.global.Tree">_</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1141764" title="PatMatVirtualiser.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span><span class="delimiter">)</span>.<a href="../../../Tuple2.scala.html#61506" title="=&gt; List[PatMatVirtualiser.this.global.Symbol]">_1</a>
        // println(&quot;pointsToBound: &quot;+ pointsToBound)

        <a href="#1141383" title="TreeMakerApproximation.this.Substitution">accumSubst</a> <a href="#1135273" title="(other: TreeMakerApproximation.this.Substitution)TreeMakerApproximation.this.Substitution">&gt;&gt;=</a> <a href="#1141401" title="TreeMakerApproximation.this.Substitution">okSubst</a>
        // println(&quot;accumSubst: &quot;+ accumSubst)

        // TODO: improve, e.g., for constants
        <span class="keyword">def</span> <a title="(a: PatMatVirtualiser.this.global.Tree, b: PatMatVirtualiser.this.global.Tree)Boolean" id="1141402">sameValue</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1141830">a</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1141831">b</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span class="delimiter">(</span><a href="#1141830" title="PatMatVirtualiser.this.global.Tree">a</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#1141831" title="PatMatVirtualiser.this.global.Tree">b</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="../../../Tuple2.scala.html#63804" title="(_1: PatMatVirtualiser.this.global.Tree, _2: PatMatVirtualiser.this.global.Tree)(PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Tree)" class="delimiter">(</a><a href="#1141830" title="PatMatVirtualiser.this.global.Tree">a</a>, <a href="#1141831" title="PatMatVirtualiser.this.global.Tree">b</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span class="delimiter">(</span>_ : Ident, _ : Ident<span class="delimiter">)</span> =&gt; <a href="#1141830" title="PatMatVirtualiser.this.global.Tree">a</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a> <a href="#1141848" title="(x: Boolean)Boolean">eq</a> <a href="#1141831" title="PatMatVirtualiser.this.global.Tree">b</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; PatMatVirtualiser.this.global.Symbol">symbol</a>
          <span class="keyword">case</span> _                      =&gt; <a href="#1141848" title="(x: Boolean)Boolean" class="keyword">false</a>
        <span class="delimiter">}</span><span class="delimiter">)</span>

        // hashconsing trees (modulo value-equality)
        <span class="keyword">def</span> <a title="(t: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1141403">unique</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1141853">t</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> =
          <a href="#1141384" title="scala.collection.mutable.HashSet[PatMatVirtualiser.this.global.Tree]">trees</a> <a href="../../../collection/IterableLike.scala.html#59463" title="(p: PatMatVirtualiser.this.global.Tree =&gt; Boolean)Option[PatMatVirtualiser.this.global.Tree]">find</a> <span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1141859">a</a> =&gt; <a href="#1141859" title="PatMatVirtualiser.this.global.Tree">a</a>.<a href="../../../reflect/api/Trees.scala.html#425084" title="(that: PatMatVirtualiser.this.global.Tree)(f: (PatMatVirtualiser.this.global.Tree, PatMatVirtualiser.this.global.Tree) =&gt; Boolean)Boolean">equalsStructure0</a><span class="delimiter">(</span><a href="#1141853" title="PatMatVirtualiser.this.global.Tree">t</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1141402" title="(a: PatMatVirtualiser.this.global.Tree, b: PatMatVirtualiser.this.global.Tree)Boolean">sameValue</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> Some<a href="#1141877" title="PatMatVirtualiser.this.global.Tree" id="1141878" class="delimiter">(</a>orig<span class="delimiter">)</span> =&gt; <a href="#1141879" title="(x: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">orig</a> // println(&quot;unique: &quot;+ (t eq orig, orig));
            <span class="keyword">case</span> _ =&gt; <a href="#1141384" title="scala.collection.mutable.HashSet[PatMatVirtualiser.this.global.Tree]">trees</a> <a href="../../../collection/mutable/HashSet.scala.html#141570" title="(elem: PatMatVirtualiser.this.global.Tree)trees.type">+=</a> <a href="#1141853" title="PatMatVirtualiser.this.global.Tree">t</a>; <a href="#1141853" title="PatMatVirtualiser.this.global.Tree">t</a>
          <span class="delimiter">}</span>

        <span class="keyword">def</span> <a title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type" id="1141404">uniqueTp</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Type" id="1141884">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a> = <a href="#1141884" title="PatMatVirtualiser.this.global.Type">tp</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          // typerefs etc are already hashconsed
          <span class="keyword">case</span> _ : UniqueType                      =&gt; <a href="#1141913" title="(x: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">tp</a>
          <span class="keyword">case</span> tp@RefinedType<a href="#1141906" title="PatMatVirtualiser.this.global.Type" id="1141909" class="delimiter">(</a>parents, <a href="../../../reflect/internal/Scopes.scala.html#441634" title="PatMatVirtualiser.this.global.Type" id="1141912">EmptyScope</a><span class="delimiter">)</span> =&gt; tp.<a href="../../../reflect/internal/Types.scala.html#447268" title="(op1: =&gt; PatMatVirtualiser.this.global.Type)(op2: PatMatVirtualiser.this.global.Type =&gt; PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">memo</a><span class="delimiter">(</span>tp: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span><a href="#1141913" title="(x: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type" class="delimiter">(</a><a href="../../../Predef.scala.html#8444" title="(x: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">identity</a><span class="delimiter">)</span> // TODO: does this help?
          <span class="keyword">case</span> _                                   =&gt; <a href="#1141913" title="(x: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">tp</a>
        <span class="delimiter">}</span>

        <span class="keyword">def</span> <a title="(b: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree" id="1141405">binderToUniqueTree</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1141922">b</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <a href="#1141403" title="(t: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">unique</a><span class="delimiter">(</span><a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">accumSubst</a><span class="delimiter">(</span><a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">normalize</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1141922" title="PatMatVirtualiser.this.global.Symbol">b</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <a href="#1141217" title="(cond: TreeMakerApproximation.this.Cond, treeMaker: TreeMakerApproximation.this.TreeMaker)TreeMakerApproximation.this.Test">Test</a><span class="delimiter">(</span><a href="#1141390" title="TreeMakerApproximation.this.TreeMaker">tm</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> ProductExtractorTreeMaker<a href="#1141951" title="TreeMakerApproximation.this.Cond" id="1141954" class="delimiter">(</a>pb, <a href="../../../Option.scala.html#2498" title="TreeMakerApproximation.this.Cond" id="1141995">None</a>, subst<span class="delimiter">)</span>           =&gt; <a href="#1141996" title="(x: TreeMakerApproximation.this.Cond)TreeMakerApproximation.this.Cond">Top</a> // TODO: NotNullTest(prevBinder)
          <span class="keyword">case</span> tm@TypeTestTreeMaker<a href="#1141951" title="TreeMakerApproximation.this.Cond" id="1141958" class="delimiter">(</a>prevBinder, nextBinderTp, _<span class="delimiter">)</span>    =&gt; <a href="#1141317" title="(testedPath: PatMatVirtualiser.this.global.Tree, pt: PatMatVirtualiser.this.global.Type)TreeMakerApproximation.this.TypeCond">TypeCond</a><a href="#1141996" title="(x: TreeMakerApproximation.this.Cond)TreeMakerApproximation.this.Cond" class="delimiter">(</a><a href="#1141405" title="(b: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">binderToUniqueTree</a><span class="delimiter">(</span>prevBinder<span class="delimiter">)</span>, <a href="#1141404" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">uniqueTp</a><span class="delimiter">(</span>nextBinderTp<span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> tm@TypeAndEqualityTestTreeMaker<a href="#1141951" title="TreeMakerApproximation.this.Cond" id="1141962" class="delimiter">(</a>_, patBinder, pt, _<span class="delimiter">)</span> =&gt; <a href="#1141349" title="(testedPath: PatMatVirtualiser.this.global.Tree, pt: PatMatVirtualiser.this.global.Type)TreeMakerApproximation.this.TypeAndEqualityCond">TypeAndEqualityCond</a><a href="#1141996" title="(x: TreeMakerApproximation.this.Cond)TreeMakerApproximation.this.Cond" class="delimiter">(</a><a href="#1141405" title="(b: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">binderToUniqueTree</a><span class="delimiter">(</span>patBinder<span class="delimiter">)</span>, <a href="#1141404" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">uniqueTp</a><span class="delimiter">(</span>pt<span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> tm@EqualityTestTreeMaker<a href="#1141951" title="TreeMakerApproximation.this.Cond" id="1141965" class="delimiter">(</a>prevBinder, patTree, _<span class="delimiter">)</span>     =&gt; <a href="#1141285" title="(testedPath: PatMatVirtualiser.this.global.Tree, rhs: PatMatVirtualiser.this.global.Tree)TreeMakerApproximation.this.EqualityCond">EqualityCond</a><a href="#1141996" title="(x: TreeMakerApproximation.this.Cond)TreeMakerApproximation.this.Cond" class="delimiter">(</a><a href="#1141405" title="(b: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.Tree">binderToUniqueTree</a><span class="delimiter">(</span>prevBinder<span class="delimiter">)</span>, <a href="#1141403" title="(t: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">unique</a><span class="delimiter">(</span>patTree<span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> ExtractorTreeMaker<a href="#1141951" title="TreeMakerApproximation.this.Cond" id="1141971" class="delimiter">(</a>_, _, _, _<span class="delimiter">)</span>
             | GuardTreeMaker<a href="#1141951" title="Boolean" id="1141974" class="delimiter">(</a>_<span class="delimiter">)</span>
             | ProductExtractorTreeMaker<a href="#1141951" title="Boolean" id="1141979" class="delimiter">(</a>_, Some<a title="Boolean" id="1141981" class="delimiter">(</a>_<span class="delimiter">)</span>, _<span class="delimiter">)</span>             =&gt; <a href="#1141996" title="(x: TreeMakerApproximation.this.Cond)TreeMakerApproximation.this.Cond">Havoc</a>
          <span class="keyword">case</span> AlternativesTreeMaker<a href="#1141951" title="TreeMakerApproximation.this.Cond" id="1141986" class="delimiter">(</a>_, _, _<span class="delimiter">)</span>                       =&gt; <a href="#1141996" title="(x: TreeMakerApproximation.this.Cond)TreeMakerApproximation.this.Cond">Havoc</a> // TODO: can do better here
          <span class="keyword">case</span> SubstOnlyTreeMaker<a href="#1141951" title="TreeMakerApproximation.this.Cond" id="1141990" class="delimiter">(</a>_, _<span class="delimiter">)</span>                             =&gt; <a href="#1141996" title="(x: TreeMakerApproximation.this.Cond)TreeMakerApproximation.this.Cond">Top</a>
          <span class="keyword">case</span> BodyTreeMaker<a href="#1141951" title="TreeMakerApproximation.this.Cond" id="1141994" class="delimiter">(</a>_, _<span class="delimiter">)</span>                                  =&gt; <a href="#1141996" title="(x: TreeMakerApproximation.this.Cond)TreeMakerApproximation.this.Cond">Havoc</a>
        <span class="delimiter">}</span>, <a href="#1141390" title="TreeMakerApproximation.this.TreeMaker">tm</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#1141379" title="List[List[TreeMakerApproximation.this.TreeMaker]]">cases</a>.<a href="../../../collection/TraversableLike.scala.html#58971" title="(f: List[TreeMakerApproximation.this.TreeMaker] =&gt; List[TreeMakerApproximation.this.Test])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[TreeMakerApproximation.this.TreeMaker]],List[TreeMakerApproximation.this.Test],List[List[TreeMakerApproximation.this.Test]]])List[List[TreeMakerApproximation.this.Test]]">map</a> <a href="../../../collection/immutable/List.scala.html#63282" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,List[TreeMakerApproximation.this.Test],List[List[TreeMakerApproximation.this.Test]]]" class="delimiter">{</a> <a href="#1142032" title="List[TreeMakerApproximation.this.TreeMaker]">_</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: TreeMakerApproximation.this.TreeMaker =&gt; TreeMakerApproximation.this.Test)(implicit bf: scala.collection.generic.CanBuildFrom[List[TreeMakerApproximation.this.TreeMaker],TreeMakerApproximation.this.Test,List[TreeMakerApproximation.this.Test]])List[TreeMakerApproximation.this.Test]">map</a> <a href="#1141385" title="(tm: TreeMakerApproximation.this.TreeMaker)TreeMakerApproximation.this.Test">approximateTreeMaker</a> <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

////
  <span class="keyword">trait</span> <a title="trait CommonSubconditionElimination extends Object with PatMatVirtualiser.this.TreeMakerApproximation" id="560245">CommonSubconditionElimination</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#560244" title="PatMatVirtualiser.this.TreeMakerApproximation">TreeMakerApproximation</a> <span class="delimiter">{</span> self: OptimizedCodegen =&gt;
    /** a flow-sensitive, generalised, common sub-expression elimination
     * reuse knowledge from performed tests
     * the only sub-expressions we consider are the conditions and results of the three tests (type, type&amp;equality, equality)
     * when a sub-expression is share, it is stored in a mutable variable
     * the variable is floated up so that its scope includes all of the program that shares it
     * we generalize sharing to implication, where b reuses a if a =&gt; b and priors(a) =&gt; priors(b) (the priors of a sub expression form the path through the decision tree)
     *
     * intended to be generalised to exhaustivity/reachability checking
     */
    <span class="keyword">def</span> <a title="(prevBinder: PatMatVirtualiser.this.global.Symbol, cases: List[List[CommonSubconditionElimination.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type)List[List[CommonSubconditionElimination.this.TreeMaker]]" id="1134878">doCSE</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1142112">prevBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="List[List[CommonSubconditionElimination.this.TreeMaker]]" id="1142113">cases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[CommonSubconditionElimination.this.TreeMaker]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Type" id="1142114">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[CommonSubconditionElimination.this.TreeMaker]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[List[CommonSubconditionElimination.this.Test]]" id="1142116">testss</a> = <a href="#1134875" title="(root: PatMatVirtualiser.this.global.Symbol, cases: List[List[CommonSubconditionElimination.this.TreeMaker]])List[List[CommonSubconditionElimination.this.Test]]">approximateMatch</a><span class="delimiter">(</span><a href="#1142112" title="PatMatVirtualiser.this.global.Symbol">prevBinder</a>, <a href="#1142113" title="List[List[CommonSubconditionElimination.this.TreeMaker]]">cases</a><span class="delimiter">)</span>

      // interpret:
      <span class="keyword">val</span> <a title="scala.collection.mutable.LinkedHashMap[CommonSubconditionElimination.this.Test,Set[CommonSubconditionElimination.this.Cond]]" id="1142117">dependencies</a> = <span title="scala.collection.mutable.LinkedHashMap[CommonSubconditionElimination.this.Test,Set[CommonSubconditionElimination.this.Cond]]" class="keyword">new</span> collection.mutable.<a href="../../../collection/mutable/LinkedHashMap.scala.html#13150" title="scala.collection.mutable.LinkedHashMap[CommonSubconditionElimination.this.Test,Set[CommonSubconditionElimination.this.Cond]]">LinkedHashMap</a><span class="delimiter">[</span>Test, Set<span class="delimiter">[</span>Cond<span class="delimiter">]</span><span class="delimiter">]</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.HashSet[CommonSubconditionElimination.this.Cond]" id="1142118">tested</a> = <a href="../../../collection/mutable/HashSet.scala.html#141566" title="()scala.collection.mutable.HashSet[CommonSubconditionElimination.this.Cond]" class="keyword">new</a> collection.mutable.<a href="../../../collection/mutable/HashSet.scala.html#13456" title="scala.collection.mutable.HashSet[CommonSubconditionElimination.this.Cond]">HashSet</a><span class="delimiter">[</span>Cond<span class="delimiter">]</span>
      <a href="#1142116" title="List[List[CommonSubconditionElimination.this.Test]]">testss</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: List[CommonSubconditionElimination.this.Test] =&gt; List[CommonSubconditionElimination.this.Test])Unit">foreach</a> <span class="delimiter">{</span> <a title="List[CommonSubconditionElimination.this.Test]" id="1142145">tests</a> =&gt;
        <a href="#1142118" title="scala.collection.mutable.HashSet[CommonSubconditionElimination.this.Cond]">tested</a>.<a href="../../../collection/mutable/HashSet.scala.html#141575" title="()Unit">clear</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#1142145" title="List[CommonSubconditionElimination.this.Test]">tests</a> <a href="../../../collection/immutable/List.scala.html#63672" title="(p: CommonSubconditionElimination.this.Test =&gt; Boolean)List[CommonSubconditionElimination.this.Test]">dropWhile</a> <span class="delimiter">{</span> <a title="CommonSubconditionElimination.this.Test" id="1142150">test</a> =&gt;
          <span class="keyword">val</span> <a title="CommonSubconditionElimination.this.Cond" id="1142151">cond</a> = <a href="#1142150" title="CommonSubconditionElimination.this.Test">test</a>.<a href="#1141189" title="=&gt; CommonSubconditionElimination.this.Cond">cond</a>
          <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#1142151" title="CommonSubconditionElimination.this.Cond">cond</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#1141281" title="CommonSubconditionElimination.this.Havoc.type">Havoc</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#1142151" title="CommonSubconditionElimination.this.Cond">cond</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#1141262" title="CommonSubconditionElimination.this.Top.type">Top</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">(</span><a href="#1142151" title="CommonSubconditionElimination.this.Cond">cond</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#1141262" title="CommonSubconditionElimination.this.Top.type">Top</a><span class="delimiter">)</span> // stop when we encounter a havoc, skip top
          <span class="keyword">else</span> <span class="delimiter">{</span>
            <a href="#1142118" title="scala.collection.mutable.HashSet[CommonSubconditionElimination.this.Cond]">tested</a> <a href="../../../collection/mutable/HashSet.scala.html#141570" title="(elem: CommonSubconditionElimination.this.Cond)tested.type">+=</a> <a href="#1142151" title="CommonSubconditionElimination.this.Cond">cond</a>

            // is there an earlier test that checks our condition and whose dependencies are implied by ours?
            <a href="#1142117" title="scala.collection.mutable.LinkedHashMap[CommonSubconditionElimination.this.Test,Set[CommonSubconditionElimination.this.Cond]]">dependencies</a> <a href="../../../collection/IterableLike.scala.html#59463" title="(p: ((CommonSubconditionElimination.this.Test, Set[CommonSubconditionElimination.this.Cond])) =&gt; Boolean)Option[(CommonSubconditionElimination.this.Test, Set[CommonSubconditionElimination.this.Cond])]">find</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[(CommonSubconditionElimination.this.Test, Set[CommonSubconditionElimination.this.Cond]),Boolean] with Serializable" id="1142166" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>priorTest, deps<span class="delimiter">)</span> =&gt;
              <span class="delimiter">(</span><span class="delimiter">(</span>priorTest.<a href="#1141189" title="=&gt; CommonSubconditionElimination.this.Cond">cond</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#1142151" title="CommonSubconditionElimination.this.Cond">cond</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span>deps <a href="../../../collection/SetLike.scala.html#71318" title="(elem: CommonSubconditionElimination.this.Cond)Boolean">contains</a> <a href="#1142151" title="CommonSubconditionElimination.this.Cond">cond</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#1142177" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span>deps <a href="../../../collection/GenSetLike.scala.html#65167" title="(that: scala.collection.GenSet[CommonSubconditionElimination.this.Cond])Boolean">subsetOf</a> <a href="#1142118" title="scala.collection.mutable.HashSet[CommonSubconditionElimination.this.Cond]">tested</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <a href="../../../Option.scala.html#63839" title="(f: ((CommonSubconditionElimination.this.Test, Set[CommonSubconditionElimination.this.Cond])) =&gt; Unit)Unit">foreach</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[(CommonSubconditionElimination.this.Test, Set[CommonSubconditionElimination.this.Cond]),Unit] with Serializable" id="1142191" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>priorTest, deps<span class="delimiter">)</span> =&gt;
              // if so, note the dependency in both tests
              priorTest <a href="#1142200" title="(x: Unit)Unit">registerReuseBy</a> <a href="#1142150" title="CommonSubconditionElimination.this.Test">test</a>
            <span class="delimiter">}</span>

            <a href="../../../collection/mutable/MapLike.scala.html#78496" title="(key: CommonSubconditionElimination.this.Test, value: Set[CommonSubconditionElimination.this.Cond])Unit">dependencies</a><span class="delimiter">(</span><a href="#1142150" title="CommonSubconditionElimination.this.Test">test</a><span class="delimiter">)</span> = <a href="#1142118" title="scala.collection.mutable.HashSet[CommonSubconditionElimination.this.Cond]">tested</a>.<a href="../../../collection/TraversableOnce.scala.html#59181" title="scala.collection.immutable.Set[CommonSubconditionElimination.this.Cond]">toSet</a> // copies
            <span title="Boolean(true)" class="keyword">true</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      // find longest prefix of tests that reuse a prior test, and whose dependent conditions monotonically increase
      // then, collapse these contiguous sequences of reusing tests
      // store the result of the final test and the intermediate results in hoisted mutable variables (TODO: optimize: don't store intermediate results that aren't used)
      // replace each reference to a variable originally bound by a collapsed test by a reference to the hoisted variable
      <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[CommonSubconditionElimination.this.TreeMaker,CommonSubconditionElimination.this.ReusedCondTreeMaker]" id="1142119">reused</a> = <a href="../../../collection/mutable/HashMap.scala.html#79203" title="()scala.collection.mutable.HashMap[CommonSubconditionElimination.this.TreeMaker,CommonSubconditionElimination.this.ReusedCondTreeMaker]" class="keyword">new</a> collection.mutable.<a href="../../../collection/mutable/HashMap.scala.html#12880" title="scala.collection.mutable.HashMap[CommonSubconditionElimination.this.TreeMaker,CommonSubconditionElimination.this.ReusedCondTreeMaker]">HashMap</a><span class="delimiter">[</span>TreeMaker, ReusedCondTreeMaker<span class="delimiter">]</span>
      <span class="keyword">var</span> <a title="Boolean" id="1142120">okToCall</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">val</span> <a title="CommonSubconditionElimination.this.TreeMaker =&gt; CommonSubconditionElimination.this.TreeMaker" id="1142121">reusedOrOrig</a> = <span class="delimiter">(</span>tm: <a href="#1134792" title="CommonSubconditionElimination.this.TreeMaker">TreeMaker</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span><a href="../Global.scala.html#559534" title="(assertion: Boolean)Unit">assert</a><span class="delimiter">(</span><a href="#1142120" title="Boolean">okToCall</a><span class="delimiter">)</span>; <a href="#1142119" title="scala.collection.mutable.HashMap[CommonSubconditionElimination.this.TreeMaker,CommonSubconditionElimination.this.ReusedCondTreeMaker]">reused</a>.<a href="../../../collection/MapLike.scala.html#78417" title="(key: CommonSubconditionElimination.this.TreeMaker, default: =&gt; CommonSubconditionElimination.this.TreeMaker)CommonSubconditionElimination.this.TreeMaker">getOrElse</a><span class="delimiter">(</span><a href="#1142226" title="CommonSubconditionElimination.this.TreeMaker">tm</a>, <a href="#1142226" title="CommonSubconditionElimination.this.TreeMaker">tm</a><span class="delimiter">)</span><span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="List[List[CommonSubconditionElimination.this.TreeMaker]]" id="1142122">res</a> = <a href="#1142116" title="List[List[CommonSubconditionElimination.this.Test]]">testss</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: List[CommonSubconditionElimination.this.Test] =&gt; List[CommonSubconditionElimination.this.TreeMaker])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[CommonSubconditionElimination.this.Test]],List[CommonSubconditionElimination.this.TreeMaker],List[List[CommonSubconditionElimination.this.TreeMaker]]])List[List[CommonSubconditionElimination.this.TreeMaker]]">map</a> <span class="delimiter">{</span> <a title="List[CommonSubconditionElimination.this.Test]" id="1142283">tests</a> =&gt;
        <span class="keyword">var</span> <a title="scala.collection.immutable.Set[CommonSubconditionElimination.this.Cond]" id="1142284">currDeps</a> = <a href="../../../collection/generic/GenericCompanion.scala.html#60782" title="[A](elems: A*)scala.collection.immutable.Set[A]">Set</a><span title="(elems: CommonSubconditionElimination.this.Cond*)scala.collection.immutable.Set[CommonSubconditionElimination.this.Cond]" class="delimiter">[</span><a href="#1134861" title="CommonSubconditionElimination.this.Cond">Cond</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a href="#1142341" title="(x: (List[CommonSubconditionElimination.this.Test], List[CommonSubconditionElimination.this.Test]))(List[CommonSubconditionElimination.this.Test], List[CommonSubconditionElimination.this.Test])" class="delimiter">(</a><a href="../../../Tuple2.scala.html#61506" title="List[CommonSubconditionElimination.this.Test]" id="1142286">sharedPrefix</a>, <a href="../../../Tuple2.scala.html#61508" title="List[CommonSubconditionElimination.this.Test]" id="1142287">suffix</a><span class="delimiter">)</span> = <a href="#1142283" title="List[CommonSubconditionElimination.this.Test]">tests</a> <a href="../../../collection/immutable/List.scala.html#63673" title="(p: CommonSubconditionElimination.this.Test =&gt; Boolean)(List[CommonSubconditionElimination.this.Test], List[CommonSubconditionElimination.this.Test])">span</a> <span class="delimiter">{</span> <a title="CommonSubconditionElimination.this.Test" id="1142295">test</a> =&gt;
          <span class="delimiter">(</span><a href="#1142295" title="CommonSubconditionElimination.this.Test">test</a>.<a href="#1141189" title="=&gt; CommonSubconditionElimination.this.Cond">cond</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#1141262" title="CommonSubconditionElimination.this.Top.type">Top</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><span class="keyword">for</span><span class="delimiter">(</span>
              <a title="CommonSubconditionElimination.this.Test" id="1142300">reusedTest</a> &lt;- <a href="#1142295" title="CommonSubconditionElimination.this.Test">test</a>.<a href="../../../Option.scala.html#63826" title="(f: CommonSubconditionElimination.this.Test =&gt; Option[CommonSubconditionElimination.this.Cond])Option[CommonSubconditionElimination.this.Cond]">reuses</a>;
              <a title="Set[CommonSubconditionElimination.this.Cond]" id="1142308">nextDeps</a> &lt;- <a href="#1142117" title="scala.collection.mutable.LinkedHashMap[CommonSubconditionElimination.this.Test,Set[CommonSubconditionElimination.this.Cond]]">dependencies</a>.<a href="../../../collection/mutable/LinkedHashMap.scala.html#292389" title="(key: CommonSubconditionElimination.this.Test)Option[Set[CommonSubconditionElimination.this.Cond]]">get</a><a href="../../../Option.scala.html#63826" title="(f: Set[CommonSubconditionElimination.this.Cond] =&gt; Option[CommonSubconditionElimination.this.Cond])Option[CommonSubconditionElimination.this.Cond]" class="delimiter">(</a><a href="#1142300" title="CommonSubconditionElimination.this.Test">reusedTest</a><span class="delimiter">)</span>;
              <a title="CommonSubconditionElimination.this.Cond" id="1142314">diff</a> &lt;- <span class="delimiter">(</span><a href="#1142308" title="Set[CommonSubconditionElimination.this.Cond]">nextDeps</a> <a href="../../../collection/generic/Subtractable.scala.html#67913" title="(xs: scala.collection.GenTraversableOnce[CommonSubconditionElimination.this.Cond])scala.collection.immutable.Set[CommonSubconditionElimination.this.Cond]">--</a> <a href="#1142284" title="scala.collection.immutable.Set[CommonSubconditionElimination.this.Cond]">currDeps</a><span class="delimiter">)</span>.<a href="../../../Option.scala.html#63826" title="(f: CommonSubconditionElimination.this.Cond =&gt; Option[CommonSubconditionElimination.this.Cond])Option[CommonSubconditionElimination.this.Cond]">headOption</a>;
              <a title="Unit" id="1142322">_</a> &lt;- <a href="../../../Option.scala.html#64111" title="(x: Unit)Some[Unit]">Some</a><a href="../../../Option.scala.html#63820" title="(f: Unit =&gt; CommonSubconditionElimination.this.Cond)Option[CommonSubconditionElimination.this.Cond]" class="delimiter">(</a><a href="#1142284" title="scala.collection.immutable.Set[CommonSubconditionElimination.this.Cond]">currDeps</a> = <a href="#1142308" title="Set[CommonSubconditionElimination.this.Cond]">nextDeps</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="keyword">yield</span> <a href="#1142314" title="CommonSubconditionElimination.this.Cond">diff</a><span class="delimiter">)</span>.<a href="../../../Option.scala.html#63834" title="=&gt; Boolean">nonEmpty</a>
        <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="Option[List[CommonSubconditionElimination.this.TreeMaker]]" id="1142288">collapsedTreeMakers</a> = <span title="Option[List[CommonSubconditionElimination.this.TreeMaker]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1142286" title="List[CommonSubconditionElimination.this.Test]">sharedPrefix</a>.<a href="../../../collection/TraversableOnce.scala.html#59102" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span> // even sharing prefixes of length 1 brings some benefit (overhead-percentage for compiler: 26-&gt;24%, lib: 19-&gt;16%)
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="CommonSubconditionElimination.this.Test" id="1142364">test</a> &lt;- <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: CommonSubconditionElimination.this.Test =&gt; Unit)Unit">sharedPrefix</a>; reusedTest &lt;- <a href="#1142364" title="CommonSubconditionElimination.this.Test">test</a>.<a href="../../../Option.scala.html#63839" title="(f: CommonSubconditionElimination.this.Test =&gt; Unit)Unit">reuses</a><span class="delimiter">)</span> <a href="#1142371" title="CommonSubconditionElimination.this.Test">reusedTest</a>.<a href="#1141190" title="=&gt; CommonSubconditionElimination.this.TreeMaker">treeMaker</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#1142386" title="Unit" id="1142388">reusedCTM</a>: CondTreeMaker =&gt; <a href="../../../collection/mutable/HashMap.scala.html#79209" title="(key: CommonSubconditionElimination.this.TreeMaker, value: CommonSubconditionElimination.this.ReusedCondTreeMaker)Unit">reused</a><span class="delimiter">(</span>reusedCTM<span class="delimiter">)</span> = <a href="#1142378" title="(orig: CommonSubconditionElimination.this.CondTreeMaker)CommonSubconditionElimination.this.ReusedCondTreeMaker">ReusedCondTreeMaker</a><span class="delimiter">(</span>reusedCTM<span class="delimiter">)</span>
            <span class="keyword">case</span> _ =&gt;
          <span class="delimiter">}</span>

          // println(&quot;sharedPrefix: &quot;+ sharedPrefix)
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="CommonSubconditionElimination.this.Test" id="1142419">lastShared</a> &lt;- <a href="#1142286" title="List[CommonSubconditionElimination.this.Test]">sharedPrefix</a>.<a href="../../../collection/immutable/List.scala.html#63674" title="=&gt; List[CommonSubconditionElimination.this.Test]">reverse</a>.<a href="../../../collection/immutable/List.scala.html#63672" title="(p: CommonSubconditionElimination.this.Test =&gt; Boolean)List[CommonSubconditionElimination.this.Test]">dropWhile</a><span class="delimiter">(</span><a href="#1142414" title="CommonSubconditionElimination.this.Test">_</a>.<a href="#1141189" title="=&gt; CommonSubconditionElimination.this.Cond">cond</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#1141262" title="CommonSubconditionElimination.this.Top.type">Top</a><span class="delimiter">)</span>.<a href="../../../Option.scala.html#63826" title="(f: CommonSubconditionElimination.this.Test =&gt; Option[List[CommonSubconditionElimination.this.TreeMaker]])Option[List[CommonSubconditionElimination.this.TreeMaker]]">headOption</a>;
               <a title="CommonSubconditionElimination.this.Test" id="1142424">lastReused</a> &lt;- <a href="#1142419" title="CommonSubconditionElimination.this.Test">lastShared</a>.<a href="../../../Option.scala.html#63820" title="(f: CommonSubconditionElimination.this.Test =&gt; List[CommonSubconditionElimination.this.TreeMaker])Option[List[CommonSubconditionElimination.this.TreeMaker]]">reuses</a><span class="delimiter">)</span>
            <span class="keyword">yield</span> <a href="#1143263" title="(sharedPrefix: List[CommonSubconditionElimination.this.Test], toReused: CommonSubconditionElimination.this.TreeMaker =&gt; CommonSubconditionElimination.this.TreeMaker)CommonSubconditionElimination.this.ReusingCondTreeMaker">ReusingCondTreeMaker</a><span class="delimiter">(</span><a href="#1142286" title="List[CommonSubconditionElimination.this.Test]">sharedPrefix</a>, <a href="#1142121" title="CommonSubconditionElimination.this.TreeMaker =&gt; CommonSubconditionElimination.this.TreeMaker">reusedOrOrig</a><span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#63643" title="(x: CommonSubconditionElimination.this.TreeMaker)List[CommonSubconditionElimination.this.TreeMaker]">::</a> <a href="#1142287" title="List[CommonSubconditionElimination.this.Test]">suffix</a>.<a href="../../../collection/TraversableLike.scala.html#58971" title="(f: CommonSubconditionElimination.this.Test =&gt; CommonSubconditionElimination.this.TreeMaker)(implicit bf: scala.collection.generic.CanBuildFrom[List[CommonSubconditionElimination.this.Test],CommonSubconditionElimination.this.TreeMaker,List[CommonSubconditionElimination.this.TreeMaker]])List[CommonSubconditionElimination.this.TreeMaker]">map</a><a href="../../../collection/immutable/List.scala.html#63282" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,CommonSubconditionElimination.this.TreeMaker,List[CommonSubconditionElimination.this.TreeMaker]]" class="delimiter">(</a><a href="#1142466" title="CommonSubconditionElimination.this.Test">_</a>.<a href="#1141190" title="=&gt; CommonSubconditionElimination.this.TreeMaker">treeMaker</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>

        <a href="#1142288" title="Option[List[CommonSubconditionElimination.this.TreeMaker]]">collapsedTreeMakers</a> <a href="../../../Option.scala.html#63814" title="(default: =&gt; List[CommonSubconditionElimination.this.TreeMaker])List[CommonSubconditionElimination.this.TreeMaker]">getOrElse</a> <a href="#1142283" title="List[CommonSubconditionElimination.this.Test]">tests</a>.<a href="../../../collection/TraversableLike.scala.html#58971" title="(f: CommonSubconditionElimination.this.Test =&gt; CommonSubconditionElimination.this.TreeMaker)(implicit bf: scala.collection.generic.CanBuildFrom[List[CommonSubconditionElimination.this.Test],CommonSubconditionElimination.this.TreeMaker,List[CommonSubconditionElimination.this.TreeMaker]])List[CommonSubconditionElimination.this.TreeMaker]">map</a><a href="../../../collection/immutable/List.scala.html#63282" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,CommonSubconditionElimination.this.TreeMaker,List[CommonSubconditionElimination.this.TreeMaker]]" class="delimiter">(</a><a href="#1142521" title="CommonSubconditionElimination.this.Test">_</a>.<a href="#1141190" title="=&gt; CommonSubconditionElimination.this.TreeMaker">treeMaker</a><span class="delimiter">)</span> // sharedPrefix need not be empty (but it only contains Top-tests, which are dropped above)
      <span class="delimiter">}</span>
      <a href="#1142120" title="Boolean">okToCall</a> = <span title="Boolean(true)" class="keyword">true</span> // TODO: remove (debugging)

      <a href="#1142122" title="List[List[CommonSubconditionElimination.this.TreeMaker]]">res</a> <a href="../../../collection/immutable/List.scala.html#63652" title="(f: List[CommonSubconditionElimination.this.TreeMaker] =&gt; List[CommonSubconditionElimination.this.TreeMaker])List[List[CommonSubconditionElimination.this.TreeMaker]]">mapConserve</a> <span class="delimiter">(</span><a href="#1142585" title="List[CommonSubconditionElimination.this.TreeMaker]">_</a> <a href="../../../collection/immutable/List.scala.html#63652" title="(f: CommonSubconditionElimination.this.TreeMaker =&gt; CommonSubconditionElimination.this.TreeMaker)List[CommonSubconditionElimination.this.TreeMaker]">mapConserve</a> <a href="#1142121" title="CommonSubconditionElimination.this.TreeMaker =&gt; CommonSubconditionElimination.this.TreeMaker">reusedOrOrig</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">object</span> <a title="CommonSubconditionElimination.this.ReusedCondTreeMaker.type" id="1134879">ReusedCondTreeMaker</a> <a href="#1134880" title="CommonSubconditionElimination.this.ReusedCondTreeMaker.type" class="delimiter">{</a>
      <span class="keyword">def</span> <a title="(orig: CommonSubconditionElimination.this.CondTreeMaker)CommonSubconditionElimination.this.ReusedCondTreeMaker" id="1142378">apply</a><span class="delimiter">(</span><a title="CommonSubconditionElimination.this.CondTreeMaker" id="1142379">orig</a>: <a href="#1134804" title="CommonSubconditionElimination.this.CondTreeMaker">CondTreeMaker</a><span class="delimiter">)</span> = <span title="CommonSubconditionElimination.this.ReusedCondTreeMaker" class="keyword">new</span> <a href="#1134881" title="CommonSubconditionElimination.this.ReusedCondTreeMaker">ReusedCondTreeMaker</a><span class="delimiter">(</span><a href="#1142379" title="CommonSubconditionElimination.this.CondTreeMaker">orig</a>.<a href="#1135961" title="=&gt; PatMatVirtualiser.this.global.Symbol">prevBinder</a>, <a href="#1142379" title="CommonSubconditionElimination.this.CondTreeMaker">orig</a>.<a href="#1135965" title="=&gt; PatMatVirtualiser.this.global.TermSymbol">nextBinder</a>, <a href="#1142379" title="CommonSubconditionElimination.this.CondTreeMaker">orig</a>.<a href="#1135963" title="=&gt; PatMatVirtualiser.this.global.Tree">cond</a>, <a href="#1142379" title="CommonSubconditionElimination.this.CondTreeMaker">orig</a>.<a href="#1135964" title="=&gt; PatMatVirtualiser.this.global.Tree">res</a>, <a href="#1142379" title="CommonSubconditionElimination.this.CondTreeMaker">orig</a>.<a href="#1135960" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">class</span> <a title="class ReusedCondTreeMaker extends CommonSubconditionElimination.this.TreeMaker" id="1134881">ReusedCondTreeMaker</a><a href="#1134881" title="CommonSubconditionElimination.this.ReusedCondTreeMaker" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Symbol" id="1142380">prevBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Symbol" id="1142381">nextBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1142382">cond</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1142383">res</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Position" id="1142384">pos</a>: <a href="../util/Position.scala.html#52230" title="PatMatVirtualiser.this.global.Position">Position</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134792" title="CommonSubconditionElimination.this.TreeMaker">TreeMaker</a> <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="CommonSubconditionElimination.this.Substitution" id="1142259">localSubstitution</a>        = <a href="#1137875" title="(from: List[PatMatVirtualiser.this.global.Symbol], to: List[PatMatVirtualiser.this.global.Tree])CommonSubconditionElimination.this.Substitution">Substitution</a><span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.Symbol*)List[PatMatVirtualiser.this.global.Symbol]">List</a><span class="delimiter">(</span><a href="#1142380" title="PatMatVirtualiser.this.global.Symbol">prevBinder</a><span class="delimiter">)</span>, <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.gen.global.Tree*)List[PatMatVirtualiser.this.global.gen.global.Tree]">List</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1142381" title="=&gt; PatMatVirtualiser.this.global.Symbol">nextBinder</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermSymbol" id="1142261">storedCond</a>               = <a href="#1134720" title="(pos: PatMatVirtualiser.this.global.Position, tp: PatMatVirtualiser.this.global.Type, prefix: String)PatMatVirtualiser.this.global.TermSymbol">freshSym</a><span class="delimiter">(</span><a href="#1142384" title="PatMatVirtualiser.this.global.Position">pos</a>, <a href="../../../reflect/internal/Definitions.scala.html#442857" title="=&gt; PatMatVirtualiser.this.global.ClassSymbol">BooleanClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>, <span title="String(&quot;rc&quot;)" class="string">&quot;rc&quot;</span><span class="delimiter">)</span> <a href="../../../reflect/internal/Symbols.scala.html#443305" title="(mask: Long)PatMatVirtualiser.this.global.TermSymbol">setFlag</a> <span title="Long(4096L)">MUTABLE</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[PatMatVirtualiser.this.global.Tree]" id="1142263">treesToHoist</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = <span class="delimiter">{</span>
        <a href="#1142381" title="=&gt; PatMatVirtualiser.this.global.Symbol">nextBinder</a> <a href="../../../reflect/internal/Symbols.scala.html#443305" title="(mask: Long)ReusedCondTreeMaker.this.nextBinder.type">setFlag</a> <span title="Long(4096L)">MUTABLE</span>
        <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.Symbol*)List[PatMatVirtualiser.this.global.Symbol]">List</a><span class="delimiter">(</span><a href="#1142260" title="=&gt; PatMatVirtualiser.this.global.TermSymbol">storedCond</a>, <a href="#1142381" title="=&gt; PatMatVirtualiser.this.global.Symbol">nextBinder</a><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: PatMatVirtualiser.this.global.Symbol =&gt; PatMatVirtualiser.this.global.ValDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Symbol],PatMatVirtualiser.this.global.ValDef,List[PatMatVirtualiser.this.global.Tree]])List[PatMatVirtualiser.this.global.Tree]">map</a> <span class="delimiter">{</span> <a title="PatMatVirtualiser.this.global.Symbol" id="1142653">b</a> =&gt; <a href="../ast/TreeDSL.scala.html#653627" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.CODE.ValSymStart">VAL</a><span class="delimiter">(</span><a href="#1142653" title="PatMatVirtualiser.this.global.Symbol">b</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#692482" title="(rhs: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.ValDef">===</a> <a href="#1134904" title="=&gt; CommonSubconditionElimination.this.AbsCodegen">codegen</a>.<a href="#1137197" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Tree">mkZero</a><span class="delimiter">(</span><a href="#1142653" title="PatMatVirtualiser.this.global.Symbol">b</a>.<a href="../../../reflect/internal/Symbols.scala.html#443427" title="=&gt; PatMatVirtualiser.this.global.Type">info</a><span class="delimiter">)</span> <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      // TODO: finer-grained duplication
      <span class="keyword">def</span> <a title="(next: PatMatVirtualiser.this.global.Tree)(casegen: CommonSubconditionElimination.this.Casegen)PatMatVirtualiser.this.global.Tree" id="1142264">chainBefore</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1142699">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="CommonSubconditionElimination.this.Casegen" id="1142700">casegen</a>: <a href="#1134722" title="CommonSubconditionElimination.this.Casegen">Casegen</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = // assert(codegen eq optimizedCodegen)
        <a href="../../../reflect/internal/Positions.scala.html#441889" title="(pos: PatMatVirtualiser.this.global.Position)(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">atPos</a><span class="delimiter">(</span><a href="#1142384" title="PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1142700" title="CommonSubconditionElimination.this.Casegen">casegen</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="CommonSubconditionElimination.this.optimizedCodegen.OptimizedCasegen" class="delimiter">[</span>optimizedCodegen.<a href="#1142710" title="CommonSubconditionElimination.this.optimizedCodegen.OptimizedCasegen">OptimizedCasegen</a><span class="delimiter">]</span>.<a href="#1142724" title="(cond: PatMatVirtualiser.this.global.Tree, condSym: PatMatVirtualiser.this.global.Symbol, res: PatMatVirtualiser.this.global.Tree, nextBinder: PatMatVirtualiser.this.global.Symbol, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">flatMapCondStored</a><span class="delimiter">(</span><a href="#1142382" title="PatMatVirtualiser.this.global.Tree">cond</a>, <a href="#1142260" title="=&gt; PatMatVirtualiser.this.global.TermSymbol">storedCond</a>, <a href="#1142383" title="PatMatVirtualiser.this.global.Tree">res</a>, <a href="#1142381" title="=&gt; PatMatVirtualiser.this.global.Symbol">nextBinder</a>, <a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">substitution</a><span class="delimiter">(</span><a href="#1142699" title="PatMatVirtualiser.this.global.Tree">next</a><span class="delimiter">)</span>.<a href="../../../reflect/api/Trees.scala.html#425086" title="=&gt; PatMatVirtualiser.this.global.Tree">duplicate</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    case <span class="keyword">class</span> <a title="class ReusingCondTreeMaker extends CommonSubconditionElimination.this.TreeMaker with Product with Serializable" id="1143263">ReusingCondTreeMaker</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="List[CommonSubconditionElimination.this.Test]" id="1142444">sharedPrefix</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[CommonSubconditionElimination.this.Test]">List</a><span class="delimiter">[</span>Test<span class="delimiter">]</span>, <a title="CommonSubconditionElimination.this.TreeMaker =&gt; CommonSubconditionElimination.this.TreeMaker" id="1142445">toReused</a>: TreeMaker =&gt; TreeMaker<span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134792" title="CommonSubconditionElimination.this.TreeMaker">TreeMaker</a> <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker])]" id="1142438">dropped_priors</a> = <a href="#1142444" title="=&gt; List[CommonSubconditionElimination.this.Test]">sharedPrefix</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: CommonSubconditionElimination.this.Test =&gt; (CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker]))(implicit bf: scala.collection.generic.CanBuildFrom[List[CommonSubconditionElimination.this.Test],(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker]),List[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker])]])List[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker])]">map</a> <span class="delimiter">(</span><a title="CommonSubconditionElimination.this.Test" id="1142756">t</a> =&gt; <a href="../../../Tuple2.scala.html#63804" title="(_1: CommonSubconditionElimination.this.TreeMaker, _2: Option[CommonSubconditionElimination.this.TreeMaker])(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker])" class="delimiter">(</a><a href="../../../Function1.scala.html#59555" title="(v1: CommonSubconditionElimination.this.TreeMaker)CommonSubconditionElimination.this.TreeMaker">toReused</a><span class="delimiter">(</span><a href="#1142756" title="CommonSubconditionElimination.this.Test">t</a>.<a href="#1141190" title="=&gt; CommonSubconditionElimination.this.TreeMaker">treeMaker</a><span class="delimiter">)</span>, <a href="#1142756" title="CommonSubconditionElimination.this.Test">t</a>.<a href="#1141114" title="=&gt; Option[CommonSubconditionElimination.this.Test]">reuses</a> <a href="../../../Option.scala.html#63820" title="(f: CommonSubconditionElimination.this.Test =&gt; CommonSubconditionElimination.this.TreeMaker)Option[CommonSubconditionElimination.this.TreeMaker]">map</a> <span class="delimiter">(</span><a title="CommonSubconditionElimination.this.Test" id="1142765">test</a> =&gt; <a href="../../../Function1.scala.html#59555" title="(v1: CommonSubconditionElimination.this.TreeMaker)CommonSubconditionElimination.this.TreeMaker">toReused</a><span class="delimiter">(</span><a href="#1142765" title="CommonSubconditionElimination.this.Test">test</a>.<a href="#1141190" title="=&gt; CommonSubconditionElimination.this.TreeMaker">treeMaker</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="CommonSubconditionElimination.this.Substitution" id="1142440">localSubstitution</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a href="#1142955" title="(x: (List[PatMatVirtualiser.this.global.TermSymbol], List[PatMatVirtualiser.this.global.gen.global.Tree]))(List[PatMatVirtualiser.this.global.TermSymbol], List[PatMatVirtualiser.this.global.gen.global.Tree])" class="delimiter">(</a><a href="../../../Tuple2.scala.html#61506" title="List[PatMatVirtualiser.this.global.TermSymbol]" id="1142798">from</a>, <a href="../../../Tuple2.scala.html#61508" title="List[PatMatVirtualiser.this.global.gen.global.Tree]" id="1142799">to</a><span class="delimiter">)</span> = <a href="#1142437" title="=&gt; List[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker])]">dropped_priors</a>.<a href="../../../collection/TraversableLike.scala.html#58983" title="(pf: PartialFunction[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker]),(PatMatVirtualiser.this.global.TermSymbol, PatMatVirtualiser.this.global.gen.global.Tree)])(implicit bf: scala.collection.generic.CanBuildFrom[List[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker])],(PatMatVirtualiser.this.global.TermSymbol, PatMatVirtualiser.this.global.gen.global.Tree),List[(PatMatVirtualiser.this.global.TermSymbol, PatMatVirtualiser.this.global.gen.global.Tree)]])List[(PatMatVirtualiser.this.global.TermSymbol, PatMatVirtualiser.this.global.gen.global.Tree)]">collect</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker]),(PatMatVirtualiser.this.global.TermSymbol, PatMatVirtualiser.this.global.gen.global.Tree)] with Serializable" id="1142844" class="delimiter">{</a>
          <span class="keyword">case</span> <span class="delimiter">(</span>dropped: CondTreeMaker, Some<a title="B1" id="1142855" class="delimiter">(</a>prior: ReusedCondTreeMaker<span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
            <a href="#1142840" title="(x: B1)B1" class="delimiter">(</a>dropped.<a href="#1135965" title="=&gt; PatMatVirtualiser.this.global.TermSymbol">nextBinder</a>, <a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span>prior.<a href="#1142381" title="=&gt; PatMatVirtualiser.this.global.Symbol">nextBinder</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#59374" title="(implicit asPair: ((PatMatVirtualiser.this.global.TermSymbol, PatMatVirtualiser.this.global.gen.global.Tree)) =&gt; (PatMatVirtualiser.this.global.TermSymbol, PatMatVirtualiser.this.global.gen.global.Tree))(List[PatMatVirtualiser.this.global.TermSymbol], List[PatMatVirtualiser.this.global.gen.global.Tree])">unzip</a>
        <span class="keyword">val</span> <a title="List[CommonSubconditionElimination.this.Substitution]" id="1142800">oldSubs</a> = <a href="#1142437" title="=&gt; List[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker])]">dropped_priors</a>.<a href="../../../collection/TraversableLike.scala.html#58983" title="(pf: PartialFunction[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker]),CommonSubconditionElimination.this.Substitution])(implicit bf: scala.collection.generic.CanBuildFrom[List[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker])],CommonSubconditionElimination.this.Substitution,List[CommonSubconditionElimination.this.Substitution]])List[CommonSubconditionElimination.this.Substitution]">collect</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker]),CommonSubconditionElimination.this.Substitution] with Serializable" id="1142985" class="delimiter">{</a>
          <span class="keyword">case</span> <span class="delimiter">(</span>dropped: TreeMaker, _<span class="delimiter">)</span> =&gt;
            dropped.<a href="#1142981" title="(x: B1)B1">substitution</a>
          <span class="delimiter">}</span>
        <a href="#1142800" title="List[CommonSubconditionElimination.this.Substitution]">oldSubs</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76173" title="(z: CommonSubconditionElimination.this.Substitution)(f: (CommonSubconditionElimination.this.Substitution, CommonSubconditionElimination.this.Substitution) =&gt; CommonSubconditionElimination.this.Substitution)CommonSubconditionElimination.this.Substitution">foldLeft</a><span class="delimiter">(</span><a href="#1137875" title="(from: List[PatMatVirtualiser.this.global.Symbol], to: List[PatMatVirtualiser.this.global.Tree])CommonSubconditionElimination.this.Substitution">Substitution</a><span class="delimiter">(</span><a href="#1142798" title="List[PatMatVirtualiser.this.global.TermSymbol]">from</a>, <a href="#1142799" title="List[PatMatVirtualiser.this.global.gen.global.Tree]">to</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1143093" title="CommonSubconditionElimination.this.Substitution">_</a> <a href="#1135273" title="(other: CommonSubconditionElimination.this.Substitution)CommonSubconditionElimination.this.Substitution">&gt;&gt;</a> <a href="#1143094" title="CommonSubconditionElimination.this.Substitution">_</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(next: PatMatVirtualiser.this.global.Tree)(casegen: CommonSubconditionElimination.this.Casegen)PatMatVirtualiser.this.global.Tree" id="1142441">chainBefore</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1143096">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="CommonSubconditionElimination.this.Casegen" id="1143097">casegen</a>: <a href="#1134722" title="CommonSubconditionElimination.this.Casegen">Casegen</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.gen.global.Tree" id="1143100">cond</a> = <a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1142437" title="=&gt; List[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker])]">dropped_priors</a>.<a href="../../../collection/immutable/List.scala.html#63674" title="=&gt; List[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker])]">reverse</a>.<a href="../../../collection/TraversableOnce.scala.html#59104" title="(pf: PartialFunction[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker]),CommonSubconditionElimination.this.ReusedCondTreeMaker])Option[CommonSubconditionElimination.this.ReusedCondTreeMaker]">collectFirst</a><a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[(CommonSubconditionElimination.this.TreeMaker, Option[CommonSubconditionElimination.this.TreeMaker]),CommonSubconditionElimination.this.ReusedCondTreeMaker] with Serializable" id="1143128" class="delimiter">{</a><span class="keyword">case</span> <span class="delimiter">(</span>_, Some<a title="B1" id="1143138" class="delimiter">(</a>ctm: ReusedCondTreeMaker<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#1143124" title="(x: B1)B1">ctm</a><span class="delimiter">}</span>.<a href="../../../Option.scala.html#63813" title="=&gt; CommonSubconditionElimination.this.ReusedCondTreeMaker">get</a>.<a href="#1142260" title="=&gt; PatMatVirtualiser.this.global.TermSymbol">storedCond</a><span class="delimiter">)</span>

        // TODO: finer-grained duplication -- MUST duplicate though, or we'll get VerifyErrors since sharing trees confuses lambdalift, and its confusion it emits illegal casts (diagnosed by Grzegorz: checkcast T ; invokevirtual S.m, where T not a subtype of S)
        <a href="#1143097" title="CommonSubconditionElimination.this.Casegen">casegen</a>.<a href="#1138811" title="(c: PatMatVirtualiser.this.global.Tree, then: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">ifThenElseZero</a><span class="delimiter">(</span><a href="#1143100" title="PatMatVirtualiser.this.global.gen.global.Tree">cond</a>, <a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">substitution</a><span class="delimiter">(</span><a href="#1143096" title="PatMatVirtualiser.this.global.Tree">next</a><span class="delimiter">)</span>.<a href="../../../reflect/api/Trees.scala.html#425086" title="=&gt; PatMatVirtualiser.this.global.Tree">duplicate</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  //// DCE
  <span class="keyword">trait</span> <a title="trait DeadCodeElimination extends Object with PatMatVirtualiser.this.TreeMakers" id="560246">DeadCodeElimination</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#560240" title="PatMatVirtualiser.this.TreeMakers">TreeMakers</a> <span class="delimiter">{</span> self: CodegenCore =&gt;
    // TODO: non-trivial dead-code elimination
    // e.g., the following match should compile to a simple instanceof:
    //   case class Ident(name: String)
    //   for (Ident(name) &lt;- ts) println(name)
    <span class="keyword">def</span> <a title="(prevBinder: PatMatVirtualiser.this.global.Symbol, cases: List[List[DeadCodeElimination.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type)List[List[DeadCodeElimination.this.TreeMaker]]" id="1134890">doDCE</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1143267">prevBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="List[List[DeadCodeElimination.this.TreeMaker]]" id="1143268">cases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[DeadCodeElimination.this.TreeMaker]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Type" id="1143269">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[DeadCodeElimination.this.TreeMaker]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      // do minimal DCE
      <a href="#1143268" title="List[List[DeadCodeElimination.this.TreeMaker]]">cases</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  //// SWITCHES -- TODO: operate on Tests rather than TreeMakers
  <span class="keyword">trait</span> <a title="trait SwitchEmission extends Object with PatMatVirtualiser.this.TreeMakers with PatMatVirtualiser.this.OptimizedMatchMonadInterface" id="560247">SwitchEmission</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#560240" title="PatMatVirtualiser.this.TreeMakers">TreeMakers</a> <span class="keyword">with</span> <a href="#560248" title="PatMatVirtualiser.this.OptimizedMatchMonadInterface">OptimizedMatchMonadInterface</a> <span class="delimiter">{</span> self: CodegenCore =&gt;
    <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class SwitchMaker extends Object" id="1134893">SwitchMaker</a> <a href="#1134893" title="SwitchEmission.this.SwitchMaker" class="delimiter">{</a>
      <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class SwitchableTreeMakerExtractor extends Object" id="1143276">SwitchableTreeMakerExtractor</a> <a href="#1143276" title="SwitchMaker.this.SwitchableTreeMakerExtractor" class="delimiter">{</a> <span class="keyword">def</span> <a title="(x: SwitchEmission.this.TreeMaker)Option[PatMatVirtualiser.this.global.Tree]" id="1143289">unapply</a><span class="delimiter">(</span><a title="SwitchEmission.this.TreeMaker" id="1143291">x</a>: <a href="#1134792" title="SwitchEmission.this.TreeMaker">TreeMaker</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="=&gt; SwitchMaker.this.SwitchableTreeMakerExtractor" id="1143277">SwitchableTreeMaker</a>: <a href="#1143276" title="SwitchMaker.this.SwitchableTreeMakerExtractor">SwitchableTreeMakerExtractor</a>

      <span class="keyword">def</span> <a title="=&gt; Boolean" id="1143278">alternativesSupported</a>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a>

      <span class="keyword">def</span> <a title="(x: PatMatVirtualiser.this.global.CaseDef)Boolean" id="1143279">isDefault</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.CaseDef" id="1143292">x</a>: <a href="../../../reflect/api/Trees.scala.html#23628" title="PatMatVirtualiser.this.global.CaseDef">CaseDef</a><span class="delimiter">)</span>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a>
      <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Symbol" id="1143280">defaultSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>
      <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Tree" id="1143281">defaultBody</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>
      <span class="keyword">def</span> <a title="(scrutSym: PatMatVirtualiser.this.global.Symbol, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.CaseDef" id="1143282">defaultCase</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1143295">scrutSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a> = <a href="#1143280" title="=&gt; PatMatVirtualiser.this.global.Symbol">defaultSym</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1143296">body</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="#1143281" title="=&gt; PatMatVirtualiser.this.global.Tree">defaultBody</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23628" title="PatMatVirtualiser.this.global.CaseDef">CaseDef</a>

      <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](xs: List[Option[T]])Option[List[T]]" id="1143283">sequence</a><span class="delimiter">[</span><a title="" id="1143285">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="List[Option[T]]" id="1143297">xs</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[Option[T]]">List</a><span class="delimiter">[</span>Option<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[List[T]]">Option</a><span class="delimiter">[</span>List<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span> =
        <span title="Option[List[T]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1143297" title="List[Option[T]]">xs</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76170" title="(p: Option[T] =&gt; Boolean)Boolean">exists</a> <span class="delimiter">(</span><a href="#1143305" title="Option[T]">_</a>.<a href="../../../Option.scala.html#63811" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a> <span class="keyword">else</span> <a href="../../../Option.scala.html#64111" title="(x: List[T])Some[List[T]]">Some</a><span class="delimiter">(</span><a href="#1143297" title="List[Option[T]]">xs</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#59386" title="(implicit asTraversable: Option[T] =&gt; scala.collection.GenTraversableOnce[T])List[T]">flatten</a><span class="delimiter">)</span>

      // empty list ==&gt; failure
      <span class="keyword">def</span> <a title="(cases: List[(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])], pt: PatMatVirtualiser.this.global.Type)List[PatMatVirtualiser.this.global.CaseDef]" id="1143286">apply</a><span class="delimiter">(</span><a title="List[(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])]" id="1143352">cases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])]">List</a><span class="delimiter">[</span><span class="delimiter">(</span>Symbol, List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Type" id="1143353">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[PatMatVirtualiser.this.global.CaseDef]">List</a><span class="delimiter">[</span>CaseDef<span class="delimiter">]</span> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="List[Option[PatMatVirtualiser.this.global.CaseDef]]" id="1143354">caseDefs</a> = <a href="#1143352" title="List[(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])]">cases</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: ((PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])) =&gt; Option[PatMatVirtualiser.this.global.CaseDef])(implicit bf: scala.collection.generic.CanBuildFrom[List[(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])],Option[PatMatVirtualiser.this.global.CaseDef],List[Option[PatMatVirtualiser.this.global.CaseDef]]])List[Option[PatMatVirtualiser.this.global.CaseDef]]">map</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker]),Option[PatMatVirtualiser.this.global.CaseDef]] with Serializable" id="1143371" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>scrutSym, makers<span class="delimiter">)</span> =&gt;
          <a href="#1143605" title="(x: Option[PatMatVirtualiser.this.global.CaseDef])Option[PatMatVirtualiser.this.global.CaseDef]">makers</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            // default case
            <span class="keyword">case</span> <span class="delimiter">(</span>btm@BodyTreeMaker<a title="Option[PatMatVirtualiser.this.global.CaseDef]" id="1143557" class="delimiter">(</a>body, _<span class="delimiter">)</span><span class="delimiter">)</span> <a href="#1143552" title="Boolean" id="1143554">::</a> <a href="../../../collection/immutable/List.scala.html#11552" title="Option[PatMatVirtualiser.this.global.CaseDef]" id="1143582">Nil</a> =&gt;
              <a href="../../../Option.scala.html#64111" title="(x: PatMatVirtualiser.this.global.CaseDef)Some[PatMatVirtualiser.this.global.CaseDef]">Some</a><a href="#1143586" title="(x: Option[PatMatVirtualiser.this.global.CaseDef])Option[PatMatVirtualiser.this.global.CaseDef]" class="delimiter">(</a><a href="#1143282" title="(scrutSym: PatMatVirtualiser.this.global.Symbol, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.CaseDef">defaultCase</a><span class="delimiter">(</span>scrutSym, btm.<a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">substitution</a><span class="delimiter">(</span>body<span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            // constant (or typetest for typeSwitch)
            <span class="keyword">case</span> <a href="#1143289" title="Option[PatMatVirtualiser.this.global.Tree]" id="1143591">SwitchableTreeMaker</a><span class="delimiter">(</span>pattern<span class="delimiter">)</span> :: <span class="delimiter">(</span>btm@BodyTreeMaker<a title="Option[PatMatVirtualiser.this.global.CaseDef]" id="1143567" class="delimiter">(</a>body, _<span class="delimiter">)</span><span class="delimiter">)</span> <a title="Option[PatMatVirtualiser.this.global.CaseDef]" id="1143564">::</a> <a href="../../../collection/immutable/List.scala.html#11552" title="Option[PatMatVirtualiser.this.global.CaseDef]" id="1143583">Nil</a> =&gt;
              <a href="../../../Option.scala.html#64111" title="(x: PatMatVirtualiser.this.global.CaseDef)Some[PatMatVirtualiser.this.global.CaseDef]">Some</a><a href="#1143586" title="(x: Option[PatMatVirtualiser.this.global.CaseDef])Option[PatMatVirtualiser.this.global.CaseDef]" class="delimiter">(</a><a href="../../../reflect/api/Trees.scala.html#427318" title="(pat: PatMatVirtualiser.this.global.Tree, guard: PatMatVirtualiser.this.global.Tree, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.CaseDef">CaseDef</a><span class="delimiter">(</span>pattern, <a href="../../../reflect/api/Trees.scala.html#23577" title="PatMatVirtualiser.this.global.EmptyTree.type">EmptyTree</a>, btm.<a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">substitution</a><span class="delimiter">(</span>body<span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            // alternatives
            <span class="keyword">case</span> AlternativesTreeMaker<a title="Option[PatMatVirtualiser.this.global.CaseDef]" id="1143575" class="delimiter">(</a>_, altss, _<span class="delimiter">)</span> :: <span class="delimiter">(</span>btm@BodyTreeMaker<a title="Option[PatMatVirtualiser.this.global.CaseDef]" id="1143580" class="delimiter">(</a>body, _<span class="delimiter">)</span><span class="delimiter">)</span> <a title="Option[PatMatVirtualiser.this.global.CaseDef]" id="1143577">::</a> <a href="../../../collection/immutable/List.scala.html#11552" title="Option[PatMatVirtualiser.this.global.CaseDef]" id="1143584">Nil</a> <span class="keyword">if</span> <a href="#1143278" title="=&gt; Boolean">alternativesSupported</a> =&gt;
              <span class="keyword">val</span> <a title="List[Option[PatMatVirtualiser.this.global.Tree]]" id="1143431">casePatterns</a> = altss <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: List[SwitchEmission.this.TreeMaker] =&gt; Option[PatMatVirtualiser.this.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[SwitchEmission.this.TreeMaker]],Option[PatMatVirtualiser.this.global.Tree],List[Option[PatMatVirtualiser.this.global.Tree]]])List[Option[PatMatVirtualiser.this.global.Tree]]">map</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[List[SwitchEmission.this.TreeMaker],Option[PatMatVirtualiser.this.global.Tree]] with Serializable" id="1143448" class="delimiter">{</a>
                <span class="keyword">case</span> <a href="#1143289" title="Option[PatMatVirtualiser.this.global.Tree]" id="1143482">SwitchableTreeMaker</a><span class="delimiter">(</span>pattern<span class="delimiter">)</span> <a href="#1143471" title="Option[PatMatVirtualiser.this.global.Tree]" id="1143474">::</a> <a href="../../../collection/immutable/List.scala.html#11552" title="Option[PatMatVirtualiser.this.global.Tree]" id="1143477">Nil</a> =&gt;
                  <a href="../../../Option.scala.html#64111" title="(x: PatMatVirtualiser.this.global.Tree)Some[PatMatVirtualiser.this.global.Tree]">Some</a><a href="#1143478" title="(x: Option[PatMatVirtualiser.this.global.Tree])Option[PatMatVirtualiser.this.global.Tree]" class="delimiter">(</a>pattern<span class="delimiter">)</span>
                <span class="keyword">case</span> _ =&gt;
                  <a href="#1143478" title="(x: Option[PatMatVirtualiser.this.global.Tree])Option[PatMatVirtualiser.this.global.Tree]">None</a>
              <span class="delimiter">}</span>

              <a href="#1143283" title="(xs: List[Option[PatMatVirtualiser.this.global.Tree]])Option[List[PatMatVirtualiser.this.global.Tree]]">sequence</a><span class="delimiter">(</span><a href="#1143431" title="List[Option[PatMatVirtualiser.this.global.Tree]]">casePatterns</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#63820" title="(f: List[PatMatVirtualiser.this.global.Tree] =&gt; PatMatVirtualiser.this.global.CaseDef)Option[PatMatVirtualiser.this.global.CaseDef]">map</a> <span class="delimiter">{</span> <a title="List[PatMatVirtualiser.this.global.Tree]" id="1143538">patterns</a> =&gt;
                <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1143539">substedBody</a>  = btm.<a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">substitution</a><span class="delimiter">(</span>body<span class="delimiter">)</span>
                <a href="../../../reflect/api/Trees.scala.html#427318" title="(pat: PatMatVirtualiser.this.global.Tree, guard: PatMatVirtualiser.this.global.Tree, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.CaseDef">CaseDef</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#436461" title="(trees: List[PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Alternative">Alternative</a><span class="delimiter">(</span><a href="#1143538" title="List[PatMatVirtualiser.this.global.Tree]">patterns</a><span class="delimiter">)</span>, <a href="../../../reflect/api/Trees.scala.html#23577" title="PatMatVirtualiser.this.global.EmptyTree.type">EmptyTree</a>, <a href="#1143539" title="PatMatVirtualiser.this.global.Tree">substedBody</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> _ =&gt; //println(&quot;can't emit switch for &quot;+ makers)
              <a href="#1143586" title="(x: Option[PatMatVirtualiser.this.global.CaseDef])Option[PatMatVirtualiser.this.global.CaseDef]">None</a> //failure (can't translate pattern to a switch)
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <span class="delimiter">(</span><span class="keyword">for</span><span class="delimiter">(</span>
          <a title="List[PatMatVirtualiser.this.global.CaseDef]" id="1143661">caseDefs</a> &lt;- <a href="#1143283" title="(xs: List[Option[PatMatVirtualiser.this.global.CaseDef]])Option[List[PatMatVirtualiser.this.global.CaseDef]]">sequence</a><a href="../../../Option.scala.html#63820" title="(f: List[PatMatVirtualiser.this.global.CaseDef] =&gt; List[PatMatVirtualiser.this.global.CaseDef])Option[List[PatMatVirtualiser.this.global.CaseDef]]" class="delimiter">(</a><a href="#1143354" title="List[Option[PatMatVirtualiser.this.global.CaseDef]]">caseDefs</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">yield</span>
            <span title="List[PatMatVirtualiser.this.global.CaseDef]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1143661" title="List[PatMatVirtualiser.this.global.CaseDef]">caseDefs</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76170" title="(p: PatMatVirtualiser.this.global.CaseDef =&gt; Boolean)Boolean">exists</a> <a href="#1143279" title="(x: PatMatVirtualiser.this.global.CaseDef)Boolean">isDefault</a><span class="delimiter">)</span> <a href="#1143661" title="List[PatMatVirtualiser.this.global.CaseDef]">caseDefs</a>
            <span class="keyword">else</span> <span class="delimiter">{</span>
              <a href="#1143661" title="List[PatMatVirtualiser.this.global.CaseDef]">caseDefs</a> <a href="../../../collection/SeqLike.scala.html#59810" title="(elem: PatMatVirtualiser.this.global.CaseDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.CaseDef],PatMatVirtualiser.this.global.CaseDef,List[PatMatVirtualiser.this.global.CaseDef]])List[PatMatVirtualiser.this.global.CaseDef]">:+</a> <a href="#1143282" title="(scrutSym: PatMatVirtualiser.this.global.Symbol, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.CaseDef">defaultCase</a><span class="delimiter">(</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
        <span class="delimiter">)</span> <a href="../../../Option.scala.html#63814" title="(default: =&gt; List[PatMatVirtualiser.this.global.CaseDef])List[PatMatVirtualiser.this.global.CaseDef]">getOrElse</a> <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">class</span> <a title="class RegularSwitchMaker extends SwitchEmission.this.SwitchMaker" id="1134894">RegularSwitchMaker</a><a href="#1134894" title="SwitchEmission.this.RegularSwitchMaker" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Symbol" id="1143743">scrutSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]" id="1143744">matchFailGenOverride</a>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree =&gt; Tree<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134893" title="SwitchEmission.this.SwitchMaker">SwitchMaker</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.immutable.Set[PatMatVirtualiser.this.global.Type]" id="1143725">switchableTpe</a> = <a href="../../../collection/generic/GenericCompanion.scala.html#60782" title="(elems: PatMatVirtualiser.this.global.Type*)scala.collection.immutable.Set[PatMatVirtualiser.this.global.Type]">Set</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442843" title="=&gt; PatMatVirtualiser.this.global.ClassSymbol">ByteClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>, <a href="../../../reflect/internal/Definitions.scala.html#442845" title="=&gt; PatMatVirtualiser.this.global.ClassSymbol">ShortClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>, <a href="../../../reflect/internal/Definitions.scala.html#442849" title="=&gt; PatMatVirtualiser.this.global.ClassSymbol">IntClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a>, <a href="../../../reflect/internal/Definitions.scala.html#442847" title="=&gt; PatMatVirtualiser.this.global.ClassSymbol">CharClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Boolean" id="1143727">alternativesSupported</a> = <span title="Boolean(true)" class="keyword">true</span>

      <span class="keyword">object</span> <a title="RegularSwitchMaker.this.SwitchablePattern.type" id="1143729">SwitchablePattern</a> <a href="#1143730" title="RegularSwitchMaker.this.SwitchablePattern.type" class="delimiter">{</a> <span class="keyword">def</span> <a title="(pat: PatMatVirtualiser.this.global.Tree)Option[PatMatVirtualiser.this.global.Tree]" id="1143746">unapply</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1143748">pat</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = <a href="#1143748" title="PatMatVirtualiser.this.global.Tree">pat</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Literal<a href="#1143756" title="Option[PatMatVirtualiser.this.global.Tree]" id="1143758" class="delimiter">(</a>const@Constant<span class="delimiter">(</span><span class="delimiter">(</span>_: Byte <span class="delimiter">)</span> | <span class="delimiter">(</span>_: Short<span class="delimiter">)</span> | <span class="delimiter">(</span>_: Int  <span class="delimiter">)</span> | <span class="delimiter">(</span>_: Char <span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
          <a href="../../../Option.scala.html#64111" title="(x: PatMatVirtualiser.this.global.Literal)Some[PatMatVirtualiser.this.global.Literal]">Some</a><a href="#1143764" title="(x: Option[PatMatVirtualiser.this.global.Tree])Option[PatMatVirtualiser.this.global.Tree]" class="delimiter">(</a><a href="../../../reflect/api/Trees.scala.html#432792" title="(value: PatMatVirtualiser.this.global.Constant)PatMatVirtualiser.this.global.Literal">Literal</a><span class="delimiter">(</span><a href="../../../reflect/internal/Constants.scala.html#443074" title="(value: Any)PatMatVirtualiser.this.global.Constant">Constant</a><span class="delimiter">(</span>const.<a href="../../../reflect/internal/Constants.scala.html#443097" title="=&gt; Int">intValue</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> // TODO: Java 7 allows strings in switches
        <span class="keyword">case</span> _ =&gt; <a href="#1143764" title="(x: Option[PatMatVirtualiser.this.global.Tree])Option[PatMatVirtualiser.this.global.Tree]">None</a>
      <span class="delimiter">}</span><span class="delimiter">}</span>

      <span class="keyword">object</span> <a title="RegularSwitchMaker.this.SwitchableTreeMaker.type" id="1143731">SwitchableTreeMaker</a> <a href="#1143732" title="RegularSwitchMaker.this.SwitchableTreeMaker.type" class="keyword">extends</a> <a href="#1143276" title="RegularSwitchMaker.this.SwitchableTreeMakerExtractor">SwitchableTreeMakerExtractor</a> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="(x: SwitchEmission.this.TreeMaker)Option[PatMatVirtualiser.this.global.Tree]" id="1143777">unapply</a><span class="delimiter">(</span><a title="SwitchEmission.this.TreeMaker" id="1143779">x</a>: <a href="#1134792" title="SwitchEmission.this.TreeMaker">TreeMaker</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = <a href="#1143779" title="SwitchEmission.this.TreeMaker">x</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> EqualityTestTreeMaker<a href="#1143786" title="Option[PatMatVirtualiser.this.global.Tree]" id="1143791" class="delimiter">(</a>_, <a href="#1143746" title="Option[PatMatVirtualiser.this.global.Tree]" id="1143797">SwitchablePattern</a><span class="delimiter">(</span>const<span class="delimiter">)</span>, _<span class="delimiter">)</span> =&gt; <a href="../../../Option.scala.html#64111" title="(x: PatMatVirtualiser.this.global.Tree)Some[PatMatVirtualiser.this.global.Tree]">Some</a><a href="#1143793" title="(x: Option[PatMatVirtualiser.this.global.Tree])Option[PatMatVirtualiser.this.global.Tree]" class="delimiter">(</a>const<span class="delimiter">)</span>
          <span class="keyword">case</span> _ =&gt; <a href="#1143793" title="(x: Option[PatMatVirtualiser.this.global.Tree])Option[PatMatVirtualiser.this.global.Tree]">None</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(x: PatMatVirtualiser.this.global.CaseDef)Boolean" id="1143733">isDefault</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.CaseDef" id="1143799">x</a>: <a href="../../../reflect/api/Trees.scala.html#23628" title="PatMatVirtualiser.this.global.CaseDef">CaseDef</a><span class="delimiter">)</span>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <a href="#1143799" title="PatMatVirtualiser.this.global.CaseDef">x</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> CaseDef<span class="delimiter">(</span>Ident<a title="Boolean" id="1143815" class="delimiter">(</a><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#445910" title="Boolean" id="1143819">WILDCARD</a><span class="delimiter">)</span>, <a href="../../../reflect/api/Trees.scala.html#23577" title="Boolean" id="1143820">EmptyTree</a>, _<span class="delimiter">)</span> =&gt; <a href="#1143821" title="(x: Boolean)Boolean" class="keyword">true</a>
        <span class="keyword">case</span> _ =&gt; <a href="#1143821" title="(x: Boolean)Boolean" class="keyword">false</a>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Symbol" id="1143734">defaultSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a> = <a href="#1143743" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a>
      <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Tree" id="1143735">defaultBody</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>  = <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._; <a href="#1143744" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">matchFailGenOverride</a> <a href="../../../Option.scala.html#63820" title="(f: (PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree) =&gt; PatMatVirtualiser.this.global.Tree)Option[PatMatVirtualiser.this.global.Tree]">map</a> <span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree" id="1143837">gen</a> =&gt; <a href="../../../Function1.scala.html#59555" title="(v1: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">gen</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1143743" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../Option.scala.html#63814" title="(default: =&gt; PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">getOrElse</a> <a href="../ast/TreeDSL.scala.html#653618" title="(arg: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Throw">MATCHERROR</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1143743" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span>
      <span class="keyword">def</span> <a title="(scrutSym: PatMatVirtualiser.this.global.Symbol, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.CaseDef" id="1143736">defaultCase</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1143851">scrutSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a> = <a href="#1143734" title="=&gt; PatMatVirtualiser.this.global.Symbol">defaultSym</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1143852">body</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="#1143735" title="=&gt; PatMatVirtualiser.this.global.Tree">defaultBody</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23628" title="PatMatVirtualiser.this.global.CaseDef">CaseDef</a> = <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._; <a href="../../../reflect/internal/Positions.scala.html#441889" title="(pos: PatMatVirtualiser.this.global.Position)(tree: PatMatVirtualiser.this.global.CaseDef)PatMatVirtualiser.this.global.CaseDef">atPos</a><span class="delimiter">(</span><a href="#1143852" title="PatMatVirtualiser.this.global.Tree">body</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../ast/TreeDSL.scala.html#653616" title="=&gt; PatMatVirtualiser.this.CODE.CaseStart">DEFAULT</a> <a href="../ast/TreeDSL.scala.html#692380" title="(body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.CaseDef">==&gt;</a> <a href="#1143852" title="PatMatVirtualiser.this.global.Tree">body</a>
      <span class="delimiter">}</span><span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, cases: List[List[SwitchEmission.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type, matchFailGenOverride: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])Option[PatMatVirtualiser.this.global.Tree]" id="1134895">emitSwitch</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1143862">scrut</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1143863">scrutSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="List[List[SwitchEmission.this.TreeMaker]]" id="1143864">cases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[SwitchEmission.this.TreeMaker]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Type" id="1143865">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>, <a title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]" id="1143866">matchFailGenOverride</a>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree =&gt; Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._
      <span class="keyword">val</span> <a title="SwitchEmission.this.RegularSwitchMaker" id="1143874">regularSwitchMaker</a> = <span title="SwitchEmission.this.RegularSwitchMaker" class="keyword">new</span> <a href="#1134894" title="SwitchEmission.this.RegularSwitchMaker">RegularSwitchMaker</a><span class="delimiter">(</span><a href="#1143863" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a>, <a href="#1143866" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">matchFailGenOverride</a><span class="delimiter">)</span>
      // TODO: if patterns allow switch but the type of the scrutinee doesn't, cast (type-test) the scrutinee to the corresponding switchable type and switch on the result
      <span title="Option[PatMatVirtualiser.this.global.Tree]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1143874" title="SwitchEmission.this.RegularSwitchMaker">regularSwitchMaker</a>.<a href="../../../collection/GenSetLike.scala.html#65156" title="(elem: PatMatVirtualiser.this.global.Type)Boolean">switchableTpe</a><span class="delimiter">(</span><a href="#1143863" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="List[PatMatVirtualiser.this.global.CaseDef]" id="1143888">caseDefsWithDefault</a> = <a href="#1143286" title="(cases: List[(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])], pt: PatMatVirtualiser.this.global.Type)List[PatMatVirtualiser.this.global.CaseDef]">regularSwitchMaker</a><span class="delimiter">(</span><a href="#1143864" title="List[List[SwitchEmission.this.TreeMaker]]">cases</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: List[SwitchEmission.this.TreeMaker] =&gt; (PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker]))(implicit bf: scala.collection.generic.CanBuildFrom[List[List[SwitchEmission.this.TreeMaker]],(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker]),List[(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])]])List[(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])]">map</a> <span class="delimiter">{</span><a title="List[SwitchEmission.this.TreeMaker]" id="1143905">c</a> =&gt; <a href="../../../Tuple2.scala.html#63804" title="(_1: PatMatVirtualiser.this.global.Symbol, _2: List[SwitchEmission.this.TreeMaker])(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])" class="delimiter">(</a><a href="#1143863" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a>, <a href="#1143905" title="List[SwitchEmission.this.TreeMaker]">c</a><span class="delimiter">)</span><span class="delimiter">}</span>, <a href="#1143865" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span>
        <span title="Option[PatMatVirtualiser.this.global.Tree]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1143888" title="List[PatMatVirtualiser.this.global.CaseDef]">caseDefsWithDefault</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57912" title="(x: Int)Boolean">&lt;=</a> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a> // not worth emitting a switch... also, the optimizer has trouble digesting tiny switches, apparently, so let's be nice and not generate them
        <span class="keyword">else</span> <span class="delimiter">{</span>
          // match on scrutSym -- converted to an int if necessary -- not on scrut directly (to avoid duplicating scrut)
          <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Tree" id="1143954">scrutToInt</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> =
            <span title="PatMatVirtualiser.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1143863" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a> <a href="../../../reflect/internal/Types.scala.html#442062" title="(that: PatMatVirtualiser.this.global.Type)Boolean">=:=</a> <a href="../../../reflect/internal/Definitions.scala.html#442849" title="=&gt; PatMatVirtualiser.this.global.ClassSymbol">IntClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1143863" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a><span class="delimiter">)</span>
            <span class="keyword">else</span> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.TreeMethods" class="delimiter">(</a><a href="#1143863" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#653650" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeFromSelectStart : (ss: PatMatVirtualiser.this.CODE.SelectStart)PatMatVirtualiser.this.global.Select">DOT</a> <span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446747" title="=&gt; PatMatVirtualiser.this.global.nme.NameType">toInt</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="../../../Option.scala.html#64111" title="(x: PatMatVirtualiser.this.global.Block)Some[PatMatVirtualiser.this.global.Block]">Some</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653638" title="(xs: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Block">BLOCK</a><span class="delimiter">(</span>
            <a href="../ast/TreeDSL.scala.html#653627" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.CODE.ValSymStart">VAL</a><span class="delimiter">(</span><a href="#1143863" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#692482" title="(rhs: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.ValDef">===</a> <a href="#1143862" title="PatMatVirtualiser.this.global.Tree">scrut</a>,
            <a href="../../../reflect/api/Trees.scala.html#436671" title="(selector: PatMatVirtualiser.this.global.Tree, cases: List[PatMatVirtualiser.this.global.CaseDef])PatMatVirtualiser.this.global.Match">Match</a><span class="delimiter">(</span><a href="../Global.scala.html#559498" title="PatMatVirtualiser.this.global.gen.type">gen</a>.<a href="../ast/TreeGen.scala.html#561768" title="(expr: PatMatVirtualiser.this.global.gen.global.Tree)PatMatVirtualiser.this.global.gen.global.Tree">mkSynthSwitchSelector</a><span class="delimiter">(</span><a href="#1143954" title="PatMatVirtualiser.this.global.Tree">scrutToInt</a><span class="delimiter">)</span>, <a href="#1143888" title="List[PatMatVirtualiser.this.global.CaseDef]">caseDefsWithDefault</a><span class="delimiter">)</span> // add switch annotation
          <span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>
    <span class="delimiter">}</span>

    // for the catch-cases in a try/catch
    <span class="keyword">private</span> <span class="keyword">object</span> <a title="SwitchEmission.this.typeSwitchMaker.type" id="1134896">typeSwitchMaker</a> <a href="#1134897" title="SwitchEmission.this.typeSwitchMaker.type" class="keyword">extends</a> <a href="#1134893" title="SwitchEmission.this.SwitchMaker">SwitchMaker</a> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(tp: PatMatVirtualiser.this.global.Type)Boolean" id="1143994">switchableTpe</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Type" id="1144005">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span> = <span title="Boolean(true)" class="keyword">true</span>
      <span class="keyword">val</span> <a title="Boolean" id="1143995">alternativesSupported</a> = <span title="Boolean(false)" class="keyword">false</span> // TODO: needs either back-end support of flattening of alternatives during typers

      // TODO: there are more treemaker-sequences that can be handled by type tests
      // analyze the result of approximateTreeMaker rather than the TreeMaker itself
      <span class="keyword">object</span> <a title="scala.tools.nsc.typechecker.PatMatVirtualiser.SwitchEmission.typeSwitchMaker.SwitchableTreeMaker.type" id="1143997">SwitchableTreeMaker</a> <a href="#1143998" title="scala.tools.nsc.typechecker.PatMatVirtualiser.SwitchEmission.typeSwitchMaker.SwitchableTreeMaker.type" class="keyword">extends</a> <a href="#1143276" title="scala.tools.nsc.typechecker.PatMatVirtualiser.SwitchEmission.typeSwitchMaker.SwitchableTreeMakerExtractor">SwitchableTreeMakerExtractor</a> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="(x: SwitchEmission.this.TreeMaker)Option[PatMatVirtualiser.this.global.Tree]" id="1144007">unapply</a><span class="delimiter">(</span><a title="SwitchEmission.this.TreeMaker" id="1144009">x</a>: <a href="#1134792" title="SwitchEmission.this.TreeMaker">TreeMaker</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = <a href="#1144009" title="SwitchEmission.this.TreeMaker">x</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> tm@TypeTestTreeMaker<a href="#1144084" title="Option[PatMatVirtualiser.this.global.Tree]" id="1144089" class="delimiter">(</a>_, _, _<span class="delimiter">)</span> =&gt;
            <a href="../../../Option.scala.html#64111" title="(x: PatMatVirtualiser.this.global.Bind)Some[PatMatVirtualiser.this.global.Bind]">Some</a><a href="#1144094" title="(x: Option[PatMatVirtualiser.this.global.Tree])Option[PatMatVirtualiser.this.global.Tree]" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#441830" title="(sym: PatMatVirtualiser.this.global.Symbol, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Bind">Bind</a><span class="delimiter">(</span>tm.<a href="#1135965" title="=&gt; PatMatVirtualiser.this.global.TermSymbol">nextBinder</a>, <a href="../../../reflect/api/Trees.scala.html#436785" title="(expr: PatMatVirtualiser.this.global.Tree, tpt: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Typed">Typed</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#427669" title="(name: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#445910" title="=&gt; PatMatVirtualiser.this.global.nme.NameType">WILDCARD</a><span class="delimiter">)</span>, <a href="../../../reflect/api/Trees.scala.html#23746" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.TypeTree">TypeTree</a><span class="delimiter">(</span>tm.<a href="#1135988" title="=&gt; PatMatVirtualiser.this.global.Type">nextBinderTp</a><span class="delimiter">)</span><span class="delimiter">)</span> /* not used by back-end */<span class="delimiter">)</span><span class="delimiter">)</span> //  -- TODO: use this if binder does not occur in the body
          <span class="keyword">case</span> tm@TypeAndEqualityTestTreeMaker<a href="#1144084" title="Option[PatMatVirtualiser.this.global.Tree]" id="1144093" class="delimiter">(</a>_, patBinder, pt, _<span class="delimiter">)</span> <span class="keyword">if</span> tm.<a href="#1136248" title="=&gt; Boolean">isStraightTypeTest</a> =&gt;
            <a href="../../../Option.scala.html#64111" title="(x: PatMatVirtualiser.this.global.Bind)Some[PatMatVirtualiser.this.global.Bind]">Some</a><a href="#1144094" title="(x: Option[PatMatVirtualiser.this.global.Tree])Option[PatMatVirtualiser.this.global.Tree]" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#441830" title="(sym: PatMatVirtualiser.this.global.Symbol, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Bind">Bind</a><span class="delimiter">(</span>tm.<a href="#1135965" title="=&gt; PatMatVirtualiser.this.global.TermSymbol">nextBinder</a>, <a href="../../../reflect/api/Trees.scala.html#436785" title="(expr: PatMatVirtualiser.this.global.Tree, tpt: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Typed">Typed</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#427669" title="(name: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#445910" title="=&gt; PatMatVirtualiser.this.global.nme.NameType">WILDCARD</a><span class="delimiter">)</span>, <a href="../../../reflect/api/Trees.scala.html#23746" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.TypeTree">TypeTree</a><span class="delimiter">(</span>tm.<a href="#1136241" title="=&gt; PatMatVirtualiser.this.global.Type">nextBinderTp</a><span class="delimiter">)</span><span class="delimiter">)</span> /* not used by back-end */<span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> _ =&gt;
            <a href="#1144094" title="(x: Option[PatMatVirtualiser.this.global.Tree])Option[PatMatVirtualiser.this.global.Tree]">None</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(x: PatMatVirtualiser.this.global.CaseDef)Boolean" id="1143999">isDefault</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.CaseDef" id="1144100">x</a>: <a href="../../../reflect/api/Trees.scala.html#23628" title="PatMatVirtualiser.this.global.CaseDef">CaseDef</a><span class="delimiter">)</span>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <a href="#1144100" title="PatMatVirtualiser.this.global.CaseDef">x</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> CaseDef<span class="delimiter">(</span>Typed<a title="Boolean" id="1144150" class="delimiter">(</a>Ident<a title="Boolean" id="1144153" class="delimiter">(</a><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#445910" title="Boolean" id="1144182">WILDCARD</a><span class="delimiter">)</span>, tpt<span class="delimiter">)</span>, <a href="../../../reflect/api/Trees.scala.html#23577" title="Boolean" id="1144183">EmptyTree</a>, _<span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span>tpt.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a> <a href="../../../reflect/internal/Types.scala.html#442062" title="(that: PatMatVirtualiser.this.global.Type)Boolean">=:=</a> <a href="../../../reflect/internal/Definitions.scala.html#442209" title="=&gt; PatMatVirtualiser.this.global.Symbol">ThrowableClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span>          =&gt; <a href="#1144188" title="(x: Boolean)Boolean" class="keyword">true</a>
        <span class="keyword">case</span> CaseDef<span class="delimiter">(</span>Bind<a title="Boolean" id="1144163" class="delimiter">(</a>_, Typed<a title="Boolean" id="1144166" class="delimiter">(</a>Ident<a title="Boolean" id="1144169" class="delimiter">(</a><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#445910" title="Boolean" id="1144184">WILDCARD</a><span class="delimiter">)</span>, tpt<span class="delimiter">)</span><span class="delimiter">)</span>, <a href="../../../reflect/api/Trees.scala.html#23577" title="Boolean" id="1144185">EmptyTree</a>, _<span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span>tpt.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a> <a href="../../../reflect/internal/Types.scala.html#442062" title="(that: PatMatVirtualiser.this.global.Type)Boolean">=:=</a> <a href="../../../reflect/internal/Definitions.scala.html#442209" title="=&gt; PatMatVirtualiser.this.global.Symbol">ThrowableClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span> =&gt; <a href="#1144188" title="(x: Boolean)Boolean" class="keyword">true</a>
        <span class="keyword">case</span> CaseDef<span class="delimiter">(</span>Ident<a title="Boolean" id="1144178" class="delimiter">(</a><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#445910" title="Boolean" id="1144186">WILDCARD</a><span class="delimiter">)</span>, <a href="../../../reflect/api/Trees.scala.html#23577" title="Boolean" id="1144187">EmptyTree</a>, _<span class="delimiter">)</span>                                                          =&gt; <a href="#1144188" title="(x: Boolean)Boolean" class="keyword">true</a>
        <span class="keyword">case</span> _ =&gt; <a href="#1144188" title="(x: Boolean)Boolean" class="keyword">false</a>
      <span class="delimiter">}</span>

      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Symbol" id="1144001">defaultSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a> = <a href="#1134720" title="(pos: PatMatVirtualiser.this.global.Position, tp: PatMatVirtualiser.this.global.Type, prefix: String)PatMatVirtualiser.this.global.TermSymbol">freshSym</a><span class="delimiter">(</span><a href="../../../reflect/internal/Positions.scala.html#441880" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a>, <a href="../../../reflect/internal/Definitions.scala.html#442209" title="=&gt; PatMatVirtualiser.this.global.Symbol">ThrowableClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Tree" id="1144002">defaultBody</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>       = <a href="../../../reflect/api/Trees.scala.html#428078" title="(expr: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Throw">Throw</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>.<a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1144000" title="=&gt; PatMatVirtualiser.this.global.Symbol">defaultSym</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(scrutSym: PatMatVirtualiser.this.global.Symbol, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.CaseDef" id="1144003">defaultCase</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1144228">scrutSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a> = <a href="#1144000" title="=&gt; PatMatVirtualiser.this.global.Symbol">defaultSym</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1144229">body</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="#1144002" title="=&gt; PatMatVirtualiser.this.global.Tree">defaultBody</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23628" title="PatMatVirtualiser.this.global.CaseDef">CaseDef</a> = <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._; <a href="../../../reflect/internal/Positions.scala.html#441889" title="(pos: PatMatVirtualiser.this.global.Position)(tree: PatMatVirtualiser.this.global.CaseDef)PatMatVirtualiser.this.global.CaseDef">atPos</a><span class="delimiter">(</span><a href="#1144229" title="PatMatVirtualiser.this.global.Tree">body</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../ast/TreeDSL.scala.html#653615" title="(pat: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.CODE.CaseStart">CASE</a> <span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#441830" title="(sym: PatMatVirtualiser.this.global.Symbol, body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Bind">Bind</a><span class="delimiter">(</span><a href="#1144228" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a>, <a href="../../../reflect/api/Trees.scala.html#436785" title="(expr: PatMatVirtualiser.this.global.Tree, tpt: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Typed">Typed</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#427669" title="(name: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#441764" title="PatMatVirtualiser.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#445910" title="=&gt; PatMatVirtualiser.this.global.nme.NameType">WILDCARD</a><span class="delimiter">)</span>, <a href="../../../reflect/api/Trees.scala.html#23746" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.TypeTree">TypeTree</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442209" title="=&gt; PatMatVirtualiser.this.global.Symbol">ThrowableClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#692380" title="(body: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.CaseDef">==&gt;</a> <a href="#1144229" title="PatMatVirtualiser.this.global.Tree">body</a>
      <span class="delimiter">}</span><span class="delimiter">}</span>
    <span class="delimiter">}</span>

    // TODO: drop null checks
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(bindersAndCases: List[(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])], pt: PatMatVirtualiser.this.global.Type)Option[List[PatMatVirtualiser.this.global.CaseDef]]" id="1134898">emitTypeSwitch</a><span class="delimiter">(</span><a title="List[(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])]" id="1144270">bindersAndCases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])]">List</a><span class="delimiter">[</span><span class="delimiter">(</span>Symbol, List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Type" id="1144271">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[List[PatMatVirtualiser.this.global.CaseDef]]">Option</a><span class="delimiter">[</span>List<span class="delimiter">[</span>CaseDef<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[PatMatVirtualiser.this.global.CaseDef]" id="1144275">caseDefsWithDefault</a> = <a href="#1143286" title="(cases: List[(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])], pt: PatMatVirtualiser.this.global.Type)List[PatMatVirtualiser.this.global.CaseDef]">typeSwitchMaker</a><span class="delimiter">(</span><a href="#1144270" title="List[(PatMatVirtualiser.this.global.Symbol, List[SwitchEmission.this.TreeMaker])]">bindersAndCases</a>, <a href="#1144271" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span>
      <span title="Option[List[PatMatVirtualiser.this.global.CaseDef]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1144275" title="List[PatMatVirtualiser.this.global.CaseDef]">caseDefsWithDefault</a> <a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>
      <span class="keyword">else</span> <a href="../../../Option.scala.html#64111" title="(x: List[PatMatVirtualiser.this.global.CaseDef])Some[List[PatMatVirtualiser.this.global.CaseDef]]">Some</a><span class="delimiter">(</span><a href="#1144275" title="List[PatMatVirtualiser.this.global.CaseDef]">caseDefsWithDefault</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">trait</span> <a title="trait OptimizedMatchMonadInterface extends Object with PatMatVirtualiser.this.MatchMonadInterface" id="560248">OptimizedMatchMonadInterface</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#560237" title="PatMatVirtualiser.this.MatchMonadInterface">MatchMonadInterface</a> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type" id="1134900">inMatchMonad</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Type" id="1144285">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a> = <a href="../../../reflect/internal/Definitions.scala.html#442514" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">optionType</a><span class="delimiter">(</span><a href="#1144285" title="PatMatVirtualiser.this.global.Type">tp</a><span class="delimiter">)</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type" id="1134901">pureType</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Type" id="1144288">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a>     = <a href="#1144288" title="PatMatVirtualiser.this.global.Type">tp</a>
    <span class="keyword">override</span> <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Symbol" id="1134902">matchMonadSym</a>      = <a href="../../../reflect/internal/Definitions.scala.html#442443" title="=&gt; PatMatVirtualiser.this.global.Symbol">OptionClass</a>
  <span class="delimiter">}</span>

  <span class="keyword">trait</span> <a title="trait OptimizedCodegen extends Object with PatMatVirtualiser.this.CodegenCore with PatMatVirtualiser.this.TypedSubstitution with PatMatVirtualiser.this.OptimizedMatchMonadInterface" id="560249">OptimizedCodegen</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#560241" title="PatMatVirtualiser.this.CodegenCore">CodegenCore</a> <span class="keyword">with</span> <a href="#560239" title="PatMatVirtualiser.this.TypedSubstitution">TypedSubstitution</a> <span class="keyword">with</span> <a href="#560248" title="PatMatVirtualiser.this.OptimizedMatchMonadInterface">OptimizedMatchMonadInterface</a> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; OptimizedCodegen.this.AbsCodegen" id="1134904">codegen</a>: <a href="#1134721" title="OptimizedCodegen.this.AbsCodegen">AbsCodegen</a> = <a href="#1134905" title="OptimizedCodegen.this.optimizedCodegen.type">optimizedCodegen</a>

    // trait AbsOptimizedCodegen extends AbsCodegen {
    //   def flatMapCondStored(cond: Tree, condSym: Symbol, res: Tree, nextBinder: Symbol, next: Tree): Tree
    // }
    // def optimizedCodegen: AbsOptimizedCodegen

    // when we know we're targetting Option, do some inlining the optimizer won't do
    // for example, `o.flatMap(f)` becomes `if(o == None) None else f(o.get)`, similarly for orElse and guard
    //   this is a special instance of the advanced inlining optimization that takes a method call on
    //   an object of a type that only has two concrete subclasses, and inlines both bodies, guarded by an if to distinguish the two cases
    <span class="keyword">object</span> <a title="OptimizedCodegen.this.optimizedCodegen.type" id="1134905">optimizedCodegen</a> <a href="#1134906" title="OptimizedCodegen.this.optimizedCodegen.type" class="keyword">extends</a> <a href="#1134725" title="OptimizedCodegen.this.CommonCodegen">CommonCodegen</a> <span class="delimiter">{</span> <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="PatMatVirtualiser.this.CODE.type">CODE</a>._

      /** Inline runOrElse and get rid of Option allocations
       *
       * runOrElse(scrut: scrutTp)(matcher): resTp = matcher(scrut) getOrElse ${catchAll(`scrut`)}
       * the matcher's optional result is encoded as a flag, keepGoing, where keepGoing == true encodes result.isEmpty,
       * if keepGoing is false, the result Some(x) of the naive translation is encoded as matchRes == x
       */
      <span class="keyword">def</span> <a title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, restpe: PatMatVirtualiser.this.global.Type)(cases: List[OptimizedCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree], matchFailGen: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree" id="1142709">matcher</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1144296">scrut</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1144297">scrutSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1144298">restpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="List[OptimizedCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]" id="1144299">cases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[OptimizedCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Casegen =&gt; Tree<span class="delimiter">]</span>, <a title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]" id="1144300">matchFailGen</a>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree =&gt; Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.MethodSymbol" id="1144303">matchEnd</a> = <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443178" title="(name: PatMatVirtualiser.this.global.TermName, pos: PatMatVirtualiser.this.global.Position)PatMatVirtualiser.this.global.MethodSymbol">newLabel</a><span class="delimiter">(</span><a href="#1134719" title="(prefix: String)PatMatVirtualiser.this.global.TermName">freshName</a><span class="delimiter">(</span><span title="String(&quot;matchEnd&quot;)" class="string">&quot;matchEnd&quot;</span><span class="delimiter">)</span>, <a href="../../../reflect/internal/Positions.scala.html#441880" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Symbols.scala.html#443305" title="(mask: Long)PatMatVirtualiser.this.global.MethodSymbol">setFlag</a> <a href="../../../Int.scala.html#57875" title="=&gt; Long">SYNTH_CASE</a>
        <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermSymbol" id="1144304">matchRes</a> = <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443175" title="(name: PatMatVirtualiser.this.global.TermName, pos: PatMatVirtualiser.this.global.Position, newFlags: Long)PatMatVirtualiser.this.global.TermSymbol">newValueParameter</a><span class="delimiter">(</span><a href="../../../reflect/internal/Names.scala.html#440783" title="(s: String)PatMatVirtualiser.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;x&quot;)" class="string">&quot;x&quot;</span><span class="delimiter">)</span>, <a href="../../../reflect/internal/Positions.scala.html#441880" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a>, <span title="Long(2097152L)">SYNTHETIC</span><span class="delimiter">)</span> <a href="../../../reflect/internal/Symbols.scala.html#443429" title="(info: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.TermSymbol">setInfo</a> <a href="#1144298" title="PatMatVirtualiser.this.global.Type">restpe</a>.<a href="../../../reflect/internal/Types.scala.html#442086" title="=&gt; PatMatVirtualiser.this.global.Type">withoutAnnotations</a> //
        <a href="#1144303" title="PatMatVirtualiser.this.global.MethodSymbol">matchEnd</a> <a href="../../../reflect/internal/Symbols.scala.html#443429" title="(info: PatMatVirtualiser.this.global.Type)matchEnd.type">setInfo</a> <a href="../../../reflect/internal/Types.scala.html#448348" title="(params: List[PatMatVirtualiser.this.global.Symbol], resultType: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.MethodType">MethodType</a><span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.TermSymbol*)List[PatMatVirtualiser.this.global.TermSymbol]">List</a><span class="delimiter">(</span><a href="#1144304" title="PatMatVirtualiser.this.global.TermSymbol">matchRes</a><span class="delimiter">)</span>, <a href="#1144298" title="PatMatVirtualiser.this.global.Type">restpe</a><span class="delimiter">)</span>

        <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.MethodSymbol" id="1144305">newCaseSym</a> = <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443178" title="(name: PatMatVirtualiser.this.global.TermName, pos: PatMatVirtualiser.this.global.Position)PatMatVirtualiser.this.global.MethodSymbol">newLabel</a><span class="delimiter">(</span><a href="#1134719" title="(prefix: String)PatMatVirtualiser.this.global.TermName">freshName</a><span class="delimiter">(</span><span title="String(&quot;case&quot;)" class="string">&quot;case&quot;</span><span class="delimiter">)</span>, <a href="../../../reflect/internal/Positions.scala.html#441880" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Symbols.scala.html#443429" title="(info: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.MethodSymbol">setInfo</a> <a href="../../../reflect/internal/Types.scala.html#448348" title="(params: List[PatMatVirtualiser.this.global.Symbol], resultType: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.MethodType">MethodType</a><span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>, <a href="#1144298" title="PatMatVirtualiser.this.global.Type">restpe</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Symbols.scala.html#443305" title="(mask: Long)PatMatVirtualiser.this.global.MethodSymbol">setFlag</a> <a href="../../../Int.scala.html#57875" title="=&gt; Long">SYNTH_CASE</a>
        <span class="keyword">var</span> <a title="PatMatVirtualiser.this.global.MethodSymbol" id="1144306">nextCase</a> = <a href="#1144305" title="=&gt; PatMatVirtualiser.this.global.MethodSymbol">newCaseSym</a>
        <span class="keyword">def</span> <a title="(mkCase: OptimizedCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1144307">caseDef</a><span class="delimiter">(</span><a title="OptimizedCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree" id="1144353">mkCase</a>: Casegen =&gt; Tree<span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.MethodSymbol" id="1144354">currCase</a> = <a href="#1144306" title="PatMatVirtualiser.this.global.MethodSymbol">nextCase</a>
          <a href="#1144306" title="PatMatVirtualiser.this.global.MethodSymbol">nextCase</a> = <a href="#1144305" title="=&gt; PatMatVirtualiser.this.global.MethodSymbol">newCaseSym</a>
          <span class="keyword">val</span> <a title="scala.tools.nsc.typechecker.PatMatVirtualiser.OptimizedCodegen.optimizedCodegen.OptimizedCasegen" id="1144355">casegen</a> = <span title="scala.tools.nsc.typechecker.PatMatVirtualiser.OptimizedCodegen.optimizedCodegen.OptimizedCasegen" class="keyword">new</span> <a href="#1142710" title="scala.tools.nsc.typechecker.PatMatVirtualiser.OptimizedCodegen.optimizedCodegen.OptimizedCasegen">OptimizedCasegen</a><span class="delimiter">(</span><a href="#1144303" title="PatMatVirtualiser.this.global.MethodSymbol">matchEnd</a>, <a href="#1144306" title="PatMatVirtualiser.this.global.MethodSymbol">nextCase</a>, <a href="#1144298" title="PatMatVirtualiser.this.global.Type">restpe</a><span class="delimiter">)</span>
          <a href="../../../reflect/internal/Trees.scala.html#441828" title="(sym: PatMatVirtualiser.this.global.Symbol, params: List[PatMatVirtualiser.this.global.Symbol], rhs: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.LabelDef">LabelDef</a><span class="delimiter">(</span><a href="#1144354" title="PatMatVirtualiser.this.global.MethodSymbol">currCase</a>, <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>, <a href="../../../Function1.scala.html#59555" title="(v1: OptimizedCodegen.this.Casegen)PatMatVirtualiser.this.global.Tree">mkCase</a><span class="delimiter">(</span><a href="#1144355" title="scala.tools.nsc.typechecker.PatMatVirtualiser.OptimizedCodegen.optimizedCodegen.OptimizedCasegen">casegen</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">def</span> <a title="=&gt; List[PatMatVirtualiser.this.global.LabelDef]" id="1144308">catchAll</a> = <a href="#1144300" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">matchFailGen</a> <a href="../../../Option.scala.html#63820" title="(f: (PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree) =&gt; PatMatVirtualiser.this.global.LabelDef)Option[PatMatVirtualiser.this.global.LabelDef]">map</a> <span class="delimiter">{</span> <a title="PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree" id="1144395">matchFailGen</a> =&gt;
          <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.gen.global.Tree" id="1144396">scrutRef</a> = <span title="PatMatVirtualiser.this.global.gen.global.Tree" class="keyword">if</span><span class="delimiter">(</span><a href="#1144297" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1144297" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="../../../reflect/api/Trees.scala.html#23577" title="PatMatVirtualiser.this.global.EmptyTree.type">EmptyTree</a> // for alternatives
          // must jump to matchEnd, use result generated by matchFailGen (could be `FALSE` for isDefinedAt)
          <a href="../../../reflect/internal/Trees.scala.html#441828" title="(sym: PatMatVirtualiser.this.global.Symbol, params: List[PatMatVirtualiser.this.global.Symbol], rhs: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.LabelDef">LabelDef</a><span class="delimiter">(</span><a href="#1144306" title="PatMatVirtualiser.this.global.MethodSymbol">nextCase</a>, <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>, <a href="../ast/TreeDSL.scala.html#653648" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethodsFromSymbol : (target: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.CODE.TreeMethods">matchEnd</a> <a href="../ast/TreeDSL.scala.html#691701" title="(params: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Apply">APPLY</a> <span class="delimiter">(</span><a href="../../../Function1.scala.html#59555" title="(v1: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">matchFailGen</a><span class="delimiter">(</span><a href="#1144396" title="PatMatVirtualiser.this.global.gen.global.Tree">scrutRef</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          // don't cast the arg to matchEnd when using PartialFun synth in uncurry, since it won't detect the throw (see gen.withDefaultCase)
          // the cast is necessary when using typedMatchAnonFun-style PartialFun synth:
          // (_asInstanceOf(matchFailGen(scrutRef), restpe))
        <span class="delimiter">}</span> <a href="../../../Option.scala.html#63849" title="=&gt; List[PatMatVirtualiser.this.global.LabelDef]">toList</a>
        // catchAll.isEmpty iff no synthetic default case needed (the (last) user-defined case is a default)
        // if the last user-defined case is a default, it will never jump to the next case; it will go immediately to matchEnd

        // the generated block is taken apart in TailCalls under the following assumptions
          // the assumption is once we encounter a case, the remainder of the block will consist of cases
          // the prologue may be empty, usually it is the valdef that stores the scrut
          // val (prologue, cases) = stats span (s =&gt; !s.isInstanceOf[LabelDef])

        // scrutSym == NoSymbol when generating an alternatives matcher
        <span class="keyword">val</span> <a title="List[PatMatVirtualiser.this.global.ValDef]" id="1144309">scrutDef</a> = <span title="List[PatMatVirtualiser.this.global.ValDef]" class="keyword">if</span><span class="delimiter">(</span><a href="#1144297" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; PatMatVirtualiser.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.ValDef*)List[PatMatVirtualiser.this.global.ValDef]">List</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653627" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.CODE.ValSymStart">VAL</a><span class="delimiter">(</span><a href="#1144297" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a><span class="delimiter">)</span>  <a href="../ast/TreeDSL.scala.html#692482" title="(rhs: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.ValDef">===</a> <a href="#1144296" title="PatMatVirtualiser.this.global.Tree">scrut</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a> // for alternatives
        <a href="../../../reflect/api/Trees.scala.html#427284" title="(stats: List[PatMatVirtualiser.this.global.Tree], expr: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Block">Block</a><span class="delimiter">(</span>
          <a href="#1144309" title="List[PatMatVirtualiser.this.global.ValDef]">scrutDef</a> <a href="../../../collection/immutable/List.scala.html#63655" title="(that: scala.collection.GenTraversableOnce[PatMatVirtualiser.this.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.ValDef],PatMatVirtualiser.this.global.Tree,List[PatMatVirtualiser.this.global.Tree]])List[PatMatVirtualiser.this.global.Tree]">++</a> <span class="delimiter">(</span><a href="#1144299" title="List[OptimizedCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]">cases</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: (OptimizedCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree) =&gt; PatMatVirtualiser.this.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[OptimizedCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree],PatMatVirtualiser.this.global.Tree,List[PatMatVirtualiser.this.global.Tree]])List[PatMatVirtualiser.this.global.Tree]">map</a> <a href="#1144307" title="(mkCase: OptimizedCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">caseDef</a><span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#63655" title="(that: scala.collection.GenTraversableOnce[PatMatVirtualiser.this.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[PatMatVirtualiser.this.global.Tree],PatMatVirtualiser.this.global.Tree,List[PatMatVirtualiser.this.global.Tree]])List[PatMatVirtualiser.this.global.Tree]">++</a> <a href="#1144308" title="=&gt; List[PatMatVirtualiser.this.global.LabelDef]">catchAll</a>,
          <a href="../../../reflect/internal/Trees.scala.html#441828" title="(sym: PatMatVirtualiser.this.global.Symbol, params: List[PatMatVirtualiser.this.global.Symbol], rhs: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.LabelDef">LabelDef</a><span class="delimiter">(</span><a href="#1144303" title="PatMatVirtualiser.this.global.MethodSymbol">matchEnd</a>, <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PatMatVirtualiser.this.global.TermSymbol*)List[PatMatVirtualiser.this.global.TermSymbol]">List</a><span class="delimiter">(</span><a href="#1144304" title="PatMatVirtualiser.this.global.TermSymbol">matchRes</a><span class="delimiter">)</span>, <a href="../ast/TreeDSL.scala.html#653643" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1144304" title="PatMatVirtualiser.this.global.TermSymbol">matchRes</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">class</span> <a title="class OptimizedCasegen extends OptimizedCodegen.this.CommonCodegen with OptimizedCodegen.this.Casegen" id="1142710">OptimizedCasegen</a><a href="#1142710" title="scala.tools.nsc.typechecker.PatMatVirtualiser.OptimizedCodegen.optimizedCodegen.OptimizedCasegen" class="delimiter">(</a><a title="PatMatVirtualiser.this.global.Symbol" id="1144356">matchEnd</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1144357">nextCase</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1144358">restpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#1134725" title="OptimizedCodegen.this.CommonCodegen">CommonCodegen</a> <span class="keyword">with</span> <a href="#1134722" title="OptimizedCodegen.this.Casegen">Casegen</a> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, restpe: PatMatVirtualiser.this.global.Type)(cases: List[OptimizedCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree], matchFailGen: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree" id="1142718">matcher</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1144669">scrut</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1144670">scrutSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Type" id="1144671">restpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="List[OptimizedCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]" id="1144672">cases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[OptimizedCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]">List</a><span class="delimiter">[</span>Casegen =&gt; Tree<span class="delimiter">]</span>, <a title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]" id="1144673">matchFailGen</a>: <a href="../../../Option.scala.html#1510" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree =&gt; Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> =
          <a href="#1134905" title="OptimizedCodegen.this.optimizedCodegen.type">optimizedCodegen</a>.<a href="#1142709" title="(scrut: PatMatVirtualiser.this.global.Tree, scrutSym: PatMatVirtualiser.this.global.Symbol, restpe: PatMatVirtualiser.this.global.Type)(cases: List[OptimizedCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree], matchFailGen: Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree])PatMatVirtualiser.this.global.Tree">matcher</a><span class="delimiter">(</span><a href="#1144669" title="PatMatVirtualiser.this.global.Tree">scrut</a>, <a href="#1144670" title="PatMatVirtualiser.this.global.Symbol">scrutSym</a>, <a href="#1144671" title="PatMatVirtualiser.this.global.Type">restpe</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1144672" title="List[OptimizedCodegen.this.Casegen =&gt; PatMatVirtualiser.this.global.Tree]">cases</a>, <a href="#1144673" title="Option[PatMatVirtualiser.this.global.Tree =&gt; PatMatVirtualiser.this.global.Tree]">matchFailGen</a><span class="delimiter">)</span>

        // only used to wrap the RHS of a body
        // res: T
        // returns MatchMonad[T]
        <span class="keyword">def</span> <a title="(res: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1142719">one</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1144679">res</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="../ast/TreeDSL.scala.html#653648" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethodsFromSymbol : (target: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.CODE.TreeMethods">matchEnd</a> <a href="../ast/TreeDSL.scala.html#691701" title="(params: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Apply">APPLY</a> <span class="delimiter">(</span><a href="#1140562" title="(t: PatMatVirtualiser.this.global.Tree, tp: PatMatVirtualiser.this.global.Type, force: Boolean)PatMatVirtualiser.this.global.Tree">_asInstanceOf</a><span class="delimiter">(</span><a href="#1144679" title="PatMatVirtualiser.this.global.Tree">res</a>, <a href="#1144358" title="PatMatVirtualiser.this.global.Type">restpe</a><span class="delimiter">)</span><span class="delimiter">)</span> // need cast for GADT magic
        <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; PatMatVirtualiser.this.global.Tree" id="1142720">zero</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <a href="../ast/TreeDSL.scala.html#653648" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethodsFromSymbol : (target: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.CODE.TreeMethods">nextCase</a> <a href="../ast/TreeDSL.scala.html#691701" title="(params: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Apply">APPLY</a> <span class="delimiter">(</span><span class="delimiter">)</span>

        // prev: MatchMonad[T]
        // b: T
        // next: MatchMonad[U]
        // returns MatchMonad[U]
        <span class="keyword">def</span> <a title="(prev: PatMatVirtualiser.this.global.Tree, b: PatMatVirtualiser.this.global.Symbol, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1142721">flatMap</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1144709">prev</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1144710">b</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1144711">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Type" id="1144713">tp</a>      = <a href="#1134900" title="(tp: PatMatVirtualiser.this.global.Type)PatMatVirtualiser.this.global.Type">inMatchMonad</a><span class="delimiter">(</span><a href="#1144710" title="PatMatVirtualiser.this.global.Symbol">b</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; PatMatVirtualiser.this.global.Type">tpe</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.TermSymbol" id="1144714">prevSym</a> = <a href="#1134720" title="(pos: PatMatVirtualiser.this.global.Position, tp: PatMatVirtualiser.this.global.Type, prefix: String)PatMatVirtualiser.this.global.TermSymbol">freshSym</a><span class="delimiter">(</span><a href="#1144709" title="PatMatVirtualiser.this.global.Tree">prev</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; PatMatVirtualiser.this.global.Position">pos</a>, <a href="#1144713" title="PatMatVirtualiser.this.global.Type">tp</a>, <span title="String(&quot;o&quot;)" class="string">&quot;o&quot;</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Symbol" id="1144715">isEmpty</a> = <a href="#1144713" title="PatMatVirtualiser.this.global.Type">tp</a> <a href="../../../reflect/internal/Types.scala.html#442028" title="(name: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.global.Symbol">member</a> <a href="#560231" title="PatMatVirtualiser.this.vpmName.type">vpmName</a>.<a href="#1134620" title="=&gt; PatMatVirtualiser.this.global.TermName">isEmpty</a>
          <span class="keyword">val</span> <a title="PatMatVirtualiser.this.global.Symbol" id="1144716">get</a>     = <a href="#1144713" title="PatMatVirtualiser.this.global.Type">tp</a> <a href="../../../reflect/internal/Types.scala.html#442028" title="(name: PatMatVirtualiser.this.global.Name)PatMatVirtualiser.this.global.Symbol">member</a> <a href="#560231" title="PatMatVirtualiser.this.vpmName.type">vpmName</a>.<a href="#1134616" title="=&gt; PatMatVirtualiser.this.global.TermName">get</a>

          <a href="../ast/TreeDSL.scala.html#653638" title="(xs: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Block">BLOCK</a><span class="delimiter">(</span>
            <a href="../ast/TreeDSL.scala.html#653627" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.CODE.ValSymStart">VAL</a><span class="delimiter">(</span><a href="#1144714" title="PatMatVirtualiser.this.global.TermSymbol">prevSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#692482" title="(rhs: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.ValDef">===</a> <a href="#1144709" title="PatMatVirtualiser.this.global.Tree">prev</a>,
            // must be isEmpty and get as we don't control the target of the call (prev is an extractor call)
            <a href="#1138811" title="(c: PatMatVirtualiser.this.global.Tree, then: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">ifThenElseZero</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653639" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Select">NOT</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653648" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethodsFromSymbol : (target: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.CODE.TreeMethods">prevSym</a> <a href="../ast/TreeDSL.scala.html#653650" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeFromSelectStart : (ss: PatMatVirtualiser.this.CODE.SelectStart)PatMatVirtualiser.this.global.Select">DOT</a> <a href="#1144715" title="PatMatVirtualiser.this.global.Symbol">isEmpty</a><span class="delimiter">)</span>, <a href="#1137874" title="(from: PatMatVirtualiser.this.global.Symbol, to: PatMatVirtualiser.this.global.Tree)OptimizedCodegen.this.Substitution">Substitution</a><a href="#1135272" title="(tree: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" class="delimiter">(</a><a href="#1144710" title="PatMatVirtualiser.this.global.Symbol">b</a>, <a href="../ast/TreeDSL.scala.html#653648" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethodsFromSymbol : (target: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.CODE.TreeMethods">prevSym</a> <a href="../ast/TreeDSL.scala.html#653650" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeFromSelectStart : (ss: PatMatVirtualiser.this.CODE.SelectStart)PatMatVirtualiser.this.global.Select">DOT</a> <a href="#1144716" title="PatMatVirtualiser.this.global.Symbol">get</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1144711" title="PatMatVirtualiser.this.global.Tree">next</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">)</span>
        <span class="delimiter">}</span>

        // cond: Boolean
        // res: T
        // nextBinder: T
        // next == MatchMonad[U]
        // returns MatchMonad[U]
        <span class="keyword">def</span> <a title="(cond: PatMatVirtualiser.this.global.Tree, res: PatMatVirtualiser.this.global.Tree, nextBinder: PatMatVirtualiser.this.global.Symbol, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1142722">flatMapCond</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1144760">cond</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1144761">res</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1144762">nextBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1144763">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> =
          <a href="#1138811" title="(c: PatMatVirtualiser.this.global.Tree, then: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">ifThenElseZero</a><span class="delimiter">(</span><a href="#1144760" title="PatMatVirtualiser.this.global.Tree">cond</a>, <a href="../ast/TreeDSL.scala.html#653638" title="(xs: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Block">BLOCK</a><span class="delimiter">(</span>
            <a href="../ast/TreeDSL.scala.html#653627" title="(sym: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.CODE.ValSymStart">VAL</a><span class="delimiter">(</span><a href="#1144762" title="PatMatVirtualiser.this.global.Symbol">nextBinder</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#692482" title="(rhs: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.ValDef">===</a> <a href="#1144761" title="PatMatVirtualiser.this.global.Tree">res</a>,
            <a href="#1144763" title="PatMatVirtualiser.this.global.Tree">next</a>
          <span class="delimiter">)</span><span class="delimiter">)</span>

        // guardTree: Boolean
        // next: MatchMonad[T]
        // returns MatchMonad[T]
        <span class="keyword">def</span> <a title="(guardTree: PatMatVirtualiser.this.global.Tree, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1142723">flatMapGuard</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1144775">guardTree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1144776">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> =
          <a href="#1138811" title="(c: PatMatVirtualiser.this.global.Tree, then: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">ifThenElseZero</a><span class="delimiter">(</span><a href="#1144775" title="PatMatVirtualiser.this.global.Tree">guardTree</a>, <a href="#1144776" title="PatMatVirtualiser.this.global.Tree">next</a><span class="delimiter">)</span>

        <span class="keyword">def</span> <a title="(cond: PatMatVirtualiser.this.global.Tree, condSym: PatMatVirtualiser.this.global.Symbol, res: PatMatVirtualiser.this.global.Tree, nextBinder: PatMatVirtualiser.this.global.Symbol, next: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree" id="1142724">flatMapCondStored</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Tree" id="1142725">cond</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1142726">condSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1142727">res</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a>, <a title="PatMatVirtualiser.this.global.Symbol" id="1142728">nextBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="PatMatVirtualiser.this.global.Tree" id="1142729">next</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PatMatVirtualiser.this.global.Tree">Tree</a> =
          <a href="#1138811" title="(c: PatMatVirtualiser.this.global.Tree, then: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Tree">ifThenElseZero</a><span class="delimiter">(</span><a href="#1142725" title="PatMatVirtualiser.this.global.Tree">cond</a>, <a href="../ast/TreeDSL.scala.html#653638" title="(xs: PatMatVirtualiser.this.global.Tree*)PatMatVirtualiser.this.global.Block">BLOCK</a><span class="delimiter">(</span>
            <a href="../ast/TreeDSL.scala.html#653648" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethodsFromSymbol : (target: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.CODE.TreeMethods">condSym</a>    <a href="../ast/TreeDSL.scala.html#691706" title="(rhs: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Assign">===</a> <a href="../ast/TreeDSL.scala.html#653593" title="=&gt; PatMatVirtualiser.this.global.Literal">TRUE_typed</a>,
            <a href="../ast/TreeDSL.scala.html#653648" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethodsFromSymbol : (target: PatMatVirtualiser.this.global.Symbol)PatMatVirtualiser.this.CODE.TreeMethods">nextBinder</a> <a href="../ast/TreeDSL.scala.html#691706" title="(rhs: PatMatVirtualiser.this.global.Tree)PatMatVirtualiser.this.global.Assign">===</a> <a href="#1142727" title="PatMatVirtualiser.this.global.Tree">res</a>,
            <a href="#1142729" title="PatMatVirtualiser.this.global.Tree">next</a>
          <span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="keyword">trait</span> <a title="trait MatchOptimizations extends Object with PatMatVirtualiser.this.CommonSubconditionElimination with PatMatVirtualiser.this.DeadCodeElimination with PatMatVirtualiser.this.SwitchEmission with PatMatVirtualiser.this.OptimizedCodegen" id="560250">MatchOptimizations</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="#560245" title="PatMatVirtualiser.this.CommonSubconditionElimination">CommonSubconditionElimination</a>
                              <span class="keyword">with</span> <a href="#560246" title="PatMatVirtualiser.this.DeadCodeElimination">DeadCodeElimination</a>
                              <span class="keyword">with</span> <a href="#560247" title="PatMatVirtualiser.this.SwitchEmission">SwitchEmission</a>
                              <span class="keyword">with</span> <a href="#560249" title="PatMatVirtualiser.this.OptimizedCodegen">OptimizedCodegen</a> <span class="delimiter">{</span> self: TreeMakers =&gt;
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(prevBinder: PatMatVirtualiser.this.global.Symbol, cases: List[List[MatchOptimizations.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type)(List[List[MatchOptimizations.this.TreeMaker]], List[PatMatVirtualiser.this.global.Tree])" id="1134887">optimizeCases</a><span class="delimiter">(</span><a title="PatMatVirtualiser.this.global.Symbol" id="1144789">prevBinder</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PatMatVirtualiser.this.global.Symbol">Symbol</a>, <a title="List[List[MatchOptimizations.this.TreeMaker]]" id="1144790">cases</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[MatchOptimizations.this.TreeMaker]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="PatMatVirtualiser.this.global.Type" id="1144791">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PatMatVirtualiser.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../Tuple2.scala.html#1222" title="(List[List[MatchOptimizations.this.TreeMaker]], List[PatMatVirtualiser.this.global.Tree])" class="delimiter">(</a>List<span class="delimiter">[</span>List<span class="delimiter">[</span>TreeMaker<span class="delimiter">]</span><span class="delimiter">]</span>, List<span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[List[MatchOptimizations.this.TreeMaker]]" id="1144796">optCases</a> = <a href="#1134878" title="(prevBinder: PatMatVirtualiser.this.global.Symbol, cases: List[List[MatchOptimizations.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type)List[List[MatchOptimizations.this.TreeMaker]]">doCSE</a><span class="delimiter">(</span><a href="#1144789" title="PatMatVirtualiser.this.global.Symbol">prevBinder</a>, <a href="#1134890" title="(prevBinder: PatMatVirtualiser.this.global.Symbol, cases: List[List[MatchOptimizations.this.TreeMaker]], pt: PatMatVirtualiser.this.global.Type)List[List[MatchOptimizations.this.TreeMaker]]">doDCE</a><span class="delimiter">(</span><a href="#1144789" title="PatMatVirtualiser.this.global.Symbol">prevBinder</a>, <a href="#1144790" title="List[List[MatchOptimizations.this.TreeMaker]]">cases</a>, <a href="#1144791" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span>, <a href="#1144791" title="PatMatVirtualiser.this.global.Type">pt</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="List[PatMatVirtualiser.this.global.Tree]" id="1144797">toHoist</a> = <span class="delimiter">(</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><a title="List[MatchOptimizations.this.TreeMaker]" id="1144820">treeMakers</a> &lt;- <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: List[MatchOptimizations.this.TreeMaker] =&gt; List[List[PatMatVirtualiser.this.global.Tree]])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[MatchOptimizations.this.TreeMaker]],List[List[PatMatVirtualiser.this.global.Tree]],List[List[List[PatMatVirtualiser.this.global.Tree]]]])List[List[List[PatMatVirtualiser.this.global.Tree]]]">optCases</a><span class="delimiter">)</span>
          <span class="keyword">yield</span> <a href="#1144820" title="List[MatchOptimizations.this.TreeMaker]">treeMakers</a>.<a href="../../../collection/TraversableLike.scala.html#58983" title="(pf: PartialFunction[MatchOptimizations.this.TreeMaker,List[PatMatVirtualiser.this.global.Tree]])(implicit bf: scala.collection.generic.CanBuildFrom[List[MatchOptimizations.this.TreeMaker],List[PatMatVirtualiser.this.global.Tree],List[List[PatMatVirtualiser.this.global.Tree]]])List[List[PatMatVirtualiser.this.global.Tree]]">collect</a><a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[MatchOptimizations.this.TreeMaker,List[PatMatVirtualiser.this.global.Tree]] with Serializable" id="1144849" class="delimiter">{</a><span class="keyword">case</span> <a href="#1144840" title="B1" id="1144855">tm</a>: ReusedCondTreeMaker =&gt; tm.<a href="#1144845" title="(x: B1)B1">treesToHoist</a><span class="delimiter">}</span>
        <span class="delimiter">)</span>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#59386" title="(implicit asTraversable: List[List[PatMatVirtualiser.this.global.Tree]] =&gt; scala.collection.GenTraversableOnce[List[PatMatVirtualiser.this.global.Tree]])List[List[PatMatVirtualiser.this.global.Tree]]">flatten</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#59386" title="(implicit asTraversable: List[PatMatVirtualiser.this.global.Tree] =&gt; scala.collection.GenTraversableOnce[PatMatVirtualiser.this.global.Tree])List[PatMatVirtualiser.this.global.Tree]">flatten</a>.<a href="../../../collection/immutable/List.scala.html#63665" title="=&gt; List[PatMatVirtualiser.this.global.Tree]">toList</a>
      <a href="../../../Tuple2.scala.html#63804" title="(_1: List[List[MatchOptimizations.this.TreeMaker]], _2: List[PatMatVirtualiser.this.global.Tree])(List[List[MatchOptimizations.this.TreeMaker]], List[PatMatVirtualiser.this.global.Tree])" class="delimiter">(</a><a href="#1144796" title="List[List[MatchOptimizations.this.TreeMaker]]">optCases</a>, <a href="#1144797" title="List[PatMatVirtualiser.this.global.Tree]">toHoist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>