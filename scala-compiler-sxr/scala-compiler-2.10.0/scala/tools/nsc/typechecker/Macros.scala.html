<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/typechecker/Macros.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> typechecker

<span class="keyword">import</span> symtab.<a href="../symtab/package.scala.html#55820" title="=&gt; reflect.internal.Flags.type">Flags</a>._
<span class="keyword">import</span> scala.tools.nsc.util._
<span class="keyword">import</span> scala.tools.nsc.util.<a href="../util/ClassPath.scala.html#50228" title="scala.tools.nsc.util.ClassPath.type">ClassPath</a>._
<span class="keyword">import</span> scala.reflect.runtime.ReflectionUtils
<span class="keyword">import</span> scala.collection.mutable.ListBuffer
<span class="keyword">import</span> scala.compat.<a href="../../../compat/Platform.scala.html#16125" title="scala.compat.Platform.type">Platform</a>.EOL
<span class="keyword">import</span> scala.reflect.internal.util.Statistics
<span class="keyword">import</span> scala.reflect.macros.util._
<span class="keyword">import</span> java.lang.<span class="delimiter">{</span>Class =&gt; jClass<span class="delimiter">}</span>
<span class="keyword">import</span> java.lang.reflect.<span class="delimiter">{</span>Array =&gt; jArray, Method =&gt; jMethod<span class="delimiter">}</span>
<span class="keyword">import</span> scala.reflect.internal.util.<a href="../../../reflect/internal/util/Collections.scala.html#22747" title="scala.reflect.internal.util.Collections.type">Collections</a>._
<span class="keyword">import</span> scala.util.control.ControlThrowable
<span class="keyword">import</span> scala.reflect.macros.runtime.AbortMacroException

/**
 *  Code to deal with macros, namely with:
 *    * Compilation of macro definitions
 *    * Expansion of macro applications
 *
 *  Say we have in a class C:
 *
 *    def foo[T](xs: List[T]): T = macro fooBar
 *
 *  Then fooBar needs to point to a static method of the following form:
 *
 *    def fooBar[T: c.WeakTypeTag] // type tag annotation is optional
 *           (c: scala.reflect.macros.Context)
 *           (xs: c.Expr[List[T]])
 *           : c.Expr[T] = {
 *      ...
 *    }
 *
 *  Then, if foo is called in qual.foo[Int](elems), where qual: D,
 *  the macro application is expanded to a reflective invocation of fooBar with parameters:
 *
 *    (simpleMacroContext{ type PrefixType = D; val prefix = qual })
 *    (Expr(elems))
 *    (TypeTag(Int))
 */
<span class="keyword">trait</span> <a title="trait Macros extends Object with scala.tools.reflect.FastTrack with scala.reflect.macros.util.Traces" id="47756">Macros</a> <a href="../../../Unit.scala.html#1515" title="Unit" class="keyword">extends</a> scala.tools.reflect.<a href="../../reflect/FastTrack.scala.html#51076" title="scala.tools.reflect.FastTrack">FastTrack</a> <span class="keyword">with</span> <a href="../../../reflect/macros/util/Traces.scala.html#23671" title="scala.reflect.macros.util.Traces">Traces</a> <span class="delimiter">{</span>
  self: Analyzer =&gt;

  <span class="keyword">import</span> <a href="Analyzer.scala.html#537962" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#407777" title="Macros.this.global.definitions.type">definitions</a>._
  <span class="keyword">import</span> <a href="../ast/Trees.scala.html#537807" title="Macros.this.global.treeInfo.type">treeInfo</a>.<span class="delimiter">{</span>isRepeatedParamType =&gt; _, _<span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="#47973" title="scala.tools.nsc.typechecker.MacrosStats.type">MacrosStats</a>._
  <span class="keyword">def</span> <a title="=&gt; scala.tools.nsc.Settings" id="538328">globalSettings</a> = <a href="Analyzer.scala.html#537962" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#537448" title="=&gt; scala.tools.nsc.Settings">settings</a>

  /** `MacroImplBinding` and its companion module are responsible for
   *  serialization/deserialization of macro def -&gt; impl bindings.
   *
   *  The first officially released version of macros persisted these bindings across compilation runs
   *  using a neat trick. The right-hand side of a macro definition (which contains a reference to a macro impl)
   *  was typechecked and then put verbatim into an annotation on the macro definition.
   *
   *  This solution is very simple, but unfortunately it's also lacking. If we use it, then
   *  signatures of macro defs become transitively dependent on scala-reflect.jar
   *  (because they refer to macro impls, and macro impls refer to scala.reflect.macros.Context defined in scala-reflect.jar).
   *  More details can be found in comments to https://issues.scala-lang.org/browse/SI-5940.
   *
   *  Therefore we have to avoid putting macro impls into binding pickles and come up with our own serialization format.
   *  Situation is further complicated by the fact that it's not enough to just pickle macro impl's class name and method name,
   *  because macro expansion needs some knowledge about the shape of macro impl's signature (which we can't pickle).
   *  Hence we precompute necessary stuff (e.g. the layout of type parameters) when compiling macro defs.
   */

  /** Represents all the information that a macro definition needs to know about its implementation.
   *  Includes a path to load the implementation via Java reflection,
   *  and various accounting information necessary when composing an argument list for the reflective invocation.
   */
  <span class="keyword">private</span> case <span class="keyword">class</span> <a title="class MacroImplBinding extends AnyRef with Product with Serializable" id="1051192">MacroImplBinding</a><a href="../../../Product.scala.html#186" title="Product" class="delimiter">(</a>
    // Java class name of the class that contains the macro implementation
    // is used to load the corresponding object with Java reflection
    <span class="keyword">val</span> <a title="String" id="1051187">className</a>: <span title="String">String</span>,
    // method name of the macro implementation
    // `className` and `methName` are all we need to reflectively invoke a macro implementation
    // because macro implementations cannot be overloaded
    <span class="keyword">val</span> <a title="String" id="1051188">methName</a>: <span title="String">String</span>,
    // flattens the macro impl's parameter lists having symbols replaced with metadata
    // currently metadata is an index of the type parameter corresponding to that type tag (if applicable)
    // f.ex. for: def impl[T: WeakTypeTag, U: WeakTypeTag, V](c: Context)(x: c.Expr[T]): (U, V) = ???
    // `signature` will be equal to List(-1, -1, 0, 1)
    <span class="keyword">val</span> <a title="List[Int]" id="1051189">signature</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[Int]">List</a><span class="delimiter">[</span>Int<span class="delimiter">]</span>,
    // type arguments part of a macro impl ref (the right-hand side of a macro definition)
    // these trees don't refer to a macro impl, so we can pickle them as is
    <span class="keyword">val</span> <a title="List[Macros.this.global.Tree]" id="1051190">targs</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[Macros.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>

  /** Macro def -&gt; macro impl bindings are serialized into a `macroImpl` annotation
   *  with synthetic content that carries the payload described in `MacroImplBinding`.
   *
   *  For example, for a pair of macro definition and macro implementation:
   *    def impl(c: scala.reflect.macros.Context): c.Expr[Unit] = c.literalUnit;
   *    def foo: Unit = macro impl
   *
   *  We will have the following annotation added on the macro definition `foo`:
   *
   *    @scala.reflect.macros.internal.macroImpl(
   *      `macro`(
   *        &quot;signature&quot; = List(-1),
   *        &quot;methodName&quot; = &quot;impl&quot;,
   *        &quot;versionFormat&quot; = 1,
   *        &quot;className&quot; = &quot;Macros$&quot;))
   */
  <span class="keyword">private</span> <span class="keyword">object</span> <a title="Macros.this.MacroImplBinding.type" id="1051220">MacroImplBinding</a> <a href="#538331" title="Macros.this.MacroImplBinding.type" class="delimiter">{</a>
    <span class="keyword">val</span> <a title="Int" id="1050552">versionFormat</a> = <span title="Int(1)" class="int">1</span>

    <span class="keyword">def</span> <a title="(obj: Any)Macros.this.global.Tree" id="1050554">pickleAtom</a><span class="delimiter">(</span><a title="Any" id="1050561">obj</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a> =
      <a href="#1050561" title="Any">obj</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#3366025" title="Macros.this.global.Tree" id="3366026">list</a>: List<span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <a href="../../../reflect/internal/Trees.scala.html#413581" title="(fun: Macros.this.global.Tree, args: List[Macros.this.global.Tree])Macros.this.global.Apply">Apply</a><a href="#3366030" title="(x: Macros.this.global.Tree)Macros.this.global.Tree" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#408127" title="(sym: Macros.this.global.Symbol)Macros.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408845" title="=&gt; Macros.this.global.ModuleSymbol">ListModule</a><span class="delimiter">)</span>, list <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: _ =&gt; Macros.this.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[_],Macros.this.global.Tree,List[Macros.this.global.Tree]])List[Macros.this.global.Tree]">map</a> <a href="#1050554" title="(obj: Any)Macros.this.global.Tree">pickleAtom</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#3366025" title="Macros.this.global.Tree" id="3366027">s</a>: String =&gt; <a href="../../../reflect/internal/Trees.scala.html#413609" title="(value: Macros.this.global.Constant)Macros.this.global.Literal">Literal</a><a href="#3366030" title="(x: Macros.this.global.Tree)Macros.this.global.Tree" class="delimiter">(</a><a href="../../../reflect/internal/Constants.scala.html#415091" title="(value: Any)Macros.this.global.Constant">Constant</a><span class="delimiter">(</span>s<span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#3366025" title="Macros.this.global.Tree" id="3366028">i</a>: Int =&gt; <a href="../../../reflect/internal/Trees.scala.html#413609" title="(value: Macros.this.global.Constant)Macros.this.global.Literal">Literal</a><a href="#3366030" title="(x: Macros.this.global.Tree)Macros.this.global.Tree" class="delimiter">(</a><a href="../../../reflect/internal/Constants.scala.html#415091" title="(value: Any)Macros.this.global.Constant">Constant</a><span class="delimiter">(</span>i<span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Any" id="1050555">unpickleAtom</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1050659">tree</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <span title="Any">Any</span> =
      <a href="#1050659" title="Macros.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Apply<a href="#3366036" title="Any" id="3366038" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410031" title="Macros.this.global.Tree" id="1050665">list</a> @ Ident<a href="#1050665" title="Any" id="3366041" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#409987" title="Macros.this.global.Name" id="3366039">_</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/Trees.scala.html#410033" title="List[Macros.this.global.Tree]" id="1050669">args</a><span class="delimiter">)</span> <span class="keyword">if</span> list.<a href="../../../reflect/internal/Trees.scala.html#409939" title="=&gt; Macros.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#408845" title="=&gt; Macros.this.global.ModuleSymbol">ListModule</a> =&gt; <a href="#1050669" title="List[Macros.this.global.Tree]">args</a> <a href="#3366052" title="(x: Any)Any">map</a> <a href="#1050555" title="(tree: Macros.this.global.Tree)Any">unpickleAtom</a>
        <span class="keyword">case</span> Literal<a href="#3366036" title="Boolean" id="3366044" class="delimiter">(</a>Constant<a href="../../../reflect/internal/Trees.scala.html#409973" title="Macros.this.global.Constant" id="3366042" class="delimiter">(</a><a href="../../../reflect/internal/Constants.scala.html#409760" title="Any" id="1050721">s</a>: String<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#3366052" title="(x: Any)Any">s</a>
        <span class="keyword">case</span> Literal<span class="delimiter">(</span>Constant<a href="../../../reflect/internal/Trees.scala.html#409973" title="Macros.this.global.Constant" id="3366045" class="delimiter">(</a><a href="../../../reflect/internal/Constants.scala.html#409760" title="Any" id="1050723">i</a>: Int<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#3366052" title="(x: Any)Any">i</a>
      <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(macroImplRef: Macros.this.global.Tree)Macros.this.global.Tree" id="1050556">pickle</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1050724">macroImplRef</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1050726">macroImpl</a> = <a href="#1050724" title="Macros.this.global.Tree">macroImplRef</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a>
      <span class="keyword">val</span> <a title="List[List[Macros.this.global.Symbol]]" id="1050727">paramss</a> = <a href="#1050726" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#411390" title="=&gt; List[List[Macros.this.global.Symbol]]">paramss</a>

      // this logic relies on the assumptions that were valid for the old macro prototype
      // namely that macro implementations can only be defined in top-level classes and modules
      // with the new prototype that materialized in a SIP, macros need to be statically accessible, which is different
      // for example, a macro def could be defined in a trait that is implemented by an object
      // there are some more clever cases when seemingly non-static method ends up being statically accessible
      // however, the code below doesn't account for these guys, because it'd take a look of time to get it right
      // for now I leave it as a todo and move along to more the important stuff
      // todo. refactor when fixing SI-5498
      <span class="keyword">def</span> <a title="=&gt; String" id="1050728">className</a>: <span title="String">String</span> = <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="(sym: Macros.this.global.Symbol)String" id="1050734">loop</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1050735">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#1050735" title="Macros.this.global.Symbol">sym</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> sym <span class="keyword">if</span> sym.<a href="../../../reflect/internal/Symbols.scala.html#411315" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#411219" title="=&gt; Boolean">isPackageClass</a> =&gt;
            <span class="keyword">val</span> <a title="String" id="1050738">suffix</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span>sym.<a href="../../../reflect/api/Symbols.scala.html#402404" title="=&gt; Boolean">isModuleClass</a><span class="delimiter">)</span> <span title="String(&quot;$&quot;)" class="string">&quot;$&quot;</span> <span class="keyword">else</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>
            sym.<a href="../../../reflect/internal/Symbols.scala.html#411334" title="=&gt; String">fullName</a> <span title="(x$1: Any)String">+</span> <a href="#1050738" title="String">suffix</a>
          <span class="keyword">case</span> sym =&gt;
            <span class="keyword">val</span> <a title="String" id="1050742">separator</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span>sym.<a href="../../../reflect/internal/Symbols.scala.html#411315" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/api/Symbols.scala.html#402404" title="=&gt; Boolean">isModuleClass</a><span class="delimiter">)</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> <span class="keyword">else</span> <span title="String(&quot;$&quot;)" class="string">&quot;$&quot;</span>
            <a href="#1050734" title="(sym: Macros.this.global.Symbol)String">loop</a><span class="delimiter">(</span>sym.<a href="../../../reflect/internal/Symbols.scala.html#411315" title="=&gt; Macros.this.global.Symbol">owner</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <a href="#1050742" title="String">separator</a> <span title="(x$1: Any)String">+</span> sym.<a href="../../../reflect/internal/Symbols.scala.html#411328" title="=&gt; Macros.this.global.Name">javaSimpleName</a>.<span title="()String">toString</span>
        <span class="delimiter">}</span>

        <a href="#1050734" title="(sym: Macros.this.global.Symbol)String">loop</a><span class="delimiter">(</span><a href="#1050726" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#411315" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#411422" title="=&gt; Macros.this.global.Symbol">enclClass</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="=&gt; List[Int]" id="1050729">signature</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[Int]">List</a><span class="delimiter">[</span>Int<span class="delimiter">]</span> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="List[List[Macros.this.global.Symbol]]" id="1050744">transformed</a> = <a href="#538334" title="(paramss: List[List[Macros.this.global.Symbol]], transform: (Macros.this.global.Symbol, Macros.this.global.Symbol) =&gt; Macros.this.global.Symbol)List[List[Macros.this.global.Symbol]]">transformTypeTagEvidenceParams</a><span class="delimiter">(</span><a href="#1050727" title="List[List[Macros.this.global.Symbol]]">paramss</a>, <span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1050746">param</a>, <a title="Macros.this.global.Symbol" id="1050747">tparam</a><span class="delimiter">)</span> =&gt; <a href="#1050747" title="Macros.this.global.Symbol">tparam</a><span class="delimiter">)</span>
        <a href="#1050744" title="List[List[Macros.this.global.Symbol]]">transformed</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#58488" title="(implicit asTraversable: List[Macros.this.global.Symbol] =&gt; scala.collection.GenTraversableOnce[Macros.this.global.Symbol])List[Macros.this.global.Symbol]">flatten</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Macros.this.global.Symbol =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Int,List[Int]])List[Int]">map</a> <span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1050773">p</a> =&gt; <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#1050773" title="Macros.this.global.Symbol">p</a>.<a href="../../../reflect/api/Symbols.scala.html#402396" title="=&gt; Boolean">isTerm</a><span class="delimiter">)</span> -<span title="Int(-1)" class="int">1</span> <span class="keyword">else</span> <a href="#1050773" title="Macros.this.global.Symbol">p</a>.<a href="../../../reflect/internal/Symbols.scala.html#411314" title="=&gt; Int">paramPos</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="List[(String, Any)]" id="1050730">payload</a> = <a href="../../../collection/immutable/List.scala.html#62451" title="[A](xs: A*)List[A]">List</a><span title="(xs: (String, Any)*)List[(String, Any)]" class="delimiter">[</span><a href="../../../Tuple2.scala.html#783" title="(String, Any)" class="delimiter">(</a>String, Any<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">(</span>
        <a href="../../../Predef.scala.html#7509" title="(x: String)ArrowAssoc[String]" class="string">&quot;versionFormat&quot;</a> <a href="../../../Predef.scala.html#62634" title="(y: Int)(String, Int)">-&gt;</a> <a href="#1050552" title="=&gt; Int">versionFormat</a>,
        <a href="../../../Predef.scala.html#7509" title="(x: String)ArrowAssoc[String]" class="string">&quot;className&quot;</a>     <a href="../../../Predef.scala.html#62634" title="(y: String)(String, String)">-&gt;</a> <a href="#1050728" title="=&gt; String">className</a>,
        <a href="../../../Predef.scala.html#7509" title="(x: String)ArrowAssoc[String]" class="string">&quot;methodName&quot;</a>    <a href="../../../Predef.scala.html#62634" title="(y: String)(String, String)">-&gt;</a> <a href="#1050726" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; macroImpl.NameType">name</a>.<span title="()String">toString</span>,
        <a href="../../../Predef.scala.html#7509" title="(x: String)ArrowAssoc[String]" class="string">&quot;signature&quot;</a>     <a href="../../../Predef.scala.html#62634" title="(y: List[Int])(String, List[Int])">-&gt;</a> <a href="#1050729" title="=&gt; List[Int]">signature</a>
      <span class="delimiter">)</span>

      // the shape of the nucleus is chosen arbitrarily. it doesn't carry any payload.
      // it's only necessary as a stub `fun` for an Apply node that carries metadata in its `args`
      // so don't try to find a program element named &quot;macro&quot; that corresponds to the nucleus
      // I just named it &quot;macro&quot;, because it's macro-related, but I could as well name it &quot;foobar&quot;
      <span class="keyword">val</span> <a title="Macros.this.global.Ident" id="1050731">nucleus</a> = <a href="../../../reflect/internal/Trees.scala.html#418125" title="(name: Macros.this.global.Name)Macros.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="../../../reflect/internal/Names.scala.html#406859" title="(s: String)Macros.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;macro&quot;)" class="string">&quot;macro&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Macros.this.global.Apply" id="1050732">wrapped</a> = <a href="../../../reflect/internal/Trees.scala.html#413581" title="(fun: Macros.this.global.Tree, args: List[Macros.this.global.Tree])Macros.this.global.Apply">Apply</a><span class="delimiter">(</span><a href="#1050731" title="Macros.this.global.Ident">nucleus</a>, <a href="#1050730" title="List[(String, Any)]">payload</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: ((String, Any)) =&gt; Macros.this.global.Assign)(implicit bf: scala.collection.generic.CanBuildFrom[List[(String, Any)],Macros.this.global.Assign,List[Macros.this.global.Assign]])List[Macros.this.global.Assign]">map</a> <a href="#1050911" title="(String, Any)" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span><a href="../../../Tuple2.scala.html#60635" title="String" id="1050914">k</a>, <a href="../../../Tuple2.scala.html#60637" title="Any" id="1050915">v</a><span class="delimiter">)</span> =&gt; <a href="../../../reflect/internal/Trees.scala.html#453516" title="(lhs: Macros.this.global.Tree, rhs: Macros.this.global.Tree)Macros.this.global.Assign">Assign</a><a href="#3366067" title="(x: Macros.this.global.Assign)Macros.this.global.Assign" class="delimiter">(</a><a href="#1050554" title="(obj: Any)Macros.this.global.Tree">pickleAtom</a><span class="delimiter">(</span><a href="#1050914" title="String">k</a><span class="delimiter">)</span>, <a href="#1050554" title="(obj: Any)Macros.this.global.Tree">pickleAtom</a><span class="delimiter">(</span><a href="#1050915" title="Any">v</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Macros.this.global.gen.global.Tree" id="1050733">pickle</a> = <a href="../Global.scala.html#537460" title="Macros.this.global.gen.type">gen</a>.<a href="../../../reflect/internal/TreeGen.scala.html#470998" title="(fun: Macros.this.global.gen.global.Tree, targs: List[Macros.this.global.gen.global.Tree])Macros.this.global.gen.global.Tree">mkTypeApply</a><span class="delimiter">(</span><a href="#1050732" title="Macros.this.global.Apply">wrapped</a>, <a href="../ast/Trees.scala.html#537807" title="Macros.this.global.treeInfo.type">treeInfo</a>.<a href="../../../reflect/internal/TreeInfo.scala.html#479230" title="(tree: Macros.this.global.treeInfo.global.Tree)List[Macros.this.global.treeInfo.global.Tree]">typeArguments</a><span class="delimiter">(</span><a href="#1050724" title="Macros.this.global.Tree">macroImplRef</a>.<a href="../../../reflect/internal/Trees.scala.html#408588" title="=&gt; macroImplRef.type">duplicate</a><span class="delimiter">)</span><span class="delimiter">)</span>

      // assign NoType to all freshly created AST nodes
      // otherwise pickler will choke on tree.tpe being null
      // there's another gotcha
      // if you don't assign a ConstantType to a constant
      // then pickling will crash
      <a href="#1050967" title="Macros.this.global.Transformer" class="keyword">new</a> <a href="../ast/Trees.scala.html#537817" title="anonymous class $anon extends Macros.this.global.Transformer" id="1050967">Transformer</a> <span class="delimiter">{</span>
        <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Macros.this.global.Tree" id="1050969">transform</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1050970">tree</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
          <a href="#1050970" title="Macros.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> Literal<a href="#3366071" title="Any" id="3366073" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#409973" title="Macros.this.global.Constant" id="1050973">const</a> @ Constant<span class="delimiter">(</span><a href="../../../reflect/internal/Constants.scala.html#409760" title="Any" id="1050974">x</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#1050970" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; Macros.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span> =&gt; <a href="#1050970" title="Macros.this.global.Tree">tree</a> <a href="#3366075" title="(x: Any)Any">setType</a> <a href="../../../reflect/internal/Types.scala.html#441752" title="(value: Macros.this.global.Constant)Macros.this.global.UniqueConstantType">ConstantType</a><span class="delimiter">(</span><a href="#1050973" title="Macros.this.global.Constant">const</a><span class="delimiter">)</span>
            <span class="keyword">case</span> _ <span class="keyword">if</span> <a href="#1050970" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; Macros.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span> =&gt; <a href="#1050970" title="Macros.this.global.Tree">tree</a> <a href="#3366075" title="(x: Any)Any">setType</a> <a href="../../../reflect/internal/Types.scala.html#407284" title="Macros.this.global.NoType.type">NoType</a>
            <span class="keyword">case</span> _ =&gt; ;
          <span class="delimiter">}</span>
          <a href="#1050967" title="Macros.this.global.Transformer" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#405652" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1050970" title="Macros.this.global.Tree">tree</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>.<a href="#1050969" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1050733" title="Macros.this.global.gen.global.Tree">pickle</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(pickle: Macros.this.global.Tree)Macros.this.MacroImplBinding" id="1050557">unpickle</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1050999">pickle</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="#1051192" title="Macros.this.MacroImplBinding">MacroImplBinding</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a href="#3366092" title="(x: (Macros.this.global.Tree, List[Macros.this.global.Tree]))(Macros.this.global.Tree, List[Macros.this.global.Tree])" class="delimiter">(</a><a href="../../../Tuple2.scala.html#60635" title="Macros.this.global.Tree" id="1051002">wrapped</a>, <a href="../../../Tuple2.scala.html#60637" title="List[Macros.this.global.Tree]" id="1051003">targs</a><span class="delimiter">)</span> =
        <a href="#1050999" title="Macros.this.global.Tree">pickle</a> <a href="../../../Tuple2.scala.html#783" title="(Macros.this.global.Tree, List[Macros.this.global.Tree]) @unchecked" class="keyword">match</a> <span class="delimiter">{</span>
          <span class="keyword">case</span> TypeApply<a href="#3366081" title="(Macros.this.global.Tree, List[Macros.this.global.Tree])" id="3366083" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410043" title="Macros.this.global.Tree" id="1051012">wrapped</a>, <a href="../../../reflect/internal/Trees.scala.html#410045" title="List[Macros.this.global.Tree]" id="1051013">targs</a><span class="delimiter">)</span> =&gt; <a href="#3366085" title="(x: (Macros.this.global.Tree, List[Macros.this.global.Tree]))(Macros.this.global.Tree, List[Macros.this.global.Tree])" class="delimiter">(</a><a href="#1051012" title="Macros.this.global.Tree">wrapped</a>, <a href="#1051013" title="List[Macros.this.global.Tree]">targs</a><span class="delimiter">)</span>
          <span class="keyword">case</span> wrapped =&gt; <a href="#3366085" title="(x: (Macros.this.global.Tree, List[Macros.this.global.Tree]))(Macros.this.global.Tree, List[Macros.this.global.Tree])" class="delimiter">(</a>wrapped, <a href="../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">val</span> Apply<a href="#3366096" title="List[Macros.this.global.Tree]" id="3366099" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410031" title="Macros.this.global.Tree" id="3366097">_</a>, <a href="../../../reflect/internal/Trees.scala.html#410033" title="List[Macros.this.global.Tree]" id="1051047">pickledPayload</a><span class="delimiter">)</span> = <a href="#1051002" title="Macros.this.global.Tree">wrapped</a>
      <span class="keyword">val</span> <a title="scala.collection.immutable.Map[Any,Any]" id="1051005">payload</a> = <a href="#3366099" title="List[Macros.this.global.Tree]">pickledPayload</a>.<a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Macros.this.global.Tree =&gt; (Any, Any))(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Tree],(Any, Any),List[(Any, Any)]])List[(Any, Any)]">map</a><a href="#1051064" title="Macros.this.global.Tree" class="delimiter">{</a> <span class="keyword">case</span> Assign<a href="#3366105" title="(Any, Any)" id="3366107" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410127" title="Macros.this.global.Tree" id="1051067">k</a>, <a href="../../../reflect/internal/Trees.scala.html#410129" title="Macros.this.global.Tree" id="1051068">v</a><span class="delimiter">)</span> =&gt; <a href="#3366109" title="(x: (Any, Any))(Any, Any)" class="delimiter">(</a><a href="#1050555" title="(tree: Macros.this.global.Tree)Any">unpickleAtom</a><span class="delimiter">(</span><a href="#1051067" title="Macros.this.global.Tree">k</a><span class="delimiter">)</span>, <a href="#1050555" title="(tree: Macros.this.global.Tree)Any">unpickleAtom</a><span class="delimiter">(</span><a href="#1051068" title="Macros.this.global.Tree">v</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span>.<a href="../../../collection/TraversableOnce.scala.html#58277" title="(implicit ev: &lt;:&lt;[(Any, Any),(Any, Any)])scala.collection.immutable.Map[Any,Any]">toMap</a>

      <span class="keyword">val</span> <a title="Int" id="1051006">pickleVersionFormat</a> = <a href="../../../collection/MapLike.scala.html#87535" title="(key: Any)Any">payload</a><span class="delimiter">(</span><span title="String(&quot;versionFormat&quot;)" class="string">&quot;versionFormat&quot;</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Int" class="delimiter">[</span><a href="../../../Int.scala.html#321" title="Int">Int</a><span class="delimiter">]</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1050552" title="=&gt; Int">versionFormat</a> <a href="../../../Int.scala.html#57104" title="(x: Int)Boolean">!=</a> <a href="#1051006" title="Int">pickleVersionFormat</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)Error" class="keyword">new</span> <a href="../../../package.scala.html#55501" title="Error">Error</a><span class="delimiter">(</span><span title="String(&quot;macro impl binding format mismatch: expected $versionFormat, actual $pickleVersionFormat&quot;)" class="string">&quot;macro impl binding format mismatch: expected $versionFormat, actual $pickleVersionFormat&quot;</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="String" id="1051007">className</a> = <a href="../../../collection/MapLike.scala.html#87535" title="(key: Any)Any">payload</a><span class="delimiter">(</span><span title="String(&quot;className&quot;)" class="string">&quot;className&quot;</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="String" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span>
      <span class="keyword">val</span> <a title="String" id="1051008">methodName</a> = <a href="../../../collection/MapLike.scala.html#87535" title="(key: Any)Any">payload</a><span class="delimiter">(</span><span title="String(&quot;methodName&quot;)" class="string">&quot;methodName&quot;</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="String" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span>
      <span class="keyword">val</span> <a title="List[Int]" id="1051009">signature</a> = <a href="../../../collection/MapLike.scala.html#87535" title="(key: Any)Any">payload</a><span class="delimiter">(</span><span title="String(&quot;signature&quot;)" class="string">&quot;signature&quot;</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="List[Int]" class="delimiter">[</span><a href="../../../collection/immutable/List.scala.html#11952" title="List[Int]">List</a><span class="delimiter">[</span>Int<span class="delimiter">]</span><span class="delimiter">]</span>
      <a href="#1051192" title="(className: String, methName: String, signature: List[Int], targs: List[Macros.this.global.Tree])Macros.this.MacroImplBinding">MacroImplBinding</a><span class="delimiter">(</span><a href="#1051007" title="String">className</a>, <a href="#1051008" title="String">methodName</a>, <a href="#1051009" title="List[Int]">signature</a>, <a href="#1051003" title="List[Macros.this.global.Tree]">targs</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(macroDef: Macros.this.global.Symbol, macroImplRef: Macros.this.global.Tree)Unit" id="538332">bindMacroImpl</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1051221">macroDef</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="Macros.this.global.Symbol">Symbol</a>, <a title="Macros.this.global.Tree" id="1051222">macroImplRef</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#1515" title="Unit">Unit</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Macros.this.global.Tree" id="1051224">pickle</a> = <a href="#1051220" title="Macros.this.MacroImplBinding.type">MacroImplBinding</a>.<a href="#1050556" title="(macroImplRef: Macros.this.global.Tree)Macros.this.global.Tree">pickle</a><span class="delimiter">(</span><a href="#1051222" title="Macros.this.global.Tree">macroImplRef</a><span class="delimiter">)</span>
    <a href="#1051221" title="Macros.this.global.Symbol">macroDef</a> <a href="../../../reflect/internal/AnnotationInfos.scala.html#408618" title="(annot: Macros.this.global.AnnotationInfo)Macros.this.global.Symbol">withAnnotation</a> <a href="../../../reflect/internal/AnnotationInfos.scala.html#411921" title="(atp: Macros.this.global.Type, args: List[Macros.this.global.Tree], assocs: List[(Macros.this.global.Name, Macros.this.global.ClassfileAnnotArg)])Macros.this.global.AnnotationInfo">AnnotationInfo</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408946" title="=&gt; Macros.this.global.ClassSymbol">MacroImplAnnotation</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; Macros.this.global.Type">tpe</a>, <a href="../../../collection/immutable/List.scala.html#62451" title="(xs: Macros.this.global.Tree*)List[Macros.this.global.Tree]">List</a><span class="delimiter">(</span><a href="#1051224" title="Macros.this.global.Tree">pickle</a><span class="delimiter">)</span>, <a href="../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(macroDef: Macros.this.global.Symbol)Macros.this.MacroImplBinding" id="538333">loadMacroImplBinding</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1051236">macroDef</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="#1051192" title="Macros.this.MacroImplBinding">MacroImplBinding</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> Some<a href="#3366113" title="Macros.this.global.Tree" id="3366115" class="delimiter">(</a><a href="../../../reflect/internal/AnnotationInfos.scala.html#411922" title="Option[(Macros.this.global.Type, List[Macros.this.global.Tree], List[(Macros.this.global.Name, Macros.this.global.ClassfileAnnotArg)])]" id="3366129">AnnotationInfo</a><a href="../../../Option.scala.html#63132" title="Macros.this.global.AnnotationInfo" id="3366114" class="delimiter">(</a><a href="../../../Tuple3.scala.html#60576" title="Macros.this.global.Type" id="3366116">_</a>, <a href="../../../collection/generic/SeqFactory.scala.html#59986" title="Option[List[Macros.this.global.Tree]]" id="3366128">List</a><a href="../../../Tuple3.scala.html#60578" title="List[Macros.this.global.Tree]" id="3366117" class="delimiter">(</a><a title="Macros.this.global.Tree" id="1051253">pickle</a><span class="delimiter">)</span>, <a href="../../../Tuple3.scala.html#60580" title="List[(Macros.this.global.Name, Macros.this.global.ClassfileAnnotArg)]" id="3366118">_</a><span class="delimiter">)</span><span class="delimiter">)</span> = <a href="#1051236" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/AnnotationInfos.scala.html#408616" title="(cls: Macros.this.global.Symbol)Option[Macros.this.global.AnnotationInfo]">getAnnotation</a><a href="../../../Option.scala.html#978" title="Option[Macros.this.global.AnnotationInfo] @unchecked" class="delimiter">(</a><a href="../../../reflect/internal/Definitions.scala.html#408946" title="=&gt; Macros.this.global.ClassSymbol">MacroImplAnnotation</a><span class="delimiter">)</span>
    <a href="#1051220" title="Macros.this.MacroImplBinding.type">MacroImplBinding</a>.<a href="#1050557" title="(pickle: Macros.this.global.Tree)Macros.this.MacroImplBinding">unpickle</a><span class="delimiter">(</span><a href="#3366115" title="Macros.this.global.Tree">pickle</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** Transforms parameters lists of a macro impl.
   *  The `transform` function is invoked only for WeakTypeTag evidence parameters.
   *
   *  The transformer takes two arguments: a value parameter from the parameter list
   *  and a type parameter that is witnesses by the value parameter.
   *
   *  If the transformer returns a NoSymbol, the value parameter is not included from the result.
   *  If the transformer returns something else, this something else is included in the result instead of the value parameter.
   *
   *  Despite of being highly esoteric, this function significantly simplifies signature analysis.
   *  For example, it can be used to strip macroImpl.paramss from the evidences (necessary when checking def &lt;-&gt; impl correspondence)
   *  or to streamline creation of the list of macro arguments.
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(paramss: List[List[Macros.this.global.Symbol]], transform: (Macros.this.global.Symbol, Macros.this.global.Symbol) =&gt; Macros.this.global.Symbol)List[List[Macros.this.global.Symbol]]" id="538334">transformTypeTagEvidenceParams</a><span class="delimiter">(</span><a title="List[List[Macros.this.global.Symbol]]" id="1033037">paramss</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[List[Macros.this.global.Symbol]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="(Macros.this.global.Symbol, Macros.this.global.Symbol) =&gt; Macros.this.global.Symbol" id="1033038">transform</a>: <span class="delimiter">(</span>Symbol, Symbol<span class="delimiter">)</span> =&gt; Symbol<span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[List[Macros.this.global.Symbol]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1033037" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a> <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="#1033037" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86394" title="=&gt; List[Macros.this.global.Symbol]">last</a>.<a href="../../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <a href="#1033037" title="List[List[Macros.this.global.Symbol]]">paramss</a> // no implicit parameters in the signature =&gt; nothing to do
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1033037" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/IterableLike.scala.html#58577" title="=&gt; List[Macros.this.global.Symbol]">head</a>.<a href="../../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a> <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><span class="delimiter">(</span><a href="#1033037" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/IterableLike.scala.html#58577" title="=&gt; List[Macros.this.global.Symbol]">head</a>.<a href="../../../collection/IterableLike.scala.html#58577" title="=&gt; Macros.this.global.Symbol">head</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Macros.this.global.Type">tpe</a> <a href="../../../reflect/internal/Types.scala.html#408481" title="(that: Macros.this.global.Type)Boolean">&lt;:&lt;</a> <a href="../../../reflect/internal/Definitions.scala.html#408940" title="=&gt; Macros.this.global.Symbol">MacroContextClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Macros.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <a href="#1033037" title="List[List[Macros.this.global.Symbol]]">paramss</a> // no context parameter in the signature =&gt; nothing to do
    <span class="keyword">def</span> <a title="(param: Macros.this.global.Symbol)Macros.this.global.Symbol" id="1051254">transformTag</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1051263">param</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="Macros.this.global.Symbol">Symbol</a> = <a href="#1051263" title="Macros.this.global.Symbol">param</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Macros.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#408439" title="=&gt; Macros.this.global.Type">dealias</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> TypeRef<a href="#3366144" title="Macros.this.global.Symbol" id="3366149" class="delimiter">(</a>SingleType<a href="../../../reflect/internal/Types.scala.html#410887" title="Macros.this.global.Type" id="3366152" class="delimiter">(</a>SingleType<a href="../../../reflect/internal/Types.scala.html#410991" title="Macros.this.global.Type" id="3366155" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#410991" title="Macros.this.global.Type" id="3366161">NoPrefix</a>, <a href="../../../reflect/internal/Types.scala.html#410993" title="Macros.this.global.Symbol" id="1051271">c</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/Types.scala.html#410993" title="Macros.this.global.Symbol" id="1051272">universe</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/Types.scala.html#410889" title="Macros.this.global.Symbol" id="3366162">WeakTypeTagClass</a>, <a href="../../../collection/immutable/List.scala.html#206583" title="Macros.this.global.Type" id="1051314">targ</a> <a href="../../../reflect/internal/Types.scala.html#410891" title="List[Macros.this.global.Type]" id="3366159">::</a> <a href="../../../collection/immutable/List.scala.html#206584" title="List[Macros.this.global.Type]" id="3366163">Nil</a><span class="delimiter">)</span>
      <span class="keyword">if</span> <a href="#1051271" title="Macros.this.global.Symbol">c</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1033037" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/IterableLike.scala.html#58577" title="=&gt; List[Macros.this.global.Symbol]">head</a>.<a href="../../../collection/IterableLike.scala.html#58577" title="=&gt; Macros.this.global.Symbol">head</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1051272" title="Macros.this.global.Symbol">universe</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#408944" title="=&gt; Macros.this.global.Symbol{def name: Macros.this.global.TermName; def rawname: Macros.this.global.TermName; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.NoSymbol &lt;: Macros.this.global.Symbol{def name: Macros.this.global.TermName; def rawname: Macros.this.global.TermName; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.NoSymbol &lt;: Macros.this.global.Symbol; type NameType &lt;: Macros.this.global.TermName}; type NameType &lt;: Macros.this.global.TermName}">MacroContextUniverse</a> =&gt;
        <a href="../../../Function2.scala.html#65848" title="(v1: Macros.this.global.Symbol, v2: Macros.this.global.Symbol)Macros.this.global.Symbol">transform</a><a href="#3366165" title="(x: Macros.this.global.Symbol)Macros.this.global.Symbol" class="delimiter">(</a><a href="#1051263" title="Macros.this.global.Symbol">param</a>, <a href="#1051314" title="Macros.this.global.Type">targ</a>.<a href="../../../reflect/internal/Types.scala.html#408407" title="=&gt; Macros.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt;
        <a href="#3366165" title="(x: Macros.this.global.Symbol)Macros.this.global.Symbol">param</a>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="List[Macros.this.global.Symbol]" id="1051255">transformed</a> = <a href="#1033037" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86394" title="=&gt; List[Macros.this.global.Symbol]">last</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Macros.this.global.Symbol =&gt; Macros.this.global.Symbol)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Macros.this.global.Symbol,List[Macros.this.global.Symbol]])List[Macros.this.global.Symbol]">map</a> <a href="#1051254" title="(param: Macros.this.global.Symbol)Macros.this.global.Symbol">transformTag</a> <a href="../../../collection/TraversableLike.scala.html#58073" title="(p: Macros.this.global.Symbol =&gt; Boolean)List[Macros.this.global.Symbol]">filter</a> <span class="delimiter">(</span><a href="#1051399" title="Macros.this.global.Symbol">_</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="../../../reflect/internal/Symbols.scala.html#407184" title="=&gt; Macros.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span>
    <span title="List[List[Macros.this.global.Symbol]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1051255" title="List[Macros.this.global.Symbol]">transformed</a>.<a href="../../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="#1033037" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/TraversableLike.scala.html#58107" title="=&gt; List[List[Macros.this.global.Symbol]]">init</a> <span class="keyword">else</span> <a href="#1033037" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/TraversableLike.scala.html#58107" title="=&gt; List[List[Macros.this.global.Symbol]]">init</a> <a href="../../../collection/SeqLike.scala.html#58855" title="(elem: List[Macros.this.global.Symbol])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[Macros.this.global.Symbol]],List[Macros.this.global.Symbol],List[List[Macros.this.global.Symbol]]])List[List[Macros.this.global.Symbol]]">:+</a> <a href="#1051255" title="List[Macros.this.global.Symbol]">transformed</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(macroDdef: Macros.this.global.DefDef, macroImpl: Macros.this.global.Symbol)Macros.this.global.Type" id="538335">computeMacroDefTypeFromMacroImpl</a><span class="delimiter">(</span><a title="Macros.this.global.DefDef" id="1033017">macroDdef</a>: <a href="../../../reflect/internal/Trees.scala.html#407963" title="Macros.this.global.DefDef">DefDef</a>, <a title="Macros.this.global.Symbol" id="1033018">macroImpl</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a> = <span class="delimiter">{</span>
    // Step I. Transform c.Expr[T] to T
    <span class="keyword">var</span> <a title="Macros.this.global.Type" id="1051451">runtimeType</a> = <a href="#1033018" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Macros.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#408427" title="=&gt; Macros.this.global.Type">finalResultType</a>.<a href="../../../reflect/internal/Types.scala.html#408439" title="=&gt; Macros.this.global.Type">dealias</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> TypeRef<a href="#3366179" title="Macros.this.global.Type" id="3366184" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#410887" title="Macros.this.global.Type" id="3366180">_</a>, <a href="../../../reflect/internal/Types.scala.html#410889" title="Macros.this.global.Symbol" id="3366189">ExprClass</a>, <a href="../../../collection/immutable/List.scala.html#206583" title="Macros.this.global.Type" id="1051497">runtimeType</a> <a href="../../../reflect/internal/Types.scala.html#410891" title="List[Macros.this.global.Type]" id="3366187">::</a> <a href="../../../collection/immutable/List.scala.html#206584" title="List[Macros.this.global.Type]" id="3366190">Nil</a><span class="delimiter">)</span> =&gt; <a href="#3366192" title="(x: Macros.this.global.Type)Macros.this.global.Type">runtimeType</a>
      <span class="keyword">case</span> _ =&gt; <a href="#3366192" title="(x: Macros.this.global.Type)Macros.this.global.Type">AnyTpe</a> // so that macro impls with rhs = ??? don't screw up our inference
    <span class="delimiter">}</span>

    // Step II. Transform type parameters of a macro implementation into type arguments in a macro definition's body
    <a href="#1051451" title="Macros.this.global.Type">runtimeType</a> = <a href="#1051451" title="Macros.this.global.Type">runtimeType</a>.<a href="../../../reflect/internal/Types.scala.html#408388" title="(from: List[Macros.this.global.Symbol], to: List[Macros.this.global.Type])Macros.this.global.Type">substituteTypes</a><span class="delimiter">(</span><a href="#1033018" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#411389" title="=&gt; List[Macros.this.global.Symbol]">typeParams</a>, <a href="#538333" title="(macroDef: Macros.this.global.Symbol)Macros.this.MacroImplBinding">loadMacroImplBinding</a><span class="delimiter">(</span><a href="#1033017" title="Macros.this.global.DefDef">macroDdef</a>.<a href="../../../reflect/internal/Trees.scala.html#409939" title="=&gt; Macros.this.global.Symbol">symbol</a><span class="delimiter">)</span>.<a href="#1051190" title="=&gt; List[Macros.this.global.Tree]">targs</a>.<a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Macros.this.global.Tree =&gt; Macros.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Tree],Macros.this.global.Type,List[Macros.this.global.Type]])List[Macros.this.global.Type]">map</a><a href="../../../collection/immutable/List.scala.html#62442" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,Macros.this.global.Type,List[Macros.this.global.Type]]" class="delimiter">(</a><a href="#1051524" title="Macros.this.global.Tree">_</a>.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; Macros.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>

    // Step III. Transform c.prefix.value.XXX to this.XXX and implParam.value.YYY to defParam.YYY
    <span class="keyword">def</span> <a title="(tpe: Macros.this.global.Type)Macros.this.global.Type" id="1051452">unsigma</a><span class="delimiter">(</span><a title="Macros.this.global.Type" id="1051557">tpe</a>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a> =
      <a href="#538334" title="(paramss: List[List[Macros.this.global.Symbol]], transform: (Macros.this.global.Symbol, Macros.this.global.Symbol) =&gt; Macros.this.global.Symbol)List[List[Macros.this.global.Symbol]]">transformTypeTagEvidenceParams</a><span title="Macros.this.global.Type" class="delimiter">(</span><a href="#1033018" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#411390" title="=&gt; List[List[Macros.this.global.Symbol]]">paramss</a>, <span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1051559">param</a>, <a title="Macros.this.global.Symbol" id="1051560">tparam</a><span class="delimiter">)</span> =&gt; <a href="../../../reflect/internal/Symbols.scala.html#407184" title="=&gt; Macros.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#206583" title="Macros.this.global.Symbol" id="1051565">implCtxParam</a> <a href="../../../collection/immutable/List.scala.html#206583" title="List[Macros.this.global.Symbol]" id="3366250">::</a> <a href="../../../collection/immutable/List.scala.html#206584" title="List[Macros.this.global.Symbol]" id="3366252">Nil</a><span class="delimiter">)</span> <a href="#3366246" title="Macros.this.global.Type" id="3366248">::</a> <a href="../../../collection/immutable/List.scala.html#206584" title="List[List[Macros.this.global.Symbol]]" id="1051566">implParamss</a> =&gt;
          <span class="keyword">val</span> <a title="scala.collection.immutable.Map[Macros.this.global.Symbol,Macros.this.global.ValDef]" id="1051567">implToDef</a> = <a href="../../../reflect/internal/util/Collections.scala.html#406747" title="(xs1: List[List[Macros.this.global.Symbol]], xs2: List[List[Macros.this.global.ValDef]])(f: (List[Macros.this.global.Symbol], List[Macros.this.global.ValDef]) =&gt; List[(Macros.this.global.Symbol, Macros.this.global.ValDef)])List[(Macros.this.global.Symbol, Macros.this.global.ValDef)]">flatMap2</a><span class="delimiter">(</span><a href="#1051566" title="List[List[Macros.this.global.Symbol]]">implParamss</a>, <a href="#1033017" title="Macros.this.global.DefDef">macroDdef</a>.<a href="../../../reflect/internal/Trees.scala.html#410284" title="=&gt; List[List[Macros.this.global.ValDef]]">vparamss</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../reflect/internal/util/Collections.scala.html#406731" title="(xs1: List[Macros.this.global.Symbol], xs2: List[Macros.this.global.ValDef])(f: (Macros.this.global.Symbol, Macros.this.global.ValDef) =&gt; (Macros.this.global.Symbol, Macros.this.global.ValDef))List[(Macros.this.global.Symbol, Macros.this.global.ValDef)]">map2</a><span class="delimiter">(</span><a href="#1051594" title="List[Macros.this.global.Symbol]">_</a>, <a href="#1051595" title="List[Macros.this.global.ValDef]">_</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../Tuple2.scala.html#62849" title="(_1: Macros.this.global.Symbol, _2: Macros.this.global.ValDef)(Macros.this.global.Symbol, Macros.this.global.ValDef)" class="delimiter">(</a><a href="#1051624" title="Macros.this.global.Symbol">_</a>, <a href="#1051625" title="Macros.this.global.ValDef">_</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../collection/TraversableOnce.scala.html#58277" title="(implicit ev: &lt;:&lt;[(Macros.this.global.Symbol, Macros.this.global.ValDef),(Macros.this.global.Symbol, Macros.this.global.ValDef)])scala.collection.immutable.Map[Macros.this.global.Symbol,Macros.this.global.ValDef]">toMap</a>
          <span class="keyword">object</span> <a title="UnsigmaTypeMap.type" id="1051568">UnsigmaTypeMap</a> <a href="#1051569" title="UnsigmaTypeMap.type" class="keyword">extends</a> <a href="../../../reflect/internal/Types.scala.html#407460" title="Macros.this.global.TypeMap">TypeMap</a> <span class="delimiter">{</span>
            <span class="keyword">def</span> <a title="(tp: Macros.this.global.Type)Macros.this.global.Type" id="1051648">apply</a><span class="delimiter">(</span><a title="Macros.this.global.Type" id="1051650">tp</a>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a> = <a href="#1051650" title="Macros.this.global.Type">tp</a> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> TypeRef<a href="#3366237" title="Macros.this.global.Type" id="3366239" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#410887" title="Macros.this.global.Type" id="1051658">pre</a>, <a href="../../../reflect/internal/Types.scala.html#410889" title="Macros.this.global.Symbol" id="1051659">sym</a>, <a href="../../../reflect/internal/Types.scala.html#410891" title="List[Macros.this.global.Type]" id="1051660">args</a><span class="delimiter">)</span> =&gt;
                <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1051661">pre1</a> = <a href="#1051658" title="Macros.this.global.Type">pre</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                  <span class="keyword">case</span> SingleType<a href="#3366203" title="Boolean" id="3366206" class="delimiter">(</a>SingleType<a href="../../../reflect/internal/Types.scala.html#410991" title="Macros.this.global.Type" id="3366209" class="delimiter">(</a>SingleType<a href="../../../reflect/internal/Types.scala.html#410991" title="Macros.this.global.Type" id="3366212" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#410991" title="Macros.this.global.Type" id="3366221">NoPrefix</a>, <a href="../../../reflect/internal/Types.scala.html#410993" title="Macros.this.global.Symbol" id="1051669">c</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/Types.scala.html#410993" title="Macros.this.global.Symbol" id="1051670">prefix</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/Types.scala.html#410993" title="Macros.this.global.Symbol" id="1051671">value</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#1051669" title="Macros.this.global.Symbol">c</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1051565" title="Macros.this.global.Symbol">implCtxParam</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1051670" title="Macros.this.global.Symbol">prefix</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#408942" title="=&gt; Macros.this.global.Symbol{def name: Macros.this.global.TermName; def rawname: Macros.this.global.TermName; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.NoSymbol &lt;: Macros.this.global.Symbol{def name: Macros.this.global.TermName; def rawname: Macros.this.global.TermName; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.NoSymbol &lt;: Macros.this.global.Symbol; type NameType &lt;: Macros.this.global.TermName}; type NameType &lt;: Macros.this.global.TermName}">MacroContextPrefix</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1051671" title="Macros.this.global.Symbol">value</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#408909" title="=&gt; Macros.this.global.Symbol{def name: Macros.this.global.TermName; def rawname: Macros.this.global.TermName; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.NoSymbol &lt;: Macros.this.global.Symbol{def name: Macros.this.global.TermName; def rawname: Macros.this.global.TermName; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.NoSymbol &lt;: Macros.this.global.Symbol; type NameType &lt;: Macros.this.global.TermName}; type NameType &lt;: Macros.this.global.TermName}">ExprValue</a> =&gt;
                    <a href="../../../reflect/internal/Types.scala.html#442139" title="(sym: Macros.this.global.Symbol)Macros.this.global.Type">ThisType</a><a href="#3366225" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a><a href="#1033017" title="Macros.this.global.DefDef">macroDdef</a>.<a href="../../../reflect/internal/Trees.scala.html#409939" title="=&gt; Macros.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411315" title="=&gt; Macros.this.global.Symbol">owner</a><span class="delimiter">)</span>
                  <span class="keyword">case</span> SingleType<span class="delimiter">(</span>SingleType<a href="../../../reflect/internal/Types.scala.html#410991" title="Macros.this.global.Type" id="3366219" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#410991" title="Macros.this.global.Type" id="3366222">NoPrefix</a>, <a href="../../../reflect/internal/Types.scala.html#410993" title="Macros.this.global.Symbol" id="1051731">implParam</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/Types.scala.html#410993" title="Macros.this.global.Symbol" id="1051732">value</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#1051732" title="Macros.this.global.Symbol">value</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#408909" title="=&gt; Macros.this.global.Symbol{def name: Macros.this.global.TermName; def rawname: Macros.this.global.TermName; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.NoSymbol &lt;: Macros.this.global.Symbol{def name: Macros.this.global.TermName; def rawname: Macros.this.global.TermName; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.NoSymbol &lt;: Macros.this.global.Symbol; type NameType &lt;: Macros.this.global.TermName}; type NameType &lt;: Macros.this.global.TermName}">ExprValue</a> =&gt;
                    <a href="#1051567" title="scala.collection.immutable.Map[Macros.this.global.Symbol,Macros.this.global.ValDef]">implToDef</a> <a href="../../../collection/MapLike.scala.html#87525" title="(key: Macros.this.global.Symbol)Option[Macros.this.global.ValDef]">get</a> <a href="#1051731" title="Macros.this.global.Symbol">implParam</a> <a href="../../../Option.scala.html#62865" title="(f: Macros.this.global.ValDef =&gt; Macros.this.global.Type)Option[Macros.this.global.Type]">map</a> <span class="delimiter">(</span><a title="Macros.this.global.ValDef" id="1051743">defParam</a> =&gt; <a href="../../../reflect/internal/Types.scala.html#450204" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">SingleType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#407286" title="Macros.this.global.NoPrefix.type">NoPrefix</a>, <a href="#1051743" title="Macros.this.global.ValDef">defParam</a>.<a href="../../../reflect/internal/Trees.scala.html#409939" title="=&gt; Macros.this.global.Symbol">symbol</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#3366225" title="(x: Macros.this.global.Type)Macros.this.global.Type">getOrElse</a> <a href="#1051658" title="Macros.this.global.Type">pre</a>
                  <span class="keyword">case</span> _ =&gt;
                    <a href="#3366225" title="(x: Macros.this.global.Type)Macros.this.global.Type">pre</a>
                <span class="delimiter">}</span>
                <span class="keyword">val</span> <a title="List[Macros.this.global.Type]" id="1051662">args1</a> = <a href="#1051660" title="List[Macros.this.global.Type]">args</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Macros.this.global.Type =&gt; Macros.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Type],Macros.this.global.Type,List[Macros.this.global.Type]])List[Macros.this.global.Type]">map</a> <a href="../../../reflect/internal/Types.scala.html#441772" title="(tp: Macros.this.global.Type)Macros.this.global.Type">mapOver</a>
                <a href="../../../reflect/internal/Types.scala.html#415106" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol, args: List[Macros.this.global.Type])Macros.this.global.Type">TypeRef</a><span class="delimiter">(</span><a href="#1051661" title="Macros.this.global.Type">pre1</a>, <a href="#1051659" title="Macros.this.global.Symbol">sym</a>, <a href="#1051662" title="List[Macros.this.global.Type]">args1</a><span class="delimiter">)</span>
              <span class="keyword">case</span> _ =&gt;
                <a href="../../../reflect/internal/Types.scala.html#441772" title="(tp: Macros.this.global.Type)Macros.this.global.Type">mapOver</a><a href="#3366241" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a><a href="#1051650" title="Macros.this.global.Type">tp</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>

          <a href="#1051648" title="(tp: Macros.this.global.Type)Macros.this.global.Type">UnsigmaTypeMap</a><span class="delimiter">(</span><a href="#1051557" title="Macros.this.global.Type">tpe</a><span class="delimiter">)</span>
        <span class="keyword">case</span> _ =&gt;
          <a href="#3366254" title="(x: Macros.this.global.Type)Macros.this.global.Type">tpe</a>
      <span class="delimiter">}</span>

    <a href="#1051452" title="(tpe: Macros.this.global.Type)Macros.this.global.Type">unsigma</a><span class="delimiter">(</span><a href="#1051451" title="Macros.this.global.Type">runtimeType</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** A reference macro implementation signature compatible with a given macro definition.
   *
   *  In the example above for the following macro def:
   *    def foo[T](xs: List[T]): T = macro fooBar
   *
   *  This function will return:
   *    (c: scala.reflect.macros.Context)(xs: c.Expr[List[T]]): c.Expr[T]
   *
   *  Note that type tag evidence parameters are not included into the result.
   *  Type tag context bounds for macro impl tparams are optional.
   *  Therefore compatibility checks ignore such parameters, and we don't need to bother about them here.
   *
   *  @param macroDef The macro definition symbol
   *  @param tparams  The type parameters of the macro definition
   *  @param vparamss The value parameters of the macro definition
   *  @param retTpe   The return type of the macro definition
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(macroDef: Macros.this.global.Symbol, tparams: List[Macros.this.global.TypeDef], vparamss: List[List[Macros.this.global.ValDef]], retTpe: Macros.this.global.Type)(List[List[Macros.this.global.Symbol]], Macros.this.global.Type)" id="538336">macroImplSig</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1033001">macroDef</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="Macros.this.global.Symbol">Symbol</a>, <a title="List[Macros.this.global.TypeDef]" id="1033002">tparams</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[Macros.this.global.TypeDef]">List</a><span class="delimiter">[</span>TypeDef<span class="delimiter">]</span>, <a title="List[List[Macros.this.global.ValDef]]" id="1033003">vparamss</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[List[Macros.this.global.ValDef]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>ValDef<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Macros.this.global.Type" id="1033004">retTpe</a>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../Tuple2.scala.html#783" title="(List[List[Macros.this.global.Symbol]], Macros.this.global.Type)" class="delimiter">(</a>List<span class="delimiter">[</span>List<span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span>, Type<span class="delimiter">)</span> = <span class="delimiter">{</span>
    // had to move method's body to an object because of the recursive dependencies between sigma and param
    <span class="keyword">object</span> <a title="SigGenerator.type" id="1051851">SigGenerator</a> <a href="#1051852" title="SigGenerator.type" class="delimiter">{</a>
      <span class="keyword">def</span> <a title="(tpe: Macros.this.global.Type)Macros.this.global.Type" id="1051855">sigma</a><span class="delimiter">(</span><a title="Macros.this.global.Type" id="1051928">tpe</a>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a> = <span class="delimiter">{</span>
        <span class="keyword">class</span> <a title="class SigmaTypeMap extends Macros.this.global.TypeMap" id="1051930">SigmaTypeMap</a> <a href="#1051930" title="SigmaTypeMap" class="keyword">extends</a> <a href="../../../reflect/internal/Types.scala.html#407460" title="Macros.this.global.TypeMap">TypeMap</a> <span class="delimiter">{</span>
          <span class="keyword">def</span> <a title="(tp: Macros.this.global.Type)Macros.this.global.Type" id="1051932">apply</a><span class="delimiter">(</span><a title="Macros.this.global.Type" id="1051934">tp</a>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a> = <a href="#1051934" title="Macros.this.global.Type">tp</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> TypeRef<a href="#3366288" title="Macros.this.global.Type" id="3366290" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#410887" title="Macros.this.global.Type" id="1051942">pre</a>, <a href="../../../reflect/internal/Types.scala.html#410889" title="Macros.this.global.Symbol" id="1051943">sym</a>, <a href="../../../reflect/internal/Types.scala.html#410891" title="List[Macros.this.global.Type]" id="1051944">args</a><span class="delimiter">)</span> =&gt;
              <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1051945">pre1</a> = <a href="#1051942" title="Macros.this.global.Type">pre</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> ThisType<a href="#3366270" title="Macros.this.global.Type" id="3366272" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#411018" title="Macros.this.global.Symbol" id="1051947">sym</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#1051947" title="Macros.this.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1033001" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#411315" title="=&gt; Macros.this.global.Symbol">owner</a> =&gt;
                  <a href="../../../reflect/internal/Types.scala.html#450204" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">SingleType</a><a href="#3366279" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#450204" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">SingleType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#450204" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">SingleType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#407286" title="Macros.this.global.NoPrefix.type">NoPrefix</a>, <a href="#1051857" title="=&gt; Macros.this.global.TermSymbol">ctxParam</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/Definitions.scala.html#408942" title="=&gt; Macros.this.global.Symbol{def name: Macros.this.global.TermName; def rawname: Macros.this.global.TermName; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.NoSymbol &lt;: Macros.this.global.Symbol{def name: Macros.this.global.TermName; def rawname: Macros.this.global.TermName; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.NoSymbol &lt;: Macros.this.global.Symbol; type NameType &lt;: Macros.this.global.TermName}; type NameType &lt;: Macros.this.global.TermName}">MacroContextPrefix</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/Definitions.scala.html#408909" title="=&gt; Macros.this.global.Symbol{def name: Macros.this.global.TermName; def rawname: Macros.this.global.TermName; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.NoSymbol &lt;: Macros.this.global.Symbol{def name: Macros.this.global.TermName; def rawname: Macros.this.global.TermName; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.NoSymbol &lt;: Macros.this.global.Symbol; type NameType &lt;: Macros.this.global.TermName}; type NameType &lt;: Macros.this.global.TermName}">ExprValue</a><span class="delimiter">)</span>
                <span class="keyword">case</span> SingleType<a href="#3366270" title="Macros.this.global.Type" id="3366275" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#410991" title="Macros.this.global.Type" id="3366277">NoPrefix</a>, <a href="../../../reflect/internal/Types.scala.html#410993" title="Macros.this.global.Symbol" id="1051954">sym</a><span class="delimiter">)</span> =&gt;
                  <a href="../../../reflect/internal/util/Collections.scala.html#406725" title="(xss: List[List[Macros.this.global.ValDef]])(p: Macros.this.global.ValDef =&gt; Boolean)Option[Macros.this.global.ValDef]">mfind</a><span class="delimiter">(</span><a href="#1033003" title="List[List[Macros.this.global.ValDef]]">vparamss</a><span class="delimiter">)</span><a href="#3366279" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a><a href="#1051967" title="Macros.this.global.ValDef">_</a>.<a href="../../../reflect/internal/Trees.scala.html#409939" title="=&gt; Macros.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1051954" title="Macros.this.global.Symbol">sym</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
                    <span class="keyword">case</span> Some<a href="#3366262" title="Macros.this.global.Type" id="3366263" class="delimiter">(</a><a href="../../../Option.scala.html#63132" title="Macros.this.global.ValDef" id="1051974">macroDefParam</a><span class="delimiter">)</span> =&gt; <a href="../../../reflect/internal/Types.scala.html#450204" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">SingleType</a><a href="#3366265" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#450204" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">SingleType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#407286" title="Macros.this.global.NoPrefix.type">NoPrefix</a>, <a href="#1051862" title="(tree: Macros.this.global.Tree)Macros.this.global.Symbol">param</a><span class="delimiter">(</span><a href="#1051974" title="Macros.this.global.ValDef">macroDefParam</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="../../../reflect/internal/Definitions.scala.html#408909" title="=&gt; Macros.this.global.Symbol{def name: Macros.this.global.TermName; def rawname: Macros.this.global.TermName; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.NoSymbol &lt;: Macros.this.global.Symbol{def name: Macros.this.global.TermName; def rawname: Macros.this.global.TermName; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.NoSymbol &lt;: Macros.this.global.Symbol; type NameType &lt;: Macros.this.global.TermName}; type NameType &lt;: Macros.this.global.TermName}">ExprValue</a><span class="delimiter">)</span>
                    <span class="keyword">case</span> _ =&gt; <a href="#3366265" title="(x: Macros.this.global.Type)Macros.this.global.Type">pre</a>
                  <span class="delimiter">}</span>
                <span class="keyword">case</span> _ =&gt;
                  <a href="#3366279" title="(x: Macros.this.global.Type)Macros.this.global.Type">pre</a>
              <span class="delimiter">}</span>
              <a href="../../../reflect/internal/Types.scala.html#415106" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol, args: List[Macros.this.global.Type])Macros.this.global.Type">TypeRef</a><span class="delimiter">(</span><a href="#1051945" title="Macros.this.global.Type">pre1</a>, <a href="#1051943" title="Macros.this.global.Symbol">sym</a>, <a href="#1051944" title="List[Macros.this.global.Type]">args</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Macros.this.global.Type =&gt; Macros.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Type],Macros.this.global.Type,List[Macros.this.global.Type]])List[Macros.this.global.Type]">map</a> <a href="../../../reflect/internal/Types.scala.html#441772" title="(tp: Macros.this.global.Type)Macros.this.global.Type">mapOver</a><span class="delimiter">)</span>
            <span class="keyword">case</span> _ =&gt;
              <a href="../../../reflect/internal/Types.scala.html#441772" title="(tp: Macros.this.global.Type)Macros.this.global.Type">mapOver</a><a href="#3366292" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a><a href="#1051934" title="Macros.this.global.Type">tp</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <span title="SigmaTypeMap" class="keyword">new</span> <a href="#1051930" title="SigmaTypeMap">SigmaTypeMap</a><span class="delimiter">(</span><span class="delimiter">)</span> <a href="#1051932" title="(tp: Macros.this.global.Type)Macros.this.global.Type">apply</a> <a href="#1051928" title="Macros.this.global.Type">tpe</a>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(name: Macros.this.global.Name, pos: Macros.this.global.Position, tpe: Macros.this.global.Type, flags: Long)Macros.this.global.TermSymbol" id="1051856">makeParam</a><span class="delimiter">(</span><a title="Macros.this.global.Name" id="1051868">name</a>: <a href="../../../reflect/internal/Names.scala.html#406868" title="Macros.this.global.Name">Name</a>, <a title="Macros.this.global.Position" id="1051869">pos</a>: <a href="../../../reflect/internal/util/Position.scala.html#22953" title="Macros.this.global.Position">Position</a>, <a title="Macros.this.global.Type" id="1051870">tpe</a>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a>, <a title="Long" id="1051872">flags</a>: <a href="../../../Long.scala.html#1293" title="Long">Long</a> = <span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span> =
        <a href="#1033001" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#411111" title="(name: Macros.this.global.TermName, pos: Macros.this.global.Position, newFlags: Long)Macros.this.global.TermSymbol">newValueParameter</a><span class="delimiter">(</span><a href="../../../reflect/internal/Names.scala.html#406832" title="implicit scala.reflect.internal.Names.promoteTermNamesAsNecessary : (name: Macros.this.global.Name)Macros.this.global.TermName">name</a>, <a href="#1051869" title="Macros.this.global.Position">pos</a>, <a href="#1051872" title="Long">flags</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Symbols.scala.html#411369" title="(info: Macros.this.global.Type)Macros.this.global.TermSymbol">setInfo</a> <a href="#1051870" title="Macros.this.global.Type">tpe</a>
      <span class="keyword">val</span> <a title="Macros.this.global.TermSymbol" id="1051857">ctxParam</a> = <a href="#1051856" title="(name: Macros.this.global.Name, pos: Macros.this.global.Position, tpe: Macros.this.global.Type, flags: Long)Macros.this.global.TermSymbol">makeParam</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#407871" title="Macros.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414429" title="=&gt; Macros.this.global.nme.NameType">macroContext</a>, <a href="#1033001" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/StdAttachments.scala.html#409602" title="=&gt; Macros.this.global.Position">pos</a>, <a href="../../../reflect/internal/Definitions.scala.html#408940" title="=&gt; Macros.this.global.Symbol">MacroContextClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Macros.this.global.Type">tpe</a>, <span title="Long(2097152L)">SYNTHETIC</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(isType: Boolean, origTpe: Macros.this.global.Type)Macros.this.global.Type" id="1051859">implType</a><span class="delimiter">(</span><a title="Boolean" id="1052046">isType</a>: <a href="../../../Boolean.scala.html#1425" title="Boolean">Boolean</a>, <a title="Macros.this.global.Type" id="1052047">origTpe</a>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a> =
        <span title="Macros.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408815" title="(tp: Macros.this.global.Type)Boolean">isRepeatedParamType</a><span class="delimiter">(</span><a href="#1052047" title="Macros.this.global.Type">origTpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="../../../reflect/internal/Types.scala.html#407408" title="(tycon: Macros.this.global.Type, args: List[Macros.this.global.Type])Macros.this.global.Type">appliedType</a><span class="delimiter">(</span>
            <a href="../../../reflect/internal/Definitions.scala.html#408810" title="=&gt; Macros.this.global.ClassSymbol">RepeatedParamClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411561" title="=&gt; Macros.this.global.Type">typeConstructor</a>,
            <a href="../../../collection/immutable/List.scala.html#62451" title="(xs: Macros.this.global.Type*)List[Macros.this.global.Type]">List</a><span class="delimiter">(</span><a href="#1051859" title="(isType: Boolean, origTpe: Macros.this.global.Type)Macros.this.global.Type">implType</a><span class="delimiter">(</span><a href="#1052046" title="Boolean">isType</a>, <a href="#1051855" title="(tpe: Macros.this.global.Type)Macros.this.global.Type">sigma</a><span class="delimiter">(</span><a href="#1052047" title="Macros.this.global.Type">origTpe</a>.<a href="../../../reflect/internal/Types.scala.html#408421" title="=&gt; List[Macros.this.global.Type]">typeArgs</a>.<a href="../../../collection/IterableLike.scala.html#58577" title="=&gt; Macros.this.global.Type">head</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1052067">tsym</a> = <a href="../../../reflect/internal/Definitions.scala.html#409262" title="(owner: Macros.this.global.Symbol, name: Macros.this.global.Name)Macros.this.global.Symbol">getMember</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408940" title="=&gt; Macros.this.global.Symbol">MacroContextClass</a>, <span title="Macros.this.global.tpnme.NameType" class="keyword">if</span> <span class="delimiter">(</span><a href="#1052046" title="Boolean">isType</a><span class="delimiter">)</span> <a href="../../../reflect/internal/StdNames.scala.html#407863" title="Macros.this.global.tpnme.type">tpnme</a>.<a href="../../../reflect/internal/StdNames.scala.html#413702" title="=&gt; Macros.this.global.tpnme.NameType">WeakTypeTag</a> <span class="keyword">else</span> <a href="../../../reflect/internal/StdNames.scala.html#407863" title="Macros.this.global.tpnme.type">tpnme</a>.<a href="../../../reflect/internal/StdNames.scala.html#413706" title="=&gt; Macros.this.global.tpnme.NameType">Expr</a><span class="delimiter">)</span>
          <a href="../../../reflect/internal/Types.scala.html#407402" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol, args: List[Macros.this.global.Type])Macros.this.global.Type">typeRef</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#407398" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">singleType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#407286" title="Macros.this.global.NoPrefix.type">NoPrefix</a>, <a href="#1051857" title="=&gt; Macros.this.global.TermSymbol">ctxParam</a><span class="delimiter">)</span>, <a href="#1052067" title="Macros.this.global.Symbol">tsym</a>, <a href="../../../collection/immutable/List.scala.html#62451" title="(xs: Macros.this.global.Type*)List[Macros.this.global.Type]">List</a><span class="delimiter">(</span><a href="#1051855" title="(tpe: Macros.this.global.Type)Macros.this.global.Type">sigma</a><span class="delimiter">(</span><a href="#1052047" title="Macros.this.global.Type">origTpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.Map[Macros.this.global.Symbol,Macros.this.global.Symbol]" id="1051860">paramCache</a> = scala.collection.mutable.<a href="../../../collection/generic/GenMapFactory.scala.html#60744" title="[A, B](elems: (A, B)*)scala.collection.mutable.Map[A,B]">Map</a><span title="(elems: (Macros.this.global.Symbol, Macros.this.global.Symbol)*)scala.collection.mutable.Map[Macros.this.global.Symbol,Macros.this.global.Symbol]" class="delimiter">[</span><a href="../../../reflect/internal/Symbols.scala.html#407146" title="Macros.this.global.Symbol">Symbol</a>, <a href="../../../reflect/internal/Symbols.scala.html#407146" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Macros.this.global.Symbol" id="1051862">param</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1051900">tree</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="Macros.this.global.Symbol">Symbol</a> =
        <a href="#1051860" title="=&gt; scala.collection.mutable.Map[Macros.this.global.Symbol,Macros.this.global.Symbol]">paramCache</a>.<a href="../../../collection/mutable/MapLike.scala.html#87629" title="(key: Macros.this.global.Symbol, op: =&gt; Macros.this.global.Symbol)Macros.this.global.Symbol">getOrElseUpdate</a><span class="delimiter">(</span><a href="#1051900" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a>, <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1052077">sym</a> = <a href="#1051900" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a>
          <span class="keyword">val</span> <a title="Macros.this.global.TermSymbol" id="1052078">sigParam</a> = <a href="#1051856" title="(name: Macros.this.global.Name, pos: Macros.this.global.Position, tpe: Macros.this.global.Type, flags: Long)Macros.this.global.TermSymbol">makeParam</a><span class="delimiter">(</span><a href="#1052077" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; sym.NameType">name</a>, <a href="#1052077" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/StdAttachments.scala.html#409602" title="=&gt; Macros.this.global.Position">pos</a>, <a href="#1051859" title="(isType: Boolean, origTpe: Macros.this.global.Type)Macros.this.global.Type">implType</a><span class="delimiter">(</span><a href="#1052077" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/api/Symbols.scala.html#402394" title="=&gt; Boolean">isType</a>, <a href="#1052077" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Macros.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1052077" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/HasFlags.scala.html#409872" title="=&gt; Boolean">isSynthetic</a><span class="delimiter">)</span> <a href="#1052078" title="Macros.this.global.TermSymbol">sigParam</a>.<a href="../../../reflect/internal/Symbols.scala.html#411242" title="(fs: Long)Unit">flags</a> <a href="../../../Long.scala.html#57505" title="(x: Int)Long">|=</a> <span title="Int(2097152)">SYNTHETIC</span>
          <a href="#1052078" title="Macros.this.global.TermSymbol">sigParam</a>
        <span class="delimiter">}</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="List[List[Macros.this.global.Symbol]]" id="1051863">paramss</a> = <a href="../../../collection/immutable/List.scala.html#62451" title="(xs: Macros.this.global.TermSymbol*)List[Macros.this.global.TermSymbol]">List</a><span class="delimiter">(</span><a href="#1051857" title="=&gt; Macros.this.global.TermSymbol">ctxParam</a><span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#62685" title="(x: List[Macros.this.global.Symbol])List[List[Macros.this.global.Symbol]]">::</a> <a href="../../../reflect/internal/util/Collections.scala.html#406717" title="(xss: List[List[Macros.this.global.ValDef]])(f: Macros.this.global.ValDef =&gt; Macros.this.global.Symbol)List[List[Macros.this.global.Symbol]]">mmap</a><span class="delimiter">(</span><a href="#1033003" title="List[List[Macros.this.global.ValDef]]">vparamss</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1051862" title="(tree: Macros.this.global.Tree)Macros.this.global.Symbol">param</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1051865">implRetTpe</a> = <a href="../../../reflect/internal/Types.scala.html#407402" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol, args: List[Macros.this.global.Type])Macros.this.global.Type">typeRef</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#407398" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">singleType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#407286" title="Macros.this.global.NoPrefix.type">NoPrefix</a>, <a href="#1051857" title="=&gt; Macros.this.global.TermSymbol">ctxParam</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/Definitions.scala.html#409262" title="(owner: Macros.this.global.Symbol, name: Macros.this.global.Name)Macros.this.global.Symbol">getMember</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408940" title="=&gt; Macros.this.global.Symbol">MacroContextClass</a>, <a href="../../../reflect/internal/StdNames.scala.html#407863" title="Macros.this.global.tpnme.type">tpnme</a>.<a href="../../../reflect/internal/StdNames.scala.html#413706" title="=&gt; Macros.this.global.tpnme.NameType">Expr</a><span class="delimiter">)</span>, <a href="../../../collection/immutable/List.scala.html#62451" title="(xs: Macros.this.global.Type*)List[Macros.this.global.Type]">List</a><span class="delimiter">(</span><a href="#1051855" title="(tpe: Macros.this.global.Type)Macros.this.global.Type">sigma</a><span class="delimiter">(</span><a href="#1033004" title="Macros.this.global.Type">retTpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">import</span> <a href="#1051851" title="SigGenerator.type">SigGenerator</a>._
    <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: Macros.this.global.Symbol)Macros.this.global.Symbol">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;generating macroImplSigs for: &quot;)" class="string">&quot;generating macroImplSigs for: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1033001" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span>
    <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: List[Macros.this.global.TypeDef])List[Macros.this.global.TypeDef]">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;tparams are: &quot;)" class="string">&quot;tparams are: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1033002" title="List[Macros.this.global.TypeDef]">tparams</a><span class="delimiter">)</span>
    <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: List[List[Macros.this.global.ValDef]])List[List[Macros.this.global.ValDef]]">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;vparamss are: &quot;)" class="string">&quot;vparamss are: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1033003" title="List[List[Macros.this.global.ValDef]]">vparamss</a><span class="delimiter">)</span>
    <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: Macros.this.global.Type)Macros.this.global.Type">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;retTpe is: &quot;)" class="string">&quot;retTpe is: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1033004" title="Macros.this.global.Type">retTpe</a><span class="delimiter">)</span>
    <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: (List[List[Macros.this.global.Symbol]], Macros.this.global.Type))(List[List[Macros.this.global.Symbol]], Macros.this.global.Type)">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;macroImplSig is: &quot;)" class="string">&quot;macroImplSig is: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../Tuple2.scala.html#62849" title="(_1: List[List[Macros.this.global.Symbol]], _2: Macros.this.global.Type)(List[List[Macros.this.global.Symbol]], Macros.this.global.Type)" class="delimiter">(</a><a href="#1051863" title="=&gt; List[List[Macros.this.global.Symbol]]">paramss</a>, <a href="#1051865" title="=&gt; Macros.this.global.Type">implRetTpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** Verifies that the body of a macro def typechecks to a reference to a static public non-overloaded method,
   *  and that that method is signature-wise compatible with the given macro definition.
   *
   *  @return Typechecked rhs of the given macro definition if everything is okay.
   *          EmptyTree if an error occurs.
   */
  <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, macroDdef: Macros.this.global.DefDef)Macros.this.global.Tree" id="538337">typedMacroBody</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1052125">typer</a>: <a href="Typers.scala.html#538117" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.DefDef" id="1052126">macroDdef</a>: <a href="../../../reflect/internal/Trees.scala.html#407963" title="Macros.this.global.DefDef">DefDef</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a> =
    <a href="#3366306" title="Macros.this.global.Tree" id="3366301" class="keyword">try</a> <span title="Macros.this.MacroTyper" class="keyword">new</span> <a href="#538338" title="Macros.this.MacroTyper">MacroTyper</a><span class="delimiter">(</span><a href="#1052125" title="Macros.this.Typer">typer</a>, <a href="#1052126" title="Macros.this.global.DefDef">macroDdef</a><span class="delimiter">)</span>.<a href="#1032799" title="=&gt; Macros.this.global.Tree">typed</a>
    <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a href="ContextErrors.scala.html#538506" title="Macros.this.global.Tree" id="3366303">MacroBodyTypecheckException</a> =&gt; <a href="#3366306" title="(x: Macros.this.global.Tree)Macros.this.global.Tree">EmptyTree</a> <span class="delimiter">}</span>

  <span class="keyword">class</span> <a title="class MacroTyper extends Object with Macros.this.MacroErrors" id="538338">MacroTyper</a><a href="#538338" title="Macros.this.MacroTyper" class="delimiter">(</a><span class="keyword">val</span> <a title="Macros.this.Typer" id="1052128">typer</a>: <a href="Typers.scala.html#538117" title="Macros.this.Typer">Typer</a>, <span class="keyword">val</span> <a title="Macros.this.global.DefDef" id="1052129">macroDdef</a>: <a href="../../../reflect/internal/Trees.scala.html#407963" title="Macros.this.global.DefDef">DefDef</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="ContextErrors.scala.html#538508" title="Macros.this.MacroErrors">MacroErrors</a> <span class="delimiter">{</span>
    // Phase I: sanity checks
    <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1032796">macroDef</a> = <a href="#1052129" title="=&gt; Macros.this.global.DefDef">macroDdef</a>.<a href="../../../reflect/internal/Trees.scala.html#409939" title="=&gt; Macros.this.global.Symbol">symbol</a>
    <a href="../../../reflect/macros/util/Traces.scala.html#537425" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;typechecking macro def %s at %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#59882" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1032796" title="=&gt; Macros.this.global.Symbol">macroDef</a>, <a href="#1052129" title="=&gt; Macros.this.global.DefDef">macroDdef</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; Macros.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="../Global.scala.html#537497" title="(assertion: Boolean, message: =&gt; Any)Unit">assert</a><span class="delimiter">(</span><a href="#1032796" title="=&gt; Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#411213" title="=&gt; Boolean">isTermMacro</a>, <a href="#1052129" title="=&gt; Macros.this.global.DefDef">macroDdef</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../reflect/FastTrack.scala.html#538320" title="=&gt; Map[Macros.this.global.Symbol,Macros.this.FastTrackEntry]">fastTrack</a> <a href="../../../collection/MapLike.scala.html#87536" title="(key: Macros.this.global.Symbol)Boolean">contains</a> <a href="#1032796" title="=&gt; Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span> <a href="ContextErrors.scala.html#1032770" title="()Nothing">MacroDefIsFastTrack</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1052128" title="=&gt; Macros.this.Typer">typer</a>.<a href="Typers.scala.html#1052204" title="() =&gt; String" id="1052215">checkFeature</a><span class="delimiter">(</span><a href="#1052129" title="=&gt; Macros.this.global.DefDef">macroDdef</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="Macros.this.global.Position" id="1052212">pos</a>, <a href="../../../reflect/internal/Definitions.scala.html#409235" title="Macros.this.global.Symbol" id="1052213">MacrosFeature</a>, immediate = <a title="Boolean" id="1052214" class="keyword">true</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="ContextErrors.scala.html#1032771" title="()Nothing">MacroFeatureNotEnabled</a><span class="delimiter">(</span><span class="delimiter">)</span>

    // we use typed1 instead of typed, because otherwise adapt is going to mess us up
    // if adapt sees &lt;qualifier&gt;.&lt;method&gt;, it will want to perform eta-expansion and will fail
    // unfortunately, this means that we have to manually trigger macro expansion
    // because it's adapt which is responsible for automatic expansion during typechecking
    <span class="keyword">def</span> <a title="(rhs: Macros.this.global.Tree)Macros.this.global.Tree" id="1032798">typecheckRhs</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1033020">rhs</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        // interestingly enough, just checking isErroneous doesn't cut it
        // e.g. a &quot;type arguments [U] do not conform to method foo's type parameter bounds&quot; error
        // doesn't manifest itself as an error in the resulting tree
        <span class="keyword">val</span> <a title="Int" id="1052217">prevNumErrors</a> = <a href="../Global.scala.html#537436" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../reporters/Reporter.scala.html#539660" title="=&gt; scala.tools.nsc.reporters.Reporter#Severity">ERROR</a>.<a href="../reporters/Reporter.scala.html#539709" title="=&gt; Int">count</a>
        <span class="keyword">var</span> <a title="Macros.this.global.Tree" id="1052218">rhs1</a> = <a href="#1052128" title="=&gt; Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538697" title="(tree: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree">typed1</a><span class="delimiter">(</span><a href="#1033020" title="Macros.this.global.Tree">rhs</a>, <span title="Int(1)">EXPRmode</span>, <a href="../../../reflect/internal/Types.scala.html#407279" title="Macros.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>
        <span class="keyword">def</span> <a title="=&gt; Boolean" id="1052219">rhsNeedsMacroExpansion</a> = <a href="#1052218" title="Macros.this.global.Tree">rhs1</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1052218" title="Macros.this.global.Tree">rhs1</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411213" title="=&gt; Boolean">isTermMacro</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1052218" title="Macros.this.global.Tree">rhs1</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411249" title="=&gt; Boolean">isErroneous</a>
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#1052219" title="=&gt; Boolean">rhsNeedsMacroExpansion</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#1052218" title="Macros.this.global.Tree">rhs1</a> = <a href="#538372" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.MacroExpansionResult">macroExpand1</a><a href="#3366318" title="(x: Macros.this.global.Tree)Macros.this.global.Tree" class="delimiter">(</a><a href="#1052128" title="=&gt; Macros.this.Typer">typer</a>, <a href="#1052218" title="Macros.this.global.Tree">rhs1</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> Success<a href="#3366313" title="Macros.this.global.Tree" id="3366314" class="delimiter">(</a><a href="#1056627" title="Macros.this.global.Tree" id="1052264">expanded</a><span class="delimiter">)</span> =&gt;
              <a href="#3366318" title="(x: Macros.this.global.Tree)Macros.this.global.Tree" class="keyword">try</a> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="Macros.this.global.Tree" id="1052265">typechecked</a> = <a href="#1052128" title="=&gt; Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538697" title="(tree: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree">typed1</a><span class="delimiter">(</span><a href="#1052264" title="Macros.this.global.Tree">expanded</a>, <span title="Int(1)">EXPRmode</span>, <a href="../../../reflect/internal/Types.scala.html#407279" title="Macros.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>
                <a href="../../../reflect/macros/util/Traces.scala.html#537425" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;typechecked1:%n%s%n%s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#59882" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1052265" title="Macros.this.global.Tree">typechecked</a>, <a href="../../../reflect/api/Printers.scala.html#56608" title="(any: Any, printTypes: Macros.this.global.BooleanFlag, printIds: Macros.this.global.BooleanFlag, printKinds: Macros.this.global.BooleanFlag, printMirrors: Macros.this.global.BooleanFlag)String">showRaw</a><span class="delimiter">(</span><a href="#1052265" title="Macros.this.global.Tree">typechecked</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="#1052265" title="Macros.this.global.Tree">typechecked</a>
              <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
                <a href="#538355" title="()Unit">popMacroContext</a><span class="delimiter">(</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> Fallback<a href="#3366313" title="Macros.this.global.Tree" id="3366315" class="delimiter">(</a><a href="#1056771" title="Macros.this.global.Tree" id="1052307">fallback</a><span class="delimiter">)</span> =&gt;
              <a href="#1052128" title="=&gt; Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538697" title="(tree: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree">typed1</a><a href="#3366318" title="(x: Macros.this.global.Tree)Macros.this.global.Tree" class="delimiter">(</a><a href="#1052307" title="Macros.this.global.Tree">fallback</a>, <span title="Int(1)">EXPRmode</span>, <a href="../../../reflect/internal/Types.scala.html#407279" title="Macros.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>
            <span class="keyword">case</span> Other<a href="#3366313" title="Macros.this.global.Tree" id="3366316" class="delimiter">(</a><a href="#1054289" title="Macros.this.global.Tree" id="1052332">result</a><span class="delimiter">)</span> =&gt;
              <a href="#3366318" title="(x: Macros.this.global.Tree)Macros.this.global.Tree">result</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="Boolean" id="1052220">typecheckedWithErrors</a> = <span class="delimiter">(</span><a href="#1052218" title="Macros.this.global.Tree">rhs1</a> <a href="../../../reflect/internal/Trees.scala.html#408545" title="(p: Macros.this.global.Tree =&gt; Boolean)Boolean">exists</a> <span class="delimiter">(</span><a href="#1052338" title="Macros.this.global.Tree">_</a>.<a href="../../../reflect/internal/Trees.scala.html#408559" title="=&gt; Boolean">isErroneous</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="../Global.scala.html#537436" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../reporters/Reporter.scala.html#539660" title="=&gt; scala.tools.nsc.reporters.Reporter#Severity">ERROR</a>.<a href="../reporters/Reporter.scala.html#539709" title="=&gt; Int">count</a> <a href="../../../Int.scala.html#57104" title="(x: Int)Boolean">!=</a> <a href="#1052217" title="Int">prevNumErrors</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1052220" title="Boolean">typecheckedWithErrors</a><span class="delimiter">)</span> <a href="ContextErrors.scala.html#1032772" title="()Nothing">MacroDefUntypeableBodyError</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#1052218" title="Macros.this.global.Tree">rhs1</a>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Nothing" id="1052344">ex</a>: <a href="../../../reflect/internal/Types.scala.html#407625" title="Macros.this.global.TypeError">TypeError</a> =&gt;
          <a href="#1052128" title="=&gt; Macros.this.Typer">typer</a>.<a href="TypeDiagnostics.scala.html#538543" title="(context0: Macros.this.Context, pos: Macros.this.global.Position, ex: Macros.this.global.TypeError)Unit">reportTypeError</a><span class="delimiter">(</span><a href="ContextErrors.scala.html#1032760" title="=&gt; Macros.this.Context">context</a>, <a href="#1033020" title="Macros.this.global.Tree">rhs</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; Macros.this.global.Position">pos</a>, <a href="#1052344" title="Macros.this.global.TypeError">ex</a><span class="delimiter">)</span>
          <a href="ContextErrors.scala.html#1032772" title="()Nothing">MacroDefUntypeableBodyError</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    // Phase II: typecheck the right-hand side of the macro def
    <span class="keyword">val</span> <a title="Macros.this.global.Tree" id="1032799">typed</a> = <a href="#1032798" title="(rhs: Macros.this.global.Tree)Macros.this.global.Tree">typecheckRhs</a><span class="delimiter">(</span><a href="#1052129" title="=&gt; Macros.this.global.DefDef">macroDdef</a>.<a href="../../../reflect/internal/Trees.scala.html#410288" title="=&gt; Macros.this.global.Tree">rhs</a><span class="delimiter">)</span>
    <a href="#1032799" title="=&gt; Macros.this.global.Tree">typed</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="../../../reflect/internal/TreeInfo.scala.html#480613" title="Option[(Macros.this.global.treeInfo.global.Symbol, Macros.this.global.treeInfo.global.Symbol, List[Macros.this.global.treeInfo.global.Tree])]" id="3366331">MacroImplReference</a><span class="delimiter">(</span><a href="../../../Tuple3.scala.html#60576" title="Macros.this.global.treeInfo.global.Symbol" id="1052354">owner</a>, <a href="../../../Tuple3.scala.html#60578" title="Macros.this.global.treeInfo.global.Symbol" id="1052355">meth</a>, <a href="../../../Tuple3.scala.html#60580" title="List[Macros.this.global.treeInfo.global.Tree]" id="1052356">targs</a><span class="delimiter">)</span> =&gt;
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1052355" title="Macros.this.global.treeInfo.global.Symbol">meth</a>.<a href="../../../reflect/api/Symbols.scala.html#402398" title="=&gt; Boolean">isMethod</a><span class="delimiter">)</span> <a href="ContextErrors.scala.html#1032773" title="()Nothing">MacroDefInvalidBodyError</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1052355" title="Macros.this.global.treeInfo.global.Symbol">meth</a>.<a href="../../../reflect/internal/HasFlags.scala.html#409868" title="=&gt; Boolean">isPublic</a><span class="delimiter">)</span> <a href="ContextErrors.scala.html#1032774" title="()Nothing">MacroImplNotPublicError</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1052355" title="Macros.this.global.treeInfo.global.Symbol">meth</a>.<a href="../../../reflect/internal/Symbols.scala.html#411206" title="=&gt; Boolean">isOverloaded</a><span class="delimiter">)</span> <a href="ContextErrors.scala.html#1032775" title="()Nothing">MacroImplOverloadedError</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1052354" title="Macros.this.global.treeInfo.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#411296" title="=&gt; Boolean">isStaticOwner</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1052354" title="Macros.this.global.treeInfo.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#411459" title="=&gt; Macros.this.global.treeInfo.global.Symbol">moduleClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411296" title="=&gt; Boolean">isStaticOwner</a><span class="delimiter">)</span> <a href="ContextErrors.scala.html#1032777" title="()Nothing">MacroImplNotStaticError</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1052355" title="Macros.this.global.treeInfo.global.Symbol">meth</a>.<a href="../../../reflect/internal/Symbols.scala.html#411389" title="=&gt; List[Macros.this.global.treeInfo.global.Symbol]">typeParams</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57104" title="(x: Int)Boolean">!=</a> <a href="#1052356" title="List[Macros.this.global.treeInfo.global.Tree]">targs</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a><span class="delimiter">)</span> <a href="ContextErrors.scala.html#1032776" title="(macroImplRef: Macros.this.global.Tree)Nothing">MacroImplWrongNumberOfTypeArgumentsError</a><span class="delimiter">(</span><a href="#1032799" title="=&gt; Macros.this.global.Tree">typed</a><span class="delimiter">)</span>
        <a href="#538332" title="(macroDef: Macros.this.global.Symbol, macroImplRef: Macros.this.global.Tree)Unit">bindMacroImpl</a><span class="delimiter">(</span><a href="#1032796" title="=&gt; Macros.this.global.Symbol">macroDef</a>, <a href="#1032799" title="=&gt; Macros.this.global.Tree">typed</a><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt;
        <a href="ContextErrors.scala.html#1032773" title="()Nothing">MacroDefInvalidBodyError</a><a href="#3366327" title="(x: Unit)Unit" class="delimiter">(</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    // Phase III: check compatibility between the macro def and its macro impl
    // this check ignores type tag evidence parameters, because type tag context bounds are optional
    // aXXX (e.g. aparamss) =&gt; characteristics of the macro impl (&quot;a&quot; stands for &quot;actual&quot;)
    // rXXX (e.g. rparamss) =&gt; characteristics of a reference macro impl signature synthesized from the macro def (&quot;r&quot; stands for &quot;reference&quot;)
    <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1032801">macroImpl</a> = <a href="#1032799" title="=&gt; Macros.this.global.Tree">typed</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a>
    <span class="keyword">val</span> <a title="List[List[Macros.this.global.Symbol]]" id="1032803">aparamss</a> = <a href="#538334" title="(paramss: List[List[Macros.this.global.Symbol]], transform: (Macros.this.global.Symbol, Macros.this.global.Symbol) =&gt; Macros.this.global.Symbol)List[List[Macros.this.global.Symbol]]">transformTypeTagEvidenceParams</a><span class="delimiter">(</span><a href="#1032801" title="=&gt; Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#411390" title="=&gt; List[List[Macros.this.global.Symbol]]">paramss</a>, <span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1033041">param</a>, <a title="Macros.this.global.Symbol" id="1033042">tparam</a><span class="delimiter">)</span> =&gt; <a href="../../../reflect/internal/Symbols.scala.html#407184" title="=&gt; Macros.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1032805">aret</a> = <a href="#1032801" title="=&gt; Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Macros.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#408427" title="=&gt; Macros.this.global.Type">finalResultType</a>
    <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1032807">macroDefRet</a> =
      <span title="Macros.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1052129" title="=&gt; Macros.this.global.DefDef">macroDdef</a>.<a href="../../../reflect/internal/Trees.scala.html#410286" title="=&gt; Macros.this.global.Tree">tpt</a>.<a href="../../../reflect/internal/Trees.scala.html#408582" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="#1052128" title="=&gt; Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538711" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">typedType</a><span class="delimiter">(</span><a href="#1052129" title="=&gt; Macros.this.global.DefDef">macroDdef</a>.<a href="../../../reflect/internal/Trees.scala.html#410286" title="=&gt; Macros.this.global.Tree">tpt</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; Macros.this.global.Type">tpe</a>
      <span class="keyword">else</span> <a href="#538335" title="(macroDdef: Macros.this.global.DefDef, macroImpl: Macros.this.global.Symbol)Macros.this.global.Type">computeMacroDefTypeFromMacroImpl</a><span class="delimiter">(</span><a href="#1052129" title="=&gt; Macros.this.global.DefDef">macroDdef</a>, <a href="#1032801" title="=&gt; Macros.this.global.Symbol">macroImpl</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a href="#3366338" title="(x: (List[List[Macros.this.global.Symbol]], Macros.this.global.Type))(List[List[Macros.this.global.Symbol]], Macros.this.global.Type)" class="delimiter">(</a><a href="../../../Tuple2.scala.html#60635" title="List[List[Macros.this.global.Symbol]]" id="1032810">rparamss</a>, <a href="../../../Tuple2.scala.html#60637" title="Macros.this.global.Type" id="1032812">rret</a><span class="delimiter">)</span> = <a href="#538336" title="(macroDef: Macros.this.global.Symbol, tparams: List[Macros.this.global.TypeDef], vparamss: List[List[Macros.this.global.ValDef]], retTpe: Macros.this.global.Type)(List[List[Macros.this.global.Symbol]], Macros.this.global.Type)">macroImplSig</a><a href="../../../Tuple2.scala.html#783" title="(List[List[Macros.this.global.Symbol]], Macros.this.global.Type) @unchecked" class="delimiter">(</a><a href="#1032796" title="=&gt; Macros.this.global.Symbol">macroDef</a>, <a href="#1052129" title="=&gt; Macros.this.global.DefDef">macroDdef</a>.<a href="../../../reflect/internal/Trees.scala.html#410282" title="=&gt; List[Macros.this.global.TypeDef]">tparams</a>, <a href="#1052129" title="=&gt; Macros.this.global.DefDef">macroDdef</a>.<a href="../../../reflect/internal/Trees.scala.html#410284" title="=&gt; List[List[Macros.this.global.ValDef]]">vparamss</a>, <a href="#1032807" title="=&gt; Macros.this.global.Type">macroDefRet</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="List[Macros.this.global.Symbol]" id="1032814">implicitParams</a> = <a href="#1032803" title="=&gt; List[List[Macros.this.global.Symbol]]">aparamss</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#58488" title="(implicit asTraversable: List[Macros.this.global.Symbol] =&gt; scala.collection.GenTraversableOnce[Macros.this.global.Symbol])List[Macros.this.global.Symbol]">flatten</a> <a href="../../../collection/TraversableLike.scala.html#58073" title="(p: Macros.this.global.Symbol =&gt; Boolean)List[Macros.this.global.Symbol]">filter</a> <span class="delimiter">(</span><a href="#1052144" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/HasFlags.scala.html#409853" title="=&gt; Boolean">isImplicit</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1032814" title="=&gt; List[Macros.this.global.Symbol]">implicitParams</a>.<a href="../../../collection/TraversableOnce.scala.html#58191" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <a href="ContextErrors.scala.html#1032778" title="(params: List[Macros.this.global.Symbol])Nothing">MacroImplNonTagImplicitParameters</a><span class="delimiter">(</span><a href="#1032814" title="=&gt; List[Macros.this.global.Symbol]">implicitParams</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1032803" title="=&gt; List[List[Macros.this.global.Symbol]]">aparamss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57104" title="(x: Int)Boolean">!=</a> <a href="#1032810" title="=&gt; List[List[Macros.this.global.Symbol]]">rparamss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a><span class="delimiter">)</span> <a href="ContextErrors.scala.html#1032779" title="()Nothing">MacroImplParamssMismatchError</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="List[Macros.this.global.Symbol]" id="1032816">atparams</a> = <a href="#1032801" title="=&gt; Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#411389" title="=&gt; List[Macros.this.global.Symbol]">typeParams</a>
    <span class="keyword">val</span> <a title="List[Macros.this.global.TypeVar]" id="1032818">atvars</a> = <a href="#1032816" title="=&gt; List[Macros.this.global.Symbol]">atparams</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Macros.this.global.Symbol =&gt; Macros.this.global.TypeVar)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Macros.this.global.TypeVar,List[Macros.this.global.TypeVar]])List[Macros.this.global.TypeVar]">map</a> <a href="Infer.scala.html#538153" title="(tparam: Macros.this.global.Symbol)Macros.this.global.TypeVar">freshVar</a>
    <span class="keyword">def</span> <a title="(atpe: Macros.this.global.Type)Macros.this.global.Type" id="1032820">atpeToRtpe</a><span class="delimiter">(</span><a title="Macros.this.global.Type" id="1052370">atpe</a>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span> = <a href="#1052370" title="Macros.this.global.Type">atpe</a>.<a href="../../../reflect/internal/Types.scala.html#408465" title="(from: List[Macros.this.global.Symbol], to: List[Macros.this.global.Symbol])Macros.this.global.Type">substSym</a><span class="delimiter">(</span><a href="#1032803" title="=&gt; List[List[Macros.this.global.Symbol]]">aparamss</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#58488" title="(implicit asTraversable: List[Macros.this.global.Symbol] =&gt; scala.collection.GenTraversableOnce[Macros.this.global.Symbol])List[Macros.this.global.Symbol]">flatten</a>, <a href="#1032810" title="=&gt; List[List[Macros.this.global.Symbol]]">rparamss</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#58488" title="(implicit asTraversable: List[Macros.this.global.Symbol] =&gt; scala.collection.GenTraversableOnce[Macros.this.global.Symbol])List[Macros.this.global.Symbol]">flatten</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Types.scala.html#408435" title="(formals: List[Macros.this.global.Symbol], actuals: List[Macros.this.global.Type])Macros.this.global.Type">instantiateTypeParams</a><span class="delimiter">(</span><a href="#1032816" title="=&gt; List[Macros.this.global.Symbol]">atparams</a>, <a href="#1032818" title="=&gt; List[Macros.this.global.TypeVar]">atvars</a><span class="delimiter">)</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="../../../reflect/internal/util/Collections.scala.html#406731" title="(xs1: List[List[Macros.this.global.Symbol]], xs2: List[List[Macros.this.global.Symbol]])(f: (List[Macros.this.global.Symbol], List[Macros.this.global.Symbol]) =&gt; Unit)List[Unit]">map2</a><span class="delimiter">(</span><a href="#1032803" title="=&gt; List[List[Macros.this.global.Symbol]]">aparamss</a>, <a href="#1032810" title="=&gt; List[List[Macros.this.global.Symbol]]">rparamss</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="List[Macros.this.global.Symbol]" id="1052411">aparams</a>, <a title="List[Macros.this.global.Symbol]" id="1052412">rparams</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1052411" title="List[Macros.this.global.Symbol]">aparams</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57111" title="(x: Int)Boolean">&lt;</a> <a href="#1052412" title="List[Macros.this.global.Symbol]">rparams</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a><span class="delimiter">)</span> <a href="ContextErrors.scala.html#1032781" title="(aparams: List[Macros.this.global.Symbol], rparams: List[Macros.this.global.Symbol])Nothing">MacroImplMissingParamsError</a><span class="delimiter">(</span><a href="#1052411" title="List[Macros.this.global.Symbol]">aparams</a>, <a href="#1052412" title="List[Macros.this.global.Symbol]">rparams</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1052412" title="List[Macros.this.global.Symbol]">rparams</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57111" title="(x: Int)Boolean">&lt;</a> <a href="#1052411" title="List[Macros.this.global.Symbol]">aparams</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a><span class="delimiter">)</span> <a href="ContextErrors.scala.html#1032780" title="(aparams: List[Macros.this.global.Symbol], rparams: List[Macros.this.global.Symbol])Nothing">MacroImplExtraParamsError</a><span class="delimiter">(</span><a href="#1052411" title="List[Macros.this.global.Symbol]">aparams</a>, <a href="#1052412" title="List[Macros.this.global.Symbol]">rparams</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      // cannot fuse these loops because if aparamss.flatten != rparamss.flatten
      // then `atpeToRtpe` is going to fail with an unsound substitution
      <a href="../../../reflect/internal/util/Collections.scala.html#406731" title="(xs1: List[Macros.this.global.Symbol], xs2: List[Macros.this.global.Symbol])(f: (Macros.this.global.Symbol, Macros.this.global.Symbol) =&gt; Unit)List[Unit]">map2</a><span class="delimiter">(</span><a href="#1032803" title="=&gt; List[List[Macros.this.global.Symbol]]">aparamss</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#58488" title="(implicit asTraversable: List[Macros.this.global.Symbol] =&gt; scala.collection.GenTraversableOnce[Macros.this.global.Symbol])List[Macros.this.global.Symbol]">flatten</a>, <a href="#1032810" title="=&gt; List[List[Macros.this.global.Symbol]]">rparamss</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#58488" title="(implicit asTraversable: List[Macros.this.global.Symbol] =&gt; scala.collection.GenTraversableOnce[Macros.this.global.Symbol])List[Macros.this.global.Symbol]">flatten</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1052459">aparam</a>, <a title="Macros.this.global.Symbol" id="1052460">rparam</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1052459" title="Macros.this.global.Symbol">aparam</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; aparam.NameType">name</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#1052460" title="Macros.this.global.Symbol">rparam</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; rparam.NameType">name</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1052460" title="Macros.this.global.Symbol">rparam</a>.<a href="../../../reflect/internal/HasFlags.scala.html#409872" title="=&gt; Boolean">isSynthetic</a><span class="delimiter">)</span> <a href="ContextErrors.scala.html#1032784" title="(aparam: Macros.this.global.Symbol, rparam: Macros.this.global.Symbol)Nothing">MacroImplParamNameMismatchError</a><span class="delimiter">(</span><a href="#1052459" title="Macros.this.global.Symbol">aparam</a>, <a href="#1052460" title="Macros.this.global.Symbol">rparam</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408816" title="(param: Macros.this.global.Symbol)Boolean">isRepeated</a><span class="delimiter">(</span><a href="#1052459" title="Macros.this.global.Symbol">aparam</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#57829" title="(x: Boolean)Boolean">^</a> <a href="../../../reflect/internal/Definitions.scala.html#408816" title="(param: Macros.this.global.Symbol)Boolean">isRepeated</a><span class="delimiter">(</span><a href="#1052460" title="Macros.this.global.Symbol">rparam</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="ContextErrors.scala.html#1032785" title="(aparam: Macros.this.global.Symbol, rparam: Macros.this.global.Symbol)Unit">MacroImplVarargMismatchError</a><span class="delimiter">(</span><a href="#1052459" title="Macros.this.global.Symbol">aparam</a>, <a href="#1052460" title="Macros.this.global.Symbol">rparam</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1052461">aparamtpe</a> = <a href="#1052459" title="Macros.this.global.Symbol">aparam</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Macros.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#408439" title="=&gt; Macros.this.global.Type">dealias</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> RefinedType<a href="#3366342" title="Macros.this.global.Type" id="3366346" class="delimiter">(</a><a href="../../../collection/generic/SeqFactory.scala.html#59986" title="Option[List[Macros.this.global.Type]]" id="3366358">List</a><a href="../../../reflect/internal/Types.scala.html#410866" title="List[Macros.this.global.Type]" id="3366343" class="delimiter">(</a><a title="Macros.this.global.Type" id="1052482">tpe</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/Scopes.scala.html#446007" title="Option[Seq[Macros.this.global.Symbol]]" id="3366357">Scope</a><a href="../../../reflect/internal/Types.scala.html#410868" title="Macros.this.global.Scope" id="3366344" class="delimiter">(</a><a title="Macros.this.global.Symbol" id="1052486">sym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#1052482" title="Macros.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#408940" title="=&gt; Macros.this.global.Symbol">MacroContextClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Macros.this.global.Type">tpe</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1052486" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411464" title="=&gt; List[Macros.this.global.Symbol]">allOverriddenSymbols</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86380" title="(elem: Any)Boolean">contains</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408943" title="=&gt; Macros.this.global.Symbol{def name: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def rawname: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; type TypeOfClonedSymbol &gt;: Null &lt;: Macros.this.global.Symbol{type NameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; type NameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}}">MacroContextPrefixType</a><span class="delimiter">)</span> =&gt; <a href="#3366353" title="(x: Macros.this.global.Type)Macros.this.global.Type">tpe</a>
          <span class="keyword">case</span> tpe =&gt; <a href="#3366353" title="(x: Macros.this.global.Type)Macros.this.global.Type">tpe</a>
        <span class="delimiter">}</span>
        <a href="ContextErrors.scala.html#1032782" title="(atpe: Macros.this.global.Type, rparam: Macros.this.global.Symbol)Unit">checkMacroImplParamTypeMismatch</a><span class="delimiter">(</span><a href="#1032820" title="(atpe: Macros.this.global.Type)Macros.this.global.Type">atpeToRtpe</a><span class="delimiter">(</span><a href="#1052461" title="Macros.this.global.Type">aparamtpe</a><span class="delimiter">)</span>, <a href="#1052460" title="Macros.this.global.Symbol">rparam</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <a href="ContextErrors.scala.html#1032783" title="(atpe: Macros.this.global.Type, rret: Macros.this.global.Type)Unit">checkMacroImplResultTypeMismatch</a><span class="delimiter">(</span><a href="#1032820" title="(atpe: Macros.this.global.Type)Macros.this.global.Type">atpeToRtpe</a><span class="delimiter">(</span><a href="#1032805" title="=&gt; Macros.this.global.Type">aret</a><span class="delimiter">)</span>, <a href="#1032812" title="=&gt; Macros.this.global.Type">rret</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Int" id="1052388">maxLubDepth</a> = <a href="../../../reflect/internal/Types.scala.html#407515" title="(ts: List[Macros.this.global.Type])Int">lubDepth</a><a href="../../../LowPriorityImplicits.scala.html#7395" title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="delimiter">(</a><a href="#1032803" title="=&gt; List[List[Macros.this.global.Symbol]]">aparamss</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#58488" title="(implicit asTraversable: List[Macros.this.global.Symbol] =&gt; scala.collection.GenTraversableOnce[Macros.this.global.Symbol])List[Macros.this.global.Symbol]">flatten</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Macros.this.global.Symbol =&gt; Macros.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Macros.this.global.Type,List[Macros.this.global.Type]])List[Macros.this.global.Type]">map</a> <span class="delimiter">(</span><a href="#1052560" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Macros.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../runtime/RichInt.scala.html#57065" title="(that: Int)Int">max</a> <a href="../../../reflect/internal/Types.scala.html#407515" title="(ts: List[Macros.this.global.Type])Int">lubDepth</a><span class="delimiter">(</span><a href="#1032810" title="=&gt; List[List[Macros.this.global.Symbol]]">rparamss</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#58488" title="(implicit asTraversable: List[Macros.this.global.Symbol] =&gt; scala.collection.GenTraversableOnce[Macros.this.global.Symbol])List[Macros.this.global.Symbol]">flatten</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Macros.this.global.Symbol =&gt; Macros.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Macros.this.global.Type,List[Macros.this.global.Type]])List[Macros.this.global.Type]">map</a> <span class="delimiter">(</span><a href="#1052636" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Macros.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="List[Macros.this.global.Type]" id="1052389">atargs</a> = <a href="Infer.scala.html#538162" title="(tvars: List[Macros.this.global.TypeVar], tparams: List[Macros.this.global.Symbol], variances: List[Int], upper: Boolean, depth: Int)List[Macros.this.global.Type]">solvedTypes</a><span class="delimiter">(</span><a href="#1032818" title="=&gt; List[Macros.this.global.TypeVar]">atvars</a>, <a href="#1032816" title="=&gt; List[Macros.this.global.Symbol]">atparams</a>, <a href="#1032816" title="=&gt; List[Macros.this.global.Symbol]">atparams</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Macros.this.global.Symbol =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Int,List[Int]])List[Int]">map</a> <a href="Variances.scala.html#538223" title="(tp: Macros.this.global.Type)(tparam: Macros.this.global.Symbol)Int">varianceInType</a><a href="#1052688" title="Macros.this.global.Symbol" class="delimiter">(</a><a href="#1032805" title="=&gt; Macros.this.global.Type">aret</a><span class="delimiter">)</span>, upper = <span title="Boolean(false)" class="keyword">false</span>, depth = <a href="#1052388" title="Int">maxLubDepth</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Macros.this.SilentResult[Boolean]" id="1052390">boundsOk</a> = <a href="#1052128" title="=&gt; Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538609" title="(op: Macros.this.Typer =&gt; Boolean, reportAmbiguousErrors: Boolean, newtree: Macros.this.global.Tree)Macros.this.SilentResult[Boolean]">silent</a><span class="delimiter">(</span><a href="#1052725" title="Macros.this.Typer">_</a>.<a href="Typers.scala.html#538550" title="=&gt; Macros.this.Inferencer">infer</a>.<a href="Infer.scala.html#541388" title="(tree: Macros.this.global.Tree, pre: Macros.this.global.Type, owner: Macros.this.global.Symbol, tparams: List[Macros.this.global.Symbol], targs: List[Macros.this.global.Type], prefix: String)Boolean">checkBounds</a><span class="delimiter">(</span><a href="#1052129" title="=&gt; Macros.this.global.DefDef">macroDdef</a>, <a href="../../../reflect/internal/Types.scala.html#407286" title="Macros.this.global.NoPrefix.type">NoPrefix</a>, <a href="../../../reflect/internal/Symbols.scala.html#407184" title="=&gt; Macros.this.global.NoSymbol">NoSymbol</a>, <a href="#1032816" title="=&gt; List[Macros.this.global.Symbol]">atparams</a>, <a href="#1052389" title="List[Macros.this.global.Type]">atargs</a>, <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#1052390" title="Macros.this.SilentResult[Boolean]">boundsOk</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> SilentResultValue<a href="#3366382" title="Unit" id="3366385" class="delimiter">(</a><a href="Typers.scala.html#541584" title="Boolean" id="3366396" class="keyword">true</a><span class="delimiter">)</span> =&gt; // do nothing, success
        <span class="keyword">case</span> SilentResultValue<a href="#3366382" title="Unit" id="3366390" class="delimiter">(</a><a href="Typers.scala.html#541584" title="Boolean" id="3366397" class="keyword">false</a><span class="delimiter">)</span> | SilentTypeError<a href="#3366382" title="Boolean" id="3366395" class="delimiter">(</a><a href="Typers.scala.html#541616" title="Macros.this.AbsTypeError" id="3366393">_</a><span class="delimiter">)</span> =&gt; <a href="ContextErrors.scala.html#1032786" title="(atargs: List[Macros.this.global.Type], atparams: List[Macros.this.global.Symbol])Nothing">MacroImplTargMismatchError</a><a href="#3366399" title="(x: Unit)Unit" class="delimiter">(</a><a href="#1052389" title="List[Macros.this.global.Type]">atargs</a>, <a href="#1032816" title="=&gt; List[Macros.this.global.Symbol]">atparams</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Nothing" id="1052742">ex</a>: <a href="Infer.scala.html#538154" title="Macros.this.NoInstance">NoInstance</a> =&gt; <a href="ContextErrors.scala.html#1032787" title="(atparams: List[Macros.this.global.Symbol], ex: Macros.this.NoInstance)Nothing">MacroImplTparamInstantiationError</a><span class="delimiter">(</span><a href="#1032816" title="=&gt; List[Macros.this.global.Symbol]">atparams</a>, <a href="#1052742" title="Macros.this.NoInstance">ex</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Macro classloader that is used to resolve and run macro implementations.
   *  Loads classes from from -cp (aka the library classpath).
   *  Is also capable of detecting REPL and reusing its classloader.
   */
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="ClassLoader" id="538340">macroClassloader</a>: <span title="ClassLoader">ClassLoader</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="Analyzer.scala.html#537962" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#537757" title="=&gt; Boolean">forMSIL</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)UnsupportedOperationException" class="keyword">new</span> <a href="../../../package.scala.html#55508" title="UnsupportedOperationException">UnsupportedOperationException</a><span class="delimiter">(</span><span title="String(&quot;Scala reflection not available on this platform&quot;)" class="string">&quot;Scala reflection not available on this platform&quot;</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="List[java.net.URL]" id="1052745">classpath</a> = <a href="Analyzer.scala.html#537962" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#537458" title="=&gt; Macros.this.global.PlatformClassPath">classPath</a>.<a href="../util/ClassPath.scala.html#540519" title="=&gt; List[java.net.URL]">asURLs</a>
    <a href="../../../reflect/macros/util/Traces.scala.html#537425" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;macro classloader: initializing from -cp: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#59882" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1052745" title="List[java.net.URL]">classpath</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.util.ScalaClassLoader.URLClassLoader" id="1052746">loader</a> = <a href="../util/ScalaClassLoader.scala.html#50234" title="scala.tools.nsc.util.ScalaClassLoader.type">ScalaClassLoader</a>.<a href="../util/ScalaClassLoader.scala.html#594241" title="(urls: Seq[java.net.URL], parent: ClassLoader)scala.tools.nsc.util.ScalaClassLoader.URLClassLoader">fromURLs</a><span class="delimiter">(</span><a href="#1052745" title="List[java.net.URL]">classpath</a>, <a href="#47756" title="Macros.this.type">self</a>.<span title="()Class[_]">getClass</span>.<span title="()ClassLoader">getClassLoader</span><span class="delimiter">)</span>

    // a heuristic to detect the REPL
    <span title="ClassLoader" class="keyword">if</span> <span class="delimiter">(</span><a href="Analyzer.scala.html#537962" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#537448" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#540131" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">exposeEmptyPackage</a>.<a href="../settings/MutableSettings.scala.html#541066" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../reflect/macros/util/Traces.scala.html#537425" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;macro classloader: initializing from a REPL classloader&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#59882" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="Analyzer.scala.html#537962" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#537458" title="=&gt; Macros.this.global.PlatformClassPath">classPath</a>.<a href="../util/ClassPath.scala.html#540519" title="=&gt; List[java.net.URL]">asURLs</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">import</span> scala.tools.nsc.interpreter._
      <span class="keyword">val</span> <a title="scala.tools.nsc.io.AbstractFile" id="1052763">virtualDirectory</a> = <a href="Analyzer.scala.html#537962" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#537448" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/MutableSettings.scala.html#539835" title="=&gt; scala.tools.nsc.Settings#OutputDirs">outputDirs</a>.<a href="../settings/MutableSettings.scala.html#593270" title="=&gt; Option[scala.tools.nsc.io.AbstractFile]">getSingleOutput</a>.<a href="../../../Option.scala.html#62858" title="=&gt; scala.tools.nsc.io.AbstractFile">get</a>
      <a href="#1052767" title="scala.tools.nsc.interpreter.AbstractFileClassLoader" class="keyword">new</a> <a href="../interpreter/AbstractFileClassLoader.scala.html#37977" title="anonymous class $anon extends scala.tools.nsc.interpreter.AbstractFileClassLoader" id="1052767">AbstractFileClassLoader</a><span class="delimiter">(</span><a href="#1052763" title="scala.tools.nsc.io.AbstractFile">virtualDirectory</a>, <a href="#1052746" title="scala.tools.nsc.util.ScalaClassLoader.URLClassLoader">loader</a><span class="delimiter">)</span> <span class="delimiter">{</span><span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#1052746" title="scala.tools.nsc.util.ScalaClassLoader.URLClassLoader">loader</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Produces a function that can be used to invoke macro implementation for a given macro definition:
   *    1) Looks up macro implementation symbol in this universe.
   *    2) Loads its enclosing class from the macro classloader.
   *    3) Loads the companion of that enclosing class from the macro classloader.
   *    4) Resolves macro implementation within the loaded companion.
   *
   *  @return Requested runtime if macro implementation can be loaded successfully from either of the mirrors,
   *          `null` otherwise.
   */
  <span class="keyword">type</span> <a title="Macros.this.MacroArgs =&gt; Any" id="538341">MacroRuntime</a> = MacroArgs =&gt; Any
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.WeakHashMap[Macros.this.global.Symbol,Macros.this.MacroArgs =&gt; Any]" id="538342">macroRuntimesCache</a> = <a href="../../../reflect/internal/SymbolTable.scala.html#406696" title="Macros.this.global.perRunCaches.type">perRunCaches</a>.<a href="../../../reflect/internal/SymbolTable.scala.html#471982" title="[K, V]()scala.collection.mutable.WeakHashMap[K,V]">newWeakMap</a><span title="()scala.collection.mutable.WeakHashMap[Macros.this.global.Symbol,Macros.this.MacroArgs =&gt; Any]" class="delimiter">[</span><a href="../../../reflect/internal/Symbols.scala.html#407146" title="Macros.this.global.Symbol">Symbol</a>, <a href="../../../Function1.scala.html#777" title="Macros.this.MacroArgs =&gt; Any">MacroRuntime</a><span class="delimiter">]</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(macroDef: Macros.this.global.Symbol)Macros.this.MacroArgs =&gt; Any" id="538344">macroRuntime</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1052775">macroDef</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../Function1.scala.html#777" title="Macros.this.MacroArgs =&gt; Any">MacroRuntime</a> = <span class="delimiter">{</span>
    <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: Macros.this.global.Symbol)Macros.this.global.Symbol">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;looking for macro implementation: &quot;)" class="string">&quot;looking for macro implementation: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1052775" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span>
    <span title="Macros.this.MacroArgs =&gt; Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../../reflect/FastTrack.scala.html#538320" title="=&gt; Map[Macros.this.global.Symbol,Macros.this.FastTrackEntry]">fastTrack</a> <a href="../../../collection/MapLike.scala.html#87536" title="(key: Macros.this.global.Symbol)Boolean">contains</a> <a href="#1052775" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../reflect/macros/util/Traces.scala.html#537425" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><span title="String(&quot;macro expansion is serviced by a fast track&quot;)" class="string">&quot;macro expansion is serviced by a fast track&quot;</span><span class="delimiter">)</span>
      <a href="../../../collection/MapLike.scala.html#87535" title="(key: Macros.this.global.Symbol)Macros.this.FastTrackEntry">fastTrack</a><a href="../../reflect/FastTrack.scala.html#538315" title="implicit scala.tools.reflect.FastTrack.fastTrackEntry2MacroRuntime : (entry: Macros.this.FastTrackEntry)Macros.this.MacroArgs =&gt; Any" class="delimiter">(</a><a href="#1052775" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#538342" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Symbol,Macros.this.MacroArgs =&gt; Any]">macroRuntimesCache</a>.<a href="../../../collection/mutable/MapLike.scala.html#87629" title="(key: Macros.this.global.Symbol, op: =&gt; Macros.this.MacroArgs =&gt; Any)Macros.this.MacroArgs =&gt; Any">getOrElseUpdate</a><span class="delimiter">(</span><a href="#1052775" title="Macros.this.global.Symbol">macroDef</a>, <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Macros.this.MacroImplBinding" id="1052804">binding</a> = <a href="#538333" title="(macroDef: Macros.this.global.Symbol)Macros.this.MacroImplBinding">loadMacroImplBinding</a><span class="delimiter">(</span><a href="#1052775" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="String" id="1052805">className</a> = <a href="#1052804" title="Macros.this.MacroImplBinding">binding</a>.<a href="#1051187" title="=&gt; String">className</a>
        <span class="keyword">val</span> <a title="String" id="1052806">methName</a> = <a href="#1052804" title="Macros.this.MacroImplBinding">binding</a>.<a href="#1051188" title="=&gt; String">methName</a>
        <a href="../../../reflect/macros/util/Traces.scala.html#537425" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../StringContext.scala.html#56629" title="(args: Any*)String">s</a>&quot;resolved implementation as $<a href="#1052805" title="String">className</a>.$<a href="#1052806" title="String">methName</a><span class="string">&quot;</span><span class="delimiter">)</span>

        // I don't use Scala reflection here, because it seems to interfere with JIT magic
        // whenever you instantiate a mirror (and not do anything with in, just instantiate), performance drops by 15-20%
        // I'm not sure what's the reason - for me it's pure voodoo
        // upd. my latest experiments show that everything's okay
        // it seems that in 2.10.1 we can easily switch to Scala reflection
        <span class="keyword">try</span> <span class="delimiter">{</span>
          <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: String)String">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;loading implementation class: &quot;)" class="string">&quot;loading implementation class: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1052805" title="String">className</a><span class="delimiter">)</span>
          <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: String)String">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;classloader is: &quot;)" class="string">&quot;classloader is: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../reflect/runtime/ReflectionUtils.scala.html#24795" title="scala.reflect.runtime.ReflectionUtils.type">ReflectionUtils</a>.<a href="../../../reflect/runtime/ReflectionUtils.scala.html#403164" title="(cl: ClassLoader)String">show</a><span class="delimiter">(</span><a href="#538339" title="=&gt; ClassLoader">macroClassloader</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="AnyRef" id="1052807">implObj</a> = <a href="../../../reflect/runtime/ReflectionUtils.scala.html#24795" title="scala.reflect.runtime.ReflectionUtils.type">ReflectionUtils</a>.<a href="../../../reflect/runtime/ReflectionUtils.scala.html#403165" title="(cl: ClassLoader, className: String)AnyRef">staticSingletonInstance</a><span class="delimiter">(</span><a href="#538339" title="=&gt; ClassLoader">macroClassloader</a>, <a href="#1052805" title="String">className</a><span class="delimiter">)</span>
          // relies on the fact that macro impls cannot be overloaded
          // so every methName can resolve to at maximum one method
          <span class="keyword">val</span> <a title="Option[java.lang.reflect.Method]" id="1052808">implMeths</a> = <a href="#1052807" title="AnyRef">implObj</a>.<span title="()Class[_]">getClass</span>.<a href="../../../Predef.scala.html#7555" title="(xs: Array[java.lang.reflect.Method])scala.collection.mutable.ArrayOps[java.lang.reflect.Method]">getDeclaredMethods</a>.<a href="../../../collection/IndexedSeqOptimized.scala.html#59126" title="(p: java.lang.reflect.Method =&gt; Boolean)Option[java.lang.reflect.Method]">find</a><span class="delimiter">(</span><a href="#1053070" title="java.lang.reflect.Method">_</a>.<span title="()String">getName</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1052806" title="String">methName</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="java.lang.reflect.Method" id="1052809">implMeth</a> = <a href="#1052808" title="Option[java.lang.reflect.Method]">implMeths</a> <a href="../../../Option.scala.html#62859" title="(default: =&gt; java.lang.reflect.Method)java.lang.reflect.Method">getOrElse</a> <span class="delimiter">{</span> <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)NoSuchMethodException" class="keyword">new</span> <span title="NoSuchMethodException">NoSuchMethodException</span><span class="delimiter">(</span><a href="../../../StringContext.scala.html#56629" title="(args: Any*)String">s</a>&quot;$<a href="#1052805" title="String">className</a>.$<a href="#1052806" title="String">methName</a><span class="string">&quot;</span><span class="delimiter">)</span> <span class="delimiter">}</span>
          <a href="../../../reflect/macros/util/Traces.scala.html#537425" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;successfully loaded macro impl as (%s, %s)&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#59882" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1052807" title="AnyRef">implObj</a>, <a href="#1052809" title="java.lang.reflect.Method">implMeth</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a title="Macros.this.MacroArgs" id="1053087">args</a> =&gt; <a href="#1052809" title="java.lang.reflect.Method">implMeth</a>.<span title="(x$1: Any, x$2: &lt;repeated...&gt;[Object])Object">invoke</span><span class="delimiter">(</span><a href="#1052807" title="AnyRef">implObj</a>, <span class="delimiter">(</span><span class="delimiter">(</span><a href="#1053087" title="Macros.this.MacroArgs">args</a>.<a href="#1054156" title="=&gt; Macros.this.MacroContext">c</a> <a href="../../../collection/immutable/List.scala.html#62702" title="(elem: Any)(implicit bf: scala.collection.generic.CanBuildFrom[List[Any],Any,List[Any]])List[Any]">+:</a> <a href="#1053087" title="Macros.this.MacroArgs">args</a>.<a href="#1054157" title="=&gt; List[Any]">others</a><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Any =&gt; AnyRef)(implicit bf: scala.collection.generic.CanBuildFrom[List[Any],AnyRef,List[AnyRef]])List[AnyRef]">map</a> <span class="delimiter">(</span><a href="#1053180" title="Any">_</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>: _*<span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="Null" id="1053209">ex</a>: <span title="Exception">Exception</span> =&gt;
            <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: String)String">macroTraceVerbose</a><span class="delimiter">(</span><a href="../../../StringContext.scala.html#56629" title="(args: Any*)String">s</a><span class="string">&quot;macro runtime failed to load: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1053209" title="Exception">ex</a>.<span title="()String">toString</span><span class="delimiter">)</span>
            <a href="#1052775" title="Macros.this.global.Symbol">macroDef</a> <a href="../../../reflect/internal/Symbols.scala.html#411236" title="(mask: Long)macroDef.type">setFlag</a> <span title="Long(4294967296L)">IS_ERROR</span>
            <span title="Null(null)" class="keyword">null</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, prefixTree: Macros.this.global.Tree, expandeeTree: Macros.this.global.Tree)Macros.this.MacroContext" id="538345">macroContext</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1053216">typer</a>: <a href="Typers.scala.html#538117" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1053217">prefixTree</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a>, <a title="Macros.this.global.Tree" id="1053218">expandeeTree</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="StdAttachments.scala.html#539248" title="Macros.this.MacroContext">MacroContext</a> =
    <a href="#1053223" title="scala.reflect.macros.runtime.Context{}" class="keyword">new</a> <a title="anonymous class $anon extends scala.reflect.macros.runtime.Context" id="1053223" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="Macros.this.global.type" id="1053388">universe</a>: self.global.<span class="keyword">type</span> = <a href="#47756" title="Macros.this.type">self</a>.<a href="Analyzer.scala.html#537962" title="=&gt; scala.tools.nsc.Global">global</a>
      <span class="keyword">val</span> <a title="universe.analyzer.Typer" id="1053389">callsiteTyper</a>: universe.analyzer.<a href="Typers.scala.html#538117" title="universe.analyzer.Typer">Typer</a> = <a href="#1053216" title="Macros.this.Typer">typer</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="this.global.analyzer.Typer" class="delimiter">[</span>global.analyzer.<a href="Typers.scala.html#538117" title="this.global.analyzer.Typer">Typer</a><span class="delimiter">]</span>
      <span class="keyword">val</span> <a title="Macros.this.global.Tree" id="1053390">expandee</a> = <a href="#1053218" title="Macros.this.global.Tree">expandeeTree</a>
    <span class="delimiter">}</span> <span class="keyword">with</span> <a href="StdAttachments.scala.html#538511" title="scala.reflect.macros.runtime.Context">UnaffiliatedMacroContext</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="this.Expr[Nothing]" id="1053240">prefix</a> = <a href="../../../reflect/macros/runtime/Aliases.scala.html#537278" title="[T](tree: this.Tree)(implicit evidence$1: this.WeakTypeTag[T])this.Expr[T]">Expr</a><span title="(tree: this.Tree)(implicit evidence$1: this.WeakTypeTag[Nothing])this.Expr[Nothing]" class="delimiter">[</span><span title="Nothing">Nothing</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#1053217" title="Macros.this.global.Tree">prefixTree</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../reflect/macros/runtime/Aliases.scala.html#537287" title="=&gt; this.universe.TypeTag.type">TypeTag</a>.<a href="../../../reflect/api/TypeTags.scala.html#403326" title="=&gt; this.universe.TypeTag[Nothing]">Nothing</a><span class="delimiter">)</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1053242">toString</a> = <a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;MacroContext(%s@%s +%d)&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#59882" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1053390" title="=&gt; Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; Macros.this.global.Symbol#NameType">name</a>, <a href="#1053390" title="=&gt; Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; Macros.this.global.Position">pos</a>, <a href="../../../reflect/macros/runtime/Enclosures.scala.html#537328" title="=&gt; List[scala.reflect.macros.runtime.Context]">enclosingMacros</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57161" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span> /* exclude myself */<span class="delimiter">)</span>
    <span class="delimiter">}</span>

  /** Calculate the arguments to pass to a macro implementation when expanding the provided tree.
   */
  case <span class="keyword">class</span> <a title="class MacroArgs extends AnyRef with Product with Serializable" id="1057217">MacroArgs</a><a href="../../../Product.scala.html#186" title="Product" class="delimiter">(</a><a title="Macros.this.MacroContext" id="1054156">c</a>: <a href="StdAttachments.scala.html#539248" title="Macros.this.MacroContext">MacroContext</a>, <a title="=&gt; List[Any]" id="1054157">others</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[Any]">List</a><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.MacroArgs" id="538349">macroArgs</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1053463">typer</a>: <a href="Typers.scala.html#538117" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1053464">expandee</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="#1057217" title="Macros.this.MacroArgs">MacroArgs</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1053466">macroDef</a>   = <a href="#1053464" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a>
    <span class="keyword">val</span> <a title="Macros.this.global.Tree" id="1053467">prefixTree</a> = <a href="#1053464" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/internal/Trees.scala.html#408541" title="(pf: PartialFunction[Macros.this.global.Tree,Macros.this.global.Tree])List[Macros.this.global.Tree]">collect</a><a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Macros.this.global.Tree,Macros.this.global.Tree] with Serializable" id="1053503" class="delimiter">{</a> <span class="keyword">case</span> Select<a href="#3366437" title="B1" id="3366448" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#409999" title="Macros.this.global.Tree" id="1053510">qual</a>, <a href="../../../reflect/internal/Trees.scala.html#410001" title="Macros.this.global.Name" id="1053511">name</a><span class="delimiter">)</span> =&gt; <a href="#3366441" title="(x: B1)B1">qual</a> <span class="delimiter">}</span>.<a href="../../../collection/TraversableLike.scala.html#58103" title="=&gt; Option[Macros.this.global.Tree]">headOption</a>.<a href="../../../Option.scala.html#62859" title="(default: =&gt; Macros.this.global.Tree)Macros.this.global.Tree">getOrElse</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#407946" title="Macros.this.global.EmptyTree.type">EmptyTree</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Macros.this.MacroContext" id="1053468">context</a>    = <a href="#1053464" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/internal/StdAttachments.scala.html#409595" title="=&gt; scala.reflect.macros.Attachments{type Pos = Macros.this.global.Position}">attachments</a>.<a href="../../../reflect/macros/Attachments.scala.html#402528" title="[T](implicit evidence$2: scala.reflect.ClassTag[T])Option[T]">get</a><a href="../../../reflect/ClassTag.scala.html#81051" title="(implicit evidence$2: scala.reflect.ClassTag[Macros.this.MacroRuntimeAttachment])Option[Macros.this.MacroRuntimeAttachment]" class="delimiter">[</a><a href="StdAttachments.scala.html#538513" title="Macros.this.MacroRuntimeAttachment">MacroRuntimeAttachment</a><span class="delimiter">]</span>.<a href="../../../Option.scala.html#62871" title="(f: Macros.this.MacroRuntimeAttachment =&gt; Option[Macros.this.MacroContext])Option[Macros.this.MacroContext]">flatMap</a><span class="delimiter">(</span><a href="#1053564" title="Macros.this.MacroRuntimeAttachment">_</a>.<a href="StdAttachments.scala.html#1053554" title="=&gt; Option[Macros.this.MacroContext]">macroContext</a><span class="delimiter">)</span>.<a href="../../../Option.scala.html#62859" title="(default: =&gt; Macros.this.MacroContext)Macros.this.MacroContext">getOrElse</a><span class="delimiter">(</span><a href="#538345" title="(typer: Macros.this.Typer, prefixTree: Macros.this.global.Tree, expandeeTree: Macros.this.global.Tree)Macros.this.MacroContext">macroContext</a><span class="delimiter">(</span><a href="#1053463" title="Macros.this.Typer">typer</a>, <a href="#1053467" title="Macros.this.global.Tree">prefixTree</a>, <a href="#1053464" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="List[Macros.this.global.Tree]" id="1053469">typeArgs</a>   = List<span class="delimiter">[</span>Tree<span class="delimiter">]</span><a href="../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type" class="delimiter">(</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[List[Macros.this.global.Expr[_]]]" id="1053470">exprArgs</a>   = <a href="../../../collection/generic/GenericCompanion.scala.html#59933" title="[A](elems: A*)scala.collection.mutable.ListBuffer[A]">ListBuffer</a><span title="(elems: List[Macros.this.global.Expr[_]]*)scala.collection.mutable.ListBuffer[List[Macros.this.global.Expr[_]]]" class="delimiter">[</span><a href="../../../collection/immutable/List.scala.html#11952" title="List[Macros.this.global.Expr[_]]">List</a><span class="delimiter">[</span>Expr<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Unit" id="1053471">collectMacroArgs</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1053588">tree</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#1515" title="Unit">Unit</a> = <a href="#1053588" title="Macros.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Apply<a href="#3366454" title="Unit" id="3366456" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410031" title="Macros.this.global.Tree" id="1053593">fn</a>, <a href="../../../reflect/internal/Trees.scala.html#410033" title="List[Macros.this.global.Tree]" id="1053594">args</a><span class="delimiter">)</span> =&gt;
        // todo. infer precise typetag for this Expr, namely the declared type of the corresponding macro impl argument
        <a href="#1053470" title="scala.collection.mutable.ListBuffer[List[Macros.this.global.Expr[_]]]">exprArgs</a>.<a href="../../../collection/mutable/BufferLike.scala.html#66926" title="(elems: List[Macros.this.global.Expr[_]]*)Unit">prepend</a><span class="delimiter">(</span><a href="#1053594" title="List[Macros.this.global.Tree]">args</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Macros.this.global.Tree =&gt; context.Expr[Nothing])(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Tree],context.Expr[Nothing],List[Macros.this.global.Expr[_]]])List[Macros.this.global.Expr[_]]">map</a> <span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1053612">arg</a> =&gt; <a href="#1053468" title="Macros.this.MacroContext">context</a>.<a href="../../../reflect/macros/runtime/Aliases.scala.html#537278" title="[T](tree: context.Tree)(implicit evidence$1: context.WeakTypeTag[T])context.Expr[T]">Expr</a><span title="(tree: context.Tree)(implicit evidence$1: context.WeakTypeTag[Nothing])context.Expr[Nothing]" class="delimiter">[</span><span title="Nothing">Nothing</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#1053612" title="Macros.this.global.Tree">arg</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../reflect/api/TypeTags.scala.html#56541" title="Macros.this.global.TypeTag.type">TypeTag</a>.<a href="../../../reflect/api/TypeTags.scala.html#403326" title="=&gt; Macros.this.global.TypeTag[Nothing]">Nothing</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#1053471" title="(tree: Macros.this.global.Tree)Unit">collectMacroArgs</a><span class="delimiter">(</span><a href="#1053593" title="Macros.this.global.Tree">fn</a><span class="delimiter">)</span>
      <span class="keyword">case</span> TypeApply<a href="#3366454" title="Unit" id="3366458" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410043" title="Macros.this.global.Tree" id="1053742">fn</a>, <a href="../../../reflect/internal/Trees.scala.html#410045" title="List[Macros.this.global.Tree]" id="1053743">args</a><span class="delimiter">)</span> =&gt;
        <a href="#1053469" title="List[Macros.this.global.Tree]">typeArgs</a> = <a href="#1053743" title="List[Macros.this.global.Tree]">args</a>
        <a href="#1053471" title="(tree: Macros.this.global.Tree)Unit">collectMacroArgs</a><span class="delimiter">(</span><a href="#1053742" title="Macros.this.global.Tree">fn</a><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt;
    <span class="delimiter">}</span>
    <a href="#1053471" title="(tree: Macros.this.global.Tree)Unit">collectMacroArgs</a><span class="delimiter">(</span><a href="#1053464" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Boolean" id="1053472">argcDoesntMatch</a> = <a href="#1053466" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#411390" title="=&gt; List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57104" title="(x: Int)Boolean">!=</a> <a href="#1053470" title="scala.collection.mutable.ListBuffer[List[Macros.this.global.Expr[_]]]">exprArgs</a>.<a href="../../../collection/mutable/ListBuffer.scala.html#79761" title="=&gt; Int">length</a>
    <span class="keyword">val</span> <a title="Boolean" id="1053473">nullaryArgsEmptyParams</a> = <a href="#1053470" title="scala.collection.mutable.ListBuffer[List[Macros.this.global.Expr[_]]]">exprArgs</a>.<a href="../../../collection/generic/TraversableForwarder.scala.html#79860" title="=&gt; Boolean">isEmpty</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1053466" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#411390" title="=&gt; List[List[Macros.this.global.Symbol]]">paramss</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../package.scala.html#55814" title="=&gt; List[scala.collection.immutable.Nil.type]">ListOfNil</a>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1053472" title="Boolean">argcDoesntMatch</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1053473" title="Boolean">nullaryArgsEmptyParams</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#1053463" title="Macros.this.Typer">typer</a>.<a href="ContextErrors.scala.html#538736" title="typer.TyperErrorGen.type">TyperErrorGen</a>.<a href="ContextErrors.scala.html#541340" title="(expandee: Macros.this.global.Tree)Nothing">MacroPartialApplicationError</a><span class="delimiter">(</span><a href="#1053464" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span> <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="List[List[Any]]" id="1053474">argss</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[List[Any]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#1053470" title="scala.collection.mutable.ListBuffer[List[Macros.this.global.Expr[_]]]">exprArgs</a>.<a href="../../../collection/mutable/ListBuffer.scala.html#79773" title="=&gt; List[List[Macros.this.global.Expr[_]]]">toList</a>
    <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: Macros.this.MacroContext)Macros.this.MacroContext">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;context: &quot;)" class="string">&quot;context: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1053468" title="Macros.this.MacroContext">context</a><span class="delimiter">)</span>
    <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: List[List[Any]])List[List[Any]]">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;argss: &quot;)" class="string">&quot;argss: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1053474" title="List[List[Any]]">argss</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="List[List[Any]]" id="1053475">preparedArgss</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[List[Any]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">]</span> =
      <span title="List[List[Any]]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../reflect/FastTrack.scala.html#538320" title="=&gt; Map[Macros.this.global.Symbol,Macros.this.FastTrackEntry]">fastTrack</a> <a href="../../../collection/MapLike.scala.html#87536" title="(key: Macros.this.global.Symbol)Boolean">contains</a> <a href="#1053466" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="List[List[Any]]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../collection/MapLike.scala.html#87535" title="(key: Macros.this.global.Symbol)Macros.this.FastTrackEntry">fastTrack</a><span class="delimiter">(</span><a href="#1053466" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span> <a href="../../reflect/FastTrack.scala.html#539776" title="(c: Macros.this.MacroContext)Boolean">validate</a> <a href="#1053468" title="Macros.this.MacroContext">context</a><span class="delimiter">)</span> <a href="#1053474" title="List[List[Any]]">argss</a>
        <span class="keyword">else</span> <a href="#1053463" title="Macros.this.Typer">typer</a>.<a href="ContextErrors.scala.html#538736" title="typer.TyperErrorGen.type">TyperErrorGen</a>.<a href="ContextErrors.scala.html#541340" title="(expandee: Macros.this.global.Tree)Nothing">MacroPartialApplicationError</a><span class="delimiter">(</span><a href="#1053464" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        // if paramss have typetag context bounds, add an arglist to argss if necessary and instantiate the corresponding evidences
        // consider the following example:
        //
        //   class D[T] {
        //     class C[U] {
        //       def foo[V] = macro Impls.foo[T, U, V]
        //     }
        //   }
        //
        //   val outer1 = new D[Int]
        //   val outer2 = new outer1.C[String]
        //   outer2.foo[Boolean]
        //
        // then T and U need to be inferred from the lexical scope of the call using `asSeenFrom`
        // whereas V won't be resolved by asSeenFrom and need to be loaded directly from `expandee` which needs to contain a TypeApply node
        // also, macro implementation reference may contain a regular type as a type argument, then we pass it verbatim
        <span class="keyword">val</span> <a title="Macros.this.MacroImplBinding" id="1053797">binding</a> = <a href="#538333" title="(macroDef: Macros.this.global.Symbol)Macros.this.MacroImplBinding">loadMacroImplBinding</a><span class="delimiter">(</span><a href="#1053466" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span>
        <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: Macros.this.MacroImplBinding)Macros.this.MacroImplBinding">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;binding: &quot;)" class="string">&quot;binding: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1053797" title="Macros.this.MacroImplBinding">binding</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="List[context.WeakTypeTag[Nothing]]" id="1053798">tags</a> = <a href="#1053797" title="Macros.this.MacroImplBinding">binding</a>.<a href="#1051189" title="=&gt; List[Int]">signature</a> <a href="../../../collection/TraversableLike.scala.html#58073" title="(p: Int =&gt; Boolean)List[Int]">filter</a> <span class="delimiter">(</span><a href="#1053808" title="Int">_</a> <a href="../../../Int.scala.html#57104" title="(x: Int)Boolean">!=</a> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Int =&gt; context.WeakTypeTag[Nothing])(implicit bf: scala.collection.generic.CanBuildFrom[List[Int],context.WeakTypeTag[Nothing],List[context.WeakTypeTag[Nothing]]])List[context.WeakTypeTag[Nothing]]">map</a> <span class="delimiter">(</span><a title="Int" id="1053832">paramPos</a> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1053833">targ</a> = <a href="#1053797" title="Macros.this.MacroImplBinding">binding</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)Macros.this.global.Tree">targs</a><span class="delimiter">(</span><a href="#1053832" title="Int">paramPos</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; Macros.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#408407" title="=&gt; Macros.this.global.Symbol">typeSymbol</a>
          <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1053834">tpe</a> = <span title="Macros.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1053833" title="Macros.this.global.Symbol">targ</a>.<a href="../../../reflect/internal/Symbols.scala.html#411193" title="=&gt; Boolean">isTypeParameterOrSkolem</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="Macros.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1053833" title="Macros.this.global.Symbol">targ</a>.<a href="../../../reflect/internal/Symbols.scala.html#411315" title="=&gt; Macros.this.global.Symbol">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1053466" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              // doesn't work when macro def is compiled separately from its usages
              // then targ is not a skolem and isn't equal to any of macroDef.typeParams
              // val argPos = targ.deSkolemize.paramPos
              <span class="keyword">val</span> <a title="Int" id="1053849">argPos</a> = <a href="#1053466" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#411389" title="=&gt; List[Macros.this.global.Symbol]">typeParams</a>.<a href="../../../collection/GenSeqLike.scala.html#58688" title="(p: Macros.this.global.Symbol =&gt; Boolean)Int">indexWhere</a><span class="delimiter">(</span><a href="#1053864" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; x$21.NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1053833" title="Macros.this.global.Symbol">targ</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; targ.NameType">name</a><span class="delimiter">)</span>
              <a href="../../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)Macros.this.global.Tree">typeArgs</a><span class="delimiter">(</span><a href="#1053849" title="Int">argPos</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; Macros.this.global.Type">tpe</a>
            <span class="delimiter">}</span> <span class="keyword">else</span>
              <a href="#1053833" title="Macros.this.global.Symbol">targ</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Macros.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#408460" title="(pre: Macros.this.global.Type, clazz: Macros.this.global.Symbol)Macros.this.global.Type">asSeenFrom</a><span class="delimiter">(</span>
                <span title="Macros.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1053467" title="Macros.this.global.Tree">prefixTree</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Trees.scala.html#407946" title="Macros.this.global.EmptyTree.type">EmptyTree</a><span class="delimiter">)</span> <a href="#1053466" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#411315" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Macros.this.global.Type">tpe</a> <span class="keyword">else</span> <a href="#1053467" title="Macros.this.global.Tree">prefixTree</a>.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; Macros.this.global.Type">tpe</a>,
                <a href="#1053466" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#411315" title="=&gt; Macros.this.global.Symbol">owner</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <a href="#1053833" title="Macros.this.global.Symbol">targ</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Macros.this.global.Type">tpe</a>
          <a href="#1053468" title="Macros.this.MacroContext">context</a>.<a href="../../../reflect/macros/runtime/Aliases.scala.html#537289" title="(tpe: context.Type)context.WeakTypeTag[Nothing]">WeakTypeTag</a><span class="delimiter">(</span><a href="#1053834" title="Macros.this.global.Type">tpe</a><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>
        <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: List[context.WeakTypeTag[Nothing]])List[context.WeakTypeTag[Nothing]]">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;tags: &quot;)" class="string">&quot;tags: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1053798" title="List[context.WeakTypeTag[Nothing]]">tags</a><span class="delimiter">)</span>

        // transforms argss taking into account varargness of paramss
        // note that typetag context bounds are only declared on macroImpls
        // so this optional arglist might not match macroDef's paramlist
        // nb! varargs can apply to any parameter section, not necessarily to the last one
        <a href="../../../reflect/internal/util/Collections.scala.html#406780" title="(xs: List[List[Any]])(f: (List[Any], Int) =&gt; List[Any])List[List[Any]]">mapWithIndex</a><span class="delimiter">(</span><a href="#1053474" title="List[List[Any]]">argss</a> <a href="../../../collection/SeqLike.scala.html#58855" title="(elem: List[Any])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[Any]],List[Any],List[List[Any]]])List[List[Any]]">:+</a> <a href="#1053798" title="List[context.WeakTypeTag[Nothing]]">tags</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="List[Any]" id="1054063">as</a>, <a title="Int" id="1054064">i</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Boolean" id="1054065">mapsToParamss</a> = <a href="#1053466" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#411390" title="=&gt; List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/SeqLike.scala.html#58876" title="=&gt; scala.collection.immutable.Range">indices</a> <a href="../../../collection/immutable/Range.scala.html#81316" title="(x: Int)Boolean">contains</a> <a href="#1054064" title="Int">i</a>
          <span title="List[Any]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1054065" title="Boolean">mapsToParamss</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="List[Macros.this.global.Symbol]" id="1054071">ps</a> = <a href="#1053466" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)List[Macros.this.global.Symbol]">paramss</a><span class="delimiter">(</span><a href="#1054064" title="Int">i</a><span class="delimiter">)</span>
            <span title="List[Any]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408821" title="(params: Seq[Macros.this.global.Symbol])Boolean">isVarArgsList</a><span class="delimiter">(</span><a href="#1054071" title="List[Macros.this.global.Symbol]">ps</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a href="#3366468" title="(x: (List[Any], List[Any]))(List[Any], List[Any])" class="delimiter">(</a><a href="../../../Tuple2.scala.html#60635" title="List[Any]" id="1054082">normal</a>, <a href="../../../Tuple2.scala.html#60637" title="List[Any]" id="1054083">varargs</a><span class="delimiter">)</span> = <a href="#1054063" title="List[Any]">as</a> <a href="../../../collection/immutable/List.scala.html#62712" title="(n: Int)(List[Any], List[Any])">splitAt</a> <span class="delimiter">(</span><a href="#1054071" title="List[Macros.this.global.Symbol]">ps</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57161" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
              <a href="#1054082" title="List[Any]">normal</a> <a href="../../../collection/SeqLike.scala.html#58855" title="(elem: Any)(implicit bf: scala.collection.generic.CanBuildFrom[List[Any],Any,List[Any]])List[Any]">:+</a> <a href="#1054083" title="List[Any]">varargs</a> // pack all varargs into a single List argument
            <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#1054063" title="List[Any]">as</a>
          <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#1054063" title="List[Any]">as</a>
        <span class="delimiter">}</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: List[List[Any]])List[List[Any]]">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;preparedArgss: &quot;)" class="string">&quot;preparedArgss: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1053475" title="List[List[Any]]">preparedArgss</a><span class="delimiter">)</span>
    <a href="#1057217" title="(c: Macros.this.MacroContext, others: List[Any])Macros.this.MacroArgs">MacroArgs</a><span class="delimiter">(</span><a href="#1053468" title="Macros.this.MacroContext">context</a>, <a href="#1053475" title="List[List[Any]]">preparedArgss</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#58488" title="(implicit asTraversable: List[Any] =&gt; scala.collection.GenTraversableOnce[Any])List[Any]">flatten</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** Keeps track of macros in-flight.
   *  See more informations in comments to `openMacros` in `scala.reflect.macros.Context`.
   */
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="List[scala.reflect.macros.runtime.Context{val universe: Macros.this.global.type}]" id="538351">_openMacros</a> = List<span class="delimiter">[</span>MacroContext<span class="delimiter">]</span><a href="../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type" class="delimiter">(</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; List[scala.reflect.macros.runtime.Context{val universe: Macros.this.global.type}]" id="538353">openMacros</a> = <a href="#538351" title="=&gt; List[scala.reflect.macros.runtime.Context{val universe: Macros.this.global.type}]">_openMacros</a>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(c: Macros.this.MacroContext)Unit" id="538354">pushMacroContext</a><span class="delimiter">(</span><a title="Macros.this.MacroContext" id="1054168">c</a>: <a href="StdAttachments.scala.html#539248" title="Macros.this.MacroContext">MacroContext</a><span class="delimiter">)</span> = <a href="#538351" title="(x$1: List[scala.reflect.macros.runtime.Context{val universe: Macros.this.global.type}])Unit">_openMacros</a> <a href="../../../collection/immutable/List.scala.html#62685" title="(x: scala.reflect.macros.runtime.Context{val universe: Macros.this.global.type})List[scala.reflect.macros.runtime.Context{val universe: Macros.this.global.type}]">::=</a> <a href="#1054168" title="Macros.this.MacroContext">c</a>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="538355">popMacroContext</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#538351" title="(x$1: List[scala.reflect.macros.runtime.Context{val universe: Macros.this.global.type}])Unit">_openMacros</a> = <a href="#538351" title="=&gt; List[scala.reflect.macros.runtime.Context{val universe: Macros.this.global.type}]">_openMacros</a>.<a href="../../../collection/TraversableLike.scala.html#58104" title="=&gt; List[scala.reflect.macros.runtime.Context{val universe: Macros.this.global.type}]">tail</a>
  <span class="keyword">def</span> <a title="=&gt; scala.reflect.internal.util.Position" id="538356">enclosingMacroPosition</a> = <a href="#538353" title="=&gt; List[scala.reflect.macros.runtime.Context{val universe: Macros.this.global.type}]">openMacros</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: scala.reflect.macros.runtime.Context{val universe: Macros.this.global.type} =&gt; scala.reflect.internal.util.Position)(implicit bf: scala.collection.generic.CanBuildFrom[List[scala.reflect.macros.runtime.Context{val universe: Macros.this.global.type}],scala.reflect.internal.util.Position,List[scala.reflect.internal.util.Position]])List[scala.reflect.internal.util.Position]">map</a> <span class="delimiter">(</span><a href="#542232" title="StdAttachments extends scala.reflect.macros.runtime.Context">_</a>.<a href="../../../reflect/macros/runtime/Enclosures.scala.html#537322" title="=&gt; x$23.universe.Tree">macroApplication</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; scala.reflect.internal.util.Position">pos</a><span class="delimiter">)</span> <a href="../../../collection/LinearSeqOptimized.scala.html#86381" title="(p: scala.reflect.internal.util.Position =&gt; Boolean)Option[scala.reflect.internal.util.Position]">find</a> <span class="delimiter">(</span><a href="#542277" title="scala.reflect.internal.util.Position">_</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="../../../reflect/internal/Positions.scala.html#408302" title="=&gt; reflect.internal.util.NoPosition.type">NoPosition</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#62859" title="(default: =&gt; scala.reflect.internal.util.Position)scala.reflect.internal.util.Position">getOrElse</a> <a href="../../../reflect/internal/Positions.scala.html#408302" title="=&gt; reflect.internal.util.NoPosition.type">NoPosition</a>

  <span class="keyword">private</span> <span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class MacroExpansionResult extends Object" id="538357">MacroExpansionResult</a>
  <span class="keyword">private</span> case <span class="keyword">class</span> <a title="class Success extends Macros.this.MacroExpansionResult with Product with Serializable" id="1057221">Success</a><a href="../../../Product.scala.html#186" title="Product" class="delimiter">(</a><a title="Macros.this.global.Tree" id="1056627">expanded</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#538357" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a>
  <span class="keyword">private</span> case <span class="keyword">class</span> <a title="class Fallback extends Macros.this.MacroExpansionResult with Product with Serializable" id="1057225">Fallback</a><a href="../../../Product.scala.html#186" title="Product" class="delimiter">(</a><a title="Macros.this.global.Tree" id="1056771">fallback</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#538357" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a> <span class="delimiter">{</span> <a href="../Global.scala.html#537672" title="=&gt; Macros.this.global.Run">currentRun</a>.<a href="../Global.scala.html#539334" title="(x$1: Boolean)Unit">seenMacroExpansionsFallingBack</a> = <span title="Boolean(true)" class="keyword">true</span> <span class="delimiter">}</span>
  <span class="keyword">private</span> case <span class="keyword">class</span> <a title="class Other extends Macros.this.MacroExpansionResult with Product with Serializable" id="1057229">Other</a><a href="../../../Product.scala.html#186" title="Product" class="delimiter">(</a><a title="Macros.this.global.Tree" id="1054289">result</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#538357" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expanded: Macros.this.global.Tree)Macros.this.Other" id="538367">Delay</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1054286">expanded</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#1057229" title="(result: Macros.this.global.Tree)Macros.this.Other">Other</a><span class="delimiter">(</span><a href="#1054286" title="Macros.this.global.Tree">expanded</a><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expanded: Macros.this.global.Tree)Macros.this.Other" id="538368">Skip</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1054292">expanded</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#1057229" title="(result: Macros.this.global.Tree)Macros.this.Other">Other</a><span class="delimiter">(</span><a href="#1054292" title="Macros.this.global.Tree">expanded</a><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expandee: Macros.this.global.Tree)Macros.this.Other" id="538369">Cancel</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1054295">expandee</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#1057229" title="(result: Macros.this.global.Tree)Macros.this.Other">Other</a><span class="delimiter">(</span><a href="#1054295" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expandee: Macros.this.global.Tree)Macros.this.Other" id="538370">Failure</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1054298">expandee</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#1057229" title="(result: Macros.this.global.Tree)Macros.this.Other">Other</a><span class="delimiter">(</span><a href="#1054298" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>

  /** Performs macro expansion:
   *    1) Checks whether the expansion needs to be delayed (see `mustDelayMacroExpansion`)
   *    2) Loads macro implementation using `macroMirror`
   *    3) Synthesizes invocation arguments for the macro implementation
   *    4) Checks that the result is a tree bound to this universe
   *    5) Typechecks the result against the return type of the macro definition
   *
   *  If -Ymacro-debug-lite is enabled, you will get basic notifications about macro expansion
   *  along with macro expansions logged in the form that can be copy/pasted verbatim into REPL.
   *
   *  If -Ymacro-debug-verbose is enabled, you will get detailed log of how exactly this function
   *  performs class loading and method resolution in order to load the macro implementation.
   *  The log will also include other non-trivial steps of macro expansion.
   *
   *  @return
   *    the expansion result                    if the expansion has been successful,
   *    the fallback method invocation          if the expansion has been unsuccessful, but there is a fallback,
   *    the expandee unchanged                  if the expansion has been delayed,
   *    the expandee fully expanded             if the expansion has been delayed before and has been expanded now,
   *    the expandee with an error marker set   if the expansion has been cancelled due malformed arguments or implementation
   *    the expandee with an error marker set   if there has been an error
   */
  <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree" id="538371">macroExpand</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1054301">typer</a>: <a href="Typers.scala.html#538117" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1054302">expandee</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a>, <a title="Int" id="1054306">mode</a>: <a href="../../../Int.scala.html#321" title="Int">Int</a> = <span title="Int(1)">EXPRmode</span>, <a title="Macros.this.global.Type" id="1054307">pt</a>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a> = <a href="../../../reflect/internal/Types.scala.html#407279" title="Macros.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="(Long, Long)" id="1054308">start</a> = <span title="(Long, Long)" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/internal/util/Statistics.scala.html#22672" title="scala.reflect.internal.util.Statistics.type">Statistics</a>.<a href="../../../reflect/internal/util/Statistics.scala.html#415273" title="=&gt; Boolean">canEnable</a><span class="delimiter">)</span> <a href="../../../reflect/internal/util/Statistics.scala.html#22672" title="scala.reflect.internal.util.Statistics.type">Statistics</a>.<a href="../../../reflect/internal/util/Statistics.scala.html#415233" title="(tm: scala.reflect.internal.util.Statistics.Timer)(Long, Long)">startTimer</a><span class="delimiter">(</span><a href="#539239" title="=&gt; scala.reflect.internal.util.Statistics.Timer">macroExpandNanos</a><span class="delimiter">)</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/internal/util/Statistics.scala.html#22672" title="scala.reflect.internal.util.Statistics.type">Statistics</a>.<a href="../../../reflect/internal/util/Statistics.scala.html#415273" title="=&gt; Boolean">canEnable</a><span class="delimiter">)</span> <a href="../../../reflect/internal/util/Statistics.scala.html#22672" title="scala.reflect.internal.util.Statistics.type">Statistics</a>.<a href="../../../reflect/internal/util/Statistics.scala.html#415226" title="(c: scala.reflect.internal.util.Statistics.Counter)Unit">incCounter</a><span class="delimiter">(</span><a href="#539237" title="=&gt; scala.reflect.internal.util.Statistics.Counter">macroExpandCount</a><span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#538372" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.MacroExpansionResult">macroExpand1</a><a href="#3366492" title="(x: Macros.this.global.Tree)Macros.this.global.Tree" class="delimiter">(</a><a href="#1054301" title="Macros.this.Typer">typer</a>, <a href="#1054302" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Success<a href="#3366487" title="Macros.this.global.Tree" id="3366488" class="delimiter">(</a><a href="#1056627" title="Macros.this.global.Tree" id="1054314">expanded</a><span class="delimiter">)</span> =&gt;
          <a href="#3366492" title="(x: Macros.this.global.Tree)Macros.this.global.Tree" class="keyword">try</a> <span class="delimiter">{</span>
            <span class="keyword">def</span> <a title="(phase: String, tree: Macros.this.global.Tree, pt: Macros.this.global.Type)Macros.this.global.Tree" id="1054315">typecheck</a><span class="delimiter">(</span><a title="String" id="1054318">phase</a>: <span title="String">String</span>, <a title="Macros.this.global.Tree" id="1054319">tree</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a>, <a title="Macros.this.global.Type" id="1054320">pt</a>: <a href="../../../reflect/internal/Types.scala.html#407270" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1054319" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#408559" title="=&gt; Boolean">isErroneous</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <a href="#1054319" title="Macros.this.global.Tree">tree</a>
              <a href="../../../reflect/macros/util/Traces.scala.html#537425" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../StringContext.scala.html#56629" title="(args: Any*)String">s</a>&quot;typechecking against $<a href="#1054318" title="String">phase</a> $<a href="#1054320" title="Macros.this.global.Type">pt</a>: $<a href="#1054314" title="Macros.this.global.Tree">expanded</a><span class="string">&quot;</span><span class="delimiter">)</span>
              <span class="keyword">val</span> <a title="Int" id="1054321">numErrors</a>    = <a href="../Global.scala.html#537436" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../reporters/Reporter.scala.html#539660" title="=&gt; scala.tools.nsc.reporters.Reporter#Severity">ERROR</a>.<a href="../reporters/Reporter.scala.html#539709" title="=&gt; Int">count</a>
              <span class="keyword">def</span> <a title="=&gt; Boolean" id="1054322">hasNewErrors</a> = <a href="../Global.scala.html#537436" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../reporters/Reporter.scala.html#539660" title="=&gt; scala.tools.nsc.reporters.Reporter#Severity">ERROR</a>.<a href="../reporters/Reporter.scala.html#539709" title="=&gt; Int">count</a> <a href="../../../Int.scala.html#57125" title="(x: Int)Boolean">&gt;</a> <a href="#1054321" title="Int">numErrors</a>
              <span class="keyword">val</span> <a title="Macros.this.global.Tree" id="1054323">result</a> = <a href="#1054301" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538560" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#538848" title="(op: =&gt; Macros.this.global.Tree)Macros.this.global.Tree">withImplicitsEnabled</a><span class="delimiter">(</span><a href="#1054301" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538698" title="(tree: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree">typed</a><span class="delimiter">(</span><a href="#1054319" title="Macros.this.global.Tree">tree</a>, <span title="Int(1)">EXPRmode</span>, <a href="#1054320" title="Macros.this.global.Type">pt</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: Macros.this.global.Tree)Macros.this.global.Tree">macroTraceVerbose</a><span class="delimiter">(</span><a href="../../../StringContext.scala.html#56629" title="(args: Any*)String">s</a>&quot;&quot;&quot;$<span class="delimiter">{</span><span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1054322" title="=&gt; Boolean">hasNewErrors</a><span class="delimiter">)</span> <span title="String(&quot;failed to typecheck&quot;)" class="string">&quot;failed to typecheck&quot;</span> <span class="keyword">else</span> <span title="String(&quot;successfully typechecked&quot;)" class="string">&quot;successfully typechecked&quot;</span><span class="delimiter">}</span> against $<a href="#1054318" title="String">phase</a> $<a href="#1054320" title="Macros.this.global.Type">pt</a>:\n$<a href="#1054323" title="Macros.this.global.Tree">result</a><span class="string">\n&quot;&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1054323" title="Macros.this.global.Tree">result</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>

            <span class="keyword">var</span> <a title="Macros.this.global.Type" id="1054316">expectedTpe</a> = <a href="#1054302" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; Macros.this.global.Type">tpe</a>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/internal/TreeInfo.scala.html#479272" title="(tree: Macros.this.global.treeInfo.global.Tree)Boolean">isNullaryInvocation</a><span class="delimiter">(</span><a href="#1054302" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#1054316" title="Macros.this.global.Type">expectedTpe</a> = <a href="#1054316" title="Macros.this.global.Type">expectedTpe</a>.<a href="../../../reflect/internal/Types.scala.html#408427" title="=&gt; Macros.this.global.Type">finalResultType</a>
            <span class="keyword">var</span> <a title="Macros.this.global.Tree" id="1054317">typechecked</a> = <a href="#1054315" title="(phase: String, tree: Macros.this.global.Tree, pt: Macros.this.global.Type)Macros.this.global.Tree">typecheck</a><span class="delimiter">(</span><span title="String(&quot;macro def return type&quot;)" class="string">&quot;macro def return type&quot;</span>, <a href="#1054314" title="Macros.this.global.Tree">expanded</a>, <a href="#1054316" title="Macros.this.global.Type">expectedTpe</a><span class="delimiter">)</span>
            <a href="#1054317" title="Macros.this.global.Tree">typechecked</a> = <a href="#1054315" title="(phase: String, tree: Macros.this.global.Tree, pt: Macros.this.global.Type)Macros.this.global.Tree">typecheck</a><span class="delimiter">(</span><span title="String(&quot;expected type&quot;)" class="string">&quot;expected type&quot;</span>, <a href="#1054317" title="Macros.this.global.Tree">typechecked</a>, <a href="#1054307" title="Macros.this.global.Type">pt</a><span class="delimiter">)</span>
            <a href="#1054317" title="Macros.this.global.Tree">typechecked</a>
          <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
            <a href="#538355" title="()Unit">popMacroContext</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="keyword">case</span> Fallback<a href="#3366487" title="Macros.this.global.Tree" id="3366489" class="delimiter">(</a><a href="#1056771" title="Macros.this.global.Tree" id="1054346">fallback</a><span class="delimiter">)</span> =&gt;
          <a href="#1054301" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538560" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#538848" title="(op: =&gt; Macros.this.global.Tree)Macros.this.global.Tree">withImplicitsEnabled</a><a href="#3366492" title="(x: Macros.this.global.Tree)Macros.this.global.Tree" class="delimiter">(</a><a href="#1054301" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538698" title="(tree: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree">typed</a><span class="delimiter">(</span><a href="#1054346" title="Macros.this.global.Tree">fallback</a>, <span title="Int(1)">EXPRmode</span>, <a href="#1054307" title="Macros.this.global.Type">pt</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> Other<a href="#3366487" title="Macros.this.global.Tree" id="3366490" class="delimiter">(</a><a href="#1054289" title="Macros.this.global.Tree" id="1054352">result</a><span class="delimiter">)</span> =&gt;
          <a href="#3366492" title="(x: Macros.this.global.Tree)Macros.this.global.Tree">result</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/internal/util/Statistics.scala.html#22672" title="scala.reflect.internal.util.Statistics.type">Statistics</a>.<a href="../../../reflect/internal/util/Statistics.scala.html#415273" title="=&gt; Boolean">canEnable</a><span class="delimiter">)</span> <a href="../../../reflect/internal/util/Statistics.scala.html#22672" title="scala.reflect.internal.util.Statistics.type">Statistics</a>.<a href="../../../reflect/internal/util/Statistics.scala.html#415234" title="(tm: scala.reflect.internal.util.Statistics.Timer, start: (Long, Long))Unit">stopTimer</a><span class="delimiter">(</span><a href="#539239" title="=&gt; scala.reflect.internal.util.Statistics.Timer">macroExpandNanos</a>, <a href="#1054308" title="(Long, Long)">start</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Does the same as `macroExpand`, but without typechecking the expansion
   *  Meant for internal use within the macro infrastructure, don't use it elsewhere.
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.MacroExpansionResult" id="538372">macroExpand1</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1052236">typer</a>: <a href="Typers.scala.html#538117" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1052237">expandee</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="#538357" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a> =
    // verbose printing might cause recursive macro expansions, so I'm shutting it down here
    <a href="../Global.scala.html#537480" title="(infolevel: Macros.this.global.nodePrinters.InfoLevel.Value)(op: =&gt; Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult">withInfoLevel</a><span class="delimiter">(</span><a href="../Global.scala.html#537478" title="Macros.this.global.nodePrinters.type">nodePrinters</a>.<a href="../ast/NodePrinters.scala.html#545463" title="Macros.this.global.nodePrinters.InfoLevel.type">InfoLevel</a>.<a href="../ast/NodePrinters.scala.html#619597" title="=&gt; Macros.this.global.nodePrinters.InfoLevel.Value">Quiet</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1052237" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411249" title="=&gt; Boolean">isErroneous</a> <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#1052237" title="Macros.this.global.Tree">expandee</a> <a href="../../../reflect/internal/Trees.scala.html#408545" title="(p: Macros.this.global.Tree =&gt; Boolean)Boolean">exists</a> <span class="delimiter">(</span><a href="#1054362" title="Macros.this.global.Tree">_</a>.<a href="../../../reflect/internal/Trees.scala.html#408559" title="=&gt; Boolean">isErroneous</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="String" id="1054363">reason</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1052237" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411249" title="=&gt; Boolean">isErroneous</a><span class="delimiter">)</span> <span title="String(&quot;not found or incompatible macro implementation&quot;)" class="string">&quot;not found or incompatible macro implementation&quot;</span> <span class="keyword">else</span> <span title="String(&quot;erroneous arguments&quot;)" class="string">&quot;erroneous arguments&quot;</span>
        <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: Macros.this.global.Tree)Macros.this.global.Tree">macroTraceVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;cancelled macro expansion because of %s: &quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#59882" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1054363" title="String">reason</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1052237" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <a href="#538369" title="(expandee: Macros.this.global.Tree)Macros.this.Other">Cancel</a><span class="delimiter">(</span><a href="#1052236" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538550" title="=&gt; Macros.this.Inferencer">infer</a>.<a href="Infer.scala.html#541356" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">setError</a><span class="delimiter">(</span><a href="#1052237" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#3366507" title="Macros.this.MacroExpansionResult" id="3366502" class="keyword">try</a> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Macros.this.MacroArgs =&gt; Any" id="1054379">runtime</a> = <a href="#538344" title="(macroDef: Macros.this.global.Symbol)Macros.this.MacroArgs =&gt; Any">macroRuntime</a><span class="delimiter">(</span><a href="#1052237" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a><span class="delimiter">)</span>
        <span title="Macros.this.MacroExpansionResult" class="keyword">if</span> <span class="delimiter">(</span><a href="#1054379" title="Macros.this.MacroArgs =&gt; Any">runtime</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#538373" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, runtime: Macros.this.MacroArgs =&gt; Any)Macros.this.MacroExpansionResult">macroExpandWithRuntime</a><span class="delimiter">(</span><a href="#1052236" title="Macros.this.Typer">typer</a>, <a href="#1052237" title="Macros.this.global.Tree">expandee</a>, <a href="#1054379" title="Macros.this.MacroArgs =&gt; Any">runtime</a><span class="delimiter">)</span>
        <span class="keyword">else</span> <a href="#538374" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.MacroExpansionResult">macroExpandWithoutRuntime</a><span class="delimiter">(</span><a href="#1052236" title="Macros.this.Typer">typer</a>, <a href="#1052237" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#1052236" title="Macros.this.Typer">typer</a>.<a href="ContextErrors.scala.html#538736" title="typer.TyperErrorGen.type">TyperErrorGen</a>.<a href="ContextErrors.scala.html#541337" title="Macros.this.MacroExpansionResult" id="3366504">MacroExpansionException</a> =&gt; <a href="#538370" title="(expandee: Macros.this.global.Tree)Macros.this.Other">Failure</a><a href="#3366507" title="(x: Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult" class="delimiter">(</a><a href="#1052237" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  /** Expands a macro when a runtime (i.e. the macro implementation) can be successfully loaded
   *  Meant for internal use within the macro infrastructure, don't use it elsewhere.
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, runtime: Macros.this.MacroArgs =&gt; Any)Macros.this.MacroExpansionResult" id="538373">macroExpandWithRuntime</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1054384">typer</a>: <a href="Typers.scala.html#538117" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1054385">expandee</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a>, <a title="Macros.this.MacroArgs =&gt; Any" id="1054386">runtime</a>: <a href="../../../Function1.scala.html#777" title="Macros.this.MacroArgs =&gt; Any">MacroRuntime</a><span class="delimiter">)</span>: <a href="#538357" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Boolean" id="1054393">wasDelayed</a>  = <a href="#538380" title="(expandee: Macros.this.global.Tree)Boolean">isDelayed</a><span class="delimiter">(</span><a href="#1054385" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.Set[Int]" id="1054394">undetparams</a> = <a href="#538381" title="(expandee: Macros.this.global.Tree)scala.collection.mutable.Set[Int]">calculateUndetparams</a><span class="delimiter">(</span><a href="#1054385" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Boolean" id="1054395">nowDelayed</a>  = <a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1054384" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538560" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#538803" title="=&gt; Boolean">macrosEnabled</a> <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="#1054394" title="scala.collection.mutable.Set[Int]">undetparams</a>.<a href="../../../collection/TraversableOnce.scala.html#58191" title="=&gt; Boolean">nonEmpty</a>

    <a href="../../../Tuple2.scala.html#62849" title="(_1: Boolean, _2: Boolean)(Boolean, Boolean)" class="delimiter">(</a><a href="#1054393" title="Boolean">wasDelayed</a>, <a href="#1054395" title="Boolean">nowDelayed</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span class="delimiter">(</span><a href="../../../Tuple2.scala.html#60635" title="Boolean" id="3366563" class="keyword">true</a>, <a href="../../../Tuple2.scala.html#60637" title="Boolean" id="3366564" class="keyword">true</a><span class="delimiter">)</span> =&gt; <a href="#538367" title="(expanded: Macros.this.global.Tree)Macros.this.Other">Delay</a><a href="#3366572" title="(x: Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult" class="delimiter">(</a><a href="#1054385" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span class="delimiter">(</span><a href="../../../Tuple2.scala.html#60635" title="Boolean" id="3366565" class="keyword">true</a>, <a href="../../../Tuple2.scala.html#60637" title="Boolean" id="3366566" class="keyword">false</a><span class="delimiter">)</span> =&gt; <a href="#538368" title="(expanded: Macros.this.global.Tree)Macros.this.Other">Skip</a><a href="#3366572" title="(x: Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult" class="delimiter">(</a><a href="#538386" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.global.Tree">macroExpandAll</a><span class="delimiter">(</span><a href="#1054384" title="Macros.this.Typer">typer</a>, <a href="#1054385" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span class="delimiter">(</span><a href="../../../Tuple2.scala.html#60635" title="Boolean" id="3366567" class="keyword">false</a>, <a href="../../../Tuple2.scala.html#60637" title="Boolean" id="3366568" class="keyword">true</a><span class="delimiter">)</span> =&gt;
        <a href="../../../reflect/macros/util/Traces.scala.html#537424" title="(msg: =&gt; Any)Unit">macroLogLite</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;macro expansion is delayed: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#59882" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1054385" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#538378" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]">delayed</a> <a href="../../../collection/convert/Wrappers.scala.html#149120" title="(kv: (Macros.this.global.Tree, scala.collection.mutable.Set[Int]))Macros.this.delayed.type">+=</a> <a href="../../../Predef.scala.html#7509" title="(x: Macros.this.global.Tree)ArrowAssoc[Macros.this.global.Tree]">expandee</a> <a href="../../../Predef.scala.html#62634" title="(y: scala.collection.mutable.Set[Int])(Macros.this.global.Tree, scala.collection.mutable.Set[Int])">-&gt;</a> <a href="#1054394" title="scala.collection.mutable.Set[Int]">undetparams</a>
        <a href="#1054385" title="Macros.this.global.Tree">expandee</a> <a href="../../../reflect/internal/StdAttachments.scala.html#409596" title="(attachment: Macros.this.MacroRuntimeAttachment)(implicit evidence$1: scala.reflect.ClassTag[Macros.this.MacroRuntimeAttachment])expandee.type">updateAttachment</a> <a href="StdAttachments.scala.html#1054454" title="(delayed: Boolean, typerContext: Macros.this.Context, macroContext: Option[Macros.this.MacroContext])Macros.this.MacroRuntimeAttachment">MacroRuntimeAttachment</a><span class="delimiter">(</span>delayed = <span title="Boolean(true)" class="keyword">true</span>, typerContext = <a href="#1054384" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538560" title="=&gt; Macros.this.Context">context</a>, macroContext = <a href="../../../Option.scala.html#63128" title="(x: Macros.this.MacroContext)Some[Macros.this.MacroContext]">Some</a><span class="delimiter">(</span><a href="#538349" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.MacroArgs">macroArgs</a><span class="delimiter">(</span><a href="#1054384" title="Macros.this.Typer">typer</a>, <a href="#1054385" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>.<a href="#1054156" title="=&gt; Macros.this.MacroContext">c</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#538367" title="(expanded: Macros.this.global.Tree)Macros.this.Other">Delay</a><span class="delimiter">(</span><a href="#1054385" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span class="delimiter">(</span><a href="../../../Tuple2.scala.html#60635" title="Boolean" id="3366569" class="keyword">false</a>, <a href="../../../Tuple2.scala.html#60637" title="Boolean" id="3366570" class="keyword">false</a><span class="delimiter">)</span> =&gt;
        <span class="keyword">import</span> <a href="#1054384" title="Macros.this.Typer">typer</a>.<a href="ContextErrors.scala.html#538736" title="typer.TyperErrorGen.type">TyperErrorGen</a>._
        <a href="../../../reflect/macros/util/Traces.scala.html#537424" title="(msg: =&gt; Any)Unit">macroLogLite</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;performing macro expansion %s at %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#59882" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1054385" title="Macros.this.global.Tree">expandee</a>, <a href="#1054385" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; Macros.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Macros.this.MacroArgs" id="1054481">args</a> = <a href="#538349" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.MacroArgs">macroArgs</a><span class="delimiter">(</span><a href="#1054384" title="Macros.this.Typer">typer</a>, <a href="#1054385" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
        <span class="keyword">try</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Int" id="1054485">numErrors</a>    = <a href="../Global.scala.html#537436" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../reporters/Reporter.scala.html#539660" title="=&gt; scala.tools.nsc.reporters.Reporter#Severity">ERROR</a>.<a href="../reporters/Reporter.scala.html#539709" title="=&gt; Int">count</a>
          <span class="keyword">def</span> <a title="=&gt; Boolean" id="1054486">hasNewErrors</a> = <a href="../Global.scala.html#537436" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../reporters/Reporter.scala.html#539660" title="=&gt; scala.tools.nsc.reporters.Reporter#Severity">ERROR</a>.<a href="../reporters/Reporter.scala.html#539709" title="=&gt; Int">count</a> <a href="../../../Int.scala.html#57125" title="(x: Int)Boolean">&gt;</a> <a href="#1054485" title="Int">numErrors</a>
          <span class="keyword">val</span> <a title="Any" id="1054487">expanded</a> = <span class="delimiter">{</span> <a href="#538354" title="(c: Macros.this.MacroContext)Unit">pushMacroContext</a><span class="delimiter">(</span><a href="#1054481" title="Macros.this.MacroArgs">args</a>.<a href="#1054156" title="=&gt; Macros.this.MacroContext">c</a><span class="delimiter">)</span>; <a href="../../../Function1.scala.html#58642" title="(v1: Macros.this.MacroArgs)Any">runtime</a><span class="delimiter">(</span><a href="#1054481" title="Macros.this.MacroArgs">args</a><span class="delimiter">)</span> <span class="delimiter">}</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1054486" title="=&gt; Boolean">hasNewErrors</a><span class="delimiter">)</span> <a href="ContextErrors.scala.html#541342" title="(expandee: Macros.this.global.Tree, err: Macros.this.global.TypeError)Nothing">MacroGeneratedTypeError</a><span class="delimiter">(</span><a href="#1054385" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
          <a href="#1054487" title="Any">expanded</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="../../../Boolean.scala.html#57826" title="Macros.this.MacroExpansionResult" id="3366517">expanded</a>: Expr<span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt;
              <a href="../../../reflect/macros/util/Traces.scala.html#537425" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><span title="String(&quot;original:&quot;)" class="string">&quot;original:&quot;</span><span class="delimiter">)</span>
              <a href="../../../reflect/macros/util/Traces.scala.html#537424" title="(msg: =&gt; Any)Unit">macroLogLite</a><span class="delimiter">(</span><span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> <span title="(x$1: Any)String">+</span> expanded.<a href="../../../reflect/api/Exprs.scala.html#402726" title="=&gt; Macros.this.global.Tree">tree</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../../reflect/api/Printers.scala.html#56608" title="(any: Any, printTypes: Macros.this.global.BooleanFlag, printIds: Macros.this.global.BooleanFlag, printKinds: Macros.this.global.BooleanFlag, printMirrors: Macros.this.global.BooleanFlag)String">showRaw</a><span class="delimiter">(</span>expanded.<a href="../../../reflect/api/Exprs.scala.html#402726" title="=&gt; Macros.this.global.Tree">tree</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">val</span> <a title="List[Macros.this.global.FreeSymbol{def name: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; def rawname: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol{def name: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def rawname: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol{type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}}]" id="1054503">freeSyms</a> = expanded.<a href="../../../reflect/api/Exprs.scala.html#402726" title="=&gt; Macros.this.global.Tree">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#408550" title="=&gt; List[Macros.this.global.FreeTermSymbol]">freeTerms</a> <a href="../../../collection/immutable/List.scala.html#62697" title="(that: scala.collection.GenTraversableOnce[Macros.this.global.FreeSymbol{def name: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; def rawname: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol{def name: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def rawname: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol{type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}}])(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.FreeTermSymbol],Macros.this.global.FreeSymbol{def name: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; def rawname: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol{def name: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def rawname: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol{type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}},List[Macros.this.global.FreeSymbol{def name: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; def rawname: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol{def name: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def rawname: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol{type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}}]])List[Macros.this.global.FreeSymbol{def name: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; def rawname: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol{def name: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def rawname: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol{type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}}]">++</a> expanded.<a href="../../../reflect/api/Exprs.scala.html#402726" title="=&gt; Macros.this.global.Tree">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#408551" title="=&gt; List[Macros.this.global.FreeTypeSymbol]">freeTypes</a>
              <a href="#1054503" title="List[Macros.this.global.FreeSymbol{def name: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; def rawname: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol{def name: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def rawname: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol{type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}}]">freeSyms</a> <a href="../../../collection/immutable/List.scala.html#62719" title="(f: Macros.this.global.FreeSymbol{def name: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; def rawname: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol{def name: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def rawname: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol{type TypeOfClonedSymbol &gt;: Macros.this.global.TermSymbol with Macros.this.global.TypeSkolem &lt;: Macros.this.global.Symbol; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}; type NameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{def newName(str: String): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def subName(from: Int,to: Int): Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; def companionName: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TypeName with Macros.this.global.TermName &lt;: Macros.this.global.Name}; def next: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}; type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name{type ThisNameType &gt;: Macros.this.global.TermName with Macros.this.global.TypeName &lt;: Macros.this.global.Name}}} =&gt; Nothing)Unit">foreach</a> <span class="delimiter">(</span><a title="Macros extends Macros.this.global.FreeSymbol" id="1056546">sym</a> =&gt; <a href="ContextErrors.scala.html#541344" title="(expandee: Macros.this.global.Tree, sym: Macros.this.global.FreeSymbol)Nothing">MacroFreeSymbolError</a><span class="delimiter">(</span><a href="#1054385" title="Macros.this.global.Tree">expandee</a>, <a href="#1056546" title="Macros extends Macros.this.global.FreeSymbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <a href="#1057221" title="(expanded: Macros.this.global.Tree)Macros.this.Success">Success</a><span class="delimiter">(</span><a href="../../../reflect/internal/Positions.scala.html#408315" title="(pos: Macros.this.global.Position)(tree: Macros.this.global.Tree)Macros.this.global.Tree">atPos</a><span class="delimiter">(</span><a href="#538356" title="=&gt; scala.reflect.internal.util.Position">enclosingMacroPosition</a>.<a href="../../../reflect/internal/util/Position.scala.html#409684" title="=&gt; scala.reflect.internal.util.Position">focus</a><span class="delimiter">)</span><span class="delimiter">(</span>expanded.<a href="../../../reflect/api/Exprs.scala.html#402726" title="=&gt; Macros.this.global.Tree">tree</a> <a href="../../../reflect/internal/StdAttachments.scala.html#409596" title="(attachment: Macros.this.global.MacroExpansionAttachment)(implicit evidence$1: scala.reflect.ClassTag[Macros.this.global.MacroExpansionAttachment])Macros.this.global.Tree">updateAttachment</a> <a href="../../../reflect/internal/StdAttachments.scala.html#464864" title="(original: Macros.this.global.Tree)Macros.this.global.MacroExpansionAttachment">MacroExpansionAttachment</a><span class="delimiter">(</span><a href="#1054385" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">case</span> _ =&gt;
              <a href="ContextErrors.scala.html#541345" title="(expandee: Macros.this.global.Tree, expanded: Any)Nothing">MacroExpansionIsNotExprError</a><a href="#3366519" title="(x: Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult" class="delimiter">(</a><a href="#1054385" title="Macros.this.global.Tree">expandee</a>, <a href="#1054487" title="Any">expanded</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="Macros.this.MacroExpansionResult" id="1056661">ex</a>: <span title="Throwable">Throwable</span> =&gt;
            <a href="#538355" title="()Unit">popMacroContext</a><span class="delimiter">(</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="Throwable" id="1056662">realex</a> = <a href="../../../reflect/runtime/ReflectionUtils.scala.html#24795" title="scala.reflect.runtime.ReflectionUtils.type">ReflectionUtils</a>.<a href="../../../reflect/runtime/ReflectionUtils.scala.html#403158" title="(x: Throwable)Throwable">unwrapThrowable</a><span class="delimiter">(</span><a href="#1056661" title="Throwable">ex</a><span class="delimiter">)</span>
            <a href="#1056662" title="Throwable">realex</a> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a href="#3366524" title="Macros.this.MacroExpansionResult" id="3366527">ex</a>: AbortMacroException =&gt; <a href="ContextErrors.scala.html#541341" title="(expandee: Macros.this.global.Tree, ex: scala.reflect.macros.runtime.AbortMacroException)Nothing">MacroGeneratedAbort</a><a href="#3366531" title="(x: Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult" class="delimiter">(</a><a href="#1054385" title="Macros.this.global.Tree">expandee</a>, ex<span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="#3366524" title="Macros.this.MacroExpansionResult" id="3366528">ex</a>: ControlThrowable =&gt; <a href="#3366531" title="(x: Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult" class="keyword">throw</a> ex
              <span class="keyword">case</span> <a href="../../../Boolean.scala.html#57826" title="Macros.this.MacroExpansionResult" id="3366529">ex</a>: TypeError =&gt; <a href="ContextErrors.scala.html#541342" title="(expandee: Macros.this.global.Tree, err: Macros.this.global.TypeError)Nothing">MacroGeneratedTypeError</a><a href="#3366531" title="(x: Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult" class="delimiter">(</a><a href="#1054385" title="Macros.this.global.Tree">expandee</a>, ex<span class="delimiter">)</span>
              <span class="keyword">case</span> _ =&gt; <a href="ContextErrors.scala.html#541343" title="(expandee: Macros.this.global.Tree, ex: Throwable)Nothing">MacroGeneratedException</a><a href="#3366531" title="(x: Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult" class="delimiter">(</a><a href="#1054385" title="Macros.this.global.Tree">expandee</a>, <a href="#1056662" title="Throwable">realex</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
          <a href="#1054385" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/internal/StdAttachments.scala.html#409599" title="[T](implicit evidence$2: scala.reflect.ClassTag[T])expandee.type">removeAttachment</a><a href="../../../reflect/ClassTag.scala.html#81051" title="(implicit evidence$2: scala.reflect.ClassTag[Macros.this.MacroRuntimeAttachment])expandee.type" class="delimiter">[</a><a href="StdAttachments.scala.html#538513" title="Macros.this.MacroRuntimeAttachment">MacroRuntimeAttachment</a><span class="delimiter">]</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Expands a macro when a runtime (i.e. the macro implementation) cannot be loaded
   *  Meant for internal use within the macro infrastructure, don't use it elsewhere.
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.MacroExpansionResult" id="538374">macroExpandWithoutRuntime</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1054388">typer</a>: <a href="Typers.scala.html#538117" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1054389">expandee</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="#538357" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a> = <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#1054388" title="Macros.this.Typer">typer</a>.<a href="ContextErrors.scala.html#538736" title="typer.TyperErrorGen.type">TyperErrorGen</a>._
    <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1056674">fallbackSym</a> = <a href="#1054389" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411466" title="=&gt; Macros.this.global.Symbol">nextOverriddenSymbol</a> <a href="../../../reflect/internal/Symbols.scala.html#411489" title="(alt: =&gt; Macros.this.global.Symbol)Macros.this.global.Symbol">orElse</a> <a href="ContextErrors.scala.html#541346" title="(expandee: Macros.this.global.Tree)Nothing">MacroImplementationNotFoundError</a><span class="delimiter">(</span><a href="#1054389" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
    <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: Macros.this.global.Symbol)Macros.this.global.Symbol">macroTraceLite</a><span class="delimiter">(</span><span title="String(&quot;falling back to: &quot;)" class="string">&quot;falling back to: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1056674" title="Macros.this.global.Symbol">fallbackSym</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Macros.this.global.Tree" id="1056675">mkFallbackTree</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1056687">tree</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <a href="#1056687" title="Macros.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Select<a href="#3366603" title="Macros.this.global.Tree" id="3366605" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#409999" title="Macros.this.global.Tree" id="1056692">qual</a>, <a href="../../../reflect/internal/Trees.scala.html#410001" title="Macros.this.global.Name" id="1056693">name</a><span class="delimiter">)</span> =&gt; <a href="../../../reflect/internal/Trees.scala.html#418089" title="(qualifier: Macros.this.global.Tree, name: Macros.this.global.Name)Macros.this.global.Select">Select</a><span class="delimiter">(</span><a href="#1056692" title="Macros.this.global.Tree">qual</a>, <a href="#1056693" title="Macros.this.global.Name">name</a><span class="delimiter">)</span> <a href="../../../reflect/internal/StdAttachments.scala.html#409604" title="(newpos: scala.reflect.internal.util.Position)Macros.this.global.Select">setPos</a> <a href="#1056687" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; Macros.this.global.Position">pos</a> <a href="#3366611" title="(x: Macros.this.global.Tree)Macros.this.global.Tree">setSymbol</a> <a href="#1056674" title="Macros.this.global.Symbol">fallbackSym</a>
        <span class="keyword">case</span> Apply<a href="#3366603" title="Macros.this.global.Tree" id="3366607" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410031" title="Macros.this.global.Tree" id="1056731">fn</a>, <a href="../../../reflect/internal/Trees.scala.html#410033" title="List[Macros.this.global.Tree]" id="1056732">args</a><span class="delimiter">)</span> =&gt; <a href="../../../reflect/internal/Trees.scala.html#413581" title="(fun: Macros.this.global.Tree, args: List[Macros.this.global.Tree])Macros.this.global.Apply">Apply</a><span class="delimiter">(</span><a href="#1056675" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">mkFallbackTree</a><span class="delimiter">(</span><a href="#1056731" title="Macros.this.global.Tree">fn</a><span class="delimiter">)</span>, <a href="#1056732" title="List[Macros.this.global.Tree]">args</a><span class="delimiter">)</span> <a href="#3366611" title="(x: Macros.this.global.Tree)Macros.this.global.Tree">setPos</a> <a href="#1056687" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; Macros.this.global.Position">pos</a>
        <span class="keyword">case</span> TypeApply<a href="#3366603" title="Macros.this.global.Tree" id="3366609" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410043" title="Macros.this.global.Tree" id="1056758">fn</a>, <a href="../../../reflect/internal/Trees.scala.html#410045" title="List[Macros.this.global.Tree]" id="1056759">args</a><span class="delimiter">)</span> =&gt; <a href="../../../reflect/internal/Trees.scala.html#453869" title="(fun: Macros.this.global.Tree, args: List[Macros.this.global.Tree])Macros.this.global.TypeApply">TypeApply</a><span class="delimiter">(</span><a href="#1056675" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">mkFallbackTree</a><span class="delimiter">(</span><a href="#1056758" title="Macros.this.global.Tree">fn</a><span class="delimiter">)</span>, <a href="#1056759" title="List[Macros.this.global.Tree]">args</a><span class="delimiter">)</span> <a href="#3366611" title="(x: Macros.this.global.Tree)Macros.this.global.Tree">setPos</a> <a href="#1056687" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; Macros.this.global.Position">pos</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#1057225" title="(fallback: Macros.this.global.Tree)Macros.this.Fallback">Fallback</a><span class="delimiter">(</span><a href="#1056675" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">mkFallbackTree</a><span class="delimiter">(</span><a href="#1054389" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** Without any restrictions on macro expansion, macro applications will expand at will,
   *  and when type inference is involved, expansions will end up using yet uninferred type params.
   *
   *  For some macros this might be ok (thanks to TreeTypeSubstituter that replaces
   *  the occurrences of undetparams with their inferred values), but in general case this won't work.
   *  E.g. for reification simple substitution is not enough - we actually need to re-reify inferred types.
   *
   *  Luckily, there exists a very simple way to fix the problem: delay macro expansion until everything is inferred.
   *  Here are the exact rules. Macro application gets delayed if any of its subtrees contain:
   *    1) type vars (tpe.isInstanceOf[TypeVar]) // [Eugene] this check is disabled right now, because TypeVars seem to be created from undetparams anyways
   *    2) undetparams (sym.isTypeParameter &amp;&amp; !sym.isSkolem)
   */
  <span class="keyword">var</span> <a title="Boolean" id="538376">hasPendingMacroExpansions</a> = <span title="Boolean(false)" class="keyword">false</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]" id="538378">delayed</a> = <a href="../../../reflect/internal/SymbolTable.scala.html#406696" title="Macros.this.global.perRunCaches.type">perRunCaches</a>.<a href="../../../reflect/internal/SymbolTable.scala.html#471982" title="[K, V]()scala.collection.mutable.WeakHashMap[K,V]">newWeakMap</a><span title="()scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]" class="delimiter">[</span><a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a>, scala.collection.mutable.<a href="../../../collection/mutable/Set.scala.html#13128" title="scala.collection.mutable.Set[Int]">Set</a><span class="delimiter">[</span>Int<span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expandee: Macros.this.global.Tree)Boolean" id="538380">isDelayed</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1054396">expandee</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#538378" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]">delayed</a> <a href="../../../collection/MapLike.scala.html#87536" title="(key: Macros.this.global.Tree)Boolean">contains</a> <a href="#1054396" title="Macros.this.global.Tree">expandee</a>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expandee: Macros.this.global.Tree)scala.collection.mutable.Set[Int]" id="538381">calculateUndetparams</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1054401">expandee</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: scala.collection.mutable.<a href="../../../collection/mutable/Set.scala.html#13128" title="scala.collection.mutable.Set[Int]">Set</a><span class="delimiter">[</span>Int<span class="delimiter">]</span> =
    <a href="#538378" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]">delayed</a>.<a href="../../../collection/convert/Wrappers.scala.html#149119" title="(k: Macros.this.global.Tree)Option[scala.collection.mutable.Set[Int]]">get</a><span class="delimiter">(</span><a href="#1054401" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>.<a href="../../../Option.scala.html#62859" title="(default: =&gt; scala.collection.mutable.Set[Int])scala.collection.mutable.Set[Int]">getOrElse</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.Set[Macros.this.global.Symbol]" id="1056781">calculated</a> = scala.collection.mutable.<a href="../../../collection/generic/GenericCompanion.scala.html#59933" title="[A](elems: A*)scala.collection.mutable.Set[A]">Set</a><span title="(elems: Macros.this.global.Symbol*)scala.collection.mutable.Set[Macros.this.global.Symbol]" class="delimiter">[</span><a href="../../../reflect/internal/Symbols.scala.html#407146" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#1054401" title="Macros.this.global.Tree">expandee</a> <a href="../../../reflect/internal/Trees.scala.html#408538" title="(f: Macros.this.global.Tree =&gt; Unit)Unit">foreach</a> <span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1056786">sub</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="(sym: Macros.this.global.Symbol)Any" id="1056787">traverse</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1056788">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1056788" title="Macros.this.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#538382" title="=&gt; scala.collection.mutable.HashSet[Int]">undetparams</a> <a href="../../../collection/mutable/HashSet.scala.html#125962" title="(elem: Int)Boolean">contains</a> <a href="#1056788" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411094" title="=&gt; Int">id</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#1056781" title="scala.collection.mutable.Set[Macros.this.global.Symbol]">calculated</a> <a href="../../../collection/mutable/SetLike.scala.html#90897" title="(elem: Macros.this.global.Symbol)calculated.type">+=</a> <a href="#1056788" title="Macros.this.global.Symbol">sym</a>
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1056786" title="Macros.this.global.Tree">sub</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#1056787" title="(sym: Macros.this.global.Symbol)Any">traverse</a><span class="delimiter">(</span><a href="#1056786" title="Macros.this.global.Tree">sub</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Macros.this.global.Symbol">symbol</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1056786" title="Macros.this.global.Tree">sub</a>.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; Macros.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#1056786" title="Macros.this.global.Tree">sub</a>.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; Macros.this.global.Type">tpe</a> <a href="../../../reflect/internal/Types.scala.html#408473" title="(f: Macros.this.global.Type =&gt; Unit)Unit">foreach</a> <span class="delimiter">(</span><a title="Macros.this.global.Type" id="1056824">sub</a> =&gt; <a href="#1056787" title="(sym: Macros.this.global.Symbol)Any">traverse</a><span title="Unit" class="delimiter">(</span><a href="#1056824" title="Macros.this.global.Type">sub</a>.<a href="../../../reflect/internal/Types.scala.html#408407" title="=&gt; Macros.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      <a href="../../../reflect/macros/util/Traces.scala.html#537425" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;calculateUndetparams: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#59882" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1056781" title="scala.collection.mutable.Set[Macros.this.global.Symbol]">calculated</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#1056781" title="scala.collection.mutable.Set[Macros.this.global.Symbol]">calculated</a> <a href="../../../collection/SetLike.scala.html#66437" title="(f: Macros.this.global.Symbol =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Set[Macros.this.global.Symbol],Int,scala.collection.mutable.Set[Int]])scala.collection.mutable.Set[Int]">map</a> <span class="delimiter">(</span><a href="#1056848" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#411094" title="=&gt; Int">id</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashSet[Int]" id="538382">undetparams</a> = <a href="../../../reflect/internal/SymbolTable.scala.html#406696" title="Macros.this.global.perRunCaches.type">perRunCaches</a>.<a href="../../../reflect/internal/SymbolTable.scala.html#471992" title="[K]()scala.collection.mutable.HashSet[K]">newSet</a><span title="()scala.collection.mutable.HashSet[Int]" class="delimiter">[</span><a href="../../../Int.scala.html#321" title="Int">Int</a><span class="delimiter">]</span>
  <span class="keyword">def</span> <a title="(newUndets: List[Macros.this.global.Symbol])Unit" id="538384">notifyUndetparamsAdded</a><span class="delimiter">(</span><a title="List[Macros.this.global.Symbol]" id="1056875">newUndets</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[Macros.this.global.Symbol]">List</a><span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#1515" title="Unit">Unit</a> = <span class="delimiter">{</span>
    <a href="#538382" title="=&gt; scala.collection.mutable.HashSet[Int]">undetparams</a> <a href="../../../collection/generic/Growable.scala.html#60003" title="(xs: scala.collection.TraversableOnce[Int])Macros.this.undetparams.type">++=</a> <a href="#1056875" title="List[Macros.this.global.Symbol]">newUndets</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Macros.this.global.Symbol =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Int,scala.collection.TraversableOnce[Int]])scala.collection.TraversableOnce[Int]">map</a> <span class="delimiter">(</span><a href="#1056894" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#411094" title="=&gt; Int">id</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/macros/util/Traces.scala.html#537418" title="=&gt; Boolean">macroDebugVerbose</a><span class="delimiter">)</span> <a href="#1056875" title="List[Macros.this.global.Symbol]">newUndets</a> <a href="../../../collection/immutable/List.scala.html#62719" title="(f: Macros.this.global.Symbol =&gt; Unit)Unit">foreach</a> <span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1056943">sym</a> =&gt; <a href="../../../Predef.scala.html#7514" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;undetParam added: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#59882" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1056943" title="Macros.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(undetNoMore: List[Macros.this.global.Symbol], inferreds: List[Macros.this.global.Type])Unit" id="538385">notifyUndetparamsInferred</a><span class="delimiter">(</span><a title="List[Macros.this.global.Symbol]" id="1041251">undetNoMore</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[Macros.this.global.Symbol]">List</a><span class="delimiter">[</span>Symbol<span class="delimiter">]</span>, <a title="List[Macros.this.global.Type]" id="1041252">inferreds</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[Macros.this.global.Type]">List</a><span class="delimiter">[</span>Type<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#1515" title="Unit">Unit</a> = <span class="delimiter">{</span>
    <a href="#538382" title="=&gt; scala.collection.mutable.HashSet[Int]">undetparams</a> <a href="../../../collection/generic/Shrinkable.scala.html#66942" title="(xs: scala.collection.TraversableOnce[Int])Macros.this.undetparams.type">--=</a> <a href="#1041251" title="List[Macros.this.global.Symbol]">undetNoMore</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Macros.this.global.Symbol =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Int,scala.collection.TraversableOnce[Int]])scala.collection.TraversableOnce[Int]">map</a> <span class="delimiter">(</span><a href="#1056967" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#411094" title="=&gt; Int">id</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/macros/util/Traces.scala.html#537418" title="=&gt; Boolean">macroDebugVerbose</a><span class="delimiter">)</span> <span class="delimiter">(</span><a href="#1041251" title="List[Macros.this.global.Symbol]">undetNoMore</a> <a href="../../../collection/IterableLike.scala.html#58590" title="(that: scala.collection.GenIterable[Macros.this.global.Type])(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],(Macros.this.global.Symbol, Macros.this.global.Type),List[(Macros.this.global.Symbol, Macros.this.global.Type)]])List[(Macros.this.global.Symbol, Macros.this.global.Type)]">zip</a> <a href="#1041252" title="List[Macros.this.global.Type]">inferreds</a><span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#62719" title="(f: ((Macros.this.global.Symbol, Macros.this.global.Type)) =&gt; Unit)Unit">foreach</a> <a href="#1057066" title="(Macros.this.global.Symbol, Macros.this.global.Type)" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span><a href="../../../Tuple2.scala.html#60635" title="Macros.this.global.Symbol" id="1057069">sym</a>, <a href="../../../Tuple2.scala.html#60637" title="Macros.this.global.Type" id="1057070">tpe</a><span class="delimiter">)</span> =&gt; <a href="../../../Predef.scala.html#7514" title="(x: Any)Unit">println</a><a href="#3366619" title="(x: Unit)Unit" class="delimiter">(</a><a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;undetParam inferred: %s as %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#59882" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1057069" title="Macros.this.global.Symbol">sym</a>, <a href="#1057070" title="Macros.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">}</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#538378" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]">delayed</a>.<a href="../../../collection/MapLike.scala.html#87531" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span>
      <a href="#538378" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]">delayed</a>.<a href="../../../collection/TraversableOnce.scala.html#58263" title="=&gt; List[(Macros.this.global.Tree, scala.collection.mutable.Set[Int])]">toList</a> <a href="../../../collection/immutable/List.scala.html#62719" title="(f: ((Macros.this.global.Tree, scala.collection.mutable.Set[Int])) =&gt; Any)Unit">foreach</a> <a href="#1057099" title="(Macros.this.global.Tree, scala.collection.mutable.Set[Int])" class="delimiter">{</a>
        <span class="keyword">case</span> <span class="delimiter">(</span><a href="../../../Tuple2.scala.html#60635" title="Macros.this.global.Tree" id="1057102">expandee</a>, <a href="../../../Tuple2.scala.html#60637" title="scala.collection.mutable.Set[Int]" id="1057103">undetparams</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1057103" title="scala.collection.mutable.Set[Int]">undetparams</a>.<a href="../../../collection/SetLike.scala.html#66447" title="=&gt; Boolean">isEmpty</a> =&gt;
          <a href="#1057103" title="scala.collection.mutable.Set[Int]">undetparams</a> <a href="../../../collection/generic/Shrinkable.scala.html#66942" title="(xs: scala.collection.TraversableOnce[Int])undetparams.type">--=</a> <a href="#1041251" title="List[Macros.this.global.Symbol]">undetNoMore</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Macros.this.global.Symbol =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Int,scala.collection.TraversableOnce[Int]])scala.collection.TraversableOnce[Int]">map</a> <span class="delimiter">(</span><a href="#1057115" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#411094" title="=&gt; Int">id</a><span class="delimiter">)</span>
          <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1057103" title="scala.collection.mutable.Set[Int]">undetparams</a>.<a href="../../../collection/SetLike.scala.html#66447" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#538376" title="(x$1: Boolean)Unit">hasPendingMacroExpansions</a> = <span title="Boolean(true)" class="keyword">true</span>
            <a href="../util/SimpleTracer.scala.html#541835" title="(msg: String)(value: Macros.this.global.Tree)Macros.this.global.Tree">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;macro expansion is pending: &quot;)" class="string">&quot;macro expansion is pending: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1057102" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="keyword">case</span> _ =&gt;
          // do nothing
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Performs macro expansion on all subtrees of a given tree.
   *  Innermost macros are expanded first, outermost macros are expanded last.
   *  See the documentation for `macroExpand` for more information.
   */
  <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.global.Tree" id="538386">macroExpandAll</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1054413">typer</a>: <a href="Typers.scala.html#538117" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1054414">expandee</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a> =
    <a href="#1057156" title="Macros.this.global.Transformer" class="keyword">new</a> <a href="../ast/Trees.scala.html#537817" title="anonymous class $anon extends Macros.this.global.Transformer" id="1057156">Transformer</a> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Macros.this.global.Tree" id="1057158">transform</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1057159">tree</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#1057156" title="Macros.this.global.Transformer" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#405652" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1057159" title="Macros.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        // todo. expansion should work from the inside out
        <span class="keyword">case</span> tree <span class="keyword">if</span> <span class="delimiter">(</span><a href="#538378" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]">delayed</a> <a href="../../../collection/MapLike.scala.html#87536" title="(key: Macros.this.global.Tree)Boolean">contains</a> tree<span class="delimiter">)</span> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#538381" title="(expandee: Macros.this.global.Tree)scala.collection.mutable.Set[Int]">calculateUndetparams</a><span class="delimiter">(</span>tree<span class="delimiter">)</span>.<a href="../../../collection/SetLike.scala.html#66447" title="=&gt; Boolean">isEmpty</a> =&gt;
          <span class="keyword">val</span> <a title="Macros.this.Context" id="1057164">context</a> = tree.<a href="../../../reflect/internal/StdAttachments.scala.html#409595" title="=&gt; scala.reflect.macros.Attachments{type Pos = Macros.this.global.Position}">attachments</a>.<a href="../../../reflect/macros/Attachments.scala.html#402528" title="[T](implicit evidence$2: scala.reflect.ClassTag[T])Option[T]">get</a><a href="../../../reflect/ClassTag.scala.html#81051" title="(implicit evidence$2: scala.reflect.ClassTag[Macros.this.MacroRuntimeAttachment])Option[Macros.this.MacroRuntimeAttachment]" class="delimiter">[</a><a href="StdAttachments.scala.html#538513" title="Macros.this.MacroRuntimeAttachment">MacroRuntimeAttachment</a><span class="delimiter">]</span>.<a href="../../../Option.scala.html#62858" title="=&gt; Macros.this.MacroRuntimeAttachment">get</a>.<a href="StdAttachments.scala.html#1053552" title="=&gt; Macros.this.Context">typerContext</a>
          <a href="#538378" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]">delayed</a> <a href="../../../collection/convert/Wrappers.scala.html#149121" title="(key: Macros.this.global.Tree)Macros.this.delayed.type">-=</a> tree
          <a href="#1057164" title="Macros.this.Context">context</a>.<a href="Contexts.scala.html#538801" title="(x$1: Boolean)Unit">implicitsEnabled</a> = <a href="#1054413" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538560" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#538800" title="=&gt; Boolean">implicitsEnabled</a>
          <a href="#1057164" title="Macros.this.Context">context</a>.<a href="Contexts.scala.html#538807" title="(x$1: Boolean)Unit">enrichmentEnabled</a> = <a href="#1054413" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538560" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#538806" title="=&gt; Boolean">enrichmentEnabled</a>
          <a href="#1057164" title="Macros.this.Context">context</a>.<a href="Contexts.scala.html#538804" title="(x$1: Boolean)Unit">macrosEnabled</a> = <a href="#1054413" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#538560" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#538803" title="=&gt; Boolean">macrosEnabled</a>
          <a href="#538371" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree">macroExpand</a><span class="delimiter">(</span><a href="Typers.scala.html#538108" title="(context: Macros.this.Context)Macros.this.Typer">newTyper</a><span class="delimiter">(</span><a href="#1057164" title="Macros.this.Context">context</a><span class="delimiter">)</span>, tree, <span title="Int(1)">EXPRmode</span>, <a href="../../../reflect/internal/Types.scala.html#407279" title="Macros.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>
        <span class="keyword">case</span> _ =&gt;
          <a href="#3366632" title="(x: Macros.this.global.Tree)Macros.this.global.Tree">tree</a>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<a href="#1057158" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1054414" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="scala.tools.nsc.typechecker.MacrosStats.type" id="47973">MacrosStats</a> <a href="#47974" title="scala.tools.nsc.typechecker.MacrosStats.type" class="delimiter">{</a>
  <span class="keyword">import</span> scala.reflect.internal.<a href="../../../reflect/internal/Types.scala.html#20345" title="scala.reflect.internal.TypesStats.type">TypesStats</a>.typerNanos
  <span class="keyword">val</span> <a title="scala.reflect.internal.util.Statistics.Counter" id="539237">macroExpandCount</a>    = <a href="../../../reflect/internal/util/Statistics.scala.html#22672" title="scala.reflect.internal.util.Statistics.type">Statistics</a>.<a href="../../../reflect/internal/util/Statistics.scala.html#415237" title="(prefix: String, phases: String*)scala.reflect.internal.util.Statistics.Counter">newCounter</a> <span class="delimiter">(</span><span title="String(&quot;#macro expansions&quot;)" class="string">&quot;#macro expansions&quot;</span>, <span title="String(&quot;typer&quot;)" class="string">&quot;typer&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="scala.reflect.internal.util.Statistics.Timer" id="539239">macroExpandNanos</a>    = <a href="../../../reflect/internal/util/Statistics.scala.html#22672" title="scala.reflect.internal.util.Statistics.type">Statistics</a>.<a href="../../../reflect/internal/util/Statistics.scala.html#415241" title="(prefix: String, timer: scala.reflect.internal.util.Statistics.Timer)scala.reflect.internal.util.Statistics.Timer">newSubTimer</a><span class="delimiter">(</span><span title="String(&quot;time spent in macroExpand&quot;)" class="string">&quot;time spent in macroExpand&quot;</span>, <a href="../../../reflect/internal/Types.scala.html#409425" title="=&gt; scala.reflect.internal.util.Statistics.Timer">typerNanos</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>