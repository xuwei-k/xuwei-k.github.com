<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/typechecker/Adaptations.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2013 LAMP/EPFL
 * @author  Paul Phillips
 */

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> typechecker

/** This trait provides logic for assessing the validity of argument
 *  adaptations, such as tupling, unit-insertion, widening, etc.  Such
 *  logic is spread around the compiler, without much ability on the
 *  part of the user to tighten the potentially dangerous bits.
 *
 *  TODO: unifying/consolidating said logic under consistent management.
 *
 *  @author  Paul Phillips
 */
<span class="keyword">trait</span> <a title="trait Adaptations extends Object" id="46484">Adaptations</a> <a href="../../../Unit.scala.html#1515" title="Unit" class="delimiter">{</a>
  self: Analyzer =&gt;

  <span class="keyword">import</span> <a href="Analyzer.scala.html#537962" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#407777" title="Adaptations.this.global.definitions.type">definitions</a>._

  <span class="keyword">trait</span> <a title="trait Adaptation extends Object" id="538122">Adaptation</a> <a href="../../../Unit.scala.html#1515" title="Unit" class="delimiter">{</a>
    self: Typer =&gt;

    <span class="keyword">def</span> <a title="(t: Adaptations.this.global.Tree, args: List[Adaptations.this.global.Tree])Boolean" id="538727">checkValidAdaptation</a><span class="delimiter">(</span><a title="Adaptations.this.global.Tree" id="1027009">t</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="Adaptations.this.global.Tree">Tree</a>, <a title="List[Adaptations.this.global.Tree]" id="1027010">args</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[Adaptations.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="=&gt; Adaptations.this.global.Tree" id="1027011">applyArg</a> = <a href="#1027009" title="Adaptations.this.global.Tree">t</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Apply<a href="#3362273" title="Adaptations.this.global.Tree" id="3362277" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410031" title="Adaptations.this.global.Tree" id="3362274">_</a>, <a href="../../../collection/immutable/List.scala.html#206583" title="Adaptations.this.global.Tree" id="1027028">arg</a> <a href="../../../reflect/internal/Trees.scala.html#410033" title="List[Adaptations.this.global.Tree]" id="3362279">::</a> <a href="../../../collection/immutable/List.scala.html#206584" title="List[Adaptations.this.global.Tree]" id="3362281">Nil</a><span class="delimiter">)</span> =&gt; <a href="#3362283" title="(x: Adaptations.this.global.Tree)Adaptations.this.global.Tree">arg</a>
        <span class="keyword">case</span> _                    =&gt; <a href="#3362283" title="(x: Adaptations.this.global.Tree)Adaptations.this.global.Tree">EmptyTree</a>
      <span class="delimiter">}</span>
      <span class="keyword">def</span> <a title="=&gt; String" id="1027012">callString</a> = <span class="delimiter">(</span>
        <span class="delimiter">(</span> <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411201" title="=&gt; Boolean">isConstructor</a><span class="delimiter">)</span> <span title="String(&quot;new &quot;)" class="string">&quot;new &quot;</span> <span class="keyword">else</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> <span class="delimiter">)</span> <span title="(x$1: Any)String">+</span>
        <span class="delimiter">(</span> <a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411315" title="=&gt; Adaptations.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#411324" title="=&gt; String">decodedName</a> <span class="delimiter">)</span> <span title="(x$1: Any)String">+</span>
        <span class="delimiter">(</span> <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411201" title="=&gt; Boolean">isConstructor</a> <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; Adaptations.this.global.Symbol#NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="Adaptations.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414263" title="=&gt; Adaptations.this.global.nme.NameType">apply</a><span class="delimiter">)</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> <span class="keyword">else</span> <span title="String(&quot;.&quot;)" class="string">&quot;.&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411324" title="=&gt; String">decodedName</a> <span class="delimiter">)</span>
      <span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="=&gt; String" id="1027013">sigString</a> = <a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411315" title="=&gt; Adaptations.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#411324" title="=&gt; String">decodedName</a> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span>
        <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411201" title="=&gt; Boolean">isConstructor</a><span class="delimiter">)</span> <a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411511" title="=&gt; String">signatureString</a>
        <span class="keyword">else</span> <span title="String(&quot;.&quot;)" class="string">&quot;.&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411324" title="=&gt; String">decodedName</a> <span title="(x$1: Any)String">+</span> <a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411511" title="=&gt; String">signatureString</a>
      <span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="=&gt; String" id="1027014">givenString</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1027010" title="List[Adaptations.this.global.Tree]">args</a>.<a href="../../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span title="String(&quot;&lt;none&gt;&quot;)" class="string">&quot;&lt;none&gt;&quot;</span> <span class="keyword">else</span> <a href="#1027010" title="List[Adaptations.this.global.Tree]">args</a>.<a href="../../../collection/TraversableOnce.scala.html#58283" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="=&gt; String" id="1027015">adaptedArgs</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1027010" title="List[Adaptations.this.global.Tree]">args</a>.<a href="../../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span title="String(&quot;(): Unit&quot;)" class="string">&quot;(): Unit&quot;</span> <span class="keyword">else</span> <a href="#1027010" title="List[Adaptations.this.global.Tree]">args</a>.<a href="../../../collection/TraversableOnce.scala.html#58282" title="(start: String, sep: String, end: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;(&quot;)" class="string">&quot;(&quot;</span>, <span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span>, <span title="String(&quot;): &quot;)" class="string">&quot;): &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1027011" title="=&gt; Adaptations.this.global.Tree">applyArg</a>.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; Adaptations.this.global.Type">tpe</a><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(msg: String)Unit" id="1027016">adaptWarning</a><span class="delimiter">(</span><a title="String" id="1027052">msg</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="Typers.scala.html#538560" title="=&gt; Adaptations.this.Context">context</a>.<a href="Contexts.scala.html#538883" title="(pos: Adaptations.this.global.Position, msg: String)Unit">warning</a><span class="delimiter">(</span><a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; Adaptations.this.global.Position">pos</a>, <a href="#1027052" title="String">msg</a> <span title="(x$1: Any)String">+</span>
        <span title="String(&quot;\n        signature: &quot;)" class="string">&quot;\n        signature: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1027013" title="=&gt; String">sigString</a> <span title="(x$1: Any)String">+</span>
        <span title="String(&quot;\n  given arguments: &quot;)" class="string">&quot;\n  given arguments: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1027014" title="=&gt; String">givenString</a> <span title="(x$1: Any)String">+</span>
        <span title="String(&quot;\n after adaptation: &quot;)" class="string">&quot;\n after adaptation: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1027012" title="=&gt; String">callString</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;(&quot;)" class="string">&quot;(&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1027015" title="=&gt; String">adaptedArgs</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span>
      <span class="delimiter">)</span>
      // A one-argument method accepting Object (which may look like &quot;Any&quot;
      // at this point if the class is java defined) is a &quot;leaky target&quot; for
      // which we should be especially reluctant to insert () or auto-tuple.
      <span class="keyword">def</span> <a title="=&gt; Boolean" id="1027017">isLeakyTarget</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Boolean" id="1027060">oneArgObject</a> = <a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411390" title="=&gt; List[List[Adaptations.this.global.Symbol]]">paramss</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#206583" title="Adaptations.this.global.Symbol" id="1027065">param</a> <a href="../../../collection/immutable/List.scala.html#206583" title="List[Adaptations.this.global.Symbol]" id="3362296">::</a> <a href="../../../collection/immutable/List.scala.html#206584" title="List[Adaptations.this.global.Symbol]" id="3362299">Nil</a><span class="delimiter">)</span> <a href="#3362291" title="Boolean" id="3362294">::</a> <a href="../../../collection/immutable/List.scala.html#206584" title="List[List[Adaptations.this.global.Symbol]]" id="3362300">Nil</a>  =&gt; <a href="../../../reflect/internal/Definitions.scala.html#408671" title="=&gt; Adaptations.this.global.ClassSymbol">ObjectClass</a> <a href="#3362302" title="(x: Boolean)Boolean">isSubClass</a> <a href="#1027065" title="Adaptations.this.global.Symbol">param</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; Adaptations.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#408407" title="=&gt; Adaptations.this.global.Symbol">typeSymbol</a>
          <span class="keyword">case</span> _                      =&gt; <a href="#3362302" title="(x: Boolean)Boolean" class="keyword">false</a>
        <span class="delimiter">}</span>
        // Unfortunately various &quot;universal&quot; methods and the manner in which
        // they are used limits our ability to enforce anything sensible until
        // an opt-in compiler option is given.
        <a href="#1027060" title="Boolean">oneArgObject</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><span class="delimiter">(</span>
             <a href="../../../reflect/internal/Definitions.scala.html#408965" title="(sym: Adaptations.this.global.Symbol)Boolean">isStringAddition</a><span class="delimiter">(</span><a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a><span class="delimiter">)</span>
          <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="../../../reflect/internal/Definitions.scala.html#408966" title="(sym: Adaptations.this.global.Symbol)Boolean">isArrowAssoc</a><span class="delimiter">(</span><a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a><span class="delimiter">)</span>
          <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; Adaptations.this.global.Symbol#NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="Adaptations.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414353" title="=&gt; Adaptations.this.global.nme.NameType">equals_</a>
          <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; Adaptations.this.global.Symbol#NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="Adaptations.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414634" title="=&gt; Adaptations.this.global.TermName">EQ</a>
          <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="#1027009" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; Adaptations.this.global.Symbol#NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="Adaptations.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414658" title="=&gt; Adaptations.this.global.TermName">NE</a>
        <span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../Global.scala.html#537448" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#540079" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">noAdaptedArgs</a>.<a href="../settings/MutableSettings.scala.html#541066" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
        <a href="#1027016" title="(msg: String)Unit">adaptWarning</a><span class="delimiter">(</span><span title="String(&quot;No automatic adaptation here: use explicit parentheses.&quot;)" class="string">&quot;No automatic adaptation here: use explicit parentheses.&quot;</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../Global.scala.html#537448" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/Warnings.scala.html#540245" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">warnAdaptedArgs</a>.<a href="../settings/MutableSettings.scala.html#541066" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
        <a href="#1027016" title="(msg: String)Unit">adaptWarning</a><span class="delimiter">(</span>
          <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1027010" title="List[Adaptations.this.global.Tree]">args</a>.<a href="../../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span title="String(&quot;Adapting argument list by inserting (): &quot;)" class="string">&quot;Adapting argument list by inserting (): &quot;</span> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span>
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1027017" title="=&gt; Boolean">isLeakyTarget</a><span class="delimiter">)</span> <span title="String(&quot;leaky (Object-receiving) target makes this especially dangerous.&quot;)" class="string">&quot;leaky (Object-receiving) target makes this especially dangerous.&quot;</span>
            <span class="keyword">else</span> <span title="String(&quot;this is unlikely to be what you want.&quot;)" class="string">&quot;this is unlikely to be what you want.&quot;</span>
          <span class="delimiter">)</span>
          <span class="keyword">else</span> <span title="String(&quot;Adapting argument list by creating a &quot;)" class="string">&quot;Adapting argument list by creating a &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1027010" title="List[Adaptations.this.global.Tree]">args</a>.<a href="../../../collection/SeqLike.scala.html#58788" title="=&gt; Int">size</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;-tuple: this may not be what you want.&quot;)" class="string">&quot;-tuple: this may not be what you want.&quot;</span>
        <span class="delimiter">)</span>

      <a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="../Global.scala.html#537448" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#540079" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">noAdaptedArgs</a>.<a href="../settings/MutableSettings.scala.html#541066" title="=&gt; Boolean">value</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span title="Object" class="delimiter">}</span>

        </pre>
    </body>
</html>