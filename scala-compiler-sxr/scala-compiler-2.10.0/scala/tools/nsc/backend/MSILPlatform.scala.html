<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/backend/MSILPlatform.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2013 LAMP/EPFL
 * @author  Paul Phillips
 */

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> backend

<span class="keyword">import</span> ch.epfl.lamp.compiler.<span class="delimiter">{</span> msil =&gt; msillib <span class="delimiter">}</span>
<span class="keyword">import</span> util.<span class="delimiter">{</span> ClassPath, MsilClassPath <span class="delimiter">}</span>
<span class="keyword">import</span> msil.GenMSIL
<span class="keyword">import</span> io.<span class="delimiter">{</span> AbstractFile, MsilFile <span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait MSILPlatform extends Object with scala.tools.nsc.backend.Platform" id="29597">MSILPlatform</a> <a href="../../../Unit.scala.html#1515" title="Unit" class="keyword">extends</a> <a href="Platform.scala.html#29594" title="scala.tools.nsc.backend.Platform">Platform</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="Platform.scala.html#540503" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#407777" title="MSILPlatform.this.global.definitions.type">definitions</a>.<span class="delimiter">{</span> ComparatorClass, BoxedNumberClass, getMember <span class="delimiter">}</span>

  <span class="keyword">type</span> <a title="scala.tools.nsc.io.MsilFile" id="619046">BinaryRepr</a> = <a href="../io/MsilFile.scala.html#40086" title="scala.tools.nsc.io.MsilFile">MsilFile</a>

  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../Global.scala.html#537448" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/StandardScalaSettings.scala.html#540228" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">verbose</a>.<a href="../settings/MutableSettings.scala.html#541066" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
    <a href="../Global.scala.html#537494" title="(msg: String)Unit">inform</a><span class="delimiter">(</span><span title="String(&quot;[AssemRefs = &quot;)" class="string">&quot;[AssemRefs = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="../Global.scala.html#537448" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#539955" title="=&gt; scala.tools.nsc.Settings#StringSetting">assemrefs</a>.<a href="../../../reflect/internal/settings/MutableSettings.scala.html#423752" title="=&gt; String">value</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span>

  // phaseName = &quot;msil&quot;
  <span class="keyword">object</span> <a title="MSILPlatform.this.genMSIL.type" id="619047">genMSIL</a> <a href="#619048" title="MSILPlatform.this.genMSIL.type" class="keyword">extends</a> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="MSILPlatform.this.global.type" id="693717">global</a>: MSILPlatform.<span class="keyword">this</span>.global.<span class="keyword">type</span> = <a href="#29597" title="MSILPlatform.this.type">MSILPlatform</a>.<span class="keyword">this</span>.<a href="Platform.scala.html#540503" title="=&gt; scala.tools.nsc.Global">global</a>
    <span class="keyword">val</span> <a title="List[String]" id="693718">runsAfter</a> = <a href="../../../collection/immutable/List.scala.html#62451" title="[A](xs: A*)List[A]">List</a><span title="(xs: String*)List[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="String(&quot;dce&quot;)" class="string">&quot;dce&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="None.type" id="693719">runsRightAfter</a> = <a href="../../../Option.scala.html#1585" title="None.type">None</a>
  <span class="delimiter">}</span> <span class="keyword">with</span> <a href="msil/GenMSIL.scala.html#32473" title="scala.tools.nsc.backend.msil.GenMSIL">GenMSIL</a>

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.tools.nsc.util.MsilClassPath" id="619050">classPath</a> = <a href="../util/MsilClassPath.scala.html#50126" title="scala.tools.nsc.util.MsilClassPath.type">MsilClassPath</a>.<a href="../util/MsilClassPath.scala.html#693727" title="(settings: scala.tools.nsc.Settings)scala.tools.nsc.util.MsilClassPath">fromSettings</a><span class="delimiter">(</span><a href="../Global.scala.html#537448" title="=&gt; scala.tools.nsc.Settings">settings</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; MSILPlatform.this.global.loaders.PackageLoader" id="619051">rootLoader</a> = <span title="MSILPlatform.this.global.loaders.PackageLoader" class="keyword">new</span> <a href="../Global.scala.html#537531" title="=&gt; scala.tools.nsc.symtab.SymbolLoaders{val global: MSILPlatform.this.global.type}">loaders</a>.<a href="../symtab/SymbolLoaders.scala.html#620822" title="MSILPlatform.this.global.loaders.PackageLoader">PackageLoader</a><span class="delimiter">(</span><a href="#619049" title="=&gt; scala.tools.nsc.util.MsilClassPath">classPath</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.tools.nsc.util.ClassPath[MSILPlatform.this.global.platform.BinaryRepr]" class="delimiter">[</span><a href="../util/ClassPath.scala.html#50227" title="scala.tools.nsc.util.ClassPath[MSILPlatform.this.global.platform.BinaryRepr]">ClassPath</a><span class="delimiter">[</span>platform.BinaryRepr<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
    // See discussion in JavaPlatForm for why we need a cast here.

  /** Update classpath with a substituted subentry */
  <span class="keyword">def</span> <a title="(subst: Map[scala.tools.nsc.util.ClassPath[MSILPlatform.this.BinaryRepr],scala.tools.nsc.util.ClassPath[MSILPlatform.this.BinaryRepr]])Nothing" id="619052">updateClassPath</a><span class="delimiter">(</span><a title="Map[scala.tools.nsc.util.ClassPath[MSILPlatform.this.BinaryRepr],scala.tools.nsc.util.ClassPath[MSILPlatform.this.BinaryRepr]]" id="693753">subst</a>: <a href="../../../collection/immutable/Map.scala.html#11241" title="Map[scala.tools.nsc.util.ClassPath[MSILPlatform.this.BinaryRepr],scala.tools.nsc.util.ClassPath[MSILPlatform.this.BinaryRepr]]">Map</a><span class="delimiter">[</span>ClassPath<span class="delimiter">[</span>BinaryRepr<span class="delimiter">]</span>, ClassPath<span class="delimiter">[</span>BinaryRepr<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> =
    <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)UnsupportedOperationException" class="keyword">new</span> <a href="../../../package.scala.html#55508" title="UnsupportedOperationException">UnsupportedOperationException</a><span class="delimiter">(</span><span title="String(&quot;classpath invalidations not supported on MSIL&quot;)" class="string">&quot;classpath invalidations not supported on MSIL&quot;</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; List[MSILPlatform.this.genMSIL.type]" id="619053">platformPhases</a> = <a href="../../../collection/immutable/List.scala.html#62451" title="(xs: MSILPlatform.this.genMSIL.type*)List[MSILPlatform.this.genMSIL.type]">List</a><span class="delimiter">(</span>
    <a href="#619047" title="MSILPlatform.this.genMSIL.type">genMSIL</a>   // generate .msil files
  <span class="delimiter">)</span>

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="MSILPlatform.this.global.Symbol" id="619055">externalEquals</a> = <a href="../../../reflect/internal/Definitions.scala.html#409262" title="(owner: MSILPlatform.this.global.Symbol, name: MSILPlatform.this.global.Name)MSILPlatform.this.global.Symbol">getMember</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#409043" title="=&gt; MSILPlatform.this.global.ClassSymbol">ComparatorClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411704" title="=&gt; MSILPlatform.this.global.Symbol">companionModule</a>, <a href="../../../reflect/internal/StdNames.scala.html#407871" title="MSILPlatform.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414353" title="=&gt; MSILPlatform.this.global.nme.NameType">equals_</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(sym: MSILPlatform.this.global.Symbol)Boolean" id="619056">isMaybeBoxed</a><span class="delimiter">(</span><a title="MSILPlatform.this.global.Symbol" id="693773">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="MSILPlatform.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <a href="#693773" title="MSILPlatform.this.global.Symbol">sym</a> <a href="../../../reflect/internal/Symbols.scala.html#411409" title="(that: MSILPlatform.this.global.Symbol)Boolean">isNonBottomSubClass</a> <a href="../../../reflect/internal/Definitions.scala.html#409119" title="=&gt; MSILPlatform.this.global.ClassSymbol">BoxedNumberClass</a>

  <span class="keyword">def</span> <a title="(bin: scala.tools.nsc.io.MsilFile)MSILPlatform.this.global.loaders.SymbolLoader" id="619057">newClassLoader</a><span class="delimiter">(</span><a title="scala.tools.nsc.io.MsilFile" id="693778">bin</a>: <a href="../io/MsilFile.scala.html#40086" title="scala.tools.nsc.io.MsilFile">MsilFile</a><span class="delimiter">)</span>: loaders.<a href="../symtab/SymbolLoaders.scala.html#620821" title="MSILPlatform.this.global.loaders.SymbolLoader">SymbolLoader</a> =  <span title="MSILPlatform.this.global.loaders.MsilFileLoader" class="keyword">new</span> <a href="../Global.scala.html#537531" title="=&gt; scala.tools.nsc.symtab.SymbolLoaders{val global: MSILPlatform.this.global.type}">loaders</a>.<a href="../symtab/SymbolLoaders.scala.html#620824" title="MSILPlatform.this.global.loaders.MsilFileLoader">MsilFileLoader</a><span class="delimiter">(</span><a href="#693778" title="scala.tools.nsc.io.MsilFile">bin</a><span class="delimiter">)</span>

  /**
   * Tells whether a class should be loaded and entered into the package
   * scope. On .NET, this method returns `false` for all synthetic classes
   * (anonymous classes, implementation classes, module classes), their
   * symtab is encoded in the pickle of another class.
   */
  <span class="keyword">def</span> <a title="(cls: scala.tools.nsc.util.ClassPath[MSILPlatform.this.BinaryRepr]#ClassRep)Boolean" id="619058">doLoad</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.ClassPath[MSILPlatform.this.BinaryRepr]#ClassRep" id="693790">cls</a>: ClassPath<span class="delimiter">[</span>BinaryRepr<span class="delimiter">]</span>#<a href="../util/ClassPath.scala.html#540525" title="scala.tools.nsc.util.ClassPath[MSILPlatform.this.BinaryRepr]#ClassRep">ClassRep</a><span class="delimiter">)</span>: <a href="../../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#693790" title="scala.tools.nsc.util.ClassPath[MSILPlatform.this.BinaryRepr]#ClassRep">cls</a>.<a href="../util/ClassPath.scala.html#626277" title="=&gt; Option[MSILPlatform.this.BinaryRepr]">binary</a>.<a href="../../../Option.scala.html#62857" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="693797">typ</a> = <a href="#693790" title="scala.tools.nsc.util.ClassPath[MSILPlatform.this.BinaryRepr]#ClassRep">cls</a>.<a href="../util/ClassPath.scala.html#626277" title="=&gt; Option[MSILPlatform.this.BinaryRepr]">binary</a>.<a href="../../../Option.scala.html#62858" title="=&gt; MSILPlatform.this.BinaryRepr">get</a>.<a href="../io/MsilFile.scala.html#693356" title="=&gt; ch.epfl.lamp.compiler.msil.Type">msilType</a>
      <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#693797" title="ch.epfl.lamp.compiler.msil.Type">typ</a>.<span title="(x$1: ch.epfl.lamp.compiler.msil.Type, x$2: Boolean)Boolean">IsDefined</span><span class="delimiter">(</span><a href="../Global.scala.html#537531" title="=&gt; scala.tools.nsc.symtab.SymbolLoaders{val global: MSILPlatform.this.global.type}">loaders</a>.<a href="../symtab/SymbolLoaders.scala.html#620828" title="MSILPlatform.this.global.loaders.clrTypes.type">clrTypes</a>.<a href="../symtab/clr/CLRTypes.scala.html#694080" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SCALA_SYMTAB_ATTR</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Array[Object]" id="694120">attrs</a> = <a href="#693797" title="ch.epfl.lamp.compiler.msil.Type">typ</a>.<span title="(x$1: ch.epfl.lamp.compiler.msil.Type, x$2: Boolean)Array[Object]">GetCustomAttributes</span><span class="delimiter">(</span><a href="../Global.scala.html#537531" title="=&gt; scala.tools.nsc.symtab.SymbolLoaders{val global: MSILPlatform.this.global.type}">loaders</a>.<a href="../symtab/SymbolLoaders.scala.html#620828" title="MSILPlatform.this.global.loaders.clrTypes.type">clrTypes</a>.<a href="../symtab/clr/CLRTypes.scala.html#694080" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SCALA_SYMTAB_ATTR</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
        <a href="../Global.scala.html#537497" title="(assertion: Boolean, message: =&gt; Any)Unit">assert</a><span class="delimiter">(</span><a href="#694120" title="Array[Object]">attrs</a>.<a href="../../../Array.scala.html#56638" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57097" title="(x: Int)Boolean">==</a> <span title="Int(1)" class="int">1</span>, <a href="#694120" title="Array[Object]">attrs</a>.<a href="../../../Array.scala.html#56638" title="=&gt; Int">length</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Attribute" id="694121">a</a> = <a href="../../../Array.scala.html#56639" title="(i: Int)Object">attrs</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.Attribute" class="delimiter">[</span>msillib.<span title="ch.epfl.lamp.compiler.msil.Attribute">Attribute</span><span class="delimiter">]</span>
        // symtab_constr takes a byte array argument (the pickle), i.e. typ has a pickle.
        // otherwise, symtab_default_constr was used, which marks typ as scala-synthetic.
        <a href="#694121" title="ch.epfl.lamp.compiler.msil.Attribute">a</a>.<span title="()ch.epfl.lamp.compiler.msil.ConstructorInfo">getConstructor</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../Global.scala.html#537531" title="=&gt; scala.tools.nsc.symtab.SymbolLoaders{val global: MSILPlatform.this.global.type}">loaders</a>.<a href="../symtab/SymbolLoaders.scala.html#620828" title="MSILPlatform.this.global.loaders.clrTypes.type">clrTypes</a>.<a href="../symtab/clr/CLRTypes.scala.html#694083" title="=&gt; ch.epfl.lamp.compiler.msil.ConstructorInfo">SYMTAB_CONSTR</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean(true)" class="keyword">true</span> // always load non-scala types
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean(true)" class="keyword">true</span> // always load source
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(bin: scala.tools.nsc.io.MsilFile, src: scala.tools.nsc.io.AbstractFile)Boolean" id="619059">needCompile</a><span class="delimiter">(</span><a title="scala.tools.nsc.io.MsilFile" id="694223">bin</a>: <a href="../io/MsilFile.scala.html#40086" title="scala.tools.nsc.io.MsilFile">MsilFile</a>, <a title="scala.tools.nsc.io.AbstractFile" id="694224">src</a>: <a href="../../../reflect/io/AbstractFile.scala.html#23215" title="scala.tools.nsc.io.AbstractFile">AbstractFile</a><span class="delimiter">)</span> =
    <span title="Boolean(false)" class="keyword">false</span> // always use compiled file on .net
<span class="delimiter">}</span>

        </pre>
    </body>
</html>