<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/backend/opt/ClosureElimination.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
 /* NSC -- new Scala compiler
 * Copyright 2005-2013 LAMP/EPFL
 * @author  Iulian Dragos
 */

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> backend.opt

<span class="keyword">import</span> scala.tools.nsc.backend.icode.analysis.LubException
<span class="keyword">import</span> scala.tools.nsc.symtab._

/**
 *  @author Iulian Dragos
 */
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class ClosureElimination extends scala.tools.nsc.SubComponent" id="33054">ClosureElimination</a> <a href="#33054" title="scala.tools.nsc.backend.opt.ClosureElimination" class="keyword">extends</a> <a href="../../SubComponent.scala.html#27133" title="scala.tools.nsc.SubComponent">SubComponent</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="../../SubComponent.scala.html#620039" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../Global.scala.html#537466" title="ClosureElimination.this.global.icodes.type">icodes</a>._
  <span class="keyword">import</span> <a href="../../Global.scala.html#537466" title="ClosureElimination.this.global.icodes.type">icodes</a>.<a href="../icode/Opcodes.scala.html#614967" title="ClosureElimination.this.global.icodes.opcodes.type">opcodes</a>._

  <span class="keyword">val</span> <a title="String" id="622936">phaseName</a> = <span title="String(&quot;closelim&quot;)" class="string">&quot;closelim&quot;</span>

  /** Create a new phase */
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(p: scala.tools.nsc.Phase)ClosureElimination.this.ClosureEliminationPhase" id="622938">newPhase</a><span class="delimiter">(</span><a title="scala.tools.nsc.Phase" id="624408">p</a>: <a href="../../../../reflect/internal/Phase.scala.html#19756" title="scala.tools.nsc.Phase">Phase</a><span class="delimiter">)</span> = <span title="ClosureElimination.this.ClosureEliminationPhase" class="keyword">new</span> <a href="#622941" title="ClosureElimination.this.ClosureEliminationPhase">ClosureEliminationPhase</a><span class="delimiter">(</span><a href="#624408" title="scala.tools.nsc.Phase">p</a><span class="delimiter">)</span>

  /** A simple peephole optimizer. */
  <span class="keyword">val</span> <a title="ClosureElimination.this.PeepholeOpt" id="622939">peephole</a> = <a href="#760915" title="ClosureElimination.this.PeepholeOpt" class="keyword">new</a> <a href="#622943" title="anonymous class $anon extends ClosureElimination.this.PeepholeOpt" id="760915">PeepholeOpt</a> <span class="delimiter">{</span>

    <span class="keyword">def</span> <a title="(bb: ClosureElimination.this.global.icodes.BasicBlock, i1: ClosureElimination.this.global.icodes.Instruction, i2: ClosureElimination.this.global.icodes.Instruction)Option[List[ClosureElimination.this.global.icodes.Instruction]]" id="760927">peep</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.BasicBlock" id="760928">bb</a>: <a href="../icode/BasicBlocks.scala.html#614938" title="ClosureElimination.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="ClosureElimination.this.global.icodes.Instruction" id="760929">i1</a>: <a href="../icode/Opcodes.scala.html#614966" title="ClosureElimination.this.global.icodes.Instruction">Instruction</a>, <a title="ClosureElimination.this.global.icodes.Instruction" id="760930">i2</a>: <a href="../icode/Opcodes.scala.html#614966" title="ClosureElimination.this.global.icodes.Instruction">Instruction</a><span class="delimiter">)</span> = <a href="../../../../Tuple2.scala.html#62849" title="(_1: ClosureElimination.this.global.icodes.Instruction, _2: ClosureElimination.this.global.icodes.Instruction)(ClosureElimination.this.global.icodes.Instruction, ClosureElimination.this.global.icodes.Instruction)" class="delimiter">(</a><a href="#760929" title="ClosureElimination.this.global.icodes.Instruction">i1</a>, <a href="#760930" title="ClosureElimination.this.global.icodes.Instruction">i2</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span class="delimiter">(</span>CONSTANT<a href="../../../../Tuple2.scala.html#60635" title="ClosureElimination.this.global.icodes.Instruction" id="3319449" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#704290" title="ClosureElimination.this.global.icodes.global.Constant" id="760943">c</a><span class="delimiter">)</span>, DROP<a href="../../../../Tuple2.scala.html#60637" title="ClosureElimination.this.global.icodes.Instruction" id="3319452" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#704127" title="ClosureElimination.this.global.icodes.TypeKind" id="3319450">_</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <a href="#3319495" title="(x: Option[List[ClosureElimination.this.global.icodes.Instruction]])Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">if</a> <span class="delimiter">(</span><a href="#760943" title="ClosureElimination.this.global.icodes.global.Constant">c</a>.<a href="../../../../reflect/internal/Constants.scala.html#409765" title="=&gt; Int">tag</a> <a href="../../../../Int.scala.html#57097" title="(x: Int)Boolean">==</a> <span title="Int(1)">UnitTag</span><span class="delimiter">)</span> <a href="../../../../Option.scala.html#63128" title="(x: List[ClosureElimination.this.global.icodes.Instruction])Some[List[ClosureElimination.this.global.icodes.Instruction]]">Some</a><span class="delimiter">(</span><a href="../../../../collection/immutable/List.scala.html#62451" title="(xs: ClosureElimination.this.global.icodes.Instruction*)List[ClosureElimination.this.global.icodes.Instruction]">List</a><span class="delimiter">(</span><a href="#760930" title="ClosureElimination.this.global.icodes.Instruction">i2</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="../../../../Option.scala.html#63128" title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</a><span class="delimiter">(</span><a href="../../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>

      <span class="keyword">case</span> <span class="delimiter">(</span>LOAD_LOCAL<a href="../../../../Tuple2.scala.html#60635" title="ClosureElimination.this.global.icodes.Instruction" id="3319456" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#703703" title="ClosureElimination.this.global.icodes.Local" id="760967">x</a><span class="delimiter">)</span>, STORE_LOCAL<a href="../../../../Tuple2.scala.html#60637" title="ClosureElimination.this.global.icodes.Instruction" id="3319458" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#700872" title="ClosureElimination.this.global.icodes.Local" id="760969">y</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <a href="#3319495" title="(x: Option[List[ClosureElimination.this.global.icodes.Instruction]])Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">if</a> <span class="delimiter">(</span><a href="#760967" title="ClosureElimination.this.global.icodes.Local">x</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#760969" title="ClosureElimination.this.global.icodes.Local">y</a><span class="delimiter">)</span> <a href="../../../../Option.scala.html#63128" title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</a><span class="delimiter">(</span><a href="../../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="../../../../Option.scala.html#1585" title="None.type">None</a>

      <span class="keyword">case</span> <span class="delimiter">(</span>STORE_LOCAL<a href="../../../../Tuple2.scala.html#60635" title="ClosureElimination.this.global.icodes.Instruction" id="3319462" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#700872" title="ClosureElimination.this.global.icodes.Local" id="760976">x</a><span class="delimiter">)</span>, LOAD_LOCAL<a href="../../../../Tuple2.scala.html#60637" title="ClosureElimination.this.global.icodes.Instruction" id="3319464" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#703703" title="ClosureElimination.this.global.icodes.Local" id="760978">y</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#760976" title="ClosureElimination.this.global.icodes.Local">x</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#760978" title="ClosureElimination.this.global.icodes.Local">y</a><span class="delimiter">)</span> =&gt;
        <span class="keyword">var</span> <a title="scala.collection.immutable.Set[ClosureElimination.this.global.icodes.liveness.global.icodes.Local]" id="760983">liveOut</a> = <a href="#760922" title="=&gt; ClosureElimination.this.global.icodes.liveness.LivenessAnalysis">liveness</a>.<a href="../../../../collection/MapLike.scala.html#87535" title="(key: ClosureElimination.this.global.icodes.liveness.global.icodes.BasicBlock)scala.collection.immutable.Set[ClosureElimination.this.global.icodes.liveness.global.icodes.Local]">out</a><span class="delimiter">(</span><a href="#760928" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a><span class="delimiter">)</span>
        <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="../../../../collection/GenSetLike.scala.html#66403" title="(elem: ClosureElimination.this.global.icodes.liveness.global.icodes.Local)Boolean">liveOut</a><span class="delimiter">(</span><a href="#760976" title="ClosureElimination.this.global.icodes.Local">x</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;store/load to a dead local? &quot;)" class="string">&quot;store/load to a dead local? &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#760976" title="ClosureElimination.this.global.icodes.Local">x</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Array[ClosureElimination.this.global.icodes.Instruction]" id="761021">instrs</a> = <a href="#760928" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#695931" title="=&gt; Array[ClosureElimination.this.global.icodes.Instruction]">getArray</a>
          <span class="keyword">var</span> <a title="Int" id="761022">idx</a> = <a href="#761021" title="Array[ClosureElimination.this.global.icodes.Instruction]">instrs</a>.<a href="../../../../Array.scala.html#56638" title="=&gt; Int">length</a> <a href="../../../../Int.scala.html#57161" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span>
          <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#761022" title="Int">idx</a> <a href="../../../../Int.scala.html#57125" title="(x: Int)Boolean">&gt;</a> <span title="Int(0)" class="int">0</span> <a href="../../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="../../../../Array.scala.html#56639" title="(i: Int)ClosureElimination.this.global.icodes.Instruction">instrs</a><span class="delimiter">(</span><a href="#761022" title="Int">idx</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="#760930" title="ClosureElimination.this.global.icodes.Instruction">i2</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#761023" title="()Unit" class="delimiter">{</a>
            <a href="#760983" title="scala.collection.immutable.Set[ClosureElimination.this.global.icodes.liveness.global.icodes.Local]">liveOut</a> = <a href="#760922" title="=&gt; ClosureElimination.this.global.icodes.liveness.LivenessAnalysis">liveness</a>.<a href="../icode/analysis/Liveness.scala.html#722684" title="(out: scala.collection.immutable.Set[ClosureElimination.this.global.icodes.liveness.global.icodes.Local], i: ClosureElimination.this.global.icodes.liveness.global.icodes.Instruction)scala.collection.immutable.Set[ClosureElimination.this.global.icodes.liveness.global.icodes.Local]">interpret</a><span class="delimiter">(</span><a href="#760983" title="scala.collection.immutable.Set[ClosureElimination.this.global.icodes.liveness.global.icodes.Local]">liveOut</a>, <a href="../../../../Array.scala.html#56639" title="(i: Int)ClosureElimination.this.global.icodes.Instruction">instrs</a><span class="delimiter">(</span><a href="#761022" title="Int">idx</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#761022" title="Int">idx</a> <a href="../../../../Int.scala.html#57161" title="(x: Int)Int">-=</a> <span title="Int(1)" class="int">1</span>
          <span class="delimiter">}</span>
          <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="../../../../collection/GenSetLike.scala.html#66403" title="(elem: ClosureElimination.this.global.icodes.liveness.global.icodes.Local)Boolean">liveOut</a><span class="delimiter">(</span><a href="#760976" title="ClosureElimination.this.global.icodes.Local">x</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="../../Global.scala.html#537516" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;Removing dead store/load of &quot;)" class="string">&quot;Removing dead store/load of &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#760976" title="ClosureElimination.this.global.icodes.Local">x</a>.<a href="../icode/Members.scala.html#696350" title="=&gt; ClosureElimination.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#411380" title="=&gt; x.sym.type">initialize</a>.<a href="../../../../reflect/internal/Symbols.scala.html#411516" title="=&gt; String">defString</a><span class="delimiter">)</span>
            <a href="../../../../Option.scala.html#63128" title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</a><span class="delimiter">(</span><a href="../../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <a href="../../../../Option.scala.html#1585" title="None.type">None</a>
        <span class="delimiter">}</span> <span class="keyword">else</span>
          <a href="../../../../Option.scala.html#63128" title="(x: List[ClosureElimination.this.global.icodes.Instruction with Product with Serializable])Some[List[ClosureElimination.this.global.icodes.Instruction with Product with Serializable]]">Some</a><span class="delimiter">(</span><a href="../../../../collection/immutable/List.scala.html#62451" title="(xs: ClosureElimination.this.global.icodes.Instruction with Product with Serializable*)List[ClosureElimination.this.global.icodes.Instruction with Product with Serializable]">List</a><span class="delimiter">(</span><a href="../icode/Opcodes.scala.html#703414" title="(typ: ClosureElimination.this.global.icodes.TypeKind)ClosureElimination.this.global.icodes.opcodes.DUP">DUP</a><span class="delimiter">(</span><a href="#760976" title="ClosureElimination.this.global.icodes.Local">x</a>.<a href="../icode/Members.scala.html#696352" title="=&gt; ClosureElimination.this.global.icodes.TypeKind">kind</a><span class="delimiter">)</span>, <a href="../icode/Opcodes.scala.html#700870" title="(local: ClosureElimination.this.global.icodes.Local)ClosureElimination.this.global.icodes.opcodes.STORE_LOCAL">STORE_LOCAL</a><span class="delimiter">(</span><a href="#760976" title="ClosureElimination.this.global.icodes.Local">x</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">case</span> <a href="#3319445" title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="delimiter">(</a>LOAD_LOCAL<a href="../../../../Tuple2.scala.html#60635" title="ClosureElimination.this.global.icodes.Instruction" id="3319469" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#703703" title="ClosureElimination.this.global.icodes.Local" id="3319467">_</a><span class="delimiter">)</span>, DROP<a href="../../../../Tuple2.scala.html#60637" title="ClosureElimination.this.global.icodes.Instruction" id="3319472" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#704127" title="ClosureElimination.this.global.icodes.TypeKind" id="3319470">_</a><span class="delimiter">)</span><span class="delimiter">)</span> | <span class="delimiter">(</span>DUP<a href="../../../../Tuple2.scala.html#60635" title="ClosureElimination.this.global.icodes.Instruction" id="3319477" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#703416" title="ClosureElimination.this.global.icodes.TypeKind" id="3319475">_</a><span class="delimiter">)</span>, DROP<a href="../../../../Tuple2.scala.html#60637" title="ClosureElimination.this.global.icodes.Instruction" id="3319480" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#704127" title="ClosureElimination.this.global.icodes.TypeKind" id="3319478">_</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <a href="../../../../Option.scala.html#63128" title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</a><a href="#3319495" title="(x: Option[List[ClosureElimination.this.global.icodes.Instruction]])Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="delimiter">(</a><a href="../../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>

      <span class="keyword">case</span> <span class="delimiter">(</span>BOX<a href="../../../../Tuple2.scala.html#60635" title="ClosureElimination.this.global.icodes.Instruction" id="3319484" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#704712" title="ClosureElimination.this.global.icodes.TypeKind" id="761108">t1</a><span class="delimiter">)</span>, UNBOX<a href="../../../../Tuple2.scala.html#60637" title="ClosureElimination.this.global.icodes.Instruction" id="3319486" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#706007" title="ClosureElimination.this.global.icodes.TypeKind" id="761110">t2</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#761108" title="ClosureElimination.this.global.icodes.TypeKind">t1</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#761110" title="ClosureElimination.this.global.icodes.TypeKind">t2</a><span class="delimiter">)</span> =&gt;
        <a href="../../../../Option.scala.html#63128" title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</a><a href="#3319495" title="(x: Option[List[ClosureElimination.this.global.icodes.Instruction]])Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="delimiter">(</a><a href="../../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>

      <span class="keyword">case</span> <span class="delimiter">(</span>LOAD_FIELD<a href="../../../../Tuple2.scala.html#60635" title="ClosureElimination.this.global.icodes.Instruction" id="3319490" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#706266" title="ClosureElimination.this.global.icodes.global.Symbol" id="761122">sym</a>, <a href="../icode/Opcodes.scala.html#706268" title="Boolean" id="761123">isStatic</a><span class="delimiter">)</span>, DROP<a href="../../../../Tuple2.scala.html#60637" title="ClosureElimination.this.global.icodes.Instruction" id="3319493" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#704127" title="ClosureElimination.this.global.icodes.TypeKind" id="3319491">_</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#761122" title="ClosureElimination.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/AnnotationInfos.scala.html#408615" title="(cls: ClosureElimination.this.global.icodes.global.Symbol)Boolean">hasAnnotation</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#407777" title="ClosureElimination.this.global.definitions.type">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#409209" title="=&gt; ClosureElimination.this.global.ClassSymbol">VolatileAttr</a><span class="delimiter">)</span> =&gt;
        <a href="#3319495" title="(x: Option[List[ClosureElimination.this.global.icodes.Instruction]])Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">if</a> <span class="delimiter">(</span><a href="#761123" title="Boolean">isStatic</a><span class="delimiter">)</span>
          <a href="../../../../Option.scala.html#63128" title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</a><span class="delimiter">(</span><a href="../../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="../../../../Option.scala.html#63128" title="(x: List[ClosureElimination.this.global.icodes.opcodes.DROP])Some[List[ClosureElimination.this.global.icodes.opcodes.DROP]]">Some</a><span class="delimiter">(</span><a href="../icode/Opcodes.scala.html#704125" title="(typ: ClosureElimination.this.global.icodes.TypeKind)ClosureElimination.this.global.icodes.opcodes.DROP">DROP</a><span class="delimiter">(</span><a href="../icode/TypeKinds.scala.html#694620" title="(cls: ClosureElimination.this.global.icodes.global.Symbol)ClosureElimination.this.global.icodes.REFERENCE">REFERENCE</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#407777" title="ClosureElimination.this.global.definitions.type">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#408671" title="=&gt; ClosureElimination.this.global.ClassSymbol">ObjectClass</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../collection/immutable/List.scala.html#62685" title="(x: ClosureElimination.this.global.icodes.opcodes.DROP)List[ClosureElimination.this.global.icodes.opcodes.DROP]">::</a> <a href="../../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>

      <span class="keyword">case</span> _ =&gt; <a href="#3319495" title="(x: Option[List[ClosureElimination.this.global.icodes.Instruction]])Option[List[ClosureElimination.this.global.icodes.Instruction]]">None</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** The closure elimination phase.
   */
  <span class="keyword">class</span> <a title="class ClosureEliminationPhase extends ClosureElimination.this.global.icodes.ICodePhase" id="622941">ClosureEliminationPhase</a><a href="#622941" title="ClosureElimination.this.ClosureEliminationPhase" class="delimiter">(</a><a title="scala.tools.nsc.Phase" id="624416">prev</a>: <a href="../../../../reflect/internal/Phase.scala.html#19756" title="scala.tools.nsc.Phase">Phase</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../icode/ICodes.scala.html#614910" title="ClosureElimination.this.global.icodes.ICodePhase">ICodePhase</a><span class="delimiter">(</span><a href="#624416" title="scala.tools.nsc.Phase">prev</a><span class="delimiter">)</span> <span class="delimiter">{</span>

    <span class="keyword">def</span> <a title="=&gt; String" id="624412">name</a> = <a href="#622936" title="=&gt; String">phaseName</a>
    <span class="keyword">val</span> <a title="ClosureElimination.this.ClosureElim" id="624413">closser</a> = <span title="ClosureElimination.this.ClosureElim" class="keyword">new</span> <a href="#622942" title="ClosureElimination.this.ClosureElim">ClosureElim</a>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(c: ClosureElimination.this.global.icodes.IClass)Unit" id="624415">apply</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.IClass" id="761171">c</a>: <a href="../icode/Members.scala.html#614923" title="ClosureElimination.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span>: <a href="../../../../Unit.scala.html#1515" title="Unit">Unit</a> =
      <a href="#624413" title="=&gt; ClosureElimination.this.ClosureElim">closser</a> <a href="#761164" title="(cls: ClosureElimination.this.global.icodes.IClass)Unit">analyzeClass</a> <a href="#761171" title="ClosureElimination.this.global.icodes.IClass">c</a>
  <span class="delimiter">}</span>

  /**
   * Remove references to the environment through fields of a closure object.
   * This has to be run after an 'apply' method has been inlined, but it still
   * references the closure object.
   *
   */
  <span class="keyword">class</span> <a title="class ClosureElim extends Object" id="622942">ClosureElim</a> <a href="#622942" title="ClosureElimination.this.ClosureElim" class="delimiter">{</a>
    <span class="keyword">def</span> <a title="(cls: ClosureElimination.this.global.icodes.IClass)Unit" id="761164">analyzeClass</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.IClass" id="761178">cls</a>: <a href="../icode/Members.scala.html#614923" title="ClosureElimination.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span>: <a href="../../../../Unit.scala.html#1515" title="Unit">Unit</a> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#537448" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#540049" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">Xcloselim</a>.<a href="../../settings/MutableSettings.scala.html#541066" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../Global.scala.html#537516" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><a href="../../../../StringContext.scala.html#56629" title="(args: Any*)String">s</a>&quot;Analyzing $<span class="delimiter">{</span><a href="#761178" title="ClosureElimination.this.global.icodes.IClass">cls</a>.<a href="../icode/Members.scala.html#615194" title="=&gt; List[ClosureElimination.this.global.icodes.IMethod]">methods</a>.<a href="../../../../collection/SeqLike.scala.html#58788" title="=&gt; Int">size</a><span class="delimiter">}</span> methods in $<a href="#761178" title="ClosureElimination.this.global.icodes.IClass">cls</a><span class="string">.&quot;</span><span class="delimiter">)</span>
      <a href="#761178" title="ClosureElimination.this.global.icodes.IClass">cls</a>.<a href="../icode/Members.scala.html#615194" title="=&gt; List[ClosureElimination.this.global.icodes.IMethod]">methods</a> <a href="../../../../collection/immutable/List.scala.html#62719" title="(f: ClosureElimination.this.global.icodes.IMethod =&gt; Unit)Unit">foreach</a> <span class="delimiter">{</span> <a title="ClosureElimination.this.global.icodes.IMethod" id="761210">m</a> =&gt;
        <a href="#761168" title="(m: ClosureElimination.this.global.icodes.IMethod)Unit">analyzeMethod</a><span class="delimiter">(</span><a href="#761210" title="ClosureElimination.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
        <a href="#760924" title="(m: ClosureElimination.this.global.icodes.IMethod)Unit">peephole</a><span class="delimiter">(</span><a href="#761210" title="ClosureElimination.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
     <span class="delimiter">}</span><span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="ClosureElimination.this.global.copyPropagation.CopyAnalysis" id="761165">cpp</a> = <span title="ClosureElimination.this.global.copyPropagation.CopyAnalysis" class="keyword">new</span> <a href="../../Global.scala.html#537474" title="ClosureElimination.this.global.copyPropagation.type">copyPropagation</a>.<a href="../icode/analysis/CopyPropagation.scala.html#619560" title="ClosureElimination.this.global.copyPropagation.CopyAnalysis">CopyAnalysis</a>

    <span class="keyword">import</span> <a href="../../Global.scala.html#537474" title="ClosureElimination.this.global.copyPropagation.type">copyPropagation</a>._

    /* Some embryonic copy propagation. */
    <span class="keyword">def</span> <a title="(m: ClosureElimination.this.global.icodes.IMethod)Unit" id="761168">analyzeMethod</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.IMethod" id="761211">m</a>: <a href="../icode/Members.scala.html#614927" title="ClosureElimination.this.global.icodes.IMethod">IMethod</a><span class="delimiter">)</span>: <a href="../../../../Unit.scala.html#1515" title="Unit">Unit</a> = <span class="keyword">try</span> <span class="delimiter">{</span><span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#761211" title="ClosureElimination.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#696027" title="=&gt; Boolean">hasCode</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#761165" title="=&gt; ClosureElimination.this.global.copyPropagation.CopyAnalysis">cpp</a>.<a href="../icode/analysis/CopyPropagation.scala.html#720997" title="(m: ClosureElimination.this.global.copyPropagation.global.icodes.IMethod)Unit">init</a><span class="delimiter">(</span><a href="#761211" title="ClosureElimination.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
      <a href="#761165" title="=&gt; ClosureElimination.this.global.copyPropagation.CopyAnalysis">cpp</a>.<a href="../icode/analysis/CopyPropagation.scala.html#720998" title="()Unit">run</a>

      <a href="#761211" title="ClosureElimination.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#695996" title="(lin: ClosureElimination.this.global.icodes.Linearizer)List[ClosureElimination.this.global.icodes.BasicBlock]">linearizedBlocks</a><span class="delimiter">(</span><span class="delimiter">)</span> <a href="../../../../collection/immutable/List.scala.html#62719" title="(f: ClosureElimination.this.global.icodes.BasicBlock =&gt; Unit)Unit">foreach</a> <span class="delimiter">{</span> <a title="ClosureElimination.this.global.icodes.BasicBlock" id="761246">bb</a> =&gt;
        <span class="keyword">var</span> <a title="ClosureElim.this.cpp.lattice.Elem" id="761247">info</a> = <a href="#761165" title="=&gt; ClosureElimination.this.global.copyPropagation.CopyAnalysis">cpp</a>.<a href="../../../../collection/MapLike.scala.html#87535" title="(key: ClosureElim.this.cpp.P)ClosureElim.this.cpp.lattice.Elem">in</a><span class="delimiter">(</span><a href="#761246" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a><span class="delimiter">)</span>
        <a href="../../Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Cpp info at entry to block &quot;)" class="string">&quot;Cpp info at entry to block &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#761246" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a><span class="delimiter">)</span>

        <span class="keyword">for</span> <span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.Instruction" id="761267">i</a> &lt;- <a href="../icode/BasicBlocks.scala.html#695934" title="(f: ClosureElimination.this.global.icodes.Instruction =&gt; Unit)Unit">bb</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#761267" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> LOAD_LOCAL<a href="#3319620" title="Unit" id="3319622" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#703703" title="ClosureElimination.this.global.icodes.Local" id="761269">l</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#720461" title="=&gt; ClosureElim.this.cpp.lattice.Bindings">bindings</a> <a href="../../../../collection/MapLike.scala.html#87537" title="(key: ClosureElimination.this.global.copyPropagation.Location)Boolean">isDefinedAt</a> <a href="../icode/analysis/CopyPropagation.scala.html#720526" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.LocalVar">LocalVar</a><span class="delimiter">(</span><a href="#761269" title="ClosureElimination.this.global.icodes.Local">l</a><span class="delimiter">)</span> =&gt;
              <span class="keyword">val</span> <a title="ClosureElimination.this.global.copyPropagation.Value" id="761277">t</a> = <a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#720470" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a><span class="delimiter">(</span><a href="#761269" title="ClosureElimination.this.global.icodes.Local">l</a><span class="delimiter">)</span>
              <a href="#761277" title="ClosureElimination.this.global.copyPropagation.Value">t</a> <span class="keyword">match</span> <span class="delimiter">{</span>
              	<span class="keyword">case</span> Deref<a href="#3319510" title="Unit" id="3319513" class="delimiter">(</a><a href="../icode/analysis/CopyPropagation.scala.html#720313" title="ClosureElimination.this.global.copyPropagation.Location" id="3319518">This</a><span class="delimiter">)</span> | Const<a href="#3319510" title="Boolean" id="3319517" class="delimiter">(</a><a href="../icode/analysis/CopyPropagation.scala.html#720383" title="ClosureElimination.this.global.copyPropagation.global.Constant" id="3319515">_</a><span class="delimiter">)</span> =&gt;
                  <a href="#761246" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#695941" title="(oldInstr: ClosureElimination.this.global.icodes.Instruction, newInstr: ClosureElimination.this.global.icodes.Instruction)Boolean">replaceInstruction</a><span class="delimiter">(</span><a href="#761267" title="ClosureElimination.this.global.icodes.Instruction">i</a>, <a href="#761169" title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction">valueToInstruction</a><span class="delimiter">(</span><a href="#761277" title="ClosureElimination.this.global.copyPropagation.Value">t</a><span class="delimiter">)</span><span class="delimiter">)</span>;
                  <a href="../../Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><a href="../../../../StringContext.scala.html#56629" title="(args: Any*)String">s</a>&quot;replaced $<a href="#761267" title="ClosureElimination.this.global.icodes.Instruction">i</a> with $<a href="#761277" title="ClosureElimination.this.global.copyPropagation.Value">t</a><span class="string">&quot;</span><span class="delimiter">)</span>

                <span class="keyword">case</span> _ =&gt;
                  <span class="keyword">val</span> <a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="761299">t</a> = <a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#720469" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.global.icodes.Local">getAlias</a><span class="delimiter">(</span><a href="#761269" title="ClosureElimination.this.global.icodes.Local">l</a><span class="delimiter">)</span>
                  <a href="#761246" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#695941" title="(oldInstr: ClosureElimination.this.global.icodes.Instruction, newInstr: ClosureElimination.this.global.icodes.Instruction)Boolean">replaceInstruction</a><span class="delimiter">(</span><a href="#761267" title="ClosureElimination.this.global.icodes.Instruction">i</a>, <a href="../icode/Opcodes.scala.html#703701" title="(local: ClosureElimination.this.global.icodes.Local)ClosureElimination.this.global.icodes.opcodes.LOAD_LOCAL">LOAD_LOCAL</a><span class="delimiter">(</span><a href="#761299" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">t</a><span class="delimiter">)</span><span class="delimiter">)</span>
                  <a href="../../Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><a href="../../../../StringContext.scala.html#56629" title="(args: Any*)String">s</a>&quot;replaced $<a href="#761267" title="ClosureElimination.this.global.icodes.Instruction">i</a> with $<a href="#761299" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">t</a><span class="string">&quot;</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>

            <span class="keyword">case</span> LOAD_FIELD<a href="#3319620" title="Unit" id="3319625" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#706266" title="ClosureElimination.this.global.icodes.global.Symbol" id="761309">f</a>, <a href="../icode/Opcodes.scala.html#706268" title="Boolean" id="3319631" class="keyword">false</a><span class="delimiter">)</span> /* if accessible(f, m.symbol) */ =&gt;
              <span class="keyword">def</span> <a title="(r: ClosureElimination.this.global.copyPropagation.Record)Unit" id="761310">replaceFieldAccess</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.copyPropagation.Record" id="761311">r</a>: <a href="../icode/analysis/CopyPropagation.scala.html#619542" title="ClosureElimination.this.global.copyPropagation.Record">Record</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> Record<a href="#3319535" title="(x: (ClosureElimination.this.global.copyPropagation.global.Symbol, scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]))(ClosureElimination.this.global.copyPropagation.global.Symbol, scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value])" class="delimiter">(</a><a href="../icode/analysis/CopyPropagation.scala.html#720206" title="ClosureElimination.this.global.copyPropagation.global.Symbol" id="761313">cls</a>, <a href="../icode/analysis/CopyPropagation.scala.html#720208" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]" id="761314">bindings</a><span class="delimiter">)</span> = <a href="#761311" title="ClosureElimination.this.global.copyPropagation.Record">r</a>
                <a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#720473" title="(r: ClosureElimination.this.global.copyPropagation.Record, f: ClosureElimination.this.global.copyPropagation.global.Symbol)Option[ClosureElimination.this.global.copyPropagation.Value]">getFieldNonRecordValue</a><span class="delimiter">(</span><a href="#761311" title="ClosureElimination.this.global.copyPropagation.Record">r</a>, <a href="#761309" title="ClosureElimination.this.global.icodes.global.Symbol">f</a><span class="delimiter">)</span> <a href="../../../../Option.scala.html#62884" title="(f: ClosureElimination.this.global.copyPropagation.Value =&gt; Unit)Unit">foreach</a> <span class="delimiter">{</span> <a title="ClosureElimination.this.global.copyPropagation.Value" id="761332">v</a> =&gt;
                        <a href="#761246" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#695942" title="(oldInstr: ClosureElimination.this.global.icodes.Instruction, is: List[ClosureElimination.this.global.icodes.Instruction])Boolean">replaceInstruction</a><span class="delimiter">(</span><a href="#761267" title="ClosureElimination.this.global.icodes.Instruction">i</a>, <a href="../icode/Opcodes.scala.html#704125" title="(typ: ClosureElimination.this.global.icodes.TypeKind)ClosureElimination.this.global.icodes.opcodes.DROP">DROP</a><span class="delimiter">(</span><a href="../icode/TypeKinds.scala.html#694620" title="(cls: ClosureElimination.this.global.icodes.global.Symbol)ClosureElimination.this.global.icodes.REFERENCE">REFERENCE</a><span class="delimiter">(</span><a href="#761313" title="ClosureElimination.this.global.copyPropagation.global.Symbol">cls</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../collection/immutable/List.scala.html#62685" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <a href="#761169" title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction">valueToInstruction</a><span class="delimiter">(</span><a href="#761332" title="ClosureElimination.this.global.copyPropagation.Value">v</a><span class="delimiter">)</span> <a href="../../../../collection/immutable/List.scala.html#62685" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <a href="../../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>
                        <a href="../../Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><a href="../../../../StringContext.scala.html#56629" title="(args: Any*)String">s</a>&quot;replaced $<a href="#761267" title="ClosureElimination.this.global.icodes.Instruction">i</a> with $<a href="#761332" title="ClosureElimination.this.global.copyPropagation.Value">v</a><span class="string">&quot;</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>

              <a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../../../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)ClosureElimination.this.global.copyPropagation.Value">stack</a><a href="#3319563" title="ClosureElimination.this.global.copyPropagation.Record" class="delimiter">(</a><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> r @ Record<a href="#3319560" title="Unit" id="3319563" class="delimiter">(</a><a href="../icode/analysis/CopyPropagation.scala.html#720206" title="ClosureElimination.this.global.copyPropagation.global.Symbol" id="3319561">_</a>, <a href="../icode/analysis/CopyPropagation.scala.html#720208" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]" id="761365">bindings</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#761365" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]">bindings</a> <a href="../../../../collection/MapLike.scala.html#87537" title="(key: ClosureElimination.this.global.copyPropagation.global.Symbol)Boolean">isDefinedAt</a> <a href="#761309" title="ClosureElimination.this.global.icodes.global.Symbol">f</a> =&gt;
                  <a href="#761310" title="(r: ClosureElimination.this.global.copyPropagation.Record)Unit">replaceFieldAccess</a><a href="#3319576" title="(x: Unit)Unit" class="delimiter">(</a>r<span class="delimiter">)</span>

                <span class="keyword">case</span> Deref<a href="#3319560" title="Boolean" id="3319566" class="delimiter">(</a>LocalVar<a href="../icode/analysis/CopyPropagation.scala.html#720313" title="ClosureElimination.this.global.copyPropagation.Location" id="3319568" class="delimiter">(</a><a href="../icode/analysis/CopyPropagation.scala.html#720157" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="761371">l</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
                  <a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#720470" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a><a href="#3319576" title="(x: Unit)Unit" class="delimiter">(</a><a href="#761371" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">l</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
                    <span class="keyword">case</span> r @ Record<a href="#3319539" title="Unit" id="3319542" class="delimiter">(</a><a href="../icode/analysis/CopyPropagation.scala.html#720206" title="ClosureElimination.this.global.copyPropagation.global.Symbol" id="3319540">_</a>, <a href="../icode/analysis/CopyPropagation.scala.html#720208" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]" id="761377">bindings</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#761377" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]">bindings</a> <a href="../../../../collection/MapLike.scala.html#87537" title="(key: ClosureElimination.this.global.copyPropagation.global.Symbol)Boolean">isDefinedAt</a> <a href="#761309" title="ClosureElimination.this.global.icodes.global.Symbol">f</a> =&gt;
                      <a href="#761310" title="(r: ClosureElimination.this.global.copyPropagation.Record)Unit">replaceFieldAccess</a><a href="#3319544" title="(x: Unit)Unit" class="delimiter">(</a>r<span class="delimiter">)</span>
                    <span class="keyword">case</span> _ =&gt;
                  <span class="delimiter">}</span>
                <span class="keyword">case</span> Deref<span class="delimiter">(</span>Field<a href="../icode/analysis/CopyPropagation.scala.html#720313" title="ClosureElimination.this.global.copyPropagation.Location" id="3319573" class="delimiter">(</a><a href="../icode/analysis/CopyPropagation.scala.html#720193" title="ClosureElimination.this.global.copyPropagation.Record" id="761384">r1</a>, <a href="../icode/analysis/CopyPropagation.scala.html#720195" title="ClosureElimination.this.global.copyPropagation.global.Symbol" id="761385">f1</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
                  <a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#720472" title="(r: ClosureElimination.this.global.copyPropagation.Record, f: ClosureElimination.this.global.copyPropagation.global.Symbol)Option[ClosureElimination.this.global.copyPropagation.Value]">getFieldValue</a><a href="#3319576" title="(x: Unit)Unit" class="delimiter">(</a><a href="#761384" title="ClosureElimination.this.global.copyPropagation.Record">r1</a>, <a href="#761385" title="ClosureElimination.this.global.copyPropagation.global.Symbol">f1</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
                    <span class="keyword">case</span> Some<a href="#3319549" title="Unit" id="3319550" class="delimiter">(</a><a href="../../../../Option.scala.html#63132" title="ClosureElimination.this.global.copyPropagation.Value" id="761389">r</a> @ Record<a href="#761389" title="Unit" id="3319553" class="delimiter">(</a><a href="../icode/analysis/CopyPropagation.scala.html#720206" title="ClosureElimination.this.global.copyPropagation.global.Symbol" id="3319551">_</a>, <a href="../icode/analysis/CopyPropagation.scala.html#720208" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]" id="761392">bindings</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#761392" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]">bindings</a> <a href="../../../../collection/MapLike.scala.html#87537" title="(key: ClosureElimination.this.global.copyPropagation.global.Symbol)Boolean">isDefinedAt</a> <a href="#761309" title="ClosureElimination.this.global.icodes.global.Symbol">f</a> =&gt;
                      <a href="#761310" title="(r: ClosureElimination.this.global.copyPropagation.Record)Unit">replaceFieldAccess</a><a href="#3319555" title="(x: Unit)Unit" class="delimiter">(</a>r<span class="delimiter">)</span>
                    <span class="keyword">case</span> _ =&gt;
                  <span class="delimiter">}</span>

                <span class="keyword">case</span> _ =&gt;
              <span class="delimiter">}</span>

            <span class="keyword">case</span> UNBOX<a href="#3319620" title="Unit" id="3319630" class="delimiter">(</a><a href="../icode/Opcodes.scala.html#706007" title="ClosureElimination.this.global.icodes.TypeKind" id="3319628">_</a><span class="delimiter">)</span> =&gt;
              <a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="#3319633" title="(x: Unit)Unit">stack</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> Deref<a href="../../../../collection/immutable/List.scala.html#206583" title="ClosureElimination.this.global.copyPropagation.Value" id="3319601" class="delimiter">(</a>LocalVar<a href="../icode/analysis/CopyPropagation.scala.html#720313" title="ClosureElimination.this.global.copyPropagation.Location" id="3319603" class="delimiter">(</a><a href="../icode/analysis/CopyPropagation.scala.html#720157" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="761401">loc1</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#3319595" title="Boolean" id="3319598">::</a> <a href="../../../../collection/immutable/List.scala.html#206584" title="List[ClosureElimination.this.global.copyPropagation.Value]" id="3319597">_</a> <span class="keyword">if</span> <a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#720461" title="=&gt; ClosureElim.this.cpp.lattice.Bindings">bindings</a> <a href="../../../../collection/MapLike.scala.html#87537" title="(key: ClosureElimination.this.global.copyPropagation.Location)Boolean">isDefinedAt</a> <a href="../icode/analysis/CopyPropagation.scala.html#720526" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.LocalVar">LocalVar</a><span class="delimiter">(</span><a href="#761401" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc1</a><span class="delimiter">)</span> =&gt;
                  <span class="keyword">val</span> <a title="ClosureElimination.this.global.copyPropagation.Value" id="761408">value</a> = <a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#720470" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a><span class="delimiter">(</span><a href="#761401" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc1</a><span class="delimiter">)</span>
                  <a href="#761408" title="ClosureElimination.this.global.copyPropagation.Value">value</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                    <span class="keyword">case</span> Boxed<a href="#3319583" title="Unit" id="3319586" class="delimiter">(</a>LocalVar<a href="../icode/analysis/CopyPropagation.scala.html#720348" title="ClosureElimination.this.global.copyPropagation.Location" id="3319588" class="delimiter">(</a><a href="../icode/analysis/CopyPropagation.scala.html#720157" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="761413">loc2</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
                      <a href="#761246" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#695942" title="(oldInstr: ClosureElimination.this.global.icodes.Instruction, is: List[ClosureElimination.this.global.icodes.Instruction])Boolean">replaceInstruction</a><span class="delimiter">(</span><a href="#761267" title="ClosureElimination.this.global.icodes.Instruction">i</a>, <a href="../icode/Opcodes.scala.html#704125" title="(typ: ClosureElimination.this.global.icodes.TypeKind)ClosureElimination.this.global.icodes.opcodes.DROP">DROP</a><span class="delimiter">(</span><a href="../../Global.scala.html#537466" title="ClosureElimination.this.global.icodes.type">icodes</a>.<a href="../icode/ICodes.scala.html#614902" title="=&gt; ClosureElimination.this.global.icodes.TypeKind">ObjectReference</a><span class="delimiter">)</span> <a href="../../../../collection/immutable/List.scala.html#62685" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <a href="#761169" title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction">valueToInstruction</a><span class="delimiter">(</span><a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#720470" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a><span class="delimiter">(</span><a href="#761413" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc2</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../collection/immutable/List.scala.html#62685" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <a href="../../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>
                      <a href="../../Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;replaced &quot;)" class="string">&quot;replaced &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#761267" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; with &quot;)" class="string">&quot; with &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#720470" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a><span class="delimiter">(</span><a href="#761413" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc2</a><span class="delimiter">)</span><span class="delimiter">)</span>
                    <span class="keyword">case</span> _ =&gt;
                      <a href="#3319590" title="(x: Unit)Unit" class="delimiter">(</a><span class="delimiter">)</span>
                  <span class="delimiter">}</span>
                <span class="keyword">case</span> Boxed<a href="../../../../collection/immutable/List.scala.html#206583" title="ClosureElimination.this.global.copyPropagation.Value" id="3319609" class="delimiter">(</a>LocalVar<a href="../icode/analysis/CopyPropagation.scala.html#720348" title="ClosureElimination.this.global.copyPropagation.Location" id="3319611" class="delimiter">(</a><a href="../icode/analysis/CopyPropagation.scala.html#720157" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="761439">loc1</a><span class="delimiter">)</span><span class="delimiter">)</span> :: <a href="../../../../collection/immutable/List.scala.html#206584" title="List[ClosureElimination.this.global.copyPropagation.Value]" id="3319605">_</a> =&gt;
                  <span class="keyword">val</span> <a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="761440">loc2</a> = <a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#720469" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.global.icodes.Local">getAlias</a><span class="delimiter">(</span><a href="#761439" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc1</a><span class="delimiter">)</span>
                  <a href="#761246" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#695942" title="(oldInstr: ClosureElimination.this.global.icodes.Instruction, is: List[ClosureElimination.this.global.icodes.Instruction])Boolean">replaceInstruction</a><span class="delimiter">(</span><a href="#761267" title="ClosureElimination.this.global.icodes.Instruction">i</a>, <a href="../icode/Opcodes.scala.html#704125" title="(typ: ClosureElimination.this.global.icodes.TypeKind)ClosureElimination.this.global.icodes.opcodes.DROP">DROP</a><span class="delimiter">(</span><a href="../../Global.scala.html#537466" title="ClosureElimination.this.global.icodes.type">icodes</a>.<a href="../icode/ICodes.scala.html#614902" title="=&gt; ClosureElimination.this.global.icodes.TypeKind">ObjectReference</a><span class="delimiter">)</span> <a href="../../../../collection/immutable/List.scala.html#62685" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <a href="#761169" title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction">valueToInstruction</a><span class="delimiter">(</span><a href="../icode/analysis/CopyPropagation.scala.html#720549" title="(l: ClosureElimination.this.global.copyPropagation.Location)ClosureElimination.this.global.copyPropagation.Deref">Deref</a><span class="delimiter">(</span><a href="../icode/analysis/CopyPropagation.scala.html#720526" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.LocalVar">LocalVar</a><span class="delimiter">(</span><a href="#761440" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc2</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../collection/immutable/List.scala.html#62685" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <a href="../../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>
                  <a href="../../Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;replaced &quot;)" class="string">&quot;replaced &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#761267" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; with &quot;)" class="string">&quot; with &quot;</span> <span title="(x$1: Any)String">+</span> <a href="../icode/analysis/CopyPropagation.scala.html#720526" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.LocalVar">LocalVar</a><span class="delimiter">(</span><a href="#761440" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc2</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="keyword">case</span> _ =&gt;
              <span class="delimiter">}</span>

            <span class="keyword">case</span> _ =&gt;
          <span class="delimiter">}</span>
          <a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a> = <a href="#761165" title="=&gt; ClosureElimination.this.global.copyPropagation.CopyAnalysis">cpp</a>.<a href="../icode/analysis/CopyPropagation.scala.html#721006" title="(in: ClosureElimination.this.global.copyPropagation.copyLattice.Elem, i: ClosureElimination.this.global.copyPropagation.global.icodes.Instruction)ClosureElimination.this.global.copyPropagation.copyLattice.Elem">interpret</a><span class="delimiter">(</span><a href="#761247" title="ClosureElim.this.cpp.lattice.Elem">info</a>, <a href="#761267" title="ClosureElimination.this.global.icodes.Instruction">i</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="761464">e</a>: <a href="../icode/analysis/LubException.scala.html#30981" title="scala.tools.nsc.backend.icode.analysis.LubException">LubException</a> =&gt;
        <a href="../../../../Console.scala.html#136" title="Console.type">Console</a>.<a href="../../../../Console.scala.html#63314" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;In method: &quot;)" class="string">&quot;In method: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#761211" title="ClosureElimination.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
        <a href="../../../../Console.scala.html#136" title="Console.type">Console</a>.<a href="../../../../Console.scala.html#63314" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="#761464" title="scala.tools.nsc.backend.icode.analysis.LubException">e</a><span class="delimiter">)</span>
        <a href="#761464" title="scala.tools.nsc.backend.icode.analysis.LubException">e</a>.<span title="()Unit">printStackTrace</span>
    <span class="delimiter">}</span>

    /* Partial mapping from values to instructions that load them. */
    <span class="keyword">def</span> <a title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction" id="761169">valueToInstruction</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.copyPropagation.Value" id="761298">v</a>: <a href="../icode/analysis/CopyPropagation.scala.html#619541" title="ClosureElimination.this.global.copyPropagation.Value">Value</a><span class="delimiter">)</span>: <a href="../icode/Opcodes.scala.html#614966" title="ClosureElimination.this.global.icodes.Instruction">Instruction</a> = <span class="delimiter">(</span><a href="#761298" title="ClosureElimination.this.global.copyPropagation.Value">v</a>: @<a href="../icode/analysis/CopyPropagation.scala.html#619541" title="ClosureElimination.this.global.copyPropagation.Value @unchecked">unchecked</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Deref<a href="#3319643" title="Boolean" id="3319646" class="delimiter">(</a>LocalVar<a href="../icode/analysis/CopyPropagation.scala.html#720313" title="ClosureElimination.this.global.copyPropagation.Location" id="3319648" class="delimiter">(</a><a href="../icode/analysis/CopyPropagation.scala.html#720157" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="761474">v</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <a href="../icode/Opcodes.scala.html#703701" title="(local: ClosureElimination.this.global.icodes.Local)ClosureElimination.this.global.icodes.opcodes.LOAD_LOCAL">LOAD_LOCAL</a><a href="#3319663" title="(x: ClosureElimination.this.global.icodes.Instruction)ClosureElimination.this.global.icodes.Instruction" class="delimiter">(</a><a href="#761474" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">v</a><span class="delimiter">)</span>
      <span class="keyword">case</span> Const<a href="#3319643" title="ClosureElimination.this.global.icodes.Instruction" id="3319650" class="delimiter">(</a><a href="../icode/analysis/CopyPropagation.scala.html#720383" title="ClosureElimination.this.global.copyPropagation.global.Constant" id="761477">k</a><span class="delimiter">)</span> =&gt;
        <a href="../icode/Opcodes.scala.html#704288" title="(constant: ClosureElimination.this.global.icodes.global.Constant)ClosureElimination.this.global.icodes.opcodes.CONSTANT">CONSTANT</a><a href="#3319663" title="(x: ClosureElimination.this.global.icodes.Instruction)ClosureElimination.this.global.icodes.Instruction" class="delimiter">(</a><a href="#761477" title="ClosureElimination.this.global.copyPropagation.global.Constant">k</a><span class="delimiter">)</span>
      <span class="keyword">case</span> Deref<span class="delimiter">(</span><a href="../icode/analysis/CopyPropagation.scala.html#720313" title="ClosureElimination.this.global.copyPropagation.Location" id="3319660">This</a><span class="delimiter">)</span> =&gt;
        <a href="../icode/Opcodes.scala.html#705565" title="(clasz: ClosureElimination.this.global.icodes.global.Symbol)ClosureElimination.this.global.icodes.opcodes.THIS">THIS</a><a href="#3319663" title="(x: ClosureElimination.this.global.icodes.Instruction)ClosureElimination.this.global.icodes.Instruction" class="delimiter">(</a><a href="../../../../reflect/internal/Definitions.scala.html#407777" title="ClosureElimination.this.global.definitions.type">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#408671" title="=&gt; ClosureElimination.this.global.ClassSymbol">ObjectClass</a><span class="delimiter">)</span>
      <span class="keyword">case</span> Boxed<a href="#3319643" title="ClosureElimination.this.global.icodes.Instruction" id="3319657" class="delimiter">(</a>LocalVar<a href="../icode/analysis/CopyPropagation.scala.html#720348" title="ClosureElimination.this.global.copyPropagation.Location" id="3319659" class="delimiter">(</a><a href="../icode/analysis/CopyPropagation.scala.html#720157" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="761486">v</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <a href="../icode/Opcodes.scala.html#703701" title="(local: ClosureElimination.this.global.icodes.Local)ClosureElimination.this.global.icodes.opcodes.LOAD_LOCAL">LOAD_LOCAL</a><a href="#3319663" title="(x: ClosureElimination.this.global.icodes.Instruction)ClosureElimination.this.global.icodes.Instruction" class="delimiter">(</a><a href="#761486" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">v</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    /** is field 'f' accessible from method 'm'? */
    <span class="keyword">def</span> <a title="(f: ClosureElimination.this.global.Symbol, m: ClosureElimination.this.global.Symbol)Boolean" id="761170">accessible</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.Symbol" id="761488">f</a>: <a href="../../../../reflect/internal/Symbols.scala.html#407146" title="ClosureElimination.this.global.Symbol">Symbol</a>, <a title="ClosureElimination.this.global.Symbol" id="761489">m</a>: <a href="../../../../reflect/internal/Symbols.scala.html#407146" title="ClosureElimination.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../../Boolean.scala.html#1425" title="Boolean">Boolean</a> =
      <a href="#761488" title="ClosureElimination.this.global.Symbol">f</a>.<a href="../../../../reflect/internal/HasFlags.scala.html#409868" title="=&gt; Boolean">isPublic</a> <a href="../../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#761488" title="ClosureElimination.this.global.Symbol">f</a>.<a href="../../../../reflect/internal/HasFlags.scala.html#409866" title="=&gt; Boolean">isProtected</a> <a href="../../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#761488" title="ClosureElimination.this.global.Symbol">f</a>.<a href="../../../../reflect/internal/Symbols.scala.html#411445" title="=&gt; ClosureElimination.this.global.Symbol">enclosingPackageClass</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#761489" title="ClosureElimination.this.global.Symbol">m</a>.<a href="../../../../reflect/internal/Symbols.scala.html#411445" title="=&gt; ClosureElimination.this.global.Symbol">enclosingPackageClass</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span> /* class ClosureElim */


  /** Peephole optimization. */
  <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class PeepholeOpt extends Object" id="622943">PeepholeOpt</a> <a href="#622943" title="ClosureElimination.this.PeepholeOpt" class="delimiter">{</a>

    <span class="keyword">private</span> <span class="keyword">var</span> <a title="ClosureElimination.this.global.icodes.IMethod" id="760918">method</a>: <a href="../icode/Members.scala.html#614927" title="ClosureElimination.this.global.icodes.IMethod">IMethod</a> = <a href="../icode/Members.scala.html#614925" title="ClosureElimination.this.global.icodes.NoIMethod.type">NoIMethod</a>

    /** Concrete implementations will perform their optimizations here */
    <span class="keyword">def</span> <a title="(bb: ClosureElimination.this.global.icodes.BasicBlock, i1: ClosureElimination.this.global.icodes.Instruction, i2: ClosureElimination.this.global.icodes.Instruction)Option[List[ClosureElimination.this.global.icodes.Instruction]]" id="760920">peep</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.BasicBlock" id="760931">bb</a>: <a href="../icode/BasicBlocks.scala.html#614938" title="ClosureElimination.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="ClosureElimination.this.global.icodes.Instruction" id="760932">i1</a>: <a href="../icode/Opcodes.scala.html#614966" title="ClosureElimination.this.global.icodes.Instruction">Instruction</a>, <a title="ClosureElimination.this.global.icodes.Instruction" id="760933">i2</a>: <a href="../icode/Opcodes.scala.html#614966" title="ClosureElimination.this.global.icodes.Instruction">Instruction</a><span class="delimiter">)</span>: <a href="../../../../Option.scala.html#978" title="Option[List[ClosureElimination.this.global.icodes.Instruction]]">Option</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Instruction<span class="delimiter">]</span><span class="delimiter">]</span>

    <span class="keyword">var</span> <a title="ClosureElimination.this.global.icodes.liveness.LivenessAnalysis" id="760922">liveness</a>: global.icodes.liveness.<a href="../icode/analysis/Liveness.scala.html#712139" title="ClosureElimination.this.global.icodes.liveness.LivenessAnalysis">LivenessAnalysis</a> = <span title="Null(null)" class="keyword">null</span>

    <span class="keyword">def</span> <a title="(m: ClosureElimination.this.global.icodes.IMethod)Unit" id="760924">apply</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.IMethod" id="761212">m</a>: <a href="../icode/Members.scala.html#614927" title="ClosureElimination.this.global.icodes.IMethod">IMethod</a><span class="delimiter">)</span>: <a href="../../../../Unit.scala.html#1515" title="Unit">Unit</a> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#761212" title="ClosureElimination.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#696027" title="=&gt; Boolean">hasCode</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#760918" title="(x$1: ClosureElimination.this.global.icodes.IMethod)Unit">method</a> = <a href="#761212" title="ClosureElimination.this.global.icodes.IMethod">m</a>
      <a href="#760922" title="(x$1: ClosureElimination.this.global.icodes.liveness.LivenessAnalysis)Unit">liveness</a> = <span title="ClosureElimination.this.global.icodes.liveness.LivenessAnalysis" class="keyword">new</span> <a href="../../SubComponent.scala.html#620039" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../../Global.scala.html#537466" title="ClosureElimination.this.global.icodes.type">icodes</a>.<a href="../icode/ICodes.scala.html#614890" title="ClosureElimination.this.global.icodes.liveness.type">liveness</a>.<a href="../icode/analysis/Liveness.scala.html#712139" title="ClosureElimination.this.global.icodes.liveness.LivenessAnalysis">LivenessAnalysis</a>
      <a href="#760922" title="=&gt; ClosureElimination.this.global.icodes.liveness.LivenessAnalysis">liveness</a>.<a href="../icode/analysis/Liveness.scala.html#722679" title="(m: ClosureElimination.this.global.icodes.liveness.global.icodes.IMethod)Unit">init</a><span class="delimiter">(</span><a href="#761212" title="ClosureElimination.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
      <a href="#760922" title="=&gt; ClosureElimination.this.global.icodes.liveness.LivenessAnalysis">liveness</a>.<a href="../icode/analysis/Liveness.scala.html#722682" title="()Unit">run</a>
      <a href="#761212" title="ClosureElimination.this.global.icodes.IMethod">m</a> <a href="../icode/Members.scala.html#695997" title="(f: ClosureElimination.this.global.icodes.BasicBlock =&gt; Unit)Unit">foreachBlock</a> <a href="#760925" title="(b: ClosureElimination.this.global.icodes.BasicBlock)Unit">transformBlock</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(b: ClosureElimination.this.global.icodes.BasicBlock)Unit" id="760925">transformBlock</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.BasicBlock" id="761509">b</a>: <a href="../icode/BasicBlocks.scala.html#614938" title="ClosureElimination.this.global.icodes.BasicBlock">BasicBlock</a><span class="delimiter">)</span>: <a href="../../../../Unit.scala.html#1515" title="Unit">Unit</a> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#761509" title="ClosureElimination.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#695938" title="=&gt; Int">size</a> <a href="../../../../Int.scala.html#57132" title="(x: Int)Boolean">&gt;=</a> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="List[ClosureElimination.this.global.icodes.Instruction]" id="761517">newInstructions</a>: <a href="../../../../collection/immutable/List.scala.html#11952" title="List[ClosureElimination.this.global.icodes.Instruction]">List</a><span class="delimiter">[</span>Instruction<span class="delimiter">]</span> = <a href="#761509" title="ClosureElimination.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#695929" title="=&gt; List[ClosureElimination.this.global.icodes.Instruction]">toList</a>
      <span class="keyword">var</span> <a title="Boolean" id="761518">redo</a> = <span title="Boolean(false)" class="keyword">false</span>

      <a href="#761519" title="Unit" class="keyword">do</a> <span class="delimiter">{</span>
        <span class="keyword">var</span> <a title="ClosureElimination.this.global.icodes.Instruction" id="761520">h</a> = <a href="#761517" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstructions</a>.<a href="../../../../collection/IterableLike.scala.html#58577" title="=&gt; ClosureElimination.this.global.icodes.Instruction">head</a>
        <span class="keyword">var</span> <a title="List[ClosureElimination.this.global.icodes.Instruction]" id="761521">t</a> = <a href="#761517" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstructions</a>.<a href="../../../../collection/TraversableLike.scala.html#58104" title="=&gt; List[ClosureElimination.this.global.icodes.Instruction]">tail</a>
        <span class="keyword">var</span> <a title="List[ClosureElimination.this.global.icodes.Instruction]" id="761522">seen</a>: <a href="../../../../collection/immutable/List.scala.html#11952" title="List[ClosureElimination.this.global.icodes.Instruction]">List</a><span class="delimiter">[</span>Instruction<span class="delimiter">]</span> = <a href="../../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a>
        <a href="#761518" title="Boolean">redo</a> = <span title="Boolean(false)" class="keyword">false</span>

        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#761521" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span> <a href="#761527" title="()Unit" class="delimiter">{</a>
          <a href="#760920" title="(bb: ClosureElimination.this.global.icodes.BasicBlock, i1: ClosureElimination.this.global.icodes.Instruction, i2: ClosureElimination.this.global.icodes.Instruction)Option[List[ClosureElimination.this.global.icodes.Instruction]]">peep</a><a href="#3319678" title="(x: Unit)Unit" class="delimiter">(</a><a href="#761509" title="ClosureElimination.this.global.icodes.BasicBlock">b</a>, <a href="#761520" title="ClosureElimination.this.global.icodes.Instruction">h</a>, <a href="#761521" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a>.<a href="../../../../collection/IterableLike.scala.html#58577" title="=&gt; ClosureElimination.this.global.icodes.Instruction">head</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> Some<a href="#3319673" title="Unit" id="3319674" class="delimiter">(</a><a href="../../../../Option.scala.html#63132" title="List[ClosureElimination.this.global.icodes.Instruction]" id="761535">newInstrs</a><span class="delimiter">)</span> =&gt;
              <a href="#761517" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstructions</a> = <a href="#761522" title="List[ClosureElimination.this.global.icodes.Instruction]">seen</a> <a href="../../../../collection/immutable/List.scala.html#62691" title="(prefix: List[ClosureElimination.this.global.icodes.Instruction])List[ClosureElimination.this.global.icodes.Instruction]">reverse_:::</a> <a href="#761535" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstrs</a> <a href="../../../../collection/immutable/List.scala.html#62688" title="(prefix: List[ClosureElimination.this.global.icodes.Instruction])List[ClosureElimination.this.global.icodes.Instruction]">:::</a> <a href="#761521" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a>.<a href="../../../../collection/TraversableLike.scala.html#58104" title="=&gt; List[ClosureElimination.this.global.icodes.Instruction]">tail</a>
              <a href="#761518" title="Boolean">redo</a> = <span title="Boolean(true)" class="keyword">true</span>
            <span class="keyword">case</span> <a href="../../../../Option.scala.html#1585" title="Unit" id="3319676">None</a> =&gt;
            	<a href="#3319678" title="(x: Unit)Unit" class="delimiter">(</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#761522" title="List[ClosureElimination.this.global.icodes.Instruction]">seen</a> = <a href="#761520" title="ClosureElimination.this.global.icodes.Instruction">h</a> <a href="../../../../collection/immutable/List.scala.html#62685" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <a href="#761522" title="List[ClosureElimination.this.global.icodes.Instruction]">seen</a>
          <a href="#761520" title="ClosureElimination.this.global.icodes.Instruction">h</a> = <a href="#761521" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a>.<a href="../../../../collection/IterableLike.scala.html#58577" title="=&gt; ClosureElimination.this.global.icodes.Instruction">head</a>
          <a href="#761521" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a> = <a href="#761521" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a>.<a href="../../../../collection/TraversableLike.scala.html#58104" title="=&gt; List[ClosureElimination.this.global.icodes.Instruction]">tail</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><a href="#761518" title="Boolean">redo</a><span class="delimiter">)</span>;
      <a href="#761509" title="ClosureElimination.this.global.icodes.BasicBlock">b</a> <a href="../icode/BasicBlocks.scala.html#695932" title="(is: List[ClosureElimination.this.global.icodes.Instruction])Unit">fromList</a> <a href="#761517" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstructions</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span title="Object" class="delimiter">}</span> /* class ClosureElimination */

        </pre>
    </body>
</html>