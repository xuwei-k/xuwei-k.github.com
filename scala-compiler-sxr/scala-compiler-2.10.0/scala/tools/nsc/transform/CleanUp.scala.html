<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/transform/CleanUp.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2013 LAMP/EPFL
 * @author Martin Odersky
 */

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> transform

<span class="keyword">import</span> symtab._
<span class="keyword">import</span> <a href="../symtab/package.scala.html#55820" title="=&gt; reflect.internal.Flags.type">Flags</a>._
<span class="keyword">import</span> scala.collection._
<span class="keyword">import</span> scala.<a href="../../../language.scala.html#1423" title="language.type">language</a>.postfixOps

<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class CleanUp extends scala.tools.nsc.SubComponent with scala.tools.nsc.transform.Transform with scala.tools.nsc.ast.TreeDSL" id="44373">CleanUp</a> <a href="#44373" title="scala.tools.nsc.transform.CleanUp" class="keyword">extends</a> <a href="Transform.scala.html#43152" title="scala.tools.nsc.transform.Transform">Transform</a> <span class="keyword">with</span> ast.<a href="../ast/TreeDSL.scala.html#28843" title="scala.tools.nsc.ast.TreeDSL">TreeDSL</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#538231" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#407777" title="CleanUp.this.global.definitions.type">definitions</a>._
  <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#538235" title="CleanUp.this.CODE.type">CODE</a>._

  /** the following two members override abstract members in Transform */
  <span class="keyword">val</span> <a title="String" id="622687">phaseName</a>: <span title="String">String</span> = <span title="String(&quot;cleanup&quot;)" class="string">&quot;cleanup&quot;</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(unit: CleanUp.this.global.CompilationUnit)CleanUp.this.global.Transformer" id="622689">newTransformer</a><span class="delimiter">(</span><a title="CleanUp.this.global.CompilationUnit" id="976363">unit</a>: <a href="../CompilationUnits.scala.html#537766" title="CleanUp.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span>: <a href="../ast/Trees.scala.html#537817" title="CleanUp.this.global.Transformer">Transformer</a> =
    <span title="CleanUp.this.CleanUpTransformer" class="keyword">new</span> <a href="#622690" title="CleanUp.this.CleanUpTransformer">CleanUpTransformer</a><span class="delimiter">(</span><a href="#976363" title="CleanUp.this.global.CompilationUnit">unit</a><span class="delimiter">)</span>

  <span class="keyword">class</span> <a title="class CleanUpTransformer extends CleanUp.this.global.Transformer" id="622690">CleanUpTransformer</a><a href="#622690" title="CleanUp.this.CleanUpTransformer" class="delimiter">(</a><a title="CleanUp.this.global.CompilationUnit" id="976399">unit</a>: <a href="../CompilationUnits.scala.html#537766" title="CleanUp.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../ast/Trees.scala.html#537817" title="CleanUp.this.global.Transformer">Transformer</a> <span class="delimiter">{</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[CleanUp.this.global.Tree]" id="976370">newStaticMembers</a>      = mutable.<a href="../../../collection/mutable/Buffer.scala.html#12427" title="scala.collection.mutable.Buffer.type">Buffer</a>.<a href="../../../collection/generic/GenericCompanion.scala.html#59930" title="[A]=&gt; scala.collection.mutable.Buffer[A]">empty</a><span title="scala.collection.mutable.Buffer[CleanUp.this.global.Tree]" class="delimiter">[</span><a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a><span class="delimiter">]</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[CleanUp.this.global.Tree]" id="976372">newStaticInits</a>        = mutable.<a href="../../../collection/mutable/Buffer.scala.html#12427" title="scala.collection.mutable.Buffer.type">Buffer</a>.<a href="../../../collection/generic/GenericCompanion.scala.html#59930" title="[A]=&gt; scala.collection.mutable.Buffer[A]">empty</a><span title="scala.collection.mutable.Buffer[CleanUp.this.global.Tree]" class="delimiter">[</span><a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a><span class="delimiter">]</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[String,CleanUp.this.global.Symbol]" id="976374">symbolsStoredAsStatic</a> = mutable.<a href="../../../collection/mutable/Map.scala.html#12499" title="scala.collection.mutable.Map.type">Map</a>.<a href="../../../collection/mutable/Map.scala.html#174225" title="[A, B]=&gt; scala.collection.mutable.Map[A,B]">empty</a><span title="scala.collection.mutable.Map[String,CleanUp.this.global.Symbol]" class="delimiter">[</span><span title="String">String</span>, <a href="../../../reflect/internal/Symbols.scala.html#407146" title="CleanUp.this.global.Symbol">Symbol</a><span class="delimiter">]</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="976376">clearStatics</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#976370" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticMembers</a>.<a href="../../../collection/mutable/BufferLike.scala.html#66917" title="()Unit">clear</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#976372" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticInits</a>.<a href="../../../collection/mutable/BufferLike.scala.html#66917" title="()Unit">clear</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#976374" title="=&gt; scala.collection.mutable.Map[String,CleanUp.this.global.Symbol]">symbolsStoredAsStatic</a>.<a href="../../../collection/mutable/MapLike.scala.html#87628" title="()Unit">clear</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](body: =&gt; T)T" id="976377">savingStatics</a><span class="delimiter">[</span><a title="" id="976379">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; T" id="976406">body</a>: =&gt; T<span class="delimiter">)</span>: <a href="#976379" title="T">T</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[CleanUp.this.global.Tree]" id="976408">savedNewStaticMembers</a> : mutable.<a href="../../../collection/mutable/Buffer.scala.html#12426" title="scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">Buffer</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = <a href="#976370" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticMembers</a>.<a href="../../../collection/mutable/BufferLike.scala.html#66938" title="()scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">clone</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[CleanUp.this.global.Tree]" id="976409">savedNewStaticInits</a>   : mutable.<a href="../../../collection/mutable/Buffer.scala.html#12426" title="scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">Buffer</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = <a href="#976372" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticInits</a>.<a href="../../../collection/mutable/BufferLike.scala.html#66938" title="()scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">clone</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.Map[String,CleanUp.this.global.Symbol]" id="976410">savedSymbolsStoredAsStatic</a> : mutable.<a href="../../../collection/mutable/Map.scala.html#12498" title="scala.collection.mutable.Map[String,CleanUp.this.global.Symbol]">Map</a><span class="delimiter">[</span>String, Symbol<span class="delimiter">]</span> = <a href="#976374" title="=&gt; scala.collection.mutable.Map[String,CleanUp.this.global.Symbol]">symbolsStoredAsStatic</a>.<a href="../../../collection/mutable/MapLike.scala.html#87632" title="()scala.collection.mutable.Map[String,CleanUp.this.global.Symbol]">clone</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="T" id="976411">result</a> = <a href="#976406" title="=&gt; T">body</a>

      <a href="#976376" title="()Unit">clearStatics</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#976370" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticMembers</a>      <a href="../../../collection/generic/Growable.scala.html#60003" title="(xs: scala.collection.TraversableOnce[CleanUp.this.global.Tree])CleanUpTransformer.this.newStaticMembers.type">++=</a> <a href="#976408" title="scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">savedNewStaticMembers</a>
      <a href="#976372" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticInits</a>        <a href="../../../collection/generic/Growable.scala.html#60003" title="(xs: scala.collection.TraversableOnce[CleanUp.this.global.Tree])CleanUpTransformer.this.newStaticInits.type">++=</a> <a href="#976409" title="scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">savedNewStaticInits</a>
      <a href="#976374" title="=&gt; scala.collection.mutable.Map[String,CleanUp.this.global.Symbol]">symbolsStoredAsStatic</a> <a href="../../../collection/generic/Growable.scala.html#60003" title="(xs: scala.collection.TraversableOnce[(String, CleanUp.this.global.Symbol)])CleanUpTransformer.this.symbolsStoredAsStatic.type">++=</a> <a href="#976410" title="scala.collection.mutable.Map[String,CleanUp.this.global.Symbol]">savedSymbolsStoredAsStatic</a>

      <a href="#976411" title="T">result</a>
    <span class="delimiter">}</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Template" id="976380">transformTemplate</a><span class="delimiter">(</span><a title="CleanUp.this.global.Tree" id="976415">tree</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> Template<a href="#3357219" title="(List[CleanUp.this.global.Tree], CleanUp.this.global.ValDef, List[CleanUp.this.global.Tree])" id="3357221" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410203" title="List[CleanUp.this.global.Tree]" id="976418">parents</a>, <a href="../../../reflect/internal/Trees.scala.html#410205" title="CleanUp.this.global.ValDef" id="976419">self</a>, <a href="../../../reflect/internal/Trees.scala.html#410207" title="List[CleanUp.this.global.Tree]" id="976420">body</a><span class="delimiter">)</span> = <a href="#976415" title="CleanUp.this.global.Tree">tree</a>
      <a href="#976376" title="()Unit">clearStatics</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="List[CleanUp.this.global.Tree]" id="976421">newBody</a> = <a href="../../../reflect/api/Trees.scala.html#405653" title="(trees: List[CleanUp.this.global.Tree])List[CleanUp.this.global.Tree]">transformTrees</a><span class="delimiter">(</span><a href="#976420" title="List[CleanUp.this.global.Tree]">body</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="CleanUp.this.global.Template" id="976422">templ</a>   = <a href="../../../reflect/internal/Trees.scala.html#408158" title="(templ: CleanUp.this.global.Tree)(applyToBody: List[CleanUp.this.global.Tree] =&gt; List[CleanUp.this.global.Tree])CleanUp.this.global.Template">deriveTemplate</a><span class="delimiter">(</span><a href="#976415" title="CleanUp.this.global.Tree">tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="List[CleanUp.this.global.Tree]" id="976456">_</a> =&gt; <a href="../../../reflect/api/Trees.scala.html#405653" title="(trees: List[CleanUp.this.global.Tree])List[CleanUp.this.global.Tree]">transformTrees</a><span class="delimiter">(</span><a href="#976370" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticMembers</a>.<a href="../../../collection/TraversableOnce.scala.html#58263" title="=&gt; List[CleanUp.this.global.Tree]">toList</a><span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#62688" title="(prefix: List[CleanUp.this.global.Tree])List[CleanUp.this.global.Tree]">:::</a> <a href="#976421" title="List[CleanUp.this.global.Tree]">newBody</a><span class="delimiter">)</span>
      <span class="keyword">try</span> <a href="#976398" title="(template: CleanUp.this.global.Template)CleanUp.this.global.Template">addStaticInits</a><span class="delimiter">(</span><a href="#976422" title="CleanUp.this.global.Template">templ</a><span class="delimiter">)</span> // postprocess to include static ctors
      <span class="keyword">finally</span> <a href="#976376" title="()Unit">clearStatics</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(prefix: String)CleanUp.this.global.TermName" id="976381">mkTerm</a><span class="delimiter">(</span><a title="String" id="976464">prefix</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../reflect/internal/Names.scala.html#406879" title="CleanUp.this.global.TermName">TermName</a> = <a href="#976399" title="CleanUp.this.global.CompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#539276" title="(prefix: String)CleanUp.this.global.TermName">freshTermName</a><span class="delimiter">(</span><a href="#976464" title="String">prefix</a><span class="delimiter">)</span>

    //private val classConstantMeth = new HashMap[String, Symbol]
    //private val symbolStaticFields = new HashMap[String, (Symbol, Tree, Tree)]

    <span class="keyword">private</span> <span class="keyword">var</span> <a title="CleanUp.this.global.analyzer.Typer" id="976383">localTyper</a>: analyzer.<a href="../typechecker/Typers.scala.html#538117" title="CleanUp.this.global.analyzer.Typer">Typer</a> = <span title="Null(null)" class="keyword">null</span>

    <span class="keyword">private</span> <span class="keyword">object</span> <a title="CleanUpTransformer.this.MethodDispatchType.type" id="976385">MethodDispatchType</a> <a href="#976386" title="CleanUpTransformer.this.MethodDispatchType.type" class="keyword">extends</a> scala.<a href="../../../Enumeration.scala.html#66" title="Enumeration">Enumeration</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.tools.nsc.transform.CleanUp.CleanUpTransformer.MethodDispatchType.Value" id="976466">NO_CACHE</a>, <a title="scala.tools.nsc.transform.CleanUp.CleanUpTransformer.MethodDispatchType.Value" id="976468">MONO_CACHE</a>, <a title="scala.tools.nsc.transform.CleanUp.CleanUpTransformer.MethodDispatchType.Value" id="976470">POLY_CACHE</a> = <a href="../../../Enumeration.scala.html#87250" title="=&gt; scala.tools.nsc.transform.CleanUp.CleanUpTransformer.MethodDispatchType.Value">Value</a>
    <span class="delimiter">}</span>
    <span class="keyword">import</span> <a href="#976385" title="CleanUpTransformer.this.MethodDispatchType.type">MethodDispatchType</a>.<span class="delimiter">{</span> NO_CACHE, MONO_CACHE, POLY_CACHE <span class="delimiter">}</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()CleanUpTransformer.this.MethodDispatchType.Value" id="976388">dispatchType</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="../Global.scala.html#537448" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#540109" title="=&gt; scala.tools.nsc.Settings#ChoiceSetting">refinementMethodDispatch</a>.<a href="../../../reflect/internal/settings/MutableSettings.scala.html#423752" title="=&gt; String">value</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#3357227" title="CleanUpTransformer.this.MethodDispatchType.Value" id="3357234" class="string">&quot;no-cache&quot;</a>   =&gt; <a href="#3357238" title="(x: CleanUpTransformer.this.MethodDispatchType.Value)CleanUpTransformer.this.MethodDispatchType.Value">NO_CACHE</a>
      <span class="keyword">case</span> <a href="#3357227" title="CleanUpTransformer.this.MethodDispatchType.Value" id="3357235" class="string">&quot;mono-cache&quot;</a> =&gt; <a href="#3357238" title="(x: CleanUpTransformer.this.MethodDispatchType.Value)CleanUpTransformer.this.MethodDispatchType.Value">MONO_CACHE</a>
      <span class="keyword">case</span> <a href="#3357227" title="CleanUpTransformer.this.MethodDispatchType.Value" id="3357236" class="string">&quot;poly-cache&quot;</a> =&gt; <a href="#3357238" title="(x: CleanUpTransformer.this.MethodDispatchType.Value)CleanUpTransformer.this.MethodDispatchType.Value">POLY_CACHE</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(tree: CleanUp.this.global.Try)Boolean" id="976389">shouldRewriteTry</a><span class="delimiter">(</span><a title="CleanUp.this.global.Try" id="976507">tree</a>: <a href="../../../reflect/internal/Trees.scala.html#408020" title="CleanUp.this.global.Try">Try</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="CleanUp.this.global.Symbol" id="976508">sym</a> = <a href="#976507" title="CleanUp.this.global.Try">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; CleanUp.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#408407" title="=&gt; CleanUp.this.global.Symbol">typeSymbol</a>
      <a href="../Global.scala.html#537757" title="=&gt; Boolean">forMSIL</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#976508" title="CleanUp.this.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/internal/Definitions.scala.html#409353" title="=&gt; CleanUp.this.global.ClassSymbol">UnitClass</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#976508" title="CleanUp.this.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/internal/Definitions.scala.html#408692" title="CleanUp.this.global.definitions.NothingClass.type">NothingClass</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(pos: CleanUp.this.global.Position)(tree: CleanUp.this.global.Tree)CleanUp.this.global.analyzer.global.Tree" id="976390">typedWithPos</a><span class="delimiter">(</span><a title="CleanUp.this.global.Position" id="976518">pos</a>: <a href="../../../reflect/internal/util/Position.scala.html#22953" title="CleanUp.this.global.Position">Position</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="CleanUp.this.global.Tree" id="976519">tree</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a><span class="delimiter">)</span> =
      <a href="#976383" title="=&gt; CleanUp.this.global.analyzer.Typer">localTyper</a>.<a href="../typechecker/Typers.scala.html#538703" title="(pos: CleanUp.this.global.analyzer.global.Position)(tree: CleanUp.this.global.analyzer.global.Tree)CleanUp.this.global.analyzer.global.Tree">typedPos</a><span class="delimiter">(</span><a href="#976518" title="CleanUp.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#976519" title="CleanUp.this.global.Tree">tree</a><span class="delimiter">)</span>

    /** A value class is defined to be only Java-compatible values: unit is
      * not part of it, as opposed to isPrimitiveValueClass in definitions. scala.Int is
      * a value class, java.lang.Integer is not. */
    <span class="keyword">def</span> <a title="(sym: CleanUp.this.global.Symbol)Boolean" id="976391">isJavaValueClass</a><span class="delimiter">(</span><a title="CleanUp.this.global.Symbol" id="976574">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="CleanUp.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <a href="../../../reflect/internal/Definitions.scala.html#409340" title="=&gt; Map[CleanUp.this.global.Symbol,CleanUp.this.global.ClassSymbol]">boxedClass</a> <a href="../../../collection/MapLike.scala.html#87536" title="(key: CleanUp.this.global.Symbol)Boolean">contains</a> <a href="#976574" title="CleanUp.this.global.Symbol">sym</a>
    <span class="keyword">def</span> <a title="(tp: CleanUp.this.global.Type)Boolean" id="976392">isJavaValueType</a><span class="delimiter">(</span><a title="CleanUp.this.global.Type" id="976577">tp</a>: <a href="../../../reflect/internal/Types.scala.html#407270" title="CleanUp.this.global.Type">Type</a><span class="delimiter">)</span> = <a href="#976391" title="(sym: CleanUp.this.global.Symbol)Boolean">isJavaValueClass</a><span class="delimiter">(</span><a href="#976577" title="CleanUp.this.global.Type">tp</a>.<a href="../../../reflect/internal/Types.scala.html#408407" title="=&gt; CleanUp.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span>

    /** The boxed type if it's a primitive; identity otherwise.
     */
    <span class="keyword">def</span> <a title="(tp: CleanUp.this.global.Type)CleanUp.this.global.Type" id="976393">toBoxedType</a><span class="delimiter">(</span><a title="CleanUp.this.global.Type" id="976578">tp</a>: <a href="../../../reflect/internal/Types.scala.html#407270" title="CleanUp.this.global.Type">Type</a><span class="delimiter">)</span> = <span title="CleanUp.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#976392" title="(tp: CleanUp.this.global.Type)Boolean">isJavaValueType</a><span class="delimiter">(</span><a href="#976578" title="CleanUp.this.global.Type">tp</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../collection/MapLike.scala.html#87535" title="(key: CleanUp.this.global.Symbol)CleanUp.this.global.ClassSymbol">boxedClass</a><span class="delimiter">(</span><a href="#976578" title="CleanUp.this.global.Type">tp</a>.<a href="../../../reflect/internal/Types.scala.html#408407" title="=&gt; CleanUp.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a> <span class="keyword">else</span> <a href="#976578" title="CleanUp.this.global.Type">tp</a>

    <span class="keyword">def</span> <a title="(ad: CleanUp.this.global.ApplyDynamic)CleanUp.this.global.analyzer.global.Tree" id="976394">transformApplyDynamic</a><span class="delimiter">(</span><a title="CleanUp.this.global.ApplyDynamic" id="976601">ad</a>: <a href="../../../reflect/internal/Trees.scala.html#408042" title="CleanUp.this.global.ApplyDynamic">ApplyDynamic</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="CleanUp.this.global.Tree" id="976602">qual0</a> = <a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#454094" title="=&gt; CleanUp.this.global.Tree">qual</a>
      <span class="keyword">val</span> <a title="List[CleanUp.this.global.Tree]" id="976603">params</a> = <a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#454096" title="=&gt; List[CleanUp.this.global.Tree]">args</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../Global.scala.html#537448" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#539975" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">logReflectiveCalls</a>.<a href="../settings/MutableSettings.scala.html#541066" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
          <a href="#976399" title="CleanUp.this.global.CompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#539297" title="(pos: CleanUp.this.global.Position, msg: String)Unit">echo</a><span class="delimiter">(</span><a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; CleanUp.this.global.Position">pos</a>, <span title="String(&quot;method invocation uses reflection&quot;)" class="string">&quot;method invocation uses reflection&quot;</span><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="CleanUp.this.global.Tree =&gt; CleanUp.this.global.analyzer.global.Tree" id="976604">typedPos</a> = <a href="#976390" title="(pos: CleanUp.this.global.Position)(tree: CleanUp.this.global.Tree)CleanUp.this.global.analyzer.global.Tree">typedWithPos</a><a href="#976620" title="CleanUp.this.global.Tree" class="delimiter">(</a><a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; CleanUp.this.global.Position">pos</a><span class="delimiter">)</span> _

        <a href="../Global.scala.html#537498" title="(assertion: Boolean)Unit">assert</a><span class="delimiter">(</span><a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#409939" title="=&gt; CleanUp.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/HasFlags.scala.html#409868" title="=&gt; Boolean">isPublic</a><span class="delimiter">)</span>
        <span class="keyword">var</span> <a title="CleanUp.this.global.Tree" id="976605">qual</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a> = <a href="#976602" title="CleanUp.this.global.Tree">qual0</a>

        /* ### CREATING THE METHOD CACHE ### */

        <span class="keyword">def</span> <a title="(forName: CleanUp.this.global.TermName, forType: CleanUp.this.global.Type, forInit: CleanUp.this.global.Tree, isFinal: Boolean)CleanUp.this.global.Symbol" id="976606">addStaticVariableToClass</a><span class="delimiter">(</span><a title="CleanUp.this.global.TermName" id="976625">forName</a>: <a href="../../../reflect/internal/Names.scala.html#406879" title="CleanUp.this.global.TermName">TermName</a>, <a title="CleanUp.this.global.Type" id="976626">forType</a>: <a href="../../../reflect/internal/Types.scala.html#407270" title="CleanUp.this.global.Type">Type</a>, <a title="CleanUp.this.global.Tree" id="976627">forInit</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a>, <a title="Boolean" id="976628">isFinal</a>: <a href="../../../Boolean.scala.html#1425" title="Boolean">Boolean</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="CleanUp.this.global.Symbol">Symbol</a> = <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Int" id="976629">flags</a> = PRIVATE | STATIC <span title="Int(10485764)">|</span> SYNTHETIC <a href="../../../Int.scala.html#57139" title="(x: Int)Int">|</a> <span class="delimiter">(</span>
            <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#976628" title="Boolean">isFinal</a><span class="delimiter">)</span> <span title="Int(32)">FINAL</span> <span class="keyword">else</span> <span title="Int(0)" class="int">0</span>
          <span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="CleanUp.this.global.TermSymbol" id="976630">varSym</a> = <a href="../../../reflect/api/Trees.scala.html#405651" title="=&gt; CleanUp.this.global.Symbol">currentClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411110" title="(name: CleanUp.this.global.TermName, pos: CleanUp.this.global.Position, newFlags: Long)CleanUp.this.global.TermSymbol">newVariable</a><span class="delimiter">(</span><a href="#976381" title="(prefix: String)CleanUp.this.global.TermName">mkTerm</a><span class="delimiter">(</span><span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#976625" title="CleanUp.this.global.TermName">forName</a><span class="delimiter">)</span>, <a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; CleanUp.this.global.Position">pos</a>, <a href="../../../Int.scala.html#57081" title="=&gt; Long">flags</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Symbols.scala.html#411373" title="(info: CleanUp.this.global.Type)CleanUp.this.global.TermSymbol">setInfoAndEnter</a> <a href="#976626" title="CleanUp.this.global.Type">forType</a>
          <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#976628" title="Boolean">isFinal</a><span class="delimiter">)</span>
            <a href="#976630" title="CleanUp.this.global.TermSymbol">varSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411406" title="(sym: CleanUp.this.global.Symbol, args: CleanUp.this.global.Tree*)varSym.type">addAnnotation</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#409209" title="=&gt; CleanUp.this.global.ClassSymbol">VolatileAttr</a><span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="CleanUp.this.global.analyzer.global.Tree" id="976631">varDef</a> = <a href="../../../Function1.scala.html#58642" title="(v1: CleanUp.this.global.Tree)CleanUp.this.global.analyzer.global.Tree">typedPos</a><span class="delimiter">(</span> <a href="../ast/TreeDSL.scala.html#624596" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.CODE.ValSymStart">VAL</a><span class="delimiter">(</span><a href="#976630" title="CleanUp.this.global.TermSymbol">varSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#663071" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.ValDef">===</a> <a href="#976627" title="CleanUp.this.global.Tree">forInit</a> <span class="delimiter">)</span>
          <a href="#976370" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticMembers</a> <a href="../../../collection/mutable/BufferLike.scala.html#66924" title="(elems: CleanUp.this.global.Tree*)Unit">append</a> <a href="#976395" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#976631" title="CleanUp.this.global.analyzer.global.Tree">varDef</a><span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="CleanUp.this.global.analyzer.global.Tree" id="976632">varInit</a> = <a href="../../../Function1.scala.html#58642" title="(v1: CleanUp.this.global.Tree)CleanUp.this.global.analyzer.global.Tree">typedPos</a><span class="delimiter">(</span> <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="#976630" title="CleanUp.this.global.TermSymbol">varSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662341" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.Assign">===</a> <a href="#976627" title="CleanUp.this.global.Tree">forInit</a> <span class="delimiter">)</span>
          <a href="#976372" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticInits</a> <a href="../../../collection/mutable/BufferLike.scala.html#66924" title="(elems: CleanUp.this.global.Tree*)Unit">append</a> <a href="#976395" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#976632" title="CleanUp.this.global.analyzer.global.Tree">varInit</a><span class="delimiter">)</span>

          <a href="#976630" title="CleanUp.this.global.TermSymbol">varSym</a>
        <span class="delimiter">}</span>

        <span class="keyword">def</span> <a title="(forBody: (CleanUp.this.global.Symbol, CleanUp.this.global.Symbol) =&gt; CleanUp.this.global.Tree)CleanUp.this.global.Symbol" id="976607">addStaticMethodToClass</a><span class="delimiter">(</span><a title="(CleanUp.this.global.Symbol, CleanUp.this.global.Symbol) =&gt; CleanUp.this.global.Tree" id="976705">forBody</a>: <span class="delimiter">(</span>Symbol, Symbol<span class="delimiter">)</span> =&gt; Tree<span class="delimiter">)</span>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="CleanUp.this.global.Symbol">Symbol</a> = <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="CleanUp.this.global.MethodSymbol" id="976706">methSym</a> = <a href="../../../reflect/api/Trees.scala.html#405651" title="=&gt; CleanUp.this.global.Symbol">currentClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411113" title="(name: CleanUp.this.global.TermName, pos: CleanUp.this.global.Position, newFlags: Long)CleanUp.this.global.MethodSymbol">newMethod</a><span class="delimiter">(</span><a href="#976381" title="(prefix: String)CleanUp.this.global.TermName">mkTerm</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#407855" title="implicit scala.reflect.internal.StdNames.lowerTermNames : (n: CleanUp.this.global.TermName)String">reflMethodName</a><span class="delimiter">)</span>, <a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; CleanUp.this.global.Position">pos</a>, STATIC <span title="Long(10485760L)">|</span> SYNTHETIC<span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="List[CleanUp.this.global.TermSymbol]" id="976707">params</a>  = <a href="#976706" title="CleanUp.this.global.MethodSymbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411137" title="(argtypes: List[CleanUp.this.global.Type])List[CleanUp.this.global.TermSymbol]">newSyntheticValueParams</a><span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#62451" title="(xs: CleanUp.this.global.Type*)List[CleanUp.this.global.Type]">List</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408726" title="=&gt; CleanUp.this.global.ClassSymbol">ClassClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#976706" title="CleanUp.this.global.MethodSymbol">methSym</a> <a href="../../../reflect/internal/Symbols.scala.html#411373" title="(info: CleanUp.this.global.Type)methSym.type">setInfoAndEnter</a> <a href="../../../reflect/internal/Types.scala.html#420479" title="(params: List[CleanUp.this.global.Symbol], resultType: CleanUp.this.global.Type)CleanUp.this.global.MethodType">MethodType</a><span class="delimiter">(</span><a href="#976707" title="List[CleanUp.this.global.TermSymbol]">params</a>, <a href="../../../reflect/internal/Definitions.scala.html#408875" title="=&gt; CleanUp.this.global.ClassSymbol">MethodClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a><span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="CleanUp.this.global.analyzer.global.Tree" id="976708">methDef</a> = <a href="../../../Function1.scala.html#58642" title="(v1: CleanUp.this.global.Tree)CleanUp.this.global.analyzer.global.Tree">typedPos</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#408109" title="(sym: CleanUp.this.global.Symbol, rhs: CleanUp.this.global.Tree)CleanUp.this.global.DefDef">DefDef</a><span class="delimiter">(</span><a href="#976706" title="CleanUp.this.global.MethodSymbol">methSym</a>, <a href="../../../Function2.scala.html#65848" title="(v1: CleanUp.this.global.Symbol, v2: CleanUp.this.global.Symbol)CleanUp.this.global.Tree">forBody</a><span class="delimiter">(</span><a href="#976706" title="CleanUp.this.global.MethodSymbol">methSym</a>, <a href="#976707" title="List[CleanUp.this.global.TermSymbol]">params</a>.<a href="../../../collection/IterableLike.scala.html#58577" title="=&gt; CleanUp.this.global.TermSymbol">head</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#976370" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticMembers</a> <a href="../../../collection/mutable/BufferLike.scala.html#66924" title="(elems: CleanUp.this.global.Tree*)Unit">append</a> <a href="#976395" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#976708" title="CleanUp.this.global.analyzer.global.Tree">methDef</a><span class="delimiter">)</span>
          <a href="#976706" title="CleanUp.this.global.MethodSymbol">methSym</a>
        <span class="delimiter">}</span>

        <span class="keyword">def</span> <a title="(paramTypes: List[CleanUp.this.global.Type])CleanUp.this.global.Tree" id="976608">fromTypesToClassArrayLiteral</a><span class="delimiter">(</span><a title="List[CleanUp.this.global.Type]" id="976790">paramTypes</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[CleanUp.this.global.Type]">List</a><span class="delimiter">[</span>Type<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a> =
          <a href="../../../reflect/internal/Trees.scala.html#453354" title="(elemtpt: CleanUp.this.global.Tree, elems: List[CleanUp.this.global.Tree])CleanUp.this.global.ArrayValue">ArrayValue</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#408087" title="(tp: CleanUp.this.global.Type)CleanUp.this.global.TypeTree">TypeTree</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408726" title="=&gt; CleanUp.this.global.ClassSymbol">ClassClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a><span class="delimiter">)</span>, <a href="#976790" title="List[CleanUp.this.global.Type]">paramTypes</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: CleanUp.this.global.Type =&gt; CleanUp.this.global.Literal)(implicit bf: scala.collection.generic.CanBuildFrom[List[CleanUp.this.global.Type],CleanUp.this.global.Literal,List[CleanUp.this.global.Tree]])List[CleanUp.this.global.Tree]">map</a> <a href="../ast/TreeDSL.scala.html#624552" title="CleanUp.this.CODE.LIT.type">LIT</a><span class="delimiter">)</span>

        /* ... */
        <span class="keyword">def</span> <a title="(method: String, paramTypes: List[CleanUp.this.global.Type])CleanUp.this.global.Symbol" id="976609">reflectiveMethodCache</a><span class="delimiter">(</span><a title="String" id="976842">method</a>: <span title="String">String</span>, <a title="List[CleanUp.this.global.Type]" id="976843">paramTypes</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[CleanUp.this.global.Type]">List</a><span class="delimiter">[</span>Type<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="CleanUp.this.global.Symbol">Symbol</a> = <a href="#976388" title="()CleanUpTransformer.this.MethodDispatchType.Value">dispatchType</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="#976466" title="CleanUp.this.global.Symbol" id="3357260">NO_CACHE</a> =&gt;

              /* Implementation of the cache is as follows for method &quot;def xyz(a: A, b: B)&quot;:

                var reflParams$Cache: Array[Class[_]] = Array[JClass](classOf[A], classOf[B])

                def reflMethod$Method(forReceiver: JClass[_]): JMethod =
                  forReceiver.getMethod(&quot;xyz&quot;, reflParams$Cache)

              */

              <span class="keyword">val</span> <a title="CleanUp.this.global.Symbol" id="976844">reflParamsCacheSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="CleanUp.this.global.Symbol">Symbol</a> =
                <a href="#976606" title="(forName: CleanUp.this.global.TermName, forType: CleanUp.this.global.Type, forInit: CleanUp.this.global.Tree, isFinal: Boolean)CleanUp.this.global.Symbol">addStaticVariableToClass</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414764" title="=&gt; CleanUp.this.global.nme.NameType">reflParamsCacheName</a>, <a href="../../../reflect/internal/Definitions.scala.html#409025" title="(arg: CleanUp.this.global.Type)CleanUp.this.global.Type">arrayType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408726" title="=&gt; CleanUp.this.global.ClassSymbol">ClassClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a><span class="delimiter">)</span>, <a href="#976608" title="(paramTypes: List[CleanUp.this.global.Type])CleanUp.this.global.Tree">fromTypesToClassArrayLiteral</a><span class="delimiter">(</span><a href="#976843" title="List[CleanUp.this.global.Type]">paramTypes</a><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

              <a href="#976607" title="(forBody: (CleanUp.this.global.Symbol, CleanUp.this.global.Symbol) =&gt; CleanUp.this.global.Tree)CleanUp.this.global.Symbol">addStaticMethodToClass</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="CleanUp.this.global.Symbol" id="976847">_</a>, <a title="CleanUp.this.global.Symbol" id="976848">forReceiverSym</a><span class="delimiter">)</span> =&gt;
                <a href="../Global.scala.html#537460" title="CleanUp.this.global.gen.type">gen</a>.<a href="../../../reflect/internal/TreeGen.scala.html#470982" title="(receiver: CleanUp.this.global.gen.global.Tree, method: CleanUp.this.global.gen.global.Symbol, targs: List[CleanUp.this.global.gen.global.Type], args: List[CleanUp.this.global.gen.global.Tree])CleanUp.this.global.gen.global.Tree">mkMethodCall</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#976848" title="CleanUp.this.global.Symbol">forReceiverSym</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/Definitions.scala.html#408728" title="=&gt; CleanUp.this.global.TermSymbol">Class_getMethod</a>, <a href="../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a>, <a href="../../../collection/immutable/List.scala.html#62451" title="(xs: CleanUp.this.global.gen.global.Tree*)List[CleanUp.this.global.gen.global.Tree]">List</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#662273" title="(x: Any)CleanUp.this.global.Literal">LIT</a><span class="delimiter">(</span><a href="#976842" title="String">method</a><span class="delimiter">)</span>, <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#976844" title="CleanUp.this.global.Symbol">reflParamsCacheSym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">)</span>

            <span class="keyword">case</span> <a href="#976468" title="CleanUp.this.global.Symbol" id="3357261">MONO_CACHE</a> =&gt;

              /* Implementation of the cache is as follows for method &quot;def xyz(a: A, b: B)&quot;
                 (but with a SoftReference wrapping reflClass$Cache, similarly in the poly Cache) :

                var reflParams$Cache: Array[Class[_]] = Array[JClass](classOf[A], classOf[B])

                var reflMethod$Cache: JMethod = null

                var reflClass$Cache: JClass[_] = null

                def reflMethod$Method(forReceiver: JClass[_]): JMethod = {
                  if (reflClass$Cache != forReceiver) {
                    reflMethod$Cache = forReceiver.getMethod(&quot;xyz&quot;, reflParams$Cache)
                    reflClass$Cache = forReceiver
                  }
                  reflMethod$Cache
                }

              */

              <span class="keyword">val</span> <a title="CleanUp.this.global.Symbol" id="976910">reflParamsCacheSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="CleanUp.this.global.Symbol">Symbol</a> =
                <a href="#976606" title="(forName: CleanUp.this.global.TermName, forType: CleanUp.this.global.Type, forInit: CleanUp.this.global.Tree, isFinal: Boolean)CleanUp.this.global.Symbol">addStaticVariableToClass</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414764" title="=&gt; CleanUp.this.global.nme.NameType">reflParamsCacheName</a>, <a href="../../../reflect/internal/Definitions.scala.html#409025" title="(arg: CleanUp.this.global.Type)CleanUp.this.global.Type">arrayType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408726" title="=&gt; CleanUp.this.global.ClassSymbol">ClassClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a><span class="delimiter">)</span>, <a href="#976608" title="(paramTypes: List[CleanUp.this.global.Type])CleanUp.this.global.Tree">fromTypesToClassArrayLiteral</a><span class="delimiter">(</span><a href="#976843" title="List[CleanUp.this.global.Type]">paramTypes</a><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

              <span class="keyword">val</span> <a title="CleanUp.this.global.Symbol" id="976911">reflMethodCacheSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="CleanUp.this.global.Symbol">Symbol</a> =
                <a href="#976606" title="(forName: CleanUp.this.global.TermName, forType: CleanUp.this.global.Type, forInit: CleanUp.this.global.Tree, isFinal: Boolean)CleanUp.this.global.Symbol">addStaticVariableToClass</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414766" title="=&gt; CleanUp.this.global.nme.NameType">reflMethodCacheName</a>, <a href="../../../reflect/internal/Definitions.scala.html#408875" title="=&gt; CleanUp.this.global.ClassSymbol">MethodClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a>, <a href="../ast/TreeDSL.scala.html#624560" title="=&gt; CleanUp.this.global.Literal">NULL</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

              <span class="keyword">val</span> <a title="CleanUp.this.global.Symbol" id="976912">reflClassCacheSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="CleanUp.this.global.Symbol">Symbol</a> =
                <a href="#976606" title="(forName: CleanUp.this.global.TermName, forType: CleanUp.this.global.Type, forInit: CleanUp.this.global.Tree, isFinal: Boolean)CleanUp.this.global.Symbol">addStaticVariableToClass</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414762" title="=&gt; CleanUp.this.global.nme.NameType">reflClassCacheName</a>, <a href="../../../reflect/internal/Definitions.scala.html#408871" title="=&gt; CleanUp.this.global.ClassSymbol">SoftReferenceClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a>, <a href="../ast/TreeDSL.scala.html#624560" title="=&gt; CleanUp.this.global.Literal">NULL</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

              <span class="keyword">def</span> <a title="(receiver: CleanUp.this.global.Symbol)CleanUp.this.global.Tree" id="976913">isCacheEmpty</a><span class="delimiter">(</span><a title="CleanUp.this.global.Symbol" id="976914">receiver</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="CleanUp.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a> =
                <a href="../ast/TreeDSL.scala.html#624618" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkSymbolMethodsFromSymbol : (target: CleanUp.this.global.Symbol)CleanUp.this.CODE.SymbolMethods">reflClassCacheSym</a>.<a href="../ast/TreeDSL.scala.html#663504" title="()CleanUp.this.global.Apply">IS_NULL</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662315" title="(other: CleanUp.this.global.Tree)CleanUp.this.global.Tree">OR</a> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624618" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkSymbolMethodsFromSymbol : (target: CleanUp.this.global.Symbol)CleanUp.this.CODE.SymbolMethods">reflClassCacheSym</a>.<a href="../ast/TreeDSL.scala.html#663506" title="()CleanUp.this.global.Apply">GET</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662324" title="(other: CleanUp.this.global.Tree)CleanUp.this.global.Apply">OBJ_NE</a> <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#976914" title="CleanUp.this.global.Symbol">receiver</a><span class="delimiter">)</span><span class="delimiter">)</span>

              <a href="#976607" title="(forBody: (CleanUp.this.global.Symbol, CleanUp.this.global.Symbol) =&gt; CleanUp.this.global.Tree)CleanUp.this.global.Symbol">addStaticMethodToClass</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="CleanUp.this.global.Symbol" id="976938">_</a>, <a title="CleanUp.this.global.Symbol" id="976939">forReceiverSym</a><span class="delimiter">)</span> =&gt;
                <a href="../ast/TreeDSL.scala.html#624607" title="(xs: CleanUp.this.global.Tree*)CleanUp.this.global.Block">BLOCK</a><span class="delimiter">(</span>
                  <a href="../ast/TreeDSL.scala.html#624605" title="(tree: CleanUp.this.global.Tree)CleanUp.this.CODE.IfStart">IF</a> <span class="delimiter">(</span><a href="#976913" title="(receiver: CleanUp.this.global.Symbol)CleanUp.this.global.Tree">isCacheEmpty</a><span class="delimiter">(</span><a href="#976939" title="CleanUp.this.global.Symbol">forReceiverSym</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662292" title="(x: CleanUp.this.global.Tree)CleanUp.this.CODE.IfStart">THEN</a> <a href="../ast/TreeDSL.scala.html#624607" title="(xs: CleanUp.this.global.Tree*)CleanUp.this.global.Block">BLOCK</a><span class="delimiter">(</span>
                    <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="#976911" title="CleanUp.this.global.Symbol">reflMethodCacheSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662341" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.Assign">===</a> <span class="delimiter">(</span><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="#976939" title="CleanUp.this.global.Symbol">forReceiverSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662306" title="(args: CleanUp.this.global.Tree*)CleanUp.this.global.Apply">DOT</a> <a href="../../../reflect/internal/Definitions.scala.html#408728" title="=&gt; CleanUp.this.global.TermSymbol">Class_getMethod</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#662273" title="(x: Any)CleanUp.this.global.Literal">LIT</a><span class="delimiter">(</span><a href="#976842" title="String">method</a><span class="delimiter">)</span>, <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#976910" title="CleanUp.this.global.Symbol">reflParamsCacheSym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> ,
                    <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="#976912" title="CleanUp.this.global.Symbol">reflClassCacheSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662341" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.Assign">===</a> <a href="../Global.scala.html#537460" title="CleanUp.this.global.gen.type">gen</a>.<a href="../ast/TreeGen.scala.html#543459" title="(expr: CleanUp.this.global.gen.global.Tree)CleanUp.this.global.gen.global.Tree">mkSoftRef</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#976939" title="CleanUp.this.global.Symbol">forReceiverSym</a><span class="delimiter">)</span><span class="delimiter">)</span>,
                    <a href="../ast/TreeDSL.scala.html#624561" title="=&gt; CleanUp.this.global.Literal">UNIT</a>
                  <span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662294" title="=&gt; CleanUp.this.global.If">ENDIF</a>,
                  <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#976911" title="CleanUp.this.global.Symbol">reflMethodCacheSym</a><span class="delimiter">)</span>
                <span class="delimiter">)</span>
              <span class="delimiter">)</span>

            <span class="keyword">case</span> <a href="#976470" title="CleanUp.this.global.Symbol" id="3357262">POLY_CACHE</a> =&gt;

              /* Implementation of the cache is as follows for method &quot;def xyz(a: A, b: B)&quot;
                 (SoftReference so that it does not interfere with classloader garbage collection, see ticket
                 #2365 for details):

                var reflParams$Cache: Array[Class[_]] = Array[JClass](classOf[A], classOf[B])

                var reflPoly$Cache: SoftReference[scala.runtime.MethodCache] = new SoftReference(new EmptyMethodCache())

                def reflMethod$Method(forReceiver: JClass[_]): JMethod = {
                  var method: JMethod = reflPoly$Cache.find(forReceiver)
                  if (method != null)
                    return method
                  else {
                    method = ScalaRunTime.ensureAccessible(forReceiver.getMethod(&quot;xyz&quot;, reflParams$Cache))
                    reflPoly$Cache = new SoftReference(reflPoly$Cache.get.add(forReceiver, method))
                    return method
                  }
                }

              */

              <span class="keyword">val</span> <a title="CleanUp.this.global.Symbol" id="976978">reflParamsCacheSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="CleanUp.this.global.Symbol">Symbol</a> =
                <a href="#976606" title="(forName: CleanUp.this.global.TermName, forType: CleanUp.this.global.Type, forInit: CleanUp.this.global.Tree, isFinal: Boolean)CleanUp.this.global.Symbol">addStaticVariableToClass</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414764" title="=&gt; CleanUp.this.global.nme.NameType">reflParamsCacheName</a>, <a href="../../../reflect/internal/Definitions.scala.html#409025" title="(arg: CleanUp.this.global.Type)CleanUp.this.global.Type">arrayType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408726" title="=&gt; CleanUp.this.global.ClassSymbol">ClassClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a><span class="delimiter">)</span>, <a href="#976608" title="(paramTypes: List[CleanUp.this.global.Type])CleanUp.this.global.Tree">fromTypesToClassArrayLiteral</a><span class="delimiter">(</span><a href="#976843" title="List[CleanUp.this.global.Type]">paramTypes</a><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

              <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.gen.global.Tree" id="976979">mkNewPolyCache</a> = <a href="../Global.scala.html#537460" title="CleanUp.this.global.gen.type">gen</a>.<a href="../ast/TreeGen.scala.html#543459" title="(expr: CleanUp.this.global.gen.global.Tree)CleanUp.this.global.gen.global.Tree">mkSoftRef</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624589" title="(tpt: CleanUp.this.global.Tree, args: CleanUp.this.global.Tree*)CleanUp.this.global.Tree">NEW</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#408087" title="(tp: CleanUp.this.global.Type)CleanUp.this.global.TypeTree">TypeTree</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408878" title="=&gt; CleanUp.this.global.ClassSymbol">EmptyMethodCacheClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">val</span> <a title="CleanUp.this.global.Symbol" id="976980">reflPolyCacheSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="CleanUp.this.global.Symbol">Symbol</a> = <span class="delimiter">(</span>
                <a href="#976606" title="(forName: CleanUp.this.global.TermName, forType: CleanUp.this.global.Type, forInit: CleanUp.this.global.Tree, isFinal: Boolean)CleanUp.this.global.Symbol">addStaticVariableToClass</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414760" title="=&gt; CleanUp.this.global.nme.NameType">reflPolyCacheName</a>, <a href="../../../reflect/internal/Definitions.scala.html#408871" title="=&gt; CleanUp.this.global.ClassSymbol">SoftReferenceClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a>, <a href="#976979" title="=&gt; CleanUp.this.global.gen.global.Tree">mkNewPolyCache</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
              <span class="delimiter">)</span>
              <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.gen.global.Tree" id="976981">getPolyCache</a> = <a href="../Global.scala.html#537460" title="CleanUp.this.global.gen.type">gen</a>.<a href="../ast/TreeGen.scala.html#543485" title="(tree: CleanUp.this.global.gen.global.Tree, pt: CleanUp.this.global.gen.global.Type)CleanUp.this.global.gen.global.Tree">mkCast</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624566" title="(lhs: CleanUp.this.global.Tree, op: CleanUp.this.global.Name, args: CleanUp.this.global.Tree*)CleanUp.this.global.Apply">fn</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#976980" title="CleanUp.this.global.Symbol">reflPolyCacheSym</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414381" title="=&gt; CleanUp.this.global.nme.NameType">get</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/Definitions.scala.html#408880" title="=&gt; CleanUp.this.global.ClassSymbol">MethodCacheClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a><span class="delimiter">)</span>

              <a href="#976607" title="(forBody: (CleanUp.this.global.Symbol, CleanUp.this.global.Symbol) =&gt; CleanUp.this.global.Tree)CleanUp.this.global.Symbol">addStaticMethodToClass</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="CleanUp.this.global.Symbol" id="977007">reflMethodSym</a>, <a title="CleanUp.this.global.Symbol" id="977008">forReceiverSym</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="CleanUp.this.global.TermSymbol" id="977009">methodSym</a> = <a href="#977007" title="CleanUp.this.global.Symbol">reflMethodSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411110" title="(name: CleanUp.this.global.TermName, pos: CleanUp.this.global.Position, newFlags: Long)CleanUp.this.global.TermSymbol">newVariable</a><span class="delimiter">(</span><a href="#976381" title="(prefix: String)CleanUp.this.global.TermName">mkTerm</a><span class="delimiter">(</span><span title="String(&quot;method&quot;)" class="string">&quot;method&quot;</span><span class="delimiter">)</span>, <a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; CleanUp.this.global.Position">pos</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Symbols.scala.html#411369" title="(info: CleanUp.this.global.Type)CleanUp.this.global.TermSymbol">setInfo</a> <a href="../../../reflect/internal/Definitions.scala.html#408875" title="=&gt; CleanUp.this.global.ClassSymbol">MethodClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a>

                <a href="../ast/TreeDSL.scala.html#624607" title="(xs: CleanUp.this.global.Tree*)CleanUp.this.global.Block">BLOCK</a><span class="delimiter">(</span>
                  <a href="../ast/TreeDSL.scala.html#624605" title="(tree: CleanUp.this.global.Tree)CleanUp.this.CODE.IfStart">IF</a> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods">getPolyCache</a> <a href="../ast/TreeDSL.scala.html#662323" title="(other: CleanUp.this.global.Tree)CleanUp.this.global.Apply">OBJ_EQ</a> <a href="../ast/TreeDSL.scala.html#624560" title="=&gt; CleanUp.this.global.Literal">NULL</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662292" title="(x: CleanUp.this.global.Tree)CleanUp.this.CODE.IfStart">THEN</a> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="#976980" title="CleanUp.this.global.Symbol">reflPolyCacheSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662341" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.Assign">===</a> <a href="#976979" title="=&gt; CleanUp.this.global.gen.global.Tree">mkNewPolyCache</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662294" title="=&gt; CleanUp.this.global.If">ENDIF</a>,
                  <a href="../ast/TreeDSL.scala.html#624596" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.CODE.ValSymStart">VAL</a><span class="delimiter">(</span><a href="#977009" title="CleanUp.this.global.TermSymbol">methodSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#663071" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.ValDef">===</a> <span class="delimiter">(</span><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods">getPolyCache</a> <a href="../ast/TreeDSL.scala.html#662306" title="(args: CleanUp.this.global.Tree*)CleanUp.this.global.Apply">DOT</a> <a href="../../../reflect/internal/Definitions.scala.html#408882" title="=&gt; CleanUp.this.global.TermSymbol">methodCache_find</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#977008" title="CleanUp.this.global.Symbol">forReceiverSym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> ,
                  <a href="../ast/TreeDSL.scala.html#624605" title="(tree: CleanUp.this.global.Tree)CleanUp.this.CODE.IfStart">IF</a> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="#977009" title="CleanUp.this.global.TermSymbol">methodSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662322" title="(other: CleanUp.this.global.Tree)CleanUp.this.global.Apply">OBJ_!=</a> <a href="../ast/TreeDSL.scala.html#624560" title="=&gt; CleanUp.this.global.Literal">NULL</a><span class="delimiter">)</span> .
                    <a href="../ast/TreeDSL.scala.html#662292" title="(x: CleanUp.this.global.Tree)CleanUp.this.CODE.IfStart">THEN</a> <span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#453672" title="(expr: CleanUp.this.global.Tree)CleanUp.this.global.Return">Return</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#977009" title="CleanUp.this.global.TermSymbol">methodSym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                  <a href="../ast/TreeDSL.scala.html#662293" title="(elsep: CleanUp.this.global.Tree)CleanUp.this.global.If">ELSE</a> <span class="delimiter">{</span>
                    <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.Apply" id="977064">methodSymRHS</a>  = <span class="delimiter">(</span><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="#977008" title="CleanUp.this.global.Symbol">forReceiverSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662306" title="(args: CleanUp.this.global.Tree*)CleanUp.this.global.Apply">DOT</a> <a href="../../../reflect/internal/Definitions.scala.html#408728" title="=&gt; CleanUp.this.global.TermSymbol">Class_getMethod</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#662273" title="(x: Any)CleanUp.this.global.Literal">LIT</a><span class="delimiter">(</span><a href="#976842" title="String">method</a><span class="delimiter">)</span>, <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#976978" title="CleanUp.this.global.Symbol">reflParamsCacheSym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                    <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.Apply" id="977065">cacheRHS</a>      = <span class="delimiter">(</span><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods">getPolyCache</a> <a href="../ast/TreeDSL.scala.html#662306" title="(args: CleanUp.this.global.Tree*)CleanUp.this.global.Apply">DOT</a> <a href="../../../reflect/internal/Definitions.scala.html#408883" title="=&gt; CleanUp.this.global.TermSymbol">methodCache_add</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#977008" title="CleanUp.this.global.Symbol">forReceiverSym</a><span class="delimiter">)</span>, <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#977009" title="CleanUp.this.global.TermSymbol">methodSym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                    <a href="../ast/TreeDSL.scala.html#624607" title="(xs: CleanUp.this.global.Tree*)CleanUp.this.global.Block">BLOCK</a><span class="delimiter">(</span>
                      <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="#977009" title="CleanUp.this.global.TermSymbol">methodSym</a><span class="delimiter">)</span>        <a href="../ast/TreeDSL.scala.html#662341" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.Assign">===</a> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="../../../reflect/internal/Definitions.scala.html#408765" title="=&gt; CleanUp.this.global.TermSymbol">ensureAccessibleMethod</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662336" title="(params: CleanUp.this.global.Tree*)CleanUp.this.global.Apply">APPLY</a> <span class="delimiter">(</span><a href="#977064" title="=&gt; CleanUp.this.global.Apply">methodSymRHS</a><span class="delimiter">)</span><span class="delimiter">)</span>,
                      <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="#976980" title="CleanUp.this.global.Symbol">reflPolyCacheSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662341" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.Assign">===</a> <a href="../Global.scala.html#537460" title="CleanUp.this.global.gen.type">gen</a>.<a href="../ast/TreeGen.scala.html#543459" title="(expr: CleanUp.this.global.gen.global.Tree)CleanUp.this.global.gen.global.Tree">mkSoftRef</a><span class="delimiter">(</span><a href="#977065" title="=&gt; CleanUp.this.global.Apply">cacheRHS</a><span class="delimiter">)</span>,
                      <a href="../../../reflect/internal/Trees.scala.html#453672" title="(expr: CleanUp.this.global.Tree)CleanUp.this.global.Return">Return</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#977009" title="CleanUp.this.global.TermSymbol">methodSym</a><span class="delimiter">)</span><span class="delimiter">)</span>
                    <span class="delimiter">)</span>
                  <span class="delimiter">}</span>
                <span class="delimiter">)</span>
              <span class="delimiter">}</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        /* ### HANDLING METHODS NORMALLY COMPILED TO OPERATORS ### */

        <span class="keyword">def</span> <a title="(name: CleanUp.this.global.Name)CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree" id="976610">testForName</a><span class="delimiter">(</span><a title="CleanUp.this.global.Name" id="977125">name</a>: <a href="../../../reflect/internal/Names.scala.html#406868" title="CleanUp.this.global.Name">Name</a><span class="delimiter">)</span>: Tree =&gt; Tree = <a title="CleanUp.this.global.Tree" id="977127">t</a> =&gt; <span class="delimiter">(</span>
          <span title="CleanUp.this.global.gen.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../collection/GenSetLike.scala.html#66403" title="(elem: CleanUp.this.global.Name)Boolean">CommonOpNames</a><span class="delimiter">(</span><a href="#977125" title="CleanUp.this.global.Name">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="../Global.scala.html#537460" title="CleanUp.this.global.gen.type">gen</a>.<a href="../../../reflect/internal/TreeGen.scala.html#470979" title="(method: CleanUp.this.global.gen.global.Symbol, args: List[CleanUp.this.global.gen.global.Tree])CleanUp.this.global.gen.global.Tree">mkMethodCall</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#407777" title="CleanUp.this.global.definitions.type">definitions</a>.<a href="../../../reflect/internal/Definitions.scala.html#409137" title="=&gt; CleanUp.this.global.Symbol">Boxes_isNumberOrBool</a>, <a href="#977127" title="CleanUp.this.global.Tree">t</a> <a href="../../../collection/immutable/List.scala.html#62685" title="(x: CleanUp.this.global.Tree)List[CleanUp.this.global.Tree]">::</a> <a href="../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>
          <span class="keyword">else</span> <span title="CleanUp.this.global.gen.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../collection/GenSetLike.scala.html#66403" title="(elem: CleanUp.this.global.Name)Boolean">BooleanOpNames</a><span class="delimiter">(</span><a href="#977125" title="CleanUp.this.global.Name">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods">t</a> <a href="../ast/TreeDSL.scala.html#662345" title="(tpe: CleanUp.this.global.Type)CleanUp.this.global.gen.global.Tree">IS_OBJ</a> <a href="../../../reflect/internal/Definitions.scala.html#409123" title="=&gt; CleanUp.this.global.ClassSymbol">BoxedBooleanClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a>
          <span class="keyword">else</span>
            <a href="../Global.scala.html#537460" title="CleanUp.this.global.gen.type">gen</a>.<a href="../../../reflect/internal/TreeGen.scala.html#470979" title="(method: CleanUp.this.global.gen.global.Symbol, args: List[CleanUp.this.global.gen.global.Tree])CleanUp.this.global.gen.global.Tree">mkMethodCall</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#407777" title="CleanUp.this.global.definitions.type">definitions</a>.<a href="../../../reflect/internal/Definitions.scala.html#409139" title="=&gt; CleanUp.this.global.Symbol">Boxes_isNumber</a>, <a href="#977127" title="CleanUp.this.global.Tree">t</a> <a href="../../../collection/immutable/List.scala.html#62685" title="(x: CleanUp.this.global.Tree)List[CleanUp.this.global.Tree]">::</a> <a href="../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>
        <span class="delimiter">)</span>

        /** The Tree =&gt; Tree function in the return is necessary to prevent the original qual
         *  from being duplicated in the resulting code.  It may be a side-effecting expression,
         *  so all the test logic is routed through gen.evalOnce, which creates a block like
         *    { val x$1 = qual; if (x$1.foo || x$1.bar) f1(x$1) else f2(x$1) }
         *  (If the compiler can verify qual is safe to inline, it will not create the block.)
         */
        <span class="keyword">def</span> <a title="(name: CleanUp.this.global.Name)Option[(CleanUp.this.global.Symbol, CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree)]" id="976611">getPrimitiveReplacementForStructuralCall</a><span class="delimiter">(</span><a title="CleanUp.this.global.Name" id="977179">name</a>: <a href="../../../reflect/internal/Names.scala.html#406868" title="CleanUp.this.global.Name">Name</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#978" title="Option[(CleanUp.this.global.Symbol, CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree)]">Option</a><span class="delimiter">[</span><span class="delimiter">(</span>Symbol, Tree =&gt; Tree<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="CleanUp.this.global.TermName" id="977180">methodName</a> = <span class="delimiter">(</span>
            <span title="CleanUp.this.global.TermName" class="keyword">if</span> <span class="delimiter">(</span><a href="#976603" title="List[CleanUp.this.global.Tree]">params</a>.<a href="../../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414736" title="(name: CleanUp.this.global.Name)CleanUp.this.global.TermName">primitivePostfixMethodName</a><span class="delimiter">(</span><a href="#977179" title="CleanUp.this.global.Name">name</a><span class="delimiter">)</span>
            <span class="keyword">else</span> <span title="CleanUp.this.global.TermName" class="keyword">if</span> <span class="delimiter">(</span><a href="#976603" title="List[CleanUp.this.global.Tree]">params</a>.<a href="../../../collection/TraversableLike.scala.html#58104" title="=&gt; List[CleanUp.this.global.Tree]">tail</a>.<a href="../../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414735" title="(name: CleanUp.this.global.Name)CleanUp.this.global.TermName">primitiveInfixMethodName</a><span class="delimiter">(</span><a href="#977179" title="CleanUp.this.global.Name">name</a><span class="delimiter">)</span>
            <span class="keyword">else</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#413712" title="=&gt; CleanUp.this.global.nme.NameType">NO_NAME</a>
          <span class="delimiter">)</span>
          <a href="../../../reflect/internal/Definitions.scala.html#407777" title="CleanUp.this.global.definitions.type">definitions</a>.<a href="../../../reflect/internal/Definitions.scala.html#409270" title="(owner: CleanUp.this.global.Symbol, name: CleanUp.this.global.Name)CleanUp.this.global.Symbol">getDeclIfDefined</a><a href="#3357282" title="CleanUp.this.global.Symbol" class="delimiter">(</a><a href="../../../reflect/internal/Definitions.scala.html#409117" title="=&gt; CleanUp.this.global.Symbol">BoxesRunTimeClass</a>, <a href="#977180" title="CleanUp.this.global.TermName">methodName</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="../../../reflect/internal/Symbols.scala.html#407184" title="Option[(CleanUp.this.global.Symbol, CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree)]" id="3357285">NoSymbol</a> =&gt; <a href="#3357288" title="(x: Option[(CleanUp.this.global.Symbol, CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree)])Option[(CleanUp.this.global.Symbol, CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree)]">None</a>
            <span class="keyword">case</span> sym      =&gt; <a href="../Global.scala.html#537497" title="(assertion: Boolean, message: =&gt; Any)Unit">assert</a><span class="delimiter">(</span><a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a>sym.<a href="../../../reflect/internal/Symbols.scala.html#411206" title="=&gt; Boolean">isOverloaded</a>, sym<span class="delimiter">)</span> ; <a href="../../../Option.scala.html#63128" title="(x: (CleanUp.this.global.Symbol, CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree))Some[(CleanUp.this.global.Symbol, CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree)]">Some</a><span class="delimiter">(</span><a href="../../../Tuple2.scala.html#62849" title="(_1: CleanUp.this.global.Symbol, _2: CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree)(CleanUp.this.global.Symbol, CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree)" class="delimiter">(</a>sym, <a href="#976610" title="(name: CleanUp.this.global.Name)CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree">testForName</a><span class="delimiter">(</span><a href="#977179" title="CleanUp.this.global.Name">name</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        /* ### BOXING PARAMS &amp; UNBOXING RESULTS ### */

        /* Transforms the result of a reflective call (always an AnyRef) to
         * the actual result value (an AnyRef too). The transformation
         * depends on the method's static return type.
         * - for units (void), the reflective call will return null: a new
         *   boxed unit is generated.
         * - otherwise, the value is simply casted to the expected type. This
         *   is enough even for value (int et al.) values as the result of
         *   a dynamic call will box them as a side-effect. */

        /* ### CALLING THE APPLY ### */
        <span class="keyword">def</span> <a title="(paramTypes: List[CleanUp.this.global.Type], resType: CleanUp.this.global.Type)CleanUp.this.global.Tree" id="976612">callAsReflective</a><span class="delimiter">(</span><a title="List[CleanUp.this.global.Type]" id="977199">paramTypes</a>: <a href="../../../collection/immutable/List.scala.html#11952" title="List[CleanUp.this.global.Type]">List</a><span class="delimiter">[</span>Type<span class="delimiter">]</span>, <a title="CleanUp.this.global.Type" id="977200">resType</a>: <a href="../../../reflect/internal/Types.scala.html#407270" title="CleanUp.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
          <a href="../Global.scala.html#537460" title="CleanUp.this.global.gen.type">gen</a>.<a href="../ast/TreeGen.scala.html#543491" title="(expr: CleanUp.this.global.gen.global.Tree, owner: CleanUp.this.global.gen.global.Symbol, unit: CleanUp.this.global.gen.global.CompilationUnit)(within: (() =&gt; CleanUp.this.global.gen.global.Tree) =&gt; CleanUp.this.global.gen.global.Tree)CleanUp.this.global.gen.global.Tree">evalOnce</a><span class="delimiter">(</span><a href="#976605" title="CleanUp.this.global.Tree">qual</a>, <a href="../../../reflect/api/Trees.scala.html#405647" title="=&gt; CleanUp.this.global.Symbol">currentOwner</a>, <a href="#976399" title="CleanUp.this.global.CompilationUnit">unit</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="() =&gt; CleanUp.this.global.gen.global.Tree" id="977206">qual1</a> =&gt;
            /* Some info about the type of the method being called. */
            <span class="keyword">val</span> <a title="CleanUp.this.global.Symbol" id="977207">methSym</a>       = <a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#409939" title="=&gt; CleanUp.this.global.Symbol">symbol</a>
            <span class="keyword">val</span> <a title="CleanUp.this.global.Type" id="977208">boxedResType</a>  = <a href="#976393" title="(tp: CleanUp.this.global.Type)CleanUp.this.global.Type">toBoxedType</a><span class="delimiter">(</span><a href="#977200" title="CleanUp.this.global.Type">resType</a><span class="delimiter">)</span>      // Int -&gt; Integer
            <span class="keyword">val</span> <a title="CleanUp.this.global.Symbol" id="977209">resultSym</a>     = <a href="#977208" title="CleanUp.this.global.Type">boxedResType</a>.<a href="../../../reflect/internal/Types.scala.html#408407" title="=&gt; CleanUp.this.global.Symbol">typeSymbol</a>
            // If this is a primitive method type (like '+' in 5+5=10) then the
            // parameter types and the (unboxed) result type should all be primitive types,
            // and the method name should be in the primitive-&gt;structural map.
            <span class="keyword">def</span> <a title="=&gt; Boolean" id="977210">isJavaValueMethod</a> = <span class="delimiter">(</span>
              <span class="delimiter">(</span><a href="#977200" title="CleanUp.this.global.Type">resType</a> <a href="../../../collection/immutable/List.scala.html#62685" title="(x: CleanUp.this.global.Type)List[CleanUp.this.global.Type]">::</a> <a href="#977199" title="List[CleanUp.this.global.Type]">paramTypes</a> <a href="../../../collection/LinearSeqOptimized.scala.html#86378" title="(p: CleanUp.this.global.Type =&gt; Boolean)Boolean">forall</a> <a href="#976392" title="(tp: CleanUp.this.global.Type)Boolean">isJavaValueType</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> // issue #1110
              <span class="delimiter">(</span><a href="#976611" title="(name: CleanUp.this.global.Name)Option[(CleanUp.this.global.Symbol, CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree)]">getPrimitiveReplacementForStructuralCall</a><span class="delimiter">(</span><a href="#977207" title="CleanUp.this.global.Symbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; methSym.NameType">name</a><span class="delimiter">)</span>.<a href="../../../Option.scala.html#62857" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span>
            <span class="delimiter">)</span>
            // Erasure lets Unit through as Unit, but a method returning Any will have an
            // erased return type of Object and should also allow Unit.
            <span class="keyword">def</span> <a title="=&gt; Boolean" id="977211">isDefinitelyUnit</a>  = <span class="delimiter">(</span><a href="#977209" title="CleanUp.this.global.Symbol">resultSym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#409353" title="=&gt; CleanUp.this.global.ClassSymbol">UnitClass</a><span class="delimiter">)</span>
            <span class="keyword">def</span> <a title="=&gt; Boolean" id="977212">isMaybeUnit</a>       = <span class="delimiter">(</span><a href="#977209" title="CleanUp.this.global.Symbol">resultSym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#408671" title="=&gt; CleanUp.this.global.ClassSymbol">ObjectClass</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="#977211" title="=&gt; Boolean">isDefinitelyUnit</a>
            // If there's any chance this signature could be met by an Array.
            <span class="keyword">val</span> <a title="Boolean" id="977213">isArrayMethodSignature</a> = <span class="delimiter">{</span>
              <span class="keyword">def</span> <a title="=&gt; Boolean" id="977248">typesMatchApply</a> = <a href="#977199" title="List[CleanUp.this.global.Type]">paramTypes</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a href="../../../collection/generic/SeqFactory.scala.html#59986" title="Option[List[CleanUp.this.global.Type]]" id="3357305">List</a><span class="delimiter">(</span><a title="CleanUp.this.global.Type" id="977262">tp</a><span class="delimiter">)</span> =&gt; <a href="#977262" title="CleanUp.this.global.Type">tp</a> <a href="#3357301" title="(x: Boolean)Boolean">&lt;:&lt;</a> <a href="../../../reflect/internal/Definitions.scala.html#409361" title="=&gt; CleanUp.this.global.ClassSymbol">IntClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a>
                <span class="keyword">case</span> _        =&gt; <a href="#3357301" title="(x: Boolean)Boolean" class="keyword">false</a>
              <span class="delimiter">}</span>
              <span class="keyword">def</span> <a title="=&gt; Boolean" id="977249">typesMatchUpdate</a> = <a href="#977199" title="List[CleanUp.this.global.Type]">paramTypes</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a href="../../../collection/generic/SeqFactory.scala.html#59986" title="Option[List[CleanUp.this.global.Type]]" id="3357327">List</a><span class="delimiter">(</span><a title="CleanUp.this.global.Type" id="977273">tp1</a>, <a title="CleanUp.this.global.Type" id="977274">tp2</a><span class="delimiter">)</span> =&gt; <span class="delimiter">(</span><a href="#977273" title="CleanUp.this.global.Type">tp1</a> <a href="../../../reflect/internal/Types.scala.html#408481" title="(that: CleanUp.this.global.Type)Boolean">&lt;:&lt;</a> <a href="../../../reflect/internal/Definitions.scala.html#409361" title="=&gt; CleanUp.this.global.ClassSymbol">IntClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a><span class="delimiter">)</span> <a href="#3357323" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#977212" title="=&gt; Boolean">isMaybeUnit</a>
                <span class="keyword">case</span> _              =&gt; <a href="#3357323" title="(x: Boolean)Boolean" class="keyword">false</a>
              <span class="delimiter">}</span>

              <span class="delimiter">(</span><a href="#977207" title="CleanUp.this.global.Symbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; methSym.NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414419" title="=&gt; CleanUp.this.global.nme.NameType">length</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#976603" title="List[CleanUp.this.global.Tree]">params</a>.<a href="../../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a>
              <span class="delimiter">(</span><a href="#977207" title="CleanUp.this.global.Symbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; methSym.NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414323" title="=&gt; CleanUp.this.global.nme.NameType">clone_</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#976603" title="List[CleanUp.this.global.Tree]">params</a>.<a href="../../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a>
              <span class="delimiter">(</span><a href="#977207" title="CleanUp.this.global.Symbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; methSym.NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414263" title="=&gt; CleanUp.this.global.nme.NameType">apply</a>  <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#977248" title="=&gt; Boolean">typesMatchApply</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a>
              <span class="delimiter">(</span><a href="#977207" title="CleanUp.this.global.Symbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; methSym.NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414583" title="=&gt; CleanUp.this.global.nme.NameType">update</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#977249" title="=&gt; Boolean">typesMatchUpdate</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>

            /* Some info about the argument at the call site. */
            <span class="keyword">val</span> <a title="CleanUp.this.global.Symbol" id="977214">qualSym</a>           = <a href="#976605" title="CleanUp.this.global.Tree">qual</a>.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; CleanUp.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#408407" title="=&gt; CleanUp.this.global.Symbol">typeSymbol</a>
            <span class="keyword">val</span> <a title="List[CleanUp.this.global.Tree]" id="977215">args</a>              = <a href="../../../Function0.scala.html#65930" title="()CleanUp.this.global.gen.global.Tree">qual1</a><span class="delimiter">(</span><span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#62685" title="(x: CleanUp.this.global.Tree)List[CleanUp.this.global.Tree]">::</a> <a href="#976603" title="List[CleanUp.this.global.Tree]">params</a>
            <span class="keyword">def</span> <a title="=&gt; Boolean" id="977216">isDefinitelyArray</a> = <span class="delimiter">(</span><a href="#977214" title="CleanUp.this.global.Symbol">qualSym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#408861" title="=&gt; CleanUp.this.global.ClassSymbol">ArrayClass</a><span class="delimiter">)</span>
            <span class="keyword">def</span> <a title="=&gt; Boolean" id="977217">isMaybeArray</a>      = <span class="delimiter">(</span><a href="#977214" title="CleanUp.this.global.Symbol">qualSym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#408671" title="=&gt; CleanUp.this.global.ClassSymbol">ObjectClass</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="#977216" title="=&gt; Boolean">isDefinitelyArray</a>
            <span class="keyword">def</span> <a title="=&gt; Boolean" id="977218">isMaybeBoxed</a>      = <a href="../Global.scala.html#537454" title="=&gt; CleanUp.this.global.ThisPlatform">platform</a> <a href="../backend/Platform.scala.html#540511" title="(sym: CleanUp.this.global.platform.global.Symbol)Boolean">isMaybeBoxed</a> <a href="#977214" title="CleanUp.this.global.Symbol">qualSym</a>

            // This is complicated a bit by trying to handle Arrays correctly.
            // Under normal circumstances if the erased return type is Object then
            // we're not going to box it to Unit, but that is the situation with
            // a signature like def f(x: { def update(x: Int, y: Long): Any })
            //
            // However we only want to do that boxing if it has been determined
            // to be an Array and a method returning Unit.  But for this fixResult
            // could be called in one place: instead it is called separately from the
            // unconditional outcomes (genValueCall, genArrayCall, genDefaultCall.)
            <span class="keyword">def</span> <a title="(tree: CleanUp.this.global.Tree, mustBeUnit: Boolean)CleanUp.this.global.Tree" id="977219">fixResult</a><span class="delimiter">(</span><a title="CleanUp.this.global.Tree" id="977323">tree</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a>, <a title="Boolean" id="977325">mustBeUnit</a>: <a href="../../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span> =
              <span title="CleanUp.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#977325" title="Boolean">mustBeUnit</a> <a href="../../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="#977209" title="CleanUp.this.global.Symbol">resultSym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#409353" title="=&gt; CleanUp.this.global.ClassSymbol">UnitClass</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#624607" title="(xs: CleanUp.this.global.Tree*)CleanUp.this.global.Block">BLOCK</a><span class="delimiter">(</span><a href="#977323" title="CleanUp.this.global.Tree">tree</a>, <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#409145" title="=&gt; CleanUp.this.global.TermSymbol">BoxedUnit_UNIT</a><span class="delimiter">)</span><span class="delimiter">)</span>  // boxed unit
              <span class="keyword">else</span> <span title="CleanUp.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#977209" title="CleanUp.this.global.Symbol">resultSym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#408671" title="=&gt; CleanUp.this.global.ClassSymbol">ObjectClass</a><span class="delimiter">)</span> <a href="#977323" title="CleanUp.this.global.Tree">tree</a>                                     // no cast necessary
              <span class="keyword">else</span> <a href="../Global.scala.html#537460" title="CleanUp.this.global.gen.type">gen</a>.<a href="../ast/TreeGen.scala.html#543485" title="(tree: CleanUp.this.global.gen.global.Tree, pt: CleanUp.this.global.gen.global.Type)CleanUp.this.global.gen.global.Tree">mkCast</a><span class="delimiter">(</span><a href="#977323" title="CleanUp.this.global.Tree">tree</a>, <a href="#977208" title="CleanUp.this.global.Type">boxedResType</a><span class="delimiter">)</span>                                         // cast to expected type

            /** Normal non-Array call */
            <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.Tree" id="977220">genDefaultCall</a> = <span class="delimiter">{</span>
              // reflective method call machinery
              <span class="keyword">val</span> <a title="CleanUp.this.global.Symbol" id="977336">invokeName</a>  = <a href="../../../reflect/internal/Definitions.scala.html#408875" title="=&gt; CleanUp.this.global.ClassSymbol">MethodClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a> <a href="../../../reflect/internal/Types.scala.html#408451" title="(name: CleanUp.this.global.Name)CleanUp.this.global.Symbol">member</a> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414755" title="=&gt; CleanUp.this.global.TermName">invoke_</a>                                  // scala.reflect.Method.invoke(...)
              <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.gen.global.Tree" id="977337">cache</a>       = <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#976609" title="(method: String, paramTypes: List[CleanUp.this.global.Type])CleanUp.this.global.Symbol">reflectiveMethodCache</a><span class="delimiter">(</span><a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#409939" title="=&gt; CleanUp.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; CleanUp.this.global.Symbol#NameType">name</a>.<span title="()String">toString</span>, <a href="#977199" title="List[CleanUp.this.global.Type]">paramTypes</a><span class="delimiter">)</span><span class="delimiter">)</span>     // cache Symbol
              <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.Apply" id="977338">lookup</a>      = <a href="../../../reflect/internal/Trees.scala.html#413581" title="(fun: CleanUp.this.global.Tree, args: List[CleanUp.this.global.Tree])CleanUp.this.global.Apply">Apply</a><span class="delimiter">(</span><a href="#977337" title="=&gt; CleanUp.this.global.gen.global.Tree">cache</a>, <a href="../../../collection/immutable/List.scala.html#62451" title="(xs: CleanUp.this.global.Apply*)List[CleanUp.this.global.Apply]">List</a><span class="delimiter">(</span><a href="../../../Function0.scala.html#65930" title="()CleanUp.this.global.gen.global.Tree">qual1</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662347" title="()CleanUp.this.global.Apply">GETCLASS</a><span class="delimiter">)</span><span class="delimiter">)</span>                                // get Method object from cache
              <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.ArrayValue" id="977339">invokeArgs</a>  = <a href="../../../reflect/internal/Trees.scala.html#453354" title="(elemtpt: CleanUp.this.global.Tree, elems: List[CleanUp.this.global.Tree])CleanUp.this.global.ArrayValue">ArrayValue</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#408087" title="(tp: CleanUp.this.global.Type)CleanUp.this.global.TypeTree">TypeTree</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408671" title="=&gt; CleanUp.this.global.ClassSymbol">ObjectClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a><span class="delimiter">)</span>, <a href="#976603" title="List[CleanUp.this.global.Tree]">params</a><span class="delimiter">)</span>                       // args for invocation
              <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.Apply" id="977340">invocation</a>  = <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods">lookup</a> <a href="../ast/TreeDSL.scala.html#662306" title="(args: CleanUp.this.global.Tree*)CleanUp.this.global.Apply">DOT</a> <a href="#977336" title="CleanUp.this.global.Symbol">invokeName</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../Function0.scala.html#65930" title="()CleanUp.this.global.gen.global.Tree">qual1</a><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#977339" title="=&gt; CleanUp.this.global.ArrayValue">invokeArgs</a><span class="delimiter">)</span>                        // .invoke(qual1, ...)

              // exception catching machinery
              <span class="keyword">val</span> <a title="CleanUp.this.global.TermSymbol" id="977341">invokeExc</a>   = <a href="../../../reflect/api/Trees.scala.html#405647" title="CleanUp.this.global.Symbol" id="977411">currentOwner</a>.<a href="../../../reflect/internal/Symbols.scala.html#424629" title="Long" id="977417">newValue</a><span class="delimiter">(</span><a href="#976381" title="(prefix: String)CleanUp.this.global.TermName">mkTerm</a><a title="CleanUp.this.global.TermName" id="977415" class="delimiter">(</a><span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>, <a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="CleanUp.this.global.Position" id="977416">pos</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Symbols.scala.html#411369" title="(info: CleanUp.this.global.Type)CleanUp.this.global.TermSymbol">setInfo</a> <a href="../../../reflect/internal/Definitions.scala.html#408704" title="=&gt; CleanUp.this.global.ClassSymbol">InvocationTargetExceptionClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a>
              <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.Bind" id="977342">catchVar</a>    = <a href="../../../reflect/internal/Trees.scala.html#408115" title="(sym: CleanUp.this.global.Symbol, body: CleanUp.this.global.Tree)CleanUp.this.global.Bind">Bind</a><span class="delimiter">(</span><a href="#977341" title="CleanUp.this.global.TermSymbol">invokeExc</a>, <a href="../../../reflect/internal/Trees.scala.html#453846" title="(expr: CleanUp.this.global.Tree, tpt: CleanUp.this.global.Tree)CleanUp.this.global.Typed">Typed</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#418125" title="(name: CleanUp.this.global.Name)CleanUp.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#413714" title="=&gt; CleanUp.this.global.nme.NameType">WILDCARD</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/Trees.scala.html#408087" title="(tp: CleanUp.this.global.Type)CleanUp.this.global.TypeTree">TypeTree</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408704" title="=&gt; CleanUp.this.global.ClassSymbol">InvocationTargetExceptionClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.Throw" id="977343">catchBody</a>   = <a href="../../../reflect/internal/Trees.scala.html#453782" title="(expr: CleanUp.this.global.Tree)CleanUp.this.global.Throw">Throw</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#413581" title="(fun: CleanUp.this.global.Tree, args: List[CleanUp.this.global.Tree])CleanUp.this.global.Apply">Apply</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#418089" title="(qualifier: CleanUp.this.global.Tree, name: CleanUp.this.global.Name)CleanUp.this.global.Select">Select</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#408127" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="#977341" title="CleanUp.this.global.TermSymbol">invokeExc</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414751" title="=&gt; CleanUp.this.global.TermName">getCause</a><span class="delimiter">)</span>, <a href="../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span><span class="delimiter">)</span>

              // try { method.invoke } catch { case e: InvocationTargetExceptionClass =&gt; throw e.getCause() }
              <a href="#977219" title="(tree: CleanUp.this.global.Tree, mustBeUnit: Boolean)CleanUp.this.global.Tree">fixResult</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624606" title="(tree: CleanUp.this.global.Tree)CleanUp.this.CODE.TryStart">TRY</a> <span class="delimiter">(</span><a href="#977340" title="=&gt; CleanUp.this.global.Apply">invocation</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#663433" title="(xs: CleanUp.this.global.CaseDef*)CleanUp.this.CODE.TryStart">CATCH</a> <span class="delimiter">{</span> <a href="../ast/TreeDSL.scala.html#624584" title="(pat: CleanUp.this.global.Tree)CleanUp.this.CODE.CaseStart">CASE</a> <span class="delimiter">(</span><a href="#977342" title="=&gt; CleanUp.this.global.Bind">catchVar</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662968" title="(body: CleanUp.this.global.Tree)CleanUp.this.global.CaseDef">==&gt;</a> <a href="#977343" title="=&gt; CleanUp.this.global.Throw">catchBody</a> <span class="delimiter">}</span> <a href="../ast/TreeDSL.scala.html#663435" title="=&gt; CleanUp.this.global.Try">ENDTRY</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>

            /** A possible primitive method call, represented by methods in BoxesRunTime. */
            <span class="keyword">def</span> <a title="(operator: CleanUp.this.global.Symbol)CleanUp.this.global.Tree" id="977221">genValueCall</a><span class="delimiter">(</span><a title="CleanUp.this.global.Symbol" id="977533">operator</a>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="CleanUp.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <a href="#977219" title="(tree: CleanUp.this.global.Tree, mustBeUnit: Boolean)CleanUp.this.global.Tree">fixResult</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="#977533" title="CleanUp.this.global.Symbol">operator</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662337" title="(params: List[CleanUp.this.global.Tree])CleanUp.this.global.Apply">APPLY</a> <a href="#977215" title="List[CleanUp.this.global.Tree]">args</a><span class="delimiter">)</span>
            <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.Tree" id="977222">genValueCallWithTest</a> = <span class="delimiter">{</span>
              <a href="#976611" title="(name: CleanUp.this.global.Name)Option[(CleanUp.this.global.Symbol, CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree)]">getPrimitiveReplacementForStructuralCall</a><span title="CleanUp.this.global.Tree" class="delimiter">(</span><a href="#977207" title="CleanUp.this.global.Symbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; methSym.NameType">name</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> Some<a href="#3357348" title="CleanUp.this.global.Tree" id="3357350" class="delimiter">(</a><a href="../../../Option.scala.html#63132" title="(CleanUp.this.global.Symbol, CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree)" id="3357349" class="delimiter">(</a><a href="../../../Tuple2.scala.html#60635" title="CleanUp.this.global.Symbol" id="977550">operator</a>, <a href="../../../Tuple2.scala.html#60637" title="CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree" id="977551">test</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
                  <a href="../ast/TreeDSL.scala.html#624605" title="(tree: CleanUp.this.global.Tree)CleanUp.this.CODE.IfStart">IF</a> <span class="delimiter">(</span><a href="../../../Function1.scala.html#58642" title="(v1: CleanUp.this.global.Tree)CleanUp.this.global.Tree">test</a><span class="delimiter">(</span><a href="../../../Function0.scala.html#65930" title="()CleanUp.this.global.gen.global.Tree">qual1</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662292" title="(x: CleanUp.this.global.Tree)CleanUp.this.CODE.IfStart">THEN</a> <a href="#977221" title="(operator: CleanUp.this.global.Symbol)CleanUp.this.global.Tree">genValueCall</a><span class="delimiter">(</span><a href="#977550" title="CleanUp.this.global.Symbol">operator</a><span class="delimiter">)</span> <a href="#3357352" title="(x: CleanUp.this.global.Tree)CleanUp.this.global.Tree">ELSE</a> <a href="#977220" title="=&gt; CleanUp.this.global.Tree">genDefaultCall</a>
                <span class="keyword">case</span> _ =&gt;
                  <a href="#3357352" title="(x: CleanUp.this.global.Tree)CleanUp.this.global.Tree">genDefaultCall</a>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>

            /** A native Array call. */
            <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.Tree" id="977223">genArrayCall</a> = <a href="#977219" title="(tree: CleanUp.this.global.Tree, mustBeUnit: Boolean)CleanUp.this.global.Tree">fixResult</a><span class="delimiter">(</span>
              <a href="#977207" title="CleanUp.this.global.Symbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; methSym.NameType">name</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414419" title="CleanUp.this.global.Tree" id="3357366">length</a> =&gt; <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="../../../collection/MapLike.scala.html#87535" title="(key: CleanUp.this.global.Symbol)CleanUp.this.global.TermSymbol">boxMethod</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#409361" title="=&gt; CleanUp.this.global.ClassSymbol">IntClass</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#3357375" title="(x: CleanUp.this.global.Tree)CleanUp.this.global.Tree">APPLY</a> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="../../../reflect/internal/Definitions.scala.html#408763" title="=&gt; CleanUp.this.global.TermSymbol">arrayLengthMethod</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662337" title="(params: List[CleanUp.this.global.Tree])CleanUp.this.global.Apply">APPLY</a> <a href="#977215" title="List[CleanUp.this.global.Tree]">args</a><span class="delimiter">)</span>
                <span class="keyword">case</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414583" title="CleanUp.this.global.Tree" id="3357367">update</a> =&gt; <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="../../../reflect/internal/Definitions.scala.html#408762" title="=&gt; CleanUp.this.global.TermSymbol">arrayUpdateMethod</a><span class="delimiter">)</span> <a href="#3357375" title="(x: CleanUp.this.global.Tree)CleanUp.this.global.Tree">APPLY</a> <a href="../../../collection/immutable/List.scala.html#62451" title="(xs: CleanUp.this.global.Tree*)List[CleanUp.this.global.Tree]">List</a><span class="delimiter">(</span><a href="../../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)CleanUp.this.global.Tree">args</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="../../../collection/MapLike.scala.html#87535" title="(key: CleanUp.this.global.Symbol)CleanUp.this.global.TermSymbol">unboxMethod</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#409361" title="=&gt; CleanUp.this.global.ClassSymbol">IntClass</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662336" title="(params: CleanUp.this.global.Tree*)CleanUp.this.global.Apply">APPLY</a> <a href="../../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)CleanUp.this.global.Tree">args</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="../../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)CleanUp.this.global.Tree">args</a><span class="delimiter">(</span><span title="Int(2)" class="int">2</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414263" title="CleanUp.this.global.Tree" id="3357368">apply</a>  =&gt; <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="../../../reflect/internal/Definitions.scala.html#408761" title="=&gt; CleanUp.this.global.TermSymbol">arrayApplyMethod</a><span class="delimiter">)</span> <a href="#3357375" title="(x: CleanUp.this.global.Tree)CleanUp.this.global.Tree">APPLY</a> <a href="../../../collection/immutable/List.scala.html#62451" title="(xs: CleanUp.this.global.Tree*)List[CleanUp.this.global.Tree]">List</a><span class="delimiter">(</span><a href="../../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)CleanUp.this.global.Tree">args</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="../../../collection/MapLike.scala.html#87535" title="(key: CleanUp.this.global.Symbol)CleanUp.this.global.TermSymbol">unboxMethod</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#409361" title="=&gt; CleanUp.this.global.ClassSymbol">IntClass</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662336" title="(params: CleanUp.this.global.Tree*)CleanUp.this.global.Apply">APPLY</a> <a href="../../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)CleanUp.this.global.Tree">args</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414323" title="CleanUp.this.global.Tree" id="3357369">clone_</a> =&gt; <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="../../../reflect/internal/Definitions.scala.html#408764" title="=&gt; CleanUp.this.global.TermSymbol">arrayCloneMethod</a><span class="delimiter">)</span> <a href="#3357375" title="(x: CleanUp.this.global.Tree)CleanUp.this.global.Tree">APPLY</a> <a href="../../../collection/immutable/List.scala.html#62451" title="(xs: CleanUp.this.global.Tree*)List[CleanUp.this.global.Tree]">List</a><span class="delimiter">(</span><a href="../../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)CleanUp.this.global.Tree">args</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>,
              mustBeUnit = <a href="#977207" title="CleanUp.this.global.Symbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; methSym.NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414583" title="=&gt; CleanUp.this.global.nme.NameType">update</a>
            <span class="delimiter">)</span>

            /** A conditional Array call, when we can't determine statically if the argument is
             *  an Array, but the structural type method signature is consistent with an Array method
             *  so we have to generate both kinds of code.
             */
            <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.If" id="977224">genArrayCallWithTest</a> =
              <a href="../ast/TreeDSL.scala.html#624605" title="(tree: CleanUp.this.global.Tree)CleanUp.this.CODE.IfStart">IF</a> <span class="delimiter">(</span><span class="delimiter">(</span><a href="../../../Function0.scala.html#65930" title="()CleanUp.this.global.gen.global.Tree">qual1</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods">GETCLASS</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#624619" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeFromSelectStart : (ss: CleanUp.this.CODE.SelectStart)CleanUp.this.global.Select">DOT</a> <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414403" title="=&gt; CleanUp.this.global.nme.NameType">isArray</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662292" title="(x: CleanUp.this.global.Tree)CleanUp.this.CODE.IfStart">THEN</a> <a href="#977223" title="=&gt; CleanUp.this.global.Tree">genArrayCall</a> <a href="../ast/TreeDSL.scala.html#662293" title="(elsep: CleanUp.this.global.Tree)CleanUp.this.global.If">ELSE</a> <a href="#977220" title="=&gt; CleanUp.this.global.Tree">genDefaultCall</a>

            <a href="#976383" title="=&gt; CleanUp.this.global.analyzer.Typer">localTyper</a> <a href="../typechecker/Typers.scala.html#538701" title="(tree: CleanUp.this.global.analyzer.global.Tree)CleanUp.this.global.analyzer.global.Tree">typed</a> <span class="delimiter">(</span>
              <span title="CleanUp.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#977218" title="=&gt; Boolean">isMaybeBoxed</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#977210" title="=&gt; Boolean">isJavaValueMethod</a><span class="delimiter">)</span> <a href="#977222" title="=&gt; CleanUp.this.global.Tree">genValueCallWithTest</a>
              <span class="keyword">else</span> <span title="CleanUp.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#977213" title="Boolean">isArrayMethodSignature</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#977216" title="=&gt; Boolean">isDefinitelyArray</a><span class="delimiter">)</span> <a href="#977223" title="=&gt; CleanUp.this.global.Tree">genArrayCall</a>
              <span class="keyword">else</span> <span title="CleanUp.this.global.analyzer.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#977213" title="Boolean">isArrayMethodSignature</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#977217" title="=&gt; Boolean">isMaybeArray</a><span class="delimiter">)</span> <a href="#977224" title="=&gt; CleanUp.this.global.If">genArrayCallWithTest</a>
              <span class="keyword">else</span> <a href="#977220" title="=&gt; CleanUp.this.global.Tree">genDefaultCall</a>
            <span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <span title="CleanUp.this.global.analyzer.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="../Global.scala.html#537448" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#540109" title="=&gt; scala.tools.nsc.Settings#ChoiceSetting">refinementMethodDispatch</a>.<a href="../../../reflect/internal/settings/MutableSettings.scala.html#423752" title="=&gt; String">value</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="String(&quot;invoke-dynamic&quot;)" class="string">&quot;invoke-dynamic&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
/*          val guardCallSite: Tree = {
            val cachedClass = addStaticVariableToClass(&quot;cachedClass&quot;, definitions.ClassClass.tpe, EmptyTree)
            val tmpVar = currentOwner.newVariable(ad.pos, unit.freshTermName(ad.pos, &quot;x&quot;)).setInfo(definitions.AnyRefClass.tpe)
            atPos(ad.pos)(Block(List(
              ValDef(tmpVar, transform(qual))),
              If(Apply(Select(gen.mkAttributedRef(cachedClass), nme.EQ), List(getClass(Ident(tmpVar)))),
                 Block(List(Assign(gen.mkAttributedRef(cachedClass), getClass(Ident(tmpVar)))),
                       treeCopy.ApplyDynamic(ad, Ident(tmpVar), transformTrees(params))),
                 EmptyTree)))
          }
          //println(guardCallSite)
*/
          <a href="#976383" title="=&gt; CleanUp.this.global.analyzer.Typer">localTyper</a>.<a href="../typechecker/Typers.scala.html#538701" title="(tree: CleanUp.this.global.analyzer.global.Tree)CleanUp.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#405645" title="=&gt; CleanUp.this.global.TreeCopier">treeCopy</a>.<a href="../../../reflect/internal/Trees.scala.html#480853" title="(tree: CleanUp.this.global.Tree, qual: CleanUp.this.global.Tree, args: List[CleanUp.this.global.Tree])CleanUp.this.global.ApplyDynamic">ApplyDynamic</a><span class="delimiter">(</span><a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>, <a href="#976395" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#976605" title="CleanUp.this.global.Tree">qual</a><span class="delimiter">)</span>, <a href="../../../reflect/api/Trees.scala.html#405653" title="(trees: List[CleanUp.this.global.Tree])List[CleanUp.this.global.Tree]">transformTrees</a><span class="delimiter">(</span><a href="#976603" title="List[CleanUp.this.global.Tree]">params</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">else</span> <span class="delimiter">{</span>

          /* ### BODY OF THE TRANSFORMATION -&gt; remember we're in case ad@ApplyDynamic(qual, params) ### */

          /* This creates the tree that does the reflective call (see general comment
           * on the apply-dynamic tree for its format). This tree is simply composed
           * of three successive calls, first to getClass on the callee, then to
           * getMethod on the class, then to invoke on the method.
           * - getMethod needs an array of classes for choosing one amongst many
           *   overloaded versions of the method. This is provided by paramTypeClasses
           *   and must be done on the static type as Scala's dispatching is static on
           *   the parameters.
           * - invoke needs an array of AnyRefs that are the method's arguments. The
           *   erasure phase guarantees that any parameter passed to a dynamic apply
           *   is compatible (through boxing). Boxed ints et al. is what invoke expects
           *   when the applied method expects ints, hence no change needed there.
           * - in the end, the result of invoke must be fixed, again to deal with arrays.
           *   This is provided by fixResult. fixResult will cast the invocation's result
           *   to the method's return type, which is generally ok, except when this type
           *   is a value type (int et al.) in which case it must cast to the boxed version
           *   because invoke only returns object and erasure made sure the result is
           *   expected to be an AnyRef. */
          <span class="keyword">val</span> <a title="CleanUp.this.global.Tree" id="977797">t</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a> = <a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#409939" title="=&gt; CleanUp.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; CleanUp.this.global.Type">tpe</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> MethodType<a href="#3357394" title="CleanUp.this.global.Tree" id="3357396" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#410769" title="List[CleanUp.this.global.Symbol]" id="977800">mparams</a>, <a href="../../../reflect/internal/Types.scala.html#410771" title="CleanUp.this.global.Type" id="977801">resType</a><span class="delimiter">)</span> =&gt;
              <a href="../Global.scala.html#537497" title="(assertion: Boolean, message: =&gt; Any)Unit">assert</a><span class="delimiter">(</span><a href="#976603" title="List[CleanUp.this.global.Tree]">params</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57097" title="(x: Int)Boolean">==</a> <a href="#977800" title="List[CleanUp.this.global.Symbol]">mparams</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a>, <a href="#977800" title="List[CleanUp.this.global.Symbol]">mparams</a><span class="delimiter">)</span>

              <a href="../../../Function1.scala.html#58642" title="(v1: CleanUp.this.global.Tree)CleanUp.this.global.analyzer.global.Tree">typedPos</a> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="CleanUp.this.global.TermSymbol" id="977811">sym</a> = <a href="../../../reflect/api/Trees.scala.html#405647" title="CleanUp.this.global.Symbol" id="977819">currentOwner</a>.<a href="../../../reflect/internal/Symbols.scala.html#424629" title="Long" id="977825">newValue</a><span class="delimiter">(</span><a href="#976381" title="(prefix: String)CleanUp.this.global.TermName">mkTerm</a><a title="CleanUp.this.global.TermName" id="977823" class="delimiter">(</a><span title="String(&quot;qual&quot;)" class="string">&quot;qual&quot;</span><span class="delimiter">)</span>, <a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="CleanUp.this.global.Position" id="977824">pos</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Symbols.scala.html#411369" title="(info: CleanUp.this.global.Type)CleanUp.this.global.TermSymbol">setInfo</a> <a href="#976602" title="CleanUp.this.global.Tree">qual0</a>.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; CleanUp.this.global.Type">tpe</a>
                <a href="#976605" title="CleanUp.this.global.Tree">qual</a> = <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#977811" title="CleanUp.this.global.TermSymbol">sym</a><span class="delimiter">)</span>

                <a href="../ast/TreeDSL.scala.html#624607" title="(xs: CleanUp.this.global.Tree*)CleanUp.this.global.Block">BLOCK</a><span class="delimiter">(</span>
                  <a href="../ast/TreeDSL.scala.html#624596" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.CODE.ValSymStart">VAL</a><span class="delimiter">(</span><a href="#977811" title="CleanUp.this.global.TermSymbol">sym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#663071" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.ValDef">===</a> <a href="#976602" title="CleanUp.this.global.Tree">qual0</a>,
                  <a href="#976612" title="(paramTypes: List[CleanUp.this.global.Type], resType: CleanUp.this.global.Type)CleanUp.this.global.Tree">callAsReflective</a><span class="delimiter">(</span><a href="#977800" title="List[CleanUp.this.global.Symbol]">mparams</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: CleanUp.this.global.Symbol =&gt; CleanUp.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[CleanUp.this.global.Symbol],CleanUp.this.global.Type,List[CleanUp.this.global.Type]])List[CleanUp.this.global.Type]">map</a> <span class="delimiter">(</span><a href="#977854" title="CleanUp.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; CleanUp.this.global.Type">tpe</a><span class="delimiter">)</span>, <a href="#977801" title="CleanUp.this.global.Type">resType</a><span class="delimiter">)</span>
                <span class="delimiter">)</span>
              <span class="delimiter">}</span>
          <span class="delimiter">}</span>

          /* For testing purposes, the dynamic application's condition
           * can be printed-out in great detail. Remove? */
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../Global.scala.html#537448" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#540057" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../settings/MutableSettings.scala.html#541066" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">def</span> <a title="(xs: Any*)String" id="977887">paramsToString</a><span class="delimiter">(</span><a title="Any*" id="977889">xs</a>: <span title="Any*">Any</span>*<span class="delimiter">)</span> = <a href="#977889" title="Any*">xs</a> <a href="../../../collection/TraversableLike.scala.html#58063" title="(f: Any =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[Any],String,Seq[String]])Seq[String]">map</a> <span class="delimiter">(</span><a href="#977906" title="Any">_</a>.<span title="()String">toString</span><span class="delimiter">)</span> <a href="../../../collection/TraversableOnce.scala.html#58283" title="(sep: String)String">mkString</a> <span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span>
            <span class="keyword">val</span> <a title="String" id="977888">mstr</a> = <a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#409939" title="=&gt; CleanUp.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; CleanUp.this.global.Type">tpe</a> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> MethodType<a href="#3357402" title="String" id="3357404" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#410769" title="List[CleanUp.this.global.Symbol]" id="977932">mparams</a>, <a href="../../../reflect/internal/Types.scala.html#410771" title="CleanUp.this.global.Type" id="977933">resType</a><span class="delimiter">)</span> =&gt;
                <a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;|  with
                   |  - declared parameter types: '%s'
                   |  - passed argument types:    '%s'
                   |  - result type:              '%s'&quot;&quot;&quot;</a> .
                  <a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">stripMargin</a>.<a href="../../../collection/immutable/StringLike.scala.html#59882" title="(args: Any*)String">format</a><a href="#3357406" title="(x: String)String" class="delimiter">(</a>
                     <a href="#977887" title="(xs: Any*)String">paramsToString</a><span class="delimiter">(</span><a href="#977932" title="List[CleanUp.this.global.Symbol]">mparams</a><span class="delimiter">)</span>,
                     <a href="#977887" title="(xs: Any*)String">paramsToString</a><span class="delimiter">(</span><a href="#976603" title="List[CleanUp.this.global.Tree]">params</a><span class="delimiter">)</span>,
                     <a href="#977933" title="CleanUp.this.global.Type">resType</a>.<a href="../../../reflect/internal/Types.scala.html#408499" title="()String">toString</a>
                  <span class="delimiter">)</span>
              <span class="keyword">case</span> _ =&gt; <a href="#3357406" title="(x: String)String" class="string">&quot;&quot;</a>
            <span class="delimiter">}</span>
            <a href="../Global.scala.html#537516" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span>
              <a href="../../../Predef.scala.html#7604" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;Dynamically application '%s.%s(%s)' %s - resulting code: '%s'&quot;&quot;&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#59882" title="(args: Any*)String">format</a><span class="delimiter">(</span>
                <a href="#976605" title="CleanUp.this.global.Tree">qual</a>, <a href="#976601" title="CleanUp.this.global.ApplyDynamic">ad</a>.<a href="../../../reflect/internal/Trees.scala.html#409939" title="=&gt; CleanUp.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#411087" title="=&gt; CleanUp.this.global.Symbol#NameType">name</a>, <a href="#977887" title="(xs: Any*)String">paramsToString</a><span class="delimiter">(</span><a href="#976603" title="List[CleanUp.this.global.Tree]">params</a><span class="delimiter">)</span>, <a href="#977888" title="String">mstr</a>, <a href="#977797" title="CleanUp.this.global.Tree">t</a>
              <span class="delimiter">)</span>
            <span class="delimiter">)</span>
          <span class="delimiter">}</span>

          /* We return the dynamic call tree, after making sure no other
           * clean-up transformation are to be applied on it. */
          <a href="#976395" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#977797" title="CleanUp.this.global.Tree">t</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        /* ### END OF DYNAMIC APPLY TRANSFORM ### */
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Tree" id="976395">transform</a><span class="delimiter">(</span><a title="CleanUp.this.global.Tree" id="976683">tree</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a> = <a href="#976683" title="CleanUp.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>

      /* Transforms dynamic calls (i.e. calls to methods that are undefined
       * in the erased type space) to -- dynamically -- unsafe calls using
       * reflection. This is used for structural sub-typing of refinement
       * types, but may be used for other dynamic calls in the future.
       * For 'a.f(b)' it will generate something like:
       * 'a.getClass().
       * '  getMethod(&quot;f&quot;, Array(classOf[b.type])).
       * '  invoke(a, Array(b))
       * plus all the necessary casting/boxing/etc. machinery required
       * for type-compatibility (see fixResult).
       *
       * USAGE CONTRACT:
       * There are a number of assumptions made on the way a dynamic apply
       * is used. Assumptions relative to type are handled by the erasure
       * phase.
       * - The applied arguments are compatible with AnyRef, which means
       *   that an argument tree typed as AnyVal has already been extended
       *   with the necessary boxing calls. This implies that passed
       *   arguments might not be strictly compatible with the method's
       *   parameter types (a boxed integer while int is expected).
       * - The expected return type is an AnyRef, even when the method's
       *   return type is an AnyVal. This means that the tree containing the
       *   call has already been extended with the necessary unboxing calls
       *   (or is happy with the boxed type).
       * - The type-checker has prevented dynamic applies on methods which
       *   parameter's erased types are not statically known at the call site.
       *   This is necessary to allow dispatching the call to the correct
       *   method (dispatching on parameters is static in Scala). In practice,
       *   this limitation only arises when the called method is defined as a
       *   refinement, where the refinement defines a parameter based on a
       *   type variable. */

      <span class="keyword">case</span> <a href="#3357424" title="CleanUp.this.global.Tree" id="3357455">tree</a>: ApplyDynamic =&gt;
        <a href="#976394" title="(ad: CleanUp.this.global.ApplyDynamic)CleanUp.this.global.analyzer.global.Tree">transformApplyDynamic</a><a href="#3357460" title="(x: CleanUp.this.global.Tree)CleanUp.this.global.Tree" class="delimiter">(</a>tree<span class="delimiter">)</span>

      /* Some cleanup transformations add members to templates (classes, traits, etc).
       * When inside a template (i.e. the body of one of its members), two maps
       * (newStaticMembers and newStaticInits) are available in the tree transformer. Any mapping from
       * a symbol to a MemberDef (DefDef, ValDef, etc.) that is in newStaticMembers once the
       * transformation of the template is finished will be added as a member to the
       * template. Any mapping from a symbol to a tree that is in newStaticInits, will be added
       * as a statement of the form &quot;symbol = tree&quot; to the beginning of the default
       * constructor. */
      <span class="keyword">case</span> Template<a href="#3357424" title="CleanUp.this.global.Tree" id="3357427" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410203" title="List[CleanUp.this.global.Tree]" id="977959">parents</a>, <a href="../../../reflect/internal/Trees.scala.html#410205" title="CleanUp.this.global.ValDef" id="977960">self</a>, <a href="../../../reflect/internal/Trees.scala.html#410207" title="List[CleanUp.this.global.Tree]" id="977961">body</a><span class="delimiter">)</span> =&gt;
        <a href="#976383" title="(x$1: CleanUp.this.global.analyzer.Typer)Unit">localTyper</a> = <a href="../Global.scala.html#537612" title="CleanUp.this.global.typer.type">typer</a>.<a href="../typechecker/Typers.scala.html#538700" title="(tree: CleanUp.this.global.analyzer.global.Tree, owner: CleanUp.this.global.analyzer.global.Symbol)CleanUp.this.global.analyzer.Typer">atOwner</a><span class="delimiter">(</span><a href="#976683" title="CleanUp.this.global.Tree">tree</a>, <a href="../../../reflect/api/Trees.scala.html#405651" title="=&gt; CleanUp.this.global.Symbol">currentClass</a><span class="delimiter">)</span>
        <span title="CleanUp.this.global.Template" class="keyword">if</span> <span class="delimiter">(</span><a href="../Global.scala.html#537757" title="=&gt; Boolean">forMSIL</a><span class="delimiter">)</span> <a href="#976377" title="(body: =&gt; CleanUp.this.global.Template)CleanUp.this.global.Template">savingStatics</a><span class="delimiter">(</span> <a href="#976380" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Template">transformTemplate</a><span class="delimiter">(</span><a href="#976683" title="CleanUp.this.global.Tree">tree</a><span class="delimiter">)</span> <span class="delimiter">)</span>
        <span class="keyword">else</span> <a href="#976380" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Template">transformTemplate</a><span class="delimiter">(</span><a href="#976683" title="CleanUp.this.global.Tree">tree</a><span class="delimiter">)</span>

      <span class="keyword">case</span> Literal<a href="#3357424" title="CleanUp.this.global.Tree" id="3357429" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#409973" title="CleanUp.this.global.Constant" id="977988">c</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#977988" title="CleanUp.this.global.Constant">c</a>.<a href="../../../reflect/internal/Constants.scala.html#409765" title="=&gt; Int">tag</a> <a href="../../../Int.scala.html#57097" title="(x: Int)Boolean">==</a> <span title="Int(12)">ClazzTag</span><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="../Global.scala.html#537757" title="=&gt; Boolean">forMSIL</a>=&gt;
        <span class="keyword">val</span> <a title="CleanUp.this.global.Type" id="977993">tpe</a> = <a href="#977988" title="CleanUp.this.global.Constant">c</a>.<a href="../../../reflect/internal/Constants.scala.html#409791" title="=&gt; CleanUp.this.global.Type">typeValue</a>
        <a href="#976390" title="(pos: CleanUp.this.global.Position)(tree: CleanUp.this.global.Tree)CleanUp.this.global.analyzer.global.Tree">typedWithPos</a><span class="delimiter">(</span><a href="#976683" title="CleanUp.this.global.Tree">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; CleanUp.this.global.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="CleanUp.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#409297" title="(sym: CleanUp.this.global.Symbol)Boolean">isPrimitiveValueClass</a><span class="delimiter">(</span><a href="#977993" title="CleanUp.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#408407" title="=&gt; CleanUp.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="CleanUp.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#977993" title="CleanUp.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#408407" title="=&gt; CleanUp.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#409353" title="=&gt; CleanUp.this.global.ClassSymbol">UnitClass</a><span class="delimiter">)</span>
              <a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#409146" title="=&gt; CleanUp.this.global.TermSymbol">BoxedUnit_TYPE</a><span class="delimiter">)</span>
            <span class="keyword">else</span>
              <a href="../../../reflect/internal/Trees.scala.html#418089" title="(qualifier: CleanUp.this.global.Tree, name: CleanUp.this.global.Name)CleanUp.this.global.Select">Select</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="../../../collection/MapLike.scala.html#87535" title="(key: CleanUp.this.global.Symbol)CleanUp.this.global.ModuleSymbol">boxedModule</a><span class="delimiter">(</span><a href="#977993" title="CleanUp.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#408407" title="=&gt; CleanUp.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#414245" title="=&gt; CleanUp.this.global.nme.NameType">TYPE_</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

          <span class="keyword">else</span> <a href="#976683" title="CleanUp.this.global.Tree">tree</a>
        <span class="delimiter">}</span>

      /* MSIL requires that the stack is empty at the end of a try-block.
       * Hence, we here rewrite all try blocks with a result != {Unit, All} such that they
       * store their result in a local variable. The catch blocks are adjusted as well.
       * The try tree is subsituted by a block whose result expression is read of that variable. */
      <span class="keyword">case</span> theTry @ Try<a href="#3357424" title="CleanUp.this.global.Tree" id="3357431" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410079" title="CleanUp.this.global.Tree" id="978051">block</a>, <a href="../../../reflect/internal/Trees.scala.html#410081" title="List[CleanUp.this.global.CaseDef]" id="978052">catches</a>, <a href="../../../reflect/internal/Trees.scala.html#410083" title="CleanUp.this.global.Tree" id="978053">finalizer</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#976389" title="(tree: CleanUp.this.global.Try)Boolean">shouldRewriteTry</a><span class="delimiter">(</span>theTry<span class="delimiter">)</span> =&gt;
        <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.analyzer.global.Tree" id="978054">transformTry</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="CleanUp.this.global.Type" id="978055">tpe</a> = theTry.<a href="../../../reflect/internal/Trees.scala.html#408573" title="=&gt; CleanUp.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#408411" title="=&gt; CleanUp.this.global.Type">widen</a>
        <span class="keyword">val</span> <a title="CleanUp.this.global.TermSymbol" id="978056">tempVar</a> = <a href="../../../reflect/api/Trees.scala.html#405647" title="CleanUp.this.global.Symbol" id="978065">currentOwner</a>.<a href="../../../reflect/internal/Symbols.scala.html#472410" title="Long" id="978071">newVariable</a><span class="delimiter">(</span><a href="#976381" title="(prefix: String)CleanUp.this.global.TermName">mkTerm</a><a title="CleanUp.this.global.TermName" id="978069" class="delimiter">(</a><a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#413956" title="=&gt; String">EXCEPTION_RESULT_PREFIX</a><span class="delimiter">)</span>, theTry.<a href="../../../reflect/internal/Trees.scala.html#408571" title="CleanUp.this.global.Position" id="978070">pos</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Symbols.scala.html#411369" title="(info: CleanUp.this.global.Type)CleanUp.this.global.TermSymbol">setInfo</a><span class="delimiter">(</span><a href="#978055" title="CleanUp.this.global.Type">tpe</a><span class="delimiter">)</span>
        <span class="keyword">def</span> <a title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.Tree" id="978057">assignBlock</a><span class="delimiter">(</span><a title="CleanUp.this.global.Tree" id="978072">rhs</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#622690" title="CleanUp.this.CleanUpTransformer" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#405652" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Tree">transform</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624607" title="(xs: CleanUp.this.global.Tree*)CleanUp.this.global.Block">BLOCK</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#408127" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.Ident">Ident</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="#978056" title="CleanUp.this.global.TermSymbol">tempVar</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662341" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.Assign">===</a> <a href="#976395" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#978072" title="CleanUp.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="CleanUp.this.global.Tree" id="978058">newBlock</a>    = <a href="#978057" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.Tree">assignBlock</a><span class="delimiter">(</span><a href="#978051" title="CleanUp.this.global.Tree">block</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="List[CleanUp.this.global.CaseDef]" id="978059">newCatches</a>  = <span class="keyword">for</span> <span class="delimiter">(</span>CaseDef<span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#410180" title="CleanUp.this.global.Tree" id="978121">pattern</a>, <a href="../../../reflect/internal/Trees.scala.html#410182" title="CleanUp.this.global.Tree" id="978122">guard</a>, <a href="../../../reflect/internal/Trees.scala.html#410184" title="CleanUp.this.global.Tree" id="978123">body</a><span class="delimiter">)</span> &lt;- <a href="../../../collection/generic/FilterMonadic.scala.html#58161" title="(f: CleanUp.this.global.CaseDef =&gt; CleanUp.this.global.CaseDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[CleanUp.this.global.CaseDef],CleanUp.this.global.CaseDef,List[CleanUp.this.global.CaseDef]])List[CleanUp.this.global.CaseDef]">catches</a><span class="delimiter">)</span> <span class="keyword">yield</span>
          <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624584" title="(pat: CleanUp.this.global.Tree)CleanUp.this.CODE.CaseStart">CASE</a><span class="delimiter">(</span><a href="#622690" title="CleanUp.this.CleanUpTransformer" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#405652" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#978121" title="CleanUp.this.global.Tree">pattern</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662967" title="(g: CleanUp.this.global.Tree)CleanUp.this.CODE.CaseStart">IF</a> <span class="delimiter">(</span><a href="#622690" title="CleanUp.this.CleanUpTransformer" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#405652" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#978122" title="CleanUp.this.global.Tree">guard</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#3357420" title="(x: CleanUp.this.global.CaseDef)CleanUp.this.global.CaseDef">==&gt;</a> <a href="#978057" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.Tree">assignBlock</a><span class="delimiter">(</span><a href="#978123" title="CleanUp.this.global.Tree">body</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="CleanUp.this.global.Try" id="978060">newTry</a>      = <a href="../../../reflect/internal/Trees.scala.html#453695" title="(block: CleanUp.this.global.Tree, catches: List[CleanUp.this.global.CaseDef], finalizer: CleanUp.this.global.Tree)CleanUp.this.global.Try">Try</a><span class="delimiter">(</span><a href="#978058" title="CleanUp.this.global.Tree">newBlock</a>, <a href="#978059" title="List[CleanUp.this.global.CaseDef]">newCatches</a>, <a href="#622690" title="CleanUp.this.CleanUpTransformer" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#405652" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#978053" title="CleanUp.this.global.Tree">finalizer</a><span class="delimiter">)</span><span class="delimiter">)</span>

        <a href="#976390" title="(pos: CleanUp.this.global.Position)(tree: CleanUp.this.global.Tree)CleanUp.this.global.analyzer.global.Tree">typedWithPos</a><span class="delimiter">(</span>theTry.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; CleanUp.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624607" title="(xs: CleanUp.this.global.Tree*)CleanUp.this.global.Block">BLOCK</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624596" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.CODE.ValSymStart">VAL</a><span class="delimiter">(</span><a href="#978056" title="CleanUp.this.global.TermSymbol">tempVar</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#663071" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.ValDef">===</a> <a href="../../../reflect/internal/Trees.scala.html#407946" title="CleanUp.this.global.EmptyTree.type">EmptyTree</a>, <a href="#978060" title="CleanUp.this.global.Try">newTry</a>, <a href="../../../reflect/internal/Trees.scala.html#408127" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="#978056" title="CleanUp.this.global.TermSymbol">tempVar</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#978054" title="=&gt; CleanUp.this.global.analyzer.global.Tree">transformTry</a>
     /*
      * This transformation should identify Scala symbol invocations in the tree and replace them
      * with references to a static member. Also, whenever a class has at least a single symbol invocation
      * somewhere in its methods, a new static member should be created and initialized for that symbol.
      * For instance, say we have a Scala class:
      *
      * class Cls {
      *   // ...
      *   def someSymbol = `symbolic
      *   // ...
      * }
      *
      * After transformation, this class looks like this:
      *
      * class Cls {
      *   private &quot;static&quot; val &lt;some_name&gt;$symbolic = Symbol(&quot;symbolic&quot;)
      *   // ...
      *   def someSymbol = &lt;some_name&gt;$symbolic
      *   // ...
      * }
      *
      * The reasoning behind this transformation is the following. Symbols get interned - they are stored
      * in a global map which is protected with a lock. The reason for this is making equality checks
      * quicker. But calling Symbol.apply, although it does return a unique symbol, accesses a locked object,
      * making symbol access slow. To solve this, the unique symbol from the global symbol map in Symbol
      * is accessed only once during class loading, and after that, the unique symbol is in the static
      * member. Hence, it is cheap to both reach the unique symbol and do equality checks on it.
      *
      * And, finally, be advised - scala symbol literal and the Symbol class of the compiler
      * have little in common.
      */
      <span class="keyword">case</span> Apply<a href="#3357424" title="Boolean" id="3357434" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410031" title="CleanUp.this.global.Tree" id="978207">fn</a>, <span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#206583" title="CleanUp.this.global.Tree" id="978210">arg</a> @ Literal<a href="#978210" title="CleanUp.this.global.Tree" id="3357439" class="delimiter">(</a>Constant<a href="../../../reflect/internal/Trees.scala.html#409973" title="CleanUp.this.global.Constant" id="3357437" class="delimiter">(</a><a href="../../../reflect/internal/Constants.scala.html#409760" title="Any" id="978212">symname</a>: String<span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../reflect/internal/Trees.scala.html#410033" title="List[CleanUp.this.global.Tree]" id="3357436">::</a> <a href="../../../collection/immutable/List.scala.html#206584" title="List[CleanUp.this.global.Tree]" id="3357457">Nil</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#978207" title="CleanUp.this.global.Tree">fn</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; CleanUp.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#408759" title="=&gt; CleanUp.this.global.TermSymbol">Symbol_apply</a> =&gt;
        <span class="keyword">def</span> <a title="=&gt; CleanUp.this.global.Tree" id="978218">transformApply</a> = <span class="delimiter">{</span>
        // add the symbol name to a map if it's not there already
        <span class="keyword">val</span> <a title="CleanUp.this.global.gen.global.Tree" id="978219">rhs</a> = <a href="../Global.scala.html#537460" title="CleanUp.this.global.gen.type">gen</a>.<a href="../../../reflect/internal/TreeGen.scala.html#470979" title="(method: CleanUp.this.global.gen.global.Symbol, args: List[CleanUp.this.global.gen.global.Tree])CleanUp.this.global.gen.global.Tree">mkMethodCall</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#408759" title="=&gt; CleanUp.this.global.TermSymbol">Symbol_apply</a>, arg <a href="../../../collection/immutable/List.scala.html#62685" title="(x: CleanUp.this.global.Literal)List[CleanUp.this.global.Literal]">::</a> <a href="../../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="CleanUp.this.global.Symbol" id="978220">staticFieldSym</a> = <a href="#976396" title="(pos: CleanUp.this.global.Position, symname: String, rhs: CleanUp.this.global.Tree, tree: CleanUp.this.global.Tree)CleanUp.this.global.Symbol">getSymbolStaticField</a><span class="delimiter">(</span><a href="#976683" title="CleanUp.this.global.Tree">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; CleanUp.this.global.Position">pos</a>, symname, <a href="#978219" title="CleanUp.this.global.gen.global.Tree">rhs</a>, <a href="#976683" title="CleanUp.this.global.Tree">tree</a><span class="delimiter">)</span>
        // create a reference to a static field
        <span class="keyword">val</span> <a title="CleanUp.this.global.analyzer.global.Tree" id="978221">ntree</a> = <a href="#976390" title="(pos: CleanUp.this.global.Position)(tree: CleanUp.this.global.Tree)CleanUp.this.global.analyzer.global.Tree">typedWithPos</a><span class="delimiter">(</span><a href="#976683" title="CleanUp.this.global.Tree">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; CleanUp.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#978220" title="CleanUp.this.global.Symbol">staticFieldSym</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#622690" title="CleanUp.this.CleanUpTransformer" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#405652" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#978221" title="CleanUp.this.global.analyzer.global.Tree">ntree</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#978218" title="=&gt; CleanUp.this.global.Tree">transformApply</a>

      // This transform replaces Array(Predef.wrapArray(Array(...)), &lt;tag&gt;)
      // with just Array(...)
      <span class="keyword">case</span> Apply<span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#410031" title="CleanUp.this.global.Tree" id="978242">appMeth</a>, <a href="../../../collection/generic/SeqFactory.scala.html#59986" title="Option[List[CleanUp.this.global.Tree]]" id="3357470">List</a><a href="../../../reflect/internal/Trees.scala.html#410033" title="List[CleanUp.this.global.Tree]" id="3357441" class="delimiter">(</a>Apply<a title="CleanUp.this.global.Tree" id="3357451" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410031" title="CleanUp.this.global.Tree" id="978255">wrapRefArrayMeth</a>, <a href="../../../collection/generic/SeqFactory.scala.html#59986" title="Option[List[CleanUp.this.global.Tree]]" id="3357469">List</a><a href="../../../reflect/internal/Trees.scala.html#410033" title="List[CleanUp.this.global.Tree]" id="3357449" class="delimiter">(</a><a title="CleanUp.this.global.Tree" id="978264">array</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a title="CleanUp.this.global.Tree" id="3357445">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">if</span> <span class="delimiter">(</span><a href="#978255" title="CleanUp.this.global.Tree">wrapRefArrayMeth</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; CleanUp.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#408745" title="=&gt; CleanUp.this.global.TermSymbol">Predef_wrapRefArray</a> <a href="../../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a>
          <a href="#978242" title="CleanUp.this.global.Tree">appMeth</a>.<a href="../../../reflect/internal/Trees.scala.html#408577" title="=&gt; CleanUp.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#408859" title="=&gt; CleanUp.this.global.TermSymbol">ArrayModule_overloadedApply</a>.<a href="../../../reflect/internal/Symbols.scala.html#411415" title="(cond: CleanUp.this.global.Symbol =&gt; Boolean)CleanUp.this.global.Symbol">suchThat</a> <span class="delimiter">{</span>
            <a href="#978278" title="CleanUp.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#411365" title="=&gt; CleanUp.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#408423" title="=&gt; CleanUp.this.global.Type">resultType</a>.<a href="../../../reflect/internal/Types.scala.html#408439" title="=&gt; CleanUp.this.global.Type">dealias</a>.<a href="../../../reflect/internal/Types.scala.html#408407" title="=&gt; CleanUp.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#408671" title="=&gt; CleanUp.this.global.ClassSymbol">ObjectClass</a>
          <span class="delimiter">}</span><span class="delimiter">)</span> =&gt;
        <a href="#622690" title="CleanUp.this.CleanUpTransformer" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#405652" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Tree">transform</a><a href="#3357460" title="(x: CleanUp.this.global.Tree)CleanUp.this.global.Tree" class="delimiter">(</a><a href="#978264" title="CleanUp.this.global.Tree">array</a><span class="delimiter">)</span>

      <span class="keyword">case</span> _ =&gt;
        <a href="#622690" title="CleanUp.this.CleanUpTransformer" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#405652" title="(tree: CleanUp.this.global.Tree)CleanUp.this.global.Tree">transform</a><a href="#3357460" title="(x: CleanUp.this.global.Tree)CleanUp.this.global.Tree" class="delimiter">(</a><a href="#976683" title="CleanUp.this.global.Tree">tree</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    /* Returns the symbol and the tree for the symbol field interning a reference to a symbol 'synmname'.
     * If it doesn't exist, i.e. the symbol is encountered the first time,
     * it creates a new static field definition and initialization and returns it.
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(pos: CleanUp.this.global.Position, symname: String, rhs: CleanUp.this.global.Tree, tree: CleanUp.this.global.Tree)CleanUp.this.global.Symbol" id="976396">getSymbolStaticField</a><span class="delimiter">(</span><a title="CleanUp.this.global.Position" id="978232">pos</a>: <a href="../../../reflect/internal/util/Position.scala.html#22953" title="CleanUp.this.global.Position">Position</a>, <a title="String" id="978233">symname</a>: <span title="String">String</span>, <a title="CleanUp.this.global.Tree" id="978234">rhs</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a>, <a title="CleanUp.this.global.Tree" id="978235">tree</a>: <a href="../../../reflect/internal/Trees.scala.html#407938" title="CleanUp.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Symbols.scala.html#407146" title="CleanUp.this.global.Symbol">Symbol</a> = <span class="delimiter">{</span>
      <a href="#976374" title="=&gt; scala.collection.mutable.Map[String,CleanUp.this.global.Symbol]">symbolsStoredAsStatic</a>.<a href="../../../collection/mutable/MapLike.scala.html#87629" title="(key: String, op: =&gt; CleanUp.this.global.Symbol)CleanUp.this.global.Symbol">getOrElseUpdate</a><span class="delimiter">(</span><a href="#978233" title="String">symname</a>, <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="CleanUp.this.global.analyzer.Typer" id="978290">theTyper</a> = <a href="../Global.scala.html#537612" title="CleanUp.this.global.typer.type">typer</a>.<a href="../typechecker/Typers.scala.html#538700" title="(tree: CleanUp.this.global.analyzer.global.Tree, owner: CleanUp.this.global.analyzer.global.Symbol)CleanUp.this.global.analyzer.Typer">atOwner</a><span class="delimiter">(</span><a href="#978235" title="CleanUp.this.global.Tree">tree</a>, <a href="../../../reflect/api/Trees.scala.html#405651" title="=&gt; CleanUp.this.global.Symbol">currentClass</a><span class="delimiter">)</span>

        // create a symbol for the static field
        <span class="keyword">val</span> <a title="CleanUp.this.global.TermSymbol" id="978291">stfieldSym</a> = <span class="delimiter">(</span>
          <a href="../../../reflect/api/Trees.scala.html#405651" title="=&gt; CleanUp.this.global.Symbol">currentClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411110" title="(name: CleanUp.this.global.TermName, pos: CleanUp.this.global.Position, newFlags: Long)CleanUp.this.global.TermSymbol">newVariable</a><span class="delimiter">(</span><a href="#976381" title="(prefix: String)CleanUp.this.global.TermName">mkTerm</a><span class="delimiter">(</span><span title="String(&quot;symbol$&quot;)" class="string">&quot;symbol$&quot;</span><span class="delimiter">)</span>, <a href="#978232" title="CleanUp.this.global.Position">pos</a>, PRIVATE | STATIC | SYNTHETIC <span title="Long(10485796L)">|</span> FINAL<span class="delimiter">)</span>
            <a href="../../../reflect/internal/Symbols.scala.html#411369" title="(info: CleanUp.this.global.Type)CleanUp.this.global.TermSymbol">setInfo</a> <a href="../../../reflect/internal/Definitions.scala.html#408720" title="=&gt; CleanUp.this.global.ClassSymbol">SymbolClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CleanUp.this.global.Type">tpe</a>
        <span class="delimiter">)</span>
        <a href="../../../reflect/api/Trees.scala.html#405651" title="=&gt; CleanUp.this.global.Symbol">currentClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411367" title="=&gt; CleanUp.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#408442" title="=&gt; CleanUp.this.global.Scope">decls</a> <a href="../../../reflect/internal/Scopes.scala.html#410508" title="(sym: CleanUp.this.global.TermSymbol)CleanUp.this.global.TermSymbol">enter</a> <a href="#978291" title="CleanUp.this.global.TermSymbol">stfieldSym</a>

        // create field definition and initialization
        <span class="keyword">val</span> <a title="CleanUp.this.global.analyzer.global.Tree" id="978292">stfieldDef</a>  = <a href="#978290" title="CleanUp.this.global.analyzer.Typer">theTyper</a>.<a href="../typechecker/Typers.scala.html#538703" title="(pos: CleanUp.this.global.analyzer.global.Position)(tree: CleanUp.this.global.analyzer.global.Tree)CleanUp.this.global.analyzer.global.Tree">typedPos</a><span class="delimiter">(</span><a href="#978232" title="CleanUp.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624596" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.CODE.ValSymStart">VAL</a><span class="delimiter">(</span><a href="#978291" title="CleanUp.this.global.TermSymbol">stfieldSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#663071" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.ValDef">===</a> <a href="#978234" title="CleanUp.this.global.Tree">rhs</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="CleanUp.this.global.analyzer.global.Tree" id="978293">stfieldInit</a> = <a href="#978290" title="CleanUp.this.global.analyzer.Typer">theTyper</a>.<a href="../typechecker/Typers.scala.html#538703" title="(pos: CleanUp.this.global.analyzer.global.Position)(tree: CleanUp.this.global.analyzer.global.Tree)CleanUp.this.global.analyzer.global.Tree">typedPos</a><span class="delimiter">(</span><a href="#978232" title="CleanUp.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#624612" title="(sym: CleanUp.this.global.Symbol)CleanUp.this.global.gen.global.Tree">REF</a><a href="../ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: CleanUp.this.global.Tree)CleanUp.this.CODE.TreeMethods" class="delimiter">(</a><a href="#978291" title="CleanUp.this.global.TermSymbol">stfieldSym</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#662341" title="(rhs: CleanUp.this.global.Tree)CleanUp.this.global.Assign">===</a> <a href="#978234" title="CleanUp.this.global.Tree">rhs</a><span class="delimiter">)</span>

        // add field definition to new defs
        <a href="#976370" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticMembers</a> <a href="../../../collection/mutable/BufferLike.scala.html#66924" title="(elems: CleanUp.this.global.Tree*)Unit">append</a> <a href="#978292" title="CleanUp.this.global.analyzer.global.Tree">stfieldDef</a>
        <a href="#976372" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticInits</a> <a href="../../../collection/mutable/BufferLike.scala.html#66924" title="(elems: CleanUp.this.global.Tree*)Unit">append</a> <a href="#978293" title="CleanUp.this.global.analyzer.global.Tree">stfieldInit</a>

        <a href="#978291" title="CleanUp.this.global.TermSymbol">stfieldSym</a>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    /* finds the static ctor DefDef tree within the template if it exists. */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(template: CleanUp.this.global.Template)Option[CleanUp.this.global.Tree]" id="976397">findStaticCtor</a><span class="delimiter">(</span><a title="CleanUp.this.global.Template" id="978343">template</a>: <a href="../../../reflect/internal/Trees.scala.html#407978" title="CleanUp.this.global.Template">Template</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#978" title="Option[CleanUp.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> =
      <a href="#978343" title="CleanUp.this.global.Template">template</a>.<a href="../../../reflect/internal/Trees.scala.html#410207" title="=&gt; List[CleanUp.this.global.Tree]">body</a> <a href="../../../collection/LinearSeqOptimized.scala.html#86381" title="(p: CleanUp.this.global.Tree =&gt; Boolean)Option[CleanUp.this.global.Tree]">find</a> <a href="#978350" title="CleanUp.this.global.Tree" class="delimiter">{</a>
        <span class="keyword">case</span> defdef @ DefDef<a href="#3357505" title="Boolean" id="3357513" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410278" title="CleanUp.this.global.Modifiers" id="3357506">_</a>, <a href="../../../reflect/internal/StdNames.scala.html#407871" title="CleanUp.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/Trees.scala.html#410280" title="CleanUp.this.global.Name" id="3357516">CONSTRUCTOR</a>, <a href="../../../reflect/internal/Trees.scala.html#410282" title="List[CleanUp.this.global.TypeDef]" id="3357508">_</a>, <a href="../../../reflect/internal/Trees.scala.html#410284" title="List[List[CleanUp.this.global.ValDef]]" id="3357509">_</a>, <a href="../../../reflect/internal/Trees.scala.html#410286" title="CleanUp.this.global.Tree" id="3357510">_</a>, <a href="../../../reflect/internal/Trees.scala.html#410288" title="CleanUp.this.global.Tree" id="3357511">_</a><span class="delimiter">)</span> =&gt; defdef.<a href="../../../reflect/internal/Trees.scala.html#409939" title="=&gt; CleanUp.this.global.Symbol">symbol</a>.<a href="#3357519" title="(x: Boolean)Boolean">hasStaticFlag</a>
        <span class="keyword">case</span> _ =&gt; <a href="#3357519" title="(x: Boolean)Boolean" class="keyword">false</a>
      <span class="delimiter">}</span>

    /* changes the template for the class so that it contains a static constructor with symbol fields inits,
     * augments an existing static ctor if one already existed.
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(template: CleanUp.this.global.Template)CleanUp.this.global.Template" id="976398">addStaticInits</a><span class="delimiter">(</span><a title="CleanUp.this.global.Template" id="976463">template</a>: <a href="../../../reflect/internal/Trees.scala.html#407978" title="CleanUp.this.global.Template">Template</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Trees.scala.html#407978" title="CleanUp.this.global.Template">Template</a> = <span class="delimiter">{</span>
      <span title="CleanUp.this.global.Template" class="keyword">if</span> <span class="delimiter">(</span><a href="#976372" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticInits</a>.<a href="../../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span>
        <a href="#976463" title="CleanUp.this.global.Template">template</a>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="CleanUp.this.global.analyzer.global.Tree" id="978360">newCtor</a> = <a href="#976397" title="(template: CleanUp.this.global.Template)Option[CleanUp.this.global.Tree]">findStaticCtor</a><a href="#3357547" title="CleanUp.this.global.DefDef" class="delimiter">(</a><a href="#976463" title="CleanUp.this.global.Template">template</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
          // in case there already were static ctors - augment existing ones
          // currently, however, static ctors aren't being generated anywhere else
          <span class="keyword">case</span> Some<a href="#3357538" title="CleanUp.this.global.analyzer.global.Tree" id="3357539" class="delimiter">(</a><a href="../../../Option.scala.html#63132" title="CleanUp.this.global.Tree" id="978362">ctor</a> @ DefDef<a href="#978362" title="CleanUp.this.global.analyzer.global.Tree" id="3357547" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410278" title="CleanUp.this.global.Modifiers" id="3357540">_</a>,<a href="../../../reflect/internal/Trees.scala.html#410280" title="CleanUp.this.global.Name" id="3357541">_</a>,<a href="../../../reflect/internal/Trees.scala.html#410282" title="List[CleanUp.this.global.TypeDef]" id="3357542">_</a>,<a href="../../../reflect/internal/Trees.scala.html#410284" title="List[List[CleanUp.this.global.ValDef]]" id="3357543">_</a>,<a href="../../../reflect/internal/Trees.scala.html#410286" title="CleanUp.this.global.Tree" id="3357544">_</a>,<a href="../../../reflect/internal/Trees.scala.html#410288" title="CleanUp.this.global.Tree" id="3357545">_</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
            // modify existing static ctor
            <a href="../../../reflect/internal/Trees.scala.html#408156" title="(ddef: CleanUp.this.global.Tree)(applyToRhs: CleanUp.this.global.Tree =&gt; CleanUp.this.global.Tree)CleanUp.this.global.DefDef">deriveDefDef</a><span class="delimiter">(</span>ctor<span class="delimiter">)</span> <a href="#3357549" title="(x: CleanUp.this.global.analyzer.global.Tree)CleanUp.this.global.analyzer.global.Tree" class="delimiter">{</a>
              <span class="keyword">case</span> block @ Block<a href="#3357527" title="CleanUp.this.global.Tree" id="3357529" class="delimiter">(</a><a href="../../../reflect/internal/Trees.scala.html#410192" title="List[CleanUp.this.global.Tree]" id="978382">stats</a>, <a href="../../../reflect/internal/Trees.scala.html#410194" title="CleanUp.this.global.Tree" id="978383">expr</a><span class="delimiter">)</span> =&gt;
                // need to add inits to existing block
                <a href="../../../reflect/api/Trees.scala.html#405645" title="=&gt; CleanUp.this.global.TreeCopier">treeCopy</a>.<a href="../../../reflect/api/Trees.scala.html#405380" title="(tree: CleanUp.this.global.Tree, stats: List[CleanUp.this.global.Tree], expr: CleanUp.this.global.Tree)CleanUp.this.global.Block">Block</a><a href="#3357533" title="(x: CleanUp.this.global.Tree)CleanUp.this.global.Tree" class="delimiter">(</a>block, <a href="#976372" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticInits</a>.<a href="../../../collection/TraversableOnce.scala.html#58263" title="=&gt; List[CleanUp.this.global.Tree]">toList</a> <a href="../../../collection/immutable/List.scala.html#62688" title="(prefix: List[CleanUp.this.global.Tree])List[CleanUp.this.global.Tree]">:::</a> <a href="#978382" title="List[CleanUp.this.global.Tree]">stats</a>, <a href="#978383" title="CleanUp.this.global.Tree">expr</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="#3357527" title="CleanUp.this.global.Tree" id="3357531">term</a>: TermTree =&gt;
                // need to create a new block with inits and the old term
                <a href="../../../reflect/api/Trees.scala.html#405645" title="=&gt; CleanUp.this.global.TreeCopier">treeCopy</a>.<a href="../../../reflect/api/Trees.scala.html#405380" title="(tree: CleanUp.this.global.Tree, stats: List[CleanUp.this.global.Tree], expr: CleanUp.this.global.Tree)CleanUp.this.global.Block">Block</a><a href="#3357533" title="(x: CleanUp.this.global.Tree)CleanUp.this.global.Tree" class="delimiter">(</a>term, <a href="#976372" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticInits</a>.<a href="../../../collection/TraversableOnce.scala.html#58263" title="=&gt; List[CleanUp.this.global.Tree]">toList</a>, term<span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="keyword">case</span> _ =&gt;
            // create new static ctor
            <span class="keyword">val</span> <a title="CleanUp.this.global.MethodSymbol" id="978394">staticCtorSym</a>  = <a href="../../../reflect/api/Trees.scala.html#405651" title="=&gt; CleanUp.this.global.Symbol">currentClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#411117" title="(pos: CleanUp.this.global.Position)CleanUp.this.global.MethodSymbol">newStaticConstructor</a><span class="delimiter">(</span><a href="#976463" title="CleanUp.this.global.Template">template</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; CleanUp.this.global.Position">pos</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="CleanUp.this.global.Block" id="978395">rhs</a>            = <a href="../../../reflect/internal/Trees.scala.html#453067" title="(stats: List[CleanUp.this.global.Tree], expr: CleanUp.this.global.Tree)CleanUp.this.global.Block">Block</a><span class="delimiter">(</span><a href="#976372" title="=&gt; scala.collection.mutable.Buffer[CleanUp.this.global.Tree]">newStaticInits</a>.<a href="../../../collection/TraversableOnce.scala.html#58263" title="=&gt; List[CleanUp.this.global.Tree]">toList</a>, <a href="../../../reflect/internal/Trees.scala.html#413609" title="(value: CleanUp.this.global.Constant)CleanUp.this.global.Literal">Literal</a><span class="delimiter">(</span><a href="../../../reflect/internal/Constants.scala.html#415091" title="(value: Any)CleanUp.this.global.Constant">Constant</a><span class="delimiter">(</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

            <a href="#976383" title="=&gt; CleanUp.this.global.analyzer.Typer">localTyper</a>.<a href="../typechecker/Typers.scala.html#538703" title="(pos: CleanUp.this.global.analyzer.global.Position)(tree: CleanUp.this.global.analyzer.global.Tree)CleanUp.this.global.analyzer.global.Tree">typedPos</a><span class="delimiter">(</span><a href="#976463" title="CleanUp.this.global.Template">template</a>.<a href="../../../reflect/internal/Trees.scala.html#408571" title="=&gt; CleanUp.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#408109" title="(sym: CleanUp.this.global.Symbol, rhs: CleanUp.this.global.Tree)CleanUp.this.global.DefDef">DefDef</a><span class="delimiter">(</span><a href="#978394" title="CleanUp.this.global.MethodSymbol">staticCtorSym</a>, <a href="#978395" title="CleanUp.this.global.Block">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="../../../reflect/internal/Trees.scala.html#408158" title="(templ: CleanUp.this.global.Tree)(applyToBody: List[CleanUp.this.global.Tree] =&gt; List[CleanUp.this.global.Tree])CleanUp.this.global.Template">deriveTemplate</a><span class="delimiter">(</span><a href="#976463" title="CleanUp.this.global.Template">template</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#978360" title="CleanUp.this.global.analyzer.global.Tree">newCtor</a> <a href="../../../collection/immutable/List.scala.html#62685" title="(x: CleanUp.this.global.Tree)List[CleanUp.this.global.Tree]">::</a> <a href="#978444" title="List[CleanUp.this.global.Tree]">_</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span> // CleanUpTransformer

<span class="delimiter">}</span>

        </pre>
    </body>
</html>