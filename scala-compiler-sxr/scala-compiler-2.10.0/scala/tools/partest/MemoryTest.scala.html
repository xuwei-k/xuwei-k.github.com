<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/partest/MemoryTest.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.partest

<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class MemoryTest extends Object" id="50606">MemoryTest</a> <a href="#50606" title="scala.tools.partest.MemoryTest" class="delimiter">{</a>
  <span class="keyword">def</span> <a title="=&gt; Double" id="1142515">maxDelta</a>: <a href="../../Double.scala.html#720" title="Double">Double</a>
  <span class="keyword">def</span> <a title="=&gt; Int" id="1142516">calcsPerIter</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>
  <span class="keyword">def</span> <a title="()Unit" id="1142517">calc</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../Unit.scala.html#1515" title="Unit">Unit</a>

  <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="1142518">main</a><span class="delimiter">(</span><a title="Array[String]" id="1142520">args</a>: <a href="../../Array.scala.html#174" title="Array[String]">Array</a><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Runtime" id="1142521">rt</a> = <span title="Runtime.type">Runtime</span>.<span title="()Runtime">getRuntime</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="()Double" id="1142522">memUsage</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">import</span> java.lang.management._
      <span class="keyword">import</span> scala.collection.<a href="../../collection/JavaConverters.scala.html#4242" title="scala.collection.JavaConverters.type">JavaConverters</a>._
      <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[java.lang.management.MemoryPoolMXBean]" id="1142530">pools</a> = <span title="java.lang.management.ManagementFactory.type">ManagementFactory</span>.<a href="../../collection/convert/DecorateAsScala.scala.html#57948" title="(l: java.util.List[java.lang.management.MemoryPoolMXBean])scala.collection.convert.Decorators.AsScala[scala.collection.mutable.Buffer[java.lang.management.MemoryPoolMXBean]]">getMemoryPoolMXBeans</a>.<a href="../../collection/convert/Decorators.scala.html#149620" title="=&gt; scala.collection.mutable.Buffer[java.lang.management.MemoryPoolMXBean]">asScala</a>
      <a href="#1142530" title="scala.collection.mutable.Buffer[java.lang.management.MemoryPoolMXBean]">pools</a>.<a href="../../collection/TraversableLike.scala.html#58063" title="(f: java.lang.management.MemoryPoolMXBean =&gt; Long)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[java.lang.management.MemoryPoolMXBean],Long,scala.collection.mutable.Buffer[Long]])scala.collection.mutable.Buffer[Long]">map</a><a href="../../collection/mutable/Buffer.scala.html#146235" title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,Long,scala.collection.mutable.Buffer[Long]]" class="delimiter">(</a><a href="#1142592" title="java.lang.management.MemoryPoolMXBean">_</a>.<span title="()java.lang.management.MemoryUsage">getUsage</span>.<span title="()Long">getUsed</span><span class="delimiter">)</span>.<a href="../../collection/TraversableOnce.scala.html#58232" title="(implicit num: Numeric[Long])Long">sum</a> <a href="../../Long.scala.html#57544" title="(x: Double)Double">/</a> <span title="Double(1000000.0)" class="double">1000000d</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[Double]" id="1142523">history</a> = scala.collection.mutable.<a href="../../collection/generic/GenericCompanion.scala.html#59933" title="[A](elems: A*)scala.collection.mutable.ListBuffer[A]">ListBuffer</a><span title="(elems: Double*)scala.collection.mutable.ListBuffer[Double]" class="delimiter">[</span><a href="../../Double.scala.html#720" title="Double">Double</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="()scala.collection.mutable.ListBuffer[Double]" id="1142524">stressTestIter</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="Int" id="1142734">i</a> = <span title="Int(0)" class="int">0</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#1142734" title="Int">i</a> <a href="../../Int.scala.html#57111" title="(x: Int)Boolean">&lt;</a> <a href="#1142516" title="=&gt; Int">calcsPerIter</a><span class="delimiter">)</span> <a href="#1142735" title="()Unit" class="delimiter">{</a> <a href="#1142517" title="()Unit">calc</a><span class="delimiter">(</span><span class="delimiter">)</span>; <a href="#1142734" title="Int">i</a> <a href="../../Int.scala.html#57154" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span> <span class="delimiter">}</span>
      <a href="../../LowPriorityImplicits.scala.html#7395" title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</a> <a href="../../runtime/RichInt.scala.html#57062" title="(end: Int)scala.collection.immutable.Range.Inclusive">to</a> <span title="Int(5)" class="int">5</span> <a href="../../collection/immutable/Range.scala.html#81297" title="(f: Int =&gt; Unit)Unit">foreach</a> <span class="delimiter">(</span><a title="Int" id="1142890">_</a> =&gt; <a href="#1142521" title="Runtime">rt</a>.<span title="()Unit">gc</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#1142523" title="scala.collection.mutable.ListBuffer[Double]">history</a> <a href="../../collection/mutable/ListBuffer.scala.html#79765" title="(x: Double)history.type">+=</a> <a href="#1142522" title="()Double">memUsage</a>
    <span class="delimiter">}</span>

    <a href="../../LowPriorityImplicits.scala.html#7395" title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</a> <a href="../../runtime/RichInt.scala.html#57062" title="(end: Int)scala.collection.immutable.Range.Inclusive">to</a> <span title="Int(5)" class="int">5</span> <a href="../../collection/immutable/Range.scala.html#81297" title="(f: Int =&gt; scala.collection.mutable.ListBuffer[Double])Unit">foreach</a> <span class="delimiter">(</span><a title="Int" id="1143012">_</a> =&gt; <a href="#1142524" title="()scala.collection.mutable.ListBuffer[Double]">stressTestIter</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Double" id="1142525">reference</a> = <a href="#1142522" title="()Double">memUsage</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="../../LowPriorityImplicits.scala.html#7395" title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</a> <a href="../../runtime/RichInt.scala.html#57062" title="(end: Int)scala.collection.immutable.Range.Inclusive">to</a> <span title="Int(5)" class="int">5</span> <a href="../../collection/immutable/Range.scala.html#81297" title="(f: Int =&gt; scala.collection.mutable.ListBuffer[Double])Unit">foreach</a> <span class="delimiter">(</span><a title="Int" id="1143125">_</a> =&gt; <a href="#1142524" title="()scala.collection.mutable.ListBuffer[Double]">stressTestIter</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="../../LowPriorityImplicits.scala.html#7395" title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</a> <a href="../../runtime/RichInt.scala.html#57062" title="(end: Int)scala.collection.immutable.Range.Inclusive">to</a> <span title="Int(5)" class="int">5</span> <a href="../../collection/immutable/Range.scala.html#81297" title="(f: Int =&gt; Unit)Unit">foreach</a> <span class="delimiter">(</span><a title="Int" id="1143238">_</a> =&gt; <a href="#1142521" title="Runtime">rt</a>.<span title="()Unit">gc</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Double" id="1142526">result</a> = <a href="#1142522" title="()Double">memUsage</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#1142523" title="scala.collection.mutable.ListBuffer[Double]">history</a> <a href="../../collection/mutable/ListBuffer.scala.html#79765" title="(x: Double)history.type">+=</a> <a href="#1142526" title="Double">result</a>

    <span class="keyword">val</span> <a title="Double" id="1142527">delta</a> = <a href="#1142526" title="Double">result</a> <a href="../../Double.scala.html#57761" title="(x: Double)Double">-</a> <a href="#1142525" title="Double">reference</a>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1142527" title="Double">delta</a> <a href="../../Double.scala.html#57740" title="(x: Double)Boolean">&gt;</a> <a href="#1142515" title="=&gt; Double">maxDelta</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../Predef.scala.html#7514" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;FAILED&quot;)" class="string">&quot;FAILED&quot;</span><span class="delimiter">)</span>
      <a href="#1142523" title="scala.collection.mutable.ListBuffer[Double]">history</a> <a href="../../collection/generic/TraversableForwarder.scala.html#79857" title="(f: Double =&gt; Unit)Unit">foreach</a> <span class="delimiter">(</span><a title="Double" id="1143270">mb</a> =&gt; <a href="../../Predef.scala.html#7514" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="#1143270" title="Double">mb</a> <a href="../../Double.scala.html#57705" title="(x: String)String">+</a> <span title="String(&quot; Mb&quot;)" class="string">&quot; Mb&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>