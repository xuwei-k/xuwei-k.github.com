<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/partest/CompilerTest.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2013 LAMP/EPFL
 * @author Paul Phillips
 */

<span class="keyword">package</span> scala.tools.partest

<span class="keyword">import</span> scala.reflect.runtime.<span class="delimiter">{</span>universe =&gt; ru<span class="delimiter">}</span>
<span class="keyword">import</span> scala.tools.nsc._

/** For testing compiler internals directly.
 *  Each source code string in &quot;sources&quot; will be compiled, and
 *  the check function will be called with the source code and the
 *  resulting CompilationUnit.  The check implementation should
 *  test for what it wants to test and fail (via assert or other
 *  exception) if it is not happy.
 */
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class CompilerTest extends scala.tools.partest.DirectTest" id="50587">CompilerTest</a> <a href="#50587" title="scala.tools.partest.CompilerTest" class="keyword">extends</a> <a href="DirectTest.scala.html#50595" title="scala.tools.partest.DirectTest">DirectTest</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(source: String, unit: CompilerTest.this.global.CompilationUnit)Unit" id="1141252">check</a><span class="delimiter">(</span><a title="String" id="1141268">source</a>: <span title="String">String</span>, <a title="CompilerTest.this.global.CompilationUnit" id="1141269">unit</a>: global.<a href="../nsc/CompilationUnits.scala.html#537766" title="CompilerTest.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span>: <a href="../../Unit.scala.html#1515" title="Unit">Unit</a>

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.tools.nsc.Global" id="1141254">global</a>: <a href="../nsc/Global.scala.html#27346" title="scala.tools.nsc.Global">Global</a> = <a href="DirectTest.scala.html#1141239" title="(args: String*)scala.tools.nsc.Global">newCompiler</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[CompilerTest.this.global.CompilationUnit]" id="1141256">units</a> = <a href="DirectTest.scala.html#1141243" title="(global: scala.tools.nsc.Global)(sourceCodes: String*)List[global.CompilationUnit]">compilationUnits</a><span class="delimiter">(</span><a href="#1141253" title="=&gt; scala.tools.nsc.Global">global</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1141262" title="=&gt; List[String]">sources</a>: _ *<span class="delimiter">)</span>
  <span class="keyword">import</span> <a href="#1141253" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../reflect/internal/Definitions.scala.html#407777" title="CompilerTest.this.global.definitions.type">definitions</a>._

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; String" id="1141259">extraSettings</a> = <span title="String(&quot;-usejavacp -d &quot;)" class="string">&quot;-usejavacp -d &quot;</span> <span title="(x$1: Any)String">+</span> <a href="DirectTest.scala.html#1141235" title="=&gt; scala.reflect.io.Directory">testOutput</a>.<a href="../../reflect/io/Path.scala.html#530886" title="=&gt; String">path</a>

  <span class="keyword">def</span> <a title="()Unit" id="1141260">show</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="../../Predef.scala.html#7531" title="(x: (List[String], List[CompilerTest.this.global.CompilationUnit]))runtime.Tuple2Zipped.Ops[List[String],List[CompilerTest.this.global.CompilationUnit]]" class="delimiter">(</a><a href="#1141262" title="=&gt; List[String]">sources</a>, <a href="#1141255" title="=&gt; List[CompilerTest.this.global.CompilationUnit]">units</a><span class="delimiter">)</span>.<a href="../../runtime/Tuple2Zipped.scala.html#60613" title="(implicit w1: List[String] =&gt; scala.collection.TraversableLike[String,List[String]], implicit w2: List[CompilerTest.this.global.CompilationUnit] =&gt; scala.collection.IterableLike[CompilerTest.this.global.CompilationUnit,List[CompilerTest.this.global.CompilationUnit]])scala.runtime.Tuple2Zipped[String,List[String],CompilerTest.this.global.CompilationUnit,List[CompilerTest.this.global.CompilationUnit]]">zipped</a> <a href="../../runtime/Tuple2Zipped.scala.html#486057" title="(f: (String, CompilerTest.this.global.CompilationUnit) =&gt; Unit)Unit">foreach</a> <a href="#1141252" title="(source: String, unit: CompilerTest.this.global.CompilationUnit)Unit">check</a>

  // Override at least one of these...
  <span class="keyword">def</span> <a title="=&gt; String" id="1141261">code</a> = <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>
  <span class="keyword">def</span> <a title="=&gt; List[String]" id="1141262">sources</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[String]">List</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="../../collection/immutable/List.scala.html#62451" title="(xs: String*)List[String]">List</a><span class="delimiter">(</span><a href="#1141261" title="=&gt; String">code</a><span class="delimiter">)</span>

  // Utility functions

  <span class="keyword">class</span> <a title="class MkType extends Object" id="1141263">MkType</a><a href="#1141263" title="CompilerTest.this.MkType" class="delimiter">(</a><a title="CompilerTest.this.global.Symbol" id="1141385">sym</a>: <a href="../../reflect/internal/Symbols.scala.html#407146" title="CompilerTest.this.global.Symbol">Symbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="[M](implicit t: reflect.runtime.universe.TypeTag[M])CompilerTest.this.global.Type" id="1141380">apply</a><span class="delimiter">[</span><a title="" id="1141382">M</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="reflect.runtime.universe.TypeTag[M]" id="1141386">t</a>: ru.<a href="../../reflect/api/TypeTags.scala.html#56539" title="reflect.runtime.universe.TypeTag[M]">TypeTag</a><span class="delimiter">[</span>M<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../reflect/internal/Types.scala.html#407270" title="CompilerTest.this.global.Type">Type</a> =
      <span title="CompilerTest.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1141385" title="CompilerTest.this.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../reflect/internal/Symbols.scala.html#407184" title="=&gt; CompilerTest.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <a href="../../reflect/internal/Types.scala.html#407284" title="CompilerTest.this.global.NoType.type">NoType</a>
      <span class="keyword">else</span> <a href="../../reflect/internal/Types.scala.html#407409" title="(tyconSym: CompilerTest.this.global.Symbol, args: CompilerTest.this.global.Type*)CompilerTest.this.global.Type">appliedType</a><span class="delimiter">(</span><a href="#1141385" title="CompilerTest.this.global.Symbol">sym</a>, <a href="../../reflect/internal/Definitions.scala.html#408963" title="(tt: scala.reflect.api.Universe#WeakTypeTag[_])CompilerTest.this.global.Type">compilerTypeFromTag</a><span class="delimiter">(</span><a href="#1141386" title="reflect.runtime.universe.TypeTag[M]">t</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scala.tools.partest.CompilerTest.mkMkType : (sym: CompilerTest.this.global.Symbol)CompilerTest.this.MkType" id="1141264">mkMkType</a><span class="delimiter">(</span><a title="CompilerTest.this.global.Symbol" id="1141399">sym</a>: <a href="../../reflect/internal/Symbols.scala.html#407146" title="CompilerTest.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <span title="CompilerTest.this.MkType" class="keyword">new</span> <a href="#1141263" title="CompilerTest.this.MkType">MkType</a><span class="delimiter">(</span><a href="#1141399" title="CompilerTest.this.global.Symbol">sym</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(root: CompilerTest.this.global.Symbol)List[CompilerTest.this.global.Symbol]" id="1141265">allMembers</a><span class="delimiter">(</span><a title="CompilerTest.this.global.Symbol" id="1141400">root</a>: <a href="../../reflect/internal/Symbols.scala.html#407146" title="CompilerTest.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CompilerTest.this.global.Symbol]">List</a><span class="delimiter">[</span>Symbol<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(seen: Set[CompilerTest.this.global.Symbol], roots: List[CompilerTest.this.global.Symbol])List[CompilerTest.this.global.Symbol]" id="1141401">loop</a><span class="delimiter">(</span><a title="Set[CompilerTest.this.global.Symbol]" id="1141402">seen</a>: <a href="../../collection/immutable/Set.scala.html#11919" title="Set[CompilerTest.this.global.Symbol]">Set</a><span class="delimiter">[</span>Symbol<span class="delimiter">]</span>, <a title="List[CompilerTest.this.global.Symbol]" id="1141403">roots</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CompilerTest.this.global.Symbol]">List</a><span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CompilerTest.this.global.Symbol]">List</a><span class="delimiter">[</span>Symbol<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[CompilerTest.this.global.Symbol]" id="1141404">latest</a> = <a href="#1141403" title="List[CompilerTest.this.global.Symbol]">roots</a> <a href="../../collection/TraversableLike.scala.html#58068" title="(f: CompilerTest.this.global.Symbol =&gt; scala.collection.GenTraversableOnce[CompilerTest.this.global.Symbol])(implicit bf: scala.collection.generic.CanBuildFrom[List[CompilerTest.this.global.Symbol],CompilerTest.this.global.Symbol,List[CompilerTest.this.global.Symbol]])List[CompilerTest.this.global.Symbol]">flatMap</a> <span class="delimiter">(</span><a href="#1141421" title="CompilerTest.this.global.Symbol">_</a>.<a href="../../reflect/internal/Symbols.scala.html#411367" title="=&gt; CompilerTest.this.global.Type">info</a>.<a href="../../reflect/internal/Types.scala.html#408446" title="=&gt; CompilerTest.this.global.Scope">members</a><span class="delimiter">)</span> <a href="../../collection/TraversableLike.scala.html#58074" title="(p: CompilerTest.this.global.Symbol =&gt; Boolean)List[CompilerTest.this.global.Symbol]">filterNot</a> <span class="delimiter">(</span><a href="#1141402" title="Set[CompilerTest.this.global.Symbol]">seen</a> <a href="../../collection/SetLike.scala.html#66442" title="(elem: CompilerTest.this.global.Symbol)Boolean">contains</a> <a href="#1141456" title="CompilerTest.this.global.Symbol">_</a><span class="delimiter">)</span>
      <span title="List[CompilerTest.this.global.Symbol]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1141404" title="List[CompilerTest.this.global.Symbol]">latest</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="#1141402" title="Set[CompilerTest.this.global.Symbol]">seen</a>.<a href="../../collection/TraversableOnce.scala.html#58263" title="=&gt; List[CompilerTest.this.global.Symbol]">toList</a>.<a href="../../collection/SeqLike.scala.html#58868" title="(lt: (CompilerTest.this.global.Symbol, CompilerTest.this.global.Symbol) =&gt; Boolean)List[CompilerTest.this.global.Symbol]">sortWith</a><span class="delimiter">(</span><a href="#1141461" title="CompilerTest.this.global.Symbol">_</a> <a href="../../reflect/internal/Symbols.scala.html#411407" title="(that: CompilerTest.this.global.Symbol)Boolean">isLess</a> <a href="#1141462" title="CompilerTest.this.global.Symbol">_</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="#1141401" title="(seen: Set[CompilerTest.this.global.Symbol], roots: List[CompilerTest.this.global.Symbol])List[CompilerTest.this.global.Symbol]">loop</a><span class="delimiter">(</span><a href="#1141402" title="Set[CompilerTest.this.global.Symbol]">seen</a> <a href="../../collection/SetLike.scala.html#66445" title="(elems: scala.collection.GenTraversableOnce[CompilerTest.this.global.Symbol])scala.collection.immutable.Set[CompilerTest.this.global.Symbol]">++</a> <a href="#1141404" title="List[CompilerTest.this.global.Symbol]">latest</a>, <a href="#1141404" title="List[CompilerTest.this.global.Symbol]">latest</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#1141401" title="(seen: Set[CompilerTest.this.global.Symbol], roots: List[CompilerTest.this.global.Symbol])List[CompilerTest.this.global.Symbol]">loop</a><span class="delimiter">(</span><a href="../../collection/generic/GenericCompanion.scala.html#59933" title="(elems: CompilerTest.this.global.Symbol*)scala.collection.immutable.Set[CompilerTest.this.global.Symbol]">Set</a><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: CompilerTest.this.global.Symbol*)List[CompilerTest.this.global.Symbol]">List</a><span class="delimiter">(</span><a href="#1141400" title="CompilerTest.this.global.Symbol">root</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">class</span> <a title="class SymsInPackage extends Object" id="1141266">SymsInPackage</a><a href="#1141266" title="CompilerTest.this.SymsInPackage" class="delimiter">(</a><a title="String" id="1141535">pkgName</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; CompilerTest.this.global.ModuleSymbol" id="1141526">pkg</a>     = <a href="../nsc/Global.scala.html#537442" title="=&gt; CompilerTest.this.global.Mirror">rootMirror</a>.<a href="../../reflect/internal/Mirrors.scala.html#412995" title="(fullname: String)CompilerTest.this.global.ModuleSymbol">getRequiredPackage</a><span class="delimiter">(</span><a href="#1141535" title="String">pkgName</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; List[CompilerTest.this.global.Symbol]" id="1141527">classes</a> = <a href="#1141265" title="(root: CompilerTest.this.global.Symbol)List[CompilerTest.this.global.Symbol]">allMembers</a><span class="delimiter">(</span><a href="#1141526" title="=&gt; CompilerTest.this.global.ModuleSymbol">pkg</a><span class="delimiter">)</span> <a href="../../collection/TraversableLike.scala.html#58073" title="(p: CompilerTest.this.global.Symbol =&gt; Boolean)List[CompilerTest.this.global.Symbol]">filter</a> <span class="delimiter">(</span><a href="#1141541" title="CompilerTest.this.global.Symbol">_</a>.<a href="../../reflect/api/Symbols.scala.html#402403" title="=&gt; Boolean">isClass</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; List[CompilerTest.this.global.Symbol]" id="1141528">modules</a> = <a href="#1141265" title="(root: CompilerTest.this.global.Symbol)List[CompilerTest.this.global.Symbol]">allMembers</a><span class="delimiter">(</span><a href="#1141526" title="=&gt; CompilerTest.this.global.ModuleSymbol">pkg</a><span class="delimiter">)</span> <a href="../../collection/TraversableLike.scala.html#58073" title="(p: CompilerTest.this.global.Symbol =&gt; Boolean)List[CompilerTest.this.global.Symbol]">filter</a> <span class="delimiter">(</span><a href="#1141547" title="CompilerTest.this.global.Symbol">_</a>.<a href="../../reflect/api/Symbols.scala.html#402401" title="=&gt; Boolean">isModule</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; List[CompilerTest.this.global.Symbol]" id="1141529">symbols</a> = <a href="#1141527" title="=&gt; List[CompilerTest.this.global.Symbol]">classes</a> <a href="../../collection/immutable/List.scala.html#62697" title="(that: scala.collection.GenTraversableOnce[CompilerTest.this.global.Symbol])(implicit bf: scala.collection.generic.CanBuildFrom[List[CompilerTest.this.global.Symbol],CompilerTest.this.global.Symbol,List[CompilerTest.this.global.Symbol]])List[CompilerTest.this.global.Symbol]">++</a> <a href="#1141530" title="=&gt; List[CompilerTest.this.global.Symbol]">terms</a> <a href="../../collection/TraversableLike.scala.html#58074" title="(p: CompilerTest.this.global.Symbol =&gt; Boolean)List[CompilerTest.this.global.Symbol]">filterNot</a> <span class="delimiter">(</span><a href="#1141617" title="CompilerTest.this.global.Symbol">_</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../reflect/internal/Symbols.scala.html#407184" title="=&gt; CompilerTest.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; List[CompilerTest.this.global.Symbol]" id="1141530">terms</a>   = <a href="#1141265" title="(root: CompilerTest.this.global.Symbol)List[CompilerTest.this.global.Symbol]">allMembers</a><span class="delimiter">(</span><a href="#1141526" title="=&gt; CompilerTest.this.global.ModuleSymbol">pkg</a><span class="delimiter">)</span> <a href="../../collection/TraversableLike.scala.html#58073" title="(p: CompilerTest.this.global.Symbol =&gt; Boolean)List[CompilerTest.this.global.Symbol]">filter</a> <span class="delimiter">(</span><a title="CompilerTest.this.global.Symbol" id="1141583">s</a> =&gt; <a href="#1141583" title="CompilerTest.this.global.Symbol">s</a>.<a href="../../reflect/api/Symbols.scala.html#402396" title="=&gt; Boolean">isTerm</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1141583" title="CompilerTest.this.global.Symbol">s</a>.<a href="../../reflect/internal/Symbols.scala.html#411201" title="=&gt; Boolean">isConstructor</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; List[CompilerTest.this.global.Symbol]" id="1141531">tparams</a> = <a href="#1141527" title="=&gt; List[CompilerTest.this.global.Symbol]">classes</a> <a href="../../collection/TraversableLike.scala.html#58068" title="(f: CompilerTest.this.global.Symbol =&gt; scala.collection.GenTraversableOnce[CompilerTest.this.global.Symbol])(implicit bf: scala.collection.generic.CanBuildFrom[List[CompilerTest.this.global.Symbol],CompilerTest.this.global.Symbol,List[CompilerTest.this.global.Symbol]])List[CompilerTest.this.global.Symbol]">flatMap</a> <span class="delimiter">(</span><a href="#1141637" title="CompilerTest.this.global.Symbol">_</a>.<a href="../../reflect/internal/Symbols.scala.html#411367" title="=&gt; CompilerTest.this.global.Type">info</a>.<a href="../../reflect/internal/Types.scala.html#408432" title="=&gt; List[CompilerTest.this.global.Symbol]">typeParams</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; List[CompilerTest.this.global.Type]" id="1141532">tpes</a>    = <a href="#1141529" title="=&gt; List[CompilerTest.this.global.Symbol]">symbols</a> <a href="../../collection/TraversableLike.scala.html#58063" title="(f: CompilerTest.this.global.Symbol =&gt; CompilerTest.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[CompilerTest.this.global.Symbol],CompilerTest.this.global.Type,List[CompilerTest.this.global.Type]])List[CompilerTest.this.global.Type]">map</a> <span class="delimiter">(</span><a href="#1141685" title="CompilerTest.this.global.Symbol">_</a>.<a href="../../reflect/internal/Symbols.scala.html#411365" title="=&gt; CompilerTest.this.global.Type">tpe</a><span class="delimiter">)</span> <a href="../../collection/SeqLike.scala.html#58839" title="=&gt; List[CompilerTest.this.global.Type]">distinct</a>
  <span class="delimiter">}</span>
<span title="Object" class="delimiter">}</span>

        </pre>
    </body>
</html>