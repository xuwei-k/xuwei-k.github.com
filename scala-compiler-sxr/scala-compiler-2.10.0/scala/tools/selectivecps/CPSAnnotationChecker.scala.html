<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/selectivecps/CPSAnnotationChecker.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
// $Id$

<span class="keyword">package</span> scala.tools.selectivecps

<span class="keyword">import</span> scala.tools.nsc.Global
<span class="keyword">import</span> scala.tools.nsc.typechecker.Modes
<span class="keyword">import</span> scala.tools.nsc.MissingRequirementError

<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class CPSAnnotationChecker extends Object with scala.tools.selectivecps.CPSUtils with scala.tools.nsc.typechecker.Modes" id="51699">CPSAnnotationChecker</a> <a href="#51699" title="scala.tools.selectivecps.CPSAnnotationChecker" class="keyword">extends</a> <a href="CPSUtils.scala.html#51704" title="scala.tools.selectivecps.CPSUtils">CPSUtils</a> <span class="keyword">with</span> <a href="../nsc/typechecker/Modes.scala.html#48698" title="scala.tools.nsc.typechecker.Modes">Modes</a> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="=&gt; scala.tools.nsc.Global" id="1211390">global</a>: <a href="../nsc/Global.scala.html#27346" title="scala.tools.nsc.Global">Global</a>
  <span class="keyword">import</span> <a href="#1211390" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../reflect/internal/Definitions.scala.html#407777" title="CPSAnnotationChecker.this.global.definitions.type">definitions</a>._

  //override val verbose = true
  @inline <span class="keyword">override</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="(x: =&gt; Any)Unit" id="1211393">vprintln</a><span class="delimiter">(</span><a title="=&gt; Any" id="1211397">x</a>: =&gt;Any<span class="delimiter">)</span>: <a href="../../Unit.scala.html#1515" title="Unit">Unit</a> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="CPSUtils.scala.html#1211331" title="=&gt; Boolean">verbose</a><span class="delimiter">)</span> <a href="../../Predef.scala.html#7514" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="#1211397" title="=&gt; Any">x</a><span class="delimiter">)</span>

  /**
   *  Checks whether @cps annotations conform
   */
  <span class="keyword">object</span> <a title="CPSAnnotationChecker.this.checker.type" id="1211394">checker</a> <a href="#1211395" title="CPSAnnotationChecker.this.checker.type" class="keyword">extends</a> <a href="../../reflect/internal/AnnotationCheckers.scala.html#406572" title="CPSAnnotationChecker.this.global.AnnotationChecker">AnnotationChecker</a> <span class="delimiter">{</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(tp: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type" id="1211403">addPlusMarker</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Type" id="1211421">tp</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a><span class="delimiter">)</span>  = <a href="#1211421" title="CPSAnnotationChecker.this.global.Type">tp</a> <a href="../../reflect/internal/AnnotationInfos.scala.html#408618" title="(annot: CPSAnnotationChecker.this.global.AnnotationInfo)CPSAnnotationChecker.this.global.Type">withAnnotation</a> <a href="CPSUtils.scala.html#1211367" title="()CPSAnnotationChecker.this.global.AnnotationInfo">newPlusMarker</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(tp: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type" id="1211404">addMinusMarker</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Type" id="1211431">tp</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a><span class="delimiter">)</span> = <a href="#1211431" title="CPSAnnotationChecker.this.global.Type">tp</a> <a href="../../reflect/internal/AnnotationInfos.scala.html#408618" title="(annot: CPSAnnotationChecker.this.global.AnnotationInfo)CPSAnnotationChecker.this.global.Type">withAnnotation</a> <a href="CPSUtils.scala.html#1211368" title="()CPSAnnotationChecker.this.global.AnnotationInfo">newMinusMarker</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(tp: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type" id="1211405">cleanPlus</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Type" id="1211439">tp</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a><span class="delimiter">)</span> =
      <a href="CPSUtils.scala.html#1211379" title="(tpe: CPSAnnotationChecker.this.global.Type, classes: CPSAnnotationChecker.this.global.Symbol*)CPSAnnotationChecker.this.global.Type">removeAttribs</a><span class="delimiter">(</span><a href="#1211439" title="CPSAnnotationChecker.this.global.Type">tp</a>, <a href="CPSUtils.scala.html#1211342" title="=&gt; CPSAnnotationChecker.this.global.ClassSymbol">MarkerCPSAdaptPlus</a>, <a href="CPSUtils.scala.html#1211338" title="=&gt; CPSAnnotationChecker.this.global.ClassSymbol">MarkerCPSTypes</a><span class="delimiter">)</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(tp: CPSAnnotationChecker.this.global.Type)(newAnnots: CPSAnnotationChecker.this.global.AnnotationInfo*)CPSAnnotationChecker.this.global.Type" id="1211406">cleanPlusWith</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Type" id="1211455">tp</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.AnnotationInfo*" id="1211456">newAnnots</a>: <span title="CPSAnnotationChecker.this.global.AnnotationInfo*">AnnotationInfo</span>*<span class="delimiter">)</span> =
      <a href="#1211405" title="(tp: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">cleanPlus</a><span class="delimiter">(</span><a href="#1211455" title="CPSAnnotationChecker.this.global.Type">tp</a><span class="delimiter">)</span> <a href="../../reflect/internal/Types.scala.html#408513" title="(annots: List[CPSAnnotationChecker.this.global.AnnotationInfo])CPSAnnotationChecker.this.global.Type">withAnnotations</a> <a href="#1211456" title="CPSAnnotationChecker.this.global.AnnotationInfo*">newAnnots</a>.<a href="../../collection/TraversableOnce.scala.html#58263" title="=&gt; List[CPSAnnotationChecker.this.global.AnnotationInfo]">toList</a>

    /** Check annotations to decide whether tpe1 &lt;:&lt; tpe2 */
    <span class="keyword">def</span> <a title="(tpe1: CPSAnnotationChecker.this.global.Type, tpe2: CPSAnnotationChecker.this.global.Type)Boolean" id="1211407">annotationsConform</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Type" id="1211461">tpe1</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a>, <a title="CPSAnnotationChecker.this.global.Type" id="1211462">tpe2</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211328" title="=&gt; Boolean">cpsEnabled</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <span title="Boolean(true)" class="keyword">true</span>

      <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;check annotations: &quot;)" class="string">&quot;check annotations: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211461" title="CPSAnnotationChecker.this.global.Type">tpe1</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; &lt;:&lt; &quot;)" class="string">&quot; &lt;:&lt; &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211462" title="CPSAnnotationChecker.this.global.Type">tpe2</a><span class="delimiter">)</span>

      // Nothing is least element, but Any is not the greatest
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211461" title="CPSAnnotationChecker.this.global.Type">tpe1</a>.<a href="../../reflect/internal/Types.scala.html#408407" title="=&gt; CPSAnnotationChecker.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../reflect/internal/Definitions.scala.html#408692" title="CPSAnnotationChecker.this.global.definitions.NothingClass.type">NothingClass</a><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <span title="Boolean(true)" class="keyword">true</span>

      <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1211465">annots1</a> = <a href="CPSUtils.scala.html#1211381" title="(tpe: CPSAnnotationChecker.this.global.Type)List[CPSAnnotationChecker.this.global.AnnotationInfo]">cpsParamAnnotation</a><span class="delimiter">(</span><a href="#1211461" title="CPSAnnotationChecker.this.global.Type">tpe1</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1211466">annots2</a> = <a href="CPSUtils.scala.html#1211381" title="(tpe: CPSAnnotationChecker.this.global.Type)List[CPSAnnotationChecker.this.global.AnnotationInfo]">cpsParamAnnotation</a><span class="delimiter">(</span><a href="#1211462" title="CPSAnnotationChecker.this.global.Type">tpe2</a><span class="delimiter">)</span>

      // @plus and @minus should only occur at the left, and never together
      // TODO: insert check

      // @minus @cps is the same as no annotations
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="CPSUtils.scala.html#1211373" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasMinusMarker</a><span class="delimiter">(</span><a href="#1211461" title="CPSAnnotationChecker.this.global.Type">tpe1</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <a href="#1211466" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots2</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a>

      // to handle answer type modification, we must make @plus &lt;:&lt; @cps
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="CPSUtils.scala.html#1211374" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasPlusMarker</a><span class="delimiter">(</span><a href="#1211461" title="CPSAnnotationChecker.this.global.Type">tpe1</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1211465" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots1</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <span title="Boolean(true)" class="keyword">true</span>

      // @plus @cps will fall through and compare the @cps type args
      // @cps parameters must match exactly
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#1211465" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots1</a> <a href="../../collection/LinearSeqLike.scala.html#86319" title="(that: scala.collection.GenSeq[CPSAnnotationChecker.this.global.AnnotationInfo])(p: (CPSAnnotationChecker.this.global.AnnotationInfo, CPSAnnotationChecker.this.global.AnnotationInfo) =&gt; Boolean)Boolean">corresponds</a> <a href="#1211466" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots2</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1211499" title="CPSAnnotationChecker.this.global.AnnotationInfo">_</a>.<a href="../../reflect/internal/AnnotationInfos.scala.html#409727" title="=&gt; CPSAnnotationChecker.this.global.Type">atp</a> <a href="../../reflect/internal/Types.scala.html#408481" title="(that: CPSAnnotationChecker.this.global.Type)Boolean">&lt;:&lt;</a> <a href="#1211500" title="CPSAnnotationChecker.this.global.AnnotationInfo">_</a>.<a href="../../reflect/internal/AnnotationInfos.scala.html#409727" title="=&gt; CPSAnnotationChecker.this.global.Type">atp</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <span title="Boolean(true)" class="keyword">true</span>

      // Need to handle uninstantiated type vars specially:

      // g map (x =&gt; x)  with expected type List[Int] @cps
      // results in comparison ?That &lt;:&lt; List[Int] @cps

      // Instantiating ?That to an annotated type would fail during
      // transformation.

      // Instead we force-compare tpe1 &lt;:&lt; tpe2.withoutAnnotations
      // to trigger instantiation of the TypeVar to the base type

      // This is a bit unorthodox (we're only supposed to look at
      // annotations here) but seems to work.

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1211466" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots2</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1211461" title="CPSAnnotationChecker.this.global.Type">tpe1</a>.<a href="../../reflect/internal/Types.scala.html#408503" title="=&gt; Boolean">isGround</a><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <a href="#1211461" title="CPSAnnotationChecker.this.global.Type">tpe1</a> <a href="../../reflect/internal/Types.scala.html#408481" title="(that: CPSAnnotationChecker.this.global.Type)Boolean">&lt;:&lt;</a> <a href="#1211462" title="CPSAnnotationChecker.this.global.Type">tpe2</a>.<a href="../../reflect/internal/Types.scala.html#408510" title="=&gt; CPSAnnotationChecker.this.global.Type">withoutAnnotations</a>

      <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>

    /** Refine the computed least upper bound of a list of types.
     *  All this should do is add annotations. */
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tpe: CPSAnnotationChecker.this.global.Type, ts: List[CPSAnnotationChecker.this.global.Type])CPSAnnotationChecker.this.global.Type" id="1211408">annotationsLub</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Type" id="1211507">tpe</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a>, <a title="List[CPSAnnotationChecker.this.global.Type]" id="1211508">ts</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.Type]">List</a><span class="delimiter">[</span>Type<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211328" title="=&gt; Boolean">cpsEnabled</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <a href="#1211507" title="CPSAnnotationChecker.this.global.Type">tpe</a>

      <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1211511">annots1</a> = <a href="CPSUtils.scala.html#1211381" title="(tpe: CPSAnnotationChecker.this.global.Type)List[CPSAnnotationChecker.this.global.AnnotationInfo]">cpsParamAnnotation</a><span class="delimiter">(</span><a href="#1211507" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1211512">annots2</a> = <a href="#1211508" title="List[CPSAnnotationChecker.this.global.Type]">ts</a> <a href="../../collection/TraversableLike.scala.html#58068" title="(f: CPSAnnotationChecker.this.global.Type =&gt; scala.collection.GenTraversableOnce[CPSAnnotationChecker.this.global.AnnotationInfo])(implicit bf: scala.collection.generic.CanBuildFrom[List[CPSAnnotationChecker.this.global.Type],CPSAnnotationChecker.this.global.AnnotationInfo,List[CPSAnnotationChecker.this.global.AnnotationInfo]])List[CPSAnnotationChecker.this.global.AnnotationInfo]">flatMap</a> <a href="CPSUtils.scala.html#1211381" title="(tpe: CPSAnnotationChecker.this.global.Type)List[CPSAnnotationChecker.this.global.AnnotationInfo]">cpsParamAnnotation</a>

      <span title="CPSAnnotationChecker.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211512" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots2</a>.<a href="../../collection/TraversableOnce.scala.html#58191" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="CPSAnnotationChecker.this.global.AnnotationInfo" id="1211565">cpsLub</a> = <a href="CPSUtils.scala.html#1211369" title="(tpe: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.AnnotationInfo">newMarker</a><span class="delimiter">(</span><a href="#1211390" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../../reflect/internal/Types.scala.html#407605" title="(ts: List[CPSAnnotationChecker.this.global.Type])CPSAnnotationChecker.this.global.Type">lub</a><span class="delimiter">(</span><a href="#1211511" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots1</a><a href="../../collection/immutable/List.scala.html#62688" title="(prefix: List[CPSAnnotationChecker.this.global.AnnotationInfo])List[CPSAnnotationChecker.this.global.AnnotationInfo]">:::</a><a href="#1211512" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots2</a> <a href="../../collection/TraversableLike.scala.html#58063" title="(f: CPSAnnotationChecker.this.global.AnnotationInfo =&gt; CPSAnnotationChecker.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[CPSAnnotationChecker.this.global.AnnotationInfo],CPSAnnotationChecker.this.global.Type,List[CPSAnnotationChecker.this.global.Type]])List[CPSAnnotationChecker.this.global.Type]">map</a> <span class="delimiter">(</span><a href="#1211605" title="CPSAnnotationChecker.this.global.AnnotationInfo">_</a>.<a href="../../reflect/internal/AnnotationInfos.scala.html#409727" title="=&gt; CPSAnnotationChecker.this.global.Type">atp</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="CPSAnnotationChecker.this.global.Type" id="1211566">tpe1</a> = <span title="CPSAnnotationChecker.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211511" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots1</a>.<a href="../../collection/TraversableOnce.scala.html#58191" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <a href="CPSUtils.scala.html#1211379" title="(tpe: CPSAnnotationChecker.this.global.Type, classes: CPSAnnotationChecker.this.global.Symbol*)CPSAnnotationChecker.this.global.Type">removeAttribs</a><span class="delimiter">(</span><a href="#1211507" title="CPSAnnotationChecker.this.global.Type">tpe</a>, <a href="CPSUtils.scala.html#1211338" title="=&gt; CPSAnnotationChecker.this.global.ClassSymbol">MarkerCPSTypes</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#1211507" title="CPSAnnotationChecker.this.global.Type">tpe</a>
        <a href="#1211566" title="CPSAnnotationChecker.this.global.Type">tpe1</a>.<a href="../../reflect/internal/AnnotationInfos.scala.html#408618" title="(annot: CPSAnnotationChecker.this.global.AnnotationInfo)CPSAnnotationChecker.this.global.Type">withAnnotation</a><span class="delimiter">(</span><a href="#1211565" title="CPSAnnotationChecker.this.global.AnnotationInfo">cpsLub</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">else</span> <a href="#1211507" title="CPSAnnotationChecker.this.global.Type">tpe</a>
    <span class="delimiter">}</span>

    /** Refine the bounds on type parameters to the given type arguments. */
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(bounds: List[CPSAnnotationChecker.this.global.TypeBounds], tparams: List[CPSAnnotationChecker.this.global.Symbol], targs: List[CPSAnnotationChecker.this.global.Type])List[CPSAnnotationChecker.this.global.TypeBounds]" id="1211409">adaptBoundsToAnnotations</a><span class="delimiter">(</span><a title="List[CPSAnnotationChecker.this.global.TypeBounds]" id="1211639">bounds</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.TypeBounds]">List</a><span class="delimiter">[</span>TypeBounds<span class="delimiter">]</span>, <a title="List[CPSAnnotationChecker.this.global.Symbol]" id="1211640">tparams</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.Symbol]">List</a><span class="delimiter">[</span>Symbol<span class="delimiter">]</span>, <a title="List[CPSAnnotationChecker.this.global.Type]" id="1211641">targs</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.Type]">List</a><span class="delimiter">[</span>Type<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.TypeBounds]">List</a><span class="delimiter">[</span>TypeBounds<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211328" title="=&gt; Boolean">cpsEnabled</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <a href="#1211639" title="List[CPSAnnotationChecker.this.global.TypeBounds]">bounds</a>

      <span class="keyword">val</span> <a title="CPSAnnotationChecker.this.global.AnnotationInfo" id="1211645">anyAtCPS</a> = <a href="CPSUtils.scala.html#1211371" title="(tp1: CPSAnnotationChecker.this.global.Type, tp2: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.AnnotationInfo">newCpsParamsMarker</a><span class="delimiter">(</span><a href="../../reflect/internal/Definitions.scala.html#408692" title="CPSAnnotationChecker.this.global.definitions.NothingClass.type">NothingClass</a>.<a href="../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a>, <a href="../../reflect/internal/Definitions.scala.html#408667" title="=&gt; CPSAnnotationChecker.this.global.ClassSymbol">AnyClass</a>.<a href="../../reflect/internal/Symbols.scala.html#411559" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>
      <span title="List[CPSAnnotationChecker.this.global.TypeBounds]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../reflect/internal/Definitions.scala.html#409021" title="(tp: CPSAnnotationChecker.this.global.Type)Boolean">isFunctionType</a><span class="delimiter">(</span><a href="#1211640" title="List[CPSAnnotationChecker.this.global.Symbol]">tparams</a>.<a href="../../collection/IterableLike.scala.html#58577" title="=&gt; CPSAnnotationChecker.this.global.Symbol">head</a>.<a href="../../reflect/internal/Symbols.scala.html#411315" title="=&gt; CPSAnnotationChecker.this.global.Symbol">owner</a>.<a href="../../reflect/internal/Symbols.scala.html#411365" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="../../reflect/internal/Definitions.scala.html#409022" title="(tp: CPSAnnotationChecker.this.global.Type)Boolean">isPartialFunctionType</a><span class="delimiter">(</span><a href="#1211640" title="List[CPSAnnotationChecker.this.global.Symbol]">tparams</a>.<a href="../../collection/IterableLike.scala.html#58577" title="=&gt; CPSAnnotationChecker.this.global.Symbol">head</a>.<a href="../../reflect/internal/Symbols.scala.html#411315" title="=&gt; CPSAnnotationChecker.this.global.Symbol">owner</a>.<a href="../../reflect/internal/Symbols.scala.html#411365" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;function bound: &quot;)" class="string">&quot;function bound: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211640" title="List[CPSAnnotationChecker.this.global.Symbol]">tparams</a>.<a href="../../collection/IterableLike.scala.html#58577" title="=&gt; CPSAnnotationChecker.this.global.Symbol">head</a>.<a href="../../reflect/internal/Symbols.scala.html#411315" title="=&gt; CPSAnnotationChecker.this.global.Symbol">owner</a>.<a href="../../reflect/internal/Symbols.scala.html#411365" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span title="(x$1: Any)String">+</span><a href="#1211639" title="List[CPSAnnotationChecker.this.global.TypeBounds]">bounds</a><span title="(x$1: Any)String">+</span><span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span title="(x$1: Any)String">+</span><a href="#1211641" title="List[CPSAnnotationChecker.this.global.Type]">targs</a><span class="delimiter">)</span>
        <span title="List[CPSAnnotationChecker.this.global.TypeBounds]" class="keyword">if</span> <span class="delimiter">(</span><a href="CPSUtils.scala.html#1211376" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasCpsParamTypes</a><span class="delimiter">(</span><a href="#1211641" title="List[CPSAnnotationChecker.this.global.Type]">targs</a>.<a href="../../collection/LinearSeqOptimized.scala.html#86394" title="=&gt; CPSAnnotationChecker.this.global.Type">last</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#1211639" title="List[CPSAnnotationChecker.this.global.TypeBounds]">bounds</a>.<a href="../../collection/immutable/List.scala.html#62716" title="=&gt; List[CPSAnnotationChecker.this.global.TypeBounds]">reverse</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="../../collection/immutable/List.scala.html#206583" title="CPSAnnotationChecker.this.global.TypeBounds" id="1211683">res</a><a href="#3381590" title="List[CPSAnnotationChecker.this.global.TypeBounds]" id="3381591">::</a><a href="../../collection/immutable/List.scala.html#206584" title="List[CPSAnnotationChecker.this.global.TypeBounds]" id="1211684">b</a> <span class="keyword">if</span> <a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211376" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasCpsParamTypes</a><span class="delimiter">(</span><a href="#1211683" title="CPSAnnotationChecker.this.global.TypeBounds">res</a>.<a href="../../reflect/internal/Types.scala.html#410584" title="=&gt; CPSAnnotationChecker.this.global.Type">hi</a><span class="delimiter">)</span> =&gt;
              <span class="delimiter">(</span><a href="../../reflect/internal/Types.scala.html#424774" title="(lo: CPSAnnotationChecker.this.global.Type, hi: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.TypeBounds">TypeBounds</a><span class="delimiter">(</span><a href="#1211683" title="CPSAnnotationChecker.this.global.TypeBounds">res</a>.<a href="../../reflect/internal/Types.scala.html#410582" title="=&gt; CPSAnnotationChecker.this.global.Type">lo</a>, <a href="#1211683" title="CPSAnnotationChecker.this.global.TypeBounds">res</a>.<a href="../../reflect/internal/Types.scala.html#410584" title="=&gt; CPSAnnotationChecker.this.global.Type">hi</a>.<a href="../../reflect/internal/AnnotationInfos.scala.html#408618" title="(annot: CPSAnnotationChecker.this.global.AnnotationInfo)CPSAnnotationChecker.this.global.Type">withAnnotation</a><span class="delimiter">(</span><a href="#1211645" title="CPSAnnotationChecker.this.global.AnnotationInfo">anyAtCPS</a><span class="delimiter">)</span><span class="delimiter">)</span><a href="../../collection/immutable/List.scala.html#62685" title="(x: CPSAnnotationChecker.this.global.TypeBounds)List[CPSAnnotationChecker.this.global.TypeBounds]">::</a><a href="#1211684" title="List[CPSAnnotationChecker.this.global.TypeBounds]">b</a><span class="delimiter">)</span>.<a href="#3381593" title="(x: List[CPSAnnotationChecker.this.global.TypeBounds])List[CPSAnnotationChecker.this.global.TypeBounds]">reverse</a>
            <span class="keyword">case</span> _ =&gt; <a href="#3381593" title="(x: List[CPSAnnotationChecker.this.global.TypeBounds])List[CPSAnnotationChecker.this.global.TypeBounds]">bounds</a>
          <span class="delimiter">}</span>
        <span class="keyword">else</span>
          <a href="#1211639" title="List[CPSAnnotationChecker.this.global.TypeBounds]">bounds</a>
      <span class="delimiter">}</span>
      <span class="keyword">else</span> <span title="List[CPSAnnotationChecker.this.global.TypeBounds]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211640" title="List[CPSAnnotationChecker.this.global.Symbol]">tparams</a>.<a href="../../collection/IterableLike.scala.html#58577" title="=&gt; CPSAnnotationChecker.this.global.Symbol">head</a>.<a href="../../reflect/internal/Symbols.scala.html#411315" title="=&gt; CPSAnnotationChecker.this.global.Symbol">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../reflect/internal/Definitions.scala.html#408804" title="=&gt; CPSAnnotationChecker.this.global.ClassSymbol">ByNameParamClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;byname bound: &quot;)" class="string">&quot;byname bound: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211640" title="List[CPSAnnotationChecker.this.global.Symbol]">tparams</a>.<a href="../../collection/IterableLike.scala.html#58577" title="=&gt; CPSAnnotationChecker.this.global.Symbol">head</a>.<a href="../../reflect/internal/Symbols.scala.html#411315" title="=&gt; CPSAnnotationChecker.this.global.Symbol">owner</a>.<a href="../../reflect/internal/Symbols.scala.html#411365" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span title="(x$1: Any)String">+</span><a href="#1211639" title="List[CPSAnnotationChecker.this.global.TypeBounds]">bounds</a><span title="(x$1: Any)String">+</span><span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span title="(x$1: Any)String">+</span><a href="#1211641" title="List[CPSAnnotationChecker.this.global.Type]">targs</a><span class="delimiter">)</span>
        <span class="keyword">val</span> TypeBounds<a href="#3381600" title="(x: (CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type))(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)" class="delimiter">(</a><a href="../../reflect/internal/Types.scala.html#410582" title="CPSAnnotationChecker.this.global.Type" id="1211704">lo</a>, <a href="../../reflect/internal/Types.scala.html#410584" title="CPSAnnotationChecker.this.global.Type" id="1211705">hi</a><span class="delimiter">)</span> = <a href="#1211639" title="List[CPSAnnotationChecker.this.global.TypeBounds]">bounds</a>.<a href="../../collection/IterableLike.scala.html#58577" title="=&gt; CPSAnnotationChecker.this.global.TypeBounds">head</a>
        <span title="List[CPSAnnotationChecker.this.global.TypeBounds]" class="keyword">if</span> <span class="delimiter">(</span><a href="CPSUtils.scala.html#1211376" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasCpsParamTypes</a><span class="delimiter">(</span><a href="#1211641" title="List[CPSAnnotationChecker.this.global.Type]">targs</a>.<a href="../../collection/IterableLike.scala.html#58577" title="=&gt; CPSAnnotationChecker.this.global.Type">head</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211376" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasCpsParamTypes</a><span class="delimiter">(</span><a href="#1211705" title="CPSAnnotationChecker.this.global.Type">hi</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="../../reflect/internal/Types.scala.html#424774" title="(lo: CPSAnnotationChecker.this.global.Type, hi: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.TypeBounds">TypeBounds</a><span class="delimiter">(</span><a href="#1211704" title="CPSAnnotationChecker.this.global.Type">lo</a>, <a href="#1211705" title="CPSAnnotationChecker.this.global.Type">hi</a> <a href="../../reflect/internal/AnnotationInfos.scala.html#408618" title="(annot: CPSAnnotationChecker.this.global.AnnotationInfo)CPSAnnotationChecker.this.global.Type">withAnnotation</a> <a href="#1211645" title="CPSAnnotationChecker.this.global.AnnotationInfo">anyAtCPS</a><span class="delimiter">)</span> <a href="../../collection/immutable/List.scala.html#62685" title="(x: CPSAnnotationChecker.this.global.TypeBounds)List[CPSAnnotationChecker.this.global.TypeBounds]">::</a> <a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a>
        <span class="keyword">else</span> <a href="#1211639" title="List[CPSAnnotationChecker.this.global.TypeBounds]">bounds</a>
      <span class="delimiter">}</span> <span class="keyword">else</span>
        <a href="#1211639" title="List[CPSAnnotationChecker.this.global.TypeBounds]">bounds</a>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: CPSAnnotationChecker.this.global.Tree, mode: Int, pt: CPSAnnotationChecker.this.global.Type)Boolean" id="1211410">canAdaptAnnotations</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Tree" id="1211725">tree</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="CPSAnnotationChecker.this.global.Tree">Tree</a>, <a title="Int" id="1211726">mode</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="CPSAnnotationChecker.this.global.Type" id="1211727">pt</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211328" title="=&gt; Boolean">cpsEnabled</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <span title="Boolean(false)" class="keyword">false</span>
      <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;can adapt annotations? &quot;)" class="string">&quot;can adapt annotations? &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211725" title="CPSAnnotationChecker.this.global.Tree">tree</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; / &quot;)" class="string">&quot; / &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211725" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; / &quot;)" class="string">&quot; / &quot;</span> <span title="(x$1: Any)String">+</span> <span title="Integer.type">Integer</span>.<span title="(x$1: Int)String">toHexString</span><span class="delimiter">(</span><a href="#1211726" title="Int">mode</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; / &quot;)" class="string">&quot; / &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211727" title="CPSAnnotationChecker.this.global.Type">pt</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1211731">annots1</a> = <a href="CPSUtils.scala.html#1211381" title="(tpe: CPSAnnotationChecker.this.global.Type)List[CPSAnnotationChecker.this.global.AnnotationInfo]">cpsParamAnnotation</a><span class="delimiter">(</span><a href="#1211725" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1211732">annots2</a> = <a href="CPSUtils.scala.html#1211381" title="(tpe: CPSAnnotationChecker.this.global.Type)List[CPSAnnotationChecker.this.global.AnnotationInfo]">cpsParamAnnotation</a><span class="delimiter">(</span><a href="#1211727" title="CPSAnnotationChecker.this.global.Type">pt</a><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#1211726" title="Int">mode</a> <a href="../../Int.scala.html#57144" title="(x: Int)Int">&amp;</a> global.analyzer.<span title="Int(2)">PATTERNmode</span><span class="delimiter">)</span> <a href="../../Int.scala.html#57104" title="(x: Int)Boolean">!=</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        //println(&quot;can adapt pattern annotations? &quot; + tree + &quot; / &quot; + tree.tpe + &quot; / &quot; + Integer.toHexString(mode) + &quot; / &quot; + pt)
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1211731" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots1</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="Nothing" class="keyword">return</span> <span title="Boolean(true)" class="keyword">true</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

/*
      // not precise enough -- still relying on addAnnotations to remove things from ValDef symbols
      if ((mode &amp; global.analyzer.TYPEmode) != 0 &amp;&amp; (mode &amp; global.analyzer.BYVALmode) != 0) {
        if (!annots1.isEmpty) {
          return true
        }
      }
*/

/*
      this interferes with overloading resolution
      if ((mode &amp; global.analyzer.BYVALmode) != 0 &amp;&amp; tree.tpe &lt;:&lt; pt) {
        vprintln(&quot;already compatible, can't adapt further&quot;)
        return false
      }
*/
      <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#1211726" title="Int">mode</a> <a href="../../Int.scala.html#57144" title="(x: Int)Int">&amp;</a> global.analyzer.<span title="Int(1)">EXPRmode</span><span class="delimiter">)</span> <a href="../../Int.scala.html#57104" title="(x: Int)Boolean">!=</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#1211731" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots1</a> <a href="../../collection/LinearSeqLike.scala.html#86319" title="(that: scala.collection.GenSeq[CPSAnnotationChecker.this.global.AnnotationInfo])(p: (CPSAnnotationChecker.this.global.AnnotationInfo, CPSAnnotationChecker.this.global.AnnotationInfo) =&gt; Boolean)Boolean">corresponds</a> <a href="#1211732" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots2</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1211769" title="CPSAnnotationChecker.this.global.AnnotationInfo">_</a>.<a href="../../reflect/internal/AnnotationInfos.scala.html#409727" title="=&gt; CPSAnnotationChecker.this.global.Type">atp</a> <a href="../../reflect/internal/Types.scala.html#408481" title="(that: CPSAnnotationChecker.this.global.Type)Boolean">&lt;:&lt;</a> <a href="#1211770" title="CPSAnnotationChecker.this.global.AnnotationInfo">_</a>.<a href="../../reflect/internal/AnnotationInfos.scala.html#409727" title="=&gt; CPSAnnotationChecker.this.global.Type">atp</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;already same, can\'t adapt further&quot;)" class="string">&quot;already same, can't adapt further&quot;</span><span class="delimiter">)</span>
          <span title="Boolean(false)" class="keyword">false</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211731" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots1</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1211732" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots2</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#1211726" title="Int">mode</a> <a href="../../Int.scala.html#57144" title="(x: Int)Int">&amp;</a> global.analyzer.<span title="Int(32768)">BYVALmode</span><span class="delimiter">)</span> <a href="../../Int.scala.html#57097" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          //println(&quot;can adapt annotations? &quot; + tree + &quot; / &quot; + tree.tpe + &quot; / &quot; + Integer.toHexString(mode) + &quot; / &quot; + pt)
          <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211374" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasPlusMarker</a><span class="delimiter">(</span><a href="#1211725" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  //          val base = tree.tpe &lt;:&lt; removeAllCPSAnnotations(pt)
  //          val known = global.analyzer.isFullyDefined(pt)
  //          println(same + &quot;/&quot; + base + &quot;/&quot; + known)
            //val same = annots2 forall { case AnnotationInfo(atp: TypeRef, _, _) =&gt; atp.typeArgs(0) =:= atp.typeArgs(1) }
            // TBD: use same or not?
            //if (same) {
              <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;yes we can!! (unit)&quot;)" class="string">&quot;yes we can!! (unit)&quot;</span><span class="delimiter">)</span>
              <span title="Boolean(true)" class="keyword">true</span>
            //}
          <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211374" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasPlusMarker</a><span class="delimiter">(</span><a href="#1211725" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1211731" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots1</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1211732" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots2</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#1211726" title="Int">mode</a> <a href="../../Int.scala.html#57144" title="(x: Int)Int">&amp;</a> global.analyzer.<span title="Int(131072)">RETmode</span><span class="delimiter">)</span> <a href="../../Int.scala.html#57104" title="(x: Int)Boolean">!=</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;checking enclosing method\'s result type without annotations&quot;)" class="string">&quot;checking enclosing method's result type without annotations&quot;</span><span class="delimiter">)</span>
          <a href="#1211725" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a> <a href="../../reflect/internal/Types.scala.html#408481" title="(that: CPSAnnotationChecker.this.global.Type)Boolean">&lt;:&lt;</a> <a href="#1211727" title="CPSAnnotationChecker.this.global.Type">pt</a>.<a href="../../reflect/internal/Types.scala.html#408510" title="=&gt; CPSAnnotationChecker.this.global.Type">withoutAnnotations</a>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211373" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasMinusMarker</a><span class="delimiter">(</span><a href="#1211725" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1211731" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots1</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#1211726" title="Int">mode</a> <a href="../../Int.scala.html#57144" title="(x: Int)Int">&amp;</a> global.analyzer.<span title="Int(32768)">BYVALmode</span><span class="delimiter">)</span> <a href="../../Int.scala.html#57104" title="(x: Int)Boolean">!=</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Option[(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)]" id="1211806">optCpsTypes</a>: <a href="../../Option.scala.html#978" title="Option[(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)]">Option</a><span class="delimiter">[</span><span class="delimiter">(</span>Type, Type<span class="delimiter">)</span><span class="delimiter">]</span>         = <a href="CPSUtils.scala.html#1211377" title="(tpe: CPSAnnotationChecker.this.global.Type)Option[(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)]">cpsParamTypes</a><span class="delimiter">(</span><a href="#1211725" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Option[(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)]" id="1211807">optExpectedCpsTypes</a>: <a href="../../Option.scala.html#978" title="Option[(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)]">Option</a><span class="delimiter">[</span><span class="delimiter">(</span>Type, Type<span class="delimiter">)</span><span class="delimiter">]</span> = <a href="CPSUtils.scala.html#1211377" title="(tpe: CPSAnnotationChecker.this.global.Type)Option[(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)]">cpsParamTypes</a><span class="delimiter">(</span><a href="#1211727" title="CPSAnnotationChecker.this.global.Type">pt</a><span class="delimiter">)</span>
          <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211806" title="Option[(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)]">optCpsTypes</a>.<a href="../../Option.scala.html#62856" title="=&gt; Boolean">isEmpty</a> <a href="../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="#1211807" title="Option[(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)]">optExpectedCpsTypes</a>.<a href="../../Option.scala.html#62856" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;yes we can!! (byval)&quot;)" class="string">&quot;yes we can!! (byval)&quot;</span><span class="delimiter">)</span>
            <span title="Boolean(true)" class="keyword">true</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span> // check cps param types
            <span class="keyword">val</span> <a title="(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)" id="1211818">cpsTpes</a> = <a href="#1211806" title="Option[(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)]">optCpsTypes</a>.<a href="../../Option.scala.html#62858" title="=&gt; (CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)">get</a>
            <span class="keyword">val</span> <a title="(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)" id="1211819">cpsPts</a>  = <a href="#1211807" title="Option[(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)]">optExpectedCpsTypes</a>.<a href="../../Option.scala.html#62858" title="=&gt; (CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)">get</a>
            // class cpsParam[-B,+C], therefore:
            <a href="#1211819" title="(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)">cpsPts</a>.<a href="../../Tuple2.scala.html#60635" title="=&gt; CPSAnnotationChecker.this.global.Type">_1</a> <a href="../../reflect/internal/Types.scala.html#408481" title="(that: CPSAnnotationChecker.this.global.Type)Boolean">&lt;:&lt;</a> <a href="#1211818" title="(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)">cpsTpes</a>.<a href="../../Tuple2.scala.html#60635" title="=&gt; CPSAnnotationChecker.this.global.Type">_1</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1211818" title="(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)">cpsTpes</a>.<a href="../../Tuple2.scala.html#60637" title="=&gt; CPSAnnotationChecker.this.global.Type">_2</a> <a href="../../reflect/internal/Types.scala.html#408481" title="(that: CPSAnnotationChecker.this.global.Type)Boolean">&lt;:&lt;</a> <a href="#1211819" title="(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)">cpsPts</a>.<a href="../../Tuple2.scala.html#60637" title="=&gt; CPSAnnotationChecker.this.global.Type">_2</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: CPSAnnotationChecker.this.global.Tree, mode: Int, pt: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Tree" id="1211411">adaptAnnotations</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Tree" id="1211824">tree</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="CPSAnnotationChecker.this.global.Tree">Tree</a>, <a title="Int" id="1211825">mode</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="CPSAnnotationChecker.this.global.Type" id="1211826">pt</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../reflect/internal/Trees.scala.html#407938" title="CPSAnnotationChecker.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211328" title="=&gt; Boolean">cpsEnabled</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a>

      <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;adapt annotations &quot;)" class="string">&quot;adapt annotations &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; / &quot;)" class="string">&quot; / &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; / &quot;)" class="string">&quot; / &quot;</span> <span title="(x$1: Any)String">+</span> <a href="../nsc/typechecker/Modes.scala.html#538084" title="(mode: Int)String">modeString</a><span class="delimiter">(</span><a href="#1211825" title="Int">mode</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; / &quot;)" class="string">&quot; / &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211826" title="CPSAnnotationChecker.this.global.Type">pt</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Boolean" id="1211830">patMode</a>   = <span class="delimiter">(</span><a href="#1211825" title="Int">mode</a> <a href="../../Int.scala.html#57144" title="(x: Int)Int">&amp;</a> global.analyzer.<span title="Int(2)">PATTERNmode</span><span class="delimiter">)</span> <a href="../../Int.scala.html#57104" title="(x: Int)Boolean">!=</a> <span title="Int(0)" class="int">0</span>
      <span class="keyword">val</span> <a title="Boolean" id="1211831">exprMode</a>  = <span class="delimiter">(</span><a href="#1211825" title="Int">mode</a> <a href="../../Int.scala.html#57144" title="(x: Int)Int">&amp;</a> global.analyzer.<span title="Int(1)">EXPRmode</span><span class="delimiter">)</span> <a href="../../Int.scala.html#57104" title="(x: Int)Boolean">!=</a> <span title="Int(0)" class="int">0</span>
      <span class="keyword">val</span> <a title="Boolean" id="1211832">byValMode</a> = <span class="delimiter">(</span><a href="#1211825" title="Int">mode</a> <a href="../../Int.scala.html#57144" title="(x: Int)Int">&amp;</a> global.analyzer.<span title="Int(32768)">BYVALmode</span><span class="delimiter">)</span> <a href="../../Int.scala.html#57104" title="(x: Int)Boolean">!=</a> <span title="Int(0)" class="int">0</span>
      <span class="keyword">val</span> <a title="Boolean" id="1211833">retMode</a>   = <span class="delimiter">(</span><a href="#1211825" title="Int">mode</a> <a href="../../Int.scala.html#57144" title="(x: Int)Int">&amp;</a> global.analyzer.<span title="Int(131072)">RETmode</span><span class="delimiter">)</span> <a href="../../Int.scala.html#57104" title="(x: Int)Boolean">!=</a> <span title="Int(0)" class="int">0</span>

      <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1211834">annotsTree</a>     = <a href="CPSUtils.scala.html#1211381" title="(tpe: CPSAnnotationChecker.this.global.Type)List[CPSAnnotationChecker.this.global.AnnotationInfo]">cpsParamAnnotation</a><span class="delimiter">(</span><a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1211835">annotsExpected</a> = <a href="CPSUtils.scala.html#1211381" title="(tpe: CPSAnnotationChecker.this.global.Type)List[CPSAnnotationChecker.this.global.AnnotationInfo]">cpsParamAnnotation</a><span class="delimiter">(</span><a href="#1211826" title="CPSAnnotationChecker.this.global.Type">pt</a><span class="delimiter">)</span>

      // not sure I rephrased this comment correctly:
      // replacing `patMode` in the condition below by `patMode || ((mode &amp; global.analyzer.TYPEmode) != 0 &amp;&amp; (mode &amp; global.analyzer.BYVALmode))`
      // doesn't work correctly -- still relying on addAnnotations to remove things from ValDef symbols
      <span title="CPSAnnotationChecker.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211830" title="Boolean">patMode</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1211834" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annotsTree</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a> <a href="../../reflect/internal/Trees.scala.html#408561" title="(f: CPSAnnotationChecker.this.global.Type =&gt; CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Tree">modifyType</a> <a href="CPSUtils.scala.html#1211380" title="(tpe: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">removeAllCPSAnnotations</a>
      <span class="keyword">else</span> <span title="CPSAnnotationChecker.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211831" title="Boolean">exprMode</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1211832" title="Boolean">byValMode</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211374" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasPlusMarker</a><span class="delimiter">(</span><a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1211834" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annotsTree</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1211835" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annotsExpected</a>.<a href="../../collection/TraversableOnce.scala.html#58191" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span> // shiftUnit
        // add a marker annotation that will make tree.tpe behave as pt, subtyping wise
        // tree will look like having any possible annotation
        //println(&quot;adapt annotations &quot; + tree + &quot; / &quot; + tree.tpe + &quot; / &quot; + Integer.toHexString(mode) + &quot; / &quot; + pt)

        // CAVEAT:
        //  for monomorphic answer types we want to have @plus @cps (for better checking)
        //  for answer type modification we want to have only @plus (because actual answer type may differ from pt)

        <span class="keyword">val</span> <a title="CPSAnnotationChecker.this.global.Tree" id="1211884">res</a> = <a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a> <a href="../../reflect/internal/Trees.scala.html#408561" title="(f: CPSAnnotationChecker.this.global.Type =&gt; CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Tree">modifyType</a> <span class="delimiter">(</span><a href="#1211886" title="CPSAnnotationChecker.this.global.Type">_</a> <a href="../../reflect/internal/Types.scala.html#408513" title="(annots: List[CPSAnnotationChecker.this.global.AnnotationInfo])CPSAnnotationChecker.this.global.Type">withAnnotations</a> <a href="CPSUtils.scala.html#1211367" title="()CPSAnnotationChecker.this.global.AnnotationInfo">newPlusMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> <a href="../../collection/immutable/List.scala.html#62685" title="(x: CPSAnnotationChecker.this.global.AnnotationInfo)List[CPSAnnotationChecker.this.global.AnnotationInfo]">::</a> <a href="#1211835" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annotsExpected</a><span class="delimiter">)</span> // needed for #1807
        <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;adapted annotations (not by val) of &quot;)" class="string">&quot;adapted annotations (not by val) of &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; to &quot;)" class="string">&quot; to &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211884" title="CPSAnnotationChecker.this.global.Tree">res</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>
        <a href="#1211884" title="CPSAnnotationChecker.this.global.Tree">res</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="CPSAnnotationChecker.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211831" title="Boolean">exprMode</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1211832" title="Boolean">byValMode</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211373" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasMinusMarker</a><span class="delimiter">(</span><a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1211834" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annotsTree</a>.<a href="../../collection/TraversableOnce.scala.html#58191" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span> // dropping annotation
        // add a marker annotation that will make tree.tpe behave as pt, subtyping wise
        // tree will look like having no annotation
        <span class="keyword">val</span> <a title="CPSAnnotationChecker.this.global.Tree" id="1211895">res</a> = <a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a> <a href="../../reflect/internal/Trees.scala.html#408561" title="(f: CPSAnnotationChecker.this.global.Type =&gt; CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Tree">modifyType</a> <a href="#1211404" title="(tp: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">addMinusMarker</a>
        <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;adapted annotations (by val) of &quot;)" class="string">&quot;adapted annotations (by val) of &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; to &quot;)" class="string">&quot; to &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211895" title="CPSAnnotationChecker.this.global.Tree">res</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>
        <a href="#1211895" title="CPSAnnotationChecker.this.global.Tree">res</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="CPSAnnotationChecker.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211833" title="Boolean">retMode</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211374" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasPlusMarker</a><span class="delimiter">(</span><a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1211834" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annotsTree</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1211835" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annotsExpected</a>.<a href="../../collection/TraversableOnce.scala.html#58191" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        // add a marker annotation that will make tree.tpe behave as pt, subtyping wise
        // tree will look like having any possible annotation
        
        // note 1: we are only adding a plus marker if the method's result type is a cps type
        //         (annotsExpected.nonEmpty == cpsParamAnnotation(pt).nonEmpty)
        // note 2: we are not adding the expected cps annotations, since they will be added
        //         by adaptTypeOfReturn (see below).
        <span class="keyword">val</span> <a title="CPSAnnotationChecker.this.global.Tree" id="1211898">res</a> = <a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a> <a href="../../reflect/internal/Trees.scala.html#408561" title="(f: CPSAnnotationChecker.this.global.Type =&gt; CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Tree">modifyType</a> <span class="delimiter">(</span><a href="#1211900" title="CPSAnnotationChecker.this.global.Type">_</a> <a href="../../reflect/internal/Types.scala.html#408513" title="(annots: List[CPSAnnotationChecker.this.global.AnnotationInfo])CPSAnnotationChecker.this.global.Type">withAnnotations</a> <a href="../../collection/immutable/List.scala.html#62451" title="(xs: CPSAnnotationChecker.this.global.AnnotationInfo*)List[CPSAnnotationChecker.this.global.AnnotationInfo]">List</a><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211367" title="()CPSAnnotationChecker.this.global.AnnotationInfo">newPlusMarker</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;adapted annotations (return) of &quot;)" class="string">&quot;adapted annotations (return) of &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; to &quot;)" class="string">&quot; to &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1211898" title="CPSAnnotationChecker.this.global.Tree">res</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>
        <a href="#1211898" title="CPSAnnotationChecker.this.global.Tree">res</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#1211824" title="CPSAnnotationChecker.this.global.Tree">tree</a>
    <span class="delimiter">}</span>

    /** Returns an adapted type for a return expression if the method's result type (pt) is a CPS type.
     *  Otherwise, it returns the `default` type (`typedReturn` passes `NothingClass.tpe`).
     *  
     *  A return expression in a method that has a CPS result type is an error unless the return
     *  is in tail position. Therefore, we are making sure that only the types of return expressions
     *  are adapted which will either be removed, or lead to an error.
     */
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: CPSAnnotationChecker.this.global.Tree, pt: CPSAnnotationChecker.this.global.Type, default: =&gt; CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type" id="1211412">adaptTypeOfReturn</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Tree" id="1211910">tree</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="CPSAnnotationChecker.this.global.Tree">Tree</a>, <a title="CPSAnnotationChecker.this.global.Type" id="1211911">pt</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a>, <a title="=&gt; CPSAnnotationChecker.this.global.Type" id="1211912">default</a>: =&gt; Type<span class="delimiter">)</span>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a> = <span class="delimiter">{</span>
      // only adapt if method's result type (pt) is cps type
      <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1211916">annots</a> = <a href="CPSUtils.scala.html#1211381" title="(tpe: CPSAnnotationChecker.this.global.Type)List[CPSAnnotationChecker.this.global.AnnotationInfo]">cpsParamAnnotation</a><span class="delimiter">(</span><a href="#1211911" title="CPSAnnotationChecker.this.global.Type">pt</a><span class="delimiter">)</span>
      <span title="CPSAnnotationChecker.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211916" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots</a>.<a href="../../collection/TraversableOnce.scala.html#58191" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        // return type of `tree` without plus marker, but only if it doesn't have other cps annots
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="CPSUtils.scala.html#1211374" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasPlusMarker</a><span class="delimiter">(</span><a href="#1211910" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211376" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasCpsParamTypes</a><span class="delimiter">(</span><a href="#1211910" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#1211910" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408575" title="(tp: CPSAnnotationChecker.this.global.Type)tree.type">setType</a><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211379" title="(tpe: CPSAnnotationChecker.this.global.Type, classes: CPSAnnotationChecker.this.global.Symbol*)CPSAnnotationChecker.this.global.Type">removeAttribs</a><span class="delimiter">(</span><a href="#1211910" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a>, <a href="CPSUtils.scala.html#1211342" title="=&gt; CPSAnnotationChecker.this.global.ClassSymbol">MarkerCPSAdaptPlus</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#1211910" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#1211912" title="=&gt; CPSAnnotationChecker.this.global.Type">default</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(tpe: CPSAnnotationChecker.this.global.Type, childAnnots: List[CPSAnnotationChecker.this.global.AnnotationInfo], byName: List[CPSAnnotationChecker.this.global.Tree])CPSAnnotationChecker.this.global.Type" id="1211413">updateAttributesFromChildren</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Type" id="1211926">tpe</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a>, <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1211927">childAnnots</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">List</a><span class="delimiter">[</span>AnnotationInfo<span class="delimiter">]</span>, <a title="List[CPSAnnotationChecker.this.global.Tree]" id="1211928">byName</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a> = <span class="delimiter">{</span>
      <a href="#1211926" title="CPSAnnotationChecker.this.global.Type">tpe</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        // Would need to push annots into each alternative of overloaded type
        // But we can't, since alternatives aren't types but symbols, which we
        // can't change (we'd be affecting symbols globally)
        /*
        case OverloadedType(pre, alts) =&gt;
          OverloadedType(pre, alts.map((sym: Symbol) =&gt; updateAttributes(pre.memberType(sym), annots)))
        */
        <span class="keyword">case</span> OverloadedType<a href="#3381604" title="CPSAnnotationChecker.this.global.Type" id="3381606" class="delimiter">(</a><a href="../../reflect/internal/Types.scala.html#450705" title="CPSAnnotationChecker.this.global.Type" id="1211931">pre</a>, <a href="../../reflect/internal/Types.scala.html#450707" title="List[CPSAnnotationChecker.this.global.Symbol]" id="1211932">alts</a><span class="delimiter">)</span> =&gt; <a href="#3381612" title="(x: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">tpe</a>   //reconstruct correct annotations later
        <span class="keyword">case</span> MethodType<a href="#3381604" title="CPSAnnotationChecker.this.global.Type" id="3381608" class="delimiter">(</a><a href="../../reflect/internal/Types.scala.html#410769" title="List[CPSAnnotationChecker.this.global.Symbol]" id="1211935">params</a>, <a href="../../reflect/internal/Types.scala.html#410771" title="CPSAnnotationChecker.this.global.Type" id="1211936">restpe</a><span class="delimiter">)</span> =&gt; <a href="#3381612" title="(x: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">tpe</a>
        <span class="keyword">case</span> PolyType<a href="#3381604" title="CPSAnnotationChecker.this.global.Type" id="3381610" class="delimiter">(</a><a href="../../reflect/internal/Types.scala.html#410715" title="List[CPSAnnotationChecker.this.global.Symbol]" id="1211939">params</a>, <a href="../../reflect/internal/Types.scala.html#410717" title="CPSAnnotationChecker.this.global.Type" id="1211940">restpe</a><span class="delimiter">)</span> =&gt; <a href="#3381612" title="(x: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">tpe</a>
        <span class="keyword">case</span> _ =&gt;
          <a href="../nsc/Global.scala.html#537497" title="(assertion: Boolean, message: =&gt; Any)Unit">assert</a><span class="delimiter">(</span><a href="#1211927" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">childAnnots</a> <a href="../../collection/LinearSeqOptimized.scala.html#86378" title="(p: CPSAnnotationChecker.this.global.AnnotationInfo =&gt; Boolean)Boolean">forall</a> <span class="delimiter">(</span><a href="#1211952" title="CPSAnnotationChecker.this.global.AnnotationInfo">_</a> <a href="../../reflect/internal/AnnotationInfos.scala.html#409745" title="(clazz: CPSAnnotationChecker.this.global.Symbol)Boolean">matches</a> <a href="CPSUtils.scala.html#1211338" title="=&gt; CPSAnnotationChecker.this.global.ClassSymbol">MarkerCPSTypes</a><span class="delimiter">)</span>, <a href="#1211927" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">childAnnots</a><span class="delimiter">)</span>
          /*
            [] + [] = []
            plus + [] = plus
            cps + [] = cps
            plus cps + [] = plus cps
            minus cps + [] = minus cps
            synth cps + [] = synth cps // &lt;- synth on left - does it happen?

            [] + cps = cps
            plus + cps = synth cps
            cps + cps = cps! &lt;- lin
            plus cps + cps = synth cps! &lt;- unify
            minus cps + cps = minus cps! &lt;- lin
            synth cps + cps = synth cps! &lt;- unify
          */

          <span class="keyword">val</span> <a title="Boolean" id="1211941">plus</a> = <a href="CPSUtils.scala.html#1211374" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasPlusMarker</a><span class="delimiter">(</span><a href="#1211926" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span>
               <a href="CPSUtils.scala.html#1211376" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasCpsParamTypes</a><span class="delimiter">(</span><a href="#1211926" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>
            <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1211928" title="List[CPSAnnotationChecker.this.global.Tree]">byName</a>.<a href="../../collection/TraversableOnce.scala.html#58191" title="=&gt; Boolean">nonEmpty</a>
            <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#1211928" title="List[CPSAnnotationChecker.this.global.Tree]">byName</a> <a href="../../collection/LinearSeqOptimized.scala.html#86378" title="(p: CPSAnnotationChecker.this.global.Tree =&gt; Boolean)Boolean">forall</a> <span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Tree" id="1211960">t</a> =&gt; <a href="CPSUtils.scala.html#1211374" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasPlusMarker</a><span class="delimiter">(</span><a href="#1211960" title="CPSAnnotationChecker.this.global.Tree">t</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">)</span>

          // move @plus annotations outward from by-name children
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211927" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">childAnnots</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <span class="delimiter">{</span>
            <span title="CPSAnnotationChecker.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211941" title="Boolean">plus</a><span class="delimiter">)</span> <span class="delimiter">{</span> // @plus or @plus @cps
              <a href="#1211928" title="List[CPSAnnotationChecker.this.global.Tree]">byName</a> <a href="../../collection/immutable/List.scala.html#62719" title="(f: CPSAnnotationChecker.this.global.Tree =&gt; CPSAnnotationChecker.this.global.Tree)Unit">foreach</a> <span class="delimiter">(</span><a href="#1211981" title="CPSAnnotationChecker.this.global.Tree">_</a> <a href="../../reflect/internal/Trees.scala.html#408561" title="(f: CPSAnnotationChecker.this.global.Type =&gt; CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Tree">modifyType</a> <a href="#1211405" title="(tp: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">cleanPlus</a><span class="delimiter">)</span>
              <a href="#1211403" title="(tp: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">addPlusMarker</a><span class="delimiter">(</span><a href="#1211926" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <span class="keyword">else</span> <a href="#1211926" title="CPSAnnotationChecker.this.global.Type">tpe</a>
          <span class="delimiter">}</span>

          <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1211942">annots1</a> = <a href="CPSUtils.scala.html#1211381" title="(tpe: CPSAnnotationChecker.this.global.Type)List[CPSAnnotationChecker.this.global.AnnotationInfo]">cpsParamAnnotation</a><span class="delimiter">(</span><a href="#1211926" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>

          <span title="CPSAnnotationChecker.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211942" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots1</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span> // nothing or @plus
            <a href="#1211406" title="(tp: CPSAnnotationChecker.this.global.Type)(newAnnots: CPSAnnotationChecker.this.global.AnnotationInfo*)CPSAnnotationChecker.this.global.Type">cleanPlusWith</a><span class="delimiter">(</span><a href="#1211926" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211366" title="()CPSAnnotationChecker.this.global.AnnotationInfo">newSynthMarker</a><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="CPSUtils.scala.html#1211382" title="(ann: List[CPSAnnotationChecker.this.global.AnnotationInfo])CPSAnnotationChecker.this.global.AnnotationInfo">linearize</a><span class="delimiter">(</span><a href="#1211927" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">childAnnots</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="CPSAnnotationChecker.this.global.AnnotationInfo" id="1212006">annot1</a> = <a href="#1211416" title="(xs: List[CPSAnnotationChecker.this.global.AnnotationInfo])CPSAnnotationChecker.this.global.AnnotationInfo">single</a><span class="delimiter">(</span><a href="#1211942" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots1</a><span class="delimiter">)</span>
            <span title="CPSAnnotationChecker.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1211941" title="Boolean">plus</a><span class="delimiter">)</span> <span class="delimiter">{</span> // @plus @cps
              <span class="keyword">val</span> <a title="CPSAnnotationChecker.this.global.AnnotationInfo" id="1212028">annot2</a> = <a href="CPSUtils.scala.html#1211382" title="(ann: List[CPSAnnotationChecker.this.global.AnnotationInfo])CPSAnnotationChecker.this.global.AnnotationInfo">linearize</a><span class="delimiter">(</span><a href="#1211927" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">childAnnots</a><span class="delimiter">)</span>

              <span title="CPSAnnotationChecker.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1212028" title="CPSAnnotationChecker.this.global.AnnotationInfo">annot2</a>.<a href="../../reflect/internal/AnnotationInfos.scala.html#409727" title="=&gt; CPSAnnotationChecker.this.global.Type">atp</a> <a href="../../reflect/internal/Types.scala.html#408481" title="(that: CPSAnnotationChecker.this.global.Type)Boolean">&lt;:&lt;</a> <a href="#1212006" title="CPSAnnotationChecker.this.global.AnnotationInfo">annot1</a>.<a href="../../reflect/internal/AnnotationInfos.scala.html#409727" title="=&gt; CPSAnnotationChecker.this.global.Type">atp</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">try</span> <a href="#1211406" title="(tp: CPSAnnotationChecker.this.global.Type)(newAnnots: CPSAnnotationChecker.this.global.AnnotationInfo*)CPSAnnotationChecker.this.global.Type">cleanPlusWith</a><span class="delimiter">(</span><a href="#1211926" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211366" title="()CPSAnnotationChecker.this.global.AnnotationInfo">newSynthMarker</a><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#1212028" title="CPSAnnotationChecker.this.global.AnnotationInfo">annot2</a><span class="delimiter">)</span>
                <span class="keyword">finally</span> <a href="#1211928" title="List[CPSAnnotationChecker.this.global.Tree]">byName</a> <a href="../../collection/immutable/List.scala.html#62719" title="(f: CPSAnnotationChecker.this.global.Tree =&gt; CPSAnnotationChecker.this.global.Tree)Unit">foreach</a> <span class="delimiter">(</span><a href="#1212048" title="CPSAnnotationChecker.this.global.Tree">_</a> <a href="../../reflect/internal/Trees.scala.html#408561" title="(f: CPSAnnotationChecker.this.global.Type =&gt; CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Tree">modifyType</a> <a href="#1211405" title="(tp: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">cleanPlus</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
              <span class="keyword">else</span> <span title="Nothing" class="keyword">throw</span> <a href="../../reflect/internal/Types.scala.html#416076" title="(msg: String)CPSAnnotationChecker.this.global.TypeError" class="keyword">new</a> <a href="../../reflect/internal/Types.scala.html#407625" title="CPSAnnotationChecker.this.global.TypeError">TypeError</a><span class="delimiter">(</span><a href="../../Predef.scala.html#7605" title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd">annot2</a> <a href="../../runtime/StringAdd.scala.html#60046" title="(other: String)String">+</a> <span title="String(&quot; is not a subtype of &quot;)" class="string">&quot; is not a subtype of &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212006" title="CPSAnnotationChecker.this.global.AnnotationInfo">annot1</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <span class="keyword">else</span> <span title="CPSAnnotationChecker.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="CPSUtils.scala.html#1211375" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasSynthMarker</a><span class="delimiter">(</span><a href="#1211926" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> // @synth @cps
              <span class="keyword">val</span> <a title="CPSAnnotationChecker.this.global.AnnotationInfo" id="1212062">annot2</a> = <a href="CPSUtils.scala.html#1211382" title="(ann: List[CPSAnnotationChecker.this.global.AnnotationInfo])CPSAnnotationChecker.this.global.AnnotationInfo">linearize</a><span class="delimiter">(</span><a href="#1211927" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">childAnnots</a><span class="delimiter">)</span>
              <span title="CPSAnnotationChecker.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1212062" title="CPSAnnotationChecker.this.global.AnnotationInfo">annot2</a>.<a href="../../reflect/internal/AnnotationInfos.scala.html#409727" title="=&gt; CPSAnnotationChecker.this.global.Type">atp</a> <a href="../../reflect/internal/Types.scala.html#408481" title="(that: CPSAnnotationChecker.this.global.Type)Boolean">&lt;:&lt;</a> <a href="#1212006" title="CPSAnnotationChecker.this.global.AnnotationInfo">annot1</a>.<a href="../../reflect/internal/AnnotationInfos.scala.html#409727" title="=&gt; CPSAnnotationChecker.this.global.Type">atp</a><span class="delimiter">)</span>
                <a href="#1211406" title="(tp: CPSAnnotationChecker.this.global.Type)(newAnnots: CPSAnnotationChecker.this.global.AnnotationInfo*)CPSAnnotationChecker.this.global.Type">cleanPlusWith</a><span class="delimiter">(</span><a href="#1211926" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1212062" title="CPSAnnotationChecker.this.global.AnnotationInfo">annot2</a><span class="delimiter">)</span>
              <span class="keyword">else</span>
                <span title="Nothing" class="keyword">throw</span> <a href="../../reflect/internal/Types.scala.html#416076" title="(msg: String)CPSAnnotationChecker.this.global.TypeError" class="keyword">new</a> <a href="../../reflect/internal/Types.scala.html#407625" title="CPSAnnotationChecker.this.global.TypeError">TypeError</a><span class="delimiter">(</span><a href="../../Predef.scala.html#7605" title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd">annot2</a> <a href="../../runtime/StringAdd.scala.html#60046" title="(other: String)String">+</a> <span title="String(&quot; is not a subtype of &quot;)" class="string">&quot; is not a subtype of &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212006" title="CPSAnnotationChecker.this.global.AnnotationInfo">annot1</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <span class="keyword">else</span> // @cps
              <a href="#1211406" title="(tp: CPSAnnotationChecker.this.global.Type)(newAnnots: CPSAnnotationChecker.this.global.AnnotationInfo*)CPSAnnotationChecker.this.global.Type">cleanPlusWith</a><span class="delimiter">(</span><a href="#1211926" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211382" title="(ann: List[CPSAnnotationChecker.this.global.AnnotationInfo])CPSAnnotationChecker.this.global.AnnotationInfo">linearize</a><span class="delimiter">(</span><a href="#1211927" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">childAnnots</a><a href="../../collection/immutable/List.scala.html#62688" title="(prefix: List[CPSAnnotationChecker.this.global.AnnotationInfo])List[CPSAnnotationChecker.this.global.AnnotationInfo]">:::</a><a href="#1211942" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots1</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(fun: CPSAnnotationChecker.this.global.Tree, args: List[CPSAnnotationChecker.this.global.Tree])List[List[CPSAnnotationChecker.this.global.Tree]]" id="1211414">transArgList</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Tree" id="1212085">fun</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="CPSAnnotationChecker.this.global.Tree">Tree</a>, <a title="List[CPSAnnotationChecker.this.global.Tree]" id="1212086">args</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../collection/immutable/List.scala.html#11952" title="List[List[CPSAnnotationChecker.this.global.Tree]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.Type]" id="1212087">formals</a> = <a href="#1212085" title="CPSAnnotationChecker.this.global.Tree">fun</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a>.<a href="../../reflect/internal/Types.scala.html#408431" title="=&gt; List[CPSAnnotationChecker.this.global.Type]">paramTypes</a>
      <span class="keyword">val</span> <a title="Int" id="1212088">overshoot</a> = <a href="#1212086" title="List[CPSAnnotationChecker.this.global.Tree]">args</a>.<a href="../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a> <a href="../../Int.scala.html#57161" title="(x: Int)Int">-</a> <a href="#1212087" title="List[CPSAnnotationChecker.this.global.Type]">formals</a>.<a href="../../collection/LinearSeqOptimized.scala.html#86373" title="=&gt; Int">length</a>

      <span class="keyword">for</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="../../Tuple2.scala.html#60635" title="CPSAnnotationChecker.this.global.Tree" id="1212190">a</a>,<a href="../../Tuple2.scala.html#60637" title="CPSAnnotationChecker.this.global.Type" id="1212191">tp</a><span class="delimiter">)</span> &lt;- <a href="#1212086" title="List[CPSAnnotationChecker.this.global.Tree]">args</a>.<a href="../../collection/IterableLike.scala.html#58590" title="(that: scala.collection.GenIterable[CPSAnnotationChecker.this.global.Type])(implicit bf: scala.collection.generic.CanBuildFrom[List[CPSAnnotationChecker.this.global.Tree],(CPSAnnotationChecker.this.global.Tree, CPSAnnotationChecker.this.global.Type),List[(CPSAnnotationChecker.this.global.Tree, CPSAnnotationChecker.this.global.Type)]])List[(CPSAnnotationChecker.this.global.Tree, CPSAnnotationChecker.this.global.Type)]">zip</a><a href="../../collection/TraversableLike.scala.html#58063" title="(f: ((CPSAnnotationChecker.this.global.Tree, CPSAnnotationChecker.this.global.Type)) =&gt; List[CPSAnnotationChecker.this.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[(CPSAnnotationChecker.this.global.Tree, CPSAnnotationChecker.this.global.Type)],List[CPSAnnotationChecker.this.global.Tree],List[List[CPSAnnotationChecker.this.global.Tree]]])List[List[CPSAnnotationChecker.this.global.Tree]]" class="delimiter">(</a><a href="#1212087" title="List[CPSAnnotationChecker.this.global.Type]">formals</a> <a href="../../collection/immutable/List.scala.html#62688" title="(prefix: List[CPSAnnotationChecker.this.global.Type])List[CPSAnnotationChecker.this.global.Type]">:::</a> <a href="../../collection/immutable/List.scala.html#11953" title="scala.collection.immutable.List.type">List</a>.<a href="../../collection/generic/GenTraversableFactory.scala.html#59945" title="(n: Int)(elem: =&gt; CPSAnnotationChecker.this.global.NoType.type)List[CPSAnnotationChecker.this.global.NoType.type]">fill</a><span class="delimiter">(</span><a href="#1212088" title="Int">overshoot</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../reflect/internal/Types.scala.html#407284" title="CPSAnnotationChecker.this.global.NoType.type">NoType</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">yield</span> <span class="delimiter">{</span>
        <a href="#3381655" title="(x: List[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">tp</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> TypeRef<a href="#3381619" title="List[CPSAnnotationChecker.this.global.Tree]" id="3381624" class="delimiter">(</a><a href="../../reflect/internal/Types.scala.html#410887" title="CPSAnnotationChecker.this.global.Type" id="3381620">_</a>, <a href="../../reflect/internal/Types.scala.html#410889" title="CPSAnnotationChecker.this.global.Symbol" id="3381630">ByNameParamClass</a>, <a href="../../collection/generic/SeqFactory.scala.html#59986" title="Option[List[CPSAnnotationChecker.this.global.Type]]" id="3381637">List</a><a href="../../reflect/internal/Types.scala.html#410891" title="List[CPSAnnotationChecker.this.global.Type]" id="3381622" class="delimiter">(</a><a title="CPSAnnotationChecker.this.global.Type" id="1212203">elemtp</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
            <a href="#3381633" title="(x: List[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">Nil</a> // TODO: check conformance??
          <span class="keyword">case</span> _ =&gt;
            <a href="../../collection/immutable/List.scala.html#62451" title="(xs: CPSAnnotationChecker.this.global.Tree*)List[CPSAnnotationChecker.this.global.Tree]">List</a><a href="#3381633" title="(x: List[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]" class="delimiter">(</a><a href="#1212190" title="CPSAnnotationChecker.this.global.Tree">a</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>


    <span class="keyword">def</span> <a title="(stms: List[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]" id="1211415">transStms</a><span class="delimiter">(</span><a title="List[CPSAnnotationChecker.this.global.Tree]" id="1212243">stms</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = <a href="#1212243" title="List[CPSAnnotationChecker.this.global.Tree]">stms</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> ValDef<a href="../../collection/immutable/List.scala.html#206583" title="CPSAnnotationChecker.this.global.Tree" id="3381663" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410298" title="CPSAnnotationChecker.this.global.Modifiers" id="1212258">mods</a>, <a href="../../reflect/internal/Trees.scala.html#410300" title="CPSAnnotationChecker.this.global.TermName" id="1212259">name</a>, <a href="../../reflect/internal/Trees.scala.html#410302" title="CPSAnnotationChecker.this.global.Tree" id="1212260">tpt</a>, <a href="../../reflect/internal/Trees.scala.html#410304" title="CPSAnnotationChecker.this.global.Tree" id="1212261">rhs</a><span class="delimiter">)</span><a href="#3381659" title="Boolean" id="3381661">::</a><a href="../../collection/immutable/List.scala.html#206584" title="List[CPSAnnotationChecker.this.global.Tree]" id="1212262">xs</a> =&gt;
        <a href="#1212261" title="CPSAnnotationChecker.this.global.Tree">rhs</a><a href="#3381673" title="(x: List[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">::</a><a href="#1211415" title="(stms: List[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">transStms</a><span class="delimiter">(</span><a href="#1212262" title="List[CPSAnnotationChecker.this.global.Tree]">xs</a><span class="delimiter">)</span>
      <span class="keyword">case</span> Assign<a href="../../collection/immutable/List.scala.html#206583" title="CPSAnnotationChecker.this.global.Tree" id="3381667" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410127" title="CPSAnnotationChecker.this.global.Tree" id="1212273">lhs</a>, <a href="../../reflect/internal/Trees.scala.html#410129" title="CPSAnnotationChecker.this.global.Tree" id="1212274">rhs</a><span class="delimiter">)</span>::<a href="../../collection/immutable/List.scala.html#206584" title="List[CPSAnnotationChecker.this.global.Tree]" id="1212275">xs</a> =&gt;
        <a href="#1212274" title="CPSAnnotationChecker.this.global.Tree">rhs</a><a href="#3381673" title="(x: List[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">::</a><a href="#1211415" title="(stms: List[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">transStms</a><span class="delimiter">(</span><a href="#1212275" title="List[CPSAnnotationChecker.this.global.Tree]">xs</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../../collection/immutable/List.scala.html#206583" title="CPSAnnotationChecker.this.global.Tree" id="1212282">x</a>::<a href="../../collection/immutable/List.scala.html#206584" title="List[CPSAnnotationChecker.this.global.Tree]" id="1212283">xs</a> =&gt;
        <a href="#1212282" title="CPSAnnotationChecker.this.global.Tree">x</a><a href="#3381673" title="(x: List[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">::</a><a href="#1211415" title="(stms: List[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">transStms</a><span class="delimiter">(</span><a href="#1212283" title="List[CPSAnnotationChecker.this.global.Tree]">xs</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../../collection/immutable/List.scala.html#11188" title="List[CPSAnnotationChecker.this.global.Tree]" id="3381670">Nil</a> =&gt;
        <a href="#3381673" title="(x: List[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">Nil</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(xs: List[CPSAnnotationChecker.this.global.AnnotationInfo])CPSAnnotationChecker.this.global.AnnotationInfo" id="1211416">single</a><span class="delimiter">(</span><a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1212007">xs</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">List</a><span class="delimiter">[</span>AnnotationInfo<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#1212007" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">xs</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="../../collection/generic/SeqFactory.scala.html#59986" title="Option[List[CPSAnnotationChecker.this.global.AnnotationInfo]]" id="3381692">List</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.AnnotationInfo" id="1212020">x</a><span class="delimiter">)</span> =&gt; <a href="#3381688" title="(x: CPSAnnotationChecker.this.global.AnnotationInfo)CPSAnnotationChecker.this.global.AnnotationInfo">x</a>
      <span class="keyword">case</span> _ =&gt;
        <a href="#1211390" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../nsc/Global.scala.html#537495" title="(msg: String)Unit">globalError</a><span class="delimiter">(</span><span title="String(&quot;not a single cps annotation: &quot;)" class="string">&quot;not a single cps annotation: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212007" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">xs</a><span class="delimiter">)</span>
        <a href="../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)CPSAnnotationChecker.this.global.AnnotationInfo">xs</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(xs: List[CPSAnnotationChecker.this.global.AnnotationInfo])List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1211417">emptyOrSingleList</a><span class="delimiter">(</span><a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1212288">xs</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">List</a><span class="delimiter">[</span>AnnotationInfo<span class="delimiter">]</span><span class="delimiter">)</span> = <span title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1212288" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">xs</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a> <span class="keyword">else</span> <a href="../../collection/immutable/List.scala.html#62451" title="(xs: CPSAnnotationChecker.this.global.AnnotationInfo*)List[CPSAnnotationChecker.this.global.AnnotationInfo]">List</a><span class="delimiter">(</span><a href="#1211416" title="(xs: List[CPSAnnotationChecker.this.global.AnnotationInfo])CPSAnnotationChecker.this.global.AnnotationInfo">single</a><span class="delimiter">(</span><a href="#1212288" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">xs</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(tree: CPSAnnotationChecker.this.global.Tree, tpe: CPSAnnotationChecker.this.global.Type, childTrees: List[CPSAnnotationChecker.this.global.Tree], byName: List[CPSAnnotationChecker.this.global.Tree])CPSAnnotationChecker.this.global.Type" id="1211418">transChildrenInOrder</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Tree" id="1212296">tree</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="CPSAnnotationChecker.this.global.Tree">Tree</a>, <a title="CPSAnnotationChecker.this.global.Type" id="1212297">tpe</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a>, <a title="List[CPSAnnotationChecker.this.global.Tree]" id="1212298">childTrees</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span>, <a title="List[CPSAnnotationChecker.this.global.Tree]" id="1212299">byName</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(t: CPSAnnotationChecker.this.global.Tree)List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1212300">inspect</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Tree" id="1212303">t</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="CPSAnnotationChecker.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">List</a><span class="delimiter">[</span>AnnotationInfo<span class="delimiter">]</span> = <span class="delimiter">{</span>
        <span title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1212303" title="CPSAnnotationChecker.this.global.Tree">t</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1212304">extra</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">List</a><span class="delimiter">[</span>AnnotationInfo<span class="delimiter">]</span> = <a href="#1212303" title="CPSAnnotationChecker.this.global.Tree">t</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> _: MethodType | _: PolyType | _: OverloadedType =&gt;
              // method types, poly types and overloaded types do not obtain cps annotions by propagation
              // need to reconstruct transitively from their children.
              <a href="#3381728" title="(x: List[CPSAnnotationChecker.this.global.AnnotationInfo])List[CPSAnnotationChecker.this.global.AnnotationInfo]">t</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> Select<a href="#3381705" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="3381707" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#409999" title="CPSAnnotationChecker.this.global.Tree" id="1212318">qual</a>, <a href="../../reflect/internal/Trees.scala.html#410001" title="CPSAnnotationChecker.this.global.Name" id="1212319">name</a><span class="delimiter">)</span> =&gt; <a href="#1212300" title="(t: CPSAnnotationChecker.this.global.Tree)List[CPSAnnotationChecker.this.global.AnnotationInfo]">inspect</a><a href="#3381713" title="(x: List[CPSAnnotationChecker.this.global.AnnotationInfo])List[CPSAnnotationChecker.this.global.AnnotationInfo]" class="delimiter">(</a><a href="#1212318" title="CPSAnnotationChecker.this.global.Tree">qual</a><span class="delimiter">)</span>
                <span class="keyword">case</span> Apply<a href="#3381705" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="3381709" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410031" title="CPSAnnotationChecker.this.global.Tree" id="1212328">fun</a>, <a href="../../reflect/internal/Trees.scala.html#410033" title="List[CPSAnnotationChecker.this.global.Tree]" id="1212329">args</a><span class="delimiter">)</span> =&gt; <span class="delimiter">(</span><a href="#1212328" title="CPSAnnotationChecker.this.global.Tree">fun</a><a href="../../collection/immutable/List.scala.html#62685" title="(x: CPSAnnotationChecker.this.global.Tree)List[CPSAnnotationChecker.this.global.Tree]">::</a><span class="delimiter">(</span><a href="#1211414" title="(fun: CPSAnnotationChecker.this.global.Tree, args: List[CPSAnnotationChecker.this.global.Tree])List[List[CPSAnnotationChecker.this.global.Tree]]">transArgList</a><span class="delimiter">(</span><a href="#1212328" title="CPSAnnotationChecker.this.global.Tree">fun</a>,<a href="#1212329" title="List[CPSAnnotationChecker.this.global.Tree]">args</a><span class="delimiter">)</span>.<a href="../../collection/generic/GenericTraversableTemplate.scala.html#58488" title="(implicit asTraversable: List[CPSAnnotationChecker.this.global.Tree] =&gt; scala.collection.GenTraversableOnce[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">flatten</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#3381713" title="(x: List[CPSAnnotationChecker.this.global.AnnotationInfo])List[CPSAnnotationChecker.this.global.AnnotationInfo]">flatMap</a> <a href="#1212300" title="(t: CPSAnnotationChecker.this.global.Tree)List[CPSAnnotationChecker.this.global.AnnotationInfo]">inspect</a>
                <span class="keyword">case</span> TypeApply<a href="#3381705" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="3381711" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410043" title="CPSAnnotationChecker.this.global.Tree" id="1212392">fun</a>, <a href="../../reflect/internal/Trees.scala.html#410045" title="List[CPSAnnotationChecker.this.global.Tree]" id="1212393">args</a><span class="delimiter">)</span> =&gt; <span class="delimiter">(</span><a href="#1212392" title="CPSAnnotationChecker.this.global.Tree">fun</a><a href="../../collection/immutable/List.scala.html#62685" title="(x: CPSAnnotationChecker.this.global.Tree)List[CPSAnnotationChecker.this.global.Tree]">::</a><span class="delimiter">(</span><a href="#1211414" title="(fun: CPSAnnotationChecker.this.global.Tree, args: List[CPSAnnotationChecker.this.global.Tree])List[List[CPSAnnotationChecker.this.global.Tree]]">transArgList</a><span class="delimiter">(</span><a href="#1212392" title="CPSAnnotationChecker.this.global.Tree">fun</a>,<a href="#1212393" title="List[CPSAnnotationChecker.this.global.Tree]">args</a><span class="delimiter">)</span>.<a href="../../collection/generic/GenericTraversableTemplate.scala.html#58488" title="(implicit asTraversable: List[CPSAnnotationChecker.this.global.Tree] =&gt; scala.collection.GenTraversableOnce[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">flatten</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#3381713" title="(x: List[CPSAnnotationChecker.this.global.AnnotationInfo])List[CPSAnnotationChecker.this.global.AnnotationInfo]">flatMap</a> <a href="#1212300" title="(t: CPSAnnotationChecker.this.global.Tree)List[CPSAnnotationChecker.this.global.AnnotationInfo]">inspect</a>
                <span class="keyword">case</span> _ =&gt; <a href="#3381713" title="(x: List[CPSAnnotationChecker.this.global.AnnotationInfo])List[CPSAnnotationChecker.this.global.AnnotationInfo]">Nil</a>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> _ =&gt; <a href="#3381728" title="(x: List[CPSAnnotationChecker.this.global.AnnotationInfo])List[CPSAnnotationChecker.this.global.AnnotationInfo]">Nil</a>
          <span class="delimiter">}</span>

          <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1212305">types</a> = <a href="CPSUtils.scala.html#1211381" title="(tpe: CPSAnnotationChecker.this.global.Type)List[CPSAnnotationChecker.this.global.AnnotationInfo]">cpsParamAnnotation</a><span class="delimiter">(</span><a href="#1212303" title="CPSAnnotationChecker.this.global.Tree">t</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>
          // TODO: check that it has been adapted and if so correctly
          <a href="#1212304" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">extra</a> <a href="../../collection/immutable/List.scala.html#62697" title="(that: scala.collection.GenTraversableOnce[CPSAnnotationChecker.this.global.AnnotationInfo])(implicit bf: scala.collection.generic.CanBuildFrom[List[CPSAnnotationChecker.this.global.AnnotationInfo],CPSAnnotationChecker.this.global.AnnotationInfo,List[CPSAnnotationChecker.this.global.AnnotationInfo]])List[CPSAnnotationChecker.this.global.AnnotationInfo]">++</a> <a href="#1211417" title="(xs: List[CPSAnnotationChecker.this.global.AnnotationInfo])List[CPSAnnotationChecker.this.global.AnnotationInfo]">emptyOrSingleList</a><span class="delimiter">(</span><a href="#1212305" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">types</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1212301">children</a> = <a href="#1212298" title="List[CPSAnnotationChecker.this.global.Tree]">childTrees</a> <a href="../../collection/TraversableLike.scala.html#58068" title="(f: CPSAnnotationChecker.this.global.Tree =&gt; scala.collection.GenTraversableOnce[CPSAnnotationChecker.this.global.AnnotationInfo])(implicit bf: scala.collection.generic.CanBuildFrom[List[CPSAnnotationChecker.this.global.Tree],CPSAnnotationChecker.this.global.AnnotationInfo,List[CPSAnnotationChecker.this.global.AnnotationInfo]])List[CPSAnnotationChecker.this.global.AnnotationInfo]">flatMap</a> <a href="#1212300" title="(t: CPSAnnotationChecker.this.global.Tree)List[CPSAnnotationChecker.this.global.AnnotationInfo]">inspect</a>

      <span class="keyword">val</span> <a title="CPSAnnotationChecker.this.global.Type" id="1212302">newtpe</a> = <a href="#1211413" title="(tpe: CPSAnnotationChecker.this.global.Type, childAnnots: List[CPSAnnotationChecker.this.global.AnnotationInfo], byName: List[CPSAnnotationChecker.this.global.Tree])CPSAnnotationChecker.this.global.Type">updateAttributesFromChildren</a><span class="delimiter">(</span><a href="#1212297" title="CPSAnnotationChecker.this.global.Type">tpe</a>, <a href="#1212301" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">children</a>, <a href="#1212299" title="List[CPSAnnotationChecker.this.global.Tree]">byName</a><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1212302" title="CPSAnnotationChecker.this.global.Type">newtpe</a>.<a href="../../reflect/internal/Types.scala.html#408509" title="=&gt; List[CPSAnnotationChecker.this.global.AnnotationInfo]">annotations</a>.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span>
        <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;[checker] inferred &quot;)" class="string">&quot;[checker] inferred &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212296" title="CPSAnnotationChecker.this.global.Tree">tree</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; / &quot;)" class="string">&quot; / &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212297" title="CPSAnnotationChecker.this.global.Type">tpe</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; ===&gt; &quot;)" class="string">&quot; ===&gt; &quot;</span><span title="(x$1: Any)String">+</span> <a href="#1212302" title="CPSAnnotationChecker.this.global.Type">newtpe</a><span class="delimiter">)</span>

      <a href="#1212302" title="CPSAnnotationChecker.this.global.Type">newtpe</a>
    <span class="delimiter">}</span>

    /** Modify the type that has thus far been inferred
     *  for a tree.  All this should do is add annotations. */

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: CPSAnnotationChecker.this.global.Tree, tpe: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type" id="1211419">addAnnotations</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Tree" id="1212549">tree</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="CPSAnnotationChecker.this.global.Tree">Tree</a>, <a title="CPSAnnotationChecker.this.global.Type" id="1212550">tpe</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a> = <span class="delimiter">{</span>
      <span class="keyword">import</span> scala.util.control._
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211328" title="=&gt; Boolean">cpsEnabled</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../util/control/Exception.scala.html#52177" title="scala.util.control.Exception.type">Exception</a>.<a href="../../util/control/Exception.scala.html#391585" title="(exceptions: Class[_]*)(value: =&gt; Boolean)scala.util.control.Exception.Catch[Boolean]">failAsValue</a><span class="delimiter">(</span>classOf<span title="Class[tools.nsc.MissingRequirementError](classOf[scala.reflect.internal.MissingRequirementError])" class="delimiter">[</span>MissingRequirementError<span class="delimiter">]</span><span class="delimiter">)</span><a href="../../util/control/Exception.scala.html#391651" title="(body: =&gt; Boolean)Boolean" class="delimiter">(</a><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211376" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasCpsParamTypes</a><span class="delimiter">(</span><a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#1211390" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../nsc/Global.scala.html#537436" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../nsc/reporters/Reporter.scala.html#539685" title="(pos: scala.reflect.internal.util.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408571" title="=&gt; CPSAnnotationChecker.this.global.Position">pos</a>, <span title="String(&quot;this code must be compiled with the Scala continuations plugin enabled&quot;)" class="string">&quot;this code must be compiled with the Scala continuations plugin enabled&quot;</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a>
      <span class="delimiter">}</span>

//      if (tree.tpe.hasAnnotation(MarkerCPSAdaptPlus))
//        println(&quot;addAnnotation &quot; + tree + &quot;/&quot; + tpe)

      <a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>

        <span class="keyword">case</span> Apply<a href="#3381788" title="Boolean" id="3381790" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410031" title="CPSAnnotationChecker.this.global.Tree" id="1212577">fun</a> @ Select<a href="#1212577" title="CPSAnnotationChecker.this.global.Type" id="3381792" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#409999" title="CPSAnnotationChecker.this.global.Tree" id="1212582">qual</a>, <a href="../../reflect/internal/Trees.scala.html#410001" title="CPSAnnotationChecker.this.global.Name" id="1212583">name</a><span class="delimiter">)</span>, <a href="../../reflect/internal/Trees.scala.html#410033" title="List[CPSAnnotationChecker.this.global.Tree]" id="1212584">args</a><span class="delimiter">)</span> <span class="keyword">if</span> fun.<a href="../../reflect/internal/Trees.scala.html#408560" title="=&gt; Boolean">isTyped</a> =&gt;

          // HACK: With overloaded methods, fun will never get annotated. This is because
          // the 'overloaded' type gets annotated, but not the alternatives (among which
          // fun's type is chosen)

          <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;[checker] checking select apply &quot;)" class="string">&quot;[checker] checking select apply &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>

          <a href="#1211418" title="(tree: CPSAnnotationChecker.this.global.Tree, tpe: CPSAnnotationChecker.this.global.Type, childTrees: List[CPSAnnotationChecker.this.global.Tree], byName: List[CPSAnnotationChecker.this.global.Tree])CPSAnnotationChecker.this.global.Type">transChildrenInOrder</a><span class="delimiter">(</span><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>, <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a>, <a href="#1212582" title="CPSAnnotationChecker.this.global.Tree">qual</a><a href="../../collection/immutable/List.scala.html#62685" title="(x: CPSAnnotationChecker.this.global.Tree)List[CPSAnnotationChecker.this.global.Tree]">::</a><span class="delimiter">(</span><a href="#1211414" title="(fun: CPSAnnotationChecker.this.global.Tree, args: List[CPSAnnotationChecker.this.global.Tree])List[List[CPSAnnotationChecker.this.global.Tree]]">transArgList</a><span class="delimiter">(</span>fun, <a href="#1212584" title="List[CPSAnnotationChecker.this.global.Tree]">args</a><span class="delimiter">)</span>.<a href="../../collection/generic/GenericTraversableTemplate.scala.html#58488" title="(implicit asTraversable: List[CPSAnnotationChecker.this.global.Tree] =&gt; scala.collection.GenTraversableOnce[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">flatten</a><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>

        <span class="keyword">case</span> Apply<span class="delimiter">(</span>TypeApply<a href="../../reflect/internal/Trees.scala.html#410031" title="CPSAnnotationChecker.this.global.Tree" id="3381797" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410043" title="CPSAnnotationChecker.this.global.Tree" id="1212600">fun</a> @ Select<a href="#1212600" title="CPSAnnotationChecker.this.global.Type" id="3381799" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#409999" title="CPSAnnotationChecker.this.global.Tree" id="1212605">qual</a>, <a href="../../reflect/internal/Trees.scala.html#410001" title="CPSAnnotationChecker.this.global.Name" id="1212606">name</a><span class="delimiter">)</span>, <a href="../../reflect/internal/Trees.scala.html#410045" title="List[CPSAnnotationChecker.this.global.Tree]" id="1212607">targs</a><span class="delimiter">)</span>, <a href="../../reflect/internal/Trees.scala.html#410033" title="List[CPSAnnotationChecker.this.global.Tree]" id="1212608">args</a><span class="delimiter">)</span> <span class="keyword">if</span> fun.<a href="../../reflect/internal/Trees.scala.html#408560" title="=&gt; Boolean">isTyped</a> =&gt; // not trigge

          <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;[checker] checking select apply type-apply &quot;)" class="string">&quot;[checker] checking select apply type-apply &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>

          <a href="#1211418" title="(tree: CPSAnnotationChecker.this.global.Tree, tpe: CPSAnnotationChecker.this.global.Type, childTrees: List[CPSAnnotationChecker.this.global.Tree], byName: List[CPSAnnotationChecker.this.global.Tree])CPSAnnotationChecker.this.global.Type">transChildrenInOrder</a><span class="delimiter">(</span><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>, <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a>, <a href="#1212605" title="CPSAnnotationChecker.this.global.Tree">qual</a><a href="../../collection/immutable/List.scala.html#62685" title="(x: CPSAnnotationChecker.this.global.Tree)List[CPSAnnotationChecker.this.global.Tree]">::</a><span class="delimiter">(</span><a href="#1211414" title="(fun: CPSAnnotationChecker.this.global.Tree, args: List[CPSAnnotationChecker.this.global.Tree])List[List[CPSAnnotationChecker.this.global.Tree]]">transArgList</a><span class="delimiter">(</span>fun, <a href="#1212608" title="List[CPSAnnotationChecker.this.global.Tree]">args</a><span class="delimiter">)</span>.<a href="../../collection/generic/GenericTraversableTemplate.scala.html#58488" title="(implicit asTraversable: List[CPSAnnotationChecker.this.global.Tree] =&gt; scala.collection.GenTraversableOnce[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">flatten</a><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>

        <span class="keyword">case</span> TypeApply<a href="#3381788" title="Boolean" id="3381801" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410043" title="CPSAnnotationChecker.this.global.Tree" id="1212620">fun</a> @ Select<a href="#1212620" title="CPSAnnotationChecker.this.global.Type" id="3381803" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#409999" title="CPSAnnotationChecker.this.global.Tree" id="1212625">qual</a>, <a href="../../reflect/internal/Trees.scala.html#410001" title="CPSAnnotationChecker.this.global.Name" id="1212626">name</a><span class="delimiter">)</span>, <a href="../../reflect/internal/Trees.scala.html#410045" title="List[CPSAnnotationChecker.this.global.Tree]" id="1212627">args</a><span class="delimiter">)</span> <span class="keyword">if</span> fun.<a href="../../reflect/internal/Trees.scala.html#408560" title="=&gt; Boolean">isTyped</a> =&gt;
          <span class="keyword">def</span> <a title="(tp: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type" id="1212628">stripNullaryMethodType</a><span class="delimiter">(</span><a title="CPSAnnotationChecker.this.global.Type" id="1212629">tp</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="CPSAnnotationChecker.this.global.Type">Type</a><span class="delimiter">)</span> = <a href="#1212629" title="CPSAnnotationChecker.this.global.Type">tp</a> <span class="keyword">match</span> <span class="delimiter">{</span> <span class="keyword">case</span> NullaryMethodType<a href="#3381739" title="CPSAnnotationChecker.this.global.Type" id="3381741" class="delimiter">(</a><a href="../../reflect/internal/Types.scala.html#410746" title="CPSAnnotationChecker.this.global.Type" id="1212631">restpe</a><span class="delimiter">)</span> =&gt; <a href="#3381743" title="(x: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">restpe</a> <span class="keyword">case</span> tp =&gt; <a href="#3381743" title="(x: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">tp</a> <span class="delimiter">}</span>
          <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;[checker] checking select type-apply &quot;)" class="string">&quot;[checker] checking select type-apply &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>

          <a href="#1211418" title="(tree: CPSAnnotationChecker.this.global.Tree, tpe: CPSAnnotationChecker.this.global.Type, childTrees: List[CPSAnnotationChecker.this.global.Tree], byName: List[CPSAnnotationChecker.this.global.Tree])CPSAnnotationChecker.this.global.Type">transChildrenInOrder</a><span class="delimiter">(</span><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>, <a href="#1212628" title="(tp: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">stripNullaryMethodType</a><span class="delimiter">(</span><a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: CPSAnnotationChecker.this.global.Tree*)List[CPSAnnotationChecker.this.global.Tree]">List</a><span class="delimiter">(</span><a href="#1212625" title="CPSAnnotationChecker.this.global.Tree">qual</a>, fun<span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>

        <span class="keyword">case</span> Apply<span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#410031" title="CPSAnnotationChecker.this.global.Tree" id="1212644">fun</a>, <a href="../../reflect/internal/Trees.scala.html#410033" title="List[CPSAnnotationChecker.this.global.Tree]" id="1212645">args</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#1212644" title="CPSAnnotationChecker.this.global.Tree">fun</a>.<a href="../../reflect/internal/Trees.scala.html#408560" title="=&gt; Boolean">isTyped</a> =&gt;

          <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;[checker] checking unknown apply &quot;)" class="string">&quot;[checker] checking unknown apply &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>

          <a href="#1211418" title="(tree: CPSAnnotationChecker.this.global.Tree, tpe: CPSAnnotationChecker.this.global.Type, childTrees: List[CPSAnnotationChecker.this.global.Tree], byName: List[CPSAnnotationChecker.this.global.Tree])CPSAnnotationChecker.this.global.Type">transChildrenInOrder</a><span class="delimiter">(</span><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>, <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a>, <a href="#1212644" title="CPSAnnotationChecker.this.global.Tree">fun</a><a href="../../collection/immutable/List.scala.html#62685" title="(x: CPSAnnotationChecker.this.global.Tree)List[CPSAnnotationChecker.this.global.Tree]">::</a><span class="delimiter">(</span><a href="#1211414" title="(fun: CPSAnnotationChecker.this.global.Tree, args: List[CPSAnnotationChecker.this.global.Tree])List[List[CPSAnnotationChecker.this.global.Tree]]">transArgList</a><span class="delimiter">(</span><a href="#1212644" title="CPSAnnotationChecker.this.global.Tree">fun</a>, <a href="#1212645" title="List[CPSAnnotationChecker.this.global.Tree]">args</a><span class="delimiter">)</span>.<a href="../../collection/generic/GenericTraversableTemplate.scala.html#58488" title="(implicit asTraversable: List[CPSAnnotationChecker.this.global.Tree] =&gt; scala.collection.GenTraversableOnce[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">flatten</a><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>

        <span class="keyword">case</span> TypeApply<span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#410043" title="CPSAnnotationChecker.this.global.Tree" id="1212657">fun</a>, <a href="../../reflect/internal/Trees.scala.html#410045" title="List[CPSAnnotationChecker.this.global.Tree]" id="1212658">args</a><span class="delimiter">)</span> =&gt;

          <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;[checker] checking unknown type apply &quot;)" class="string">&quot;[checker] checking unknown type apply &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>

          <a href="#1211418" title="(tree: CPSAnnotationChecker.this.global.Tree, tpe: CPSAnnotationChecker.this.global.Type, childTrees: List[CPSAnnotationChecker.this.global.Tree], byName: List[CPSAnnotationChecker.this.global.Tree])CPSAnnotationChecker.this.global.Type">transChildrenInOrder</a><span class="delimiter">(</span><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>, <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: CPSAnnotationChecker.this.global.Tree*)List[CPSAnnotationChecker.this.global.Tree]">List</a><span class="delimiter">(</span><a href="#1212657" title="CPSAnnotationChecker.this.global.Tree">fun</a><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>

        <span class="keyword">case</span> Select<a href="#3381788" title="CPSAnnotationChecker.this.global.Type" id="3381809" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#409999" title="CPSAnnotationChecker.this.global.Tree" id="1212670">qual</a>, <a href="../../reflect/internal/Trees.scala.html#410001" title="CPSAnnotationChecker.this.global.Name" id="1212671">name</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#1212670" title="CPSAnnotationChecker.this.global.Tree">qual</a>.<a href="../../reflect/internal/Trees.scala.html#408560" title="=&gt; Boolean">isTyped</a> =&gt;

          <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;[checker] checking select &quot;)" class="string">&quot;[checker] checking select &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>

          // straightforward way is problematic (see select.scala and Test2.scala)
          // transChildrenInOrder(tree, tpe, List(qual), Nil)

          // the problem is that qual may be of type OverloadedType (or MethodType) and
          // we cannot safely annotate these. so we just ignore these cases and
          // clean up later in the Apply/TypeApply trees.

          <span title="CPSAnnotationChecker.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="CPSUtils.scala.html#1211376" title="(tpe: CPSAnnotationChecker.this.global.Type)Boolean">hasCpsParamTypes</a><span class="delimiter">(</span><a href="#1212670" title="CPSAnnotationChecker.this.global.Tree">qual</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            // however there is one special case:
            // if it's a method without parameters, just apply it. normally done in adapt, but
            // we have to do it here so we don't lose the cps information (wouldn't trigger our
            // adapt and there is no Apply/TypeApply created)
            <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> NullaryMethodType<a href="#3381748" title="CPSAnnotationChecker.this.global.Type" id="3381750" class="delimiter">(</a><a href="../../reflect/internal/Types.scala.html#410746" title="CPSAnnotationChecker.this.global.Type" id="1212673">restpe</a><span class="delimiter">)</span> =&gt;
                //println(&quot;yep: &quot; + restpe + &quot;,&quot; + restpe.getClass)
                <a href="#1211418" title="(tree: CPSAnnotationChecker.this.global.Tree, tpe: CPSAnnotationChecker.this.global.Type, childTrees: List[CPSAnnotationChecker.this.global.Tree], byName: List[CPSAnnotationChecker.this.global.Tree])CPSAnnotationChecker.this.global.Type">transChildrenInOrder</a><a href="#3381758" title="(x: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type" class="delimiter">(</a><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>, <a href="#1212673" title="CPSAnnotationChecker.this.global.Type">restpe</a>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: CPSAnnotationChecker.this.global.Tree*)List[CPSAnnotationChecker.this.global.Tree]">List</a><span class="delimiter">(</span><a href="#1212670" title="CPSAnnotationChecker.this.global.Tree">qual</a><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>
              <span class="keyword">case</span> _ : PolyType =&gt; <a href="#3381758" title="(x: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">tpe</a>
              <span class="keyword">case</span> _ : MethodType =&gt; <a href="#3381758" title="(x: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">tpe</a>
              <span class="keyword">case</span> _ : OverloadedType =&gt; <a href="#3381758" title="(x: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">tpe</a>
              <span class="keyword">case</span> _ =&gt;
                <a href="#1211418" title="(tree: CPSAnnotationChecker.this.global.Tree, tpe: CPSAnnotationChecker.this.global.Type, childTrees: List[CPSAnnotationChecker.this.global.Tree], byName: List[CPSAnnotationChecker.this.global.Tree])CPSAnnotationChecker.this.global.Type">transChildrenInOrder</a><a href="#3381758" title="(x: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type" class="delimiter">(</a><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>, <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: CPSAnnotationChecker.this.global.Tree*)List[CPSAnnotationChecker.this.global.Tree]">List</a><span class="delimiter">(</span><a href="#1212670" title="CPSAnnotationChecker.this.global.Tree">qual</a><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a>

        <span class="keyword">case</span> If<a href="#3381788" title="CPSAnnotationChecker.this.global.Type" id="3381811" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410107" title="CPSAnnotationChecker.this.global.Tree" id="1212691">cond</a>, <a href="../../reflect/internal/Trees.scala.html#410109" title="CPSAnnotationChecker.this.global.Tree" id="1212692">thenp</a>, <a href="../../reflect/internal/Trees.scala.html#410111" title="CPSAnnotationChecker.this.global.Tree" id="1212693">elsep</a><span class="delimiter">)</span> =&gt;
          <a href="#1211418" title="(tree: CPSAnnotationChecker.this.global.Tree, tpe: CPSAnnotationChecker.this.global.Type, childTrees: List[CPSAnnotationChecker.this.global.Tree], byName: List[CPSAnnotationChecker.this.global.Tree])CPSAnnotationChecker.this.global.Type">transChildrenInOrder</a><a href="#3381823" title="(x: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type" class="delimiter">(</a><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>, <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: CPSAnnotationChecker.this.global.Tree*)List[CPSAnnotationChecker.this.global.Tree]">List</a><span class="delimiter">(</span><a href="#1212691" title="CPSAnnotationChecker.this.global.Tree">cond</a><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: CPSAnnotationChecker.this.global.Tree*)List[CPSAnnotationChecker.this.global.Tree]">List</a><span class="delimiter">(</span><a href="#1212692" title="CPSAnnotationChecker.this.global.Tree">thenp</a>, <a href="#1212693" title="CPSAnnotationChecker.this.global.Tree">elsep</a><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">case</span> Match<a href="#3381788" title="CPSAnnotationChecker.this.global.Type" id="3381813" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410097" title="CPSAnnotationChecker.this.global.Tree" id="1212710">select</a>, <a href="../../reflect/internal/Trees.scala.html#410099" title="List[CPSAnnotationChecker.this.global.CaseDef]" id="1212711">cases</a><span class="delimiter">)</span> =&gt;
          <a href="#1211418" title="(tree: CPSAnnotationChecker.this.global.Tree, tpe: CPSAnnotationChecker.this.global.Type, childTrees: List[CPSAnnotationChecker.this.global.Tree], byName: List[CPSAnnotationChecker.this.global.Tree])CPSAnnotationChecker.this.global.Type">transChildrenInOrder</a><a href="#3381823" title="(x: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type" class="delimiter">(</a><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>, <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: CPSAnnotationChecker.this.global.Tree*)List[CPSAnnotationChecker.this.global.Tree]">List</a><span class="delimiter">(</span><a href="#1212710" title="CPSAnnotationChecker.this.global.Tree">select</a><span class="delimiter">)</span>, <a href="#1212711" title="List[CPSAnnotationChecker.this.global.CaseDef]">cases</a><a href="../../collection/immutable/List.scala.html#62688" title="(prefix: List[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">:::</a><span class="delimiter">(</span><a href="#1212711" title="List[CPSAnnotationChecker.this.global.CaseDef]">cases</a> <a href="../../collection/TraversableLike.scala.html#58063" title="(f: CPSAnnotationChecker.this.global.CaseDef =&gt; CPSAnnotationChecker.this.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[CPSAnnotationChecker.this.global.CaseDef],CPSAnnotationChecker.this.global.Tree,List[CPSAnnotationChecker.this.global.Tree]])List[CPSAnnotationChecker.this.global.Tree]">map</a> <a href="#1212736" title="CPSAnnotationChecker.this.global.CaseDef" class="delimiter">{</a> <span class="keyword">case</span> CaseDef<span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#410180" title="CPSAnnotationChecker.this.global.Tree" id="3381767">_</a>, <a href="../../reflect/internal/Trees.scala.html#410182" title="CPSAnnotationChecker.this.global.Tree" id="3381768">_</a>, <a href="../../reflect/internal/Trees.scala.html#410184" title="CPSAnnotationChecker.this.global.Tree" id="1212746">body</a><span class="delimiter">)</span> =&gt; <a href="#3381770" title="(x: CPSAnnotationChecker.this.global.Tree)CPSAnnotationChecker.this.global.Tree">body</a> <span class="delimiter">}</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">case</span> Try<a href="#3381788" title="CPSAnnotationChecker.this.global.Type" id="3381815" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410079" title="CPSAnnotationChecker.this.global.Tree" id="1212794">block</a>, <a href="../../reflect/internal/Trees.scala.html#410081" title="List[CPSAnnotationChecker.this.global.CaseDef]" id="1212795">catches</a>, <a href="../../reflect/internal/Trees.scala.html#410083" title="CPSAnnotationChecker.this.global.Tree" id="1212796">finalizer</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="CPSAnnotationChecker.this.global.Type" id="1212797">tpe1</a> = <a href="#1211418" title="(tree: CPSAnnotationChecker.this.global.Tree, tpe: CPSAnnotationChecker.this.global.Type, childTrees: List[CPSAnnotationChecker.this.global.Tree], byName: List[CPSAnnotationChecker.this.global.Tree])CPSAnnotationChecker.this.global.Type">transChildrenInOrder</a><span class="delimiter">(</span><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>, <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a>, <a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a>, <a href="#1212794" title="CPSAnnotationChecker.this.global.Tree">block</a><a href="../../collection/immutable/List.scala.html#62685" title="(x: CPSAnnotationChecker.this.global.Tree)List[CPSAnnotationChecker.this.global.Tree]">::</a><a href="#1212795" title="List[CPSAnnotationChecker.this.global.CaseDef]">catches</a><a href="../../collection/immutable/List.scala.html#62688" title="(prefix: List[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">:::</a><span class="delimiter">(</span><a href="#1212795" title="List[CPSAnnotationChecker.this.global.CaseDef]">catches</a> <a href="../../collection/TraversableLike.scala.html#58063" title="(f: CPSAnnotationChecker.this.global.CaseDef =&gt; CPSAnnotationChecker.this.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[CPSAnnotationChecker.this.global.CaseDef],CPSAnnotationChecker.this.global.Tree,List[CPSAnnotationChecker.this.global.Tree]])List[CPSAnnotationChecker.this.global.Tree]">map</a> <a href="#1212817" title="CPSAnnotationChecker.this.global.CaseDef" class="delimiter">{</a> <span class="keyword">case</span> CaseDef<span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#410180" title="CPSAnnotationChecker.this.global.Tree" id="3381775">_</a>, <a href="../../reflect/internal/Trees.scala.html#410182" title="CPSAnnotationChecker.this.global.Tree" id="3381776">_</a>, <a href="../../reflect/internal/Trees.scala.html#410184" title="CPSAnnotationChecker.this.global.Tree" id="1212823">body</a><span class="delimiter">)</span> =&gt; <a href="#3381778" title="(x: CPSAnnotationChecker.this.global.Tree)CPSAnnotationChecker.this.global.Tree">body</a> <span class="delimiter">}</span><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="List[CPSAnnotationChecker.this.global.AnnotationInfo]" id="1212798">annots</a> = <a href="CPSUtils.scala.html#1211381" title="(tpe: CPSAnnotationChecker.this.global.Type)List[CPSAnnotationChecker.this.global.AnnotationInfo]">cpsParamAnnotation</a><span class="delimiter">(</span><a href="#1212797" title="CPSAnnotationChecker.this.global.Type">tpe1</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1212798" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots</a>.<a href="../../collection/TraversableOnce.scala.html#58191" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="CPSAnnotationChecker.this.global.AnnotationInfo" id="1212859">ann</a> = <a href="#1211416" title="(xs: List[CPSAnnotationChecker.this.global.AnnotationInfo])CPSAnnotationChecker.this.global.AnnotationInfo">single</a><span class="delimiter">(</span><a href="#1212798" title="List[CPSAnnotationChecker.this.global.AnnotationInfo]">annots</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a href="#3381784" title="(x: (CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type))(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)" class="delimiter">(</a><a href="../../Tuple2.scala.html#60635" title="CPSAnnotationChecker.this.global.Type" id="1212861">atp0</a>, <a href="../../Tuple2.scala.html#60637" title="CPSAnnotationChecker.this.global.Type" id="1212862">atp1</a><span class="delimiter">)</span> = <a href="CPSUtils.scala.html#1211372" title="(ann: CPSAnnotationChecker.this.global.AnnotationInfo)(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type)">annTypes</a><a href="../../Tuple2.scala.html#783" title="(CPSAnnotationChecker.this.global.Type, CPSAnnotationChecker.this.global.Type) @unchecked" class="delimiter">(</a><a href="#1212859" title="CPSAnnotationChecker.this.global.AnnotationInfo">ann</a><span class="delimiter">)</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><span class="delimiter">(</span><a href="#1212861" title="CPSAnnotationChecker.this.global.Type">atp0</a> <a href="../../reflect/internal/Types.scala.html#408485" title="(that: CPSAnnotationChecker.this.global.Type)Boolean">=:=</a> <a href="#1212862" title="CPSAnnotationChecker.this.global.Type">atp1</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span title="Nothing" class="keyword">throw</span> <a href="../../reflect/internal/Types.scala.html#416076" title="(msg: String)CPSAnnotationChecker.this.global.TypeError" class="keyword">new</a> <a href="../../reflect/internal/Types.scala.html#407625" title="CPSAnnotationChecker.this.global.TypeError">TypeError</a><span class="delimiter">(</span><span title="String(&quot;only simple cps types allowed in try/catch blocks (found: &quot;)" class="string">&quot;only simple cps types allowed in try/catch blocks (found: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212797" title="CPSAnnotationChecker.this.global.Type">tpe1</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#1212796" title="CPSAnnotationChecker.this.global.Tree">finalizer</a>.<a href="../../reflect/internal/Trees.scala.html#408582" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> // no finalizers allowed. see explanation in SelectiveCPSTransform
              <a href="../nsc/Global.scala.html#537436" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../nsc/reporters/Reporter.scala.html#539685" title="(pos: scala.reflect.internal.util.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408571" title="=&gt; CPSAnnotationChecker.this.global.Position">pos</a>, <span title="String(&quot;try/catch blocks that use continuations cannot have finalizers&quot;)" class="string">&quot;try/catch blocks that use continuations cannot have finalizers&quot;</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#1212797" title="CPSAnnotationChecker.this.global.Type">tpe1</a>

        <span class="keyword">case</span> Block<a href="#3381788" title="CPSAnnotationChecker.this.global.Type" id="3381817" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410192" title="List[CPSAnnotationChecker.this.global.Tree]" id="1212885">stms</a>, <a href="../../reflect/internal/Trees.scala.html#410194" title="CPSAnnotationChecker.this.global.Tree" id="1212886">expr</a><span class="delimiter">)</span> =&gt;
          // if any stm has annotation, so does block
          <a href="#1211418" title="(tree: CPSAnnotationChecker.this.global.Tree, tpe: CPSAnnotationChecker.this.global.Type, childTrees: List[CPSAnnotationChecker.this.global.Tree], byName: List[CPSAnnotationChecker.this.global.Tree])CPSAnnotationChecker.this.global.Type">transChildrenInOrder</a><a href="#3381823" title="(x: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type" class="delimiter">(</a><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>, <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a>, <a href="#1211415" title="(stms: List[CPSAnnotationChecker.this.global.Tree])List[CPSAnnotationChecker.this.global.Tree]">transStms</a><span class="delimiter">(</span><a href="#1212885" title="List[CPSAnnotationChecker.this.global.Tree]">stms</a><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: CPSAnnotationChecker.this.global.Tree*)List[CPSAnnotationChecker.this.global.Tree]">List</a><span class="delimiter">(</span><a href="#1212886" title="CPSAnnotationChecker.this.global.Tree">expr</a><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">case</span> ValDef<a href="#3381788" title="CPSAnnotationChecker.this.global.Type" id="3381819" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410298" title="CPSAnnotationChecker.this.global.Modifiers" id="1212900">mods</a>, <a href="../../reflect/internal/Trees.scala.html#410300" title="CPSAnnotationChecker.this.global.TermName" id="1212901">name</a>, <a href="../../reflect/internal/Trees.scala.html#410302" title="CPSAnnotationChecker.this.global.Tree" id="1212902">tpt</a>, <a href="../../reflect/internal/Trees.scala.html#410304" title="CPSAnnotationChecker.this.global.Tree" id="1212903">rhs</a><span class="delimiter">)</span> =&gt;
          <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;[checker] checking valdef &quot;)" class="string">&quot;[checker] checking valdef &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212901" title="CPSAnnotationChecker.this.global.TermName">name</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span title="(x$1: Any)String">+</span><a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a><span title="(x$1: Any)String">+</span><span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span title="(x$1: Any)String">+</span><a href="#1212902" title="CPSAnnotationChecker.this.global.Tree">tpt</a><span title="(x$1: Any)String">+</span><span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span title="(x$1: Any)String">+</span><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408577" title="=&gt; CPSAnnotationChecker.this.global.Symbol">symbol</a>.<a href="../../reflect/internal/Symbols.scala.html#411365" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a><span class="delimiter">)</span>
          // ValDef symbols must *not* have annotations!
          <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="CPSUtils.scala.html#1211385" title="(tp: CPSAnnotationChecker.this.global.Type)Boolean">hasAnswerTypeAnn</a><span class="delimiter">(</span><a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408577" title="=&gt; CPSAnnotationChecker.this.global.Symbol">symbol</a>.<a href="../../reflect/internal/Symbols.scala.html#411367" title="=&gt; CPSAnnotationChecker.this.global.Type">info</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> // is it okay to modify sym here?
            <a href="#1211393" title="(x: =&gt; Any)Unit">vprintln</a><span class="delimiter">(</span><span title="String(&quot;removing annotation from sym &quot;)" class="string">&quot;removing annotation from sym &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408577" title="=&gt; CPSAnnotationChecker.this.global.Symbol">symbol</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408577" title="=&gt; CPSAnnotationChecker.this.global.Symbol">symbol</a>.<a href="../../reflect/internal/Symbols.scala.html#411365" title="=&gt; CPSAnnotationChecker.this.global.Type">tpe</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1212902" title="CPSAnnotationChecker.this.global.Tree">tpt</a><span class="delimiter">)</span>
            <a href="#1212902" title="CPSAnnotationChecker.this.global.Tree">tpt</a> <a href="../../reflect/internal/Trees.scala.html#408561" title="(f: CPSAnnotationChecker.this.global.Type =&gt; CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Tree">modifyType</a> <a href="CPSUtils.scala.html#1211380" title="(tpe: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">removeAllCPSAnnotations</a>
            <a href="#1212549" title="CPSAnnotationChecker.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408577" title="=&gt; CPSAnnotationChecker.this.global.Symbol">symbol</a> <a href="../../reflect/internal/Symbols.scala.html#411370" title="(f: CPSAnnotationChecker.this.global.Type =&gt; CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Symbol">modifyInfo</a> <a href="CPSUtils.scala.html#1211380" title="(tpe: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">removeAllCPSAnnotations</a>
          <span class="delimiter">}</span>
          <a href="#1212550" title="CPSAnnotationChecker.this.global.Type">tpe</a>

        <span class="keyword">case</span> _ =&gt;
          <a href="#3381823" title="(x: CPSAnnotationChecker.this.global.Type)CPSAnnotationChecker.this.global.Type">tpe</a>
      <span class="delimiter">}</span>


    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>