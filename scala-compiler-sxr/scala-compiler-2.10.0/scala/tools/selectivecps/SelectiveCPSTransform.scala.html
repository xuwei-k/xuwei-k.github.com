<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/selectivecps/SelectiveCPSTransform.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
// $Id$

<span class="keyword">package</span> scala.tools.selectivecps

<span class="keyword">import</span> scala.collection._

<span class="keyword">import</span> scala.tools.nsc._
<span class="keyword">import</span> scala.tools.nsc.transform._
<span class="keyword">import</span> scala.tools.nsc.plugins._

<span class="keyword">import</span> scala.tools.nsc.ast.TreeBrowsers
<span class="keyword">import</span> scala.tools.nsc.ast._

/**
 * In methods marked @cps, CPS-transform assignments introduced by ANF-transform phase.
 */
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class SelectiveCPSTransform extends scala.tools.nsc.plugins.PluginComponent with scala.tools.nsc.transform.InfoTransform with scala.tools.nsc.transform.TypingTransformers with scala.tools.selectivecps.CPSUtils with scala.tools.nsc.ast.TreeDSL" id="51733">SelectiveCPSTransform</a> <a href="#51733" title="scala.tools.selectivecps.SelectiveCPSTransform" class="keyword">extends</a> <a href="../nsc/plugins/PluginComponent.scala.html#41112" title="scala.tools.nsc.plugins.PluginComponent">PluginComponent</a> <span class="keyword">with</span>
  <a href="../nsc/transform/InfoTransform.scala.html#43005" title="scala.tools.nsc.transform.InfoTransform">InfoTransform</a> <span class="keyword">with</span> <a href="../nsc/transform/TypingTransformers.scala.html#43407" title="scala.tools.nsc.transform.TypingTransformers">TypingTransformers</a> <span class="keyword">with</span> <a href="CPSUtils.scala.html#51704" title="scala.tools.selectivecps.CPSUtils">CPSUtils</a> <span class="keyword">with</span> <a href="../nsc/ast/TreeDSL.scala.html#28843" title="scala.tools.nsc.ast.TreeDSL">TreeDSL</a> <span class="delimiter">{</span>
  // inherits abstract value `global` and class `Phase` from Transform

  <span class="keyword">import</span> <a href="../nsc/ast/TreeDSL.scala.html#538231" title="=&gt; scala.tools.nsc.Global">global</a>._                  // the global environment
  <span class="keyword">import</span> <a href="../../reflect/internal/Definitions.scala.html#407777" title="SelectiveCPSTransform.this.global.definitions.type">definitions</a>._             // standard classes and methods
  <span class="keyword">import</span> <a href="../nsc/Global.scala.html#537612" title="SelectiveCPSTransform.this.global.typer.type">typer</a>.atOwner             // methods to type trees

  /** the following two members override abstract members in Transform */
  <span class="keyword">val</span> <a title="String" id="1215844">phaseName</a>: <span title="String">String</span> = <span title="String(&quot;selectivecps&quot;)" class="string">&quot;selectivecps&quot;</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(unit: SelectiveCPSTransform.this.global.CompilationUnit)SelectiveCPSTransform.this.global.Transformer" id="1215846">newTransformer</a><span class="delimiter">(</span><a title="SelectiveCPSTransform.this.global.CompilationUnit" id="1215947">unit</a>: <a href="../nsc/CompilationUnits.scala.html#537766" title="SelectiveCPSTransform.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span>: <a href="../nsc/ast/Trees.scala.html#537817" title="SelectiveCPSTransform.this.global.Transformer">Transformer</a> =
    <span title="SelectiveCPSTransform.this.CPSTransformer" class="keyword">new</span> <a href="#1215850" title="SelectiveCPSTransform.this.CPSTransformer">CPSTransformer</a><span class="delimiter">(</span><a href="#1215947" title="SelectiveCPSTransform.this.global.CompilationUnit">unit</a><span class="delimiter">)</span>

  /** This class does not change linearization */
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="1215847">changesBaseClasses</a> = <span title="Boolean(false)" class="keyword">false</span>

  /** - return symbol's transformed type,
   */
  <span class="keyword">def</span> <a title="(sym: SelectiveCPSTransform.this.global.Symbol, tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type" id="1215848">transformInfo</a><span class="delimiter">(</span><a title="SelectiveCPSTransform.this.global.Symbol" id="1215963">sym</a>: <a href="../../reflect/internal/Symbols.scala.html#407146" title="SelectiveCPSTransform.this.global.Symbol">Symbol</a>, <a title="SelectiveCPSTransform.this.global.Type" id="1215964">tp</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="SelectiveCPSTransform.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../reflect/internal/Types.scala.html#407270" title="SelectiveCPSTransform.this.global.Type">Type</a> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211328" title="=&gt; Boolean">cpsEnabled</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <a href="#1215964" title="SelectiveCPSTransform.this.global.Type">tp</a>

    <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.Type" id="1215968">newtp</a> = <a href="#1215849" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type">transformCPSType</a><span class="delimiter">(</span><a href="#1215964" title="SelectiveCPSTransform.this.global.Type">tp</a><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1215968" title="SelectiveCPSTransform.this.global.Type">newtp</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#1215964" title="SelectiveCPSTransform.this.global.Type">tp</a><span class="delimiter">)</span>
      <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;transformInfo changed type for &quot;)" class="string">&quot;transformInfo changed type for &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1215963" title="SelectiveCPSTransform.this.global.Symbol">sym</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; to &quot;)" class="string">&quot; to &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1215968" title="SelectiveCPSTransform.this.global.Type">newtp</a><span class="delimiter">)</span>;

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1215963" title="SelectiveCPSTransform.this.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="CPSUtils.scala.html#1211362" title="=&gt; SelectiveCPSTransform.this.global.Symbol">MethReifyR</a><span class="delimiter">)</span>
      <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;transformInfo (not)changed type for &quot;)" class="string">&quot;transformInfo (not)changed type for &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1215963" title="SelectiveCPSTransform.this.global.Symbol">sym</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; to &quot;)" class="string">&quot; to &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1215968" title="SelectiveCPSTransform.this.global.Type">newtp</a><span class="delimiter">)</span>;

    <a href="#1215968" title="SelectiveCPSTransform.this.global.Type">newtp</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type" id="1215849">transformCPSType</a><span class="delimiter">(</span><a title="SelectiveCPSTransform.this.global.Type" id="1215969">tp</a>: <a href="../../reflect/internal/Types.scala.html#407270" title="SelectiveCPSTransform.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../reflect/internal/Types.scala.html#407270" title="SelectiveCPSTransform.this.global.Type">Type</a> = <span class="delimiter">{</span>  // TODO: use a TypeMap? need to handle more cases?
    <a href="#1215969" title="SelectiveCPSTransform.this.global.Type">tp</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> PolyType<a href="#3382367" title="SelectiveCPSTransform.this.global.Type" id="3382369" class="delimiter">(</a><a href="../../reflect/internal/Types.scala.html#410715" title="List[SelectiveCPSTransform.this.global.Symbol]" id="1215981">params</a>,<a href="../../reflect/internal/Types.scala.html#410717" title="SelectiveCPSTransform.this.global.Type" id="1215982">res</a><span class="delimiter">)</span> =&gt; <a href="../../reflect/internal/Types.scala.html#421482" title="(typeParams: List[SelectiveCPSTransform.this.global.Symbol], resultType: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.PolyType">PolyType</a><a href="#3382377" title="(x: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type" class="delimiter">(</a><a href="#1215981" title="List[SelectiveCPSTransform.this.global.Symbol]">params</a>, <a href="#1215849" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type">transformCPSType</a><span class="delimiter">(</span><a href="#1215982" title="SelectiveCPSTransform.this.global.Type">res</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> NullaryMethodType<a href="#3382367" title="SelectiveCPSTransform.this.global.Type" id="3382371" class="delimiter">(</a><a href="../../reflect/internal/Types.scala.html#410746" title="SelectiveCPSTransform.this.global.Type" id="1215988">res</a><span class="delimiter">)</span> =&gt; <a href="../../reflect/internal/Types.scala.html#441694" title="(resultType: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.NullaryMethodType">NullaryMethodType</a><a href="#3382377" title="(x: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type" class="delimiter">(</a><a href="#1215849" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type">transformCPSType</a><span class="delimiter">(</span><a href="#1215988" title="SelectiveCPSTransform.this.global.Type">res</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> MethodType<a href="#3382367" title="SelectiveCPSTransform.this.global.Type" id="3382373" class="delimiter">(</a><a href="../../reflect/internal/Types.scala.html#410769" title="List[SelectiveCPSTransform.this.global.Symbol]" id="1215993">params</a>,<a href="../../reflect/internal/Types.scala.html#410771" title="SelectiveCPSTransform.this.global.Type" id="1215994">res</a><span class="delimiter">)</span> =&gt; <a href="../../reflect/internal/Types.scala.html#420479" title="(params: List[SelectiveCPSTransform.this.global.Symbol], resultType: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.MethodType">MethodType</a><a href="#3382377" title="(x: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type" class="delimiter">(</a><a href="#1215993" title="List[SelectiveCPSTransform.this.global.Symbol]">params</a>, <a href="#1215849" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type">transformCPSType</a><span class="delimiter">(</span><a href="#1215994" title="SelectiveCPSTransform.this.global.Type">res</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> TypeRef<a href="#3382367" title="SelectiveCPSTransform.this.global.Type" id="3382375" class="delimiter">(</a><a href="../../reflect/internal/Types.scala.html#410887" title="SelectiveCPSTransform.this.global.Type" id="1216002">pre</a>, <a href="../../reflect/internal/Types.scala.html#410889" title="SelectiveCPSTransform.this.global.Symbol" id="1216003">sym</a>, <a href="../../reflect/internal/Types.scala.html#410891" title="List[SelectiveCPSTransform.this.global.Type]" id="1216004">args</a><span class="delimiter">)</span> =&gt; <a href="../../reflect/internal/Types.scala.html#415106" title="(pre: SelectiveCPSTransform.this.global.Type, sym: SelectiveCPSTransform.this.global.Symbol, args: List[SelectiveCPSTransform.this.global.Type])SelectiveCPSTransform.this.global.Type">TypeRef</a><a href="#3382377" title="(x: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type" class="delimiter">(</a><a href="#1216002" title="SelectiveCPSTransform.this.global.Type">pre</a>, <a href="#1216003" title="SelectiveCPSTransform.this.global.Symbol">sym</a>, <a href="#1216004" title="List[SelectiveCPSTransform.this.global.Type]">args</a>.<a href="../../collection/TraversableLike.scala.html#58063" title="(f: SelectiveCPSTransform.this.global.Type =&gt; SelectiveCPSTransform.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[SelectiveCPSTransform.this.global.Type],SelectiveCPSTransform.this.global.Type,List[SelectiveCPSTransform.this.global.Type]])List[SelectiveCPSTransform.this.global.Type]">map</a><a href="../../collection/immutable/List.scala.html#62442" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,SelectiveCPSTransform.this.global.Type,List[SelectiveCPSTransform.this.global.Type]]" class="delimiter">(</a><a href="#1215849" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type">transformCPSType</a><span class="delimiter">(</span><a href="#1216027" title="SelectiveCPSTransform.this.global.Type">_</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt;
        <a href="CPSUtils.scala.html#1211383" title="(tp: SelectiveCPSTransform.this.global.Type)Option[(SelectiveCPSTransform.this.global.Type, SelectiveCPSTransform.this.global.Type)]">getExternalAnswerTypeAnn</a><a href="#3382377" title="(x: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type" class="delimiter">(</a><a href="#1215969" title="SelectiveCPSTransform.this.global.Type">tp</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> Some<a href="#3382358" title="SelectiveCPSTransform.this.global.Type" id="3382360" class="delimiter">(</a><a href="../../Option.scala.html#63132" title="(SelectiveCPSTransform.this.global.Type, SelectiveCPSTransform.this.global.Type)" id="3382359" class="delimiter">(</a><a href="../../Tuple2.scala.html#60635" title="SelectiveCPSTransform.this.global.Type" id="1216072">res</a>, <a href="../../Tuple2.scala.html#60637" title="SelectiveCPSTransform.this.global.Type" id="1216073">outer</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
            <a href="../../reflect/internal/Types.scala.html#407408" title="(tycon: SelectiveCPSTransform.this.global.Type, args: List[SelectiveCPSTransform.this.global.Type])SelectiveCPSTransform.this.global.Type">appliedType</a><a href="#3382362" title="(x: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type" class="delimiter">(</a><a href="CPSUtils.scala.html#1211346" title="=&gt; SelectiveCPSTransform.this.global.ClassSymbol">Context</a>.<a href="../../reflect/internal/Symbols.scala.html#411559" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.Type*)List[SelectiveCPSTransform.this.global.Type]">List</a><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211380" title="(tpe: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type">removeAllCPSAnnotations</a><span class="delimiter">(</span><a href="#1215969" title="SelectiveCPSTransform.this.global.Type">tp</a><span class="delimiter">)</span>, <a href="#1216072" title="SelectiveCPSTransform.this.global.Type">res</a>, <a href="#1216073" title="SelectiveCPSTransform.this.global.Type">outer</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> _ =&gt;
            <a href="CPSUtils.scala.html#1211380" title="(tpe: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type">removeAllCPSAnnotations</a><a href="#3382362" title="(x: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type" class="delimiter">(</a><a href="#1215969" title="SelectiveCPSTransform.this.global.Type">tp</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="keyword">class</span> <a title="class CPSTransformer extends SelectiveCPSTransform.this.TypingTransformer" id="1215850">CPSTransformer</a><a href="#1215850" title="SelectiveCPSTransform.this.CPSTransformer" class="delimiter">(</a><a title="SelectiveCPSTransform.this.global.CompilationUnit" id="1215959">unit</a>: <a href="../nsc/CompilationUnits.scala.html#537766" title="SelectiveCPSTransform.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../nsc/transform/TypingTransformers.scala.html#621441" title="SelectiveCPSTransform.this.TypingTransformer">TypingTransformer</a><span class="delimiter">(</span><a href="#1215959" title="SelectiveCPSTransform.this.global.CompilationUnit">unit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.patmat.global.Transformer" id="1215953">patmatTransformer</a> = <a href="../nsc/Global.scala.html#537552" title="SelectiveCPSTransform.this.global.patmat.type">patmat</a>.<a href="../nsc/typechecker/PatternMatching.scala.html#621361" title="(unit: SelectiveCPSTransform.this.global.patmat.global.CompilationUnit)SelectiveCPSTransform.this.global.patmat.global.Transformer">newTransformer</a><span class="delimiter">(</span><a href="#1215959" title="SelectiveCPSTransform.this.global.CompilationUnit">unit</a><span class="delimiter">)</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree" id="1215955">transform</a><span class="delimiter">(</span><a title="SelectiveCPSTransform.this.global.Tree" id="1216097">tree</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="SelectiveCPSTransform.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../reflect/internal/Trees.scala.html#407938" title="SelectiveCPSTransform.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="CPSUtils.scala.html#1211328" title="=&gt; Boolean">cpsEnabled</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <a href="#1216097" title="SelectiveCPSTransform.this.global.Tree">tree</a>
      <a href="#1215956" title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">postTransform</a><span class="delimiter">(</span><a href="#1215957" title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">mainTransform</a><span class="delimiter">(</span><a href="#1216097" title="SelectiveCPSTransform.this.global.Tree">tree</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree" id="1215956">postTransform</a><span class="delimiter">(</span><a title="SelectiveCPSTransform.this.global.Tree" id="1216102">tree</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="SelectiveCPSTransform.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../reflect/internal/Trees.scala.html#407938" title="SelectiveCPSTransform.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <a href="#1216102" title="SelectiveCPSTransform.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408575" title="(tp: SelectiveCPSTransform.this.global.Type)tree.type">setType</a><span class="delimiter">(</span><a href="#1215849" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type">transformCPSType</a><span class="delimiter">(</span><a href="#1216102" title="SelectiveCPSTransform.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>


    <span class="keyword">def</span> <a title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree" id="1215957">mainTransform</a><span class="delimiter">(</span><a title="SelectiveCPSTransform.this.global.Tree" id="1216103">tree</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="SelectiveCPSTransform.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../reflect/internal/Trees.scala.html#407938" title="SelectiveCPSTransform.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>

        // TODO: can we generalize this?

        <span class="keyword">case</span> Apply<a href="#3382406" title="Boolean" id="3382409" class="delimiter">(</a>TypeApply<a href="../../reflect/internal/Trees.scala.html#410031" title="SelectiveCPSTransform.this.global.Tree" id="3382411" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410043" title="SelectiveCPSTransform.this.global.Tree" id="1216116">fun</a>, <a href="../../reflect/internal/Trees.scala.html#410045" title="List[SelectiveCPSTransform.this.global.Tree]" id="1216117">targs</a><span class="delimiter">)</span>, <a href="../../reflect/internal/Trees.scala.html#410033" title="List[SelectiveCPSTransform.this.global.Tree]" id="1216118">args</a><span class="delimiter">)</span>
        <span class="keyword">if</span> <span class="delimiter">(</span><a href="#1216116" title="SelectiveCPSTransform.this.global.Tree">fun</a>.<a href="../../reflect/internal/Trees.scala.html#408577" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="CPSUtils.scala.html#1211356" title="=&gt; SelectiveCPSTransform.this.global.Symbol">MethShift</a><span class="delimiter">)</span> =&gt;
          <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;found shift: &quot;)" class="string">&quot;found shift: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a><span class="delimiter">)</span>
          <a href="../../reflect/internal/Positions.scala.html#408315" title="(pos: SelectiveCPSTransform.this.global.Position)(tree: SelectiveCPSTransform.this.global.Apply)SelectiveCPSTransform.this.global.Apply">atPos</a><span class="delimiter">(</span><a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408571" title="=&gt; SelectiveCPSTransform.this.global.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.gen.global.Tree" id="1216135">funR</a> = <a href="../nsc/Global.scala.html#537460" title="SelectiveCPSTransform.this.global.gen.type">gen</a>.<a href="../../reflect/internal/TreeGen.scala.html#470989" title="(sym: SelectiveCPSTransform.this.global.gen.global.Symbol)SelectiveCPSTransform.this.global.gen.global.Tree">mkAttributedRef</a><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211358" title="=&gt; SelectiveCPSTransform.this.global.Symbol">MethShiftR</a><span class="delimiter">)</span> // TODO: correct?
            //gen.mkAttributedSelect(gen.mkAttributedSelect(gen.mkAttributedSelect(gen.mkAttributedIdent(ScalaPackage),
            //ScalaPackage.tpe.member(&quot;util&quot;)), ScalaPackage.tpe.member(&quot;util&quot;).tpe.member(&quot;continuations&quot;)), MethShiftR)
            //gen.mkAttributedRef(ModCPS.tpe,  MethShiftR) // TODO: correct?
            <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;funR.tpe = &quot;)" class="string">&quot;funR.tpe = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1216135" title="SelectiveCPSTransform.this.global.gen.global.Tree">funR</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.gen.global.Type">tpe</a><span class="delimiter">)</span>
            <a href="../../reflect/internal/Trees.scala.html#413581" title="(fun: SelectiveCPSTransform.this.global.Tree, args: List[SelectiveCPSTransform.this.global.Tree])SelectiveCPSTransform.this.global.Apply">Apply</a><span class="delimiter">(</span>
                <a href="../../reflect/internal/Trees.scala.html#453869" title="(fun: SelectiveCPSTransform.this.global.Tree, args: List[SelectiveCPSTransform.this.global.Tree])SelectiveCPSTransform.this.global.TypeApply">TypeApply</a><span class="delimiter">(</span><a href="#1216135" title="SelectiveCPSTransform.this.global.gen.global.Tree">funR</a>, <a href="#1216117" title="List[SelectiveCPSTransform.this.global.Tree]">targs</a><span class="delimiter">)</span>.<a href="../../reflect/internal/Trees.scala.html#408575" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.TypeApply">setType</a><span class="delimiter">(</span><a href="../../reflect/internal/Types.scala.html#407408" title="(tycon: SelectiveCPSTransform.this.global.Type, args: List[SelectiveCPSTransform.this.global.Type])SelectiveCPSTransform.this.global.Type">appliedType</a><span class="delimiter">(</span><a href="#1216135" title="SelectiveCPSTransform.this.global.gen.global.Tree">funR</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.gen.global.Type">tpe</a>, <a href="#1216117" title="List[SelectiveCPSTransform.this.global.Tree]">targs</a>.<a href="../../collection/TraversableLike.scala.html#58063" title="(f: SelectiveCPSTransform.this.global.Tree =&gt; SelectiveCPSTransform.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[SelectiveCPSTransform.this.global.Tree],SelectiveCPSTransform.this.global.Type,List[SelectiveCPSTransform.this.global.Type]])List[SelectiveCPSTransform.this.global.Type]">map</a><a href="../../collection/immutable/List.scala.html#62442" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,SelectiveCPSTransform.this.global.Type,List[SelectiveCPSTransform.this.global.Type]]" class="delimiter">(</a><span class="delimiter">(</span>t:<a href="../../reflect/internal/Trees.scala.html#407938" title="SelectiveCPSTransform.this.global.Tree">Tree</a><span class="delimiter">)</span> =&gt; <a href="#1216189" title="SelectiveCPSTransform.this.global.Tree">t</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>,
                <a href="#1216118" title="List[SelectiveCPSTransform.this.global.Tree]">args</a>.<a href="../../collection/TraversableLike.scala.html#58063" title="(f: SelectiveCPSTransform.this.global.Tree =&gt; SelectiveCPSTransform.this.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[SelectiveCPSTransform.this.global.Tree],SelectiveCPSTransform.this.global.Tree,List[SelectiveCPSTransform.this.global.Tree]])List[SelectiveCPSTransform.this.global.Tree]">map</a><a href="../../collection/immutable/List.scala.html#62442" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,SelectiveCPSTransform.this.global.Tree,List[SelectiveCPSTransform.this.global.Tree]]" class="delimiter">(</a><a href="#1215955" title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1216234" title="SelectiveCPSTransform.this.global.Tree">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">)</span>.<a href="../../reflect/internal/Trees.scala.html#408575" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Apply">setType</a><span class="delimiter">(</span><a href="#1215849" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type">transformCPSType</a><span class="delimiter">(</span><a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> Apply<span class="delimiter">(</span>TypeApply<a href="../../reflect/internal/Trees.scala.html#410031" title="SelectiveCPSTransform.this.global.Tree" id="3382416" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410043" title="SelectiveCPSTransform.this.global.Tree" id="1216286">fun</a>, <a href="../../reflect/internal/Trees.scala.html#410045" title="List[SelectiveCPSTransform.this.global.Tree]" id="1216287">targs</a><span class="delimiter">)</span>, <a href="../../reflect/internal/Trees.scala.html#410033" title="List[SelectiveCPSTransform.this.global.Tree]" id="1216288">args</a><span class="delimiter">)</span>
        <span class="keyword">if</span> <span class="delimiter">(</span><a href="#1216286" title="SelectiveCPSTransform.this.global.Tree">fun</a>.<a href="../../reflect/internal/Trees.scala.html#408577" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="CPSUtils.scala.html#1211350" title="=&gt; SelectiveCPSTransform.this.global.Symbol">MethShiftUnit</a><span class="delimiter">)</span> =&gt;
          <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;found shiftUnit: &quot;)" class="string">&quot;found shiftUnit: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a><span class="delimiter">)</span>
          <a href="../../reflect/internal/Positions.scala.html#408315" title="(pos: SelectiveCPSTransform.this.global.Position)(tree: SelectiveCPSTransform.this.global.Apply)SelectiveCPSTransform.this.global.Apply">atPos</a><span class="delimiter">(</span><a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408571" title="=&gt; SelectiveCPSTransform.this.global.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.gen.global.Tree" id="1216299">funR</a> = <a href="../nsc/Global.scala.html#537460" title="SelectiveCPSTransform.this.global.gen.type">gen</a>.<a href="../../reflect/internal/TreeGen.scala.html#470989" title="(sym: SelectiveCPSTransform.this.global.gen.global.Symbol)SelectiveCPSTransform.this.global.gen.global.Tree">mkAttributedRef</a><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211354" title="=&gt; SelectiveCPSTransform.this.global.Symbol">MethShiftUnitR</a><span class="delimiter">)</span> // TODO: correct?
            <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;funR.tpe = &quot;)" class="string">&quot;funR.tpe = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1216299" title="SelectiveCPSTransform.this.global.gen.global.Tree">funR</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.gen.global.Type">tpe</a><span class="delimiter">)</span>
            <a href="../../reflect/internal/Trees.scala.html#413581" title="(fun: SelectiveCPSTransform.this.global.Tree, args: List[SelectiveCPSTransform.this.global.Tree])SelectiveCPSTransform.this.global.Apply">Apply</a><span class="delimiter">(</span>
                <a href="../../reflect/internal/Trees.scala.html#453869" title="(fun: SelectiveCPSTransform.this.global.Tree, args: List[SelectiveCPSTransform.this.global.Tree])SelectiveCPSTransform.this.global.TypeApply">TypeApply</a><span class="delimiter">(</span><a href="#1216299" title="SelectiveCPSTransform.this.global.gen.global.Tree">funR</a>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.Tree*)List[SelectiveCPSTransform.this.global.Tree]">List</a><span class="delimiter">(</span><a href="../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)SelectiveCPSTransform.this.global.Tree">targs</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a href="../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)SelectiveCPSTransform.this.global.Tree">targs</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../reflect/internal/Trees.scala.html#408575" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.TypeApply">setType</a><span class="delimiter">(</span><a href="../../reflect/internal/Types.scala.html#407408" title="(tycon: SelectiveCPSTransform.this.global.Type, args: List[SelectiveCPSTransform.this.global.Type])SelectiveCPSTransform.this.global.Type">appliedType</a><span class="delimiter">(</span><a href="#1216299" title="SelectiveCPSTransform.this.global.gen.global.Tree">funR</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.gen.global.Type">tpe</a>,
                    <a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.Type*)List[SelectiveCPSTransform.this.global.Type]">List</a><span class="delimiter">(</span><a href="../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)SelectiveCPSTransform.this.global.Tree">targs</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a>, <a href="../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)SelectiveCPSTransform.this.global.Tree">targs</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>,
                <a href="#1216288" title="List[SelectiveCPSTransform.this.global.Tree]">args</a>.<a href="../../collection/TraversableLike.scala.html#58063" title="(f: SelectiveCPSTransform.this.global.Tree =&gt; SelectiveCPSTransform.this.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[SelectiveCPSTransform.this.global.Tree],SelectiveCPSTransform.this.global.Tree,List[SelectiveCPSTransform.this.global.Tree]])List[SelectiveCPSTransform.this.global.Tree]">map</a><a href="../../collection/immutable/List.scala.html#62442" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,SelectiveCPSTransform.this.global.Tree,List[SelectiveCPSTransform.this.global.Tree]]" class="delimiter">(</a><a href="#1215955" title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1216380" title="SelectiveCPSTransform.this.global.Tree">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">)</span>.<a href="../../reflect/internal/Trees.scala.html#408575" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Apply">setType</a><span class="delimiter">(</span><a href="../../reflect/internal/Types.scala.html#407408" title="(tycon: SelectiveCPSTransform.this.global.Type, args: List[SelectiveCPSTransform.this.global.Type])SelectiveCPSTransform.this.global.Type">appliedType</a><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211346" title="=&gt; SelectiveCPSTransform.this.global.ClassSymbol">Context</a>.<a href="../../reflect/internal/Symbols.scala.html#411559" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.Type*)List[SelectiveCPSTransform.this.global.Type]">List</a><span class="delimiter">(</span><a href="../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)SelectiveCPSTransform.this.global.Tree">targs</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a>,<a href="../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)SelectiveCPSTransform.this.global.Tree">targs</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a>,<a href="../../collection/LinearSeqOptimized.scala.html#86374" title="(n: Int)SelectiveCPSTransform.this.global.Tree">targs</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> Apply<span class="delimiter">(</span>TypeApply<a href="../../reflect/internal/Trees.scala.html#410031" title="SelectiveCPSTransform.this.global.Tree" id="3382421" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410043" title="SelectiveCPSTransform.this.global.Tree" id="1216466">fun</a>, <a href="../../reflect/internal/Trees.scala.html#410045" title="List[SelectiveCPSTransform.this.global.Tree]" id="1216467">targs</a><span class="delimiter">)</span>, <a href="../../reflect/internal/Trees.scala.html#410033" title="List[SelectiveCPSTransform.this.global.Tree]" id="1216468">args</a><span class="delimiter">)</span>
        <span class="keyword">if</span> <span class="delimiter">(</span><a href="#1216466" title="SelectiveCPSTransform.this.global.Tree">fun</a>.<a href="../../reflect/internal/Trees.scala.html#408577" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="CPSUtils.scala.html#1211360" title="=&gt; SelectiveCPSTransform.this.global.Symbol">MethReify</a><span class="delimiter">)</span> =&gt;
          <a href="../nsc/Global.scala.html#537516" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;found reify: &quot;)" class="string">&quot;found reify: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a><span class="delimiter">)</span>
          <a href="../../reflect/internal/Positions.scala.html#408315" title="(pos: SelectiveCPSTransform.this.global.Position)(tree: SelectiveCPSTransform.this.global.Apply)SelectiveCPSTransform.this.global.Apply">atPos</a><span class="delimiter">(</span><a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408571" title="=&gt; SelectiveCPSTransform.this.global.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.gen.global.Tree" id="1216479">funR</a> = <a href="../nsc/Global.scala.html#537460" title="SelectiveCPSTransform.this.global.gen.type">gen</a>.<a href="../../reflect/internal/TreeGen.scala.html#470989" title="(sym: SelectiveCPSTransform.this.global.gen.global.Symbol)SelectiveCPSTransform.this.global.gen.global.Tree">mkAttributedRef</a><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211362" title="=&gt; SelectiveCPSTransform.this.global.Symbol">MethReifyR</a><span class="delimiter">)</span> // TODO: correct?
            <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;funR.tpe = &quot;)" class="string">&quot;funR.tpe = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1216479" title="SelectiveCPSTransform.this.global.gen.global.Tree">funR</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.gen.global.Type">tpe</a><span class="delimiter">)</span>
            <a href="../../reflect/internal/Trees.scala.html#413581" title="(fun: SelectiveCPSTransform.this.global.Tree, args: List[SelectiveCPSTransform.this.global.Tree])SelectiveCPSTransform.this.global.Apply">Apply</a><span class="delimiter">(</span>
                <a href="../../reflect/internal/Trees.scala.html#453869" title="(fun: SelectiveCPSTransform.this.global.Tree, args: List[SelectiveCPSTransform.this.global.Tree])SelectiveCPSTransform.this.global.TypeApply">TypeApply</a><span class="delimiter">(</span><a href="#1216479" title="SelectiveCPSTransform.this.global.gen.global.Tree">funR</a>, <a href="#1216467" title="List[SelectiveCPSTransform.this.global.Tree]">targs</a><span class="delimiter">)</span>.<a href="../../reflect/internal/Trees.scala.html#408575" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.TypeApply">setType</a><span class="delimiter">(</span><a href="../../reflect/internal/Types.scala.html#407408" title="(tycon: SelectiveCPSTransform.this.global.Type, args: List[SelectiveCPSTransform.this.global.Type])SelectiveCPSTransform.this.global.Type">appliedType</a><span class="delimiter">(</span><a href="#1216479" title="SelectiveCPSTransform.this.global.gen.global.Tree">funR</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.gen.global.Type">tpe</a>, <a href="#1216467" title="List[SelectiveCPSTransform.this.global.Tree]">targs</a>.<a href="../../collection/TraversableLike.scala.html#58063" title="(f: SelectiveCPSTransform.this.global.Tree =&gt; SelectiveCPSTransform.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[SelectiveCPSTransform.this.global.Tree],SelectiveCPSTransform.this.global.Type,List[SelectiveCPSTransform.this.global.Type]])List[SelectiveCPSTransform.this.global.Type]">map</a><a href="../../collection/immutable/List.scala.html#62442" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,SelectiveCPSTransform.this.global.Type,List[SelectiveCPSTransform.this.global.Type]]" class="delimiter">(</a><span class="delimiter">(</span>t:<a href="../../reflect/internal/Trees.scala.html#407938" title="SelectiveCPSTransform.this.global.Tree">Tree</a><span class="delimiter">)</span> =&gt; <a href="#1216516" title="SelectiveCPSTransform.this.global.Tree">t</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>,
                <a href="#1216468" title="List[SelectiveCPSTransform.this.global.Tree]">args</a>.<a href="../../collection/TraversableLike.scala.html#58063" title="(f: SelectiveCPSTransform.this.global.Tree =&gt; SelectiveCPSTransform.this.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[SelectiveCPSTransform.this.global.Tree],SelectiveCPSTransform.this.global.Tree,List[SelectiveCPSTransform.this.global.Tree]])List[SelectiveCPSTransform.this.global.Tree]">map</a><a href="../../collection/immutable/List.scala.html#62442" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,SelectiveCPSTransform.this.global.Tree,List[SelectiveCPSTransform.this.global.Tree]]" class="delimiter">(</a><a href="#1215955" title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1216561" title="SelectiveCPSTransform.this.global.Tree">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">)</span>.<a href="../../reflect/internal/Trees.scala.html#408575" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Apply">setType</a><span class="delimiter">(</span><a href="#1215849" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type">transformCPSType</a><span class="delimiter">(</span><a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>

      <span class="keyword">case</span> Try<a href="#3382406" title="SelectiveCPSTransform.this.global.Tree" id="3382423" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410079" title="SelectiveCPSTransform.this.global.Tree" id="1216615">block</a>, <a href="../../reflect/internal/Trees.scala.html#410081" title="List[SelectiveCPSTransform.this.global.CaseDef]" id="1216616">catches</a>, <a href="../../reflect/internal/Trees.scala.html#410083" title="SelectiveCPSTransform.this.global.Tree" id="1216617">finalizer</a><span class="delimiter">)</span> =&gt;
        // currently duplicates the catch block into a partial function.
        // this is kinda risky, but we don't expect there will be lots
        // of try/catches inside catch blocks (exp. blowup unlikely).

        // CAVEAT: finalizers are surprisingly tricky!
        // the problem is that they cannot easily be removed
        // from the regular control path and hence will
        // also be invoked after creating the Context object.

        /*
        object Test {
          def foo1 = {
            throw new Exception(&quot;in sub&quot;)
            shift((k:Int=&gt;Int) =&gt; k(1))
            10
          }
          def foo2 = {
            shift((k:Int=&gt;Int) =&gt; k(2))
            20
          }
          def foo3 = {
            shift((k:Int=&gt;Int) =&gt; k(3))
            throw new Exception(&quot;in sub&quot;)
            30
          }
          def foo4 = {
            shift((k:Int=&gt;Int) =&gt; 4)
            throw new Exception(&quot;in sub&quot;)
            40
          }
          def bar(x: Int) = try {
            if (x == 1)
              foo1
            else if (x == 2)
              foo2
            else if (x == 3)
              foo3
            else //if (x == 4)
              foo4
          } catch {
            case _ =&gt;
              println(&quot;exception&quot;)
              0
          } finally {
            println(&quot;done&quot;)
          }
        }

        reset(Test.bar(1)) // should print: exception,done,0
        reset(Test.bar(2)) // should print: done,20 &lt;-- but prints: done,done,20
        reset(Test.bar(3)) // should print: exception,done,0 &lt;-- but prints: done,exception,done,0
        reset(Test.bar(4)) // should print: 4 &lt;-- but prints: done,4
        */

        <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.Tree" id="1216618">block1</a> = <a href="#1215955" title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1216615" title="SelectiveCPSTransform.this.global.Tree">block</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="List[SelectiveCPSTransform.this.global.CaseDef]" id="1216619">catches1</a> = <a href="../../reflect/api/Trees.scala.html#405659" title="(trees: List[SelectiveCPSTransform.this.global.CaseDef])List[SelectiveCPSTransform.this.global.CaseDef]">transformCaseDefs</a><span class="delimiter">(</span><a href="#1216616" title="List[SelectiveCPSTransform.this.global.CaseDef]">catches</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.Tree" id="1216620">finalizer1</a> = <a href="#1215955" title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1216617" title="SelectiveCPSTransform.this.global.Tree">finalizer</a><span class="delimiter">)</span>

        <span title="SelectiveCPSTransform.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="CPSUtils.scala.html#1211385" title="(tp: SelectiveCPSTransform.this.global.Type)Boolean">hasAnswerTypeAnn</a><span class="delimiter">(</span><a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          //vprintln(&quot;CPS Transform: &quot; + tree + &quot;/&quot; + tree.tpe + &quot;/&quot; + block1.tpe)

          <span class="keyword">val</span> <a href="#3382396" title="(x: (List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree))(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" class="delimiter">(</a><a href="../../Tuple2.scala.html#60635" title="List[SelectiveCPSTransform.this.global.Tree]" id="1216624">stms</a>, <a href="../../Tuple2.scala.html#60637" title="SelectiveCPSTransform.this.global.Tree" id="1216625">expr1</a><span class="delimiter">)</span> = <a href="#1216618" title="SelectiveCPSTransform.this.global.Tree">block1</a> <a href="../../Tuple2.scala.html#783" title="(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree) @unchecked" class="keyword">match</a> <span class="delimiter">{</span>
            <span class="keyword">case</span> Block<a href="#3382385" title="(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" id="3382387" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410192" title="List[SelectiveCPSTransform.this.global.Tree]" id="1216641">stms</a>, <a href="../../reflect/internal/Trees.scala.html#410194" title="SelectiveCPSTransform.this.global.Tree" id="1216642">expr</a><span class="delimiter">)</span> =&gt; <a href="#3382389" title="(x: (List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree))(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" class="delimiter">(</a><a href="#1216641" title="List[SelectiveCPSTransform.this.global.Tree]">stms</a>, <a href="#1216642" title="SelectiveCPSTransform.this.global.Tree">expr</a><span class="delimiter">)</span>
            <span class="keyword">case</span> expr =&gt; <a href="#3382389" title="(x: (List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree))(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" class="delimiter">(</a><a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a>, expr<span class="delimiter">)</span>
          <span class="delimiter">}</span>

          <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.Type" id="1216626">targettp</a> = <a href="#1215849" title="(tp: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.Type">transformCPSType</a><span class="delimiter">(</span><a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.Position" id="1216627">pos</a> = <a href="#1216616" title="List[SelectiveCPSTransform.this.global.CaseDef]">catches</a>.<a href="../../collection/IterableLike.scala.html#58577" title="=&gt; SelectiveCPSTransform.this.global.CaseDef">head</a>.<a href="../../reflect/internal/Trees.scala.html#408571" title="=&gt; SelectiveCPSTransform.this.global.Position">pos</a>
          <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.TermSymbol" id="1216628">funSym</a> = <a href="../../reflect/api/Trees.scala.html#405647" title="SelectiveCPSTransform.this.global.Symbol" id="1216675">currentOwner</a>.<a href="../../reflect/internal/Symbols.scala.html#472420" title="Long" id="1216681">newValueParameter</a><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211334" title="SelectiveCPSTransform.this.cpsNames.type">cpsNames</a>.<a href="CPSUtils.scala.html#1212941" title="SelectiveCPSTransform.this.global.TermName" id="1216679">catches</a>, <a href="#1216627" title="SelectiveCPSTransform.this.global.Position" id="1216680">pos</a><span class="delimiter">)</span>.<a href="../../reflect/internal/Symbols.scala.html#411369" title="(info: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.TermSymbol">setInfo</a><span class="delimiter">(</span><a href="../../reflect/internal/Types.scala.html#407408" title="(tycon: SelectiveCPSTransform.this.global.Type, args: List[SelectiveCPSTransform.this.global.Type])SelectiveCPSTransform.this.global.Type">appliedType</a><span class="delimiter">(</span><a href="../../reflect/internal/Definitions.scala.html#408716" title="=&gt; SelectiveCPSTransform.this.global.ClassSymbol">PartialFunctionClass</a>.<a href="../../reflect/internal/Symbols.scala.html#411559" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.Type*)List[SelectiveCPSTransform.this.global.Type]">List</a><span class="delimiter">(</span><a href="../../reflect/internal/Definitions.scala.html#408712" title="=&gt; SelectiveCPSTransform.this.global.ClassSymbol">ThrowableClass</a>.<a href="../../reflect/internal/Symbols.scala.html#411559" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a>, <a href="#1216626" title="SelectiveCPSTransform.this.global.Type">targettp</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.analyzer.global.Tree" id="1216629">funDef</a> = <a href="../nsc/transform/TypingTransformers.scala.html#984456" title="=&gt; SelectiveCPSTransform.this.global.analyzer.Typer">localTyper</a>.<a href="../nsc/typechecker/Typers.scala.html#538703" title="(pos: SelectiveCPSTransform.this.global.analyzer.global.Position)(tree: SelectiveCPSTransform.this.global.analyzer.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree">typedPos</a><span class="delimiter">(</span><a href="#1216627" title="SelectiveCPSTransform.this.global.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="../../reflect/internal/Trees.scala.html#408102" title="(sym: SelectiveCPSTransform.this.global.Symbol, rhs: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#1216628" title="SelectiveCPSTransform.this.global.TermSymbol">funSym</a>, <a href="../../reflect/internal/Trees.scala.html#453592" title="(selector: SelectiveCPSTransform.this.global.Tree, cases: List[SelectiveCPSTransform.this.global.CaseDef])SelectiveCPSTransform.this.global.Match">Match</a><span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#407946" title="SelectiveCPSTransform.this.global.EmptyTree.type">EmptyTree</a>, <a href="#1216619" title="List[SelectiveCPSTransform.this.global.CaseDef]">catches1</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.analyzer.global.Tree" id="1216630">expr2</a> = <a href="../nsc/transform/TypingTransformers.scala.html#984456" title="=&gt; SelectiveCPSTransform.this.global.analyzer.Typer">localTyper</a>.<a href="../nsc/typechecker/Typers.scala.html#538703" title="(pos: SelectiveCPSTransform.this.global.analyzer.global.Position)(tree: SelectiveCPSTransform.this.global.analyzer.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree">typedPos</a><span class="delimiter">(</span><a href="#1216627" title="SelectiveCPSTransform.this.global.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="../../reflect/internal/Trees.scala.html#413581" title="(fun: SelectiveCPSTransform.this.global.Tree, args: List[SelectiveCPSTransform.this.global.Tree])SelectiveCPSTransform.this.global.Apply">Apply</a><span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#408125" title="(qualifier: SelectiveCPSTransform.this.global.Tree, sym: SelectiveCPSTransform.this.global.Symbol)SelectiveCPSTransform.this.global.Select">Select</a><span class="delimiter">(</span><a href="#1216625" title="SelectiveCPSTransform.this.global.Tree">expr1</a>, <a href="#1216625" title="SelectiveCPSTransform.this.global.Tree">expr1</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a>.<a href="../../reflect/internal/Types.scala.html#408451" title="(name: SelectiveCPSTransform.this.global.Name)SelectiveCPSTransform.this.global.Symbol">member</a><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211334" title="SelectiveCPSTransform.this.cpsNames.type">cpsNames</a>.<a href="CPSUtils.scala.html#1212945" title="=&gt; SelectiveCPSTransform.this.global.TermName">flatMapCatch</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.Ident*)List[SelectiveCPSTransform.this.global.Ident]">List</a><span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#408127" title="(sym: SelectiveCPSTransform.this.global.Symbol)SelectiveCPSTransform.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="#1216628" title="SelectiveCPSTransform.this.global.TermSymbol">funSym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>

          <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.TermSymbol" id="1216631">exSym</a> = <a href="../../reflect/api/Trees.scala.html#405647" title="SelectiveCPSTransform.this.global.Symbol" id="1216802">currentOwner</a>.<a href="../../reflect/internal/Symbols.scala.html#472420" title="Long" id="1216808">newValueParameter</a><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211334" title="SelectiveCPSTransform.this.cpsNames.type">cpsNames</a>.<a href="CPSUtils.scala.html#1212943" title="SelectiveCPSTransform.this.global.TermName" id="1216806">ex</a>, <a href="#1216627" title="SelectiveCPSTransform.this.global.Position" id="1216807">pos</a><span class="delimiter">)</span>.<a href="../../reflect/internal/Symbols.scala.html#411369" title="(info: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.TermSymbol">setInfo</a><span class="delimiter">(</span><a href="../../reflect/internal/Definitions.scala.html#408712" title="=&gt; SelectiveCPSTransform.this.global.ClassSymbol">ThrowableClass</a>.<a href="../../reflect/internal/Symbols.scala.html#411559" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span>

          <span class="keyword">import</span> <a href="../nsc/ast/TreeDSL.scala.html#538235" title="SelectiveCPSTransform.this.CODE.type">CODE</a>._
          // generate a case that is supported directly by the back-end
          <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.CaseDef" id="1216633">catchIfDefined</a> = <a href="../../reflect/internal/Trees.scala.html#453147" title="(pat: SelectiveCPSTransform.this.global.Tree, guard: SelectiveCPSTransform.this.global.Tree, body: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.CaseDef">CaseDef</a><span class="delimiter">(</span>
                <a href="../../reflect/internal/Trees.scala.html#408115" title="(sym: SelectiveCPSTransform.this.global.Symbol, body: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Bind">Bind</a><span class="delimiter">(</span><a href="#1216631" title="SelectiveCPSTransform.this.global.TermSymbol">exSym</a>, <a href="../../reflect/internal/Trees.scala.html#418125" title="(name: SelectiveCPSTransform.this.global.Name)SelectiveCPSTransform.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="../../reflect/internal/StdNames.scala.html#407871" title="SelectiveCPSTransform.this.global.nme.type">nme</a>.<a href="../../reflect/internal/StdNames.scala.html#413714" title="=&gt; SelectiveCPSTransform.this.global.nme.NameType">WILDCARD</a><span class="delimiter">)</span><span class="delimiter">)</span>,
                <a href="../../reflect/internal/Trees.scala.html#407946" title="SelectiveCPSTransform.this.global.EmptyTree.type">EmptyTree</a>,
                <a href="../nsc/ast/TreeDSL.scala.html#624605" title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.CODE.IfStart">IF</a> <span class="delimiter">(</span><span class="delimiter">(</span><a href="../nsc/ast/TreeDSL.scala.html#624612" title="(sym: SelectiveCPSTransform.this.global.Symbol)SelectiveCPSTransform.this.global.gen.global.Tree">REF</a><a href="../nsc/ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.CODE.TreeMethods" class="delimiter">(</a><a href="#1216628" title="SelectiveCPSTransform.this.global.TermSymbol">funSym</a><span class="delimiter">)</span> <a href="../nsc/ast/TreeDSL.scala.html#662306" title="(args: SelectiveCPSTransform.this.global.Tree*)SelectiveCPSTransform.this.global.Apply">DOT</a> <a href="../../reflect/internal/StdNames.scala.html#407871" title="SelectiveCPSTransform.this.global.nme.type">nme</a>.<a href="../../reflect/internal/StdNames.scala.html#414405" title="=&gt; SelectiveCPSTransform.this.global.nme.NameType">isDefinedAt</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../nsc/ast/TreeDSL.scala.html#624612" title="(sym: SelectiveCPSTransform.this.global.Symbol)SelectiveCPSTransform.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1216631" title="SelectiveCPSTransform.this.global.TermSymbol">exSym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../nsc/ast/TreeDSL.scala.html#662292" title="(x: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.CODE.IfStart">THEN</a> <span class="delimiter">(</span><a href="../nsc/ast/TreeDSL.scala.html#624612" title="(sym: SelectiveCPSTransform.this.global.Symbol)SelectiveCPSTransform.this.global.gen.global.Tree">REF</a><a href="../nsc/ast/TreeDSL.scala.html#624616" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.CODE.TreeMethods" class="delimiter">(</a><a href="#1216628" title="SelectiveCPSTransform.this.global.TermSymbol">funSym</a><span class="delimiter">)</span> <a href="../nsc/ast/TreeDSL.scala.html#662336" title="(params: SelectiveCPSTransform.this.global.Tree*)SelectiveCPSTransform.this.global.Apply">APPLY</a> <span class="delimiter">(</span><a href="../nsc/ast/TreeDSL.scala.html#624612" title="(sym: SelectiveCPSTransform.this.global.Symbol)SelectiveCPSTransform.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1216631" title="SelectiveCPSTransform.this.global.TermSymbol">exSym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../nsc/ast/TreeDSL.scala.html#662293" title="(elsep: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.If">ELSE</a> <a href="../../reflect/internal/Trees.scala.html#453782" title="(expr: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Throw">Throw</a><span class="delimiter">(</span><a href="../nsc/ast/TreeDSL.scala.html#624612" title="(sym: SelectiveCPSTransform.this.global.Symbol)SelectiveCPSTransform.this.global.gen.global.Tree">REF</a><span class="delimiter">(</span><a href="#1216631" title="SelectiveCPSTransform.this.global.TermSymbol">exSym</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="List[SelectiveCPSTransform.this.global.analyzer.global.CaseDef]" id="1216634">catch2</a> = <a href="../nsc/transform/TypingTransformers.scala.html#984456" title="=&gt; SelectiveCPSTransform.this.global.analyzer.Typer">localTyper</a>.<a href="../nsc/typechecker/Typers.scala.html#538654" title="(cases: List[SelectiveCPSTransform.this.global.analyzer.global.CaseDef], pattp: SelectiveCPSTransform.this.global.analyzer.global.Type, pt: SelectiveCPSTransform.this.global.analyzer.global.Type)List[SelectiveCPSTransform.this.global.analyzer.global.CaseDef]">typedCases</a><span class="delimiter">(</span><a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.CaseDef*)List[SelectiveCPSTransform.this.global.CaseDef]">List</a><span class="delimiter">(</span><a href="#1216633" title="SelectiveCPSTransform.this.global.CaseDef">catchIfDefined</a><span class="delimiter">)</span>, <a href="../../reflect/internal/Definitions.scala.html#408712" title="=&gt; SelectiveCPSTransform.this.global.ClassSymbol">ThrowableClass</a>.<a href="../../reflect/internal/Symbols.scala.html#411559" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a>, <a href="#1216626" title="SelectiveCPSTransform.this.global.Type">targettp</a><span class="delimiter">)</span>
          //typedCases(tree, catches, ThrowableClass.tpe, pt)

          <a href="#1215953" title="=&gt; SelectiveCPSTransform.this.global.patmat.global.Transformer">patmatTransformer</a>.<a href="../../reflect/api/Trees.scala.html#405652" title="(tree: SelectiveCPSTransform.this.global.patmat.global.Tree)SelectiveCPSTransform.this.global.patmat.global.Tree">transform</a><span class="delimiter">(</span><a href="../nsc/transform/TypingTransformers.scala.html#984456" title="=&gt; SelectiveCPSTransform.this.global.analyzer.Typer">localTyper</a>.<a href="../nsc/typechecker/Typers.scala.html#538701" title="(tree: SelectiveCPSTransform.this.global.analyzer.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#453067" title="(stats: List[SelectiveCPSTransform.this.global.Tree], expr: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Block">Block</a><span class="delimiter">(</span><a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.analyzer.global.Tree*)List[SelectiveCPSTransform.this.global.analyzer.global.Tree]">List</a><span class="delimiter">(</span><a href="#1216629" title="SelectiveCPSTransform.this.global.analyzer.global.Tree">funDef</a><span class="delimiter">)</span>, <a href="../../reflect/api/Trees.scala.html#405645" title="=&gt; SelectiveCPSTransform.this.global.TreeCopier">treeCopy</a>.<a href="../../reflect/api/Trees.scala.html#405392" title="(tree: SelectiveCPSTransform.this.global.Tree, block: SelectiveCPSTransform.this.global.Tree, catches: List[SelectiveCPSTransform.this.global.CaseDef], finalizer: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Try">Try</a><span class="delimiter">(</span><a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a>, <a href="../../reflect/api/Trees.scala.html#405645" title="=&gt; SelectiveCPSTransform.this.global.TreeCopier">treeCopy</a>.<a href="../../reflect/api/Trees.scala.html#405380" title="(tree: SelectiveCPSTransform.this.global.Tree, stats: List[SelectiveCPSTransform.this.global.Tree], expr: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Block">Block</a><span class="delimiter">(</span><a href="#1216618" title="SelectiveCPSTransform.this.global.Tree">block1</a>, <a href="#1216624" title="List[SelectiveCPSTransform.this.global.Tree]">stms</a>, <a href="#1216630" title="SelectiveCPSTransform.this.global.analyzer.global.Tree">expr2</a><span class="delimiter">)</span>, <a href="#1216634" title="List[SelectiveCPSTransform.this.global.analyzer.global.CaseDef]">catch2</a>, <a href="#1216620" title="SelectiveCPSTransform.this.global.Tree">finalizer1</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>


/*
          disabled for now - see notes above

          val expr3 = if (!finalizer.isEmpty) {
            val pos = finalizer.pos
            val finalizer2 = duplicateTree(finalizer1)
            val fun = Function(List(), finalizer2)
            val expr3 = localTyper.typedPos(pos) { Apply(Select(expr2, expr2.tpe.member(&quot;mapFinally&quot;)), List(fun)) }

            val chown = new ChangeOwnerTraverser(currentOwner, fun.symbol)
            chown.traverse(finalizer2)

            expr3
          } else
            expr2
*/
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="../../reflect/api/Trees.scala.html#405645" title="=&gt; SelectiveCPSTransform.this.global.TreeCopier">treeCopy</a>.<a href="../../reflect/api/Trees.scala.html#405392" title="(tree: SelectiveCPSTransform.this.global.Tree, block: SelectiveCPSTransform.this.global.Tree, catches: List[SelectiveCPSTransform.this.global.CaseDef], finalizer: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Try">Try</a><span class="delimiter">(</span><a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a>, <a href="#1216618" title="SelectiveCPSTransform.this.global.Tree">block1</a>, <a href="#1216619" title="List[SelectiveCPSTransform.this.global.CaseDef]">catches1</a>, <a href="#1216620" title="SelectiveCPSTransform.this.global.Tree">finalizer1</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      <span class="keyword">case</span> Block<a href="#3382406" title="SelectiveCPSTransform.this.global.Tree" id="3382425" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410192" title="List[SelectiveCPSTransform.this.global.Tree]" id="1216981">stms</a>, <a href="../../reflect/internal/Trees.scala.html#410194" title="SelectiveCPSTransform.this.global.Tree" id="1216982">expr</a><span class="delimiter">)</span> =&gt;

          <span class="keyword">val</span> <a href="#3382402" title="(x: (List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree))(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" class="delimiter">(</a><a href="../../Tuple2.scala.html#60635" title="List[SelectiveCPSTransform.this.global.Tree]" id="1216984">stms1</a>, <a href="../../Tuple2.scala.html#60637" title="SelectiveCPSTransform.this.global.Tree" id="1216985">expr1</a><span class="delimiter">)</span> = <a href="#1215958" title="(stms: List[SelectiveCPSTransform.this.global.Tree], expr: SelectiveCPSTransform.this.global.Tree)(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)">transBlock</a><a href="../../Tuple2.scala.html#783" title="(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree) @unchecked" class="delimiter">(</a><a href="#1216981" title="List[SelectiveCPSTransform.this.global.Tree]">stms</a>, <a href="#1216982" title="SelectiveCPSTransform.this.global.Tree">expr</a><span class="delimiter">)</span>
          <a href="../../reflect/api/Trees.scala.html#405645" title="=&gt; SelectiveCPSTransform.this.global.TreeCopier">treeCopy</a>.<a href="../../reflect/api/Trees.scala.html#405380" title="(tree: SelectiveCPSTransform.this.global.Tree, stats: List[SelectiveCPSTransform.this.global.Tree], expr: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Block">Block</a><span class="delimiter">(</span><a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a>, <a href="#1216984" title="List[SelectiveCPSTransform.this.global.Tree]">stms1</a>, <a href="#1216985" title="SelectiveCPSTransform.this.global.Tree">expr1</a><span class="delimiter">)</span>

        <span class="keyword">case</span> _ =&gt;
          <a href="#1215850" title="SelectiveCPSTransform.this.CPSTransformer" class="keyword">super</a>.<a href="../nsc/transform/TypingTransformers.scala.html#984469" title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">transform</a><a href="#3382428" title="(x: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree" class="delimiter">(</a><a href="#1216103" title="SelectiveCPSTransform.this.global.Tree">tree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>



    <span class="keyword">def</span> <a title="(stms: List[SelectiveCPSTransform.this.global.Tree], expr: SelectiveCPSTransform.this.global.Tree)(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" id="1215958">transBlock</a><span class="delimiter">(</span><a title="List[SelectiveCPSTransform.this.global.Tree]" id="1216986">stms</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[SelectiveCPSTransform.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span>, <a title="SelectiveCPSTransform.this.global.Tree" id="1216987">expr</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="SelectiveCPSTransform.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../Tuple2.scala.html#783" title="(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" class="delimiter">(</a>List<span class="delimiter">[</span>Tree<span class="delimiter">]</span>, Tree<span class="delimiter">)</span> = <span class="delimiter">{</span>

      <a href="#1216986" title="List[SelectiveCPSTransform.this.global.Tree]">stms</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="../../collection/immutable/List.scala.html#11188" title="(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" id="3382470">Nil</a> =&gt;
          <a href="#3382472" title="(x: (List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree))(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" class="delimiter">(</a><a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a>, <a href="#1215955" title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1216987" title="SelectiveCPSTransform.this.global.Tree">expr</a><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <a href="../../collection/immutable/List.scala.html#206583" title="SelectiveCPSTransform.this.global.Tree" id="1217010">stm</a><a href="#3382467" title="(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" id="3382469">::</a><a href="../../collection/immutable/List.scala.html#206584" title="List[SelectiveCPSTransform.this.global.Tree]" id="1217011">rest</a> =&gt;

          <a href="#3382472" title="(x: (List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree))(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)">stm</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> vd @ ValDef<a href="#3382458" title="(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" id="3382460" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410298" title="SelectiveCPSTransform.this.global.Modifiers" id="1217019">mods</a>, <a href="../../reflect/internal/Trees.scala.html#410300" title="SelectiveCPSTransform.this.global.TermName" id="1217020">name</a>, <a href="../../reflect/internal/Trees.scala.html#410302" title="SelectiveCPSTransform.this.global.Tree" id="1217021">tpt</a>, <a href="../../reflect/internal/Trees.scala.html#410304" title="SelectiveCPSTransform.this.global.Tree" id="1217022">rhs</a><span class="delimiter">)</span>
            <span class="keyword">if</span> <span class="delimiter">(</span>vd.<a href="../../reflect/internal/Trees.scala.html#409939" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a>.<a href="../../reflect/internal/AnnotationInfos.scala.html#408615" title="(cls: SelectiveCPSTransform.this.global.Symbol)Boolean">hasAnnotation</a><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211336" title="=&gt; SelectiveCPSTransform.this.global.ClassSymbol">MarkerCPSSym</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;

              <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;found marked ValDef &quot;)" class="string">&quot;found marked ValDef &quot;</span><span title="(x$1: Any)String">+</span><a href="#1217020" title="SelectiveCPSTransform.this.global.TermName">name</a><span title="(x$1: Any)String">+</span><span title="String(&quot; of type &quot;)" class="string">&quot; of type &quot;</span> <span title="(x$1: Any)String">+</span> vd.<a href="../../reflect/internal/Trees.scala.html#409939" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a>.<a href="../../reflect/internal/Symbols.scala.html#411365" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span>

              <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.Type" id="1217024">tpe</a> = vd.<a href="../../reflect/internal/Trees.scala.html#409939" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a>.<a href="../../reflect/internal/Symbols.scala.html#411365" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a>
              <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.Tree" id="1217025">rhs1</a> = <a href="../nsc/transform/TypingTransformers.scala.html#984463" title="(owner: SelectiveCPSTransform.this.global.Symbol)(trans: =&gt; SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">atOwner</a><span class="delimiter">(</span>vd.<a href="../../reflect/internal/Trees.scala.html#409939" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#1215955" title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1217022" title="SelectiveCPSTransform.this.global.Tree">rhs</a><span class="delimiter">)</span> <span class="delimiter">}</span>
              <a href="#1217025" title="SelectiveCPSTransform.this.global.Tree">rhs1</a>.<a href="../../reflect/internal/Trees.scala.html#408563" title="(pairs: (SelectiveCPSTransform.this.global.Symbol, SelectiveCPSTransform.this.global.Symbol)*)SelectiveCPSTransform.this.global.Tree">changeOwner</a><span class="delimiter">(</span>vd.<a href="../../Predef.scala.html#7509" title="(x: SelectiveCPSTransform.this.global.Symbol)ArrowAssoc[SelectiveCPSTransform.this.global.Symbol]">symbol</a> <a href="../../Predef.scala.html#62634" title="(y: SelectiveCPSTransform.this.global.Symbol)(SelectiveCPSTransform.this.global.Symbol, SelectiveCPSTransform.this.global.Symbol)">-&gt;</a> <a href="../../reflect/api/Trees.scala.html#405647" title="=&gt; SelectiveCPSTransform.this.global.Symbol">currentOwner</a><span class="delimiter">)</span> // TODO: don't traverse twice

              <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;valdef symbol &quot;)" class="string">&quot;valdef symbol &quot;</span> <span title="(x$1: Any)String">+</span> vd.<a href="../../reflect/internal/Trees.scala.html#409939" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; has type &quot;)" class="string">&quot; has type &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1217024" title="SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span>
              <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;right hand side &quot;)" class="string">&quot;right hand side &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1217025" title="SelectiveCPSTransform.this.global.Tree">rhs1</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; has type &quot;)" class="string">&quot; has type &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1217025" title="SelectiveCPSTransform.this.global.Tree">rhs1</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span>

              <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;currentOwner: &quot;)" class="string">&quot;currentOwner: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../reflect/api/Trees.scala.html#405647" title="=&gt; SelectiveCPSTransform.this.global.Symbol">currentOwner</a><span class="delimiter">)</span>
              <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;currentMethod: &quot;)" class="string">&quot;currentMethod: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../reflect/api/Trees.scala.html#405650" title="=&gt; SelectiveCPSTransform.this.global.Symbol">currentMethod</a><span class="delimiter">)</span>

              <span class="keyword">val</span> <a href="#3382439" title="(x: (List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree))(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" class="delimiter">(</a><a href="../../Tuple2.scala.html#60635" title="List[SelectiveCPSTransform.this.global.Tree]" id="1217027">bodyStms</a>, <a href="../../Tuple2.scala.html#60637" title="SelectiveCPSTransform.this.global.Tree" id="1217028">bodyExpr</a><span class="delimiter">)</span> = <a href="#1215958" title="(stms: List[SelectiveCPSTransform.this.global.Tree], expr: SelectiveCPSTransform.this.global.Tree)(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)">transBlock</a><a href="../../Tuple2.scala.html#783" title="(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree) @unchecked" class="delimiter">(</a><a href="#1217011" title="List[SelectiveCPSTransform.this.global.Tree]">rest</a>, <a href="#1216987" title="SelectiveCPSTransform.this.global.Tree">expr</a><span class="delimiter">)</span>
              // FIXME: result will later be traversed again by TreeSymSubstituter and
              // ChangeOwnerTraverser =&gt; exp. running time.
              // Should be changed to fuse traversals into one.

              <span class="keyword">val</span> <a title="Boolean" id="1217029">specialCaseTrivial</a> = <a href="#1217028" title="SelectiveCPSTransform.this.global.Tree">bodyExpr</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> Apply<a href="#3382443" title="Boolean" id="3382445" class="delimiter">(</a><a href="../../reflect/internal/Trees.scala.html#410031" title="SelectiveCPSTransform.this.global.Tree" id="1217087">fun</a>, <a href="../../reflect/internal/Trees.scala.html#410033" title="List[SelectiveCPSTransform.this.global.Tree]" id="1217088">args</a><span class="delimiter">)</span> =&gt;
                  // for now, look for explicit tail calls only.
                  // are there other cases that could profit from specializing on
                  // trivial contexts as well?
                  <span class="delimiter">(</span><a href="#1217028" title="SelectiveCPSTransform.this.global.Tree">bodyExpr</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a>.<a href="../../reflect/internal/Types.scala.html#408407" title="=&gt; SelectiveCPSTransform.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="CPSUtils.scala.html#1211346" title="=&gt; SelectiveCPSTransform.this.global.ClassSymbol">Context</a><span class="delimiter">)</span> <a href="#3382447" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="../../reflect/api/Trees.scala.html#405650" title="=&gt; SelectiveCPSTransform.this.global.Symbol">currentMethod</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1217087" title="SelectiveCPSTransform.this.global.Tree">fun</a>.<a href="../../reflect/internal/Trees.scala.html#408577" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a><span class="delimiter">)</span>
                <span class="keyword">case</span> _ =&gt; <a href="#3382447" title="(x: Boolean)Boolean" class="keyword">false</a>
              <span class="delimiter">}</span>

              <span class="keyword">def</span> <a title="(ctxValSym: SelectiveCPSTransform.this.global.Symbol, body: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree" id="1217030">applyTrivial</a><span class="delimiter">(</span><a title="SelectiveCPSTransform.this.global.Symbol" id="1217100">ctxValSym</a>: <a href="../../reflect/internal/Symbols.scala.html#407146" title="SelectiveCPSTransform.this.global.Symbol">Symbol</a>, <a title="SelectiveCPSTransform.this.global.Tree" id="1217101">body</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="SelectiveCPSTransform.this.global.Tree">Tree</a><span class="delimiter">)</span> = <span class="delimiter">{</span>

                <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.Tree" id="1217102">body1</a> = <span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#481162" title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree" class="keyword">new</a> <a href="../../reflect/internal/Trees.scala.html#408145" title="SelectiveCPSTransform.this.global.TreeSymSubstituter">TreeSymSubstituter</a><span class="delimiter">(</span><a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.Symbol*)List[SelectiveCPSTransform.this.global.Symbol]">List</a><span class="delimiter">(</span>vd.<a href="../../reflect/internal/Trees.scala.html#409939" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.Symbol*)List[SelectiveCPSTransform.this.global.Symbol]">List</a><span class="delimiter">(</span><a href="#1217100" title="SelectiveCPSTransform.this.global.Symbol">ctxValSym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1217101" title="SelectiveCPSTransform.this.global.Tree">body</a><span class="delimiter">)</span>

                <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.analyzer.global.Tree" id="1217103">body2</a> = <a href="../nsc/transform/TypingTransformers.scala.html#984456" title="=&gt; SelectiveCPSTransform.this.global.analyzer.Typer">localTyper</a>.<a href="../nsc/typechecker/Typers.scala.html#538703" title="(pos: SelectiveCPSTransform.this.global.analyzer.global.Position)(tree: SelectiveCPSTransform.this.global.analyzer.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree">typedPos</a><span class="delimiter">(</span>vd.<a href="../../reflect/internal/Trees.scala.html#409939" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a>.<a href="../../reflect/internal/StdAttachments.scala.html#409602" title="=&gt; SelectiveCPSTransform.this.global.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#1217102" title="SelectiveCPSTransform.this.global.Tree">body1</a> <span class="delimiter">}</span>

                // in theory it would be nicer to look for an @cps annotation instead
                // of testing for Context
                <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#1217103" title="SelectiveCPSTransform.this.global.analyzer.global.Tree">body2</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><span class="delimiter">(</span><a href="#1217103" title="SelectiveCPSTransform.this.global.analyzer.global.Tree">body2</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Type">tpe</a>.<a href="../../reflect/internal/Types.scala.html#408407" title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="CPSUtils.scala.html#1211346" title="=&gt; SelectiveCPSTransform.this.global.ClassSymbol">Context</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  //println(body2 + &quot;/&quot; + body2.tpe)
                  <a href="#1215959" title="SelectiveCPSTransform.this.global.CompilationUnit">unit</a>.<a href="../nsc/CompilationUnits.scala.html#539298" title="(pos: SelectiveCPSTransform.this.global.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#1217022" title="SelectiveCPSTransform.this.global.Tree">rhs</a>.<a href="../../reflect/internal/Trees.scala.html#408571" title="=&gt; SelectiveCPSTransform.this.global.Position">pos</a>, <span title="String(&quot;cannot compute type for CPS-transformed function result&quot;)" class="string">&quot;cannot compute type for CPS-transformed function result&quot;</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
                <a href="#1217103" title="SelectiveCPSTransform.this.global.analyzer.global.Tree">body2</a>
              <span class="delimiter">}</span>

              <span class="keyword">def</span> <a title="(ctxR: SelectiveCPSTransform.this.global.Tree, body: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree" id="1217031">applyCombinatorFun</a><span class="delimiter">(</span><a title="SelectiveCPSTransform.this.global.Tree" id="1217141">ctxR</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="SelectiveCPSTransform.this.global.Tree">Tree</a>, <a title="SelectiveCPSTransform.this.global.Tree" id="1217142">body</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="SelectiveCPSTransform.this.global.Tree">Tree</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.TermSymbol" id="1217143">arg</a> = <a href="../../reflect/api/Trees.scala.html#405647" title="SelectiveCPSTransform.this.global.Symbol" id="1217150">currentOwner</a>.<a href="../../reflect/internal/Symbols.scala.html#472420" title="Long" id="1217156">newValueParameter</a><span class="delimiter">(</span><a href="#1217020" title="SelectiveCPSTransform.this.global.TermName" id="1217154">name</a>, <a href="#1217141" title="SelectiveCPSTransform.this.global.Tree">ctxR</a>.<a href="../../reflect/internal/Trees.scala.html#408571" title="SelectiveCPSTransform.this.global.Position" id="1217155">pos</a><span class="delimiter">)</span>.<a href="../../reflect/internal/Symbols.scala.html#411369" title="(info: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.TermSymbol">setInfo</a><span class="delimiter">(</span><a href="#1217024" title="SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span>
                <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.Tree" id="1217144">body1</a> = <span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#481162" title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree" class="keyword">new</a> <a href="../../reflect/internal/Trees.scala.html#408145" title="SelectiveCPSTransform.this.global.TreeSymSubstituter">TreeSymSubstituter</a><span class="delimiter">(</span><a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.Symbol*)List[SelectiveCPSTransform.this.global.Symbol]">List</a><span class="delimiter">(</span>vd.<a href="../../reflect/internal/Trees.scala.html#409939" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.TermSymbol*)List[SelectiveCPSTransform.this.global.TermSymbol]">List</a><span class="delimiter">(</span><a href="#1217143" title="SelectiveCPSTransform.this.global.TermSymbol">arg</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1217142" title="SelectiveCPSTransform.this.global.Tree">body</a><span class="delimiter">)</span>
                <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.analyzer.global.Tree" id="1217145">fun</a> = <a href="../nsc/transform/TypingTransformers.scala.html#984456" title="=&gt; SelectiveCPSTransform.this.global.analyzer.Typer">localTyper</a>.<a href="../nsc/typechecker/Typers.scala.html#538703" title="(pos: SelectiveCPSTransform.this.global.analyzer.global.Position)(tree: SelectiveCPSTransform.this.global.analyzer.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree">typedPos</a><span class="delimiter">(</span>vd.<a href="../../reflect/internal/Trees.scala.html#409939" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a>.<a href="../../reflect/internal/StdAttachments.scala.html#409602" title="=&gt; SelectiveCPSTransform.this.global.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="../../reflect/internal/Trees.scala.html#453438" title="(vparams: List[SelectiveCPSTransform.this.global.ValDef], body: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Function">Function</a><span class="delimiter">(</span><a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.ValDef*)List[SelectiveCPSTransform.this.global.ValDef]">List</a><span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#408103" title="(sym: SelectiveCPSTransform.this.global.Symbol)SelectiveCPSTransform.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#1217143" title="SelectiveCPSTransform.this.global.TermSymbol">arg</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#1217144" title="SelectiveCPSTransform.this.global.Tree">body1</a><span class="delimiter">)</span> <span class="delimiter">}</span> // types body as well
                <a href="#1217143" title="SelectiveCPSTransform.this.global.TermSymbol">arg</a>.<a href="../../reflect/internal/Symbols.scala.html#411316" title="(owner: SelectiveCPSTransform.this.global.Symbol)Unit">owner</a> = <a href="#1217145" title="SelectiveCPSTransform.this.global.analyzer.global.Tree">fun</a>.<a href="../../reflect/internal/Trees.scala.html#408577" title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Symbol">symbol</a>
                <a href="#1217144" title="SelectiveCPSTransform.this.global.Tree">body1</a>.<a href="../../reflect/internal/Trees.scala.html#408563" title="(pairs: (SelectiveCPSTransform.this.global.Symbol, SelectiveCPSTransform.this.global.Symbol)*)SelectiveCPSTransform.this.global.Tree">changeOwner</a><span class="delimiter">(</span><a href="../../Predef.scala.html#7509" title="(x: SelectiveCPSTransform.this.global.Symbol)ArrowAssoc[SelectiveCPSTransform.this.global.Symbol]">currentOwner</a> <a href="../../Predef.scala.html#62634" title="(y: SelectiveCPSTransform.this.global.analyzer.global.Symbol)(SelectiveCPSTransform.this.global.Symbol, SelectiveCPSTransform.this.global.analyzer.global.Symbol)">-&gt;</a> <a href="#1217145" title="SelectiveCPSTransform.this.global.analyzer.global.Tree">fun</a>.<a href="../../reflect/internal/Trees.scala.html#408577" title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Symbol">symbol</a><span class="delimiter">)</span>

                // see note about multiple traversals above

                <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;fun.symbol: &quot;)" class="string">&quot;fun.symbol: &quot;</span><span title="(x$1: Any)String">+</span><a href="#1217145" title="SelectiveCPSTransform.this.global.analyzer.global.Tree">fun</a>.<a href="../../reflect/internal/Trees.scala.html#408577" title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Symbol">symbol</a><span class="delimiter">)</span>
                <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;fun.symbol.owner: &quot;)" class="string">&quot;fun.symbol.owner: &quot;</span><span title="(x$1: Any)String">+</span><a href="#1217145" title="SelectiveCPSTransform.this.global.analyzer.global.Tree">fun</a>.<a href="../../reflect/internal/Trees.scala.html#408577" title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Symbol">symbol</a>.<a href="../../reflect/internal/Symbols.scala.html#411315" title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Symbol">owner</a><span class="delimiter">)</span>
                <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;arg.owner: &quot;)" class="string">&quot;arg.owner: &quot;</span><span title="(x$1: Any)String">+</span><a href="#1217143" title="SelectiveCPSTransform.this.global.TermSymbol">arg</a>.<a href="../../reflect/internal/Symbols.scala.html#411315" title="=&gt; SelectiveCPSTransform.this.global.Symbol">owner</a><span class="delimiter">)</span>

                <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;fun.tpe:&quot;)" class="string">&quot;fun.tpe:&quot;</span><span title="(x$1: Any)String">+</span><a href="#1217145" title="SelectiveCPSTransform.this.global.analyzer.global.Tree">fun</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Type">tpe</a><span class="delimiter">)</span>
                <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;return type of fun:&quot;)" class="string">&quot;return type of fun:&quot;</span><span title="(x$1: Any)String">+</span><a href="#1217144" title="SelectiveCPSTransform.this.global.Tree">body1</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span>

                <span class="keyword">var</span> <a title="SelectiveCPSTransform.this.global.nme.NameType" id="1217146">methodName</a> = <a href="../../reflect/internal/StdNames.scala.html#407871" title="SelectiveCPSTransform.this.global.nme.type">nme</a>.<a href="../../reflect/internal/StdNames.scala.html#414439" title="=&gt; SelectiveCPSTransform.this.global.nme.NameType">map</a>

                <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1217144" title="SelectiveCPSTransform.this.global.Tree">body1</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1217144" title="SelectiveCPSTransform.this.global.Tree">body1</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a>.<a href="../../reflect/internal/Types.scala.html#408407" title="=&gt; SelectiveCPSTransform.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="CPSUtils.scala.html#1211346" title="=&gt; SelectiveCPSTransform.this.global.ClassSymbol">Context</a><span class="delimiter">)</span>
                    <a href="#1217146" title="SelectiveCPSTransform.this.global.nme.NameType">methodName</a> = <a href="../../reflect/internal/StdNames.scala.html#407871" title="SelectiveCPSTransform.this.global.nme.type">nme</a>.<a href="../../reflect/internal/StdNames.scala.html#414375" title="=&gt; SelectiveCPSTransform.this.global.nme.NameType">flatMap</a>
                <span class="delimiter">}</span>
                <span class="keyword">else</span>
                  <a href="#1215959" title="SelectiveCPSTransform.this.global.CompilationUnit">unit</a>.<a href="../nsc/CompilationUnits.scala.html#539298" title="(pos: SelectiveCPSTransform.this.global.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#1217022" title="SelectiveCPSTransform.this.global.Tree">rhs</a>.<a href="../../reflect/internal/Trees.scala.html#408571" title="=&gt; SelectiveCPSTransform.this.global.Position">pos</a>, <span title="String(&quot;cannot compute type for CPS-transformed function result&quot;)" class="string">&quot;cannot compute type for CPS-transformed function result&quot;</span><span class="delimiter">)</span>

                <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;will use method:&quot;)" class="string">&quot;will use method:&quot;</span><span title="(x$1: Any)String">+</span><a href="#1217146" title="SelectiveCPSTransform.this.global.nme.NameType">methodName</a><span class="delimiter">)</span>

                <a href="../nsc/transform/TypingTransformers.scala.html#984456" title="=&gt; SelectiveCPSTransform.this.global.analyzer.Typer">localTyper</a>.<a href="../nsc/typechecker/Typers.scala.html#538703" title="(pos: SelectiveCPSTransform.this.global.analyzer.global.Position)(tree: SelectiveCPSTransform.this.global.analyzer.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree">typedPos</a><span class="delimiter">(</span>vd.<a href="../../reflect/internal/Trees.scala.html#409939" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a>.<a href="../../reflect/internal/StdAttachments.scala.html#409602" title="=&gt; SelectiveCPSTransform.this.global.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="../../reflect/internal/Trees.scala.html#413581" title="(fun: SelectiveCPSTransform.this.global.Tree, args: List[SelectiveCPSTransform.this.global.Tree])SelectiveCPSTransform.this.global.Apply">Apply</a><span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#408125" title="(qualifier: SelectiveCPSTransform.this.global.Tree, sym: SelectiveCPSTransform.this.global.Symbol)SelectiveCPSTransform.this.global.Select">Select</a><span class="delimiter">(</span><a href="#1217141" title="SelectiveCPSTransform.this.global.Tree">ctxR</a>, <a href="#1217141" title="SelectiveCPSTransform.this.global.Tree">ctxR</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a>.<a href="../../reflect/internal/Types.scala.html#408451" title="(name: SelectiveCPSTransform.this.global.Name)SelectiveCPSTransform.this.global.Symbol">member</a><span class="delimiter">(</span><a href="#1217146" title="SelectiveCPSTransform.this.global.nme.NameType">methodName</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.analyzer.global.Tree*)List[SelectiveCPSTransform.this.global.analyzer.global.Tree]">List</a><span class="delimiter">(</span><a href="#1217145" title="SelectiveCPSTransform.this.global.analyzer.global.Tree">fun</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>

              <span class="keyword">def</span> <a title="(stms: List[SelectiveCPSTransform.this.global.Tree], expr: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree" id="1217032">mkBlock</a><span class="delimiter">(</span><a title="List[SelectiveCPSTransform.this.global.Tree]" id="1217274">stms</a>: <a href="../../collection/immutable/List.scala.html#11952" title="List[SelectiveCPSTransform.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span>, <a title="SelectiveCPSTransform.this.global.Tree" id="1217275">expr</a>: <a href="../../reflect/internal/Trees.scala.html#407938" title="SelectiveCPSTransform.this.global.Tree">Tree</a><span class="delimiter">)</span> = <span title="SelectiveCPSTransform.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1217274" title="List[SelectiveCPSTransform.this.global.Tree]">stms</a>.<a href="../../collection/TraversableOnce.scala.html#58191" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <a href="../../reflect/internal/Trees.scala.html#453067" title="(stats: List[SelectiveCPSTransform.this.global.Tree], expr: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Block">Block</a><span class="delimiter">(</span><a href="#1217274" title="List[SelectiveCPSTransform.this.global.Tree]">stms</a>, <a href="#1217275" title="SelectiveCPSTransform.this.global.Tree">expr</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#1217275" title="SelectiveCPSTransform.this.global.Tree">expr</a>

              <span class="keyword">try</span> <span class="delimiter">{</span>
                <span title="(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" class="keyword">if</span> <span class="delimiter">(</span><a href="#1217029" title="Boolean">specialCaseTrivial</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="../nsc/Global.scala.html#537517" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;will optimize possible tail call: &quot;)" class="string">&quot;will optimize possible tail call: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1217028" title="SelectiveCPSTransform.this.global.Tree">bodyExpr</a><span class="delimiter">)</span>

                  // FIXME: flatMap impl has become more complicated due to
                  // exceptions. do we need to put a try/catch in the then part??

                  // val ctx = &lt;rhs&gt;
                  // if (ctx.isTrivial)
                  //   val &lt;lhs&gt; = ctx.getTrivialValue; ...    &lt;--- TODO: try/catch ??? don't bother for the moment...
                  // else
                  //   ctx.flatMap { &lt;lhs&gt; =&gt; ... }
                  <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.TermSymbol" id="1217292">ctxSym</a> = <a href="../../reflect/api/Trees.scala.html#405647" title="SelectiveCPSTransform.this.global.Symbol" id="1217305">currentOwner</a>.<a href="../../reflect/internal/Symbols.scala.html#424628" title="SelectiveCPSTransform.this.global.Position" id="1217318">newValue</a><span class="delimiter">(</span><a href="../../reflect/internal/Names.scala.html#406859" title="(s: String)SelectiveCPSTransform.this.global.TermName">newTermName</a><a title="SelectiveCPSTransform.this.global.TermName" id="1217316" class="delimiter">(</a><span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> <span title="(x$1: Any)String">+</span> vd.<a href="../../reflect/internal/Trees.scala.html#409939" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a>.<a href="../../reflect/internal/Symbols.scala.html#411087" title="=&gt; SelectiveCPSTransform.this.global.Symbol#NameType">name</a> <span title="(x$1: Any)String">+</span> <a href="CPSUtils.scala.html#1211334" title="SelectiveCPSTransform.this.cpsNames.type">cpsNames</a>.<a href="CPSUtils.scala.html#1212959" title="=&gt; SelectiveCPSTransform.this.global.TermName">shiftSuffix</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../reflect/internal/Symbols.scala.html#411369" title="(info: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.TermSymbol">setInfo</a><span class="delimiter">(</span><a href="#1217025" title="SelectiveCPSTransform.this.global.Tree">rhs1</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span>
                  <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.analyzer.global.Tree" id="1217293">ctxDef</a> = <a href="../nsc/transform/TypingTransformers.scala.html#984456" title="=&gt; SelectiveCPSTransform.this.global.analyzer.Typer">localTyper</a>.<a href="../nsc/typechecker/Typers.scala.html#538701" title="(tree: SelectiveCPSTransform.this.global.analyzer.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#408102" title="(sym: SelectiveCPSTransform.this.global.Symbol, rhs: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#1217292" title="SelectiveCPSTransform.this.global.TermSymbol">ctxSym</a>, <a href="#1217025" title="SelectiveCPSTransform.this.global.Tree">rhs1</a><span class="delimiter">)</span><span class="delimiter">)</span>
                  <span class="keyword">def</span> <a title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Tree" id="1217294">ctxRef</a> = <a href="../nsc/transform/TypingTransformers.scala.html#984456" title="=&gt; SelectiveCPSTransform.this.global.analyzer.Typer">localTyper</a>.<a href="../nsc/typechecker/Typers.scala.html#538701" title="(tree: SelectiveCPSTransform.this.global.analyzer.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#408127" title="(sym: SelectiveCPSTransform.this.global.Symbol)SelectiveCPSTransform.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="#1217292" title="SelectiveCPSTransform.this.global.TermSymbol">ctxSym</a><span class="delimiter">)</span><span class="delimiter">)</span>
                  <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.TermSymbol" id="1217295">argSym</a> = <a href="../../reflect/api/Trees.scala.html#405647" title="SelectiveCPSTransform.this.global.Symbol" id="1217347">currentOwner</a>.<a href="../../reflect/internal/Symbols.scala.html#424628" title="SelectiveCPSTransform.this.global.Position" id="1217356">newValue</a><span class="delimiter">(</span>vd.<a href="../../reflect/internal/Trees.scala.html#409939" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a>.<a href="../../reflect/internal/Names.scala.html#406832" title="SelectiveCPSTransform.this.global.TermName" id="1217354">name</a><span class="delimiter">)</span>.<a href="../../reflect/internal/Symbols.scala.html#411369" title="(info: SelectiveCPSTransform.this.global.Type)SelectiveCPSTransform.this.global.TermSymbol">setInfo</a><span class="delimiter">(</span><a href="#1217024" title="SelectiveCPSTransform.this.global.Type">tpe</a><span class="delimiter">)</span>
                  <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.analyzer.global.Tree" id="1217296">argDef</a> = <a href="../nsc/transform/TypingTransformers.scala.html#984456" title="=&gt; SelectiveCPSTransform.this.global.analyzer.Typer">localTyper</a>.<a href="../nsc/typechecker/Typers.scala.html#538701" title="(tree: SelectiveCPSTransform.this.global.analyzer.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#408102" title="(sym: SelectiveCPSTransform.this.global.Symbol, rhs: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#1217295" title="SelectiveCPSTransform.this.global.TermSymbol">argSym</a>, <a href="../../reflect/internal/Trees.scala.html#408125" title="(qualifier: SelectiveCPSTransform.this.global.Tree, sym: SelectiveCPSTransform.this.global.Symbol)SelectiveCPSTransform.this.global.Select">Select</a><span class="delimiter">(</span><a href="#1217294" title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Tree">ctxRef</a>, <a href="#1217294" title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Tree">ctxRef</a>.<a href="../../reflect/internal/Trees.scala.html#408573" title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Type">tpe</a>.<a href="../../reflect/internal/Types.scala.html#408451" title="(name: SelectiveCPSTransform.this.global.analyzer.global.Name)SelectiveCPSTransform.this.global.analyzer.global.Symbol">member</a><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211334" title="SelectiveCPSTransform.this.cpsNames.type">cpsNames</a>.<a href="CPSUtils.scala.html#1212947" title="=&gt; SelectiveCPSTransform.this.global.TermName">getTrivialValue</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                  <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.analyzer.global.Tree" id="1217297">switchExpr</a> = <a href="../nsc/transform/TypingTransformers.scala.html#984456" title="=&gt; SelectiveCPSTransform.this.global.analyzer.Typer">localTyper</a>.<a href="../nsc/typechecker/Typers.scala.html#538703" title="(pos: SelectiveCPSTransform.this.global.analyzer.global.Position)(tree: SelectiveCPSTransform.this.global.analyzer.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree">typedPos</a><span class="delimiter">(</span>vd.<a href="../../reflect/internal/Trees.scala.html#409939" title="=&gt; SelectiveCPSTransform.this.global.Symbol">symbol</a>.<a href="../../reflect/internal/StdAttachments.scala.html#409602" title="=&gt; SelectiveCPSTransform.this.global.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                    <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.Tree" id="1217393">body2</a> = <a href="#1217032" title="(stms: List[SelectiveCPSTransform.this.global.Tree], expr: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">mkBlock</a><span class="delimiter">(</span><a href="#1217027" title="List[SelectiveCPSTransform.this.global.Tree]">bodyStms</a>, <a href="#1217028" title="SelectiveCPSTransform.this.global.Tree">bodyExpr</a><span class="delimiter">)</span>.<a href="../../reflect/internal/Trees.scala.html#408588" title="=&gt; SelectiveCPSTransform.this.global.Tree">duplicate</a> // dup before typing!
                    <a href="../../reflect/internal/Trees.scala.html#453562" title="(cond: SelectiveCPSTransform.this.global.Tree, thenp: SelectiveCPSTransform.this.global.Tree, elsep: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.If">If</a><span class="delimiter">(</span><a href="../../reflect/internal/Trees.scala.html#408125" title="(qualifier: SelectiveCPSTransform.this.global.Tree, sym: SelectiveCPSTransform.this.global.Symbol)SelectiveCPSTransform.this.global.Select">Select</a><span class="delimiter">(</span><a href="#1217294" title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Tree">ctxRef</a>, <a href="#1217292" title="SelectiveCPSTransform.this.global.TermSymbol">ctxSym</a>.<a href="../../reflect/internal/Symbols.scala.html#411365" title="=&gt; SelectiveCPSTransform.this.global.Type">tpe</a>.<a href="../../reflect/internal/Types.scala.html#408451" title="(name: SelectiveCPSTransform.this.global.Name)SelectiveCPSTransform.this.global.Symbol">member</a><span class="delimiter">(</span><a href="CPSUtils.scala.html#1211334" title="SelectiveCPSTransform.this.cpsNames.type">cpsNames</a>.<a href="CPSUtils.scala.html#1212949" title="=&gt; SelectiveCPSTransform.this.global.TermName">isTrivial</a><span class="delimiter">)</span><span class="delimiter">)</span>,
                      <a href="#1217030" title="(ctxValSym: SelectiveCPSTransform.this.global.Symbol, body: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree">applyTrivial</a><span class="delimiter">(</span><a href="#1217295" title="SelectiveCPSTransform.this.global.TermSymbol">argSym</a>, <a href="#1217032" title="(stms: List[SelectiveCPSTransform.this.global.Tree], expr: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">mkBlock</a><span class="delimiter">(</span><a href="#1217296" title="SelectiveCPSTransform.this.global.analyzer.global.Tree">argDef</a><a href="../../collection/immutable/List.scala.html#62685" title="(x: SelectiveCPSTransform.this.global.Tree)List[SelectiveCPSTransform.this.global.Tree]">::</a><a href="#1217027" title="List[SelectiveCPSTransform.this.global.Tree]">bodyStms</a>, <a href="#1217028" title="SelectiveCPSTransform.this.global.Tree">bodyExpr</a><span class="delimiter">)</span><span class="delimiter">)</span>,
                      <a href="#1217031" title="(ctxR: SelectiveCPSTransform.this.global.Tree, body: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree">applyCombinatorFun</a><span class="delimiter">(</span><a href="#1217294" title="=&gt; SelectiveCPSTransform.this.global.analyzer.global.Tree">ctxRef</a>, <a href="#1217393" title="SelectiveCPSTransform.this.global.Tree">body2</a><span class="delimiter">)</span><span class="delimiter">)</span>
                  <span class="delimiter">}</span>
                  <a href="../../Tuple2.scala.html#62849" title="(_1: List[SelectiveCPSTransform.this.global.analyzer.global.Tree], _2: SelectiveCPSTransform.this.global.analyzer.global.Tree)(List[SelectiveCPSTransform.this.global.analyzer.global.Tree], SelectiveCPSTransform.this.global.analyzer.global.Tree)" class="delimiter">(</a><a href="../../collection/immutable/List.scala.html#62451" title="(xs: SelectiveCPSTransform.this.global.analyzer.global.Tree*)List[SelectiveCPSTransform.this.global.analyzer.global.Tree]">List</a><span class="delimiter">(</span><a href="#1217293" title="SelectiveCPSTransform.this.global.analyzer.global.Tree">ctxDef</a><span class="delimiter">)</span>, <a href="#1217297" title="SelectiveCPSTransform.this.global.analyzer.global.Tree">switchExpr</a><span class="delimiter">)</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                  // ctx.flatMap { &lt;lhs&gt; =&gt; ... }
                  //     or
                  // ctx.map { &lt;lhs&gt; =&gt; ... }
                  <a href="../../Tuple2.scala.html#62849" title="(_1: scala.collection.immutable.Nil.type, _2: SelectiveCPSTransform.this.global.analyzer.global.Tree)(scala.collection.immutable.Nil.type, SelectiveCPSTransform.this.global.analyzer.global.Tree)" class="delimiter">(</a><a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a>, <a href="#1217031" title="(ctxR: SelectiveCPSTransform.this.global.Tree, body: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.analyzer.global.Tree">applyCombinatorFun</a><span class="delimiter">(</span><a href="#1217025" title="SelectiveCPSTransform.this.global.Tree">rhs1</a>, <a href="#1217032" title="(stms: List[SelectiveCPSTransform.this.global.Tree], expr: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">mkBlock</a><span class="delimiter">(</span><a href="#1217027" title="List[SelectiveCPSTransform.this.global.Tree]">bodyStms</a>, <a href="#1217028" title="SelectiveCPSTransform.this.global.Tree">bodyExpr</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a title="(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" id="1217448">ex</a>:<a href="../../reflect/internal/Types.scala.html#407625" title="SelectiveCPSTransform.this.global.TypeError">TypeError</a> =&gt;
                  <a href="#1215959" title="SelectiveCPSTransform.this.global.CompilationUnit">unit</a>.<a href="../nsc/CompilationUnits.scala.html#539298" title="(pos: SelectiveCPSTransform.this.global.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#1217448" title="SelectiveCPSTransform.this.global.TypeError">ex</a>.<a href="../../reflect/internal/Types.scala.html#416070" title="=&gt; SelectiveCPSTransform.this.global.Position">pos</a>, <a href="#1217448" title="SelectiveCPSTransform.this.global.TypeError">ex</a>.<a href="../../reflect/internal/Types.scala.html#416073" title="=&gt; String">msg</a><span class="delimiter">)</span>
                  <a href="../../Tuple2.scala.html#62849" title="(_1: List[SelectiveCPSTransform.this.global.Tree], _2: SelectiveCPSTransform.this.global.Tree)(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" class="delimiter">(</a><a href="#1217027" title="List[SelectiveCPSTransform.this.global.Tree]">bodyStms</a>, <a href="#1217028" title="SelectiveCPSTransform.this.global.Tree">bodyExpr</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>

            <span class="keyword">case</span> _ =&gt;
                <span class="keyword">val</span> <a title="SelectiveCPSTransform.this.global.Tree" id="1217455">stm1</a> = <a href="#1215955" title="(tree: SelectiveCPSTransform.this.global.Tree)SelectiveCPSTransform.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1217010" title="SelectiveCPSTransform.this.global.Tree">stm</a><span class="delimiter">)</span>
                <span class="keyword">val</span> <a href="#3382454" title="(x: (List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree))(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" class="delimiter">(</a><a href="../../Tuple2.scala.html#60635" title="List[SelectiveCPSTransform.this.global.Tree]" id="1217457">a</a>, <a href="../../Tuple2.scala.html#60637" title="SelectiveCPSTransform.this.global.Tree" id="1217458">b</a><span class="delimiter">)</span> = <a href="#1215958" title="(stms: List[SelectiveCPSTransform.this.global.Tree], expr: SelectiveCPSTransform.this.global.Tree)(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)">transBlock</a><a href="../../Tuple2.scala.html#783" title="(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree) @unchecked" class="delimiter">(</a><a href="#1217011" title="List[SelectiveCPSTransform.this.global.Tree]">rest</a>, <a href="#1216987" title="SelectiveCPSTransform.this.global.Tree">expr</a><span class="delimiter">)</span>
                <a href="../../Tuple2.scala.html#62849" title="(_1: List[SelectiveCPSTransform.this.global.Tree], _2: SelectiveCPSTransform.this.global.Tree)(List[SelectiveCPSTransform.this.global.Tree], SelectiveCPSTransform.this.global.Tree)" class="delimiter">(</a><a href="#1217455" title="SelectiveCPSTransform.this.global.Tree">stm1</a><a href="../../collection/immutable/List.scala.html#62685" title="(x: SelectiveCPSTransform.this.global.Tree)List[SelectiveCPSTransform.this.global.Tree]">::</a><a href="#1217457" title="List[SelectiveCPSTransform.this.global.Tree]">a</a>, <a href="#1217458" title="SelectiveCPSTransform.this.global.Tree">b</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>


  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>