<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/scalap/scalax/rules/Memoisable.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
// -----------------------------------------------------------------------------
//
//  Scalax - The Scala Community Library
//  Copyright (c) 2005-8 The Scalax Project. All rights reserved.
//
//  The primary distribution site is http://scalax.scalaforge.org/
//
//  This software is released under the terms of the Revised BSD License.
//  There is NO WARRANTY.  See the file LICENSE for the full text.
//
// -----------------------------------------------------------------------------

<span class="keyword">package</span> scala.tools.scalap
<span class="keyword">package</span> scalax
<span class="keyword">package</span> rules

<span class="keyword">import</span> scala.collection.mutable

<span class="keyword">trait</span> <a title="trait MemoisableRules extends Object with scala.tools.scalap.scalax.rules.Rules" id="51440">MemoisableRules</a> <a href="../../../../Unit.scala.html#1515" title="Unit" class="keyword">extends</a> <a href="Rules.scala.html#51497" title="scala.tools.scalap.scalax.rules.Rules">Rules</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="[In &lt;: scala.tools.scalap.scalax.rules.Memoisable, Out, A, X](key: AnyRef)(toRule: =&gt; In =&gt; scala.tools.scalap.scalax.rules.Result[Out,A,X])scala.tools.scalap.scalax.rules.Rule[In,Out,A,X]" id="1195538">memo</a><span class="delimiter">[</span><a title=" &lt;: scala.tools.scalap.scalax.rules.Memoisable" id="1195543">In</a> &lt;: Memoisable, <a title="" id="1195544">Out</a>, <a title="" id="1195545">A</a>, <a title="" id="1195546">X</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="AnyRef" id="1195967">key</a> : <span title="AnyRef">AnyRef</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; In =&gt; scala.tools.scalap.scalax.rules.Result[Out,A,X]" id="1195968">toRule</a> : =&gt; In =&gt; Result<span class="delimiter">[</span>Out, A, X<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="In =&gt; scala.tools.scalap.scalax.rules.Result[Out,A,X]" id="1195972">rule</a> = <a href="#1195968" title="=&gt; In =&gt; scala.tools.scalap.scalax.rules.Result[Out,A,X]">toRule</a>
    <a href="Rules.scala.html#1192181" title="[In]=&gt; Object{def apply[Out, A, X](f: In =&gt; scala.tools.scalap.scalax.rules.Result[Out,A,X]): scala.tools.scalap.scalax.rules.Rule[In,Out,A,X]}">from</a><a href="Rules.scala.html#1196073" title="(f: In =&gt; scala.tools.scalap.scalax.rules.Result[Out,A,X])scala.tools.scalap.scalax.rules.Rule[In,Out,A,X]" class="delimiter">[</a><a href="#1195543" title="In">In</a><span class="delimiter">]</span> <span class="delimiter">{</span> <a title="In" id="1196084">in</a> =&gt; <a href="#1196084" title="In">in</a>.<a href="#1195364" title="(key: AnyRef, a: =&gt; scala.tools.scalap.scalax.rules.Result[Out,A,X])scala.tools.scalap.scalax.rules.Result[Out,A,X]">memo</a><span class="delimiter">(</span><a href="#1195967" title="AnyRef">key</a>, <a href="../../../../Function1.scala.html#58642" title="(v1: In)scala.tools.scalap.scalax.rules.Result[Out,A,X]">rule</a><span class="delimiter">(</span><a href="#1196084" title="In">in</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="[In, Out, A, X](name: String, f: In =&gt; scala.tools.scalap.scalax.rules.Result[Out,A,X])scala.tools.scalap.scalax.rules.Rule[In,Out,A,X] with scala.tools.scalap.scalax.rules.Name" id="1195547">ruleWithName</a><span class="delimiter">[</span><a title="" id="1195552">In</a>, <a title="" id="1195553">Out</a>, <a title="" id="1195554">A</a>, <a title="" id="1195555">X</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="1199609">name</a> : <span title="String">String</span>, <a title="In =&gt; scala.tools.scalap.scalax.rules.Result[Out,A,X]" id="1199610">f</a> : In =&gt; rules.Result<span class="delimiter">[</span>Out, A, X<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#51440" title="scala.tools.scalap.scalax.rules.MemoisableRules" class="keyword">super</a>.<a href="Rules.scala.html#1192208" title="(_name: String, f: In =&gt; scala.tools.scalap.scalax.rules.Result[Out,A,X])scala.tools.scalap.scalax.rules.Rule[In,Out,A,X] with scala.tools.scalap.scalax.rules.Name">ruleWithName</a><span class="delimiter">(</span><a href="#1199609" title="String">name</a>, <span class="delimiter">(</span>in : <a href="#1195552" title="In">In</a><span class="delimiter">)</span> =&gt; <a href="#1199645" title="In">in</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#3379510" title="scala.tools.scalap.scalax.rules.Result[Out,A,X]" id="3379513">s</a> : Memoisable =&gt; s.<a href="#1195364" title="(key: AnyRef, a: =&gt; scala.tools.scalap.scalax.rules.Result[Out,A,X])scala.tools.scalap.scalax.rules.Result[Out,A,X]">memo</a><a href="#3379515" title="(x: scala.tools.scalap.scalax.rules.Result[Out,A,X])scala.tools.scalap.scalax.rules.Result[Out,A,X]" class="delimiter">(</a><a href="#1199609" title="String">name</a>, <a href="../../../../Function1.scala.html#58642" title="(v1: In)scala.tools.scalap.scalax.rules.Result[Out,A,X]">f</a><span class="delimiter">(</span><a href="#1199645" title="In">in</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt; <a href="../../../../Function1.scala.html#58642" title="(v1: In)scala.tools.scalap.scalax.rules.Result[Out,A,X]">f</a><a href="#3379515" title="(x: scala.tools.scalap.scalax.rules.Result[Out,A,X])scala.tools.scalap.scalax.rules.Result[Out,A,X]" class="delimiter">(</a><a href="#1199645" title="In">in</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait Memoisable extends Object" id="51441">Memoisable</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="[A](key: AnyRef, a: =&gt; A)A" id="1195364">memo</a><span class="delimiter">[</span><a title="" id="1195366">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="AnyRef" id="1196085">key</a> : <span title="AnyRef">AnyRef</span>, <a title="=&gt; A" id="1196086">a</a> : =&gt; A<span class="delimiter">)</span> : <a href="#1195366" title="A">A</a>
<span class="delimiter">}</span>


<span title="Object" class="keyword">object</span> <a title="scala.tools.scalap.scalax.rules.DefaultMemoisable.type" id="51442">DefaultMemoisable</a> <a href="#51443" title="scala.tools.scalap.scalax.rules.DefaultMemoisable.type" class="delimiter">{</a>
  <span class="keyword">var</span> <a title="Boolean" id="1199663">debug</a> = <span title="Boolean(false)" class="keyword">false</span>
<span class="delimiter">}</span>

<span title="Object" class="keyword">trait</span> <a title="trait DefaultMemoisable extends Object with scala.tools.scalap.scalax.rules.Memoisable" id="51444">DefaultMemoisable</a> <a href="../../../../Unit.scala.html#1515" title="Unit" class="keyword">extends</a> <a href="#51441" title="scala.tools.scalap.scalax.rules.Memoisable">Memoisable</a> <span class="delimiter">{</span>
  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[AnyRef,Any]" id="1195368">map</a> = <a href="../../../../collection/mutable/HashMap.scala.html#88242" title="()scala.collection.mutable.HashMap[AnyRef,Any]" class="keyword">new</a> mutable.<a href="../../../../collection/mutable/HashMap.scala.html#12447" title="scala.collection.mutable.HashMap[AnyRef,Any]">HashMap</a><span class="delimiter">[</span>AnyRef, Any<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="[A](key: AnyRef, a: =&gt; A)A" id="1195370">memo</a><span class="delimiter">[</span><a title="" id="1195372">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="AnyRef" id="1199670">key</a> : <span title="AnyRef">AnyRef</span>, <a title="=&gt; A" id="1199671">a</a> : =&gt; A<span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#1195368" title="=&gt; scala.collection.mutable.HashMap[AnyRef,Any]">map</a>.<a href="../../../../collection/mutable/MapLike.scala.html#87629" title="(key: AnyRef, op: =&gt; Any)Any">getOrElseUpdate</a><span class="delimiter">(</span><a href="#1199670" title="AnyRef">key</a>, <a href="#1195373" title="(key: AnyRef, a: =&gt; A)Any">compute</a><span class="delimiter">(</span><a href="#1199670" title="AnyRef">key</a>, <a href="#1199671" title="=&gt; A">a</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="A" class="delimiter">[</span><a href="#1195372" title="A">A</a><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="[A](key: AnyRef, a: =&gt; A)Any" id="1195373">compute</a><span class="delimiter">[</span><a title="" id="1195375">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="AnyRef" id="1199686">key</a> : <span title="AnyRef">AnyRef</span>, <a title="=&gt; A" id="1199687">a</a> : =&gt; A<span class="delimiter">)</span>: <span title="Any">Any</span> = <a href="#1199687" title="=&gt; A">a</a> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#3379520" title="Any" id="3379523">success</a> : Success<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt; <a href="#1195376" title="(key: AnyRef, result: scala.tools.scalap.scalax.rules.Success[_,_])Unit">onSuccess</a><span class="delimiter">(</span><a href="#1199686" title="AnyRef">key</a>, success<span class="delimiter">)</span>; success
    <span class="keyword">case</span> other =&gt;
      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#51442" title="scala.tools.scalap.scalax.rules.DefaultMemoisable.type">DefaultMemoisable</a>.<a href="#1199663" title="=&gt; Boolean">debug</a><span class="delimiter">)</span> <a href="../../../../Predef.scala.html#7514" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="../../../../Predef.scala.html#7605" title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd">key</a> <a href="../../../../runtime/StringAdd.scala.html#60046" title="(other: String)String">+</a> <span title="String(&quot; -&gt; &quot;)" class="string">&quot; -&gt; &quot;</span> <span title="(x$1: Any)String">+</span> other<span class="delimiter">)</span>
      other
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="[S, T](key: AnyRef, result: scala.tools.scalap.scalax.rules.Success[S,T])Unit" id="1195376">onSuccess</a><span class="delimiter">[</span><a title="" id="1195379">S</a>, <a title="" id="1195380">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="AnyRef" id="1199701">key</a> : <span title="AnyRef">AnyRef</span>,  <a title="scala.tools.scalap.scalax.rules.Success[S,T]" id="1199702">result</a> : <a href="Result.scala.html#51464" title="scala.tools.scalap.scalax.rules.Success[S,T]">Success</a><span class="delimiter">[</span>S, T<span class="delimiter">]</span><span class="delimiter">)</span>  <span class="delimiter">{</span>
    <span class="keyword">val</span> Success<a href="#3379532" title="(x: (S, T))(S, T)" class="delimiter">(</a><a href="Result.scala.html#1192894" title="S" id="1199732">out</a>, <a href="Result.scala.html#1192896" title="T" id="1199733">t</a><span class="delimiter">)</span> = <a href="#1199702" title="scala.tools.scalap.scalax.rules.Success[S,T]">result</a>
    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#51442" title="scala.tools.scalap.scalax.rules.DefaultMemoisable.type">DefaultMemoisable</a>.<a href="#1199663" title="=&gt; Boolean">debug</a><span class="delimiter">)</span> <a href="../../../../Predef.scala.html#7514" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="../../../../Predef.scala.html#7605" title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd">key</a> <a href="../../../../runtime/StringAdd.scala.html#60046" title="(other: String)String">+</a> <span title="String(&quot; -&gt; &quot;)" class="string">&quot; -&gt; &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1199733" title="T">t</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; (&quot;)" class="string">&quot; (&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1199732" title="S">out</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>




        </pre>
    </body>
</html>