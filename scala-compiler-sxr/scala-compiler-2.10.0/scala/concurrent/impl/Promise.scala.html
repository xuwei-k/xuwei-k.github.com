<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/concurrent/impl/Promise.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2013, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

<span class="keyword">package</span> scala.concurrent.impl

<span class="keyword">import</span> scala.concurrent.<span class="delimiter">{</span> ExecutionContext, CanAwait, OnCompleteRunnable, TimeoutException, ExecutionException <span class="delimiter">}</span>
<span class="keyword">import</span> scala.concurrent.duration.<span class="delimiter">{</span> Duration, Deadline, FiniteDuration, NANOSECONDS <span class="delimiter">}</span>
<span class="keyword">import</span> scala.annotation.tailrec
<span class="keyword">import</span> scala.util.control.NonFatal
<span class="keyword">import</span> scala.util.<span class="delimiter">{</span> Try, Success, Failure <span class="delimiter">}</span>

<span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait Promise[T] extends Object with scala.concurrent.Promise[T] with scala.concurrent.Future[T]" id="16842">Promise</a><span class="delimiter">[</span><a title="" id="16896">T</a><span class="delimiter">]</span> <a href="../../Unit.scala.html#1515" title="Unit" class="keyword">extends</a> scala.concurrent.<a href="../Promise.scala.html#16299" title="scala.concurrent.Promise[T]">Promise</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="keyword">with</span> scala.concurrent.<a href="../Future.scala.html#16323" title="scala.concurrent.Future[T]">Future</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; Promise.this.type" id="386890">future</a>: <span class="keyword">this</span>.<span class="keyword">type</span> = <a href="#16842" title="Promise.this.type" class="keyword">this</a>
<span class="delimiter">}</span>

/* Precondition: `executor` is prepared, i.e., `executor` has been returned from invocation of `prepare` on some other `ExecutionContext`.
 */
<span class="keyword">private</span> <span class="keyword">class</span> <a title="class CallbackRunnable[T] extends Object with Runnable with scala.concurrent.OnCompleteRunnable" id="16845">CallbackRunnable</a><span class="delimiter">[</span><a title="" id="16897">T</a><span class="delimiter">]</span><a href="#16845" title="scala.concurrent.impl.CallbackRunnable[T]" class="delimiter">(</a><span class="keyword">val</span> <a title="scala.concurrent.ExecutionContext" id="391295">executor</a>: <a href="../ExecutionContext.scala.html#16170" title="scala.concurrent.ExecutionContext">ExecutionContext</a>, <span class="keyword">val</span> <a title="scala.util.Try[T] =&gt; Any" id="391296">onComplete</a>: Try<span class="delimiter">[</span>T<span class="delimiter">]</span> =&gt; Any<span class="delimiter">)</span> <span class="keyword">extends</span> <span title="Runnable">Runnable</span> <span class="keyword">with</span> <a href="../Future.scala.html#16245" title="scala.concurrent.OnCompleteRunnable">OnCompleteRunnable</a> <span class="delimiter">{</span>
  // must be filled in before running it
  <span class="keyword">var</span> <a title="scala.util.Try[T]" id="391287">value</a>: <a href="../../util/Try.scala.html#7255" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="391289">run</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="../../Predef.scala.html#7488" title="(requirement: Boolean)Unit">require</a><span class="delimiter">(</span><a href="#391287" title="=&gt; scala.util.Try[T]">value</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> // must set value to non-null before running!
    <a href="#3273116" title="Unit" id="3273112" class="keyword">try</a> <a href="../../Function1.scala.html#58642" title="(v1: scala.util.Try[T])Any">onComplete</a><span title="Unit" class="delimiter">(</span><a href="#391287" title="=&gt; scala.util.Try[T]">value</a><span class="delimiter">)</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a href="../../util/control/NonFatal.scala.html#385750" title="Option[Throwable]" id="3273120">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="391303">e</a><span class="delimiter">)</span> =&gt; <a href="#391295" title="=&gt; scala.concurrent.ExecutionContext">executor</a> <a href="#3273116" title="(x: Unit)Unit">reportFailure</a> <a href="#391303" title="Throwable">e</a> <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(v: scala.util.Try[T])Unit" id="391290">executeWithValue</a><span class="delimiter">(</span><a title="scala.util.Try[T]" id="391304">v</a>: <a href="../../util/Try.scala.html#7255" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Unit.scala.html#1515" title="Unit">Unit</a> = <span class="delimiter">{</span>
    <a href="../../Predef.scala.html#7488" title="(requirement: Boolean)Unit">require</a><span class="delimiter">(</span><a href="#391287" title="=&gt; scala.util.Try[T]">value</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> // can't complete it twice
    <a href="#391287" title="(x$1: scala.util.Try[T])Unit">value</a> = <a href="#391304" title="scala.util.Try[T]">v</a>
    // Note that we cannot prepare the ExecutionContext at this point, since we might
    // already be running on a different thread!
    <a href="#391295" title="=&gt; scala.concurrent.ExecutionContext">executor</a>.<a href="../ExecutionContext.scala.html#367133" title="(runnable: Runnable)Unit">execute</a><span class="delimiter">(</span><a href="#16845" title="scala.concurrent.impl.CallbackRunnable[T]" class="keyword">this</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">object</span> <a title="scala.concurrent.impl.Promise.type" id="16843">Promise</a> <a href="#16844" title="scala.concurrent.impl.Promise.type" class="delimiter">{</a>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](source: scala.util.Try[T])scala.util.Try[T]" id="386863">resolveTry</a><span class="delimiter">[</span><a title="" id="386865">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.util.Try[T]" id="391309">source</a>: <a href="../../util/Try.scala.html#7255" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../util/Try.scala.html#7255" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = <a href="#391309" title="scala.util.Try[T]">source</a> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> Failure<a href="#3273121" title="scala.util.Try[T]" id="3273122" class="delimiter">(</a><a href="../../util/Try.scala.html#385699" title="Throwable" id="391312">t</a><span class="delimiter">)</span> =&gt; <a href="#386866" title="(throwable: Throwable)scala.util.Try[Nothing]">resolver</a><a href="#3273124" title="(x: scala.util.Try[T])scala.util.Try[T]" class="delimiter">(</a><a href="#391312" title="Throwable">t</a><span class="delimiter">)</span>
    <span class="keyword">case</span> _          =&gt; <a href="#3273124" title="(x: scala.util.Try[T])scala.util.Try[T]">source</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](throwable: Throwable)scala.util.Try[T]" id="386866">resolver</a><span class="delimiter">[</span><a title="" id="386868">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Throwable" id="391313">throwable</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>: <a href="../../util/Try.scala.html#7255" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = <a href="#391313" title="Throwable">throwable</a> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#3273129" title="scala.util.Try[T]" id="3273130">t</a>: scala.runtime.NonLocalReturnControl<span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <a href="../../util/Try.scala.html#385625" title="(value: T)scala.util.Success[T]">Success</a><a href="#3273135" title="(x: scala.util.Try[T])scala.util.Try[T]" class="delimiter">(</a>t.<a href="../../runtime/NonLocalReturnControl.scala.html#391328" title="=&gt; _">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#386868" title="T">T</a><span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#3273129" title="scala.util.Try[T]" id="3273131">t</a>: scala.util.control.ControlThrowable    =&gt; <a href="../../util/Try.scala.html#385695" title="(exception: Throwable)scala.util.Failure[Nothing]">Failure</a><a href="#3273135" title="(x: scala.util.Try[T])scala.util.Try[T]" class="delimiter">(</a><span title="(x$1: String, x$2: Throwable)java.util.concurrent.ExecutionException" class="keyword">new</span> <a href="../package.scala.html#55429" title="java.util.concurrent.ExecutionException">ExecutionException</a><span class="delimiter">(</span><span title="String(&quot;Boxed ControlThrowable&quot;)" class="string">&quot;Boxed ControlThrowable&quot;</span>, t<span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#3273129" title="scala.util.Try[T]" id="3273132">t</a>: InterruptedException                   =&gt; <a href="../../util/Try.scala.html#385695" title="(exception: Throwable)scala.util.Failure[Nothing]">Failure</a><a href="#3273135" title="(x: scala.util.Try[T])scala.util.Try[T]" class="delimiter">(</a><span title="(x$1: String, x$2: Throwable)java.util.concurrent.ExecutionException" class="keyword">new</span> <a href="../package.scala.html#55429" title="java.util.concurrent.ExecutionException">ExecutionException</a><span class="delimiter">(</span><span title="String(&quot;Boxed InterruptedException&quot;)" class="string">&quot;Boxed InterruptedException&quot;</span>, t<span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#3273129" title="scala.util.Try[T]" id="3273133">e</a>: Error                                  =&gt; <a href="../../util/Try.scala.html#385695" title="(exception: Throwable)scala.util.Failure[Nothing]">Failure</a><a href="#3273135" title="(x: scala.util.Try[T])scala.util.Try[T]" class="delimiter">(</a><span title="(x$1: String, x$2: Throwable)java.util.concurrent.ExecutionException" class="keyword">new</span> <a href="../package.scala.html#55429" title="java.util.concurrent.ExecutionException">ExecutionException</a><span class="delimiter">(</span><span title="String(&quot;Boxed Error&quot;)" class="string">&quot;Boxed Error&quot;</span>, e<span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> t                                         =&gt; <a href="../../util/Try.scala.html#385695" title="(exception: Throwable)scala.util.Failure[Nothing]">Failure</a><a href="#3273135" title="(x: scala.util.Try[T])scala.util.Try[T]" class="delimiter">(</a>t<span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** Default promise implementation.
   */
  <span class="keyword">class</span> <a title="class DefaultPromise[T] extends scala.concurrent.impl.AbstractPromise with scala.concurrent.impl.Promise[T]" id="386869">DefaultPromise</a><span class="delimiter">[</span><a title="" id="386870">T</a><span class="delimiter">]</span> <a href="#386869" title="scala.concurrent.impl.Promise.DefaultPromise[T]" class="keyword">extends</a> <a href="AbstractPromise.java.html#16836" title="scala.concurrent.impl.AbstractPromise">AbstractPromise</a> <span class="keyword">with</span> <a href="#16842" title="scala.concurrent.impl.Promise[T]">Promise</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">{</span> self =&gt;
    <a href="AbstractPromise.java.html#386876" title="(oldState: Any, newState: Any)Boolean">updateState</a><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <a href="../../collection/immutable/List.scala.html#11188" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span> // Start at &quot;No callbacks&quot;

    <span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="(atMost: scala.concurrent.duration.Duration)Boolean" id="386880">tryAwait</a><span class="delimiter">(</span><a title="scala.concurrent.duration.Duration" id="391371">atMost</a>: <a href="../duration/Duration.scala.html#16562" title="scala.concurrent.duration.Duration">Duration</a><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
      @tailrec
      <span class="keyword">def</span> <a title="(deadline: scala.concurrent.duration.Deadline, nextWait: scala.concurrent.duration.FiniteDuration)Boolean" id="391373">awaitUnsafe</a><span class="delimiter">(</span><a title="scala.concurrent.duration.Deadline" id="391376">deadline</a>: <a href="../duration/Deadline.scala.html#16514" title="scala.concurrent.duration.Deadline">Deadline</a>, <a title="scala.concurrent.duration.FiniteDuration" id="391377">nextWait</a>: <a href="../duration/Duration.scala.html#16526" title="scala.concurrent.duration.FiniteDuration">FiniteDuration</a><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#386884" title="=&gt; Boolean">isCompleted</a> <a href="../../Boolean.scala.html#57826" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#391377" title="scala.concurrent.duration.FiniteDuration">nextWait</a> <a href="../../math/Ordered.scala.html#56748" title="(that: scala.concurrent.duration.Duration)Boolean">&gt;</a> <a href="../duration/Duration.scala.html#16563" title="scala.concurrent.duration.Duration.type">Duration</a>.<a href="../duration/Duration.scala.html#387445" title="=&gt; scala.concurrent.duration.FiniteDuration">Zero</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Long" id="391381">ms</a> = <a href="#391377" title="scala.concurrent.duration.FiniteDuration">nextWait</a>.<a href="../duration/Duration.scala.html#387360" title="=&gt; Long">toMillis</a>
          <span class="keyword">val</span> <a title="Int" id="391382">ns</a> = <span class="delimiter">(</span><a href="#391377" title="scala.concurrent.duration.FiniteDuration">nextWait</a>.<a href="../duration/Duration.scala.html#387358" title="=&gt; Long">toNanos</a> <a href="../../Long.scala.html#57549" title="(x: Long)Long">%</a> <span title="Long(1000000L)" class="long">1000000l</span><span class="delimiter">)</span>.<a href="../../Long.scala.html#57446" title="=&gt; Int">toInt</a> // as per object.wait spec

          <a href="#386869" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#386884" title="=&gt; Boolean">isCompleted</a><span class="delimiter">)</span> <a href="#386869" title="(x$1: Long, x$2: Int)Unit">wait</a><span class="delimiter">(</span><a href="#391381" title="Long">ms</a>, <a href="#391382" title="Int">ns</a><span class="delimiter">)</span> <span class="delimiter">}</span>

          <a href="#391373" title="(deadline: scala.concurrent.duration.Deadline, nextWait: scala.concurrent.duration.FiniteDuration)Boolean">awaitUnsafe</a><span class="delimiter">(</span><a href="#391376" title="scala.concurrent.duration.Deadline">deadline</a>, <a href="#391376" title="scala.concurrent.duration.Deadline">deadline</a>.<a href="../duration/Deadline.scala.html#387341" title="=&gt; scala.concurrent.duration.FiniteDuration">timeLeft</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span>
          <a href="#386884" title="=&gt; Boolean">isCompleted</a>
      <span class="delimiter">}</span>
      @tailrec
      <span class="keyword">def</span> <a title="()Boolean" id="391374">awaitUnbounded</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#386884" title="=&gt; Boolean">isCompleted</a><span class="delimiter">)</span> <span title="Boolean(true)" class="keyword">true</span>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#386869" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#57822" title="=&gt; Boolean">!</a><a href="#386884" title="=&gt; Boolean">isCompleted</a><span class="delimiter">)</span> <a href="#386869" title="()Unit">wait</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>
          <a href="#391374" title="()Boolean">awaitUnbounded</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">import</span> <a href="../duration/Duration.scala.html#16563" title="scala.concurrent.duration.Duration.type">Duration</a>.Undefined
      <a href="#391371" title="scala.concurrent.duration.Duration">atMost</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> u <span class="keyword">if</span> u <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../duration/Duration.scala.html#387447" title="=&gt; scala.concurrent.duration.Duration.Infinite">Undefined</a> =&gt; <a href="#3273154" title="(x: Boolean)Boolean" class="keyword">throw</a> <span title="(x$1: String)IllegalArgumentException" class="keyword">new</span> <a href="../../package.scala.html#55509" title="IllegalArgumentException">IllegalArgumentException</a><span class="delimiter">(</span><span title="String(&quot;cannot wait for Undefined period&quot;)" class="string">&quot;cannot wait for Undefined period&quot;</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../duration/Duration.scala.html#16563" title="scala.concurrent.duration.Duration.type">Duration</a>.<a href="../duration/Duration.scala.html#387450" title="Boolean" id="3273148">Inf</a>        =&gt; <a href="#3273154" title="(x: Boolean)Boolean">awaitUnbounded</a>
        <span class="keyword">case</span> <a href="../duration/Duration.scala.html#16563" title="scala.concurrent.duration.Duration.type">Duration</a>.<a href="../duration/Duration.scala.html#387452" title="Boolean" id="3273149">MinusInf</a>   =&gt; <a href="#3273154" title="(x: Boolean)Boolean">isCompleted</a>
        <span class="keyword">case</span> <a href="#3273143" title="Boolean" id="3273150">f</a>: FiniteDuration   =&gt; <a href="#3273154" title="(x: Boolean)Boolean" class="keyword">if</a> <span class="delimiter">(</span>f <a href="../../math/Ordered.scala.html#56748" title="(that: scala.concurrent.duration.Duration)Boolean">&gt;</a> <a href="../duration/Duration.scala.html#16563" title="scala.concurrent.duration.Duration.type">Duration</a>.<a href="../duration/Duration.scala.html#387445" title="=&gt; scala.concurrent.duration.FiniteDuration">Zero</a><span class="delimiter">)</span> <a href="#391373" title="(deadline: scala.concurrent.duration.Deadline, nextWait: scala.concurrent.duration.FiniteDuration)Boolean">awaitUnsafe</a><span class="delimiter">(</span>f.<a href="../duration/Duration.scala.html#387366" title="=&gt; scala.concurrent.duration.Deadline">fromNow</a>, f<span class="delimiter">)</span> <span class="keyword">else</span> <a href="#386884" title="=&gt; Boolean">isCompleted</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    @throws<span class="delimiter">(</span>classOf<span class="delimiter">[</span>TimeoutException<span class="delimiter">]</span><span class="delimiter">)</span>
    @throws<span class="delimiter">(</span>classOf<span class="delimiter">[</span>InterruptedException<span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(atMost: scala.concurrent.duration.Duration)(implicit permit: scala.concurrent.CanAwait)DefaultPromise.this.type" id="386881">ready</a><span class="delimiter">(</span><a title="scala.concurrent.duration.Duration" id="391408">atMost</a>: <a href="../duration/Duration.scala.html#16562" title="scala.concurrent.duration.Duration">Duration</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.CanAwait" id="391409">permit</a>: <a href="../package.scala.html#16212" title="scala.concurrent.CanAwait">CanAwait</a><span class="delimiter">)</span>: <span class="keyword">this</span>.<span class="keyword">type</span> =
      <span title="DefaultPromise.this.type" class="keyword">if</span> <span class="delimiter">(</span><a href="#386884" title="=&gt; Boolean">isCompleted</a> <a href="../../Boolean.scala.html#57825" title="(x: Boolean)Boolean">||</a> <a href="#386880" title="(atMost: scala.concurrent.duration.Duration)Boolean">tryAwait</a><span class="delimiter">(</span><a href="#391408" title="scala.concurrent.duration.Duration">atMost</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#386869" title="DefaultPromise.this.type" class="keyword">this</a>
      <span class="keyword">else</span> <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)java.util.concurrent.TimeoutException" class="keyword">new</span> <a href="../package.scala.html#55431" title="java.util.concurrent.TimeoutException">TimeoutException</a><span class="delimiter">(</span><span title="String(&quot;Futures timed out after [&quot;)" class="string">&quot;Futures timed out after [&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#391408" title="scala.concurrent.duration.Duration">atMost</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span>

    @throws<span class="delimiter">(</span>classOf<span class="delimiter">[</span>Exception<span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(atMost: scala.concurrent.duration.Duration)(implicit permit: scala.concurrent.CanAwait)T" id="386882">result</a><span class="delimiter">(</span><a title="scala.concurrent.duration.Duration" id="391413">atMost</a>: <a href="../duration/Duration.scala.html#16562" title="scala.concurrent.duration.Duration">Duration</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.CanAwait" id="391414">permit</a>: <a href="../package.scala.html#16212" title="scala.concurrent.CanAwait">CanAwait</a><span class="delimiter">)</span>: <a href="#386870" title="T">T</a> =
      <a href="#386881" title="(atMost: scala.concurrent.duration.Duration)(implicit permit: scala.concurrent.CanAwait)DefaultPromise.this.type">ready</a><a href="#391414" title="scala.concurrent.CanAwait" class="delimiter">(</a><a href="#391413" title="scala.concurrent.duration.Duration">atMost</a><span class="delimiter">)</span>.<a href="#386883" title="=&gt; Option[scala.util.Try[T]]">value</a>.<a href="../../Option.scala.html#62858" title="=&gt; scala.util.Try[T]">get</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Failure<a href="#3273167" title="T" id="3273168" class="delimiter">(</a><a href="../../util/Try.scala.html#385699" title="Throwable" id="391418">e</a><span class="delimiter">)</span>  =&gt; <a href="#3273171" title="(x: T)T" class="keyword">throw</a> <a href="#391418" title="Throwable">e</a>
        <span class="keyword">case</span> Success<a href="#3273167" title="T" id="3273169" class="delimiter">(</a><a href="../../util/Try.scala.html#385629" title="T" id="391420">r</a><span class="delimiter">)</span> =&gt; <a href="#3273171" title="(x: T)T">r</a>
      <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; Option[scala.util.Try[T]]" id="386883">value</a>: <a href="../../Option.scala.html#978" title="Option[scala.util.Try[T]]">Option</a><span class="delimiter">[</span>Try<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="AbstractPromise.java.html#386877" title="()Object">getState</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#3273176" title="Option[scala.util.Try[T]]" id="3273177">c</a>: Try<span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <a href="../../Option.scala.html#63128" title="(x: scala.util.Try[T])Some[scala.util.Try[T]]">Some</a><a href="#3273179" title="(x: Option[scala.util.Try[T]])Option[scala.util.Try[T]]" class="delimiter">(</a>c.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.util.Try[T]" class="delimiter">[</span><a href="../../util/Try.scala.html#7255" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt; <a href="#3273179" title="(x: Option[scala.util.Try[T]])Option[scala.util.Try[T]]">None</a>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="386884">isCompleted</a>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <a href="AbstractPromise.java.html#386877" title="()Object">getState</a> <span class="keyword">match</span> <span class="delimiter">{</span> // Cheaper than boxing result into Option due to &quot;def value&quot;
      <span class="keyword">case</span> _: Try<span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <a href="#3273187" title="(x: Boolean)Boolean" class="keyword">true</a>
      <span class="keyword">case</span> _ =&gt; <a href="#3273187" title="(x: Boolean)Boolean" class="keyword">false</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(value: scala.util.Try[T])Boolean" id="386885">tryComplete</a><span class="delimiter">(</span><a title="scala.util.Try[T]" id="391427">value</a>: <a href="../../util/Try.scala.html#7255" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.util.Try[T]" id="391430">resolved</a> = <a href="#386863" title="(source: scala.util.Try[T])scala.util.Try[T]">resolveTry</a><span class="delimiter">(</span><a href="#391427" title="scala.util.Try[T]">value</a><span class="delimiter">)</span>
      <span class="delimiter">(</span><a href="#3273200" title="Boolean" class="keyword">try</a> <span class="delimiter">{</span>
        @tailrec
        <span class="keyword">def</span> <a title="(v: scala.util.Try[T])List[scala.concurrent.impl.CallbackRunnable[T]]" id="391434">tryComplete</a><span class="delimiter">(</span><a title="scala.util.Try[T]" id="391435">v</a>: <a href="../../util/Try.scala.html#7255" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../collection/immutable/List.scala.html#11952" title="List[scala.concurrent.impl.CallbackRunnable[T]]">List</a><span class="delimiter">[</span>CallbackRunnable<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
          <a href="AbstractPromise.java.html#386877" title="()Object">getState</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#3273192" title="List[scala.concurrent.impl.CallbackRunnable[T]]" id="3273193">raw</a>: List<span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt;
              <span class="keyword">val</span> <a title="List[scala.concurrent.impl.CallbackRunnable[T]]" id="391438">cur</a> = raw.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="List[scala.concurrent.impl.CallbackRunnable[T]]" class="delimiter">[</span><a href="../../collection/immutable/List.scala.html#11952" title="List[scala.concurrent.impl.CallbackRunnable[T]]">List</a><span class="delimiter">[</span>CallbackRunnable<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>
              <span title="List[scala.concurrent.impl.CallbackRunnable[T]]" class="keyword">if</span> <span class="delimiter">(</span><a href="AbstractPromise.java.html#386876" title="(oldState: Any, newState: Any)Boolean">updateState</a><span class="delimiter">(</span><a href="#391438" title="List[scala.concurrent.impl.CallbackRunnable[T]]">cur</a>, <a href="#391435" title="scala.util.Try[T]">v</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#391438" title="List[scala.concurrent.impl.CallbackRunnable[T]]">cur</a> <span class="keyword">else</span> <a href="#391434" title="(v: scala.util.Try[T])List[scala.concurrent.impl.CallbackRunnable[T]]">tryComplete</a><span class="delimiter">(</span><a href="#391435" title="scala.util.Try[T]">v</a><span class="delimiter">)</span>
            <span class="keyword">case</span> _ =&gt; <a href="#3273195" title="(x: List[scala.concurrent.impl.CallbackRunnable[T]])List[scala.concurrent.impl.CallbackRunnable[T]]" class="keyword">null</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <a href="#391434" title="(v: scala.util.Try[T])List[scala.concurrent.impl.CallbackRunnable[T]]">tryComplete</a><span class="delimiter">(</span><a href="#391430" title="scala.util.Try[T]">resolved</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
        <a href="#386869" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span> <a href="#386869" title="()Unit">notifyAll</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span> //Notify any evil blockers
      <span class="delimiter">}</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#3273200" title="Boolean" id="3273203" class="keyword">null</a>             =&gt; <a href="#3273205" title="(x: Boolean)Boolean" class="keyword">false</a>
        <span class="keyword">case</span> rs <span class="keyword">if</span> rs.<a href="../../collection/SeqLike.scala.html#58787" title="=&gt; Boolean">isEmpty</a> =&gt; <a href="#3273205" title="(x: Boolean)Boolean" class="keyword">true</a>
        <span class="keyword">case</span> rs               =&gt; rs.<a href="../../collection/immutable/List.scala.html#62719" title="(f: scala.concurrent.impl.CallbackRunnable[T] =&gt; Unit)Unit">foreach</a><span class="delimiter">(</span><a title="scala.concurrent.impl.CallbackRunnable[T]" id="391464">r</a> =&gt; <a href="#391464" title="scala.concurrent.impl.CallbackRunnable[T]">r</a>.<a href="#391290" title="(v: scala.util.Try[T])Unit">executeWithValue</a><span class="delimiter">(</span><a href="#391430" title="scala.util.Try[T]">resolved</a><span class="delimiter">)</span><span class="delimiter">)</span>; <span title="Boolean(true)" class="keyword">true</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="[U](func: scala.util.Try[T] =&gt; U)(implicit executor: scala.concurrent.ExecutionContext)Unit" id="386886">onComplete</a><span class="delimiter">[</span><a title="" id="386888">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.util.Try[T] =&gt; U" id="391467">func</a>: Try<span class="delimiter">[</span>T<span class="delimiter">]</span> =&gt; U<span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.ExecutionContext" id="391468">executor</a>: <a href="../ExecutionContext.scala.html#16170" title="scala.concurrent.ExecutionContext">ExecutionContext</a><span class="delimiter">)</span>: <a href="../../Unit.scala.html#1515" title="Unit">Unit</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.concurrent.ExecutionContext" id="391474">preparedEC</a> = <a href="#391468" title="scala.concurrent.ExecutionContext">executor</a>.<a href="../ExecutionContext.scala.html#367135" title="()scala.concurrent.ExecutionContext">prepare</a>
      <span class="keyword">val</span> <a title="scala.concurrent.impl.CallbackRunnable[T]" id="391475">runnable</a> = <span title="scala.concurrent.impl.CallbackRunnable[T]" class="keyword">new</span> <a href="#16845" title="scala.concurrent.impl.CallbackRunnable[T]">CallbackRunnable</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">(</span><a href="#391474" title="scala.concurrent.ExecutionContext">preparedEC</a>, <a href="#391467" title="scala.util.Try[T] =&gt; U">func</a><span class="delimiter">)</span>

      @tailrec //Tries to add the callback, if already completed, it dispatches the callback to be executed
      <span class="keyword">def</span> <a title="()Unit" id="391476">dispatchOrAddCallback</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../Unit.scala.html#1515" title="Unit">Unit</a> =
        <a href="AbstractPromise.java.html#386877" title="()Object">getState</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="#3273214" title="Unit" id="3273215">r</a>: Try<span class="delimiter">[</span>_<span class="delimiter">]</span>          =&gt; <a href="#391475" title="scala.concurrent.impl.CallbackRunnable[T]">runnable</a>.<a href="#391290" title="(v: scala.util.Try[T])Unit">executeWithValue</a><a href="#3273218" title="(x: Unit)Unit" class="delimiter">(</a>r.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.util.Try[T]" class="delimiter">[</span><a href="../../util/Try.scala.html#7255" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="#3273214" title="Unit" id="3273216">listeners</a>: List<span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <a href="#3273218" title="(x: Unit)Unit" class="keyword">if</a> <span class="delimiter">(</span><a href="AbstractPromise.java.html#386876" title="(oldState: Any, newState: Any)Boolean">updateState</a><span class="delimiter">(</span>listeners, <a href="#391475" title="scala.concurrent.impl.CallbackRunnable[T]">runnable</a> <a href="../../collection/immutable/List.scala.html#62685" title="(x: Any)List[Any]">::</a> listeners<span class="delimiter">)</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#391476" title="()Unit">dispatchOrAddCallback</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <a href="#391476" title="()Unit">dispatchOrAddCallback</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** An already completed Future is given its result at creation.
   *
   *  Useful in Future-composition when a value to contribute is already available.
   */
  <span class="keyword">final</span> <span class="keyword">class</span> <a title="class KeptPromise[T] extends Object with scala.concurrent.impl.Promise[T]" id="386871">KeptPromise</a><span class="delimiter">[</span><a title="" id="386872">T</a><span class="delimiter">]</span><a href="#386871" title="scala.concurrent.impl.Promise.KeptPromise[T]" class="delimiter">(</a><a title="scala.util.Try[T]" id="386903">suppliedValue</a>: <a href="../../util/Try.scala.html#7255" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#16842" title="scala.concurrent.impl.Promise[T]">Promise</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="Some[scala.util.Try[T]]" id="386894">value</a> = <a href="../../Option.scala.html#63128" title="(x: scala.util.Try[T])Some[scala.util.Try[T]]">Some</a><span class="delimiter">(</span><a href="#386863" title="(source: scala.util.Try[T])scala.util.Try[T]">resolveTry</a><span class="delimiter">(</span><a href="#386903" title="scala.util.Try[T]">suppliedValue</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="386896">isCompleted</a>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span title="Boolean(true)" class="keyword">true</span>

    <span class="keyword">def</span> <a title="(value: scala.util.Try[T])Boolean" id="386897">tryComplete</a><span class="delimiter">(</span><a title="scala.util.Try[T]" id="391503">value</a>: <a href="../../util/Try.scala.html#7255" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span title="Boolean(false)" class="keyword">false</span>

    <span class="keyword">def</span> <a title="[U](func: scala.util.Try[T] =&gt; U)(implicit executor: scala.concurrent.ExecutionContext)Unit" id="386898">onComplete</a><span class="delimiter">[</span><a title="" id="386900">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.util.Try[T] =&gt; U" id="391506">func</a>: Try<span class="delimiter">[</span>T<span class="delimiter">]</span> =&gt; U<span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.ExecutionContext" id="391507">executor</a>: <a href="../ExecutionContext.scala.html#16170" title="scala.concurrent.ExecutionContext">ExecutionContext</a><span class="delimiter">)</span>: <a href="../../Unit.scala.html#1515" title="Unit">Unit</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.util.Try[T]" id="391513">completedAs</a> = <a href="#386894" title="=&gt; Some[scala.util.Try[T]]">value</a>.<a href="../../Option.scala.html#63136" title="=&gt; scala.util.Try[T]">get</a>
      <span class="keyword">val</span> <a title="scala.concurrent.ExecutionContext" id="391514">preparedEC</a> = <a href="#391507" title="scala.concurrent.ExecutionContext">executor</a>.<a href="../ExecutionContext.scala.html#367135" title="()scala.concurrent.ExecutionContext">prepare</a>
      <span class="delimiter">(</span><span title="scala.concurrent.impl.CallbackRunnable[T]" class="keyword">new</span> <a href="#16845" title="scala.concurrent.impl.CallbackRunnable[T]">CallbackRunnable</a><span class="delimiter">(</span><a href="#391514" title="scala.concurrent.ExecutionContext">preparedEC</a>, <a href="#391506" title="scala.util.Try[T] =&gt; U">func</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#391290" title="(v: scala.util.Try[T])Unit">executeWithValue</a><span class="delimiter">(</span><a href="#391513" title="scala.util.Try[T]">completedAs</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(atMost: scala.concurrent.duration.Duration)(implicit permit: scala.concurrent.CanAwait)KeptPromise.this.type" id="386901">ready</a><span class="delimiter">(</span><a title="scala.concurrent.duration.Duration" id="391521">atMost</a>: <a href="../duration/Duration.scala.html#16562" title="scala.concurrent.duration.Duration">Duration</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.CanAwait" id="391522">permit</a>: <a href="../package.scala.html#16212" title="scala.concurrent.CanAwait">CanAwait</a><span class="delimiter">)</span>: <span class="keyword">this</span>.<span class="keyword">type</span> = <a href="#386871" title="KeptPromise.this.type" class="keyword">this</a>

    <span class="keyword">def</span> <a title="(atMost: scala.concurrent.duration.Duration)(implicit permit: scala.concurrent.CanAwait)T" id="386902">result</a><span class="delimiter">(</span><a title="scala.concurrent.duration.Duration" id="391524">atMost</a>: <a href="../duration/Duration.scala.html#16562" title="scala.concurrent.duration.Duration">Duration</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.CanAwait" id="391525">permit</a>: <a href="../package.scala.html#16212" title="scala.concurrent.CanAwait">CanAwait</a><span class="delimiter">)</span>: <a href="#386872" title="T">T</a> = <a href="#386894" title="=&gt; Some[scala.util.Try[T]]">value</a>.<a href="../../Option.scala.html#63136" title="=&gt; scala.util.Try[T]">get</a>.<a href="../../util/Try.scala.html#385598" title="=&gt; T">get</a>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>