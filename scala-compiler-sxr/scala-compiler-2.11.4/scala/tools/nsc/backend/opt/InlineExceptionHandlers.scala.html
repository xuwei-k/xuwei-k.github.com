<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scala/tools/nsc/backend/opt/InlineExceptionHandlers.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new scala compiler
 * Copyright 2005-2013 LAMP/EPFL
 */</span>

package scala.tools.nsc
package backend.opt

import java.util.concurrent.TimeUnit

<span class="comment">/**
  * This optimization phase inlines the exception handlers so that further phases can optimize the code better
  *
  * {{{
  * try {
  *   ...
  *   if (condition)
  *     throw IllegalArgumentException(&quot;sth&quot;)
  * } catch {
  *   case e: IllegalArgumentException =&gt; &lt;handler code&gt;
  *   case e: ... =&gt; ...
  * }
  * }}}
  *
  * will inline the exception handler code to:
  *
  * {{{
  * try {
  *   ...
  *   if (condition)
  *     &lt;handler code&gt; // + jump to the end of the catch statement
  * } catch {
  *   case e: IllegalArgumentException =&gt; &lt;handler code&gt;
  *   case e: ... =&gt; ...
  * }
  * }}}
  *
  * Q: How does the inlining work, ICode level?
  * A: if a block contains a THROW(A) instruction AND there is a handler that takes A or a superclass of A we do:
  *    1. We duplicate the handler code such that we can transform THROW into a JUMP
  *    2. We analyze the handler to see what local it expects the exception to be placed in
  *    3. We place the exception that is thrown in the correct &quot;local variable&quot; slot and clean up the stack
  *    4. We finally JUMP to the duplicate handler
 *    All the above logic is implemented in InlineExceptionHandlersPhase.apply(bblock: BasicBlock)
  *
  * Q: Why do we need to duplicate the handler?
  * A: An exception might be thrown in a method that we invoke in the function and we cannot see that THROW command
  * directly. In order to catch such exceptions, we keep the exception handler in place and duplicate it in order
  * to inline its code.
  *
  * @author Vlad Ureche
  */</span>
abstract class <a title="class InlineExceptionHandlers extends scala.tools.nsc.SubComponent" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers">InlineExceptionHandlers</a> extends <a href="../../SubComponent.scala.html#scala.tools.nsc;SubComponent" title="scala.tools.nsc.SubComponent">SubComponent</a> <span class="delimiter">{</span>
  import <a href="../../SubComponent.scala.html#scala.tools.nsc;SubComponent.global" title="=&gt; scala.tools.nsc.Global">global</a>._
  import <a href="../../Global.scala.html#scala.tools.nsc;Global.icodes" title="InlineExceptionHandlers.this.global.icodes.type">icodes</a>._
  import <a href="../../Global.scala.html#scala.tools.nsc;Global.icodes" title="InlineExceptionHandlers.this.global.icodes.type">icodes</a>.<a href="../icode/Opcodes.scala.html#scala.tools.nsc.backend.icode;Opcodes.opcodes" title="InlineExceptionHandlers.this.global.icodes.opcodes.type">opcodes</a>._

  val <a title="String" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers.phaseName">phaseName</a> = <span title="String(&quot;inlinehandlers&quot;)" class="string">&quot;inlinehandlers&quot;</span>

  <span class="comment">/** Create a new phase */</span>
  override def <a title="(p: scala.tools.nsc.Phase)InlineExceptionHandlers.this.InlineExceptionHandlersPhase" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers.newPhase">newPhase</a><span class="delimiter">(</span><a title="scala.tools.nsc.Phase" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers.newPhase.p">p</a>: <a href="../../../../reflect/internal/Phase.scala.html#scala.reflect.internal;Phase" title="scala.tools.nsc.Phase">Phase</a><span class="delimiter">)</span> = new <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase" title="InlineExceptionHandlers.this.InlineExceptionHandlersPhase">InlineExceptionHandlersPhase</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers.newPhase.p" title="scala.tools.nsc.Phase">p</a><span class="delimiter">)</span>

  override def <a title="=&gt; Boolean" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers.enabled">enabled</a> = <a href="../../Global.scala.html#scala.tools.nsc;Global.settings" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../../../reflect/internal/settings/MutableSettings.scala.html#scala.reflect.internal.settings.MutableSettings.reflectSettingToBoolean" title="implicit scala.reflect.internal.settings.MutableSettings.reflectSettingToBoolean : (s: scala.reflect.internal.settings.MutableSettings#BooleanSetting)Boolean">inlineHandlers</a>

  <span class="comment">/**
    * Inlining Exception Handlers
    */</span>
  class <a title="class InlineExceptionHandlersPhase extends InlineExceptionHandlers.this.global.icodes.ICodePhase" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase">InlineExceptionHandlersPhase</a><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase" title="InlineExceptionHandlers.this.InlineExceptionHandlersPhase" class="delimiter">(</a><a title="scala.tools.nsc.Phase" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.prev">prev</a>: <a href="../../../../reflect/internal/Phase.scala.html#scala.reflect.internal;Phase" title="scala.tools.nsc.Phase">Phase</a><span class="delimiter">)</span> extends <a href="../icode/ICodes.scala.html#scala.tools.nsc.backend.icode;ICodes;ICodePhase" title="InlineExceptionHandlers.this.global.icodes.ICodePhase">ICodePhase</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.prev" title="scala.tools.nsc.Phase">prev</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    def <a title="=&gt; String" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.name">name</a> = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers.phaseName" title="=&gt; String">phaseName</a>

    <span class="comment">/* This map is used to keep track of duplicated exception handlers
     * explanation: for each exception handler basic block, there is a copy of it
     * -some exception handler basic blocks might not be duplicated because they have an unknown format =&gt; Option[(...)]
     * -some exception handler duplicates expect the exception on the stack while others expect it in a local
     *   =&gt; Option[Local]
     */</span>
    private val <a title="scala.collection.mutable.HashMap[InlineExceptionHandlers.this.global.icodes.BasicBlock,Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)]]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerCopies">handlerCopies</a> = <a href="../../../../reflect/internal/SymbolTable.scala.html#scala.reflect.internal;SymbolTable.perRunCaches" title="InlineExceptionHandlers.this.global.perRunCaches.type">perRunCaches</a>.<a href="../../../../reflect/internal/SymbolTable.scala.html#scala.reflect.internal;SymbolTable.perRunCaches.newMap" title="[K, V]()scala.collection.mutable.HashMap[K,V]">newMap</a><span title="()scala.collection.mutable.HashMap[InlineExceptionHandlers.this.global.icodes.BasicBlock,Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)]]" class="delimiter">[</span><a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">BasicBlock</a>, <a href="../../../../Option.scala.html#scala;Option" title="Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)]">Option</a><span class="delimiter">[</span><span class="delimiter">(</span>Option<span class="delimiter">[</span>Local<span class="delimiter">]</span>, BasicBlock<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="comment">/* This map is the inverse of handlerCopies, used to compute the stack of duplicate blocks */</span>
    private val <a title="scala.collection.mutable.HashMap[InlineExceptionHandlers.this.global.icodes.BasicBlock,(InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind)]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerCopiesInverted">handlerCopiesInverted</a> = <a href="../../../../reflect/internal/SymbolTable.scala.html#scala.reflect.internal;SymbolTable.perRunCaches" title="InlineExceptionHandlers.this.global.perRunCaches.type">perRunCaches</a>.<a href="../../../../reflect/internal/SymbolTable.scala.html#scala.reflect.internal;SymbolTable.perRunCaches.newMap" title="[K, V]()scala.collection.mutable.HashMap[K,V]">newMap</a><span title="()scala.collection.mutable.HashMap[InlineExceptionHandlers.this.global.icodes.BasicBlock,(InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind)]" class="delimiter">[</span><a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">BasicBlock</a>, <a href="../../../../Tuple2.scala.html#scala;Tuple2" title="(InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind)" class="delimiter">(</a>BasicBlock, TypeKind<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    private def <a title="(bb: InlineExceptionHandlers.this.global.icodes.BasicBlock)Option[InlineExceptionHandlers.this.global.icodes.Local]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerLocal">handlerLocal</a><span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.BasicBlock" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerLocal.bb">bb</a>: <a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">BasicBlock</a><span class="delimiter">)</span>: <a href="../../../../Option.scala.html#scala;Option" title="Option[InlineExceptionHandlers.this.global.icodes.Local]">Option</a><span class="delimiter">[</span>Local<span class="delimiter">]</span> =
      for <span class="delimiter">(</span><a title="Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerLocal.$anonfun.v">v</a> &lt;- <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerCopies" title="=&gt; scala.collection.mutable.HashMap[InlineExceptionHandlers.this.global.icodes.BasicBlock,Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)]]">handlerCopies</a> <a href="../../../../Option.scala.html#scala;Option.flatMap" title="(f: Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)] =&gt; Option[InlineExceptionHandlers.this.global.icodes.Local])Option[InlineExceptionHandlers.this.global.icodes.Local]">get</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerLocal.bb" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bb</a> ; <span class="delimiter">(</span><a title="Option[InlineExceptionHandlers.this.global.icodes.Local]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerLocal.$anonfun.$anonfun.local">local</a>, <a title="InlineExceptionHandlers.this.global.icodes.BasicBlock" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerLocal.$anonfun.$anonfun.block">block</a><span class="delimiter">)</span> &lt;- <a href="../../../../Option.scala.html#scala;Option;WithFilter.flatMap" title="(f: ((Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)) =&gt; Option[InlineExceptionHandlers.this.global.icodes.Local])Option[InlineExceptionHandlers.this.global.icodes.Local]">v</a> ; <a title="InlineExceptionHandlers.this.global.icodes.Local" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerLocal.$anonfun.$anonfun.$anonfun.l">l</a> &lt;- <a href="../../../../Option.scala.html#scala;Option.map" title="(f: InlineExceptionHandlers.this.global.icodes.Local =&gt; InlineExceptionHandlers.this.global.icodes.Local)Option[InlineExceptionHandlers.this.global.icodes.Local]">local</a><span class="delimiter">)</span> yield <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerLocal.$anonfun.$anonfun.$anonfun.l" title="InlineExceptionHandlers.this.global.icodes.Local">l</a>

    <span class="comment">/* Type Flow Analysis */</span>
    private val <a title="InlineExceptionHandlers.this.global.analysis.MethodTFA" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.tfa">tfa</a>: analysis.<a href="../icode/analysis/TypeFlowAnalysis.scala.html#scala.tools.nsc.backend.icode.analysis;TypeFlowAnalysis;MethodTFA" title="InlineExceptionHandlers.this.global.analysis.MethodTFA">MethodTFA</a> = new <a href="../../Global.scala.html#scala.tools.nsc;Global.analysis" title="InlineExceptionHandlers.this.global.analysis.type">analysis</a>.<a href="../icode/analysis/TypeFlowAnalysis.scala.html#scala.tools.nsc.backend.icode.analysis;TypeFlowAnalysis;MethodTFA" title="InlineExceptionHandlers.this.global.analysis.MethodTFA">MethodTFA</a><span class="delimiter">(</span><span class="delimiter">)</span>
    private var <a title="Map[Int,InlineExceptionHandlersPhase.this.tfa.lattice.Elem]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.tfaCache_=">tfaCache</a>: <a href="../../../../collection/immutable/Map.scala.html#scala.collection.immutable;Map" title="Map[Int,InlineExceptionHandlersPhase.this.tfa.lattice.Elem]">Map</a><span class="delimiter">[</span>Int, tfa.lattice.Elem<span class="delimiter">]</span> = <a href="../../../../Predef.scala.html#scala.Predef.Map" title="=&gt; scala.collection.immutable.Map.type">Map</a>.<a href="../../../../collection/immutable/Map.scala.html#scala.collection.immutable.Map.empty" title="scala.collection.immutable.Map[Int,Nothing]">empty</a>
    private var <a title="InlineExceptionHandlers.this.global.icodes.IMethod" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.analyzedMethod_=">analyzedMethod</a>: <a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members;IMethod" title="InlineExceptionHandlers.this.global.icodes.IMethod">IMethod</a> = <a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members.NoIMethod" title="InlineExceptionHandlers.this.global.icodes.NoIMethod.type">NoIMethod</a>

    <span class="comment">/* Blocks that need to be analyzed */</span>
    private var <a title="List[InlineExceptionHandlers.this.global.icodes.BasicBlock]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.todoBlocks_=">todoBlocks</a>: <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable;List" title="List[InlineExceptionHandlers.this.global.icodes.BasicBlock]">List</a><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span> = <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable.Nil" title="scala.collection.immutable.Nil.type">Nil</a>

    <span class="comment">/* Used only for warnings */</span>
    private var <a title="InlineExceptionHandlers.this.global.icodes.IClass" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.currentClass_=">currentClass</a>: <a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members;IClass" title="InlineExceptionHandlers.this.global.icodes.IClass">IClass</a> = null

    <span class="comment">/** Apply exception handler inlining to a class */</span>
    override def <a title="(c: InlineExceptionHandlers.this.global.icodes.IClass)Unit" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.apply(06865afe83)">apply</a><span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.IClass" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.apply(06865afe83).c">c</a>: <a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members;IClass" title="InlineExceptionHandlers.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span>: <a href="../../../../Unit.scala.html#scala;Unit" title="Unit">Unit</a> =
      if <span class="delimiter">(</span><a href="../../Global.scala.html#scala.tools.nsc;Global.settings" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../../../reflect/internal/settings/MutableSettings.scala.html#scala.reflect.internal.settings.MutableSettings.reflectSettingToBoolean" title="implicit scala.reflect.internal.settings.MutableSettings.reflectSettingToBoolean : (s: scala.reflect.internal.settings.MutableSettings#BooleanSetting)Boolean">inlineHandlers</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        val <a title="Long" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.apply(06865afe83).startTime">startTime</a> = <span title="System.type">System</span>.<span title="()Long">nanoTime</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.currentClass_=" title="(x$1: InlineExceptionHandlers.this.global.icodes.IClass)Unit">currentClass</a> = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.apply(06865afe83).c" title="InlineExceptionHandlers.this.global.icodes.IClass">c</a>

        <a href="../../Global.scala.html#scala.tools.nsc;Global.debuglog" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Starting InlineExceptionHandlers on &quot;)" class="string">&quot;Starting InlineExceptionHandlers on &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.apply(06865afe83).c" title="InlineExceptionHandlers.this.global.icodes.IClass">c</a><span class="delimiter">)</span>
        <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.apply(06865afe83).c" title="InlineExceptionHandlers.this.global.icodes.IClass">c</a>.<a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members;IClass.methods" title="=&gt; List[InlineExceptionHandlers.this.global.icodes.IMethod]">methods</a> <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable;List.foreach" title="(f: InlineExceptionHandlers.this.global.icodes.IMethod =&gt; Unit)Unit">foreach</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyMethod" title="(method: InlineExceptionHandlers.this.global.icodes.IMethod)Unit">applyMethod</a>
        <a href="../../Global.scala.html#scala.tools.nsc;Global.debuglog" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Finished InlineExceptionHandlers on &quot;)" class="string">&quot;Finished InlineExceptionHandlers on &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.apply(06865afe83).c" title="InlineExceptionHandlers.this.global.icodes.IClass">c</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;... &quot;)" class="string">&quot;... &quot;</span> <span title="(x$1: Any)String">+</span> TimeUnit.<span title="java.util.concurrent.TimeUnit(NANOSECONDS)">NANOSECONDS</span>.<span title="(x$1: Long)Long">toMillis</span><span class="delimiter">(</span><span title="System.type">System</span>.<span title="()Long">nanoTime</span><span class="delimiter">(</span><span class="delimiter">)</span> <a href="../../../../Long.scala.html#scala;Long.-(89ec8b5973)" title="(x: Long)Long">-</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.apply(06865afe83).startTime" title="Long">startTime</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot;ms&quot;)" class="string">&quot;ms&quot;</span><span class="delimiter">)</span>
        <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.currentClass_=" title="(x$1: InlineExceptionHandlers.this.global.icodes.IClass)Unit">currentClass</a> = null
      <span class="delimiter">}</span>

    <span class="comment">/**
      * Apply exception handler inlining to a method
      *
      * Note: for each exception handling block, we (might) create duplicates. Therefore we iterate until we get to a
      * fixed point where all the possible handlers have been inlined.
      *
      * TODO: Should we have an inlining depth limit? A nested sequence of n try-catch blocks can lead to at most 2n
      * inlined blocks, so worst case scenario we double the size of the code
      */</span>
    private def <a title="(method: InlineExceptionHandlers.this.global.icodes.IMethod)Unit" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyMethod">applyMethod</a><span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.IMethod" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyMethod.method">method</a>: <a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members;IMethod" title="InlineExceptionHandlers.this.global.icodes.IMethod">IMethod</a><span class="delimiter">)</span>: <a href="../../../../Unit.scala.html#scala;Unit" title="Unit">Unit</a> = <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyMethod.method" title="InlineExceptionHandlers.this.global.icodes.IMethod">method</a>.<a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members;IMethod.hasCode" title="=&gt; Boolean">hasCode</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">// create the list of starting blocks</span>
        <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.todoBlocks_=" title="(x$1: List[InlineExceptionHandlers.this.global.icodes.BasicBlock])Unit">todoBlocks</a> = <a href="../../SubComponent.scala.html#scala.tools.nsc;SubComponent.global" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../../Global.scala.html#scala.tools.nsc;Global.icodes" title="InlineExceptionHandlers.this.global.icodes.type">icodes</a>.<a href="../icode/ICodes.scala.html#scala.tools.nsc.backend.icode;ICodes.linearizer" title="=&gt; InlineExceptionHandlers.this.global.icodes.Linearizer">linearizer</a>.<a href="../icode/Linearizers.scala.html#scala.tools.nsc.backend.icode;Linearizers;Linearizer.linearize" title="(c: InlineExceptionHandlers.this.global.icodes.IMethod)List[InlineExceptionHandlers.this.global.icodes.BasicBlock]">linearize</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyMethod.method" title="InlineExceptionHandlers.this.global.icodes.IMethod">method</a><span class="delimiter">)</span>

        while <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.todoBlocks_=" title="=&gt; List[InlineExceptionHandlers.this.global.icodes.BasicBlock]">todoBlocks</a>.<a href="../../../../collection/TraversableOnce.scala.html#scala.collection;TraversableOnce.nonEmpty" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyMethod.while$1" title="()Unit" class="delimiter">{</a>
          val <a title="List[InlineExceptionHandlers.this.global.icodes.BasicBlock]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyMethod.levelBlocks">levelBlocks</a> = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.todoBlocks_=" title="=&gt; List[InlineExceptionHandlers.this.global.icodes.BasicBlock]">todoBlocks</a>
          <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.todoBlocks_=" title="(x$1: List[InlineExceptionHandlers.this.global.icodes.BasicBlock])Unit">todoBlocks</a> = <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable.Nil" title="scala.collection.immutable.Nil.type">Nil</a>
          <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyMethod.levelBlocks" title="List[InlineExceptionHandlers.this.global.icodes.BasicBlock]">levelBlocks</a> <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable;List.foreach" title="(f: InlineExceptionHandlers.this.global.icodes.BasicBlock =&gt; Unit)Unit">foreach</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock" title="(bblock: InlineExceptionHandlers.this.global.icodes.BasicBlock)Unit">applyBasicBlock</a> <span class="comment">// new blocks will be added to todoBlocks</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="comment">// Cleanup the references after we finished the file</span>
      <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerCopies" title="=&gt; scala.collection.mutable.HashMap[InlineExceptionHandlers.this.global.icodes.BasicBlock,Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)]]">handlerCopies</a>.<a href="../../../../collection/mutable/HashMap.scala.html#scala.collection.mutable;HashMap.clear" title="()Unit">clear</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerCopiesInverted" title="=&gt; scala.collection.mutable.HashMap[InlineExceptionHandlers.this.global.icodes.BasicBlock,(InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind)]">handlerCopiesInverted</a>.<a href="../../../../collection/mutable/HashMap.scala.html#scala.collection.mutable;HashMap.clear" title="()Unit">clear</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.todoBlocks_=" title="(x$1: List[InlineExceptionHandlers.this.global.icodes.BasicBlock])Unit">todoBlocks</a> = <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable.Nil" title="scala.collection.immutable.Nil.type">Nil</a>

      <span class="comment">// Type flow analysis cleanup</span>
      <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.analyzedMethod_=" title="(x$1: InlineExceptionHandlers.this.global.icodes.IMethod)Unit">analyzedMethod</a> = <a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members.NoIMethod" title="InlineExceptionHandlers.this.global.icodes.NoIMethod.type">NoIMethod</a>
      <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.tfaCache_=" title="(x$1: Map[Int,InlineExceptionHandlersPhase.this.tfa.lattice.Elem])Unit">tfaCache</a> = <a href="../../../../Predef.scala.html#scala.Predef.Map" title="=&gt; scala.collection.immutable.Map.type">Map</a>.<a href="../../../../collection/immutable/Map.scala.html#scala.collection.immutable.Map.empty" title="scala.collection.immutable.Map[Int,Nothing]">empty</a>
      <span class="comment">//TODO: Need a way to clear tfa structures</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Apply exception handler inlining to a basic block  */</span>
    private def <a title="(bblock: InlineExceptionHandlers.this.global.icodes.BasicBlock)Unit" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock">applyBasicBlock</a><span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.BasicBlock" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock">bblock</a>: <a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">BasicBlock</a><span class="delimiter">)</span>: <a href="../../../../Unit.scala.html#scala;Unit" title="Unit">Unit</a> = <span class="delimiter">{</span>
      <span class="comment">/*
       * The logic of this entire method:
       *  - for each basic block, we look at each instruction until we find a THROW instruction
       *  - once we found a THROW instruction, we decide if it is DECIDABLE which of handler will catch the exception
       *  (see method findExceptionHandler for more details)
       *  - if we decided there is a handler that will catch the exception, we need to replace the THROW instruction by
       *  a set of equivalent instructions:
       *    * we need to compute the static types of the stack slots
       *    * we need to clear the stack, everything but the exception instance on top (or in a local variable slot)
       *    * we need to JUMP to the duplicate exception handler
       *  - we compute the static types of the stack slots in function getTypesAtInstruction
       *  - we duplicate the exception handler (and we get back the information of whether the duplicate expects the
       *  exception instance on top of the stack or in a local variable slot)
       *  - we compute the necessary code to put the exception in its place, clear the stack and JUMP
       *  - we change the THROW exception to the new Clear stack + JUMP code
       */</span>
      for <span class="delimiter">{</span>
        <span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.opcodes.THROW" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.instr">instr</a> @ THROW<span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.global.Symbol" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.clazz">clazz</a><span class="delimiter">)</span>, <a title="Int" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.index">index</a><span class="delimiter">)</span> &lt;- <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.iterator" title="=&gt; Iterator[InlineExceptionHandlers.this.global.icodes.Instruction]">iterator</a>.<a href="../../../../collection/Iterator.scala.html#scala.collection;Iterator.foreach" title="(f: ((InlineExceptionHandlers.this.global.icodes.Instruction, Int)) =&gt; Unit)Unit">zipWithIndex</a>
        <span class="comment">// Decide if any handler fits this exception</span>
        <span class="comment">// If not, then nothing to do, we cannot determine statically which handler will catch the exception</span>
        <span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.BasicBlock" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.handler">handler</a>, <a title="InlineExceptionHandlers.this.global.icodes.TypeKind" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.caughtException">caughtException</a><span class="delimiter">)</span>    &lt;- <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler" title="(thrownException: InlineExceptionHandlers.this.global.icodes.TypeKind, handlers: List[InlineExceptionHandlers.this.global.icodes.BasicBlock])Option[(InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind)]">findExceptionHandler</a><a href="../../../../Option.scala.html#scala;Option;WithFilter.foreach" title="(f: ((InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind)) =&gt; Unit)Unit" class="delimiter">(</a><a href="../icode/TypeKinds.scala.html#scala.tools.nsc.backend.icode;TypeKinds.toTypeKind" title="(t: InlineExceptionHandlers.this.global.icodes.global.Type)InlineExceptionHandlers.this.global.icodes.TypeKind">toTypeKind</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.clazz" title="InlineExceptionHandlers.this.global.icodes.global.Symbol">clazz</a>.<a href="../../../../reflect/internal/Symbols.scala.html#scala.reflect.internal;Symbols;Symbol.tpe" title="=&gt; InlineExceptionHandlers.this.global.icodes.global.Type">tpe</a><span class="delimiter">)</span>, <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.exceptionSuccessors" title="=&gt; List[InlineExceptionHandlers.this.global.icodes.BasicBlock]">exceptionSuccessors</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="delimiter">{</span>
        <a href="../../Global.scala.html#scala.tools.nsc;Global.log" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;   Replacing &quot;)" class="string">&quot;   Replacing &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.instr" title="InlineExceptionHandlers.this.global.icodes.opcodes.THROW">instr</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; in &quot;)" class="string">&quot; in &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; to new handler&quot;)" class="string">&quot; to new handler&quot;</span><span class="delimiter">)</span>

        <span class="comment">// Solve the stack and drop the element that we already stored, which should be the exception</span>
        <span class="comment">// needs to be done here to be the first thing before code becomes altered</span>
        val <a title="List[InlineExceptionHandlers.this.global.icodes.TypeKind]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.typeInfo">typeInfo</a> = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction" title="(bblock: InlineExceptionHandlers.this.global.icodes.BasicBlock, index: Int)List[InlineExceptionHandlers.this.global.icodes.TypeKind]">getTypesAtInstruction</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>, <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.index" title="Int">index</a><span class="delimiter">)</span>

        <span class="comment">// Duplicate exception handler</span>
        <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandlerCache" title="(handler: InlineExceptionHandlers.this.global.icodes.BasicBlock)Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)]">duplicateExceptionHandlerCache</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
          case <a href="../../../../Option.scala.html#scala.None" title="None.type">None</a> =&gt;
            <a href="../../Global.scala.html#scala.tools.nsc;Global.log" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;   Could not duplicate handler for &quot;)" class="string">&quot;   Could not duplicate handler for &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.instr" title="InlineExceptionHandlers.this.global.icodes.opcodes.THROW">instr</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; in &quot;)" class="string">&quot; in &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a><span class="delimiter">)</span>

          case Some<span class="delimiter">(</span><span class="delimiter">(</span><a title="Option[InlineExceptionHandlers.this.global.icodes.Local]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.exceptionLocalOpt">exceptionLocalOpt</a>, <a title="InlineExceptionHandlers.this.global.icodes.BasicBlock" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newHandler">newHandler</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
            val <a title="InlineExceptionHandlers.this.global.icodes.TypeKind" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.onStackException">onStackException</a> = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.typeInfo" title="List[InlineExceptionHandlers.this.global.icodes.TypeKind]">typeInfo</a>.<a href="../../../../collection/IterableLike.scala.html#scala.collection;IterableLike.head" title="=&gt; InlineExceptionHandlers.this.global.icodes.TypeKind">head</a>
            val <a title="InlineExceptionHandlers.this.global.icodes.TypeKind" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.thrownException">thrownException</a>  = <a href="../icode/TypeKinds.scala.html#scala.tools.nsc.backend.icode;TypeKinds.toTypeKind" title="(t: InlineExceptionHandlers.this.global.icodes.global.Type)InlineExceptionHandlers.this.global.icodes.TypeKind">toTypeKind</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.clazz" title="InlineExceptionHandlers.this.global.icodes.global.Symbol">clazz</a>.<a href="../../../../reflect/internal/Symbols.scala.html#scala.reflect.internal;Symbols;Symbol.tpe" title="=&gt; InlineExceptionHandlers.this.global.icodes.global.Type">tpe</a><span class="delimiter">)</span>

            <span class="comment">// A couple of sanity checks, to make sure we don't touch code we can't safely handle</span>
            val canReplaceHandler = <span class="delimiter">(</span>
                  <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.typeInfo" title="List[InlineExceptionHandlers.this.global.icodes.TypeKind]">typeInfo</a>.<a href="../../../../collection/TraversableOnce.scala.html#scala.collection;TraversableOnce.nonEmpty" title="=&gt; Boolean">nonEmpty</a>
              <a href="../../../../Boolean.scala.html#scala;Boolean.&&" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.index" title="Int">index</a> <a href="../../../../Int.scala.html#scala;Int.==(5f58a84eb3)" title="(x: Int)Boolean">==</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.length" title="=&gt; Int">length</a> <a href="../../../../Int.scala.html#scala;Int.-(1409840560)" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
              <a href="../../../../Boolean.scala.html#scala;Boolean.&&" title="Boolean" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.canReplaceHandler">&amp;&amp;</a> <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.onStackException" title="InlineExceptionHandlers.this.global.icodes.TypeKind">onStackException</a> <a href="../icode/TypeKinds.scala.html#scala.tools.nsc.backend.icode;TypeKinds;TypeKind.<:<" title="(other: InlineExceptionHandlers.this.global.icodes.TypeKind)Boolean">&lt;:&lt;</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.thrownException" title="InlineExceptionHandlers.this.global.icodes.TypeKind">thrownException</a><span class="delimiter">)</span>
            <span class="delimiter">)</span>
            <span class="comment">// in other words: what's on the stack MUST conform to what's in the THROW(..)!</span>

            if <span class="delimiter">(</span><a href="../../../../Boolean.scala.html#scala;Boolean.unary_!" title="=&gt; Boolean">!</a><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.canReplaceHandler" title="Boolean">canReplaceHandler</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="../../Global.scala.html#scala.tools.nsc;Global.reporter" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../../../../reflect/internal/Reporting.scala.html#scala.reflect.internal;Reporter.warning" title="(pos: scala.reflect.internal.util.Position, msg: String)Unit">warning</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Positions.scala.html#scala.reflect.internal;Positions.NoPosition" title="=&gt; reflect.internal.util.NoPosition.type">NoPosition</a>, <span class="string">&quot;Unable to inline the exception handler inside incorrect&quot;</span> <span title="String(&quot;Unable to inline the exception handler inside incorrect block:\n&quot;)">+</span>
                <span class="string">&quot; block:\n&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.iterator" title="=&gt; Iterator[InlineExceptionHandlers.this.global.icodes.Instruction]">iterator</a>.<a href="../../../../collection/TraversableOnce.scala.html#scala.collection;TraversableOnce.mkString(f5d728d244)" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\nwith stack: &quot;)" class="string">&quot;\nwith stack: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.typeInfo" title="List[InlineExceptionHandlers.this.global.icodes.TypeKind]">typeInfo</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; just &quot;)" class="string">&quot; just &quot;</span> <span title="(x$1: Any)String">+</span>
                <span title="String(&quot;before instruction index &quot;)" class="string">&quot;before instruction index &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.index" title="Int">index</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            else <span class="delimiter">{</span>
              <span class="comment">// Prepare the new code to replace the THROW instruction</span>
              val <a title="List[InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode">newCode</a> = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.exceptionLocalOpt" title="Option[InlineExceptionHandlers.this.global.icodes.Local]">exceptionLocalOpt</a> match <span class="delimiter">{</span>
                <span class="comment">// the handler duplicate expects the exception in a local: easy one :)</span>
                case Some<span class="delimiter">(</span><span title="InlineExceptionHandlers.this.global.icodes.Local">local</span><span class="delimiter">)</span> =&gt;
                  <span class="comment">// in the first cycle we remove the exception Type</span>
                  <a href="../icode/Opcodes.scala.html#scala.tools.nsc.backend.icode;Opcodes.opcodes;STORE_LOCAL" title="(local: InlineExceptionHandlers.this.global.icodes.Local)InlineExceptionHandlers.this.global.icodes.opcodes.STORE_LOCAL">STORE_LOCAL</a><span class="delimiter">(</span><span title="InlineExceptionHandlers.this.global.icodes.Local">local</span><span class="delimiter">)</span> <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable;List.+:" title="(elem: InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable)(implicit bf: scala.collection.generic.CanBuildFrom[List[InlineExceptionHandlers.this.global.icodes.opcodes.DROP],InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable,List[InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable]])List[InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable]">+:</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.typeInfo" title="List[InlineExceptionHandlers.this.global.icodes.TypeKind]">typeInfo</a>.<a href="../../../../collection/TraversableLike.scala.html#scala.collection;TraversableLike.tail" title="=&gt; List[InlineExceptionHandlers.this.global.icodes.TypeKind]">tail</a>.<a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable;List.map" title="(f: InlineExceptionHandlers.this.global.icodes.TypeKind =&gt; InlineExceptionHandlers.this.global.icodes.opcodes.DROP)(implicit bf: scala.collection.generic.CanBuildFrom[List[InlineExceptionHandlers.this.global.icodes.TypeKind],InlineExceptionHandlers.this.global.icodes.opcodes.DROP,List[InlineExceptionHandlers.this.global.icodes.opcodes.DROP]])List[InlineExceptionHandlers.this.global.icodes.opcodes.DROP]">map</a><a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable.List.canBuildFrom" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,InlineExceptionHandlers.this.global.icodes.opcodes.DROP,List[InlineExceptionHandlers.this.global.icodes.opcodes.DROP]]" class="delimiter">(</a><a title="InlineExceptionHandlers.this.global.icodes.TypeKind" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode.$anonfun.x">x</a> =&gt; <a href="../icode/Opcodes.scala.html#scala.tools.nsc.backend.icode;Opcodes.opcodes;DROP" title="(typ: InlineExceptionHandlers.this.global.icodes.TypeKind)InlineExceptionHandlers.this.global.icodes.opcodes.DROP">DROP</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode.$anonfun.x" title="InlineExceptionHandlers.this.global.icodes.TypeKind">x</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../collection/SeqLike.scala.html#scala.collection;SeqLike.:+" title="(elem: InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable)(implicit bf: scala.collection.generic.CanBuildFrom[List[InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable],InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable,List[InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable]])List[InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable]">:+</a> <a href="../icode/Opcodes.scala.html#scala.tools.nsc.backend.icode;Opcodes.opcodes;JUMP" title="(whereto: InlineExceptionHandlers.this.global.icodes.BasicBlock)InlineExceptionHandlers.this.global.icodes.opcodes.JUMP">JUMP</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newHandler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">newHandler</a><span class="delimiter">)</span>

                <span class="comment">// we already have the exception on top of the stack, only need to JUMP</span>
                case <a href="../../../../Option.scala.html#scala.None" title="None.type">None</a> if <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.typeInfo" title="List[InlineExceptionHandlers.this.global.icodes.TypeKind]">typeInfo</a>.<a href="../../../../collection/LinearSeqOptimized.scala.html#scala.collection;LinearSeqOptimized.length" title="=&gt; Int">length</a> <a href="../../../../Int.scala.html#scala;Int.==(5f58a84eb3)" title="(x: Int)Boolean">==</a> <span title="Int(1)" class="int">1</span> =&gt;
                  <a href="../icode/Opcodes.scala.html#scala.tools.nsc.backend.icode;Opcodes.opcodes;JUMP" title="(whereto: InlineExceptionHandlers.this.global.icodes.BasicBlock)InlineExceptionHandlers.this.global.icodes.opcodes.JUMP">JUMP</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newHandler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">newHandler</a><span class="delimiter">)</span> <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable;List.::" title="(x: InlineExceptionHandlers.this.global.icodes.opcodes.JUMP)List[InlineExceptionHandlers.this.global.icodes.opcodes.JUMP]">::</a> <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable.Nil" title="scala.collection.immutable.Nil.type">Nil</a>

                <span class="comment">// we have the exception on top of the stack but we have other stuff on the stack</span>
                <span class="comment">// create a local, load exception, clear the stack and finally store the exception on the stack</span>
                case _ =&gt;
                  val <a title="InlineExceptionHandlers.this.global.icodes.TypeKind" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode.exceptionType">exceptionType</a> = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.typeInfo" title="List[InlineExceptionHandlers.this.global.icodes.TypeKind]">typeInfo</a>.<a href="../../../../collection/IterableLike.scala.html#scala.collection;IterableLike.head" title="=&gt; InlineExceptionHandlers.this.global.icodes.TypeKind">head</a>
                  <span class="comment">// Here we could create a single local for all exceptions of a certain type. TODO: try that.</span>
                  val <a title="InlineExceptionHandlers.this.global.icodes.global.TermName" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode.localName">localName</a>   = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.currentClass_=" title="=&gt; InlineExceptionHandlers.this.global.icodes.IClass">currentClass</a>.<a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members;IClass.cunit" title="=&gt; InlineExceptionHandlers.this.global.icodes.global.CompilationUnit">cunit</a>.<a href="../../CompilationUnits.scala.html#scala.tools.nsc;CompilationUnits;CompilationUnit.freshTermName" title="(prefix: String)InlineExceptionHandlers.this.global.icodes.global.TermName">freshTermName</a><span class="delimiter">(</span><span title="String(&quot;exception$&quot;)" class="string">&quot;exception$&quot;</span><span class="delimiter">)</span>
                  val <a title="InlineExceptionHandlers.this.global.icodes.TypeKind" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode.localType">localType</a>   = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode.exceptionType" title="InlineExceptionHandlers.this.global.icodes.TypeKind">exceptionType</a>
                  val <a title="InlineExceptionHandlers.this.global.icodes.global.TermSymbol" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode.localSymbol">localSymbol</a> = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.method" title="=&gt; InlineExceptionHandlers.this.global.icodes.IMethod">method</a>.<a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members;IMethod.symbol" title="=&gt; InlineExceptionHandlers.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#scala.reflect.internal;Symbols;Symbol.newValue" title="(name: InlineExceptionHandlers.this.global.icodes.global.TermName, pos: InlineExceptionHandlers.this.global.icodes.global.Position, newFlags: Long)InlineExceptionHandlers.this.global.icodes.global.TermSymbol">newValue</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode.localName" title="InlineExceptionHandlers.this.global.icodes.global.TermName">localName</a><span class="delimiter">)</span>.<a href="../../../../reflect/internal/Symbols.scala.html#scala.reflect.internal;Symbols;Symbol.setInfo" title="(info: InlineExceptionHandlers.this.global.icodes.global.Type)InlineExceptionHandlers.this.global.icodes.global.TermSymbol">setInfo</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode.localType" title="InlineExceptionHandlers.this.global.icodes.TypeKind">localType</a>.<a href="../icode/TypeKinds.scala.html#scala.tools.nsc.backend.icode;TypeKinds;TypeKind.toType" title="=&gt; InlineExceptionHandlers.this.global.icodes.global.Type">toType</a><span class="delimiter">)</span>
                  val <span title="InlineExceptionHandlers.this.global.icodes.Local">local</span>       = new <a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members;Local" title="InlineExceptionHandlers.this.global.icodes.Local">Local</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode.localSymbol" title="InlineExceptionHandlers.this.global.icodes.global.TermSymbol">localSymbol</a>, <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode.localType" title="InlineExceptionHandlers.this.global.icodes.TypeKind">localType</a>, false<span class="delimiter">)</span>

                  <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.method" title="=&gt; InlineExceptionHandlers.this.global.icodes.IMethod">method</a>.<a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members;IMethod.addLocal" title="(l: InlineExceptionHandlers.this.global.icodes.Local)InlineExceptionHandlers.this.global.icodes.Local">addLocal</a><span class="delimiter">(</span><span title="InlineExceptionHandlers.this.global.icodes.Local">local</span><span class="delimiter">)</span>

                  <span class="comment">// Save the exception, drop the stack and place back the exception</span>
                  <a href="../icode/Opcodes.scala.html#scala.tools.nsc.backend.icode;Opcodes.opcodes;STORE_LOCAL" title="(local: InlineExceptionHandlers.this.global.icodes.Local)InlineExceptionHandlers.this.global.icodes.opcodes.STORE_LOCAL">STORE_LOCAL</a><span class="delimiter">(</span><span title="InlineExceptionHandlers.this.global.icodes.Local">local</span><span class="delimiter">)</span> <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable;List.::" title="(x: InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable)List[InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable]">::</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.typeInfo" title="List[InlineExceptionHandlers.this.global.icodes.TypeKind]">typeInfo</a>.<a href="../../../../collection/TraversableLike.scala.html#scala.collection;TraversableLike.tail" title="=&gt; List[InlineExceptionHandlers.this.global.icodes.TypeKind]">tail</a>.<a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable;List.map" title="(f: InlineExceptionHandlers.this.global.icodes.TypeKind =&gt; InlineExceptionHandlers.this.global.icodes.opcodes.DROP)(implicit bf: scala.collection.generic.CanBuildFrom[List[InlineExceptionHandlers.this.global.icodes.TypeKind],InlineExceptionHandlers.this.global.icodes.opcodes.DROP,List[InlineExceptionHandlers.this.global.icodes.opcodes.DROP]])List[InlineExceptionHandlers.this.global.icodes.opcodes.DROP]">map</a><a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable.List.canBuildFrom" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,InlineExceptionHandlers.this.global.icodes.opcodes.DROP,List[InlineExceptionHandlers.this.global.icodes.opcodes.DROP]]" class="delimiter">(</a><a title="InlineExceptionHandlers.this.global.icodes.TypeKind" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode.x$4.$anonfun.x">x</a> =&gt; <a href="../icode/Opcodes.scala.html#scala.tools.nsc.backend.icode;Opcodes.opcodes;DROP" title="(typ: InlineExceptionHandlers.this.global.icodes.TypeKind)InlineExceptionHandlers.this.global.icodes.opcodes.DROP">DROP</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode.x$4.$anonfun.x" title="InlineExceptionHandlers.this.global.icodes.TypeKind">x</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable;List.:::" title="(prefix: List[InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable])List[InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable]">:::</a> <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable.List.apply" title="(xs: InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable*)List[InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable]">List</a><span class="delimiter">(</span><a href="../icode/Opcodes.scala.html#scala.tools.nsc.backend.icode;Opcodes.opcodes;LOAD_LOCAL" title="(local: InlineExceptionHandlers.this.global.icodes.Local)InlineExceptionHandlers.this.global.icodes.opcodes.LOAD_LOCAL">LOAD_LOCAL</a><span class="delimiter">(</span><span title="InlineExceptionHandlers.this.global.icodes.Local">local</span><span class="delimiter">)</span>, <a href="../icode/Opcodes.scala.html#scala.tools.nsc.backend.icode;Opcodes.opcodes;JUMP" title="(whereto: InlineExceptionHandlers.this.global.icodes.BasicBlock)InlineExceptionHandlers.this.global.icodes.opcodes.JUMP">JUMP</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newHandler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">newHandler</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
              <span class="comment">// replace THROW by the new code</span>
              <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.replaceInstruction(5884c16d3b)" title="(oldInstr: InlineExceptionHandlers.this.global.icodes.Instruction, is: List[InlineExceptionHandlers.this.global.icodes.Instruction])Boolean">replaceInstruction</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.instr" title="InlineExceptionHandlers.this.global.icodes.opcodes.THROW">instr</a>, <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newCode" title="List[InlineExceptionHandlers.this.global.icodes.Instruction with Product with Serializable]">newCode</a><span class="delimiter">)</span>

              <span class="comment">// notify the successors changed for the current block</span>
              <span class="comment">// notify the predecessors changed for the inlined handler block</span>
              <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.touched_=" title="(b: Boolean)Unit">touched</a> = true
              <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newHandler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">newHandler</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.touched_=" title="(b: Boolean)Unit">touched</a> = true

              <a href="../../Global.scala.html#scala.tools.nsc;Global.log" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;   Replaced  &quot;)" class="string">&quot;   Replaced  &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.instr" title="InlineExceptionHandlers.this.global.icodes.opcodes.THROW">instr</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; in &quot;)" class="string">&quot; in &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; to new handler&quot;)" class="string">&quot; to new handler&quot;</span><span class="delimiter">)</span>
              <a href="../../Global.scala.html#scala.tools.nsc;Global.log" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;OPTIMIZED class &quot;)" class="string">&quot;OPTIMIZED class &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.currentClass_=" title="=&gt; InlineExceptionHandlers.this.global.icodes.IClass">currentClass</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; method &quot;)" class="string">&quot; method &quot;</span> <span title="(x$1: Any)String">+</span>
                <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.method" title="=&gt; InlineExceptionHandlers.this.global.icodes.IMethod">method</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; block &quot;)" class="string">&quot; block &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; newhandler &quot;)" class="string">&quot; newhandler &quot;</span> <span title="(x$1: Any)String">+</span>
                <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.newHandler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">newHandler</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;:\n\t\t&quot;)" class="string">&quot;:\n\t\t&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.onStackException" title="InlineExceptionHandlers.this.global.icodes.TypeKind">onStackException</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; &lt;:&lt; &quot;)" class="string">&quot; &lt;:&lt; &quot;</span> <span title="(x$1: Any)String">+</span>
                <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.thrownException" title="InlineExceptionHandlers.this.global.icodes.TypeKind">thrownException</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; &lt;:&lt; &quot;)" class="string">&quot; &lt;:&lt; &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.applyBasicBlock.$anonfun.$anonfun.caughtException" title="InlineExceptionHandlers.this.global.icodes.TypeKind">caughtException</a><span class="delimiter">)</span>

          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
      * Gets the types on the stack at a certain point in the program. Note that we want to analyze the method lazily
      * and therefore use the analyzedMethod variable
      */</span>
    private def <a title="(bblock: InlineExceptionHandlers.this.global.icodes.BasicBlock, index: Int)List[InlineExceptionHandlers.this.global.icodes.TypeKind]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction">getTypesAtInstruction</a><span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.BasicBlock" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.bblock">bblock</a>: <a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="Int" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.index">index</a>: <a href="../../../../Int.scala.html#scala;Int" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable;List" title="List[InlineExceptionHandlers.this.global.icodes.TypeKind]">List</a><span class="delimiter">[</span>TypeKind<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="comment">// get the stack at the block entry</span>
      var <a title="InlineExceptionHandlersPhase.this.tfa.lattice.Elem" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.typeInfo">typeInfo</a> = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry" title="(bblock: InlineExceptionHandlers.this.global.icodes.BasicBlock)InlineExceptionHandlersPhase.this.tfa.lattice.Elem">getTypesAtBlockEntry</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a><span class="delimiter">)</span>

      <span class="comment">// perform tfa to the current instruction</span>
      <a href="../../Global.scala.html#scala.tools.nsc;Global.log" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;         stack at the beginning of block &quot;)" class="string">&quot;         stack at the beginning of block &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; in function &quot;)" class="string">&quot; in function &quot;</span> <span title="(x$1: Any)String">+</span>
        <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.method" title="=&gt; InlineExceptionHandlers.this.global.icodes.IMethod">method</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.typeInfo" title="InlineExceptionHandlersPhase.this.tfa.lattice.Elem">typeInfo</a>.<a href="../icode/analysis/SemiLattice.scala.html#scala.tools.nsc.backend.icode.analysis;SemiLattice;IState.stack" title="=&gt; InlineExceptionHandlers.this.global.analysis.global.icodes.TypeStack">stack</a><span class="delimiter">)</span>
      for <span class="delimiter">(</span><a title="Int" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.$anonfun.i">i</a> &lt;- <a href="../../../../Predef.scala.html#scala;LowPriorityImplicits.intWrapper" title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</a> <a href="../../../../collection/immutable/Range.scala.html#scala.collection.immutable;Range.foreach" title="(f: Int =&gt; Unit)Unit">to</a> <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.index" title="Int">index</a> <a href="../../../../Int.scala.html#scala;Int.-(1409840560)" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.typeInfo" title="InlineExceptionHandlersPhase.this.tfa.lattice.Elem">typeInfo</a> = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.tfa" title="=&gt; InlineExceptionHandlers.this.global.analysis.MethodTFA">tfa</a>.<a href="../icode/analysis/TypeFlowAnalysis.scala.html#scala.tools.nsc.backend.icode.analysis;TypeFlowAnalysis;MethodTFA.interpret" title="(in: InlineExceptionHandlers.this.global.analysis.typeFlowLattice.Elem, i: InlineExceptionHandlers.this.global.analysis.global.icodes.Instruction)InlineExceptionHandlers.this.global.analysis.typeFlowLattice.Elem">interpret</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.typeInfo" title="InlineExceptionHandlersPhase.this.tfa.lattice.Elem">typeInfo</a>, <a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.apply" title="(n: Int)InlineExceptionHandlers.this.global.icodes.Instruction">bblock</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.$anonfun.i" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="../../Global.scala.html#scala.tools.nsc;Global.log" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;         stack after interpret: &quot;)" class="string">&quot;         stack after interpret: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.typeInfo" title="InlineExceptionHandlersPhase.this.tfa.lattice.Elem">typeInfo</a>.<a href="../icode/analysis/SemiLattice.scala.html#scala.tools.nsc.backend.icode.analysis;SemiLattice;IState.stack" title="=&gt; InlineExceptionHandlers.this.global.analysis.global.icodes.TypeStack">stack</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; after instruction &quot;)" class="string">&quot; after instruction &quot;</span> <span title="(x$1: Any)String">+</span>
          <a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.apply" title="(n: Int)InlineExceptionHandlers.this.global.icodes.Instruction">bblock</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.$anonfun.i" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="../../Global.scala.html#scala.tools.nsc;Global.log" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;         stack before instruction &quot;)" class="string">&quot;         stack before instruction &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.index" title="Int">index</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; of block &quot;)" class="string">&quot; of block &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; in function &quot;)" class="string">&quot; in function &quot;</span> <span title="(x$1: Any)String">+</span>
        <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.method" title="=&gt; InlineExceptionHandlers.this.global.icodes.IMethod">method</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.typeInfo" title="InlineExceptionHandlersPhase.this.tfa.lattice.Elem">typeInfo</a>.<a href="../icode/analysis/SemiLattice.scala.html#scala.tools.nsc.backend.icode.analysis;SemiLattice;IState.stack" title="=&gt; InlineExceptionHandlers.this.global.analysis.global.icodes.TypeStack">stack</a><span class="delimiter">)</span>

      <span class="comment">// return the result</span>
      <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtInstruction.typeInfo" title="InlineExceptionHandlersPhase.this.tfa.lattice.Elem">typeInfo</a>.<a href="../icode/analysis/SemiLattice.scala.html#scala.tools.nsc.backend.icode.analysis;SemiLattice;IState.stack" title="=&gt; InlineExceptionHandlers.this.global.analysis.global.icodes.TypeStack">stack</a>.<a href="../icode/TypeStacks.scala.html#scala.tools.nsc.backend.icode;TypeStacks;TypeStack.types" title="=&gt; InlineExceptionHandlers.this.global.analysis.global.icodes.Rep">types</a>
    <span class="delimiter">}</span>

    <span class="comment">/**
      * Gets the stack at the block entry. Normally the typeFlowAnalysis should be run again, but we know how to compute
      * the stack for handler duplicates. For the locals, it's safe to assume the info from the original handler is
      * still valid (a more precise analysis can be done, but it's not necessary)
      */</span>
    private def <a title="(bblock: InlineExceptionHandlers.this.global.icodes.BasicBlock)InlineExceptionHandlersPhase.this.tfa.lattice.Elem" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry">getTypesAtBlockEntry</a><span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.BasicBlock" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.bblock">bblock</a>: <a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">BasicBlock</a><span class="delimiter">)</span>: tfa.lattice.<a href="../icode/analysis/SemiLattice.scala.html#scala.tools.nsc.backend.icode.analysis;SemiLattice;IState" title="InlineExceptionHandlersPhase.this.tfa.lattice.Elem">Elem</a> = <span class="delimiter">{</span>
      <span class="comment">// lazily perform tfa, because it's expensive</span>
      <span class="comment">// cache results by block label, as rewriting the code messes up the block's hashCode</span>
      if <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.analyzedMethod_=" title="=&gt; InlineExceptionHandlers.this.global.icodes.IMethod">analyzedMethod</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members.NoIMethod" title="InlineExceptionHandlers.this.global.icodes.NoIMethod.type">NoIMethod</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.analyzedMethod_=" title="(x$1: InlineExceptionHandlers.this.global.icodes.IMethod)Unit">analyzedMethod</a> = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.method" title="=&gt; InlineExceptionHandlers.this.global.icodes.IMethod">method</a>
        <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.tfa" title="=&gt; InlineExceptionHandlers.this.global.analysis.MethodTFA">tfa</a>.<a href="../icode/analysis/TypeFlowAnalysis.scala.html#scala.tools.nsc.backend.icode.analysis;TypeFlowAnalysis;MethodTFA.init(3a8c56c83f)" title="(m: InlineExceptionHandlers.this.global.analysis.global.icodes.IMethod)Unit">init</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.method" title="=&gt; InlineExceptionHandlers.this.global.icodes.IMethod">method</a><span class="delimiter">)</span>
        <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.tfa" title="=&gt; InlineExceptionHandlers.this.global.analysis.MethodTFA">tfa</a>.<a href="../icode/analysis/TypeFlowAnalysis.scala.html#scala.tools.nsc.backend.icode.analysis;TypeFlowAnalysis;MethodTFA.run" title="()Unit">run</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="../../Global.scala.html#scala.tools.nsc;Global.log" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;      performed tfa on method: &quot;)" class="string">&quot;      performed tfa on method: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.method" title="=&gt; InlineExceptionHandlers.this.global.icodes.IMethod">method</a><span class="delimiter">)</span>

        for <span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.BasicBlock" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.$anonfun.block">block</a> &lt;- <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.method" title="=&gt; InlineExceptionHandlers.this.global.icodes.IMethod">method</a>.<a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members;IMethod.blocks" title="=&gt; List[InlineExceptionHandlers.this.global.icodes.BasicBlock]">blocks</a>.<a href="../../../../collection/SeqLike.scala.html#scala.collection;SeqLike.sortBy" title="(f: InlineExceptionHandlers.this.global.icodes.BasicBlock =&gt; Int)(implicit ord: scala.math.Ordering[Int])List[InlineExceptionHandlers.this.global.icodes.BasicBlock]">sortBy</a><a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable;List.foreach" title="(f: InlineExceptionHandlers.this.global.icodes.BasicBlock =&gt; Unit)Unit" class="delimiter">(</a><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.$anonfun.x$8" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">_</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.label" title="=&gt; Int">label</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.tfaCache_=" title="(x$1: Map[Int,InlineExceptionHandlersPhase.this.tfa.lattice.Elem])Unit">tfaCache</a> <a href="../../../../collection/immutable/Map.scala.html#scala.collection.immutable;Map.+(f81ff2b7d7)" title="(kv: (Int, InlineExceptionHandlersPhase.this.tfa.lattice.Elem))scala.collection.immutable.Map[Int,InlineExceptionHandlersPhase.this.tfa.lattice.Elem]">+=</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.$anonfun.block" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">block</a>.<a href="../../../../Predef.scala.html#scala.Predef.ArrowAssoc(fefc64a42a)" title="(self: Int)ArrowAssoc[Int]">label</a> <a href="../../../../Predef.scala.html#scala.Predef;ArrowAssoc.->" title="(y: InlineExceptionHandlersPhase.this.tfa.lattice.Elem)(Int, InlineExceptionHandlersPhase.this.tfa.lattice.Elem)">-&gt;</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.tfa" title="=&gt; InlineExceptionHandlers.this.global.analysis.MethodTFA">tfa</a>.<a href="../../../../collection/MapLike.scala.html#scala.collection;MapLike.apply" title="(key: InlineExceptionHandlersPhase.this.tfa.P)InlineExceptionHandlersPhase.this.tfa.lattice.Elem">in</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.$anonfun.block" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">block</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="../../Global.scala.html#scala.tools.nsc;Global.log" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;         getting typeinfo at the beginning of block &quot;)" class="string">&quot;         getting typeinfo at the beginning of block &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a><span class="delimiter">)</span>

      <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.tfaCache_=" title="=&gt; Map[Int,InlineExceptionHandlersPhase.this.tfa.lattice.Elem]">tfaCache</a>.<a href="../../../../collection/MapLike.scala.html#scala.collection;MapLike.getOrElse" title="(key: Int, default: =&gt; InlineExceptionHandlersPhase.this.tfa.lattice.Elem)InlineExceptionHandlersPhase.this.tfa.lattice.Elem">getOrElse</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.label" title="=&gt; Int">label</a>, <span class="delimiter">{</span>
        <span class="comment">// this block was not analyzed, but it's a copy of some other block so its stack should be the same</span>
        <a href="../../Global.scala.html#scala.tools.nsc;Global.log" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;         getting typeinfo at the beginning of block &quot;)" class="string">&quot;         getting typeinfo at the beginning of block &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; as a copy of &quot;)" class="string">&quot; as a copy of &quot;</span> <span title="(x$1: Any)String">+</span>
          <a href="../../../../collection/mutable/HashMap.scala.html#scala.collection.mutable;HashMap.apply" title="(key: InlineExceptionHandlers.this.global.icodes.BasicBlock)(InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind)">handlerCopiesInverted</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a><span class="delimiter">)</span><span class="delimiter">)</span>
        val <a href="../../../../Tuple2.scala.html#scala;Tuple2" title="(InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind)" class="delimiter">(</a><a href="../../../../Tuple2.scala.html#scala;Tuple2._1" title="InlineExceptionHandlers.this.global.icodes.BasicBlock" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.origBlock">origBlock</a>, <a href="../../../../Tuple2.scala.html#scala;Tuple2._2" title="InlineExceptionHandlers.this.global.icodes.TypeKind" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.exception">exception</a><span class="delimiter">)</span> = <a href="../../../../collection/mutable/HashMap.scala.html#scala.collection.mutable;HashMap.apply" title="(key: InlineExceptionHandlers.this.global.icodes.BasicBlock)(InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind)">handlerCopiesInverted</a><a href="../../../../Tuple2.scala.html#scala;Tuple2" title="(InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind) @unchecked" class="delimiter">(</a><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.bblock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">bblock</a><span class="delimiter">)</span>
        val <a title="InlineExceptionHandlersPhase.this.tfa.lattice.Elem" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.typeInfo">typeInfo</a>               = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry" title="(bblock: InlineExceptionHandlers.this.global.icodes.BasicBlock)InlineExceptionHandlersPhase.this.tfa.lattice.Elem">getTypesAtBlockEntry</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.origBlock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">origBlock</a><span class="delimiter">)</span>
        val <a title="List[InlineExceptionHandlers.this.global.icodes.TypeKind]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.stack">stack</a>                  =
          if <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerLocal" title="(bb: InlineExceptionHandlers.this.global.icodes.BasicBlock)Option[InlineExceptionHandlers.this.global.icodes.Local]">handlerLocal</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.origBlock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">origBlock</a><span class="delimiter">)</span>.<a href="../../../../Option.scala.html#scala;Option.nonEmpty" title="=&gt; Boolean">nonEmpty</a><span class="delimiter">)</span> <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable.Nil" title="scala.collection.immutable.Nil.type">Nil</a>   <span class="comment">// empty stack, the handler copy expects an empty stack</span>
          else <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable.List.apply" title="(xs: InlineExceptionHandlers.this.global.icodes.TypeKind*)List[InlineExceptionHandlers.this.global.icodes.TypeKind]">List</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.exception" title="InlineExceptionHandlers.this.global.icodes.TypeKind">exception</a><span class="delimiter">)</span>                        <span class="comment">// one slot on the stack for the exception</span>

        <span class="comment">// If we use the mutability property, it crashes the analysis</span>
        <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.tfa" title="=&gt; InlineExceptionHandlers.this.global.analysis.MethodTFA">tfa</a>.<a href="../icode/analysis/TypeFlowAnalysis.scala.html#scala.tools.nsc.backend.icode.analysis;TypeFlowAnalysis;MethodTFA.lattice" title="=&gt; InlineExceptionHandlers.this.global.analysis.typeFlowLattice.type">lattice</a>.<a href="../icode/analysis/SemiLattice.scala.html#scala.tools.nsc.backend.icode.analysis;SemiLattice;IState" title="(vars: InlineExceptionHandlers.this.global.analysis.VarBinding, stack: InlineExceptionHandlers.this.global.icodes.TypeStack)InlineExceptionHandlersPhase.this.tfa.lattice.IState[InlineExceptionHandlers.this.global.analysis.VarBinding,InlineExceptionHandlers.this.global.icodes.TypeStack]">IState</a><span class="delimiter">(</span>new <a href="../../Global.scala.html#scala.tools.nsc;Global.analysis" title="InlineExceptionHandlers.this.global.analysis.type">analysis</a>.<a href="../icode/analysis/TypeFlowAnalysis.scala.html#scala.tools.nsc.backend.icode.analysis;TypeFlowAnalysis;VarBinding" title="InlineExceptionHandlers.this.global.analysis.VarBinding">VarBinding</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.typeInfo" title="InlineExceptionHandlersPhase.this.tfa.lattice.Elem">typeInfo</a>.<a href="../icode/analysis/SemiLattice.scala.html#scala.tools.nsc.backend.icode.analysis;SemiLattice;IState.vars" title="=&gt; InlineExceptionHandlers.this.global.analysis.VarBinding">vars</a><span class="delimiter">)</span>, new <a href="../../Global.scala.html#scala.tools.nsc;Global.icodes" title="InlineExceptionHandlers.this.global.icodes.type">icodes</a>.<a href="../icode/TypeStacks.scala.html#scala.tools.nsc.backend.icode;TypeStacks;TypeStack" title="InlineExceptionHandlers.this.global.icodes.TypeStack">TypeStack</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.getTypesAtBlockEntry.stack" title="List[InlineExceptionHandlers.this.global.icodes.TypeKind]">stack</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
      * Finds the first exception handler that matches the current exception
      *
      * Note the following code:
      * {{{
      * try {
      *   throw new IllegalArgumentException(&quot;...&quot;)
      * } catch {
      *   case e: RuntimeException =&gt; log(&quot;RuntimeException&quot;)
      *   case i: IllegalArgumentException =&gt; log(&quot;IllegalArgumentException&quot;)
      * }
      * }}}
      *
      * will print &quot;RuntimeException&quot; =&gt; we need the *first* valid handler
      *
      * There's a hidden catch here: say we have the following code:
      * {{{
      * try {
      *   val exception: Throwable =
      *     if (scala.util.Random.nextInt % 2 == 0)
      *       new IllegalArgumentException(&quot;even&quot;)
      *     else
      *       new StackOverflowError(&quot;odd&quot;)
      *   throw exception
      * } catch {
      *   case e: IllegalArgumentException =&gt;
      *     println(&quot;Correct, IllegalArgumentException&quot;)
      *   case e: StackOverflowError =&gt;
      *     println(&quot;Correct, StackOverflowException&quot;)
      *   case t: Throwable =&gt;
      *     println(&quot;WROOOONG, not Throwable!&quot;)
      * }
      * }}}
      *
      * We don't want to select a handler if there's at least one that's more specific!
      */</span>
    def <a title="(thrownException: InlineExceptionHandlers.this.global.icodes.TypeKind, handlers: List[InlineExceptionHandlers.this.global.icodes.BasicBlock])Option[(InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind)]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler">findExceptionHandler</a><span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.TypeKind" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler.thrownException">thrownException</a>: <a href="../icode/TypeKinds.scala.html#scala.tools.nsc.backend.icode;TypeKinds;TypeKind" title="InlineExceptionHandlers.this.global.icodes.TypeKind">TypeKind</a>, <a title="List[InlineExceptionHandlers.this.global.icodes.BasicBlock]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler.handlers">handlers</a>: <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable;List" title="List[InlineExceptionHandlers.this.global.icodes.BasicBlock]">List</a><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../Option.scala.html#scala;Option" title="Option[(InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind)]">Option</a><span class="delimiter">[</span><span class="delimiter">(</span>BasicBlock, TypeKind<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      for <span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.BasicBlock" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler.$anonfun.handler">handler</a> &lt;- <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable;List.foreach" title="(f: InlineExceptionHandlers.this.global.icodes.BasicBlock =&gt; Unit)Unit">handlers</a> ; LOAD_EXCEPTION<span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.global.Symbol" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler.$anonfun.$anonfun.clazz">clazz</a><span class="delimiter">)</span> &lt;- <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler.$anonfun.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a> <a href="../../../../collection/generic/FilterMonadic.scala.html#scala.collection.generic;FilterMonadic.foreach" title="(f: InlineExceptionHandlers.this.global.icodes.Instruction =&gt; Unit)Unit">take</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        val <a title="InlineExceptionHandlers.this.global.icodes.TypeKind" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler.$anonfun.$anonfun.caughtException">caughtException</a> = <a href="../icode/TypeKinds.scala.html#scala.tools.nsc.backend.icode;TypeKinds.toTypeKind" title="(t: InlineExceptionHandlers.this.global.icodes.global.Type)InlineExceptionHandlers.this.global.icodes.TypeKind">toTypeKind</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler.$anonfun.$anonfun.clazz" title="InlineExceptionHandlers.this.global.icodes.global.Symbol">clazz</a>.<a href="../../../../reflect/internal/Symbols.scala.html#scala.reflect.internal;Symbols;Symbol.tpe" title="=&gt; InlineExceptionHandlers.this.global.icodes.global.Type">tpe</a><span class="delimiter">)</span>
        <span class="comment">// we'll do inlining here: createdException &lt;:&lt; thrownException &lt;:&lt; caughtException, good!</span>
        if <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler.thrownException" title="InlineExceptionHandlers.this.global.icodes.TypeKind">thrownException</a> <a href="../icode/TypeKinds.scala.html#scala.tools.nsc.backend.icode;TypeKinds;TypeKind.<:<" title="(other: InlineExceptionHandlers.this.global.icodes.TypeKind)Boolean">&lt;:&lt;</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler.$anonfun.$anonfun.caughtException" title="InlineExceptionHandlers.this.global.icodes.TypeKind">caughtException</a><span class="delimiter">)</span>
          return <a href="../../../../Option.scala.html#scala;Some" title="(x: (InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind))Some[(InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind)]">Some</a><span class="delimiter">(</span><a href="../../../../Tuple2.scala.html#scala;Tuple2" title="(_1: InlineExceptionHandlers.this.global.icodes.BasicBlock, _2: InlineExceptionHandlers.this.global.icodes.TypeKind)(InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind)" class="delimiter">(</a><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler.$anonfun.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a>, <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler.$anonfun.$anonfun.caughtException" title="InlineExceptionHandlers.this.global.icodes.TypeKind">caughtException</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="comment">// we can't do inlining here, the handling mechanism is more precise than we can reason about</span>
        if <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler.$anonfun.$anonfun.caughtException" title="InlineExceptionHandlers.this.global.icodes.TypeKind">caughtException</a> <a href="../icode/TypeKinds.scala.html#scala.tools.nsc.backend.icode;TypeKinds;TypeKind.<:<" title="(other: InlineExceptionHandlers.this.global.icodes.TypeKind)Boolean">&lt;:&lt;</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.findExceptionHandler.thrownException" title="InlineExceptionHandlers.this.global.icodes.TypeKind">thrownException</a><span class="delimiter">)</span>
          return <a href="../../../../Option.scala.html#scala.None" title="None.type">None</a>
        <span class="comment">// no result yet, look deeper in the handler stack</span>
      <span class="delimiter">}</span>
      <a href="../../../../Option.scala.html#scala.None" title="None.type">None</a>
    <span class="delimiter">}</span>

    <span class="comment">/**
      * This function takes care of duplicating the basic block code for inlining the handler
      *
      * Note: This function does not duplicate the same basic block twice. It wil contain a map of the duplicated
      * basic blocks
      */</span>
    private def <a title="(handler: InlineExceptionHandlers.this.global.icodes.BasicBlock)Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandlerCache">duplicateExceptionHandlerCache</a><span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.BasicBlock" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandlerCache.handler">handler</a>: <a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">BasicBlock</a><span class="delimiter">)</span> =
      <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.handlerCopies" title="=&gt; scala.collection.mutable.HashMap[InlineExceptionHandlers.this.global.icodes.BasicBlock,Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)]]">handlerCopies</a>.<a href="../../../../collection/mutable/MapLike.scala.html#scala.collection.mutable;MapLike.getOrElseUpdate" title="(key: InlineExceptionHandlers.this.global.icodes.BasicBlock, op: =&gt; Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)])Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)]">getOrElseUpdate</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandlerCache.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a>, <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler" title="(handler: InlineExceptionHandlers.this.global.icodes.BasicBlock)Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)]">duplicateExceptionHandler</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandlerCache.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="comment">/** This function takes care of actual duplication */</span>
    private def <a title="(handler: InlineExceptionHandlers.this.global.icodes.BasicBlock)Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler">duplicateExceptionHandler</a><span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.BasicBlock" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.handler">handler</a>: <a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">BasicBlock</a><span class="delimiter">)</span>: <a href="../../../../Option.scala.html#scala;Option" title="Option[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)]">Option</a><span class="delimiter">[</span><span class="delimiter">(</span>Option<span class="delimiter">[</span>Local<span class="delimiter">]</span>, BasicBlock<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      <a href="../../Global.scala.html#scala.tools.nsc;Global.log" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;      duplicating handler block &quot;)" class="string">&quot;      duplicating handler block &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a><span class="delimiter">)</span>

      <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a> <a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.take" title="(n: Int)Seq[InlineExceptionHandlers.this.global.icodes.Instruction]">take</a> <span title="Int(2)" class="int">2</span> match <span class="delimiter">{</span>
        case <a href="../../../../collection/generic/SeqFactory.scala.html#scala.collection.generic;SeqFactory.unapplySeq" title="(x: Seq[InlineExceptionHandlers.this.global.icodes.Instruction])Some[Seq[InlineExceptionHandlers.this.global.icodes.Instruction]]">Seq</a><span class="delimiter">(</span>LOAD_EXCEPTION<span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.global.Symbol" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.caughtClass">caughtClass</a><span class="delimiter">)</span>, <a title="InlineExceptionHandlers.this.global.icodes.Instruction" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.next">next</a><span class="delimiter">)</span> =&gt;
          val <a href="../../../../Tuple2.scala.html#scala;Tuple2" title="(Int, Option[InlineExceptionHandlers.this.global.icodes.Local])" class="delimiter">(</a><a href="../../../../Tuple2.scala.html#scala;Tuple2._1" title="Int" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.dropCount">dropCount</a>, <a href="../../../../Tuple2.scala.html#scala;Tuple2._2" title="Option[InlineExceptionHandlers.this.global.icodes.Local]" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.exceptionLocal">exceptionLocal</a><span class="delimiter">)</span> = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.next" title="InlineExceptionHandlers.this.global.icodes.Instruction">next</a> match <span class="delimiter">{</span>
            case STORE_LOCAL<span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.Local" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.x$11.local">local</a><span class="delimiter">)</span> =&gt; <a href="../../../../Tuple2.scala.html#scala;Tuple2" title="(_1: Int, _2: Some[InlineExceptionHandlers.this.global.icodes.Local])(Int, Some[InlineExceptionHandlers.this.global.icodes.Local])" class="delimiter">(</a><span title="Int(2)" class="int">2</span>, <a href="../../../../Option.scala.html#scala;Some" title="(x: InlineExceptionHandlers.this.global.icodes.Local)Some[InlineExceptionHandlers.this.global.icodes.Local]">Some</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.x$11.local" title="InlineExceptionHandlers.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="comment">// we drop both LOAD_EXCEPTION and STORE_LOCAL</span>
            case _                  =&gt; <a href="../../../../Tuple2.scala.html#scala;Tuple2" title="(_1: Int, _2: None.type)(Int, None.type)" class="delimiter">(</a><span title="Int(1)" class="int">1</span>, <a href="../../../../Option.scala.html#scala.None" title="None.type">None</a><span class="delimiter">)</span>        <span class="comment">// we only drop the LOAD_EXCEPTION and expect the exception on the stack</span>
          <span class="delimiter">}</span>
          val <a title="InlineExceptionHandlers.this.global.icodes.TypeKind" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.caughtException">caughtException</a> = <a href="../icode/TypeKinds.scala.html#scala.tools.nsc.backend.icode;TypeKinds.toTypeKind" title="(t: InlineExceptionHandlers.this.global.icodes.global.Type)InlineExceptionHandlers.this.global.icodes.TypeKind">toTypeKind</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.caughtClass" title="InlineExceptionHandlers.this.global.icodes.global.Symbol">caughtClass</a>.<a href="../../../../reflect/internal/Symbols.scala.html#scala.reflect.internal;Symbols;Symbol.tpe" title="=&gt; InlineExceptionHandlers.this.global.icodes.global.Type">tpe</a><span class="delimiter">)</span>
          <span class="comment">// copy the exception handler code once again, dropping the LOAD_EXCEPTION</span>
          val <a title="InlineExceptionHandlers.this.global.icodes.BasicBlock" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.copy">copy</a> = <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.code" title="=&gt; InlineExceptionHandlers.this.global.icodes.Code">code</a>.<a href="../icode/Members.scala.html#scala.tools.nsc.backend.icode;Members;Code.newBlock" title="()InlineExceptionHandlers.this.global.icodes.BasicBlock">newBlock</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.copy" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">copy</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.emitOnly" title="(is: InlineExceptionHandlers.this.global.icodes.Instruction*)Unit">emitOnly</a><span class="delimiter">(</span><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.iterator" title="=&gt; Iterator[InlineExceptionHandlers.this.global.icodes.Instruction]">iterator</a> <a href="../../../../collection/Iterator.scala.html#scala.collection;Iterator.drop" title="(n: Int)Iterator[InlineExceptionHandlers.this.global.icodes.Instruction]">drop</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.dropCount" title="Int">dropCount</a><span class="delimiter">)</span>.<a href="../../../../collection/TraversableOnce.scala.html#scala.collection;TraversableOnce.toSeq" title="=&gt; Seq[InlineExceptionHandlers.this.global.icodes.Instruction]">toSeq</a>: _*<span class="delimiter">)</span>

          <span class="comment">// extend the handlers of the handler to the copy</span>
          for <span class="delimiter">(</span><a title="InlineExceptionHandlers.this.global.icodes.ExceptionHandler" id="scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.$anonfun.parentHandler">parentHandler</a> &lt;- <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.method" title="=&gt; InlineExceptionHandlers.this.global.icodes.IMethod">method</a>.<a href="../../../../collection/TraversableLike.scala.html#scala.collection;TraversableLike.withFilter" title="(p: InlineExceptionHandlers.this.global.icodes.ExceptionHandler =&gt; Boolean)scala.collection.generic.FilterMonadic[InlineExceptionHandlers.this.global.icodes.ExceptionHandler,List[InlineExceptionHandlers.this.global.icodes.ExceptionHandler]]">exh</a> ; if <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.$anonfun.parentHandler" title="InlineExceptionHandlers.this.global.icodes.ExceptionHandler">parentHandler</a> <a href="../../../../collection/generic/FilterMonadic.scala.html#scala.collection.generic;FilterMonadic.foreach" title="(f: InlineExceptionHandlers.this.global.icodes.ExceptionHandler =&gt; Unit)Unit">covers</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.$anonfun.parentHandler" title="InlineExceptionHandlers.this.global.icodes.ExceptionHandler">parentHandler</a>.<a href="../icode/ExceptionHandlers.scala.html#scala.tools.nsc.backend.icode;ExceptionHandlers;ExceptionHandler.addCoveredBlock" title="(b: InlineExceptionHandlers.this.global.icodes.BasicBlock)parentHandler.type">addCoveredBlock</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.copy" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">copy</a><span class="delimiter">)</span>
            <span class="comment">// notify the parent handler that the successors changed</span>
            <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.$anonfun.parentHandler" title="InlineExceptionHandlers.this.global.icodes.ExceptionHandler">parentHandler</a>.<a href="../icode/ExceptionHandlers.scala.html#scala.tools.nsc.backend.icode;ExceptionHandlers;ExceptionHandler.startBlock" title="=&gt; InlineExceptionHandlers.this.global.icodes.BasicBlock">startBlock</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.touched_=" title="(b: Boolean)Unit">touched</a> = true
          <span class="delimiter">}</span>

          <span class="comment">// notify the successors of the inlined handler might have changed</span>
          <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.copy" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">copy</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.touched_=" title="(b: Boolean)Unit">touched</a>    = true
          <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.touched_=" title="(b: Boolean)Unit">touched</a> = true
          <a href="../../Global.scala.html#scala.tools.nsc;Global.log" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;      duplicated  handler block &quot;)" class="string">&quot;      duplicated  handler block &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; to &quot;)" class="string">&quot; to &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.copy" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">copy</a><span class="delimiter">)</span>

          <span class="comment">// announce the duplicate handler</span>
          <a href="../../../../collection/mutable/HashMap.scala.html#scala.collection.mutable;HashMap.update" title="(key: InlineExceptionHandlers.this.global.icodes.BasicBlock, value: (InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind))Unit">handlerCopiesInverted</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.copy" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">copy</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="../../../../Tuple2.scala.html#scala;Tuple2" title="(_1: InlineExceptionHandlers.this.global.icodes.BasicBlock, _2: InlineExceptionHandlers.this.global.icodes.TypeKind)(InlineExceptionHandlers.this.global.icodes.BasicBlock, InlineExceptionHandlers.this.global.icodes.TypeKind)" class="delimiter">(</a><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a>, <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.caughtException" title="InlineExceptionHandlers.this.global.icodes.TypeKind">caughtException</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.todoBlocks_=" title="(x$1: List[InlineExceptionHandlers.this.global.icodes.BasicBlock])Unit">todoBlocks</a> <a href="../../../../collection/immutable/List.scala.html#scala.collection.immutable;List.::" title="(x: InlineExceptionHandlers.this.global.icodes.BasicBlock)List[InlineExceptionHandlers.this.global.icodes.BasicBlock]">::=</a> <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.copy" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">copy</a>

          <a href="../../../../Option.scala.html#scala;Some" title="(x: (Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock))Some[(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)]">Some</a><span class="delimiter">(</span><a href="../../../../Tuple2.scala.html#scala;Tuple2" title="(_1: Option[InlineExceptionHandlers.this.global.icodes.Local], _2: InlineExceptionHandlers.this.global.icodes.BasicBlock)(Option[InlineExceptionHandlers.this.global.icodes.Local], InlineExceptionHandlers.this.global.icodes.BasicBlock)" class="delimiter">(</a><a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.exceptionLocal" title="Option[InlineExceptionHandlers.this.global.icodes.Local]">exceptionLocal</a>, <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.copy" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">copy</a><span class="delimiter">)</span><span class="delimiter">)</span>

        case _ =&gt;
          <a href="../../Global.scala.html#scala.tools.nsc;Global.reporter" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../../../../reflect/internal/Reporting.scala.html#scala.reflect.internal;Reporter.warning" title="(pos: scala.reflect.internal.util.Position, msg: String)Unit">warning</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Positions.scala.html#scala.reflect.internal;Positions.NoPosition" title="=&gt; reflect.internal.util.NoPosition.type">NoPosition</a>, <span title="String(&quot;Unable to inline the exception handler due to incorrect format:\n&quot;)" class="string">&quot;Unable to inline the exception handler due to incorrect format:\n&quot;</span> <span title="(x$1: Any)String">+</span>
            <a href="#scala.tools.nsc.backend.opt;InlineExceptionHandlers;InlineExceptionHandlersPhase.duplicateExceptionHandler.handler" title="InlineExceptionHandlers.this.global.icodes.BasicBlock">handler</a>.<a href="../icode/BasicBlocks.scala.html#scala.tools.nsc.backend.icode;BasicBlocks;BasicBlock.iterator" title="=&gt; Iterator[InlineExceptionHandlers.this.global.icodes.Instruction]">iterator</a>.<a href="../../../../collection/TraversableOnce.scala.html#scala.collection;TraversableOnce.mkString(f5d728d244)" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="../../../../Option.scala.html#scala.None" title="None.type">None</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
