<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scala/tools/nsc/backend/jvm/opt/LocalOpt.scala</title>
        <script type="text/javascript" src="../../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2014 LAMP/EPFL
 * @author  Martin Odersky
 */</span>

package scala.tools.nsc
package backend.jvm
package opt

import scala.tools.asm.<span class="delimiter">{</span>Opcodes, MethodWriter, ClassWriter<span class="delimiter">}</span>
import scala.tools.asm.tree.analysis.<span class="delimiter">{</span>Analyzer, BasicValue, BasicInterpreter<span class="delimiter">}</span>
import scala.tools.asm.tree._
import scala.collection.convert.<a href="../../../../../collection/convert/package.scala.html#scala.collection.convert.package.decorateAsScala" title="=&gt; scala.collection.convert.DecorateAsScala">decorateAsScala</a>._
import scala.collection.<span class="delimiter">{</span> mutable =&gt; m <span class="delimiter">}</span>

<span class="comment">/**
 * Intra-Method optimizations.
 */</span>
object <a title="scala.tools.nsc.backend.jvm.opt.LocalOpt.type" id="scala.tools.nsc.backend.jvm.opt.LocalOpt">LocalOpt</a> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt" title="scala.tools.nsc.backend.jvm.opt.LocalOpt.type" class="delimiter">{</a>
  <span class="comment">/**
   * Remove unreachable instructions from all (non-abstract) methods.
   *
   * @param clazz The class whose methods are optimized
   * @return      `true` if unreachable code was elminated in some method, `false` otherwise.
   */</span>
  def <a title="(clazz: scala.tools.asm.tree.ClassNode)Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(4a4affe58e)">removeUnreachableCode</a><span class="delimiter">(</span><a title="scala.tools.asm.tree.ClassNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(4a4affe58e).clazz">clazz</a>: <span title="scala.tools.asm.tree.ClassNode">ClassNode</span><span class="delimiter">)</span>: <a href="../../../../../Boolean.scala.html#scala;Boolean" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(4a4affe58e).clazz" title="scala.tools.asm.tree.ClassNode">clazz</a>.<a href="../../../../../collection/convert/DecorateAsScala.scala.html#scala.collection.convert;DecorateAsScala.asScalaBufferConverter" title="(l: java.util.List[scala.tools.asm.tree.MethodNode])scala.collection.convert.Decorators.AsScala[scala.collection.mutable.Buffer[scala.tools.asm.tree.MethodNode]]">methods</a>.<a href="../../../../../collection/convert/Decorators.scala.html#scala.collection.convert;Decorators;AsScala.asScala" title="=&gt; scala.collection.mutable.Buffer[scala.tools.asm.tree.MethodNode]">asScala</a>.<a href="../../../../../collection/TraversableOnce.scala.html#scala.collection;TraversableOnce.foldLeft" title="(z: Boolean)(op: (Boolean, scala.tools.asm.tree.MethodNode) =&gt; Boolean)Boolean">foldLeft</a><span class="delimiter">(</span>false<span class="delimiter">)</span> <a href="../../../../../Tuple2.scala.html#scala;Tuple2" title="Boolean" class="delimiter">{</a>
      case <span class="delimiter">(</span><a title="Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(4a4affe58e).$anonfun.changed">changed</a>, <a title="scala.tools.asm.tree.MethodNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(4a4affe58e).$anonfun.method">method</a><span class="delimiter">)</span> =&gt; <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9)" title="(method: scala.tools.asm.tree.MethodNode, ownerClassName: String)Boolean">removeUnreachableCode</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(4a4affe58e).$anonfun.method" title="scala.tools.asm.tree.MethodNode">method</a>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(4a4affe58e).clazz" title="scala.tools.asm.tree.ClassNode">clazz</a>.<span title="String">name</span><span class="delimiter">)</span> <a href="../../../../../Boolean.scala.html#scala;Boolean.||" title="(x: Boolean)Boolean">||</a> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(4a4affe58e).$anonfun.changed" title="Boolean">changed</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Remove unreachable code from a method.
   * We rely on dead code elimination provided by the ASM framework, as described in the ASM User
   * Guide (http://asm.ow2.org/index.html), Section 8.2.1. It runs a data flow analysis, which only
   * computes Frame information for reachable instructions. Instructions for which no Frame data is
   * available after the analyis are unreachable.
   *
   * TODO doc: it also removes empty handlers, unused local vars
   *
   * Returns `true` if dead code in `method` has been eliminated.
   */</span>
  private def <a title="(method: scala.tools.asm.tree.MethodNode, ownerClassName: String)Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9)">removeUnreachableCode</a><span class="delimiter">(</span><a title="scala.tools.asm.tree.MethodNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).method">method</a>: <span title="scala.tools.asm.tree.MethodNode">MethodNode</span>, <a title="String" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).ownerClassName">ownerClassName</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../../../Boolean.scala.html#scala;Boolean" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="scala.tools.asm.tree.InsnList">instructions</span>.<span title="()Int">size</span> <a href="../../../../../Int.scala.html#scala;Int.==(5f58a84eb3)" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> return false <span class="comment">// fast path for abstract methods</span>

    val <a title="Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).codeRemoved">codeRemoved</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl" title="(method: scala.tools.asm.tree.MethodNode, ownerClassName: String)Boolean">removeUnreachableCodeImpl</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).method" title="scala.tools.asm.tree.MethodNode">method</a>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).ownerClassName" title="String">ownerClassName</a><span class="delimiter">)</span>

    <span class="comment">// unreachable-code also removes unused local variable nodes and empty exception handlers.</span>
    <span class="comment">// This is required for correctness: such nodes are not allowed to refer to instruction offsets</span>
    <span class="comment">// that don't exist (because they have been eliminated).</span>
    val <a title="Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).localsRemoved">localsRemoved</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes" title="(method: scala.tools.asm.tree.MethodNode)Boolean">removeUnusedLocalVariableNodes</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).method" title="scala.tools.asm.tree.MethodNode">method</a><span class="delimiter">)</span>
    val <a title="Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).handlersRemoved">handlersRemoved</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3)" title="(method: scala.tools.asm.tree.MethodNode)Boolean">removeEmptyExceptionHandlers</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).method" title="scala.tools.asm.tree.MethodNode">method</a><span class="delimiter">)</span>

    <span class="comment">// When eliminating a handler, the catch block becomes unreachable. The recursive invocation</span>
    <span class="comment">// removes these blocks.</span>
    <span class="comment">// Note that invoking removeUnreachableCode*Impl* a second time is not enough: removing the dead</span>
    <span class="comment">// catch block can render other handlers empty, which also have to be removed in turn.</span>
    if <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).handlersRemoved" title="Boolean">handlersRemoved</a><span class="delimiter">)</span> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9)" title="(method: scala.tools.asm.tree.MethodNode, ownerClassName: String)Boolean">removeUnreachableCode</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).method" title="scala.tools.asm.tree.MethodNode">method</a>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).ownerClassName" title="String">ownerClassName</a><span class="delimiter">)</span>

    <span class="comment">// assert that we can leave local variable annotations as-is</span>
    def <a title="[T](l: java.util.List[T])Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).nullOrEmpty">nullOrEmpty</a><span class="delimiter">[</span><a title="" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).nullOrEmpty;T">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="java.util.List[T]" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).nullOrEmpty.l">l</a>: java.util.<span title="java.util.List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).nullOrEmpty.l" title="java.util.List[T]">l</a> <span title="(x$1: Any)Boolean">==</span> null <a href="../../../../../Boolean.scala.html#scala;Boolean.||" title="(x: Boolean)Boolean">||</a> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).nullOrEmpty.l" title="java.util.List[T]">l</a>.<span title="()Boolean">isEmpty</span>
    <a href="../../../../../Predef.scala.html#scala.Predef.assert(0f40bc559c)" title="(assertion: Boolean, message: =&gt; Any)Unit">assert</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).nullOrEmpty" title="(l: java.util.List[scala.tools.asm.tree.LocalVariableAnnotationNode])Boolean">nullOrEmpty</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="java.util.List[scala.tools.asm.tree.LocalVariableAnnotationNode]">visibleLocalVariableAnnotations</span><span class="delimiter">)</span>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="java.util.List[scala.tools.asm.tree.LocalVariableAnnotationNode]">visibleLocalVariableAnnotations</span><span class="delimiter">)</span>
    <a href="../../../../../Predef.scala.html#scala.Predef.assert(0f40bc559c)" title="(assertion: Boolean, message: =&gt; Any)Unit">assert</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).nullOrEmpty" title="(l: java.util.List[scala.tools.asm.tree.LocalVariableAnnotationNode])Boolean">nullOrEmpty</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="java.util.List[scala.tools.asm.tree.LocalVariableAnnotationNode]">invisibleLocalVariableAnnotations</span><span class="delimiter">)</span>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="java.util.List[scala.tools.asm.tree.LocalVariableAnnotationNode]">invisibleLocalVariableAnnotations</span><span class="delimiter">)</span>

    <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).codeRemoved" title="Boolean">codeRemoved</a> <a href="../../../../../Boolean.scala.html#scala;Boolean.||" title="(x: Boolean)Boolean">||</a> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).localsRemoved" title="Boolean">localsRemoved</a> <a href="../../../../../Boolean.scala.html#scala;Boolean.||" title="(x: Boolean)Boolean">||</a> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCode(c87d3fead9).handlersRemoved" title="Boolean">handlersRemoved</a>
  <span class="delimiter">}</span>

  private def <a title="(method: scala.tools.asm.tree.MethodNode, ownerClassName: String)Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl">removeUnreachableCodeImpl</a><span class="delimiter">(</span><a title="scala.tools.asm.tree.MethodNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.method">method</a>: <span title="scala.tools.asm.tree.MethodNode">MethodNode</span>, <a title="String" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.ownerClassName">ownerClassName</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../../../Boolean.scala.html#scala;Boolean" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    val <a title="Int" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.initialSize">initialSize</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="scala.tools.asm.tree.InsnList">instructions</span>.<span title="()Int">size</span>
    if <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.initialSize" title="Int">initialSize</a> <a href="../../../../../Int.scala.html#scala;Int.==(5f58a84eb3)" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> return false

    <span class="comment">// The data flow analysis requires the maxLocals / maxStack fields of the method to be computed.</span>
    <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack" title="(method: scala.tools.asm.tree.MethodNode)Unit">computeMaxLocalsMaxStack</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.method" title="scala.tools.asm.tree.MethodNode">method</a><span class="delimiter">)</span>
    val <a title="scala.tools.asm.tree.analysis.Analyzer[scala.tools.asm.tree.analysis.BasicValue]" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.a">a</a> = new <span title="scala.tools.asm.tree.analysis.Analyzer[scala.tools.asm.tree.analysis.BasicValue]">Analyzer</span><span class="delimiter">[</span>BasicValue<span class="delimiter">]</span><span class="delimiter">(</span>new <span title="scala.tools.asm.tree.analysis.BasicInterpreter">BasicInterpreter</span><span class="delimiter">)</span>
    <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.a" title="scala.tools.asm.tree.analysis.Analyzer[scala.tools.asm.tree.analysis.BasicValue]">a</a>.<span title="(x$1: String, x$2: scala.tools.asm.tree.MethodNode)Array[scala.tools.asm.tree.analysis.Frame[scala.tools.asm.tree.analysis.BasicValue]]">analyze</span><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.ownerClassName" title="String">ownerClassName</a>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.method" title="scala.tools.asm.tree.MethodNode">method</a><span class="delimiter">)</span>
    val <a title="Array[scala.tools.asm.tree.analysis.Frame[scala.tools.asm.tree.analysis.BasicValue]]" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.frames">frames</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.a" title="scala.tools.asm.tree.analysis.Analyzer[scala.tools.asm.tree.analysis.BasicValue]">a</a>.<span title="()Array[scala.tools.asm.tree.analysis.Frame[scala.tools.asm.tree.analysis.BasicValue]]">getFrames</span>

    var <a title="Int" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.i">i</a> = <span title="Int(0)" class="int">0</span>
    val <a title="java.util.ListIterator[scala.tools.asm.tree.AbstractInsnNode]" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.itr">itr</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="scala.tools.asm.tree.InsnList">instructions</span>.<span title="()java.util.ListIterator[scala.tools.asm.tree.AbstractInsnNode]">iterator</span><span class="delimiter">(</span><span class="delimiter">)</span>
    while <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.itr" title="java.util.ListIterator[scala.tools.asm.tree.AbstractInsnNode]">itr</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.while$1" title="()Unit" class="delimiter">{</a>
      val <a title="scala.tools.asm.tree.AbstractInsnNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.ins">ins</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.itr" title="java.util.ListIterator[scala.tools.asm.tree.AbstractInsnNode]">itr</a>.<span title="()scala.tools.asm.tree.AbstractInsnNode">next</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="comment">// Don't remove label nodes: they might be referenced for example in a LocalVariableNode</span>
      if <span class="delimiter">(</span><a href="../../../../../Array.scala.html#scala;Array.apply" title="(i: Int)scala.tools.asm.tree.analysis.Frame[scala.tools.asm.tree.analysis.BasicValue]">frames</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.i" title="Int">i</a><span class="delimiter">)</span> <span title="(x$1: Any)Boolean">==</span> null <a href="../../../../../Boolean.scala.html#scala;Boolean.&&" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../../../Boolean.scala.html#scala;Boolean.unary_!" title="=&gt; Boolean">!</a><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.ins" title="scala.tools.asm.tree.AbstractInsnNode">ins</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><span title="scala.tools.asm.tree.LabelNode">LabelNode</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">// Instruction iterators allow removing during iteration.</span>
        <span class="comment">// Removing is O(1): instructions are doubly linked list elements.</span>
        <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.itr" title="java.util.ListIterator[scala.tools.asm.tree.AbstractInsnNode]">itr</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.i" title="Int">i</a> <a href="../../../../../Int.scala.html#scala;Int.+(1409840560)" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>

    <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="scala.tools.asm.tree.InsnList">instructions</span>.<span title="()Int">size</span> <a href="../../../../../Int.scala.html#scala;Int.!=(5f58a84eb3)" title="(x: Int)Boolean">!=</a> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnreachableCodeImpl.initialSize" title="Int">initialSize</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Remove exception handlers that cover empty code blocks from all methods of `clazz`.
   * Returns `true` if any exception handler was eliminated.
   */</span>
  def <a title="(clazz: scala.tools.asm.tree.ClassNode)Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(4a4affe58e)">removeEmptyExceptionHandlers</a><span class="delimiter">(</span><a title="scala.tools.asm.tree.ClassNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(4a4affe58e).clazz">clazz</a>: <span title="scala.tools.asm.tree.ClassNode">ClassNode</span><span class="delimiter">)</span>: <a href="../../../../../Boolean.scala.html#scala;Boolean" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(4a4affe58e).clazz" title="scala.tools.asm.tree.ClassNode">clazz</a>.<a href="../../../../../collection/convert/DecorateAsScala.scala.html#scala.collection.convert;DecorateAsScala.asScalaBufferConverter" title="(l: java.util.List[scala.tools.asm.tree.MethodNode])scala.collection.convert.Decorators.AsScala[scala.collection.mutable.Buffer[scala.tools.asm.tree.MethodNode]]">methods</a>.<a href="../../../../../collection/convert/Decorators.scala.html#scala.collection.convert;Decorators;AsScala.asScala" title="=&gt; scala.collection.mutable.Buffer[scala.tools.asm.tree.MethodNode]">asScala</a>.<a href="../../../../../collection/TraversableOnce.scala.html#scala.collection;TraversableOnce.foldLeft" title="(z: Boolean)(op: (Boolean, scala.tools.asm.tree.MethodNode) =&gt; Boolean)Boolean">foldLeft</a><span class="delimiter">(</span>false<span class="delimiter">)</span> <a href="../../../../../Tuple2.scala.html#scala;Tuple2" title="Boolean" class="delimiter">{</a>
      case <span class="delimiter">(</span><a title="Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(4a4affe58e).$anonfun.changed">changed</a>, <a title="scala.tools.asm.tree.MethodNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(4a4affe58e).$anonfun.method">method</a><span class="delimiter">)</span> =&gt; <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3)" title="(method: scala.tools.asm.tree.MethodNode)Boolean">removeEmptyExceptionHandlers</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(4a4affe58e).$anonfun.method" title="scala.tools.asm.tree.MethodNode">method</a><span class="delimiter">)</span> <a href="../../../../../Boolean.scala.html#scala;Boolean.||" title="(x: Boolean)Boolean">||</a> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(4a4affe58e).$anonfun.changed" title="Boolean">changed</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Remove exception handlers that cover empty code blocks. A block is considered empty if it
   * consist only of labels, frames, line numbers, nops and gotos.
   *
   * Note that no instructions are eliminated.
   *
   * @return `true` if some exception handler was eliminated.
   */</span>
  def <a title="(method: scala.tools.asm.tree.MethodNode)Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3)">removeEmptyExceptionHandlers</a><span class="delimiter">(</span><a title="scala.tools.asm.tree.MethodNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).method">method</a>: <span title="scala.tools.asm.tree.MethodNode">MethodNode</span><span class="delimiter">)</span>: <a href="../../../../../Boolean.scala.html#scala;Boolean" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    <span class="comment">/** True if there exists code between start and end. */</span>
    def <a title="(start: scala.tools.asm.tree.AbstractInsnNode, end: scala.tools.asm.tree.LabelNode)Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).containsExecutableCode">containsExecutableCode</a><span class="delimiter">(</span><a title="scala.tools.asm.tree.AbstractInsnNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).containsExecutableCode.start">start</a>: <span title="scala.tools.asm.tree.AbstractInsnNode">AbstractInsnNode</span>, <a title="scala.tools.asm.tree.LabelNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).containsExecutableCode.end">end</a>: <span title="scala.tools.asm.tree.LabelNode">LabelNode</span><span class="delimiter">)</span>: <a href="../../../../../Boolean.scala.html#scala;Boolean" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
      <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).containsExecutableCode.start" title="scala.tools.asm.tree.AbstractInsnNode">start</a> <span title="(x$1: Any)Boolean">!=</span> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).containsExecutableCode.end" title="scala.tools.asm.tree.LabelNode">end</a> <a href="../../../../../Boolean.scala.html#scala;Boolean.&&" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).containsExecutableCode.start" title="scala.tools.asm.tree.AbstractInsnNode">start</a>.<span title="()Int">getOpcode</span> match <span class="delimiter">{</span>
        <span class="comment">// FrameNode, LabelNode and LineNumberNode have opcode == -1.</span>
        case <span title="Int(-1)">-</span><span class="int">1</span> | Opcodes.<span title="Int(0)">NOP</span> | Opcodes.<span title="Int(167)">GOTO</span> =&gt; <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).containsExecutableCode" title="(start: scala.tools.asm.tree.AbstractInsnNode, end: scala.tools.asm.tree.LabelNode)Boolean">containsExecutableCode</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).containsExecutableCode.start" title="scala.tools.asm.tree.AbstractInsnNode">start</a>.<span title="()scala.tools.asm.tree.AbstractInsnNode">getNext</span>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).containsExecutableCode.end" title="scala.tools.asm.tree.LabelNode">end</a><span class="delimiter">)</span>
        case _ =&gt; true
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    val <a title="Int" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).initialNumberHandlers">initialNumberHandlers</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="java.util.List[scala.tools.asm.tree.TryCatchBlockNode]">tryCatchBlocks</span>.<span title="()Int">size</span>
    val <a title="java.util.Iterator[scala.tools.asm.tree.TryCatchBlockNode]" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).handlersIter">handlersIter</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="java.util.List[scala.tools.asm.tree.TryCatchBlockNode]">tryCatchBlocks</span>.<span title="()java.util.Iterator[scala.tools.asm.tree.TryCatchBlockNode]">iterator</span><span class="delimiter">(</span><span class="delimiter">)</span>
    while<span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).handlersIter" title="java.util.Iterator[scala.tools.asm.tree.TryCatchBlockNode]">handlersIter</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).while$2" title="()Unit" class="delimiter">{</a>
      val <a title="scala.tools.asm.tree.TryCatchBlockNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).handler">handler</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).handlersIter" title="java.util.Iterator[scala.tools.asm.tree.TryCatchBlockNode]">handlersIter</a>.<span title="()scala.tools.asm.tree.TryCatchBlockNode">next</span><span class="delimiter">(</span><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="../../../../../Boolean.scala.html#scala;Boolean.unary_!" title="=&gt; Boolean">!</a><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).containsExecutableCode" title="(start: scala.tools.asm.tree.AbstractInsnNode, end: scala.tools.asm.tree.LabelNode)Boolean">containsExecutableCode</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).handler" title="scala.tools.asm.tree.TryCatchBlockNode">handler</a>.<span title="scala.tools.asm.tree.LabelNode">start</span>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).handler" title="scala.tools.asm.tree.TryCatchBlockNode">handler</a>.<span title="scala.tools.asm.tree.LabelNode">end</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).handlersIter" title="java.util.Iterator[scala.tools.asm.tree.TryCatchBlockNode]">handlersIter</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="java.util.List[scala.tools.asm.tree.TryCatchBlockNode]">tryCatchBlocks</span>.<span title="()Int">size</span> <a href="../../../../../Int.scala.html#scala;Int.!=(5f58a84eb3)" title="(x: Int)Boolean">!=</a> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeEmptyExceptionHandlers(a8f6620ef3).initialNumberHandlers" title="Int">initialNumberHandlers</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Remove all non-parameter entries from the local variable table which denote variables that are
   * not actually read or written.
   *
   * Note that each entry in the local variable table has a start, end and index. Two entries with
   * the same index, but distinct start / end ranges are different variables, they may have not the
   * same type or name.
   *
   * TODO: also re-allocate locals to occupy fewer slots after eliminating unused ones
   */</span>
  def <a title="(method: scala.tools.asm.tree.MethodNode)Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes">removeUnusedLocalVariableNodes</a><span class="delimiter">(</span><a title="scala.tools.asm.tree.MethodNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.method">method</a>: <span title="scala.tools.asm.tree.MethodNode">MethodNode</span><span class="delimiter">)</span>: <a href="../../../../../Boolean.scala.html#scala;Boolean" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    def <a title="(start: scala.tools.asm.tree.AbstractInsnNode, end: scala.tools.asm.tree.LabelNode, varIndex: Int)Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed">variableIsUsed</a><span class="delimiter">(</span><a title="scala.tools.asm.tree.AbstractInsnNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed.start">start</a>: <span title="scala.tools.asm.tree.AbstractInsnNode">AbstractInsnNode</span>, <a title="scala.tools.asm.tree.LabelNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed.end">end</a>: <span title="scala.tools.asm.tree.LabelNode">LabelNode</span>, <a title="Int" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed.varIndex">varIndex</a>: <a href="../../../../../Int.scala.html#scala;Int" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../../../../Boolean.scala.html#scala;Boolean" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
      <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed.start" title="scala.tools.asm.tree.AbstractInsnNode">start</a> <span title="(x$1: Any)Boolean">!=</span> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed.end" title="scala.tools.asm.tree.LabelNode">end</a> <a href="../../../../../Boolean.scala.html#scala;Boolean.&&" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed.start" title="scala.tools.asm.tree.AbstractInsnNode">start</a> match <span class="delimiter">{</span>
        case <a title="scala.tools.asm.tree.VarInsnNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed.v">v</a>: <span title="scala.tools.asm.tree.VarInsnNode">VarInsnNode</span> =&gt;  <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed.v" title="scala.tools.asm.tree.VarInsnNode">v</a>.<span title="Int">`var`</span> <a href="../../../../../Int.scala.html#scala;Int.==(5f58a84eb3)" title="(x: Int)Boolean">==</a> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed.varIndex" title="Int">varIndex</a>
        case _ =&gt; <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed" title="(start: scala.tools.asm.tree.AbstractInsnNode, end: scala.tools.asm.tree.LabelNode, varIndex: Int)Boolean">variableIsUsed</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed.start" title="scala.tools.asm.tree.AbstractInsnNode">start</a>.<span title="()scala.tools.asm.tree.AbstractInsnNode">getNext</span>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed.end" title="scala.tools.asm.tree.LabelNode">end</a>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed.varIndex" title="Int">varIndex</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    val <a title="Int" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.initialNumVars">initialNumVars</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="java.util.List[scala.tools.asm.tree.LocalVariableNode]">localVariables</span>.<span title="()Int">size</span>
    val <a title="java.util.Iterator[scala.tools.asm.tree.LocalVariableNode]" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.localsIter">localsIter</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="java.util.List[scala.tools.asm.tree.LocalVariableNode]">localVariables</span>.<span title="()java.util.Iterator[scala.tools.asm.tree.LocalVariableNode]">iterator</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="comment">// The parameters and `this` (for instance methods) have the lowest indices in the local variables</span>
    <span class="comment">// table. Note that double / long fields occupy two slots, so we sum up the sizes. Since getSize</span>
    <span class="comment">// returns 0 for void, we have to add `max 1`.</span>
    val <a title="Int" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.paramsSize">paramsSize</a> = scala.tools.asm.<span title="scala.tools.asm.Type.type">Type</span>.<span title="(x$1: String)Array[scala.tools.asm.Type]">getArgumentTypes</span><a href="../../../../../Predef.scala.html#scala.Predef.refArrayOps" title="(xs: Array[scala.tools.asm.Type])scala.collection.mutable.ArrayOps[scala.tools.asm.Type]" class="delimiter">(</a><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="String">desc</span><span class="delimiter">)</span>.<a href="../../../../../collection/TraversableLike.scala.html#scala.collection;TraversableLike.map" title="(f: scala.tools.asm.Type =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Array[scala.tools.asm.Type],Int,Array[Int]])Array[Int]">map</a><a href="../../../../../Predef.scala.html#scala.Predef.intArrayOps" title="implicit scala.Predef.intArrayOps : (xs: Array[Int])scala.collection.mutable.ArrayOps[Int]" class="delimiter">(</a><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.paramsSize.$anonfun.x$1" title="scala.tools.asm.Type">_</a>.<a href="../../../../../Predef.scala.html#scala;LowPriorityImplicits.intWrapper" title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt">getSize</a> <a href="../../../../../runtime/RichInt.scala.html#scala.runtime;RichInt.max" title="(that: Int)Int">max</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="../../../../../collection/TraversableOnce.scala.html#scala.collection;TraversableOnce.sum" title="(implicit num: Numeric[Int])Int">sum</a>
    val <a title="Int" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.thisSize">thisSize</a> = if <span class="delimiter">(</span><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="Int">access</span> <a href="../../../../../Int.scala.html#scala;Int.&(1409840560)" title="(x: Int)Int">&amp;</a> Opcodes.<span title="Int(8)">ACC_STATIC</span><span class="delimiter">)</span> <a href="../../../../../Int.scala.html#scala;Int.==(5f58a84eb3)" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="Int(1)" class="int">1</span> else <span title="Int(0)" class="int">0</span>
    val endParamIndex = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.paramsSize" title="Int">paramsSize</a> <a href="../../../../../Int.scala.html#scala;Int.+(1409840560)" title="Int" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.endParamIndex">+</a> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.thisSize" title="Int">thisSize</a>
    while <span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.localsIter" title="java.util.Iterator[scala.tools.asm.tree.LocalVariableNode]">localsIter</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.while$3" title="()Unit" class="delimiter">{</a>
      val <a title="scala.tools.asm.tree.LocalVariableNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.local">local</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.localsIter" title="java.util.Iterator[scala.tools.asm.tree.LocalVariableNode]">localsIter</a>.<span title="()scala.tools.asm.tree.LocalVariableNode">next</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="comment">// parameters and `this` have the lowest indices, starting at 0</span>
      val used = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.local" title="scala.tools.asm.tree.LocalVariableNode">local</a>.<span title="Int">index</span> <a href="../../../../../Int.scala.html#scala;Int.<(5f58a84eb3)" title="(x: Int)Boolean">&lt;</a> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.endParamIndex" title="Int">endParamIndex</a> <a href="../../../../../Boolean.scala.html#scala;Boolean.||" title="Boolean" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.used">||</a> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.variableIsUsed" title="(start: scala.tools.asm.tree.AbstractInsnNode, end: scala.tools.asm.tree.LabelNode, varIndex: Int)Boolean">variableIsUsed</a><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.local" title="scala.tools.asm.tree.LocalVariableNode">local</a>.<span title="scala.tools.asm.tree.LabelNode">start</span>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.local" title="scala.tools.asm.tree.LocalVariableNode">local</a>.<span title="scala.tools.asm.tree.LabelNode">end</span>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.local" title="scala.tools.asm.tree.LocalVariableNode">local</a>.<span title="Int">index</span><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="../../../../../Boolean.scala.html#scala;Boolean.unary_!" title="=&gt; Boolean">!</a><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.used" title="Boolean">used</a><span class="delimiter">)</span>
        <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.localsIter" title="java.util.Iterator[scala.tools.asm.tree.LocalVariableNode]">localsIter</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="java.util.List[scala.tools.asm.tree.LocalVariableNode]">localVariables</span>.<span title="()Int">size</span> <a href="../../../../../Int.scala.html#scala;Int.==(5f58a84eb3)" title="(x: Int)Boolean">==</a> <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.removeUnusedLocalVariableNodes.initialNumVars" title="Int">initialNumVars</a>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * In order to run an Analyzer, the maxLocals / maxStack fields need to be available. The ASM
   * framework only computes these values during bytecode generation.
   *
   * Sicne there's currently no better way, we run a bytecode generator on the method and extract
   * the computed values. This required changes to the ASM codebase:
   *   - the [[MethodWriter]] class was made public
   *   - accessors for maxLocals / maxStack were added to the MethodWriter class
   *
   * We could probably make this faster (and allocate less memory) by hacking the ASM framework
   * more: create a subclass of MethodWriter with a /dev/null byteVector. Another option would be
   * to create a separate visitor for computing those values, duplicating the functionality from the
   * MethodWriter.
   */</span>
  private def <a title="(method: scala.tools.asm.tree.MethodNode)Unit" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack">computeMaxLocalsMaxStack</a><span class="delimiter">(</span><a title="scala.tools.asm.tree.MethodNode" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.method">method</a>: <span title="scala.tools.asm.tree.MethodNode">MethodNode</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    val <a title="scala.tools.asm.ClassWriter" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.cw">cw</a> = new <span title="scala.tools.asm.ClassWriter">ClassWriter</span><span class="delimiter">(</span>ClassWriter.<span title="Int(1)">COMPUTE_MAXS</span><span class="delimiter">)</span>
    val <a title="Array[String]" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.excs">excs</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.method" title="scala.tools.asm.tree.MethodNode">method</a>.<a href="../../../../../collection/convert/DecorateAsScala.scala.html#scala.collection.convert;DecorateAsScala.asScalaBufferConverter" title="(l: java.util.List[String])scala.collection.convert.Decorators.AsScala[scala.collection.mutable.Buffer[String]]">exceptions</a>.<a href="../../../../../collection/convert/Decorators.scala.html#scala.collection.convert;Decorators;AsScala.asScala" title="=&gt; scala.collection.mutable.Buffer[String]">asScala</a>.<a href="../../../../../collection/TraversableOnce.scala.html#scala.collection;TraversableOnce.toArray" title="(implicit evidence$1: scala.reflect.ClassTag[String])Array[String]">toArray</a>
    val <a title="scala.tools.asm.MethodWriter" id="scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.mw">mw</a> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.cw" title="scala.tools.asm.ClassWriter">cw</a>.<span title="(x$1: Int, x$2: String, x$3: String, x$4: String, x$5: Array[String])scala.tools.asm.MethodVisitor">visitMethod</span><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="Int">access</span>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="String">name</span>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="String">desc</span>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="String">signature</span>, <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.excs" title="Array[String]">excs</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.tools.asm.MethodWriter" class="delimiter">[</span><span title="scala.tools.asm.MethodWriter">MethodWriter</span><span class="delimiter">]</span>
    <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="(x$1: scala.tools.asm.MethodVisitor)Unit">accept</span><span class="delimiter">(</span><a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.mw" title="scala.tools.asm.MethodWriter">mw</a><span class="delimiter">)</span>
    <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="Int">maxLocals</span> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.mw" title="scala.tools.asm.MethodWriter">mw</a>.<span title="()Int">getMaxLocals</span>
    <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.method" title="scala.tools.asm.tree.MethodNode">method</a>.<span title="Int">maxStack</span> = <a href="#scala.tools.nsc.backend.jvm.opt.LocalOpt.computeMaxLocalsMaxStack.mw" title="scala.tools.asm.MethodWriter">mw</a>.<span title="()Int">getMaxStack</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
