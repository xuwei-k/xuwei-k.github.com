<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scala/tools/nsc/transform/PostErasure.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2013 LAMP/EPFL
 * @author Martin odersky
 */</span>
package scala.tools.nsc
package transform

<span class="comment">/** This phase maps ErasedValueTypes to the underlying unboxed representation and
 *  performs peephole optimizations.
 */</span>
trait <a title="trait PostErasure extends scala.tools.nsc.SubComponent with scala.tools.nsc.transform.InfoTransform with scala.tools.nsc.transform.TypingTransformers with scala.reflect.internal.transform.PostErasure" id="scala.tools.nsc.transform;PostErasure">PostErasure</a> extends <a href="InfoTransform.scala.html#scala.tools.nsc.transform;InfoTransform" title="scala.tools.nsc.transform.InfoTransform">InfoTransform</a> with <a href="TypingTransformers.scala.html#scala.tools.nsc.transform;TypingTransformers" title="scala.tools.nsc.transform.TypingTransformers">TypingTransformers</a> with scala.reflect.internal.transform.<a href="../../../reflect/internal/transform/PostErasure.scala.html#scala.reflect.internal.transform;PostErasure" title="scala.reflect.internal.transform.PostErasure">PostErasure</a> <span class="delimiter">{</span>
  val <a title="=&gt; scala.tools.nsc.Global" id="scala.tools.nsc.transform;PostErasure.global">global</a>: <a href="../Global.scala.html#scala.tools.nsc;Global" title="scala.tools.nsc.Global">Global</a>

  import <a href="#scala.tools.nsc.transform;PostErasure.global" title="=&gt; scala.tools.nsc.Global">global</a>._
  import <a href="../ast/Trees.scala.html#scala.tools.nsc.ast;Trees.treeInfo" title="PostErasure.this.global.treeInfo.type">treeInfo</a>._

  val <a title="String" id="scala.tools.nsc.transform;PostErasure.phaseName">phaseName</a>: <span title="String">String</span> = <span title="String(&quot;posterasure&quot;)" class="string">&quot;posterasure&quot;</span>

  def <a title="(unit: PostErasure.this.global.CompilationUnit)PostErasure.this.global.Transformer" id="scala.tools.nsc.transform;PostErasure.newTransformer">newTransformer</a><span class="delimiter">(</span><a title="PostErasure.this.global.CompilationUnit" id="scala.tools.nsc.transform;PostErasure.newTransformer.unit">unit</a>: <a href="../CompilationUnits.scala.html#scala.tools.nsc;CompilationUnits;CompilationUnit" title="PostErasure.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span>: <a href="../ast/Trees.scala.html#scala.tools.nsc.ast;Trees;Transformer" title="PostErasure.this.global.Transformer">Transformer</a> = new <a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer" title="PostErasure.this.PostErasureTransformer">PostErasureTransformer</a><span class="delimiter">(</span><a href="#scala.tools.nsc.transform;PostErasure.newTransformer.unit" title="PostErasure.this.global.CompilationUnit">unit</a><span class="delimiter">)</span>
  override def <a title="=&gt; Boolean" id="scala.tools.nsc.transform;PostErasure.changesBaseClasses">changesBaseClasses</a> = false

  class <a title="class PostErasureTransformer extends PostErasure.this.TypingTransformer" id="scala.tools.nsc.transform;PostErasure;PostErasureTransformer">PostErasureTransformer</a><a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer" title="PostErasure.this.PostErasureTransformer" class="delimiter">(</a><a title="PostErasure.this.global.CompilationUnit" id="scala.tools.nsc.transform;PostErasure;PostErasureTransformer.unit">unit</a>: <a href="../CompilationUnits.scala.html#scala.tools.nsc;CompilationUnits;CompilationUnit" title="PostErasure.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span> extends <a href="TypingTransformers.scala.html#scala.tools.nsc.transform;TypingTransformers;TypingTransformer" title="PostErasure.this.TypingTransformer">TypingTransformer</a><span class="delimiter">(</span><a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer.unit" title="PostErasure.this.global.CompilationUnit">unit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    override def <a title="(tree: PostErasure.this.global.Tree)PostErasure.this.global.Tree" id="scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform">transform</a><span class="delimiter">(</span><span title="PostErasure.this.global.Tree">tree</span>: <a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Tree" title="PostErasure.this.global.Tree">Tree</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
      def <a title="(res: PostErasure.this.global.Tree)PostErasure.this.global.Tree" id="scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.finish">finish</a><span class="delimiter">(</span><a title="PostErasure.this.global.Tree" id="scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.finish.res">res</a>: <a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Tree" title="PostErasure.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="../../../reflect/internal/SymbolTable.scala.html#scala.reflect.internal;SymbolTable.logResult" title="(msg: =&gt; String)(result: PostErasure.this.global.Tree)PostErasure.this.global.Tree">logResult</a><span class="delimiter">(</span><a href="../../../StringContext.scala.html#scala;StringContext.s" title="(args: Any*)String">s</a>&quot;<span title="String(&quot;Posterasure reduction\\n  Old: &quot;)">Posterasure reduction\n  Old: $</span><span title="PostErasure.this.global.Tree">tree</span><span title="String(&quot;\\n  New&quot;)" class="string">\n  New&quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.finish.res" title="PostErasure.this.global.Tree">res</a><span class="delimiter">)</span>

      <span class="comment">/* We use the name of the operation being performed and not the symbol
       * itself because the symbol hails from the boxed class, and this transformation
       * exists to operate directly on the values. So we are for instance looking
       * up == on an lhs of type Int, whereas the symbol which has been passed in
       * is from java.lang.Integer.
       */</span>
      def <a title="(lhs: PostErasure.this.global.Tree, op: PostErasure.this.global.Symbol, rhs: PostErasure.this.global.Tree)PostErasure.this.global.Tree" id="scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.binop">binop</a><span class="delimiter">(</span><a title="PostErasure.this.global.Tree" id="scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.binop.lhs">lhs</a>: <a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Tree" title="PostErasure.this.global.Tree">Tree</a>, <a title="PostErasure.this.global.Symbol" id="scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.binop.op">op</a>: <a href="../../../reflect/internal/Symbols.scala.html#scala.reflect.internal;Symbols;Symbol" title="PostErasure.this.global.Symbol">Symbol</a>, <a title="PostErasure.this.global.Tree" id="scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.binop.rhs">rhs</a>: <a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Tree" title="PostErasure.this.global.Tree">Tree</a><span class="delimiter">)</span> =
        <a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.finish" title="(res: PostErasure.this.global.Tree)PostErasure.this.global.Tree">finish</a><span class="delimiter">(</span><a href="TypingTransformers.scala.html#scala.tools.nsc.transform;TypingTransformers;TypingTransformer.localTyper" title="=&gt; PostErasure.this.global.analyzer.Typer">localTyper</a> <a href="../typechecker/Typers.scala.html#scala.tools.nsc.typechecker;Typers;Typer.typed(60ebfc8632)" title="(tree: PostErasure.this.global.analyzer.global.Tree)PostErasure.this.global.analyzer.global.Tree">typed</a> <span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Apply" title="(fun: PostErasure.this.global.Tree, args: List[PostErasure.this.global.Tree])PostErasure.this.global.Apply">Apply</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Select" title="(qualifier: PostErasure.this.global.Tree, name: PostErasure.this.global.Name)PostErasure.this.global.Select">Select</a><span class="delimiter">(</span><a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.binop.lhs" title="PostErasure.this.global.Tree">lhs</a>, <a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.binop.op" title="PostErasure.this.global.Symbol">op</a>.<a href="../../../reflect/internal/Symbols.scala.html#scala.reflect.internal;Symbols;Symbol.name" title="=&gt; op.NameType">name</a><span class="delimiter">)</span> <a href="../../../reflect/internal/StdAttachments.scala.html#scala.reflect.internal;StdAttachments;Attachable.setPos" title="(newpos: scala.reflect.internal.util.Position)PostErasure.this.global.Select">setPos</a> <span title="PostErasure.this.global.Tree">tree</span>.<a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Tree.pos" title="=&gt; PostErasure.this.global.Position">pos</a>, <a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.binop.rhs" title="PostErasure.this.global.Tree">rhs</a> <a href="../../../collection/immutable/List.scala.html#scala.collection.immutable;List.::" title="(x: PostErasure.this.global.Tree)List[PostErasure.this.global.Tree]">::</a> <a href="../../../collection/immutable/List.scala.html#scala.collection.immutable.Nil" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span> <a href="../../../reflect/internal/StdAttachments.scala.html#scala.reflect.internal;StdAttachments;Attachable.setPos" title="(newpos: scala.reflect.internal.util.Position)PostErasure.this.global.Apply">setPos</a> <span title="PostErasure.this.global.Tree">tree</span>.<a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Tree.pos" title="=&gt; PostErasure.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">)</span>

      super.<a href="TypingTransformers.scala.html#scala.tools.nsc.transform;TypingTransformers;TypingTransformer.transform" title="(tree: PostErasure.this.global.Tree)PostErasure.this.global.Tree">transform</a><span class="delimiter">(</span><span title="PostErasure.this.global.Tree">tree</span><span class="delimiter">)</span> <a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Tree.setType" title="(tp: PostErasure.this.global.Type)PostErasure.this.global.Tree">setType</a> <a href="../../../reflect/internal/transform/PostErasure.scala.html#scala.reflect.internal.transform;PostErasure.elimErasedValueType.apply" title="(tp: PostErasure.this.global.Type)PostErasure.this.global.Type">elimErasedValueType</a><span class="delimiter">(</span><span title="PostErasure.this.global.Tree">tree</span>.<a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Tree.tpe" title="=&gt; PostErasure.this.global.Type">tpe</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
        case <a href="../ast/TreeInfo.scala.html#scala.tools.nsc.ast;TreeInfo.AsInstanceOf.unapply" title="(t: PostErasure.this.global.treeInfo.global.Tree)Option[(PostErasure.this.global.treeInfo.global.Tree, PostErasure.this.global.treeInfo.global.Type)]">AsInstanceOf</a><span class="delimiter">(</span><span title="PostErasure.this.global.treeInfo.global.Tree">v</span>, <a title="PostErasure.this.global.treeInfo.global.Type" id="scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.tpe">tpe</a><span class="delimiter">)</span> if <span title="PostErasure.this.global.treeInfo.global.Tree">v</span>.<a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Tree.tpe" title="=&gt; PostErasure.this.global.treeInfo.global.Type">tpe</a> <a href="../../../reflect/internal/Types.scala.html#scala.reflect.internal;Types;Type.<:<" title="(that: PostErasure.this.global.treeInfo.global.Type)Boolean">&lt;:&lt;</a> <a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.tpe" title="PostErasure.this.global.treeInfo.global.Type">tpe</a> =&gt; <a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.finish" title="(res: PostErasure.this.global.Tree)PostErasure.this.global.Tree">finish</a><span class="delimiter">(</span><span title="PostErasure.this.global.treeInfo.global.Tree">v</span><span class="delimiter">)</span>          <span class="comment">// x.asInstanceOf[X]       ==&gt; x</span>
        case <a href="../ast/TreeInfo.scala.html#scala.tools.nsc.ast;TreeInfo.ValueClass" title="PostErasure.this.global.treeInfo.ValueClass.type">ValueClass</a>.<a href="../ast/TreeInfo.scala.html#scala.tools.nsc.ast;TreeInfo.ValueClass.BoxAndUnbox.unapply" title="(t: PostErasure.this.global.treeInfo.global.Tree)Option[PostErasure.this.global.treeInfo.global.Tree]">BoxAndUnbox</a><span class="delimiter">(</span><span title="PostErasure.this.global.treeInfo.global.Tree">v</span><span class="delimiter">)</span>             =&gt; <a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.finish" title="(res: PostErasure.this.global.Tree)PostErasure.this.global.Tree">finish</a><span class="delimiter">(</span><span title="PostErasure.this.global.treeInfo.global.Tree">v</span><span class="delimiter">)</span>          <span class="comment">// (new B(v)).unbox        ==&gt; v</span>
        case <a href="../ast/TreeInfo.scala.html#scala.tools.nsc.ast;TreeInfo.ValueClass" title="PostErasure.this.global.treeInfo.ValueClass.type">ValueClass</a>.<a href="../ast/TreeInfo.scala.html#scala.tools.nsc.ast;TreeInfo.ValueClass.BoxAndCompare.unapply" title="(t: PostErasure.this.global.treeInfo.global.Tree)Option[(PostErasure.this.global.treeInfo.global.Tree, PostErasure.this.global.treeInfo.global.Symbol, PostErasure.this.global.treeInfo.global.Tree)]">BoxAndCompare</a><span class="delimiter">(</span><a title="PostErasure.this.global.treeInfo.global.Tree" id="scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.v1">v1</a>, <a title="PostErasure.this.global.treeInfo.global.Symbol" id="scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.op">op</a>, <a title="PostErasure.this.global.treeInfo.global.Tree" id="scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.v2">v2</a><span class="delimiter">)</span>  =&gt; <a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.binop" title="(lhs: PostErasure.this.global.Tree, op: PostErasure.this.global.Symbol, rhs: PostErasure.this.global.Tree)PostErasure.this.global.Tree">binop</a><span class="delimiter">(</span><a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.v1" title="PostErasure.this.global.treeInfo.global.Tree">v1</a>, <a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.op" title="PostErasure.this.global.treeInfo.global.Symbol">op</a>, <a href="#scala.tools.nsc.transform;PostErasure;PostErasureTransformer.transform.v2" title="PostErasure.this.global.treeInfo.global.Tree">v2</a><span class="delimiter">)</span>  <span class="comment">// new B(v1) == new B(v2)  ==&gt; v1 == v2</span>
        case <span title="PostErasure.this.global.Tree">tree</span>                                  =&gt; <span title="PostErasure.this.global.Tree">tree</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
