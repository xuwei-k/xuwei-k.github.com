<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scala/tools/nsc/transform/patmat/MatchCps.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 *
 * Copyright 2011-2013 LAMP/EPFL
 * @author Adriaan Moors
 */</span>

package scala.tools.nsc.transform.patmat

<span class="comment">/** Segregating this super hacky CPS code. */</span>
trait <a title="trait MatchCps extends AnyRef" id="scala.tools.nsc.transform.patmat;MatchCps">MatchCps</a> <a href="../../../../Unit.scala.html#scala;Unit" title="Unit" class="delimiter">{</a>
  self: PatternMatching =&gt;

  import <a href="ScalacPatternExpanders.scala.html#scala.tools.nsc.transform.patmat;ScalacPatternExpanders.global" title="=&gt; scala.tools.nsc.Global">global</a>._

  <span class="comment">// duplicated from CPSUtils (avoid dependency from compiler -&gt; cps plugin...)</span>
  private object <a title="MatchCps.this.CpsSymbols.type" id="scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols">CpsSymbols</a> <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols" title="MatchCps.this.CpsSymbols.type" class="delimiter">{</a>
    private def <a title="(name: String)MatchCps.this.global.Symbol" id="scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.cpsSymbol">cpsSymbol</a><span class="delimiter">(</span><a title="String" id="scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.cpsSymbol.name">name</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="../../Global.scala.html#scala.tools.nsc;Global.rootMirror" title="=&gt; MatchCps.this.global.Mirror">rootMirror</a>.<a href="../../../../reflect/internal/Mirrors.scala.html#scala.reflect.internal;Mirrors;RootsBase.getClassIfDefined(bbad876616)" title="(fullname: String)MatchCps.this.global.Symbol">getClassIfDefined</a><span class="delimiter">(</span><a href="../../../../StringContext.scala.html#scala;StringContext.s" title="(args: Any*)String">s</a>&quot;<span title="String(&quot;scala.util.continuations.&quot;)">scala.util.continuations.$</span><a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.cpsSymbol.name" title="String">name</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>

    val <a title="MatchCps.this.global.Symbol" id="scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.MarkerCPSAdaptPlus">MarkerCPSAdaptPlus</a>  = <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.cpsSymbol" title="(name: String)MatchCps.this.global.Symbol">cpsSymbol</a><span class="delimiter">(</span><span title="String(&quot;cpsPlus&quot;)" class="string">&quot;cpsPlus&quot;</span><span class="delimiter">)</span>
    val <a title="MatchCps.this.global.Symbol" id="scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.MarkerCPSAdaptMinus">MarkerCPSAdaptMinus</a> = <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.cpsSymbol" title="(name: String)MatchCps.this.global.Symbol">cpsSymbol</a><span class="delimiter">(</span><span title="String(&quot;cpsMinus&quot;)" class="string">&quot;cpsMinus&quot;</span><span class="delimiter">)</span>
    val <a title="MatchCps.this.global.Symbol" id="scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.MarkerCPSSynth">MarkerCPSSynth</a>      = <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.cpsSymbol" title="(name: String)MatchCps.this.global.Symbol">cpsSymbol</a><span class="delimiter">(</span><span title="String(&quot;cpsSynth&quot;)" class="string">&quot;cpsSynth&quot;</span><span class="delimiter">)</span>
    val <a title="MatchCps.this.global.Symbol" id="scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.MarkerCPSTypes">MarkerCPSTypes</a>      = <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.cpsSymbol" title="(name: String)MatchCps.this.global.Symbol">cpsSymbol</a><span class="delimiter">(</span><span title="String(&quot;cpsParam&quot;)" class="string">&quot;cpsParam&quot;</span><span class="delimiter">)</span>
    val <a title="scala.collection.immutable.Set[MatchCps.this.global.Symbol]" id="scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.stripTriggerCPSAnns">stripTriggerCPSAnns</a> = <a href="../../../../collection/generic/GenericCompanion.scala.html#scala.collection.generic;GenericCompanion.apply" title="[A](elems: A*)scala.collection.immutable.Set[A]">Set</a><span title="(elems: MatchCps.this.global.Symbol*)scala.collection.immutable.Set[MatchCps.this.global.Symbol]" class="delimiter">[</span><a href="../../../../reflect/internal/Symbols.scala.html#scala.reflect.internal;Symbols;Symbol" title="MatchCps.this.global.Symbol">Symbol</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.MarkerCPSSynth" title="=&gt; MatchCps.this.global.Symbol">MarkerCPSSynth</a>, <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.MarkerCPSAdaptMinus" title="=&gt; MatchCps.this.global.Symbol">MarkerCPSAdaptMinus</a>, <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.MarkerCPSAdaptPlus" title="=&gt; MatchCps.this.global.Symbol">MarkerCPSAdaptPlus</a><span class="delimiter">)</span>
    val strippedCPSAnns     = <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.stripTriggerCPSAnns" title="=&gt; scala.collection.immutable.Set[MatchCps.this.global.Symbol]">stripTriggerCPSAnns</a> <a href="../../../../collection/SetLike.scala.html#scala.collection;SetLike.+(daf7108c0f)" title="scala.collection.immutable.Set[MatchCps.this.global.Symbol]" id="scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.strippedCPSAnns">+</a> <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.MarkerCPSTypes" title="=&gt; MatchCps.this.global.Symbol">MarkerCPSTypes</a>

    <span class="comment">// when one of the internal cps-type-state annotations is present, strip all CPS annotations</span>
    <span class="comment">// a cps-type-state-annotated type makes no sense as an expected type (matchX.tpe is used as pt in translateMatch)</span>
    <span class="comment">// (only test availability of MarkerCPSAdaptPlus assuming they are either all available or none of them are)</span>
    def <a title="(pt: MatchCps.this.global.Type)MatchCps.this.global.Type" id="scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.removeCPSFromPt">removeCPSFromPt</a><span class="delimiter">(</span><a title="MatchCps.this.global.Type" id="scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.removeCPSFromPt.pt">pt</a>: <a href="../../../../reflect/internal/Types.scala.html#scala.reflect.internal;Types;Type" title="MatchCps.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../../reflect/internal/Types.scala.html#scala.reflect.internal;Types;Type" title="MatchCps.this.global.Type">Type</a> = <span class="delimiter">(</span>
      if <span class="delimiter">(</span><a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.MarkerCPSAdaptPlus" title="=&gt; MatchCps.this.global.Symbol">MarkerCPSAdaptPlus</a>.<a href="../../../../reflect/internal/Symbols.scala.html#scala.reflect.internal;Symbols;Symbol.exists" title="=&gt; Boolean">exists</a> <a href="../../../../Boolean.scala.html#scala;Boolean.&&" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.stripTriggerCPSAnns" title="=&gt; scala.collection.immutable.Set[MatchCps.this.global.Symbol]">stripTriggerCPSAnns</a> <a href="../../../../collection/IterableLike.scala.html#scala.collection;IterableLike.exists" title="(p: MatchCps.this.global.Symbol =&gt; Boolean)Boolean">exists</a> <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.removeCPSFromPt.pt" title="MatchCps.this.global.Type">pt</a>.<a href="../../../../reflect/internal/AnnotationInfos.scala.html#scala.reflect.internal;AnnotationInfos;Annotatable.hasAnnotation" title="(cls: MatchCps.this.global.Symbol)Boolean">hasAnnotation</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.removeCPSFromPt.pt" title="MatchCps.this.global.Type">pt</a> <a href="../../../../reflect/internal/Types.scala.html#scala.reflect.internal;Types;Type.filterAnnotations" title="(p: MatchCps.this.global.AnnotationInfo =&gt; Boolean)MatchCps.this.global.Type">filterAnnotations</a> <span class="delimiter">(</span><a title="MatchCps.this.global.AnnotationInfo" id="scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.removeCPSFromPt.$anonfun.ann">ann</a> =&gt; <a href="../../../../Boolean.scala.html#scala;Boolean.unary_!" title="=&gt; Boolean">!</a><span class="delimiter">(</span><a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.strippedCPSAnns" title="=&gt; scala.collection.immutable.Set[MatchCps.this.global.Symbol]">strippedCPSAnns</a> <a href="../../../../collection/IterableLike.scala.html#scala.collection;IterableLike.exists" title="(p: MatchCps.this.global.Symbol =&gt; Boolean)Boolean">exists</a> <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.removeCPSFromPt.$anonfun.ann" title="MatchCps.this.global.AnnotationInfo">ann</a>.<a href="../../../../reflect/internal/AnnotationInfos.scala.html#scala.reflect.internal;AnnotationInfos;AnnotationInfo.matches" title="(clazz: MatchCps.this.global.Symbol)Boolean">matches</a><span class="delimiter">)</span><span class="delimiter">)</span>
      else
        <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.removeCPSFromPt.pt" title="MatchCps.this.global.Type">pt</a>
    <span class="delimiter">)</span>
  <span class="delimiter">}</span>
  def <a title="(pt: MatchCps.this.global.Type)MatchCps.this.global.Type" id="scala.tools.nsc.transform.patmat;MatchCps.removeCPSFromPt">removeCPSFromPt</a><span class="delimiter">(</span><a title="MatchCps.this.global.Type" id="scala.tools.nsc.transform.patmat;MatchCps.removeCPSFromPt.pt">pt</a>: <a href="../../../../reflect/internal/Types.scala.html#scala.reflect.internal;Types;Type" title="MatchCps.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../../reflect/internal/Types.scala.html#scala.reflect.internal;Types;Type" title="MatchCps.this.global.Type">Type</a> = <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols" title="MatchCps.this.CpsSymbols.type">CpsSymbols</a> <a href="#scala.tools.nsc.transform.patmat;MatchCps.CpsSymbols.removeCPSFromPt" title="(pt: MatchCps.this.global.Type)MatchCps.this.global.Type">removeCPSFromPt</a> <a href="#scala.tools.nsc.transform.patmat;MatchCps.removeCPSFromPt.pt" title="MatchCps.this.global.Type">pt</a>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
