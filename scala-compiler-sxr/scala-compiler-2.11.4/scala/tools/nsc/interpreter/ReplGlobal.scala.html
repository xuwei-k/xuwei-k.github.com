<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scala/tools/nsc/interpreter/ReplGlobal.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2013 LAMP/EPFL
 * @author  Paul Phillips
 */</span>

package scala.tools.nsc
package interpreter

import typechecker.Analyzer

<span class="comment">/** A layer on top of Global so I can guarantee some extra
 *  functionality for the repl.  It doesn't do much yet.
 */</span>
trait <a title="trait ReplGlobal extends scala.tools.nsc.Global" id="scala.tools.nsc.interpreter;ReplGlobal">ReplGlobal</a> extends <a href="../Global.scala.html#scala.tools.nsc;Global" title="scala.tools.nsc.Global">Global</a> <span class="delimiter">{</span>
  <span class="comment">// This exists mostly because using the reporter too early leads to deadlock.</span>
  private def <a title="(msg: String)Unit" id="scala.tools.nsc.interpreter;ReplGlobal.echo">echo</a><span class="delimiter">(</span><a title="String" id="scala.tools.nsc.interpreter;ReplGlobal.echo.msg">msg</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="../../../Console.scala.html#scala.Console" title="Console.type">Console</a> <a href="../../../Console.scala.html#scala.Console.println(b0c81b2e65)" title="(x: Any)Unit">println</a> <a href="#scala.tools.nsc.interpreter;ReplGlobal.echo.msg" title="String">msg</a> <span class="delimiter">}</span>

  override def <a title="(msg: String)Nothing" id="scala.tools.nsc.interpreter;ReplGlobal.abort">abort</a><span class="delimiter">(</span><a title="String" id="scala.tools.nsc.interpreter;ReplGlobal.abort.msg">msg</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Nothing">Nothing</span> = <span class="delimiter">{</span>
    <a href="#scala.tools.nsc.interpreter;ReplGlobal.echo" title="(msg: String)Unit">echo</a><span class="delimiter">(</span><span title="String(&quot;ReplGlobal.abort: &quot;)" class="string">&quot;ReplGlobal.abort: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.interpreter;ReplGlobal.abort.msg" title="String">msg</a><span class="delimiter">)</span>
    super.<a href="../../../reflect/internal/Reporting.scala.html#scala.reflect.internal;Reporting.abort" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><a href="#scala.tools.nsc.interpreter;ReplGlobal.abort.msg" title="String">msg</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  override lazy val <a title="&lt;refinement of scala.tools.nsc.typechecker.Analyzer&gt; extends AnyRef with scala.tools.nsc.typechecker.Analyzer" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer">analyzer</a> = new <a title="&lt;$anon: scala.tools.nsc.typechecker.Analyzer&gt; extends AnyRef with scala.tools.nsc.typechecker.Analyzer" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon" class="delimiter">{</a>
    val <a title="ReplGlobal.this.type" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.global">global</a>: ReplGlobal.this.type = <a href="#scala.tools.nsc.interpreter;ReplGlobal" title="ReplGlobal.this.type">ReplGlobal</a>.this
  <span class="delimiter">}</span> with <a href="../typechecker/Analyzer.scala.html#scala.tools.nsc.typechecker;Analyzer" title="scala.tools.nsc.typechecker.Analyzer">Analyzer</a> <span class="delimiter">{</span>

    override protected def <a title="()ClassLoader" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.findMacroClassLoader">findMacroClassLoader</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="ClassLoader">ClassLoader</span> = <span class="delimiter">{</span>
      val <a title="ClassLoader" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.findMacroClassLoader.loader">loader</a> = super.<a href="../typechecker/Macros.scala.html#scala.tools.nsc.typechecker;Macros.findMacroClassLoader" title="()ClassLoader">findMacroClassLoader</a>
      <a href="../../../reflect/macros/util/Traces.scala.html#scala.reflect.macros.util;Traces.macroLogVerbose" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#scala.Predef.augmentString" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;macro classloader: initializing from a REPL classloader: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#scala.collection.immutable;StringLike.format" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.global" title="=&gt; ReplGlobal.this.type">global</a>.<a href="../Global.scala.html#scala.tools.nsc;Global.classPath" title="=&gt; this.global.PlatformClassPath">classPath</a>.<a href="../util/ClassPath.scala.html#scala.tools.nsc.util;ClassPath.asURLs" title="=&gt; List[java.net.URL]">asURLs</a><span class="delimiter">)</span><span class="delimiter">)</span>
      val <a title="scala.tools.nsc.io.AbstractFile" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.findMacroClassLoader.virtualDirectory">virtualDirectory</a> = <a href="../typechecker/Macros.scala.html#scala.tools.nsc.typechecker;Macros.globalSettings" title="=&gt; scala.tools.nsc.Settings">globalSettings</a>.<a href="../settings/MutableSettings.scala.html#scala.tools.nsc.settings;MutableSettings.outputDirs" title="=&gt; scala.tools.nsc.Settings#OutputDirs">outputDirs</a>.<a href="../settings/MutableSettings.scala.html#scala.tools.nsc.settings;MutableSettings;OutputDirs.getSingleOutput" title="=&gt; Option[scala.tools.nsc.io.AbstractFile]">getSingleOutput</a>.<a href="../../../Option.scala.html#scala;Option.get" title="=&gt; scala.tools.nsc.io.AbstractFile">get</a>
      new <a title="&lt;$anon: scala.tools.nsc.util.AbstractFileClassLoader&gt; extends scala.tools.nsc.util.AbstractFileClassLoader" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.findMacroClassLoader;$anon">util</a>.<a href="../util/package.scala.html#scala.tools.nsc.util.package;AbstractFileClassLoader" title="scala.tools.nsc.util.AbstractFileClassLoader">AbstractFileClassLoader</a><span class="delimiter">(</span><a href="#scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.findMacroClassLoader.virtualDirectory" title="scala.tools.nsc.io.AbstractFile">virtualDirectory</a>, <a href="#scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.findMacroClassLoader.loader" title="ClassLoader">loader</a><span class="delimiter">)</span> <span class="delimiter">{</span><span class="delimiter">}</span>
    <span class="delimiter">}</span>

    override def <a title="(context: this.Context)this.Typer" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper">newTyper</a><span class="delimiter">(</span><a title="this.Context" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper.context">context</a>: <a href="../typechecker/Contexts.scala.html#scala.tools.nsc.typechecker;Contexts;Context" title="this.Context">Context</a><span class="delimiter">)</span>: <a href="../typechecker/Typers.scala.html#scala.tools.nsc.typechecker;Typers;Typer" title="this.Typer">Typer</a> = new <a href="../typechecker/Typers.scala.html#scala.tools.nsc.typechecker;Typers;Typer" title="&lt;$anon: this.Typer&gt; extends this.Typer" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon">Typer</a><span class="delimiter">(</span><a href="#scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper.context" title="this.Context">context</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      override def <a title="(tree: ReplGlobal.this.Tree, mode: scala.tools.nsc.Mode, pt: ReplGlobal.this.Type)ReplGlobal.this.Tree" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0)">typed</a><span class="delimiter">(</span><a title="ReplGlobal.this.Tree" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0).tree">tree</a>: <a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Tree" title="ReplGlobal.this.Tree">Tree</a>, <a title="scala.tools.nsc.Mode" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0).mode">mode</a>: <a href="../../../reflect/internal/Mode.scala.html#scala.reflect.internal;Mode" title="scala.tools.nsc.Mode">Mode</a>, <a title="ReplGlobal.this.Type" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0).pt">pt</a>: <a href="../../../reflect/internal/Types.scala.html#scala.reflect.internal;Types;Type" title="ReplGlobal.this.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Tree" title="ReplGlobal.this.Tree">Tree</a> = <span class="delimiter">{</span>
        val <a title="this.global.Tree" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0).res">res</a> = super.<a href="../typechecker/Typers.scala.html#scala.tools.nsc.typechecker;Typers;Typer.typed(301a5271e9)" title="(tree: this.global.Tree, mode: scala.tools.nsc.Mode, pt: this.global.Type)this.global.Tree">typed</a><span class="delimiter">(</span><a href="#scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0).tree" title="ReplGlobal.this.Tree">tree</a>, <a href="#scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0).mode" title="scala.tools.nsc.Mode">mode</a>, <a href="#scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0).pt" title="ReplGlobal.this.Type">pt</a><span class="delimiter">)</span>
        <a href="#scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0).tree" title="ReplGlobal.this.Tree">tree</a> match <span class="delimiter">{</span>
          case Ident<span class="delimiter">(</span><a title="ReplGlobal.this.Name" id="scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0).name">name</a><span class="delimiter">)</span> if <a href="../../../Boolean.scala.html#scala;Boolean.unary_!" title="=&gt; Boolean">!</a><a href="#scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0).tree" title="ReplGlobal.this.Tree">tree</a>.<a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Tree.symbol" title="=&gt; ReplGlobal.this.Symbol">symbol</a>.<a href="../../../reflect/internal/HasFlags.scala.html#scala.reflect.internal;HasFlags.hasPackageFlag" title="=&gt; Boolean">hasPackageFlag</a> <a href="../../../Boolean.scala.html#scala;Boolean.&&" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#scala;Boolean.unary_!" title="=&gt; Boolean">!</a><a href="#scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0).name" title="ReplGlobal.this.Name">name</a>.<span title="()String">toString</span>.<span title="(x$1: String)Boolean">startsWith</span><span class="delimiter">(</span><span title="String(&quot;$&quot;)" class="string">&quot;$&quot;</span><span class="delimiter">)</span> =&gt;
            <a href="ReplConfig.scala.html#scala.tools.nsc.interpreter;ReplConfig.repldbg" title="(msg: =&gt; String)Unit">repldbg</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#scala.Predef.augmentString" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;typed %s: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#scala.collection.immutable;StringLike.format" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0).name" title="ReplGlobal.this.Name">name</a>, <a href="#scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0).res" title="this.global.Tree">res</a>.<a href="../../../reflect/internal/Trees.scala.html#scala.reflect.internal;Trees;Tree.tpe" title="=&gt; this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
          case _ =&gt;
        <span class="delimiter">}</span>
        <a href="#scala.tools.nsc.interpreter;ReplGlobal.analyzer;$anon.newTyper;$anon.typed(96ada9fca0).res" title="this.global.Tree">res</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  object <a title="ReplGlobal.this.replPhase.type" id="scala.tools.nsc.interpreter;ReplGlobal.replPhase">replPhase</a> extends <a href="../SubComponent.scala.html#scala.tools.nsc;SubComponent" title="scala.tools.nsc.SubComponent">SubComponent</a> <span class="delimiter">{</span>
    val <a title="ReplGlobal.this.type" id="scala.tools.nsc.interpreter;ReplGlobal.replPhase.global">global</a>: ReplGlobal.this.type = <a href="#scala.tools.nsc.interpreter;ReplGlobal" title="ReplGlobal.this.type">ReplGlobal</a>.this
    val <a title="String" id="scala.tools.nsc.interpreter;ReplGlobal.replPhase.phaseName">phaseName</a> = <span title="String(&quot;repl&quot;)" class="string">&quot;repl&quot;</span>
    val <a title="List[String]" id="scala.tools.nsc.interpreter;ReplGlobal.replPhase.runsAfter">runsAfter</a> = <a href="../../../collection/immutable/List.scala.html#scala.collection.immutable.List.apply" title="[A](xs: A*)List[A]">List</a><span title="(xs: String*)List[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="String(&quot;typer&quot;)" class="string">&quot;typer&quot;</span><span class="delimiter">)</span>
    val <a title="None.type" id="scala.tools.nsc.interpreter;ReplGlobal.replPhase.runsRightAfter">runsRightAfter</a> = <a href="../../../Option.scala.html#scala.None" title="None.type">None</a>
    def <a title="(_prev: scala.tools.nsc.Phase)scala.tools.nsc.interpreter.ReplGlobal.replPhase.StdPhase" id="scala.tools.nsc.interpreter;ReplGlobal.replPhase.newPhase">newPhase</a><span class="delimiter">(</span><a title="scala.tools.nsc.Phase" id="scala.tools.nsc.interpreter;ReplGlobal.replPhase.newPhase._prev">_prev</a>: <a href="../../../reflect/internal/Phase.scala.html#scala.reflect.internal;Phase" title="scala.tools.nsc.Phase">Phase</a><span class="delimiter">)</span>: <a href="../SubComponent.scala.html#scala.tools.nsc;SubComponent;StdPhase" title="scala.tools.nsc.interpreter.ReplGlobal.replPhase.StdPhase">StdPhase</a> = new <a href="../SubComponent.scala.html#scala.tools.nsc;SubComponent;StdPhase" title="&lt;$anon: scala.tools.nsc.interpreter.ReplGlobal.replPhase.StdPhase&gt; extends scala.tools.nsc.interpreter.ReplGlobal.replPhase.StdPhase" id="scala.tools.nsc.interpreter;ReplGlobal.replPhase.newPhase;$anon">StdPhase</a><span class="delimiter">(</span><a href="#scala.tools.nsc.interpreter;ReplGlobal.replPhase.newPhase._prev" title="scala.tools.nsc.Phase">_prev</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      def <a title="(unit: ReplGlobal.this.CompilationUnit)Unit" id="scala.tools.nsc.interpreter;ReplGlobal.replPhase.newPhase;$anon.apply">apply</a><span class="delimiter">(</span><a title="ReplGlobal.this.CompilationUnit" id="scala.tools.nsc.interpreter;ReplGlobal.replPhase.newPhase;$anon.apply.unit">unit</a>: <a href="../CompilationUnits.scala.html#scala.tools.nsc;CompilationUnits;CompilationUnit" title="ReplGlobal.this.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="ReplConfig.scala.html#scala.tools.nsc.interpreter;ReplConfig.repldbg" title="(msg: =&gt; String)Unit">repldbg</a><span class="delimiter">(</span><span title="String(&quot;Running replPhase on &quot;)" class="string">&quot;Running replPhase on &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#scala.tools.nsc.interpreter;ReplGlobal.replPhase.newPhase;$anon.apply.unit" title="ReplGlobal.this.CompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#scala.tools.nsc;CompilationUnits;CompilationUnit.body" title="=&gt; ReplGlobal.this.Tree">body</a><span class="delimiter">)</span>
        <span class="comment">// newNamer(rootContext(unit)).enterSym(unit.body)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="comment">// add to initial or terminal phase to sanity check Run at construction</span>
    override val <a title="List[String]" id="scala.tools.nsc.interpreter;ReplGlobal.replPhase.requires">requires</a> = <a href="../../../collection/immutable/List.scala.html#scala.collection.immutable.List.apply" title="(xs: String*)List[String]">List</a><span class="delimiter">(</span><span title="String(&quot;typer&quot;)" class="string">&quot;typer&quot;</span><span class="delimiter">)</span>  <span class="comment">// ensure they didn't -Ystop-after:parser</span>
  <span class="delimiter">}</span>

  override protected def <a title="=&gt; List[scala.tools.nsc.SubComponent]" id="scala.tools.nsc.interpreter;ReplGlobal.computePhaseDescriptors">computePhaseDescriptors</a>: <a href="../../../collection/immutable/List.scala.html#scala.collection.immutable;List" title="List[scala.tools.nsc.SubComponent]">List</a><span class="delimiter">[</span>SubComponent<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="../Global.scala.html#scala.tools.nsc;Global.addToPhasesSet" title="(sub: scala.tools.nsc.SubComponent, descr: String)Unit">addToPhasesSet</a><span class="delimiter">(</span><a href="#scala.tools.nsc.interpreter;ReplGlobal.replPhase" title="ReplGlobal.this.replPhase.type">replPhase</a>, <span title="String(&quot;repl&quot;)" class="string">&quot;repl&quot;</span><span class="delimiter">)</span>
    super.<a href="../Global.scala.html#scala.tools.nsc;Global.computePhaseDescriptors" title="=&gt; List[scala.tools.nsc.SubComponent]">computePhaseDescriptors</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
