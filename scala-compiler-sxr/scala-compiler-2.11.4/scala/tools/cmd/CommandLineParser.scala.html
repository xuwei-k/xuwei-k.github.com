<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scala/tools/cmd/CommandLineParser.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NEST (New Scala Test)
 * Copyright 2007-2013 LAMP/EPFL
 * @author Paul Phillips
 */</span>

package scala.tools
package cmd

import scala.annotation.tailrec

<span class="comment">/** A simple (overly so) command line parser.
 *  !!! This needs a thorough test suite to make sure quoting is
 *  done correctly and portably.
 */</span>
object <a title="scala.tools.cmd.CommandLineParser.type" id="scala.tools.cmd.CommandLineParser">CommandLineParser</a> <a href="#scala.tools.cmd.CommandLineParser" title="scala.tools.cmd.CommandLineParser.type" class="delimiter">{</a>
  <span class="comment">// splits a string into a quoted prefix and the rest of the string,</span>
  <span class="comment">// taking escaping into account (using \)</span>
  <span class="comment">// `&quot;abc&quot;def` will match as `DoubleQuoted(abc, def)`</span>
  private class <a title="class QuotedExtractor extends AnyRef" id="scala.tools.cmd.CommandLineParser;QuotedExtractor">QuotedExtractor</a><a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor" title="scala.tools.cmd.CommandLineParser.QuotedExtractor" class="delimiter">(</a><a title="Char" id="scala.tools.cmd.CommandLineParser;QuotedExtractor.quote">quote</a>: <a href="../../Char.scala.html#scala;Char" title="Char">Char</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    def <a title="(in: String)Option[(String, String)]" id="scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply">unapply</a><span class="delimiter">(</span><a title="String" id="scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.in">in</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../Option.scala.html#scala;Option" title="Option[(String, String)]">Option</a><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      val <a title="String" id="scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.del">del</a> = <a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.quote" title="Char">quote</a>.<span title="()String">toString</span>
      if <span class="delimiter">(</span><a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.in" title="String">in</a> <span title="(x$1: String)Boolean">startsWith</span> <a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.del" title="String">del</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        var <a title="Boolean" id="scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.escaped">escaped</a> = false
        val <a href="../../Tuple2.scala.html#scala;Tuple2" title="(_1: String, _2: String)(String, String)" class="delimiter">(</a><a href="../../Tuple2.scala.html#scala;Tuple2._1" title="String" id="scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.quoted">quoted</a>, <a href="../../Tuple2.scala.html#scala;Tuple2._2" title="String" id="scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.next">next</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.in" title="String">in</a> <a href="../../Predef.scala.html#scala.Predef.augmentString" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">substring</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="../../collection/IndexedSeqOptimized.scala.html#scala.collection;IndexedSeqOptimized.span" title="(String, String)">span</a> <a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.x$1.$anonfun.x0$1" title="Boolean" class="delimiter">{</a>
          case <a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.quote" title="Char">`quote`</a> if <a href="../../Boolean.scala.html#scala;Boolean.unary_!" title="=&gt; Boolean">!</a><a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.escaped" title="Boolean">escaped</a> =&gt; false
          case <span title="Char('\\')" class="char">'\\'</span>    if <a href="../../Boolean.scala.html#scala;Boolean.unary_!" title="=&gt; Boolean">!</a><a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.escaped" title="Boolean">escaped</a> =&gt; <a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.escaped" title="Boolean">escaped</a> = true; true
          case _                   =&gt; <a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.escaped" title="Boolean">escaped</a> = false; true
        <span class="delimiter">}</span>
        <span class="comment">// the only way to get out of the above loop is with an empty next or !escaped</span>
        <span class="comment">// require(next.isEmpty || !escaped)</span>
        if <span class="delimiter">(</span><a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.next" title="String">next</a> <span title="(x$1: String)Boolean">startsWith</span> <a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.del" title="String">del</a><span class="delimiter">)</span> <a href="../../Option.scala.html#scala;Some" title="(x: (String, String))Some[(String, String)]">Some</a><span class="delimiter">(</span><a href="../../Tuple2.scala.html#scala;Tuple2" title="(_1: String, _2: String)(String, String)" class="delimiter">(</a><a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.quoted" title="String">quoted</a>, <a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply.next" title="String">next</a> <span title="(x$1: Int)String">substring</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
        else <a href="../../Option.scala.html#scala.None" title="None.type">None</a>
      <span class="delimiter">}</span> else <a href="../../Option.scala.html#scala.None" title="None.type">None</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  private object <a title="scala.tools.cmd.CommandLineParser.DoubleQuoted.type" id="scala.tools.cmd.CommandLineParser.DoubleQuoted">DoubleQuoted</a> extends <a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor" title="scala.tools.cmd.CommandLineParser.QuotedExtractor">QuotedExtractor</a><span class="delimiter">(</span><span title="Char('\&quot;')" class="char">'&quot;'</span><span class="delimiter">)</span>
  private object <a title="scala.tools.cmd.CommandLineParser.SingleQuoted.type" id="scala.tools.cmd.CommandLineParser.SingleQuoted">SingleQuoted</a> extends <a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor" title="scala.tools.cmd.CommandLineParser.QuotedExtractor">QuotedExtractor</a><span class="delimiter">(</span><span title="Char('\'')" class="char">'\''</span><span class="delimiter">)</span>
  private val <a title="scala.util.matching.Regex" id="scala.tools.cmd.CommandLineParser.Word">Word</a> = <a href="../../Predef.scala.html#scala.Predef.augmentString" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;(\S+)(.*)&quot;&quot;&quot;</a>.<a href="../../collection/immutable/StringLike.scala.html#scala.collection.immutable;StringLike.r(10b770f77e)" title="=&gt; scala.util.matching.Regex">r</a>

  <span class="comment">// parse `in` for an argument, return it and the remainder of the input (or an error message)</span>
  <span class="comment">// (argument may be in single/double quotes, taking escaping into account, quotes are stripped)</span>
  private def <a title="(in: String)Either[String,(String, String)]" id="scala.tools.cmd.CommandLineParser.argument">argument</a><span class="delimiter">(</span><a title="String" id="scala.tools.cmd.CommandLineParser.argument.in">in</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../util/Either.scala.html#scala.util;Either" title="Either[String,(String, String)]">Either</a><span class="delimiter">[</span>String, <span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span> = <a href="#scala.tools.cmd.CommandLineParser.argument.in" title="String">in</a> match <span class="delimiter">{</span>
    case <a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply" title="(in: String)Option[(String, String)]">DoubleQuoted</a><span class="delimiter">(</span><span title="String">arg</span>, <span title="String">rest</span><span class="delimiter">)</span> =&gt; <a href="../../util/Either.scala.html#scala.util;Right" title="(b: (String, String))scala.util.Right[Nothing,(String, String)]">Right</a><span class="delimiter">(</span><a href="../../Tuple2.scala.html#scala;Tuple2" title="(_1: String, _2: String)(String, String)" class="delimiter">(</a><span title="String">arg</span>, <span title="String">rest</span><span class="delimiter">)</span><span class="delimiter">)</span>
    case <a href="#scala.tools.cmd.CommandLineParser;QuotedExtractor.unapply" title="(in: String)Option[(String, String)]">SingleQuoted</a><span class="delimiter">(</span><span title="String">arg</span>, <span title="String">rest</span><span class="delimiter">)</span> =&gt; <a href="../../util/Either.scala.html#scala.util;Right" title="(b: (String, String))scala.util.Right[Nothing,(String, String)]">Right</a><span class="delimiter">(</span><a href="../../Tuple2.scala.html#scala;Tuple2" title="(_1: String, _2: String)(String, String)" class="delimiter">(</a><span title="String">arg</span>, <span title="String">rest</span><span class="delimiter">)</span><span class="delimiter">)</span>
    case <a href="../../util/matching/Regex.scala.html#scala.util.matching;Regex.unapplySeq(e8ea5a0e04)" title="(s: CharSequence)Option[List[String]]">Word</a><span class="delimiter">(</span><span title="String">arg</span>, <span title="String">rest</span><span class="delimiter">)</span>         =&gt; <a href="../../util/Either.scala.html#scala.util;Right" title="(b: (String, String))scala.util.Right[Nothing,(String, String)]">Right</a><span class="delimiter">(</span><a href="../../Tuple2.scala.html#scala;Tuple2" title="(_1: String, _2: String)(String, String)" class="delimiter">(</a><span title="String">arg</span>, <span title="String">rest</span><span class="delimiter">)</span><span class="delimiter">)</span>
    case _                       =&gt; <a href="../../util/Either.scala.html#scala.util;Left" title="(a: String)scala.util.Left[String,Nothing]">Left</a><span class="delimiter">(</span><a href="../../StringContext.scala.html#scala;StringContext.s" title="(args: Any*)String">s</a>&quot;<span title="String(&quot;Illegal argument: &quot;)">Illegal argument: $</span><a href="#scala.tools.cmd.CommandLineParser.argument.in" title="String">in</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">// parse a list of whitespace-separated arguments (ignoring whitespace in quoted arguments)</span>
  @tailrec private def <a title="(in: String, accum: List[String])Either[String,(List[String], String)]" id="scala.tools.cmd.CommandLineParser.commandLine">commandLine</a><span class="delimiter">(</span><a title="String" id="scala.tools.cmd.CommandLineParser.commandLine.in">in</a>: <span title="String">String</span>, <a title="List[String]" id="scala.tools.cmd.CommandLineParser.commandLine$default$2">accum</a>: <a href="../../collection/immutable/List.scala.html#scala.collection.immutable;List" title="List[String]">List</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="../../collection/immutable/List.scala.html#scala.collection.immutable.Nil" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>: <a href="../../util/Either.scala.html#scala.util;Either" title="Either[String,(List[String], String)]">Either</a><span class="delimiter">[</span>String, <span class="delimiter">(</span>List<span class="delimiter">[</span>String<span class="delimiter">]</span>, String<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    val <a title="String" id="scala.tools.cmd.CommandLineParser.commandLine.trimmed">trimmed</a> = <a href="#scala.tools.cmd.CommandLineParser.commandLine.in" title="String">in</a>.<span title="()String">trim</span>
    if <span class="delimiter">(</span><a href="#scala.tools.cmd.CommandLineParser.commandLine.trimmed" title="String">trimmed</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <a href="../../util/Either.scala.html#scala.util;Right" title="(b: (List[String], String))scala.util.Right[Nothing,(List[String], String)]">Right</a><span class="delimiter">(</span><a href="../../Tuple2.scala.html#scala;Tuple2" title="(_1: List[String], _2: String)(List[String], String)" class="delimiter">(</a><a href="#scala.tools.cmd.CommandLineParser.commandLine$default$2" title="List[String]">accum</a>.<a href="../../collection/immutable/List.scala.html#scala.collection.immutable;List.reverse" title="=&gt; List[String]">reverse</a>, <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    else <a href="#scala.tools.cmd.CommandLineParser.argument" title="(in: String)Either[String,(String, String)]">argument</a><span class="delimiter">(</span><a href="#scala.tools.cmd.CommandLineParser.commandLine.trimmed" title="String">trimmed</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
      case Right<span class="delimiter">(</span><span class="delimiter">(</span><a title="String" id="scala.tools.cmd.CommandLineParser.commandLine.arg">arg</a>, <a title="String" id="scala.tools.cmd.CommandLineParser.commandLine.next">next</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <span class="delimiter">(</span><a href="../../Predef.scala.html#scala.Predef.augmentString" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">next</a> <a href="../../collection/IndexedSeqOptimized.scala.html#scala.collection;IndexedSeqOptimized.span" title="(p: Char =&gt; Boolean)(String, String)">span</a> <span title="Character.type">Character</span>.<a href="#scala.tools.cmd.CommandLineParser.commandLine.$anonfun.x$1" title="(x$1: Char)Boolean">isWhitespace</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
          case<span class="delimiter">(</span><span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="String">rest</span><span class="delimiter">)</span> if <a href="../../Predef.scala.html#scala.Predef.augmentString" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">rest</a>.<a href="../../collection/TraversableOnce.scala.html#scala.collection;TraversableOnce.nonEmpty" title="=&gt; Boolean">nonEmpty</a> =&gt; <a href="../../util/Either.scala.html#scala.util;Left" title="(a: String)scala.util.Left[String,Nothing]">Left</a><span class="delimiter">(</span><span title="String(&quot;Arguments should be separated by whitespace.&quot;)" class="string">&quot;Arguments should be separated by whitespace.&quot;</span><span class="delimiter">)</span> <span class="comment">// TODO: can this happen?</span>
          case<span class="delimiter">(</span><a title="String" id="scala.tools.cmd.CommandLineParser.commandLine.ws">ws</a>, <span title="String">rest</span><span class="delimiter">)</span>                  =&gt; <a href="#scala.tools.cmd.CommandLineParser.commandLine" title="(in: String, accum: List[String])Either[String,(List[String], String)]">commandLine</a><span class="delimiter">(</span><span title="String">rest</span>, <a href="#scala.tools.cmd.CommandLineParser.commandLine.arg" title="String">arg</a> <a href="../../collection/immutable/List.scala.html#scala.collection.immutable;List.::" title="(x: String)List[String]">::</a> <a href="#scala.tools.cmd.CommandLineParser.commandLine$default$2" title="List[String]">accum</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      case Left<span class="delimiter">(</span><a title="String" id="scala.tools.cmd.CommandLineParser.commandLine.msg">msg</a><span class="delimiter">)</span> =&gt; <a href="../../util/Either.scala.html#scala.util;Left" title="(a: String)scala.util.Left[String,Nothing]">Left</a><span class="delimiter">(</span><a href="#scala.tools.cmd.CommandLineParser.commandLine.msg" title="String">msg</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  class <a title="class ParseException extends RuntimeException" id="scala.tools.cmd.CommandLineParser;ParseException">ParseException</a><a href="#scala.tools.cmd.CommandLineParser;ParseException" title="scala.tools.cmd.CommandLineParser.ParseException" class="delimiter">(</a><a title="String" id="scala.tools.cmd.CommandLineParser;ParseException.msg">msg</a>: <span title="String">String</span><span class="delimiter">)</span> extends <a href="../../package.scala.html#scala.package;RuntimeException" title="RuntimeException">RuntimeException</a><span class="delimiter">(</span><a href="#scala.tools.cmd.CommandLineParser;ParseException.msg" title="String">msg</a><span class="delimiter">)</span>

  def <a title="(line: String)List[String]" id="scala.tools.cmd.CommandLineParser.tokenize(124e6ae60f)">tokenize</a><span class="delimiter">(</span><a title="String" id="scala.tools.cmd.CommandLineParser.tokenize(124e6ae60f).line">line</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../collection/immutable/List.scala.html#scala.collection.immutable;List" title="List[String]">List</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#scala.tools.cmd.CommandLineParser.tokenize(9a0c61a426)" title="(line: String, errorFn: String =&gt; Unit)List[String]">tokenize</a><span class="delimiter">(</span><a href="#scala.tools.cmd.CommandLineParser.tokenize(124e6ae60f).line" title="String">line</a>, <a title="String" id="scala.tools.cmd.CommandLineParser.tokenize(124e6ae60f).$anonfun.x">x</a> =&gt; throw new <a href="#scala.tools.cmd.CommandLineParser;ParseException" title="scala.tools.cmd.CommandLineParser.ParseException">ParseException</a><span class="delimiter">(</span><a href="#scala.tools.cmd.CommandLineParser.tokenize(124e6ae60f).$anonfun.x" title="String">x</a><span class="delimiter">)</span><span class="delimiter">)</span>
  def <a title="(line: String, errorFn: String =&gt; Unit)List[String]" id="scala.tools.cmd.CommandLineParser.tokenize(9a0c61a426)">tokenize</a><span class="delimiter">(</span><a title="String" id="scala.tools.cmd.CommandLineParser.tokenize(9a0c61a426).line">line</a>: <span title="String">String</span>, <a title="String =&gt; Unit" id="scala.tools.cmd.CommandLineParser.tokenize(9a0c61a426).errorFn">errorFn</a>: String =&gt; Unit<span class="delimiter">)</span>: <a href="../../collection/immutable/List.scala.html#scala.collection.immutable;List" title="List[String]">List</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#scala.tools.cmd.CommandLineParser.commandLine" title="(in: String, accum: List[String])Either[String,(List[String], String)]">commandLine</a><span class="delimiter">(</span><a href="#scala.tools.cmd.CommandLineParser.tokenize(9a0c61a426).line" title="String">line</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
      case Right<span class="delimiter">(</span><span class="delimiter">(</span><a title="List[String]" id="scala.tools.cmd.CommandLineParser.tokenize(9a0c61a426).args">args</a>, _<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#scala.tools.cmd.CommandLineParser.tokenize(9a0c61a426).args" title="List[String]">args</a>
      case Left<span class="delimiter">(</span><a title="String" id="scala.tools.cmd.CommandLineParser.tokenize(9a0c61a426).msg">msg</a><span class="delimiter">)</span>        =&gt; <a href="../../Function1.scala.html#scala;Function1.apply" title="(v1: String)Unit">errorFn</a><span class="delimiter">(</span><a href="#scala.tools.cmd.CommandLineParser.tokenize(9a0c61a426).msg" title="String">msg</a><span class="delimiter">)</span> ; <a href="../../collection/immutable/List.scala.html#scala.collection.immutable.Nil" title="scala.collection.immutable.Nil.type">Nil</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
