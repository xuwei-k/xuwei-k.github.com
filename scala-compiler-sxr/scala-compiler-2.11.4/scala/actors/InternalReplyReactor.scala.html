<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scala/actors/InternalReplyReactor.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
package scala.actors

import java.util.<span class="delimiter">{</span>TimerTask<span class="delimiter">}</span>

<span class="comment">/** 
 * Extends the [[scala.actors.Reactor]]
 *    trait with methods to reply to the sender of a message.
 *    Sending a message to a &lt;code&gt;ReplyReactor&lt;/code&gt; implicitly
 *    passes a reference to the sender together with the message.
 *
 *  @author Philipp Haller
 *
 *  @define actor `ReplyReactor`
 */</span>
@deprecated<span class="delimiter">(</span><span class="string">&quot;Use the akka.actor package instead. For migration from the scala.actors package refer to the Actors Migration Guide.&quot;</span>, <span class="string">&quot;2.11.0&quot;</span><span class="delimiter">)</span>
trait <a title="trait InternalReplyReactor extends AnyRef with scala.actors.Reactor[Any] with scala.actors.ReactorCanReply" id="scala.actors;InternalReplyReactor">InternalReplyReactor</a> extends <a href="Reactor.scala.html#scala.actors;Reactor" title="scala.actors.Reactor[Any]">Reactor</a><span class="delimiter">[</span>Any<span class="delimiter">]</span> with <a href="ReactorCanReply.scala.html#scala.actors;ReactorCanReply" title="scala.actors.ReactorCanReply">ReactorCanReply</a> <span class="delimiter">{</span>

  <span class="comment">/* A list of the current senders. The head of the list is
   * the sender of the message that was received last.
   */</span>
  @volatile
  private<span class="delimiter">[</span>actors<span class="delimiter">]</span> var <a title="List[scala.actors.OutputChannel[Any]]" id="scala.actors;InternalReplyReactor.senders_=">senders</a>: <a href="../collection/immutable/List.scala.html#scala.collection.immutable;List" title="List[scala.actors.OutputChannel[Any]]">List</a><span class="delimiter">[</span>OutputChannel<span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">]</span> = List<a href="../collection/immutable/List.scala.html#scala.collection.immutable.Nil" title="scala.collection.immutable.Nil.type" class="delimiter">(</a><span class="delimiter">)</span>

  <span class="comment">/* This option holds a TimerTask when the actor waits in a
   * reactWithin. The TimerTask is cancelled when the actor
   * resumes.
   *
   * guarded by this
   */</span>
  private<span class="delimiter">[</span>actors<span class="delimiter">]</span> var <a title="Option[java.util.TimerTask]" id="scala.actors;InternalReplyReactor.onTimeout_=">onTimeout</a>: <a href="../Option.scala.html#scala;Option" title="Option[java.util.TimerTask]">Option</a><span class="delimiter">[</span>TimerTask<span class="delimiter">]</span> = <a href="../Option.scala.html#scala.None" title="None.type">None</a>

  <span class="comment">/**
   * Returns the $actor which sent the last received message.
   */</span>
  protected<span class="delimiter">[</span>actors<span class="delimiter">]</span> def <a title="=&gt; scala.actors.OutputChannel[Any]" id="scala.actors;InternalReplyReactor.internalSender">internalSender</a>: <a href="OutputChannel.scala.html#scala.actors;OutputChannel" title="scala.actors.OutputChannel[Any]">OutputChannel</a><span class="delimiter">[</span>Any<span class="delimiter">]</span> = <a href="#scala.actors;InternalReplyReactor.senders_=" title="=&gt; List[scala.actors.OutputChannel[Any]]">senders</a>.<a href="../collection/IterableLike.scala.html#scala.collection;IterableLike.head" title="=&gt; scala.actors.OutputChannel[Any]">head</a>

  <span class="comment">/**
   * Replies with &lt;code&gt;msg&lt;/code&gt; to the sender.
   */</span>
  protected<span class="delimiter">[</span>actors<span class="delimiter">]</span> def <a title="(msg: Any)Unit" id="scala.actors;InternalReplyReactor.reply">reply</a><span class="delimiter">(</span><a title="Any" id="scala.actors;InternalReplyReactor.reply.msg">msg</a>: <span title="Any">Any</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#scala.actors;InternalReplyReactor.internalSender" title="=&gt; scala.actors.OutputChannel[Any]">internalSender</a> <a href="OutputChannel.scala.html#scala.actors;OutputChannel.!" title="(msg: Any)Unit">!</a> <a href="#scala.actors;InternalReplyReactor.reply.msg" title="Any">msg</a>
  <span class="delimiter">}</span>

  override def <a title="(msg: Any)Unit" id="scala.actors;InternalReplyReactor.!">!</a><span class="delimiter">(</span><a title="Any" id="scala.actors;InternalReplyReactor.!.msg">msg</a>: <span title="Any">Any</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="Reactor.scala.html#scala.actors;Reactor.send" title="(msg: Any, replyTo: scala.actors.OutputChannel[Any])Unit">send</a><span class="delimiter">(</span><a href="#scala.actors;InternalReplyReactor.!.msg" title="Any">msg</a>, <a href="Actor.scala.html#scala.actors.Actor" title="scala.actors.Actor.type">Actor</a>.<a href="Actor.scala.html#scala.actors.Actor.rawSelf(3e2f7be990)" title="(sched: scala.actors.IScheduler)scala.actors.InternalReplyReactor">rawSelf</a><span class="delimiter">(</span><a href="Reactor.scala.html#scala.actors;Reactor.scheduler" title="=&gt; scala.actors.IScheduler">scheduler</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  override def <a title="(msg: Any)Unit" id="scala.actors;InternalReplyReactor.forward">forward</a><span class="delimiter">(</span><a title="Any" id="scala.actors;InternalReplyReactor.forward.msg">msg</a>: <span title="Any">Any</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="Reactor.scala.html#scala.actors;Reactor.send" title="(msg: Any, replyTo: scala.actors.OutputChannel[Any])Unit">send</a><span class="delimiter">(</span><a href="#scala.actors;InternalReplyReactor.forward.msg" title="Any">msg</a>, <a href="Actor.scala.html#scala.actors.Actor" title="scala.actors.Actor.type">Actor</a>.<a href="Actor.scala.html#scala.actors.Actor.sender" title="=&gt; scala.actors.OutputChannel[Any]">sender</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private<span class="delimiter">[</span>actors<span class="delimiter">]</span> override def <a title="(item: (Any, scala.actors.OutputChannel[Any]), handler: PartialFunction[Any,Any], onSameThread: Boolean)Unit" id="scala.actors;InternalReplyReactor.resumeReceiver">resumeReceiver</a><span class="delimiter">(</span><a title="(Any, scala.actors.OutputChannel[Any])" id="scala.actors;InternalReplyReactor.resumeReceiver.item">item</a>: <a href="../Tuple2.scala.html#scala;Tuple2" title="(Any, scala.actors.OutputChannel[Any])" class="delimiter">(</a>Any, OutputChannel<span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">)</span>, <a title="PartialFunction[Any,Any]" id="scala.actors;InternalReplyReactor.resumeReceiver.handler">handler</a>: <a href="../PartialFunction.scala.html#scala;PartialFunction" title="PartialFunction[Any,Any]">PartialFunction</a><span class="delimiter">[</span>Any, Any<span class="delimiter">]</span>, <a title="Boolean" id="scala.actors;InternalReplyReactor.resumeReceiver.onSameThread">onSameThread</a>: <a href="../Boolean.scala.html#scala;Boolean" title="Boolean">Boolean</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#scala.actors;InternalReplyReactor" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="../Boolean.scala.html#scala;Boolean.unary_!" title="=&gt; Boolean">!</a><a href="#scala.actors;InternalReplyReactor.onTimeout_=" title="=&gt; Option[java.util.TimerTask]">onTimeout</a>.<a href="../Option.scala.html#scala;Option.isEmpty" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#scala.actors;InternalReplyReactor.onTimeout_=" title="=&gt; Option[java.util.TimerTask]">onTimeout</a>.<a href="../Option.scala.html#scala;Option.get" title="=&gt; java.util.TimerTask">get</a>.<span title="()Boolean">cancel</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#scala.actors;InternalReplyReactor.onTimeout_=" title="(x$1: Option[java.util.TimerTask])Unit">onTimeout</a> = <a href="../Option.scala.html#scala.None" title="None.type">None</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#scala.actors;InternalReplyReactor.senders_=" title="(x$1: List[scala.actors.OutputChannel[Any]])Unit">senders</a> = <a href="../collection/immutable/List.scala.html#scala.collection.immutable.List.apply" title="(xs: scala.actors.OutputChannel[Any]*)List[scala.actors.OutputChannel[Any]]">List</a><span class="delimiter">(</span><a href="#scala.actors;InternalReplyReactor.resumeReceiver.item" title="(Any, scala.actors.OutputChannel[Any])">item</a>.<a href="../Tuple2.scala.html#scala;Tuple2._2" title="=&gt; scala.actors.OutputChannel[Any]">_2</a><span class="delimiter">)</span>
    super.<a href="Reactor.scala.html#scala.actors;Reactor.resumeReceiver" title="(item: (Any, scala.actors.OutputChannel[Any]), handler: PartialFunction[Any,Any], onSameThread: Boolean)Unit">resumeReceiver</a><span class="delimiter">(</span><a href="#scala.actors;InternalReplyReactor.resumeReceiver.item" title="(Any, scala.actors.OutputChannel[Any])">item</a>, <a href="#scala.actors;InternalReplyReactor.resumeReceiver.handler" title="PartialFunction[Any,Any]">handler</a>, <a href="#scala.actors;InternalReplyReactor.resumeReceiver.onSameThread" title="Boolean">onSameThread</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private<span class="delimiter">[</span>actors<span class="delimiter">]</span> override def <a title="(startMbox: scala.actors.MQueue[Any], handler: PartialFunction[Any,Any], resumeOnSameThread: Boolean)Unit" id="scala.actors;InternalReplyReactor.searchMailbox">searchMailbox</a><span class="delimiter">(</span><a title="scala.actors.MQueue[Any]" id="scala.actors;InternalReplyReactor.searchMailbox.startMbox">startMbox</a>: <a href="MQueue.scala.html#scala.actors;MQueue" title="scala.actors.MQueue[Any]">MQueue</a><span class="delimiter">[</span>Any<span class="delimiter">]</span>,
                                             <a title="PartialFunction[Any,Any]" id="scala.actors;InternalReplyReactor.searchMailbox.handler">handler</a>: <a href="../PartialFunction.scala.html#scala;PartialFunction" title="PartialFunction[Any,Any]">PartialFunction</a><span class="delimiter">[</span>Any, Any<span class="delimiter">]</span>,
                                             <a title="Boolean" id="scala.actors;InternalReplyReactor.searchMailbox.resumeOnSameThread">resumeOnSameThread</a>: <a href="../Boolean.scala.html#scala;Boolean" title="Boolean">Boolean</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    var <a title="scala.actors.MQueue[Any]" id="scala.actors;InternalReplyReactor.searchMailbox.tmpMbox">tmpMbox</a> = <a href="#scala.actors;InternalReplyReactor.searchMailbox.startMbox" title="scala.actors.MQueue[Any]">startMbox</a>
    var <a title="Boolean" id="scala.actors;InternalReplyReactor.searchMailbox.done">done</a> = false
    while <span class="delimiter">(</span><a href="../Boolean.scala.html#scala;Boolean.unary_!" title="=&gt; Boolean">!</a><a href="#scala.actors;InternalReplyReactor.searchMailbox.done" title="Boolean">done</a><span class="delimiter">)</span> <a href="#scala.actors;InternalReplyReactor.searchMailbox.while$1" title="()Unit" class="delimiter">{</a>
      val <a title="scala.actors.MQueueElement[Any]" id="scala.actors;InternalReplyReactor.searchMailbox.qel">qel</a> = <a href="#scala.actors;InternalReplyReactor.searchMailbox.tmpMbox" title="scala.actors.MQueue[Any]">tmpMbox</a>.<a href="MQueue.scala.html#scala.actors;MQueue.extractFirst(6d20ee5371)" title="(p: (Any, scala.actors.OutputChannel[Any]) =&gt; Boolean)scala.actors.MQueueElement[Any]">extractFirst</a><span class="delimiter">(</span><span class="delimiter">(</span>msg: <span title="Any">Any</span>, replyTo: <a href="OutputChannel.scala.html#scala.actors;OutputChannel" title="scala.actors.OutputChannel[Any]">OutputChannel</a><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#scala.actors;InternalReplyReactor.senders_=" title="(x$1: List[scala.actors.OutputChannel[Any]])Unit">senders</a> = <a href="../collection/immutable/List.scala.html#scala.collection.immutable.List.apply" title="(xs: scala.actors.OutputChannel[Any]*)List[scala.actors.OutputChannel[Any]]">List</a><span class="delimiter">(</span><a href="#scala.actors;InternalReplyReactor.searchMailbox.qel.$anonfun.replyTo" title="scala.actors.OutputChannel[Any]">replyTo</a><span class="delimiter">)</span>
        <a href="#scala.actors;InternalReplyReactor.searchMailbox.handler" title="PartialFunction[Any,Any]">handler</a>.<a href="../PartialFunction.scala.html#scala;PartialFunction.isDefinedAt" title="(x: Any)Boolean">isDefinedAt</a><span class="delimiter">(</span><a href="#scala.actors;InternalReplyReactor.searchMailbox.qel.$anonfun.msg" title="Any">msg</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#scala.actors;InternalReplyReactor.searchMailbox.tmpMbox" title="scala.actors.MQueue[Any]">tmpMbox</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="Reactor.scala.html#scala.actors;Reactor.mailbox" title="=&gt; scala.actors.MQueue[Any]">mailbox</a><span class="delimiter">)</span>
        <a href="#scala.actors;InternalReplyReactor.searchMailbox.tmpMbox" title="scala.actors.MQueue[Any]">tmpMbox</a>.<a href="MQueue.scala.html#scala.actors;MQueue.foreach" title="(f: (Any, scala.actors.OutputChannel[Any]) =&gt; Unit)Unit">foreach</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="Any" id="scala.actors;InternalReplyReactor.searchMailbox.$anonfun.m">m</a>, <a title="scala.actors.OutputChannel[Any]" id="scala.actors;InternalReplyReactor.searchMailbox.$anonfun.s">s</a><span class="delimiter">)</span> =&gt; <a href="Reactor.scala.html#scala.actors;Reactor.mailbox" title="=&gt; scala.actors.MQueue[Any]">mailbox</a>.<a href="MQueue.scala.html#scala.actors;MQueue.append(ce164a9111)" title="(msg: Any, session: scala.actors.OutputChannel[Any])Unit">append</a><span class="delimiter">(</span><a href="#scala.actors;InternalReplyReactor.searchMailbox.$anonfun.m" title="Any">m</a>, <a href="#scala.actors;InternalReplyReactor.searchMailbox.$anonfun.s" title="scala.actors.OutputChannel[Any]">s</a><span class="delimiter">)</span><span class="delimiter">)</span>
      if <span class="delimiter">(</span>null <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#scala.actors;InternalReplyReactor.searchMailbox.qel" title="scala.actors.MQueueElement[Any]">qel</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#scala.actors;InternalReplyReactor" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
          <span class="comment">// in mean time new stuff might have arrived</span>
          if <span class="delimiter">(</span><a href="../Boolean.scala.html#scala;Boolean.unary_!" title="=&gt; Boolean">!</a><a href="Reactor.scala.html#scala.actors;Reactor.sendBuffer" title="=&gt; scala.actors.MQueue[Any]">sendBuffer</a>.<a href="MQueue.scala.html#scala.actors;MQueue.isEmpty" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#scala.actors;InternalReplyReactor.searchMailbox.tmpMbox" title="scala.actors.MQueue[Any]">tmpMbox</a> = new <a href="MQueue.scala.html#scala.actors;MQueue" title="scala.actors.MQueue[Any]">MQueue</a><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">(</span><span title="String(&quot;Temp&quot;)" class="string">&quot;Temp&quot;</span><span class="delimiter">)</span>
            <a href="Reactor.scala.html#scala.actors;Reactor.drainSendBuffer" title="(mbox: scala.actors.MQueue[Any])Unit">drainSendBuffer</a><span class="delimiter">(</span><a href="#scala.actors;InternalReplyReactor.searchMailbox.tmpMbox" title="scala.actors.MQueue[Any]">tmpMbox</a><span class="delimiter">)</span>
            <span class="comment">// keep going</span>
          <span class="delimiter">}</span> else <span class="delimiter">{</span>
            <a href="Reactor.scala.html#scala.actors;Reactor.waitingFor_=" title="(x$1: PartialFunction[Any,Any])Unit">waitingFor</a> = <a href="#scala.actors;InternalReplyReactor.searchMailbox.handler" title="PartialFunction[Any,Any]">handler</a>
            <span class="comment">// see Reactor.searchMailbox</span>
            throw <a href="Actor.scala.html#scala.actors.Actor" title="scala.actors.Actor.type">Actor</a>.<a href="Actor.scala.html#scala.actors.Actor.suspendException" title="=&gt; scala.actors.SuspendActorControl">suspendException</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> else <span class="delimiter">{</span>
        <a href="#scala.actors;InternalReplyReactor.resumeReceiver" title="(item: (Any, scala.actors.OutputChannel[Any]), handler: PartialFunction[Any,Any], onSameThread: Boolean)Unit">resumeReceiver</a><span class="delimiter">(</span><a href="../Tuple2.scala.html#scala;Tuple2" title="(_1: Any, _2: scala.actors.OutputChannel[Any])(Any, scala.actors.OutputChannel[Any])" class="delimiter">(</a><a href="#scala.actors;InternalReplyReactor.searchMailbox.qel" title="scala.actors.MQueueElement[Any]">qel</a>.<a href="MQueue.scala.html#scala.actors;MQueueElement.msg" title="=&gt; Any">msg</a>, <a href="#scala.actors;InternalReplyReactor.searchMailbox.qel" title="scala.actors.MQueueElement[Any]">qel</a>.<a href="MQueue.scala.html#scala.actors;MQueueElement.session" title="=&gt; scala.actors.OutputChannel[Any]">session</a><span class="delimiter">)</span>, <a href="#scala.actors;InternalReplyReactor.searchMailbox.handler" title="PartialFunction[Any,Any]">handler</a>, <a href="#scala.actors;InternalReplyReactor.searchMailbox.resumeOnSameThread" title="Boolean">resumeOnSameThread</a><span class="delimiter">)</span>
        <a href="#scala.actors;InternalReplyReactor.searchMailbox.done" title="Boolean">done</a> = true
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private<span class="delimiter">[</span>actors<span class="delimiter">]</span> override def <a title="(fun: () =&gt; Unit, handler: PartialFunction[Any,Any], msg: Any)Runnable" id="scala.actors;InternalReplyReactor.makeReaction(dd5d7a02aa)">makeReaction</a><span class="delimiter">(</span><a title="() =&gt; Unit" id="scala.actors;InternalReplyReactor.makeReaction(dd5d7a02aa).fun">fun</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Unit, <a title="PartialFunction[Any,Any]" id="scala.actors;InternalReplyReactor.makeReaction(dd5d7a02aa).handler">handler</a>: <a href="../PartialFunction.scala.html#scala;PartialFunction" title="PartialFunction[Any,Any]">PartialFunction</a><span class="delimiter">[</span>Any, Any<span class="delimiter">]</span>, <a title="Any" id="scala.actors;InternalReplyReactor.makeReaction(dd5d7a02aa).msg">msg</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Runnable">Runnable</span> =
    new <a href="ReplyReactorTask.scala.html#scala.actors;ReplyReactorTask" title="scala.actors.ReplyReactorTask">ReplyReactorTask</a><span class="delimiter">(</span>this, <a href="#scala.actors;InternalReplyReactor.makeReaction(dd5d7a02aa).fun" title="() =&gt; Unit">fun</a>, <a href="#scala.actors;InternalReplyReactor.makeReaction(dd5d7a02aa).handler" title="PartialFunction[Any,Any]">handler</a>, <a href="#scala.actors;InternalReplyReactor.makeReaction(dd5d7a02aa).msg" title="Any">msg</a><span class="delimiter">)</span>

  protected<span class="delimiter">[</span>actors<span class="delimiter">]</span> override def <a title="(handler: PartialFunction[Any,Unit])Nothing" id="scala.actors;InternalReplyReactor.react">react</a><span class="delimiter">(</span><a title="PartialFunction[Any,Unit]" id="scala.actors;InternalReplyReactor.react.handler">handler</a>: <a href="../PartialFunction.scala.html#scala;PartialFunction" title="PartialFunction[Any,Unit]">PartialFunction</a><span class="delimiter">[</span>Any, Unit<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Nothing">Nothing</span> = <span class="delimiter">{</span>
    <a href="../Predef.scala.html#scala.Predef.assert(0f40bc559c)" title="(assertion: Boolean, message: =&gt; Any)Unit">assert</a><span class="delimiter">(</span><a href="Actor.scala.html#scala.actors.Actor" title="scala.actors.Actor.type">Actor</a>.<a href="Actor.scala.html#scala.actors.Actor.rawSelf(3e2f7be990)" title="(sched: scala.actors.IScheduler)scala.actors.InternalReplyReactor">rawSelf</a><span class="delimiter">(</span><a href="Reactor.scala.html#scala.actors;Reactor.scheduler" title="=&gt; scala.actors.IScheduler">scheduler</a><span class="delimiter">)</span> <span title="(x$1: Any)Boolean">==</span> this, <span title="String(&quot;react on channel belonging to other actor&quot;)" class="string">&quot;react on channel belonging to other actor&quot;</span><span class="delimiter">)</span>
    super.<a href="Reactor.scala.html#scala.actors;Reactor.react" title="(handler: PartialFunction[Any,Unit])Nothing">react</a><span class="delimiter">(</span><a href="#scala.actors;InternalReplyReactor.react.handler" title="PartialFunction[Any,Unit]">handler</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
   
  
  <span class="comment">/**
   * Receives a message from this $actor's mailbox within a certain
   * time span.
   *
   * This method never returns. Therefore, the rest of the computation
   * has to be contained in the actions of the partial function.
   *
   * @param  msec     the time span before timeout
   * @param  handler  a partial function with message patterns and actions
   */</span>
  protected<span class="delimiter">[</span>actors<span class="delimiter">]</span> def <a title="(msec: Long)(handler: PartialFunction[Any,Unit])Nothing" id="scala.actors;InternalReplyReactor.reactWithin">reactWithin</a><span class="delimiter">(</span><a title="Long" id="scala.actors;InternalReplyReactor.reactWithin.msec">msec</a>: <a href="../Long.scala.html#scala;Long" title="Long">Long</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="PartialFunction[Any,Unit]" id="scala.actors;InternalReplyReactor.reactWithin.handler">handler</a>: <a href="../PartialFunction.scala.html#scala;PartialFunction" title="PartialFunction[Any,Unit]">PartialFunction</a><span class="delimiter">[</span>Any, Unit<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Nothing">Nothing</span> = <span class="delimiter">{</span>
    <a href="../Predef.scala.html#scala.Predef.assert(0f40bc559c)" title="(assertion: Boolean, message: =&gt; Any)Unit">assert</a><span class="delimiter">(</span><a href="Actor.scala.html#scala.actors.Actor" title="scala.actors.Actor.type">Actor</a>.<a href="Actor.scala.html#scala.actors.Actor.rawSelf(3e2f7be990)" title="(sched: scala.actors.IScheduler)scala.actors.InternalReplyReactor">rawSelf</a><span class="delimiter">(</span><a href="Reactor.scala.html#scala.actors;Reactor.scheduler" title="=&gt; scala.actors.IScheduler">scheduler</a><span class="delimiter">)</span> <span title="(x$1: Any)Boolean">==</span> this, <span title="String(&quot;react on channel belonging to other actor&quot;)" class="string">&quot;react on channel belonging to other actor&quot;</span><span class="delimiter">)</span>

    <a href="#scala.actors;InternalReplyReactor" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span> <a href="Reactor.scala.html#scala.actors;Reactor.drainSendBuffer" title="(mbox: scala.actors.MQueue[Any])Unit">drainSendBuffer</a><span class="delimiter">(</span><a href="Reactor.scala.html#scala.actors;Reactor.mailbox" title="=&gt; scala.actors.MQueue[Any]">mailbox</a><span class="delimiter">)</span> <span class="delimiter">}</span>

    <span class="comment">// first, remove spurious TIMEOUT message from mailbox if any</span>
    <a href="Reactor.scala.html#scala.actors;Reactor.mailbox" title="=&gt; scala.actors.MQueue[Any]">mailbox</a>.<a href="MQueue.scala.html#scala.actors;MQueue.extractFirst(6d20ee5371)" title="(p: (Any, scala.actors.OutputChannel[Any]) =&gt; Boolean)scala.actors.MQueueElement[Any]">extractFirst</a><span class="delimiter">(</span><span class="delimiter">(</span>m: <span title="Any">Any</span>, replyTo: <a href="OutputChannel.scala.html#scala.actors;OutputChannel" title="scala.actors.OutputChannel[Any]">OutputChannel</a><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; <a href="#scala.actors;InternalReplyReactor.reactWithin.$anonfun.m" title="Any">m</a> <span title="(x$1: Any)Boolean">==</span> <a href="InternalActor.scala.html#scala.actors.TIMEOUT" title="scala.actors.TIMEOUT.type">TIMEOUT</a><span class="delimiter">)</span>

    while <span class="delimiter">(</span>true<span class="delimiter">)</span> <a href="#scala.actors;InternalReplyReactor.reactWithin.while$2" title="()Unit" class="delimiter">{</a>
      val <a title="scala.actors.MQueueElement[Any]" id="scala.actors;InternalReplyReactor.reactWithin.qel">qel</a> = <a href="Reactor.scala.html#scala.actors;Reactor.mailbox" title="=&gt; scala.actors.MQueue[Any]">mailbox</a>.<a href="MQueue.scala.html#scala.actors;MQueue.extractFirst(6d20ee5371)" title="(p: (Any, scala.actors.OutputChannel[Any]) =&gt; Boolean)scala.actors.MQueueElement[Any]">extractFirst</a><span class="delimiter">(</span><span class="delimiter">(</span>m: <span title="Any">Any</span>, replyTo: <a href="OutputChannel.scala.html#scala.actors;OutputChannel" title="scala.actors.OutputChannel[Any]">OutputChannel</a><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#scala.actors;InternalReplyReactor.senders_=" title="(x$1: List[scala.actors.OutputChannel[Any]])Unit">senders</a> = <a href="../collection/immutable/List.scala.html#scala.collection.immutable.List.apply" title="(xs: scala.actors.OutputChannel[Any]*)List[scala.actors.OutputChannel[Any]]">List</a><span class="delimiter">(</span><a href="#scala.actors;InternalReplyReactor.reactWithin.qel.$anonfun.replyTo" title="scala.actors.OutputChannel[Any]">replyTo</a><span class="delimiter">)</span>
        <a href="#scala.actors;InternalReplyReactor.reactWithin.handler" title="PartialFunction[Any,Unit]">handler</a> <a href="../PartialFunction.scala.html#scala;PartialFunction.isDefinedAt" title="(x: Any)Boolean">isDefinedAt</a> <a href="#scala.actors;InternalReplyReactor.reactWithin.qel.$anonfun.m" title="Any">m</a>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      if <span class="delimiter">(</span>null <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#scala.actors;InternalReplyReactor.reactWithin.qel" title="scala.actors.MQueueElement[Any]">qel</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#scala.actors;InternalReplyReactor" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
          <span class="comment">// in mean time new messages might have arrived</span>
          if <span class="delimiter">(</span><a href="../Boolean.scala.html#scala;Boolean.unary_!" title="=&gt; Boolean">!</a><a href="Reactor.scala.html#scala.actors;Reactor.sendBuffer" title="=&gt; scala.actors.MQueue[Any]">sendBuffer</a>.<a href="MQueue.scala.html#scala.actors;MQueue.isEmpty" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="Reactor.scala.html#scala.actors;Reactor.drainSendBuffer" title="(mbox: scala.actors.MQueue[Any])Unit">drainSendBuffer</a><span class="delimiter">(</span><a href="Reactor.scala.html#scala.actors;Reactor.mailbox" title="=&gt; scala.actors.MQueue[Any]">mailbox</a><span class="delimiter">)</span>
            <span class="comment">// keep going</span>
          <span class="delimiter">}</span> else if <span class="delimiter">(</span><a href="#scala.actors;InternalReplyReactor.reactWithin.msec" title="Long">msec</a> <a href="../Long.scala.html#scala;Long.==(2dca8a685a)" title="(x: Long)Boolean">==</a> <span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="comment">// throws Actor.suspendException</span>
            <a href="#scala.actors;InternalReplyReactor.resumeReceiver" title="(item: (Any, scala.actors.OutputChannel[Any]), handler: PartialFunction[Any,Any], onSameThread: Boolean)Unit">resumeReceiver</a><span class="delimiter">(</span><a href="../Tuple2.scala.html#scala;Tuple2" title="(_1: scala.actors.TIMEOUT.type, _2: scala.actors.InternalReplyReactor)(scala.actors.TIMEOUT.type, scala.actors.InternalReplyReactor)" class="delimiter">(</a><a href="InternalActor.scala.html#scala.actors.TIMEOUT" title="scala.actors.TIMEOUT.type">TIMEOUT</a>, this<span class="delimiter">)</span>, <a href="#scala.actors;InternalReplyReactor.reactWithin.handler" title="PartialFunction[Any,Unit]">handler</a>, false<span class="delimiter">)</span>
          <span class="delimiter">}</span> else <span class="delimiter">{</span>
            <a href="Reactor.scala.html#scala.actors;Reactor.waitingFor_=" title="(x$1: PartialFunction[Any,Any])Unit">waitingFor</a> = <a href="#scala.actors;InternalReplyReactor.reactWithin.handler" title="PartialFunction[Any,Unit]">handler</a>
            val <a title="scala.actors.InternalReplyReactor" id="scala.actors;InternalReplyReactor.reactWithin.thisActor">thisActor</a> = this
            <a href="#scala.actors;InternalReplyReactor.onTimeout_=" title="(x$1: Option[java.util.TimerTask])Unit">onTimeout</a> = <a href="../Option.scala.html#scala;Some" title="(x: java.util.TimerTask)Some[java.util.TimerTask]">Some</a><span class="delimiter">(</span>new <a title="&lt;$anon: java.util.TimerTask&gt; extends java.util.TimerTask" id="scala.actors;InternalReplyReactor.reactWithin;$anon">TimerTask</a> <span class="delimiter">{</span>
              def <a title="()Unit" id="scala.actors;InternalReplyReactor.reactWithin;$anon.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#scala.actors;InternalReplyReactor.reactWithin.thisActor" title="scala.actors.InternalReplyReactor">thisActor</a>.<a href="Reactor.scala.html#scala.actors;Reactor.send" title="(msg: Any, replyTo: scala.actors.OutputChannel[Any])Unit">send</a><span class="delimiter">(</span><a href="InternalActor.scala.html#scala.actors.TIMEOUT" title="scala.actors.TIMEOUT.type">TIMEOUT</a>, <a href="#scala.actors;InternalReplyReactor.reactWithin.thisActor" title="scala.actors.InternalReplyReactor">thisActor</a><span class="delimiter">)</span> <span class="delimiter">}</span>
            <span class="delimiter">}</span><span class="delimiter">)</span>
            <a href="Actor.scala.html#scala.actors.Actor" title="scala.actors.Actor.type">Actor</a>.<a href="Actor.scala.html#scala.actors.Actor.timer" title="=&gt; java.util.Timer">timer</a>.<span title="(x$1: java.util.TimerTask, x$2: Long)Unit">schedule</span><span class="delimiter">(</span><a href="#scala.actors;InternalReplyReactor.onTimeout_=" title="=&gt; Option[java.util.TimerTask]">onTimeout</a>.<a href="../Option.scala.html#scala;Option.get" title="=&gt; java.util.TimerTask">get</a>, <a href="#scala.actors;InternalReplyReactor.reactWithin.msec" title="Long">msec</a><span class="delimiter">)</span>
            throw <a href="Actor.scala.html#scala.actors.Actor" title="scala.actors.Actor.type">Actor</a>.<a href="Actor.scala.html#scala.actors.Actor.suspendException" title="=&gt; scala.actors.SuspendActorControl">suspendException</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> else
        <a href="#scala.actors;InternalReplyReactor.resumeReceiver" title="(item: (Any, scala.actors.OutputChannel[Any]), handler: PartialFunction[Any,Any], onSameThread: Boolean)Unit">resumeReceiver</a><span class="delimiter">(</span><a href="../Tuple2.scala.html#scala;Tuple2" title="(_1: Any, _2: scala.actors.OutputChannel[Any])(Any, scala.actors.OutputChannel[Any])" class="delimiter">(</a><a href="#scala.actors;InternalReplyReactor.reactWithin.qel" title="scala.actors.MQueueElement[Any]">qel</a>.<a href="MQueue.scala.html#scala.actors;MQueueElement.msg" title="=&gt; Any">msg</a>, <a href="#scala.actors;InternalReplyReactor.reactWithin.qel" title="scala.actors.MQueueElement[Any]">qel</a>.<a href="MQueue.scala.html#scala.actors;MQueueElement.session" title="=&gt; scala.actors.OutputChannel[Any]">session</a><span class="delimiter">)</span>, <a href="#scala.actors;InternalReplyReactor.reactWithin.handler" title="PartialFunction[Any,Unit]">handler</a>, false<span class="delimiter">)</span>
    <span class="delimiter">}</span>
    throw <a href="Actor.scala.html#scala.actors.Actor" title="scala.actors.Actor.type">Actor</a>.<a href="Actor.scala.html#scala.actors.Actor.suspendException" title="=&gt; scala.actors.SuspendActorControl">suspendException</a>
  <span class="delimiter">}</span>

  override def <a title="=&gt; scala.actors.Actor.State.Value" id="scala.actors;InternalReplyReactor.getState">getState</a>: Actor.State.<a href="../Enumeration.scala.html#scala;Enumeration;Value" title="scala.actors.Actor.State.Value">Value</a> = <a href="#scala.actors;InternalReplyReactor" title="(x$1: scala.actors.Actor.State.Value)scala.actors.Actor.State.Value">synchronized</a> <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="Reactor.scala.html#scala.actors;Reactor.waitingFor" title="=&gt; PartialFunction[Any,Any]">waitingFor</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="Reactor.scala.html#scala.actors.Reactor" title="scala.actors.Reactor.type">Reactor</a>.<a href="Reactor.scala.html#scala.actors.Reactor.waitingForNone" title="=&gt; PartialFunction[Any,Unit]">waitingForNone</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#scala.actors;InternalReplyReactor.onTimeout_=" title="=&gt; Option[java.util.TimerTask]">onTimeout</a>.<a href="../Option.scala.html#scala;Option.isEmpty" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span>
        <a href="Actor.scala.html#scala.actors.Actor" title="scala.actors.Actor.type">Actor</a>.<a href="Actor.scala.html#scala.actors.Actor.State" title="scala.actors.Actor.State.type">State</a>.<a href="Actor.scala.html#scala.actors.Actor.State.Suspended" title="=&gt; scala.actors.Actor.State.Value">Suspended</a>
      else
        <a href="Actor.scala.html#scala.actors.Actor" title="scala.actors.Actor.type">Actor</a>.<a href="Actor.scala.html#scala.actors.Actor.State" title="scala.actors.Actor.State.type">State</a>.<a href="Actor.scala.html#scala.actors.Actor.State.TimedSuspended" title="=&gt; scala.actors.Actor.State.Value">TimedSuspended</a>
    <span class="delimiter">}</span> else
      <a href="Reactor.scala.html#scala.actors;Reactor._state" title="=&gt; scala.actors.Actor.State.Value">_state</a>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
