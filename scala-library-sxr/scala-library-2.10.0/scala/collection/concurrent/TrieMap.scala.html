<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/collection/concurrent/TrieMap.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2013, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

<span class="keyword">package</span> scala.collection
<span class="keyword">package</span> concurrent

<span class="keyword">import</span> java.util.concurrent.atomic._
<span class="keyword">import</span> scala.collection.immutable.<span class="delimiter">{</span> ListMap =&gt; ImmutableListMap <span class="delimiter">}</span>
<span class="keyword">import</span> scala.collection.parallel.mutable.ParTrieMap
<span class="keyword">import</span> scala.util.hashing.Hashing
<span class="keyword">import</span> scala.util.control.ControlThrowable
<span class="keyword">import</span> generic._
<span class="keyword">import</span> scala.annotation.tailrec
<span class="keyword">import</span> scala.annotation.switch

<span class="keyword">private</span><span class="delimiter">[</span>collection<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class INode[K, V] extends scala.collection.concurrent.INodeBase[K,V]" id="9126">INode</a><span class="delimiter">[</span><a title="" id="9203">K</a>, <a title="" id="9204">V</a><span class="delimiter">]</span><a href="#9126" title="scala.collection.concurrent.INode[K,V]" class="delimiter">(</a><a title="scala.collection.concurrent.MainNode[K,V]" id="136739">bn</a>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.Gen" id="136740">g</a>: <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="INodeBase.java.html#9129" title="scala.collection.concurrent.INodeBase[K,V]">INodeBase</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#136740" title="scala.collection.concurrent.Gen">g</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="INodeBase.java.html#9130" title="scala.collection.concurrent.INodeBase.type">INodeBase</a>._

  <a href="#136711" title="(nval: scala.collection.concurrent.MainNode[K,V])Unit">WRITE</a><span class="delimiter">(</span><a href="#136739" title="scala.collection.concurrent.MainNode[K,V]">bn</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(g: scala.collection.concurrent.Gen)scala.collection.concurrent.INode[K,V]" id="136710" class="keyword">this</a><span class="delimiter">(</span><a title="scala.collection.concurrent.Gen" id="136810">g</a>: <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span> = <a href="#9126" title="INode.this.type" class="keyword">this</a><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <a href="#136810" title="scala.collection.concurrent.Gen">g</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(nval: scala.collection.concurrent.MainNode[K,V])Unit" id="136711">WRITE</a><span class="delimiter">(</span><a title="scala.collection.concurrent.MainNode[K,V]" id="136748">nval</a>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="INodeBase.java.html#9130" title="scala.collection.concurrent.INodeBase.type">INodeBase</a>.<a href="INodeBase.java.html#136745" title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.INodeBase[_, _],scala.collection.concurrent.MainNode[_, _]]">updater</a>.<span title="(x$1: scala.collection.concurrent.INodeBase[_, _], x$2: scala.collection.concurrent.MainNode[_, _])Unit">set</span><span class="delimiter">(</span><a href="#9126" title="scala.collection.concurrent.INode[K,V]" class="keyword">this</a>, <a href="#136748" title="scala.collection.concurrent.MainNode[K,V]">nval</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V])Boolean" id="136712">CAS</a><span class="delimiter">(</span><a title="scala.collection.concurrent.MainNode[K,V]" id="136819">old</a>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.MainNode[K,V]" id="136820">n</a>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="INodeBase.java.html#9130" title="scala.collection.concurrent.INodeBase.type">INodeBase</a>.<a href="INodeBase.java.html#136745" title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.INodeBase[_, _],scala.collection.concurrent.MainNode[_, _]]">updater</a>.<span title="(x$1: scala.collection.concurrent.INodeBase[_, _], x$2: scala.collection.concurrent.MainNode[_, _], x$3: scala.collection.concurrent.MainNode[_, _])Boolean">compareAndSet</span><span class="delimiter">(</span><a href="#9126" title="scala.collection.concurrent.INode[K,V]" class="keyword">this</a>, <a href="#136819" title="scala.collection.concurrent.MainNode[K,V]">old</a>, <a href="#136820" title="scala.collection.concurrent.MainNode[K,V]">n</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]" id="136713">gcasRead</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TrieMap[K,V]" id="136830">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <a href="#136714" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#136830" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]" id="136714">GCAS_READ</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TrieMap[K,V]" id="136893">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="136894">m</a> = /*READ*/<a href="INodeBase.java.html#136700" title="scala.collection.concurrent.MainNode[K,V]">mainnode</a>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="136895">prevval</a> = /*READ*/<a href="#136894" title="scala.collection.concurrent.MainNode[K,V]">m</a>.<a href="MainNode.java.html#136733" title="scala.collection.concurrent.MainNode[K,V]">prev</a>
    <span title="scala.collection.concurrent.MainNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136895" title="scala.collection.concurrent.MainNode[K,V]">prevval</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#136894" title="scala.collection.concurrent.MainNode[K,V]">m</a>
    <span class="keyword">else</span> <a href="#136715" title="(m: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_Complete</a><span class="delimiter">(</span><a href="#136894" title="scala.collection.concurrent.MainNode[K,V]">m</a>, <a href="#136893" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  @tailrec <span class="keyword">private</span> <span class="keyword">def</span> <a title="(m: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]" id="136715">GCAS_Complete</a><span class="delimiter">(</span><a title="scala.collection.concurrent.MainNode[K,V]" id="136898">m</a>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="136899">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span title="scala.collection.concurrent.MainNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136898" title="scala.collection.concurrent.MainNode[K,V]">m</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="Null(null)" class="keyword">null</span> <span class="keyword">else</span> <span class="delimiter">{</span>
    // complete the GCAS
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="136900">prev</a> = /*READ*/<a href="#136898" title="scala.collection.concurrent.MainNode[K,V]">m</a>.<a href="MainNode.java.html#136733" title="scala.collection.concurrent.MainNode[K,V]">prev</a>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="136901">ctr</a> = <a href="#136899" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>.<a href="#136859" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">readRoot</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

    <a href="#136900" title="scala.collection.concurrent.MainNode[K,V]">prev</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1439859" title="scala.collection.concurrent.MainNode[K,V]" id="1439864" class="keyword">null</a> =&gt;
        <a href="#1439868" title="(x: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.MainNode[K,V]">m</a>
      <span class="keyword">case</span> <a href="#1439859" title="scala.collection.concurrent.MainNode[K,V]" id="1439865">fn</a>: FailedNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt; // try to commit to previous value
        <a href="#1439868" title="(x: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.MainNode[K,V]" class="keyword">if</a> <span class="delimiter">(</span><a href="#136712" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V])Boolean">CAS</a><span class="delimiter">(</span><a href="#136898" title="scala.collection.concurrent.MainNode[K,V]">m</a>, fn.<a href="MainNode.java.html#136733" title="scala.collection.concurrent.MainNode[_336,_337]">prev</a><span class="delimiter">)</span><span class="delimiter">)</span> fn.<a href="MainNode.java.html#136733" title="scala.collection.concurrent.MainNode[_336,_337]">prev</a>
        <span class="keyword">else</span> <a href="#136715" title="(m: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_Complete</a><span class="delimiter">(</span>/*READ*/<a href="INodeBase.java.html#136700" title="scala.collection.concurrent.MainNode[K,V]">mainnode</a>, <a href="#136899" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#1439859" title="scala.collection.concurrent.MainNode[K,V]" id="1439866">vn</a>: MainNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt;
        // Assume that you've read the root from the generation G.
        // Assume that the snapshot algorithm is correct.
        // ==&gt; you can only reach nodes in generations &lt;= G.
        // ==&gt; `gen` is &lt;= G.
        // We know that `ctr.gen` is &gt;= G.
        // ==&gt; if `ctr.gen` = `gen` then they are both equal to G.
        // ==&gt; otherwise, we know that either `ctr.gen` &gt; G, `gen` &lt; G,
        //     or both
        <a href="#1439868" title="(x: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.MainNode[K,V]" class="keyword">if</a> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#136901" title="scala.collection.concurrent.INode[K,V]">ctr</a>.<a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#27150" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#136899" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>.<a href="#136872" title="=&gt; Boolean">nonReadOnly</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          // try to commit
          <span title="scala.collection.concurrent.MainNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136898" title="scala.collection.concurrent.MainNode[K,V]">m</a>.<a href="MainNode.java.html#136735" title="(oldval: scala.collection.concurrent.MainNode[K,V], nval: scala.collection.concurrent.MainNode[K,V])Boolean">CAS_PREV</a><span class="delimiter">(</span><a href="#136900" title="scala.collection.concurrent.MainNode[K,V]">prev</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#136898" title="scala.collection.concurrent.MainNode[K,V]">m</a>
          <span class="keyword">else</span> <a href="#136715" title="(m: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_Complete</a><span class="delimiter">(</span><a href="#136898" title="scala.collection.concurrent.MainNode[K,V]">m</a>, <a href="#136899" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          // try to abort
          <a href="#136898" title="scala.collection.concurrent.MainNode[K,V]">m</a>.<a href="MainNode.java.html#136735" title="(oldval: scala.collection.concurrent.MainNode[K,V], nval: scala.collection.concurrent.MainNode[K,V])Boolean">CAS_PREV</a><span class="delimiter">(</span><a href="#136900" title="scala.collection.concurrent.MainNode[K,V]">prev</a>, <span title="scala.collection.concurrent.FailedNode[K,V]" class="keyword">new</span> <a href="#9105" title="scala.collection.concurrent.FailedNode[K,V]">FailedNode</a><span class="delimiter">(</span><a href="#136900" title="scala.collection.concurrent.MainNode[K,V]">prev</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#136715" title="(m: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_Complete</a><span class="delimiter">(</span>/*READ*/<a href="INodeBase.java.html#136700" title="scala.collection.concurrent.MainNode[K,V]">mainnode</a>, <a href="#136899" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean" id="136716">GCAS</a><span class="delimiter">(</span><a title="scala.collection.concurrent.MainNode[K,V]" id="136955">old</a>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.MainNode[K,V]" id="136956">n</a>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="136957">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    <a href="#136956" title="scala.collection.concurrent.MainNode[K,V]">n</a>.<a href="MainNode.java.html#136736" title="(nval: scala.collection.concurrent.MainNode[K,V])Unit">WRITE_PREV</a><span class="delimiter">(</span><a href="#136955" title="scala.collection.concurrent.MainNode[K,V]">old</a><span class="delimiter">)</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#136712" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V])Boolean">CAS</a><span class="delimiter">(</span><a href="#136955" title="scala.collection.concurrent.MainNode[K,V]">old</a>, <a href="#136956" title="scala.collection.concurrent.MainNode[K,V]">n</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#136715" title="(m: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_Complete</a><span class="delimiter">(</span><a href="#136956" title="scala.collection.concurrent.MainNode[K,V]">n</a>, <a href="#136957" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
      /*READ*/<a href="#136956" title="scala.collection.concurrent.MainNode[K,V]">n</a>.<a href="MainNode.java.html#136733" title="scala.collection.concurrent.MainNode[K,V]">prev</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(k1: K, k2: K, ct: scala.collection.concurrent.TrieMap[K,V])Boolean" id="136717">equal</a><span class="delimiter">(</span><a title="K" id="136960">k1</a>: <a href="#9203" title="K">K</a>, <a title="K" id="136961">k2</a>: <a href="#9203" title="K">K</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="136962">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#136962" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>.<a href="#136850" title="=&gt; Equiv[K]">equality</a>.<a href="../../math/Equiv.scala.html#51468" title="(x: K, y: K)Boolean">equiv</a><span class="delimiter">(</span><a href="#136960" title="K">k1</a>, <a href="#136961" title="K">k2</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(cn: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.INode[K,V]" id="136718">inode</a><span class="delimiter">(</span><a title="scala.collection.concurrent.MainNode[K,V]" id="136971">cn</a>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="136972">nin</a> = <a href="#136710" title="(g: scala.collection.concurrent.Gen)scala.collection.concurrent.INode[K,V]" class="keyword">new</a> <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
    <a href="#136972" title="scala.collection.concurrent.INode[K,V]">nin</a>.<a href="#136711" title="(nval: scala.collection.concurrent.MainNode[K,V])Unit">WRITE</a><span class="delimiter">(</span><a href="#136971" title="scala.collection.concurrent.MainNode[K,V]">cn</a><span class="delimiter">)</span>
    <a href="#136972" title="scala.collection.concurrent.INode[K,V]">nin</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.INode[K,V]" id="136719">copyToGen</a><span class="delimiter">(</span><a title="scala.collection.concurrent.Gen" id="136975">ngen</a>: <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="136976">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="136977">nin</a> = <a href="#136710" title="(g: scala.collection.concurrent.Gen)scala.collection.concurrent.INode[K,V]" class="keyword">new</a> <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#136975" title="scala.collection.concurrent.Gen">ngen</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="136978">main</a> = <a href="#136714" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#136976" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
    <a href="#136977" title="scala.collection.concurrent.INode[K,V]">nin</a>.<a href="#136711" title="(nval: scala.collection.concurrent.MainNode[K,V])Unit">WRITE</a><span class="delimiter">(</span><a href="#136978" title="scala.collection.concurrent.MainNode[K,V]">main</a><span class="delimiter">)</span>
    <a href="#136977" title="scala.collection.concurrent.INode[K,V]">nin</a>
  <span class="delimiter">}</span>

  /** Inserts a key value pair, overwriting the old pair if the keys match.
   *
   *  @return        true if successful, false otherwise
   */
  @tailrec <span class="keyword">def</span> <a title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Boolean" id="136720">rec_insert</a><span class="delimiter">(</span><a title="K" id="136981">k</a>: <a href="#9203" title="K">K</a>, <a title="V" id="136982">v</a>: <a href="#9204" title="V">V</a>, <a title="Int" id="136983">hc</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="Int" id="136984">lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="scala.collection.concurrent.INode[K,V]" id="136985">parent</a>: <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.Gen" id="136986">startgen</a>: <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="136987">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="136988">m</a> = <a href="#136714" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#136987" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span> // use -Yinline!

    <a href="#136988" title="scala.collection.concurrent.MainNode[K,V]">m</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1439886" title="Boolean" id="1439887">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 1) a multiway node
        <span class="keyword">val</span> <a title="Int" id="137021">idx</a> = <span class="delimiter">(</span><a href="#136983" title="Int">hc</a> <a href="../../Int.scala.html#26414" title="(x: Int)Int">&gt;&gt;&gt;</a> <a href="#136984" title="Int">lev</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <span title="Int(31)" class="int">0x1f</span>
        <span class="keyword">val</span> <a title="Int" id="137022">flag</a> = <span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#26412" title="(x: Int)Int">&lt;&lt;</a> <a href="#137021" title="Int">idx</a>
        <span class="keyword">val</span> <a title="Int" id="137023">bmp</a> = cn.<a href="#137089" title="=&gt; Int">bitmap</a>
        <span class="keyword">val</span> <a title="Int" id="137024">mask</a> = <a href="#137022" title="Int">flag</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span>
        <span class="keyword">val</span> <a title="Int" id="137025">pos</a> = <span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">bitCount</span><span class="delimiter">(</span><a href="#137023" title="Int">bmp</a> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <a href="#137024" title="Int">mask</a><span class="delimiter">)</span>
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#137023" title="Int">bmp</a> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <a href="#137022" title="Int">flag</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26428" title="(x: Int)Boolean">!=</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          // 1a) insert below
          cn.<a href="../../Array.scala.html#25963" title="(i: Int)scala.collection.concurrent.BasicNode">array</a><a href="#1439878" title="scala.collection.concurrent.INode[K,V]" class="delimiter">(</a><a href="#137025" title="Int">pos</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#1439877" title="Boolean" id="1439878">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
              <a href="#1439881" title="(x: Boolean)Boolean" class="keyword">if</a> <span class="delimiter">(</span><a href="#136986" title="scala.collection.concurrent.Gen">startgen</a> <span title="(x$1: AnyRef)Boolean">eq</span> in.<a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> in.<a href="#136720" title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Boolean">rec_insert</a><span class="delimiter">(</span><a href="#136981" title="K">k</a>, <a href="#136982" title="V">v</a>, <a href="#136983" title="Int">hc</a>, <a href="#136984" title="Int">lev</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="#9126" title="scala.collection.concurrent.INode[K,V]" class="keyword">this</a>, <a href="#136986" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#136987" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <span class="keyword">else</span> <span class="delimiter">{</span>
                <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#137011" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="#136986" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#136987" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>, <a href="#136987" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#136720" title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Boolean">rec_insert</a><span class="delimiter">(</span><a href="#136981" title="K">k</a>, <a href="#136982" title="V">v</a>, <a href="#136983" title="Int">hc</a>, <a href="#136984" title="Int">lev</a>, <a href="#136985" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#136986" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#136987" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
                <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <a href="#1439877" title="Boolean" id="1439879">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
              <a href="#1439881" title="(x: Boolean)Boolean" class="keyword">if</a> <span class="delimiter">(</span>sn.<a href="#137130" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> <a href="#136983" title="Int">hc</a> <a href="../../Boolean.scala.html#27150" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#136717" title="(k1: K, k2: K, ct: scala.collection.concurrent.TrieMap[K,V])Boolean">equal</a><span class="delimiter">(</span>sn.<a href="#137128" title="=&gt; K">k</a>, <a href="#136981" title="K">k</a>, <a href="#136987" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#137008" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#137025" title="Int">pos</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#9114" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#136981" title="K">k</a>, <a href="#136982" title="V">v</a>, <a href="#136983" title="Int">hc</a><span class="delimiter">)</span>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>, <a href="#136987" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <span class="keyword">else</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="137137">rn</a> = <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span>cn.<a href="#137091" title="=&gt; scala.collection.concurrent.Gen">gen</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> cn <span class="keyword">else</span> cn.<a href="#137011" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a>, <a href="#136987" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
                <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="137138">nn</a> = <a href="#137137" title="scala.collection.concurrent.CNode[K,V]">rn</a>.<a href="#137008" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#137025" title="Int">pos</a>, <a href="#136718" title="(cn: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.INode[K,V]">inode</a><span class="delimiter">(</span><a href="#9133" title="scala.collection.concurrent.CNode.type">CNode</a>.<a href="#137140" title="(x: scala.collection.concurrent.SNode[K,V], xhc: Int, y: scala.collection.concurrent.SNode[K,V], yhc: Int, lev: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.MainNode[K,V]">dual</a><span class="delimiter">(</span>sn, sn.<a href="#137130" title="=&gt; Int">hc</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#9114" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#136981" title="K">k</a>, <a href="#136982" title="V">v</a>, <a href="#136983" title="Int">hc</a><span class="delimiter">)</span>, <a href="#136983" title="Int">hc</a>, <a href="#136984" title="Int">lev</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
                <a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, <a href="#137138" title="scala.collection.concurrent.CNode[K,V]">nn</a>, <a href="#136987" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="137183">rn</a> = <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span>cn.<a href="#137091" title="=&gt; scala.collection.concurrent.Gen">gen</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> cn <span class="keyword">else</span> cn.<a href="#137011" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a>, <a href="#136987" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="137184">ncnode</a> = <a href="#137183" title="scala.collection.concurrent.CNode[K,V]">rn</a>.<a href="#137010" title="(pos: Int, flag: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">insertedAt</a><span class="delimiter">(</span><a href="#137025" title="Int">pos</a>, <a href="#137022" title="Int">flag</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#9114" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#136981" title="K">k</a>, <a href="#136982" title="V">v</a>, <a href="#136983" title="Int">hc</a><span class="delimiter">)</span>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
          <a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, <a href="#137184" title="scala.collection.concurrent.CNode[K,V]">ncnode</a>, <a href="#136987" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#1439886" title="Boolean" id="1439888">tn</a>: TNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
        <a href="#136724" title="(nd: scala.collection.concurrent.INode[K,V], ct: scala.collection.concurrent.TrieMap[K,V], lev: Int)Unit">clean</a><span class="delimiter">(</span><a href="#136985" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#136987" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>, <a href="#136984" title="Int">lev</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
        <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">case</span> <a href="#1439886" title="Boolean" id="1439889">ln</a>: LNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 3) an l-node
        <span class="keyword">val</span> <a title="scala.collection.concurrent.LNode[K,V]" id="137258">nn</a> = ln.<a href="#137251" title="(k: K, v: V)scala.collection.concurrent.LNode[K,V]">inserted</a><span class="delimiter">(</span><a href="#136981" title="K">k</a>, <a href="#136982" title="V">v</a><span class="delimiter">)</span>
        <a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>ln, <a href="#137258" title="scala.collection.concurrent.LNode[K,V]">nn</a>, <a href="#136987" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Inserts a new key value pair, given that a specific condition is met.
   *
   *  @param cond        null - don't care if the key was there; KEY_ABSENT - key wasn't there; KEY_PRESENT - key was there; other value `v` - key must be bound to `v`
   *  @return            null if unsuccessful, Option[V] otherwise (indicating previous value bound to the key)
   */
  @tailrec <span class="keyword">def</span> <a title="(k: K, v: V, hc: Int, cond: AnyRef, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]" id="136721">rec_insertif</a><span class="delimiter">(</span><a title="K" id="137721">k</a>: <a href="#9203" title="K">K</a>, <a title="V" id="137722">v</a>: <a href="#9204" title="V">V</a>, <a title="Int" id="137723">hc</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="AnyRef" id="137724">cond</a>: <span title="AnyRef">AnyRef</span>, <a title="Int" id="137725">lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="scala.collection.concurrent.INode[K,V]" id="137726">parent</a>: <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.Gen" id="137727">startgen</a>: <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="137728">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Option.scala.html#978" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="137729">m</a> = <a href="#136714" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>  // use -Yinline!

    <a href="#137729" title="scala.collection.concurrent.MainNode[K,V]">m</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1440030" title="Option[V]" id="1440031">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 1) a multiway node
        <span class="keyword">val</span> <a title="Int" id="137733">idx</a> = <span class="delimiter">(</span><a href="#137723" title="Int">hc</a> <a href="../../Int.scala.html#26414" title="(x: Int)Int">&gt;&gt;&gt;</a> <a href="#137725" title="Int">lev</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <span title="Int(31)" class="int">0x1f</span>
        <span class="keyword">val</span> <a title="Int" id="137734">flag</a> = <span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#26412" title="(x: Int)Int">&lt;&lt;</a> <a href="#137733" title="Int">idx</a>
        <span class="keyword">val</span> <a title="Int" id="137735">bmp</a> = cn.<a href="#137089" title="=&gt; Int">bitmap</a>
        <span class="keyword">val</span> <a title="Int" id="137736">mask</a> = <a href="#137734" title="Int">flag</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span>
        <span class="keyword">val</span> <a title="Int" id="137737">pos</a> = <span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">bitCount</span><span class="delimiter">(</span><a href="#137735" title="Int">bmp</a> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <a href="#137736" title="Int">mask</a><span class="delimiter">)</span>
        <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#137735" title="Int">bmp</a> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <a href="#137734" title="Int">flag</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26428" title="(x: Int)Boolean">!=</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          // 1a) insert below
          cn.<a href="../../Array.scala.html#25963" title="(i: Int)scala.collection.concurrent.BasicNode">array</a><a href="#1439927" title="scala.collection.concurrent.INode[K,V]" class="delimiter">(</a><a href="#137737" title="Int">pos</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#1439926" title="Option[V]" id="1439927">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
              <a href="#1439930" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span><a href="#137727" title="scala.collection.concurrent.Gen">startgen</a> <span title="(x$1: AnyRef)Boolean">eq</span> in.<a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> in.<a href="#136721" title="(k: K, v: V, hc: Int, cond: AnyRef, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]">rec_insertif</a><span class="delimiter">(</span><a href="#137721" title="K">k</a>, <a href="#137722" title="V">v</a>, <a href="#137723" title="Int">hc</a>, <a href="#137724" title="AnyRef">cond</a>, <a href="#137725" title="Int">lev</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="#9126" title="scala.collection.concurrent.INode[K,V]" class="keyword">this</a>, <a href="#137727" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <span class="keyword">else</span> <span class="delimiter">{</span>
                <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#137011" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="#137727" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#136721" title="(k: K, v: V, hc: Int, cond: AnyRef, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]">rec_insertif</a><span class="delimiter">(</span><a href="#137721" title="K">k</a>, <a href="#137722" title="V">v</a>, <a href="#137723" title="Int">hc</a>, <a href="#137724" title="AnyRef">cond</a>, <a href="#137725" title="Int">lev</a>, <a href="#137726" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#137727" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
                <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <a href="#1439926" title="Option[V]" id="1439928">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="#1439930" title="(x: Option[V])Option[V]">cond</a> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a href="#1439897" title="Option[V]" id="1439904" class="keyword">null</a> =&gt;
                <a href="#1439910" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span>sn.<a href="#137130" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> <a href="#137723" title="Int">hc</a> <a href="../../Boolean.scala.html#27150" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#136717" title="(k1: K, k2: K, ct: scala.collection.concurrent.TrieMap[K,V])Boolean">equal</a><span class="delimiter">(</span>sn.<a href="#137128" title="=&gt; K">k</a>, <a href="#137721" title="K">k</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#137008" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#137737" title="Int">pos</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#9114" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#137721" title="K">k</a>, <a href="#137722" title="V">v</a>, <a href="#137723" title="Int">hc</a><span class="delimiter">)</span>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#32449" title="(x: V)Some[V]">Some</a><span class="delimiter">(</span>sn.<a href="#137129" title="=&gt; V">v</a><span class="delimiter">)</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                  <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="137796">rn</a> = <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span>cn.<a href="#137091" title="=&gt; scala.collection.concurrent.Gen">gen</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> cn <span class="keyword">else</span> cn.<a href="#137011" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
                  <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="137797">nn</a> = <a href="#137796" title="scala.collection.concurrent.CNode[K,V]">rn</a>.<a href="#137008" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#137737" title="Int">pos</a>, <a href="#136718" title="(cn: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.INode[K,V]">inode</a><span class="delimiter">(</span><a href="#9133" title="scala.collection.concurrent.CNode.type">CNode</a>.<a href="#137140" title="(x: scala.collection.concurrent.SNode[K,V], xhc: Int, y: scala.collection.concurrent.SNode[K,V], yhc: Int, lev: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.MainNode[K,V]">dual</a><span class="delimiter">(</span>sn, sn.<a href="#137130" title="=&gt; Int">hc</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#9114" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#137721" title="K">k</a>, <a href="#137722" title="V">v</a>, <a href="#137723" title="Int">hc</a><span class="delimiter">)</span>, <a href="#137723" title="Int">hc</a>, <a href="#137725" title="Int">lev</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
                  <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, <a href="#137797" title="scala.collection.concurrent.CNode[K,V]">nn</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#1585" title="None.type">None</a>
                  <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
                <span class="delimiter">}</span>
              <span class="keyword">case</span> <a href="#9127" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#137827" title="Option[V]" id="1439905">KEY_ABSENT</a> =&gt;
                <a href="#1439910" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span>sn.<a href="#137130" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> <a href="#137723" title="Int">hc</a> <a href="../../Boolean.scala.html#27150" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#136717" title="(k1: K, k2: K, ct: scala.collection.concurrent.TrieMap[K,V])Boolean">equal</a><span class="delimiter">(</span>sn.<a href="#137128" title="=&gt; K">k</a>, <a href="#137721" title="K">k</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#32449" title="(x: V)Some[V]">Some</a><span class="delimiter">(</span>sn.<a href="#137129" title="=&gt; V">v</a><span class="delimiter">)</span>
                <span class="keyword">else</span> <span class="delimiter">{</span>
                  <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="137841">rn</a> = <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span>cn.<a href="#137091" title="=&gt; scala.collection.concurrent.Gen">gen</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> cn <span class="keyword">else</span> cn.<a href="#137011" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
                  <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="137842">nn</a> = <a href="#137841" title="scala.collection.concurrent.CNode[K,V]">rn</a>.<a href="#137008" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#137737" title="Int">pos</a>, <a href="#136718" title="(cn: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.INode[K,V]">inode</a><span class="delimiter">(</span><a href="#9133" title="scala.collection.concurrent.CNode.type">CNode</a>.<a href="#137140" title="(x: scala.collection.concurrent.SNode[K,V], xhc: Int, y: scala.collection.concurrent.SNode[K,V], yhc: Int, lev: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.MainNode[K,V]">dual</a><span class="delimiter">(</span>sn, sn.<a href="#137130" title="=&gt; Int">hc</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#9114" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#137721" title="K">k</a>, <a href="#137722" title="V">v</a>, <a href="#137723" title="Int">hc</a><span class="delimiter">)</span>, <a href="#137723" title="Int">hc</a>, <a href="#137725" title="Int">lev</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
                  <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, <a href="#137842" title="scala.collection.concurrent.CNode[K,V]">nn</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#1585" title="None.type">None</a>
                  <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
                <span class="delimiter">}</span>
              <span class="keyword">case</span> <a href="#9127" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#137825" title="Option[V]" id="1439906">KEY_PRESENT</a> =&gt;
                <a href="#1439910" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span>sn.<a href="#137130" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> <a href="#137723" title="Int">hc</a> <a href="../../Boolean.scala.html#27150" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#136717" title="(k1: K, k2: K, ct: scala.collection.concurrent.TrieMap[K,V])Boolean">equal</a><span class="delimiter">(</span>sn.<a href="#137128" title="=&gt; K">k</a>, <a href="#137721" title="K">k</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#137008" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#137737" title="Int">pos</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#9114" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#137721" title="K">k</a>, <a href="#137722" title="V">v</a>, <a href="#137723" title="Int">hc</a><span class="delimiter">)</span>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#32449" title="(x: V)Some[V]">Some</a><span class="delimiter">(</span>sn.<a href="#137129" title="=&gt; V">v</a><span class="delimiter">)</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <a href="../../Option.scala.html#1585" title="None.type">None</a>
              <span class="keyword">case</span> otherv =&gt;
                <a href="#1439910" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span>sn.<a href="#137130" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> <a href="#137723" title="Int">hc</a> <a href="../../Boolean.scala.html#27150" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#136717" title="(k1: K, k2: K, ct: scala.collection.concurrent.TrieMap[K,V])Boolean">equal</a><span class="delimiter">(</span>sn.<a href="#137128" title="=&gt; K">k</a>, <a href="#137721" title="K">k</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#27150" title="(x: Boolean)Boolean">&amp;&amp;</a> sn.<a href="#137129" title="=&gt; V">v</a> <span title="(x$1: Any)Boolean">==</span> otherv<span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#137008" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#137737" title="Int">pos</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#9114" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#137721" title="K">k</a>, <a href="#137722" title="V">v</a>, <a href="#137723" title="Int">hc</a><span class="delimiter">)</span>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#32449" title="(x: V)Some[V]">Some</a><span class="delimiter">(</span>sn.<a href="#137129" title="=&gt; V">v</a><span class="delimiter">)</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <a href="../../Option.scala.html#1585" title="None.type">None</a>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#137724" title="AnyRef">cond</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="#1439935" title="Option[V]" id="1439942" class="keyword">null</a> | <a href="#9127" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#137827" title="Boolean" id="1439943">KEY_ABSENT</a> =&gt;
            <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="137900">rn</a> = <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span>cn.<a href="#137091" title="=&gt; scala.collection.concurrent.Gen">gen</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> cn <span class="keyword">else</span> cn.<a href="#137011" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="137901">ncnode</a> = <a href="#137900" title="scala.collection.concurrent.CNode[K,V]">rn</a>.<a href="#137010" title="(pos: Int, flag: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">insertedAt</a><span class="delimiter">(</span><a href="#137737" title="Int">pos</a>, <a href="#137734" title="Int">flag</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#9114" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#137721" title="K">k</a>, <a href="#137722" title="V">v</a>, <a href="#137723" title="Int">hc</a><span class="delimiter">)</span>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
            <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, <a href="#137901" title="scala.collection.concurrent.CNode[K,V]">ncnode</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#1585" title="None.type">None</a> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">case</span> <a href="#9127" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#137825" title="Option[V]" id="1439944">KEY_PRESENT</a> =&gt; <a href="#1439948" title="(x: Option[V])Option[V]">None</a>
          <span class="keyword">case</span> otherv =&gt; <a href="#1439948" title="(x: Option[V])Option[V]">None</a>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#1440030" title="Option[V]" id="1440032">sn</a>: TNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
        <a href="#136724" title="(nd: scala.collection.concurrent.INode[K,V], ct: scala.collection.concurrent.TrieMap[K,V], lev: Int)Unit">clean</a><span class="delimiter">(</span><a href="#137726" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>, <a href="#137725" title="Int">lev</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
        <span title="Null(null)" class="keyword">null</span>
      <span class="keyword">case</span> <a href="#1440030" title="Option[V]" id="1440033">ln</a>: LNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 3) an l-node
        <span class="keyword">def</span> <a title="()Boolean" id="137921">insertln</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="scala.collection.concurrent.LNode[K,V]" id="137922">nn</a> = ln.<a href="#137251" title="(k: K, v: V)scala.collection.concurrent.LNode[K,V]">inserted</a><span class="delimiter">(</span><a href="#137721" title="K">k</a>, <a href="#137722" title="V">v</a><span class="delimiter">)</span>
          <a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>ln, <a href="#137922" title="scala.collection.concurrent.LNode[K,V]">nn</a>, <a href="#137728" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#137724" title="AnyRef">cond</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="#1440001" title="Option[V]" id="1440008" class="keyword">null</a> =&gt;
            <span class="keyword">val</span> <a title="Option[V]" id="137925">optv</a> = ln.<a href="#137253" title="(k: K)Option[V]">get</a><span class="delimiter">(</span><a href="#137721" title="K">k</a><span class="delimiter">)</span>
            <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#137921" title="()Boolean">insertln</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#137925" title="Option[V]">optv</a> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">case</span> <a href="#9127" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#137827" title="Option[V]" id="1440009">KEY_ABSENT</a> =&gt;
            ln.<a href="#137253" title="(k: K)Option[V]">get</a><a href="#1440014" title="(x: Option[V])Option[V]" class="delimiter">(</a><a href="#137721" title="K">k</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a href="../../Option.scala.html#1585" title="Option[V]" id="1439970">None</a> =&gt; <a href="#1439972" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span><a href="#137921" title="()Boolean">insertln</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#1585" title="None.type">None</a> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
              <span class="keyword">case</span> optv =&gt; <a href="#1439972" title="(x: Option[V])Option[V]">optv</a>
            <span class="delimiter">}</span>
          <span class="keyword">case</span> <a href="#9127" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#137825" title="Option[V]" id="1440010">KEY_PRESENT</a> =&gt;
            ln.<a href="#137253" title="(k: K)Option[V]">get</a><a href="#1440014" title="(x: Option[V])Option[V]" class="delimiter">(</a><a href="#137721" title="K">k</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> Some<a href="#1439980" title="Option[V]" id="1439981" class="delimiter">(</a><a href="../../Option.scala.html#32453" title="V" id="137938">v0</a><span class="delimiter">)</span> =&gt; <a href="#1439985" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span><a href="#137921" title="()Boolean">insertln</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#32449" title="(x: V)Some[V]">Some</a><span class="delimiter">(</span><a href="#137938" title="V">v0</a><span class="delimiter">)</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
              <span class="keyword">case</span> <a href="../../Option.scala.html#1585" title="Option[V]" id="1439983">None</a> =&gt; <a href="#1439985" title="(x: Option[V])Option[V]">None</a>
            <span class="delimiter">}</span>
          <span class="keyword">case</span> otherv =&gt;
            ln.<a href="#137253" title="(k: K)Option[V]">get</a><a href="#1440014" title="(x: Option[V])Option[V]" class="delimiter">(</a><a href="#137721" title="K">k</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> Some<a href="#1439993" title="Option[V]" id="1439994" class="delimiter">(</a><a href="../../Option.scala.html#32453" title="V" id="137944">v0</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#137944" title="V">v0</a> <span title="(x$1: Any)Boolean">==</span> otherv =&gt; <a href="#1439996" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span><a href="#137921" title="()Boolean">insertln</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#32449" title="(x: V)Some[V]">Some</a><span class="delimiter">(</span>otherv.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="V" class="delimiter">[</span><a href="#9204" title="V">V</a><span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
              <span class="keyword">case</span> _ =&gt; <a href="#1439996" title="(x: Option[V])Option[V]">None</a>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Looks up the value associated with the key.
   *
   *  @return          null if no value has been found, RESTART if the operation wasn't successful, or any other value otherwise
   */
  @tailrec <span class="keyword">def</span> <a title="(k: K, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])AnyRef" id="136722">rec_lookup</a><span class="delimiter">(</span><a title="K" id="137948">k</a>: <a href="#9203" title="K">K</a>, <a title="Int" id="137949">hc</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="Int" id="137950">lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="scala.collection.concurrent.INode[K,V]" id="137951">parent</a>: <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.Gen" id="137952">startgen</a>: <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="137953">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="AnyRef">AnyRef</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="137954">m</a> = <a href="#136714" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#137953" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span> // use -Yinline!

    <a href="#137954" title="scala.collection.concurrent.MainNode[K,V]">m</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1440050" title="AnyRef" id="1440051">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 1) a multinode
        <span class="keyword">val</span> <a title="Int" id="137958">idx</a> = <span class="delimiter">(</span><a href="#137949" title="Int">hc</a> <a href="../../Int.scala.html#26414" title="(x: Int)Int">&gt;&gt;&gt;</a> <a href="#137950" title="Int">lev</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <span title="Int(31)" class="int">0x1f</span>
        <span class="keyword">val</span> <a title="Int" id="137959">flag</a> = <span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#26412" title="(x: Int)Int">&lt;&lt;</a> <a href="#137958" title="Int">idx</a>
        <span class="keyword">val</span> <a title="Int" id="137960">bmp</a> = cn.<a href="#137089" title="=&gt; Int">bitmap</a>
        <span title="AnyRef" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#137960" title="Int">bmp</a> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <a href="#137959" title="Int">flag</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="Null(null)" class="keyword">null</span> // 1a) bitmap shows no binding
        <span class="keyword">else</span> <span class="delimiter">{</span> // 1b) bitmap contains a value - descend
          <span class="keyword">val</span> <a title="Int" id="137982">pos</a> = <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#137960" title="Int">bmp</a> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> <span title="Int(-1)" class="int">0xffffffff</span><span class="delimiter">)</span> <a href="#137958" title="Int">idx</a> <span class="keyword">else</span> <span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">bitCount</span><span class="delimiter">(</span><a href="#137960" title="Int">bmp</a> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <span class="delimiter">(</span><a href="#137959" title="Int">flag</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="scala.collection.concurrent.BasicNode" id="137983">sub</a> = cn.<a href="../../Array.scala.html#25963" title="(i: Int)scala.collection.concurrent.BasicNode">array</a><span class="delimiter">(</span><a href="#137982" title="Int">pos</a><span class="delimiter">)</span>
          <a href="#137983" title="scala.collection.concurrent.BasicNode">sub</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#1440041" title="AnyRef" id="1440042">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
              <a href="#1440045" title="(x: AnyRef)AnyRef" class="keyword">if</a> <span class="delimiter">(</span><a href="#137953" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>.<a href="#136871" title="=&gt; Boolean">isReadOnly</a> <a href="../../Boolean.scala.html#27149" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#137952" title="scala.collection.concurrent.Gen">startgen</a> <span title="(x$1: AnyRef)Boolean">eq</span> in.<a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span><span class="delimiter">)</span> in.<a href="#136722" title="(k: K, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])AnyRef">rec_lookup</a><span class="delimiter">(</span><a href="#137948" title="K">k</a>, <a href="#137949" title="Int">hc</a>, <a href="#137950" title="Int">lev</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="#9126" title="scala.collection.concurrent.INode[K,V]" class="keyword">this</a>, <a href="#137952" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#137953" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <span class="keyword">else</span> <span class="delimiter">{</span>
                <span title="AnyRef" class="keyword">if</span> <span class="delimiter">(</span><a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#137011" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="#137952" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#137953" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>, <a href="#137953" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#136722" title="(k: K, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])AnyRef">rec_lookup</a><span class="delimiter">(</span><a href="#137948" title="K">k</a>, <a href="#137949" title="Int">hc</a>, <a href="#137950" title="Int">lev</a>, <a href="#137951" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#137952" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#137953" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
                <span class="keyword">else</span> <span title="Nothing" class="keyword">return</span> <a href="INodeBase.java.html#136746" title="Object">RESTART</a> // used to be throw RestartException
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <a href="#1440041" title="AnyRef" id="1440043">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 2) singleton node
              <a href="#1440045" title="(x: AnyRef)AnyRef" class="keyword">if</a> <span class="delimiter">(</span>sn.<a href="#137130" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> <a href="#137949" title="Int">hc</a> <a href="../../Boolean.scala.html#27150" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#136717" title="(k1: K, k2: K, ct: scala.collection.concurrent.TrieMap[K,V])Boolean">equal</a><span class="delimiter">(</span>sn.<a href="#137128" title="=&gt; K">k</a>, <a href="#137948" title="K">k</a>, <a href="#137953" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> sn.<a href="#137129" title="=&gt; V">v</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span>
              <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#1440050" title="AnyRef" id="1440052">tn</a>: TNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 3) non-live node
        <span class="keyword">def</span> <a title="(tn: scala.collection.concurrent.TNode[K,V])Object" id="138020">cleanReadOnly</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TNode[K,V]" id="138021">tn</a>: <a href="#9150" title="scala.collection.concurrent.TNode[K,V]">TNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <span title="Object" class="keyword">if</span> <span class="delimiter">(</span><a href="#137953" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>.<a href="#136872" title="=&gt; Boolean">nonReadOnly</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#136724" title="(nd: scala.collection.concurrent.INode[K,V], ct: scala.collection.concurrent.TrieMap[K,V], lev: Int)Unit">clean</a><span class="delimiter">(</span><a href="#137951" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#137953" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>, <a href="#137950" title="Int">lev</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
          <a href="INodeBase.java.html#136746" title="Object">RESTART</a> // used to be throw RestartException
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="AnyRef" class="keyword">if</span> <span class="delimiter">(</span><a href="#138021" title="scala.collection.concurrent.TNode[K,V]">tn</a>.<a href="#138399" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> <a href="#137949" title="Int">hc</a> <a href="../../Boolean.scala.html#27150" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#138021" title="scala.collection.concurrent.TNode[K,V]">tn</a>.<a href="#138397" title="=&gt; K">k</a> <span title="(x$1: Any)Boolean">==</span> <a href="#137948" title="K">k</a><span class="delimiter">)</span> <a href="#138021" title="scala.collection.concurrent.TNode[K,V]">tn</a>.<a href="#138398" title="=&gt; V">v</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span>
          <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
        <span class="delimiter">}</span>
        <a href="#138020" title="(tn: scala.collection.concurrent.TNode[K,V])Object">cleanReadOnly</a><span class="delimiter">(</span>tn<span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#1440050" title="AnyRef" id="1440053">ln</a>: LNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 5) an l-node
        ln.<a href="#137253" title="(k: K)Option[V]">get</a><span class="delimiter">(</span><a href="#137948" title="K">k</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Option[AnyRef]" class="delimiter">[</span><a href="../../Option.scala.html#978" title="Option[AnyRef]">Option</a><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span><span class="delimiter">]</span>.<a href="#1440055" title="(x: AnyRef)AnyRef">orNull</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Removes the key associated with the given value.
   *
   *  @param v         if null, will remove the key irregardless of the value; otherwise removes only if binding contains that exact key and value
   *  @return          null if not successful, an Option[V] indicating the previous value otherwise
   */
  <span class="keyword">def</span> <a title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]" id="136723">rec_remove</a><span class="delimiter">(</span><a title="K" id="138041">k</a>: <a href="#9203" title="K">K</a>, <a title="V" id="138042">v</a>: <a href="#9204" title="V">V</a>, <a title="Int" id="138043">hc</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="Int" id="138044">lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="scala.collection.concurrent.INode[K,V]" id="138045">parent</a>: <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.Gen" id="138046">startgen</a>: <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="138047">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Option.scala.html#978" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="138048">m</a> = <a href="#136714" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span> // use -Yinline!

    <a href="#138048" title="scala.collection.concurrent.MainNode[K,V]">m</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1440093" title="Option[V]" id="1440094">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
        <span class="keyword">val</span> <a title="Int" id="138052">idx</a> = <span class="delimiter">(</span><a href="#138043" title="Int">hc</a> <a href="../../Int.scala.html#26414" title="(x: Int)Int">&gt;&gt;&gt;</a> <a href="#138044" title="Int">lev</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <span title="Int(31)" class="int">0x1f</span>
        <span class="keyword">val</span> <a title="Int" id="138053">bmp</a> = cn.<a href="#137089" title="=&gt; Int">bitmap</a>
        <span class="keyword">val</span> <a title="Int" id="138054">flag</a> = <span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#26412" title="(x: Int)Int">&lt;&lt;</a> <a href="#138052" title="Int">idx</a>
        <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#138053" title="Int">bmp</a> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <a href="#138054" title="Int">flag</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="../../Option.scala.html#1585" title="None.type">None</a>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Int" id="138076">pos</a> = <span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">bitCount</span><span class="delimiter">(</span><a href="#138053" title="Int">bmp</a> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <span class="delimiter">(</span><a href="#138054" title="Int">flag</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="scala.collection.concurrent.BasicNode" id="138077">sub</a> = cn.<a href="../../Array.scala.html#25963" title="(i: Int)scala.collection.concurrent.BasicNode">array</a><span class="delimiter">(</span><a href="#138076" title="Int">pos</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Option[V]" id="138078">res</a> = <a href="#138077" title="scala.collection.concurrent.BasicNode">sub</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#1440061" title="Option[V]" id="1440062">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
              <a href="#1440065" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span><a href="#138046" title="scala.collection.concurrent.Gen">startgen</a> <span title="(x$1: AnyRef)Boolean">eq</span> in.<a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> in.<a href="#136723" title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]">rec_remove</a><span class="delimiter">(</span><a href="#138041" title="K">k</a>, <a href="#138042" title="V">v</a>, <a href="#138043" title="Int">hc</a>, <a href="#138044" title="Int">lev</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="#9126" title="scala.collection.concurrent.INode[K,V]" class="keyword">this</a>, <a href="#138046" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <span class="keyword">else</span> <span class="delimiter">{</span>
                <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#137011" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="#138046" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>, <a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#136723" title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]">rec_remove</a><span class="delimiter">(</span><a href="#138041" title="K">k</a>, <a href="#138042" title="V">v</a>, <a href="#138043" title="Int">hc</a>, <a href="#138044" title="Int">lev</a>, <a href="#138045" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#138046" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
                <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <a href="#1440061" title="Option[V]" id="1440063">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
              <a href="#1440065" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span>sn.<a href="#137130" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> <a href="#138043" title="Int">hc</a> <a href="../../Boolean.scala.html#27150" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#136717" title="(k1: K, k2: K, ct: scala.collection.concurrent.TrieMap[K,V])Boolean">equal</a><span class="delimiter">(</span>sn.<a href="#137128" title="=&gt; K">k</a>, <a href="#138041" title="K">k</a>, <a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#27150" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#138042" title="V">v</a> <span title="(x$1: Any)Boolean">==</span> <span title="Null(null)" class="keyword">null</span> <a href="../../Boolean.scala.html#27149" title="(x: Boolean)Boolean">||</a> sn.<a href="#137129" title="=&gt; V">v</a> <span title="(x$1: Any)Boolean">==</span> <a href="#138042" title="V">v</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="138105">ncn</a> = cn.<a href="#137009" title="(pos: Int, flag: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">removedAt</a><span class="delimiter">(</span><a href="#138076" title="Int">pos</a>, <a href="#138054" title="Int">flag</a>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>.<a href="#137013" title="(lev: Int)scala.collection.concurrent.MainNode[K,V]">toContracted</a><span class="delimiter">(</span><a href="#138044" title="Int">lev</a><span class="delimiter">)</span>
                <span title="Some[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, <a href="#138105" title="scala.collection.concurrent.MainNode[K,V]">ncn</a>, <a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#32449" title="(x: V)Some[V]">Some</a><span class="delimiter">(</span>sn.<a href="#137129" title="=&gt; V">v</a><span class="delimiter">)</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
              <span class="delimiter">}</span> <span class="keyword">else</span> <a href="../../Option.scala.html#1585" title="None.type">None</a>
          <span class="delimiter">}</span>

          <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#138078" title="Option[V]">res</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../Option.scala.html#1585" title="None.type">None</a> <a href="../../Boolean.scala.html#27149" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#138078" title="Option[V]">res</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#138078" title="Option[V]">res</a>
          <span class="keyword">else</span> <span class="delimiter">{</span>
            @tailrec <span class="keyword">def</span> <a title="(nonlive: AnyRef)Unit" id="138150">cleanParent</a><span class="delimiter">(</span><a title="AnyRef" id="138151">nonlive</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="138152">pm</a> = <a href="#138045" title="scala.collection.concurrent.INode[K,V]">parent</a>.<a href="#136714" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <a href="#138152" title="scala.collection.concurrent.MainNode[K,V]">pm</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a href="#1440077" title="Unit" id="1440078">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
                  <span class="keyword">val</span> <a title="Int" id="138156">idx</a> = <span class="delimiter">(</span><a href="#138043" title="Int">hc</a> <a href="../../Int.scala.html#26414" title="(x: Int)Int">&gt;&gt;&gt;</a> <span class="delimiter">(</span><a href="#138044" title="Int">lev</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <span title="Int(5)" class="int">5</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <span title="Int(31)" class="int">0x1f</span>
                  <span class="keyword">val</span> <a title="Int" id="138157">bmp</a> = cn.<a href="#137089" title="=&gt; Int">bitmap</a>
                  <span class="keyword">val</span> <a title="Int" id="138158">flag</a> = <span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#26412" title="(x: Int)Int">&lt;&lt;</a> <a href="#138156" title="Int">idx</a>
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#138157" title="Int">bmp</a> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <a href="#138158" title="Int">flag</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span> // somebody already removed this i-node, we're done
                  <span class="keyword">else</span> <span class="delimiter">{</span>
                    <span class="keyword">val</span> <a title="Int" id="138184">pos</a> = <span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">bitCount</span><span class="delimiter">(</span><a href="#138157" title="Int">bmp</a> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <span class="delimiter">(</span><a href="#138158" title="Int">flag</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
                    <span class="keyword">val</span> <a title="scala.collection.concurrent.BasicNode" id="138185">sub</a> = cn.<a href="../../Array.scala.html#25963" title="(i: Int)scala.collection.concurrent.BasicNode">array</a><span class="delimiter">(</span><a href="#138184" title="Int">pos</a><span class="delimiter">)</span>
                    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#138185" title="scala.collection.concurrent.BasicNode">sub</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#9126" title="scala.collection.concurrent.INode[K,V]" class="keyword">this</a><span class="delimiter">)</span> <a href="#138151" title="AnyRef">nonlive</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                      <span class="keyword">case</span> <a href="#1440070" title="Unit" id="1440071">tn</a>: TNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
                        <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="138199">ncn</a> = cn.<a href="#137008" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#138184" title="Int">pos</a>, tn.<a href="#137231" title="=&gt; scala.collection.concurrent.SNode[K,V]">copyUntombed</a>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>.<a href="#137013" title="(lev: Int)scala.collection.concurrent.MainNode[K,V]">toContracted</a><span class="delimiter">(</span><a href="#138044" title="Int">lev</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
                        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#27146" title="=&gt; Boolean">!</a><a href="#138045" title="scala.collection.concurrent.INode[K,V]">parent</a>.<a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, <a href="#138199" title="scala.collection.concurrent.MainNode[K,V]">ncn</a>, <a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span>
                          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>.<a href="#136859" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">readRoot</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#138046" title="scala.collection.concurrent.Gen">startgen</a><span class="delimiter">)</span> <a href="#138150" title="(nonlive: AnyRef)Unit">cleanParent</a><span class="delimiter">(</span><a href="#138151" title="AnyRef">nonlive</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span>
                  <span class="delimiter">}</span>
                <span class="keyword">case</span> _ =&gt; // parent is no longer a cnode, we're done
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>

            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#138045" title="scala.collection.concurrent.INode[K,V]">parent</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span> // never tomb at root
              <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="138222">n</a> = <a href="#136714" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#138222" title="scala.collection.concurrent.MainNode[K,V]">n</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="#9150" title="scala.collection.concurrent.TNode[_, _]">TNode</a><span class="delimiter">[</span>_, _<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
                <a href="#138150" title="(nonlive: AnyRef)Unit">cleanParent</a><span class="delimiter">(</span><a href="#138222" title="scala.collection.concurrent.MainNode[K,V]">n</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>

            <a href="#138078" title="Option[V]">res</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#1440093" title="Option[V]" id="1440095">tn</a>: TNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
        <a href="#136724" title="(nd: scala.collection.concurrent.INode[K,V], ct: scala.collection.concurrent.TrieMap[K,V], lev: Int)Unit">clean</a><span class="delimiter">(</span><a href="#138045" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>, <a href="#138044" title="Int">lev</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
        <span title="Null(null)" class="keyword">null</span>
      <span class="keyword">case</span> <a href="#1440093" title="Option[V]" id="1440096">ln</a>: LNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
        <a href="#1440098" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span><a href="#138042" title="V">v</a> <span title="(x$1: Any)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Option[V]" id="138243">optv</a> = ln.<a href="#137253" title="(k: K)Option[V]">get</a><span class="delimiter">(</span><a href="#138041" title="K">k</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="138244">nn</a> = ln.<a href="#137252" title="(k: K, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">removed</a><span class="delimiter">(</span><a href="#138041" title="K">k</a>, <a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
          <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>ln, <a href="#138244" title="scala.collection.concurrent.MainNode[K,V]">nn</a>, <a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#138243" title="Option[V]">optv</a> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> ln.<a href="#137253" title="(k: K)Option[V]">get</a><a href="#1440086" title="Some[V]" class="delimiter">(</a><a href="#138041" title="K">k</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> optv @ Some<a href="#1440085" title="Option[V]" id="1440086" class="delimiter">(</a><a href="../../Option.scala.html#32453" title="V" id="138252">v0</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#138252" title="V">v0</a> <span title="(x$1: Any)Boolean">==</span> <a href="#138042" title="V">v</a> =&gt;
            <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="138253">nn</a> = ln.<a href="#137252" title="(k: K, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">removed</a><span class="delimiter">(</span><a href="#138041" title="K">k</a>, <a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
            <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>ln, <a href="#138253" title="scala.collection.concurrent.MainNode[K,V]">nn</a>, <a href="#138047" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> optv <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">case</span> _ =&gt; <a href="#1440088" title="(x: Option[V])Option[V]">None</a>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(nd: scala.collection.concurrent.INode[K,V], ct: scala.collection.concurrent.TrieMap[K,V], lev: Int)Unit" id="136724">clean</a><span class="delimiter">(</span><a title="scala.collection.concurrent.INode[K,V]" id="137237">nd</a>: <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="137238">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="Int" id="137239">lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="138254">m</a> = <a href="#137237" title="scala.collection.concurrent.INode[K,V]">nd</a>.<a href="#136714" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#137238" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
    <a href="#138254" title="scala.collection.concurrent.MainNode[K,V]">m</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1440104" title="Unit" id="1440105">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="#137237" title="scala.collection.concurrent.INode[K,V]">nd</a>.<a href="#136716" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><a href="#1440107" title="(x: Unit)Unit" class="delimiter">(</a>cn, cn.<a href="#137014" title="(ct: scala.collection.concurrent.TrieMap[K,V], lev: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.MainNode[K,V]">toCompressed</a><span class="delimiter">(</span><a href="#137238" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>, <a href="#137239" title="Int">lev</a>, <a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>, <a href="#137238" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt;
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(ct: scala.collection.concurrent.TrieMap[K,V])Boolean" id="136725">isNullInode</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TrieMap[K,V]" id="138298">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#136714" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#138298" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">def</span> <a title="(ct: scala.collection.concurrent.TrieMap[K,V])Int" id="136726">cachedSize</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TrieMap[K,V]" id="138299">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Int.scala.html#321" title="Int">Int</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="138300">m</a> = <a href="#136714" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#138299" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
    <a href="#138300" title="scala.collection.concurrent.MainNode[K,V]">m</a>.<a href="MainNode.java.html#136734" title="(ct: Any)Int">cachedSize</a><span class="delimiter">(</span><a href="#138299" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /* this is a quiescent method! */
  <span class="keyword">def</span> <a title="(lev: Int)String" id="136727">string</a><span class="delimiter">(</span><a title="Int" id="138302">lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a><span class="delimiter">)</span> = <a href="../../Predef.scala.html#7314" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%sINode -&gt; %s&quot;</a>.<a href="../immutable/StringLike.scala.html#29203" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="../../Predef.scala.html#7314" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;  &quot;</a> <a href="../immutable/StringLike.scala.html#29173" title="(n: Int)String">*</a> <a href="#138302" title="Int">lev</a>, <a href="INodeBase.java.html#136700" title="scala.collection.concurrent.MainNode[K,V]">mainnode</a> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#1440112" title="Any" id="1440121" class="keyword">null</a> =&gt; <a href="#1440126" title="(x: Any)Any" class="string">&quot;&lt;null&gt;&quot;</a>
    <span class="keyword">case</span> <a href="#1440112" title="Any" id="1440122">tn</a>: TNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt; <a href="../../Predef.scala.html#7314" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;TNode(%s, %s, %d, !)&quot;</a>.<a href="../immutable/StringLike.scala.html#29203" title="(args: Any*)String">format</a><a href="#1440126" title="(x: Any)Any" class="delimiter">(</a>tn.<a href="#138397" title="=&gt; _">k</a>, tn.<a href="#138398" title="=&gt; _">v</a>, tn.<a href="#138399" title="=&gt; Int">hc</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#1440112" title="Any" id="1440123">cn</a>: CNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt; cn.<a href="#137015" title="(lev: Int)String">string</a><a href="#1440126" title="(x: Any)Any" class="delimiter">(</a><a href="#138302" title="Int">lev</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#1440112" title="Any" id="1440124">ln</a>: LNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt; ln.<a href="#137255" title="(lev: Int)String">string</a><a href="#1440126" title="(x: Any)Any" class="delimiter">(</a><a href="#138302" title="Int">lev</a><span class="delimiter">)</span>
    <span class="keyword">case</span> x =&gt; <a href="../../Predef.scala.html#7314" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&lt;elem: %s&gt;&quot;</a>.<a href="../immutable/StringLike.scala.html#29203" title="(args: Any*)String">format</a><a href="#1440126" title="(x: Any)Any" class="delimiter">(</a>x<span class="delimiter">)</span>
  <span class="delimiter">}</span><span class="delimiter">)</span>

<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">object</span> <a title="scala.collection.concurrent.INode.type" id="9127">INode</a> <a href="#9128" title="scala.collection.concurrent.INode.type" class="delimiter">{</a>
  <span class="keyword">val</span> <a title="Object" id="137825">KEY_PRESENT</a> = <span title="Object" class="keyword">new</span> <span title="Object">AnyRef</span>
  <span class="keyword">val</span> <a title="Object" id="137827">KEY_ABSENT</a> = <span title="Object" class="keyword">new</span> <span title="Object">AnyRef</span>

  <span class="keyword">def</span> <a title="[K, V]=&gt; scala.collection.concurrent.INode[K,V]" id="137829">newRootNode</a><span class="delimiter">[</span><a title="" id="137832">K</a>, <a title="" id="137833">V</a><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.Gen" id="138354">gen</a> = <span title="scala.collection.concurrent.Gen" class="keyword">new</span> <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="138355">cn</a> = <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#9132" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <span title="Array[scala.collection.concurrent.BasicNode]" class="keyword">new</span> <a href="../../Array.scala.html#174" title="Array[scala.collection.concurrent.BasicNode]">Array</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a href="#138354" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
    <span title="scala.collection.concurrent.INode[K,V]" class="keyword">new</span> <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#138355" title="scala.collection.concurrent.CNode[K,V]">cn</a>, <a href="#138354" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


<span title="Object" class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class FailedNode[K, V] extends scala.collection.concurrent.MainNode[K,V]" id="9105">FailedNode</a><span class="delimiter">[</span><a title="" id="9205">K</a>, <a title="" id="9206">V</a><span class="delimiter">]</span><a href="#9105" title="scala.collection.concurrent.FailedNode[K,V]" class="delimiter">(</a><a title="scala.collection.concurrent.MainNode[K,V]" id="136952">p</a>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> <span class="delimiter">{</span>
  <a href="MainNode.java.html#136736" title="(nval: scala.collection.concurrent.MainNode[K,V])Unit">WRITE_PREV</a><span class="delimiter">(</span><a href="#136952" title="scala.collection.concurrent.MainNode[K,V]">p</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(lev: Int)Nothing" id="136929">string</a><span class="delimiter">(</span><a title="Int" id="138364">lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a><span class="delimiter">)</span> = <span title="Nothing" class="keyword">throw</span> <span title="UnsupportedOperationException" class="keyword">new</span> <a href="../../package.scala.html#22178" title="UnsupportedOperationException">UnsupportedOperationException</a>

  <span class="keyword">def</span> <a title="(ct: AnyRef)Int" id="136930">cachedSize</a><span class="delimiter">(</span><a title="AnyRef" id="138367">ct</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <a href="../../Int.scala.html#321" title="Int">Int</a> = <span title="Nothing" class="keyword">throw</span> <span title="UnsupportedOperationException" class="keyword">new</span> <a href="../../package.scala.html#22178" title="UnsupportedOperationException">UnsupportedOperationException</a>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="136931">toString</a> = <a href="../../Predef.scala.html#7314" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;FailedNode(%s)&quot;</a>.<a href="../immutable/StringLike.scala.html#29203" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#136952" title="scala.collection.concurrent.MainNode[K,V]">p</a><span class="delimiter">)</span>
<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait KVNode[K, V] extends Object" id="9141">KVNode</a><span class="delimiter">[</span><a title="" id="9207">K</a>, <a title="" id="9208">V</a><span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; (K, V)" id="137110">kvPair</a>: <a href="../../Tuple2.scala.html#783" title="(K, V)" class="delimiter">(</a>K, V<span class="delimiter">)</span>
<span class="delimiter">}</span>


<span title="Object" class="keyword">private</span><span class="delimiter">[</span>collection<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class SNode[K, V] extends scala.collection.concurrent.BasicNode with scala.collection.concurrent.KVNode[K,V]" id="9114">SNode</a><span class="delimiter">[</span><a title="" id="9209">K</a>, <a title="" id="9210">V</a><span class="delimiter">]</span><a href="#9114" title="scala.collection.concurrent.SNode[K,V]" class="delimiter">(</a><span class="keyword">final</span> <span class="keyword">val</span> <a title="K" id="137128">k</a>: <a href="#9209" title="K">K</a>, <span class="keyword">final</span> <span class="keyword">val</span> <a title="V" id="137129">v</a>: <a href="#9210" title="V">V</a>, <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int" id="137130">hc</a>: <a href="../../Int.scala.html#321" title="Int">Int</a><span class="delimiter">)</span>
<span class="keyword">extends</span> <a href="BasicNode.java.html#9165" title="scala.collection.concurrent.BasicNode">BasicNode</a> <span class="keyword">with</span> <a href="#9141" title="scala.collection.concurrent.KVNode[K,V]">KVNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.SNode[K,V]" id="137105">copy</a> = <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#9114" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#137128" title="=&gt; K">k</a>, <a href="#137129" title="=&gt; V">v</a>, <a href="#137130" title="=&gt; Int">hc</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.TNode[K,V]" id="137106">copyTombed</a> = <span title="scala.collection.concurrent.TNode[K,V]" class="keyword">new</span> <a href="#9150" title="scala.collection.concurrent.TNode[K,V]">TNode</a><span class="delimiter">(</span><a href="#137128" title="=&gt; K">k</a>, <a href="#137129" title="=&gt; V">v</a>, <a href="#137130" title="=&gt; Int">hc</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.SNode[K,V]" id="137107">copyUntombed</a> = <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#9114" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#137128" title="=&gt; K">k</a>, <a href="#137129" title="=&gt; V">v</a>, <a href="#137130" title="=&gt; Int">hc</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; (K, V)" id="137108">kvPair</a> = <a href="../../Tuple2.scala.html#32170" title="(_1: K, _2: V)(K, V)" class="delimiter">(</a><a href="#137128" title="=&gt; K">k</a>, <a href="#137129" title="=&gt; V">v</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(lev: Int)String" id="137109">string</a><span class="delimiter">(</span><a title="Int" id="138426">lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="../../Predef.scala.html#7314" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;  &quot;</a> <a href="../immutable/StringLike.scala.html#29173" title="(n: Int)String">*</a> <a href="#138426" title="Int">lev</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <a href="../../Predef.scala.html#7314" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;SNode(%s, %s, %x)&quot;</a>.<a href="../immutable/StringLike.scala.html#29203" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#137128" title="=&gt; K">k</a>, <a href="#137129" title="=&gt; V">v</a>, <a href="#137130" title="=&gt; Int">hc</a><span class="delimiter">)</span>
<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>collection<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class TNode[K, V] extends scala.collection.concurrent.MainNode[K,V] with scala.collection.concurrent.KVNode[K,V]" id="9150">TNode</a><span class="delimiter">[</span><a title="" id="9211">K</a>, <a title="" id="9212">V</a><span class="delimiter">]</span><a href="#9150" title="scala.collection.concurrent.TNode[K,V]" class="delimiter">(</a><span class="keyword">final</span> <span class="keyword">val</span> <a title="K" id="138397">k</a>: <a href="#9211" title="K">K</a>, <span class="keyword">final</span> <span class="keyword">val</span> <a title="V" id="138398">v</a>: <a href="#9212" title="V">V</a>, <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int" id="138399">hc</a>: <a href="../../Int.scala.html#321" title="Int">Int</a><span class="delimiter">)</span>
<span class="keyword">extends</span> <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#9141" title="scala.collection.concurrent.KVNode[K,V]">KVNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.TNode[K,V]" id="137229">copy</a> = <span title="scala.collection.concurrent.TNode[K,V]" class="keyword">new</span> <a href="#9150" title="scala.collection.concurrent.TNode[K,V]">TNode</a><span class="delimiter">(</span><a href="#138397" title="=&gt; K">k</a>, <a href="#138398" title="=&gt; V">v</a>, <a href="#138399" title="=&gt; Int">hc</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.TNode[K,V]" id="137230">copyTombed</a> = <span title="scala.collection.concurrent.TNode[K,V]" class="keyword">new</span> <a href="#9150" title="scala.collection.concurrent.TNode[K,V]">TNode</a><span class="delimiter">(</span><a href="#138397" title="=&gt; K">k</a>, <a href="#138398" title="=&gt; V">v</a>, <a href="#138399" title="=&gt; Int">hc</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.SNode[K,V]" id="137231">copyUntombed</a> = <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#9114" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#138397" title="=&gt; K">k</a>, <a href="#138398" title="=&gt; V">v</a>, <a href="#138399" title="=&gt; Int">hc</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; (K, V)" id="137232">kvPair</a> = <a href="../../Tuple2.scala.html#32170" title="(_1: K, _2: V)(K, V)" class="delimiter">(</a><a href="#138397" title="=&gt; K">k</a>, <a href="#138398" title="=&gt; V">v</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(ct: AnyRef)Int" id="137233">cachedSize</a><span class="delimiter">(</span><a title="AnyRef" id="138470">ct</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <a href="../../Int.scala.html#321" title="Int">Int</a> = <span title="Int(1)" class="int">1</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(lev: Int)String" id="137234">string</a><span class="delimiter">(</span><a title="Int" id="138472">lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="../../Predef.scala.html#7314" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;  &quot;</a> <a href="../immutable/StringLike.scala.html#29173" title="(n: Int)String">*</a> <a href="#138472" title="Int">lev</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <a href="../../Predef.scala.html#7314" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;TNode(%s, %s, %x, !)&quot;</a>.<a href="../immutable/StringLike.scala.html#29203" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#138397" title="=&gt; K">k</a>, <a href="#138398" title="=&gt; V">v</a>, <a href="#138399" title="=&gt; Int">hc</a><span class="delimiter">)</span>
<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>collection<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class LNode[K, V] extends scala.collection.concurrent.MainNode[K,V]" id="9087">LNode</a><span class="delimiter">[</span><a title="" id="9213">K</a>, <a title="" id="9214">V</a><span class="delimiter">]</span><a href="#9087" title="scala.collection.concurrent.LNode[K,V]" class="delimiter">(</a><span class="keyword">final</span> <span class="keyword">val</span> <a title="scala.collection.immutable.ListMap[K,V]" id="137277">listmap</a>: <a href="../immutable/ListMap.scala.html#10831" title="scala.collection.immutable.ListMap[K,V]">ImmutableListMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>
<span class="keyword">extends</span> <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(k: K, v: V)scala.collection.concurrent.LNode[K,V]" id="137249" class="keyword">this</a><span class="delimiter">(</span><a title="K" id="137273">k</a>: <a href="#9213" title="K">K</a>, <a title="V" id="137274">v</a>: <a href="#9214" title="V">V</a><span class="delimiter">)</span> = <a href="#9087" title="LNode.this.type" class="keyword">this</a><span class="delimiter">(</span><a href="../generic/GenMapFactory.scala.html#30065" title="(elems: (K, V)*)scala.collection.immutable.ListMap[K,V]">ImmutableListMap</a><span class="delimiter">(</span><a href="../../Predef.scala.html#7219" title="(x: K)ArrowAssoc[K]">k</a> <a href="../../Predef.scala.html#31955" title="(y: V)(K, V)">-&gt;</a> <a href="#137274" title="V">v</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(k1: K, v1: V, k2: K, v2: V)scala.collection.concurrent.LNode[K,V]" id="137250" class="keyword">this</a><span class="delimiter">(</span><a title="K" id="137265">k1</a>: <a href="#9213" title="K">K</a>, <a title="V" id="137266">v1</a>: <a href="#9214" title="V">V</a>, <a title="K" id="137267">k2</a>: <a href="#9213" title="K">K</a>, <a title="V" id="137268">v2</a>: <a href="#9214" title="V">V</a><span class="delimiter">)</span> = <a href="#9087" title="LNode.this.type" class="keyword">this</a><span class="delimiter">(</span><a href="../generic/GenMapFactory.scala.html#30065" title="(elems: (K, V)*)scala.collection.immutable.ListMap[K,V]">ImmutableListMap</a><span class="delimiter">(</span><a href="../../Predef.scala.html#7219" title="(x: K)ArrowAssoc[K]">k1</a> <a href="../../Predef.scala.html#31955" title="(y: V)(K, V)">-&gt;</a> <a href="#137266" title="V">v1</a>, <a href="../../Predef.scala.html#7219" title="(x: K)ArrowAssoc[K]">k2</a> <a href="../../Predef.scala.html#31955" title="(y: V)(K, V)">-&gt;</a> <a href="#137268" title="V">v2</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(k: K, v: V)scala.collection.concurrent.LNode[K,V]" id="137251">inserted</a><span class="delimiter">(</span><a title="K" id="137259">k</a>: <a href="#9213" title="K">K</a>, <a title="V" id="137260">v</a>: <a href="#9214" title="V">V</a><span class="delimiter">)</span> = <span title="scala.collection.concurrent.LNode[K,V]" class="keyword">new</span> <a href="#9087" title="scala.collection.concurrent.LNode[K,V]">LNode</a><span class="delimiter">(</span><a href="#137277" title="=&gt; scala.collection.immutable.ListMap[K,V]">listmap</a> <a href="../immutable/ListMap.scala.html#137287" title="(kv: (K, V))scala.collection.immutable.ListMap[K,V]">+</a> <span class="delimiter">(</span><a href="../../Tuple2.scala.html#32170" title="(_1: K, _2: V)(K, V)" class="delimiter">(</a><a href="#137259" title="K">k</a>, <a href="#137260" title="V">v</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(k: K, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]" id="137252">removed</a><span class="delimiter">(</span><a title="K" id="138246">k</a>: <a href="#9213" title="K">K</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="138247">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.ListMap[K,V]" id="138569">updmap</a> = <a href="#137277" title="=&gt; scala.collection.immutable.ListMap[K,V]">listmap</a> <a href="../immutable/ListMap.scala.html#137296" title="(key: K)scala.collection.immutable.ListMap[K,V]">-</a> <a href="#138246" title="K">k</a>
    <span title="scala.collection.concurrent.MainNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#138569" title="scala.collection.immutable.ListMap[K,V]">updmap</a>.<a href="../immutable/ListMap.scala.html#137282" title="=&gt; Int">size</a> <a href="../../Int.scala.html#26449" title="(x: Int)Boolean">&gt;</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="scala.collection.concurrent.LNode[K,V]" class="keyword">new</span> <a href="#9087" title="scala.collection.concurrent.LNode[K,V]">LNode</a><span class="delimiter">(</span><a href="#138569" title="scala.collection.immutable.ListMap[K,V]">updmap</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a href="#1440139" title="(x: (K, V))(K, V)" class="delimiter">(</a><a href="../../Tuple2.scala.html#29956" title="K" id="138619">k</a>, <a href="../../Tuple2.scala.html#29958" title="V" id="138620">v</a><span class="delimiter">)</span> = <a href="#138569" title="scala.collection.immutable.ListMap[K,V]">updmap</a>.<a href="../immutable/ListMap.scala.html#137297" title="=&gt; Iterator[(K, V)]">iterator</a>.<a href="../Iterator.scala.html#36069" title="()(K, V)">next</a>
      <span title="scala.collection.concurrent.TNode[K,V]" class="keyword">new</span> <a href="#9150" title="scala.collection.concurrent.TNode[K,V]">TNode</a><span class="delimiter">(</span><a href="#138619" title="K">k</a>, <a href="#138620" title="V">v</a>, <a href="#138247" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>.<a href="#136876" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#138619" title="K">k</a><span class="delimiter">)</span><span class="delimiter">)</span> // create it tombed so that it gets compressed on subsequent accesses
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(k: K)Option[V]" id="137253">get</a><span class="delimiter">(</span><a title="K" id="137926">k</a>: <a href="#9213" title="K">K</a><span class="delimiter">)</span> = <a href="#137277" title="=&gt; scala.collection.immutable.ListMap[K,V]">listmap</a>.<a href="../immutable/ListMap.scala.html#137283" title="(key: K)Option[V]">get</a><span class="delimiter">(</span><a href="#137926" title="K">k</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(ct: AnyRef)Int" id="137254">cachedSize</a><span class="delimiter">(</span><a title="AnyRef" id="138683">ct</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <a href="../../Int.scala.html#321" title="Int">Int</a> = <a href="#137277" title="=&gt; scala.collection.immutable.ListMap[K,V]">listmap</a>.<a href="../immutable/ListMap.scala.html#137282" title="=&gt; Int">size</a>
  <span class="keyword">def</span> <a title="(lev: Int)String" id="137255">string</a><span class="delimiter">(</span><a title="Int" id="138339">lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="../../Predef.scala.html#7314" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot; &quot;</a> <a href="../immutable/StringLike.scala.html#29173" title="(n: Int)String">*</a> <a href="#138339" title="Int">lev</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <a href="../../Predef.scala.html#7314" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;LNode(%s)&quot;</a>.<a href="../immutable/StringLike.scala.html#29203" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#137277" title="=&gt; scala.collection.immutable.ListMap[K,V]">listmap</a>.<a href="../TraversableOnce.scala.html#27607" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>collection<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class CNode[K, V] extends scala.collection.concurrent.CNodeBase[K,V]" id="9132">CNode</a><span class="delimiter">[</span><a title="" id="9215">K</a>, <a title="" id="9216">V</a><span class="delimiter">]</span><a href="#9132" title="scala.collection.concurrent.CNode[K,V]" class="delimiter">(</a><span class="keyword">val</span> <a title="Int" id="137089">bitmap</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="137090">array</a>: <a href="../../Array.scala.html#174" title="Array[scala.collection.concurrent.BasicNode]">Array</a><span class="delimiter">[</span>BasicNode<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="scala.collection.concurrent.Gen" id="137091">gen</a>: <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="CNodeBase.java.html#9138" title="scala.collection.concurrent.CNodeBase[K,V]">CNodeBase</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> <span class="delimiter">{</span>
  // this should only be called from within read-only snapshots
  <span class="keyword">def</span> <a title="(ct: AnyRef)Int" id="137006">cachedSize</a><span class="delimiter">(</span><a title="AnyRef" id="138688">ct</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="138689">currsz</a> = <a href="CNodeBase.java.html#136995" title="()Int">READ_SIZE</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#138689" title="Int">currsz</a> <a href="../../Int.scala.html#26428" title="(x: Int)Boolean">!=</a> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <a href="#138689" title="Int">currsz</a>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="138694">sz</a> = <a href="#137007" title="(ct: scala.collection.concurrent.TrieMap[K,V])Int">computeSize</a><span class="delimiter">(</span><a href="#138688" title="AnyRef">ct</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.collection.concurrent.TrieMap[K,V]" class="delimiter">[</span><a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="CNodeBase.java.html#136995" title="()Int">READ_SIZE</a><span class="delimiter">(</span><span class="delimiter">)</span> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <a href="CNodeBase.java.html#136993" title="(oldval: Int, nval: Int)Boolean">CAS_SIZE</a><a href="#138695" title="()Unit" class="delimiter">(</a>-<span title="Int(-1)" class="int">1</span>, <a href="#138694" title="Int">sz</a><span class="delimiter">)</span>
      <a href="CNodeBase.java.html#136995" title="()Int">READ_SIZE</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  // lends itself towards being parallelizable by choosing
  // a random starting offset in the array
  // =&gt; if there are concurrent size computations, they start
  //    at different positions, so they are more likely to
  //    to be independent
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(ct: scala.collection.concurrent.TrieMap[K,V])Int" id="137007">computeSize</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TrieMap[K,V]" id="138696">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Int.scala.html#321" title="Int">Int</a> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="138704">i</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">var</span> <a title="Int" id="138705">sz</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">val</span> <a title="Int" id="138706">offset</a> =
      <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#137090" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>.<a href="../../Array.scala.html#25962" title="=&gt; Int">length</a> <a href="../../Int.scala.html#26449" title="(x: Int)Boolean">&gt;</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        //util.Random.nextInt(array.length) /* &lt;-- benchmarks show that this causes observable contention */
        scala.concurrent.forkjoin.<span title="scala.concurrent.forkjoin.ThreadLocalRandom.type">ThreadLocalRandom</span>.<span title="()scala.concurrent.forkjoin.ThreadLocalRandom">current</span>.<span title="(x$1: Int, x$2: Int)Int">nextInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#137090" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>.<a href="../../Array.scala.html#25962" title="=&gt; Int">length</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="Int(0)" class="int">0</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#138704" title="Int">i</a> <a href="../../Int.scala.html#26435" title="(x: Int)Boolean">&lt;</a> <a href="#137090" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>.<a href="../../Array.scala.html#25962" title="=&gt; Int">length</a><span class="delimiter">)</span> <a href="#138707" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="Int" id="138759">pos</a> = <span class="delimiter">(</span><a href="#138704" title="Int">i</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <a href="#138706" title="Int">offset</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26506" title="(x: Int)Int">%</a> <a href="#137090" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>.<a href="../../Array.scala.html#25962" title="=&gt; Int">length</a>
      <a href="../../Array.scala.html#25963" title="(i: Int)scala.collection.concurrent.BasicNode">array</a><a href="#1440145" title="scala.collection.concurrent.INode[K,V]" class="delimiter">(</a><a href="#138759" title="Int">pos</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#1440143" title="Unit" id="1440144">sn</a>: SNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt; <a href="#138705" title="Int">sz</a> <a href="#1440147" title="(x: Unit)Unit">+=</a> <span title="Int(1)" class="int">1</span>
        <span class="keyword">case</span> <a href="#1440143" title="Unit" id="1440145">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="#138705" title="Int">sz</a> <a href="#1440147" title="(x: Unit)Unit">+=</a> in.<a href="#136726" title="(ct: scala.collection.concurrent.TrieMap[K,V])Int">cachedSize</a><span class="delimiter">(</span><a href="#138696" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#138704" title="Int">i</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>
    <a href="#138705" title="Int">sz</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]" id="137008">updatedAt</a><span class="delimiter">(</span><a title="Int" id="137119">pos</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="scala.collection.concurrent.BasicNode" id="137120">nn</a>: <a href="BasicNode.java.html#9165" title="scala.collection.concurrent.BasicNode">BasicNode</a>, <a title="scala.collection.concurrent.Gen" id="137121">gen</a>: <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="137122">len</a> = <a href="#137090" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>.<a href="../../Array.scala.html#25962" title="=&gt; Int">length</a>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="137123">narr</a> = <span title="Array[scala.collection.concurrent.BasicNode]" class="keyword">new</span> <a href="../../Array.scala.html#174" title="Array[scala.collection.concurrent.BasicNode]">Array</a><span class="delimiter">[</span>BasicNode<span class="delimiter">]</span><span class="delimiter">(</span><a href="#137122" title="Int">len</a><span class="delimiter">)</span>
    <a href="../../Array.scala.html#175" title="Array.type">Array</a>.<a href="../../Array.scala.html#41577" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#137090" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>, <span title="Int(0)" class="int">0</span>, <a href="#137123" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <span title="Int(0)" class="int">0</span>, <a href="#137122" title="Int">len</a><span class="delimiter">)</span>
    <a href="../../Array.scala.html#25964" title="(i: Int, x: scala.collection.concurrent.BasicNode)Unit">narr</a><span class="delimiter">(</span><a href="#137119" title="Int">pos</a><span class="delimiter">)</span> = <a href="#137120" title="scala.collection.concurrent.BasicNode">nn</a>
    <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#9132" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#137089" title="=&gt; Int">bitmap</a>, <a href="#137123" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <a href="#137121" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(pos: Int, flag: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]" id="137009">removedAt</a><span class="delimiter">(</span><a title="Int" id="138106">pos</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="Int" id="138107">flag</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="scala.collection.concurrent.Gen" id="138108">gen</a>: <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="138109">arr</a> = <a href="#137090" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>
    <span class="keyword">val</span> <a title="Int" id="138110">len</a> = <a href="#138109" title="Array[scala.collection.concurrent.BasicNode]">arr</a>.<a href="../../Array.scala.html#25962" title="=&gt; Int">length</a>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="138111">narr</a> = <span title="Array[scala.collection.concurrent.BasicNode]" class="keyword">new</span> <a href="../../Array.scala.html#174" title="Array[scala.collection.concurrent.BasicNode]">Array</a><span class="delimiter">[</span>BasicNode<span class="delimiter">]</span><span class="delimiter">(</span><a href="#138110" title="Int">len</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <a href="../../Array.scala.html#175" title="Array.type">Array</a>.<a href="../../Array.scala.html#41577" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#138109" title="Array[scala.collection.concurrent.BasicNode]">arr</a>, <span title="Int(0)" class="int">0</span>, <a href="#138111" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <span title="Int(0)" class="int">0</span>, <a href="#138106" title="Int">pos</a><span class="delimiter">)</span>
    <a href="../../Array.scala.html#175" title="Array.type">Array</a>.<a href="../../Array.scala.html#41577" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#138109" title="Array[scala.collection.concurrent.BasicNode]">arr</a>, <a href="#138106" title="Int">pos</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span>, <a href="#138111" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <a href="#138106" title="Int">pos</a>, <a href="#138110" title="Int">len</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <a href="#138106" title="Int">pos</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#9132" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#137089" title="=&gt; Int">bitmap</a> <a href="../../Int.scala.html#26473" title="(x: Int)Int">^</a> <a href="#138107" title="Int">flag</a>, <a href="#138111" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <a href="#138108" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(pos: Int, flag: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]" id="137010">insertedAt</a><span class="delimiter">(</span><a title="Int" id="137185">pos</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="Int" id="137186">flag</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="scala.collection.concurrent.BasicNode" id="137187">nn</a>: <a href="BasicNode.java.html#9165" title="scala.collection.concurrent.BasicNode">BasicNode</a>, <a title="scala.collection.concurrent.Gen" id="137188">gen</a>: <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="137189">len</a> = <a href="#137090" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>.<a href="../../Array.scala.html#25962" title="=&gt; Int">length</a>
    <span class="keyword">val</span> <a title="Int" id="137190">bmp</a> = <a href="#137089" title="=&gt; Int">bitmap</a>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="137191">narr</a> = <span title="Array[scala.collection.concurrent.BasicNode]" class="keyword">new</span> <a href="../../Array.scala.html#174" title="Array[scala.collection.concurrent.BasicNode]">Array</a><span class="delimiter">[</span>BasicNode<span class="delimiter">]</span><span class="delimiter">(</span><a href="#137189" title="Int">len</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <a href="../../Array.scala.html#175" title="Array.type">Array</a>.<a href="../../Array.scala.html#41577" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#137090" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>, <span title="Int(0)" class="int">0</span>, <a href="#137191" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <span title="Int(0)" class="int">0</span>, <a href="#137185" title="Int">pos</a><span class="delimiter">)</span>
    <a href="../../Array.scala.html#25964" title="(i: Int, x: scala.collection.concurrent.BasicNode)Unit">narr</a><span class="delimiter">(</span><a href="#137185" title="Int">pos</a><span class="delimiter">)</span> = <a href="#137187" title="scala.collection.concurrent.BasicNode">nn</a>
    <a href="../../Array.scala.html#175" title="Array.type">Array</a>.<a href="../../Array.scala.html#41577" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#137090" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>, <a href="#137185" title="Int">pos</a>, <a href="#137191" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <a href="#137185" title="Int">pos</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span>, <a href="#137189" title="Int">len</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <a href="#137185" title="Int">pos</a><span class="delimiter">)</span>
    <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#9132" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#137190" title="Int">bmp</a> <a href="../../Int.scala.html#26463" title="(x: Int)Int">|</a> <a href="#137186" title="Int">flag</a>, <a href="#137191" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <a href="#137188" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** Returns a copy of this cnode such that all the i-nodes below it are copied
   *  to the specified generation `ngen`.
   */
  <span class="keyword">def</span> <a title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]" id="137011">renewed</a><span class="delimiter">(</span><a title="scala.collection.concurrent.Gen" id="137062">ngen</a>: <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="137063">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="137064">i</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="137065">arr</a> = <a href="#137090" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>
    <span class="keyword">val</span> <a title="Int" id="137066">len</a> = <a href="#137065" title="Array[scala.collection.concurrent.BasicNode]">arr</a>.<a href="../../Array.scala.html#25962" title="=&gt; Int">length</a>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="137067">narr</a> = <span title="Array[scala.collection.concurrent.BasicNode]" class="keyword">new</span> <a href="../../Array.scala.html#174" title="Array[scala.collection.concurrent.BasicNode]">Array</a><span class="delimiter">[</span>BasicNode<span class="delimiter">]</span><span class="delimiter">(</span><a href="#137066" title="Int">len</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#137064" title="Int">i</a> <a href="../../Int.scala.html#26435" title="(x: Int)Boolean">&lt;</a> <a href="#137066" title="Int">len</a><span class="delimiter">)</span> <a href="#137068" title="()Unit" class="delimiter">{</a>
      <a href="../../Array.scala.html#25963" title="(i: Int)scala.collection.concurrent.BasicNode">arr</a><a href="#1440153" title="scala.collection.concurrent.INode[K,V]" class="delimiter">(</a><a href="#137064" title="Int">i</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#1440152" title="Unit" id="1440153">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="../../Array.scala.html#25964" title="(i: Int, x: scala.collection.concurrent.BasicNode)Unit">narr</a><span class="delimiter">(</span><a href="#137064" title="Int">i</a><span class="delimiter">)</span> = in.<a href="#136719" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.INode[K,V]">copyToGen</a><span class="delimiter">(</span><a href="#137062" title="scala.collection.concurrent.Gen">ngen</a>, <a href="#137063" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#1440152" title="Unit" id="1440154">bn</a>: BasicNode =&gt; <a href="../../Array.scala.html#25964" title="(i: Int, x: scala.collection.concurrent.BasicNode)Unit">narr</a><span class="delimiter">(</span><a href="#137064" title="Int">i</a><span class="delimiter">)</span> = bn
      <span class="delimiter">}</span>
      <a href="#137064" title="Int">i</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>
    <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#9132" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#137089" title="=&gt; Int">bitmap</a>, <a href="#137067" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <a href="#137062" title="scala.collection.concurrent.Gen">ngen</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(inode: scala.collection.concurrent.INode[K,V], inodemain: AnyRef)scala.collection.concurrent.BasicNode" id="137012">resurrect</a><span class="delimiter">(</span><a title="scala.collection.concurrent.INode[K,V]" id="138282">inode</a>: <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="AnyRef" id="138283">inodemain</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <a href="BasicNode.java.html#9165" title="scala.collection.concurrent.BasicNode">BasicNode</a> = <a href="#138283" title="AnyRef">inodemain</a> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#1440161" title="scala.collection.concurrent.BasicNode" id="1440162">tn</a>: TNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt; tn.<a href="#1440164" title="(x: scala.collection.concurrent.BasicNode)scala.collection.concurrent.BasicNode">copyUntombed</a>
    <span class="keyword">case</span> _ =&gt; <a href="#1440164" title="(x: scala.collection.concurrent.BasicNode)scala.collection.concurrent.BasicNode">inode</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(lev: Int)scala.collection.concurrent.MainNode[K,V]" id="137013">toContracted</a><span class="delimiter">(</span><a title="Int" id="138132">lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a><span class="delimiter">)</span>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span title="scala.collection.concurrent.MainNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#137090" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>.<a href="../../Array.scala.html#25962" title="=&gt; Int">length</a> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> <span title="Int(1)" class="int">1</span> <a href="../../Boolean.scala.html#27150" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#138132" title="Int">lev</a> <a href="../../Int.scala.html#26449" title="(x: Int)Boolean">&gt;</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="../../Array.scala.html#25963" title="(i: Int)scala.collection.concurrent.BasicNode">array</a><a href="#1440170" title="scala.collection.concurrent.SNode[K,V]" class="delimiter">(</a><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#1440169" title="scala.collection.concurrent.MainNode[K,V]" id="1440170">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; sn.<a href="#1440172" title="(x: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.MainNode[K,V]">copyTombed</a>
    <span class="keyword">case</span> _ =&gt; <a href="#1440172" title="(x: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.MainNode[K,V]" class="keyword">this</a>
  <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#9132" title="scala.collection.concurrent.CNode[K,V]" class="keyword">this</a>

  // - if the branching factor is 1 for this CNode, and the child
  //   is a tombed SNode, returns its tombed version
  // - otherwise, if there is at least one non-null node below,
  //   returns the version of this node with at least some null-inodes
  //   removed (those existing when the op began)
  // - if there are only null-i-nodes below, returns null
  <span class="keyword">def</span> <a title="(ct: scala.collection.concurrent.TrieMap[K,V], lev: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.MainNode[K,V]" id="137014">toCompressed</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TrieMap[K,V]" id="138258">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="Int" id="138259">lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="scala.collection.concurrent.Gen" id="138260">gen</a>: <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="138261">bmp</a> = <a href="#137089" title="=&gt; Int">bitmap</a>
    <span class="keyword">var</span> <a title="Int" id="138262">i</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="138263">arr</a> = <a href="#137090" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="138264">tmparray</a> = <span title="Array[scala.collection.concurrent.BasicNode]" class="keyword">new</span> <a href="../../Array.scala.html#174" title="Array[scala.collection.concurrent.BasicNode]">Array</a><span class="delimiter">[</span>BasicNode<span class="delimiter">]</span><span class="delimiter">(</span><a href="#138263" title="Array[scala.collection.concurrent.BasicNode]">arr</a>.<a href="../../Array.scala.html#25962" title="=&gt; Int">length</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#138262" title="Int">i</a> <a href="../../Int.scala.html#26435" title="(x: Int)Boolean">&lt;</a> <a href="#138263" title="Array[scala.collection.concurrent.BasicNode]">arr</a>.<a href="../../Array.scala.html#25962" title="=&gt; Int">length</a><span class="delimiter">)</span> <a href="#138265" title="()Unit" class="delimiter">{</a> // construct new bitmap
      <span class="keyword">val</span> <a title="scala.collection.concurrent.BasicNode" id="138270">sub</a> = <a href="../../Array.scala.html#25963" title="(i: Int)scala.collection.concurrent.BasicNode">arr</a><span class="delimiter">(</span><a href="#138262" title="Int">i</a><span class="delimiter">)</span>
      <a href="#138270" title="scala.collection.concurrent.BasicNode">sub</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#1440177" title="Unit" id="1440178">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
          <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="138276">inodemain</a> = in.<a href="#136713" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">gcasRead</a><span class="delimiter">(</span><a href="#138258" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
          <a href="../../Predef.scala.html#7194" title="(assertion: Boolean)Unit">assert</a><span class="delimiter">(</span><a href="#138276" title="scala.collection.concurrent.MainNode[K,V]">inodemain</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
          <a href="../../Array.scala.html#25964" title="(i: Int, x: scala.collection.concurrent.BasicNode)Unit">tmparray</a><span class="delimiter">(</span><a href="#138262" title="Int">i</a><span class="delimiter">)</span> = <a href="#137012" title="(inode: scala.collection.concurrent.INode[K,V], inodemain: AnyRef)scala.collection.concurrent.BasicNode">resurrect</a><span class="delimiter">(</span>in, <a href="#138276" title="scala.collection.concurrent.MainNode[K,V]">inodemain</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#1440177" title="Unit" id="1440179">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
          <a href="../../Array.scala.html#25964" title="(i: Int, x: scala.collection.concurrent.BasicNode)Unit">tmparray</a><span class="delimiter">(</span><a href="#138262" title="Int">i</a><span class="delimiter">)</span> = sn
      <span class="delimiter">}</span>
      <a href="#138262" title="Int">i</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>

    <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#9132" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#138261" title="Int">bmp</a>, <a href="#138264" title="Array[scala.collection.concurrent.BasicNode]">tmparray</a>, <a href="#138260" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>.<a href="#137013" title="(lev: Int)scala.collection.concurrent.MainNode[K,V]">toContracted</a><span class="delimiter">(</span><a href="#138259" title="Int">lev</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(lev: Int)String" id="137015">string</a><span class="delimiter">(</span><a title="Int" id="138331">lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a><span class="delimiter">)</span>: <span title="String">String</span> = <a href="../../Predef.scala.html#7314" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;CNode %x\n%s&quot;</a>.<a href="../immutable/StringLike.scala.html#29203" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#137089" title="=&gt; Int">bitmap</a>, <a href="../../Predef.scala.html#7265" title="(xs: Array[scala.collection.concurrent.BasicNode])scala.collection.mutable.ArrayOps[scala.collection.concurrent.BasicNode]">array</a>.<a href="../TraversableLike.scala.html#27387" title="(f: scala.collection.concurrent.BasicNode =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Array[scala.collection.concurrent.BasicNode],String,Array[String]])Array[String]">map</a><a href="../../Predef.scala.html#7265" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</a><a href="#139206" title="scala.collection.concurrent.BasicNode">_</a>.<a href="BasicNode.java.html#136698" title="(lev: Int)String">string</a><span class="delimiter">(</span><a href="#138331" title="Int">lev</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../TraversableOnce.scala.html#27607" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

  /* quiescently consistent - don't call concurrently to anything involving a GCAS!! */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; Seq[(K, V)]" id="137016">collectElems</a>: <a href="../Seq.scala.html#4340" title="Seq[(K, V)]">Seq</a><span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span> = <a href="../../Predef.scala.html#7265" title="(xs: Array[scala.collection.concurrent.BasicNode])scala.collection.mutable.ArrayOps[scala.collection.concurrent.BasicNode]">array</a> <a href="../TraversableLike.scala.html#27392" title="(f: scala.collection.concurrent.BasicNode =&gt; scala.collection.GenTraversableOnce[(K, V)])(implicit bf: scala.collection.generic.CanBuildFrom[Array[scala.collection.concurrent.BasicNode],(K, V),Seq[(K, V)]])Seq[(K, V)]">flatMap</a> <a href="#139710" title="scala.collection.concurrent.BasicNode" class="delimiter">{</a>
    <span class="keyword">case</span> <a href="#1440197" title="Iterable[(K, V)]" id="1440198">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="../../Option.scala.html#32449" title="(x: (K, V))Some[(K, V)]">Some</a><a href="#1440201" title="(x: Iterable[(K, V)])Iterable[(K, V)]" class="delimiter">(</a>sn.<a href="#137108" title="=&gt; (K, V)">kvPair</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#1440197" title="Iterable[(K, V)]" id="1440199">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; in.<a href="#1440201" title="(x: Iterable[(K, V)])Iterable[(K, V)]">mainnode</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1440186" title="Iterable[(K, V)]" id="1440187">tn</a>: TNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="../../Option.scala.html#32449" title="(x: (K, V))Some[(K, V)]">Some</a><a href="#1440191" title="(x: Iterable[(K, V)])Iterable[(K, V)]" class="delimiter">(</a>tn.<a href="#137232" title="=&gt; (K, V)">kvPair</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#1440186" title="Iterable[(K, V)]" id="1440188">ln</a>: LNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; ln.<a href="#137277" title="=&gt; scala.collection.immutable.ListMap[K,V]">listmap</a>.<a href="#1440191" title="(x: Iterable[(K, V)])Iterable[(K, V)]">toList</a>
      <span class="keyword">case</span> <a href="#1440186" title="Iterable[(K, V)]" id="1440189">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; cn.<a href="#1440191" title="(x: Iterable[(K, V)])Iterable[(K, V)]">collectElems</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; Seq[String]" id="137017">collectLocalElems</a>: <a href="../Seq.scala.html#4340" title="Seq[String]">Seq</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="../../Predef.scala.html#7265" title="(xs: Array[scala.collection.concurrent.BasicNode])scala.collection.mutable.ArrayOps[scala.collection.concurrent.BasicNode]">array</a> <a href="../TraversableLike.scala.html#27392" title="(f: scala.collection.concurrent.BasicNode =&gt; scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[Array[scala.collection.concurrent.BasicNode],String,Seq[String]])Seq[String]">flatMap</a> <a href="#140172" title="scala.collection.concurrent.BasicNode" class="delimiter">{</a>
    <span class="keyword">case</span> <a href="#1440206" title="Iterable[String]" id="1440207">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="../../Option.scala.html#32449" title="(x: String)Some[String]">Some</a><a href="#1440210" title="(x: Iterable[String])Iterable[String]" class="delimiter">(</a>sn.<a href="#137108" title="=&gt; (K, V)">kvPair</a>.<a href="../../Tuple2.scala.html#29958" title="=&gt; V">_2</a>.<span title="()String">toString</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#1440206" title="Iterable[String]" id="1440208">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="../../Option.scala.html#32449" title="(x: String)Some[String]">Some</a><a href="#1440210" title="(x: Iterable[String])Iterable[String]" class="delimiter">(</a>in.<a href="../../Predef.scala.html#7314" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">toString</a>.<a href="../IndexedSeqOptimized.scala.html#28484" title="(n: Int)String">drop</a><span class="delimiter">(</span><span title="Int(14)" class="int">14</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot;(&quot;)" class="string">&quot;(&quot;</span> <span title="(x$1: Any)String">+</span> in.<a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="137018">toString</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[String]" id="140244">elems</a> = <a href="#137017" title="=&gt; Seq[String]">collectLocalElems</a>
    <a href="../../Predef.scala.html#7314" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;CNode(sz: %d; %s)&quot;</a>.<a href="../immutable/StringLike.scala.html#29203" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#140244" title="Seq[String]">elems</a>.<a href="../SeqLike.scala.html#28109" title="=&gt; Int">size</a>, <a href="#140244" title="Seq[String]">elems</a>.<a href="../SeqLike.scala.html#28193" title="(implicit ord: scala.math.Ordering[String])Seq[String]">sorted</a>.<a href="../TraversableOnce.scala.html#27607" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">object</span> <a title="scala.collection.concurrent.CNode.type" id="9133">CNode</a> <a href="#9134" title="scala.collection.concurrent.CNode.type" class="delimiter">{</a>

  <span class="keyword">def</span> <a title="[K, V](x: scala.collection.concurrent.SNode[K,V], xhc: Int, y: scala.collection.concurrent.SNode[K,V], yhc: Int, lev: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.MainNode[K,V]" id="137140">dual</a><span class="delimiter">[</span><a title="" id="137143">K</a>, <a title="" id="137144">V</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.collection.concurrent.SNode[K,V]" id="137145">x</a>: <a href="#9114" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="Int" id="137146">xhc</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="scala.collection.concurrent.SNode[K,V]" id="137147">y</a>: <a href="#9114" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="Int" id="137148">yhc</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="Int" id="137149">lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="scala.collection.concurrent.Gen" id="137150">gen</a>: <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span title="scala.collection.concurrent.MainNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#137149" title="Int">lev</a> <a href="../../Int.scala.html#26435" title="(x: Int)Boolean">&lt;</a> <span title="Int(35)" class="int">35</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="140314">xidx</a> = <span class="delimiter">(</span><a href="#137146" title="Int">xhc</a> <a href="../../Int.scala.html#26414" title="(x: Int)Int">&gt;&gt;&gt;</a> <a href="#137149" title="Int">lev</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <span title="Int(31)" class="int">0x1f</span>
    <span class="keyword">val</span> <a title="Int" id="140315">yidx</a> = <span class="delimiter">(</span><a href="#137148" title="Int">yhc</a> <a href="../../Int.scala.html#26414" title="(x: Int)Int">&gt;&gt;&gt;</a> <a href="#137149" title="Int">lev</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26468" title="(x: Int)Int">&amp;</a> <span title="Int(31)" class="int">0x1f</span>
    <span class="keyword">val</span> <a title="Int" id="140316">bmp</a> = <span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#26412" title="(x: Int)Int">&lt;&lt;</a> <a href="#140314" title="Int">xidx</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26463" title="(x: Int)Int">|</a> <span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#26412" title="(x: Int)Int">&lt;&lt;</a> <a href="#140315" title="Int">yidx</a><span class="delimiter">)</span>
    <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#140314" title="Int">xidx</a> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> <a href="#140315" title="Int">yidx</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="140349">subinode</a> = <a href="#136710" title="(g: scala.collection.concurrent.Gen)scala.collection.concurrent.INode[K,V]" class="keyword">new</a> <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#137150" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>//(TrieMap.inodeupdater)
      <a href="#140349" title="scala.collection.concurrent.INode[K,V]">subinode</a>.<a href="INodeBase.java.html#136700" title="scala.collection.concurrent.MainNode[K,V]">mainnode</a> = <a href="#137140" title="(x: scala.collection.concurrent.SNode[K,V], xhc: Int, y: scala.collection.concurrent.SNode[K,V], yhc: Int, lev: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.MainNode[K,V]">dual</a><span class="delimiter">(</span><a href="#137145" title="scala.collection.concurrent.SNode[K,V]">x</a>, <a href="#137146" title="Int">xhc</a>, <a href="#137147" title="scala.collection.concurrent.SNode[K,V]">y</a>, <a href="#137148" title="Int">yhc</a>, <a href="#137149" title="Int">lev</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="#137150" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
      <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#9132" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">(</span><a href="#140316" title="Int">bmp</a>, <a href="../../Array.scala.html#41581" title="(xs: scala.collection.concurrent.BasicNode*)(implicit evidence$2: scala.reflect.ClassTag[scala.collection.concurrent.BasicNode])Array[scala.collection.concurrent.BasicNode]">Array</a><a href="../../reflect/ClassTag.scala.html#50372" title="(runtimeClass1: Class[_])scala.reflect.ClassTag[scala.collection.concurrent.BasicNode]" class="delimiter">(</a><a href="#140349" title="scala.collection.concurrent.INode[K,V]">subinode</a><span class="delimiter">)</span>, <a href="#137150" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#140314" title="Int">xidx</a> <a href="../../Int.scala.html#26435" title="(x: Int)Boolean">&lt;</a> <a href="#140315" title="Int">yidx</a><span class="delimiter">)</span> <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#9132" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">(</span><a href="#140316" title="Int">bmp</a>, <a href="../../Array.scala.html#41581" title="(xs: scala.collection.concurrent.BasicNode*)(implicit evidence$2: scala.reflect.ClassTag[scala.collection.concurrent.BasicNode])Array[scala.collection.concurrent.BasicNode]">Array</a><a href="../../reflect/ClassTag.scala.html#50372" title="(runtimeClass1: Class[_])scala.reflect.ClassTag[scala.collection.concurrent.BasicNode]" class="delimiter">(</a><a href="#137145" title="scala.collection.concurrent.SNode[K,V]">x</a>, <a href="#137147" title="scala.collection.concurrent.SNode[K,V]">y</a><span class="delimiter">)</span>, <a href="#137150" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#9132" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">(</span><a href="#140316" title="Int">bmp</a>, <a href="../../Array.scala.html#41581" title="(xs: scala.collection.concurrent.BasicNode*)(implicit evidence$2: scala.reflect.ClassTag[scala.collection.concurrent.BasicNode])Array[scala.collection.concurrent.BasicNode]">Array</a><a href="../../reflect/ClassTag.scala.html#50372" title="(runtimeClass1: Class[_])scala.reflect.ClassTag[scala.collection.concurrent.BasicNode]" class="delimiter">(</a><a href="#137147" title="scala.collection.concurrent.SNode[K,V]">y</a>, <a href="#137145" title="scala.collection.concurrent.SNode[K,V]">x</a><span class="delimiter">)</span>, <a href="#137150" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
    <a href="#137250" title="(k1: K, v1: V, k2: K, v2: V)scala.collection.concurrent.LNode[K,V]" class="keyword">new</a> <a href="#9087" title="scala.collection.concurrent.LNode[K,V]">LNode</a><span class="delimiter">(</span><a href="#137145" title="scala.collection.concurrent.SNode[K,V]">x</a>.<a href="#137128" title="=&gt; K">k</a>, <a href="#137145" title="scala.collection.concurrent.SNode[K,V]">x</a>.<a href="#137129" title="=&gt; V">v</a>, <a href="#137147" title="scala.collection.concurrent.SNode[K,V]">y</a>.<a href="#137128" title="=&gt; K">k</a>, <a href="#137147" title="scala.collection.concurrent.SNode[K,V]">y</a>.<a href="#137129" title="=&gt; V">v</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>


<span title="Object" class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> case <span class="keyword">class</span> <a href="#140705" title="class RDCSS_Descriptor[K, V] extends AnyRef with Product with Serializable" id="142474">RDCSS_Descriptor</a><span class="delimiter">[</span><a title="" id="141242">K</a>, <a title="" id="141243">V</a><span class="delimiter">]</span><a href="../../Product.scala.html#186" title="Product" class="delimiter">(</a><a title="scala.collection.concurrent.INode[K,V]" id="141290">old</a>: <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.MainNode[K,V]" id="141291">expectedmain</a>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.INode[K,V]" id="141292">nv</a>: <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  @volatile <span class="keyword">var</span> <a title="Boolean" id="140651">committed</a> = <span title="Boolean(false)" class="keyword">false</span>
<span class="delimiter">}</span>


/** A concurrent hash-trie or TrieMap is a concurrent thread-safe lock-free
 *  implementation of a hash array mapped trie. It is used to implement the
 *  concurrent map abstraction. It has particularly scalable concurrent insert
 *  and remove operations and is memory-efficient. It supports O(1), atomic,
 *  lock-free snapshots which are used to implement linearizable lock-free size,
 *  iterator and clear operations. The cost of evaluating the (lazy) snapshot is
 *  distributed across subsequent updates, thus making snapshot evaluation horizontally scalable.
 *
 *  For details, see: http://lampwww.epfl.ch/~prokopec/ctries-snapshot.pdf
 *
 *  @author Aleksandar Prokopec
 *  @since 2.10
 */
@SerialVersionUID<span class="delimiter">(</span><span class="long">0L</span> - <span class="long">6402774413839597105L</span><span class="delimiter">)</span>
<span class="keyword">final</span> <span class="keyword">class</span> <a title="class TrieMap[K, V] extends AnyRef with scala.collection.concurrent.Map[K,V] with scala.collection.mutable.MapLike[K,V,scala.collection.concurrent.TrieMap[K,V]] with scala.collection.CustomParallelizable[(K, V),scala.collection.parallel.mutable.ParTrieMap[K,V]] with Serializable" id="9120">TrieMap</a><span class="delimiter">[</span><a title="" id="9219">K</a>, <a title="" id="9220">V</a><span class="delimiter">]</span> <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">private</a> <span class="delimiter">(</span><a title="AnyRef" id="140781">r</a>: <span title="AnyRef">AnyRef</span>, <a title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]" id="140782">rtupd</a>: <span title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">AtomicReferenceFieldUpdater</span><span class="delimiter">[</span>TrieMap<span class="delimiter">[</span>K, V<span class="delimiter">]</span>, AnyRef<span class="delimiter">]</span>, <a title="scala.util.hashing.Hashing[K]" id="140783">hashf</a>: <a href="../../util/hashing/Hashing.scala.html#19081" title="scala.util.hashing.Hashing[K]">Hashing</a><span class="delimiter">[</span>K<span class="delimiter">]</span>, <a title="Equiv[K]" id="140784">ef</a>: <a href="../../math/Equiv.scala.html#16673" title="Equiv[K]">Equiv</a><span class="delimiter">[</span>K<span class="delimiter">]</span><span class="delimiter">)</span>
<span class="keyword">extends</span> scala.collection.concurrent.<a href="Map.scala.html#9093" title="scala.collection.concurrent.Map[K,V]">Map</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>
   <span class="keyword">with</span> scala.collection.mutable.<a href="../mutable/MapLike.scala.html#12448" title="scala.collection.mutable.MapLike[K,V,scala.collection.concurrent.TrieMap[K,V]]">MapLike</a><span class="delimiter">[</span>K, V, TrieMap<span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">]</span>
   <span class="keyword">with</span> <a href="../CustomParallelizable.scala.html#3551" title="scala.collection.CustomParallelizable[(K, V),scala.collection.parallel.mutable.ParTrieMap[K,V]]">CustomParallelizable</a><span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span>, ParTrieMap<span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">]</span>
   <span class="keyword">with</span> <a href="../../Serializable.scala.html#891" title="Serializable">Serializable</a>
<span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="scala.util.hashing.Hashing[K]" id="136841">hashingobj</a> = <span title="scala.util.hashing.Hashing[K]" class="keyword">if</span> <span class="delimiter">(</span><a href="#140783" title="scala.util.hashing.Hashing[K]">hashf</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span>Hashing.<a href="../../util/hashing/Hashing.scala.html#138645" title="scala.util.hashing.Hashing.Default[_]">Default</a><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> <span title="scala.collection.concurrent.TrieMap.MangledHashing[K]" class="keyword">new</span> TrieMap.<a href="#138672" title="scala.collection.concurrent.TrieMap.MangledHashing[K]">MangledHashing</a><span class="delimiter">[</span>K<span class="delimiter">]</span> <span class="keyword">else</span> <a href="#140783" title="scala.util.hashing.Hashing[K]">hashf</a>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Equiv[K]" id="136844">equalityobj</a> = <a href="#140784" title="Equiv[K]">ef</a>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]" id="136847">rootupdater</a> = <a href="#140782" title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">rtupd</a>
  <span class="keyword">def</span> <a title="=&gt; scala.util.hashing.Hashing[K]" id="136849">hashing</a> = <a href="#136841" title="=&gt; scala.util.hashing.Hashing[K]">hashingobj</a>
  <span class="keyword">def</span> <a title="=&gt; Equiv[K]" id="136850">equality</a> = <a href="#136844" title="=&gt; Equiv[K]">equalityobj</a>
  @volatile <span class="keyword">var</span> <a title="AnyRef" id="136852">root</a> = <a href="#140781" title="AnyRef">r</a>

  <span class="keyword">def</span> <a title="(hashf: scala.util.hashing.Hashing[K], ef: Equiv[K])scala.collection.concurrent.TrieMap[K,V]" id="136854" class="keyword">this</a><span class="delimiter">(</span><a title="scala.util.hashing.Hashing[K]" id="140791">hashf</a>: <a href="../../util/hashing/Hashing.scala.html#19081" title="scala.util.hashing.Hashing[K]">Hashing</a><span class="delimiter">[</span>K<span class="delimiter">]</span>, <a title="Equiv[K]" id="140792">ef</a>: <a href="../../math/Equiv.scala.html#16673" title="Equiv[K]">Equiv</a><span class="delimiter">[</span>K<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#9120" title="TrieMap.this.type" class="keyword">this</a><span class="delimiter">(</span>
    <a href="#9127" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#137829" title="scala.collection.concurrent.INode[Nothing,Nothing]">newRootNode</a>,
    <span title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater.type">AtomicReferenceFieldUpdater</span>.<span title="(x$1: Class[scala.collection.concurrent.TrieMap[K,V]], x$2: Class[AnyRef], x$3: String)java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">newUpdater</span><span class="delimiter">(</span>classOf<span title="Class[scala.collection.concurrent.TrieMap[K,V]](classOf[scala.collection.concurrent.TrieMap])" class="delimiter">[</span>TrieMap<span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">]</span>, classOf<span title="Class[AnyRef](classOf[java.lang.Object])" class="delimiter">[</span>AnyRef<span class="delimiter">]</span>, <span title="String(&quot;root&quot;)" class="string">&quot;root&quot;</span><span class="delimiter">)</span>,
    <a href="#140791" title="scala.util.hashing.Hashing[K]">hashf</a>,
    <a href="#140792" title="Equiv[K]">ef</a>
  <span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()scala.collection.concurrent.TrieMap[K,V]" id="136855" class="keyword">this</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#136854" title="(hashf: scala.util.hashing.Hashing[K], ef: Equiv[K])scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">(</span><a href="../../util/hashing/Hashing.scala.html#19082" title="scala.util.hashing.Hashing.type">Hashing</a>.<a href="../../util/hashing/Hashing.scala.html#138647" title="scala.util.hashing.Hashing.Default[K]">default</a>, <a href="../../package.scala.html#22250" title="=&gt; math.Equiv.type">Equiv</a>.<a href="../../math/Equiv.scala.html#51692" title="scala.math.Equiv[K]">universal</a><span class="delimiter">)</span>

  /* internal methods */

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(out: java.io.ObjectOutputStream)Unit" id="136856">writeObject</a><span class="delimiter">(</span><a title="java.io.ObjectOutputStream" id="140821">out</a>: java.io.<span title="java.io.ObjectOutputStream">ObjectOutputStream</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#140821" title="java.io.ObjectOutputStream">out</a>.<span title="(x$1: Any)Unit">writeObject</span><span class="delimiter">(</span><a href="#140783" title="scala.util.hashing.Hashing[K]">hashf</a><span class="delimiter">)</span>
    <a href="#140821" title="java.io.ObjectOutputStream">out</a>.<span title="(x$1: Any)Unit">writeObject</span><span class="delimiter">(</span><a href="#140784" title="Equiv[K]">ef</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Iterator[(K, V)]" id="140934">it</a> = <a href="#136889" title="=&gt; Iterator[(K, V)]">iterator</a>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#140934" title="Iterator[(K, V)]">it</a>.<a href="../Iterator.scala.html#36068" title="=&gt; Boolean">hasNext</a><span class="delimiter">)</span> <a href="#140935" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a href="#1440239" title="(x: (K, V))(K, V)" class="delimiter">(</a><a href="../../Tuple2.scala.html#29956" title="K" id="141011">k</a>, <a href="../../Tuple2.scala.html#29958" title="V" id="141012">v</a><span class="delimiter">)</span> = <a href="#140934" title="Iterator[(K, V)]">it</a>.<a href="../Iterator.scala.html#36069" title="()(K, V)">next</a><a href="../../Tuple2.scala.html#783" title="(K, V) @unchecked" class="delimiter">(</a><span class="delimiter">)</span>
      <a href="#140821" title="java.io.ObjectOutputStream">out</a>.<span title="(x$1: Any)Unit">writeObject</span><span class="delimiter">(</span><a href="#141011" title="K">k</a><span class="delimiter">)</span>
      <a href="#140821" title="java.io.ObjectOutputStream">out</a>.<span title="(x$1: Any)Unit">writeObject</span><span class="delimiter">(</span><a href="#141012" title="V">v</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#140821" title="java.io.ObjectOutputStream">out</a>.<span title="(x$1: Any)Unit">writeObject</span><span class="delimiter">(</span><a href="#142328" title="scala.collection.concurrent.TrieMapSerializationEnd.type">TrieMapSerializationEnd</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: java.io.ObjectInputStream)Unit" id="136857">readObject</a><span class="delimiter">(</span><a title="java.io.ObjectInputStream" id="141025">in</a>: java.io.<span title="java.io.ObjectInputStream">ObjectInputStream</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#136852" title="(x$1: AnyRef)Unit">root</a> = <a href="#9127" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#137829" title="scala.collection.concurrent.INode[Nothing,Nothing]">newRootNode</a>
    <a href="#136847" title="(x$1: java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef])Unit">rootupdater</a> = <span title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater.type">AtomicReferenceFieldUpdater</span>.<span title="(x$1: Class[scala.collection.concurrent.TrieMap[K,V]], x$2: Class[AnyRef], x$3: String)java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">newUpdater</span><span class="delimiter">(</span>classOf<span title="Class[scala.collection.concurrent.TrieMap[K,V]](classOf[scala.collection.concurrent.TrieMap])" class="delimiter">[</span>TrieMap<span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">]</span>, classOf<span title="Class[AnyRef](classOf[java.lang.Object])" class="delimiter">[</span>AnyRef<span class="delimiter">]</span>, <span title="String(&quot;root&quot;)" class="string">&quot;root&quot;</span><span class="delimiter">)</span>

    <a href="#136841" title="(x$1: scala.util.hashing.Hashing[K])Unit">hashingobj</a> = <a href="#141025" title="java.io.ObjectInputStream">in</a>.<span title="()Object">readObject</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.util.hashing.Hashing[K]" class="delimiter">[</span><a href="../../util/hashing/Hashing.scala.html#19081" title="scala.util.hashing.Hashing[K]">Hashing</a><span class="delimiter">[</span>K<span class="delimiter">]</span><span class="delimiter">]</span>
    <a href="#136844" title="(x$1: Equiv[K])Unit">equalityobj</a> = <a href="#141025" title="java.io.ObjectInputStream">in</a>.<span title="()Object">readObject</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Equiv[K]" class="delimiter">[</span><a href="../../math/Equiv.scala.html#16673" title="Equiv[K]">Equiv</a><span class="delimiter">[</span>K<span class="delimiter">]</span><span class="delimiter">]</span>

    <span class="keyword">var</span> <a title="AnyRef" id="141132">obj</a>: <span title="AnyRef">AnyRef</span> = <span title="Null(null)" class="keyword">null</span>
    <a href="#141175" title="Unit" class="keyword">do</a> <span class="delimiter">{</span>
      <a href="#141132" title="AnyRef">obj</a> = <a href="#141025" title="java.io.ObjectInputStream">in</a>.<span title="()Object">readObject</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#141132" title="AnyRef">obj</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#142328" title="scala.collection.concurrent.TrieMapSerializationEnd.type">TrieMapSerializationEnd</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="K" id="141181">k</a> = <a href="#141132" title="AnyRef">obj</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="K" class="delimiter">[</span><a href="#9219" title="K">K</a><span class="delimiter">]</span>
        <span class="keyword">val</span> <a title="V" id="141182">v</a> = <a href="#141025" title="java.io.ObjectInputStream">in</a>.<span title="()Object">readObject</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="V" class="delimiter">[</span><a href="#9220" title="V">V</a><span class="delimiter">]</span>
        <a href="#136881" title="(k: K, v: V)Unit">update</a><span class="delimiter">(</span><a href="#141181" title="K">k</a>, <a href="#141182" title="V">v</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><a href="#141132" title="AnyRef">obj</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#142328" title="scala.collection.concurrent.TrieMapSerializationEnd.type">TrieMapSerializationEnd</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(ov: AnyRef, nv: AnyRef)Boolean" id="136858">CAS_ROOT</a><span class="delimiter">(</span><a title="AnyRef" id="141193">ov</a>: <span title="AnyRef">AnyRef</span>, <a title="AnyRef" id="141194">nv</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span> = <a href="#136847" title="=&gt; java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">rootupdater</a>.<span title="(x$1: scala.collection.concurrent.TrieMap[K,V], x$2: AnyRef, x$3: AnyRef)Boolean">compareAndSet</span><span class="delimiter">(</span><a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a>, <a href="#141193" title="AnyRef">ov</a>, <a href="#141194" title="AnyRef">nv</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(abort: Boolean)scala.collection.concurrent.INode[K,V]" id="136859">readRoot</a><span class="delimiter">(</span><a title="Boolean" id="136904">abort</a>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>: <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <a href="#136860" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><a href="#136904" title="Boolean">abort</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(abort: Boolean)scala.collection.concurrent.INode[K,V]" id="136860">RDCSS_READ_ROOT</a><span class="delimiter">(</span><a title="Boolean" id="141202">abort</a>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>: <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="AnyRef" id="141203">r</a> = /*READ*/<a href="#136852" title="=&gt; AnyRef">root</a>
    <a href="#141203" title="AnyRef">r</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1440243" title="scala.collection.concurrent.INode[K,V]" id="1440244">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="#1440247" title="(x: scala.collection.concurrent.INode[K,V])scala.collection.concurrent.INode[K,V]">in</a>
      <span class="keyword">case</span> <a href="#1440243" title="scala.collection.concurrent.INode[K,V]" id="1440245">desc</a>: RDCSS_Descriptor<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="#136861" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_Complete</a><a href="#1440247" title="(x: scala.collection.concurrent.INode[K,V])scala.collection.concurrent.INode[K,V]" class="delimiter">(</a><a href="#141202" title="Boolean">abort</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  @tailrec <span class="keyword">private</span> <span class="keyword">def</span> <a title="(abort: Boolean)scala.collection.concurrent.INode[K,V]" id="136861">RDCSS_Complete</a><span class="delimiter">(</span><a title="Boolean" id="141214">abort</a>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a><span class="delimiter">)</span>: <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="AnyRef" id="141216">v</a> = /*READ*/<a href="#136852" title="=&gt; AnyRef">root</a>
    <a href="#141216" title="AnyRef">v</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1440258" title="scala.collection.concurrent.INode[K,V]" id="1440259">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="#1440262" title="(x: scala.collection.concurrent.INode[K,V])scala.collection.concurrent.INode[K,V]">in</a>
      <span class="keyword">case</span> <a href="#1440258" title="scala.collection.concurrent.INode[K,V]" id="1440260">desc</a>: RDCSS_Descriptor<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
        <span class="keyword">val</span> RDCSS_Descriptor<a href="#1440254" title="(x: (scala.collection.concurrent.INode[K,V], scala.collection.concurrent.MainNode[K,V], scala.collection.concurrent.INode[K,V]))(scala.collection.concurrent.INode[K,V], scala.collection.concurrent.MainNode[K,V], scala.collection.concurrent.INode[K,V])" class="delimiter">(</a><a href="#141290" title="scala.collection.concurrent.INode[K,V]" id="141228">ov</a>, <a href="#141291" title="scala.collection.concurrent.MainNode[K,V]" id="141229">exp</a>, <a href="#141292" title="scala.collection.concurrent.INode[K,V]" id="141230">nv</a><span class="delimiter">)</span> = <a href="#142474" title="scala.collection.concurrent.RDCSS_Descriptor[K,V] @unchecked">desc</a>
        <span title="scala.collection.concurrent.INode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#141214" title="Boolean">abort</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="scala.collection.concurrent.INode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136858" title="(ov: AnyRef, nv: AnyRef)Boolean">CAS_ROOT</a><span class="delimiter">(</span>desc, <a href="#141228" title="scala.collection.concurrent.INode[K,V]">ov</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#141228" title="scala.collection.concurrent.INode[K,V]">ov</a>
          <span class="keyword">else</span> <a href="#136861" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_Complete</a><span class="delimiter">(</span><a href="#141214" title="Boolean">abort</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="141283">oldmain</a> = <a href="#141228" title="scala.collection.concurrent.INode[K,V]">ov</a>.<a href="#136713" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">gcasRead</a><span class="delimiter">(</span><a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>
          <span title="scala.collection.concurrent.INode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#141283" title="scala.collection.concurrent.MainNode[K,V]">oldmain</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#141229" title="scala.collection.concurrent.MainNode[K,V]">exp</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="scala.collection.concurrent.INode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136858" title="(ov: AnyRef, nv: AnyRef)Boolean">CAS_ROOT</a><span class="delimiter">(</span>desc, <a href="#141230" title="scala.collection.concurrent.INode[K,V]">nv</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              desc.<a href="#140651" title="(x$1: Boolean)Unit">committed</a> = <span title="Boolean(true)" class="keyword">true</span>
              <a href="#141230" title="scala.collection.concurrent.INode[K,V]">nv</a>
            <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#136861" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_Complete</a><span class="delimiter">(</span><a href="#141214" title="Boolean">abort</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span title="scala.collection.concurrent.INode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136858" title="(ov: AnyRef, nv: AnyRef)Boolean">CAS_ROOT</a><span class="delimiter">(</span>desc, <a href="#141228" title="scala.collection.concurrent.INode[K,V]">ov</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#141228" title="scala.collection.concurrent.INode[K,V]">ov</a>
            <span class="keyword">else</span> <a href="#136861" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_Complete</a><span class="delimiter">(</span><a href="#141214" title="Boolean">abort</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(ov: scala.collection.concurrent.INode[K,V], expectedmain: scala.collection.concurrent.MainNode[K,V], nv: scala.collection.concurrent.INode[K,V])Boolean" id="136862">RDCSS_ROOT</a><span class="delimiter">(</span><a title="scala.collection.concurrent.INode[K,V]" id="141285">ov</a>: <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.MainNode[K,V]" id="141286">expectedmain</a>: <a href="MainNode.java.html#9117" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.INode[K,V]" id="141287">nv</a>: <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.RDCSS_Descriptor[K,V]" id="141289">desc</a> = <a href="#142474" title="(old: scala.collection.concurrent.INode[K,V], expectedmain: scala.collection.concurrent.MainNode[K,V], nv: scala.collection.concurrent.INode[K,V])scala.collection.concurrent.RDCSS_Descriptor[K,V]">RDCSS_Descriptor</a><span class="delimiter">(</span><a href="#141285" title="scala.collection.concurrent.INode[K,V]">ov</a>, <a href="#141286" title="scala.collection.concurrent.MainNode[K,V]">expectedmain</a>, <a href="#141287" title="scala.collection.concurrent.INode[K,V]">nv</a><span class="delimiter">)</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#136858" title="(ov: AnyRef, nv: AnyRef)Boolean">CAS_ROOT</a><span class="delimiter">(</span><a href="#141285" title="scala.collection.concurrent.INode[K,V]">ov</a>, <a href="#141289" title="scala.collection.concurrent.RDCSS_Descriptor[K,V]">desc</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#136861" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_Complete</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
      /*READ*/<a href="#141289" title="scala.collection.concurrent.RDCSS_Descriptor[K,V]">desc</a>.<a href="#140651" title="=&gt; Boolean">committed</a>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>

  @tailrec <span class="keyword">private</span> <span class="keyword">def</span> <a title="(k: K, hc: Int, v: V)Unit" id="136863">inserthc</a><span class="delimiter">(</span><a title="K" id="141304">k</a>: <a href="#9219" title="K">K</a>, <a title="Int" id="141305">hc</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="V" id="141306">v</a>: <a href="#9220" title="V">V</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="141308">r</a> = <a href="#136860" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#27146" title="=&gt; Boolean">!</a><a href="#141308" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#136720" title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Boolean">rec_insert</a><span class="delimiter">(</span><a href="#141304" title="K">k</a>, <a href="#141306" title="V">v</a>, <a href="#141305" title="Int">hc</a>, <span title="Int(0)" class="int">0</span>, <span title="Null(null)" class="keyword">null</span>, <a href="#141308" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a>, <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#136863" title="(k: K, hc: Int, v: V)Unit">inserthc</a><span class="delimiter">(</span><a href="#141304" title="K">k</a>, <a href="#141305" title="Int">hc</a>, <a href="#141306" title="V">v</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  @tailrec <span class="keyword">private</span> <span class="keyword">def</span> <a title="(k: K, hc: Int, v: V, cond: AnyRef)Option[V]" id="136864">insertifhc</a><span class="delimiter">(</span><a title="K" id="141318">k</a>: <a href="#9219" title="K">K</a>, <a title="Int" id="141319">hc</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="V" id="141320">v</a>: <a href="#9220" title="V">V</a>, <a title="AnyRef" id="141321">cond</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <a href="../../Option.scala.html#978" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="141323">r</a> = <a href="#136860" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Option[V]" id="141324">ret</a> = <a href="#141323" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#136721" title="(k: K, v: V, hc: Int, cond: AnyRef, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]">rec_insertif</a><span class="delimiter">(</span><a href="#141318" title="K">k</a>, <a href="#141320" title="V">v</a>, <a href="#141319" title="Int">hc</a>, <a href="#141321" title="AnyRef">cond</a>, <span title="Int(0)" class="int">0</span>, <span title="Null(null)" class="keyword">null</span>, <a href="#141323" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a>, <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>
    <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#141324" title="Option[V]">ret</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#136864" title="(k: K, hc: Int, v: V, cond: AnyRef)Option[V]">insertifhc</a><span class="delimiter">(</span><a href="#141318" title="K">k</a>, <a href="#141319" title="Int">hc</a>, <a href="#141320" title="V">v</a>, <a href="#141321" title="AnyRef">cond</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#141324" title="Option[V]">ret</a>
  <span class="delimiter">}</span>

  @tailrec <span class="keyword">private</span> <span class="keyword">def</span> <a title="(k: K, hc: Int)AnyRef" id="136865">lookuphc</a><span class="delimiter">(</span><a title="K" id="141333">k</a>: <a href="#9219" title="K">K</a>, <a title="Int" id="141334">hc</a>: <a href="../../Int.scala.html#321" title="Int">Int</a><span class="delimiter">)</span>: <span title="AnyRef">AnyRef</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="141336">r</a> = <a href="#136860" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="AnyRef" id="141337">res</a> = <a href="#141336" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#136722" title="(k: K, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])AnyRef">rec_lookup</a><span class="delimiter">(</span><a href="#141333" title="K">k</a>, <a href="#141334" title="Int">hc</a>, <span title="Int(0)" class="int">0</span>, <span title="Null(null)" class="keyword">null</span>, <a href="#141336" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a>, <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>
    <span title="AnyRef" class="keyword">if</span> <span class="delimiter">(</span><a href="#141337" title="AnyRef">res</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="INodeBase.java.html#9130" title="scala.collection.concurrent.INodeBase.type">INodeBase</a>.<a href="INodeBase.java.html#136746" title="Object">RESTART</a><span class="delimiter">)</span> <a href="#136865" title="(k: K, hc: Int)AnyRef">lookuphc</a><span class="delimiter">(</span><a href="#141333" title="K">k</a>, <a href="#141334" title="Int">hc</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#141337" title="AnyRef">res</a>
  <span class="delimiter">}</span>

  /* slower:
  //@tailrec
  private def lookuphc(k: K, hc: Int): AnyRef = {
    val r = RDCSS_READ_ROOT()
    try {
      r.rec_lookup(k, hc, 0, null, r.gen, this)
    } catch {
      case RestartException =&gt;
        lookuphc(k, hc)
    }
  }
  */

  @tailrec <span class="keyword">private</span> <span class="keyword">def</span> <a title="(k: K, v: V, hc: Int)Option[V]" id="136866">removehc</a><span class="delimiter">(</span><a title="K" id="141344">k</a>: <a href="#9219" title="K">K</a>, <a title="V" id="141345">v</a>: <a href="#9220" title="V">V</a>, <a title="Int" id="141346">hc</a>: <a href="../../Int.scala.html#321" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../Option.scala.html#978" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="141348">r</a> = <a href="#136860" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Option[V]" id="141349">res</a> = <a href="#141348" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#136723" title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]">rec_remove</a><span class="delimiter">(</span><a href="#141344" title="K">k</a>, <a href="#141345" title="V">v</a>, <a href="#141346" title="Int">hc</a>, <span title="Int(0)" class="int">0</span>, <span title="Null(null)" class="keyword">null</span>, <a href="#141348" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="INodeBase.java.html#136701" title="scala.collection.concurrent.Gen">gen</a>, <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>
    <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#141349" title="Option[V]">res</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#141349" title="Option[V]">res</a>
    <span class="keyword">else</span> <a href="#136866" title="(k: K, v: V, hc: Int)Option[V]">removehc</a><span class="delimiter">(</span><a href="#141344" title="K">k</a>, <a href="#141345" title="V">v</a>, <a href="#141346" title="Int">hc</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; String" id="136867">string</a> = <a href="#136860" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="#136727" title="(lev: Int)String">string</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

  /* public methods */

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.TrieMap[K,V]" id="136868">seq</a> = <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.parallel.mutable.ParTrieMap[K,V]" id="136869">par</a> = <span title="scala.collection.parallel.mutable.ParTrieMap[K,V]" class="keyword">new</span> <a href="../parallel/mutable/ParTrieMap.scala.html#14873" title="scala.collection.parallel.mutable.ParTrieMap[K,V]">ParTrieMap</a><span class="delimiter">(</span><a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.TrieMap[K,V]" id="136870">empty</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <a href="#136855" title="()scala.collection.concurrent.TrieMap[K,V]" class="keyword">new</a> <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="136871">isReadOnly</a> = <a href="#136847" title="=&gt; java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">rootupdater</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="136872">nonReadOnly</a> = <a href="#136847" title="=&gt; java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">rootupdater</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span>

  /** Returns a snapshot of this TrieMap.
   *  This operation is lock-free and linearizable.
   *
   *  The snapshot is lazily updated - the first time some branch
   *  in the snapshot or this TrieMap are accessed, they are rewritten.
   *  This means that the work of rebuilding both the snapshot and this
   *  TrieMap is distributed across all the threads doing updates or accesses
   *  subsequent to the snapshot creation.
   */
  @tailrec <span class="keyword">def</span> <a title="()scala.collection.concurrent.TrieMap[K,V]" id="136873">snapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="141473">r</a> = <a href="#136860" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="141474">expmain</a> = <a href="#141473" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#136713" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">gcasRead</a><span class="delimiter">(</span><a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>
    <span title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136862" title="(ov: scala.collection.concurrent.INode[K,V], expectedmain: scala.collection.concurrent.MainNode[K,V], nv: scala.collection.concurrent.INode[K,V])Boolean">RDCSS_ROOT</a><span class="delimiter">(</span><a href="#141473" title="scala.collection.concurrent.INode[K,V]">r</a>, <a href="#141474" title="scala.collection.concurrent.MainNode[K,V]">expmain</a>, <a href="#141473" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#136719" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.INode[K,V]">copyToGen</a><span class="delimiter">(</span><span title="scala.collection.concurrent.Gen" class="keyword">new</span> <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a>, <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">new</span> <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">(</span><a href="#141473" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#136719" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.INode[K,V]">copyToGen</a><span class="delimiter">(</span><span title="scala.collection.concurrent.Gen" class="keyword">new</span> <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a>, <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>, <a href="#136847" title="=&gt; java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">rootupdater</a>, <a href="#136849" title="=&gt; scala.util.hashing.Hashing[K]">hashing</a>, <a href="#136850" title="=&gt; Equiv[K]">equality</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#136873" title="()scala.collection.concurrent.TrieMap[K,V]">snapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** Returns a read-only snapshot of this TrieMap.
   *  This operation is lock-free and linearizable.
   *
   *  The snapshot is lazily updated - the first time some branch
   *  of this TrieMap are accessed, it is rewritten. The work of creating
   *  the snapshot is thus distributed across subsequent updates
   *  and accesses on this TrieMap by all threads.
   *  Note that the snapshot itself is never rewritten unlike when calling
   *  the `snapshot` method, but the obtained snapshot cannot be modified.
   *
   *  This method is used by other methods such as `size` and `iterator`.
   */
  @tailrec <span class="keyword">def</span> <a title="()scala.collection.Map[K,V]" id="136874">readOnlySnapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>: scala.collection.<a href="../Map.scala.html#3509" title="scala.collection.Map[K,V]">Map</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="141493">r</a> = <a href="#136860" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="141494">expmain</a> = <a href="#141493" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#136713" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">gcasRead</a><span class="delimiter">(</span><a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>
    <span title="scala.collection.Map[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136862" title="(ov: scala.collection.concurrent.INode[K,V], expectedmain: scala.collection.concurrent.MainNode[K,V], nv: scala.collection.concurrent.INode[K,V])Boolean">RDCSS_ROOT</a><span class="delimiter">(</span><a href="#141493" title="scala.collection.concurrent.INode[K,V]">r</a>, <a href="#141494" title="scala.collection.concurrent.MainNode[K,V]">expmain</a>, <a href="#141493" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#136719" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.INode[K,V]">copyToGen</a><span class="delimiter">(</span><span title="scala.collection.concurrent.Gen" class="keyword">new</span> <a href="Gen.java.html#9171" title="scala.collection.concurrent.Gen">Gen</a>, <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="scala.collection.concurrent.TrieMap[K,Nothing]" class="keyword">new</span> <a href="#9120" title="scala.collection.concurrent.TrieMap[K,Nothing]">TrieMap</a><span class="delimiter">(</span><a href="#141493" title="scala.collection.concurrent.INode[K,V]">r</a>, <span title="Null(null)" class="keyword">null</span>, <a href="#136849" title="=&gt; scala.util.hashing.Hashing[K]">hashing</a>, <a href="#136850" title="=&gt; Equiv[K]">equality</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#136874" title="()scala.collection.Map[K,V]">readOnlySnapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  @tailrec <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="136875">clear</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="141531">r</a> = <a href="#136860" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#27146" title="=&gt; Boolean">!</a><a href="#136862" title="(ov: scala.collection.concurrent.INode[K,V], expectedmain: scala.collection.concurrent.MainNode[K,V], nv: scala.collection.concurrent.INode[K,V])Boolean">RDCSS_ROOT</a><span class="delimiter">(</span><a href="#141531" title="scala.collection.concurrent.INode[K,V]">r</a>, <a href="#141531" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#136713" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">gcasRead</a><span class="delimiter">(</span><a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>, <a href="#9127" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#137829" title="[K, V]=&gt; scala.collection.concurrent.INode[K,V]">newRootNode</a><span title="scala.collection.concurrent.INode[K,V]" class="delimiter">[</span><a href="#9219" title="K">K</a>, <a href="#9220" title="V">V</a><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#136875" title="()Unit">clear</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="keyword">def</span> <a title="(k: K)Int" id="136876">computeHash</a><span class="delimiter">(</span><a title="K" id="138639">k</a>: <a href="#9219" title="K">K</a><span class="delimiter">)</span> = <a href="#136841" title="=&gt; scala.util.hashing.Hashing[K]">hashingobj</a>.<a href="../../util/hashing/Hashing.scala.html#138642" title="(x: K)Int">hash</a><span class="delimiter">(</span><a href="#138639" title="K">k</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(k: K)V" id="136877">lookup</a><span class="delimiter">(</span><a title="K" id="141533">k</a>: <a href="#9219" title="K">K</a><span class="delimiter">)</span>: <a href="#9220" title="V">V</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="141535">hc</a> = <a href="#136876" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#141533" title="K">k</a><span class="delimiter">)</span>
    <a href="#136865" title="(k: K, hc: Int)AnyRef">lookuphc</a><span class="delimiter">(</span><a href="#141533" title="K">k</a>, <a href="#141535" title="Int">hc</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="V" class="delimiter">[</span><a href="#9220" title="V">V</a><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(k: K)V" id="136878">apply</a><span class="delimiter">(</span><a title="K" id="141536">k</a>: <a href="#9219" title="K">K</a><span class="delimiter">)</span>: <a href="#9220" title="V">V</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="141542">hc</a> = <a href="#136876" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#141536" title="K">k</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="AnyRef" id="141543">res</a> = <a href="#136865" title="(k: K, hc: Int)AnyRef">lookuphc</a><span class="delimiter">(</span><a href="#141536" title="K">k</a>, <a href="#141542" title="Int">hc</a><span class="delimiter">)</span>
    <span title="V" class="keyword">if</span> <span class="delimiter">(</span><a href="#141543" title="AnyRef">res</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <span title="java.util.NoSuchElementException" class="keyword">new</span> <a href="../../package.scala.html#22180" title="java.util.NoSuchElementException">NoSuchElementException</a>
    <span class="keyword">else</span> <a href="#141543" title="AnyRef">res</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="V" class="delimiter">[</span><a href="#9220" title="V">V</a><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(k: K)Option[V]" id="136879">get</a><span class="delimiter">(</span><a title="K" id="141546">k</a>: <a href="#9219" title="K">K</a><span class="delimiter">)</span>: <a href="../../Option.scala.html#978" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="141551">hc</a> = <a href="#136876" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#141546" title="K">k</a><span class="delimiter">)</span>
    <a href="../../Option.scala.html#66720" title="(x: AnyRef)Option[AnyRef]">Option</a><span class="delimiter">(</span><a href="#136865" title="(k: K, hc: Int)AnyRef">lookuphc</a><span class="delimiter">(</span><a href="#141546" title="K">k</a>, <a href="#141551" title="Int">hc</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Option[V]" class="delimiter">[</span><a href="../../Option.scala.html#978" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(key: K, value: V)Option[V]" id="136880">put</a><span class="delimiter">(</span><a title="K" id="141555">key</a>: <a href="#9219" title="K">K</a>, <a title="V" id="141556">value</a>: <a href="#9220" title="V">V</a><span class="delimiter">)</span>: <a href="../../Option.scala.html#978" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="141563">hc</a> = <a href="#136876" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#141555" title="K">key</a><span class="delimiter">)</span>
    <a href="#136864" title="(k: K, hc: Int, v: V, cond: AnyRef)Option[V]">insertifhc</a><span class="delimiter">(</span><a href="#141555" title="K">key</a>, <a href="#141563" title="Int">hc</a>, <a href="#141556" title="V">value</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(k: K, v: V)Unit" id="136881">update</a><span class="delimiter">(</span><a title="K" id="141183">k</a>: <a href="#9219" title="K">K</a>, <a title="V" id="141184">v</a>: <a href="#9220" title="V">V</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="141564">hc</a> = <a href="#136876" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#141183" title="K">k</a><span class="delimiter">)</span>
    <a href="#136863" title="(k: K, hc: Int, v: V)Unit">inserthc</a><span class="delimiter">(</span><a href="#141183" title="K">k</a>, <a href="#141564" title="Int">hc</a>, <a href="#141184" title="V">v</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(kv: (K, V))TrieMap.this.type" id="136882">+=</a><span class="delimiter">(</span><a title="(K, V)" id="141565">kv</a>: <a href="../../Tuple2.scala.html#783" title="(K, V)" class="delimiter">(</a>K, V<span class="delimiter">)</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#136881" title="(k: K, v: V)Unit">update</a><span class="delimiter">(</span><a href="#141565" title="(K, V)">kv</a>.<a href="../../Tuple2.scala.html#29956" title="=&gt; K">_1</a>, <a href="#141565" title="(K, V)">kv</a>.<a href="../../Tuple2.scala.html#29958" title="=&gt; V">_2</a><span class="delimiter">)</span>
    <a href="#9120" title="TrieMap.this.type" class="keyword">this</a>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(k: K)Option[V]" id="136883">remove</a><span class="delimiter">(</span><a title="K" id="141590">k</a>: <a href="#9219" title="K">K</a><span class="delimiter">)</span>: <a href="../../Option.scala.html#978" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="141599">hc</a> = <a href="#136876" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#141590" title="K">k</a><span class="delimiter">)</span>
    <a href="#136866" title="(k: K, v: V, hc: Int)Option[V]">removehc</a><span class="delimiter">(</span><a href="#141590" title="K">k</a>, <span title="Null(null)" class="keyword">null</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="V" class="delimiter">[</span><a href="#9220" title="V">V</a><span class="delimiter">]</span>, <a href="#141599" title="Int">hc</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(k: K)TrieMap.this.type" id="136884">-=</a><span class="delimiter">(</span><a title="K" id="141600">k</a>: <a href="#9219" title="K">K</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#136883" title="(k: K)Option[V]">remove</a><span class="delimiter">(</span><a href="#141600" title="K">k</a><span class="delimiter">)</span>
    <a href="#9120" title="TrieMap.this.type" class="keyword">this</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(k: K, v: V)Option[V]" id="136885">putIfAbsent</a><span class="delimiter">(</span><a title="K" id="141648">k</a>: <a href="#9219" title="K">K</a>, <a title="V" id="141649">v</a>: <a href="#9220" title="V">V</a><span class="delimiter">)</span>: <a href="../../Option.scala.html#978" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="141653">hc</a> = <a href="#136876" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#141648" title="K">k</a><span class="delimiter">)</span>
    <a href="#136864" title="(k: K, hc: Int, v: V, cond: AnyRef)Option[V]">insertifhc</a><span class="delimiter">(</span><a href="#141648" title="K">k</a>, <a href="#141653" title="Int">hc</a>, <a href="#141649" title="V">v</a>, <a href="#9127" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#137827" title="=&gt; Object">KEY_ABSENT</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(k: K, v: V)Boolean" id="136886">remove</a><span class="delimiter">(</span><a title="K" id="141634">k</a>: <a href="#9219" title="K">K</a>, <a title="V" id="141635">v</a>: <a href="#9220" title="V">V</a><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="141654">hc</a> = <a href="#136876" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#141634" title="K">k</a><span class="delimiter">)</span>
    <a href="#136866" title="(k: K, v: V, hc: Int)Option[V]">removehc</a><span class="delimiter">(</span><a href="#141634" title="K">k</a>, <a href="#141635" title="V">v</a>, <a href="#141654" title="Int">hc</a><span class="delimiter">)</span>.<a href="../../Option.scala.html#32200" title="=&gt; Boolean">nonEmpty</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(k: K, oldvalue: V, newvalue: V)Boolean" id="136887">replace</a><span class="delimiter">(</span><a title="K" id="141655">k</a>: <a href="#9219" title="K">K</a>, <a title="V" id="141656">oldvalue</a>: <a href="#9220" title="V">V</a>, <a title="V" id="141657">newvalue</a>: <a href="#9220" title="V">V</a><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="141665">hc</a> = <a href="#136876" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#141655" title="K">k</a><span class="delimiter">)</span>
    <a href="#136864" title="(k: K, hc: Int, v: V, cond: AnyRef)Option[V]">insertifhc</a><span class="delimiter">(</span><a href="#141655" title="K">k</a>, <a href="#141665" title="Int">hc</a>, <a href="#141657" title="V">newvalue</a>, <a href="#141656" title="V">oldvalue</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>.<a href="../../Option.scala.html#32200" title="=&gt; Boolean">nonEmpty</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(k: K, v: V)Option[V]" id="136888">replace</a><span class="delimiter">(</span><a title="K" id="141666">k</a>: <a href="#9219" title="K">K</a>, <a title="V" id="141667">v</a>: <a href="#9220" title="V">V</a><span class="delimiter">)</span>: <a href="../../Option.scala.html#978" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="141670">hc</a> = <a href="#136876" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#141666" title="K">k</a><span class="delimiter">)</span>
    <a href="#136864" title="(k: K, hc: Int, v: V, cond: AnyRef)Option[V]">insertifhc</a><span class="delimiter">(</span><a href="#141666" title="K">k</a>, <a href="#141670" title="Int">hc</a>, <a href="#141667" title="V">v</a>, <a href="#9127" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#137825" title="=&gt; Object">KEY_PRESENT</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Iterator[(K, V)]" id="136889">iterator</a>: <a href="../Iterator.scala.html#4100" title="Iterator[(K, V)]">Iterator</a><span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span> =
    <span title="Iterator[(K, V)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#136872" title="=&gt; Boolean">nonReadOnly</a><span class="delimiter">)</span> <a href="#136874" title="()scala.collection.Map[K,V]">readOnlySnapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../MapLike.scala.html#56847" title="=&gt; Iterator[(K, V)]">iterator</a>
    <span class="keyword">else</span> <a href="#141719" title="scala.collection.concurrent.TrieMapIterator[K,V]" class="keyword">new</a> <a href="#9136" title="scala.collection.concurrent.TrieMapIterator[K,V]">TrieMapIterator</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Int" id="136890">cachedSize</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="141742">r</a> = <a href="#136860" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#141742" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#136726" title="(ct: scala.collection.concurrent.TrieMap[K,V])Int">cachedSize</a><span class="delimiter">(</span><a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Int" id="136891">size</a>: <a href="../../Int.scala.html#321" title="Int">Int</a> =
    <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#136872" title="=&gt; Boolean">nonReadOnly</a><span class="delimiter">)</span> <a href="#136874" title="()scala.collection.Map[K,V]">readOnlySnapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../TraversableOnce.scala.html#27514" title="=&gt; Int">size</a>
    <span class="keyword">else</span> <a href="#136890" title="()Int">cachedSize</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; String" id="136892">stringPrefix</a> = <span title="String(&quot;TrieMap&quot;)" class="string">&quot;TrieMap&quot;</span>

<span class="delimiter">}</span>


<span class="keyword">object</span> <a title="scala.collection.concurrent.TrieMap.type" id="141808">TrieMap</a> <a href="#9122" title="scala.collection.concurrent.TrieMap.type" class="keyword">extends</a> <a href="../generic/MutableMapFactory.scala.html#9752" title="scala.collection.generic.MutableMapFactory[scala.collection.concurrent.TrieMap]">MutableMapFactory</a><span class="delimiter">[</span>TrieMap<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.INodeBase[_, _],scala.collection.concurrent.MainNode[_, _]]" id="138660">inodeupdater</a> = <span title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater.type">AtomicReferenceFieldUpdater</span>.<span title="(x$1: Class[scala.collection.concurrent.INodeBase[_, _]], x$2: Class[scala.collection.concurrent.MainNode[_, _]], x$3: String)java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.INodeBase[_, _],scala.collection.concurrent.MainNode[_, _]]">newUpdater</span><span class="delimiter">(</span>classOf<span title="Class[scala.collection.concurrent.INodeBase[_, _]](classOf[scala.collection.concurrent.INodeBase])" class="delimiter">[</span>INodeBase<span class="delimiter">[</span>_, _<span class="delimiter">]</span><span class="delimiter">]</span>, classOf<span title="Class[scala.collection.concurrent.MainNode[_, _]](classOf[scala.collection.concurrent.MainNode])" class="delimiter">[</span>MainNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span><span class="delimiter">]</span>, <span title="String(&quot;mainnode&quot;)" class="string">&quot;mainnode&quot;</span><span class="delimiter">)</span>

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[K, V]=&gt; scala.collection.generic.CanBuildFrom[scala.collection.concurrent.TrieMap.Coll,(K, V),scala.collection.concurrent.TrieMap[K,V]]" id="138662">canBuildFrom</a><span class="delimiter">[</span><a title="" id="138665">K</a>, <a title="" id="138666">V</a><span class="delimiter">]</span>: <a href="../generic/CanBuildFrom.scala.html#9806" title="scala.collection.generic.CanBuildFrom[scala.collection.concurrent.TrieMap.Coll,(K, V),scala.collection.concurrent.TrieMap[K,V]]">CanBuildFrom</a><span class="delimiter">[</span>Coll, <span class="delimiter">(</span>K, V<span class="delimiter">)</span>, TrieMap<span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="scala.collection.concurrent.TrieMap.MapCanBuildFrom[K,V]" class="keyword">new</span> <a href="../generic/GenMapFactory.scala.html#30075" title="scala.collection.concurrent.TrieMap.MapCanBuildFrom[K,V]">MapCanBuildFrom</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="[K, V]=&gt; scala.collection.concurrent.TrieMap[K,V]" id="138667">empty</a><span class="delimiter">[</span><a title="" id="138670">K</a>, <a title="" id="138671">V</a><span class="delimiter">]</span>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <a href="#136855" title="()scala.collection.concurrent.TrieMap[K,V]" class="keyword">new</a> <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>

  <span class="keyword">class</span> <a title="class MangledHashing[K] extends AnyRef with scala.util.hashing.Hashing[K]" id="138672">MangledHashing</a><span class="delimiter">[</span><a title="" id="138673">K</a><span class="delimiter">]</span> <a href="#138672" title="scala.collection.concurrent.TrieMap.MangledHashing[K]" class="keyword">extends</a> <a href="../../util/hashing/Hashing.scala.html#19081" title="scala.util.hashing.Hashing[K]">Hashing</a><span class="delimiter">[</span>K<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(k: K)Int" id="138675">hash</a><span class="delimiter">(</span><a title="K" id="141803">k</a>: <a href="#138673" title="K">K</a><span class="delimiter">)</span>= scala.util.hashing.<a href="../../util/hashing/package.scala.html#22395" title="(v: Int)Int">byteswap32</a><span class="delimiter">(</span><a href="#141803" title="K">k</a>.<span title="()Int">##</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>collection<span class="delimiter">]</span> <span class="keyword">class</span> <a title="class TrieMapIterator[K, V] extends AnyRef with Iterator[(K, V)]" id="9136">TrieMapIterator</a><span class="delimiter">[</span><a title="" id="141722">K</a>, <a title="" id="141723">V</a><span class="delimiter">]</span><a href="#9136" title="scala.collection.concurrent.TrieMapIterator[K,V]" class="delimiter">(</a><span class="keyword">var</span> <a title="Int" id="141715">level</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <span class="keyword">private</span> <span class="keyword">var</span> <a title="scala.collection.concurrent.TrieMap[K,V]" id="141716">ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="Boolean" id="141719">mustInit</a>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../Iterator.scala.html#4100" title="Iterator[(K, V)]">Iterator</a><span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Array[Array[scala.collection.concurrent.BasicNode]]" id="141689">stack</a> = <span title="Array[Array[scala.collection.concurrent.BasicNode]]" class="keyword">new</span> <a href="../../Array.scala.html#174" title="Array[Array[scala.collection.concurrent.BasicNode]]">Array</a><span class="delimiter">[</span>Array<span class="delimiter">[</span>BasicNode<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Array[Int]" id="141692">stackpos</a> = <span title="Array[Int]" class="keyword">new</span> <a href="../../Array.scala.html#174" title="Array[Int]">Array</a><span class="delimiter">[</span>Int<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="141695">depth</a> = -<span title="Int(-1)" class="int">1</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Iterator[(K, V)]" id="141698">subiter</a>: <a href="../Iterator.scala.html#4100" title="Iterator[(K, V)]">Iterator</a><span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span> = <span title="Null(null)" class="keyword">null</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="scala.collection.concurrent.KVNode[K,V]" id="141701">current</a>: <a href="#9141" title="scala.collection.concurrent.KVNode[K,V]">KVNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span title="Null(null)" class="keyword">null</span>

  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#141719" title="Boolean">mustInit</a><span class="delimiter">)</span> <a href="#141707" title="()Unit">initialize</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="141703">hasNext</a> = <span class="delimiter">(</span><a href="#141701" title="=&gt; scala.collection.concurrent.KVNode[K,V]">current</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="../../Boolean.scala.html#27149" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#141698" title="=&gt; Iterator[(K, V)]">subiter</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()(K, V)" id="141704">next</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span title="(K, V)" class="keyword">if</span> <span class="delimiter">(</span><a href="#141703" title="=&gt; Boolean">hasNext</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="(K, V)" id="141826">r</a>: <a href="../../Tuple2.scala.html#783" title="(K, V)" class="delimiter">(</a>K, V<span class="delimiter">)</span> = <span title="Null(null)" class="keyword">null</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#141698" title="=&gt; Iterator[(K, V)]">subiter</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#141826" title="(K, V)">r</a> = <a href="#141698" title="=&gt; Iterator[(K, V)]">subiter</a>.<a href="../Iterator.scala.html#36069" title="()(K, V)">next</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#141706" title="()Unit">checkSubiter</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#141826" title="(K, V)">r</a> = <a href="#141701" title="=&gt; scala.collection.concurrent.KVNode[K,V]">current</a>.<a href="#137110" title="=&gt; (K, V)">kvPair</a>
      <a href="#141708" title="()Unit">advance</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#141826" title="(K, V)">r</a>
  <span class="delimiter">}</span> <span class="keyword">else</span> <a href="../Iterator.scala.html#4101" title="scala.collection.Iterator.type">Iterator</a>.<a href="../Iterator.scala.html#66854" title="=&gt; Iterator[Nothing]">empty</a>.<a href="../Iterator.scala.html#36069" title="()Nothing">next</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: scala.collection.concurrent.INode[K,V])Unit" id="141705">readin</a><span class="delimiter">(</span><a title="scala.collection.concurrent.INode[K,V]" id="141830">in</a>: <a href="#9126" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#141830" title="scala.collection.concurrent.INode[K,V]">in</a>.<a href="#136713" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">gcasRead</a><a href="#1440270" title="scala.collection.concurrent.CNode[K,V]" class="delimiter">(</a><a href="#141716" title="=&gt; scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#1440267" title="Unit" id="1440270">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
      <a href="#141695" title="(x$1: Int)Unit">depth</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
      <a href="../../Array.scala.html#25964" title="(i: Int, x: Array[scala.collection.concurrent.BasicNode])Unit">stack</a><span class="delimiter">(</span><a href="#141695" title="=&gt; Int">depth</a><span class="delimiter">)</span> = cn.<a href="#137090" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>
      <a href="../../Array.scala.html#25964" title="(i: Int, x: Int)Unit">stackpos</a><span class="delimiter">(</span><a href="#141695" title="=&gt; Int">depth</a><span class="delimiter">)</span> = -<span title="Int(-1)" class="int">1</span>
      <a href="#141708" title="()Unit">advance</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#1440267" title="Unit" id="1440271">tn</a>: TNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
      <a href="#141701" title="(x$1: scala.collection.concurrent.KVNode[K,V])Unit">current</a> = tn
    <span class="keyword">case</span> <a href="#1440267" title="Unit" id="1440272">ln</a>: LNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
      <a href="#141698" title="(x$1: Iterator[(K, V)])Unit">subiter</a> = ln.<a href="#137277" title="=&gt; scala.collection.immutable.ListMap[K,V]">listmap</a>.<a href="../immutable/ListMap.scala.html#137297" title="=&gt; Iterator[(K, V)]">iterator</a>
      <a href="#141706" title="()Unit">checkSubiter</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#1440267" title="Unit" id="1440273" class="keyword">null</a> =&gt;
      <a href="#141701" title="(x$1: scala.collection.concurrent.KVNode[K,V])Unit">current</a> = <span title="Null(null)" class="keyword">null</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="141706">checkSubiter</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#27146" title="=&gt; Boolean">!</a><a href="#141698" title="=&gt; Iterator[(K, V)]">subiter</a>.<a href="../Iterator.scala.html#36068" title="=&gt; Boolean">hasNext</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#141698" title="(x$1: Iterator[(K, V)])Unit">subiter</a> = <span title="Null(null)" class="keyword">null</span>
    <a href="#141708" title="()Unit">advance</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="141707">initialize</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../../Predef.scala.html#7194" title="(assertion: Boolean)Unit">assert</a><span class="delimiter">(</span><a href="#141716" title="=&gt; scala.collection.concurrent.TrieMap[K,V]">ct</a>.<a href="#136871" title="=&gt; Boolean">isReadOnly</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="141853">r</a> = <a href="#141716" title="scala.collection.concurrent.TrieMap[K,V]" id="141856">ct</a>.<a href="#141202" title="Boolean" id="141857">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#141705" title="(in: scala.collection.concurrent.INode[K,V])Unit">readin</a><span class="delimiter">(</span><a href="#141853" title="scala.collection.concurrent.INode[K,V]">r</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="141708">advance</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../Unit.scala.html#1515" title="Unit">Unit</a> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#141695" title="=&gt; Int">depth</a> <a href="../../Int.scala.html#26456" title="(x: Int)Boolean">&gt;=</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="141862">npos</a> = <a href="../../Array.scala.html#25963" title="(i: Int)Int">stackpos</a><span class="delimiter">(</span><a href="#141695" title="=&gt; Int">depth</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#141862" title="Int">npos</a> <a href="../../Int.scala.html#26435" title="(x: Int)Boolean">&lt;</a> <a href="../../Array.scala.html#25963" title="(i: Int)Array[scala.collection.concurrent.BasicNode]">stack</a><span class="delimiter">(</span><a href="#141695" title="=&gt; Int">depth</a><span class="delimiter">)</span>.<a href="../../Array.scala.html#25962" title="=&gt; Int">length</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../Array.scala.html#25964" title="(i: Int, x: Int)Unit">stackpos</a><span class="delimiter">(</span><a href="#141695" title="=&gt; Int">depth</a><span class="delimiter">)</span> = <a href="#141862" title="Int">npos</a>
      <a href="../../Array.scala.html#25963" title="(i: Int)Array[scala.collection.concurrent.BasicNode]">stack</a><a href="../../Array.scala.html#25963" title="(i: Int)scala.collection.concurrent.BasicNode" class="delimiter">(</a><a href="#141695" title="=&gt; Int">depth</a><span class="delimiter">)</span><a href="#1440286" title="scala.collection.concurrent.SNode[K,V]" class="delimiter">(</a><a href="#141862" title="Int">npos</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#1440285" title="Unit" id="1440286">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
          <a href="#141701" title="(x$1: scala.collection.concurrent.KVNode[K,V])Unit">current</a> = sn
        <span class="keyword">case</span> <a href="#1440285" title="Unit" id="1440287">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
          <a href="#141705" title="(in: scala.collection.concurrent.INode[K,V])Unit">readin</a><a href="#1440289" title="(x: Unit)Unit" class="delimiter">(</a>in<span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#141695" title="(x$1: Int)Unit">depth</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-=</a> <span title="Int(1)" class="int">1</span>
      <a href="#141708" title="()Unit">advance</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#141701" title="(x$1: scala.collection.concurrent.KVNode[K,V])Unit">current</a> = <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(_lev: Int, _ct: scala.collection.concurrent.TrieMap[K,V], _mustInit: Boolean)scala.collection.concurrent.TrieMapIterator[K,V]" id="141709">newIterator</a><span class="delimiter">(</span><a title="Int" id="141887">_lev</a>: <a href="../../Int.scala.html#321" title="Int">Int</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="141888">_ct</a>: <a href="#9120" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="Boolean" id="141889">_mustInit</a>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a><span class="delimiter">)</span> = <span title="scala.collection.concurrent.TrieMapIterator[K,V]" class="keyword">new</span> <a href="#9136" title="scala.collection.concurrent.TrieMapIterator[K,V]">TrieMapIterator</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#141887" title="Int">_lev</a>, <a href="#141888" title="scala.collection.concurrent.TrieMap[K,V]">_ct</a>, <a href="#141889" title="Boolean">_mustInit</a><span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(it: scala.collection.concurrent.TrieMapIterator[K,V])Unit" id="141710">dupTo</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TrieMapIterator[K,V]" id="141892">it</a>: <a href="#9136" title="scala.collection.concurrent.TrieMapIterator[K,V]">TrieMapIterator</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#141892" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#141715" title="(x$1: Int)Unit">level</a> = <a href="#9136" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#141715" title="=&gt; Int">level</a>
    <a href="#141892" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#141716" title="(x$1: scala.collection.concurrent.TrieMap[K,V])Unit">ct</a> = <a href="#9136" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#141716" title="=&gt; scala.collection.concurrent.TrieMap[K,V]">ct</a>
    <a href="#141892" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#141695" title="(x$1: Int)Unit">depth</a> = <a href="#9136" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#141695" title="=&gt; Int">depth</a>
    <a href="#141892" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#141701" title="(x$1: scala.collection.concurrent.KVNode[K,V])Unit">current</a> = <a href="#9136" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#141701" title="=&gt; scala.collection.concurrent.KVNode[K,V]">current</a>

    // these need a deep copy
    <a href="../../Array.scala.html#175" title="Array.type">Array</a>.<a href="../../Array.scala.html#41577" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#9136" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#141689" title="=&gt; Array[Array[scala.collection.concurrent.BasicNode]]">stack</a>, <span title="Int(0)" class="int">0</span>, <a href="#141892" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#141689" title="=&gt; Array[Array[scala.collection.concurrent.BasicNode]]">stack</a>, <span title="Int(0)" class="int">0</span>, <span title="Int(7)" class="int">7</span><span class="delimiter">)</span>
    <a href="../../Array.scala.html#175" title="Array.type">Array</a>.<a href="../../Array.scala.html#41577" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#9136" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#141692" title="=&gt; Array[Int]">stackpos</a>, <span title="Int(0)" class="int">0</span>, <a href="#141892" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#141692" title="=&gt; Array[Int]">stackpos</a>, <span title="Int(0)" class="int">0</span>, <span title="Int(7)" class="int">7</span><span class="delimiter">)</span>

    // this one needs to be evaluated
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#9136" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#141698" title="=&gt; Iterator[(K, V)]">subiter</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#141892" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#141698" title="(x$1: Iterator[(K, V)])Unit">subiter</a> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[(K, V)]" id="141900">lst</a> = <a href="#9136" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#141698" title="=&gt; Iterator[(K, V)]">subiter</a>.<a href="../TraversableOnce.scala.html#27587" title="=&gt; List[(K, V)]">toList</a>
      <a href="#9136" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#141698" title="(x$1: Iterator[(K, V)])Unit">subiter</a> = <a href="#141900" title="List[(K, V)]">lst</a>.<a href="../LinearSeqLike.scala.html#55639" title="=&gt; Iterator[(K, V)]">iterator</a>
      <a href="#141892" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#141698" title="(x$1: Iterator[(K, V)])Unit">subiter</a> = <a href="#141900" title="List[(K, V)]">lst</a>.<a href="../LinearSeqLike.scala.html#55639" title="=&gt; Iterator[(K, V)]">iterator</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Returns a sequence of iterators over subsets of this iterator.
   *  It's used to ease the implementation of splitters for a parallel version of the TrieMap.
   */
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="()Seq[Iterator[(K, V)]]" id="141711">subdivide</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../Seq.scala.html#4340" title="Seq[Iterator[(K, V)]]">Seq</a><span class="delimiter">[</span>Iterator<span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">]</span> = <span title="Seq[Iterator[(K, V)]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#141698" title="=&gt; Iterator[(K, V)]">subiter</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    // the case where an LNode is being iterated
    <span class="keyword">val</span> <a title="Iterator[(K, V)]" id="141903">it</a> = <a href="#141698" title="=&gt; Iterator[(K, V)]">subiter</a>
    <a href="#141698" title="(x$1: Iterator[(K, V)])Unit">subiter</a> = <span title="Null(null)" class="keyword">null</span>
    <a href="#141708" title="()Unit">advance</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#9136" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#141715" title="(x$1: Int)Unit">level</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <a href="../generic/GenericCompanion.scala.html#29254" title="(elems: Iterator[(K, V)]*)Seq[Iterator[(K, V)]]">Seq</a><span class="delimiter">(</span><a href="#141903" title="Iterator[(K, V)]">it</a>, <a href="#9136" title="scala.collection.concurrent.TrieMapIterator[K,V]" class="keyword">this</a><span class="delimiter">)</span>
  <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Seq[scala.collection.concurrent.TrieMapIterator[K,V]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#141695" title="=&gt; Int">depth</a> <a href="../../Int.scala.html#26421" title="(x: Int)Boolean">==</a> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#9136" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#141715" title="(x$1: Int)Unit">level</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <a href="../generic/GenericCompanion.scala.html#29254" title="(elems: scala.collection.concurrent.TrieMapIterator[K,V]*)Seq[scala.collection.concurrent.TrieMapIterator[K,V]]">Seq</a><span class="delimiter">(</span><a href="#9136" title="scala.collection.concurrent.TrieMapIterator[K,V]" class="keyword">this</a><span class="delimiter">)</span>
  <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="141927">d</a> = <span title="Int(0)" class="int">0</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#141927" title="Int">d</a> <a href="../../Int.scala.html#26442" title="(x: Int)Boolean">&lt;=</a> <a href="#141695" title="=&gt; Int">depth</a><span class="delimiter">)</span> <a href="#141928" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="Int" id="141933">rem</a> = <a href="../../Array.scala.html#25963" title="(i: Int)Array[scala.collection.concurrent.BasicNode]">stack</a><span class="delimiter">(</span><a href="#141927" title="Int">d</a><span class="delimiter">)</span>.<a href="../../Array.scala.html#25962" title="=&gt; Int">length</a> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#26485" title="(x: Int)Int">-</a> <a href="../../Array.scala.html#25963" title="(i: Int)Int">stackpos</a><span class="delimiter">(</span><a href="#141927" title="Int">d</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#141933" title="Int">rem</a> <a href="../../Int.scala.html#26449" title="(x: Int)Boolean">&gt;</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a href="#1440296" title="(x: (Array[scala.collection.concurrent.BasicNode], Array[scala.collection.concurrent.BasicNode]))(Array[scala.collection.concurrent.BasicNode], Array[scala.collection.concurrent.BasicNode])" class="delimiter">(</a><a href="../../Tuple2.scala.html#29956" title="Array[scala.collection.concurrent.BasicNode]" id="141947">arr1</a>, <a href="../../Tuple2.scala.html#29958" title="Array[scala.collection.concurrent.BasicNode]" id="141948">arr2</a><span class="delimiter">)</span> = <a href="../../Array.scala.html#25963" title="(i: Int)Array[scala.collection.concurrent.BasicNode]">stack</a><a href="../../Predef.scala.html#7265" title="(xs: Array[scala.collection.concurrent.BasicNode])scala.collection.mutable.ArrayOps[scala.collection.concurrent.BasicNode]" class="delimiter">(</a><a href="#141927" title="Int">d</a><span class="delimiter">)</span>.<a href="../IndexedSeqOptimized.scala.html#28484" title="(n: Int)Array[scala.collection.concurrent.BasicNode]">drop</a><a href="../../Predef.scala.html#7265" title="(xs: Array[scala.collection.concurrent.BasicNode])scala.collection.mutable.ArrayOps[scala.collection.concurrent.BasicNode]" class="delimiter">(</a><a href="../../Array.scala.html#25963" title="(i: Int)Int">stackpos</a><span class="delimiter">(</span><a href="#141927" title="Int">d</a><span class="delimiter">)</span> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="../IndexedSeqOptimized.scala.html#28487" title="(n: Int)(Array[scala.collection.concurrent.BasicNode], Array[scala.collection.concurrent.BasicNode])">splitAt</a><a href="../../Tuple2.scala.html#783" title="(Array[scala.collection.concurrent.BasicNode], Array[scala.collection.concurrent.BasicNode]) @unchecked" class="delimiter">(</a><a href="#141933" title="Int">rem</a> <a href="../../Int.scala.html#26499" title="(x: Int)Int">/</a> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span>
        <a href="../../Array.scala.html#25964" title="(i: Int, x: Array[scala.collection.concurrent.BasicNode])Unit">stack</a><span class="delimiter">(</span><a href="#141927" title="Int">d</a><span class="delimiter">)</span> = <a href="#141947" title="Array[scala.collection.concurrent.BasicNode]">arr1</a>
        <a href="../../Array.scala.html#25964" title="(i: Int, x: Int)Unit">stackpos</a><span class="delimiter">(</span><a href="#141927" title="Int">d</a><span class="delimiter">)</span> = -<span title="Int(-1)" class="int">1</span>
        <span class="keyword">val</span> <a title="scala.collection.concurrent.TrieMapIterator[K,V]" id="141949">it</a> = <a href="#141709" title="(_lev: Int, _ct: scala.collection.concurrent.TrieMap[K,V], _mustInit: Boolean)scala.collection.concurrent.TrieMapIterator[K,V]">newIterator</a><span class="delimiter">(</span><a href="#141715" title="=&gt; Int">level</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span>, <a href="#141716" title="=&gt; scala.collection.concurrent.TrieMap[K,V]">ct</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
        <a href="#141949" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="../../Array.scala.html#25964" title="(i: Int, x: Array[scala.collection.concurrent.BasicNode])Unit">stack</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> = <a href="#141948" title="Array[scala.collection.concurrent.BasicNode]">arr2</a>
        <a href="#141949" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="../../Array.scala.html#25964" title="(i: Int, x: Int)Unit">stackpos</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> = -<span title="Int(-1)" class="int">1</span>
        <a href="#141949" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#141695" title="(x$1: Int)Unit">depth</a> = <span title="Int(0)" class="int">0</span>
        <a href="#141949" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#141708" title="()Unit">advance</a><span class="delimiter">(</span><span class="delimiter">)</span> // &lt;-- fix it
        <a href="#9136" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#141715" title="(x$1: Int)Unit">level</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
        <span title="Nothing" class="keyword">return</span> <a href="../generic/GenericCompanion.scala.html#29254" title="(elems: scala.collection.concurrent.TrieMapIterator[K,V]*)Seq[scala.collection.concurrent.TrieMapIterator[K,V]]">Seq</a><span class="delimiter">(</span><a href="#9136" title="scala.collection.concurrent.TrieMapIterator[K,V]" class="keyword">this</a>, <a href="#141949" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#141927" title="Int">d</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>
    <a href="#9136" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#141715" title="(x$1: Int)Unit">level</a> <a href="../../Int.scala.html#26478" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <a href="../generic/GenericCompanion.scala.html#29254" title="(elems: scala.collection.concurrent.TrieMapIterator[K,V]*)Seq[scala.collection.concurrent.TrieMapIterator[K,V]]">Seq</a><span class="delimiter">(</span><a href="#9136" title="scala.collection.concurrent.TrieMapIterator[K,V]" class="keyword">this</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="141712">printDebug</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../../Predef.scala.html#7224" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;ctrie iterator&quot;)" class="string">&quot;ctrie iterator&quot;</span><span class="delimiter">)</span>
    <a href="../../Predef.scala.html#7224" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="../../Predef.scala.html#7263" title="implicit scala.Predef.intArrayOps : (xs: Array[Int])scala.collection.mutable.ArrayOps[Int]">stackpos</a>.<a href="../TraversableOnce.scala.html#27607" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="../../Predef.scala.html#7224" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;depth: &quot;)" class="string">&quot;depth: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#141695" title="=&gt; Int">depth</a><span class="delimiter">)</span>
    <a href="../../Predef.scala.html#7224" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;curr.: &quot;)" class="string">&quot;curr.: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#141701" title="=&gt; scala.collection.concurrent.KVNode[K,V]">current</a><span class="delimiter">)</span>
    <a href="../../Predef.scala.html#7224" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="../../Predef.scala.html#7265" title="(xs: Array[Array[scala.collection.concurrent.BasicNode]])scala.collection.mutable.ArrayOps[Array[scala.collection.concurrent.BasicNode]]">stack</a>.<a href="../TraversableOnce.scala.html#27607" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">object</span> <a title="scala.collection.concurrent.RestartException.type" id="142315">RestartException</a> <a href="#9098" title="scala.collection.concurrent.RestartException.type" class="keyword">extends</a> <a href="../../util/control/ControlThrowable.scala.html#18950" title="scala.util.control.ControlThrowable">ControlThrowable</a>


/** Only used for ctrie serialization. */
@SerialVersionUID<span class="delimiter">(</span><span class="long">0L</span> - <span class="long">7237891413820527142L</span><span class="delimiter">)</span>
<span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> case <span class="keyword">object</span> <a href="#142320" title="scala.collection.concurrent.TrieMapSerializationEnd.type" id="142328">TrieMapSerializationEnd</a>


<a href="#9101" title="scala.collection.concurrent.TrieMapSerializationEnd.type" class="keyword">private</a><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">object</span> <a title="scala.collection.concurrent.Debug.type" id="9082">Debug</a> <a href="#9083" title="scala.collection.concurrent.Debug.type" class="delimiter">{</a>
  <span class="keyword">import</span> scala.collection._

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentLinkedQueue[AnyRef]" id="142332">logbuffer</a> = <span title="java.util.concurrent.ConcurrentLinkedQueue[AnyRef]" class="keyword">new</span> java.util.concurrent.<span title="java.util.concurrent.ConcurrentLinkedQueue[AnyRef]">ConcurrentLinkedQueue</span><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="(s: AnyRef)Boolean" id="142333">log</a><span class="delimiter">(</span><a title="AnyRef" id="142439">s</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span> = <a href="#142331" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[AnyRef]">logbuffer</a>.<span title="(x$1: AnyRef)Boolean">add</span><span class="delimiter">(</span><a href="#142439" title="AnyRef">s</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()Unit" id="142334">flush</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="AnyRef" id="142461">s</a> &lt;- <a href="../JavaConversions.scala.html#3429" title="scala.collection.JavaConversions.type">JavaConversions</a>.<a href="../convert/WrapAsScala.scala.html#103435" title="(it: java.util.Iterator[AnyRef])Iterator[AnyRef]">asScalaIterator</a><a href="../Iterator.scala.html#36118" title="(f: AnyRef =&gt; Unit)Unit" class="delimiter">(</a><a href="#142331" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[AnyRef]">logbuffer</a>.<span title="()java.util.Iterator[AnyRef]">iterator</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Console.scala.html#136" title="Console.type">Console</a>.<a href="../../Console.scala.html#32605" title="=&gt; java.io.PrintStream">out</a>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><a href="#142461" title="AnyRef">s</a>.<span title="()String">toString</span><span class="delimiter">)</span>
    <a href="#142331" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[AnyRef]">logbuffer</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="142335">clear</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#142331" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[AnyRef]">logbuffer</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>