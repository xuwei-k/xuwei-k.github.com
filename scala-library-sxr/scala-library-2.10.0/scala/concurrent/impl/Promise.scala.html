<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/concurrent/impl/Promise.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2013, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

<span class="keyword">package</span> scala.concurrent.impl

<span class="keyword">import</span> scala.concurrent.<span class="delimiter">{</span> ExecutionContext, CanAwait, OnCompleteRunnable, TimeoutException, ExecutionException <span class="delimiter">}</span>
<span class="keyword">import</span> scala.concurrent.duration.<span class="delimiter">{</span> Duration, Deadline, FiniteDuration, NANOSECONDS <span class="delimiter">}</span>
<span class="keyword">import</span> scala.annotation.tailrec
<span class="keyword">import</span> scala.util.control.NonFatal
<span class="keyword">import</span> scala.util.<span class="delimiter">{</span> Try, Success, Failure <span class="delimiter">}</span>

<span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait Promise[T] extends Object with scala.concurrent.Promise[T] with scala.concurrent.Future[T]" id="15961">Promise</a><span class="delimiter">[</span><a title="" id="16015">T</a><span class="delimiter">]</span> <a href="../../Unit.scala.html#1515" title="Unit" class="keyword">extends</a> scala.concurrent.<a href="../Promise.scala.html#15418" title="scala.concurrent.Promise[T]">Promise</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="keyword">with</span> scala.concurrent.<a href="../Future.scala.html#15442" title="scala.concurrent.Future[T]">Future</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; Promise.this.type" id="345500">future</a>: <span class="keyword">this</span>.<span class="keyword">type</span> = <a href="#15961" title="Promise.this.type" class="keyword">this</a>
<span class="delimiter">}</span>

/* Precondition: `executor` is prepared, i.e., `executor` has been returned from invocation of `prepare` on some other `ExecutionContext`.
 */
<span class="keyword">private</span> <span class="keyword">class</span> <a title="class CallbackRunnable[T] extends Object with Runnable with scala.concurrent.OnCompleteRunnable" id="15964">CallbackRunnable</a><span class="delimiter">[</span><a title="" id="16016">T</a><span class="delimiter">]</span><a href="#15964" title="scala.concurrent.impl.CallbackRunnable[T]" class="delimiter">(</a><span class="keyword">val</span> <a title="scala.concurrent.ExecutionContext" id="349961">executor</a>: <a href="../ExecutionContext.scala.html#15289" title="scala.concurrent.ExecutionContext">ExecutionContext</a>, <span class="keyword">val</span> <a title="scala.util.Try[T] =&gt; Any" id="349962">onComplete</a>: Try<span class="delimiter">[</span>T<span class="delimiter">]</span> =&gt; Any<span class="delimiter">)</span> <span class="keyword">extends</span> <span title="Runnable">Runnable</span> <span class="keyword">with</span> <a href="../Future.scala.html#15364" title="scala.concurrent.OnCompleteRunnable">OnCompleteRunnable</a> <span class="delimiter">{</span>
  // must be filled in before running it
  <span class="keyword">var</span> <a title="scala.util.Try[T]" id="349953">value</a>: <a href="../../util/Try.scala.html#18451" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="349955">run</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="../../Predef.scala.html#7198" title="(requirement: Boolean)Unit">require</a><span class="delimiter">(</span><a href="#349953" title="=&gt; scala.util.Try[T]">value</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> // must set value to non-null before running!
    <a href="#1445492" title="Unit" id="1445488" class="keyword">try</a> <a href="../../Function1.scala.html#27963" title="(v1: scala.util.Try[T])Any">onComplete</a><span title="Unit" class="delimiter">(</span><a href="#349953" title="=&gt; scala.util.Try[T]">value</a><span class="delimiter">)</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a href="../../util/control/NonFatal.scala.html#344304" title="Option[Throwable]" id="1445496">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="349969">e</a><span class="delimiter">)</span> =&gt; <a href="#349961" title="=&gt; scala.concurrent.ExecutionContext">executor</a> <a href="#1445492" title="(x: Unit)Unit">reportFailure</a> <a href="#349969" title="Throwable">e</a> <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(v: scala.util.Try[T])Unit" id="349956">executeWithValue</a><span class="delimiter">(</span><a title="scala.util.Try[T]" id="349970">v</a>: <a href="../../util/Try.scala.html#18451" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Unit.scala.html#1515" title="Unit">Unit</a> = <span class="delimiter">{</span>
    <a href="../../Predef.scala.html#7198" title="(requirement: Boolean)Unit">require</a><span class="delimiter">(</span><a href="#349953" title="=&gt; scala.util.Try[T]">value</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> // can't complete it twice
    <a href="#349953" title="(x$1: scala.util.Try[T])Unit">value</a> = <a href="#349970" title="scala.util.Try[T]">v</a>
    // Note that we cannot prepare the ExecutionContext at this point, since we might
    // already be running on a different thread!
    <a href="#349961" title="=&gt; scala.concurrent.ExecutionContext">executor</a>.<a href="../ExecutionContext.scala.html#324925" title="(runnable: Runnable)Unit">execute</a><span class="delimiter">(</span><a href="#15964" title="scala.concurrent.impl.CallbackRunnable[T]" class="keyword">this</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">object</span> <a title="scala.concurrent.impl.Promise.type" id="15962">Promise</a> <a href="#15963" title="scala.concurrent.impl.Promise.type" class="delimiter">{</a>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](source: scala.util.Try[T])scala.util.Try[T]" id="345473">resolveTry</a><span class="delimiter">[</span><a title="" id="345475">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.util.Try[T]" id="349975">source</a>: <a href="../../util/Try.scala.html#18451" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../util/Try.scala.html#18451" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = <a href="#349975" title="scala.util.Try[T]">source</a> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> Failure<a href="#1445497" title="scala.util.Try[T]" id="1445498" class="delimiter">(</a><a href="../../util/Try.scala.html#344253" title="Throwable" id="349978">t</a><span class="delimiter">)</span> =&gt; <a href="#345476" title="(throwable: Throwable)scala.util.Try[Nothing]">resolver</a><a href="#1445500" title="(x: scala.util.Try[T])scala.util.Try[T]" class="delimiter">(</a><a href="#349978" title="Throwable">t</a><span class="delimiter">)</span>
    <span class="keyword">case</span> _          =&gt; <a href="#1445500" title="(x: scala.util.Try[T])scala.util.Try[T]">source</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](throwable: Throwable)scala.util.Try[T]" id="345476">resolver</a><span class="delimiter">[</span><a title="" id="345478">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Throwable" id="349979">throwable</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>: <a href="../../util/Try.scala.html#18451" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = <a href="#349979" title="Throwable">throwable</a> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#1445505" title="scala.util.Try[T]" id="1445506">t</a>: scala.runtime.NonLocalReturnControl<span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <a href="../../util/Try.scala.html#344179" title="(value: T)scala.util.Success[T]">Success</a><a href="#1445511" title="(x: scala.util.Try[T])scala.util.Try[T]" class="delimiter">(</a>t.<a href="../../runtime/NonLocalReturnControl.scala.html#349994" title="=&gt; _">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#345478" title="T">T</a><span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#1445505" title="scala.util.Try[T]" id="1445507">t</a>: scala.util.control.ControlThrowable    =&gt; <a href="../../util/Try.scala.html#344249" title="(exception: Throwable)scala.util.Failure[Nothing]">Failure</a><a href="#1445511" title="(x: scala.util.Try[T])scala.util.Try[T]" class="delimiter">(</a><span title="(x$1: String, x$2: Throwable)java.util.concurrent.ExecutionException" class="keyword">new</span> <a href="../package.scala.html#22099" title="java.util.concurrent.ExecutionException">ExecutionException</a><span class="delimiter">(</span><span title="String(&quot;Boxed ControlThrowable&quot;)" class="string">&quot;Boxed ControlThrowable&quot;</span>, t<span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#1445505" title="scala.util.Try[T]" id="1445508">t</a>: InterruptedException                   =&gt; <a href="../../util/Try.scala.html#344249" title="(exception: Throwable)scala.util.Failure[Nothing]">Failure</a><a href="#1445511" title="(x: scala.util.Try[T])scala.util.Try[T]" class="delimiter">(</a><span title="(x$1: String, x$2: Throwable)java.util.concurrent.ExecutionException" class="keyword">new</span> <a href="../package.scala.html#22099" title="java.util.concurrent.ExecutionException">ExecutionException</a><span class="delimiter">(</span><span title="String(&quot;Boxed InterruptedException&quot;)" class="string">&quot;Boxed InterruptedException&quot;</span>, t<span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#1445505" title="scala.util.Try[T]" id="1445509">e</a>: Error                                  =&gt; <a href="../../util/Try.scala.html#344249" title="(exception: Throwable)scala.util.Failure[Nothing]">Failure</a><a href="#1445511" title="(x: scala.util.Try[T])scala.util.Try[T]" class="delimiter">(</a><span title="(x$1: String, x$2: Throwable)java.util.concurrent.ExecutionException" class="keyword">new</span> <a href="../package.scala.html#22099" title="java.util.concurrent.ExecutionException">ExecutionException</a><span class="delimiter">(</span><span title="String(&quot;Boxed Error&quot;)" class="string">&quot;Boxed Error&quot;</span>, e<span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> t                                         =&gt; <a href="../../util/Try.scala.html#344249" title="(exception: Throwable)scala.util.Failure[Nothing]">Failure</a><a href="#1445511" title="(x: scala.util.Try[T])scala.util.Try[T]" class="delimiter">(</a>t<span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** Default promise implementation.
   */
  <span class="keyword">class</span> <a title="class DefaultPromise[T] extends scala.concurrent.impl.AbstractPromise with scala.concurrent.impl.Promise[T]" id="345479">DefaultPromise</a><span class="delimiter">[</span><a title="" id="345480">T</a><span class="delimiter">]</span> <a href="#345479" title="scala.concurrent.impl.Promise.DefaultPromise[T]" class="keyword">extends</a> <a href="AbstractPromise.java.html#15955" title="scala.concurrent.impl.AbstractPromise">AbstractPromise</a> <span class="keyword">with</span> <a href="#15961" title="scala.concurrent.impl.Promise[T]">Promise</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">{</span> self =&gt;
    <a href="AbstractPromise.java.html#345486" title="(oldState: Any, newState: Any)Boolean">updateState</a><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <a href="../../collection/immutable/List.scala.html#10307" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span> // Start at &quot;No callbacks&quot;

    <span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="(atMost: scala.concurrent.duration.Duration)Boolean" id="345490">tryAwait</a><span class="delimiter">(</span><a title="scala.concurrent.duration.Duration" id="350037">atMost</a>: <a href="../duration/Duration.scala.html#15681" title="scala.concurrent.duration.Duration">Duration</a><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
      @tailrec
      <span class="keyword">def</span> <a title="(deadline: scala.concurrent.duration.Deadline, nextWait: scala.concurrent.duration.FiniteDuration)Boolean" id="350039">awaitUnsafe</a><span class="delimiter">(</span><a title="scala.concurrent.duration.Deadline" id="350042">deadline</a>: <a href="../duration/Deadline.scala.html#15633" title="scala.concurrent.duration.Deadline">Deadline</a>, <a title="scala.concurrent.duration.FiniteDuration" id="350043">nextWait</a>: <a href="../duration/Duration.scala.html#15645" title="scala.concurrent.duration.FiniteDuration">FiniteDuration</a><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#27146" title="=&gt; Boolean">!</a><a href="#345494" title="=&gt; Boolean">isCompleted</a> <a href="../../Boolean.scala.html#27150" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#350043" title="scala.concurrent.duration.FiniteDuration">nextWait</a> <a href="../../math/Ordered.scala.html#26072" title="(that: scala.concurrent.duration.Duration)Boolean">&gt;</a> <a href="../duration/Duration.scala.html#15682" title="scala.concurrent.duration.Duration.type">Duration</a>.<a href="../duration/Duration.scala.html#346104" title="=&gt; scala.concurrent.duration.FiniteDuration">Zero</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Long" id="350047">ms</a> = <a href="#350043" title="scala.concurrent.duration.FiniteDuration">nextWait</a>.<a href="../duration/Duration.scala.html#346019" title="=&gt; Long">toMillis</a>
          <span class="keyword">val</span> <a title="Int" id="350048">ns</a> = <span class="delimiter">(</span><a href="#350043" title="scala.concurrent.duration.FiniteDuration">nextWait</a>.<a href="../duration/Duration.scala.html#346017" title="=&gt; Long">toNanos</a> <a href="../../Long.scala.html#26873" title="(x: Long)Long">%</a> <span title="Long(1000000L)" class="long">1000000l</span><span class="delimiter">)</span>.<a href="../../Long.scala.html#26770" title="=&gt; Int">toInt</a> // as per object.wait spec

          <a href="#345479" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#27146" title="=&gt; Boolean">!</a><a href="#345494" title="=&gt; Boolean">isCompleted</a><span class="delimiter">)</span> <a href="#345479" title="(x$1: Long, x$2: Int)Unit">wait</a><span class="delimiter">(</span><a href="#350047" title="Long">ms</a>, <a href="#350048" title="Int">ns</a><span class="delimiter">)</span> <span class="delimiter">}</span>

          <a href="#350039" title="(deadline: scala.concurrent.duration.Deadline, nextWait: scala.concurrent.duration.FiniteDuration)Boolean">awaitUnsafe</a><span class="delimiter">(</span><a href="#350042" title="scala.concurrent.duration.Deadline">deadline</a>, <a href="#350042" title="scala.concurrent.duration.Deadline">deadline</a>.<a href="../duration/Deadline.scala.html#346000" title="=&gt; scala.concurrent.duration.FiniteDuration">timeLeft</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span>
          <a href="#345494" title="=&gt; Boolean">isCompleted</a>
      <span class="delimiter">}</span>
      @tailrec
      <span class="keyword">def</span> <a title="()Boolean" id="350040">awaitUnbounded</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#345494" title="=&gt; Boolean">isCompleted</a><span class="delimiter">)</span> <span title="Boolean(true)" class="keyword">true</span>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#345479" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#27146" title="=&gt; Boolean">!</a><a href="#345494" title="=&gt; Boolean">isCompleted</a><span class="delimiter">)</span> <a href="#345479" title="()Unit">wait</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>
          <a href="#350040" title="()Boolean">awaitUnbounded</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">import</span> <a href="../duration/Duration.scala.html#15682" title="scala.concurrent.duration.Duration.type">Duration</a>.Undefined
      <a href="#350037" title="scala.concurrent.duration.Duration">atMost</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> u <span class="keyword">if</span> u <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../duration/Duration.scala.html#346106" title="=&gt; scala.concurrent.duration.Duration.Infinite">Undefined</a> =&gt; <a href="#1445530" title="(x: Boolean)Boolean" class="keyword">throw</a> <span title="(x$1: String)IllegalArgumentException" class="keyword">new</span> <a href="../../package.scala.html#22179" title="IllegalArgumentException">IllegalArgumentException</a><span class="delimiter">(</span><span title="String(&quot;cannot wait for Undefined period&quot;)" class="string">&quot;cannot wait for Undefined period&quot;</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../duration/Duration.scala.html#15682" title="scala.concurrent.duration.Duration.type">Duration</a>.<a href="../duration/Duration.scala.html#346109" title="Boolean" id="1445524">Inf</a>        =&gt; <a href="#1445530" title="(x: Boolean)Boolean">awaitUnbounded</a>
        <span class="keyword">case</span> <a href="../duration/Duration.scala.html#15682" title="scala.concurrent.duration.Duration.type">Duration</a>.<a href="../duration/Duration.scala.html#346111" title="Boolean" id="1445525">MinusInf</a>   =&gt; <a href="#1445530" title="(x: Boolean)Boolean">isCompleted</a>
        <span class="keyword">case</span> <a href="#1445519" title="Boolean" id="1445526">f</a>: FiniteDuration   =&gt; <a href="#1445530" title="(x: Boolean)Boolean" class="keyword">if</a> <span class="delimiter">(</span>f <a href="../../math/Ordered.scala.html#26072" title="(that: scala.concurrent.duration.Duration)Boolean">&gt;</a> <a href="../duration/Duration.scala.html#15682" title="scala.concurrent.duration.Duration.type">Duration</a>.<a href="../duration/Duration.scala.html#346104" title="=&gt; scala.concurrent.duration.FiniteDuration">Zero</a><span class="delimiter">)</span> <a href="#350039" title="(deadline: scala.concurrent.duration.Deadline, nextWait: scala.concurrent.duration.FiniteDuration)Boolean">awaitUnsafe</a><span class="delimiter">(</span>f.<a href="../duration/Duration.scala.html#346025" title="=&gt; scala.concurrent.duration.Deadline">fromNow</a>, f<span class="delimiter">)</span> <span class="keyword">else</span> <a href="#345494" title="=&gt; Boolean">isCompleted</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    @throws<span class="delimiter">(</span>classOf<span class="delimiter">[</span>TimeoutException<span class="delimiter">]</span><span class="delimiter">)</span>
    @throws<span class="delimiter">(</span>classOf<span class="delimiter">[</span>InterruptedException<span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(atMost: scala.concurrent.duration.Duration)(implicit permit: scala.concurrent.CanAwait)DefaultPromise.this.type" id="345491">ready</a><span class="delimiter">(</span><a title="scala.concurrent.duration.Duration" id="350074">atMost</a>: <a href="../duration/Duration.scala.html#15681" title="scala.concurrent.duration.Duration">Duration</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.CanAwait" id="350075">permit</a>: <a href="../package.scala.html#15331" title="scala.concurrent.CanAwait">CanAwait</a><span class="delimiter">)</span>: <span class="keyword">this</span>.<span class="keyword">type</span> =
      <span title="DefaultPromise.this.type" class="keyword">if</span> <span class="delimiter">(</span><a href="#345494" title="=&gt; Boolean">isCompleted</a> <a href="../../Boolean.scala.html#27149" title="(x: Boolean)Boolean">||</a> <a href="#345490" title="(atMost: scala.concurrent.duration.Duration)Boolean">tryAwait</a><span class="delimiter">(</span><a href="#350074" title="scala.concurrent.duration.Duration">atMost</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#345479" title="DefaultPromise.this.type" class="keyword">this</a>
      <span class="keyword">else</span> <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)java.util.concurrent.TimeoutException" class="keyword">new</span> <a href="../package.scala.html#22101" title="java.util.concurrent.TimeoutException">TimeoutException</a><span class="delimiter">(</span><span title="String(&quot;Futures timed out after [&quot;)" class="string">&quot;Futures timed out after [&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#350074" title="scala.concurrent.duration.Duration">atMost</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span>

    @throws<span class="delimiter">(</span>classOf<span class="delimiter">[</span>Exception<span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(atMost: scala.concurrent.duration.Duration)(implicit permit: scala.concurrent.CanAwait)T" id="345492">result</a><span class="delimiter">(</span><a title="scala.concurrent.duration.Duration" id="350079">atMost</a>: <a href="../duration/Duration.scala.html#15681" title="scala.concurrent.duration.Duration">Duration</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.CanAwait" id="350080">permit</a>: <a href="../package.scala.html#15331" title="scala.concurrent.CanAwait">CanAwait</a><span class="delimiter">)</span>: <a href="#345480" title="T">T</a> =
      <a href="#345491" title="(atMost: scala.concurrent.duration.Duration)(implicit permit: scala.concurrent.CanAwait)DefaultPromise.this.type">ready</a><a href="#350080" title="scala.concurrent.CanAwait" class="delimiter">(</a><a href="#350079" title="scala.concurrent.duration.Duration">atMost</a><span class="delimiter">)</span>.<a href="#345493" title="=&gt; Option[scala.util.Try[T]]">value</a>.<a href="../../Option.scala.html#32179" title="=&gt; scala.util.Try[T]">get</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Failure<a href="#1445543" title="T" id="1445544" class="delimiter">(</a><a href="../../util/Try.scala.html#344253" title="Throwable" id="350084">e</a><span class="delimiter">)</span>  =&gt; <a href="#1445547" title="(x: T)T" class="keyword">throw</a> <a href="#350084" title="Throwable">e</a>
        <span class="keyword">case</span> Success<a href="#1445543" title="T" id="1445545" class="delimiter">(</a><a href="../../util/Try.scala.html#344183" title="T" id="350086">r</a><span class="delimiter">)</span> =&gt; <a href="#1445547" title="(x: T)T">r</a>
      <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; Option[scala.util.Try[T]]" id="345493">value</a>: <a href="../../Option.scala.html#978" title="Option[scala.util.Try[T]]">Option</a><span class="delimiter">[</span>Try<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="AbstractPromise.java.html#345487" title="()Object">getState</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1445552" title="Option[scala.util.Try[T]]" id="1445553">c</a>: Try<span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <a href="../../Option.scala.html#32449" title="(x: scala.util.Try[T])Some[scala.util.Try[T]]">Some</a><a href="#1445555" title="(x: Option[scala.util.Try[T]])Option[scala.util.Try[T]]" class="delimiter">(</a>c.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.util.Try[T]" class="delimiter">[</span><a href="../../util/Try.scala.html#18451" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt; <a href="#1445555" title="(x: Option[scala.util.Try[T]])Option[scala.util.Try[T]]">None</a>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="345494">isCompleted</a>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <a href="AbstractPromise.java.html#345487" title="()Object">getState</a> <span class="keyword">match</span> <span class="delimiter">{</span> // Cheaper than boxing result into Option due to &quot;def value&quot;
      <span class="keyword">case</span> _: Try<span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <a href="#1445563" title="(x: Boolean)Boolean" class="keyword">true</a>
      <span class="keyword">case</span> _ =&gt; <a href="#1445563" title="(x: Boolean)Boolean" class="keyword">false</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(value: scala.util.Try[T])Boolean" id="345495">tryComplete</a><span class="delimiter">(</span><a title="scala.util.Try[T]" id="350093">value</a>: <a href="../../util/Try.scala.html#18451" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.util.Try[T]" id="350096">resolved</a> = <a href="#345473" title="(source: scala.util.Try[T])scala.util.Try[T]">resolveTry</a><span class="delimiter">(</span><a href="#350093" title="scala.util.Try[T]">value</a><span class="delimiter">)</span>
      <span class="delimiter">(</span><a href="#1445576" title="Boolean" class="keyword">try</a> <span class="delimiter">{</span>
        @tailrec
        <span class="keyword">def</span> <a title="(v: scala.util.Try[T])List[scala.concurrent.impl.CallbackRunnable[T]]" id="350100">tryComplete</a><span class="delimiter">(</span><a title="scala.util.Try[T]" id="350101">v</a>: <a href="../../util/Try.scala.html#18451" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../collection/immutable/List.scala.html#11071" title="List[scala.concurrent.impl.CallbackRunnable[T]]">List</a><span class="delimiter">[</span>CallbackRunnable<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
          <a href="AbstractPromise.java.html#345487" title="()Object">getState</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#1445568" title="List[scala.concurrent.impl.CallbackRunnable[T]]" id="1445569">raw</a>: List<span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt;
              <span class="keyword">val</span> <a title="List[scala.concurrent.impl.CallbackRunnable[T]]" id="350104">cur</a> = raw.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="List[scala.concurrent.impl.CallbackRunnable[T]]" class="delimiter">[</span><a href="../../collection/immutable/List.scala.html#11071" title="List[scala.concurrent.impl.CallbackRunnable[T]]">List</a><span class="delimiter">[</span>CallbackRunnable<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>
              <span title="List[scala.concurrent.impl.CallbackRunnable[T]]" class="keyword">if</span> <span class="delimiter">(</span><a href="AbstractPromise.java.html#345486" title="(oldState: Any, newState: Any)Boolean">updateState</a><span class="delimiter">(</span><a href="#350104" title="List[scala.concurrent.impl.CallbackRunnable[T]]">cur</a>, <a href="#350101" title="scala.util.Try[T]">v</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#350104" title="List[scala.concurrent.impl.CallbackRunnable[T]]">cur</a> <span class="keyword">else</span> <a href="#350100" title="(v: scala.util.Try[T])List[scala.concurrent.impl.CallbackRunnable[T]]">tryComplete</a><span class="delimiter">(</span><a href="#350101" title="scala.util.Try[T]">v</a><span class="delimiter">)</span>
            <span class="keyword">case</span> _ =&gt; <a href="#1445571" title="(x: List[scala.concurrent.impl.CallbackRunnable[T]])List[scala.concurrent.impl.CallbackRunnable[T]]" class="keyword">null</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <a href="#350100" title="(v: scala.util.Try[T])List[scala.concurrent.impl.CallbackRunnable[T]]">tryComplete</a><span class="delimiter">(</span><a href="#350096" title="scala.util.Try[T]">resolved</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
        <a href="#345479" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span> <a href="#345479" title="()Unit">notifyAll</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span> //Notify any evil blockers
      <span class="delimiter">}</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#1445576" title="Boolean" id="1445579" class="keyword">null</a>             =&gt; <a href="#1445581" title="(x: Boolean)Boolean" class="keyword">false</a>
        <span class="keyword">case</span> rs <span class="keyword">if</span> rs.<a href="../../collection/SeqLike.scala.html#28108" title="=&gt; Boolean">isEmpty</a> =&gt; <a href="#1445581" title="(x: Boolean)Boolean" class="keyword">true</a>
        <span class="keyword">case</span> rs               =&gt; rs.<a href="../../collection/immutable/List.scala.html#32040" title="(f: scala.concurrent.impl.CallbackRunnable[T] =&gt; Unit)Unit">foreach</a><span class="delimiter">(</span><a title="scala.concurrent.impl.CallbackRunnable[T]" id="350130">r</a> =&gt; <a href="#350130" title="scala.concurrent.impl.CallbackRunnable[T]">r</a>.<a href="#349956" title="(v: scala.util.Try[T])Unit">executeWithValue</a><span class="delimiter">(</span><a href="#350096" title="scala.util.Try[T]">resolved</a><span class="delimiter">)</span><span class="delimiter">)</span>; <span title="Boolean(true)" class="keyword">true</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="[U](func: scala.util.Try[T] =&gt; U)(implicit executor: scala.concurrent.ExecutionContext)Unit" id="345496">onComplete</a><span class="delimiter">[</span><a title="" id="345498">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.util.Try[T] =&gt; U" id="350133">func</a>: Try<span class="delimiter">[</span>T<span class="delimiter">]</span> =&gt; U<span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.ExecutionContext" id="350134">executor</a>: <a href="../ExecutionContext.scala.html#15289" title="scala.concurrent.ExecutionContext">ExecutionContext</a><span class="delimiter">)</span>: <a href="../../Unit.scala.html#1515" title="Unit">Unit</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.concurrent.ExecutionContext" id="350140">preparedEC</a> = <a href="#350134" title="scala.concurrent.ExecutionContext">executor</a>.<a href="../ExecutionContext.scala.html#324927" title="()scala.concurrent.ExecutionContext">prepare</a>
      <span class="keyword">val</span> <a title="scala.concurrent.impl.CallbackRunnable[T]" id="350141">runnable</a> = <span title="scala.concurrent.impl.CallbackRunnable[T]" class="keyword">new</span> <a href="#15964" title="scala.concurrent.impl.CallbackRunnable[T]">CallbackRunnable</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">(</span><a href="#350140" title="scala.concurrent.ExecutionContext">preparedEC</a>, <a href="#350133" title="scala.util.Try[T] =&gt; U">func</a><span class="delimiter">)</span>

      @tailrec //Tries to add the callback, if already completed, it dispatches the callback to be executed
      <span class="keyword">def</span> <a title="()Unit" id="350142">dispatchOrAddCallback</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../Unit.scala.html#1515" title="Unit">Unit</a> =
        <a href="AbstractPromise.java.html#345487" title="()Object">getState</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="#1445590" title="Unit" id="1445591">r</a>: Try<span class="delimiter">[</span>_<span class="delimiter">]</span>          =&gt; <a href="#350141" title="scala.concurrent.impl.CallbackRunnable[T]">runnable</a>.<a href="#349956" title="(v: scala.util.Try[T])Unit">executeWithValue</a><a href="#1445594" title="(x: Unit)Unit" class="delimiter">(</a>r.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.util.Try[T]" class="delimiter">[</span><a href="../../util/Try.scala.html#18451" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="#1445590" title="Unit" id="1445592">listeners</a>: List<span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <a href="#1445594" title="(x: Unit)Unit" class="keyword">if</a> <span class="delimiter">(</span><a href="AbstractPromise.java.html#345486" title="(oldState: Any, newState: Any)Boolean">updateState</a><span class="delimiter">(</span>listeners, <a href="#350141" title="scala.concurrent.impl.CallbackRunnable[T]">runnable</a> <a href="../../collection/immutable/List.scala.html#32006" title="(x: Any)List[Any]">::</a> listeners<span class="delimiter">)</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#350142" title="()Unit">dispatchOrAddCallback</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <a href="#350142" title="()Unit">dispatchOrAddCallback</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** An already completed Future is given its result at creation.
   *
   *  Useful in Future-composition when a value to contribute is already available.
   */
  <span class="keyword">final</span> <span class="keyword">class</span> <a title="class KeptPromise[T] extends Object with scala.concurrent.impl.Promise[T]" id="345481">KeptPromise</a><span class="delimiter">[</span><a title="" id="345482">T</a><span class="delimiter">]</span><a href="#345481" title="scala.concurrent.impl.Promise.KeptPromise[T]" class="delimiter">(</a><a title="scala.util.Try[T]" id="345513">suppliedValue</a>: <a href="../../util/Try.scala.html#18451" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#15961" title="scala.concurrent.impl.Promise[T]">Promise</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="Some[scala.util.Try[T]]" id="345504">value</a> = <a href="../../Option.scala.html#32449" title="(x: scala.util.Try[T])Some[scala.util.Try[T]]">Some</a><span class="delimiter">(</span><a href="#345473" title="(source: scala.util.Try[T])scala.util.Try[T]">resolveTry</a><span class="delimiter">(</span><a href="#345513" title="scala.util.Try[T]">suppliedValue</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="345506">isCompleted</a>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span title="Boolean(true)" class="keyword">true</span>

    <span class="keyword">def</span> <a title="(value: scala.util.Try[T])Boolean" id="345507">tryComplete</a><span class="delimiter">(</span><a title="scala.util.Try[T]" id="350169">value</a>: <a href="../../util/Try.scala.html#18451" title="scala.util.Try[T]">Try</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#1425" title="Boolean">Boolean</a> = <span title="Boolean(false)" class="keyword">false</span>

    <span class="keyword">def</span> <a title="[U](func: scala.util.Try[T] =&gt; U)(implicit executor: scala.concurrent.ExecutionContext)Unit" id="345508">onComplete</a><span class="delimiter">[</span><a title="" id="345510">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.util.Try[T] =&gt; U" id="350172">func</a>: Try<span class="delimiter">[</span>T<span class="delimiter">]</span> =&gt; U<span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.ExecutionContext" id="350173">executor</a>: <a href="../ExecutionContext.scala.html#15289" title="scala.concurrent.ExecutionContext">ExecutionContext</a><span class="delimiter">)</span>: <a href="../../Unit.scala.html#1515" title="Unit">Unit</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.util.Try[T]" id="350179">completedAs</a> = <a href="#345504" title="=&gt; Some[scala.util.Try[T]]">value</a>.<a href="../../Option.scala.html#32457" title="=&gt; scala.util.Try[T]">get</a>
      <span class="keyword">val</span> <a title="scala.concurrent.ExecutionContext" id="350180">preparedEC</a> = <a href="#350173" title="scala.concurrent.ExecutionContext">executor</a>.<a href="../ExecutionContext.scala.html#324927" title="()scala.concurrent.ExecutionContext">prepare</a>
      <span class="delimiter">(</span><span title="scala.concurrent.impl.CallbackRunnable[T]" class="keyword">new</span> <a href="#15964" title="scala.concurrent.impl.CallbackRunnable[T]">CallbackRunnable</a><span class="delimiter">(</span><a href="#350180" title="scala.concurrent.ExecutionContext">preparedEC</a>, <a href="#350172" title="scala.util.Try[T] =&gt; U">func</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#349956" title="(v: scala.util.Try[T])Unit">executeWithValue</a><span class="delimiter">(</span><a href="#350179" title="scala.util.Try[T]">completedAs</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(atMost: scala.concurrent.duration.Duration)(implicit permit: scala.concurrent.CanAwait)KeptPromise.this.type" id="345511">ready</a><span class="delimiter">(</span><a title="scala.concurrent.duration.Duration" id="350187">atMost</a>: <a href="../duration/Duration.scala.html#15681" title="scala.concurrent.duration.Duration">Duration</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.CanAwait" id="350188">permit</a>: <a href="../package.scala.html#15331" title="scala.concurrent.CanAwait">CanAwait</a><span class="delimiter">)</span>: <span class="keyword">this</span>.<span class="keyword">type</span> = <a href="#345481" title="KeptPromise.this.type" class="keyword">this</a>

    <span class="keyword">def</span> <a title="(atMost: scala.concurrent.duration.Duration)(implicit permit: scala.concurrent.CanAwait)T" id="345512">result</a><span class="delimiter">(</span><a title="scala.concurrent.duration.Duration" id="350190">atMost</a>: <a href="../duration/Duration.scala.html#15681" title="scala.concurrent.duration.Duration">Duration</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.CanAwait" id="350191">permit</a>: <a href="../package.scala.html#15331" title="scala.concurrent.CanAwait">CanAwait</a><span class="delimiter">)</span>: <a href="#345482" title="T">T</a> = <a href="#345504" title="=&gt; Some[scala.util.Try[T]]">value</a>.<a href="../../Option.scala.html#32457" title="=&gt; scala.util.Try[T]">get</a>.<a href="../../util/Try.scala.html#344152" title="=&gt; T">get</a>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>