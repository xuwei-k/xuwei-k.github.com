<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>akka/persistence/stream/PersistentSource.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
package akka.persistence.stream

import akka.actor._
import akka.persistence._
import akka.stream.MaterializerSettings
import akka.stream.impl.ActorPublisher
import akka.stream.impl.ActorSubscriptionWithCursor
import akka.stream.impl.Cancel
import akka.stream.impl.ExposedPublisher
import akka.stream.impl.RequestMore
import akka.stream.impl.SoftShutdown
import akka.stream.impl.SubscribePending
import akka.stream.impl.SubscriberManagement
import akka.stream.impl.ActorBasedFlowMaterializer
import akka.stream.scaladsl.KeyedActorFlowSource
import org.reactivestreams.Subscriber

import scala.concurrent.duration._
import scala.util.control.NonFatal

<span class="comment">// ------------------------------------------------------------------------------------------------</span>
<span class="comment">// FIXME: #15964 move this file to akka-persistence-experimental once going back to project dependencies</span>
<span class="comment">// ------------------------------------------------------------------------------------------------</span>

<span class="comment">/**
 * Constructs a `Source` from the given [[akka.persistence.PersistentActor]],
 * identified by `persistenceId`. Events are pulled from the persistent actor's
 * journal (using a [[akka.persistence.PersistentView]]) in accordance with the
 * demand coming from the downstream transformation steps.
 *
 * Elements pulled from the persistent actor's journal are buffered in memory so that
 * fine-grained demands (requests) from downstream can be served efficiently.
 *
 * Reads from the journal are done in (coarse-grained) batches of configurable
 * size (which correspond to the configurable maximum buffer size).
 *
 * @see [[akka.persistence.stream.PersistentSourceSettings]]
 */</span>
final case class <a href="#akka.persistence.stream;PersistentSource.productElement.x$1" title="class PersistentSource[Out] extends AnyRef with akka.stream.scaladsl.KeyedActorFlowSource[Out,akka.actor.ActorRef] with Product with Serializable" id="akka.persistence.stream.PersistentSource.readResolve">PersistentSource</a><span class="delimiter">[</span><a title="" id="akka.persistence.stream.PersistentSource.apply$default$2;Out">Out</a><span class="delimiter">]</span><span title="Product" class="delimiter">(</span><a title="String" id="akka.persistence.stream;PersistentSource.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="akka.persistence.stream.PersistentSourceSettings" id="akka.persistence.stream.PersistentSource.apply$default$2">sourceSettings</a>: <a href="#akka.persistence.stream.PersistentSourceSettings.readResolve" title="akka.persistence.stream.PersistentSourceSettings">PersistentSourceSettings</a> = <a href="#akka.persistence.stream.PersistentSourceSettings.readResolve" title="(fromSequenceNr: Long, maxBufferSize: Int, idle: Option[scala.concurrent.duration.FiniteDuration])akka.persistence.stream.PersistentSourceSettings">PersistentSourceSettings</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> extends <a href="../../stream/scaladsl/ActorFlowSource.scala.html#akka.stream.scaladsl;KeyedActorFlowSource" title="akka.stream.scaladsl.KeyedActorFlowSource[Out,akka.actor.ActorRef]">KeyedActorFlowSource</a><span class="delimiter">[</span>Out, ActorRef<span class="delimiter">]</span> <span class="delimiter">{</span>

  override def <a title="(flowSubscriber: org.reactivestreams.Subscriber[Out], materializer: akka.stream.impl.ActorBasedFlowMaterializer, flowName: String)akka.actor.ActorRef" id="akka.persistence.stream;PersistentSource.attach">attach</a><span class="delimiter">(</span><a title="org.reactivestreams.Subscriber[Out]" id="akka.persistence.stream;PersistentSource.attach.flowSubscriber">flowSubscriber</a>: <span title="org.reactivestreams.Subscriber[Out]">Subscriber</span><span class="delimiter">[</span>Out<span class="delimiter">]</span>, <a title="akka.stream.impl.ActorBasedFlowMaterializer" id="akka.persistence.stream;PersistentSource.attach.materializer">materializer</a>: <a href="../../stream/impl/ActorBasedFlowMaterializer.scala.html#akka.stream.impl;ActorBasedFlowMaterializer" title="akka.stream.impl.ActorBasedFlowMaterializer">ActorBasedFlowMaterializer</a>, <a title="String" id="akka.persistence.stream;PersistentSource.attach.flowName">flowName</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    val <a href="#akka.persistence.stream;PersistentSource.attach.publisher" title="(akka.stream.impl.ActorPublisher[Out], akka.actor.ActorRef)" class="delimiter">(</a><a href="#akka.persistence.stream;PersistentSource.attach.x$1" title="akka.stream.impl.ActorPublisher[Out]" id="akka.persistence.stream;PersistentSource.attach.publisher">publisher</a>, <a href="#akka.persistence.stream;PersistentSource.attach.x$1" title="akka.actor.ActorRef" id="akka.persistence.stream;PersistentSource.attach.publisherRef">publisherRef</a><span class="delimiter">)</span> = <a href="#akka.persistence.stream;PersistentSource.create" title="(materializer: akka.stream.impl.ActorBasedFlowMaterializer, flowName: String)(akka.stream.impl.ActorPublisher[Out], akka.actor.ActorRef)">create</a><span title="(akka.stream.impl.ActorPublisher[Out], akka.actor.ActorRef) @unchecked" class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSource.attach.materializer" title="akka.stream.impl.ActorBasedFlowMaterializer">materializer</a>, <a href="#akka.persistence.stream;PersistentSource.attach.flowName" title="String">flowName</a><span class="delimiter">)</span>
    <a href="#akka.persistence.stream;PersistentSource.attach.publisher" title="akka.stream.impl.ActorPublisher[Out]">publisher</a>.<a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;ActorPublisher.subscribe" title="(subscriber: org.reactivestreams.Subscriber[_ &gt;: Out])Unit">subscribe</a><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSource.attach.flowSubscriber" title="org.reactivestreams.Subscriber[Out]">flowSubscriber</a><span class="delimiter">)</span>
    <a href="#akka.persistence.stream;PersistentSource.attach.publisherRef" title="akka.actor.ActorRef">publisherRef</a>
  <span class="delimiter">}</span>
  override def <a title="=&gt; Boolean" id="akka.persistence.stream;PersistentSource.isActive">isActive</a>: <span title="Boolean">Boolean</span> = true
  override def <a title="(materializer: akka.stream.impl.ActorBasedFlowMaterializer, flowName: String)(akka.stream.impl.ActorPublisher[Out], akka.actor.ActorRef)" id="akka.persistence.stream;PersistentSource.create">create</a><span class="delimiter">(</span><a title="akka.stream.impl.ActorBasedFlowMaterializer" id="akka.persistence.stream;PersistentSource.create.materializer">materializer</a>: <a href="../../stream/impl/ActorBasedFlowMaterializer.scala.html#akka.stream.impl;ActorBasedFlowMaterializer" title="akka.stream.impl.ActorBasedFlowMaterializer">ActorBasedFlowMaterializer</a>, <a title="String" id="akka.persistence.stream;PersistentSource.create.flowName">flowName</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    val <a title="akka.actor.ActorRef" id="akka.persistence.stream;PersistentSource.create.publisherRef">publisherRef</a> = <a href="#akka.persistence.stream;PersistentSource.create.materializer" title="akka.stream.impl.ActorBasedFlowMaterializer">materializer</a>.<a href="../../stream/impl/ActorBasedFlowMaterializer.scala.html#akka.stream.impl;ActorBasedFlowMaterializer.actorOf(874c98419a)" title="(props: akka.actor.Props, name: String)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span><a href="#akka.persistence.stream.PersistentSourceImpl" title="akka.persistence.stream.PersistentSourceImpl.type">PersistentSourceImpl</a>.<a href="#akka.persistence.stream.PersistentSourceImpl.props" title="(persistenceId: String, sourceSettings: akka.persistence.stream.PersistentSourceSettings, settings: akka.stream.MaterializerSettings)akka.actor.Props">props</a><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSource.persistenceId" title="=&gt; String">persistenceId</a>, <a href="#akka.persistence.stream.PersistentSource.apply$default$2" title="=&gt; akka.persistence.stream.PersistentSourceSettings">sourceSettings</a>, <a href="#akka.persistence.stream;PersistentSource.create.materializer" title="akka.stream.impl.ActorBasedFlowMaterializer">materializer</a>.<a href="../../stream/impl/ActorBasedFlowMaterializer.scala.html#akka.stream.impl;ActorBasedFlowMaterializer.settings" title="=&gt; akka.stream.MaterializerSettings">settings</a><span class="delimiter">)</span>, name = <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;&quot;)">$</span><a href="#akka.persistence.stream;PersistentSource.create.flowName" title="String">flowName</a><span title="String(&quot;-0-persistent-source&quot;)" class="string">-0-persistent-source&quot;</span><span class="delimiter">)</span>
    <span title="(_1: akka.stream.impl.ActorPublisher[Out], _2: akka.actor.ActorRef)(akka.stream.impl.ActorPublisher[Out], akka.actor.ActorRef)" class="delimiter">(</span><a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl.ActorPublisher.apply" title="[T](impl: akka.actor.ActorRef)akka.stream.impl.ActorPublisher[T]">ActorPublisher</a><span title="(impl: akka.actor.ActorRef)akka.stream.impl.ActorPublisher[Out]" class="delimiter">[</span><a href="#akka.persistence.stream.PersistentSource.apply$default$2;Out" title="Out">Out</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSource.create.publisherRef" title="akka.actor.ActorRef">publisherRef</a><span class="delimiter">)</span>, <a href="#akka.persistence.stream;PersistentSource.create.publisherRef" title="akka.actor.ActorRef">publisherRef</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Configuration object for a `PersistentSource`.
 *
 * @param fromSequenceNr Sequence number where the published stream shall start (inclusive).
 *                       Default is `1L`.
 * @param maxBufferSize Maximum number of persistent events to be buffered in memory (per Source).
 *                      Default is `100`.
 * @param idle Optional duration to wait if no more persistent events can be pulled from the journal
 *             before attempting the next pull. Default is `None` which causes the publisher to take
 *             the value defined by the `akka.persistence.view.auto-update-interval` configuration
 *             key. If defined, the `idle` value is taken directly.
 */</span>
case class <a title="class PersistentSourceSettings extends AnyRef with Product with Serializable" id="akka.persistence.stream.PersistentSourceSettings.readResolve">PersistentSourceSettings</a><a href="#akka.persistence.stream.PersistentSourceSettings.readResolve" title="Product" class="delimiter">(</a><a title="Long" id="akka.persistence.stream.PersistentSourceSettings.<init>$default$1">fromSequenceNr</a>: <span title="Long">Long</span> = <span title="Long(1L)" class="long">1L</span>, <a title="Int" id="akka.persistence.stream.PersistentSourceSettings.<init>$default$2">maxBufferSize</a>: <span title="Int">Int</span> = <span title="Int(100)" class="int">100</span>, <a title="Option[scala.concurrent.duration.FiniteDuration]" id="akka.persistence.stream.PersistentSourceSettings.<init>$default$3">idle</a>: <span title="Option[scala.concurrent.duration.FiniteDuration]">Option</span><span class="delimiter">[</span>FiniteDuration<span class="delimiter">]</span> = <span title="None.type">None</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.persistence.stream.PersistentSourceSettings.<init>$default$1" title="=&gt; Long">fromSequenceNr</a> <span title="(x: Long)Boolean">&gt;</span> <span title="Long(0L)" class="long">0L</span>, <span title="String(&quot;fromSequenceNr must be &gt; 0&quot;)" class="string">&quot;fromSequenceNr must be &gt; 0&quot;</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

private object <a title="akka.persistence.stream.PersistentSourceImpl.type" id="akka.persistence.stream.PersistentSourceImpl">PersistentSourceImpl</a> <a href="#akka.persistence.stream.PersistentSourceImpl" title="akka.persistence.stream.PersistentSourceImpl.type" class="delimiter">{</a>
  def <a title="(persistenceId: String, sourceSettings: akka.persistence.stream.PersistentSourceSettings, settings: akka.stream.MaterializerSettings)akka.actor.Props" id="akka.persistence.stream.PersistentSourceImpl.props">props</a><span class="delimiter">(</span><a title="String" id="akka.persistence.stream.PersistentSourceImpl.props.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="akka.persistence.stream.PersistentSourceSettings" id="akka.persistence.stream.PersistentSourceImpl.props.sourceSettings">sourceSettings</a>: <a href="#akka.persistence.stream.PersistentSourceSettings.readResolve" title="akka.persistence.stream.PersistentSourceSettings">PersistentSourceSettings</a>, <a title="akka.stream.MaterializerSettings" id="akka.persistence.stream.PersistentSourceImpl.props.settings">settings</a>: <a href="../../stream/FlowMaterializer.scala.html#akka.stream;MaterializerSettings" title="akka.stream.MaterializerSettings">MaterializerSettings</a><span class="delimiter">)</span>: <span title="akka.actor.Props">Props</span> =
    <span title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</span><span class="delimiter">(</span>classOf<span title="Class[akka.persistence.stream.PersistentSourceImpl](classOf[akka.persistence.stream.PersistentSourceImpl])" class="delimiter">[</span>PersistentSourceImpl<span class="delimiter">]</span>, <a href="#akka.persistence.stream.PersistentSourceImpl.props.persistenceId" title="String">persistenceId</a>, <a href="#akka.persistence.stream.PersistentSourceImpl.props.sourceSettings" title="akka.persistence.stream.PersistentSourceSettings">sourceSettings</a>, <a href="#akka.persistence.stream.PersistentSourceImpl.props.settings" title="akka.stream.MaterializerSettings">settings</a><span class="delimiter">)</span>.<span title="(d: String)akka.actor.Props">withDispatcher</span><span class="delimiter">(</span><a href="#akka.persistence.stream.PersistentSourceImpl.props.settings" title="akka.stream.MaterializerSettings">settings</a>.<a href="../../stream/FlowMaterializer.scala.html#akka.stream;MaterializerSettings.dispatcher" title="=&gt; String">dispatcher</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

private class <a title="class PersistentSourceImpl extends AnyRef with akka.actor.Actor with akka.actor.ActorLogging with akka.stream.impl.SubscriberManagement[Any] with akka.stream.impl.SoftShutdown" id="akka.persistence.stream;PersistentSourceImpl">PersistentSourceImpl</a><a href="#akka.persistence.stream;PersistentSourceImpl" title="akka.persistence.stream.PersistentSourceImpl" class="delimiter">(</a><a title="String" id="akka.persistence.stream;PersistentSourceImpl.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="akka.persistence.stream.PersistentSourceSettings" id="akka.persistence.stream;PersistentSourceImpl.sourceSettings">sourceSettings</a>: <a href="#akka.persistence.stream.PersistentSourceSettings.readResolve" title="akka.persistence.stream.PersistentSourceSettings">PersistentSourceSettings</a>, <a title="akka.stream.MaterializerSettings" id="akka.persistence.stream;PersistentSourceImpl.materializerSettings">materializerSettings</a>: <a href="../../stream/FlowMaterializer.scala.html#akka.stream;MaterializerSettings" title="akka.stream.MaterializerSettings">MaterializerSettings</a><span class="delimiter">)</span>
  extends <a href="#akka.persistence.stream;PersistentSourceImpl" title="akka.actor.Actor">Actor</a>
  with <span title="akka.actor.ActorLogging">ActorLogging</span>
  with <a href="../../stream/impl/SubscriberManagement.scala.html#akka.stream.impl;SubscriberManagement" title="akka.stream.impl.SubscriberManagement[Any]">SubscriberManagement</a><span class="delimiter">[</span>Any<span class="delimiter">]</span>
  with <a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;SoftShutdown" title="akka.stream.impl.SoftShutdown">SoftShutdown</a> <span class="delimiter">{</span>

  import <a href="#akka.persistence.stream.PersistentSourceBuffer" title="akka.persistence.stream.PersistentSourceBuffer.type">PersistentSourceBuffer</a>._

  type <a title="akka.stream.impl.ActorSubscriptionWithCursor[Any]" id="akka.persistence.stream;PersistentSourceImpl;S">S</a> = <a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;ActorSubscriptionWithCursor" title="akka.stream.impl.ActorSubscriptionWithCursor[Any]">ActorSubscriptionWithCursor</a><span class="delimiter">[</span>Any<span class="delimiter">]</span>

  private val <a title="akka.actor.ActorRef" id="akka.persistence.stream;PersistentSourceImpl.buffer">buffer</a> = <a href="#akka.persistence.stream;PersistentSourceImpl" title="=&gt; akka.actor.ActorContext">context</a>.<span title="(props: akka.actor.Props, name: String)akka.actor.ActorRef">actorOf</span><span class="delimiter">(</span><span title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</span><span class="delimiter">(</span>classOf<span title="Class[akka.persistence.stream.PersistentSourceBuffer](classOf[akka.persistence.stream.PersistentSourceBuffer])" class="delimiter">[</span>PersistentSourceBuffer<span class="delimiter">]</span>, <a href="#akka.persistence.stream;PersistentSourceImpl.persistenceId" title="String">persistenceId</a>, <a href="#akka.persistence.stream;PersistentSourceImpl.sourceSettings" title="akka.persistence.stream.PersistentSourceSettings">sourceSettings</a>, <a href="#akka.persistence.stream;PersistentSourceImpl" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>.
    <span title="(d: String)akka.actor.Props">withDispatcher</span><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl" title="=&gt; akka.actor.ActorContext">context</a>.<span title="=&gt; akka.actor.Props">props</span>.<span title="=&gt; String">dispatcher</span><span class="delimiter">)</span>, <span title="String(&quot;persistent-source-buffer&quot;)" class="string">&quot;persistent-source-buffer&quot;</span><span class="delimiter">)</span>

  private var <a title="akka.stream.impl.ActorPublisher[Any]" id="akka.persistence.stream;PersistentSourceImpl.pub_=">pub</a>: <a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;ActorPublisher" title="akka.stream.impl.ActorPublisher[Any]">ActorPublisher</a><span class="delimiter">[</span>Any<span class="delimiter">]</span> = _
  private var <a title="Option[Throwable]" id="akka.persistence.stream;PersistentSourceImpl.shutdownReason_=">shutdownReason</a>: <span title="Option[Throwable]">Option</span><span class="delimiter">[</span>Throwable<span class="delimiter">]</span> = <a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl.ActorPublisher" title="akka.stream.impl.ActorPublisher.type">ActorPublisher</a>.<a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl.ActorPublisher.NormalShutdownReason" title="=&gt; Option[Throwable]">NormalShutdownReason</a>

  final def <a title="=&gt; PartialFunction[Any,Unit]" id="akka.persistence.stream;PersistentSourceImpl.receive">receive</a> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.persistence.stream;PersistentSourceImpl.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case ExposedPublisher<span class="delimiter">(</span><a title="akka.stream.impl.ActorPublisher[Any]" id="akka.persistence.stream;PersistentSourceImpl.receive;$anonfun.isDefinedAt.publisher">publisher</a><span class="delimiter">)</span> ⇒
      <a href="#akka.persistence.stream;PersistentSourceImpl.pub_=" title="(x$1: akka.stream.impl.ActorPublisher[Any])Unit">pub</a> = <a href="#akka.persistence.stream;PersistentSourceImpl.receive;$anonfun.isDefinedAt.publisher" title="akka.stream.impl.ActorPublisher[Any]">publisher</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.stream.impl.ActorPublisher[Any]" class="delimiter">[</span><a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;ActorPublisher" title="akka.stream.impl.ActorPublisher[Any]">ActorPublisher</a><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">]</span>
      <a href="#akka.persistence.stream;PersistentSourceImpl" title="=&gt; akka.actor.ActorContext">context</a>.<span title="(behavior: akka.actor.Actor.Receive)Unit">become</span><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl.waitingForSubscribers" title="=&gt; PersistentSourceImpl.this.Receive">waitingForSubscribers</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  final def <a title="=&gt; PersistentSourceImpl.this.Receive" id="akka.persistence.stream;PersistentSourceImpl.waitingForSubscribers">waitingForSubscribers</a>: <span title="PersistentSourceImpl.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.persistence.stream;PersistentSourceImpl.waitingForSubscribers;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case <a href="../../stream/impl/Messages.scala.html#akka.stream.impl.SubscribePending" title="akka.stream.impl.SubscribePending.type">SubscribePending</a> ⇒
      <a href="#akka.persistence.stream;PersistentSourceImpl.pub_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">pub</a>.<a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;ActorPublisher.takePendingSubscribers" title="()scala.collection.immutable.Seq[org.reactivestreams.Subscriber[_ &gt;: Any]]">takePendingSubscribers</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(f: org.reactivestreams.Subscriber[_ &gt;: Any] =&gt; Unit)Unit">foreach</span> <a href="../../stream/impl/SubscriberManagement.scala.html#akka.stream.impl;SubscriberManagement.registerSubscriber" title="(subscriber: org.reactivestreams.Subscriber[_ &gt;: Any])Unit">registerSubscriber</a>
      <a href="#akka.persistence.stream;PersistentSourceImpl" title="=&gt; akka.actor.ActorContext">context</a>.<span title="(behavior: akka.actor.Actor.Receive)Unit">become</span><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl.active" title="=&gt; PersistentSourceImpl.this.Receive">active</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  final def <a title="=&gt; PersistentSourceImpl.this.Receive" id="akka.persistence.stream;PersistentSourceImpl.active">active</a>: <span title="PersistentSourceImpl.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.persistence.stream;PersistentSourceImpl.active;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case <a href="../../stream/impl/Messages.scala.html#akka.stream.impl.SubscribePending" title="akka.stream.impl.SubscribePending.type">SubscribePending</a> ⇒
      <a href="#akka.persistence.stream;PersistentSourceImpl.pub_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">pub</a>.<a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;ActorPublisher.takePendingSubscribers" title="()scala.collection.immutable.Seq[org.reactivestreams.Subscriber[_ &gt;: Any]]">takePendingSubscribers</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(f: org.reactivestreams.Subscriber[_ &gt;: Any] =&gt; Unit)Unit">foreach</span> <a href="../../stream/impl/SubscriberManagement.scala.html#akka.stream.impl;SubscriberManagement.registerSubscriber" title="(subscriber: org.reactivestreams.Subscriber[_ &gt;: Any])Unit">registerSubscriber</a>
    case RequestMore<span class="delimiter">(</span><span title="akka.stream.impl.ActorSubscription[_]">sub</span>, <a title="Long" id="akka.persistence.stream;PersistentSourceImpl.active;$anonfun.isDefinedAt.elements">elements</a><span class="delimiter">)</span> ⇒
      <a href="../../stream/impl/SubscriberManagement.scala.html#akka.stream.impl;SubscriberManagement.moreRequested" title="(subscription: PersistentSourceImpl.this.S, elements: Long)Unit">moreRequested</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.stream.impl.ActorSubscription[_]">sub</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="PersistentSourceImpl.this.S" class="delimiter">[</span><a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;ActorSubscriptionWithCursor" title="PersistentSourceImpl.this.S">S</a><span class="delimiter">]</span>, <a href="#akka.persistence.stream;PersistentSourceImpl.active;$anonfun.isDefinedAt.elements" title="Long">elements</a><span class="delimiter">)</span>
    case Cancel<span class="delimiter">(</span><span title="akka.stream.impl.ActorSubscription[_]">sub</span><span class="delimiter">)</span> ⇒
      <a href="../../stream/impl/SubscriberManagement.scala.html#akka.stream.impl;SubscriberManagement.unregisterSubscription" title="(subscription: PersistentSourceImpl.this.S)Unit">unregisterSubscription</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.stream.impl.ActorSubscription[_]">sub</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="PersistentSourceImpl.this.S" class="delimiter">[</span><a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;ActorSubscriptionWithCursor" title="PersistentSourceImpl.this.S">S</a><span class="delimiter">]</span><span class="delimiter">)</span>
    case Response<span class="delimiter">(</span><a title="Vector[Any]" id="akka.persistence.stream;PersistentSourceImpl.active;$anonfun.isDefinedAt.ps">ps</a><span class="delimiter">)</span> ⇒
      try <a href="#akka.persistence.stream;PersistentSourceImpl.active;$anonfun.isDefinedAt.ps" title="Vector[Any]">ps</a>.<span title="(f: Any =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../../stream/impl/SubscriberManagement.scala.html#akka.stream.impl;SubscriberManagement.pushToDownstream" title="(value: Any)Unit">pushToDownstream</a><span class="delimiter">)</span> catch <span class="delimiter">{</span>
        case <a href="#akka.persistence.stream;PersistentSourceImpl.active;$anonfun.applyOrElse.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="akka.persistence.stream;PersistentSourceImpl.active;$anonfun.applyOrElse.e">e</a><span class="delimiter">)</span> ⇒ <a href="../../stream/impl/SubscriberManagement.scala.html#akka.stream.impl;SubscriberManagement.abortDownstream" title="(cause: Throwable)Unit">abortDownstream</a><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl.active;$anonfun.applyOrElse.e" title="Throwable">e</a><span class="delimiter">)</span>; <a href="#akka.persistence.stream;PersistentSourceImpl.shutdownReason_=" title="(x$1: Option[Throwable])Unit">shutdownReason</a> = <span title="(x: Throwable)Some[Throwable]">Some</span><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl.active;$anonfun.applyOrElse.e" title="Throwable">e</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  override def <a title="(elements: Long)Unit" id="akka.persistence.stream;PersistentSourceImpl.requestFromUpstream">requestFromUpstream</a><span class="delimiter">(</span><a title="Long" id="akka.persistence.stream;PersistentSourceImpl.requestFromUpstream.elements">elements</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.persistence.stream;PersistentSourceImpl.buffer" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">buffer</a> <a href="#akka.persistence.stream;PersistentSourceImpl" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.persistence.stream.PersistentSourceBuffer.Request.readResolve" title="(n: Long)akka.persistence.stream.PersistentSourceBuffer.Request">Request</a><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl.requestFromUpstream.elements" title="Long">elements</a><span class="delimiter">)</span>

  override def <a title="=&gt; Int" id="akka.persistence.stream;PersistentSourceImpl.initialBufferSize">initialBufferSize</a> =
    <a href="#akka.persistence.stream;PersistentSourceImpl.materializerSettings" title="akka.stream.MaterializerSettings">materializerSettings</a>.<a href="../../stream/FlowMaterializer.scala.html#akka.stream;MaterializerSettings.initialFanOutBufferSize" title="=&gt; Int">initialFanOutBufferSize</a>

  override def <a title="=&gt; Int" id="akka.persistence.stream;PersistentSourceImpl.maxBufferSize">maxBufferSize</a> =
    <a href="#akka.persistence.stream;PersistentSourceImpl.materializerSettings" title="akka.stream.MaterializerSettings">materializerSettings</a>.<a href="../../stream/FlowMaterializer.scala.html#akka.stream;MaterializerSettings.maxFanOutBufferSize" title="=&gt; Int">maxFanOutBufferSize</a>

  override def <a title="(subscriber: org.reactivestreams.Subscriber[_ &gt;: Any])akka.stream.impl.ActorSubscriptionWithCursor[Any]" id="akka.persistence.stream;PersistentSourceImpl.createSubscription">createSubscription</a><span class="delimiter">(</span><a title="org.reactivestreams.Subscriber[_ &gt;: Any]" id="akka.persistence.stream;PersistentSourceImpl.createSubscription.subscriber">subscriber</a>: <span title="org.reactivestreams.Subscriber[_ &gt;: Any]">Subscriber</span><span class="delimiter">[</span>_ &gt;: Any<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;ActorSubscriptionWithCursor" title="akka.stream.impl.ActorSubscriptionWithCursor[Any]">ActorSubscriptionWithCursor</a><span class="delimiter">[</span>Any<span class="delimiter">]</span> =
    new <a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;ActorSubscriptionWithCursor" title="akka.stream.impl.ActorSubscriptionWithCursor[Any]">ActorSubscriptionWithCursor</a><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.persistence.stream;PersistentSourceImpl.createSubscription.subscriber" title="org.reactivestreams.Subscriber[_ &gt;: Any]">subscriber</a><span class="delimiter">)</span>

  override def <a title="()Unit" id="akka.persistence.stream;PersistentSourceImpl.cancelUpstream">cancelUpstream</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl.pub_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">pub</a> <span title="(x$1: AnyRef)Boolean">ne</span> null<span class="delimiter">)</span> <a href="#akka.persistence.stream;PersistentSourceImpl.pub_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">pub</a>.<a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;ActorPublisher.shutdown" title="(reason: Option[Throwable])Unit">shutdown</a><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl.shutdownReason_=" title="=&gt; Option[Throwable]">shutdownReason</a><span class="delimiter">)</span>
    <a href="#akka.persistence.stream;PersistentSourceImpl" title="=&gt; akka.actor.ActorContext">context</a>.<span title="(actor: akka.actor.ActorRef)Unit">stop</span><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl.buffer" title="=&gt; akka.actor.ActorRef">buffer</a><span class="delimiter">)</span>
    <a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;SoftShutdown.softShutdown" title="()Unit">softShutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  override def <a title="(completed: Boolean)Unit" id="akka.persistence.stream;PersistentSourceImpl.shutdown">shutdown</a><span class="delimiter">(</span><a title="Boolean" id="akka.persistence.stream;PersistentSourceImpl.shutdown.completed">completed</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl.pub_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">pub</a> <span title="(x$1: AnyRef)Boolean">ne</span> null<span class="delimiter">)</span> <a href="#akka.persistence.stream;PersistentSourceImpl.pub_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">pub</a>.<a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;ActorPublisher.shutdown" title="(reason: Option[Throwable])Unit">shutdown</a><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl.shutdownReason_=" title="=&gt; Option[Throwable]">shutdownReason</a><span class="delimiter">)</span>
    <a href="#akka.persistence.stream;PersistentSourceImpl" title="=&gt; akka.actor.ActorContext">context</a>.<span title="(actor: akka.actor.ActorRef)Unit">stop</span><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl.buffer" title="=&gt; akka.actor.ActorRef">buffer</a><span class="delimiter">)</span>
    <a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;SoftShutdown.softShutdown" title="()Unit">softShutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  override def <a title="()Unit" id="akka.persistence.stream;PersistentSourceImpl.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl.pub_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">pub</a> <span title="(x$1: AnyRef)Boolean">ne</span> null<span class="delimiter">)</span> <a href="#akka.persistence.stream;PersistentSourceImpl.pub_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">pub</a>.<a href="../../stream/impl/ActorPublisher.scala.html#akka.stream.impl;ActorPublisher.shutdown" title="(reason: Option[Throwable])Unit">shutdown</a><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceImpl.shutdownReason_=" title="=&gt; Option[Throwable]">shutdownReason</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

private object <a title="akka.persistence.stream.PersistentSourceBuffer.type" id="akka.persistence.stream.PersistentSourceBuffer">PersistentSourceBuffer</a> <a href="#akka.persistence.stream.PersistentSourceBuffer" title="akka.persistence.stream.PersistentSourceBuffer.type" class="delimiter">{</a>
  case class <a title="class Request extends AnyRef with Product with Serializable" id="akka.persistence.stream.PersistentSourceBuffer.Request.readResolve">Request</a><a href="#akka.persistence.stream.PersistentSourceBuffer.Request.readResolve" title="Product" class="delimiter">(</a><a title="Long" id="akka.persistence.stream.PersistentSourceBuffer;Request.n">n</a>: <span title="Long">Long</span><span class="delimiter">)</span>
  case class <a title="class Response extends AnyRef with Product with Serializable" id="akka.persistence.stream.PersistentSourceBuffer.Response.readResolve">Response</a><a href="#akka.persistence.stream.PersistentSourceBuffer.Response.readResolve" title="Product" class="delimiter">(</a><a title="Vector[Any]" id="akka.persistence.stream.PersistentSourceBuffer;Response.events">events</a>: <span title="Vector[Any]">Vector</span><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">)</span>

  case object <a href="#akka.persistence.stream.PersistentSourceBuffer.Fill.productElement.x$1" title="akka.persistence.stream.PersistentSourceBuffer.Fill.type" id="akka.persistence.stream.PersistentSourceBuffer.Fill.readResolve">Fill</a>
  case object <a href="#akka.persistence.stream.PersistentSourceBuffer.Filled.productElement.x$1" title="akka.persistence.stream.PersistentSourceBuffer.Filled.type" id="akka.persistence.stream.PersistentSourceBuffer.Filled.readResolve">Filled</a>
<a href="#akka.persistence.stream.PersistentSourceBuffer.Filled.readResolve" title="akka.persistence.stream.PersistentSourceBuffer.Filled.type" class="delimiter">}</a>

<span class="comment">/**
 * A view that buffers up to `sourceSettings.maxBufferSize` persistent events in memory.
 * Downstream demands (requests) are served if the buffer is non-empty either while filling
 * the buffer or after having filled the buffer. When the buffer becomes empty new persistent
 * events are loaded from the journal (in batches up to `sourceSettings.maxBufferSize`).
 */</span>
private class <a title="class PersistentSourceBuffer extends AnyRef with akka.persistence.PersistentView" id="akka.persistence.stream;PersistentSourceBuffer">PersistentSourceBuffer</a><a href="#akka.persistence.stream;PersistentSourceBuffer" title="akka.persistence.stream.PersistentSourceBuffer" class="delimiter">(</a>override val <a title="String" id="akka.persistence.stream;PersistentSourceBuffer.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="akka.persistence.stream.PersistentSourceSettings" id="akka.persistence.stream;PersistentSourceBuffer.sourceSettings">sourceSettings</a>: <a href="#akka.persistence.stream.PersistentSourceSettings.readResolve" title="akka.persistence.stream.PersistentSourceSettings">PersistentSourceSettings</a>, <a title="akka.actor.ActorRef" id="akka.persistence.stream;PersistentSourceBuffer.publisher">publisher</a>: <span title="akka.actor.ActorRef">ActorRef</span><span class="delimiter">)</span> extends <a href="#akka.persistence.stream;PersistentSourceBuffer" title="akka.persistence.PersistentView">PersistentView</a> <span class="delimiter">{</span>
  import <a href="#akka.persistence.stream.PersistentSourceBuffer" title="akka.persistence.stream.PersistentSourceBuffer.type">PersistentSourceBuffer</a>._
  import <a href="#akka.persistence.stream;PersistentSourceBuffer" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher

  private var <a title="Long" id="akka.persistence.stream;PersistentSourceBuffer.replayed_=">replayed</a> = <span title="Long(0L)" class="long">0L</span>
  private var <a title="Long" id="akka.persistence.stream;PersistentSourceBuffer.pendingDemand_=">pendingDemand</a> = <span title="Long(0L)" class="long">0L</span>
  private var <a title="Vector[Any]" id="akka.persistence.stream;PersistentSourceBuffer.buffer_=">buffer</a>: <span title="Vector[Any]">Vector</span><span class="delimiter">[</span>Any<span class="delimiter">]</span> = <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span>

  override def <a title="=&gt; String" id="akka.persistence.stream;PersistentSourceBuffer.viewId">viewId</a>: <span title="String">String</span> = <a href="#akka.persistence.stream;PersistentSourceBuffer.persistenceId" title="=&gt; String">persistenceId</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;-stream-view&quot;)" class="string">&quot;-stream-view&quot;</span>

  private val <a title="PersistentSourceBuffer.this.Receive" id="akka.persistence.stream;PersistentSourceBuffer.filling">filling</a>: <span title="PersistentSourceBuffer.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.persistence.stream;PersistentSourceBuffer.filling;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case <a href="#akka.persistence.stream.PersistentSourceBuffer.Filled.readResolve" title="akka.persistence.stream.PersistentSourceBuffer.Filled.type">Filled</a> ⇒
      if <span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.buffer_=" title="=&gt; Vector[Any]">buffer</a>.<span title="=&gt; Boolean">nonEmpty</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.persistence.stream;PersistentSourceBuffer.pendingDemand_=" title="=&gt; Long">pendingDemand</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#akka.persistence.stream;PersistentSourceBuffer.respond" title="(num: Long)Unit">respond</a><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.pendingDemand_=" title="=&gt; Long">pendingDemand</a><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.buffer_=" title="=&gt; Vector[Any]">buffer</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <a href="#akka.persistence.stream;PersistentSourceBuffer.pause" title="()Unit">pause</a><span class="delimiter">(</span><span class="delimiter">)</span>
      else if <span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.replayed_=" title="=&gt; Long">replayed</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#akka.persistence.stream;PersistentSourceBuffer.fill" title="()Unit">fill</a><span class="delimiter">(</span><span class="delimiter">)</span>
      else <a href="#akka.persistence.stream;PersistentSourceBuffer.schedule" title="()Unit">schedule</a><span class="delimiter">(</span><span class="delimiter">)</span>
    case Request<span class="delimiter">(</span><a title="Long" id="akka.persistence.stream;PersistentSourceBuffer.filling;$anonfun.isDefinedAt.num">num</a><span class="delimiter">)</span> ⇒
      <a href="#akka.persistence.stream;PersistentSourceBuffer.pendingDemand_=" title="(x$1: Long)Unit">pendingDemand</a> <span title="(x: Long)Long">+=</span> <a href="#akka.persistence.stream;PersistentSourceBuffer.filling;$anonfun.isDefinedAt.num" title="Long">num</a>
      if <span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.buffer_=" title="=&gt; Vector[Any]">buffer</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <a href="#akka.persistence.stream;PersistentSourceBuffer.respond" title="(num: Long)Unit">respond</a><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.pendingDemand_=" title="=&gt; Long">pendingDemand</a><span class="delimiter">)</span>
    case <a title="Any" id="akka.persistence.stream;PersistentSourceBuffer.filling;$anonfun.isDefinedAt.persistentEvent">persistentEvent</a> ⇒
      <a href="#akka.persistence.stream;PersistentSourceBuffer.buffer_=" title="(x$1: Vector[Any])Unit">buffer</a> <span title="(elem: Any)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector[Any],Any,Vector[Any]])Vector[Any]">:+=</span> <a href="#akka.persistence.stream;PersistentSourceBuffer.filling;$anonfun.isDefinedAt.persistentEvent" title="Any">persistentEvent</a>
      <a href="#akka.persistence.stream;PersistentSourceBuffer.replayed_=" title="(x$1: Long)Unit">replayed</a> <span title="(x: Int)Long">+=</span> <span title="Int(1)" class="int">1</span>
      if <span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.pendingDemand_=" title="=&gt; Long">pendingDemand</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#akka.persistence.stream;PersistentSourceBuffer.respond" title="(num: Long)Unit">respond</a><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.pendingDemand_=" title="=&gt; Long">pendingDemand</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private val <a title="PersistentSourceBuffer.this.Receive" id="akka.persistence.stream;PersistentSourceBuffer.pausing">pausing</a>: <span title="PersistentSourceBuffer.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.persistence.stream;PersistentSourceBuffer.pausing;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case Request<span class="delimiter">(</span><a title="Long" id="akka.persistence.stream;PersistentSourceBuffer.pausing;$anonfun.isDefinedAt.num">num</a><span class="delimiter">)</span> ⇒
      <a href="#akka.persistence.stream;PersistentSourceBuffer.pendingDemand_=" title="(x$1: Long)Unit">pendingDemand</a> <span title="(x: Long)Long">+=</span> <a href="#akka.persistence.stream;PersistentSourceBuffer.pausing;$anonfun.isDefinedAt.num" title="Long">num</a>
      <a href="#akka.persistence.stream;PersistentSourceBuffer.respond" title="(num: Long)Unit">respond</a><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.pendingDemand_=" title="=&gt; Long">pendingDemand</a><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.buffer_=" title="=&gt; Vector[Any]">buffer</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#akka.persistence.stream;PersistentSourceBuffer.fill" title="()Unit">fill</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private val <a title="PersistentSourceBuffer.this.Receive" id="akka.persistence.stream;PersistentSourceBuffer.scheduled">scheduled</a>: <span title="PersistentSourceBuffer.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.persistence.stream;PersistentSourceBuffer.scheduled;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case <a href="#akka.persistence.stream.PersistentSourceBuffer.Fill.readResolve" title="akka.persistence.stream.PersistentSourceBuffer.Fill.type">Fill</a> ⇒
      <a href="#akka.persistence.stream;PersistentSourceBuffer.fill" title="()Unit">fill</a><span title="Boolean(true)" class="delimiter">(</span><span class="delimiter">)</span>
    case Request<span class="delimiter">(</span><a title="Long" id="akka.persistence.stream;PersistentSourceBuffer.scheduled;$anonfun.isDefinedAt.num">num</a><span class="delimiter">)</span> ⇒
      <a href="#akka.persistence.stream;PersistentSourceBuffer.pendingDemand_=" title="(x$1: Long)Unit">pendingDemand</a> <span title="(x: Long)Long">+=</span> <a href="#akka.persistence.stream;PersistentSourceBuffer.scheduled;$anonfun.isDefinedAt.num" title="Long">num</a>
  <span class="delimiter">}</span>

  def <a title="=&gt; PersistentSourceBuffer.this.Receive" id="akka.persistence.stream;PersistentSourceBuffer.receive">receive</a> = <a href="#akka.persistence.stream;PersistentSourceBuffer.filling" title="=&gt; PersistentSourceBuffer.this.Receive">filling</a>

  override def <a title="(receive: PersistentSourceBuffer.this.Receive, await: Boolean)Unit" id="akka.persistence.stream;PersistentSourceBuffer.onReplaySuccess">onReplaySuccess</a><span class="delimiter">(</span><a title="PersistentSourceBuffer.this.Receive" id="akka.persistence.stream;PersistentSourceBuffer.onReplaySuccess.receive">receive</a>: <span title="PersistentSourceBuffer.this.Receive">Receive</span>, <a title="Boolean" id="akka.persistence.stream;PersistentSourceBuffer.onReplaySuccess.await">await</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    super.<span title="(receive: PersistentSourceBuffer.this.Receive, await: Boolean)Unit">onReplaySuccess</span><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.onReplaySuccess.receive" title="PersistentSourceBuffer.this.Receive">receive</a>, <a href="#akka.persistence.stream;PersistentSourceBuffer.onReplaySuccess.await" title="Boolean">await</a><span class="delimiter">)</span>
    <a href="#akka.persistence.stream;PersistentSourceBuffer" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">self</a> <a href="#akka.persistence.stream;PersistentSourceBuffer" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.persistence.stream.PersistentSourceBuffer.Filled.readResolve" title="akka.persistence.stream.PersistentSourceBuffer.Filled.type">Filled</a>
  <span class="delimiter">}</span>

  override def <a title="(receive: PersistentSourceBuffer.this.Receive, await: Boolean, cause: Throwable)Unit" id="akka.persistence.stream;PersistentSourceBuffer.onReplayFailure">onReplayFailure</a><span class="delimiter">(</span><a title="PersistentSourceBuffer.this.Receive" id="akka.persistence.stream;PersistentSourceBuffer.onReplayFailure.receive">receive</a>: <span title="PersistentSourceBuffer.this.Receive">Receive</span>, <a title="Boolean" id="akka.persistence.stream;PersistentSourceBuffer.onReplayFailure.await">await</a>: <span title="Boolean">Boolean</span>, <a title="Throwable" id="akka.persistence.stream;PersistentSourceBuffer.onReplayFailure.cause">cause</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    super.<span title="(receive: PersistentSourceBuffer.this.Receive, await: Boolean, cause: Throwable)Unit">onReplayFailure</span><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.onReplayFailure.receive" title="PersistentSourceBuffer.this.Receive">receive</a>, <a href="#akka.persistence.stream;PersistentSourceBuffer.onReplayFailure.await" title="Boolean">await</a>, <a href="#akka.persistence.stream;PersistentSourceBuffer.onReplayFailure.cause" title="Throwable">cause</a><span class="delimiter">)</span>
    <a href="#akka.persistence.stream;PersistentSourceBuffer" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">self</a> <a href="#akka.persistence.stream;PersistentSourceBuffer" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.persistence.stream.PersistentSourceBuffer.Filled.readResolve" title="akka.persistence.stream.PersistentSourceBuffer.Filled.type">Filled</a>
  <span class="delimiter">}</span>

  override def <a title="=&gt; Long" id="akka.persistence.stream;PersistentSourceBuffer.lastSequenceNr">lastSequenceNr</a>: <span title="Long">Long</span> =
    math.<span title="(x: Long, y: Long)Long">max</span><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.sourceSettings" title="akka.persistence.stream.PersistentSourceSettings">sourceSettings</a>.<a href="#akka.persistence.stream.PersistentSourceSettings.<init>$default$1" title="=&gt; Long">fromSequenceNr</a> <span title="(x: Long)Long">-</span> <span title="Long(1L)" class="long">1L</span>, super.<span title="=&gt; Long">lastSequenceNr</span><span class="delimiter">)</span>

  override def <a title="=&gt; scala.concurrent.duration.FiniteDuration" id="akka.persistence.stream;PersistentSourceBuffer.autoUpdateInterval">autoUpdateInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span> =
    <a href="#akka.persistence.stream;PersistentSourceBuffer.sourceSettings" title="akka.persistence.stream.PersistentSourceSettings">sourceSettings</a>.<a href="#akka.persistence.stream.PersistentSourceSettings.<init>$default$3" title="=&gt; Option[scala.concurrent.duration.FiniteDuration]">idle</a>.<span title="(default: =&gt; scala.concurrent.duration.FiniteDuration)scala.concurrent.duration.FiniteDuration">getOrElse</span><span class="delimiter">(</span>super.<span title="=&gt; scala.concurrent.duration.FiniteDuration">autoUpdateInterval</span><span class="delimiter">)</span>

  override def <a title="=&gt; Long" id="akka.persistence.stream;PersistentSourceBuffer.autoUpdateReplayMax">autoUpdateReplayMax</a>: <span title="Long">Long</span> =
    <a href="#akka.persistence.stream;PersistentSourceBuffer.sourceSettings" title="akka.persistence.stream.PersistentSourceSettings">sourceSettings</a>.<a href="#akka.persistence.stream.PersistentSourceSettings.<init>$default$2" title="=&gt; Long">maxBufferSize</a>

  override def <a title="=&gt; Boolean" id="akka.persistence.stream;PersistentSourceBuffer.autoUpdate">autoUpdate</a>: <span title="Boolean">Boolean</span> =
    false

  private def <a title="()Unit" id="akka.persistence.stream;PersistentSourceBuffer.fill">fill</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.persistence.stream;PersistentSourceBuffer.replayed_=" title="(x$1: Long)Unit">replayed</a> = <span title="Long(0L)" class="int">0</span>
    <a href="#akka.persistence.stream;PersistentSourceBuffer" title="=&gt; akka.actor.ActorContext">context</a>.<span title="(behavior: akka.actor.Actor.Receive)Unit">become</span><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.filling" title="=&gt; PersistentSourceBuffer.this.Receive">filling</a><span class="delimiter">)</span>
    <a href="#akka.persistence.stream;PersistentSourceBuffer" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">self</a> <a href="#akka.persistence.stream;PersistentSourceBuffer" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <span title="(await: Boolean, replayMax: Long)akka.persistence.Update">Update</span><span class="delimiter">(</span>await = false, <a href="#akka.persistence.stream;PersistentSourceBuffer.autoUpdateReplayMax" title="=&gt; Long">autoUpdateReplayMax</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private def <a title="()Unit" id="akka.persistence.stream;PersistentSourceBuffer.pause">pause</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.persistence.stream;PersistentSourceBuffer" title="=&gt; akka.actor.ActorContext">context</a>.<span title="(behavior: akka.actor.Actor.Receive)Unit">become</span><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.pausing" title="=&gt; PersistentSourceBuffer.this.Receive">pausing</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private def <a title="()Unit" id="akka.persistence.stream;PersistentSourceBuffer.schedule">schedule</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.persistence.stream;PersistentSourceBuffer" title="=&gt; akka.actor.ActorContext">context</a>.<span title="(behavior: akka.actor.Actor.Receive)Unit">become</span><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.scheduled" title="=&gt; PersistentSourceBuffer.this.Receive">scheduled</a><span class="delimiter">)</span>
    <a href="#akka.persistence.stream;PersistentSourceBuffer" title="=&gt; akka.actor.ActorContext">context</a>.<span title="=&gt; akka.actor.ActorSystem">system</span>.<span title="=&gt; akka.actor.Scheduler">scheduler</span>.<span title="(delay: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">scheduleOnce</span><a href="#akka.persistence.stream;PersistentSourceBuffer" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="#akka.persistence.stream;PersistentSourceBuffer.autoUpdateInterval" title="=&gt; scala.concurrent.duration.FiniteDuration">autoUpdateInterval</a>, <a href="#akka.persistence.stream;PersistentSourceBuffer" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.persistence.stream.PersistentSourceBuffer.Fill.readResolve" title="akka.persistence.stream.PersistentSourceBuffer.Fill.type">Fill</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">// TODO Breaks now?</span>
  private def <a title="(num: Long)Unit" id="akka.persistence.stream;PersistentSourceBuffer.respond">respond</a><span class="delimiter">(</span><a title="Long" id="akka.persistence.stream;PersistentSourceBuffer.respond.num">num</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.respond.num" title="Long">num</a> <span title="(x: Int)Boolean">&lt;=</span> Int.<span title="Int(2147483647)">MaxValue</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="Int" id="akka.persistence.stream;PersistentSourceBuffer.respond.n">n</a> = <a href="#akka.persistence.stream;PersistentSourceBuffer.respond.num" title="Long">num</a>.<span title="=&gt; Int">toInt</span>
      val <a href="#akka.persistence.stream;PersistentSourceBuffer.respond.res" title="(scala.collection.immutable.Vector[Any], scala.collection.immutable.Vector[Any])" class="delimiter">(</a><a href="#akka.persistence.stream;PersistentSourceBuffer.respond.x$2" title="scala.collection.immutable.Vector[Any]" id="akka.persistence.stream;PersistentSourceBuffer.respond.res">res</a>, <a href="#akka.persistence.stream;PersistentSourceBuffer.respond.x$2" title="scala.collection.immutable.Vector[Any]" id="akka.persistence.stream;PersistentSourceBuffer.respond.buf">buf</a><span class="delimiter">)</span> = <a href="#akka.persistence.stream;PersistentSourceBuffer.buffer_=" title="=&gt; Vector[Any]">buffer</a>.<span title="(n: Int)(scala.collection.immutable.Vector[Any], scala.collection.immutable.Vector[Any])">splitAt</span><span title="(scala.collection.immutable.Vector[Any], scala.collection.immutable.Vector[Any]) @unchecked" class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.respond.n" title="Int">n</a><span class="delimiter">)</span>
      <a href="#akka.persistence.stream;PersistentSourceBuffer.publisher" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">publisher</a> <a href="#akka.persistence.stream;PersistentSourceBuffer" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.persistence.stream.PersistentSourceBuffer.Response.readResolve" title="(events: Vector[Any])akka.persistence.stream.PersistentSourceBuffer.Response">Response</a><span class="delimiter">(</span><a href="#akka.persistence.stream;PersistentSourceBuffer.respond.res" title="scala.collection.immutable.Vector[Any]">res</a><span class="delimiter">)</span>
      <a href="#akka.persistence.stream;PersistentSourceBuffer.buffer_=" title="(x$1: Vector[Any])Unit">buffer</a> = <a href="#akka.persistence.stream;PersistentSourceBuffer.respond.buf" title="scala.collection.immutable.Vector[Any]">buf</a>
      <a href="#akka.persistence.stream;PersistentSourceBuffer.pendingDemand_=" title="(x$1: Long)Unit">pendingDemand</a> <span title="(x: Int)Long">-=</span> <a href="#akka.persistence.stream;PersistentSourceBuffer.respond.res" title="scala.collection.immutable.Vector[Any]">res</a>.<span title="=&gt; Int">size</span>
    <span class="delimiter">}</span> else <span class="delimiter">{</span>
      <a href="#akka.persistence.stream;PersistentSourceBuffer.respond" title="(num: Long)Unit">respond</a><span class="delimiter">(</span>Int.<span title="Long(2147483647L)">MaxValue</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
