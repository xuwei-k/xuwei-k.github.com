<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>akka/stream/impl/ResizableMultiReaderRingBuffer.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
package akka.stream.impl

import scala.annotation.tailrec
import scala.util.control.NoStackTrace
import <a href="#akka.stream.impl.ResizableMultiReaderRingBuffer" title="akka.stream.impl.ResizableMultiReaderRingBuffer.type">ResizableMultiReaderRingBuffer</a>._

<span class="comment">/**
 * INTERNAL API
 * A mutable RingBuffer that can grow in size and supports multiple readers.
 * Contrary to many other ring buffer implementations this one does not automatically overwrite the oldest
 * elements, rather, if full, the buffer tries to grow and rejects further writes if max capacity is reached.
 */</span>
private<span class="delimiter">[</span>akka<span class="delimiter">]</span> class <a title="class ResizableMultiReaderRingBuffer[T] extends AnyRef" id="akka.stream.impl;ResizableMultiReaderRingBuffer">ResizableMultiReaderRingBuffer</a><span class="delimiter">[</span><a title="" id="akka.stream.impl;ResizableMultiReaderRingBuffer;T">T</a><span class="delimiter">]</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer" title="akka.stream.impl.ResizableMultiReaderRingBuffer[T]" class="delimiter">(</a><a title="Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.initialSize">initialSize</a>: <span title="Int">Int</span>, <span class="comment">// constructor param, not field</span>
                                                      <a title="Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.maxSize">maxSize</a>: <span title="Int">Int</span>, <span class="comment">// constructor param, not field</span>
                                                      val <a title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursors" id="akka.stream.impl;ResizableMultiReaderRingBuffer.cursors">cursors</a>: <a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursors" title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursors">Cursors</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">lowestOneBit</span><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.maxSize" title="Int">maxSize</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.maxSize" title="Int">maxSize</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.maxSize" title="Int">maxSize</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.maxSize" title="Int">maxSize</a> <span title="(x: Int)Boolean">&lt;=</span> Int.MaxValue <span title="Int(1073741823)">/</span> <span class="int">2</span>,
    <span title="String(&quot;maxSize must be a power of 2 that is &gt; 0 and &lt; Int.MaxValue/2&quot;)" class="string">&quot;maxSize must be a power of 2 that is &gt; 0 and &lt; Int.MaxValue/2&quot;</span><span class="delimiter">)</span>
  <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">lowestOneBit</span><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.initialSize" title="Int">initialSize</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.initialSize" title="Int">initialSize</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.initialSize" title="Int">initialSize</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.initialSize" title="Int">initialSize</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.maxSize" title="Int">maxSize</a>,
    <span title="String(&quot;initialSize must be a power of 2 that is &gt; 0 and &lt;= maxSize&quot;)" class="string">&quot;initialSize must be a power of 2 that is &gt; 0 and &lt;= maxSize&quot;</span><span class="delimiter">)</span>

  private<span class="delimiter">[</span>this<span class="delimiter">]</span> val <a title="Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.maxSizeBit">maxSizeBit</a> = <span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">numberOfTrailingZeros</span><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.maxSize" title="Int">maxSize</a><span class="delimiter">)</span>
  private<span class="delimiter">[</span>this<span class="delimiter">]</span> var <a title="Array[Any]" id="akka.stream.impl;ResizableMultiReaderRingBuffer.array">array</a> = new <span title="Array[Any]">Array</span><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.initialSize" title="Int">initialSize</a><span class="delimiter">)</span>

  <span class="comment">/*
   * two counters counting the number of elements ever written and read; wrap-around is
   * handled by always looking at differences or masked values
   */</span>
  private<span class="delimiter">[</span>this<span class="delimiter">]</span> var <a title="Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.writeIx">writeIx</a> = <span title="Int(0)" class="int">0</span>
  private<span class="delimiter">[</span>this<span class="delimiter">]</span> var <a title="Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.readIx">readIx</a> = <span title="Int(0)" class="int">0</span> <span class="comment">// the &quot;oldest&quot; of all read cursor indices, i.e. the one that is most behind</span>

  <span class="comment">// current array.length log2, we don't keep it as an extra field because `Integer.numberOfTrailingZeros`</span>
  <span class="comment">// is a JVM intrinsic compiling down to a `BSF` instruction on x86, which is very fast on modern CPUs</span>
  private def <a title="=&gt; Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.lenBit">lenBit</a>: <span title="Int">Int</span> = <span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">numberOfTrailingZeros</span><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.array" title="Array[Any]">array</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>

  <span class="comment">// bit mask for converting a cursor into an array index</span>
  private def <a title="=&gt; Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.mask">mask</a>: <span title="Int">Int</span> = Int.<span title="Int(2147483647)">MaxValue</span> <span title="(x: Int)Int">&gt;&gt;</span> <span class="delimiter">(</span><span title="Int(31)" class="int">31</span> <span title="(x: Int)Int">-</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.lenBit" title="=&gt; Int">lenBit</a><span class="delimiter">)</span>

  <span class="comment">/**
   * The number of elements currently in the buffer.
   */</span>
  def <a title="=&gt; Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.size">size</a>: <span title="Int">Int</span> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.writeIx" title="Int">writeIx</a> <span title="(x: Int)Int">-</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.readIx" title="Int">readIx</a>

  def <a title="=&gt; Boolean" id="akka.stream.impl;ResizableMultiReaderRingBuffer.isEmpty">isEmpty</a>: <span title="Boolean">Boolean</span> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.size" title="=&gt; Int">size</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span>

  def <a title="=&gt; Boolean" id="akka.stream.impl;ResizableMultiReaderRingBuffer.nonEmpty">nonEmpty</a>: <span title="Boolean">Boolean</span> = <span title="=&gt; Boolean">!</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.isEmpty" title="=&gt; Boolean">isEmpty</a>

  <span class="comment">/**
   * The number of elements the buffer can still take without having to be resized.
   */</span>
  def <a title="=&gt; Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.immediatelyAvailable">immediatelyAvailable</a>: <span title="Int">Int</span> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.array" title="Array[Any]">array</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.size" title="=&gt; Int">size</a>

  <span class="comment">/**
   * The maximum number of elements the buffer can still take.
   */</span>
  def <a title="=&gt; Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.maxAvailable">maxAvailable</a>: <span title="Int">Int</span> = <span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <span title="(x: Int)Int">&lt;&lt;</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.maxSizeBit" title="Int">maxSizeBit</a><span class="delimiter">)</span> <span title="(x: Int)Int">-</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.size" title="=&gt; Int">size</a>

  <span class="comment">/**
   * Returns the number of elements that the buffer currently contains for the given cursor.
   */</span>
  def <a title="(cursor: akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor)Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.count">count</a><span class="delimiter">(</span><a title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor" id="akka.stream.impl;ResizableMultiReaderRingBuffer.count.cursor">cursor</a>: <a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor" title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor">Cursor</a><span class="delimiter">)</span>: <span title="Int">Int</span> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.writeIx" title="Int">writeIx</a> <span title="(x: Int)Int">-</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.count.cursor" title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor">cursor</a>.<a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor.cursor" title="=&gt; Int">cursor</a>

  <span class="comment">/**
   * Initializes the given Cursor to the oldest buffer entry that is still available.
   */</span>
  def <a title="(cursor: akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor)Unit" id="akka.stream.impl;ResizableMultiReaderRingBuffer.initCursor">initCursor</a><span class="delimiter">(</span><a title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor" id="akka.stream.impl;ResizableMultiReaderRingBuffer.initCursor.cursor">cursor</a>: <a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor" title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor">Cursor</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.initCursor.cursor" title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor">cursor</a>.<a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor.cursor_=" title="(ix: Int)Unit">cursor</a> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.readIx" title="Int">readIx</a>

  <span class="comment">/**
   * Tries to write the given value into the buffer thereby potentially growing the backing array.
   * Returns `true` if the write was successful and false if the buffer is full and cannot grow anymore.
   */</span>
  def <a title="(value: T)Boolean" id="akka.stream.impl;ResizableMultiReaderRingBuffer.write">write</a><span class="delimiter">(</span><a title="T" id="akka.stream.impl;ResizableMultiReaderRingBuffer.write.value">value</a>: <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer;T" title="T">T</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> =
    if <span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.size" title="=&gt; Int">size</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.array" title="Array[Any]">array</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">// if we have space left we can simply write and be done</span>
      <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.array" title="(i: Int, x: Any)Unit">array</a><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.writeIx" title="Int">writeIx</a> <span title="(x: Int)Int">&amp;</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.mask" title="=&gt; Int">mask</a><span class="delimiter">)</span> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.value" title="T">value</a>
      <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.writeIx" title="Int">writeIx</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      true
    <span class="delimiter">}</span> else if <span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.lenBit" title="=&gt; Int">lenBit</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.maxSizeBit" title="Int">maxSizeBit</a><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">// if we are full but can grow we do so</span>
      <span class="comment">// the growing logic is quite simple: we assemble all current buffer entries in the new array</span>
      <span class="comment">// in their natural order (removing potential wrap around) and rebase all indices to zero</span>
      val r = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.readIx" title="Int">readIx</a> <a title="Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.write.r">&amp;</a> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.mask" title="=&gt; Int">mask</a>
      val <a title="Array[Any]" id="akka.stream.impl;ResizableMultiReaderRingBuffer.write.newArray">newArray</a> = new <span title="Array[Any]">Array</span><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.array" title="Array[Any]">array</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">&lt;&lt;</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span title="System.type">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.array" title="Array[Any]">array</a>, <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.r" title="Int">r</a>, <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.newArray" title="Array[Any]">newArray</a>, <span title="Int(0)" class="int">0</span>, <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.array" title="Array[Any]">array</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.r" title="Int">r</a><span class="delimiter">)</span>
      <span title="System.type">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.array" title="Array[Any]">array</a>, <span title="Int(0)" class="int">0</span>, <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.newArray" title="Array[Any]">newArray</a>, <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.array" title="Array[Any]">array</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.r" title="Int">r</a>, <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.r" title="Int">r</a><span class="delimiter">)</span>
      @tailrec def <a title="(remaining: List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor])Unit" id="akka.stream.impl;ResizableMultiReaderRingBuffer.write.rebaseCursors">rebaseCursors</a><span class="delimiter">(</span><a title="List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]" id="akka.stream.impl;ResizableMultiReaderRingBuffer.write.rebaseCursors.remaining">remaining</a>: <span title="List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]">List</span><span class="delimiter">[</span>Cursor<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.rebaseCursors.remaining" title="List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]">remaining</a> match <span class="delimiter">{</span>
        case <a title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor" id="akka.stream.impl;ResizableMultiReaderRingBuffer.write.rebaseCursors.head">head</a> :: <a title="List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]" id="akka.stream.impl;ResizableMultiReaderRingBuffer.write.rebaseCursors.tail">tail</a> ⇒
          <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.rebaseCursors.head" title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor">head</a>.<a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor.cursor_=" title="(ix: Int)Unit">cursor</a> <span title="(x: Int)Int">-=</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.readIx" title="Int">readIx</a>
          <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.rebaseCursors" title="(remaining: List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor])Unit">rebaseCursors</a><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.rebaseCursors.tail" title="List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]">tail</a><span class="delimiter">)</span>
        case _ ⇒ <span class="comment">// done</span>
      <span class="delimiter">}</span>
      <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.rebaseCursors" title="(remaining: List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor])Unit">rebaseCursors</a><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.cursors" title="=&gt; akka.stream.impl.ResizableMultiReaderRingBuffer.Cursors">cursors</a>.<a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursors.cursors" title="=&gt; List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]">cursors</a><span class="delimiter">)</span>
      <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.array" title="Array[Any]">array</a> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.newArray" title="Array[Any]">newArray</a>
      val <a title="Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.write.w">w</a> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.size" title="=&gt; Int">size</a>
      <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.array" title="(i: Int, x: Any)Unit">array</a><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.w" title="Int">w</a> <span title="(x: Int)Int">&amp;</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.mask" title="=&gt; Int">mask</a><span class="delimiter">)</span> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.value" title="T">value</a>
      <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.writeIx" title="Int">writeIx</a> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.write.w" title="Int">w</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>
      <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.readIx" title="Int">readIx</a> = <span title="Int(0)" class="int">0</span>
      true
    <span class="delimiter">}</span> else false

  <span class="comment">/**
   * Tries to read from the buffer using the given Cursor.
   * If there are no more data to be read (i.e. the cursor is already
   * at writeIx) the method throws ResizableMultiReaderRingBuffer.NothingToReadException!
   */</span>
  def <a title="(cursor: akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor)T" id="akka.stream.impl;ResizableMultiReaderRingBuffer.read">read</a><span class="delimiter">(</span><a title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor" id="akka.stream.impl;ResizableMultiReaderRingBuffer.read.cursor">cursor</a>: <a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor" title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor">Cursor</a><span class="delimiter">)</span>: <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer;T" title="T">T</a> = <span class="delimiter">{</span>
    val <a title="Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.read.c">c</a> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.read.cursor" title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor">cursor</a>.<a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor.cursor" title="=&gt; Int">cursor</a>
    if <span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.read.c" title="Int">c</a> <span title="(x: Int)Int">-</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.writeIx" title="Int">writeIx</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.read.cursor" title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor">cursor</a>.<a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor.cursor_=" title="(ix: Int)Unit">cursor</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      val <a title="T" id="akka.stream.impl;ResizableMultiReaderRingBuffer.read.ret">ret</a> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.array" title="(i: Int)Any">array</a><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.read.c" title="Int">c</a> <span title="(x: Int)Int">&amp;</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.mask" title="=&gt; Int">mask</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer;T" title="T">T</a><span class="delimiter">]</span>
      if <span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.read.c" title="Int">c</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.readIx" title="Int">readIx</a><span class="delimiter">)</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx" title="()Unit">updateReadIx</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.read.ret" title="T">ret</a>
    <span class="delimiter">}</span> else throw <a href="#akka.stream.impl.ResizableMultiReaderRingBuffer.NothingToReadException.readResolve" title="akka.stream.impl.ResizableMultiReaderRingBuffer.NothingToReadException.type">NothingToReadException</a>
  <span class="delimiter">}</span>

  def <a title="(cursor: akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor)Unit" id="akka.stream.impl;ResizableMultiReaderRingBuffer.onCursorRemoved">onCursorRemoved</a><span class="delimiter">(</span><a title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor" id="akka.stream.impl;ResizableMultiReaderRingBuffer.onCursorRemoved.cursor">cursor</a>: <a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor" title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor">Cursor</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    if <span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.onCursorRemoved.cursor" title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor">cursor</a>.<a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor.cursor" title="=&gt; Int">cursor</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.readIx" title="Int">readIx</a><span class="delimiter">)</span> <span class="comment">// if this cursor is the last one it must be at readIx</span>
      <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx" title="()Unit">updateReadIx</a><span class="delimiter">(</span><span class="delimiter">)</span>

  private def <a title="()Unit" id="akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx">updateReadIx</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    @tailrec def <a title="(remaining: List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor], result: Int)Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.minCursor">minCursor</a><span class="delimiter">(</span><a title="List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]" id="akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.minCursor.remaining">remaining</a>: <span title="List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]">List</span><span class="delimiter">[</span>Cursor<span class="delimiter">]</span>, <a title="Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.minCursor.result">result</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> =
      <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.minCursor.remaining" title="List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]">remaining</a> match <span class="delimiter">{</span>
        case <a title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor" id="akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.minCursor.head">head</a> :: <a title="List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]" id="akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.minCursor.tail">tail</a> ⇒ <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.minCursor" title="(remaining: List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor], result: Int)Int">minCursor</a><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.minCursor.tail" title="List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]">tail</a>, math.<span title="(x: Int, y: Int)Int">min</span><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.minCursor.head" title="akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor">head</a>.<a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor.cursor" title="=&gt; Int">cursor</a> <span title="(x: Int)Int">-</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.writeIx" title="Int">writeIx</a>, <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.minCursor.result" title="Int">result</a><span class="delimiter">)</span><span class="delimiter">)</span>
        case _            ⇒ <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.minCursor.result" title="Int">result</a>
      <span class="delimiter">}</span>
    val newReadIx = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.writeIx" title="Int">writeIx</a> <a title="Int" id="akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.newReadIx">+</a> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.minCursor" title="(remaining: List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor], result: Int)Int">minCursor</a><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.cursors" title="=&gt; akka.stream.impl.ResizableMultiReaderRingBuffer.Cursors">cursors</a>.<a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursors.cursors" title="=&gt; List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]">cursors</a>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    while <span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.readIx" title="Int">readIx</a> <span title="(x: Int)Boolean">!=</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.newReadIx" title="Int">newReadIx</a><span class="delimiter">)</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.updateReadIx.while$1" title="()Unit" class="delimiter">{</a>
      <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.array" title="(i: Int, x: Any)Unit">array</a><span class="delimiter">(</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.readIx" title="Int">readIx</a> <span title="(x: Int)Int">&amp;</span> <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.mask" title="=&gt; Int">mask</a><span class="delimiter">)</span> = null
      <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.readIx" title="Int">readIx</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  protected def <a title="=&gt; Array[Any]" id="akka.stream.impl;ResizableMultiReaderRingBuffer.underlyingArray">underlyingArray</a>: <span title="Array[Any]">Array</span><span class="delimiter">[</span>Any<span class="delimiter">]</span> = <a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.array" title="Array[Any]">array</a>

  override def <a title="()String" id="akka.stream.impl;ResizableMultiReaderRingBuffer.toString">toString</a>: <span title="String">String</span> =
    <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;ResizableMultiReaderRingBuffer(size=&quot;)">ResizableMultiReaderRingBuffer(size=$</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.size" title="=&gt; Int">size</a><span title="String(&quot;, writeIx=&quot;)">, writeIx=$</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.writeIx" title="Int">writeIx</a><span title="String(&quot;, readIx=&quot;)">, readIx=$</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.readIx" title="Int">readIx</a><span title="String(&quot;, cursors=&quot;)">, cursors=$</span><span class="delimiter">{</span><a href="#akka.stream.impl;ResizableMultiReaderRingBuffer.cursors" title="=&gt; akka.stream.impl.ResizableMultiReaderRingBuffer.Cursors">cursors</a>.<a href="#akka.stream.impl.ResizableMultiReaderRingBuffer;Cursors.cursors" title="=&gt; List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]">cursors</a>.<span title="=&gt; Int">size</span><span class="delimiter">}</span><span title="String(&quot;)&quot;)" class="string">)&quot;</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API
 */</span>
private<span class="delimiter">[</span>akka<span class="delimiter">]</span> object <a title="akka.stream.impl.ResizableMultiReaderRingBuffer.type" id="akka.stream.impl.ResizableMultiReaderRingBuffer">ResizableMultiReaderRingBuffer</a> <a href="#akka.stream.impl.ResizableMultiReaderRingBuffer" title="akka.stream.impl.ResizableMultiReaderRingBuffer.type" class="delimiter">{</a>
  object <a title="akka.stream.impl.ResizableMultiReaderRingBuffer.NothingToReadException.type" id="akka.stream.impl.ResizableMultiReaderRingBuffer.NothingToReadException.readResolve">NothingToReadException</a> extends <span title="RuntimeException">RuntimeException</span> with <span title="scala.util.control.NoStackTrace">NoStackTrace</span>

  trait <a title="trait Cursors extends AnyRef" id="akka.stream.impl.ResizableMultiReaderRingBuffer;Cursors">Cursors</a> <span class="delimiter">{</span>
    def <a title="=&gt; List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]" id="akka.stream.impl.ResizableMultiReaderRingBuffer;Cursors.cursors">cursors</a>: <span title="List[akka.stream.impl.ResizableMultiReaderRingBuffer.Cursor]">List</span><span class="delimiter">[</span>Cursor<span class="delimiter">]</span>
  <span class="delimiter">}</span>
  trait <a title="trait Cursor extends AnyRef" id="akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor">Cursor</a> <span class="delimiter">{</span>
    def <a title="=&gt; Int" id="akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor.cursor">cursor</a>: <span title="Int">Int</span>
    def <a title="(ix: Int)Unit" id="akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor.cursor_=">cursor_=</a><span class="delimiter">(</span><a title="Int" id="akka.stream.impl.ResizableMultiReaderRingBuffer;Cursor.cursor_=.ix">ix</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span>
  <span class="delimiter">}</span>
<span title="AnyRef" class="delimiter">}</span>
        </pre>
    </body>
</html>
