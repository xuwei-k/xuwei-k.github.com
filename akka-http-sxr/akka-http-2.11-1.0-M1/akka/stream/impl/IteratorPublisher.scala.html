<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>akka/stream/impl/IteratorPublisher.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
package akka.stream.impl

import scala.annotation.tailrec
import scala.util.control.NonFatal
import akka.actor.Actor
import akka.actor.Props
import akka.event.Logging
import akka.stream.MaterializerSettings

import org.reactivestreams.Subscriber

<span class="comment">/**
 * INTERNAL API
 */</span>
private<span class="delimiter">[</span>akka<span class="delimiter">]</span> object <a title="akka.stream.impl.IteratorPublisher.type" id="akka.stream.impl.IteratorPublisher">IteratorPublisher</a> <a href="#akka.stream.impl.IteratorPublisher" title="akka.stream.impl.IteratorPublisher.type" class="delimiter">{</a>
  def <a title="(iterator: Iterator[Any], settings: akka.stream.MaterializerSettings)akka.actor.Props" id="akka.stream.impl.IteratorPublisher.props">props</a><span class="delimiter">(</span><a title="Iterator[Any]" id="akka.stream.impl.IteratorPublisher.props.iterator">iterator</a>: <span title="Iterator[Any]">Iterator</span><span class="delimiter">[</span>Any<span class="delimiter">]</span>, <a title="akka.stream.MaterializerSettings" id="akka.stream.impl.IteratorPublisher.props.settings">settings</a>: <a href="../FlowMaterializer.scala.html#akka.stream;MaterializerSettings" title="akka.stream.MaterializerSettings">MaterializerSettings</a><span class="delimiter">)</span>: <span title="akka.actor.Props">Props</span> =
    <span title="(creator: =&gt; akka.stream.impl.IteratorPublisher)(implicit evidence$2: scala.reflect.ClassTag[akka.stream.impl.IteratorPublisher])akka.actor.Props">Props</span><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[akka.stream.impl.IteratorPublisher]" class="delimiter">(</span>new <a href="#akka.stream.impl;IteratorPublisher" title="akka.stream.impl.IteratorPublisher">IteratorPublisher</a><span class="delimiter">(</span><a href="#akka.stream.impl.IteratorPublisher.props.iterator" title="Iterator[Any]">iterator</a>, <a href="#akka.stream.impl.IteratorPublisher.props.settings" title="akka.stream.MaterializerSettings">settings</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(d: String)akka.actor.Props">withDispatcher</span><span class="delimiter">(</span><a href="#akka.stream.impl.IteratorPublisher.props.settings" title="akka.stream.MaterializerSettings">settings</a>.<a href="../FlowMaterializer.scala.html#akka.stream;MaterializerSettings.dispatcher" title="=&gt; String">dispatcher</a><span class="delimiter">)</span>

  private case object <a href="#akka.stream.impl.IteratorPublisher.PushMore.productElement.x$1" title="akka.stream.impl.IteratorPublisher.PushMore.type" id="akka.stream.impl.IteratorPublisher.PushMore.readResolve">PushMore</a>

  private sealed trait <a title="trait State extends AnyRef" id="akka.stream.impl.IteratorPublisher;State">State</a>
  private sealed trait <a title="trait StopState extends AnyRef with akka.stream.impl.IteratorPublisher.State" id="akka.stream.impl.IteratorPublisher;StopState">StopState</a> extends <a href="#akka.stream.impl.IteratorPublisher;State" title="akka.stream.impl.IteratorPublisher.State">State</a>
  private case object <a href="#akka.stream.impl.IteratorPublisher.Unitialized.productElement.x$1" title="akka.stream.impl.IteratorPublisher.Unitialized.type" id="akka.stream.impl.IteratorPublisher.Unitialized.readResolve">Unitialized</a> extends <a href="#akka.stream.impl.IteratorPublisher;State" title="akka.stream.impl.IteratorPublisher.State">State</a>
  private case object <a href="#akka.stream.impl.IteratorPublisher.Initialized.productElement.x$1" title="akka.stream.impl.IteratorPublisher.Initialized.type" id="akka.stream.impl.IteratorPublisher.Initialized.readResolve">Initialized</a> extends <a href="#akka.stream.impl.IteratorPublisher;State" title="akka.stream.impl.IteratorPublisher.State">State</a>
  private case object <a href="#akka.stream.impl.IteratorPublisher.Cancelled.productElement.x$1" title="akka.stream.impl.IteratorPublisher.Cancelled.type" id="akka.stream.impl.IteratorPublisher.Cancelled.readResolve">Cancelled</a> extends <a href="#akka.stream.impl.IteratorPublisher;StopState" title="akka.stream.impl.IteratorPublisher.StopState">StopState</a>
  private case object <a href="#akka.stream.impl.IteratorPublisher.Completed.productElement.x$1" title="akka.stream.impl.IteratorPublisher.Completed.type" id="akka.stream.impl.IteratorPublisher.Completed.readResolve">Completed</a> extends <a href="#akka.stream.impl.IteratorPublisher;StopState" title="akka.stream.impl.IteratorPublisher.StopState">StopState</a>
  private case class <a title="class Errored extends AnyRef with akka.stream.impl.IteratorPublisher.StopState with Product with Serializable" id="akka.stream.impl.IteratorPublisher.Errored.readResolve">Errored</a><span title="Product" class="delimiter">(</span><a title="Throwable" id="akka.stream.impl.IteratorPublisher;Errored.cause">cause</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span> extends <a href="#akka.stream.impl.IteratorPublisher;StopState" title="akka.stream.impl.IteratorPublisher.StopState">StopState</a>
<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API
 * Elements are produced from the iterator.
 */</span>
private<span class="delimiter">[</span>akka<span class="delimiter">]</span> class <a title="class IteratorPublisher extends AnyRef with akka.actor.Actor" id="akka.stream.impl;IteratorPublisher">IteratorPublisher</a><a href="#akka.stream.impl;IteratorPublisher" title="akka.stream.impl.IteratorPublisher" class="delimiter">(</a><a title="Iterator[Any]" id="akka.stream.impl;IteratorPublisher.iterator">iterator</a>: <span title="Iterator[Any]">Iterator</span><span class="delimiter">[</span>Any<span class="delimiter">]</span>, <a title="akka.stream.MaterializerSettings" id="akka.stream.impl;IteratorPublisher.settings">settings</a>: <a href="../FlowMaterializer.scala.html#akka.stream;MaterializerSettings" title="akka.stream.MaterializerSettings">MaterializerSettings</a><span class="delimiter">)</span> extends <a href="#akka.stream.impl;IteratorPublisher" title="akka.actor.Actor">Actor</a> <span class="delimiter">{</span>
  import <a href="#akka.stream.impl.IteratorPublisher" title="akka.stream.impl.IteratorPublisher.type">IteratorPublisher</a>._
  import <a href="ReactiveStreamsCompliance.scala.html#akka.stream.impl.ReactiveStreamsCompliance" title="akka.stream.impl.ReactiveStreamsCompliance.type">ReactiveStreamsCompliance</a>._

  private var <a title="akka.stream.impl.ActorPublisher[Any]" id="akka.stream.impl;IteratorPublisher.exposedPublisher_=">exposedPublisher</a>: <a href="ActorPublisher.scala.html#akka.stream.impl;ActorPublisher" title="akka.stream.impl.ActorPublisher[Any]">ActorPublisher</a><span class="delimiter">[</span>Any<span class="delimiter">]</span> = _
  private var <a title="org.reactivestreams.Subscriber[Any]" id="akka.stream.impl;IteratorPublisher.subscriber_=">subscriber</a>: <span title="org.reactivestreams.Subscriber[Any]">Subscriber</span><span class="delimiter">[</span>Any<span class="delimiter">]</span> = _
  private var <a title="Long" id="akka.stream.impl;IteratorPublisher.downstreamDemand_=">downstreamDemand</a>: <span title="Long">Long</span> = <span title="Long(0L)" class="long">0L</span>
  private var <a title="akka.stream.impl.IteratorPublisher.State" id="akka.stream.impl;IteratorPublisher.state_=">state</a>: <a href="#akka.stream.impl.IteratorPublisher;State" title="akka.stream.impl.IteratorPublisher.State">State</a> = <a href="#akka.stream.impl.IteratorPublisher.Unitialized.readResolve" title="akka.stream.impl.IteratorPublisher.Unitialized.type">Unitialized</a>
  private val <a title="Int" id="akka.stream.impl;IteratorPublisher.maxPush">maxPush</a> = <a href="#akka.stream.impl;IteratorPublisher.settings" title="akka.stream.MaterializerSettings">settings</a>.<a href="../FlowMaterializer.scala.html#akka.stream;MaterializerSettings.maxInputBufferSize" title="=&gt; Int">maxInputBufferSize</a> <span class="comment">// FIXME why is this a good number?</span>

  def <a title="=&gt; PartialFunction[Any,Unit]" id="akka.stream.impl;IteratorPublisher.receive">receive</a> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.stream.impl;IteratorPublisher.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case ExposedPublisher<span class="delimiter">(</span><a title="akka.stream.impl.ActorPublisher[Any]" id="akka.stream.impl;IteratorPublisher.receive;$anonfun.isDefinedAt.publisher">publisher</a><span class="delimiter">)</span> ⇒
      <a href="#akka.stream.impl;IteratorPublisher.exposedPublisher_=" title="(x$1: akka.stream.impl.ActorPublisher[Any])Unit">exposedPublisher</a> = <a href="#akka.stream.impl;IteratorPublisher.receive;$anonfun.isDefinedAt.publisher" title="akka.stream.impl.ActorPublisher[Any]">publisher</a>
      <a href="#akka.stream.impl;IteratorPublisher" title="=&gt; akka.actor.ActorContext">context</a>.<span title="(behavior: akka.actor.Actor.Receive)Unit">become</span><span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.waitingForFirstSubscriber" title="=&gt; IteratorPublisher.this.Receive">waitingForFirstSubscriber</a><span class="delimiter">)</span>
    case _ ⇒
      throw new <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;The first message must be ExposedPublisher&quot;)" class="string">&quot;The first message must be ExposedPublisher&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="=&gt; IteratorPublisher.this.Receive" id="akka.stream.impl;IteratorPublisher.waitingForFirstSubscriber">waitingForFirstSubscriber</a>: <span title="IteratorPublisher.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.stream.impl;IteratorPublisher.waitingForFirstSubscriber;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case <a href="Messages.scala.html#akka.stream.impl.SubscribePending" title="akka.stream.impl.SubscribePending.type">SubscribePending</a> ⇒
      <a href="#akka.stream.impl;IteratorPublisher.exposedPublisher_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">exposedPublisher</a>.<a href="ActorPublisher.scala.html#akka.stream.impl;ActorPublisher.takePendingSubscribers" title="()scala.collection.immutable.Seq[org.reactivestreams.Subscriber[_ &gt;: Any]]">takePendingSubscribers</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(f: org.reactivestreams.Subscriber[_ &gt;: Any] =&gt; Unit)Unit">foreach</span> <a href="#akka.stream.impl;IteratorPublisher.registerSubscriber" title="(sub: org.reactivestreams.Subscriber[Any])Unit">registerSubscriber</a>
      <a href="#akka.stream.impl;IteratorPublisher.state_=" title="(x$1: akka.stream.impl.IteratorPublisher.State)Unit">state</a> = <a href="#akka.stream.impl.IteratorPublisher.Initialized.readResolve" title="akka.stream.impl.IteratorPublisher.Initialized.type">Initialized</a>
      <span class="comment">// hasNext might throw</span>
      try <span class="delimiter">{</span>
        if <span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.iterator" title="Iterator[Any]">iterator</a>.<span title="=&gt; Boolean">hasNext</span><span class="delimiter">)</span> <a href="#akka.stream.impl;IteratorPublisher" title="=&gt; akka.actor.ActorContext">context</a>.<span title="(behavior: akka.actor.Actor.Receive)Unit">become</span><span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.active" title="=&gt; IteratorPublisher.this.Receive">active</a><span class="delimiter">)</span>
        else <a href="#akka.stream.impl;IteratorPublisher.stop" title="(reason: akka.stream.impl.IteratorPublisher.StopState)Unit">stop</a><span class="delimiter">(</span><a href="#akka.stream.impl.IteratorPublisher.Completed.readResolve" title="akka.stream.impl.IteratorPublisher.Completed.type">Completed</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> catch <span class="delimiter">{</span> case <a href="#akka.stream.impl;IteratorPublisher.waitingForFirstSubscriber;$anonfun.applyOrElse.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="akka.stream.impl;IteratorPublisher.waitingForFirstSubscriber;$anonfun.applyOrElse.e">e</a><span class="delimiter">)</span> ⇒ <a href="#akka.stream.impl;IteratorPublisher.stop" title="(reason: akka.stream.impl.IteratorPublisher.StopState)Unit">stop</a><span class="delimiter">(</span><a href="#akka.stream.impl.IteratorPublisher.Errored.readResolve" title="(cause: Throwable)akka.stream.impl.IteratorPublisher.Errored">Errored</a><span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.waitingForFirstSubscriber;$anonfun.applyOrElse.e" title="Throwable">e</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  def <a title="=&gt; IteratorPublisher.this.Receive" id="akka.stream.impl;IteratorPublisher.active">active</a>: <span title="IteratorPublisher.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.stream.impl;IteratorPublisher.active;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case RequestMore<span class="delimiter">(</span>_, <a title="Long" id="akka.stream.impl;IteratorPublisher.active;$anonfun.isDefinedAt.elements">elements</a><span class="delimiter">)</span> ⇒
      <a href="#akka.stream.impl;IteratorPublisher.downstreamDemand_=" title="(x$1: Long)Unit">downstreamDemand</a> <span title="(x: Long)Long">+=</span> <a href="#akka.stream.impl;IteratorPublisher.active;$anonfun.isDefinedAt.elements" title="Long">elements</a>
      if <span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.downstreamDemand_=" title="=&gt; Long">downstreamDemand</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">// Long has overflown, reactive-streams specification rule 3.17</span>
        <a href="#akka.stream.impl;IteratorPublisher.stop" title="(reason: akka.stream.impl.IteratorPublisher.StopState)Unit">stop</a><span class="delimiter">(</span><a href="#akka.stream.impl.IteratorPublisher.Errored.readResolve" title="(cause: Throwable)akka.stream.impl.IteratorPublisher.Errored">Errored</a><span class="delimiter">(</span>new <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;Total pending demand MUST NOT be &gt; `java.lang.Long.MAX_VALUE` (see reactive-streams specification, rule 3.17)&quot;)">TotalPendingDemandMustNotExceedLongMaxValue</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      else
        <a href="#akka.stream.impl;IteratorPublisher.push" title="()Unit">push</a><span class="delimiter">(</span><span class="delimiter">)</span>
    case <a href="#akka.stream.impl.IteratorPublisher.PushMore.readResolve" title="akka.stream.impl.IteratorPublisher.PushMore.type">PushMore</a> ⇒
      <a href="#akka.stream.impl;IteratorPublisher.push" title="()Unit">push</a><span title="Boolean(true)" class="delimiter">(</span><span class="delimiter">)</span>
    case _: <a href="Messages.scala.html#akka.stream.impl;Cancel" title="akka.stream.impl.Cancel">Cancel</a> ⇒
      <a href="#akka.stream.impl;IteratorPublisher.stop" title="(reason: akka.stream.impl.IteratorPublisher.StopState)Unit">stop</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.stream.impl.IteratorPublisher.Cancelled.readResolve" title="akka.stream.impl.IteratorPublisher.Cancelled.type">Cancelled</a><span class="delimiter">)</span>
    case <a href="Messages.scala.html#akka.stream.impl.SubscribePending" title="akka.stream.impl.SubscribePending.type">SubscribePending</a> ⇒
      <a href="#akka.stream.impl;IteratorPublisher.exposedPublisher_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">exposedPublisher</a>.<a href="ActorPublisher.scala.html#akka.stream.impl;ActorPublisher.takePendingSubscribers" title="()scala.collection.immutable.Seq[org.reactivestreams.Subscriber[_ &gt;: Any]]">takePendingSubscribers</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(f: org.reactivestreams.Subscriber[_ &gt;: Any] =&gt; Unit)Unit">foreach</span> <a href="#akka.stream.impl;IteratorPublisher.registerSubscriber" title="(sub: org.reactivestreams.Subscriber[Any])Unit">registerSubscriber</a>
  <span class="delimiter">}</span>

  <span class="comment">// note that iterator.hasNext is always true when calling push, completing as soon as hasNext is false</span>
  private def <a title="()Unit" id="akka.stream.impl;IteratorPublisher.push">push</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    @tailrec def <a title="(n: Int)Unit" id="akka.stream.impl;IteratorPublisher.push.doPush">doPush</a><span class="delimiter">(</span><a title="Int" id="akka.stream.impl;IteratorPublisher.push.doPush.n">n</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
      if <span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.downstreamDemand_=" title="=&gt; Long">downstreamDemand</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.stream.impl;IteratorPublisher.downstreamDemand_=" title="(x$1: Long)Unit">downstreamDemand</a> <span title="(x: Int)Long">-=</span> <span title="Int(1)" class="int">1</span>
        val <a title="Boolean" id="akka.stream.impl;IteratorPublisher.push.doPush.hasNext">hasNext</a> = <span class="delimiter">{</span>
          <a href="ReactiveStreamsCompliance.scala.html#akka.stream.impl.ReactiveStreamsCompliance.tryOnNext" title="(subscriber: org.reactivestreams.Subscriber[Any], element: Any)Unit">tryOnNext</a><span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.subscriber_=" title="=&gt; org.reactivestreams.Subscriber[Any]">subscriber</a>, <a href="#akka.stream.impl;IteratorPublisher.iterator" title="Iterator[Any]">iterator</a>.<span title="()Any">next</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#akka.stream.impl;IteratorPublisher.iterator" title="Iterator[Any]">iterator</a>.<span title="=&gt; Boolean">hasNext</span>
        <span class="delimiter">}</span>
        if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.stream.impl;IteratorPublisher.push.doPush.hasNext" title="Boolean">hasNext</a><span class="delimiter">)</span>
          <a href="#akka.stream.impl;IteratorPublisher.stop" title="(reason: akka.stream.impl.IteratorPublisher.StopState)Unit">stop</a><span class="delimiter">(</span><a href="#akka.stream.impl.IteratorPublisher.Completed.readResolve" title="akka.stream.impl.IteratorPublisher.Completed.type">Completed</a><span class="delimiter">)</span>
        else if <span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.push.doPush.n" title="Int">n</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.stream.impl;IteratorPublisher.downstreamDemand_=" title="=&gt; Long">downstreamDemand</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
          <a href="#akka.stream.impl;IteratorPublisher" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">self</a> <a href="#akka.stream.impl;IteratorPublisher" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.stream.impl.IteratorPublisher.PushMore.readResolve" title="akka.stream.impl.IteratorPublisher.PushMore.type">PushMore</a>
        else
          <a href="#akka.stream.impl;IteratorPublisher.push.doPush" title="(n: Int)Unit">doPush</a><span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.push.doPush.n" title="Int">n</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    try <a href="#akka.stream.impl;IteratorPublisher.push.doPush" title="(n: Int)Unit">doPush</a><span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.maxPush" title="=&gt; Int">maxPush</a><span class="delimiter">)</span> catch <span class="delimiter">{</span>
      case <a href="#akka.stream.impl;IteratorPublisher.push.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="akka.stream.impl;IteratorPublisher.push.e">e</a><span class="delimiter">)</span> ⇒ <a href="#akka.stream.impl;IteratorPublisher.stop" title="(reason: akka.stream.impl.IteratorPublisher.StopState)Unit">stop</a><span class="delimiter">(</span><a href="#akka.stream.impl.IteratorPublisher.Errored.readResolve" title="(cause: Throwable)akka.stream.impl.IteratorPublisher.Errored">Errored</a><span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.push.e" title="Throwable">e</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(sub: org.reactivestreams.Subscriber[Any])Unit" id="akka.stream.impl;IteratorPublisher.registerSubscriber">registerSubscriber</a><span class="delimiter">(</span><a title="org.reactivestreams.Subscriber[Any]" id="akka.stream.impl;IteratorPublisher.registerSubscriber.sub">sub</a>: <span title="org.reactivestreams.Subscriber[Any]">Subscriber</span><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.stream.impl;IteratorPublisher.subscriber_=" title="=&gt; org.reactivestreams.Subscriber[Any]">subscriber</a> match <span class="delimiter">{</span>
      case null ⇒
        <a href="#akka.stream.impl;IteratorPublisher.subscriber_=" title="(x$1: org.reactivestreams.Subscriber[Any])Unit">subscriber</a> = <a href="#akka.stream.impl;IteratorPublisher.registerSubscriber.sub" title="org.reactivestreams.Subscriber[Any]">sub</a>
        <a href="ReactiveStreamsCompliance.scala.html#akka.stream.impl.ReactiveStreamsCompliance.tryOnSubscribe" title="(subscriber: org.reactivestreams.Subscriber[Any], subscription: org.reactivestreams.Subscription)Unit">tryOnSubscribe</a><span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.registerSubscriber.sub" title="org.reactivestreams.Subscriber[Any]">sub</a>, new <a href="ActorPublisher.scala.html#akka.stream.impl;ActorSubscription" title="akka.stream.impl.ActorSubscription[Any]">ActorSubscription</a><span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.stream.impl;IteratorPublisher.registerSubscriber.sub" title="org.reactivestreams.Subscriber[Any]">sub</a><span class="delimiter">)</span><span class="delimiter">)</span>
      case _ ⇒
        <a href="ReactiveStreamsCompliance.scala.html#akka.stream.impl.ReactiveStreamsCompliance.rejectAdditionalSubscriber" title="(subsriber: org.reactivestreams.Subscriber[Any], rejector: org.reactivestreams.Publisher[Any])Unit">rejectAdditionalSubscriber</a><span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.registerSubscriber.sub" title="org.reactivestreams.Subscriber[Any]">sub</a>, <a href="#akka.stream.impl;IteratorPublisher.exposedPublisher_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">exposedPublisher</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(reason: akka.stream.impl.IteratorPublisher.StopState)Unit" id="akka.stream.impl;IteratorPublisher.stop">stop</a><span class="delimiter">(</span><a title="akka.stream.impl.IteratorPublisher.StopState" id="akka.stream.impl;IteratorPublisher.stop.reason">reason</a>: <a href="#akka.stream.impl.IteratorPublisher;StopState" title="akka.stream.impl.IteratorPublisher.StopState">StopState</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.stream.impl;IteratorPublisher.state_=" title="=&gt; akka.stream.impl.IteratorPublisher.State">state</a> match <span class="delimiter">{</span>
      case _: <a href="#akka.stream.impl.IteratorPublisher;StopState" title="akka.stream.impl.IteratorPublisher.StopState">StopState</a> ⇒ throw new <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Already stopped. Transition attempted from &quot;)">Already stopped. Transition attempted from $</span><a href="#akka.stream.impl;IteratorPublisher.state_=" title="=&gt; akka.stream.impl.IteratorPublisher.State">state</a><span title="String(&quot; to &quot;)"> to $</span><a href="#akka.stream.impl;IteratorPublisher.stop.reason" title="akka.stream.impl.IteratorPublisher.StopState">reason</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
      case _ ⇒
        <a href="#akka.stream.impl;IteratorPublisher.state_=" title="(x$1: akka.stream.impl.IteratorPublisher.State)Unit">state</a> = <a href="#akka.stream.impl;IteratorPublisher.stop.reason" title="akka.stream.impl.IteratorPublisher.StopState">reason</a>
        <a href="#akka.stream.impl;IteratorPublisher" title="=&gt; akka.actor.ActorContext">context</a>.<span title="(actor: akka.actor.ActorRef)Unit">stop</span><span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  override def <a title="()Unit" id="akka.stream.impl;IteratorPublisher.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.stream.impl;IteratorPublisher.state_=" title="=&gt; akka.stream.impl.IteratorPublisher.State">state</a> match <span class="delimiter">{</span>
      case <a href="#akka.stream.impl.IteratorPublisher.Unitialized.readResolve" title="akka.stream.impl.IteratorPublisher.Unitialized.type">Unitialized</a> | <a href="#akka.stream.impl.IteratorPublisher.Initialized.readResolve" title="akka.stream.impl.IteratorPublisher.Initialized.type">Initialized</a> | <a href="#akka.stream.impl.IteratorPublisher.Cancelled.readResolve" title="akka.stream.impl.IteratorPublisher.Cancelled.type">Cancelled</a> ⇒
        if <span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.exposedPublisher_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">exposedPublisher</a> <span title="(x$1: AnyRef)Boolean">ne</span> null<span class="delimiter">)</span> <a href="#akka.stream.impl;IteratorPublisher.exposedPublisher_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">exposedPublisher</a>.<a href="ActorPublisher.scala.html#akka.stream.impl;ActorPublisher.shutdown" title="(reason: Option[Throwable])Unit">shutdown</a><span class="delimiter">(</span><a href="ActorPublisher.scala.html#akka.stream.impl.ActorPublisher" title="akka.stream.impl.ActorPublisher.type">ActorPublisher</a>.<a href="ActorPublisher.scala.html#akka.stream.impl.ActorPublisher.NormalShutdownReason" title="=&gt; Option[Throwable]">NormalShutdownReason</a><span class="delimiter">)</span>
      case <a href="#akka.stream.impl.IteratorPublisher.Completed.readResolve" title="akka.stream.impl.IteratorPublisher.Completed.type">Completed</a> ⇒
        <a href="ReactiveStreamsCompliance.scala.html#akka.stream.impl.ReactiveStreamsCompliance.tryOnComplete" title="(subscriber: org.reactivestreams.Subscriber[Any])Unit">tryOnComplete</a><span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.subscriber_=" title="=&gt; org.reactivestreams.Subscriber[Any]">subscriber</a><span class="delimiter">)</span>
        <a href="#akka.stream.impl;IteratorPublisher.exposedPublisher_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">exposedPublisher</a>.<a href="ActorPublisher.scala.html#akka.stream.impl;ActorPublisher.shutdown" title="(reason: Option[Throwable])Unit">shutdown</a><span class="delimiter">(</span><a href="ActorPublisher.scala.html#akka.stream.impl.ActorPublisher" title="akka.stream.impl.ActorPublisher.type">ActorPublisher</a>.<a href="ActorPublisher.scala.html#akka.stream.impl.ActorPublisher.NormalShutdownReason" title="=&gt; Option[Throwable]">NormalShutdownReason</a><span class="delimiter">)</span>
      case Errored<span class="delimiter">(</span><a title="Throwable" id="akka.stream.impl;IteratorPublisher.postStop.e">e</a><span class="delimiter">)</span> ⇒
        <a href="ReactiveStreamsCompliance.scala.html#akka.stream.impl.ReactiveStreamsCompliance.tryOnError" title="(subscriber: org.reactivestreams.Subscriber[Any], error: Throwable)Unit">tryOnError</a><span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.subscriber_=" title="=&gt; org.reactivestreams.Subscriber[Any]">subscriber</a>, <a href="#akka.stream.impl;IteratorPublisher.postStop.e" title="Throwable">e</a><span class="delimiter">)</span>
        <a href="#akka.stream.impl;IteratorPublisher.exposedPublisher_=" title="=&gt; akka.stream.impl.ActorPublisher[Any]">exposedPublisher</a>.<a href="ActorPublisher.scala.html#akka.stream.impl;ActorPublisher.shutdown" title="(reason: Option[Throwable])Unit">shutdown</a><span class="delimiter">(</span><span title="(x: Throwable)Some[Throwable]">Some</span><span class="delimiter">(</span><a href="#akka.stream.impl;IteratorPublisher.postStop.e" title="Throwable">e</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="comment">// if onComplete or onError throws we let normal supervision take care of it,</span>
    <span class="comment">// see reactive-streams specification rule 2:13</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>


        </pre>
    </body>
</html>
