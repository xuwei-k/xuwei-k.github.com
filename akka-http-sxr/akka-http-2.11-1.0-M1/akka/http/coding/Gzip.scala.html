<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>akka/http/coding/Gzip.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

package akka.http.coding

import java.util.zip.<span class="delimiter">{</span> Inflater, CRC32, ZipException, Deflater <span class="delimiter">}</span>
import akka.util.ByteString

import scala.annotation.tailrec
import akka.http.model._
import headers.HttpEncodings

import scala.util.control.<span class="delimiter">{</span> NonFatal, NoStackTrace <span class="delimiter">}</span>

class <a title="class Gzip extends AnyRef with akka.http.coding.Coder" id="akka.http.coding;Gzip">Gzip</a><a href="#akka.http.coding;Gzip" title="akka.http.coding.Gzip" class="delimiter">(</a>val <a title="akka.http.model.HttpMessage =&gt; Boolean" id="akka.http.coding;Gzip.messageFilter">messageFilter</a>: HttpMessage ⇒ Boolean<span class="delimiter">)</span> extends <a href="Coder.scala.html#akka.http.coding;Coder" title="akka.http.coding.Coder">Coder</a> <span class="delimiter">{</span>
  val <a title="akka.http.model.headers.HttpEncoding" id="akka.http.coding;Gzip.encoding">encoding</a> = <a href="../model/headers/HttpEncoding.scala.html#akka.http.model.headers.HttpEncodings" title="akka.http.model.headers.HttpEncodings.type">HttpEncodings</a>.<a href="../model/headers/HttpEncoding.scala.html#akka.http.model.headers.HttpEncodings.gzip" title="=&gt; akka.http.model.headers.HttpEncoding">gzip</a>
  def <a title="=&gt; akka.http.coding.GzipCompressor" id="akka.http.coding;Gzip.newCompressor">newCompressor</a> = new <a href="#akka.http.coding;GzipCompressor" title="akka.http.coding.GzipCompressor">GzipCompressor</a>
  def <a title="=&gt; akka.http.coding.GzipDecompressor" id="akka.http.coding;Gzip.newDecompressor">newDecompressor</a> = new <a href="#akka.http.coding;GzipDecompressor" title="akka.http.coding.GzipDecompressor">GzipDecompressor</a>
<span class="delimiter">}</span>

<span class="comment">/**
 * An encoder and decoder for the HTTP 'gzip' encoding.
 */</span>
object <a title="akka.http.coding.Gzip.type" id="akka.http.coding.Gzip">Gzip</a> extends <a href="#akka.http.coding;Gzip" title="akka.http.coding.Gzip">Gzip</a><span class="delimiter">(</span><a href="Encoder.scala.html#akka.http.coding.Encoder" title="akka.http.coding.Encoder.type">Encoder</a>.<a href="Encoder.scala.html#akka.http.coding.Encoder.DefaultFilter" title="=&gt; akka.http.model.HttpMessage =&gt; Boolean">DefaultFilter</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  def <a title="(messageFilter: akka.http.model.HttpMessage =&gt; Boolean)akka.http.coding.Gzip" id="akka.http.coding.Gzip.apply">apply</a><span class="delimiter">(</span><a title="akka.http.model.HttpMessage =&gt; Boolean" id="akka.http.coding.Gzip.apply.messageFilter">messageFilter</a>: HttpMessage ⇒ Boolean<span class="delimiter">)</span> = new <a href="#akka.http.coding;Gzip" title="akka.http.coding.Gzip">Gzip</a><span class="delimiter">(</span><a href="#akka.http.coding.Gzip.apply.messageFilter" title="akka.http.model.HttpMessage =&gt; Boolean">messageFilter</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

class <a title="class GzipCompressor extends akka.http.coding.DeflateCompressor" id="akka.http.coding;GzipCompressor">GzipCompressor</a> extends <a href="Deflate.scala.html#akka.http.coding;DeflateCompressor" title="akka.http.coding.DeflateCompressor">DeflateCompressor</a> <span class="delimiter">{</span>
  override protected lazy val <a title="java.util.zip.Deflater" id="akka.http.coding;GzipCompressor.deflater">deflater</a> = new <span title="java.util.zip.Deflater">Deflater</span><span class="delimiter">(</span>Deflater.<span title="Int(9)">BEST_COMPRESSION</span>, true<span class="delimiter">)</span>
  private val <a title="java.util.zip.CRC32" id="akka.http.coding;GzipCompressor.checkSum">checkSum</a> = new <span title="java.util.zip.CRC32">CRC32</span> <span class="comment">// CRC32 of uncompressed data</span>
  private var <a title="Boolean" id="akka.http.coding;GzipCompressor.headerSent_=">headerSent</a> = false
  private var <a title="Long" id="akka.http.coding;GzipCompressor.bytesRead_=">bytesRead</a> = <span title="Long(0L)" class="long">0L</span>

  override protected def <a title="(input: akka.util.ByteString, buffer: Array[Byte])akka.util.ByteString" id="akka.http.coding;GzipCompressor.compressWithBuffer">compressWithBuffer</a><span class="delimiter">(</span><a title="akka.util.ByteString" id="akka.http.coding;GzipCompressor.compressWithBuffer.input">input</a>: <span title="akka.util.ByteString">ByteString</span>, <a title="Array[Byte]" id="akka.http.coding;GzipCompressor.compressWithBuffer.buffer">buffer</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="akka.util.ByteString">ByteString</span> = <span class="delimiter">{</span>
    <a href="#akka.http.coding;GzipCompressor.updateCrc" title="(input: akka.util.ByteString)Unit">updateCrc</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipCompressor.compressWithBuffer.input" title="akka.util.ByteString">input</a><span class="delimiter">)</span>
    <a href="#akka.http.coding;GzipCompressor.header" title="()akka.util.ByteString">header</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(that: akka.util.ByteString)akka.util.ByteString">++</span> super.<a href="Deflate.scala.html#akka.http.coding;DeflateCompressor.compressWithBuffer" title="(input: akka.util.ByteString, buffer: Array[Byte])akka.util.ByteString">compressWithBuffer</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipCompressor.compressWithBuffer.input" title="akka.util.ByteString">input</a>, <a href="#akka.http.coding;GzipCompressor.compressWithBuffer.buffer" title="Array[Byte]">buffer</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  override protected def <a title="(buffer: Array[Byte])akka.util.ByteString" id="akka.http.coding;GzipCompressor.flushWithBuffer">flushWithBuffer</a><span class="delimiter">(</span><a title="Array[Byte]" id="akka.http.coding;GzipCompressor.flushWithBuffer.buffer">buffer</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="akka.util.ByteString">ByteString</span> = <a href="#akka.http.coding;GzipCompressor.header" title="()akka.util.ByteString">header</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(that: akka.util.ByteString)akka.util.ByteString">++</span> super.<a href="Deflate.scala.html#akka.http.coding;DeflateCompressor.flushWithBuffer" title="(buffer: Array[Byte])akka.util.ByteString">flushWithBuffer</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipCompressor.flushWithBuffer.buffer" title="Array[Byte]">buffer</a><span class="delimiter">)</span>
  override protected def <a title="(buffer: Array[Byte])akka.util.ByteString" id="akka.http.coding;GzipCompressor.finishWithBuffer">finishWithBuffer</a><span class="delimiter">(</span><a title="Array[Byte]" id="akka.http.coding;GzipCompressor.finishWithBuffer.buffer">buffer</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="akka.util.ByteString">ByteString</span> = super.<a href="Deflate.scala.html#akka.http.coding;DeflateCompressor.finishWithBuffer" title="(buffer: Array[Byte])akka.util.ByteString">finishWithBuffer</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipCompressor.finishWithBuffer.buffer" title="Array[Byte]">buffer</a><span class="delimiter">)</span> <span title="(that: akka.util.ByteString)akka.util.ByteString">++</span> <a href="#akka.http.coding;GzipCompressor.trailer" title="()akka.util.ByteString">trailer</a><span class="delimiter">(</span><span class="delimiter">)</span>

  private def <a title="(input: akka.util.ByteString)Unit" id="akka.http.coding;GzipCompressor.updateCrc">updateCrc</a><span class="delimiter">(</span><a title="akka.util.ByteString" id="akka.http.coding;GzipCompressor.updateCrc.input">input</a>: <span title="akka.util.ByteString">ByteString</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.http.coding;GzipCompressor.checkSum" title="=&gt; java.util.zip.CRC32">checkSum</a>.<span title="(x$1: Array[Byte])Unit">update</span><span class="delimiter">(</span><a href="#akka.http.coding;GzipCompressor.updateCrc.input" title="akka.util.ByteString">input</a>.<span title="(implicit arg0: scala.reflect.ClassTag[Byte])Array[Byte]">toArray</span><span class="delimiter">)</span>
    <a href="#akka.http.coding;GzipCompressor.bytesRead_=" title="(x$1: Long)Unit">bytesRead</a> <span title="(x: Int)Long">+=</span> <a href="#akka.http.coding;GzipCompressor.updateCrc.input" title="akka.util.ByteString">input</a>.<span title="=&gt; Int">length</span>
  <span class="delimiter">}</span>
  private def <a title="()akka.util.ByteString" id="akka.http.coding;GzipCompressor.header">header</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="akka.util.ByteString">ByteString</span> =
    if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.http.coding;GzipCompressor.headerSent_=" title="=&gt; Boolean">headerSent</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.http.coding;GzipCompressor.headerSent_=" title="(x$1: Boolean)Unit">headerSent</a> = true
      <a href="#akka.http.coding.GzipDecompressor" title="akka.http.coding.GzipDecompressor.type">GzipDecompressor</a>.<a href="#akka.http.coding.GzipDecompressor.Header" title="=&gt; akka.util.ByteString">Header</a>
    <span class="delimiter">}</span> else <span title="akka.util.ByteString.type">ByteString</span>.<span title="=&gt; akka.util.ByteString">empty</span>

  private def <a title="()akka.util.ByteString" id="akka.http.coding;GzipCompressor.trailer">trailer</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="akka.util.ByteString">ByteString</span> = <span class="delimiter">{</span>
    def <a title="(i: Int)akka.util.ByteString" id="akka.http.coding;GzipCompressor.trailer.int32">int32</a><span class="delimiter">(</span><a title="Int" id="akka.http.coding;GzipCompressor.trailer.int32.i">i</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="akka.util.ByteString">ByteString</span> = <span title="(bytes: Int*)(implicit num: Integral[Int])akka.util.ByteString">ByteString</span><span title="scala.math.Numeric.IntIsIntegral.type" class="delimiter">(</span><a href="#akka.http.coding;GzipCompressor.trailer.int32.i" title="Int">i</a>, <a href="#akka.http.coding;GzipCompressor.trailer.int32.i" title="Int">i</a> <span title="(x: Int)Int">&gt;&gt;</span> <span title="Int(8)" class="int">8</span>, <a href="#akka.http.coding;GzipCompressor.trailer.int32.i" title="Int">i</a> <span title="(x: Int)Int">&gt;&gt;</span> <span title="Int(16)" class="int">16</span>, <a href="#akka.http.coding;GzipCompressor.trailer.int32.i" title="Int">i</a> <span title="(x: Int)Int">&gt;&gt;</span> <span title="Int(24)" class="int">24</span><span class="delimiter">)</span>
    val <a title="Int" id="akka.http.coding;GzipCompressor.trailer.crc">crc</a> = <a href="#akka.http.coding;GzipCompressor.checkSum" title="=&gt; java.util.zip.CRC32">checkSum</a>.<span title="()Long">getValue</span>.<span title="=&gt; Int">toInt</span>
    val <a title="Int" id="akka.http.coding;GzipCompressor.trailer.tot">tot</a> = <a href="#akka.http.coding;GzipCompressor.bytesRead_=" title="=&gt; Long">bytesRead</a>.<span title="=&gt; Int">toInt</span> <span class="comment">// truncated to 32bit as specified in https://tools.ietf.org/html/rfc1952#section-2</span>
    val trailer = <a href="#akka.http.coding;GzipCompressor.trailer.int32" title="(i: Int)akka.util.ByteString">int32</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipCompressor.trailer.crc" title="Int">crc</a><span class="delimiter">)</span> <a title="akka.util.ByteString" id="akka.http.coding;GzipCompressor.trailer.trailer">++</a> <a href="#akka.http.coding;GzipCompressor.trailer.int32" title="(i: Int)akka.util.ByteString">int32</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipCompressor.trailer.tot" title="Int">tot</a><span class="delimiter">)</span>

    <a href="#akka.http.coding;GzipCompressor.trailer.trailer" title="akka.util.ByteString">trailer</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/** A suspendable gzip decompressor */</span>
class <a title="class GzipDecompressor extends akka.http.coding.DeflateDecompressor" id="akka.http.coding;GzipDecompressor">GzipDecompressor</a> extends <a href="Deflate.scala.html#akka.http.coding;DeflateDecompressor" title="akka.http.coding.DeflateDecompressor">DeflateDecompressor</a> <span class="delimiter">{</span>
  override protected lazy val <a title="java.util.zip.Inflater" id="akka.http.coding;GzipDecompressor.inflater">inflater</a> = new <span title="java.util.zip.Inflater">Inflater</span><span class="delimiter">(</span>true<span class="delimiter">)</span> <span class="comment">// disable ZLIB headers</span>
  override def <a title="(input: akka.util.ByteString)akka.util.ByteString" id="akka.http.coding;GzipDecompressor.decompress">decompress</a><span class="delimiter">(</span><a title="akka.util.ByteString" id="akka.http.coding;GzipDecompressor.decompress.input">input</a>: <span title="akka.util.ByteString">ByteString</span><span class="delimiter">)</span>: <span title="akka.util.ByteString">ByteString</span> = <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine" title="GzipDecompressor.this.DecompressionStateMachine.type">DecompressionStateMachine</a>.<a href="#akka.http.coding.GzipDecompressor;StateMachine.run" title="(input: akka.util.ByteString)akka.util.ByteString">run</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.decompress.input" title="akka.util.ByteString">input</a><span class="delimiter">)</span>
  override def <a title="()akka.util.ByteString" id="akka.http.coding;GzipDecompressor.finish">finish</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="akka.util.ByteString">ByteString</span> =
    if <span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine" title="GzipDecompressor.this.DecompressionStateMachine.type">DecompressionStateMachine</a>.<a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.isFinished" title="=&gt; Boolean">isFinished</a><span class="delimiter">)</span> <span title="akka.util.ByteString.type">ByteString</span>.<span title="=&gt; akka.util.ByteString">empty</span>
    else <a href="#akka.http.coding;GzipDecompressor.fail" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="String(&quot;Truncated GZIP stream&quot;)" class="string">&quot;Truncated GZIP stream&quot;</span><span class="delimiter">)</span>

  import <a href="#akka.http.coding.GzipDecompressor" title="akka.http.coding.GzipDecompressor.type">GzipDecompressor</a>._

  object <a title="GzipDecompressor.this.DecompressionStateMachine.type" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine">DecompressionStateMachine</a> extends <a href="#akka.http.coding.GzipDecompressor;StateMachine" title="akka.http.coding.GzipDecompressor.StateMachine">StateMachine</a> <span class="delimiter">{</span>
    def <a title="=&gt; Boolean" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.isFinished">isFinished</a>: <span title="Boolean">Boolean</span> = <a href="#akka.http.coding.GzipDecompressor;StateMachine.currentState" title="=&gt; akka.http.coding.GzipDecompressor.DecompressionStateMachine.State">currentState</a> <span title="(x$1: Any)Boolean">==</span> <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.finished" title="=&gt; akka.util.ByteString =&gt; akka.http.coding.GzipDecompressor.DecompressionStateMachine.Action">finished</a>

    def <a title="=&gt; akka.util.ByteString =&gt; akka.http.coding.GzipDecompressor.DecompressionStateMachine.Action" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.initialState">initialState</a> = <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.finished" title="=&gt; akka.util.ByteString =&gt; akka.http.coding.GzipDecompressor.DecompressionStateMachine.Action">finished</a>

    private def <a title="(data: akka.util.ByteString)akka.http.coding.GzipDecompressor.DecompressionStateMachine.Action" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders">readHeaders</a><span class="delimiter">(</span><a title="akka.util.ByteString" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders.data">data</a>: <span title="akka.util.ByteString">ByteString</span><span class="delimiter">)</span>: <a href="#akka.http.coding.GzipDecompressor;StateMachine;Action" title="akka.http.coding.GzipDecompressor.DecompressionStateMachine.Action">Action</a> =
      try <span class="delimiter">{</span>
        val <a title="akka.http.coding.GzipDecompressor.ByteReader" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders.reader">reader</a> = new <a href="#akka.http.coding.GzipDecompressor;ByteReader" title="akka.http.coding.GzipDecompressor.ByteReader">ByteReader</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders.data" title="akka.util.ByteString">data</a><span class="delimiter">)</span>
        import <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders.reader" title="akka.http.coding.GzipDecompressor.ByteReader">reader</a>._

        if <span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;ByteReader.readByte" title="()Int">readByte</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(31)" class="int">0x1F</span> <span title="(x: Boolean)Boolean">||</span> <a href="#akka.http.coding.GzipDecompressor;ByteReader.readByte" title="()Int">readByte</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(139)" class="int">0x8B</span><span class="delimiter">)</span> <a href="#akka.http.coding;GzipDecompressor.fail" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="String(&quot;Not in GZIP format&quot;)" class="string">&quot;Not in GZIP format&quot;</span><span class="delimiter">)</span> <span class="comment">// check magic header</span>
        if <span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;ByteReader.readByte" title="()Int">readByte</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(8)" class="int">8</span><span class="delimiter">)</span> <a href="#akka.http.coding;GzipDecompressor.fail" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="String(&quot;Unsupported GZIP compression method&quot;)" class="string">&quot;Unsupported GZIP compression method&quot;</span><span class="delimiter">)</span> <span class="comment">// check compression method</span>
        val <a title="Int" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders.flags">flags</a> = <a href="#akka.http.coding.GzipDecompressor;ByteReader.readByte" title="()Int">readByte</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#akka.http.coding.GzipDecompressor;ByteReader.skip" title="(numBytes: Int)Unit">skip</a><span class="delimiter">(</span><span title="Int(6)" class="int">6</span><span class="delimiter">)</span> <span class="comment">// skip MTIME, XFL and OS fields</span>
        if <span class="delimiter">(</span><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders.flags" title="Int">flags</a> <span title="(x: Int)Int">&amp;</span> <span title="Int(4)" class="int">4</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#akka.http.coding.GzipDecompressor;ByteReader.skip" title="(numBytes: Int)Unit">skip</a><span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;ByteReader.readShort" title="()Int">readShort</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="comment">// skip optional extra fields</span>
        if <span class="delimiter">(</span><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders.flags" title="Int">flags</a> <span title="(x: Int)Int">&amp;</span> <span title="Int(8)" class="int">8</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> while <span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;ByteReader.readByte" title="()Int">readByte</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders.while$1" title="Unit" class="delimiter">{</a><span class="delimiter">}</span> <span class="comment">// skip optional file name</span>
        if <span class="delimiter">(</span><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders.flags" title="Int">flags</a> <span title="(x: Int)Int">&amp;</span> <span title="Int(16)" class="int">16</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> while <span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;ByteReader.readByte" title="()Int">readByte</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders.while$2" title="Unit" class="delimiter">{</a><span class="delimiter">}</span> <span class="comment">// skip optional file comment</span>
        if <span class="delimiter">(</span><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders.flags" title="Int">flags</a> <span title="(x: Int)Int">&amp;</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.crc16" title="(data: akka.util.ByteString)Int">crc16</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders.data" title="akka.util.ByteString">data</a>.<span title="(n: Int)akka.util.ByteString">take</span><span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;ByteReader.currentOffset" title="=&gt; Int">currentOffset</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <a href="#akka.http.coding.GzipDecompressor;ByteReader.readShort" title="()Int">readShort</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.http.coding;GzipDecompressor.fail" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="String(&quot;Corrupt GZIP header&quot;)" class="string">&quot;Corrupt GZIP header&quot;</span><span class="delimiter">)</span>

        <a href="#akka.http.coding.GzipDecompressor;StateMachine.ContinueWith.readResolve" title="(nextState: akka.http.coding.GzipDecompressor.DecompressionStateMachine.State, remainingInput: akka.util.ByteString)akka.http.coding.GzipDecompressor.DecompressionStateMachine.ContinueWith">ContinueWith</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.deflate" title="(checkSum: java.util.zip.CRC32)(data: akka.util.ByteString)akka.http.coding.GzipDecompressor.DecompressionStateMachine.Action">deflate</a><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders.$anonfun.data" title="akka.util.ByteString" class="delimiter">(</a>new <span title="java.util.zip.CRC32">CRC32</span><span class="delimiter">)</span>, <a href="#akka.http.coding.GzipDecompressor;ByteReader.remainingData" title="=&gt; akka.util.ByteString">remainingData</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> catch <span class="delimiter">{</span>
        case <a href="#akka.http.coding.GzipDecompressor.ByteReader" title="akka.http.coding.GzipDecompressor.ByteReader.type">ByteReader</a>.<a href="#akka.http.coding.GzipDecompressor.ByteReader.NeedMoreData" title="=&gt; Exception with scala.util.control.NoStackTrace">NeedMoreData</a> ⇒ <a href="#akka.http.coding.GzipDecompressor;StateMachine.SuspendAndRetryWithMoreData.readResolve" title="akka.http.coding.GzipDecompressor.DecompressionStateMachine.SuspendAndRetryWithMoreData.type">SuspendAndRetryWithMoreData</a>
      <span class="delimiter">}</span>

    private def <a title="(checkSum: java.util.zip.CRC32)(data: akka.util.ByteString)akka.http.coding.GzipDecompressor.DecompressionStateMachine.Action" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.deflate">deflate</a><span class="delimiter">(</span><a title="java.util.zip.CRC32" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.deflate.checkSum">checkSum</a>: <span title="java.util.zip.CRC32">CRC32</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="akka.util.ByteString" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.deflate.data">data</a>: <span title="akka.util.ByteString">ByteString</span><span class="delimiter">)</span>: <a href="#akka.http.coding.GzipDecompressor;StateMachine;Action" title="akka.http.coding.GzipDecompressor.DecompressionStateMachine.Action">Action</a> = <span class="delimiter">{</span>
      <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.inflater" title="=&gt; java.util.zip.Inflater">inflater</a>.<span title="()Boolean">needsInput</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.http.coding;GzipDecompressor.inflater" title="=&gt; java.util.zip.Inflater">inflater</a>.<span title="(x$1: Array[Byte])Unit">setInput</span><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.deflate.data" title="akka.util.ByteString">data</a>.<span title="(implicit arg0: scala.reflect.ClassTag[Byte])Array[Byte]">toArray</span><span class="delimiter">)</span>
      val <a title="akka.util.ByteString" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.deflate.output">output</a> = <a href="Deflate.scala.html#akka.http.coding;DeflateDecompressor.drain" title="(buffer: Array[Byte], result: akka.util.ByteString)akka.util.ByteString">drain</a><span class="delimiter">(</span>new <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.deflate.data" title="akka.util.ByteString">data</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">*</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.deflate.checkSum" title="java.util.zip.CRC32">checkSum</a>.<span title="(x$1: Array[Byte])Unit">update</span><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.deflate.output" title="akka.util.ByteString">output</a>.<span title="(implicit arg0: scala.reflect.ClassTag[Byte])Array[Byte]">toArray</span><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.inflater" title="=&gt; java.util.zip.Inflater">inflater</a>.<span title="()Boolean">finished</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.http.coding.GzipDecompressor;StateMachine.EmitAndContinueWith.readResolve" title="(output: akka.util.ByteString, nextState: akka.http.coding.GzipDecompressor.DecompressionStateMachine.State, remainingInput: akka.util.ByteString)akka.http.coding.GzipDecompressor.DecompressionStateMachine.EmitAndContinueWith">EmitAndContinueWith</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.deflate.output" title="akka.util.ByteString">output</a>, <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readTrailer" title="(checkSum: java.util.zip.CRC32)(data: akka.util.ByteString)akka.http.coding.GzipDecompressor.DecompressionStateMachine.Action">readTrailer</a><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.deflate.$anonfun.data" title="akka.util.ByteString" class="delimiter">(</a><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.deflate.checkSum" title="java.util.zip.CRC32">checkSum</a><span class="delimiter">)</span>, <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.deflate.data" title="akka.util.ByteString">data</a>.<span title="(n: Int)akka.util.ByteString">takeRight</span><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.inflater" title="=&gt; java.util.zip.Inflater">inflater</a>.<span title="()Int">getRemaining</span><span class="delimiter">)</span><span class="delimiter">)</span>
      else <a href="#akka.http.coding.GzipDecompressor;StateMachine.EmitAndSuspend.readResolve" title="(output: akka.util.ByteString)akka.http.coding.GzipDecompressor.DecompressionStateMachine.EmitAndSuspend">EmitAndSuspend</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.deflate.output" title="akka.util.ByteString">output</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    private def <a title="(checkSum: java.util.zip.CRC32)(data: akka.util.ByteString)akka.http.coding.GzipDecompressor.DecompressionStateMachine.Action" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.readTrailer">readTrailer</a><span class="delimiter">(</span><a title="java.util.zip.CRC32" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.readTrailer.checkSum">checkSum</a>: <span title="java.util.zip.CRC32">CRC32</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="akka.util.ByteString" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.readTrailer.data">data</a>: <span title="akka.util.ByteString">ByteString</span><span class="delimiter">)</span>: <a href="#akka.http.coding.GzipDecompressor;StateMachine;Action" title="akka.http.coding.GzipDecompressor.DecompressionStateMachine.Action">Action</a> =
      try <span class="delimiter">{</span>
        val <a title="akka.http.coding.GzipDecompressor.ByteReader" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.readTrailer.reader">reader</a> = new <a href="#akka.http.coding.GzipDecompressor;ByteReader" title="akka.http.coding.GzipDecompressor.ByteReader">ByteReader</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readTrailer.data" title="akka.util.ByteString">data</a><span class="delimiter">)</span>
        import <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readTrailer.reader" title="akka.http.coding.GzipDecompressor.ByteReader">reader</a>._

        if <span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;ByteReader.readInt" title="()Int">readInt</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readTrailer.checkSum" title="java.util.zip.CRC32">checkSum</a>.<span title="()Long">getValue</span>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span> <a href="#akka.http.coding;GzipDecompressor.fail" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="String(&quot;Corrupt data (CRC32 checksum error)&quot;)" class="string">&quot;Corrupt data (CRC32 checksum error)&quot;</span><span class="delimiter">)</span>
        if <span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;ByteReader.readInt" title="()Int">readInt</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <a href="#akka.http.coding;GzipDecompressor.inflater" title="=&gt; java.util.zip.Inflater">inflater</a>.<span title="()Long">getBytesWritten</span>.<span title="=&gt; Int">toInt</span> <span class="comment">/* truncated to 32bit */</span> <span class="delimiter">)</span> <a href="#akka.http.coding;GzipDecompressor.fail" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="String(&quot;Corrupt GZIP trailer ISIZE&quot;)" class="string">&quot;Corrupt GZIP trailer ISIZE&quot;</span><span class="delimiter">)</span>

        <a href="#akka.http.coding;GzipDecompressor.inflater" title="=&gt; java.util.zip.Inflater">inflater</a>.<span title="()Unit">reset</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readTrailer.checkSum" title="java.util.zip.CRC32">checkSum</a>.<span title="()Unit">reset</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#akka.http.coding.GzipDecompressor;StateMachine.ContinueWith.readResolve" title="(nextState: akka.http.coding.GzipDecompressor.DecompressionStateMachine.State, remainingInput: akka.util.ByteString)akka.http.coding.GzipDecompressor.DecompressionStateMachine.ContinueWith">ContinueWith</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.finished" title="=&gt; akka.util.ByteString =&gt; akka.http.coding.GzipDecompressor.DecompressionStateMachine.Action">finished</a>, <a href="#akka.http.coding.GzipDecompressor;ByteReader.remainingData" title="=&gt; akka.util.ByteString">remainingData</a><span class="delimiter">)</span> <span class="comment">// start over to support multiple concatenated gzip streams</span>
      <span class="delimiter">}</span> catch <span class="delimiter">{</span>
        case <a href="#akka.http.coding.GzipDecompressor.ByteReader" title="akka.http.coding.GzipDecompressor.ByteReader.type">ByteReader</a>.<a href="#akka.http.coding.GzipDecompressor.ByteReader.NeedMoreData" title="=&gt; Exception with scala.util.control.NoStackTrace">NeedMoreData</a> ⇒ <a href="#akka.http.coding.GzipDecompressor;StateMachine.SuspendAndRetryWithMoreData.readResolve" title="akka.http.coding.GzipDecompressor.DecompressionStateMachine.SuspendAndRetryWithMoreData.type">SuspendAndRetryWithMoreData</a>
      <span class="delimiter">}</span>

    lazy val <a title="akka.util.ByteString =&gt; akka.http.coding.GzipDecompressor.DecompressionStateMachine.Action" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.finished">finished</a>: ByteString ⇒ Action =
      <a title="akka.util.ByteString" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.finished.$anonfun.data">data</a> ⇒ if <span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.finished.$anonfun.data" title="akka.util.ByteString">data</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <a href="#akka.http.coding.GzipDecompressor;StateMachine.ContinueWith.readResolve" title="(nextState: akka.http.coding.GzipDecompressor.DecompressionStateMachine.State, remainingInput: akka.util.ByteString)akka.http.coding.GzipDecompressor.DecompressionStateMachine.ContinueWith">ContinueWith</a><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.readHeaders" title="(data: akka.util.ByteString)akka.http.coding.GzipDecompressor.DecompressionStateMachine.Action">readHeaders</a>, <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.finished.$anonfun.data" title="akka.util.ByteString">data</a><span class="delimiter">)</span> else <a href="#akka.http.coding.GzipDecompressor;StateMachine.SuspendAndRetryWithMoreData.readResolve" title="akka.http.coding.GzipDecompressor.DecompressionStateMachine.SuspendAndRetryWithMoreData.type">SuspendAndRetryWithMoreData</a>

    private def <a title="(data: akka.util.ByteString)Int" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.crc16">crc16</a><span class="delimiter">(</span><a title="akka.util.ByteString" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.crc16.data">data</a>: <span title="akka.util.ByteString">ByteString</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      val <a title="java.util.zip.CRC32" id="akka.http.coding;GzipDecompressor.DecompressionStateMachine.crc16.crc">crc</a> = new <span title="java.util.zip.CRC32">CRC32</span>
      <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.crc16.crc" title="java.util.zip.CRC32">crc</a>.<span title="(x$1: Array[Byte])Unit">update</span><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.crc16.data" title="akka.util.ByteString">data</a>.<span title="(implicit arg0: scala.reflect.ClassTag[Byte])Array[Byte]">toArray</span><span class="delimiter">)</span>
      <a href="#akka.http.coding;GzipDecompressor.DecompressionStateMachine.crc16.crc" title="java.util.zip.CRC32">crc</a>.<span title="()Long">getValue</span>.<span title="=&gt; Int">toInt</span> <span title="(x: Int)Int">&amp;</span> <span title="Int(65535)" class="int">0xFFFF</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(msg: String)Nothing" id="akka.http.coding;GzipDecompressor.fail">fail</a><span class="delimiter">(</span><a title="String" id="akka.http.coding;GzipDecompressor.fail.msg">msg</a>: <span title="String">String</span><span class="delimiter">)</span> = throw new <span title="java.util.zip.ZipException">ZipException</span><span class="delimiter">(</span><a href="#akka.http.coding;GzipDecompressor.fail.msg" title="String">msg</a><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="comment">/** INTERNAL API */</span>
private<span class="delimiter">[</span>http<span class="delimiter">]</span> object <a title="akka.http.coding.GzipDecompressor.type" id="akka.http.coding.GzipDecompressor">GzipDecompressor</a> <a href="#akka.http.coding.GzipDecompressor" title="akka.http.coding.GzipDecompressor.type" class="delimiter">{</a>
  <span class="comment">// RFC 1952: http://tools.ietf.org/html/rfc1952 section 2.2</span>
  val <a title="akka.util.ByteString" id="akka.http.coding.GzipDecompressor.Header">Header</a> = <span title="(bytes: Int*)(implicit num: Integral[Int])akka.util.ByteString">ByteString</span><span title="scala.math.Numeric.IntIsIntegral.type" class="delimiter">(</span>
    <span title="Int(31)" class="int">31</span>, <span class="comment">// ID1</span>
    -<span title="Int(-117)" class="int">117</span>, <span class="comment">// ID2</span>
    <span title="Int(8)" class="int">8</span>, <span class="comment">// CM = Deflate</span>
    <span title="Int(0)" class="int">0</span>, <span class="comment">// FLG</span>
    <span title="Int(0)" class="int">0</span>, <span class="comment">// MTIME 1</span>
    <span title="Int(0)" class="int">0</span>, <span class="comment">// MTIME 2</span>
    <span title="Int(0)" class="int">0</span>, <span class="comment">// MTIME 3</span>
    <span title="Int(0)" class="int">0</span>, <span class="comment">// MTIME 4</span>
    <span title="Int(0)" class="int">0</span>, <span class="comment">// XFL</span>
    <span title="Int(0)" class="int">0</span> <span class="comment">// OS</span>
    <span class="delimiter">)</span>

  class <a title="class ByteReader extends AnyRef" id="akka.http.coding.GzipDecompressor;ByteReader">ByteReader</a><a href="#akka.http.coding.GzipDecompressor;ByteReader" title="akka.http.coding.GzipDecompressor.ByteReader" class="delimiter">(</a><a title="akka.util.ByteString" id="akka.http.coding.GzipDecompressor;ByteReader.input">input</a>: <span title="akka.util.ByteString">ByteString</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    import <a href="#akka.http.coding.GzipDecompressor.ByteReader" title="akka.http.coding.GzipDecompressor.ByteReader.type">ByteReader</a>.NeedMoreData

    private<span class="delimiter">[</span>this<span class="delimiter">]</span> var <a title="Int" id="akka.http.coding.GzipDecompressor;ByteReader.off">off</a> = <span title="Int(0)" class="int">0</span>

    def <a title="()Int" id="akka.http.coding.GzipDecompressor;ByteReader.readByte">readByte</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Int">Int</span> =
      if <span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;ByteReader.off" title="Int">off</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.http.coding.GzipDecompressor;ByteReader.input" title="akka.util.ByteString">input</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        val <a title="Byte" id="akka.http.coding.GzipDecompressor;ByteReader.readByte.x">x</a> = <a href="#akka.http.coding.GzipDecompressor;ByteReader.input" title="(idx: Int)Byte">input</a><span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;ByteReader.off" title="Int">off</a><span class="delimiter">)</span>
        <a href="#akka.http.coding.GzipDecompressor;ByteReader.off" title="Int">off</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
        <a href="#akka.http.coding.GzipDecompressor;ByteReader.readByte.x" title="Byte">x</a>.<span title="=&gt; Int">toInt</span> <span title="(x: Int)Int">&amp;</span> <span title="Int(255)" class="int">0xFF</span>
      <span class="delimiter">}</span> else throw <a href="#akka.http.coding.GzipDecompressor.ByteReader.NeedMoreData" title="=&gt; Exception with scala.util.control.NoStackTrace">NeedMoreData</a>
    def <a title="()Int" id="akka.http.coding.GzipDecompressor;ByteReader.readShort">readShort</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <a href="#akka.http.coding.GzipDecompressor;ByteReader.readByte" title="()Int">readByte</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Int">|</span> <span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;ByteReader.readByte" title="()Int">readByte</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Int">&lt;&lt;</span> <span title="Int(8)" class="int">8</span><span class="delimiter">)</span>
    def <a title="()Int" id="akka.http.coding.GzipDecompressor;ByteReader.readInt">readInt</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <a href="#akka.http.coding.GzipDecompressor;ByteReader.readShort" title="()Int">readShort</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Int">|</span> <span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;ByteReader.readShort" title="()Int">readShort</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Int">&lt;&lt;</span> <span title="Int(16)" class="int">16</span><span class="delimiter">)</span>
    def <a title="(numBytes: Int)Unit" id="akka.http.coding.GzipDecompressor;ByteReader.skip">skip</a><span class="delimiter">(</span><a title="Int" id="akka.http.coding.GzipDecompressor;ByteReader.skip.numBytes">numBytes</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
      if <span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;ByteReader.off" title="Int">off</a> <span title="(x: Int)Int">+</span> <a href="#akka.http.coding.GzipDecompressor;ByteReader.skip.numBytes" title="Int">numBytes</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="#akka.http.coding.GzipDecompressor;ByteReader.input" title="akka.util.ByteString">input</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <a href="#akka.http.coding.GzipDecompressor;ByteReader.off" title="Int">off</a> <span title="(x: Int)Int">+=</span> <a href="#akka.http.coding.GzipDecompressor;ByteReader.skip.numBytes" title="Int">numBytes</a>
      else throw <a href="#akka.http.coding.GzipDecompressor.ByteReader.NeedMoreData" title="=&gt; Exception with scala.util.control.NoStackTrace">NeedMoreData</a>
    def <a title="=&gt; Int" id="akka.http.coding.GzipDecompressor;ByteReader.currentOffset">currentOffset</a>: <span title="Int">Int</span> = <a href="#akka.http.coding.GzipDecompressor;ByteReader.off" title="Int">off</a>
    def <a title="=&gt; akka.util.ByteString" id="akka.http.coding.GzipDecompressor;ByteReader.remainingData">remainingData</a>: <span title="akka.util.ByteString">ByteString</span> = <a href="#akka.http.coding.GzipDecompressor;ByteReader.input" title="akka.util.ByteString">input</a>.<span title="(n: Int)akka.util.ByteString">drop</span><span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;ByteReader.off" title="Int">off</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  object <a title="akka.http.coding.GzipDecompressor.ByteReader.type" id="akka.http.coding.GzipDecompressor.ByteReader">ByteReader</a> <a href="#akka.http.coding.GzipDecompressor.ByteReader" title="akka.http.coding.GzipDecompressor.ByteReader.type" class="delimiter">{</a>
    val <a title="&lt;refinement of Exception with scala.util.control.NoStackTrace&gt; extends Exception with scala.util.control.NoStackTrace" id="akka.http.coding.GzipDecompressor.ByteReader.NeedMoreData">NeedMoreData</a> = new <a title="&lt;$anon: Exception with scala.util.control.NoStackTrace&gt; extends Exception with scala.util.control.NoStackTrace" id="akka.http.coding.GzipDecompressor.ByteReader.NeedMoreData;$anon">Exception</a> with <span title="scala.util.control.NoStackTrace">NoStackTrace</span>
  <span class="delimiter">}</span>

  <span class="comment">/** A simple state machine implementation for suspendable parsing */</span>
  trait <a title="trait StateMachine extends AnyRef" id="akka.http.coding.GzipDecompressor;StateMachine">StateMachine</a> <span title="Unit" class="delimiter">{</span>
    sealed trait <a title="trait Action extends AnyRef" id="akka.http.coding.GzipDecompressor;StateMachine;Action">Action</a>
    <span class="comment">/** Cache the current input and suspend to wait for more data */</span>
    case object <a href="#akka.http.coding.GzipDecompressor;StateMachine.SuspendAndRetryWithMoreData.productElement.x$1" title="StateMachine.this.SuspendAndRetryWithMoreData.type" id="akka.http.coding.GzipDecompressor;StateMachine.SuspendAndRetryWithMoreData.readResolve">SuspendAndRetryWithMoreData</a> extends <a href="#akka.http.coding.GzipDecompressor;StateMachine;Action" title="StateMachine.this.Action">Action</a>
    <span class="comment">/** Emit some output and suspend in the current state and wait for more data */</span>
    case class <a title="class EmitAndSuspend extends AnyRef with StateMachine.this.Action with Product with Serializable" id="akka.http.coding.GzipDecompressor;StateMachine.EmitAndSuspend.readResolve">EmitAndSuspend</a><span title="Product" class="delimiter">(</span><a title="akka.util.ByteString" id="akka.http.coding.GzipDecompressor;StateMachine;EmitAndSuspend.output">output</a>: <span title="akka.util.ByteString">ByteString</span><span class="delimiter">)</span> extends <a href="#akka.http.coding.GzipDecompressor;StateMachine;Action" title="StateMachine.this.Action">Action</a>
    <span class="comment">/** Proceed to the nextState and immediately run it with the remainingInput */</span>
    case class <a title="class ContinueWith extends AnyRef with StateMachine.this.Action with Product with Serializable" id="akka.http.coding.GzipDecompressor;StateMachine.ContinueWith.readResolve">ContinueWith</a><span title="Product" class="delimiter">(</span><a title="StateMachine.this.State" id="akka.http.coding.GzipDecompressor;StateMachine;ContinueWith.nextState">nextState</a>: <span title="StateMachine.this.State">State</span>, <a title="akka.util.ByteString" id="akka.http.coding.GzipDecompressor;StateMachine;ContinueWith.remainingInput">remainingInput</a>: <span title="akka.util.ByteString">ByteString</span><span class="delimiter">)</span> extends <a href="#akka.http.coding.GzipDecompressor;StateMachine;Action" title="StateMachine.this.Action">Action</a>
    <span class="comment">/** Emit some output and then proceed to the nextState and immediately run it with the remainingInput */</span>
    case class <a title="class EmitAndContinueWith extends AnyRef with StateMachine.this.Action with Product with Serializable" id="akka.http.coding.GzipDecompressor;StateMachine.EmitAndContinueWith.readResolve">EmitAndContinueWith</a><span title="Product" class="delimiter">(</span><a title="akka.util.ByteString" id="akka.http.coding.GzipDecompressor;StateMachine;EmitAndContinueWith.output">output</a>: <span title="akka.util.ByteString">ByteString</span>, <a title="StateMachine.this.State" id="akka.http.coding.GzipDecompressor;StateMachine;EmitAndContinueWith.nextState">nextState</a>: <span title="StateMachine.this.State">State</span>, <a title="akka.util.ByteString" id="akka.http.coding.GzipDecompressor;StateMachine;EmitAndContinueWith.remainingInput">remainingInput</a>: <span title="akka.util.ByteString">ByteString</span><span class="delimiter">)</span> extends <a href="#akka.http.coding.GzipDecompressor;StateMachine;Action" title="StateMachine.this.Action">Action</a>

    type <a title="akka.util.ByteString =&gt; StateMachine.this.Action" id="akka.http.coding.GzipDecompressor;StateMachine;State">State</a> = ByteString ⇒ Action
    def <a title="=&gt; StateMachine.this.State" id="akka.http.coding.GzipDecompressor;StateMachine.initialState">initialState</a>: <span title="StateMachine.this.State">State</span>

    private<span class="delimiter">[</span>this<span class="delimiter">]</span> var <a title="StateMachine.this.State" id="akka.http.coding.GzipDecompressor;StateMachine.state">state</a>: <span title="StateMachine.this.State">State</span> = <a href="#akka.http.coding.GzipDecompressor;StateMachine.initialState" title="=&gt; StateMachine.this.State">initialState</a>
    def <a title="=&gt; StateMachine.this.State" id="akka.http.coding.GzipDecompressor;StateMachine.currentState">currentState</a>: <span title="StateMachine.this.State">State</span> = <a href="#akka.http.coding.GzipDecompressor;StateMachine.state" title="StateMachine.this.State">state</a>

    <span class="comment">/** Run the state machine with the current input */</span>
    final def <a title="(input: akka.util.ByteString)akka.util.ByteString" id="akka.http.coding.GzipDecompressor;StateMachine.run">run</a><span class="delimiter">(</span><a title="akka.util.ByteString" id="akka.http.coding.GzipDecompressor;StateMachine.run.input">input</a>: <span title="akka.util.ByteString">ByteString</span><span class="delimiter">)</span>: <span title="akka.util.ByteString">ByteString</span> = <span class="delimiter">{</span>
      @tailrec def <a title="(input: akka.util.ByteString, result: akka.util.ByteString)akka.util.ByteString" id="akka.http.coding.GzipDecompressor;StateMachine.run.rec">rec</a><span class="delimiter">(</span><a title="akka.util.ByteString" id="akka.http.coding.GzipDecompressor;StateMachine.run.rec.input">input</a>: <span title="akka.util.ByteString">ByteString</span>, <a title="akka.util.ByteString" id="akka.http.coding.GzipDecompressor;StateMachine.run.rec$default$2">result</a>: <span title="akka.util.ByteString">ByteString</span> = <span title="akka.util.ByteString.type">ByteString</span>.<span title="=&gt; akka.util.ByteString">empty</span><span class="delimiter">)</span>: <span title="akka.util.ByteString">ByteString</span> =
        <a href="#akka.http.coding.GzipDecompressor;StateMachine.state" title="(v1: akka.util.ByteString)StateMachine.this.Action">state</a><span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;StateMachine.run.rec.input" title="akka.util.ByteString">input</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
          case <a href="#akka.http.coding.GzipDecompressor;StateMachine.SuspendAndRetryWithMoreData.readResolve" title="StateMachine.this.SuspendAndRetryWithMoreData.type">SuspendAndRetryWithMoreData</a> ⇒
            val <a title="StateMachine.this.State" id="akka.http.coding.GzipDecompressor;StateMachine.run.rec.oldState">oldState</a> = <a href="#akka.http.coding.GzipDecompressor;StateMachine.state" title="StateMachine.this.State">state</a>
            <a href="#akka.http.coding.GzipDecompressor;StateMachine.state" title="StateMachine.this.State">state</a> = <span class="delimiter">{</span> <a title="akka.util.ByteString" id="akka.http.coding.GzipDecompressor;StateMachine.run.rec.$anonfun.newData">newData</a> ⇒
              <a href="#akka.http.coding.GzipDecompressor;StateMachine.state" title="StateMachine.this.State">state</a> = <a href="#akka.http.coding.GzipDecompressor;StateMachine.run.rec.oldState" title="StateMachine.this.State">oldState</a>
              <a href="#akka.http.coding.GzipDecompressor;StateMachine.run.rec.oldState" title="(v1: akka.util.ByteString)StateMachine.this.Action">oldState</a><span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;StateMachine.run.rec.input" title="akka.util.ByteString">input</a> <span title="(that: akka.util.ByteString)akka.util.ByteString">++</span> <a href="#akka.http.coding.GzipDecompressor;StateMachine.run.rec.$anonfun.newData" title="akka.util.ByteString">newData</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <a href="#akka.http.coding.GzipDecompressor;StateMachine.run.rec$default$2" title="akka.util.ByteString">result</a>
          case EmitAndSuspend<span class="delimiter">(</span><span title="akka.util.ByteString">output</span><span class="delimiter">)</span> ⇒ <a href="#akka.http.coding.GzipDecompressor;StateMachine.run.rec$default$2" title="akka.util.ByteString">result</a> <span title="(that: akka.util.ByteString)akka.util.ByteString">++</span> <span title="akka.util.ByteString">output</span>
          case ContinueWith<span class="delimiter">(</span><span title="StateMachine.this.State">next</span>, <span title="akka.util.ByteString">remainingInput</span><span class="delimiter">)</span> ⇒
            <a href="#akka.http.coding.GzipDecompressor;StateMachine.state" title="StateMachine.this.State">state</a> = <span title="StateMachine.this.State">next</span>
            if <span class="delimiter">(</span><span title="akka.util.ByteString">remainingInput</span>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <a href="#akka.http.coding.GzipDecompressor;StateMachine.run.rec" title="(input: akka.util.ByteString, result: akka.util.ByteString)akka.util.ByteString">rec</a><span class="delimiter">(</span><span title="akka.util.ByteString">remainingInput</span>, <a href="#akka.http.coding.GzipDecompressor;StateMachine.run.rec$default$2" title="akka.util.ByteString">result</a><span class="delimiter">)</span>
            else <a href="#akka.http.coding.GzipDecompressor;StateMachine.run.rec$default$2" title="akka.util.ByteString">result</a>
          case EmitAndContinueWith<span class="delimiter">(</span><span title="akka.util.ByteString">output</span>, <span title="StateMachine.this.State">next</span>, <span title="akka.util.ByteString">remainingInput</span><span class="delimiter">)</span> ⇒
            <a href="#akka.http.coding.GzipDecompressor;StateMachine.state" title="StateMachine.this.State">state</a> = <span title="StateMachine.this.State">next</span>
            <a href="#akka.http.coding.GzipDecompressor;StateMachine.run.rec" title="(input: akka.util.ByteString, result: akka.util.ByteString)akka.util.ByteString">rec</a><span class="delimiter">(</span><span title="akka.util.ByteString">remainingInput</span>, <a href="#akka.http.coding.GzipDecompressor;StateMachine.run.rec$default$2" title="akka.util.ByteString">result</a> <span title="(that: akka.util.ByteString)akka.util.ByteString">++</span> <span title="akka.util.ByteString">output</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      try <a href="#akka.http.coding.GzipDecompressor;StateMachine.run.rec" title="(input: akka.util.ByteString, result: akka.util.ByteString)akka.util.ByteString">rec</a><span class="delimiter">(</span><a href="#akka.http.coding.GzipDecompressor;StateMachine.run.input" title="akka.util.ByteString">input</a><span class="delimiter">)</span>
      catch <span class="delimiter">{</span>
        case <a href="#akka.http.coding.GzipDecompressor;StateMachine.run.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="akka.http.coding.GzipDecompressor;StateMachine.run.e">e</a><span class="delimiter">)</span> ⇒
          <a href="#akka.http.coding.GzipDecompressor;StateMachine.state" title="StateMachine.this.State">state</a> = <a href="#akka.http.coding.GzipDecompressor;StateMachine.failState" title="=&gt; StateMachine.this.State">failState</a>
          throw <a href="#akka.http.coding.GzipDecompressor;StateMachine.run.e" title="Throwable">e</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    private def <a title="=&gt; StateMachine.this.State" id="akka.http.coding.GzipDecompressor;StateMachine.failState">failState</a>: <span title="StateMachine.this.State">State</span> = <a title="akka.util.ByteString" id="akka.http.coding.GzipDecompressor;StateMachine.failState.$anonfun.x$1">_</a> ⇒ throw new <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;Trying to reuse failed decompressor.&quot;)" class="string">&quot;Trying to reuse failed decompressor.&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span title="AnyRef" class="delimiter">}</span>

        </pre>
    </body>
</html>
