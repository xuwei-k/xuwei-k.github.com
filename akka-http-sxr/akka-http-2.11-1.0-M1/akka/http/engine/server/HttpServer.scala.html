<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>akka/http/engine/server/HttpServer.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

package akka.http.engine.server

import akka.actor.<span class="delimiter">{</span> ActorRef, Props <span class="delimiter">}</span>
import akka.util.ByteString
import akka.event.LoggingAdapter
import akka.stream.stage.PushPullStage
import akka.stream.scaladsl.<a href="../../../stream/scaladsl/OperationAttributes.scala.html#akka.stream.scaladsl.OperationAttributes" title="akka.stream.scaladsl.OperationAttributes.type">OperationAttributes</a>._
import akka.stream.FlattenStrategy
import akka.stream.scaladsl._
import akka.stream.stage.PushPullStage
import akka.http.engine.parsing.<span class="delimiter">{</span> HttpHeaderParser, HttpRequestParser <span class="delimiter">}</span>
import akka.http.engine.rendering.<span class="delimiter">{</span> ResponseRenderingContext, HttpResponseRendererFactory <span class="delimiter">}</span>
import akka.http.engine.parsing.<a href="../parsing/ParserOutput.scala.html#akka.http.engine.parsing.ParserOutput" title="akka.http.engine.parsing.ParserOutput.type">ParserOutput</a>._
import akka.http.model._
import akka.http.util._
import akka.http.Http

import scala.util.control.NonFatal

<span class="comment">/**
 * INTERNAL API
 */</span>
private<span class="delimiter">[</span>http<span class="delimiter">]</span> object <a title="akka.http.engine.server.HttpServer.type" id="akka.http.engine.server.HttpServer">HttpServer</a> <a href="#akka.http.engine.server.HttpServer" title="akka.http.engine.server.HttpServer.type" class="delimiter">{</a>

  def <a title="(serverFlow: akka.stream.scaladsl.Flow[akka.http.model.HttpRequest,akka.http.model.HttpResponse], settings: akka.http.engine.server.ServerSettings, log: akka.event.LoggingAdapter)akka.stream.scaladsl.Flow[akka.util.ByteString,akka.util.ByteString]" id="akka.http.engine.server.HttpServer.serverFlowToTransport">serverFlowToTransport</a><span class="delimiter">(</span><a title="akka.stream.scaladsl.Flow[akka.http.model.HttpRequest,akka.http.model.HttpResponse]" id="akka.http.engine.server.HttpServer.serverFlowToTransport.serverFlow">serverFlow</a>: <a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;Flow" title="akka.stream.scaladsl.Flow[akka.http.model.HttpRequest,akka.http.model.HttpResponse]">Flow</a><span class="delimiter">[</span>HttpRequest, HttpResponse<span class="delimiter">]</span>,
                            <a title="akka.http.engine.server.ServerSettings" id="akka.http.engine.server.HttpServer.serverFlowToTransport.settings">settings</a>: <a href="ServerSettings.scala.html#akka.http.engine.server;ServerSettings" title="akka.http.engine.server.ServerSettings">ServerSettings</a>,
                            <a title="akka.event.LoggingAdapter" id="akka.http.engine.server.HttpServer.serverFlowToTransport.log">log</a>: <span title="akka.event.LoggingAdapter">LoggingAdapter</span><span class="delimiter">)</span>: <a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;Flow" title="akka.stream.scaladsl.Flow[akka.util.ByteString,akka.util.ByteString]">Flow</a><span class="delimiter">[</span>ByteString, ByteString<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <span class="comment">// the initial header parser we initially use for every connection,</span>
    <span class="comment">// will not be mutated, all &quot;shared copy&quot; parsers copy on first-write into the header cache</span>
    val <a title="akka.http.engine.parsing.HttpRequestParser" id="akka.http.engine.server.HttpServer.serverFlowToTransport.rootParser">rootParser</a> = new <a href="../parsing/HttpRequestParser.scala.html#akka.http.engine.parsing;HttpRequestParser" title="akka.http.engine.parsing.HttpRequestParser">HttpRequestParser</a><span class="delimiter">(</span>
      <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.settings" title="akka.http.engine.server.ServerSettings">settings</a>.<a href="ServerSettings.scala.html#akka.http.engine.server;ServerSettings.parserSettings" title="=&gt; akka.http.engine.parsing.ParserSettings">parserSettings</a>,
      <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.settings" title="akka.http.engine.server.ServerSettings">settings</a>.<a href="ServerSettings.scala.html#akka.http.engine.server;ServerSettings.rawRequestUriHeader" title="=&gt; Boolean">rawRequestUriHeader</a>,
      <a href="../parsing/HttpHeaderParser.scala.html#akka.http.engine.parsing.HttpHeaderParser.apply" title="(settings: akka.http.engine.parsing.HttpHeaderParser.Settings)(warnOnIllegalHeader: akka.http.model.ErrorInfo =&gt; Unit)akka.http.engine.parsing.HttpHeaderParser">HttpHeaderParser</a><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.settings" title="akka.http.engine.server.ServerSettings">settings</a>.<a href="ServerSettings.scala.html#akka.http.engine.server;ServerSettings.parserSettings" title="=&gt; akka.http.engine.parsing.ParserSettings">parserSettings</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="akka.http.model.ErrorInfo" id="akka.http.engine.server.HttpServer.serverFlowToTransport.rootParser.$anonfun.errorInfo">errorInfo</a> â‡’
        if <span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.settings" title="akka.http.engine.server.ServerSettings">settings</a>.<a href="ServerSettings.scala.html#akka.http.engine.server;ServerSettings.parserSettings" title="=&gt; akka.http.engine.parsing.ParserSettings">parserSettings</a>.<a href="../parsing/ParserSettings.scala.html#akka.http.engine.parsing;ParserSettings.illegalHeaderWarnings" title="=&gt; Boolean">illegalHeaderWarnings</a><span class="delimiter">)</span> <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.log" title="akka.event.LoggingAdapter">log</a>.<span title="(message: String)Unit">warning</span><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.rootParser.$anonfun.errorInfo" title="akka.http.model.ErrorInfo">errorInfo</a>.<a href="../../model/ErrorInfo.scala.html#akka.http.model;ErrorInfo.withSummaryPrepended" title="(prefix: String)akka.http.model.ErrorInfo">withSummaryPrepended</a><span class="delimiter">(</span><span title="String(&quot;Illegal request header&quot;)" class="string">&quot;Illegal request header&quot;</span><span class="delimiter">)</span>.<a href="../../model/ErrorInfo.scala.html#akka.http.model;ErrorInfo.formatPretty" title="=&gt; String">formatPretty</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

    val <a title="akka.http.engine.rendering.HttpResponseRendererFactory" id="akka.http.engine.server.HttpServer.serverFlowToTransport.responseRendererFactory">responseRendererFactory</a> = new <a href="../rendering/HttpResponseRendererFactory.scala.html#akka.http.engine.rendering;HttpResponseRendererFactory" title="akka.http.engine.rendering.HttpResponseRendererFactory">HttpResponseRendererFactory</a><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.settings" title="akka.http.engine.server.ServerSettings">settings</a>.<a href="ServerSettings.scala.html#akka.http.engine.server;ServerSettings.serverHeader" title="=&gt; Option[akka.http.model.headers.Server]">serverHeader</a>, <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.settings" title="akka.http.engine.server.ServerSettings">settings</a>.<a href="ServerSettings.scala.html#akka.http.engine.server;ServerSettings.responseHeaderSizeHint" title="=&gt; Int">responseHeaderSizeHint</a>, <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.log" title="akka.event.LoggingAdapter">log</a><span class="delimiter">)</span>

    @volatile var <a title="Option[akka.actor.ActorRef]" id="akka.http.engine.server.HttpServer.serverFlowToTransport.oneHundredContinueRef">oneHundredContinueRef</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <span title="None.type">None</span> <span class="comment">// FIXME: unnecessary after fixing #16168</span>
    val <a title="akka.stream.scaladsl.PropsSource[akka.http.engine.server.OneHundredContinue.type]" id="akka.http.engine.server.HttpServer.serverFlowToTransport.oneHundredContinueSource">oneHundredContinueSource</a> = <a href="../../../stream/scaladsl/Source.scala.html#akka.stream.scaladsl.Source.apply(072f21a291)" title="[T](props: akka.actor.Props)akka.stream.scaladsl.PropsSource[T]">Source</a><span title="(props: akka.actor.Props)akka.stream.scaladsl.PropsSource[akka.http.engine.server.OneHundredContinue.type]" class="delimiter">[</span>OneHundredContinue.type<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span title="(creator: =&gt; akka.http.engine.server.OneHundredContinueSourceActor)(implicit evidence$2: scala.reflect.ClassTag[akka.http.engine.server.OneHundredContinueSourceActor])akka.actor.Props">Props</span> <span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[akka.http.engine.server.OneHundredContinueSourceActor]" class="delimiter">{</span>
        val <a title="akka.http.engine.server.OneHundredContinueSourceActor" id="akka.http.engine.server.HttpServer.serverFlowToTransport.oneHundredContinueSource.actor">actor</a> = new <a href="OneHundredContinue.scala.html#akka.http.engine.server;OneHundredContinueSourceActor" title="akka.http.engine.server.OneHundredContinueSourceActor">OneHundredContinueSourceActor</a>
        <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.oneHundredContinueRef" title="Option[akka.actor.ActorRef]">oneHundredContinueRef</a> = <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.oneHundredContinueSource.actor" title="akka.http.engine.server.OneHundredContinueSourceActor">actor</a>.<span title="=&gt; akka.actor.ActorContext">context</span>.<span title="=&gt; akka.actor.ActorRef">self</span><span class="delimiter">)</span>
        <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.oneHundredContinueSource.actor" title="akka.http.engine.server.OneHundredContinueSourceActor">actor</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    val <a title="akka.stream.scaladsl.Broadcast[akka.http.engine.parsing.ParserOutput.RequestOutput]" id="akka.http.engine.server.HttpServer.serverFlowToTransport.bypassFanout">bypassFanout</a> = <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.Broadcast.apply(007d939b76)" title="[T](name: String)akka.stream.scaladsl.Broadcast[T]">Broadcast</a><span title="(name: String)akka.stream.scaladsl.Broadcast[akka.http.engine.parsing.ParserOutput.RequestOutput]" class="delimiter">[</span><a href="../parsing/ParserOutput.scala.html#akka.http.engine.parsing.ParserOutput;RequestOutput" title="akka.http.engine.parsing.ParserOutput.RequestOutput">RequestOutput</a><span class="delimiter">]</span><span class="delimiter">(</span><span title="String(&quot;bypassFanout&quot;)" class="string">&quot;bypassFanout&quot;</span><span class="delimiter">)</span>
    val <a title="akka.http.engine.server.HttpServer.BypassMerge" id="akka.http.engine.server.HttpServer.serverFlowToTransport.bypassMerge">bypassMerge</a> = new <a href="#akka.http.engine.server.HttpServer;BypassMerge" title="akka.http.engine.server.HttpServer.BypassMerge">BypassMerge</a><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.settings" title="akka.http.engine.server.ServerSettings">settings</a>, <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.log" title="akka.event.LoggingAdapter">log</a><span class="delimiter">)</span>

    val <a title="akka.stream.scaladsl.Flow[akka.util.ByteString,akka.http.engine.parsing.ParserOutput.RequestOutput]" id="akka.http.engine.server.HttpServer.serverFlowToTransport.requestParsing">requestParsing</a> = <a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl.Flow.apply(25a994e6fb)" title="[T]=&gt; akka.stream.scaladsl.Flow[T,T]">Flow</a><span title="akka.stream.scaladsl.Flow[akka.util.ByteString,akka.util.ByteString]" class="delimiter">[</span><span title="akka.util.ByteString">ByteString</span><span class="delimiter">]</span>.<a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;Flow.section" title="(attributes: akka.stream.scaladsl.OperationAttributes)(section: akka.stream.scaladsl.Flow[akka.util.ByteString,akka.util.ByteString] =&gt; akka.stream.scaladsl.Flow[akka.util.ByteString,akka.http.engine.parsing.ParserOutput.RequestOutput])akka.stream.scaladsl.Flow[akka.util.ByteString,akka.http.engine.parsing.ParserOutput.RequestOutput]">section</a><span class="delimiter">(</span><a href="../../../stream/scaladsl/OperationAttributes.scala.html#akka.stream.scaladsl.OperationAttributes.name" title="(name: String)akka.stream.scaladsl.OperationAttributes">name</a><span class="delimiter">(</span><span title="String(&quot;rootParser&quot;)" class="string">&quot;rootParser&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestParsing.$anonfun.x$1" title="akka.stream.scaladsl.Flow[akka.util.ByteString,akka.util.ByteString]">_</a>.<a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;FlowOps.transform" title="(mkStage: () =&gt; akka.stream.stage.Stage[akka.util.ByteString,akka.http.engine.parsing.ParserOutput.RequestOutput])x$1.Repr[akka.http.engine.parsing.ParserOutput.RequestOutput]">transform</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> â‡’
      <span class="comment">// each connection uses a single (private) request parser instance for all its requests</span>
      <span class="comment">// which builds a cache of all header instances seen on that connection</span>
      <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.rootParser" title="akka.http.engine.parsing.HttpRequestParser">rootParser</a>.<a href="../parsing/HttpRequestParser.scala.html#akka.http.engine.parsing;HttpRequestParser.createShallowCopy" title="(oneHundredContinueRef: () =&gt; Option[akka.actor.ActorRef])akka.http.engine.parsing.HttpRequestParser">createShallowCopy</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> â‡’ <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.oneHundredContinueRef" title="Option[akka.actor.ActorRef]">oneHundredContinueRef</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

    val <a title="akka.stream.scaladsl.Flow[akka.http.engine.parsing.ParserOutput.RequestOutput,(akka.http.engine.parsing.ParserOutput.RequestOutput, akka.stream.scaladsl.Source[akka.http.engine.parsing.ParserOutput.RequestOutput])]#Repr[akka.http.model.HttpRequest]" id="akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation">requestPreparation</a> =
      <a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl.Flow.apply(25a994e6fb)" title="[T]=&gt; akka.stream.scaladsl.Flow[T,T]">Flow</a><span title="akka.stream.scaladsl.Flow[akka.http.engine.parsing.ParserOutput.RequestOutput,akka.http.engine.parsing.ParserOutput.RequestOutput]" class="delimiter">[</span><a href="../parsing/ParserOutput.scala.html#akka.http.engine.parsing.ParserOutput;RequestOutput" title="akka.http.engine.parsing.ParserOutput.RequestOutput">RequestOutput</a><span class="delimiter">]</span>
        .<a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;FlowOps.splitWhen" title="(p: akka.http.engine.parsing.ParserOutput.RequestOutput =&gt; Boolean)akka.stream.scaladsl.Flow[akka.http.engine.parsing.ParserOutput.RequestOutput,akka.http.engine.parsing.ParserOutput.RequestOutput]#Repr[akka.stream.scaladsl.Source[akka.http.engine.parsing.ParserOutput.RequestOutput]]">splitWhen</a><a href="../../util/package.scala.html#akka.http.util.package.FlowWithHeadAndTail(5e2dd08046)" title="(underlying: akka.stream.scaladsl.Flow[akka.http.engine.parsing.ParserOutput.RequestOutput,akka.stream.scaladsl.Source[akka.http.engine.parsing.ParserOutput.RequestOutput]])akka.http.util.FlowWithHeadAndTail[akka.http.engine.parsing.ParserOutput.RequestOutput,akka.http.engine.parsing.ParserOutput.RequestOutput]" class="delimiter">(</a><a title="akka.http.engine.parsing.ParserOutput.RequestOutput" id="akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation.$anonfun.x">x</a> â‡’ <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation.$anonfun.x" title="akka.http.engine.parsing.ParserOutput.RequestOutput">x</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../parsing/ParserOutput.scala.html#akka.http.engine.parsing.ParserOutput;MessageStart" title="akka.http.engine.parsing.ParserOutput.MessageStart">MessageStart</a><span class="delimiter">]</span> <span title="(x: Boolean)Boolean">||</span> <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation.$anonfun.x" title="akka.http.engine.parsing.ParserOutput.RequestOutput">x</a> <span title="(x$1: Any)Boolean">==</span> <a href="../parsing/ParserOutput.scala.html#akka.http.engine.parsing.ParserOutput.MessageEnd" title="akka.http.engine.parsing.ParserOutput.MessageEnd.type">MessageEnd</a><span class="delimiter">)</span>
        .<a href="../../util/package.scala.html#akka.http.util.package;FlowWithHeadAndTail.headAndTail" title="=&gt; akka.stream.scaladsl.Flow[akka.http.engine.parsing.ParserOutput.RequestOutput,(akka.http.engine.parsing.ParserOutput.RequestOutput, akka.stream.scaladsl.Source[akka.http.engine.parsing.ParserOutput.RequestOutput])]">headAndTail</a>
        .<a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;FlowOps.collect" title="(pf: PartialFunction[(akka.http.engine.parsing.ParserOutput.RequestOutput, akka.stream.scaladsl.Source[akka.http.engine.parsing.ParserOutput.RequestOutput]),akka.http.model.HttpRequest])akka.stream.scaladsl.Flow[akka.http.engine.parsing.ParserOutput.RequestOutput,(akka.http.engine.parsing.ParserOutput.RequestOutput, akka.stream.scaladsl.Source[akka.http.engine.parsing.ParserOutput.RequestOutput])]#Repr[akka.http.model.HttpRequest]">collect</a> <a title="&lt;$anon: ((akka.http.engine.parsing.ParserOutput.RequestOutput, akka.stream.scaladsl.Source[akka.http.engine.parsing.ParserOutput.RequestOutput])) =&gt; akka.http.model.HttpRequest&gt; extends scala.runtime.AbstractPartialFunction[(akka.http.engine.parsing.ParserOutput.RequestOutput, akka.stream.scaladsl.Source[akka.http.engine.parsing.ParserOutput.RequestOutput]),akka.http.model.HttpRequest] with Serializable" id="akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
          case <span class="delimiter">(</span>RequestStart<span class="delimiter">(</span><a title="akka.http.model.HttpMethod" id="akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.method">method</a>, <a title="akka.http.model.Uri" id="akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.uri">uri</a>, <a title="akka.http.model.HttpProtocol" id="akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.protocol">protocol</a>, <a title="List[akka.http.model.HttpHeader]" id="akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.headers">headers</a>, <a title="akka.stream.scaladsl.Source[akka.http.engine.parsing.ParserOutput.RequestOutput] =&gt; akka.http.model.RequestEntity" id="akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.createEntity">createEntity</a>, _, _<span class="delimiter">)</span>, <a title="akka.stream.scaladsl.Source[akka.http.engine.parsing.ParserOutput.RequestOutput]" id="akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.entityParts">entityParts</a><span class="delimiter">)</span> â‡’
            val <a title="akka.http.model.Uri" id="akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.applyOrElse.effectiveUri">effectiveUri</a> = <a href="../../model/HttpMessage.scala.html#akka.http.model.HttpRequest" title="akka.http.model.HttpRequest.type">HttpRequest</a>.<a href="../../model/HttpMessage.scala.html#akka.http.model.HttpRequest.effectiveUri" title="(uri: akka.http.model.Uri, headers: scala.collection.immutable.Seq[akka.http.model.HttpHeader], securedConnection: Boolean, defaultHostHeader: akka.http.model.headers.Host)akka.http.model.Uri">effectiveUri</a><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.uri" title="akka.http.model.Uri">uri</a>, <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.headers" title="List[akka.http.model.HttpHeader]">headers</a>, securedConnection = false, <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.settings" title="akka.http.engine.server.ServerSettings">settings</a>.<a href="ServerSettings.scala.html#akka.http.engine.server;ServerSettings.defaultHostHeader" title="=&gt; akka.http.model.headers.Host">defaultHostHeader</a><span class="delimiter">)</span>
            val <a title="akka.http.model.HttpMethod" id="akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.applyOrElse.effectiveMethod">effectiveMethod</a> = if <span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.method" title="akka.http.model.HttpMethod">method</a> <span title="(x$1: Any)Boolean">==</span> <a href="../../model/HttpMethod.scala.html#akka.http.model.HttpMethods" title="akka.http.model.HttpMethods.type">HttpMethods</a>.<a href="../../model/HttpMethod.scala.html#akka.http.model.HttpMethods.HEAD" title="=&gt; akka.http.model.HttpMethod">HEAD</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.settings" title="akka.http.engine.server.ServerSettings">settings</a>.<a href="ServerSettings.scala.html#akka.http.engine.server;ServerSettings.transparentHeadRequests" title="=&gt; Boolean">transparentHeadRequests</a><span class="delimiter">)</span> <a href="../../model/HttpMethod.scala.html#akka.http.model.HttpMethods" title="akka.http.model.HttpMethods.type">HttpMethods</a>.<a href="../../model/HttpMethod.scala.html#akka.http.model.HttpMethods.GET" title="=&gt; akka.http.model.HttpMethod">GET</a> else <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.method" title="akka.http.model.HttpMethod">method</a>
            <a href="../../model/HttpMessage.scala.html#akka.http.model;HttpRequest" title="(method: akka.http.model.HttpMethod, uri: akka.http.model.Uri, headers: scala.collection.immutable.Seq[akka.http.model.HttpHeader], entity: akka.http.model.RequestEntity, protocol: akka.http.model.HttpProtocol)akka.http.model.HttpRequest">HttpRequest</a><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.applyOrElse.effectiveMethod" title="akka.http.model.HttpMethod">effectiveMethod</a>, <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.applyOrElse.effectiveUri" title="akka.http.model.Uri">effectiveUri</a>, <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.headers" title="List[akka.http.model.HttpHeader]">headers</a>, <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.createEntity" title="(v1: akka.stream.scaladsl.Source[akka.http.engine.parsing.ParserOutput.RequestOutput])akka.http.model.RequestEntity">createEntity</a><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.entityParts" title="akka.stream.scaladsl.Source[akka.http.engine.parsing.ParserOutput.RequestOutput]">entityParts</a><span class="delimiter">)</span>, <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation;$anonfun.isDefinedAt.protocol" title="akka.http.model.HttpProtocol">protocol</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

    val <a title="akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.util.ByteString]" id="akka.http.engine.server.HttpServer.serverFlowToTransport.rendererPipeline">rendererPipeline</a> =
      <a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl.Flow.apply(25a994e6fb)" title="[T]=&gt; akka.stream.scaladsl.Flow[T,T]">Flow</a><span title="akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.http.engine.rendering.ResponseRenderingContext]" class="delimiter">[</span><a href="../rendering/HttpResponseRendererFactory.scala.html#akka.http.engine.rendering;ResponseRenderingContext" title="akka.http.engine.rendering.ResponseRenderingContext">ResponseRenderingContext</a><span class="delimiter">]</span>
        .<a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;Flow.section" title="(attributes: akka.stream.scaladsl.OperationAttributes)(section: akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.http.engine.rendering.ResponseRenderingContext] =&gt; akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.http.engine.rendering.ResponseRenderingContext])akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.http.engine.rendering.ResponseRenderingContext]">section</a><span class="delimiter">(</span><a href="../../../stream/scaladsl/OperationAttributes.scala.html#akka.stream.scaladsl.OperationAttributes.name" title="(name: String)akka.stream.scaladsl.OperationAttributes">name</a><span class="delimiter">(</span><span title="String(&quot;recover&quot;)" class="string">&quot;recover&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.rendererPipeline.$anonfun.x$2" title="akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.http.engine.rendering.ResponseRenderingContext]">_</a>.<a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;FlowOps.transform" title="(mkStage: () =&gt; akka.stream.stage.Stage[akka.http.engine.rendering.ResponseRenderingContext,akka.http.engine.rendering.ResponseRenderingContext])x$2.Repr[akka.http.engine.rendering.ResponseRenderingContext]">transform</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> â‡’ new <a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery" title="akka.http.engine.server.ErrorsTo500ResponseRecovery">ErrorsTo500ResponseRecovery</a><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.log" title="akka.event.LoggingAdapter">log</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="comment">// FIXME: simplify after #16394 is closed</span>
        .<a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;Flow.section" title="(attributes: akka.stream.scaladsl.OperationAttributes)(section: akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.http.engine.rendering.ResponseRenderingContext] =&gt; akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.stream.scaladsl.Source[akka.util.ByteString]])akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.stream.scaladsl.Source[akka.util.ByteString]]">section</a><span class="delimiter">(</span><a href="../../../stream/scaladsl/OperationAttributes.scala.html#akka.stream.scaladsl.OperationAttributes.name" title="(name: String)akka.stream.scaladsl.OperationAttributes">name</a><span class="delimiter">(</span><span title="String(&quot;renderer&quot;)" class="string">&quot;renderer&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.rendererPipeline.$anonfun.x$3" title="akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.http.engine.rendering.ResponseRenderingContext]">_</a>.<a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;FlowOps.transform" title="(mkStage: () =&gt; akka.stream.stage.Stage[akka.http.engine.rendering.ResponseRenderingContext,akka.stream.scaladsl.Source[akka.util.ByteString]])x$3.Repr[akka.stream.scaladsl.Source[akka.util.ByteString]]">transform</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> â‡’ <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.responseRendererFactory" title="akka.http.engine.rendering.HttpResponseRendererFactory">responseRendererFactory</a>.<a href="../rendering/HttpResponseRendererFactory.scala.html#akka.http.engine.rendering;HttpResponseRendererFactory.newRenderer" title="=&gt; responseRendererFactory.HttpResponseRenderer">newRenderer</a><span class="delimiter">)</span><span class="delimiter">)</span>
        .<a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;FlowOps.flatten" title="(strategy: akka.stream.FlattenStrategy[akka.stream.scaladsl.Source[akka.util.ByteString],akka.util.ByteString])akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.stream.scaladsl.Source[akka.util.ByteString]]#Repr[akka.util.ByteString]">flatten</a><span class="delimiter">(</span><a href="../../../stream/FlattenStrategy.scala.html#akka.stream.FlattenStrategy" title="akka.stream.FlattenStrategy.type">FlattenStrategy</a>.<a href="../../../stream/FlattenStrategy.scala.html#akka.stream.FlattenStrategy.concat" title="akka.stream.FlattenStrategy[akka.stream.scaladsl.Source[akka.util.ByteString],akka.util.ByteString]">concat</a><span class="delimiter">)</span>
        .<a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;Flow.section" title="(attributes: akka.stream.scaladsl.OperationAttributes)(section: akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.util.ByteString] =&gt; akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.util.ByteString])akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.util.ByteString]">section</a><span class="delimiter">(</span><a href="../../../stream/scaladsl/OperationAttributes.scala.html#akka.stream.scaladsl.OperationAttributes.name" title="(name: String)akka.stream.scaladsl.OperationAttributes">name</a><span class="delimiter">(</span><span title="String(&quot;errorLogger&quot;)" class="string">&quot;errorLogger&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.rendererPipeline.$anonfun.x$4" title="akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.util.ByteString]">_</a>.<a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;FlowOps.transform" title="(mkStage: () =&gt; akka.stream.stage.Stage[akka.util.ByteString,akka.util.ByteString])x$4.Repr[akka.util.ByteString]">transform</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> â‡’ <a href="../../util/package.scala.html#akka.http.util.package.errorLogger" title="(log: akka.event.LoggingAdapter, msg: String)akka.stream.stage.PushStage[akka.util.ByteString,akka.util.ByteString]">errorLogger</a><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.log" title="akka.event.LoggingAdapter">log</a>, <span title="String(&quot;Outgoing response stream error&quot;)" class="string">&quot;Outgoing response stream error&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

    val <a title="akka.stream.scaladsl.UndefinedSource[akka.util.ByteString]" id="akka.http.engine.server.HttpServer.serverFlowToTransport.transportIn">transportIn</a> = <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.UndefinedSource.apply(60f3f0873d)" title="[T]=&gt; akka.stream.scaladsl.UndefinedSource[T]">UndefinedSource</a><span title="akka.stream.scaladsl.UndefinedSource[akka.util.ByteString]" class="delimiter">[</span><span title="akka.util.ByteString">ByteString</span><span class="delimiter">]</span>
    val <a title="akka.stream.scaladsl.UndefinedSink[akka.util.ByteString]" id="akka.http.engine.server.HttpServer.serverFlowToTransport.transportOut">transportOut</a> = <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.UndefinedSink.apply(319cd600db)" title="[T]=&gt; akka.stream.scaladsl.UndefinedSink[T]">UndefinedSink</a><span title="akka.stream.scaladsl.UndefinedSink[akka.util.ByteString]" class="delimiter">[</span><span title="akka.util.ByteString">ByteString</span><span class="delimiter">]</span>

    import <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.FlowGraphImplicits" title="akka.stream.scaladsl.FlowGraphImplicits.type">FlowGraphImplicits</a>._

    <a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl.Flow.apply(e16ca30e59)" title="()(block: akka.stream.scaladsl.FlowGraphBuilder =&gt; (akka.stream.scaladsl.UndefinedSource[akka.util.ByteString], akka.stream.scaladsl.UndefinedSink[Nothing]))akka.stream.scaladsl.Flow[akka.util.ByteString,Nothing]">Flow</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span> implicit <a title="akka.stream.scaladsl.FlowGraphBuilder" id="akka.http.engine.server.HttpServer.serverFlowToTransport.$anonfun.b">b</a> â‡’
      <span class="comment">//FIXME: the graph is unnecessary after fixing #15957</span>
      <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.FlowGraphImplicits.UndefinedSourceOps(8f594c3346)" title="(source: akka.stream.scaladsl.UndefinedSource[akka.util.ByteString])akka.stream.scaladsl.FlowGraphImplicits.UndefinedSourceOps[akka.util.ByteString]">transportIn</a> <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.FlowGraphImplicits;UndefinedSourceOps.~>(c4d24a6e2a)" title="(flow: akka.stream.scaladsl.Flow[akka.util.ByteString,akka.http.engine.parsing.ParserOutput.RequestOutput])(implicit builder: akka.stream.scaladsl.FlowGraphBuilder)akka.stream.scaladsl.FlowGraphImplicits.UndefinedSourceNextStep[akka.util.ByteString,akka.http.engine.parsing.ParserOutput.RequestOutput]">~&gt;</a> <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestParsing" title="akka.stream.scaladsl.Flow[akka.util.ByteString,akka.http.engine.parsing.ParserOutput.RequestOutput]">requestParsing</a> <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.FlowGraphImplicits.JunctionOps(114ae30b90)" title="(junction: akka.stream.scaladsl.JunctionOutPort[bypassFanout.NextT])akka.stream.scaladsl.FlowGraphImplicits.JunctionOps[bypassFanout.NextT]">~&gt;</a> <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.bypassFanout" title="akka.stream.scaladsl.Broadcast[akka.http.engine.parsing.ParserOutput.RequestOutput]">bypassFanout</a> <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.FlowGraphImplicits;JunctionOps.~>(3b3b991bfe)" title="(flow: akka.stream.scaladsl.Flow[bypassFanout.NextT,akka.http.model.HttpRequest])(implicit builder: akka.stream.scaladsl.FlowGraphBuilder)akka.stream.scaladsl.FlowGraphImplicits.JunctionNextStep[bypassFanout.NextT,akka.http.model.HttpRequest]">~&gt;</a> <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.requestPreparation" title="akka.stream.scaladsl.Flow[akka.http.engine.parsing.ParserOutput.RequestOutput,(akka.http.engine.parsing.ParserOutput.RequestOutput, akka.stream.scaladsl.Source[akka.http.engine.parsing.ParserOutput.RequestOutput])]#Repr[akka.http.model.HttpRequest]">requestPreparation</a> <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.FlowGraphImplicits;JunctionNextStep.~>(4326123cdb)" title="(otherFlow: akka.stream.scaladsl.Flow[akka.http.model.HttpRequest,akka.http.model.HttpResponse])akka.stream.scaladsl.FlowGraphImplicits.JunctionNextStep[bypassFanout.NextT,akka.http.model.HttpResponse]">~&gt;</a> <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.serverFlow" title="akka.stream.scaladsl.Flow[akka.http.model.HttpRequest,akka.http.model.HttpResponse]">serverFlow</a> <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.FlowGraphImplicits.JunctionOps(114ae30b90)" title="(junction: akka.stream.scaladsl.JunctionOutPort[bypassMerge.applicationInput.NextT])akka.stream.scaladsl.FlowGraphImplicits.JunctionOps[bypassMerge.applicationInput.NextT]">~&gt;</a> <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.bypassMerge" title="akka.http.engine.server.HttpServer.BypassMerge">bypassMerge</a>.<a href="#akka.http.engine.server.HttpServer;BypassMerge.applicationInput" title="=&gt; akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.model.HttpResponse,akka.http.engine.rendering.ResponseRenderingContext]">applicationInput</a> <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.FlowGraphImplicits;JunctionOps.~>(3b3b991bfe)" title="(flow: akka.stream.scaladsl.Flow[bypassMerge.applicationInput.NextT,akka.util.ByteString])(implicit builder: akka.stream.scaladsl.FlowGraphBuilder)akka.stream.scaladsl.FlowGraphImplicits.JunctionNextStep[bypassMerge.applicationInput.NextT,akka.util.ByteString]">~&gt;</a> <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.rendererPipeline" title="akka.stream.scaladsl.Flow[akka.http.engine.rendering.ResponseRenderingContext,akka.util.ByteString]">rendererPipeline</a> <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.FlowGraphImplicits;JunctionNextStep.~>(feca27962c)" title="(sink: akka.stream.scaladsl.UndefinedSink[akka.util.ByteString])Unit">~&gt;</a> <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.transportOut" title="akka.stream.scaladsl.UndefinedSink[akka.util.ByteString]">transportOut</a>
      <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.FlowGraphImplicits.JunctionOps(114ae30b90)" title="(junction: akka.stream.scaladsl.JunctionOutPort[akka.http.engine.parsing.ParserOutput.RequestOutput])akka.stream.scaladsl.FlowGraphImplicits.JunctionOps[akka.http.engine.parsing.ParserOutput.RequestOutput]">bypassFanout</a> <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.FlowGraphImplicits;JunctionOps.~>(c33a1b29a8)" title="(junctionIn: akka.stream.scaladsl.JunctionInPort[akka.http.engine.parsing.ParserOutput.RequestOutput])(implicit builder: akka.stream.scaladsl.FlowGraphBuilder)akka.stream.scaladsl.JunctionOutPort[junctionIn.NextT]">~&gt;</a> <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.bypassMerge" title="akka.http.engine.server.HttpServer.BypassMerge">bypassMerge</a>.<a href="#akka.http.engine.server.HttpServer;BypassMerge.bypassInput" title="=&gt; akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.engine.parsing.ParserOutput.RequestOutput,akka.http.engine.rendering.ResponseRenderingContext]">bypassInput</a>
      <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.FlowGraphImplicits.SourceOps(7cb649aecd)" title="(source: akka.stream.scaladsl.Source[akka.http.engine.server.OneHundredContinue.type])akka.stream.scaladsl.FlowGraphImplicits.SourceOps[akka.http.engine.server.OneHundredContinue.type]">oneHundredContinueSource</a> <a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl.FlowGraphImplicits;SourceOps.~>(57020350be)" title="(junctionIn: akka.stream.scaladsl.JunctionInPort[akka.http.engine.server.OneHundredContinue.type])(implicit builder: akka.stream.scaladsl.FlowGraphBuilder)akka.stream.scaladsl.JunctionOutPort[junctionIn.NextT]">~&gt;</a> <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.bypassMerge" title="akka.http.engine.server.HttpServer.BypassMerge">bypassMerge</a>.<a href="#akka.http.engine.server.HttpServer;BypassMerge.oneHundredContinueInput" title="=&gt; akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.engine.server.OneHundredContinue.type,akka.http.engine.rendering.ResponseRenderingContext]">oneHundredContinueInput</a>

      <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.$anonfun.b" title="akka.stream.scaladsl.FlowGraphBuilder">b</a>.<a href="../../../stream/scaladsl/FlowGraph.scala.html#akka.stream.scaladsl;FlowGraphBuilder.allowCycles" title="()Unit">allowCycles</a><span class="delimiter">(</span><span class="delimiter">)</span>

      <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.transportIn" title="(self: akka.stream.scaladsl.UndefinedSource[akka.util.ByteString])ArrowAssoc[akka.stream.scaladsl.UndefinedSource[akka.util.ByteString]]">transportIn</a> <span title="(y: akka.stream.scaladsl.UndefinedSink[akka.util.ByteString])(akka.stream.scaladsl.UndefinedSource[akka.util.ByteString], akka.stream.scaladsl.UndefinedSink[akka.util.ByteString])">-&gt;</span> <a href="#akka.http.engine.server.HttpServer.serverFlowToTransport.transportOut" title="akka.stream.scaladsl.UndefinedSink[akka.util.ByteString]">transportOut</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  class <a title="class BypassMerge extends akka.stream.scaladsl.FlexiMerge[akka.http.engine.rendering.ResponseRenderingContext]" id="akka.http.engine.server.HttpServer;BypassMerge">BypassMerge</a><a href="#akka.http.engine.server.HttpServer;BypassMerge" title="akka.http.engine.server.HttpServer.BypassMerge" class="delimiter">(</a><a title="akka.http.engine.server.ServerSettings" id="akka.http.engine.server.HttpServer;BypassMerge.settings">settings</a>: <a href="ServerSettings.scala.html#akka.http.engine.server;ServerSettings" title="akka.http.engine.server.ServerSettings">ServerSettings</a>, <a title="akka.event.LoggingAdapter" id="akka.http.engine.server.HttpServer;BypassMerge.log">log</a>: <span title="akka.event.LoggingAdapter">LoggingAdapter</span><span class="delimiter">)</span> extends <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl;FlexiMerge" title="akka.stream.scaladsl.FlexiMerge[akka.http.engine.rendering.ResponseRenderingContext]">FlexiMerge</a><span class="delimiter">[</span>ResponseRenderingContext<span class="delimiter">]</span><span class="delimiter">(</span><span title="String(&quot;BypassMerge&quot;)" class="string">&quot;BypassMerge&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    import <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge" title="akka.stream.scaladsl.FlexiMerge.type">FlexiMerge</a>._
    val <a title="akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.engine.parsing.ParserOutput.RequestOutput,akka.http.engine.rendering.ResponseRenderingContext]" id="akka.http.engine.server.HttpServer;BypassMerge.bypassInput">bypassInput</a> = <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl;FlexiMerge.createInputPort" title="[T]()akka.stream.scaladsl.FlexiMerge.InputPort[T,akka.http.engine.rendering.ResponseRenderingContext]">createInputPort</a><span title="()akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.engine.parsing.ParserOutput.RequestOutput,akka.http.engine.rendering.ResponseRenderingContext]" class="delimiter">[</span><a href="../parsing/ParserOutput.scala.html#akka.http.engine.parsing.ParserOutput;RequestOutput" title="akka.http.engine.parsing.ParserOutput.RequestOutput">RequestOutput</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.engine.server.OneHundredContinue.type,akka.http.engine.rendering.ResponseRenderingContext]" id="akka.http.engine.server.HttpServer;BypassMerge.oneHundredContinueInput">oneHundredContinueInput</a> = <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl;FlexiMerge.createInputPort" title="[T]()akka.stream.scaladsl.FlexiMerge.InputPort[T,akka.http.engine.rendering.ResponseRenderingContext]">createInputPort</a><span title="()akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.engine.server.OneHundredContinue.type,akka.http.engine.rendering.ResponseRenderingContext]" class="delimiter">[</span>OneHundredContinue.type<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.model.HttpResponse,akka.http.engine.rendering.ResponseRenderingContext]" id="akka.http.engine.server.HttpServer;BypassMerge.applicationInput">applicationInput</a> = <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl;FlexiMerge.createInputPort" title="[T]()akka.stream.scaladsl.FlexiMerge.InputPort[T,akka.http.engine.rendering.ResponseRenderingContext]">createInputPort</a><span title="()akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.model.HttpResponse,akka.http.engine.rendering.ResponseRenderingContext]" class="delimiter">[</span><a href="../../model/HttpMessage.scala.html#akka.http.model;HttpResponse" title="akka.http.model.HttpResponse">HttpResponse</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    def <a title="()akka.stream.scaladsl.FlexiMerge.MergeLogic[akka.http.engine.rendering.ResponseRenderingContext]{def inputHandles(inputCount: Int): scala.collection.immutable.Vector[akka.stream.scaladsl.FlexiMerge.InputPort[_ &gt;: akka.http.model.HttpResponse with akka.http.engine.server.OneHundredContinue.type with akka.http.engine.parsing.ParserOutput.RequestOutput &lt;: Object, akka.http.engine.rendering.ResponseRenderingContext]]; val initialState: this.State[Any]}" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic">createMergeLogic</a><span class="delimiter">(</span><span class="delimiter">)</span> = new <a title="&lt;$anon: akka.stream.scaladsl.FlexiMerge.MergeLogic[akka.http.engine.rendering.ResponseRenderingContext]&gt; extends akka.stream.scaladsl.FlexiMerge.MergeLogic[akka.http.engine.rendering.ResponseRenderingContext]" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon">MergeLogic</a><span class="delimiter">[</span>ResponseRenderingContext<span class="delimiter">]</span> <span class="delimiter">{</span>
      override def <a title="(inputCount: Int)scala.collection.immutable.Vector[akka.stream.scaladsl.FlexiMerge.InputPort[_ &gt;: akka.http.model.HttpResponse with akka.http.engine.server.OneHundredContinue.type with akka.http.engine.parsing.ParserOutput.RequestOutput &lt;: Object, akka.http.engine.rendering.ResponseRenderingContext]]" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.inputHandles">inputHandles</a><span class="delimiter">(</span><a title="Int" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.inputHandles.inputCount">inputCount</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
        <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.inputHandles.inputCount" title="Int">inputCount</a> <span title="(x: Int)Boolean">==</span> <span title="Int(3)" class="int">3</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;BypassMerge must have 3 connected inputs, was &quot;)">BypassMerge must have 3 connected inputs, was $</span><a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.inputHandles.inputCount" title="Int">inputCount</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
        <span title="(elems: akka.stream.scaladsl.FlexiMerge.InputPort[_ &gt;: akka.http.model.HttpResponse with akka.http.engine.server.OneHundredContinue.type with akka.http.engine.parsing.ParserOutput.RequestOutput &lt;: Object, akka.http.engine.rendering.ResponseRenderingContext]*)scala.collection.immutable.Vector[akka.stream.scaladsl.FlexiMerge.InputPort[_ &gt;: akka.http.model.HttpResponse with akka.http.engine.server.OneHundredContinue.type with akka.http.engine.parsing.ParserOutput.RequestOutput &lt;: Object, akka.http.engine.rendering.ResponseRenderingContext]]">Vector</span><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer;BypassMerge.bypassInput" title="=&gt; akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.engine.parsing.ParserOutput.RequestOutput,akka.http.engine.rendering.ResponseRenderingContext]">bypassInput</a>, <a href="#akka.http.engine.server.HttpServer;BypassMerge.oneHundredContinueInput" title="=&gt; akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.engine.server.OneHundredContinue.type,akka.http.engine.rendering.ResponseRenderingContext]">oneHundredContinueInput</a>, <a href="#akka.http.engine.server.HttpServer;BypassMerge.applicationInput" title="=&gt; akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.model.HttpResponse,akka.http.engine.rendering.ResponseRenderingContext]">applicationInput</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      override val <a title="this.State[Any]" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.initialState">initialState</a> = <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic;State" title="[In](condition: akka.stream.scaladsl.FlexiMerge.ReadCondition)(onInput: (this.MergeLogicContext, akka.stream.scaladsl.FlexiMerge.InputHandle, In) =&gt; this.State[_])this.State[In]">State</a><span title="(condition: akka.stream.scaladsl.FlexiMerge.ReadCondition)(onInput: (this.MergeLogicContext, akka.stream.scaladsl.FlexiMerge.InputHandle, Any) =&gt; this.State[_])this.State[Any]" class="delimiter">[</span><span title="Any">Any</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;Read" title="(input: akka.stream.scaladsl.FlexiMerge.InputHandle)akka.stream.scaladsl.FlexiMerge.Read">Read</a><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer;BypassMerge.bypassInput" title="=&gt; akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.engine.parsing.ParserOutput.RequestOutput,akka.http.engine.rendering.ResponseRenderingContext]">bypassInput</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.initialState.$anonfun.x0$1" title="this.State[_104]" class="delimiter">{</a>
        case <span class="delimiter">(</span><span title="this.MergeLogicContext">ctx</span>, _, <a title="akka.http.engine.parsing.ParserOutput.RequestStart" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.initialState.$anonfun.requestStart">requestStart</a>: <a href="../parsing/ParserOutput.scala.html#akka.http.engine.parsing.ParserOutput;RequestStart" title="akka.http.engine.parsing.ParserOutput.RequestStart">RequestStart</a><span class="delimiter">)</span>      â‡’ <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse" title="(requestStart: akka.http.engine.parsing.ParserOutput.RequestStart)this.State[Any]">waitingForApplicationResponse</a><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.initialState.$anonfun.requestStart" title="akka.http.engine.parsing.ParserOutput.RequestStart">requestStart</a><span class="delimiter">)</span>
        case <span class="delimiter">(</span><span title="this.MergeLogicContext">ctx</span>, _, MessageStartError<span class="delimiter">(</span><a title="akka.http.model.StatusCode" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.initialState.$anonfun.status">status</a>, <a title="akka.http.model.ErrorInfo" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.initialState.$anonfun.info">info</a><span class="delimiter">)</span><span class="delimiter">)</span> â‡’ <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError" title="(ctx: this.MergeLogicContext, target: String, status: akka.http.model.StatusCode, info: akka.http.model.ErrorInfo)this.State[Any]">finishWithError</a><span class="delimiter">(</span><span title="this.MergeLogicContext">ctx</span>, <span title="String(&quot;request&quot;)" class="string">&quot;request&quot;</span>, <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.initialState.$anonfun.status" title="akka.http.model.StatusCode">status</a>, <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.initialState.$anonfun.info" title="akka.http.model.ErrorInfo">info</a><span class="delimiter">)</span>
        case _                                         â‡’ <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic.SameState" title="this.State[Nothing]">SameState</a> <span class="comment">// drop other parser output</span>
      <span class="delimiter">}</span>

      def <a title="(requestStart: akka.http.engine.parsing.ParserOutput.RequestStart)this.State[Any]" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse">waitingForApplicationResponse</a><span class="delimiter">(</span><a title="akka.http.engine.parsing.ParserOutput.RequestStart" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse.requestStart">requestStart</a>: <a href="../parsing/ParserOutput.scala.html#akka.http.engine.parsing.ParserOutput;RequestStart" title="akka.http.engine.parsing.ParserOutput.RequestStart">RequestStart</a><span class="delimiter">)</span>: <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic;State" title="this.State[Any]">State</a><span class="delimiter">[</span>Any<span class="delimiter">]</span> =
        <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic;State" title="[In](condition: akka.stream.scaladsl.FlexiMerge.ReadCondition)(onInput: (this.MergeLogicContext, akka.stream.scaladsl.FlexiMerge.InputHandle, In) =&gt; this.State[_])this.State[In]">State</a><span title="(condition: akka.stream.scaladsl.FlexiMerge.ReadCondition)(onInput: (this.MergeLogicContext, akka.stream.scaladsl.FlexiMerge.InputHandle, Any) =&gt; this.State[_])this.State[Any]" class="delimiter">[</span><span title="Any">Any</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;ReadAny" title="(inputs: akka.stream.scaladsl.FlexiMerge.InputHandle*)akka.stream.scaladsl.FlexiMerge.ReadAny">ReadAny</a><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer;BypassMerge.oneHundredContinueInput" title="=&gt; akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.engine.server.OneHundredContinue.type,akka.http.engine.rendering.ResponseRenderingContext]">oneHundredContinueInput</a>, <a href="#akka.http.engine.server.HttpServer;BypassMerge.applicationInput" title="=&gt; akka.stream.scaladsl.FlexiMerge.InputPort[akka.http.model.HttpResponse,akka.http.engine.rendering.ResponseRenderingContext]">applicationInput</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse.$anonfun.x0$3" title="this.State[Any]" class="delimiter">{</a>
          case <span class="delimiter">(</span><span title="this.MergeLogicContext">ctx</span>, _, <a title="akka.http.model.HttpResponse" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse.$anonfun.response">response</a>: <a href="../../model/HttpMessage.scala.html#akka.http.model;HttpResponse" title="akka.http.model.HttpResponse">HttpResponse</a><span class="delimiter">)</span> â‡’
            <span class="comment">// see the comment on [[OneHundredContinue]] for an explanation of the closing logic here (and more)</span>
            val close = <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse.requestStart" title="akka.http.engine.parsing.ParserOutput.RequestStart">requestStart</a>.<a href="../parsing/ParserOutput.scala.html#akka.http.engine.parsing.ParserOutput;RequestStart.closeAfterResponseCompletion" title="=&gt; Boolean">closeAfterResponseCompletion</a> <a title="Boolean" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse.$anonfun.close">||</a> <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse.requestStart" title="akka.http.engine.parsing.ParserOutput.RequestStart">requestStart</a>.<a href="../parsing/ParserOutput.scala.html#akka.http.engine.parsing.ParserOutput;RequestStart.expect100ContinueResponsePending" title="=&gt; Boolean">expect100ContinueResponsePending</a>
            <span title="this.MergeLogicContext">ctx</span>.<a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic;MergeLogicContext.emit" title="(elem: akka.http.engine.rendering.ResponseRenderingContext)Unit">emit</a><span class="delimiter">(</span><a href="../rendering/HttpResponseRendererFactory.scala.html#akka.http.engine.rendering;ResponseRenderingContext" title="(response: akka.http.model.HttpResponse, requestMethod: akka.http.model.HttpMethod, requestProtocol: akka.http.model.HttpProtocol, closeAfterResponseCompletion: Boolean)akka.http.engine.rendering.ResponseRenderingContext">ResponseRenderingContext</a><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse.$anonfun.response" title="akka.http.model.HttpResponse">response</a>, <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse.requestStart" title="akka.http.engine.parsing.ParserOutput.RequestStart">requestStart</a>.<a href="../parsing/ParserOutput.scala.html#akka.http.engine.parsing.ParserOutput;RequestStart.method" title="=&gt; akka.http.model.HttpMethod">method</a>, <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse.requestStart" title="akka.http.engine.parsing.ParserOutput.RequestStart">requestStart</a>.<a href="../parsing/ParserOutput.scala.html#akka.http.engine.parsing.ParserOutput;RequestStart.protocol" title="=&gt; akka.http.model.HttpProtocol">protocol</a>, <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse.$anonfun.close" title="Boolean">close</a><span class="delimiter">)</span><span class="delimiter">)</span>
            if <span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse.$anonfun.close" title="Boolean">close</a><span class="delimiter">)</span> <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finish" title="(ctx: this.MergeLogicContext)this.State[Any]">finish</a><span class="delimiter">(</span><span title="this.MergeLogicContext">ctx</span><span class="delimiter">)</span> else <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.initialState" title="=&gt; this.State[Any]">initialState</a>

          case <span class="delimiter">(</span><span title="this.MergeLogicContext">ctx</span>, _, <a href="OneHundredContinue.scala.html#akka.http.engine.server.OneHundredContinue" title="akka.http.engine.server.OneHundredContinue.type">OneHundredContinue</a><span class="delimiter">)</span> â‡’
            <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse.requestStart" title="akka.http.engine.parsing.ParserOutput.RequestStart">requestStart</a>.<a href="../parsing/ParserOutput.scala.html#akka.http.engine.parsing.ParserOutput;RequestStart.expect100ContinueResponsePending" title="=&gt; Boolean">expect100ContinueResponsePending</a><span class="delimiter">)</span>
            <span title="this.MergeLogicContext">ctx</span>.<a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic;MergeLogicContext.emit" title="(elem: akka.http.engine.rendering.ResponseRenderingContext)Unit">emit</a><span class="delimiter">(</span><a href="../rendering/HttpResponseRendererFactory.scala.html#akka.http.engine.rendering;ResponseRenderingContext" title="(response: akka.http.model.HttpResponse, requestMethod: akka.http.model.HttpMethod, requestProtocol: akka.http.model.HttpProtocol, closeAfterResponseCompletion: Boolean)akka.http.engine.rendering.ResponseRenderingContext">ResponseRenderingContext</a><span class="delimiter">(</span><a href="../../model/HttpMessage.scala.html#akka.http.model;HttpResponse" title="(status: akka.http.model.StatusCode, headers: scala.collection.immutable.Seq[akka.http.model.HttpHeader], entity: akka.http.model.ResponseEntity, protocol: akka.http.model.HttpProtocol)akka.http.model.HttpResponse">HttpResponse</a><span class="delimiter">(</span><a href="../../model/StatusCode.scala.html#akka.http.model.StatusCodes" title="akka.http.model.StatusCodes.type">StatusCodes</a>.<a href="../../model/StatusCode.scala.html#akka.http.model.StatusCodes.Continue" title="=&gt; akka.http.model.StatusCodes.Informational">Continue</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse" title="(requestStart: akka.http.engine.parsing.ParserOutput.RequestStart)this.State[Any]">waitingForApplicationResponse</a><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse.requestStart" title="akka.http.engine.parsing.ParserOutput.RequestStart">requestStart</a>.<a href="../parsing/ParserOutput.scala.html#akka.http.engine.parsing.ParserOutput;RequestStart.copy$default$1" title="akka.http.model.HttpMethod" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.waitingForApplicationResponse.$anonfun.x$12">copy</a><span class="delimiter">(</span>expect100ContinueResponsePending = false<span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      override def <a title="=&gt; this.CompletionHandling" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.initialCompletionHandling">initialCompletionHandling</a> = <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic;CompletionHandling" title="(onComplete: (this.MergeLogicContext, akka.stream.scaladsl.FlexiMerge.InputHandle) =&gt; this.State[_], onError: (this.MergeLogicContext, akka.stream.scaladsl.FlexiMerge.InputHandle, Throwable) =&gt; this.State[_])this.CompletionHandling">CompletionHandling</a><span class="delimiter">(</span>
        onComplete = <span class="delimiter">(</span><span title="this.MergeLogicContext">ctx</span>, <a title="akka.stream.scaladsl.FlexiMerge.InputHandle" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.initialCompletionHandling.$anonfun.x$5">_</a><span class="delimiter">)</span> â‡’ <span class="delimiter">{</span> <span title="this.MergeLogicContext">ctx</span>.<a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic;MergeLogicContext.complete" title="()Unit">complete</a><span class="delimiter">(</span><span class="delimiter">)</span>; <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic.SameState" title="this.State[Nothing]">SameState</a> <span class="delimiter">}</span>,
        onError = <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.initialCompletionHandling.$anonfun.x0$2" title="this.State[_105]" class="delimiter">{</a>
          case <span class="delimiter">(</span><span title="this.MergeLogicContext">ctx</span>, _, <span title="akka.http.Http.StreamException">error</span>: Http.<a href="../../Http.scala.html#akka.http.Http;StreamException" title="akka.http.Http.StreamException">StreamException</a><span class="delimiter">)</span> â‡’
            <span class="comment">// the application has forwarded a request entity stream error to the response stream</span>
            <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError" title="(ctx: this.MergeLogicContext, target: String, status: akka.http.model.StatusCode, info: akka.http.model.ErrorInfo)this.State[Any]">finishWithError</a><span class="delimiter">(</span><span title="this.MergeLogicContext">ctx</span>, <span title="String(&quot;request&quot;)" class="string">&quot;request&quot;</span>, <a href="../../model/StatusCode.scala.html#akka.http.model.StatusCodes" title="akka.http.model.StatusCodes.type">StatusCodes</a>.<a href="../../model/StatusCode.scala.html#akka.http.model.StatusCodes.BadRequest" title="=&gt; akka.http.model.StatusCodes.ClientError">BadRequest</a>, <span title="akka.http.Http.StreamException">error</span>.<a href="../../Http.scala.html#akka.http.Http;StreamException.info" title="=&gt; akka.http.model.ErrorInfo">info</a><span class="delimiter">)</span>
          case <span class="delimiter">(</span><span title="this.MergeLogicContext">ctx</span>, _, <span title="Throwable">error</span><span class="delimiter">)</span> â‡’
            <span title="this.MergeLogicContext">ctx</span>.<a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic;MergeLogicContext.error" title="(cause: Throwable)Unit">error</a><span class="delimiter">(</span><span title="Throwable">error</span><span class="delimiter">)</span>
            <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic.SameState" title="this.State[Nothing]">SameState</a>
        <span class="delimiter">}</span><span class="delimiter">)</span>

      def <a title="(ctx: this.MergeLogicContext, target: String, status: akka.http.model.StatusCode, info: akka.http.model.ErrorInfo)this.State[Any]" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError">finishWithError</a><span class="delimiter">(</span><a title="this.MergeLogicContext" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.ctx">ctx</a>: <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic;MergeLogicContext" title="this.MergeLogicContext">MergeLogicContext</a>, <a title="String" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.target">target</a>: <span title="String">String</span>, <a title="akka.http.model.StatusCode" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.status">status</a>: <a href="../../model/StatusCode.scala.html#akka.http.model;StatusCode" title="akka.http.model.StatusCode">StatusCode</a>, <a title="akka.http.model.ErrorInfo" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.info">info</a>: <a href="../../model/ErrorInfo.scala.html#akka.http.model;ErrorInfo" title="akka.http.model.ErrorInfo">ErrorInfo</a><span class="delimiter">)</span>: <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic;State" title="this.State[Any]">State</a><span class="delimiter">[</span>Any<span class="delimiter">]</span> = <span class="delimiter">{</span>
        <a href="#akka.http.engine.server.HttpServer;BypassMerge.log" title="akka.event.LoggingAdapter">log</a>.<span title="(template: String, arg1: Any, arg2: Any, arg3: Any)Unit">warning</span><span class="delimiter">(</span><span title="String(&quot;Illegal {}, responding with status \'{}\': {}&quot;)" class="string">&quot;Illegal {}, responding with status '{}': {}&quot;</span>, <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.target" title="String">target</a>, <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.status" title="akka.http.model.StatusCode">status</a>, <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.info" title="akka.http.model.ErrorInfo">info</a>.<a href="../../model/ErrorInfo.scala.html#akka.http.model;ErrorInfo.formatPretty" title="=&gt; String">formatPretty</a><span class="delimiter">)</span>
        val <a title="String" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.msg">msg</a> = if <span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer;BypassMerge.settings" title="akka.http.engine.server.ServerSettings">settings</a>.<a href="ServerSettings.scala.html#akka.http.engine.server;ServerSettings.verboseErrorMessages" title="=&gt; Boolean">verboseErrorMessages</a><span class="delimiter">)</span> <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.info" title="akka.http.model.ErrorInfo">info</a>.<a href="../../model/ErrorInfo.scala.html#akka.http.model;ErrorInfo.formatPretty" title="=&gt; String">formatPretty</a> else <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.info" title="akka.http.model.ErrorInfo">info</a>.<a href="../../model/ErrorInfo.scala.html#akka.http.model;ErrorInfo.summary" title="=&gt; String">summary</a>
        <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.ctx" title="this.MergeLogicContext">ctx</a>.<a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic;MergeLogicContext.emit" title="(elem: akka.http.engine.rendering.ResponseRenderingContext)Unit">emit</a><span class="delimiter">(</span><a href="../rendering/HttpResponseRendererFactory.scala.html#akka.http.engine.rendering.ResponseRenderingContext.apply$default$2" title="akka.http.model.HttpMethod" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.x$20">ResponseRenderingContext</a><span class="delimiter">(</span><a href="../../model/HttpMessage.scala.html#akka.http.model.HttpResponse.apply$default$2" title="scala.collection.immutable.Seq[akka.http.model.HttpHeader] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.x$17.x$16">HttpResponse</a><a title="akka.http.model.HttpResponse" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.x$17" class="delimiter">(</a><a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.status" title="akka.http.model.StatusCode" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.x$17.x$13">status</a>, entity = <a href="../../model/HttpEntity.scala.html#akka.http.model.HttpEntity.apply(53b9f636ea)" title="akka.http.model.HttpEntity.Strict" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.x$17.x$14">msg</a><span class="delimiter">)</span>, closeAfterResponseCompletion = true<span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finish" title="(ctx: this.MergeLogicContext)this.State[Any]">finish</a><span class="delimiter">(</span><a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finishWithError.ctx" title="this.MergeLogicContext">ctx</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      def <a title="(ctx: this.MergeLogicContext)this.State[Any]" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finish">finish</a><span class="delimiter">(</span><a title="this.MergeLogicContext" id="akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finish.ctx">ctx</a>: <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic;MergeLogicContext" title="this.MergeLogicContext">MergeLogicContext</a><span class="delimiter">)</span>: <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic;State" title="this.State[Any]">State</a><span class="delimiter">[</span>Any<span class="delimiter">]</span> = <span class="delimiter">{</span>
        <a href="#akka.http.engine.server.HttpServer;BypassMerge.createMergeLogic;$anon.finish.ctx" title="this.MergeLogicContext">ctx</a>.<a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic;MergeLogicContext.complete" title="()Unit">complete</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="comment">// shouldn't this return a `State` rather than `Unit`?</span>
        <a href="../../../stream/scaladsl/FlexiMerge.scala.html#akka.stream.scaladsl.FlexiMerge;MergeLogic.SameState" title="this.State[Any]">SameState</a> <span class="comment">// it seems weird to stay in the same state after completion</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

private<span class="delimiter">[</span>server<span class="delimiter">]</span> class <a title="class ErrorsTo500ResponseRecovery extends akka.stream.stage.PushPullStage[akka.http.engine.rendering.ResponseRenderingContext,akka.http.engine.rendering.ResponseRenderingContext]" id="akka.http.engine.server;ErrorsTo500ResponseRecovery">ErrorsTo500ResponseRecovery</a><a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery" title="akka.http.engine.server.ErrorsTo500ResponseRecovery" class="delimiter">(</a><a title="akka.event.LoggingAdapter" id="akka.http.engine.server;ErrorsTo500ResponseRecovery.log">log</a>: <span title="akka.event.LoggingAdapter">LoggingAdapter</span><span class="delimiter">)</span>
  extends <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;PushPullStage" title="akka.stream.stage.PushPullStage[akka.http.engine.rendering.ResponseRenderingContext,akka.http.engine.rendering.ResponseRenderingContext]">PushPullStage</a><span class="delimiter">[</span>ResponseRenderingContext, ResponseRenderingContext<span class="delimiter">]</span> <span class="delimiter">{</span>
  import akka.stream.stage.Context

  private<span class="delimiter">[</span>this<span class="delimiter">]</span> var <a title="akka.http.engine.rendering.ResponseRenderingContext" id="akka.http.engine.server;ErrorsTo500ResponseRecovery.errorResponse">errorResponse</a>: <a href="../rendering/HttpResponseRendererFactory.scala.html#akka.http.engine.rendering;ResponseRenderingContext" title="akka.http.engine.rendering.ResponseRenderingContext">ResponseRenderingContext</a> = _

  override def <a title="(elem: akka.http.engine.rendering.ResponseRenderingContext, ctx: akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext])akka.stream.stage.DownstreamDirective" id="akka.http.engine.server;ErrorsTo500ResponseRecovery.onPush">onPush</a><span class="delimiter">(</span><a title="akka.http.engine.rendering.ResponseRenderingContext" id="akka.http.engine.server;ErrorsTo500ResponseRecovery.onPush.elem">elem</a>: <a href="../rendering/HttpResponseRendererFactory.scala.html#akka.http.engine.rendering;ResponseRenderingContext" title="akka.http.engine.rendering.ResponseRenderingContext">ResponseRenderingContext</a>, <a title="akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext]" id="akka.http.engine.server;ErrorsTo500ResponseRecovery.onPush.ctx">ctx</a>: <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context" title="akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext]">Context</a><span class="delimiter">[</span>ResponseRenderingContext<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery.onPush.ctx" title="akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext]">ctx</a>.<a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context.push" title="(elem: akka.http.engine.rendering.ResponseRenderingContext)akka.stream.stage.DownstreamDirective">push</a><span class="delimiter">(</span><a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery.onPush.elem" title="akka.http.engine.rendering.ResponseRenderingContext">elem</a><span class="delimiter">)</span>

  override def <a title="(ctx: akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext])akka.stream.stage.Directive" id="akka.http.engine.server;ErrorsTo500ResponseRecovery.onPull">onPull</a><span class="delimiter">(</span><a title="akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext]" id="akka.http.engine.server;ErrorsTo500ResponseRecovery.onPull.ctx">ctx</a>: <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context" title="akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext]">Context</a><span class="delimiter">[</span>ResponseRenderingContext<span class="delimiter">]</span><span class="delimiter">)</span> =
    if <span class="delimiter">(</span><a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery.onPull.ctx" title="akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext]">ctx</a>.<a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context.isFinishing" title="=&gt; Boolean">isFinishing</a><span class="delimiter">)</span> <a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery.onPull.ctx" title="akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext]">ctx</a>.<a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context.pushAndFinish" title="(elem: akka.http.engine.rendering.ResponseRenderingContext)akka.stream.stage.DownstreamDirective">pushAndFinish</a><span class="delimiter">(</span><a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery.errorResponse" title="akka.http.engine.rendering.ResponseRenderingContext">errorResponse</a><span class="delimiter">)</span>
    else <a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery.onPull.ctx" title="akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext]">ctx</a>.<a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context.pull" title="()akka.stream.stage.UpstreamDirective">pull</a><span class="delimiter">(</span><span class="delimiter">)</span>

  override def <a title="(error: Throwable, ctx: akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext])akka.stream.stage.TerminationDirective" id="akka.http.engine.server;ErrorsTo500ResponseRecovery.onUpstreamFailure">onUpstreamFailure</a><span class="delimiter">(</span><a title="Throwable" id="akka.http.engine.server;ErrorsTo500ResponseRecovery.onUpstreamFailure.error">error</a>: <span title="Throwable">Throwable</span>, <a title="akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext]" id="akka.http.engine.server;ErrorsTo500ResponseRecovery.onUpstreamFailure.ctx">ctx</a>: <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context" title="akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext]">Context</a><span class="delimiter">[</span>ResponseRenderingContext<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery.onUpstreamFailure.error" title="Throwable">error</a> match <span class="delimiter">{</span>
      case <a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery.onUpstreamFailure.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="akka.http.engine.server;ErrorsTo500ResponseRecovery.onUpstreamFailure.e">e</a><span class="delimiter">)</span> â‡’
        <a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery.log" title="akka.event.LoggingAdapter">log</a>.<span title="(cause: Throwable, message: String)Unit">error</span><span class="delimiter">(</span><a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery.onUpstreamFailure.e" title="Throwable">e</a>, <span title="String(&quot;Internal server error, sending 500 response&quot;)" class="string">&quot;Internal server error, sending 500 response&quot;</span><span class="delimiter">)</span>
        <a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery.errorResponse" title="akka.http.engine.rendering.ResponseRenderingContext">errorResponse</a> = <a href="../rendering/HttpResponseRendererFactory.scala.html#akka.http.engine.rendering.ResponseRenderingContext.apply$default$2" title="akka.http.model.HttpMethod" id="akka.http.engine.server;ErrorsTo500ResponseRecovery.onUpstreamFailure.x$24">ResponseRenderingContext</a><span class="delimiter">(</span><a href="../../model/HttpMessage.scala.html#akka.http.model;HttpResponse" title="(status: akka.http.model.StatusCode, headers: scala.collection.immutable.Seq[akka.http.model.HttpHeader], entity: akka.http.model.ResponseEntity, protocol: akka.http.model.HttpProtocol)akka.http.model.HttpResponse">HttpResponse</a><a title="akka.http.model.HttpResponse" id="akka.http.engine.server;ErrorsTo500ResponseRecovery.onUpstreamFailure.x$21" class="delimiter">(</a><a href="../../model/StatusCode.scala.html#akka.http.model.StatusCodes" title="akka.http.model.StatusCodes.type">StatusCodes</a>.<a href="../../model/StatusCode.scala.html#akka.http.model.StatusCodes.InternalServerError" title="=&gt; akka.http.model.StatusCodes.ServerError">InternalServerError</a><span class="delimiter">)</span>,
          closeAfterResponseCompletion = true<span class="delimiter">)</span>
        <a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery.onUpstreamFailure.ctx" title="akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext]">ctx</a>.<a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context.absorbTermination" title="()akka.stream.stage.TerminationDirective">absorbTermination</a><span class="delimiter">(</span><span class="delimiter">)</span>
      case _ â‡’ <a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery.onUpstreamFailure.ctx" title="akka.stream.stage.Context[akka.http.engine.rendering.ResponseRenderingContext]">ctx</a>.<a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context.fail" title="(cause: Throwable)akka.stream.stage.FreeDirective">fail</a><span class="delimiter">(</span><a href="#akka.http.engine.server;ErrorsTo500ResponseRecovery.onUpstreamFailure.error" title="Throwable">error</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>
