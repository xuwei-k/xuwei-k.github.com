<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>akka/http/engine/rendering/RenderSupport.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

package akka.http.engine.rendering

import akka.parboiled2.CharUtils
import akka.stream.impl.ActorBasedFlowMaterializer
import akka.util.ByteString
import akka.event.LoggingAdapter
import akka.stream.scaladsl._
import akka.stream.stage._
import akka.http.model._
import akka.http.util._
import org.reactivestreams.Subscriber

<span class="comment">/**
 * INTERNAL API
 */</span>
private object <a title="akka.http.engine.rendering.RenderSupport.type" id="akka.http.engine.rendering.RenderSupport">RenderSupport</a> <a href="#akka.http.engine.rendering.RenderSupport" title="akka.http.engine.rendering.RenderSupport.type" class="delimiter">{</a>
  val <a title="Array[Byte]" id="akka.http.engine.rendering.RenderSupport.DefaultStatusLineBytes">DefaultStatusLineBytes</a> = <a href="../../util/package.scala.html#akka.http.util.package.enhanceString_" title="implicit akka.http.util.package.enhanceString_ : (s: String)akka.http.util.EnhancedString" class="string">&quot;HTTP/1.1 200 OK\r\n&quot;</a>.<a href="../../util/EnhancedString.scala.html#akka.http.util;EnhancedString.asciiBytes" title="=&gt; Array[Byte]">asciiBytes</a>
  val <a title="Array[Byte]" id="akka.http.engine.rendering.RenderSupport.StatusLineStartBytes">StatusLineStartBytes</a> = <a href="../../util/package.scala.html#akka.http.util.package.enhanceString_" title="implicit akka.http.util.package.enhanceString_ : (s: String)akka.http.util.EnhancedString" class="string">&quot;HTTP/1.1 &quot;</a>.<a href="../../util/EnhancedString.scala.html#akka.http.util;EnhancedString.asciiBytes" title="=&gt; Array[Byte]">asciiBytes</a>
  val <a title="Array[Byte]" id="akka.http.engine.rendering.RenderSupport.ChunkedBytes">ChunkedBytes</a> = <a href="../../util/package.scala.html#akka.http.util.package.enhanceString_" title="implicit akka.http.util.package.enhanceString_ : (s: String)akka.http.util.EnhancedString" class="string">&quot;chunked&quot;</a>.<a href="../../util/EnhancedString.scala.html#akka.http.util;EnhancedString.asciiBytes" title="=&gt; Array[Byte]">asciiBytes</a>
  val <a title="Array[Byte]" id="akka.http.engine.rendering.RenderSupport.KeepAliveBytes">KeepAliveBytes</a> = <a href="../../util/package.scala.html#akka.http.util.package.enhanceString_" title="implicit akka.http.util.package.enhanceString_ : (s: String)akka.http.util.EnhancedString" class="string">&quot;Keep-Alive&quot;</a>.<a href="../../util/EnhancedString.scala.html#akka.http.util;EnhancedString.asciiBytes" title="=&gt; Array[Byte]">asciiBytes</a>
  val <a title="Array[Byte]" id="akka.http.engine.rendering.RenderSupport.CloseBytes">CloseBytes</a> = <a href="../../util/package.scala.html#akka.http.util.package.enhanceString_" title="implicit akka.http.util.package.enhanceString_ : (s: String)akka.http.util.EnhancedString" class="string">&quot;close&quot;</a>.<a href="../../util/EnhancedString.scala.html#akka.http.util;EnhancedString.asciiBytes" title="=&gt; Array[Byte]">asciiBytes</a>

  def <a title="=&gt; akka.http.util.Rendering.CrLf.type" id="akka.http.engine.rendering.RenderSupport.CrLf">CrLf</a> = <a href="../../util/Rendering.scala.html#akka.http.util.Rendering" title="akka.http.util.Rendering.type">Rendering</a>.<a href="../../util/Rendering.scala.html#akka.http.util.Rendering.CrLf" title="akka.http.util.Rendering.CrLf.type">CrLf</a>

  implicit val <a title="akka.http.util.Renderer[scala.collection.immutable.Seq[akka.http.model.HttpHeader]]" id="akka.http.engine.rendering.RenderSupport.trailerRenderer">trailerRenderer</a> = <a href="../../util/Rendering.scala.html#akka.http.util.Renderer" title="akka.http.util.Renderer.type">Renderer</a>.<a href="../../util/Rendering.scala.html#akka.http.util.Renderer.genericSeqRenderer" title="[S, T](separator: S, empty: S)(implicit sRenderer: akka.http.util.Renderer[S], implicit tRenderer: akka.http.util.Renderer[T])akka.http.util.Renderer[scala.collection.immutable.Seq[T]]">genericSeqRenderer</a><span title="(separator: akka.http.util.Renderable, empty: akka.http.util.Renderable)(implicit sRenderer: akka.http.util.Renderer[akka.http.util.Renderable], implicit tRenderer: akka.http.util.Renderer[akka.http.model.HttpHeader])akka.http.util.Renderer[scala.collection.immutable.Seq[akka.http.model.HttpHeader]]" class="delimiter">[</span><a href="../../util/Rendering.scala.html#akka.http.util;Renderable" title="akka.http.util.Renderable">Renderable</a>, <a href="../../model/HttpHeader.scala.html#akka.http.model;HttpHeader" title="akka.http.model.HttpHeader">HttpHeader</a><span class="delimiter">]</span><a href="../../util/Rendering.scala.html#akka.http.util.Renderer.renderableRenderer" title="akka.http.util.Renderer[akka.http.util.Renderable]" class="delimiter">(</a><a href="#akka.http.engine.rendering.RenderSupport.CrLf" title="=&gt; akka.http.util.Rendering.CrLf.type">CrLf</a>, <a href="../../util/Rendering.scala.html#akka.http.util.Rendering" title="akka.http.util.Rendering.type">Rendering</a>.<a href="../../util/Rendering.scala.html#akka.http.util.Rendering.Empty" title="akka.http.util.Rendering.Empty.type">Empty</a><span class="delimiter">)</span>

  val <a title="akka.util.ByteString" id="akka.http.engine.rendering.RenderSupport.defaultLastChunkBytes">defaultLastChunkBytes</a>: <span title="akka.util.ByteString">ByteString</span> = <a href="#akka.http.engine.rendering.RenderSupport.renderChunk" title="(chunk: akka.http.model.HttpEntity.ChunkStreamPart)akka.util.ByteString">renderChunk</a><span class="delimiter">(</span><a href="../../model/HttpEntity.scala.html#akka.http.model.HttpEntity" title="akka.http.model.HttpEntity.type">HttpEntity</a>.<a href="../../model/HttpEntity.scala.html#akka.http.model.HttpEntity.LastChunk" title="akka.http.model.HttpEntity.LastChunk.type">LastChunk</a><span class="delimiter">)</span>

  <span class="comment">// This hooks into the materialization to cancel the not needed second source. This helper class</span>
  <span class="comment">// allows us to not take a FlowMaterializer but delegate the cancellation to the point when the whole stream</span>
  <span class="comment">// materializes</span>
  private case class <a href="#akka.http.engine.rendering.RenderSupport;CancelSecond.productElement.x$1" title="class CancelSecond[T] extends AnyRef with akka.stream.scaladsl.SimpleActorFlowSource[T] with Product with Serializable" id="akka.http.engine.rendering.RenderSupport.CancelSecond.readResolve">CancelSecond</a><span class="delimiter">[</span><a title="" id="akka.http.engine.rendering.RenderSupport;CancelSecond;T">T</a><span class="delimiter">]</span><span title="Product" class="delimiter">(</span><a title="akka.stream.scaladsl.Source[T]" id="akka.http.engine.rendering.RenderSupport;CancelSecond.first">first</a>: <a href="../../../stream/scaladsl/Source.scala.html#akka.stream.scaladsl;Source" title="akka.stream.scaladsl.Source[T]">Source</a><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="akka.stream.scaladsl.Source[T]" id="akka.http.engine.rendering.RenderSupport;CancelSecond.second">second</a>: <a href="../../../stream/scaladsl/Source.scala.html#akka.stream.scaladsl;Source" title="akka.stream.scaladsl.Source[T]">Source</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> extends <a href="../../../stream/scaladsl/ActorFlowSource.scala.html#akka.stream.scaladsl;SimpleActorFlowSource" title="akka.stream.scaladsl.SimpleActorFlowSource[T]">SimpleActorFlowSource</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">{</span>
    override def <a title="(flowSubscriber: org.reactivestreams.Subscriber[T], materializer: akka.stream.impl.ActorBasedFlowMaterializer, flowName: String)Unit" id="akka.http.engine.rendering.RenderSupport;CancelSecond.attach">attach</a><span class="delimiter">(</span><a title="org.reactivestreams.Subscriber[T]" id="akka.http.engine.rendering.RenderSupport;CancelSecond.attach.flowSubscriber">flowSubscriber</a>: <span title="org.reactivestreams.Subscriber[T]">Subscriber</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="akka.stream.impl.ActorBasedFlowMaterializer" id="akka.http.engine.rendering.RenderSupport;CancelSecond.attach.materializer">materializer</a>: <a href="../../../stream/impl/ActorBasedFlowMaterializer.scala.html#akka.stream.impl;ActorBasedFlowMaterializer" title="akka.stream.impl.ActorBasedFlowMaterializer">ActorBasedFlowMaterializer</a>, <a title="String" id="akka.http.engine.rendering.RenderSupport;CancelSecond.attach.flowName">flowName</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
      <a href="#akka.http.engine.rendering.RenderSupport;CancelSecond.first" title="=&gt; akka.stream.scaladsl.Source[T]">first</a>.<a href="../../../stream/scaladsl/Source.scala.html#akka.stream.scaladsl;Source.to" title="(sink: akka.stream.scaladsl.Sink[T])akka.stream.scaladsl.RunnableFlow">to</a><span class="delimiter">(</span><a href="../../../stream/scaladsl/Sink.scala.html#akka.stream.scaladsl.Sink.apply(530e3873da)" title="(subscriber: org.reactivestreams.Subscriber[T])akka.stream.scaladsl.Sink[T]">Sink</a><span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport;CancelSecond.attach.flowSubscriber" title="org.reactivestreams.Subscriber[T]">flowSubscriber</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;RunnableFlow.run" title="()(implicit materializer: akka.stream.FlowMaterializer)akka.stream.scaladsl.MaterializedMap">run</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport;CancelSecond.attach.materializer" title="akka.stream.impl.ActorBasedFlowMaterializer">materializer</a><span class="delimiter">)</span>
      <a href="#akka.http.engine.rendering.RenderSupport;CancelSecond.second" title="=&gt; akka.stream.scaladsl.Source[T]">second</a>.<a href="../../../stream/scaladsl/Source.scala.html#akka.stream.scaladsl;Source.to" title="(sink: akka.stream.scaladsl.Sink[T])akka.stream.scaladsl.RunnableFlow">to</a><span class="delimiter">(</span><a href="../../../stream/scaladsl/Sink.scala.html#akka.stream.scaladsl.Sink" title="akka.stream.scaladsl.Sink.type">Sink</a>.<a href="../../../stream/scaladsl/Sink.scala.html#akka.stream.scaladsl.Sink.cancelled" title="akka.stream.scaladsl.Sink[Any]">cancelled</a><span class="delimiter">)</span>.<a href="../../../stream/scaladsl/Flow.scala.html#akka.stream.scaladsl;RunnableFlow.run" title="()(implicit materializer: akka.stream.FlowMaterializer)akka.stream.scaladsl.MaterializedMap">run</a><span class="delimiter">(</span><span class="delimiter">)</span><span title="Unit" class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport;CancelSecond.attach.materializer" title="akka.stream.impl.ActorBasedFlowMaterializer">materializer</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(r: akka.http.util.Rendering, entity: akka.http.model.HttpEntity)akka.http.util.Rendering" id="akka.http.engine.rendering.RenderSupport.renderEntityContentType">renderEntityContentType</a><span class="delimiter">(</span><a title="akka.http.util.Rendering" id="akka.http.engine.rendering.RenderSupport.renderEntityContentType.r">r</a>: <a href="../../util/Rendering.scala.html#akka.http.util;Rendering" title="akka.http.util.Rendering">Rendering</a>, <a title="akka.http.model.HttpEntity" id="akka.http.engine.rendering.RenderSupport.renderEntityContentType.entity">entity</a>: <a href="../../model/HttpEntity.scala.html#akka.http.model;HttpEntity" title="akka.http.model.HttpEntity">HttpEntity</a><span class="delimiter">)</span> =
    if <span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport.renderEntityContentType.entity" title="akka.http.model.HttpEntity">entity</a>.<a href="../../model/HttpEntity.scala.html#akka.http.model;HttpEntity.contentType" title="()akka.http.model.ContentType">contentType</a> <span title="(x$1: Any)Boolean">!=</span> <a href="../../model/ContentType.scala.html#akka.http.model.ContentTypes" title="akka.http.model.ContentTypes.type">ContentTypes</a>.<a href="../../model/ContentType.scala.html#akka.http.model.ContentTypes.NoContentType" title="=&gt; akka.http.model.ContentType">NoContentType</a><span class="delimiter">)</span> <a href="#akka.http.engine.rendering.RenderSupport.renderEntityContentType.r" title="akka.http.util.Rendering">r</a> <a href="../../util/Rendering.scala.html#akka.http.util;Rendering.~~(f8b31a61d8)" title="(value: akka.http.model.headers.Content-Type.type)(implicit ev: akka.http.util.Renderer[akka.http.model.headers.Content-Type.type])r.type">~~</a> headers.<a href="../../model/headers/headers.scala.html#akka.http.model.headers.Content-Type" title="akka.http.model.headers.Content-Type.type">`Content-Type`</a> <a href="../../util/Rendering.scala.html#akka.http.util;Rendering.~~(f8b31a61d8)" title="(value: akka.http.model.ContentType)(implicit ev: akka.http.util.Renderer[akka.http.model.ContentType])r.type">~~</a> <a href="#akka.http.engine.rendering.RenderSupport.renderEntityContentType.entity" title="akka.http.model.HttpEntity">entity</a>.<a href="../../model/HttpEntity.scala.html#akka.http.model;HttpEntity.contentType" title="()akka.http.model.ContentType">contentType</a> <a href="../../util/Rendering.scala.html#akka.http.util;Rendering.~~(f8b31a61d8)" title="(value: akka.http.util.Rendering.CrLf.type)(implicit ev: akka.http.util.Renderer[akka.http.util.Rendering.CrLf.type])r.type">~~</a> <a href="#akka.http.engine.rendering.RenderSupport.CrLf" title="=&gt; akka.http.util.Rendering.CrLf.type">CrLf</a>
    else <a href="#akka.http.engine.rendering.RenderSupport.renderEntityContentType.r" title="akka.http.util.Rendering">r</a>

  def <a title="(r: akka.http.util.ByteStringRendering, entityBytes: =&gt; akka.stream.scaladsl.Source[akka.util.ByteString], skipEntity: Boolean)akka.stream.scaladsl.Source[akka.util.ByteString]" id="akka.http.engine.rendering.RenderSupport.renderByteStrings">renderByteStrings</a><span class="delimiter">(</span><a title="akka.http.util.ByteStringRendering" id="akka.http.engine.rendering.RenderSupport.renderByteStrings.r">r</a>: <a href="../../util/Rendering.scala.html#akka.http.util;ByteStringRendering" title="akka.http.util.ByteStringRendering">ByteStringRendering</a>, <a title="=&gt; akka.stream.scaladsl.Source[akka.util.ByteString]" id="akka.http.engine.rendering.RenderSupport.renderByteStrings.entityBytes">entityBytes</a>: ⇒ Source<span class="delimiter">[</span>ByteString<span class="delimiter">]</span>,
                        <a title="Boolean" id="akka.http.engine.rendering.RenderSupport.renderByteStrings$default$3">skipEntity</a>: <span title="Boolean">Boolean</span> = false<span class="delimiter">)</span>: <a href="../../../stream/scaladsl/Source.scala.html#akka.stream.scaladsl;Source" title="akka.stream.scaladsl.Source[akka.util.ByteString]">Source</a><span class="delimiter">[</span>ByteString<span class="delimiter">]</span> = <span class="delimiter">{</span>
    val <a title="akka.stream.scaladsl.Source[akka.util.ByteString]" id="akka.http.engine.rendering.RenderSupport.renderByteStrings.messageStart">messageStart</a> = <a href="../../../stream/scaladsl/Source.scala.html#akka.stream.scaladsl.Source" title="akka.stream.scaladsl.Source.type">Source</a>.<a href="../../../stream/scaladsl/Source.scala.html#akka.stream.scaladsl.Source.singleton" title="(element: akka.util.ByteString)akka.stream.scaladsl.Source[akka.util.ByteString]">singleton</a><span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport.renderByteStrings.r" title="akka.http.util.ByteStringRendering">r</a>.<a href="../../util/Rendering.scala.html#akka.http.util;ByteStringRendering.get" title="=&gt; akka.util.ByteString">get</a><span class="delimiter">)</span>
    val <a title="akka.stream.scaladsl.Source[akka.util.ByteString]" id="akka.http.engine.rendering.RenderSupport.renderByteStrings.messageBytes">messageBytes</a> =
      if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.http.engine.rendering.RenderSupport.renderByteStrings$default$3" title="Boolean">skipEntity</a><span class="delimiter">)</span> <a href="#akka.http.engine.rendering.RenderSupport.renderByteStrings.messageStart" title="akka.stream.scaladsl.Source[akka.util.ByteString]">messageStart</a> <a href="../../../stream/scaladsl/Source.scala.html#akka.stream.scaladsl;Source.++" title="(second: akka.stream.scaladsl.Source[akka.util.ByteString])akka.stream.scaladsl.Source[akka.util.ByteString]">++</a> <a href="#akka.http.engine.rendering.RenderSupport.renderByteStrings.entityBytes" title="=&gt; akka.stream.scaladsl.Source[akka.util.ByteString]">entityBytes</a>
      else <a href="#akka.http.engine.rendering.RenderSupport.CancelSecond.readResolve" title="(first: akka.stream.scaladsl.Source[akka.util.ByteString], second: akka.stream.scaladsl.Source[akka.util.ByteString])akka.http.engine.rendering.RenderSupport.CancelSecond[akka.util.ByteString]">CancelSecond</a><span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport.renderByteStrings.messageStart" title="akka.stream.scaladsl.Source[akka.util.ByteString]">messageStart</a>, <a href="#akka.http.engine.rendering.RenderSupport.renderByteStrings.entityBytes" title="=&gt; akka.stream.scaladsl.Source[akka.util.ByteString]">entityBytes</a><span class="delimiter">)</span>
    <a href="#akka.http.engine.rendering.RenderSupport.renderByteStrings.messageBytes" title="akka.stream.scaladsl.Source[akka.util.ByteString]">messageBytes</a>
  <span class="delimiter">}</span>

  class <a title="class ChunkTransformer extends akka.stream.stage.StatefulStage[akka.http.model.HttpEntity.ChunkStreamPart,akka.util.ByteString]" id="akka.http.engine.rendering.RenderSupport;ChunkTransformer">ChunkTransformer</a> extends <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;StatefulStage" title="akka.stream.stage.StatefulStage[akka.http.model.HttpEntity.ChunkStreamPart,akka.util.ByteString]">StatefulStage</a><span class="delimiter">[</span>HttpEntity.ChunkStreamPart, ByteString<span class="delimiter">]</span> <span class="delimiter">{</span>
    var <a title="Boolean" id="akka.http.engine.rendering.RenderSupport;ChunkTransformer.lastChunkSeen_=">lastChunkSeen</a> = false

    override def <a title="=&gt; ChunkTransformer.this.State" id="akka.http.engine.rendering.RenderSupport;ChunkTransformer.initial">initial</a> = new <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;StatefulStage;State" title="&lt;$anon: ChunkTransformer.this.State&gt; extends ChunkTransformer.this.State" id="akka.http.engine.rendering.RenderSupport;ChunkTransformer.initial;$anon">State</a> <span class="delimiter">{</span>
      override def <a title="(chunk: akka.http.model.HttpEntity.ChunkStreamPart, ctx: akka.stream.stage.Context[akka.util.ByteString])akka.stream.stage.Directive" id="akka.http.engine.rendering.RenderSupport;ChunkTransformer.initial;$anon.onPush">onPush</a><span class="delimiter">(</span><a title="akka.http.model.HttpEntity.ChunkStreamPart" id="akka.http.engine.rendering.RenderSupport;ChunkTransformer.initial;$anon.onPush.chunk">chunk</a>: HttpEntity.<a href="../../model/HttpEntity.scala.html#akka.http.model.HttpEntity;ChunkStreamPart" title="akka.http.model.HttpEntity.ChunkStreamPart">ChunkStreamPart</a>, <a title="akka.stream.stage.Context[akka.util.ByteString]" id="akka.http.engine.rendering.RenderSupport;ChunkTransformer.initial;$anon.onPush.ctx">ctx</a>: <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context" title="akka.stream.stage.Context[akka.util.ByteString]">Context</a><span class="delimiter">[</span>ByteString<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Directive" title="akka.stream.stage.Directive">Directive</a> = <span class="delimiter">{</span>
        if <span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport;ChunkTransformer.initial;$anon.onPush.chunk" title="akka.http.model.HttpEntity.ChunkStreamPart">chunk</a>.<a href="../../model/HttpEntity.scala.html#akka.http.model.HttpEntity;ChunkStreamPart.isLastChunk" title="()Boolean">isLastChunk</a><span class="delimiter">)</span>
          <a href="#akka.http.engine.rendering.RenderSupport;ChunkTransformer.lastChunkSeen_=" title="(x$1: Boolean)Unit">lastChunkSeen</a> = true
        <a href="#akka.http.engine.rendering.RenderSupport;ChunkTransformer.initial;$anon.onPush.ctx" title="akka.stream.stage.Context[akka.util.ByteString]">ctx</a>.<a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context.push" title="(elem: akka.util.ByteString)akka.stream.stage.DownstreamDirective">push</a><span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport.renderChunk" title="(chunk: akka.http.model.HttpEntity.ChunkStreamPart)akka.util.ByteString">renderChunk</a><span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport;ChunkTransformer.initial;$anon.onPush.chunk" title="akka.http.model.HttpEntity.ChunkStreamPart">chunk</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    override def <a title="(ctx: akka.stream.stage.Context[akka.util.ByteString])akka.stream.stage.TerminationDirective" id="akka.http.engine.rendering.RenderSupport;ChunkTransformer.onUpstreamFinish">onUpstreamFinish</a><span class="delimiter">(</span><a title="akka.stream.stage.Context[akka.util.ByteString]" id="akka.http.engine.rendering.RenderSupport;ChunkTransformer.onUpstreamFinish.ctx">ctx</a>: <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context" title="akka.stream.stage.Context[akka.util.ByteString]">Context</a><span class="delimiter">[</span>ByteString<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;TerminationDirective" title="akka.stream.stage.TerminationDirective">TerminationDirective</a> =
      if <span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport;ChunkTransformer.lastChunkSeen_=" title="=&gt; Boolean">lastChunkSeen</a><span class="delimiter">)</span> super.<a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;StatefulStage.onUpstreamFinish" title="(ctx: akka.stream.stage.Context[akka.util.ByteString])akka.stream.stage.TerminationDirective">onUpstreamFinish</a><span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport;ChunkTransformer.onUpstreamFinish.ctx" title="akka.stream.stage.Context[akka.util.ByteString]">ctx</a><span class="delimiter">)</span>
      else <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;StatefulStage.terminationEmit(6a279f2ca5)" title="(iter: Iterator[akka.util.ByteString], ctx: akka.stream.stage.Context[akka.util.ByteString])akka.stream.stage.TerminationDirective">terminationEmit</a><span class="delimiter">(</span><span title="=&gt; collection.Iterator.type">Iterator</span>.<span title="(elem: akka.util.ByteString)Iterator[akka.util.ByteString]">single</span><span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport.defaultLastChunkBytes" title="=&gt; akka.util.ByteString">defaultLastChunkBytes</a><span class="delimiter">)</span>, <a href="#akka.http.engine.rendering.RenderSupport;ChunkTransformer.onUpstreamFinish.ctx" title="akka.stream.stage.Context[akka.util.ByteString]">ctx</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  class <a title="class CheckContentLengthTransformer extends akka.stream.stage.PushStage[akka.util.ByteString,akka.util.ByteString]" id="akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer">CheckContentLengthTransformer</a><a href="#akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer" title="akka.http.engine.rendering.RenderSupport.CheckContentLengthTransformer" class="delimiter">(</a><a title="Long" id="akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.length">length</a>: <span title="Long">Long</span><span class="delimiter">)</span> extends <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;PushStage" title="akka.stream.stage.PushStage[akka.util.ByteString,akka.util.ByteString]">PushStage</a><span class="delimiter">[</span>ByteString, ByteString<span class="delimiter">]</span> <span class="delimiter">{</span>
    var <a title="Long" id="akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.sent_=">sent</a> = <span title="Long(0L)" class="long">0L</span>

    override def <a title="(elem: akka.util.ByteString, ctx: akka.stream.stage.Context[akka.util.ByteString])akka.stream.stage.Directive" id="akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.onPush">onPush</a><span class="delimiter">(</span><a title="akka.util.ByteString" id="akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.onPush.elem">elem</a>: <span title="akka.util.ByteString">ByteString</span>, <a title="akka.stream.stage.Context[akka.util.ByteString]" id="akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.onPush.ctx">ctx</a>: <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context" title="akka.stream.stage.Context[akka.util.ByteString]">Context</a><span class="delimiter">[</span>ByteString<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Directive" title="akka.stream.stage.Directive">Directive</a> = <span class="delimiter">{</span>
      <a href="#akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.sent_=" title="(x$1: Long)Unit">sent</a> <span title="(x: Int)Long">+=</span> <a href="#akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.onPush.elem" title="akka.util.ByteString">elem</a>.<span title="=&gt; Int">length</span>
      if <span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.sent_=" title="=&gt; Long">sent</a> <span title="(x: Long)Boolean">&gt;</span> <a href="#akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.length" title="Long">length</a><span class="delimiter">)</span>
        throw new <a href="../../model/ErrorInfo.scala.html#akka.http.model;InvalidContentLengthException" title="akka.http.model.InvalidContentLengthException">InvalidContentLengthException</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;HTTP message had declared Content-Length &quot;)">HTTP message had declared Content-Length $</span><a href="#akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.length" title="Long">length</a><span title="String(&quot; but entity data stream amounts to more bytes&quot;)" class="string"> but entity data stream amounts to more bytes&quot;</span><span class="delimiter">)</span>
      <a href="#akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.onPush.ctx" title="akka.stream.stage.Context[akka.util.ByteString]">ctx</a>.<a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context.push" title="(elem: akka.util.ByteString)akka.stream.stage.DownstreamDirective">push</a><span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.onPush.elem" title="akka.util.ByteString">elem</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    override def <a title="(ctx: akka.stream.stage.Context[akka.util.ByteString])akka.stream.stage.TerminationDirective" id="akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.onUpstreamFinish">onUpstreamFinish</a><span class="delimiter">(</span><a title="akka.stream.stage.Context[akka.util.ByteString]" id="akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.onUpstreamFinish.ctx">ctx</a>: <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context" title="akka.stream.stage.Context[akka.util.ByteString]">Context</a><span class="delimiter">[</span>ByteString<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;TerminationDirective" title="akka.stream.stage.TerminationDirective">TerminationDirective</a> = <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.sent_=" title="=&gt; Long">sent</a> <span title="(x: Long)Boolean">&lt;</span> <a href="#akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.length" title="Long">length</a><span class="delimiter">)</span>
        throw new <a href="../../model/ErrorInfo.scala.html#akka.http.model;InvalidContentLengthException" title="akka.http.model.InvalidContentLengthException">InvalidContentLengthException</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;HTTP message had declared Content-Length &quot;)">HTTP message had declared Content-Length $</span><a href="#akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.length" title="Long">length</a><span title="String(&quot; but entity data stream amounts to &quot;)"> but entity data stream amounts to $</span><span class="delimiter">{</span><a href="#akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.length" title="Long">length</a> <span title="(x: Long)Long">-</span> <a href="#akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.sent_=" title="=&gt; Long">sent</a><span class="delimiter">}</span><span title="String(&quot; bytes less&quot;)" class="string"> bytes less&quot;</span><span class="delimiter">)</span>
      <a href="#akka.http.engine.rendering.RenderSupport;CheckContentLengthTransformer.onUpstreamFinish.ctx" title="akka.stream.stage.Context[akka.util.ByteString]">ctx</a>.<a href="../../../stream/stage/Stage.scala.html#akka.stream.stage;Context.finish" title="()akka.stream.stage.FreeDirective">finish</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  private def <a title="(chunk: akka.http.model.HttpEntity.ChunkStreamPart)akka.util.ByteString" id="akka.http.engine.rendering.RenderSupport.renderChunk">renderChunk</a><span class="delimiter">(</span><a title="akka.http.model.HttpEntity.ChunkStreamPart" id="akka.http.engine.rendering.RenderSupport.renderChunk.chunk">chunk</a>: HttpEntity.<a href="../../model/HttpEntity.scala.html#akka.http.model.HttpEntity;ChunkStreamPart" title="akka.http.model.HttpEntity.ChunkStreamPart">ChunkStreamPart</a><span class="delimiter">)</span>: <span title="akka.util.ByteString">ByteString</span> = <span class="delimiter">{</span>
    import <a href="#akka.http.engine.rendering.RenderSupport.renderChunk.chunk" title="akka.http.model.HttpEntity.ChunkStreamPart">chunk</a>._
    val renderedSize = <span class="comment">// buffer space required for rendering (without trailer)</span>
      <span title="akka.parboiled2.CharUtils.type">CharUtils</span>.<span title="(l: Long)Int">numberOfHexDigits</span><span class="delimiter">(</span><a href="../../model/HttpEntity.scala.html#akka.http.model.HttpEntity;ChunkStreamPart.data" title="()akka.util.ByteString">data</a>.<span title="=&gt; Long">length</span><span class="delimiter">)</span> <span title="(x: Int)Int">+</span>
        <span class="delimiter">(</span>if <span class="delimiter">(</span><a href="../../model/HttpEntity.scala.html#akka.http.model.HttpEntity;ChunkStreamPart.extension" title="()String">extension</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <span title="Int(0)" class="int">0</span> else <a href="../../model/HttpEntity.scala.html#akka.http.model.HttpEntity;ChunkStreamPart.extension" title="()String">extension</a>.<span title="()Int">length</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(x: Int)Int">+</span>
        <a href="../../model/HttpEntity.scala.html#akka.http.model.HttpEntity;ChunkStreamPart.data" title="()akka.util.ByteString">data</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">+</span>
        <span title="Int(2)" class="int">2</span> <a title="Int" id="akka.http.engine.rendering.RenderSupport.renderChunk.renderedSize">+</a> <span title="Int(2)" class="int">2</span>
    val <a title="akka.http.util.ByteStringRendering" id="akka.http.engine.rendering.RenderSupport.renderChunk.r">r</a> = new <a href="../../util/Rendering.scala.html#akka.http.util;ByteStringRendering" title="akka.http.util.ByteStringRendering">ByteStringRendering</a><span class="delimiter">(</span><a href="#akka.http.engine.rendering.RenderSupport.renderChunk.renderedSize" title="Int">renderedSize</a><span class="delimiter">)</span>
    <a href="#akka.http.engine.rendering.RenderSupport.renderChunk.r" title="akka.http.util.ByteStringRendering">r</a> <a href="../../util/Rendering.scala.html#akka.http.util;Rendering.~~%(a8e69143d0)" title="(i: Int)r.type">~~%</a> <a href="../../model/HttpEntity.scala.html#akka.http.model.HttpEntity;ChunkStreamPart.data" title="()akka.util.ByteString">data</a>.<span title="=&gt; Int">length</span>
    if <span class="delimiter">(</span><a href="../../model/HttpEntity.scala.html#akka.http.model.HttpEntity;ChunkStreamPart.extension" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">extension</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <a href="#akka.http.engine.rendering.RenderSupport.renderChunk.r" title="akka.http.util.ByteStringRendering">r</a> <a href="../../util/Rendering.scala.html#akka.http.util;ByteStringRendering.~~(63031d6399)" title="(char: Char)r.type">~~</a> <span title="Char(';')" class="char">';'</span> <a href="../../util/Rendering.scala.html#akka.http.util;Rendering.~~(ee0eda224f)" title="(string: String)r.type">~~</a> <a href="../../model/HttpEntity.scala.html#akka.http.model.HttpEntity;ChunkStreamPart.extension" title="()String">extension</a>
    <a href="#akka.http.engine.rendering.RenderSupport.renderChunk.r" title="akka.http.util.ByteStringRendering">r</a> <a href="../../util/Rendering.scala.html#akka.http.util;Rendering.~~(f8b31a61d8)" title="(value: akka.http.util.Rendering.CrLf.type)(implicit ev: akka.http.util.Renderer[akka.http.util.Rendering.CrLf.type])r.type">~~</a> <a href="#akka.http.engine.rendering.RenderSupport.CrLf" title="=&gt; akka.http.util.Rendering.CrLf.type">CrLf</a>
    <a href="#akka.http.engine.rendering.RenderSupport.renderChunk.chunk" title="akka.http.model.HttpEntity.ChunkStreamPart">chunk</a> match <span class="delimiter">{</span>
      case HttpEntity.Chunk<span class="delimiter">(</span><a title="akka.util.ByteString" id="akka.http.engine.rendering.RenderSupport.renderChunk.data">data</a>, _<span class="delimiter">)</span>        ⇒ <a href="#akka.http.engine.rendering.RenderSupport.renderChunk.r" title="akka.http.util.ByteStringRendering">r</a> <a href="../../util/Rendering.scala.html#akka.http.util;ByteStringRendering.~~(c1efd57e98)" title="(bytes: akka.util.ByteString)r.type">~~</a> <a href="#akka.http.engine.rendering.RenderSupport.renderChunk.data" title="akka.util.ByteString">data</a>
      case HttpEntity.LastChunk<span class="delimiter">(</span>_, <span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span>     ⇒ <span class="comment">// nothing to do</span>
      case HttpEntity.LastChunk<span class="delimiter">(</span>_, <a title="scala.collection.immutable.Seq[akka.http.model.HttpHeader]" id="akka.http.engine.rendering.RenderSupport.renderChunk.trailer">trailer</a><span class="delimiter">)</span> ⇒ <a href="#akka.http.engine.rendering.RenderSupport.renderChunk.r" title="akka.http.util.ByteStringRendering">r</a> <a href="../../util/Rendering.scala.html#akka.http.util;Rendering.~~(f8b31a61d8)" title="(value: scala.collection.immutable.Seq[akka.http.model.HttpHeader])(implicit ev: akka.http.util.Renderer[scala.collection.immutable.Seq[akka.http.model.HttpHeader]])r.type">~~</a> <a href="#akka.http.engine.rendering.RenderSupport.renderChunk.trailer" title="scala.collection.immutable.Seq[akka.http.model.HttpHeader]">trailer</a> <a href="../../util/Rendering.scala.html#akka.http.util;Rendering.~~(f8b31a61d8)" title="(value: akka.http.util.Rendering.CrLf.type)(implicit ev: akka.http.util.Renderer[akka.http.util.Rendering.CrLf.type])r.type">~~</a> <a href="#akka.http.engine.rendering.RenderSupport.CrLf" title="=&gt; akka.http.util.Rendering.CrLf.type">CrLf</a>
    <span class="delimiter">}</span>
    <a href="#akka.http.engine.rendering.RenderSupport.renderChunk.r" title="akka.http.util.ByteStringRendering">r</a> <a href="../../util/Rendering.scala.html#akka.http.util;Rendering.~~(f8b31a61d8)" title="(value: akka.http.util.Rendering.CrLf.type)(implicit ev: akka.http.util.Renderer[akka.http.util.Rendering.CrLf.type])r.type">~~</a> <a href="#akka.http.engine.rendering.RenderSupport.CrLf" title="=&gt; akka.http.util.Rendering.CrLf.type">CrLf</a>
    <a href="#akka.http.engine.rendering.RenderSupport.renderChunk.r" title="akka.http.util.ByteStringRendering">r</a>.<a href="../../util/Rendering.scala.html#akka.http.util;ByteStringRendering.get" title="=&gt; akka.util.ByteString">get</a>
  <span class="delimiter">}</span>

  def <a title="(log: akka.event.LoggingAdapter, h: akka.http.model.HttpHeader, msg: String)Unit" id="akka.http.engine.rendering.RenderSupport.suppressionWarning">suppressionWarning</a><span class="delimiter">(</span><a title="akka.event.LoggingAdapter" id="akka.http.engine.rendering.RenderSupport.suppressionWarning.log">log</a>: <span title="akka.event.LoggingAdapter">LoggingAdapter</span>, <a title="akka.http.model.HttpHeader" id="akka.http.engine.rendering.RenderSupport.suppressionWarning.h">h</a>: <a href="../../model/HttpHeader.scala.html#akka.http.model;HttpHeader" title="akka.http.model.HttpHeader">HttpHeader</a>,
                         <a title="String" id="akka.http.engine.rendering.RenderSupport.suppressionWarning$default$3">msg</a>: <span title="String">String</span> = <span title="String(&quot;the akka-http-core layer sets this header automatically!&quot;)" class="string">&quot;the akka-http-core layer sets this header automatically!&quot;</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.http.engine.rendering.RenderSupport.suppressionWarning.log" title="akka.event.LoggingAdapter">log</a>.<span title="(template: String, arg1: Any, arg2: Any)Unit">warning</span><span class="delimiter">(</span><span title="String(&quot;Explicitly set HTTP header \'{}\' is ignored, {}&quot;)" class="string">&quot;Explicitly set HTTP header '{}' is ignored, {}&quot;</span>, <a href="#akka.http.engine.rendering.RenderSupport.suppressionWarning.h" title="akka.http.model.HttpHeader">h</a>, <a href="#akka.http.engine.rendering.RenderSupport.suppressionWarning$default$3" title="String">msg</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
