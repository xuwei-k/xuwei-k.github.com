<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>akka/http/marshalling/Marshal.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

package akka.http.marshalling

import scala.concurrent.<span class="delimiter">{</span> ExecutionContext, Future <span class="delimiter">}</span>
import akka.http.util.FastFuture
import akka.http.model.<a href="../model/HttpCharset.scala.html#akka.http.model.HttpCharsets" title="akka.http.model.HttpCharsets.type">HttpCharsets</a>._
import akka.http.model._
import <a href="../util/FastFuture.scala.html#akka.http.util.FastFuture" title="akka.http.util.FastFuture.type">FastFuture</a>._

object <a title="akka.http.marshalling.Marshal.type" id="akka.http.marshalling.Marshal">Marshal</a> <a href="#akka.http.marshalling.Marshal" title="akka.http.marshalling.Marshal.type" class="delimiter">{</a>
  def <a title="[T](value: T)akka.http.marshalling.Marshal[T]" id="akka.http.marshalling.Marshal.apply">apply</a><span class="delimiter">[</span><a title="" id="akka.http.marshalling.Marshal.apply;T">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="T" id="akka.http.marshalling.Marshal.apply.value">value</a>: <a href="#akka.http.marshalling.Marshal.apply;T" title="T">T</a><span class="delimiter">)</span>: <a href="#akka.http.marshalling;Marshal" title="akka.http.marshalling.Marshal[T]">Marshal</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = new <a href="#akka.http.marshalling;Marshal" title="akka.http.marshalling.Marshal[T]">Marshal</a><span class="delimiter">(</span><a href="#akka.http.marshalling.Marshal.apply.value" title="T">value</a><span class="delimiter">)</span>

  case class <a title="class UnacceptableResponseContentTypeException extends RuntimeException with Product with Serializable" id="akka.http.marshalling.Marshal.UnacceptableResponseContentTypeException.readResolve">UnacceptableResponseContentTypeException</a><span title="Product" class="delimiter">(</span><a title="Set[akka.http.model.ContentType]" id="akka.http.marshalling.Marshal;UnacceptableResponseContentTypeException.supported">supported</a>: <span title="Set[akka.http.model.ContentType]">Set</span><span class="delimiter">[</span>ContentType<span class="delimiter">]</span><span class="delimiter">)</span> extends <a href="#akka.http.marshalling.Marshal.UnacceptableResponseContentTypeException.readResolve" title="RuntimeException">RuntimeException</a>

  private class <a title="class MarshallingWeight extends AnyRef" id="akka.http.marshalling.Marshal;MarshallingWeight">MarshallingWeight</a><a href="#akka.http.marshalling.Marshal;MarshallingWeight" title="akka.http.marshalling.Marshal.MarshallingWeight" class="delimiter">(</a>val <a title="Float" id="akka.http.marshalling.Marshal;MarshallingWeight.weight">weight</a>: <span title="Float">Float</span>, val <a title="() =&gt; akka.http.model.HttpResponse" id="akka.http.marshalling.Marshal;MarshallingWeight.marshal">marshal</a>: <span class="delimiter">(</span><span class="delimiter">)</span> ⇒ HttpResponse<span class="delimiter">)</span>
<a href="#akka.http.marshalling.Marshal;MarshallingWeight" title="AnyRef" class="delimiter">}</a>

class <a title="class Marshal[A] extends AnyRef" id="akka.http.marshalling;Marshal">Marshal</a><span class="delimiter">[</span><a title="" id="akka.http.marshalling;Marshal;A">A</a><span class="delimiter">]</span><a href="#akka.http.marshalling;Marshal" title="akka.http.marshalling.Marshal[A]" class="delimiter">(</a>val <a title="A" id="akka.http.marshalling;Marshal.value">value</a>: <a href="#akka.http.marshalling;Marshal;A" title="A">A</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="comment">/**
   * Marshals `value` using the first available [[Marshalling]] for `A` and `B` provided by the given [[Marshaller]].
   * If the marshalling is flexible with regard to the used charset `UTF-8` is chosen.
   */</span>
  def <a title="[B](implicit m: akka.http.marshalling.Marshaller[A,B], implicit ec: scala.concurrent.ExecutionContext)scala.concurrent.Future[B]" id="akka.http.marshalling;Marshal.to">to</a><span class="delimiter">[</span><a title="" id="akka.http.marshalling;Marshal.to;B">B</a><span class="delimiter">]</span><span class="delimiter">(</span>implicit <a title="akka.http.marshalling.Marshaller[A,B]" id="akka.http.marshalling;Marshal.to.m">m</a>: <a href="Marshaller.scala.html#akka.http.marshalling;Marshaller" title="akka.http.marshalling.Marshaller[A,B]">Marshaller</a><span class="delimiter">[</span>A, B<span class="delimiter">]</span>, <a title="scala.concurrent.ExecutionContext" id="akka.http.marshalling;Marshal.to.ec">ec</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[B]">Future</span><span class="delimiter">[</span>B<span class="delimiter">]</span> =
    <a href="#akka.http.marshalling;Marshal.to.m" title="(v1: A)scala.concurrent.Future[List[akka.http.marshalling.Marshalling[B]]]">m</a><a href="../util/FastFuture.scala.html#akka.http.util.FastFuture.EnhancedFuture(70d292f3d1)" title="(future: scala.concurrent.Future[List[akka.http.marshalling.Marshalling[B]]])akka.http.util.FastFuture.EnhancedFuture[List[akka.http.marshalling.Marshalling[B]]]" class="delimiter">(</a><a href="#akka.http.marshalling;Marshal.value" title="=&gt; A">value</a><span class="delimiter">)</span>.<a href="../util/FastFuture.scala.html#akka.http.util.FastFuture;EnhancedFuture.fast" title="=&gt; akka.http.util.FastFuture[List[akka.http.marshalling.Marshalling[B]]]">fast</a>.<a href="../util/FastFuture.scala.html#akka.http.util;FastFuture.map" title="(f: List[akka.http.marshalling.Marshalling[B]] =&gt; B)(implicit ec: scala.concurrent.ExecutionContext)scala.concurrent.Future[B]">map</a> <a href="#akka.http.marshalling;Marshal.to.ec" title="scala.concurrent.ExecutionContext" class="delimiter">{</a>
      <a href="#akka.http.marshalling;Marshal.to.$anonfun.x$1" title="List[akka.http.marshalling.Marshalling[B]]">_</a>.<span title="=&gt; akka.http.marshalling.Marshalling[B]">head</span> match <span class="delimiter">{</span>
        case Marshalling.WithFixedCharset<span class="delimiter">(</span>_, _, <span title="() =&gt; B">marshal</span><span class="delimiter">)</span> ⇒ <span title="()B">marshal</span><span class="delimiter">(</span><span class="delimiter">)</span>
        case Marshalling.WithOpenCharset<span class="delimiter">(</span>_, <span title="akka.http.model.HttpCharset =&gt; B">marshal</span><span class="delimiter">)</span>     ⇒ <span title="(v1: akka.http.model.HttpCharset)B">marshal</span><span class="delimiter">(</span><a href="../model/HttpCharset.scala.html#akka.http.model.HttpCharsets" title="akka.http.model.HttpCharsets.type">HttpCharsets</a>.<a href="../model/HttpCharset.scala.html#akka.http.model.HttpCharsets.UTF-8" title="=&gt; akka.http.model.HttpCharset">`UTF-8`</a><span class="delimiter">)</span>
        case Marshalling.Opaque<span class="delimiter">(</span><span title="() =&gt; B">marshal</span><span class="delimiter">)</span>                 ⇒ <span title="()B">marshal</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="comment">/**
   * Marshals `value` to an `HttpResponse` for the given `HttpRequest` with full content-negotiation.
   */</span>
  def <a title="(request: akka.http.model.HttpRequest)(implicit m: akka.http.marshalling.ToResponseMarshaller[A], implicit ec: scala.concurrent.ExecutionContext)scala.concurrent.Future[akka.http.model.HttpResponse]" id="akka.http.marshalling;Marshal.toResponseFor">toResponseFor</a><span class="delimiter">(</span><a title="akka.http.model.HttpRequest" id="akka.http.marshalling;Marshal.toResponseFor.request">request</a>: <a href="../model/HttpMessage.scala.html#akka.http.model;HttpRequest" title="akka.http.model.HttpRequest">HttpRequest</a><span class="delimiter">)</span><span class="delimiter">(</span>implicit <a title="akka.http.marshalling.ToResponseMarshaller[A]" id="akka.http.marshalling;Marshal.toResponseFor.m">m</a>: <a href="Marshaller.scala.html#akka.http.marshalling;Marshaller" title="akka.http.marshalling.ToResponseMarshaller[A]">ToResponseMarshaller</a><span class="delimiter">[</span>A<span class="delimiter">]</span>, <a title="scala.concurrent.ExecutionContext" id="akka.http.marshalling;Marshal.toResponseFor.ec">ec</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[akka.http.model.HttpResponse]">Future</span><span class="delimiter">[</span>HttpResponse<span class="delimiter">]</span> = <span class="delimiter">{</span>
    import akka.http.marshalling.<a href="#akka.http.marshalling.Marshal" title="akka.http.marshalling.Marshal.type">Marshal</a>._
    val <a title="scala.collection.immutable.Seq[akka.http.model.MediaRange]" id="akka.http.marshalling;Marshal.toResponseFor.mediaRanges">mediaRanges</a> = <a href="#akka.http.marshalling;Marshal.toResponseFor.request" title="akka.http.model.HttpRequest">request</a>.<a href="../model/HttpMessage.scala.html#akka.http.model;HttpRequest.acceptedMediaRanges" title="=&gt; scala.collection.immutable.Seq[akka.http.model.MediaRange]">acceptedMediaRanges</a> <span class="comment">// cache for performance</span>
    val <a title="scala.collection.immutable.Seq[akka.http.model.HttpCharsetRange]" id="akka.http.marshalling;Marshal.toResponseFor.charsetRanges">charsetRanges</a> = <a href="#akka.http.marshalling;Marshal.toResponseFor.request" title="akka.http.model.HttpRequest">request</a>.<a href="../model/HttpMessage.scala.html#akka.http.model;HttpRequest.acceptedCharsetRanges" title="=&gt; scala.collection.immutable.Seq[akka.http.model.HttpCharsetRange]">acceptedCharsetRanges</a> <span class="comment">// cache for performance</span>
    def <a title="(mediaType: akka.http.model.MediaType)Float" id="akka.http.marshalling;Marshal.toResponseFor.qValueMT">qValueMT</a><span class="delimiter">(</span><a title="akka.http.model.MediaType" id="akka.http.marshalling;Marshal.toResponseFor.qValueMT.mediaType">mediaType</a>: <a href="../model/MediaType.scala.html#akka.http.model;MediaType" title="akka.http.model.MediaType">MediaType</a><span class="delimiter">)</span> = <a href="#akka.http.marshalling;Marshal.toResponseFor.request" title="akka.http.model.HttpRequest">request</a>.<a href="../model/HttpMessage.scala.html#akka.http.model;HttpRequest.qValueForMediaType" title="(mediaType: akka.http.model.MediaType, ranges: Seq[akka.http.model.MediaRange])Float">qValueForMediaType</a><span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.qValueMT.mediaType" title="akka.http.model.MediaType">mediaType</a>, <a href="#akka.http.marshalling;Marshal.toResponseFor.mediaRanges" title="scala.collection.immutable.Seq[akka.http.model.MediaRange]">mediaRanges</a><span class="delimiter">)</span>
    def <a title="(charset: akka.http.model.HttpCharset)Float" id="akka.http.marshalling;Marshal.toResponseFor.qValueCS">qValueCS</a><span class="delimiter">(</span><a title="akka.http.model.HttpCharset" id="akka.http.marshalling;Marshal.toResponseFor.qValueCS.charset">charset</a>: <a href="../model/HttpCharset.scala.html#akka.http.model;HttpCharset" title="akka.http.model.HttpCharset">HttpCharset</a><span class="delimiter">)</span> = <a href="#akka.http.marshalling;Marshal.toResponseFor.request" title="akka.http.model.HttpRequest">request</a>.<a href="../model/HttpMessage.scala.html#akka.http.model;HttpRequest.qValueForCharset" title="(charset: akka.http.model.HttpCharset, ranges: Seq[akka.http.model.HttpCharsetRange])Float">qValueForCharset</a><span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.qValueCS.charset" title="akka.http.model.HttpCharset">charset</a>, <a href="#akka.http.marshalling;Marshal.toResponseFor.charsetRanges" title="scala.collection.immutable.Seq[akka.http.model.HttpCharsetRange]">charsetRanges</a><span class="delimiter">)</span>

    <a href="#akka.http.marshalling;Marshal.toResponseFor.m" title="(v1: A)scala.concurrent.Future[List[akka.http.marshalling.Marshalling[akka.http.model.HttpResponse]]]">m</a><a href="../util/FastFuture.scala.html#akka.http.util.FastFuture.EnhancedFuture(70d292f3d1)" title="(future: scala.concurrent.Future[List[akka.http.marshalling.Marshalling[akka.http.model.HttpResponse]]])akka.http.util.FastFuture.EnhancedFuture[List[akka.http.marshalling.Marshalling[akka.http.model.HttpResponse]]]" class="delimiter">(</a><a href="#akka.http.marshalling;Marshal.value" title="=&gt; A">value</a><span class="delimiter">)</span>.<a href="../util/FastFuture.scala.html#akka.http.util.FastFuture;EnhancedFuture.fast" title="=&gt; akka.http.util.FastFuture[List[akka.http.marshalling.Marshalling[akka.http.model.HttpResponse]]]">fast</a>.<a href="../util/FastFuture.scala.html#akka.http.util;FastFuture.map" title="(f: List[akka.http.marshalling.Marshalling[akka.http.model.HttpResponse]] =&gt; akka.http.model.HttpResponse)(implicit ec: scala.concurrent.ExecutionContext)scala.concurrent.Future[akka.http.model.HttpResponse]">map</a> <a href="#akka.http.marshalling;Marshal.toResponseFor.ec" title="scala.concurrent.ExecutionContext" class="delimiter">{</a> <a title="List[akka.http.marshalling.Marshalling[akka.http.model.HttpResponse]]" id="akka.http.marshalling;Marshal.toResponseFor.$anonfun.marshallings">marshallings</a> ⇒
      def <a title="(mt: akka.http.model.MediaType, cs: akka.http.model.HttpCharset)Float" id="akka.http.marshalling;Marshal.toResponseFor.$anonfun.weight">weight</a><span class="delimiter">(</span><a title="akka.http.model.MediaType" id="akka.http.marshalling;Marshal.toResponseFor.$anonfun.weight.mt">mt</a>: <a href="../model/MediaType.scala.html#akka.http.model;MediaType" title="akka.http.model.MediaType">MediaType</a>, <a title="akka.http.model.HttpCharset" id="akka.http.marshalling;Marshal.toResponseFor.$anonfun.weight.cs">cs</a>: <a href="../model/HttpCharset.scala.html#akka.http.model;HttpCharset" title="akka.http.model.HttpCharset">HttpCharset</a><span class="delimiter">)</span>: <span title="Float">Float</span> = math.<span title="(x: Float, y: Float)Float">min</span><span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.qValueMT" title="(mediaType: akka.http.model.MediaType)Float">qValueMT</a><span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.weight.mt" title="akka.http.model.MediaType">mt</a><span class="delimiter">)</span>, <a href="#akka.http.marshalling;Marshal.toResponseFor.qValueCS" title="(charset: akka.http.model.HttpCharset)Float">qValueCS</a><span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.weight.cs" title="akka.http.model.HttpCharset">cs</a><span class="delimiter">)</span><span class="delimiter">)</span>
      val <a title="akka.http.marshalling.Marshal.MarshallingWeight" id="akka.http.marshalling;Marshal.toResponseFor.$anonfun.defaultMarshallingWeight">defaultMarshallingWeight</a>: <a href="#akka.http.marshalling.Marshal;MarshallingWeight" title="akka.http.marshalling.Marshal.MarshallingWeight">MarshallingWeight</a> =
        new <a href="#akka.http.marshalling.Marshal;MarshallingWeight" title="akka.http.marshalling.Marshal.MarshallingWeight">MarshallingWeight</a><span class="delimiter">(</span><span title="Float(0.0)" class="float">0f</span>, <span class="delimiter">{</span> <span class="delimiter">(</span><span class="delimiter">)</span> ⇒
          val supportedContentTypes = <a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.marshallings" title="List[akka.http.marshalling.Marshalling[akka.http.model.HttpResponse]]">marshallings</a> <a title="List[akka.http.model.ContentType]" id="akka.http.marshalling;Marshal.toResponseFor.$anonfun.defaultMarshallingWeight.$anonfun.supportedContentTypes">collect</a> <a title="&lt;$anon: akka.http.marshalling.Marshalling[akka.http.model.HttpResponse] =&gt; akka.http.model.ContentType&gt; extends scala.runtime.AbstractPartialFunction[akka.http.marshalling.Marshalling[akka.http.model.HttpResponse],akka.http.model.ContentType] with Serializable" id="akka.http.marshalling;Marshal.toResponseFor.$anonfun.defaultMarshallingWeight.$anonfun.supportedContentTypes;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
            case Marshalling.WithFixedCharset<span class="delimiter">(</span><span title="akka.http.model.MediaType">mt</span>, <a title="akka.http.model.HttpCharset" id="akka.http.marshalling;Marshal.toResponseFor.$anonfun.defaultMarshallingWeight.$anonfun.supportedContentTypes;$anonfun.isDefinedAt.cs">cs</a>, _<span class="delimiter">)</span> ⇒ <a href="../model/ContentType.scala.html#akka.http.model.ContentType.apply(2ae8f5cf3b)" title="(mediaType: akka.http.model.MediaType, charset: akka.http.model.HttpCharset)akka.http.model.ContentType">ContentType</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.http.model.MediaType">mt</span>, <a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.defaultMarshallingWeight.$anonfun.supportedContentTypes;$anonfun.isDefinedAt.cs" title="akka.http.model.HttpCharset">cs</a><span class="delimiter">)</span>
            case Marshalling.WithOpenCharset<span class="delimiter">(</span><span title="akka.http.model.MediaType">mt</span>, _<span class="delimiter">)</span>      ⇒ <a href="../model/ContentType.scala.html#akka.http.model.ContentType.apply(f1dbd43f8a)" title="implicit akka.http.model.ContentType.apply : (mediaType: akka.http.model.MediaType)akka.http.model.ContentType">ContentType</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.http.model.MediaType">mt</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          throw <a href="#akka.http.marshalling.Marshal.UnacceptableResponseContentTypeException.readResolve" title="(supported: Set[akka.http.model.ContentType])akka.http.marshalling.Marshal.UnacceptableResponseContentTypeException">UnacceptableResponseContentTypeException</a><span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.defaultMarshallingWeight.$anonfun.supportedContentTypes" title="List[akka.http.model.ContentType]">supportedContentTypes</a>.<span title="scala.collection.immutable.Set[akka.http.model.ContentType]">toSet</span><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>
      val <a title="akka.http.marshalling.Marshal.MarshallingWeight" id="akka.http.marshalling;Marshal.toResponseFor.$anonfun.best">best</a> = <a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.marshallings" title="List[akka.http.marshalling.Marshalling[akka.http.model.HttpResponse]]">marshallings</a>.<span title="(z: akka.http.marshalling.Marshal.MarshallingWeight)(f: (akka.http.marshalling.Marshal.MarshallingWeight, akka.http.marshalling.Marshalling[akka.http.model.HttpResponse]) =&gt; akka.http.marshalling.Marshal.MarshallingWeight)akka.http.marshalling.Marshal.MarshallingWeight">foldLeft</span><span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.defaultMarshallingWeight" title="akka.http.marshalling.Marshal.MarshallingWeight">defaultMarshallingWeight</a><span class="delimiter">)</span> <a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.x0$1" title="akka.http.marshalling.Marshal.MarshallingWeight" class="delimiter">{</a>
        case <span class="delimiter">(</span><span title="akka.http.marshalling.Marshal.MarshallingWeight">acc</span>, Marshalling.WithFixedCharset<span class="delimiter">(</span><span title="akka.http.model.MediaType">mt</span>, <span title="akka.http.model.HttpCharset">cs</span>, <span title="() =&gt; akka.http.model.HttpResponse">marshal</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
          val <a title="Float" id="akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.w">w</a> = <a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.weight" title="(mt: akka.http.model.MediaType, cs: akka.http.model.HttpCharset)Float">weight</a><span class="delimiter">(</span><span title="akka.http.model.MediaType">mt</span>, <span title="akka.http.model.HttpCharset">cs</span><span class="delimiter">)</span>
          if <span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.w" title="Float">w</a> <span title="(x: Float)Boolean">&gt;</span> <span title="akka.http.marshalling.Marshal.MarshallingWeight">acc</span>.<a href="#akka.http.marshalling.Marshal;MarshallingWeight.weight" title="=&gt; Float">weight</a><span class="delimiter">)</span> new <a href="#akka.http.marshalling.Marshal;MarshallingWeight" title="akka.http.marshalling.Marshal.MarshallingWeight">MarshallingWeight</a><span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.w" title="Float">w</a>, <span title="() =&gt; akka.http.model.HttpResponse">marshal</span><span class="delimiter">)</span> else <span title="akka.http.marshalling.Marshal.MarshallingWeight">acc</span>

        case <span class="delimiter">(</span><span title="akka.http.marshalling.Marshal.MarshallingWeight">acc</span>, Marshalling.WithOpenCharset<span class="delimiter">(</span><span title="akka.http.model.MediaType">mt</span>, <span title="akka.http.model.HttpCharset =&gt; akka.http.model.HttpResponse">marshal</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
          def <a title="(cs: akka.http.model.HttpCharset)akka.http.marshalling.Marshal.MarshallingWeight" id="akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.withCharset">withCharset</a><span class="delimiter">(</span><a title="akka.http.model.HttpCharset" id="akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.withCharset.cs">cs</a>: <a href="../model/HttpCharset.scala.html#akka.http.model;HttpCharset" title="akka.http.model.HttpCharset">HttpCharset</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
            val <a title="Float" id="akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.withCharset.w">w</a> = <a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.weight" title="(mt: akka.http.model.MediaType, cs: akka.http.model.HttpCharset)Float">weight</a><span class="delimiter">(</span><span title="akka.http.model.MediaType">mt</span>, <a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.withCharset.cs" title="akka.http.model.HttpCharset">cs</a><span class="delimiter">)</span>
            if <span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.withCharset.w" title="Float">w</a> <span title="(x: Float)Boolean">&gt;</span> <span title="akka.http.marshalling.Marshal.MarshallingWeight">acc</span>.<a href="#akka.http.marshalling.Marshal;MarshallingWeight.weight" title="=&gt; Float">weight</a><span class="delimiter">)</span> new <a href="#akka.http.marshalling.Marshal;MarshallingWeight" title="akka.http.marshalling.Marshal.MarshallingWeight">MarshallingWeight</a><span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.withCharset.w" title="Float">w</a>, <span class="delimiter">(</span><span class="delimiter">)</span> ⇒ <span title="(v1: akka.http.model.HttpCharset)akka.http.model.HttpResponse">marshal</span><span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.withCharset.cs" title="akka.http.model.HttpCharset">cs</a><span class="delimiter">)</span><span class="delimiter">)</span> else <span title="akka.http.marshalling.Marshal.MarshallingWeight">acc</span>
          <span class="delimiter">}</span>
          <span class="comment">// logic for choosing the charset adapted from http://tools.ietf.org/html/rfc7231#section-5.3.3</span>
          if <span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.qValueCS" title="(charset: akka.http.model.HttpCharset)Float">qValueCS</a><span class="delimiter">(</span><a href="../model/HttpCharset.scala.html#akka.http.model.HttpCharsets.UTF-8" title="=&gt; akka.http.model.HttpCharset">`UTF-8`</a><span class="delimiter">)</span> <span title="(x: Float)Boolean">==</span> <span title="Float(1.0)" class="float">1f</span><span class="delimiter">)</span> <a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.withCharset" title="(cs: akka.http.model.HttpCharset)akka.http.marshalling.Marshal.MarshallingWeight">withCharset</a><span class="delimiter">(</span><a href="../model/HttpCharset.scala.html#akka.http.model.HttpCharsets.UTF-8" title="=&gt; akka.http.model.HttpCharset">`UTF-8`</a><span class="delimiter">)</span> <span class="comment">// prefer UTF-8 if fully accepted</span>
          else <a href="#akka.http.marshalling;Marshal.toResponseFor.charsetRanges" title="scala.collection.immutable.Seq[akka.http.model.HttpCharsetRange]">charsetRanges</a> match <span class="delimiter">{</span> <span class="comment">// ranges are sorted by descending q-value,</span>
            case <span class="delimiter">(</span>HttpCharsetRange.One<span class="delimiter">(</span><span title="akka.http.model.HttpCharset">cs</span>, <a title="Float" id="akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.qValue">qValue</a><span class="delimiter">)</span><span class="delimiter">)</span> :: _ ⇒ <span class="comment">// so we only need to look at the first one</span>
              if <span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.qValue" title="Float">qValue</a> <span title="(x: Float)Boolean">==</span> <span title="Float(1.0)" class="float">1f</span><span class="delimiter">)</span> <a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.withCharset" title="(cs: akka.http.model.HttpCharset)akka.http.marshalling.Marshal.MarshallingWeight">withCharset</a><span class="delimiter">(</span><span title="akka.http.model.HttpCharset">cs</span><span class="delimiter">)</span> <span class="comment">// if the client has high preference for this charset, pick it</span>
              else if <span class="delimiter">(</span><a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.qValue" title="Float">qValue</a> <span title="(x: Float)Boolean">&gt;</span> <span title="Float(0.0)" class="float">0f</span><span class="delimiter">)</span> <a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.best.$anonfun.withCharset" title="(cs: akka.http.model.HttpCharset)akka.http.marshalling.Marshal.MarshallingWeight">withCharset</a><span class="delimiter">(</span><span title="akka.http.model.HttpCharset">cs</span><span class="delimiter">)</span> <span class="comment">// ok, simply choose the first one if the client doesn't reject it</span>
              else <span title="akka.http.marshalling.Marshal.MarshallingWeight">acc</span>
            case _ ⇒ <span title="akka.http.marshalling.Marshal.MarshallingWeight">acc</span>
          <span class="delimiter">}</span>

        case <span class="delimiter">(</span><span title="akka.http.marshalling.Marshal.MarshallingWeight">acc</span>, Marshalling.Opaque<span class="delimiter">(</span><span title="() =&gt; akka.http.model.HttpResponse">marshal</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
          if <span class="delimiter">(</span><span title="akka.http.marshalling.Marshal.MarshallingWeight">acc</span>.<a href="#akka.http.marshalling.Marshal;MarshallingWeight.weight" title="=&gt; Float">weight</a> <span title="(x: Float)Boolean">==</span> <span title="Float(0.0)" class="float">0f</span><span class="delimiter">)</span> new <a href="#akka.http.marshalling.Marshal;MarshallingWeight" title="akka.http.marshalling.Marshal.MarshallingWeight">MarshallingWeight</a><span class="delimiter">(</span>Float.<span title="Float(1.4E-45)">MinPositiveValue</span>, <span title="() =&gt; akka.http.model.HttpResponse">marshal</span><span class="delimiter">)</span> else <span title="akka.http.marshalling.Marshal.MarshallingWeight">acc</span>
      <span class="delimiter">}</span>
      <a href="#akka.http.marshalling;Marshal.toResponseFor.$anonfun.best" title="akka.http.marshalling.Marshal.MarshallingWeight">best</a>.<a href="#akka.http.marshalling.Marshal;MarshallingWeight.marshal" title="()akka.http.model.HttpResponse">marshal</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
