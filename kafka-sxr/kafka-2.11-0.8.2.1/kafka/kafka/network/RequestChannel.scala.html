<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>kafka/kafka/network/RequestChannel.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

package kafka.network

import java.util.concurrent._
import kafka.metrics.KafkaMetricsGroup
import com.yammer.metrics.core.Gauge
import java.nio.ByteBuffer
import kafka.api._
import kafka.common.TopicAndPartition
import kafka.utils.<span class="delimiter">{</span>Logging, SystemTime<span class="delimiter">}</span>
import kafka.message.ByteBufferMessageSet
import java.net._
import org.apache.log4j.Logger


object <a title="kafka.network.RequestChannel.type" id="kafka.network.RequestChannel">RequestChannel</a> extends <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> <span class="delimiter">{</span>
  val <a title="kafka.network.RequestChannel.Request" id="kafka.network.RequestChannel.AllDone">AllDone</a> = new <a href="#kafka.network.RequestChannel.Request.readResolve" title="kafka.network.RequestChannel.Request">Request</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <span title="Int(2)" class="int">2</span>, <a href="#kafka.network.RequestChannel.getShutdownReceive" title="()java.nio.ByteBuffer">getShutdownReceive</a><span class="delimiter">(</span><span class="delimiter">)</span>, <span title="Long(0L)" class="int">0</span><span class="delimiter">)</span>

  def <a title="()java.nio.ByteBuffer" id="kafka.network.RequestChannel.getShutdownReceive">getShutdownReceive</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    val <a title="kafka.api.ProducerRequest" id="kafka.network.RequestChannel.getShutdownReceive.emptyProducerRequest">emptyProducerRequest</a> = new <a href="../api/ProducerRequest.scala.html#kafka.api;ProducerRequest" title="kafka.api.ProducerRequest">ProducerRequest</a><span class="delimiter">(</span><span title="Short(0)" class="int">0</span>, <span title="Int(0)" class="int">0</span>, <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="Short(0)" class="int">0</span>, <span title="Int(0)" class="int">0</span>, collection.mutable.<span title="[A, B](elems: (A, B)*)scala.collection.mutable.Map[A,B]">Map</span><span title="(elems: (kafka.common.TopicAndPartition, kafka.message.ByteBufferMessageSet)*)scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.message.ByteBufferMessageSet]" class="delimiter">[</span><a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition" title="kafka.common.TopicAndPartition">TopicAndPartition</a>, <a href="../message/ByteBufferMessageSet.scala.html#kafka.message;ByteBufferMessageSet" title="kafka.message.ByteBufferMessageSet">ByteBufferMessageSet</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    val <a title="java.nio.ByteBuffer" id="kafka.network.RequestChannel.getShutdownReceive.byteBuffer">byteBuffer</a> = <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Int)java.nio.ByteBuffer">allocate</span><span class="delimiter">(</span><a href="#kafka.network.RequestChannel.getShutdownReceive.emptyProducerRequest" title="kafka.api.ProducerRequest">emptyProducerRequest</a>.<a href="../api/ProducerRequest.scala.html#kafka.api;ProducerRequest.sizeInBytes" title="=&gt; Int">sizeInBytes</a> <span title="(x: Int)Int">+</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span>
    <a href="#kafka.network.RequestChannel.getShutdownReceive.byteBuffer" title="java.nio.ByteBuffer">byteBuffer</a>.<span title="(x$1: Short)java.nio.ByteBuffer">putShort</span><span class="delimiter">(</span><a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys" title="kafka.api.RequestKeys.type">RequestKeys</a>.<a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys.ProduceKey" title="=&gt; Short">ProduceKey</a><span class="delimiter">)</span>
    <a href="#kafka.network.RequestChannel.getShutdownReceive.emptyProducerRequest" title="kafka.api.ProducerRequest">emptyProducerRequest</a>.<a href="../api/ProducerRequest.scala.html#kafka.api;ProducerRequest.writeTo" title="(buffer: java.nio.ByteBuffer)Unit">writeTo</a><span class="delimiter">(</span><a href="#kafka.network.RequestChannel.getShutdownReceive.byteBuffer" title="java.nio.ByteBuffer">byteBuffer</a><span class="delimiter">)</span>
    <a href="#kafka.network.RequestChannel.getShutdownReceive.byteBuffer" title="java.nio.ByteBuffer">byteBuffer</a>.<span title="()java.nio.Buffer">rewind</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#kafka.network.RequestChannel.getShutdownReceive.byteBuffer" title="java.nio.ByteBuffer">byteBuffer</a>
  <span class="delimiter">}</span>

  case class <a title="class Request extends AnyRef with Product with Serializable" id="kafka.network.RequestChannel.Request.readResolve">Request</a><a href="#kafka.network.RequestChannel.Request.readResolve" title="Product" class="delimiter">(</a><a title="Int" id="kafka.network.RequestChannel;Request.processor">processor</a>: <span title="Int">Int</span>, <a title="Any" id="kafka.network.RequestChannel;Request.requestKey">requestKey</a>: <span title="Any">Any</span>, private var <a title="java.nio.ByteBuffer" id="kafka.network.RequestChannel;Request.buffer">buffer</a>: <span title="java.nio.ByteBuffer">ByteBuffer</span>, <a title="Long" id="kafka.network.RequestChannel;Request.startTimeMs">startTimeMs</a>: <span title="Long">Long</span>, <a title="java.net.SocketAddress" id="kafka.network.RequestChannel.Request.apply$default$5">remoteAddress</a>: <span title="java.net.SocketAddress">SocketAddress</span> = new <span title="java.net.InetSocketAddress">InetSocketAddress</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    @volatile var <a title="Long" id="kafka.network.RequestChannel;Request.requestDequeueTimeMs_=">requestDequeueTimeMs</a> = -<span title="Long(-1L)" class="long">1L</span>
    @volatile var <a title="Long" id="kafka.network.RequestChannel;Request.apiLocalCompleteTimeMs_=">apiLocalCompleteTimeMs</a> = -<span title="Long(-1L)" class="long">1L</span>
    @volatile var <a title="Long" id="kafka.network.RequestChannel;Request.responseCompleteTimeMs_=">responseCompleteTimeMs</a> = -<span title="Long(-1L)" class="long">1L</span>
    @volatile var <a title="Long" id="kafka.network.RequestChannel;Request.responseDequeueTimeMs_=">responseDequeueTimeMs</a> = -<span title="Long(-1L)" class="long">1L</span>
    val <a title="Short" id="kafka.network.RequestChannel;Request.requestId">requestId</a> = <a href="#kafka.network.RequestChannel;Request.buffer" title="=&gt; java.nio.ByteBuffer">buffer</a>.<span title="()Short">getShort</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="kafka.api.RequestOrResponse" id="kafka.network.RequestChannel;Request.requestObj">requestObj</a>: <a href="../api/RequestOrResponse.scala.html#kafka.api;RequestOrResponse" title="kafka.api.RequestOrResponse">RequestOrResponse</a> = <a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys" title="kafka.api.RequestKeys.type">RequestKeys</a>.<a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys.deserializerForKey" title="(key: Short)java.nio.ByteBuffer =&gt; kafka.api.RequestOrResponse">deserializerForKey</a><span title="(v1: java.nio.ByteBuffer)kafka.api.RequestOrResponse" class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.requestId" title="=&gt; Short">requestId</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.buffer" title="=&gt; java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
    <a href="#kafka.network.RequestChannel;Request.buffer" title="(x$1: java.nio.ByteBuffer)Unit">buffer</a> = null
    private val <a title="org.apache.log4j.Logger" id="kafka.network.RequestChannel;Request.requestLogger">requestLogger</a> = <span title="org.apache.log4j.Logger.type">Logger</span>.<span title="(x$1: String)org.apache.log4j.Logger">getLogger</span><span class="delimiter">(</span><span title="String(&quot;kafka.request.logger&quot;)" class="string">&quot;kafka.request.logger&quot;</span><span class="delimiter">)</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Processor %d received request : %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.processor" title="=&gt; Int">processor</a>, <a href="#kafka.network.RequestChannel;Request.requestObj" title="=&gt; kafka.api.RequestOrResponse">requestObj</a><span class="delimiter">)</span><span class="delimiter">)</span>

    def <a title="()Unit" id="kafka.network.RequestChannel;Request.updateRequestMetrics">updateRequestMetrics</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="Long" id="kafka.network.RequestChannel;Request.updateRequestMetrics.endTimeMs">endTimeMs</a> = <a href="../utils/Time.scala.html#kafka.utils.SystemTime" title="kafka.utils.SystemTime.type">SystemTime</a>.<a href="../utils/Time.scala.html#kafka.utils.SystemTime.milliseconds" title="=&gt; Long">milliseconds</a>
      <span class="comment">// In some corner cases, apiLocalCompleteTimeMs may not be set when the request completes since the remote</span>
      <span class="comment">// processing time is really small. In this case, use responseCompleteTimeMs as apiLocalCompleteTimeMs.</span>
      if <span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.apiLocalCompleteTimeMs_=" title="=&gt; Long">apiLocalCompleteTimeMs</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        <a href="#kafka.network.RequestChannel;Request.apiLocalCompleteTimeMs_=" title="(x$1: Long)Unit">apiLocalCompleteTimeMs</a> = <a href="#kafka.network.RequestChannel;Request.responseCompleteTimeMs_=" title="=&gt; Long">responseCompleteTimeMs</a>
      val <a title="Long" id="kafka.network.RequestChannel;Request.updateRequestMetrics.requestQueueTime">requestQueueTime</a> = <span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.requestDequeueTimeMs_=" title="=&gt; Long">requestDequeueTimeMs</a> <span title="implicit scala.LowPriorityImplicits.longWrapper : (x: Long)scala.runtime.RichLong">-</span> <a href="#kafka.network.RequestChannel;Request.startTimeMs" title="=&gt; Long">startTimeMs</a><span class="delimiter">)</span>.<span title="(that: Long)Long">max</span><span class="delimiter">(</span><span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span>
      val <a title="Long" id="kafka.network.RequestChannel;Request.updateRequestMetrics.apiLocalTime">apiLocalTime</a> = <span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.apiLocalCompleteTimeMs_=" title="=&gt; Long">apiLocalCompleteTimeMs</a> <span title="implicit scala.LowPriorityImplicits.longWrapper : (x: Long)scala.runtime.RichLong">-</span> <a href="#kafka.network.RequestChannel;Request.requestDequeueTimeMs_=" title="=&gt; Long">requestDequeueTimeMs</a><span class="delimiter">)</span>.<span title="(that: Long)Long">max</span><span class="delimiter">(</span><span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span>
      val <a title="Long" id="kafka.network.RequestChannel;Request.updateRequestMetrics.apiRemoteTime">apiRemoteTime</a> = <span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.responseCompleteTimeMs_=" title="=&gt; Long">responseCompleteTimeMs</a> <span title="implicit scala.LowPriorityImplicits.longWrapper : (x: Long)scala.runtime.RichLong">-</span> <a href="#kafka.network.RequestChannel;Request.apiLocalCompleteTimeMs_=" title="=&gt; Long">apiLocalCompleteTimeMs</a><span class="delimiter">)</span>.<span title="(that: Long)Long">max</span><span class="delimiter">(</span><span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span>
      val <a title="Long" id="kafka.network.RequestChannel;Request.updateRequestMetrics.responseQueueTime">responseQueueTime</a> = <span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.responseDequeueTimeMs_=" title="=&gt; Long">responseDequeueTimeMs</a> <span title="implicit scala.LowPriorityImplicits.longWrapper : (x: Long)scala.runtime.RichLong">-</span> <a href="#kafka.network.RequestChannel;Request.responseCompleteTimeMs_=" title="=&gt; Long">responseCompleteTimeMs</a><span class="delimiter">)</span>.<span title="(that: Long)Long">max</span><span class="delimiter">(</span><span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span>
      val <a title="Long" id="kafka.network.RequestChannel;Request.updateRequestMetrics.responseSendTime">responseSendTime</a> = <span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.endTimeMs" title="Long">endTimeMs</a> <span title="implicit scala.LowPriorityImplicits.longWrapper : (x: Long)scala.runtime.RichLong">-</span> <a href="#kafka.network.RequestChannel;Request.responseDequeueTimeMs_=" title="=&gt; Long">responseDequeueTimeMs</a><span class="delimiter">)</span>.<span title="(that: Long)Long">max</span><span class="delimiter">(</span><span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span>
      val totalTime = <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.endTimeMs" title="Long">endTimeMs</a> <a title="Long" id="kafka.network.RequestChannel;Request.updateRequestMetrics.totalTime">-</a> <a href="#kafka.network.RequestChannel;Request.startTimeMs" title="=&gt; Long">startTimeMs</a>
      var <a title="List[kafka.network.RequestMetrics]" id="kafka.network.RequestChannel;Request.updateRequestMetrics.metricsList">metricsList</a> = <span title="(xs: kafka.network.RequestMetrics*)List[kafka.network.RequestMetrics]">List</span><span class="delimiter">(</span><a href="#kafka.network.RequestMetrics" title="kafka.network.RequestMetrics.type">RequestMetrics</a>.<a href="#kafka.network.RequestMetrics.metricsMap" title="(key: String)kafka.network.RequestMetrics">metricsMap</a><span class="delimiter">(</span><a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys" title="kafka.api.RequestKeys.type">RequestKeys</a>.<a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys.nameForKey" title="(key: Short)String">nameForKey</a><span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.requestId" title="=&gt; Short">requestId</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.requestId" title="=&gt; Short">requestId</a> <span title="(x: Short)Boolean">==</span> <a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys" title="kafka.api.RequestKeys.type">RequestKeys</a>.<a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys.FetchKey" title="=&gt; Short">FetchKey</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        val <a title="Boolean" id="kafka.network.RequestChannel;Request.updateRequestMetrics.isFromFollower">isFromFollower</a> = <a href="#kafka.network.RequestChannel;Request.requestObj" title="=&gt; kafka.api.RequestOrResponse">requestObj</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="kafka.api.FetchRequest" class="delimiter">[</span><a href="../api/FetchRequest.scala.html#kafka.api;FetchRequest" title="kafka.api.FetchRequest">FetchRequest</a><span class="delimiter">]</span>.<a href="../api/FetchRequest.scala.html#kafka.api;FetchRequest.isFromFollower" title="=&gt; Boolean">isFromFollower</a>
        <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.metricsList" title="List[kafka.network.RequestMetrics]">metricsList</a> <span title="(x: kafka.network.RequestMetrics)List[kafka.network.RequestMetrics]">::=</span> <span class="delimiter">(</span> if <span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.isFromFollower" title="Boolean">isFromFollower</a><span class="delimiter">)</span>
                            <a href="#kafka.network.RequestMetrics" title="kafka.network.RequestMetrics.type">RequestMetrics</a>.<a href="#kafka.network.RequestMetrics.metricsMap" title="(key: String)kafka.network.RequestMetrics">metricsMap</a><span class="delimiter">(</span><a href="#kafka.network.RequestMetrics" title="kafka.network.RequestMetrics.type">RequestMetrics</a>.<a href="#kafka.network.RequestMetrics.followFetchMetricName" title="=&gt; String">followFetchMetricName</a><span class="delimiter">)</span>
                          else
                            <a href="#kafka.network.RequestMetrics" title="kafka.network.RequestMetrics.type">RequestMetrics</a>.<a href="#kafka.network.RequestMetrics.metricsMap" title="(key: String)kafka.network.RequestMetrics">metricsMap</a><span class="delimiter">(</span><a href="#kafka.network.RequestMetrics" title="kafka.network.RequestMetrics.type">RequestMetrics</a>.<a href="#kafka.network.RequestMetrics.consumerFetchMetricName" title="=&gt; String">consumerFetchMetricName</a><span class="delimiter">)</span> <span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.metricsList" title="List[kafka.network.RequestMetrics]">metricsList</a>.<span title="(f: kafka.network.RequestMetrics =&gt; Unit)Unit">foreach</span><span class="delimiter">{</span>
        <a title="kafka.network.RequestMetrics" id="kafka.network.RequestChannel;Request.updateRequestMetrics.$anonfun.m">m</a> =&gt; <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.$anonfun.m" title="kafka.network.RequestMetrics">m</a>.<a href="#kafka.network;RequestMetrics.requestRate" title="=&gt; com.yammer.metrics.core.Meter">requestRate</a>.<span title="()Unit">mark</span><span class="delimiter">(</span><span class="delimiter">)</span>
             <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.$anonfun.m" title="kafka.network.RequestMetrics">m</a>.<a href="#kafka.network;RequestMetrics.requestQueueTimeHist" title="=&gt; com.yammer.metrics.core.Histogram">requestQueueTimeHist</a>.<span title="(x$1: Long)Unit">update</span><span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.requestQueueTime" title="Long">requestQueueTime</a><span class="delimiter">)</span>
             <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.$anonfun.m" title="kafka.network.RequestMetrics">m</a>.<a href="#kafka.network;RequestMetrics.localTimeHist" title="=&gt; com.yammer.metrics.core.Histogram">localTimeHist</a>.<span title="(x$1: Long)Unit">update</span><span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.apiLocalTime" title="Long">apiLocalTime</a><span class="delimiter">)</span>
             <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.$anonfun.m" title="kafka.network.RequestMetrics">m</a>.<a href="#kafka.network;RequestMetrics.remoteTimeHist" title="=&gt; com.yammer.metrics.core.Histogram">remoteTimeHist</a>.<span title="(x$1: Long)Unit">update</span><span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.apiRemoteTime" title="Long">apiRemoteTime</a><span class="delimiter">)</span>
             <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.$anonfun.m" title="kafka.network.RequestMetrics">m</a>.<a href="#kafka.network;RequestMetrics.responseQueueTimeHist" title="=&gt; com.yammer.metrics.core.Histogram">responseQueueTimeHist</a>.<span title="(x$1: Long)Unit">update</span><span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.responseQueueTime" title="Long">responseQueueTime</a><span class="delimiter">)</span>
             <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.$anonfun.m" title="kafka.network.RequestMetrics">m</a>.<a href="#kafka.network;RequestMetrics.responseSendTimeHist" title="=&gt; com.yammer.metrics.core.Histogram">responseSendTimeHist</a>.<span title="(x$1: Long)Unit">update</span><span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.responseSendTime" title="Long">responseSendTime</a><span class="delimiter">)</span>
             <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.$anonfun.m" title="kafka.network.RequestMetrics">m</a>.<a href="#kafka.network;RequestMetrics.totalTimeHist" title="=&gt; com.yammer.metrics.core.Histogram">totalTimeHist</a>.<span title="(x$1: Long)Unit">update</span><span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.totalTime" title="Long">totalTime</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      if<span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.requestLogger" title="=&gt; org.apache.log4j.Logger">requestLogger</a>.<span title="()Boolean">isTraceEnabled</span><span class="delimiter">)</span>
        <a href="#kafka.network.RequestChannel;Request.requestLogger" title="=&gt; org.apache.log4j.Logger">requestLogger</a>.<span title="(x$1: Any)Unit">trace</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Completed request:%s from client %s;totalTime:%d,requestQueueTime:%d,localTime:%d,remoteTime:%d,responseQueueTime:%d,sendTime:%d&quot;</span>
          .<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.requestObj" title="=&gt; kafka.api.RequestOrResponse">requestObj</a>.<a href="../api/RequestOrResponse.scala.html#kafka.api;RequestOrResponse.describe" title="(details: Boolean)String">describe</a><span class="delimiter">(</span>true<span class="delimiter">)</span>, <a href="#kafka.network.RequestChannel.Request.apply$default$5" title="=&gt; java.net.SocketAddress">remoteAddress</a>, <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.totalTime" title="Long">totalTime</a>, <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.requestQueueTime" title="Long">requestQueueTime</a>, <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.apiLocalTime" title="Long">apiLocalTime</a>, <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.apiRemoteTime" title="Long">apiRemoteTime</a>, <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.responseQueueTime" title="Long">responseQueueTime</a>, <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.responseSendTime" title="Long">responseSendTime</a><span class="delimiter">)</span><span class="delimiter">)</span>
      else if<span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.requestLogger" title="=&gt; org.apache.log4j.Logger">requestLogger</a>.<span title="()Boolean">isDebugEnabled</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#kafka.network.RequestChannel;Request.requestLogger" title="=&gt; org.apache.log4j.Logger">requestLogger</a>.<span title="(x$1: Any)Unit">debug</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Completed request:%s from client %s;totalTime:%d,requestQueueTime:%d,localTime:%d,remoteTime:%d,responseQueueTime:%d,sendTime:%d&quot;</span>
          .<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Request.requestObj" title="=&gt; kafka.api.RequestOrResponse">requestObj</a>.<a href="../api/RequestOrResponse.scala.html#kafka.api;RequestOrResponse.describe" title="(details: Boolean)String">describe</a><span class="delimiter">(</span>false<span class="delimiter">)</span>, <a href="#kafka.network.RequestChannel.Request.apply$default$5" title="=&gt; java.net.SocketAddress">remoteAddress</a>, <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.totalTime" title="Long">totalTime</a>, <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.requestQueueTime" title="Long">requestQueueTime</a>, <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.apiLocalTime" title="Long">apiLocalTime</a>, <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.apiRemoteTime" title="Long">apiRemoteTime</a>, <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.responseQueueTime" title="Long">responseQueueTime</a>, <a href="#kafka.network.RequestChannel;Request.updateRequestMetrics.responseSendTime" title="Long">responseSendTime</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  case class <a title="class Response extends AnyRef with Product with Serializable" id="kafka.network.RequestChannel.Response.readResolve">Response</a><a href="#kafka.network.RequestChannel.Response.readResolve" title="Product" class="delimiter">(</a><a title="Int" id="kafka.network.RequestChannel;Response.processor">processor</a>: <span title="Int">Int</span>, <a title="kafka.network.RequestChannel.Request" id="kafka.network.RequestChannel;Response.request">request</a>: <a href="#kafka.network.RequestChannel.Request.readResolve" title="kafka.network.RequestChannel.Request">Request</a>, <a title="kafka.network.Send" id="kafka.network.RequestChannel;Response.responseSend">responseSend</a>: <a href="Transmission.scala.html#kafka.network;Send" title="kafka.network.Send">Send</a>, <a title="kafka.network.RequestChannel.ResponseAction" id="kafka.network.RequestChannel;Response.responseAction">responseAction</a>: <a href="#kafka.network.RequestChannel;ResponseAction" title="kafka.network.RequestChannel.ResponseAction">ResponseAction</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.network.RequestChannel;Response.request" title="=&gt; kafka.network.RequestChannel.Request">request</a>.<a href="#kafka.network.RequestChannel;Request.responseCompleteTimeMs_=" title="(x$1: Long)Unit">responseCompleteTimeMs</a> = <a href="../utils/Time.scala.html#kafka.utils.SystemTime" title="kafka.utils.SystemTime.type">SystemTime</a>.<a href="../utils/Time.scala.html#kafka.utils.SystemTime.milliseconds" title="=&gt; Long">milliseconds</a>

    def this<span class="delimiter">(</span><a title="Int" id="kafka.network.RequestChannel;Response.<init>(5704e61013).processor">processor</a>: <span title="Int">Int</span>, <a title="kafka.network.RequestChannel.Request" id="kafka.network.RequestChannel;Response.<init>(5704e61013).request">request</a>: <a href="#kafka.network.RequestChannel.Request.readResolve" title="kafka.network.RequestChannel.Request">Request</a>, <a title="kafka.network.Send" id="kafka.network.RequestChannel;Response.<init>(5704e61013).responseSend">responseSend</a>: <a href="Transmission.scala.html#kafka.network;Send" title="kafka.network.Send">Send</a><span class="delimiter">)</span> =
      this<span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Response.<init>(5704e61013).processor" title="Int">processor</a>, <a href="#kafka.network.RequestChannel;Response.<init>(5704e61013).request" title="kafka.network.RequestChannel.Request">request</a>, <a href="#kafka.network.RequestChannel;Response.<init>(5704e61013).responseSend" title="kafka.network.Send">responseSend</a>, if <span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Response.<init>(5704e61013).responseSend" title="kafka.network.Send">responseSend</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span> <a href="#kafka.network.RequestChannel.NoOpAction.readResolve" title="kafka.network.RequestChannel.NoOpAction.type">NoOpAction</a> else <a href="#kafka.network.RequestChannel.SendAction.readResolve" title="kafka.network.RequestChannel.SendAction.type">SendAction</a><span class="delimiter">)</span>

    def this<span class="delimiter">(</span><a title="kafka.network.RequestChannel.Request" id="kafka.network.RequestChannel;Response.<init>(c024e18076).request">request</a>: <a href="#kafka.network.RequestChannel.Request.readResolve" title="kafka.network.RequestChannel.Request">Request</a>, <a title="kafka.network.Send" id="kafka.network.RequestChannel;Response.<init>(c024e18076).send">send</a>: <a href="Transmission.scala.html#kafka.network;Send" title="kafka.network.Send">Send</a><span class="delimiter">)</span> =
      this<span class="delimiter">(</span><a href="#kafka.network.RequestChannel;Response.<init>(c024e18076).request" title="kafka.network.RequestChannel.Request">request</a>.<a href="#kafka.network.RequestChannel;Request.processor" title="=&gt; Int">processor</a>, <a href="#kafka.network.RequestChannel;Response.<init>(c024e18076).request" title="kafka.network.RequestChannel.Request">request</a>, <a href="#kafka.network.RequestChannel;Response.<init>(c024e18076).send" title="kafka.network.Send">send</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  trait <a title="trait ResponseAction extends AnyRef" id="kafka.network.RequestChannel;ResponseAction">ResponseAction</a>
  case object <a href="#kafka.network.RequestChannel.SendAction.productElement.x$1" title="kafka.network.RequestChannel.SendAction.type" id="kafka.network.RequestChannel.SendAction.readResolve">SendAction</a> extends <a href="#kafka.network.RequestChannel;ResponseAction" title="kafka.network.RequestChannel.ResponseAction">ResponseAction</a>
  case object <a href="#kafka.network.RequestChannel.NoOpAction.productElement.x$1" title="kafka.network.RequestChannel.NoOpAction.type" id="kafka.network.RequestChannel.NoOpAction.readResolve">NoOpAction</a> extends <a href="#kafka.network.RequestChannel;ResponseAction" title="kafka.network.RequestChannel.ResponseAction">ResponseAction</a>
  case object <a href="#kafka.network.RequestChannel.CloseConnectionAction.productElement.x$1" title="kafka.network.RequestChannel.CloseConnectionAction.type" id="kafka.network.RequestChannel.CloseConnectionAction.readResolve">CloseConnectionAction</a> extends <a href="#kafka.network.RequestChannel;ResponseAction" title="kafka.network.RequestChannel.ResponseAction">ResponseAction</a>
<span class="delimiter">}</span>

class <a title="class RequestChannel extends AnyRef with kafka.metrics.KafkaMetricsGroup" id="kafka.network;RequestChannel">RequestChannel</a><a href="#kafka.network;RequestChannel" title="kafka.network.RequestChannel" class="delimiter">(</a>val <a title="Int" id="kafka.network;RequestChannel.numProcessors">numProcessors</a>: <span title="Int">Int</span>, val <a title="Int" id="kafka.network;RequestChannel.queueSize">queueSize</a>: <span title="Int">Int</span><span class="delimiter">)</span> extends <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup" title="kafka.metrics.KafkaMetricsGroup">KafkaMetricsGroup</a> <span class="delimiter">{</span>
  private var <a title="List[Int =&gt; Unit]" id="kafka.network;RequestChannel.responseListeners_=">responseListeners</a>: <span title="List[Int =&gt; Unit]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>Int<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">]</span> = <span title="scala.collection.immutable.Nil.type">Nil</span>
  private val <a title="java.util.concurrent.ArrayBlockingQueue[kafka.network.RequestChannel.Request]" id="kafka.network;RequestChannel.requestQueue">requestQueue</a> = new <span title="java.util.concurrent.ArrayBlockingQueue[kafka.network.RequestChannel.Request]">ArrayBlockingQueue</span><span class="delimiter">[</span>RequestChannel.Request<span class="delimiter">]</span><span class="delimiter">(</span><a href="#kafka.network;RequestChannel.queueSize" title="=&gt; Int">queueSize</a><span class="delimiter">)</span>
  private val <a title="Array[java.util.concurrent.BlockingQueue[kafka.network.RequestChannel.Response]]" id="kafka.network;RequestChannel.responseQueues">responseQueues</a> = new <span title="Array[java.util.concurrent.BlockingQueue[kafka.network.RequestChannel.Response]]">Array</span><span class="delimiter">[</span>BlockingQueue<span class="delimiter">[</span>RequestChannel.Response<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#kafka.network;RequestChannel.numProcessors" title="=&gt; Int">numProcessors</a><span class="delimiter">)</span>
  for<span class="delimiter">(</span><span title="Int">i</span> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(f: Int =&gt; Unit)Unit">until</span> <a href="#kafka.network;RequestChannel.numProcessors" title="=&gt; Int">numProcessors</a><span class="delimiter">)</span>
    <a href="#kafka.network;RequestChannel.responseQueues" title="(i: Int, x: java.util.concurrent.BlockingQueue[kafka.network.RequestChannel.Response])Unit">responseQueues</a><span class="delimiter">(</span><span title="Int">i</span><span class="delimiter">)</span> = new <span title="java.util.concurrent.LinkedBlockingQueue[kafka.network.RequestChannel.Response]">LinkedBlockingQueue</span><span class="delimiter">[</span>RequestChannel.Response<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newGauge" title="(name: String, metric: com.yammer.metrics.core.Gauge[Int], tags: scala.collection.Map[String,String])com.yammer.metrics.core.Gauge[Int]">newGauge</a><span class="delimiter">(</span>
    <span title="String(&quot;RequestQueueSize&quot;)" class="string">&quot;RequestQueueSize&quot;</span>,
    new <span title="&lt;$anon: com.yammer.metrics.core.Gauge[Int]&gt; extends com.yammer.metrics.core.Gauge[Int]">Gauge</span><span class="delimiter">[</span>Int<span class="delimiter">]</span> <span class="delimiter">{</span>
      def <span title="()Int">value</span> = <a href="#kafka.network;RequestChannel.requestQueue" title="=&gt; java.util.concurrent.ArrayBlockingQueue[kafka.network.RequestChannel.Request]">requestQueue</a>.<span title="()Int">size</span>
    <span class="delimiter">}</span>
  <span class="delimiter">)</span>

  <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newGauge" title="(name: String, metric: com.yammer.metrics.core.Gauge[Int], tags: scala.collection.Map[String,String])com.yammer.metrics.core.Gauge[Int]">newGauge</a><span class="delimiter">(</span><span title="String(&quot;ResponseQueueSize&quot;)" class="string">&quot;ResponseQueueSize&quot;</span>, new <span title="&lt;$anon: com.yammer.metrics.core.Gauge[Int]&gt; extends com.yammer.metrics.core.Gauge[Int]">Gauge</span><span class="delimiter">[</span>Int<span class="delimiter">]</span><span class="delimiter">{</span>
    def <span title="()Int">value</span> = <a href="#kafka.network;RequestChannel.responseQueues" title="(xs: Array[java.util.concurrent.BlockingQueue[kafka.network.RequestChannel.Response]])scala.collection.mutable.ArrayOps[java.util.concurrent.BlockingQueue[kafka.network.RequestChannel.Response]]">responseQueues</a>.<span title="(z: Int)(op: (Int, java.util.concurrent.BlockingQueue[kafka.network.RequestChannel.Response]) =&gt; Int)Int">foldLeft</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span><span class="delimiter">(</span><a title="Int" id="kafka.network;RequestChannel.<local RequestChannel>;$anon.value.$anonfun.total">total</a>, <a title="java.util.concurrent.BlockingQueue[kafka.network.RequestChannel.Response]" id="kafka.network;RequestChannel.<local RequestChannel>;$anon.value.$anonfun.q">q</a><span class="delimiter">)</span> =&gt; <a href="#kafka.network;RequestChannel.<local RequestChannel>;$anon.value.$anonfun.total" title="Int">total</a> <span title="(x: Int)Int">+</span> <a href="#kafka.network;RequestChannel.<local RequestChannel>;$anon.value.$anonfun.q" title="java.util.concurrent.BlockingQueue[kafka.network.RequestChannel.Response]">q</a>.<span title="()Int">size</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">}</span>
  <span class="delimiter">}</span><span class="delimiter">)</span>

  for <span class="delimiter">(</span><span title="Int">i</span> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(f: Int =&gt; com.yammer.metrics.core.Gauge[Int])Unit">until</span> <a href="#kafka.network;RequestChannel.numProcessors" title="=&gt; Int">numProcessors</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newGauge" title="(name: String, metric: com.yammer.metrics.core.Gauge[Int], tags: scala.collection.Map[String,String])com.yammer.metrics.core.Gauge[Int]">newGauge</a><span class="delimiter">(</span><span title="String(&quot;ResponseQueueSize&quot;)" class="string">&quot;ResponseQueueSize&quot;</span>,
      new <a title="&lt;$anon: com.yammer.metrics.core.Gauge[Int]&gt; extends com.yammer.metrics.core.Gauge[Int]" id="kafka.network;RequestChannel.<local RequestChannel>.$anonfun;$anon">Gauge</a><span class="delimiter">[</span>Int<span class="delimiter">]</span> <span class="delimiter">{</span>
        def <a title="()Int" id="kafka.network;RequestChannel.<local RequestChannel>.$anonfun;$anon.value">value</a> = <a href="#kafka.network;RequestChannel.responseQueues" title="(i: Int)java.util.concurrent.BlockingQueue[kafka.network.RequestChannel.Response]">responseQueues</a><span class="delimiter">(</span><span title="Int">i</span><span class="delimiter">)</span>.<span title="()Int">size</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>,
      <span title="(elems: (String, String)*)scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">(</span><span title="(self: String)ArrowAssoc[String]" class="string">&quot;processor&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <span title="Int">i</span>.<span title="()String">toString</span><span class="delimiter">)</span>
    <span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Send a request to be handled, potentially blocking until there is room in the queue for the request */</span>
  def <a title="(request: kafka.network.RequestChannel.Request)Unit" id="kafka.network;RequestChannel.sendRequest">sendRequest</a><span class="delimiter">(</span><a title="kafka.network.RequestChannel.Request" id="kafka.network;RequestChannel.sendRequest.request">request</a>: RequestChannel.<a href="#kafka.network.RequestChannel.Request.readResolve" title="kafka.network.RequestChannel.Request">Request</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.network;RequestChannel.requestQueue" title="=&gt; java.util.concurrent.ArrayBlockingQueue[kafka.network.RequestChannel.Request]">requestQueue</a>.<span title="(x$1: kafka.network.RequestChannel.Request)Unit">put</span><span class="delimiter">(</span><a href="#kafka.network;RequestChannel.sendRequest.request" title="kafka.network.RequestChannel.Request">request</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/** Send a response back to the socket server to be sent over the network */</span> 
  def <a title="(response: kafka.network.RequestChannel.Response)Unit" id="kafka.network;RequestChannel.sendResponse">sendResponse</a><span class="delimiter">(</span><a title="kafka.network.RequestChannel.Response" id="kafka.network;RequestChannel.sendResponse.response">response</a>: RequestChannel.<a href="#kafka.network.RequestChannel.Response.readResolve" title="kafka.network.RequestChannel.Response">Response</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.network;RequestChannel.responseQueues" title="(i: Int)java.util.concurrent.BlockingQueue[kafka.network.RequestChannel.Response]">responseQueues</a><span class="delimiter">(</span><a href="#kafka.network;RequestChannel.sendResponse.response" title="kafka.network.RequestChannel.Response">response</a>.<a href="#kafka.network.RequestChannel;Response.processor" title="=&gt; Int">processor</a><span class="delimiter">)</span>.<span title="(x$1: kafka.network.RequestChannel.Response)Unit">put</span><span class="delimiter">(</span><a href="#kafka.network;RequestChannel.sendResponse.response" title="kafka.network.RequestChannel.Response">response</a><span class="delimiter">)</span>
    for<span class="delimiter">(</span><a title="Int =&gt; Unit" id="kafka.network;RequestChannel.sendResponse.$anonfun.onResponse">onResponse</a> &lt;- <a href="#kafka.network;RequestChannel.responseListeners_=" title="(f: (Int =&gt; Unit) =&gt; Unit)Unit">responseListeners</a><span class="delimiter">)</span>
      <a href="#kafka.network;RequestChannel.sendResponse.$anonfun.onResponse" title="(v1: Int)Unit">onResponse</a><span class="delimiter">(</span><a href="#kafka.network;RequestChannel.sendResponse.response" title="kafka.network.RequestChannel.Response">response</a>.<a href="#kafka.network.RequestChannel;Response.processor" title="=&gt; Int">processor</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** No operation to take for the request, need to read more over the network */</span>
  def <a title="(processor: Int, request: kafka.network.RequestChannel.Request)Unit" id="kafka.network;RequestChannel.noOperation">noOperation</a><span class="delimiter">(</span><a title="Int" id="kafka.network;RequestChannel.noOperation.processor">processor</a>: <span title="Int">Int</span>, <a title="kafka.network.RequestChannel.Request" id="kafka.network;RequestChannel.noOperation.request">request</a>: RequestChannel.<a href="#kafka.network.RequestChannel.Request.readResolve" title="kafka.network.RequestChannel.Request">Request</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.network;RequestChannel.responseQueues" title="(i: Int)java.util.concurrent.BlockingQueue[kafka.network.RequestChannel.Response]">responseQueues</a><span class="delimiter">(</span><a href="#kafka.network;RequestChannel.noOperation.processor" title="Int">processor</a><span class="delimiter">)</span>.<span title="(x$1: kafka.network.RequestChannel.Response)Unit">put</span><span class="delimiter">(</span>new <a href="#kafka.network.RequestChannel" title="kafka.network.RequestChannel.type">RequestChannel</a>.<a href="#kafka.network.RequestChannel.Response.readResolve" title="kafka.network.RequestChannel.Response">Response</a><span class="delimiter">(</span><a href="#kafka.network;RequestChannel.noOperation.processor" title="Int">processor</a>, <a href="#kafka.network;RequestChannel.noOperation.request" title="kafka.network.RequestChannel.Request">request</a>, null, <a href="#kafka.network.RequestChannel" title="kafka.network.RequestChannel.type">RequestChannel</a>.<a href="#kafka.network.RequestChannel.NoOpAction.readResolve" title="kafka.network.RequestChannel.NoOpAction.type">NoOpAction</a><span class="delimiter">)</span><span class="delimiter">)</span>
    for<span class="delimiter">(</span><a title="Int =&gt; Unit" id="kafka.network;RequestChannel.noOperation.$anonfun.onResponse">onResponse</a> &lt;- <a href="#kafka.network;RequestChannel.responseListeners_=" title="(f: (Int =&gt; Unit) =&gt; Unit)Unit">responseListeners</a><span class="delimiter">)</span>
      <a href="#kafka.network;RequestChannel.noOperation.$anonfun.onResponse" title="(v1: Int)Unit">onResponse</a><span class="delimiter">(</span><a href="#kafka.network;RequestChannel.noOperation.processor" title="Int">processor</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Close the connection for the request */</span>
  def <a title="(processor: Int, request: kafka.network.RequestChannel.Request)Unit" id="kafka.network;RequestChannel.closeConnection">closeConnection</a><span class="delimiter">(</span><a title="Int" id="kafka.network;RequestChannel.closeConnection.processor">processor</a>: <span title="Int">Int</span>, <a title="kafka.network.RequestChannel.Request" id="kafka.network;RequestChannel.closeConnection.request">request</a>: RequestChannel.<a href="#kafka.network.RequestChannel.Request.readResolve" title="kafka.network.RequestChannel.Request">Request</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.network;RequestChannel.responseQueues" title="(i: Int)java.util.concurrent.BlockingQueue[kafka.network.RequestChannel.Response]">responseQueues</a><span class="delimiter">(</span><a href="#kafka.network;RequestChannel.closeConnection.processor" title="Int">processor</a><span class="delimiter">)</span>.<span title="(x$1: kafka.network.RequestChannel.Response)Unit">put</span><span class="delimiter">(</span>new <a href="#kafka.network.RequestChannel" title="kafka.network.RequestChannel.type">RequestChannel</a>.<a href="#kafka.network.RequestChannel.Response.readResolve" title="kafka.network.RequestChannel.Response">Response</a><span class="delimiter">(</span><a href="#kafka.network;RequestChannel.closeConnection.processor" title="Int">processor</a>, <a href="#kafka.network;RequestChannel.closeConnection.request" title="kafka.network.RequestChannel.Request">request</a>, null, <a href="#kafka.network.RequestChannel" title="kafka.network.RequestChannel.type">RequestChannel</a>.<a href="#kafka.network.RequestChannel.CloseConnectionAction.readResolve" title="kafka.network.RequestChannel.CloseConnectionAction.type">CloseConnectionAction</a><span class="delimiter">)</span><span class="delimiter">)</span>
    for<span class="delimiter">(</span><a title="Int =&gt; Unit" id="kafka.network;RequestChannel.closeConnection.$anonfun.onResponse">onResponse</a> &lt;- <a href="#kafka.network;RequestChannel.responseListeners_=" title="(f: (Int =&gt; Unit) =&gt; Unit)Unit">responseListeners</a><span class="delimiter">)</span>
      <a href="#kafka.network;RequestChannel.closeConnection.$anonfun.onResponse" title="(v1: Int)Unit">onResponse</a><span class="delimiter">(</span><a href="#kafka.network;RequestChannel.closeConnection.processor" title="Int">processor</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Get the next request or block until specified time has elapsed */</span>
  def <a title="(timeout: Long)kafka.network.RequestChannel.Request" id="kafka.network;RequestChannel.receiveRequest(d3967f5061)">receiveRequest</a><span class="delimiter">(</span><a title="Long" id="kafka.network;RequestChannel.receiveRequest(d3967f5061).timeout">timeout</a>: <span title="Long">Long</span><span class="delimiter">)</span>: RequestChannel.<a href="#kafka.network.RequestChannel.Request.readResolve" title="kafka.network.RequestChannel.Request">Request</a> =
    <a href="#kafka.network;RequestChannel.requestQueue" title="=&gt; java.util.concurrent.ArrayBlockingQueue[kafka.network.RequestChannel.Request]">requestQueue</a>.<span title="(x$1: Long, x$2: java.util.concurrent.TimeUnit)kafka.network.RequestChannel.Request">poll</span><span class="delimiter">(</span><a href="#kafka.network;RequestChannel.receiveRequest(d3967f5061).timeout" title="Long">timeout</a>, TimeUnit.<span title="java.util.concurrent.TimeUnit(MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>

  <span class="comment">/** Get the next request or block until there is one */</span>
  def <a title="()kafka.network.RequestChannel.Request" id="kafka.network;RequestChannel.receiveRequest(e813d8c994)">receiveRequest</a><span class="delimiter">(</span><span class="delimiter">)</span>: RequestChannel.<a href="#kafka.network.RequestChannel.Request.readResolve" title="kafka.network.RequestChannel.Request">Request</a> =
    <a href="#kafka.network;RequestChannel.requestQueue" title="=&gt; java.util.concurrent.ArrayBlockingQueue[kafka.network.RequestChannel.Request]">requestQueue</a>.<span title="()kafka.network.RequestChannel.Request">take</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/** Get a response for the given processor if there is one */</span>
  def <a title="(processor: Int)kafka.network.RequestChannel.Response" id="kafka.network;RequestChannel.receiveResponse">receiveResponse</a><span class="delimiter">(</span><a title="Int" id="kafka.network;RequestChannel.receiveResponse.processor">processor</a>: <span title="Int">Int</span><span class="delimiter">)</span>: RequestChannel.<a href="#kafka.network.RequestChannel.Response.readResolve" title="kafka.network.RequestChannel.Response">Response</a> = <span class="delimiter">{</span>
    val <a title="kafka.network.RequestChannel.Response" id="kafka.network;RequestChannel.receiveResponse.response">response</a> = <a href="#kafka.network;RequestChannel.responseQueues" title="(i: Int)java.util.concurrent.BlockingQueue[kafka.network.RequestChannel.Response]">responseQueues</a><span class="delimiter">(</span><a href="#kafka.network;RequestChannel.receiveResponse.processor" title="Int">processor</a><span class="delimiter">)</span>.<span title="()kafka.network.RequestChannel.Response">poll</span><span class="delimiter">(</span><span class="delimiter">)</span>
    if <span class="delimiter">(</span><a href="#kafka.network;RequestChannel.receiveResponse.response" title="kafka.network.RequestChannel.Response">response</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
      <a href="#kafka.network;RequestChannel.receiveResponse.response" title="kafka.network.RequestChannel.Response">response</a>.<a href="#kafka.network.RequestChannel;Response.request" title="=&gt; kafka.network.RequestChannel.Request">request</a>.<a href="#kafka.network.RequestChannel;Request.responseDequeueTimeMs_=" title="(x$1: Long)Unit">responseDequeueTimeMs</a> = <a href="../utils/Time.scala.html#kafka.utils.SystemTime" title="kafka.utils.SystemTime.type">SystemTime</a>.<a href="../utils/Time.scala.html#kafka.utils.SystemTime.milliseconds" title="=&gt; Long">milliseconds</a>
    <a href="#kafka.network;RequestChannel.receiveResponse.response" title="kafka.network.RequestChannel.Response">response</a>
  <span class="delimiter">}</span>

  def <a title="(onResponse: Int =&gt; Unit)Unit" id="kafka.network;RequestChannel.addResponseListener">addResponseListener</a><span class="delimiter">(</span><a title="Int =&gt; Unit" id="kafka.network;RequestChannel.addResponseListener.onResponse">onResponse</a>: Int =&gt; Unit<span class="delimiter">)</span> <span class="delimiter">{</span> 
    <a href="#kafka.network;RequestChannel.responseListeners_=" title="(x$1: List[Int =&gt; Unit])Unit">responseListeners</a> <span title="(x: Int =&gt; Unit)List[Int =&gt; Unit]">::=</span> <a href="#kafka.network;RequestChannel.addResponseListener.onResponse" title="Int =&gt; Unit">onResponse</a>
  <span class="delimiter">}</span>

  def <a title="()Unit" id="kafka.network;RequestChannel.shutdown">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.network;RequestChannel.requestQueue" title="=&gt; java.util.concurrent.ArrayBlockingQueue[kafka.network.RequestChannel.Request]">requestQueue</a>.<span title="()Unit">clear</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

object <a title="kafka.network.RequestMetrics.type" id="kafka.network.RequestMetrics">RequestMetrics</a> <a href="#kafka.network.RequestMetrics" title="kafka.network.RequestMetrics.type" class="delimiter">{</a>
  val <a title="scala.collection.mutable.HashMap[String,kafka.network.RequestMetrics]" id="kafka.network.RequestMetrics.metricsMap">metricsMap</a> = new scala.collection.mutable.<span title="scala.collection.mutable.HashMap[String,kafka.network.RequestMetrics]">HashMap</span><span class="delimiter">[</span>String, RequestMetrics<span class="delimiter">]</span>
  val consumerFetchMetricName = <a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys" title="kafka.api.RequestKeys.type">RequestKeys</a>.<a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys.nameForKey" title="(key: Short)String">nameForKey</a><span class="delimiter">(</span><a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys" title="kafka.api.RequestKeys.type">RequestKeys</a>.<a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys.FetchKey" title="=&gt; Short">FetchKey</a><span class="delimiter">)</span> <a title="String" id="kafka.network.RequestMetrics.consumerFetchMetricName">+</a> <span title="String(&quot;Consumer&quot;)" class="string">&quot;Consumer&quot;</span>
  val followFetchMetricName = <a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys" title="kafka.api.RequestKeys.type">RequestKeys</a>.<a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys.nameForKey" title="(key: Short)String">nameForKey</a><span class="delimiter">(</span><a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys" title="kafka.api.RequestKeys.type">RequestKeys</a>.<a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys.FetchKey" title="=&gt; Short">FetchKey</a><span class="delimiter">)</span> <a title="String" id="kafka.network.RequestMetrics.followFetchMetricName">+</a> <span title="String(&quot;Follower&quot;)" class="string">&quot;Follower&quot;</span>
  <span class="delimiter">(</span><a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys" title="kafka.api.RequestKeys.type">RequestKeys</a>.<a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys.keyToNameAndDeserializerMap" title="=&gt; Map[Short,(String, java.nio.ByteBuffer =&gt; kafka.api.RequestOrResponse)]">keyToNameAndDeserializerMap</a>.<span title="=&gt; Iterable[(String, java.nio.ByteBuffer =&gt; kafka.api.RequestOrResponse)]">values</span>.<span title="(f: ((String, java.nio.ByteBuffer =&gt; kafka.api.RequestOrResponse)) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[(String, java.nio.ByteBuffer =&gt; kafka.api.RequestOrResponse)],String,Iterable[String]])Iterable[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,String,Iterable[String]]" class="delimiter">(</span><a title="(String, java.nio.ByteBuffer =&gt; kafka.api.RequestOrResponse)" id="kafka.network.RequestMetrics.<local RequestMetrics>.$anonfun.e">e</a> =&gt; <a href="#kafka.network.RequestMetrics.<local RequestMetrics>.$anonfun.e" title="(String, java.nio.ByteBuffer =&gt; kafka.api.RequestOrResponse)">e</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span>
    <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[String],String,Iterable[String]])Iterable[String]">++</span> <span title="(xs: String*)List[String]">List</span><span class="delimiter">(</span><a href="#kafka.network.RequestMetrics.consumerFetchMetricName" title="=&gt; String">consumerFetchMetricName</a>, <a href="#kafka.network.RequestMetrics.followFetchMetricName" title="=&gt; String">followFetchMetricName</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: String =&gt; Option[kafka.network.RequestMetrics])Unit">foreach</span><span class="delimiter">(</span><a title="String" id="kafka.network.RequestMetrics.<local RequestMetrics>.$anonfun.name">name</a> =&gt; <a href="#kafka.network.RequestMetrics.metricsMap" title="=&gt; scala.collection.mutable.HashMap[String,kafka.network.RequestMetrics]">metricsMap</a>.<span title="(key: String, value: kafka.network.RequestMetrics)Option[kafka.network.RequestMetrics]">put</span><span class="delimiter">(</span><a href="#kafka.network.RequestMetrics.<local RequestMetrics>.$anonfun.name" title="String">name</a>, new <a href="#kafka.network;RequestMetrics" title="kafka.network.RequestMetrics">RequestMetrics</a><span class="delimiter">(</span><a href="#kafka.network.RequestMetrics.<local RequestMetrics>.$anonfun.name" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

class <a title="class RequestMetrics extends AnyRef with kafka.metrics.KafkaMetricsGroup" id="kafka.network;RequestMetrics">RequestMetrics</a><a href="#kafka.network;RequestMetrics" title="kafka.network.RequestMetrics" class="delimiter">(</a><a title="String" id="kafka.network;RequestMetrics.name">name</a>: <span title="String">String</span><span class="delimiter">)</span> extends <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup" title="kafka.metrics.KafkaMetricsGroup">KafkaMetricsGroup</a> <span class="delimiter">{</span>
  val <a title="scala.collection.immutable.Map[String,String]" id="kafka.network;RequestMetrics.tags">tags</a> = <span title="(elems: (String, String)*)scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">(</span><span title="(self: String)ArrowAssoc[String]" class="string">&quot;request&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.network;RequestMetrics.name" title="String">name</a><span class="delimiter">)</span>
  val <a title="com.yammer.metrics.core.Meter" id="kafka.network;RequestMetrics.requestRate">requestRate</a> = <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newMeter" title="(name: String, eventType: String, timeUnit: java.util.concurrent.TimeUnit, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Meter">newMeter</a><span class="delimiter">(</span><span title="String(&quot;RequestsPerSec&quot;)" class="string">&quot;RequestsPerSec&quot;</span>, <span title="String(&quot;requests&quot;)" class="string">&quot;requests&quot;</span>, TimeUnit.<span title="java.util.concurrent.TimeUnit(SECONDS)">SECONDS</span>, <a href="#kafka.network;RequestMetrics.tags" title="=&gt; scala.collection.immutable.Map[String,String]">tags</a><span class="delimiter">)</span>
  <span class="comment">// time a request spent in a request queue</span>
  val <a title="com.yammer.metrics.core.Histogram" id="kafka.network;RequestMetrics.requestQueueTimeHist">requestQueueTimeHist</a> = <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newHistogram" title="(name: String, biased: Boolean, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Histogram">newHistogram</a><span class="delimiter">(</span><span title="String(&quot;RequestQueueTimeMs&quot;)" class="string">&quot;RequestQueueTimeMs&quot;</span>, biased = true, <a href="#kafka.network;RequestMetrics.tags" title="=&gt; scala.collection.immutable.Map[String,String]">tags</a><span class="delimiter">)</span>
  <span class="comment">// time a request takes to be processed at the local broker</span>
  val <a title="com.yammer.metrics.core.Histogram" id="kafka.network;RequestMetrics.localTimeHist">localTimeHist</a> = <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newHistogram" title="(name: String, biased: Boolean, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Histogram">newHistogram</a><span class="delimiter">(</span><span title="String(&quot;LocalTimeMs&quot;)" class="string">&quot;LocalTimeMs&quot;</span>, biased = true, <a href="#kafka.network;RequestMetrics.tags" title="=&gt; scala.collection.immutable.Map[String,String]">tags</a><span class="delimiter">)</span>
  <span class="comment">// time a request takes to wait on remote brokers (only relevant to fetch and produce requests)</span>
  val <a title="com.yammer.metrics.core.Histogram" id="kafka.network;RequestMetrics.remoteTimeHist">remoteTimeHist</a> = <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newHistogram" title="(name: String, biased: Boolean, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Histogram">newHistogram</a><span class="delimiter">(</span><span title="String(&quot;RemoteTimeMs&quot;)" class="string">&quot;RemoteTimeMs&quot;</span>, biased = true, <a href="#kafka.network;RequestMetrics.tags" title="=&gt; scala.collection.immutable.Map[String,String]">tags</a><span class="delimiter">)</span>
  <span class="comment">// time a response spent in a response queue</span>
  val <a title="com.yammer.metrics.core.Histogram" id="kafka.network;RequestMetrics.responseQueueTimeHist">responseQueueTimeHist</a> = <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newHistogram" title="(name: String, biased: Boolean, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Histogram">newHistogram</a><span class="delimiter">(</span><span title="String(&quot;ResponseQueueTimeMs&quot;)" class="string">&quot;ResponseQueueTimeMs&quot;</span>, biased = true, <a href="#kafka.network;RequestMetrics.tags" title="=&gt; scala.collection.immutable.Map[String,String]">tags</a><span class="delimiter">)</span>
  <span class="comment">// time to send the response to the requester</span>
  val <a title="com.yammer.metrics.core.Histogram" id="kafka.network;RequestMetrics.responseSendTimeHist">responseSendTimeHist</a> = <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newHistogram" title="(name: String, biased: Boolean, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Histogram">newHistogram</a><span class="delimiter">(</span><span title="String(&quot;ResponseSendTimeMs&quot;)" class="string">&quot;ResponseSendTimeMs&quot;</span>, biased = true, <a href="#kafka.network;RequestMetrics.tags" title="=&gt; scala.collection.immutable.Map[String,String]">tags</a><span class="delimiter">)</span>
  val <a title="com.yammer.metrics.core.Histogram" id="kafka.network;RequestMetrics.totalTimeHist">totalTimeHist</a> = <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newHistogram" title="(name: String, biased: Boolean, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Histogram">newHistogram</a><span class="delimiter">(</span><span title="String(&quot;TotalTimeMs&quot;)" class="string">&quot;TotalTimeMs&quot;</span>, biased = true, <a href="#kafka.network;RequestMetrics.tags" title="=&gt; scala.collection.immutable.Map[String,String]">tags</a><span class="delimiter">)</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
