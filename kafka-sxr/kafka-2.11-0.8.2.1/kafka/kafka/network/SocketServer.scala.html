<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>kafka/kafka/network/SocketServer.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

package kafka.network

import java.util
import java.util.concurrent._
import java.util.concurrent.atomic._
import java.net._
import java.io._
import java.nio.channels._

import scala.collection._

import kafka.common.KafkaException
import kafka.metrics.KafkaMetricsGroup
import kafka.utils._
import com.yammer.metrics.core.<span class="delimiter">{</span>Gauge, Meter<span class="delimiter">}</span>

<span class="comment">/**
 * An NIO socket server. The threading model is
 *   1 Acceptor thread that handles new connections
 *   N Processor threads that each have their own selector and read requests from sockets
 *   M Handler threads that handle requests and produce responses back to the processor threads for writing.
 */</span>
class <a title="class SocketServer extends AnyRef with kafka.utils.Logging with kafka.metrics.KafkaMetricsGroup" id="kafka.network.SocketServer">SocketServer</a><a href="#kafka.network.SocketServer" title="kafka.network.SocketServer" class="delimiter">(</a>val <a title="Int" id="kafka.network;SocketServer.brokerId">brokerId</a>: <span title="Int">Int</span>,
                   val <a title="String" id="kafka.network;SocketServer.host">host</a>: <span title="String">String</span>,
                   val <a title="Int" id="kafka.network;SocketServer.port">port</a>: <span title="Int">Int</span>,
                   val <a title="Int" id="kafka.network;SocketServer.numProcessorThreads">numProcessorThreads</a>: <span title="Int">Int</span>,
                   val <a title="Int" id="kafka.network;SocketServer.maxQueuedRequests">maxQueuedRequests</a>: <span title="Int">Int</span>,
                   val <a title="Int" id="kafka.network;SocketServer.sendBufferSize">sendBufferSize</a>: <span title="Int">Int</span>,
                   val <a title="Int" id="kafka.network;SocketServer.recvBufferSize">recvBufferSize</a>: <span title="Int">Int</span>,
                   val <a title="Int" id="kafka.network.SocketServer.<init>$default$8">maxRequestSize</a>: <span title="Int">Int</span> = Int.<span title="Int(2147483647)">MaxValue</span>,
                   val <a title="Int" id="kafka.network.SocketServer.<init>$default$9">maxConnectionsPerIp</a>: <span title="Int">Int</span> = Int.<span title="Int(2147483647)">MaxValue</span>,
                   val <a title="Long" id="kafka.network;SocketServer.connectionsMaxIdleMs">connectionsMaxIdleMs</a>: <span title="Long">Long</span>,
                   val <a title="scala.collection.Map[String,Int]" id="kafka.network;SocketServer.maxConnectionsPerIpOverrides">maxConnectionsPerIpOverrides</a>: <span title="scala.collection.Map[String,Int]">Map</span><span class="delimiter">[</span>String, Int<span class="delimiter">]</span> <span class="delimiter">)</span> extends <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> with <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup" title="kafka.metrics.KafkaMetricsGroup">KafkaMetricsGroup</a> <span class="delimiter">{</span>
  this.<a href="../utils/Logging.scala.html#kafka.utils;Logging.logIdent_=" title="(x$1: String)Unit">logIdent</a> = <span title="String(&quot;[Socket Server on Broker &quot;)" class="string">&quot;[Socket Server on Broker &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;SocketServer.brokerId" title="=&gt; Int">brokerId</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;], &quot;)" class="string">&quot;], &quot;</span>
  private val <a title="kafka.utils.SystemTime.type" id="kafka.network;SocketServer.time">time</a> = <a href="../utils/Time.scala.html#kafka.utils.SystemTime" title="kafka.utils.SystemTime.type">SystemTime</a>
  private val <a title="Array[kafka.network.Processor]" id="kafka.network;SocketServer.processors">processors</a> = new <span title="Array[kafka.network.Processor]">Array</span><span class="delimiter">[</span>Processor<span class="delimiter">]</span><span class="delimiter">(</span><a href="#kafka.network;SocketServer.numProcessorThreads" title="=&gt; Int">numProcessorThreads</a><span class="delimiter">)</span>
  @volatile private var <a title="kafka.network.Acceptor" id="kafka.network;SocketServer.acceptor_=">acceptor</a>: <a href="#kafka.network;Acceptor" title="kafka.network.Acceptor">Acceptor</a> = null
  val <a title="kafka.network.RequestChannel" id="kafka.network;SocketServer.requestChannel">requestChannel</a> = new <a href="RequestChannel.scala.html#kafka.network;RequestChannel" title="kafka.network.RequestChannel">RequestChannel</a><span class="delimiter">(</span><a href="#kafka.network;SocketServer.numProcessorThreads" title="=&gt; Int">numProcessorThreads</a>, <a href="#kafka.network;SocketServer.maxQueuedRequests" title="=&gt; Int">maxQueuedRequests</a><span class="delimiter">)</span>

  <span class="comment">/* a meter to track the average free capacity of the network processors */</span>
  private val <a title="com.yammer.metrics.core.Meter" id="kafka.network;SocketServer.aggregateIdleMeter">aggregateIdleMeter</a> = <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newMeter" title="(name: String, eventType: String, timeUnit: java.util.concurrent.TimeUnit, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Meter">newMeter</a><span class="delimiter">(</span><span title="String(&quot;NetworkProcessorAvgIdlePercent&quot;)" class="string">&quot;NetworkProcessorAvgIdlePercent&quot;</span>, <span title="String(&quot;percent&quot;)" class="string">&quot;percent&quot;</span>, TimeUnit.<span title="java.util.concurrent.TimeUnit(NANOSECONDS)">NANOSECONDS</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Start the socket server
   */</span>
  def <a title="()Unit" id="kafka.network;SocketServer.startup">startup</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    val <a title="kafka.network.ConnectionQuotas" id="kafka.network;SocketServer.startup.quotas">quotas</a> = new <a href="#kafka.network;ConnectionQuotas" title="kafka.network.ConnectionQuotas">ConnectionQuotas</a><span class="delimiter">(</span><a href="#kafka.network.SocketServer.<init>$default$9" title="=&gt; Int">maxConnectionsPerIp</a>, <a href="#kafka.network;SocketServer.maxConnectionsPerIpOverrides" title="=&gt; scala.collection.Map[String,Int]">maxConnectionsPerIpOverrides</a><span class="delimiter">)</span>
    for<span class="delimiter">(</span><a title="Int" id="kafka.network;SocketServer.startup.$anonfun.i">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(f: Int =&gt; Unit)Unit">until</span> <a href="#kafka.network;SocketServer.numProcessorThreads" title="=&gt; Int">numProcessorThreads</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#kafka.network;SocketServer.processors" title="(i: Int, x: kafka.network.Processor)Unit">processors</a><span class="delimiter">(</span><a href="#kafka.network;SocketServer.startup.$anonfun.i" title="Int">i</a><span class="delimiter">)</span> = new <a href="#kafka.network;Processor" title="kafka.network.Processor">Processor</a><span class="delimiter">(</span><a href="#kafka.network;SocketServer.startup.$anonfun.i" title="Int">i</a>, 
                                    <a href="#kafka.network;SocketServer.time" title="=&gt; kafka.utils.SystemTime.type">time</a>, 
                                    <a href="#kafka.network.SocketServer.<init>$default$8" title="=&gt; Int">maxRequestSize</a>, 
                                    <a href="#kafka.network;SocketServer.aggregateIdleMeter" title="=&gt; com.yammer.metrics.core.Meter">aggregateIdleMeter</a>,
                                    <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newMeter" title="(name: String, eventType: String, timeUnit: java.util.concurrent.TimeUnit, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Meter">newMeter</a><span class="delimiter">(</span><span title="String(&quot;IdlePercent&quot;)" class="string">&quot;IdlePercent&quot;</span>, <span title="String(&quot;percent&quot;)" class="string">&quot;percent&quot;</span>, TimeUnit.<span title="java.util.concurrent.TimeUnit(NANOSECONDS)">NANOSECONDS</span>, <span title="(elems: (String, String)*)scala.collection.Map[String,String]">Map</span><span class="delimiter">(</span><span title="(self: String)ArrowAssoc[String]" class="string">&quot;networkProcessor&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.network;SocketServer.startup.$anonfun.i" title="Int">i</a>.<span title="()String">toString</span><span class="delimiter">)</span><span class="delimiter">)</span>,
                                    <a href="#kafka.network;SocketServer.numProcessorThreads" title="=&gt; Int">numProcessorThreads</a>, 
                                    <a href="#kafka.network;SocketServer.requestChannel" title="=&gt; kafka.network.RequestChannel">requestChannel</a>,
                                    <a href="#kafka.network;SocketServer.startup.quotas" title="kafka.network.ConnectionQuotas">quotas</a>,
                                    <a href="#kafka.network;SocketServer.connectionsMaxIdleMs" title="=&gt; Long">connectionsMaxIdleMs</a><span class="delimiter">)</span>
      <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Utils.scala.html#kafka.utils.Utils.newThread(dc18ba96a6)" title="(name: String, runnable: Runnable, daemon: Boolean)Thread">newThread</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;kafka-network-thread-%d-%d&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.network;SocketServer.port" title="=&gt; Int">port</a>, <a href="#kafka.network;SocketServer.startup.$anonfun.i" title="Int">i</a><span class="delimiter">)</span>, <a href="#kafka.network;SocketServer.processors" title="(i: Int)kafka.network.Processor">processors</a><span class="delimiter">(</span><a href="#kafka.network;SocketServer.startup.$anonfun.i" title="Int">i</a><span class="delimiter">)</span>, false<span class="delimiter">)</span>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newGauge" title="(name: String, metric: com.yammer.metrics.core.Gauge[Int], tags: scala.collection.Map[String,String])com.yammer.metrics.core.Gauge[Int]">newGauge</a><span class="delimiter">(</span><span title="String(&quot;ResponsesBeingSent&quot;)" class="string">&quot;ResponsesBeingSent&quot;</span>, new <a title="&lt;$anon: com.yammer.metrics.core.Gauge[Int]&gt; extends com.yammer.metrics.core.Gauge[Int]" id="kafka.network;SocketServer.startup;$anon">Gauge</a><span class="delimiter">[</span>Int<span class="delimiter">]</span> <span class="delimiter">{</span>
      def <a title="()Int" id="kafka.network;SocketServer.startup;$anon.value">value</a> = <a href="#kafka.network;SocketServer.processors" title="(xs: Array[kafka.network.Processor])scala.collection.mutable.ArrayOps[kafka.network.Processor]">processors</a>.<span title="(z: Int)(op: (Int, kafka.network.Processor) =&gt; Int)Int">foldLeft</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="Int" id="kafka.network;SocketServer.startup;$anon.value.$anonfun.total">total</a>, <a title="kafka.network.Processor" id="kafka.network;SocketServer.startup;$anon.value.$anonfun.p">p</a><span class="delimiter">)</span> =&gt; <a href="#kafka.network;SocketServer.startup;$anon.value.$anonfun.total" title="Int">total</a> <span title="(x: Int)Int">+</span> <a href="#kafka.network;SocketServer.startup;$anon.value.$anonfun.p" title="kafka.network.Processor">p</a>.<a href="#kafka.network;AbstractServerThread.countInterestOps" title="(ops: Int)Int">countInterestOps</a><span class="delimiter">(</span>SelectionKey.<span title="Int(4)">OP_WRITE</span><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <span class="comment">// register the processor threads for notification of responses</span>
    <a href="#kafka.network;SocketServer.requestChannel" title="=&gt; kafka.network.RequestChannel">requestChannel</a>.<a href="RequestChannel.scala.html#kafka.network;RequestChannel.addResponseListener" title="(onResponse: Int =&gt; Unit)Unit">addResponseListener</a><span class="delimiter">(</span><span class="delimiter">(</span>id:<span title="Int">Int</span><span class="delimiter">)</span> =&gt; <a href="#kafka.network;SocketServer.processors" title="(i: Int)kafka.network.Processor">processors</a><span class="delimiter">(</span><a href="#kafka.network;SocketServer.startup.$anonfun.id" title="Int">id</a><span class="delimiter">)</span>.<a href="#kafka.network;AbstractServerThread.wakeup" title="()java.nio.channels.Selector">wakeup</a><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
   
    <span class="comment">// start accepting connections</span>
    this.<a href="#kafka.network;SocketServer.acceptor_=" title="(x$1: kafka.network.Acceptor)Unit">acceptor</a> = new <a href="#kafka.network;Acceptor" title="kafka.network.Acceptor">Acceptor</a><span class="delimiter">(</span><a href="#kafka.network;SocketServer.host" title="=&gt; String">host</a>, <a href="#kafka.network;SocketServer.port" title="=&gt; Int">port</a>, <a href="#kafka.network;SocketServer.processors" title="=&gt; Array[kafka.network.Processor]">processors</a>, <a href="#kafka.network;SocketServer.sendBufferSize" title="=&gt; Int">sendBufferSize</a>, <a href="#kafka.network;SocketServer.recvBufferSize" title="=&gt; Int">recvBufferSize</a>, <a href="#kafka.network;SocketServer.startup.quotas" title="kafka.network.ConnectionQuotas">quotas</a><span class="delimiter">)</span>
    <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Utils.scala.html#kafka.utils.Utils.newThread(dc18ba96a6)" title="(name: String, runnable: Runnable, daemon: Boolean)Thread">newThread</a><span class="delimiter">(</span><span title="String(&quot;kafka-socket-acceptor&quot;)" class="string">&quot;kafka-socket-acceptor&quot;</span>, <a href="#kafka.network;SocketServer.acceptor_=" title="=&gt; kafka.network.Acceptor">acceptor</a>, false<span class="delimiter">)</span>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#kafka.network;SocketServer.acceptor_=" title="=&gt; kafka.network.Acceptor">acceptor</a>.<a href="#kafka.network;AbstractServerThread.awaitStartup" title="()Unit">awaitStartup</a>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Started&quot;)" class="string">&quot;Started&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Shutdown the socket server
   */</span>
  def <a title="()Unit" id="kafka.network;SocketServer.shutdown">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Shutting down&quot;)" class="string">&quot;Shutting down&quot;</span><span class="delimiter">)</span>
    if<span class="delimiter">(</span><a href="#kafka.network;SocketServer.acceptor_=" title="=&gt; kafka.network.Acceptor">acceptor</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
      <a href="#kafka.network;SocketServer.acceptor_=" title="=&gt; kafka.network.Acceptor">acceptor</a>.<a href="#kafka.network;AbstractServerThread.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
    for<span class="delimiter">(</span><a title="kafka.network.Processor" id="kafka.network;SocketServer.shutdown.$anonfun.processor">processor</a> &lt;- <a href="#kafka.network;SocketServer.processors" title="(f: kafka.network.Processor =&gt; Unit)Unit">processors</a><span class="delimiter">)</span>
      <a href="#kafka.network;SocketServer.shutdown.$anonfun.processor" title="kafka.network.Processor">processor</a>.<a href="#kafka.network;AbstractServerThread.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Shutdown completed&quot;)" class="string">&quot;Shutdown completed&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * A base class with some helper variables and methods
 */</span>
private<span class="delimiter">[</span>kafka<span class="delimiter">]</span> abstract class <a title="class AbstractServerThread extends Object with Runnable with kafka.utils.Logging" id="kafka.network;AbstractServerThread">AbstractServerThread</a><a href="#kafka.network;AbstractServerThread" title="kafka.network.AbstractServerThread" class="delimiter">(</a><a title="kafka.network.ConnectionQuotas" id="kafka.network;AbstractServerThread.connectionQuotas">connectionQuotas</a>: <a href="#kafka.network;ConnectionQuotas" title="kafka.network.ConnectionQuotas">ConnectionQuotas</a><span class="delimiter">)</span> extends <a href="#kafka.network;AbstractServerThread" title="Runnable">Runnable</a> with <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> <span class="delimiter">{</span>

  protected val <a title="java.nio.channels.Selector" id="kafka.network;AbstractServerThread.selector">selector</a> = <span title="java.nio.channels.Selector.type">Selector</span>.<span title="()java.nio.channels.Selector">open</span><span class="delimiter">(</span><span class="delimiter">)</span>;
  private val <a title="java.util.concurrent.CountDownLatch" id="kafka.network;AbstractServerThread.startupLatch">startupLatch</a> = new <span title="java.util.concurrent.CountDownLatch">CountDownLatch</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
  private val <a title="java.util.concurrent.CountDownLatch" id="kafka.network;AbstractServerThread.shutdownLatch">shutdownLatch</a> = new <span title="java.util.concurrent.CountDownLatch">CountDownLatch</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
  private val <a title="java.util.concurrent.atomic.AtomicBoolean" id="kafka.network;AbstractServerThread.alive">alive</a> = new <span title="java.util.concurrent.atomic.AtomicBoolean">AtomicBoolean</span><span class="delimiter">(</span>true<span class="delimiter">)</span>

  <span class="comment">/**
   * Initiates a graceful shutdown by signaling to stop and waiting for the shutdown to complete
   */</span>
  def <a title="()Unit" id="kafka.network;AbstractServerThread.shutdown">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#kafka.network;AbstractServerThread.alive" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">alive</a>.<span title="(x$1: Boolean)Unit">set</span><span class="delimiter">(</span>false<span class="delimiter">)</span>
    <a href="#kafka.network;AbstractServerThread.selector" title="=&gt; java.nio.channels.Selector">selector</a>.<span title="()java.nio.channels.Selector">wakeup</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#kafka.network;AbstractServerThread.shutdownLatch" title="=&gt; java.util.concurrent.CountDownLatch">shutdownLatch</a>.<span title="()Unit">await</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Wait for the thread to completely start up
   */</span>
  def <a title="()Unit" id="kafka.network;AbstractServerThread.awaitStartup">awaitStartup</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#kafka.network;AbstractServerThread.startupLatch" title="=&gt; java.util.concurrent.CountDownLatch">startupLatch</a>.<span title="()Unit">await</span>

  <span class="comment">/**
   * Record that the thread startup is complete
   */</span>
  protected def <a title="()Unit" id="kafka.network;AbstractServerThread.startupComplete">startupComplete</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#kafka.network;AbstractServerThread.startupLatch" title="=&gt; java.util.concurrent.CountDownLatch">startupLatch</a>.<span title="()Unit">countDown</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Record that the thread shutdown is complete
   */</span>
  protected def <a title="()Unit" id="kafka.network;AbstractServerThread.shutdownComplete">shutdownComplete</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#kafka.network;AbstractServerThread.shutdownLatch" title="=&gt; java.util.concurrent.CountDownLatch">shutdownLatch</a>.<span title="()Unit">countDown</span>

  <span class="comment">/**
   * Is the server still running?
   */</span>
  protected def <a title="=&gt; Boolean" id="kafka.network;AbstractServerThread.isRunning">isRunning</a> = <a href="#kafka.network;AbstractServerThread.alive" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">alive</a>.<span title="()Boolean">get</span>
  
  <span class="comment">/**
   * Wakeup the thread for selection.
   */</span>
  def <a title="()java.nio.channels.Selector" id="kafka.network;AbstractServerThread.wakeup">wakeup</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#kafka.network;AbstractServerThread.selector" title="=&gt; java.nio.channels.Selector">selector</a>.<span title="()java.nio.channels.Selector">wakeup</span><span class="delimiter">(</span><span class="delimiter">)</span>
  
  <span class="comment">/**
   * Close the given key and associated socket
   */</span>
  def <a title="(key: java.nio.channels.SelectionKey)Unit" id="kafka.network;AbstractServerThread.close(29a247936b)">close</a><span class="delimiter">(</span><a title="java.nio.channels.SelectionKey" id="kafka.network;AbstractServerThread.close(29a247936b).key">key</a>: <span title="java.nio.channels.SelectionKey">SelectionKey</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    if<span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.close(29a247936b).key" title="java.nio.channels.SelectionKey">key</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#kafka.network;AbstractServerThread.close(29a247936b).key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Any)Object">attach</span><span class="delimiter">(</span>null<span class="delimiter">)</span>
      <a href="#kafka.network;AbstractServerThread.close(d3e893404e)" title="(channel: java.nio.channels.SocketChannel)Unit">close</a><span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.close(29a247936b).key" title="java.nio.channels.SelectionKey">key</a>.<span title="()java.nio.channels.SelectableChannel">channel</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="java.nio.channels.SocketChannel" class="delimiter">[</span><span title="java.nio.channels.SocketChannel">SocketChannel</span><span class="delimiter">]</span><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.swallowError" title="(action: =&gt; Unit)Unit">swallowError</a><span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.close(29a247936b).key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Unit">cancel</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  def <a title="(channel: java.nio.channels.SocketChannel)Unit" id="kafka.network;AbstractServerThread.close(d3e893404e)">close</a><span class="delimiter">(</span><a title="java.nio.channels.SocketChannel" id="kafka.network;AbstractServerThread.close(d3e893404e).channel">channel</a>: <span title="java.nio.channels.SocketChannel">SocketChannel</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    if<span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.close(d3e893404e).channel" title="java.nio.channels.SocketChannel">channel</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Closing connection from &quot;)" class="string">&quot;Closing connection from &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;AbstractServerThread.close(d3e893404e).channel" title="java.nio.channels.SocketChannel">channel</a>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.SocketAddress">getRemoteSocketAddress</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#kafka.network;AbstractServerThread.connectionQuotas" title="kafka.network.ConnectionQuotas">connectionQuotas</a>.<a href="#kafka.network;ConnectionQuotas.dec" title="(addr: java.net.InetAddress)Unit">dec</a><span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.close(d3e893404e).channel" title="java.nio.channels.SocketChannel">channel</a>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.InetAddress">getInetAddress</span><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.swallowError" title="(action: =&gt; Unit)Unit">swallowError</a><span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.close(d3e893404e).channel" title="java.nio.channels.SocketChannel">channel</a>.<span title="()java.net.Socket">socket</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.swallowError" title="(action: =&gt; Unit)Unit">swallowError</a><span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.close(d3e893404e).channel" title="java.nio.channels.SocketChannel">channel</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/**
   * Close all open connections
   */</span>
  def <a title="()Unit" id="kafka.network;AbstractServerThread.closeAll">closeAll</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="comment">// removes cancelled keys from selector.keys set</span>
    this.<a href="#kafka.network;AbstractServerThread.selector" title="=&gt; java.nio.channels.Selector">selector</a>.<span title="()Int">selectNow</span><span class="delimiter">(</span><span class="delimiter">)</span> 
    val <a title="java.util.Iterator[java.nio.channels.SelectionKey]" id="kafka.network;AbstractServerThread.closeAll.iter">iter</a> = this.<a href="#kafka.network;AbstractServerThread.selector" title="=&gt; java.nio.channels.Selector">selector</a>.<span title="()java.util.Set[java.nio.channels.SelectionKey]">keys</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.util.Iterator[java.nio.channels.SelectionKey]">iterator</span><span class="delimiter">(</span><span class="delimiter">)</span>
    while <span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.closeAll.iter" title="java.util.Iterator[java.nio.channels.SelectionKey]">iter</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <a href="#kafka.network;AbstractServerThread.closeAll.while$1" title="()Unit" class="delimiter">{</a>
      val <a title="java.nio.channels.SelectionKey" id="kafka.network;AbstractServerThread.closeAll.key">key</a> = <a href="#kafka.network;AbstractServerThread.closeAll.iter" title="java.util.Iterator[java.nio.channels.SelectionKey]">iter</a>.<span title="()java.nio.channels.SelectionKey">next</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#kafka.network;AbstractServerThread.close(29a247936b)" title="(key: java.nio.channels.SelectionKey)Unit">close</a><span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.closeAll.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(ops: Int)Int" id="kafka.network;AbstractServerThread.countInterestOps">countInterestOps</a><span class="delimiter">(</span><a title="Int" id="kafka.network;AbstractServerThread.countInterestOps.ops">ops</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    var <a title="Int" id="kafka.network;AbstractServerThread.countInterestOps.count">count</a> = <span title="Int(0)" class="int">0</span>
    val <a title="java.util.Iterator[java.nio.channels.SelectionKey]" id="kafka.network;AbstractServerThread.countInterestOps.it">it</a> = this.<a href="#kafka.network;AbstractServerThread.selector" title="=&gt; java.nio.channels.Selector">selector</a>.<span title="()java.util.Set[java.nio.channels.SelectionKey]">keys</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.util.Iterator[java.nio.channels.SelectionKey]">iterator</span><span class="delimiter">(</span><span class="delimiter">)</span>
    while <span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.countInterestOps.it" title="java.util.Iterator[java.nio.channels.SelectionKey]">it</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      if <span class="delimiter">(</span><span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.countInterestOps.it" title="java.util.Iterator[java.nio.channels.SelectionKey]">it</a>.<span title="()java.nio.channels.SelectionKey">next</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Int">interestOps</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Int">&amp;</span> <a href="#kafka.network;AbstractServerThread.countInterestOps.ops" title="Int">ops</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#kafka.network;AbstractServerThread.countInterestOps.count" title="Int">count</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#kafka.network;AbstractServerThread.countInterestOps.count" title="Int">count</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Thread that accepts and configures new connections. There is only need for one of these
 */</span>
private<span class="delimiter">[</span>kafka<span class="delimiter">]</span> class <a title="class Acceptor extends kafka.network.AbstractServerThread" id="kafka.network;Acceptor">Acceptor</a><a href="#kafka.network;Acceptor" title="kafka.network.Acceptor" class="delimiter">(</a>val <a title="String" id="kafka.network;Acceptor.host">host</a>: <span title="String">String</span>, 
                              val <a title="Int" id="kafka.network;Acceptor.port">port</a>: <span title="Int">Int</span>, 
                              private val <a title="Array[kafka.network.Processor]" id="kafka.network;Acceptor.processors">processors</a>: <span title="Array[kafka.network.Processor]">Array</span><span class="delimiter">[</span>Processor<span class="delimiter">]</span>,
                              val <a title="Int" id="kafka.network;Acceptor.sendBufferSize">sendBufferSize</a>: <span title="Int">Int</span>, 
                              val <a title="Int" id="kafka.network;Acceptor.recvBufferSize">recvBufferSize</a>: <span title="Int">Int</span>,
                              <a title="kafka.network.ConnectionQuotas" id="kafka.network;Acceptor.connectionQuotas">connectionQuotas</a>: <a href="#kafka.network;ConnectionQuotas" title="kafka.network.ConnectionQuotas">ConnectionQuotas</a><span class="delimiter">)</span> extends <a href="#kafka.network;AbstractServerThread" title="kafka.network.AbstractServerThread">AbstractServerThread</a><span class="delimiter">(</span><a href="#kafka.network;Acceptor.connectionQuotas" title="kafka.network.ConnectionQuotas">connectionQuotas</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  val <a title="java.nio.channels.ServerSocketChannel" id="kafka.network;Acceptor.serverChannel">serverChannel</a> = <a href="#kafka.network;Acceptor.openServerSocket" title="(host: String, port: Int)java.nio.channels.ServerSocketChannel">openServerSocket</a><span class="delimiter">(</span><a href="#kafka.network;Acceptor.host" title="=&gt; String">host</a>, <a href="#kafka.network;Acceptor.port" title="=&gt; Int">port</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Accept loop that checks for new connection attempts
   */</span>
  def <a title="()Unit" id="kafka.network;Acceptor.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.network;Acceptor.serverChannel" title="=&gt; java.nio.channels.ServerSocketChannel">serverChannel</a>.<span title="(x$1: java.nio.channels.Selector, x$2: Int)java.nio.channels.SelectionKey">register</span><span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.selector" title="=&gt; java.nio.channels.Selector">selector</a>, SelectionKey.<span title="Int(16)">OP_ACCEPT</span><span class="delimiter">)</span>;
    <a href="#kafka.network;AbstractServerThread.startupComplete" title="()Unit">startupComplete</a><span class="delimiter">(</span><span class="delimiter">)</span>
    var <a title="Int" id="kafka.network;Acceptor.run.currentProcessor">currentProcessor</a> = <span title="Int(0)" class="int">0</span>
    while<span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.isRunning" title="=&gt; Boolean">isRunning</a><span class="delimiter">)</span> <a href="#kafka.network;Acceptor.run.while$4" title="()Unit" class="delimiter">{</a>
      val <a title="Int" id="kafka.network;Acceptor.run.ready">ready</a> = <a href="#kafka.network;AbstractServerThread.selector" title="=&gt; java.nio.channels.Selector">selector</a>.<span title="(x$1: Long)Int">select</span><span class="delimiter">(</span><span title="Long(500L)" class="int">500</span><span class="delimiter">)</span>
      if<span class="delimiter">(</span><a href="#kafka.network;Acceptor.run.ready" title="Int">ready</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        val <a title="java.util.Set[java.nio.channels.SelectionKey]" id="kafka.network;Acceptor.run.keys">keys</a> = <a href="#kafka.network;AbstractServerThread.selector" title="=&gt; java.nio.channels.Selector">selector</a>.<span title="()java.util.Set[java.nio.channels.SelectionKey]">selectedKeys</span><span class="delimiter">(</span><span class="delimiter">)</span>
        val <a title="java.util.Iterator[java.nio.channels.SelectionKey]" id="kafka.network;Acceptor.run.iter">iter</a> = <a href="#kafka.network;Acceptor.run.keys" title="java.util.Set[java.nio.channels.SelectionKey]">keys</a>.<span title="()java.util.Iterator[java.nio.channels.SelectionKey]">iterator</span><span class="delimiter">(</span><span class="delimiter">)</span>
        while<span class="delimiter">(</span><a href="#kafka.network;Acceptor.run.iter" title="java.util.Iterator[java.nio.channels.SelectionKey]">iter</a>.<span title="()Boolean">hasNext</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#kafka.network;AbstractServerThread.isRunning" title="=&gt; Boolean">isRunning</a><span class="delimiter">)</span> <a href="#kafka.network;Acceptor.run.while$3" title="()Unit" class="delimiter">{</a>
          var <a title="java.nio.channels.SelectionKey" id="kafka.network;Acceptor.run.key">key</a>: <span title="java.nio.channels.SelectionKey">SelectionKey</span> = null
          try <span class="delimiter">{</span>
            <a href="#kafka.network;Acceptor.run.key" title="java.nio.channels.SelectionKey">key</a> = <a href="#kafka.network;Acceptor.run.iter" title="java.util.Iterator[java.nio.channels.SelectionKey]">iter</a>.<span title="()java.nio.channels.SelectionKey">next</span>
            <a href="#kafka.network;Acceptor.run.iter" title="java.util.Iterator[java.nio.channels.SelectionKey]">iter</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
            if<span class="delimiter">(</span><a href="#kafka.network;Acceptor.run.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Boolean">isAcceptable</span><span class="delimiter">)</span>
               <a href="#kafka.network;Acceptor.accept" title="(key: java.nio.channels.SelectionKey, processor: kafka.network.Processor)Unit">accept</a><span class="delimiter">(</span><a href="#kafka.network;Acceptor.run.key" title="java.nio.channels.SelectionKey">key</a>, <a href="#kafka.network;Acceptor.processors" title="(i: Int)kafka.network.Processor">processors</a><span class="delimiter">(</span><a href="#kafka.network;Acceptor.run.currentProcessor" title="Int">currentProcessor</a><span class="delimiter">)</span><span class="delimiter">)</span>
            else
               throw new <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;Unrecognized key state for acceptor thread.&quot;)" class="string">&quot;Unrecognized key state for acceptor thread.&quot;</span><span class="delimiter">)</span>

            <span class="comment">// round robin to the next processor thread</span>
            <a href="#kafka.network;Acceptor.run.currentProcessor" title="Int">currentProcessor</a> = <span class="delimiter">(</span><a href="#kafka.network;Acceptor.run.currentProcessor" title="Int">currentProcessor</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(x: Int)Int">%</span> <a href="#kafka.network;Acceptor.processors" title="=&gt; Array[kafka.network.Processor]">processors</a>.<span title="=&gt; Int">length</span>
          <span class="delimiter">}</span> catch <span class="delimiter">{</span>
            case <a title="Throwable" id="kafka.network;Acceptor.run.e">e</a>: <span title="Throwable">Throwable</span> =&gt; <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;Error while accepting connection&quot;)" class="string">&quot;Error while accepting connection&quot;</span>, <a href="#kafka.network;Acceptor.run.e" title="Throwable">e</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Closing server socket and selector.&quot;)" class="string">&quot;Closing server socket and selector.&quot;</span><span class="delimiter">)</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.swallowError" title="(action: =&gt; Unit)Unit">swallowError</a><span class="delimiter">(</span><a href="#kafka.network;Acceptor.serverChannel" title="=&gt; java.nio.channels.ServerSocketChannel">serverChannel</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.swallowError" title="(action: =&gt; Unit)Unit">swallowError</a><span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.selector" title="=&gt; java.nio.channels.Selector">selector</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#kafka.network;AbstractServerThread.shutdownComplete" title="()Unit">shutdownComplete</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/*
   * Create a server socket to listen for connections on.
   */</span>
  def <a title="(host: String, port: Int)java.nio.channels.ServerSocketChannel" id="kafka.network;Acceptor.openServerSocket">openServerSocket</a><span class="delimiter">(</span><a title="String" id="kafka.network;Acceptor.openServerSocket.host">host</a>: <span title="String">String</span>, <a title="Int" id="kafka.network;Acceptor.openServerSocket.port">port</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="java.nio.channels.ServerSocketChannel">ServerSocketChannel</span> = <span class="delimiter">{</span>
    val <a title="java.net.InetSocketAddress" id="kafka.network;Acceptor.openServerSocket.socketAddress">socketAddress</a> = 
      if<span class="delimiter">(</span><a href="#kafka.network;Acceptor.openServerSocket.host" title="String">host</a> <span title="(x$1: Any)Boolean">==</span> null <span title="(x: Boolean)Boolean">||</span> <a href="#kafka.network;Acceptor.openServerSocket.host" title="String">host</a>.<span title="()String">trim</span>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span>
        new <span title="java.net.InetSocketAddress">InetSocketAddress</span><span class="delimiter">(</span><a href="#kafka.network;Acceptor.openServerSocket.port" title="Int">port</a><span class="delimiter">)</span>
      else
        new <span title="java.net.InetSocketAddress">InetSocketAddress</span><span class="delimiter">(</span><a href="#kafka.network;Acceptor.openServerSocket.host" title="String">host</a>, <a href="#kafka.network;Acceptor.openServerSocket.port" title="Int">port</a><span class="delimiter">)</span>
    val <a title="java.nio.channels.ServerSocketChannel" id="kafka.network;Acceptor.openServerSocket.serverChannel">serverChannel</a> = <span title="java.nio.channels.ServerSocketChannel.type">ServerSocketChannel</span>.<span title="()java.nio.channels.ServerSocketChannel">open</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#kafka.network;Acceptor.openServerSocket.serverChannel" title="java.nio.channels.ServerSocketChannel">serverChannel</a>.<span title="(x$1: Boolean)java.nio.channels.SelectableChannel">configureBlocking</span><span class="delimiter">(</span>false<span class="delimiter">)</span>
    <a href="#kafka.network;Acceptor.openServerSocket.serverChannel" title="java.nio.channels.ServerSocketChannel">serverChannel</a>.<span title="()java.net.ServerSocket">socket</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Int)Unit">setReceiveBufferSize</span><span class="delimiter">(</span><a href="#kafka.network;Acceptor.recvBufferSize" title="=&gt; Int">recvBufferSize</a><span class="delimiter">)</span>
    try <span class="delimiter">{</span>
      <a href="#kafka.network;Acceptor.openServerSocket.serverChannel" title="java.nio.channels.ServerSocketChannel">serverChannel</a>.<span title="()java.net.ServerSocket">socket</span>.<span title="(x$1: java.net.SocketAddress)Unit">bind</span><span class="delimiter">(</span><a href="#kafka.network;Acceptor.openServerSocket.socketAddress" title="java.net.InetSocketAddress">socketAddress</a><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Awaiting socket connections on %s:%d.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.network;Acceptor.openServerSocket.socketAddress" title="java.net.InetSocketAddress">socketAddress</a>.<span title="()String">getHostName</span>, <a href="#kafka.network;Acceptor.openServerSocket.port" title="Int">port</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> catch <span class="delimiter">{</span>
      case <a title="java.net.SocketException" id="kafka.network;Acceptor.openServerSocket.e">e</a>: <span title="java.net.SocketException">SocketException</span> =&gt; 
        throw new <a href="../common/KafkaException.scala.html#kafka.common;KafkaException" title="kafka.common.KafkaException">KafkaException</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Socket server failed to bind to %s:%d: %s.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.network;Acceptor.openServerSocket.socketAddress" title="java.net.InetSocketAddress">socketAddress</a>.<span title="()String">getHostName</span>, <a href="#kafka.network;Acceptor.openServerSocket.port" title="Int">port</a>, <a href="#kafka.network;Acceptor.openServerSocket.e" title="java.net.SocketException">e</a>.<span title="()String">getMessage</span><span class="delimiter">)</span>, <a href="#kafka.network;Acceptor.openServerSocket.e" title="java.net.SocketException">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#kafka.network;Acceptor.openServerSocket.serverChannel" title="java.nio.channels.ServerSocketChannel">serverChannel</a>
  <span class="delimiter">}</span>

  <span class="comment">/*
   * Accept a new connection
   */</span>
  def <a title="(key: java.nio.channels.SelectionKey, processor: kafka.network.Processor)Unit" id="kafka.network;Acceptor.accept">accept</a><span class="delimiter">(</span><a title="java.nio.channels.SelectionKey" id="kafka.network;Acceptor.accept.key">key</a>: <span title="java.nio.channels.SelectionKey">SelectionKey</span>, <a title="kafka.network.Processor" id="kafka.network;Acceptor.accept.processor">processor</a>: <a href="#kafka.network;Processor" title="kafka.network.Processor">Processor</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    val <a title="java.nio.channels.ServerSocketChannel" id="kafka.network;Acceptor.accept.serverSocketChannel">serverSocketChannel</a> = <a href="#kafka.network;Acceptor.accept.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()java.nio.channels.SelectableChannel">channel</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="java.nio.channels.ServerSocketChannel" class="delimiter">[</span><span title="java.nio.channels.ServerSocketChannel">ServerSocketChannel</span><span class="delimiter">]</span>
    val <a title="java.nio.channels.SocketChannel" id="kafka.network;Acceptor.accept.socketChannel">socketChannel</a> = <a href="#kafka.network;Acceptor.accept.serverSocketChannel" title="java.nio.channels.ServerSocketChannel">serverSocketChannel</a>.<span title="()java.nio.channels.SocketChannel">accept</span><span class="delimiter">(</span><span class="delimiter">)</span>
    try <span class="delimiter">{</span>
      <a href="#kafka.network;Acceptor.connectionQuotas" title="kafka.network.ConnectionQuotas">connectionQuotas</a>.<a href="#kafka.network;ConnectionQuotas.inc" title="(addr: java.net.InetAddress)Unit">inc</a><span class="delimiter">(</span><a href="#kafka.network;Acceptor.accept.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a>.<span title="()java.net.Socket">socket</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.net.InetAddress">getInetAddress</span><span class="delimiter">)</span>
      <a href="#kafka.network;Acceptor.accept.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a>.<span title="(x$1: Boolean)java.nio.channels.SelectableChannel">configureBlocking</span><span class="delimiter">(</span>false<span class="delimiter">)</span>
      <a href="#kafka.network;Acceptor.accept.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a>.<span title="()java.net.Socket">socket</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Boolean)Unit">setTcpNoDelay</span><span class="delimiter">(</span>true<span class="delimiter">)</span>
      <a href="#kafka.network;Acceptor.accept.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a>.<span title="()java.net.Socket">socket</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Int)Unit">setSendBufferSize</span><span class="delimiter">(</span><a href="#kafka.network;Acceptor.sendBufferSize" title="=&gt; Int">sendBufferSize</a><span class="delimiter">)</span>

      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Accepted connection from %s on %s. sendBufferSize [actual|requested]: [%d|%d] recvBufferSize [actual|requested]: [%d|%d]&quot;</span>
            .<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.network;Acceptor.accept.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.InetAddress">getInetAddress</span>, <a href="#kafka.network;Acceptor.accept.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.SocketAddress">getLocalSocketAddress</span>,
                  <a href="#kafka.network;Acceptor.accept.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a>.<span title="()java.net.Socket">socket</span>.<span title="()Int">getSendBufferSize</span>, <a href="#kafka.network;Acceptor.sendBufferSize" title="=&gt; Int">sendBufferSize</a>,
                  <a href="#kafka.network;Acceptor.accept.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a>.<span title="()java.net.Socket">socket</span>.<span title="()Int">getReceiveBufferSize</span>, <a href="#kafka.network;Acceptor.recvBufferSize" title="=&gt; Int">recvBufferSize</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#kafka.network;Acceptor.accept.processor" title="kafka.network.Processor">processor</a>.<a href="#kafka.network;Processor.accept" title="(socketChannel: java.nio.channels.SocketChannel)Unit">accept</a><span class="delimiter">(</span><a href="#kafka.network;Acceptor.accept.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> catch <span class="delimiter">{</span>
      case <a title="kafka.network.TooManyConnectionsException" id="kafka.network;Acceptor.accept.e">e</a>: <a href="#kafka.network;TooManyConnectionsException" title="kafka.network.TooManyConnectionsException">TooManyConnectionsException</a> =&gt;
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Rejected connection from %s, address already has the configured maximum of %d connections.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.network;Acceptor.accept.e" title="kafka.network.TooManyConnectionsException">e</a>.<a href="#kafka.network;TooManyConnectionsException.ip" title="=&gt; java.net.InetAddress">ip</a>, <a href="#kafka.network;Acceptor.accept.e" title="kafka.network.TooManyConnectionsException">e</a>.<a href="#kafka.network;TooManyConnectionsException.count" title="=&gt; Int">count</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#kafka.network;AbstractServerThread.close(d3e893404e)" title="(channel: java.nio.channels.SocketChannel)Unit">close</a><span class="delimiter">(</span><a href="#kafka.network;Acceptor.accept.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Thread that processes all requests from a single connection. There are N of these running in parallel
 * each of which has its own selectors
 */</span>
private<span class="delimiter">[</span>kafka<span class="delimiter">]</span> class <a title="class Processor extends kafka.network.AbstractServerThread" id="kafka.network;Processor">Processor</a><a href="#kafka.network;Processor" title="kafka.network.Processor" class="delimiter">(</a>val <a title="Int" id="kafka.network;Processor.id">id</a>: <span title="Int">Int</span>,
                               val <a title="kafka.utils.Time" id="kafka.network;Processor.time">time</a>: <a href="../utils/Time.scala.html#kafka.utils;Time" title="kafka.utils.Time">Time</a>,
                               val <a title="Int" id="kafka.network;Processor.maxRequestSize">maxRequestSize</a>: <span title="Int">Int</span>,
                               val <a title="com.yammer.metrics.core.Meter" id="kafka.network;Processor.aggregateIdleMeter">aggregateIdleMeter</a>: <span title="com.yammer.metrics.core.Meter">Meter</span>,
                               val <a title="com.yammer.metrics.core.Meter" id="kafka.network;Processor.idleMeter">idleMeter</a>: <span title="com.yammer.metrics.core.Meter">Meter</span>,
                               val <a title="Int" id="kafka.network;Processor.totalProcessorThreads">totalProcessorThreads</a>: <span title="Int">Int</span>,
                               val <a title="kafka.network.RequestChannel" id="kafka.network;Processor.requestChannel">requestChannel</a>: <a href="RequestChannel.scala.html#kafka.network;RequestChannel" title="kafka.network.RequestChannel">RequestChannel</a>,
                               <a title="kafka.network.ConnectionQuotas" id="kafka.network;Processor.connectionQuotas">connectionQuotas</a>: <a href="#kafka.network;ConnectionQuotas" title="kafka.network.ConnectionQuotas">ConnectionQuotas</a>,
                               val <a title="Long" id="kafka.network;Processor.connectionsMaxIdleMs">connectionsMaxIdleMs</a>: <span title="Long">Long</span><span class="delimiter">)</span> extends <a href="#kafka.network;AbstractServerThread" title="kafka.network.AbstractServerThread">AbstractServerThread</a><span class="delimiter">(</span><a href="#kafka.network;Processor.connectionQuotas" title="kafka.network.ConnectionQuotas">connectionQuotas</a><span class="delimiter">)</span> <span class="delimiter">{</span>

  private val <a title="java.util.concurrent.ConcurrentLinkedQueue[java.nio.channels.SocketChannel]" id="kafka.network;Processor.newConnections">newConnections</a> = new <span title="java.util.concurrent.ConcurrentLinkedQueue[java.nio.channels.SocketChannel]">ConcurrentLinkedQueue</span><span class="delimiter">[</span>SocketChannel<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
  private val connectionsMaxIdleNanos = <a href="#kafka.network;Processor.connectionsMaxIdleMs" title="=&gt; Long">connectionsMaxIdleMs</a> <span title="(x: Int)Long">*</span> <span title="Int(1000)" class="int">1000</span> <a title="Long" id="kafka.network;Processor.connectionsMaxIdleNanos">*</a> <span title="Int(1000)" class="int">1000</span>
  private var <a title="Long" id="kafka.network;Processor.currentTimeNanos_=">currentTimeNanos</a> = <a href="../utils/Time.scala.html#kafka.utils.SystemTime" title="kafka.utils.SystemTime.type">SystemTime</a>.<a href="../utils/Time.scala.html#kafka.utils.SystemTime.nanoseconds" title="=&gt; Long">nanoseconds</a>
  private val <a title="java.util.LinkedHashMap[java.nio.channels.SelectionKey,Long]" id="kafka.network;Processor.lruConnections">lruConnections</a> = new util.<span title="java.util.LinkedHashMap[java.nio.channels.SelectionKey,Long]">LinkedHashMap</span><span class="delimiter">[</span>SelectionKey, Long<span class="delimiter">]</span>
  private var nextIdleCloseCheckTime = <a href="#kafka.network;Processor.currentTimeNanos_=" title="=&gt; Long">currentTimeNanos</a> <a title="Long" id="kafka.network;Processor.nextIdleCloseCheckTime_=">+</a> <a href="#kafka.network;Processor.connectionsMaxIdleNanos" title="=&gt; Long">connectionsMaxIdleNanos</a>

  override def <a title="()Unit" id="kafka.network;Processor.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.network;AbstractServerThread.startupComplete" title="()Unit">startupComplete</a><span class="delimiter">(</span><span class="delimiter">)</span>
    while<span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.isRunning" title="=&gt; Boolean">isRunning</a><span class="delimiter">)</span> <a href="#kafka.network;Processor.run.while$6" title="()Unit" class="delimiter">{</a>
      <span class="comment">// setup any new connections that have been queued up</span>
      <a href="#kafka.network;Processor.configureNewConnections" title="()Unit">configureNewConnections</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="comment">// register any new responses for writing</span>
      <a href="#kafka.network;Processor.processNewResponses" title="()Unit">processNewResponses</a><span class="delimiter">(</span><span class="delimiter">)</span>
      val <a title="Long" id="kafka.network;Processor.run.startSelectTime">startSelectTime</a> = <a href="../utils/Time.scala.html#kafka.utils.SystemTime" title="kafka.utils.SystemTime.type">SystemTime</a>.<a href="../utils/Time.scala.html#kafka.utils.SystemTime.nanoseconds" title="=&gt; Long">nanoseconds</a>
      val <a title="Int" id="kafka.network;Processor.run.ready">ready</a> = <a href="#kafka.network;AbstractServerThread.selector" title="=&gt; java.nio.channels.Selector">selector</a>.<span title="(x$1: Long)Int">select</span><span class="delimiter">(</span><span title="Long(300L)" class="int">300</span><span class="delimiter">)</span>
      <a href="#kafka.network;Processor.currentTimeNanos_=" title="(x$1: Long)Unit">currentTimeNanos</a> = <a href="../utils/Time.scala.html#kafka.utils.SystemTime" title="kafka.utils.SystemTime.type">SystemTime</a>.<a href="../utils/Time.scala.html#kafka.utils.SystemTime.nanoseconds" title="=&gt; Long">nanoseconds</a>
      val idleTime = <a href="#kafka.network;Processor.currentTimeNanos_=" title="=&gt; Long">currentTimeNanos</a> <a title="Long" id="kafka.network;Processor.run.idleTime">-</a> <a href="#kafka.network;Processor.run.startSelectTime" title="Long">startSelectTime</a>
      <a href="#kafka.network;Processor.idleMeter" title="=&gt; com.yammer.metrics.core.Meter">idleMeter</a>.<span title="(x$1: Long)Unit">mark</span><span class="delimiter">(</span><a href="#kafka.network;Processor.run.idleTime" title="Long">idleTime</a><span class="delimiter">)</span>
      <span class="comment">// We use a single meter for aggregate idle percentage for the thread pool.</span>
      <span class="comment">// Since meter is calculated as total_recorded_value / time_window and</span>
      <span class="comment">// time_window is independent of the number of threads, each recorded idle</span>
      <span class="comment">// time should be discounted by # threads.</span>
      <a href="#kafka.network;Processor.aggregateIdleMeter" title="=&gt; com.yammer.metrics.core.Meter">aggregateIdleMeter</a>.<span title="(x$1: Long)Unit">mark</span><span class="delimiter">(</span><a href="#kafka.network;Processor.run.idleTime" title="Long">idleTime</a> <span title="(x: Int)Long">/</span> <a href="#kafka.network;Processor.totalProcessorThreads" title="=&gt; Int">totalProcessorThreads</a><span class="delimiter">)</span>

      <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="String(&quot;Processor id &quot;)" class="string">&quot;Processor id &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.id" title="=&gt; Int">id</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; selection time = &quot;)" class="string">&quot; selection time = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.run.idleTime" title="Long">idleTime</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; ns&quot;)" class="string">&quot; ns&quot;</span><span class="delimiter">)</span>
      if<span class="delimiter">(</span><a href="#kafka.network;Processor.run.ready" title="Int">ready</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        val <a title="java.util.Set[java.nio.channels.SelectionKey]" id="kafka.network;Processor.run.keys">keys</a> = <a href="#kafka.network;AbstractServerThread.selector" title="=&gt; java.nio.channels.Selector">selector</a>.<span title="()java.util.Set[java.nio.channels.SelectionKey]">selectedKeys</span><span class="delimiter">(</span><span class="delimiter">)</span>
        val <a title="java.util.Iterator[java.nio.channels.SelectionKey]" id="kafka.network;Processor.run.iter">iter</a> = <a href="#kafka.network;Processor.run.keys" title="java.util.Set[java.nio.channels.SelectionKey]">keys</a>.<span title="()java.util.Iterator[java.nio.channels.SelectionKey]">iterator</span><span class="delimiter">(</span><span class="delimiter">)</span>
        while<span class="delimiter">(</span><a href="#kafka.network;Processor.run.iter" title="java.util.Iterator[java.nio.channels.SelectionKey]">iter</a>.<span title="()Boolean">hasNext</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#kafka.network;AbstractServerThread.isRunning" title="=&gt; Boolean">isRunning</a><span class="delimiter">)</span> <a href="#kafka.network;Processor.run.while$5" title="()Unit" class="delimiter">{</a>
          var <a title="java.nio.channels.SelectionKey" id="kafka.network;Processor.run.key">key</a>: <span title="java.nio.channels.SelectionKey">SelectionKey</span> = null
          try <span class="delimiter">{</span>
            <a href="#kafka.network;Processor.run.key" title="java.nio.channels.SelectionKey">key</a> = <a href="#kafka.network;Processor.run.iter" title="java.util.Iterator[java.nio.channels.SelectionKey]">iter</a>.<span title="()java.nio.channels.SelectionKey">next</span>
            <a href="#kafka.network;Processor.run.iter" title="java.util.Iterator[java.nio.channels.SelectionKey]">iter</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
            if<span class="delimiter">(</span><a href="#kafka.network;Processor.run.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Boolean">isReadable</span><span class="delimiter">)</span>
              <a href="#kafka.network;Processor.read" title="(key: java.nio.channels.SelectionKey)Unit">read</a><span class="delimiter">(</span><a href="#kafka.network;Processor.run.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
            else if<span class="delimiter">(</span><a href="#kafka.network;Processor.run.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Boolean">isWritable</span><span class="delimiter">)</span>
              <a href="#kafka.network;Processor.write" title="(key: java.nio.channels.SelectionKey)Unit">write</a><span class="delimiter">(</span><a href="#kafka.network;Processor.run.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
            else if<span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.network;Processor.run.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Boolean">isValid</span><span class="delimiter">)</span>
              <a href="#kafka.network;Processor.close(29a247936b)" title="(key: java.nio.channels.SelectionKey)Unit">close</a><span class="delimiter">(</span><a href="#kafka.network;Processor.run.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
            else
              throw new <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;Unrecognized key state for processor thread.&quot;)" class="string">&quot;Unrecognized key state for processor thread.&quot;</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> catch <span class="delimiter">{</span>
            case <span title="java.io.EOFException">e</span>: <span title="java.io.EOFException">EOFException</span> =&gt; <span class="delimiter">{</span>
              <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Closing socket connection to %s.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.network;Processor.channelFor" title="(key: java.nio.channels.SelectionKey)java.nio.channels.SocketChannel">channelFor</a><span class="delimiter">(</span><a href="#kafka.network;Processor.run.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.InetAddress">getInetAddress</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <a href="#kafka.network;Processor.close(29a247936b)" title="(key: java.nio.channels.SelectionKey)Unit">close</a><span class="delimiter">(</span><a href="#kafka.network;Processor.run.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> case <span title="kafka.network.InvalidRequestException">e</span>: <a href="InvalidRequestException.scala.html#kafka.network;InvalidRequestException" title="kafka.network.InvalidRequestException">InvalidRequestException</a> =&gt; <span class="delimiter">{</span>
              <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Closing socket connection to %s due to invalid request: %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.network;Processor.channelFor" title="(key: java.nio.channels.SelectionKey)java.nio.channels.SocketChannel">channelFor</a><span class="delimiter">(</span><a href="#kafka.network;Processor.run.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.InetAddress">getInetAddress</span>, <span title="kafka.network.InvalidRequestException">e</span>.<span title="()String">getMessage</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <a href="#kafka.network;Processor.close(29a247936b)" title="(key: java.nio.channels.SelectionKey)Unit">close</a><span class="delimiter">(</span><a href="#kafka.network;Processor.run.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> case <span title="Throwable">e</span>: <span title="Throwable">Throwable</span> =&gt; <span class="delimiter">{</span>
              <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;Closing socket for &quot;)" class="string">&quot;Closing socket for &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.channelFor" title="(key: java.nio.channels.SelectionKey)java.nio.channels.SocketChannel">channelFor</a><span class="delimiter">(</span><a href="#kafka.network;Processor.run.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.InetAddress">getInetAddress</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; because of error&quot;)" class="string">&quot; because of error&quot;</span>, <span title="Throwable">e</span><span class="delimiter">)</span>
              <a href="#kafka.network;Processor.close(29a247936b)" title="(key: java.nio.channels.SelectionKey)Unit">close</a><span class="delimiter">(</span><a href="#kafka.network;Processor.run.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#kafka.network;Processor.maybeCloseOldestConnection" title="=&gt; Unit">maybeCloseOldestConnection</a>
    <span class="delimiter">}</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Closing selector.&quot;)" class="string">&quot;Closing selector.&quot;</span><span class="delimiter">)</span>
    <a href="#kafka.network;AbstractServerThread.closeAll" title="()Unit">closeAll</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.swallowError" title="(action: =&gt; Unit)Unit">swallowError</a><span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.selector" title="=&gt; java.nio.channels.Selector">selector</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#kafka.network;AbstractServerThread.shutdownComplete" title="()Unit">shutdownComplete</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Close the given key and associated socket
   */</span>
  override def <a title="(key: java.nio.channels.SelectionKey)Unit" id="kafka.network;Processor.close(29a247936b)">close</a><span class="delimiter">(</span><a title="java.nio.channels.SelectionKey" id="kafka.network;Processor.close(29a247936b).key">key</a>: <span title="java.nio.channels.SelectionKey">SelectionKey</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#kafka.network;Processor.lruConnections" title="=&gt; java.util.LinkedHashMap[java.nio.channels.SelectionKey,Long]">lruConnections</a>.<span title="(x$1: Any)Long">remove</span><span class="delimiter">(</span><a href="#kafka.network;Processor.close(29a247936b).key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
    super.<a href="#kafka.network;AbstractServerThread.close(29a247936b)" title="(key: java.nio.channels.SelectionKey)Unit">close</a><span class="delimiter">(</span><a href="#kafka.network;Processor.close(29a247936b).key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private def <a title="()Unit" id="kafka.network;Processor.processNewResponses">processNewResponses</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    var <a title="kafka.network.RequestChannel.Response" id="kafka.network;Processor.processNewResponses.curr">curr</a> = <a href="#kafka.network;Processor.requestChannel" title="=&gt; kafka.network.RequestChannel">requestChannel</a>.<a href="RequestChannel.scala.html#kafka.network;RequestChannel.receiveResponse" title="(processor: Int)kafka.network.RequestChannel.Response">receiveResponse</a><span class="delimiter">(</span><a href="#kafka.network;Processor.id" title="=&gt; Int">id</a><span class="delimiter">)</span>
    while<span class="delimiter">(</span><a href="#kafka.network;Processor.processNewResponses.curr" title="kafka.network.RequestChannel.Response">curr</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <a href="#kafka.network;Processor.processNewResponses.while$7" title="()Unit" class="delimiter">{</a>
      val <a title="java.nio.channels.SelectionKey" id="kafka.network;Processor.processNewResponses.key">key</a> = <a href="#kafka.network;Processor.processNewResponses.curr" title="kafka.network.RequestChannel.Response">curr</a>.<a href="RequestChannel.scala.html#kafka.network.RequestChannel;Response.request" title="=&gt; kafka.network.RequestChannel.Request">request</a>.<a href="RequestChannel.scala.html#kafka.network.RequestChannel;Request.requestKey" title="=&gt; Any">requestKey</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="java.nio.channels.SelectionKey" class="delimiter">[</span><span title="java.nio.channels.SelectionKey">SelectionKey</span><span class="delimiter">]</span>
      try <span class="delimiter">{</span>
        <a href="#kafka.network;Processor.processNewResponses.curr" title="kafka.network.RequestChannel.Response">curr</a>.<a href="RequestChannel.scala.html#kafka.network.RequestChannel;Response.responseAction" title="=&gt; kafka.network.RequestChannel.ResponseAction">responseAction</a> match <span class="delimiter">{</span>
          case <a href="RequestChannel.scala.html#kafka.network.RequestChannel" title="kafka.network.RequestChannel.type">RequestChannel</a>.<a href="RequestChannel.scala.html#kafka.network.RequestChannel.NoOpAction" title="kafka.network.RequestChannel.NoOpAction.type">NoOpAction</a> =&gt; <span class="delimiter">{</span>
            <span class="comment">// There is no response to send to the client, we need to read more pipelined requests</span>
            <span class="comment">// that are sitting in the server's socket buffer</span>
            <a href="#kafka.network;Processor.processNewResponses.curr" title="kafka.network.RequestChannel.Response">curr</a>.<a href="RequestChannel.scala.html#kafka.network.RequestChannel;Response.request" title="=&gt; kafka.network.RequestChannel.Request">request</a>.<a href="RequestChannel.scala.html#kafka.network.RequestChannel;Request.updateRequestMetrics" title="()Unit">updateRequestMetrics</a>
            <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="String(&quot;Socket server received empty response to send, registering for read: &quot;)" class="string">&quot;Socket server received empty response to send, registering for read: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.processNewResponses.curr" title="kafka.network.RequestChannel.Response">curr</a><span class="delimiter">)</span>
            <a href="#kafka.network;Processor.processNewResponses.key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Int)java.nio.channels.SelectionKey">interestOps</span><span class="delimiter">(</span>SelectionKey.<span title="Int(1)">OP_READ</span><span class="delimiter">)</span>
            <a href="#kafka.network;Processor.processNewResponses.key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Any)Object">attach</span><span class="delimiter">(</span>null<span class="delimiter">)</span>
          <span class="delimiter">}</span>
          case <a href="RequestChannel.scala.html#kafka.network.RequestChannel" title="kafka.network.RequestChannel.type">RequestChannel</a>.<a href="RequestChannel.scala.html#kafka.network.RequestChannel.SendAction" title="kafka.network.RequestChannel.SendAction.type">SendAction</a> =&gt; <span class="delimiter">{</span>
            <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="String(&quot;Socket server received response to send, registering for write: &quot;)" class="string">&quot;Socket server received response to send, registering for write: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.processNewResponses.curr" title="kafka.network.RequestChannel.Response">curr</a><span class="delimiter">)</span>
            <a href="#kafka.network;Processor.processNewResponses.key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Int)java.nio.channels.SelectionKey">interestOps</span><span class="delimiter">(</span>SelectionKey.<span title="Int(4)">OP_WRITE</span><span class="delimiter">)</span>
            <a href="#kafka.network;Processor.processNewResponses.key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Any)Object">attach</span><span class="delimiter">(</span><a href="#kafka.network;Processor.processNewResponses.curr" title="kafka.network.RequestChannel.Response">curr</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          case <a href="RequestChannel.scala.html#kafka.network.RequestChannel" title="kafka.network.RequestChannel.type">RequestChannel</a>.<a href="RequestChannel.scala.html#kafka.network.RequestChannel.CloseConnectionAction" title="kafka.network.RequestChannel.CloseConnectionAction.type">CloseConnectionAction</a> =&gt; <span class="delimiter">{</span>
            <a href="#kafka.network;Processor.processNewResponses.curr" title="kafka.network.RequestChannel.Response">curr</a>.<a href="RequestChannel.scala.html#kafka.network.RequestChannel;Response.request" title="=&gt; kafka.network.RequestChannel.Request">request</a>.<a href="RequestChannel.scala.html#kafka.network.RequestChannel;Request.updateRequestMetrics" title="()Unit">updateRequestMetrics</a>
            <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="String(&quot;Closing socket connection actively according to the response code.&quot;)" class="string">&quot;Closing socket connection actively according to the response code.&quot;</span><span class="delimiter">)</span>
            <a href="#kafka.network;Processor.close(29a247936b)" title="(key: java.nio.channels.SelectionKey)Unit">close</a><span class="delimiter">(</span><a href="#kafka.network;Processor.processNewResponses.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          case <a title="kafka.network.RequestChannel.ResponseAction" id="kafka.network;Processor.processNewResponses.responseCode">responseCode</a> =&gt; throw new <a href="../common/KafkaException.scala.html#kafka.common;KafkaException" title="kafka.common.KafkaException">KafkaException</a><span class="delimiter">(</span><span title="String(&quot;No mapping found for response code &quot;)" class="string">&quot;No mapping found for response code &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.processNewResponses.responseCode" title="kafka.network.RequestChannel.ResponseAction">responseCode</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> catch <span class="delimiter">{</span>
        case <a title="java.nio.channels.CancelledKeyException" id="kafka.network;Processor.processNewResponses.e">e</a>: <span title="java.nio.channels.CancelledKeyException">CancelledKeyException</span> =&gt; <span class="delimiter">{</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Ignoring response for closed socket.&quot;)" class="string">&quot;Ignoring response for closed socket.&quot;</span><span class="delimiter">)</span>
          <a href="#kafka.network;Processor.close(29a247936b)" title="(key: java.nio.channels.SelectionKey)Unit">close</a><span class="delimiter">(</span><a href="#kafka.network;Processor.processNewResponses.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> finally <span class="delimiter">{</span>
        <a href="#kafka.network;Processor.processNewResponses.curr" title="kafka.network.RequestChannel.Response">curr</a> = <a href="#kafka.network;Processor.requestChannel" title="=&gt; kafka.network.RequestChannel">requestChannel</a>.<a href="RequestChannel.scala.html#kafka.network;RequestChannel.receiveResponse" title="(processor: Int)kafka.network.RequestChannel.Response">receiveResponse</a><span class="delimiter">(</span><a href="#kafka.network;Processor.id" title="=&gt; Int">id</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Queue up a new connection for reading
   */</span>
  def <a title="(socketChannel: java.nio.channels.SocketChannel)Unit" id="kafka.network;Processor.accept">accept</a><span class="delimiter">(</span><a title="java.nio.channels.SocketChannel" id="kafka.network;Processor.accept.socketChannel">socketChannel</a>: <span title="java.nio.channels.SocketChannel">SocketChannel</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.network;Processor.newConnections" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[java.nio.channels.SocketChannel]">newConnections</a>.<span title="(x$1: java.nio.channels.SocketChannel)Boolean">add</span><span class="delimiter">(</span><a href="#kafka.network;Processor.accept.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a><span class="delimiter">)</span>
    <a href="#kafka.network;AbstractServerThread.wakeup" title="()java.nio.channels.Selector">wakeup</a><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Register any new connections that have been queued up
   */</span>
  private def <a title="()Unit" id="kafka.network;Processor.configureNewConnections">configureNewConnections</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    while<span class="delimiter">(</span><a href="#kafka.network;Processor.newConnections" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[java.nio.channels.SocketChannel]">newConnections</a>.<span title="()Int">size</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#kafka.network;Processor.configureNewConnections.while$8" title="()Unit" class="delimiter">{</a>
      val <a title="java.nio.channels.SocketChannel" id="kafka.network;Processor.configureNewConnections.channel">channel</a> = <a href="#kafka.network;Processor.newConnections" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[java.nio.channels.SocketChannel]">newConnections</a>.<span title="()java.nio.channels.SocketChannel">poll</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Processor &quot;)" class="string">&quot;Processor &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.id" title="=&gt; Int">id</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; listening to new connection from &quot;)" class="string">&quot; listening to new connection from &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.configureNewConnections.channel" title="java.nio.channels.SocketChannel">channel</a>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.SocketAddress">getRemoteSocketAddress</span><span class="delimiter">)</span>
      <a href="#kafka.network;Processor.configureNewConnections.channel" title="java.nio.channels.SocketChannel">channel</a>.<span title="(x$1: java.nio.channels.Selector, x$2: Int)java.nio.channels.SelectionKey">register</span><span class="delimiter">(</span><a href="#kafka.network;AbstractServerThread.selector" title="=&gt; java.nio.channels.Selector">selector</a>, SelectionKey.<span title="Int(1)">OP_READ</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/*
   * Process reads from ready sockets
   */</span>
  def <a title="(key: java.nio.channels.SelectionKey)Unit" id="kafka.network;Processor.read">read</a><span class="delimiter">(</span><a title="java.nio.channels.SelectionKey" id="kafka.network;Processor.read.key">key</a>: <span title="java.nio.channels.SelectionKey">SelectionKey</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.network;Processor.lruConnections" title="=&gt; java.util.LinkedHashMap[java.nio.channels.SelectionKey,Long]">lruConnections</a>.<span title="(x$1: java.nio.channels.SelectionKey, x$2: Long)Long">put</span><span class="delimiter">(</span><a href="#kafka.network;Processor.read.key" title="java.nio.channels.SelectionKey">key</a>, <a href="#kafka.network;Processor.currentTimeNanos_=" title="=&gt; Long">currentTimeNanos</a><span class="delimiter">)</span>
    val <a title="java.nio.channels.SocketChannel" id="kafka.network;Processor.read.socketChannel">socketChannel</a> = <a href="#kafka.network;Processor.channelFor" title="(key: java.nio.channels.SelectionKey)java.nio.channels.SocketChannel">channelFor</a><span class="delimiter">(</span><a href="#kafka.network;Processor.read.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
    var <a title="kafka.network.Receive" id="kafka.network;Processor.read.receive">receive</a> = <a href="#kafka.network;Processor.read.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Object">attachment</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="kafka.network.Receive" class="delimiter">[</span><a href="Transmission.scala.html#kafka.network;Receive" title="kafka.network.Receive">Receive</a><span class="delimiter">]</span>
    if<span class="delimiter">(</span><a href="#kafka.network;Processor.read.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Object">attachment</span> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#kafka.network;Processor.read.receive" title="kafka.network.Receive">receive</a> = new <a href="BoundedByteBufferReceive.scala.html#kafka.network;BoundedByteBufferReceive" title="kafka.network.BoundedByteBufferReceive">BoundedByteBufferReceive</a><span class="delimiter">(</span><a href="#kafka.network;Processor.maxRequestSize" title="=&gt; Int">maxRequestSize</a><span class="delimiter">)</span>
      <a href="#kafka.network;Processor.read.key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Any)Object">attach</span><span class="delimiter">(</span><a href="#kafka.network;Processor.read.receive" title="kafka.network.Receive">receive</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    val <a title="Int" id="kafka.network;Processor.read.read">read</a> = <a href="#kafka.network;Processor.read.receive" title="kafka.network.Receive">receive</a>.<a href="Transmission.scala.html#kafka.network;Receive.readFrom" title="(channel: java.nio.channels.ReadableByteChannel)Int">readFrom</a><span class="delimiter">(</span><a href="#kafka.network;Processor.read.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a><span class="delimiter">)</span>
    val <a title="java.net.SocketAddress" id="kafka.network;Processor.read.address">address</a> = <a href="#kafka.network;Processor.read.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.SocketAddress">getRemoteSocketAddress</span><span class="delimiter">(</span><span class="delimiter">)</span>;
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><a href="#kafka.network;Processor.read.read" title="Int">read</a> <span title="(x: String)String">+</span> <span title="String(&quot; bytes read from &quot;)" class="string">&quot; bytes read from &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.read.address" title="java.net.SocketAddress">address</a><span class="delimiter">)</span>
    if<span class="delimiter">(</span><a href="#kafka.network;Processor.read.read" title="Int">read</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#kafka.network;Processor.close(29a247936b)" title="(key: java.nio.channels.SelectionKey)Unit">close</a><span class="delimiter">(</span><a href="#kafka.network;Processor.read.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> else if<span class="delimiter">(</span><a href="#kafka.network;Processor.read.receive" title="kafka.network.Receive">receive</a>.<a href="Transmission.scala.html#kafka.network;Transmission.complete" title="=&gt; Boolean">complete</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="kafka.network.RequestChannel.Request" id="kafka.network;Processor.read.req">req</a> = <a href="RequestChannel.scala.html#kafka.network.RequestChannel" title="kafka.network.RequestChannel.type">RequestChannel</a>.<a href="RequestChannel.scala.html#kafka.network.RequestChannel;Request" title="(processor: Int, requestKey: Any, buffer: java.nio.ByteBuffer, startTimeMs: Long, remoteAddress: java.net.SocketAddress)kafka.network.RequestChannel.Request">Request</a><span class="delimiter">(</span>processor = <a href="#kafka.network;Processor.id" title="=&gt; Int">id</a>, requestKey = <a href="#kafka.network;Processor.read.key" title="java.nio.channels.SelectionKey">key</a>, buffer = <a href="#kafka.network;Processor.read.receive" title="kafka.network.Receive">receive</a>.<a href="Transmission.scala.html#kafka.network;Receive.buffer" title="=&gt; java.nio.ByteBuffer">buffer</a>, startTimeMs = <a href="#kafka.network;Processor.time" title="=&gt; kafka.utils.Time">time</a>.<a href="../utils/Time.scala.html#kafka.utils;Time.milliseconds" title="=&gt; Long">milliseconds</a>, remoteAddress = <a href="#kafka.network;Processor.read.address" title="java.net.SocketAddress">address</a><span class="delimiter">)</span>
      <a href="#kafka.network;Processor.requestChannel" title="=&gt; kafka.network.RequestChannel">requestChannel</a>.<a href="RequestChannel.scala.html#kafka.network;RequestChannel.sendRequest" title="(request: kafka.network.RequestChannel.Request)Unit">sendRequest</a><span class="delimiter">(</span><a href="#kafka.network;Processor.read.req" title="kafka.network.RequestChannel.Request">req</a><span class="delimiter">)</span>
      <a href="#kafka.network;Processor.read.key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Any)Object">attach</span><span class="delimiter">(</span>null<span class="delimiter">)</span>
      <span class="comment">// explicitly reset interest ops to not READ, no need to wake up the selector just yet</span>
      <a href="#kafka.network;Processor.read.key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Int)java.nio.channels.SelectionKey">interestOps</span><span title="Unit" class="delimiter">(</span><a href="#kafka.network;Processor.read.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Int">interestOps</span> <span title="(x: Int)Int">&amp;</span> <span class="delimiter">(</span><span title="=&gt; Int">~</span>SelectionKey.<span title="Int(1)">OP_READ</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> else <span class="delimiter">{</span>
      <span class="comment">// more reading to be done</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="String(&quot;Did not finish reading, registering for read again on connection &quot;)" class="string">&quot;Did not finish reading, registering for read again on connection &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.read.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.SocketAddress">getRemoteSocketAddress</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#kafka.network;Processor.read.key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Int)java.nio.channels.SelectionKey">interestOps</span><span class="delimiter">(</span>SelectionKey.<span title="Int(1)">OP_READ</span><span class="delimiter">)</span>
      <a href="#kafka.network;AbstractServerThread.wakeup" title="()java.nio.channels.Selector">wakeup</a><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/*
   * Process writes to ready sockets
   */</span>
  def <a title="(key: java.nio.channels.SelectionKey)Unit" id="kafka.network;Processor.write">write</a><span class="delimiter">(</span><a title="java.nio.channels.SelectionKey" id="kafka.network;Processor.write.key">key</a>: <span title="java.nio.channels.SelectionKey">SelectionKey</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    val <a title="java.nio.channels.SocketChannel" id="kafka.network;Processor.write.socketChannel">socketChannel</a> = <a href="#kafka.network;Processor.channelFor" title="(key: java.nio.channels.SelectionKey)java.nio.channels.SocketChannel">channelFor</a><span class="delimiter">(</span><a href="#kafka.network;Processor.write.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
    val <a title="kafka.network.RequestChannel.Response" id="kafka.network;Processor.write.response">response</a> = <a href="#kafka.network;Processor.write.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Object">attachment</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="kafka.network.RequestChannel.Response" class="delimiter">[</span>RequestChannel.<a href="RequestChannel.scala.html#kafka.network.RequestChannel;Response" title="kafka.network.RequestChannel.Response">Response</a><span class="delimiter">]</span>
    val <a title="kafka.network.Send" id="kafka.network;Processor.write.responseSend">responseSend</a> = <a href="#kafka.network;Processor.write.response" title="kafka.network.RequestChannel.Response">response</a>.<a href="RequestChannel.scala.html#kafka.network.RequestChannel;Response.responseSend" title="=&gt; kafka.network.Send">responseSend</a>
    if<span class="delimiter">(</span><a href="#kafka.network;Processor.write.responseSend" title="kafka.network.Send">responseSend</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span>
      throw new <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;Registered for write interest but no response attached to key.&quot;)" class="string">&quot;Registered for write interest but no response attached to key.&quot;</span><span class="delimiter">)</span>
    val <a title="Int" id="kafka.network;Processor.write.written">written</a> = <a href="#kafka.network;Processor.write.responseSend" title="kafka.network.Send">responseSend</a>.<a href="Transmission.scala.html#kafka.network;Send.writeTo" title="(channel: java.nio.channels.GatheringByteChannel)Int">writeTo</a><span class="delimiter">(</span><a href="#kafka.network;Processor.write.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a><span class="delimiter">)</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><a href="#kafka.network;Processor.write.written" title="Int">written</a> <span title="(x: String)String">+</span> <span title="String(&quot; bytes written to &quot;)" class="string">&quot; bytes written to &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.write.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.SocketAddress">getRemoteSocketAddress</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; using key &quot;)" class="string">&quot; using key &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.write.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
    if<span class="delimiter">(</span><a href="#kafka.network;Processor.write.responseSend" title="kafka.network.Send">responseSend</a>.<a href="Transmission.scala.html#kafka.network;Transmission.complete" title="=&gt; Boolean">complete</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#kafka.network;Processor.write.response" title="kafka.network.RequestChannel.Response">response</a>.<a href="RequestChannel.scala.html#kafka.network.RequestChannel;Response.request" title="=&gt; kafka.network.RequestChannel.Request">request</a>.<a href="RequestChannel.scala.html#kafka.network.RequestChannel;Request.updateRequestMetrics" title="()Unit">updateRequestMetrics</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#kafka.network;Processor.write.key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Any)Object">attach</span><span class="delimiter">(</span>null<span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="String(&quot;Finished writing, registering for read on connection &quot;)" class="string">&quot;Finished writing, registering for read on connection &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.write.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.SocketAddress">getRemoteSocketAddress</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#kafka.network;Processor.write.key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Int)java.nio.channels.SelectionKey">interestOps</span><span title="Unit" class="delimiter">(</span>SelectionKey.<span title="Int(1)">OP_READ</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> else <span class="delimiter">{</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="String(&quot;Did not finish writing, registering for write again on connection &quot;)" class="string">&quot;Did not finish writing, registering for write again on connection &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.write.socketChannel" title="java.nio.channels.SocketChannel">socketChannel</a>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.SocketAddress">getRemoteSocketAddress</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#kafka.network;Processor.write.key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Int)java.nio.channels.SelectionKey">interestOps</span><span class="delimiter">(</span>SelectionKey.<span title="Int(4)">OP_WRITE</span><span class="delimiter">)</span>
      <a href="#kafka.network;AbstractServerThread.wakeup" title="()java.nio.channels.Selector">wakeup</a><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(key: java.nio.channels.SelectionKey)java.nio.channels.SocketChannel" id="kafka.network;Processor.channelFor">channelFor</a><span class="delimiter">(</span><a title="java.nio.channels.SelectionKey" id="kafka.network;Processor.channelFor.key">key</a>: <span title="java.nio.channels.SelectionKey">SelectionKey</span><span class="delimiter">)</span> = <a href="#kafka.network;Processor.channelFor.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()java.nio.channels.SelectableChannel">channel</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="java.nio.channels.SocketChannel" class="delimiter">[</span><span title="java.nio.channels.SocketChannel">SocketChannel</span><span class="delimiter">]</span>

  private def <a title="=&gt; Unit" id="kafka.network;Processor.maybeCloseOldestConnection">maybeCloseOldestConnection</a> <span class="delimiter">{</span>
    if<span class="delimiter">(</span><a href="#kafka.network;Processor.currentTimeNanos_=" title="=&gt; Long">currentTimeNanos</a> <span title="(x: Long)Boolean">&gt;</span> <a href="#kafka.network;Processor.nextIdleCloseCheckTime_=" title="=&gt; Long">nextIdleCloseCheckTime</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      if<span class="delimiter">(</span><a href="#kafka.network;Processor.lruConnections" title="=&gt; java.util.LinkedHashMap[java.nio.channels.SelectionKey,Long]">lruConnections</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#kafka.network;Processor.nextIdleCloseCheckTime_=" title="(x$1: Long)Unit">nextIdleCloseCheckTime</a> = <a href="#kafka.network;Processor.currentTimeNanos_=" title="=&gt; Long">currentTimeNanos</a> <span title="(x: Long)Long">+</span> <a href="#kafka.network;Processor.connectionsMaxIdleNanos" title="=&gt; Long">connectionsMaxIdleNanos</a>
      <span class="delimiter">}</span> else <span class="delimiter">{</span>
        val <a title="java.util.Map.Entry[java.nio.channels.SelectionKey,Long]" id="kafka.network;Processor.maybeCloseOldestConnection.oldestConnectionEntry">oldestConnectionEntry</a> = <a href="#kafka.network;Processor.lruConnections" title="=&gt; java.util.LinkedHashMap[java.nio.channels.SelectionKey,Long]">lruConnections</a>.<span title="()java.util.Set[java.util.Map.Entry[java.nio.channels.SelectionKey,Long]]">entrySet</span>.<span title="()java.util.Iterator[java.util.Map.Entry[java.nio.channels.SelectionKey,Long]]">iterator</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.util.Map.Entry[java.nio.channels.SelectionKey,Long]">next</span><span class="delimiter">(</span><span class="delimiter">)</span>
        val <a title="Long" id="kafka.network;Processor.maybeCloseOldestConnection.connectionLastActiveTime">connectionLastActiveTime</a> = <a href="#kafka.network;Processor.maybeCloseOldestConnection.oldestConnectionEntry" title="java.util.Map.Entry[java.nio.channels.SelectionKey,Long]">oldestConnectionEntry</a>.<span title="()Long">getValue</span>
        <a href="#kafka.network;Processor.nextIdleCloseCheckTime_=" title="(x$1: Long)Unit">nextIdleCloseCheckTime</a> = <a href="#kafka.network;Processor.maybeCloseOldestConnection.connectionLastActiveTime" title="Long">connectionLastActiveTime</a> <span title="(x: Long)Long">+</span> <a href="#kafka.network;Processor.connectionsMaxIdleNanos" title="=&gt; Long">connectionsMaxIdleNanos</a>
        if<span class="delimiter">(</span><a href="#kafka.network;Processor.currentTimeNanos_=" title="=&gt; Long">currentTimeNanos</a> <span title="(x: Long)Boolean">&gt;</span> <a href="#kafka.network;Processor.nextIdleCloseCheckTime_=" title="=&gt; Long">nextIdleCloseCheckTime</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          val <a title="java.nio.channels.SelectionKey" id="kafka.network;Processor.maybeCloseOldestConnection.key">key</a>: <span title="java.nio.channels.SelectionKey">SelectionKey</span> = <a href="#kafka.network;Processor.maybeCloseOldestConnection.oldestConnectionEntry" title="java.util.Map.Entry[java.nio.channels.SelectionKey,Long]">oldestConnectionEntry</a>.<span title="()java.nio.channels.SelectionKey">getKey</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="String(&quot;About to close the idle connection from &quot;)" class="string">&quot;About to close the idle connection from &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.network;Processor.maybeCloseOldestConnection.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()java.nio.channels.SelectableChannel">channel</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="java.nio.channels.SocketChannel" class="delimiter">[</span><span title="java.nio.channels.SocketChannel">SocketChannel</span><span class="delimiter">]</span>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.SocketAddress">getRemoteSocketAddress</span>
            <span title="(x$1: Any)String">+</span> <span title="String(&quot; due to being idle for &quot;)" class="string">&quot; due to being idle for &quot;</span> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span><a href="#kafka.network;Processor.currentTimeNanos_=" title="=&gt; Long">currentTimeNanos</a> <span title="(x: Long)Long">-</span> <a href="#kafka.network;Processor.maybeCloseOldestConnection.connectionLastActiveTime" title="Long">connectionLastActiveTime</a><span class="delimiter">)</span> <span title="(x: Int)Long">/</span> <span title="Int(1000)" class="int">1000</span> <span title="(x: Int)Long">/</span> <span title="Int(1000)" class="int">1000</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; millis&quot;)" class="string">&quot; millis&quot;</span><span class="delimiter">)</span>
          <a href="#kafka.network;Processor.close(29a247936b)" title="(key: java.nio.channels.SelectionKey)Unit">close</a><span class="delimiter">(</span><a href="#kafka.network;Processor.maybeCloseOldestConnection.key" title="java.nio.channels.SelectionKey">key</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

class <a title="class ConnectionQuotas extends AnyRef" id="kafka.network;ConnectionQuotas">ConnectionQuotas</a><a href="#kafka.network;ConnectionQuotas" title="kafka.network.ConnectionQuotas" class="delimiter">(</a>val <a title="Int" id="kafka.network;ConnectionQuotas.defaultMax">defaultMax</a>: <span title="Int">Int</span>, <a title="scala.collection.Map[String,Int]" id="kafka.network;ConnectionQuotas.overrideQuotas">overrideQuotas</a>: <span title="scala.collection.Map[String,Int]">Map</span><span class="delimiter">[</span>String, Int<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  private val <a title="scala.collection.Map[java.net.InetAddress,Int]" id="kafka.network;ConnectionQuotas.overrides">overrides</a> = <a href="#kafka.network;ConnectionQuotas.overrideQuotas" title="scala.collection.Map[String,Int]">overrideQuotas</a>.<span title="(f: ((String, Int)) =&gt; (java.net.InetAddress, Int))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.Map[String,Int],(java.net.InetAddress, Int),scala.collection.Map[java.net.InetAddress,Int]])scala.collection.Map[java.net.InetAddress,Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Map.Coll,(java.net.InetAddress, Int),scala.collection.Map[java.net.InetAddress,Int]]" class="delimiter">(</span><a title="(String, Int)" id="kafka.network;ConnectionQuotas.overrides.$anonfun.entry">entry</a> =&gt; <span title="(_1: java.net.InetAddress, _2: Int)(java.net.InetAddress, Int)" class="delimiter">(</span><span title="java.net.InetAddress.type">InetAddress</span>.<span title="(x$1: String)java.net.InetAddress">getByName</span><span class="delimiter">(</span><a href="#kafka.network;ConnectionQuotas.overrides.$anonfun.entry" title="(String, Int)">entry</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span>, <a href="#kafka.network;ConnectionQuotas.overrides.$anonfun.entry" title="(String, Int)">entry</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>
  private val <a title="scala.collection.mutable.Map[java.net.InetAddress,Int]" id="kafka.network;ConnectionQuotas.counts">counts</a> = mutable.<span title="[A, B](elems: (A, B)*)scala.collection.mutable.Map[A,B]">Map</span><span title="(elems: (java.net.InetAddress, Int)*)scala.collection.mutable.Map[java.net.InetAddress,Int]" class="delimiter">[</span><span title="java.net.InetAddress">InetAddress</span>, <span title="Int">Int</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
  
  def <a title="(addr: java.net.InetAddress)Unit" id="kafka.network;ConnectionQuotas.inc">inc</a><span class="delimiter">(</span><a title="java.net.InetAddress" id="kafka.network;ConnectionQuotas.inc.addr">addr</a>: <span title="java.net.InetAddress">InetAddress</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.network;ConnectionQuotas.counts" title="=&gt; scala.collection.mutable.Map[java.net.InetAddress,Int]">counts</a> <span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
      val <a title="Int" id="kafka.network;ConnectionQuotas.inc.count">count</a> = <a href="#kafka.network;ConnectionQuotas.counts" title="=&gt; scala.collection.mutable.Map[java.net.InetAddress,Int]">counts</a>.<span title="(key: java.net.InetAddress, default: =&gt; Int)Int">getOrElse</span><span class="delimiter">(</span><a href="#kafka.network;ConnectionQuotas.inc.addr" title="java.net.InetAddress">addr</a>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="#kafka.network;ConnectionQuotas.counts" title="=&gt; scala.collection.mutable.Map[java.net.InetAddress,Int]">counts</a>.<span title="(key: java.net.InetAddress, value: Int)Option[Int]">put</span><span class="delimiter">(</span><a href="#kafka.network;ConnectionQuotas.inc.addr" title="java.net.InetAddress">addr</a>, <a href="#kafka.network;ConnectionQuotas.inc.count" title="Int">count</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      val <a title="Int" id="kafka.network;ConnectionQuotas.inc.max">max</a> = <a href="#kafka.network;ConnectionQuotas.overrides" title="=&gt; scala.collection.Map[java.net.InetAddress,Int]">overrides</a>.<span title="(key: java.net.InetAddress, default: =&gt; Int)Int">getOrElse</span><span class="delimiter">(</span><a href="#kafka.network;ConnectionQuotas.inc.addr" title="java.net.InetAddress">addr</a>, <a href="#kafka.network;ConnectionQuotas.defaultMax" title="=&gt; Int">defaultMax</a><span class="delimiter">)</span>
      if<span class="delimiter">(</span><a href="#kafka.network;ConnectionQuotas.inc.count" title="Int">count</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#kafka.network;ConnectionQuotas.inc.max" title="Int">max</a><span class="delimiter">)</span>
        throw new <a href="#kafka.network;TooManyConnectionsException" title="kafka.network.TooManyConnectionsException">TooManyConnectionsException</a><span class="delimiter">(</span><a href="#kafka.network;ConnectionQuotas.inc.addr" title="java.net.InetAddress">addr</a>, <a href="#kafka.network;ConnectionQuotas.inc.max" title="Int">max</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  def <a title="(addr: java.net.InetAddress)Unit" id="kafka.network;ConnectionQuotas.dec">dec</a><span class="delimiter">(</span><a title="java.net.InetAddress" id="kafka.network;ConnectionQuotas.dec.addr">addr</a>: <span title="java.net.InetAddress">InetAddress</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.network;ConnectionQuotas.counts" title="=&gt; scala.collection.mutable.Map[java.net.InetAddress,Int]">counts</a> <span title="(x$1: Option[Int])Option[Int]">synchronized</span> <span class="delimiter">{</span>
      val <a title="Int" id="kafka.network;ConnectionQuotas.dec.count">count</a> = <a href="#kafka.network;ConnectionQuotas.counts" title="=&gt; scala.collection.mutable.Map[java.net.InetAddress,Int]">counts</a>.<span title="(key: java.net.InetAddress)Option[Int]">get</span><span class="delimiter">(</span><a href="#kafka.network;ConnectionQuotas.dec.addr" title="java.net.InetAddress">addr</a><span class="delimiter">)</span>.<span title="=&gt; Int">get</span>
      if<span class="delimiter">(</span><a href="#kafka.network;ConnectionQuotas.dec.count" title="Int">count</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <a href="#kafka.network;ConnectionQuotas.counts" title="=&gt; scala.collection.mutable.Map[java.net.InetAddress,Int]">counts</a>.<span title="(key: java.net.InetAddress)Option[Int]">remove</span><span class="delimiter">(</span><a href="#kafka.network;ConnectionQuotas.dec.addr" title="java.net.InetAddress">addr</a><span class="delimiter">)</span>
      else
        <a href="#kafka.network;ConnectionQuotas.counts" title="=&gt; scala.collection.mutable.Map[java.net.InetAddress,Int]">counts</a>.<span title="(key: java.net.InetAddress, value: Int)Option[Int]">put</span><span class="delimiter">(</span><a href="#kafka.network;ConnectionQuotas.dec.addr" title="java.net.InetAddress">addr</a>, <a href="#kafka.network;ConnectionQuotas.dec.count" title="Int">count</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
<span class="delimiter">}</span>

class <a title="class TooManyConnectionsException extends kafka.common.KafkaException" id="kafka.network;TooManyConnectionsException">TooManyConnectionsException</a><a href="#kafka.network;TooManyConnectionsException" title="kafka.network.TooManyConnectionsException" class="delimiter">(</a>val <a title="java.net.InetAddress" id="kafka.network;TooManyConnectionsException.ip">ip</a>: <span title="java.net.InetAddress">InetAddress</span>, val <a title="Int" id="kafka.network;TooManyConnectionsException.count">count</a>: <span title="Int">Int</span><span class="delimiter">)</span> extends <a href="../common/KafkaException.scala.html#kafka.common;KafkaException" title="kafka.common.KafkaException">KafkaException</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Too many connections from %s (maximum = %d)&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.network;TooManyConnectionsException.ip" title="java.net.InetAddress">ip</a>, <a href="#kafka.network;TooManyConnectionsException.count" title="Int">count</a><span class="delimiter">)</span><span class="delimiter">)</span>

        </pre>
    </body>
</html>
