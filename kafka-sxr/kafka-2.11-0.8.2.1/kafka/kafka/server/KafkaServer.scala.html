<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>kafka/kafka/server/KafkaServer.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

package kafka.server

import kafka.admin._
import kafka.log.LogConfig
import kafka.log.CleanerConfig
import kafka.log.LogManager
import kafka.utils._
import java.util.concurrent._
import atomic.<span class="delimiter">{</span>AtomicInteger, AtomicBoolean<span class="delimiter">}</span>
import java.io.File
import org.I0Itec.zkclient.ZkClient
import kafka.controller.<span class="delimiter">{</span>ControllerStats, KafkaController<span class="delimiter">}</span>
import kafka.cluster.Broker
import kafka.api.<span class="delimiter">{</span>ControlledShutdownResponse, ControlledShutdownRequest<span class="delimiter">}</span>
import kafka.common.ErrorMapping
import kafka.network.<span class="delimiter">{</span>Receive, BlockingChannel, SocketServer<span class="delimiter">}</span>
import kafka.metrics.KafkaMetricsGroup
import com.yammer.metrics.core.Gauge

<span class="comment">/**
 * Represents the lifecycle of a single Kafka broker. Handles all functionality required
 * to start up and shutdown a single Kafka node.
 */</span>
class <a title="class KafkaServer extends AnyRef with kafka.utils.Logging with kafka.metrics.KafkaMetricsGroup" id="kafka.server.KafkaServer">KafkaServer</a><a href="#kafka.server.KafkaServer" title="kafka.server.KafkaServer" class="delimiter">(</a>val <a title="kafka.server.KafkaConfig" id="kafka.server;KafkaServer.config">config</a>: <a href="KafkaConfig.scala.html#kafka.server;KafkaConfig" title="kafka.server.KafkaConfig">KafkaConfig</a>, <a title="kafka.utils.Time" id="kafka.server.KafkaServer.<init>$default$2">time</a>: <a href="../utils/Time.scala.html#kafka.utils;Time" title="kafka.utils.Time">Time</a> = <a href="../utils/Time.scala.html#kafka.utils.SystemTime" title="kafka.utils.SystemTime.type">SystemTime</a><span class="delimiter">)</span> extends <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> with <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup" title="kafka.metrics.KafkaMetricsGroup">KafkaMetricsGroup</a> <span class="delimiter">{</span>
  this.<a href="../utils/Logging.scala.html#kafka.utils;Logging.logIdent_=" title="(x$1: String)Unit">logIdent</a> = <span title="String(&quot;[Kafka Server &quot;)" class="string">&quot;[Kafka Server &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.brokerId" title="=&gt; Int">brokerId</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;], &quot;)" class="string">&quot;], &quot;</span>
  private var <a title="java.util.concurrent.atomic.AtomicBoolean" id="kafka.server;KafkaServer.isShuttingDown_=">isShuttingDown</a> = new <span title="java.util.concurrent.atomic.AtomicBoolean">AtomicBoolean</span><span class="delimiter">(</span>false<span class="delimiter">)</span>
  private var <a title="java.util.concurrent.CountDownLatch" id="kafka.server;KafkaServer.shutdownLatch_=">shutdownLatch</a> = new <span title="java.util.concurrent.CountDownLatch">CountDownLatch</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
  private var <a title="java.util.concurrent.atomic.AtomicBoolean" id="kafka.server;KafkaServer.startupComplete_=">startupComplete</a> = new <span title="java.util.concurrent.atomic.AtomicBoolean">AtomicBoolean</span><span class="delimiter">(</span>false<span class="delimiter">)</span>
  val <a title="kafka.server.BrokerState" id="kafka.server;KafkaServer.brokerState">brokerState</a>: <a href="BrokerStates.scala.html#kafka.server;BrokerState" title="kafka.server.BrokerState">BrokerState</a> = new <a href="BrokerStates.scala.html#kafka.server;BrokerState" title="kafka.server.BrokerState">BrokerState</a>
  val <a title="java.util.concurrent.atomic.AtomicInteger" id="kafka.server;KafkaServer.correlationId">correlationId</a>: <span title="java.util.concurrent.atomic.AtomicInteger">AtomicInteger</span> = new <span title="java.util.concurrent.atomic.AtomicInteger">AtomicInteger</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
  var <a title="kafka.network.SocketServer" id="kafka.server;KafkaServer.socketServer_=">socketServer</a>: <a href="../network/SocketServer.scala.html#kafka.network;SocketServer" title="kafka.network.SocketServer">SocketServer</a> = null
  var <a title="kafka.server.KafkaRequestHandlerPool" id="kafka.server;KafkaServer.requestHandlerPool_=">requestHandlerPool</a>: <a href="KafkaRequestHandler.scala.html#kafka.server;KafkaRequestHandlerPool" title="kafka.server.KafkaRequestHandlerPool">KafkaRequestHandlerPool</a> = null
  var <a title="kafka.log.LogManager" id="kafka.server;KafkaServer.logManager_=">logManager</a>: <a href="../log/LogManager.scala.html#kafka.log;LogManager" title="kafka.log.LogManager">LogManager</a> = null
  var <a title="kafka.server.OffsetManager" id="kafka.server;KafkaServer.offsetManager_=">offsetManager</a>: <a href="OffsetManager.scala.html#kafka.server;OffsetManager" title="kafka.server.OffsetManager">OffsetManager</a> = null
  var <a title="kafka.server.KafkaHealthcheck" id="kafka.server;KafkaServer.kafkaHealthcheck_=">kafkaHealthcheck</a>: <a href="KafkaHealthcheck.scala.html#kafka.server;KafkaHealthcheck" title="kafka.server.KafkaHealthcheck">KafkaHealthcheck</a> = null
  var <a title="kafka.server.TopicConfigManager" id="kafka.server;KafkaServer.topicConfigManager_=">topicConfigManager</a>: <a href="TopicConfigManager.scala.html#kafka.server;TopicConfigManager" title="kafka.server.TopicConfigManager">TopicConfigManager</a> = null
  var <a title="kafka.server.ReplicaManager" id="kafka.server;KafkaServer.replicaManager_=">replicaManager</a>: <a href="ReplicaManager.scala.html#kafka.server;ReplicaManager" title="kafka.server.ReplicaManager">ReplicaManager</a> = null
  var <a title="kafka.server.KafkaApis" id="kafka.server;KafkaServer.apis_=">apis</a>: <a href="KafkaApis.scala.html#kafka.server;KafkaApis" title="kafka.server.KafkaApis">KafkaApis</a> = null
  var <a title="kafka.controller.KafkaController" id="kafka.server;KafkaServer.kafkaController_=">kafkaController</a>: <a href="../controller/KafkaController.scala.html#kafka.controller;KafkaController" title="kafka.controller.KafkaController">KafkaController</a> = null
  val <a title="kafka.utils.KafkaScheduler" id="kafka.server;KafkaServer.kafkaScheduler">kafkaScheduler</a> = new <a href="../utils/KafkaScheduler.scala.html#kafka.utils;KafkaScheduler" title="kafka.utils.KafkaScheduler">KafkaScheduler</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.backgroundThreads" title="=&gt; Int">backgroundThreads</a><span class="delimiter">)</span>
  var <a title="org.I0Itec.zkclient.ZkClient" id="kafka.server;KafkaServer.zkClient_=">zkClient</a>: <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span> = null

  <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newGauge" title="(name: String, metric: com.yammer.metrics.core.Gauge[Int], tags: scala.collection.Map[String,String])com.yammer.metrics.core.Gauge[Int]">newGauge</a><span class="delimiter">(</span>
    <span title="String(&quot;BrokerState&quot;)" class="string">&quot;BrokerState&quot;</span>,
    new <a title="&lt;$anon: com.yammer.metrics.core.Gauge[Int]&gt; extends com.yammer.metrics.core.Gauge[Int]" id="kafka.server;KafkaServer.<local KafkaServer>;$anon">Gauge</a><span class="delimiter">[</span>Int<span class="delimiter">]</span> <span class="delimiter">{</span>
      def <a title="()Int" id="kafka.server;KafkaServer.<local KafkaServer>;$anon.value">value</a> = <a href="#kafka.server;KafkaServer.brokerState" title="=&gt; kafka.server.BrokerState">brokerState</a>.<a href="BrokerStates.scala.html#kafka.server;BrokerState.currentState" title="=&gt; Int">currentState</a>
    <span class="delimiter">}</span>
  <span class="delimiter">)</span>

  <span class="comment">/**
   * Start up API for bringing up a single instance of the Kafka server.
   * Instantiates the LogManager, the SocketServer and the request handlers - KafkaRequestHandlers
   */</span>
  def <a title="()Unit" id="kafka.server;KafkaServer.startup">startup</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    try <span class="delimiter">{</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;starting&quot;)" class="string">&quot;starting&quot;</span><span class="delimiter">)</span>
      <a href="#kafka.server;KafkaServer.brokerState" title="=&gt; kafka.server.BrokerState">brokerState</a>.<a href="BrokerStates.scala.html#kafka.server;BrokerState.newState(ab9c491e36)" title="(newState: kafka.server.BrokerStates)Unit">newState</a><span class="delimiter">(</span><a href="BrokerStates.scala.html#kafka.server.Starting" title="kafka.server.Starting.type">Starting</a><span class="delimiter">)</span>
      <a href="#kafka.server;KafkaServer.isShuttingDown_=" title="(x$1: java.util.concurrent.atomic.AtomicBoolean)Unit">isShuttingDown</a> = new <span title="java.util.concurrent.atomic.AtomicBoolean">AtomicBoolean</span><span class="delimiter">(</span>false<span class="delimiter">)</span>
      <a href="#kafka.server;KafkaServer.shutdownLatch_=" title="(x$1: java.util.concurrent.CountDownLatch)Unit">shutdownLatch</a> = new <span title="java.util.concurrent.CountDownLatch">CountDownLatch</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>

      <span class="comment">/* start scheduler */</span>
      <a href="#kafka.server;KafkaServer.kafkaScheduler" title="=&gt; kafka.utils.KafkaScheduler">kafkaScheduler</a>.<a href="../utils/KafkaScheduler.scala.html#kafka.utils;KafkaScheduler.startup" title="()Unit">startup</a><span class="delimiter">(</span><span class="delimiter">)</span>
    
      <span class="comment">/* setup zookeeper */</span>
      <a href="#kafka.server;KafkaServer.zkClient_=" title="(x$1: org.I0Itec.zkclient.ZkClient)Unit">zkClient</a> = <a href="#kafka.server;KafkaServer.initZk" title="()org.I0Itec.zkclient.ZkClient">initZk</a><span class="delimiter">(</span><span class="delimiter">)</span>

      <span class="comment">/* start log manager */</span>
      <a href="#kafka.server;KafkaServer.logManager_=" title="(x$1: kafka.log.LogManager)Unit">logManager</a> = <a href="#kafka.server;KafkaServer.createLogManager" title="(zkClient: org.I0Itec.zkclient.ZkClient, brokerState: kafka.server.BrokerState)kafka.log.LogManager">createLogManager</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.server;KafkaServer.brokerState" title="=&gt; kafka.server.BrokerState">brokerState</a><span class="delimiter">)</span>
      <a href="#kafka.server;KafkaServer.logManager_=" title="=&gt; kafka.log.LogManager">logManager</a>.<a href="../log/LogManager.scala.html#kafka.log;LogManager.startup" title="()Unit">startup</a><span class="delimiter">(</span><span class="delimiter">)</span>

      <a href="#kafka.server;KafkaServer.socketServer_=" title="(x$1: kafka.network.SocketServer)Unit">socketServer</a> = new <a href="../network/SocketServer.scala.html#kafka.network;SocketServer" title="kafka.network.SocketServer">SocketServer</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.brokerId" title="=&gt; Int">brokerId</a>,
                                      <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.hostName" title="=&gt; String">hostName</a>,
                                      <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.port" title="=&gt; Int">port</a>,
                                      <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.numNetworkThreads" title="=&gt; Int">numNetworkThreads</a>,
                                      <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.queuedMaxRequests" title="=&gt; Int">queuedMaxRequests</a>,
                                      <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.socketSendBufferBytes" title="=&gt; Int">socketSendBufferBytes</a>,
                                      <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.socketReceiveBufferBytes" title="=&gt; Int">socketReceiveBufferBytes</a>,
                                      <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.socketRequestMaxBytes" title="=&gt; Int">socketRequestMaxBytes</a>,
                                      <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.maxConnectionsPerIp" title="=&gt; Int">maxConnectionsPerIp</a>,
                                      <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.connectionsMaxIdleMs" title="=&gt; Long">connectionsMaxIdleMs</a>,
                                      <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.maxConnectionsPerIpOverrides" title="=&gt; scala.collection.Map[String,Int]">maxConnectionsPerIpOverrides</a><span class="delimiter">)</span>
      <a href="#kafka.server;KafkaServer.socketServer_=" title="=&gt; kafka.network.SocketServer">socketServer</a>.<a href="../network/SocketServer.scala.html#kafka.network;SocketServer.startup" title="()Unit">startup</a><span class="delimiter">(</span><span class="delimiter">)</span>

      <a href="#kafka.server;KafkaServer.replicaManager_=" title="(x$1: kafka.server.ReplicaManager)Unit">replicaManager</a> = new <a href="ReplicaManager.scala.html#kafka.server;ReplicaManager" title="kafka.server.ReplicaManager">ReplicaManager</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>, <a href="#kafka.server.KafkaServer.<init>$default$2" title="kafka.utils.Time">time</a>, <a href="#kafka.server;KafkaServer.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.server;KafkaServer.kafkaScheduler" title="=&gt; kafka.utils.KafkaScheduler">kafkaScheduler</a>, <a href="#kafka.server;KafkaServer.logManager_=" title="=&gt; kafka.log.LogManager">logManager</a>, <a href="#kafka.server;KafkaServer.isShuttingDown_=" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">isShuttingDown</a><span class="delimiter">)</span>

      <span class="comment">/* start offset manager */</span>
      <a href="#kafka.server;KafkaServer.offsetManager_=" title="(x$1: kafka.server.OffsetManager)Unit">offsetManager</a> = <a href="#kafka.server;KafkaServer.createOffsetManager" title="()kafka.server.OffsetManager">createOffsetManager</a><span class="delimiter">(</span><span class="delimiter">)</span>

      <a href="#kafka.server;KafkaServer.kafkaController_=" title="(x$1: kafka.controller.KafkaController)Unit">kafkaController</a> = new <a href="../controller/KafkaController.scala.html#kafka.controller;KafkaController" title="kafka.controller.KafkaController">KafkaController</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>, <a href="#kafka.server;KafkaServer.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.server;KafkaServer.brokerState" title="=&gt; kafka.server.BrokerState">brokerState</a><span class="delimiter">)</span>
    
      <span class="comment">/* start processing requests */</span>
      <a href="#kafka.server;KafkaServer.apis_=" title="(x$1: kafka.server.KafkaApis)Unit">apis</a> = new <a href="KafkaApis.scala.html#kafka.server;KafkaApis" title="kafka.server.KafkaApis">KafkaApis</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.socketServer_=" title="=&gt; kafka.network.SocketServer">socketServer</a>.<a href="../network/SocketServer.scala.html#kafka.network;SocketServer.requestChannel" title="=&gt; kafka.network.RequestChannel">requestChannel</a>, <a href="#kafka.server;KafkaServer.replicaManager_=" title="=&gt; kafka.server.ReplicaManager">replicaManager</a>, <a href="#kafka.server;KafkaServer.offsetManager_=" title="=&gt; kafka.server.OffsetManager">offsetManager</a>, <a href="#kafka.server;KafkaServer.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.brokerId" title="=&gt; Int">brokerId</a>, <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>, <a href="#kafka.server;KafkaServer.kafkaController_=" title="=&gt; kafka.controller.KafkaController">kafkaController</a><span class="delimiter">)</span>
      <a href="#kafka.server;KafkaServer.requestHandlerPool_=" title="(x$1: kafka.server.KafkaRequestHandlerPool)Unit">requestHandlerPool</a> = new <a href="KafkaRequestHandler.scala.html#kafka.server;KafkaRequestHandlerPool" title="kafka.server.KafkaRequestHandlerPool">KafkaRequestHandlerPool</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.brokerId" title="=&gt; Int">brokerId</a>, <a href="#kafka.server;KafkaServer.socketServer_=" title="=&gt; kafka.network.SocketServer">socketServer</a>.<a href="../network/SocketServer.scala.html#kafka.network;SocketServer.requestChannel" title="=&gt; kafka.network.RequestChannel">requestChannel</a>, <a href="#kafka.server;KafkaServer.apis_=" title="=&gt; kafka.server.KafkaApis">apis</a>, <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.numIoThreads" title="=&gt; Int">numIoThreads</a><span class="delimiter">)</span>
      <a href="#kafka.server;KafkaServer.brokerState" title="=&gt; kafka.server.BrokerState">brokerState</a>.<a href="BrokerStates.scala.html#kafka.server;BrokerState.newState(ab9c491e36)" title="(newState: kafka.server.BrokerStates)Unit">newState</a><span class="delimiter">(</span><a href="BrokerStates.scala.html#kafka.server.RunningAsBroker" title="kafka.server.RunningAsBroker.type">RunningAsBroker</a><span class="delimiter">)</span>
   
      <a href="../utils/Mx4jLoader.scala.html#kafka.utils.Mx4jLoader" title="kafka.utils.Mx4jLoader.type">Mx4jLoader</a>.<a href="../utils/Mx4jLoader.scala.html#kafka.utils.Mx4jLoader.maybeLoad" title="()Boolean">maybeLoad</a><span class="delimiter">(</span><span class="delimiter">)</span>

      <a href="#kafka.server;KafkaServer.replicaManager_=" title="=&gt; kafka.server.ReplicaManager">replicaManager</a>.<a href="ReplicaManager.scala.html#kafka.server;ReplicaManager.startup" title="()Unit">startup</a><span class="delimiter">(</span><span class="delimiter">)</span>

      <a href="#kafka.server;KafkaServer.kafkaController_=" title="=&gt; kafka.controller.KafkaController">kafkaController</a>.<a href="../controller/KafkaController.scala.html#kafka.controller;KafkaController.startup" title="()Unit">startup</a><span class="delimiter">(</span><span class="delimiter">)</span>
    
      <a href="#kafka.server;KafkaServer.topicConfigManager_=" title="(x$1: kafka.server.TopicConfigManager)Unit">topicConfigManager</a> = new <a href="TopicConfigManager.scala.html#kafka.server;TopicConfigManager" title="kafka.server.TopicConfigManager">TopicConfigManager</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.server;KafkaServer.logManager_=" title="=&gt; kafka.log.LogManager">logManager</a><span class="delimiter">)</span>
      <a href="#kafka.server;KafkaServer.topicConfigManager_=" title="=&gt; kafka.server.TopicConfigManager">topicConfigManager</a>.<a href="TopicConfigManager.scala.html#kafka.server;TopicConfigManager.startup" title="()Unit">startup</a><span class="delimiter">(</span><span class="delimiter">)</span>
    
      <span class="comment">/* tell everyone we are alive */</span>
      <a href="#kafka.server;KafkaServer.kafkaHealthcheck_=" title="(x$1: kafka.server.KafkaHealthcheck)Unit">kafkaHealthcheck</a> = new <a href="KafkaHealthcheck.scala.html#kafka.server;KafkaHealthcheck" title="kafka.server.KafkaHealthcheck">KafkaHealthcheck</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.brokerId" title="=&gt; Int">brokerId</a>, <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.advertisedHostName" title="=&gt; String">advertisedHostName</a>, <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.advertisedPort" title="=&gt; Int">advertisedPort</a>, <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkSessionTimeoutMs" title="=&gt; Int">zkSessionTimeoutMs</a>, <a href="#kafka.server;KafkaServer.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a><span class="delimiter">)</span>
      <a href="#kafka.server;KafkaServer.kafkaHealthcheck_=" title="=&gt; kafka.server.KafkaHealthcheck">kafkaHealthcheck</a>.<a href="KafkaHealthcheck.scala.html#kafka.server;KafkaHealthcheck.startup" title="()Unit">startup</a><span class="delimiter">(</span><span class="delimiter">)</span>

    
      <a href="#kafka.server;KafkaServer.registerStats" title="()Unit">registerStats</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#kafka.server;KafkaServer.startupComplete_=" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">startupComplete</a>.<span title="(x$1: Boolean)Unit">set</span><span class="delimiter">(</span>true<span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;started&quot;)" class="string">&quot;started&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    catch <span class="delimiter">{</span>
      case <a title="Throwable" id="kafka.server;KafkaServer.startup.e">e</a>: <span title="Throwable">Throwable</span> =&gt;
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.fatal(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">fatal</a><span class="delimiter">(</span><span title="String(&quot;Fatal error during KafkaServer startup. Prepare to shutdown&quot;)" class="string">&quot;Fatal error during KafkaServer startup. Prepare to shutdown&quot;</span>, <a href="#kafka.server;KafkaServer.startup.e" title="Throwable">e</a><span class="delimiter">)</span>
        <a href="#kafka.server;KafkaServer.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throw <a href="#kafka.server;KafkaServer.startup.e" title="Throwable">e</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="()org.I0Itec.zkclient.ZkClient" id="kafka.server;KafkaServer.initZk">initZk</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span> = <span class="delimiter">{</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Connecting to zookeeper on &quot;)" class="string">&quot;Connecting to zookeeper on &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkConnect" title="=&gt; String">zkConnect</a><span class="delimiter">)</span>

    val <a title="String" id="kafka.server;KafkaServer.initZk.chroot">chroot</a> = <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkConnect" title="=&gt; String">zkConnect</a>.<span title="(x$1: String)Int">indexOf</span><span class="delimiter">(</span><span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkConnect" title="=&gt; String">zkConnect</a>.<span title="(x$1: Int)String">substring</span><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkConnect" title="=&gt; String">zkConnect</a>.<span title="(x$1: String)Int">indexOf</span><span class="delimiter">(</span><span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      else
        <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>
    <span class="delimiter">}</span>

    if <span class="delimiter">(</span><a href="#kafka.server;KafkaServer.initZk.chroot" title="String">chroot</a>.<span title="()Int">length</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="String" id="kafka.server;KafkaServer.initZk.zkConnForChrootCreation">zkConnForChrootCreation</a> = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkConnect" title="=&gt; String">zkConnect</a>.<span title="(x$1: Int, x$2: Int)String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkConnect" title="=&gt; String">zkConnect</a>.<span title="(x$1: String)Int">indexOf</span><span class="delimiter">(</span><span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      val <a title="org.I0Itec.zkclient.ZkClient" id="kafka.server;KafkaServer.initZk.zkClientForChrootCreation">zkClientForChrootCreation</a> = new <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.initZk.zkConnForChrootCreation" title="String">zkConnForChrootCreation</a>, <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkSessionTimeoutMs" title="=&gt; Int">zkSessionTimeoutMs</a>, <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkConnectionTimeoutMs" title="=&gt; Int">zkConnectionTimeoutMs</a>, <a href="../utils/ZkUtils.scala.html#kafka.utils.ZKStringSerializer" title="kafka.utils.ZKStringSerializer.type">ZKStringSerializer</a><span class="delimiter">)</span>
      <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.makeSurePersistentPathExists" title="(client: org.I0Itec.zkclient.ZkClient, path: String)Unit">makeSurePersistentPathExists</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.initZk.zkClientForChrootCreation" title="org.I0Itec.zkclient.ZkClient">zkClientForChrootCreation</a>, <a href="#kafka.server;KafkaServer.initZk.chroot" title="String">chroot</a><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Created zookeeper path &quot;)" class="string">&quot;Created zookeeper path &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.server;KafkaServer.initZk.chroot" title="String">chroot</a><span class="delimiter">)</span>
      <a href="#kafka.server;KafkaServer.initZk.zkClientForChrootCreation" title="org.I0Itec.zkclient.ZkClient">zkClientForChrootCreation</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    val <a title="org.I0Itec.zkclient.ZkClient" id="kafka.server;KafkaServer.initZk.zkClient">zkClient</a> = new <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkConnect" title="=&gt; String">zkConnect</a>, <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkSessionTimeoutMs" title="=&gt; Int">zkSessionTimeoutMs</a>, <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkConnectionTimeoutMs" title="=&gt; Int">zkConnectionTimeoutMs</a>, <a href="../utils/ZkUtils.scala.html#kafka.utils.ZKStringSerializer" title="kafka.utils.ZKStringSerializer.type">ZKStringSerializer</a><span class="delimiter">)</span>
    <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.setupCommonPaths" title="(zkClient: org.I0Itec.zkclient.ZkClient)Unit">setupCommonPaths</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.initZk.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a><span class="delimiter">)</span>
    <a href="#kafka.server;KafkaServer.initZk.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a>
  <span class="delimiter">}</span>


  <span class="comment">/**
   *  Forces some dynamic jmx beans to be registered on server startup.
   */</span>
  private def <a title="()Unit" id="kafka.server;KafkaServer.registerStats">registerStats</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="KafkaRequestHandler.scala.html#kafka.server.BrokerTopicStats" title="kafka.server.BrokerTopicStats.type">BrokerTopicStats</a>.<a href="KafkaRequestHandler.scala.html#kafka.server.BrokerTopicStats.getBrokerAllTopicsStats" title="()kafka.server.BrokerTopicMetrics">getBrokerAllTopicsStats</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="../controller/KafkaController.scala.html#kafka.controller.ControllerStats" title="kafka.controller.ControllerStats.type">ControllerStats</a>.<a href="../controller/KafkaController.scala.html#kafka.controller.ControllerStats.uncleanLeaderElectionRate" title="=&gt; com.yammer.metrics.core.Meter">uncleanLeaderElectionRate</a>
    <a href="../controller/KafkaController.scala.html#kafka.controller.ControllerStats" title="kafka.controller.ControllerStats.type">ControllerStats</a>.<a href="../controller/KafkaController.scala.html#kafka.controller.ControllerStats.leaderElectionTimer" title="=&gt; kafka.metrics.KafkaTimer">leaderElectionTimer</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   *  Performs controlled shutdown
   */</span>
  private def <a title="()Unit" id="kafka.server;KafkaServer.controlledShutdown">controlledShutdown</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#kafka.server;KafkaServer.startupComplete_=" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">startupComplete</a>.<span title="()Boolean">get</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.controlledShutdownEnable" title="=&gt; Boolean">controlledShutdownEnable</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// We request the controller to do a controlled shutdown. On failure, we backoff for a configured period</span>
      <span class="comment">// of time and try again for a configured number of retries. If all the attempt fails, we simply force</span>
      <span class="comment">// the shutdown.</span>
      var <a title="Int" id="kafka.server;KafkaServer.controlledShutdown.remainingRetries">remainingRetries</a> = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.controlledShutdownMaxRetries" title="=&gt; Int">controlledShutdownMaxRetries</a>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Starting controlled shutdown&quot;)" class="string">&quot;Starting controlled shutdown&quot;</span><span class="delimiter">)</span>
      var <a title="kafka.network.BlockingChannel" id="kafka.server;KafkaServer.controlledShutdown.channel">channel</a> : <a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel" title="kafka.network.BlockingChannel">BlockingChannel</a> = null
      var <a title="kafka.cluster.Broker" id="kafka.server;KafkaServer.controlledShutdown.prevController">prevController</a> : <a href="../cluster/Broker.scala.html#kafka.cluster;Broker" title="kafka.cluster.Broker">Broker</a> = null
      var <a title="Boolean" id="kafka.server;KafkaServer.controlledShutdown.shutdownSuceeded">shutdownSuceeded</a> : <span title="Boolean">Boolean</span> = false
      try <span class="delimiter">{</span>
        <a href="#kafka.server;KafkaServer.brokerState" title="=&gt; kafka.server.BrokerState">brokerState</a>.<a href="BrokerStates.scala.html#kafka.server;BrokerState.newState(ab9c491e36)" title="(newState: kafka.server.BrokerStates)Unit">newState</a><span class="delimiter">(</span><a href="BrokerStates.scala.html#kafka.server.PendingControlledShutdown" title="kafka.server.PendingControlledShutdown.type">PendingControlledShutdown</a><span class="delimiter">)</span>
        while <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.server;KafkaServer.controlledShutdown.shutdownSuceeded" title="Boolean">shutdownSuceeded</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#kafka.server;KafkaServer.controlledShutdown.remainingRetries" title="Int">remainingRetries</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#kafka.server;KafkaServer.controlledShutdown.while$1" title="()Unit" class="delimiter">{</a>
          <a href="#kafka.server;KafkaServer.controlledShutdown.remainingRetries" title="Int">remainingRetries</a> = <a href="#kafka.server;KafkaServer.controlledShutdown.remainingRetries" title="Int">remainingRetries</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>

          <span class="comment">// 1. Find the controller and establish a connection to it.</span>

          <span class="comment">// Get the current controller info. This is to ensure we use the most recent info to issue the</span>
          <span class="comment">// controlled shutdown request</span>
          val <a title="Int" id="kafka.server;KafkaServer.controlledShutdown.controllerId">controllerId</a> = <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.getController" title="(zkClient: org.I0Itec.zkclient.ZkClient)Int">getController</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a><span class="delimiter">)</span>
          <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.getBrokerInfo" title="(zkClient: org.I0Itec.zkclient.ZkClient, brokerId: Int)Option[kafka.cluster.Broker]">getBrokerInfo</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.server;KafkaServer.controlledShutdown.controllerId" title="Int">controllerId</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
            case Some<span class="delimiter">(</span><a title="kafka.cluster.Broker" id="kafka.server;KafkaServer.controlledShutdown.broker">broker</a><span class="delimiter">)</span> =&gt;
              if <span class="delimiter">(</span><a href="#kafka.server;KafkaServer.controlledShutdown.channel" title="kafka.network.BlockingChannel">channel</a> <span title="(x$1: Any)Boolean">==</span> null <span title="(x: Boolean)Boolean">||</span> <a href="#kafka.server;KafkaServer.controlledShutdown.prevController" title="kafka.cluster.Broker">prevController</a> <span title="(x$1: Any)Boolean">==</span> null <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><a href="#kafka.server;KafkaServer.controlledShutdown.prevController" title="kafka.cluster.Broker">prevController</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.equals" title="(obj: Any)Boolean">equals</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.controlledShutdown.broker" title="kafka.cluster.Broker">broker</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="comment">// if this is the first attempt or if the controller has changed, create a channel to the most recent</span>
                <span class="comment">// controller</span>
                if <span class="delimiter">(</span><a href="#kafka.server;KafkaServer.controlledShutdown.channel" title="kafka.network.BlockingChannel">channel</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="#kafka.server;KafkaServer.controlledShutdown.channel" title="kafka.network.BlockingChannel">channel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.disconnect" title="()Unit">disconnect</a><span class="delimiter">(</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
                <a href="#kafka.server;KafkaServer.controlledShutdown.channel" title="kafka.network.BlockingChannel">channel</a> = new <a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel" title="kafka.network.BlockingChannel">BlockingChannel</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.controlledShutdown.broker" title="kafka.cluster.Broker">broker</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.host" title="=&gt; String">host</a>, <a href="#kafka.server;KafkaServer.controlledShutdown.broker" title="kafka.cluster.Broker">broker</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.port" title="=&gt; Int">port</a>,
                  <a href="../network/BlockingChannel.scala.html#kafka.network.BlockingChannel" title="kafka.network.BlockingChannel.type">BlockingChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network.BlockingChannel.UseDefaultBufferSize" title="=&gt; Int">UseDefaultBufferSize</a>,
                  <a href="../network/BlockingChannel.scala.html#kafka.network.BlockingChannel" title="kafka.network.BlockingChannel.type">BlockingChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network.BlockingChannel.UseDefaultBufferSize" title="=&gt; Int">UseDefaultBufferSize</a>,
                  <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.controllerSocketTimeoutMs" title="=&gt; Int">controllerSocketTimeoutMs</a><span class="delimiter">)</span>
                <a href="#kafka.server;KafkaServer.controlledShutdown.channel" title="kafka.network.BlockingChannel">channel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.connect" title="()Unit">connect</a><span class="delimiter">(</span><span class="delimiter">)</span>
                <a href="#kafka.server;KafkaServer.controlledShutdown.prevController" title="kafka.cluster.Broker">prevController</a> = <a href="#kafka.server;KafkaServer.controlledShutdown.broker" title="kafka.cluster.Broker">broker</a>
              <span class="delimiter">}</span>
            case <span title="None.type">None</span>=&gt;
              <span class="comment">//ignore and try again</span>
          <span class="delimiter">}</span>

          <span class="comment">// 2. issue a controlled shutdown to the controller</span>
          if <span class="delimiter">(</span><a href="#kafka.server;KafkaServer.controlledShutdown.channel" title="kafka.network.BlockingChannel">channel</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
            var <a title="kafka.network.Receive" id="kafka.server;KafkaServer.controlledShutdown.response">response</a>: <a href="../network/Transmission.scala.html#kafka.network;Receive" title="kafka.network.Receive">Receive</a> = null
            try <span class="delimiter">{</span>
              <span class="comment">// send the controlled shutdown request</span>
              val <a title="kafka.api.ControlledShutdownRequest" id="kafka.server;KafkaServer.controlledShutdown.request">request</a> = new <a href="../api/ControlledShutdownRequest.scala.html#kafka.api;ControlledShutdownRequest" title="kafka.api.ControlledShutdownRequest">ControlledShutdownRequest</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.correlationId" title="=&gt; java.util.concurrent.atomic.AtomicInteger">correlationId</a>.<span title="()Int">getAndIncrement</span>, <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.brokerId" title="=&gt; Int">brokerId</a><span class="delimiter">)</span>
              <a href="#kafka.server;KafkaServer.controlledShutdown.channel" title="kafka.network.BlockingChannel">channel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.send" title="(request: kafka.api.RequestOrResponse)Int">send</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.controlledShutdown.request" title="kafka.api.ControlledShutdownRequest">request</a><span class="delimiter">)</span>

              <a href="#kafka.server;KafkaServer.controlledShutdown.response" title="kafka.network.Receive">response</a> = <a href="#kafka.server;KafkaServer.controlledShutdown.channel" title="kafka.network.BlockingChannel">channel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.receive" title="()kafka.network.Receive">receive</a><span class="delimiter">(</span><span class="delimiter">)</span>
              val <a title="kafka.api.ControlledShutdownResponse" id="kafka.server;KafkaServer.controlledShutdown.shutdownResponse">shutdownResponse</a> = <a href="../api/ControlledShutdownResponse.scala.html#kafka.api.ControlledShutdownResponse" title="kafka.api.ControlledShutdownResponse.type">ControlledShutdownResponse</a>.<a href="../api/ControlledShutdownResponse.scala.html#kafka.api.ControlledShutdownResponse.readFrom" title="(buffer: java.nio.ByteBuffer)kafka.api.ControlledShutdownResponse">readFrom</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.controlledShutdown.response" title="kafka.network.Receive">response</a>.<a href="../network/Transmission.scala.html#kafka.network;Receive.buffer" title="=&gt; java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
              if <span class="delimiter">(</span><a href="#kafka.server;KafkaServer.controlledShutdown.shutdownResponse" title="kafka.api.ControlledShutdownResponse">shutdownResponse</a>.<a href="../api/ControlledShutdownResponse.scala.html#kafka.api;ControlledShutdownResponse.errorCode" title="=&gt; Short">errorCode</a> <span title="(x: Short)Boolean">==</span> <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.NoError" title="=&gt; Short">NoError</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#kafka.server;KafkaServer.controlledShutdown.shutdownResponse" title="kafka.api.ControlledShutdownResponse">shutdownResponse</a>.<a href="../api/ControlledShutdownResponse.scala.html#kafka.api;ControlledShutdownResponse.partitionsRemaining" title="=&gt; scala.collection.Set[kafka.common.TopicAndPartition]">partitionsRemaining</a> <span title="(x$1: Any)Boolean">!=</span> null <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                  <a href="#kafka.server;KafkaServer.controlledShutdown.shutdownResponse" title="kafka.api.ControlledShutdownResponse">shutdownResponse</a>.<a href="../api/ControlledShutdownResponse.scala.html#kafka.api;ControlledShutdownResponse.partitionsRemaining" title="=&gt; scala.collection.Set[kafka.common.TopicAndPartition]">partitionsRemaining</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#kafka.server;KafkaServer.controlledShutdown.shutdownSuceeded" title="Boolean">shutdownSuceeded</a> = true
                <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a> <span class="delimiter">(</span><span title="String(&quot;Controlled shutdown succeeded&quot;)" class="string">&quot;Controlled shutdown succeeded&quot;</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
              else <span class="delimiter">{</span>
                <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Remaining partitions to move: %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.controlledShutdown.shutdownResponse" title="kafka.api.ControlledShutdownResponse">shutdownResponse</a>.<a href="../api/ControlledShutdownResponse.scala.html#kafka.api;ControlledShutdownResponse.partitionsRemaining" title="=&gt; scala.collection.Set[kafka.common.TopicAndPartition]">partitionsRemaining</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Error code from controller: %d&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.controlledShutdown.shutdownResponse" title="kafka.api.ControlledShutdownResponse">shutdownResponse</a>.<a href="../api/ControlledShutdownResponse.scala.html#kafka.api;ControlledShutdownResponse.errorCode" title="=&gt; Short">errorCode</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
            catch <span class="delimiter">{</span>
              case <a title="java.io.IOException" id="kafka.server;KafkaServer.controlledShutdown.ioe">ioe</a>: java.io.<span title="java.io.IOException">IOException</span> =&gt;
                <a href="#kafka.server;KafkaServer.controlledShutdown.channel" title="kafka.network.BlockingChannel">channel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.disconnect" title="()Unit">disconnect</a><span class="delimiter">(</span><span class="delimiter">)</span>
                <a href="#kafka.server;KafkaServer.controlledShutdown.channel" title="kafka.network.BlockingChannel">channel</a> = null
                <a href="../utils/Logging.scala.html#kafka.utils;Logging.warn(1729dbc42f)" title="(msg: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Error during controlled shutdown, possibly because leader movement took longer than the configured socket.timeout.ms: %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.controlledShutdown.ioe" title="java.io.IOException">ioe</a>.<span title="()String">getMessage</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="comment">// ignore and try again</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
          if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.server;KafkaServer.controlledShutdown.shutdownSuceeded" title="Boolean">shutdownSuceeded</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="Thread.type">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.controlledShutdownRetryBackoffMs" title="=&gt; Long">controlledShutdownRetryBackoffMs</a><span class="delimiter">)</span>
            <a href="../utils/Logging.scala.html#kafka.utils;Logging.warn(1729dbc42f)" title="(msg: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="String(&quot;Retrying controlled shutdown after the previous attempt failed...&quot;)" class="string">&quot;Retrying controlled shutdown after the previous attempt failed...&quot;</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      finally <span class="delimiter">{</span>
        if <span class="delimiter">(</span><a href="#kafka.server;KafkaServer.controlledShutdown.channel" title="kafka.network.BlockingChannel">channel</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#kafka.server;KafkaServer.controlledShutdown.channel" title="kafka.network.BlockingChannel">channel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.disconnect" title="()Unit">disconnect</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#kafka.server;KafkaServer.controlledShutdown.channel" title="kafka.network.BlockingChannel">channel</a> = null
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.server;KafkaServer.controlledShutdown.shutdownSuceeded" title="Boolean">shutdownSuceeded</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.warn(1729dbc42f)" title="(msg: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="String(&quot;Proceeding to do an unclean shutdown as all the controlled shutdown attempts failed&quot;)" class="string">&quot;Proceeding to do an unclean shutdown as all the controlled shutdown attempts failed&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Shutdown API for shutting down a single instance of the Kafka server.
   * Shuts down the LogManager, the SocketServer and the log cleaner scheduler thread
   */</span>
  def <a title="()Unit" id="kafka.server;KafkaServer.shutdown">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    try <span class="delimiter">{</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;shutting down&quot;)" class="string">&quot;shutting down&quot;</span><span class="delimiter">)</span>
      val <a title="Boolean" id="kafka.server;KafkaServer.shutdown.canShutdown">canShutdown</a> = <a href="#kafka.server;KafkaServer.isShuttingDown_=" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">isShuttingDown</a>.<span title="(x$1: Boolean, x$2: Boolean)Boolean">compareAndSet</span><span class="delimiter">(</span>false, true<span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#kafka.server;KafkaServer.shutdown.canShutdown" title="Boolean">canShutdown</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Logging.scala.html#kafka.utils;Logging.swallow" title="(action: =&gt; Unit)Unit">swallow</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.controlledShutdown" title="()Unit">controlledShutdown</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#kafka.server;KafkaServer.brokerState" title="=&gt; kafka.server.BrokerState">brokerState</a>.<a href="BrokerStates.scala.html#kafka.server;BrokerState.newState(ab9c491e36)" title="(newState: kafka.server.BrokerStates)Unit">newState</a><span class="delimiter">(</span><a href="BrokerStates.scala.html#kafka.server.BrokerShuttingDown" title="kafka.server.BrokerShuttingDown.type">BrokerShuttingDown</a><span class="delimiter">)</span>
        if<span class="delimiter">(</span><a href="#kafka.server;KafkaServer.socketServer_=" title="=&gt; kafka.network.SocketServer">socketServer</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
          <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Logging.scala.html#kafka.utils;Logging.swallow" title="(action: =&gt; Unit)Unit">swallow</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.socketServer_=" title="=&gt; kafka.network.SocketServer">socketServer</a>.<a href="../network/SocketServer.scala.html#kafka.network;SocketServer.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        if<span class="delimiter">(</span><a href="#kafka.server;KafkaServer.requestHandlerPool_=" title="=&gt; kafka.server.KafkaRequestHandlerPool">requestHandlerPool</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
          <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Logging.scala.html#kafka.utils;Logging.swallow" title="(action: =&gt; Unit)Unit">swallow</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.requestHandlerPool_=" title="=&gt; kafka.server.KafkaRequestHandlerPool">requestHandlerPool</a>.<a href="KafkaRequestHandler.scala.html#kafka.server;KafkaRequestHandlerPool.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        if<span class="delimiter">(</span><a href="#kafka.server;KafkaServer.offsetManager_=" title="=&gt; kafka.server.OffsetManager">offsetManager</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
          <a href="#kafka.server;KafkaServer.offsetManager_=" title="=&gt; kafka.server.OffsetManager">offsetManager</a>.<a href="OffsetManager.scala.html#kafka.server;OffsetManager.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Logging.scala.html#kafka.utils;Logging.swallow" title="(action: =&gt; Unit)Unit">swallow</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.kafkaScheduler" title="=&gt; kafka.utils.KafkaScheduler">kafkaScheduler</a>.<a href="../utils/KafkaScheduler.scala.html#kafka.utils;KafkaScheduler.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        if<span class="delimiter">(</span><a href="#kafka.server;KafkaServer.apis_=" title="=&gt; kafka.server.KafkaApis">apis</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
          <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Logging.scala.html#kafka.utils;Logging.swallow" title="(action: =&gt; Unit)Unit">swallow</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.apis_=" title="=&gt; kafka.server.KafkaApis">apis</a>.<a href="KafkaApis.scala.html#kafka.server;KafkaApis.close" title="()Unit">close</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        if<span class="delimiter">(</span><a href="#kafka.server;KafkaServer.replicaManager_=" title="=&gt; kafka.server.ReplicaManager">replicaManager</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
          <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Logging.scala.html#kafka.utils;Logging.swallow" title="(action: =&gt; Unit)Unit">swallow</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.replicaManager_=" title="=&gt; kafka.server.ReplicaManager">replicaManager</a>.<a href="ReplicaManager.scala.html#kafka.server;ReplicaManager.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        if<span class="delimiter">(</span><a href="#kafka.server;KafkaServer.logManager_=" title="=&gt; kafka.log.LogManager">logManager</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
          <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Logging.scala.html#kafka.utils;Logging.swallow" title="(action: =&gt; Unit)Unit">swallow</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.logManager_=" title="=&gt; kafka.log.LogManager">logManager</a>.<a href="../log/LogManager.scala.html#kafka.log;LogManager.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        if<span class="delimiter">(</span><a href="#kafka.server;KafkaServer.kafkaController_=" title="=&gt; kafka.controller.KafkaController">kafkaController</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
          <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Logging.scala.html#kafka.utils;Logging.swallow" title="(action: =&gt; Unit)Unit">swallow</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.kafkaController_=" title="=&gt; kafka.controller.KafkaController">kafkaController</a>.<a href="../controller/KafkaController.scala.html#kafka.controller;KafkaController.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        if<span class="delimiter">(</span><a href="#kafka.server;KafkaServer.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
          <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Logging.scala.html#kafka.utils;Logging.swallow" title="(action: =&gt; Unit)Unit">swallow</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <a href="#kafka.server;KafkaServer.brokerState" title="=&gt; kafka.server.BrokerState">brokerState</a>.<a href="BrokerStates.scala.html#kafka.server;BrokerState.newState(ab9c491e36)" title="(newState: kafka.server.BrokerStates)Unit">newState</a><span class="delimiter">(</span><a href="BrokerStates.scala.html#kafka.server.NotRunning" title="kafka.server.NotRunning.type">NotRunning</a><span class="delimiter">)</span>
        <a href="#kafka.server;KafkaServer.shutdownLatch_=" title="=&gt; java.util.concurrent.CountDownLatch">shutdownLatch</a>.<span title="()Unit">countDown</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#kafka.server;KafkaServer.startupComplete_=" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">startupComplete</a>.<span title="(x$1: Boolean)Unit">set</span><span class="delimiter">(</span>false<span class="delimiter">)</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;shut down completed&quot;)" class="string">&quot;shut down completed&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    catch <span class="delimiter">{</span>
      case <a title="Throwable" id="kafka.server;KafkaServer.shutdown.e">e</a>: <span title="Throwable">Throwable</span> =&gt;
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.fatal(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">fatal</a><span class="delimiter">(</span><span title="String(&quot;Fatal error during KafkaServer shutdown.&quot;)" class="string">&quot;Fatal error during KafkaServer shutdown.&quot;</span>, <a href="#kafka.server;KafkaServer.shutdown.e" title="Throwable">e</a><span class="delimiter">)</span>
        throw <a href="#kafka.server;KafkaServer.shutdown.e" title="Throwable">e</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * After calling shutdown(), use this API to wait until the shutdown is complete
   */</span>
  def <a title="()Unit" id="kafka.server;KafkaServer.awaitShutdown">awaitShutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#kafka.server;KafkaServer.shutdownLatch_=" title="=&gt; java.util.concurrent.CountDownLatch">shutdownLatch</a>.<span title="()Unit">await</span><span class="delimiter">(</span><span class="delimiter">)</span>

  def <a title="()kafka.log.LogManager" id="kafka.server;KafkaServer.getLogManager">getLogManager</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../log/LogManager.scala.html#kafka.log;LogManager" title="kafka.log.LogManager">LogManager</a> = <a href="#kafka.server;KafkaServer.logManager_=" title="=&gt; kafka.log.LogManager">logManager</a>
  
  private def <a title="(zkClient: org.I0Itec.zkclient.ZkClient, brokerState: kafka.server.BrokerState)kafka.log.LogManager" id="kafka.server;KafkaServer.createLogManager">createLogManager</a><span class="delimiter">(</span><a title="org.I0Itec.zkclient.ZkClient" id="kafka.server;KafkaServer.createLogManager.zkClient">zkClient</a>: <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span>, <a title="kafka.server.BrokerState" id="kafka.server;KafkaServer.createLogManager.brokerState">brokerState</a>: <a href="BrokerStates.scala.html#kafka.server;BrokerState" title="kafka.server.BrokerState">BrokerState</a><span class="delimiter">)</span>: <a href="../log/LogManager.scala.html#kafka.log;LogManager" title="kafka.log.LogManager">LogManager</a> = <span class="delimiter">{</span>
    val <a title="kafka.log.LogConfig" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig">defaultLogConfig</a> = <a href="../log/LogConfig.scala.html#kafka.log.LogConfig.apply$default$15" title="Boolean" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$18">LogConfig</a><span class="delimiter">(</span>segmentSize = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logSegmentBytes" title="Int" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$3">logSegmentBytes</a>,
                                     segmentMs = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logRollTimeMillis" title="Long" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$4">logRollTimeMillis</a>,
                                     segmentJitterMs = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logRollTimeJitterMillis" title="Long" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$5">logRollTimeJitterMillis</a>,
                                     flushInterval = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logFlushIntervalMessages" title="Long" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$6">logFlushIntervalMessages</a>,
                                     flushMs = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logFlushIntervalMs" title="=&gt; Long">logFlushIntervalMs</a>.<a title="Long" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$7">toLong</a>,
                                     retentionSize = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logRetentionBytes" title="Long" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$8">logRetentionBytes</a>,
                                     retentionMs = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logRetentionTimeMillis" title="Long" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$9">logRetentionTimeMillis</a>,
                                     maxMessageSize = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.messageMaxBytes" title="Int" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$10">messageMaxBytes</a>,
                                     maxIndexSize = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logIndexSizeMaxBytes" title="Int" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$11">logIndexSizeMaxBytes</a>,
                                     indexInterval = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logIndexIntervalBytes" title="Int" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$12">logIndexIntervalBytes</a>,
                                     deleteRetentionMs = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logCleanerDeleteRetentionMs" title="Long" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$13">logCleanerDeleteRetentionMs</a>,
                                     fileDeleteDelayMs = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logDeleteDelayMs" title="Long" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$14">logDeleteDelayMs</a>,
                                     minCleanableRatio = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logCleanerMinCleanRatio" title="Double" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$15">logCleanerMinCleanRatio</a>,
                                     compact = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logCleanupPolicy" title="=&gt; String">logCleanupPolicy</a>.<span title="()String">trim</span>.<span title="()String">toLowerCase</span> <a title="Boolean" id="kafka.server;KafkaServer.createLogManager.defaultLogConfig.x$16">==</a> <span title="String(&quot;compact&quot;)" class="string">&quot;compact&quot;</span><span class="delimiter">)</span>
    val <a title="java.util.Properties" id="kafka.server;KafkaServer.createLogManager.defaultProps">defaultProps</a> = <a href="#kafka.server;KafkaServer.createLogManager.defaultLogConfig" title="kafka.log.LogConfig">defaultLogConfig</a>.<a href="../log/LogConfig.scala.html#kafka.log;LogConfig.toProps" title="=&gt; java.util.Properties">toProps</a>
    val <a title="scala.collection.Map[String,kafka.log.LogConfig]" id="kafka.server;KafkaServer.createLogManager.configs">configs</a> = <a href="../admin/AdminUtils.scala.html#kafka.admin.AdminUtils" title="kafka.admin.AdminUtils.type">AdminUtils</a>.<a href="../admin/AdminUtils.scala.html#kafka.admin.AdminUtils.fetchAllTopicConfigs" title="(zkClient: org.I0Itec.zkclient.ZkClient)scala.collection.Map[String,java.util.Properties]">fetchAllTopicConfigs</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.createLogManager.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a><span class="delimiter">)</span>.<span title="(f: java.util.Properties =&gt; kafka.log.LogConfig)scala.collection.Map[String,kafka.log.LogConfig]">mapValues</span><span class="delimiter">(</span><a href="../log/LogConfig.scala.html#kafka.log.LogConfig" title="kafka.log.LogConfig.type">LogConfig</a>.<a href="../log/LogConfig.scala.html#kafka.log.LogConfig.fromProps(9d0df464c6)" title="(defaults: java.util.Properties, overrides: java.util.Properties)kafka.log.LogConfig">fromProps</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.createLogManager.defaultProps" title="java.util.Properties">defaultProps</a>, <a href="#kafka.server;KafkaServer.createLogManager.configs.$anonfun.x$1" title="java.util.Properties">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="comment">// read the log configurations from zookeeper</span>
    val <a title="kafka.log.CleanerConfig" id="kafka.server;KafkaServer.createLogManager.cleanerConfig">cleanerConfig</a> = <a href="../log/CleanerConfig.scala.html#kafka.log;CleanerConfig" title="(numThreads: Int, dedupeBufferSize: Long, dedupeBufferLoadFactor: Double, ioBufferSize: Int, maxMessageSize: Int, maxIoBytesPerSecond: Double, backOffMs: Long, enableCleaner: Boolean, hashAlgorithm: String)kafka.log.CleanerConfig">CleanerConfig</a><span class="delimiter">(</span>numThreads = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logCleanerThreads" title="=&gt; Int">logCleanerThreads</a>,
                                      dedupeBufferSize = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logCleanerDedupeBufferSize" title="=&gt; Long">logCleanerDedupeBufferSize</a>,
                                      dedupeBufferLoadFactor = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logCleanerDedupeBufferLoadFactor" title="=&gt; Double">logCleanerDedupeBufferLoadFactor</a>,
                                      ioBufferSize = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logCleanerIoBufferSize" title="=&gt; Int">logCleanerIoBufferSize</a>,
                                      maxMessageSize = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.messageMaxBytes" title="=&gt; Int">messageMaxBytes</a>,
                                      maxIoBytesPerSecond = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logCleanerIoMaxBytesPerSecond" title="=&gt; Double">logCleanerIoMaxBytesPerSecond</a>,
                                      backOffMs = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logCleanerBackoffMs" title="=&gt; Long">logCleanerBackoffMs</a>,
                                      enableCleaner = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logCleanerEnable" title="=&gt; Boolean">logCleanerEnable</a><span class="delimiter">)</span>
    new <a href="../log/LogManager.scala.html#kafka.log;LogManager" title="kafka.log.LogManager">LogManager</a><span class="delimiter">(</span>logDirs = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logDirs" title="=&gt; Seq[String]">logDirs</a>.<span title="(f: String =&gt; java.io.File)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],java.io.File,Seq[java.io.File]])Seq[java.io.File]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.io.File,Seq[java.io.File]]" class="delimiter">(</span>new <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.createLogManager.$anonfun.x$2" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit evidence$1: scala.reflect.ClassTag[java.io.File])Array[java.io.File]">toArray</span>,
                   topicConfigs = <a href="#kafka.server;KafkaServer.createLogManager.configs" title="scala.collection.Map[String,kafka.log.LogConfig]">configs</a>,
                   defaultConfig = <a href="#kafka.server;KafkaServer.createLogManager.defaultLogConfig" title="kafka.log.LogConfig">defaultLogConfig</a>,
                   cleanerConfig = <a href="#kafka.server;KafkaServer.createLogManager.cleanerConfig" title="kafka.log.CleanerConfig">cleanerConfig</a>,
                   ioThreads = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.numRecoveryThreadsPerDataDir" title="=&gt; Int">numRecoveryThreadsPerDataDir</a>,
                   flushCheckMs = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logFlushSchedulerIntervalMs" title="=&gt; Long">logFlushSchedulerIntervalMs</a>,
                   flushCheckpointMs = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logFlushOffsetCheckpointIntervalMs" title="=&gt; Long">logFlushOffsetCheckpointIntervalMs</a>,
                   retentionCheckMs = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.logCleanupIntervalMs" title="=&gt; Long">logCleanupIntervalMs</a>,
                   scheduler = <a href="#kafka.server;KafkaServer.kafkaScheduler" title="=&gt; kafka.utils.KafkaScheduler">kafkaScheduler</a>,
                   brokerState = <a href="#kafka.server;KafkaServer.createLogManager.brokerState" title="kafka.server.BrokerState">brokerState</a>,
                   time = <a href="#kafka.server.KafkaServer.<init>$default$2" title="kafka.utils.Time">time</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private def <a title="()kafka.server.OffsetManager" id="kafka.server;KafkaServer.createOffsetManager">createOffsetManager</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="OffsetManager.scala.html#kafka.server;OffsetManager" title="kafka.server.OffsetManager">OffsetManager</a> = <span class="delimiter">{</span>
    val <a title="kafka.server.OffsetManagerConfig" id="kafka.server;KafkaServer.createOffsetManager.offsetManagerConfig">offsetManagerConfig</a> = <a href="OffsetManager.scala.html#kafka.server.OffsetManagerConfig.apply$default$4" title="Long" id="kafka.server;KafkaServer.createOffsetManager.offsetManagerConfig.x$28">OffsetManagerConfig</a><span class="delimiter">(</span>
      maxMetadataSize = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.offsetMetadataMaxSize" title="Int" id="kafka.server;KafkaServer.createOffsetManager.offsetManagerConfig.x$19">offsetMetadataMaxSize</a>,
      loadBufferSize = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.offsetsLoadBufferSize" title="Int" id="kafka.server;KafkaServer.createOffsetManager.offsetManagerConfig.x$20">offsetsLoadBufferSize</a>,
      offsetsRetentionMs = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.offsetsRetentionMinutes" title="=&gt; Int">offsetsRetentionMinutes</a> <span title="(x: Int)Int">*</span> <span title="Int(60)" class="int">60</span> <a title="Long" id="kafka.server;KafkaServer.createOffsetManager.offsetManagerConfig.x$21">*</a> <span title="Long(1000L)" class="long">1000L</span>,
      offsetsTopicNumPartitions = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.offsetsTopicPartitions" title="Int" id="kafka.server;KafkaServer.createOffsetManager.offsetManagerConfig.x$22">offsetsTopicPartitions</a>,
      offsetsTopicReplicationFactor = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.offsetsTopicReplicationFactor" title="Short" id="kafka.server;KafkaServer.createOffsetManager.offsetManagerConfig.x$23">offsetsTopicReplicationFactor</a>,
      offsetCommitTimeoutMs = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.offsetCommitTimeoutMs" title="Int" id="kafka.server;KafkaServer.createOffsetManager.offsetManagerConfig.x$24">offsetCommitTimeoutMs</a>,
      offsetCommitRequiredAcks = <a href="#kafka.server;KafkaServer.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="KafkaConfig.scala.html#kafka.server;KafkaConfig.offsetCommitRequiredAcks" title="Short" id="kafka.server;KafkaServer.createOffsetManager.offsetManagerConfig.x$25">offsetCommitRequiredAcks</a><span class="delimiter">)</span>
    new <a href="OffsetManager.scala.html#kafka.server;OffsetManager" title="kafka.server.OffsetManager">OffsetManager</a><span class="delimiter">(</span><a href="#kafka.server;KafkaServer.createOffsetManager.offsetManagerConfig" title="kafka.server.OffsetManagerConfig">offsetManagerConfig</a>, <a href="#kafka.server;KafkaServer.replicaManager_=" title="=&gt; kafka.server.ReplicaManager">replicaManager</a>, <a href="#kafka.server;KafkaServer.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.server;KafkaServer.kafkaScheduler" title="=&gt; kafka.utils.KafkaScheduler">kafkaScheduler</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>


        </pre>
    </body>
</html>
