<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>kafka/kafka/controller/ControllerChannelManager.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
*/</span>
package kafka.controller

import kafka.network.<span class="delimiter">{</span>Receive, BlockingChannel<span class="delimiter">}</span>
import kafka.utils.<span class="delimiter">{</span>Utils, Logging, ShutdownableThread<span class="delimiter">}</span>
import collection.mutable.HashMap
import kafka.cluster.Broker
import java.util.concurrent.<span class="delimiter">{</span>LinkedBlockingQueue, BlockingQueue<span class="delimiter">}</span>
import kafka.server.KafkaConfig
import collection.mutable
import kafka.api._
import org.apache.log4j.Logger
import scala.Some
import kafka.common.TopicAndPartition
import kafka.api.RequestOrResponse
import collection.Set

class <a title="class ControllerChannelManager extends AnyRef with kafka.utils.Logging" id="kafka.controller;ControllerChannelManager">ControllerChannelManager</a> <a href="#kafka.controller;ControllerChannelManager" title="kafka.controller.ControllerChannelManager" class="delimiter">(</a>private val <a title="kafka.controller.ControllerContext" id="kafka.controller;ControllerChannelManager.controllerContext">controllerContext</a>: <a href="KafkaController.scala.html#kafka.controller;ControllerContext" title="kafka.controller.ControllerContext">ControllerContext</a>, <a title="kafka.server.KafkaConfig" id="kafka.controller;ControllerChannelManager.config">config</a>: <a href="../server/KafkaConfig.scala.html#kafka.server;KafkaConfig" title="kafka.server.KafkaConfig">KafkaConfig</a><span class="delimiter">)</span> extends <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> <span class="delimiter">{</span>
  private val <a title="scala.collection.mutable.HashMap[Int,kafka.controller.ControllerBrokerStateInfo]" id="kafka.controller;ControllerChannelManager.brokerStateInfo">brokerStateInfo</a> = new <span title="scala.collection.mutable.HashMap[Int,kafka.controller.ControllerBrokerStateInfo]">HashMap</span><span class="delimiter">[</span>Int, ControllerBrokerStateInfo<span class="delimiter">]</span>
  private val <a title="Object" id="kafka.controller;ControllerChannelManager.brokerLock">brokerLock</a> = new <span title="Object">Object</span>
  this.<a href="../utils/Logging.scala.html#kafka.utils;Logging.logIdent_=" title="(x$1: String)Unit">logIdent</a> = <span title="String(&quot;[Channel manager on controller &quot;)" class="string">&quot;[Channel manager on controller &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.controller;ControllerChannelManager.config" title="kafka.server.KafkaConfig">config</a>.<a href="../server/KafkaConfig.scala.html#kafka.server;KafkaConfig.brokerId" title="=&gt; Int">brokerId</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;]: &quot;)" class="string">&quot;]: &quot;</span>

  <a href="#kafka.controller;ControllerChannelManager.controllerContext" title="=&gt; kafka.controller.ControllerContext">controllerContext</a>.<a href="KafkaController.scala.html#kafka.controller;ControllerContext.liveBrokers" title="=&gt; scala.collection.Set[kafka.cluster.Broker]">liveBrokers</a>.<span title="(f: kafka.cluster.Broker =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.addNewBroker" title="(broker: kafka.cluster.Broker)Unit">addNewBroker</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.<local ControllerChannelManager>.$anonfun.x$1" title="kafka.cluster.Broker">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

  def <a title="()Unit" id="kafka.controller;ControllerChannelManager.startup">startup</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#kafka.controller;ControllerChannelManager.brokerLock" title="=&gt; Object">brokerLock</a> <span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
      <a href="#kafka.controller;ControllerChannelManager.brokerStateInfo" title="=&gt; scala.collection.mutable.HashMap[Int,kafka.controller.ControllerBrokerStateInfo]">brokerStateInfo</a>.<span title="(f: ((Int, kafka.controller.ControllerBrokerStateInfo)) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="(Int, kafka.controller.ControllerBrokerStateInfo)" id="kafka.controller;ControllerChannelManager.startup.$anonfun.brokerState">brokerState</a> =&gt; <a href="#kafka.controller;ControllerChannelManager.startRequestSendThread" title="(brokerId: Int)Unit">startRequestSendThread</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.startup.$anonfun.brokerState" title="(Int, kafka.controller.ControllerBrokerStateInfo)">brokerState</a>.<span title="=&gt; Int">_1</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="()Unit" id="kafka.controller;ControllerChannelManager.shutdown">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#kafka.controller;ControllerChannelManager.brokerLock" title="=&gt; Object">brokerLock</a> <span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
      <a href="#kafka.controller;ControllerChannelManager.brokerStateInfo" title="=&gt; scala.collection.mutable.HashMap[Int,kafka.controller.ControllerBrokerStateInfo]">brokerStateInfo</a>.<span title="(f: ((Int, kafka.controller.ControllerBrokerStateInfo)) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="(Int, kafka.controller.ControllerBrokerStateInfo)" id="kafka.controller;ControllerChannelManager.shutdown.$anonfun.brokerState">brokerState</a> =&gt; <a href="#kafka.controller;ControllerChannelManager.removeExistingBroker" title="(brokerId: Int)Unit">removeExistingBroker</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.shutdown.$anonfun.brokerState" title="(Int, kafka.controller.ControllerBrokerStateInfo)">brokerState</a>.<span title="=&gt; Int">_1</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(brokerId: Int, request: kafka.api.RequestOrResponse, callback: kafka.api.RequestOrResponse =&gt; Unit)Unit" id="kafka.controller;ControllerChannelManager.sendRequest">sendRequest</a><span class="delimiter">(</span><a title="Int" id="kafka.controller;ControllerChannelManager.sendRequest.brokerId">brokerId</a> : <span title="Int">Int</span>, <a title="kafka.api.RequestOrResponse" id="kafka.controller;ControllerChannelManager.sendRequest.request">request</a> : <a href="../api/RequestOrResponse.scala.html#kafka.api;RequestOrResponse" title="kafka.api.RequestOrResponse">RequestOrResponse</a>, <a title="kafka.api.RequestOrResponse =&gt; Unit" id="kafka.controller;ControllerChannelManager.sendRequest$default$3">callback</a>: <span class="delimiter">(</span>RequestOrResponse<span class="delimiter">)</span> =&gt; Unit = null<span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.controller;ControllerChannelManager.brokerLock" title="=&gt; Object">brokerLock</a> <span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
      val <a title="Option[kafka.controller.ControllerBrokerStateInfo]" id="kafka.controller;ControllerChannelManager.sendRequest.stateInfoOpt">stateInfoOpt</a> = <a href="#kafka.controller;ControllerChannelManager.brokerStateInfo" title="=&gt; scala.collection.mutable.HashMap[Int,kafka.controller.ControllerBrokerStateInfo]">brokerStateInfo</a>.<span title="(key: Int)Option[kafka.controller.ControllerBrokerStateInfo]">get</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.sendRequest.brokerId" title="Int">brokerId</a><span class="delimiter">)</span>
      <a href="#kafka.controller;ControllerChannelManager.sendRequest.stateInfoOpt" title="Option[kafka.controller.ControllerBrokerStateInfo]">stateInfoOpt</a> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><a title="kafka.controller.ControllerBrokerStateInfo" id="kafka.controller;ControllerChannelManager.sendRequest.stateInfo">stateInfo</a><span class="delimiter">)</span> =&gt;
          <a href="#kafka.controller;ControllerChannelManager.sendRequest.stateInfo" title="kafka.controller.ControllerBrokerStateInfo">stateInfo</a>.<a href="#kafka.controller;ControllerBrokerStateInfo.messageQueue" title="=&gt; java.util.concurrent.BlockingQueue[(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)]">messageQueue</a>.<span title="(x$1: (kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit))Unit">put</span><span class="delimiter">(</span><span title="(_1: kafka.api.RequestOrResponse, _2: kafka.api.RequestOrResponse =&gt; Unit)(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)" class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.sendRequest.request" title="kafka.api.RequestOrResponse">request</a>, <a href="#kafka.controller;ControllerChannelManager.sendRequest$default$3" title="kafka.api.RequestOrResponse =&gt; Unit">callback</a><span class="delimiter">)</span><span class="delimiter">)</span>
        case <span title="None.type">None</span> =&gt;
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.warn(1729dbc42f)" title="(msg: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Not sending request %s to broker %d, since it is offline.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.sendRequest.request" title="kafka.api.RequestOrResponse">request</a>, <a href="#kafka.controller;ControllerChannelManager.sendRequest.brokerId" title="Int">brokerId</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(broker: kafka.cluster.Broker)Unit" id="kafka.controller;ControllerChannelManager.addBroker">addBroker</a><span class="delimiter">(</span><a title="kafka.cluster.Broker" id="kafka.controller;ControllerChannelManager.addBroker.broker">broker</a>: <a href="../cluster/Broker.scala.html#kafka.cluster;Broker" title="kafka.cluster.Broker">Broker</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="comment">// be careful here. Maybe the startup() API has already started the request send thread</span>
    <a href="#kafka.controller;ControllerChannelManager.brokerLock" title="=&gt; Object">brokerLock</a> <span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
      if<span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.controller;ControllerChannelManager.brokerStateInfo" title="=&gt; scala.collection.mutable.HashMap[Int,kafka.controller.ControllerBrokerStateInfo]">brokerStateInfo</a>.<span title="(key: Int)Boolean">contains</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.addBroker.broker" title="kafka.cluster.Broker">broker</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.id" title="=&gt; Int">id</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#kafka.controller;ControllerChannelManager.addNewBroker" title="(broker: kafka.cluster.Broker)Unit">addNewBroker</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.addBroker.broker" title="kafka.cluster.Broker">broker</a><span class="delimiter">)</span>
        <a href="#kafka.controller;ControllerChannelManager.startRequestSendThread" title="(brokerId: Int)Unit">startRequestSendThread</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.addBroker.broker" title="kafka.cluster.Broker">broker</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.id" title="=&gt; Int">id</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(brokerId: Int)Unit" id="kafka.controller;ControllerChannelManager.removeBroker">removeBroker</a><span class="delimiter">(</span><a title="Int" id="kafka.controller;ControllerChannelManager.removeBroker.brokerId">brokerId</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.controller;ControllerChannelManager.brokerLock" title="=&gt; Object">brokerLock</a> <span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
      <a href="#kafka.controller;ControllerChannelManager.removeExistingBroker" title="(brokerId: Int)Unit">removeExistingBroker</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.removeBroker.brokerId" title="Int">brokerId</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(broker: kafka.cluster.Broker)Unit" id="kafka.controller;ControllerChannelManager.addNewBroker">addNewBroker</a><span class="delimiter">(</span><a title="kafka.cluster.Broker" id="kafka.controller;ControllerChannelManager.addNewBroker.broker">broker</a>: <a href="../cluster/Broker.scala.html#kafka.cluster;Broker" title="kafka.cluster.Broker">Broker</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    val <a title="java.util.concurrent.LinkedBlockingQueue[(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)]" id="kafka.controller;ControllerChannelManager.addNewBroker.messageQueue">messageQueue</a> = new <span title="java.util.concurrent.LinkedBlockingQueue[(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)]">LinkedBlockingQueue</span><span class="delimiter">[</span><span class="delimiter">(</span>RequestOrResponse, <span class="delimiter">(</span>RequestOrResponse<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.config" title="kafka.server.KafkaConfig">config</a>.<a href="../server/KafkaConfig.scala.html#kafka.server;KafkaConfig.controllerMessageQueueSize" title="=&gt; Int">controllerMessageQueueSize</a><span class="delimiter">)</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Controller %d trying to connect to broker %d&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.config" title="kafka.server.KafkaConfig">config</a>.<a href="../server/KafkaConfig.scala.html#kafka.server;KafkaConfig.brokerId" title="=&gt; Int">brokerId</a>,<a href="#kafka.controller;ControllerChannelManager.addNewBroker.broker" title="kafka.cluster.Broker">broker</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.id" title="=&gt; Int">id</a><span class="delimiter">)</span><span class="delimiter">)</span>
    val <a title="kafka.network.BlockingChannel" id="kafka.controller;ControllerChannelManager.addNewBroker.channel">channel</a> = new <a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel" title="kafka.network.BlockingChannel">BlockingChannel</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.addNewBroker.broker" title="kafka.cluster.Broker">broker</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.host" title="=&gt; String">host</a>, <a href="#kafka.controller;ControllerChannelManager.addNewBroker.broker" title="kafka.cluster.Broker">broker</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.port" title="=&gt; Int">port</a>,
      <a href="../network/BlockingChannel.scala.html#kafka.network.BlockingChannel" title="kafka.network.BlockingChannel.type">BlockingChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network.BlockingChannel.UseDefaultBufferSize" title="=&gt; Int">UseDefaultBufferSize</a>,
      <a href="../network/BlockingChannel.scala.html#kafka.network.BlockingChannel" title="kafka.network.BlockingChannel.type">BlockingChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network.BlockingChannel.UseDefaultBufferSize" title="=&gt; Int">UseDefaultBufferSize</a>,
      <a href="#kafka.controller;ControllerChannelManager.config" title="kafka.server.KafkaConfig">config</a>.<a href="../server/KafkaConfig.scala.html#kafka.server;KafkaConfig.controllerSocketTimeoutMs" title="=&gt; Int">controllerSocketTimeoutMs</a><span class="delimiter">)</span>
    val <a title="kafka.controller.RequestSendThread" id="kafka.controller;ControllerChannelManager.addNewBroker.requestThread">requestThread</a> = new <a href="#kafka.controller;RequestSendThread" title="kafka.controller.RequestSendThread">RequestSendThread</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.config" title="kafka.server.KafkaConfig">config</a>.<a href="../server/KafkaConfig.scala.html#kafka.server;KafkaConfig.brokerId" title="=&gt; Int">brokerId</a>, <a href="#kafka.controller;ControllerChannelManager.controllerContext" title="=&gt; kafka.controller.ControllerContext">controllerContext</a>, <a href="#kafka.controller;ControllerChannelManager.addNewBroker.broker" title="kafka.cluster.Broker">broker</a>, <a href="#kafka.controller;ControllerChannelManager.addNewBroker.messageQueue" title="java.util.concurrent.LinkedBlockingQueue[(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)]">messageQueue</a>, <a href="#kafka.controller;ControllerChannelManager.addNewBroker.channel" title="kafka.network.BlockingChannel">channel</a><span class="delimiter">)</span>
    <a href="#kafka.controller;ControllerChannelManager.addNewBroker.requestThread" title="kafka.controller.RequestSendThread">requestThread</a>.<span title="(x$1: Boolean)Unit">setDaemon</span><span class="delimiter">(</span>false<span class="delimiter">)</span>
    <a href="#kafka.controller;ControllerChannelManager.brokerStateInfo" title="=&gt; scala.collection.mutable.HashMap[Int,kafka.controller.ControllerBrokerStateInfo]">brokerStateInfo</a>.<span title="(key: Int, value: kafka.controller.ControllerBrokerStateInfo)Option[kafka.controller.ControllerBrokerStateInfo]">put</span><span title="Unit" class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.addNewBroker.broker" title="kafka.cluster.Broker">broker</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.id" title="=&gt; Int">id</a>, new <a href="#kafka.controller.ControllerBrokerStateInfo.readResolve" title="kafka.controller.ControllerBrokerStateInfo">ControllerBrokerStateInfo</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.addNewBroker.channel" title="kafka.network.BlockingChannel">channel</a>, <a href="#kafka.controller;ControllerChannelManager.addNewBroker.broker" title="kafka.cluster.Broker">broker</a>, <a href="#kafka.controller;ControllerChannelManager.addNewBroker.messageQueue" title="java.util.concurrent.LinkedBlockingQueue[(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)]">messageQueue</a>, <a href="#kafka.controller;ControllerChannelManager.addNewBroker.requestThread" title="kafka.controller.RequestSendThread">requestThread</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private def <a title="(brokerId: Int)Unit" id="kafka.controller;ControllerChannelManager.removeExistingBroker">removeExistingBroker</a><span class="delimiter">(</span><a title="Int" id="kafka.controller;ControllerChannelManager.removeExistingBroker.brokerId">brokerId</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    try <span class="delimiter">{</span>
      <a href="#kafka.controller;ControllerChannelManager.brokerStateInfo" title="(key: Int)kafka.controller.ControllerBrokerStateInfo">brokerStateInfo</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.removeExistingBroker.brokerId" title="Int">brokerId</a><span class="delimiter">)</span>.<a href="#kafka.controller;ControllerBrokerStateInfo.channel" title="=&gt; kafka.network.BlockingChannel">channel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.disconnect" title="()Unit">disconnect</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#kafka.controller;ControllerChannelManager.brokerStateInfo" title="(key: Int)kafka.controller.ControllerBrokerStateInfo">brokerStateInfo</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.removeExistingBroker.brokerId" title="Int">brokerId</a><span class="delimiter">)</span>.<a href="#kafka.controller;ControllerBrokerStateInfo.messageQueue" title="=&gt; java.util.concurrent.BlockingQueue[(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)]">messageQueue</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#kafka.controller;ControllerChannelManager.brokerStateInfo" title="(key: Int)kafka.controller.ControllerBrokerStateInfo">brokerStateInfo</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.removeExistingBroker.brokerId" title="Int">brokerId</a><span class="delimiter">)</span>.<a href="#kafka.controller;ControllerBrokerStateInfo.requestSendThread" title="=&gt; kafka.controller.RequestSendThread">requestSendThread</a>.<a href="../utils/ShutdownableThread.scala.html#kafka.utils;ShutdownableThread.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#kafka.controller;ControllerChannelManager.brokerStateInfo" title="=&gt; scala.collection.mutable.HashMap[Int,kafka.controller.ControllerBrokerStateInfo]">brokerStateInfo</a>.<span title="(key: Int)Option[kafka.controller.ControllerBrokerStateInfo]">remove</span><span title="Unit" class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.removeExistingBroker.brokerId" title="Int">brokerId</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>catch <span class="delimiter">{</span>
      case <a title="Throwable" id="kafka.controller;ControllerChannelManager.removeExistingBroker.e">e</a>: <span title="Throwable">Throwable</span> =&gt; <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;Error while removing broker by the controller&quot;)" class="string">&quot;Error while removing broker by the controller&quot;</span>, <a href="#kafka.controller;ControllerChannelManager.removeExistingBroker.e" title="Throwable">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(brokerId: Int)Unit" id="kafka.controller;ControllerChannelManager.startRequestSendThread">startRequestSendThread</a><span class="delimiter">(</span><a title="Int" id="kafka.controller;ControllerChannelManager.startRequestSendThread.brokerId">brokerId</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    val <a title="kafka.controller.RequestSendThread" id="kafka.controller;ControllerChannelManager.startRequestSendThread.requestThread">requestThread</a> = <a href="#kafka.controller;ControllerChannelManager.brokerStateInfo" title="(key: Int)kafka.controller.ControllerBrokerStateInfo">brokerStateInfo</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.startRequestSendThread.brokerId" title="Int">brokerId</a><span class="delimiter">)</span>.<a href="#kafka.controller;ControllerBrokerStateInfo.requestSendThread" title="=&gt; kafka.controller.RequestSendThread">requestSendThread</a>
    if<span class="delimiter">(</span><a href="#kafka.controller;ControllerChannelManager.startRequestSendThread.requestThread" title="kafka.controller.RequestSendThread">requestThread</a>.<span title="()java.lang.Thread.State">getState</span> <span title="(x$1: Any)Boolean">==</span> Thread.State.<span title="java.lang.Thread.State(NEW)">NEW</span><span class="delimiter">)</span>
      <a href="#kafka.controller;ControllerChannelManager.startRequestSendThread.requestThread" title="kafka.controller.RequestSendThread">requestThread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

class <a title="class RequestSendThread extends kafka.utils.ShutdownableThread" id="kafka.controller;RequestSendThread">RequestSendThread</a><a href="#kafka.controller;RequestSendThread" title="kafka.controller.RequestSendThread" class="delimiter">(</a>val <a title="Int" id="kafka.controller;RequestSendThread.controllerId">controllerId</a>: <span title="Int">Int</span>,
                        val <a title="kafka.controller.ControllerContext" id="kafka.controller;RequestSendThread.controllerContext">controllerContext</a>: <a href="KafkaController.scala.html#kafka.controller;ControllerContext" title="kafka.controller.ControllerContext">ControllerContext</a>,
                        val <a title="kafka.cluster.Broker" id="kafka.controller;RequestSendThread.toBroker">toBroker</a>: <a href="../cluster/Broker.scala.html#kafka.cluster;Broker" title="kafka.cluster.Broker">Broker</a>,
                        val <a title="java.util.concurrent.BlockingQueue[(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)]" id="kafka.controller;RequestSendThread.queue">queue</a>: <span title="java.util.concurrent.BlockingQueue[(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)]">BlockingQueue</span><span class="delimiter">[</span><span class="delimiter">(</span>RequestOrResponse, <span class="delimiter">(</span>RequestOrResponse<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span><span class="delimiter">]</span>,
                        val <a title="kafka.network.BlockingChannel" id="kafka.controller;RequestSendThread.channel">channel</a>: <a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel" title="kafka.network.BlockingChannel">BlockingChannel</a><span class="delimiter">)</span>
  extends <a href="../utils/ShutdownableThread.scala.html#kafka.utils;ShutdownableThread" title="kafka.utils.ShutdownableThread">ShutdownableThread</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Controller-%d-to-broker-%d-send-thread&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.controller;RequestSendThread.controllerId" title="Int">controllerId</a>, <a href="#kafka.controller;RequestSendThread.toBroker" title="kafka.cluster.Broker">toBroker</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.id" title="=&gt; Int">id</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  private val <a title="Object" id="kafka.controller;RequestSendThread.lock">lock</a> = new <span title="Object">Object</span><span class="delimiter">(</span><span class="delimiter">)</span>
  private val <a title="kafka.controller.KafkaController.StateChangeLogger" id="kafka.controller;RequestSendThread.stateChangeLogger">stateChangeLogger</a> = <a href="KafkaController.scala.html#kafka.controller.KafkaController" title="kafka.controller.KafkaController.type">KafkaController</a>.<a href="KafkaController.scala.html#kafka.controller.KafkaController.stateChangeLogger" title="=&gt; kafka.controller.KafkaController.StateChangeLogger">stateChangeLogger</a>
  <a href="#kafka.controller;RequestSendThread.connectToBroker" title="(broker: kafka.cluster.Broker, channel: kafka.network.BlockingChannel)Unit">connectToBroker</a><span class="delimiter">(</span><a href="#kafka.controller;RequestSendThread.toBroker" title="=&gt; kafka.cluster.Broker">toBroker</a>, <a href="#kafka.controller;RequestSendThread.channel" title="=&gt; kafka.network.BlockingChannel">channel</a><span class="delimiter">)</span>

  override def <a title="()Unit" id="kafka.controller;RequestSendThread.doWork">doWork</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val <a title="(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)" id="kafka.controller;RequestSendThread.doWork.queueItem">queueItem</a> = <a href="#kafka.controller;RequestSendThread.queue" title="=&gt; java.util.concurrent.BlockingQueue[(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)]">queue</a>.<span title="()(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)">take</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="kafka.api.RequestOrResponse" id="kafka.controller;RequestSendThread.doWork.request">request</a> = <a href="#kafka.controller;RequestSendThread.doWork.queueItem" title="(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)">queueItem</a>.<span title="=&gt; kafka.api.RequestOrResponse">_1</span>
    val <a title="kafka.api.RequestOrResponse =&gt; Unit" id="kafka.controller;RequestSendThread.doWork.callback">callback</a> = <a href="#kafka.controller;RequestSendThread.doWork.queueItem" title="(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)">queueItem</a>.<span title="=&gt; kafka.api.RequestOrResponse =&gt; Unit">_2</span>
    var <a title="kafka.network.Receive" id="kafka.controller;RequestSendThread.doWork.receive">receive</a>: <a href="../network/Transmission.scala.html#kafka.network;Receive" title="kafka.network.Receive">Receive</a> = null
    try <span class="delimiter">{</span>
      <a href="#kafka.controller;RequestSendThread.lock" title="=&gt; Object">lock</a> <span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
        var <a title="Boolean" id="kafka.controller;RequestSendThread.doWork.isSendSuccessful">isSendSuccessful</a> = false
        while<span class="delimiter">(</span><a href="../utils/ShutdownableThread.scala.html#kafka.utils;ShutdownableThread.isRunning" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">isRunning</a>.<span title="()Boolean">get</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#kafka.controller;RequestSendThread.doWork.isSendSuccessful" title="Boolean">isSendSuccessful</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="comment">// if a broker goes down for a long time, then at some point the controller's zookeeper listener will trigger a</span>
          <span class="comment">// removeBroker which will invoke shutdown() on this thread. At that point, we will stop retrying.</span>
          try <span class="delimiter">{</span>
            <a href="#kafka.controller;RequestSendThread.channel" title="=&gt; kafka.network.BlockingChannel">channel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.send" title="(request: kafka.api.RequestOrResponse)Int">send</a><span class="delimiter">(</span><a href="#kafka.controller;RequestSendThread.doWork.request" title="kafka.api.RequestOrResponse">request</a><span class="delimiter">)</span>
            <a href="#kafka.controller;RequestSendThread.doWork.receive" title="kafka.network.Receive">receive</a> = <a href="#kafka.controller;RequestSendThread.channel" title="=&gt; kafka.network.BlockingChannel">channel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.receive" title="()kafka.network.Receive">receive</a><span class="delimiter">(</span><span class="delimiter">)</span>
            <a href="#kafka.controller;RequestSendThread.doWork.isSendSuccessful" title="Boolean">isSendSuccessful</a> = true
          <span class="delimiter">}</span> catch <span class="delimiter">{</span>
            case <span title="Throwable">e</span>: <span title="Throwable">Throwable</span> =&gt; <span class="comment">// if the send was not successful, reconnect to broker and resend the message</span>
              <a href="../utils/Logging.scala.html#kafka.utils;Logging.warn(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">warn</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="string">&quot;Controller %d epoch %d fails to send request %s to broker %s. &quot;</span> <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">+</span>
                <span class="string">&quot;Reconnecting to broker.&quot;</span><span class="delimiter">)</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.controller;RequestSendThread.controllerId" title="=&gt; Int">controllerId</a>, <a href="#kafka.controller;RequestSendThread.controllerContext" title="=&gt; kafka.controller.ControllerContext">controllerContext</a>.<a href="KafkaController.scala.html#kafka.controller;ControllerContext.epoch" title="=&gt; Int">epoch</a>,
                <a href="#kafka.controller;RequestSendThread.doWork.request" title="kafka.api.RequestOrResponse">request</a>.<span title="()String">toString</span>, <a href="#kafka.controller;RequestSendThread.toBroker" title="=&gt; kafka.cluster.Broker">toBroker</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.toString" title="()String">toString</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="Throwable">e</span><span class="delimiter">)</span>
              <a href="#kafka.controller;RequestSendThread.channel" title="=&gt; kafka.network.BlockingChannel">channel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.disconnect" title="()Unit">disconnect</a><span class="delimiter">(</span><span class="delimiter">)</span>
              <a href="#kafka.controller;RequestSendThread.connectToBroker" title="(broker: kafka.cluster.Broker, channel: kafka.network.BlockingChannel)Unit">connectToBroker</a><span class="delimiter">(</span><a href="#kafka.controller;RequestSendThread.toBroker" title="=&gt; kafka.cluster.Broker">toBroker</a>, <a href="#kafka.controller;RequestSendThread.channel" title="=&gt; kafka.network.BlockingChannel">channel</a><span class="delimiter">)</span>
              <a href="#kafka.controller;RequestSendThread.doWork.isSendSuccessful" title="Boolean">isSendSuccessful</a> = false
              <span class="comment">// backoff before retrying the connection and send</span>
              <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Logging.scala.html#kafka.utils;Logging.swallow" title="(action: =&gt; Unit)Unit">swallow</a><span class="delimiter">(</span><span title="Thread.type">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(300L)" class="int">300</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        var <a title="kafka.api.RequestOrResponse" id="kafka.controller;RequestSendThread.doWork.response">response</a>: <a href="../api/RequestOrResponse.scala.html#kafka.api;RequestOrResponse" title="kafka.api.RequestOrResponse">RequestOrResponse</a> = null
        <a href="#kafka.controller;RequestSendThread.doWork.request" title="kafka.api.RequestOrResponse">request</a>.<a href="../api/RequestOrResponse.scala.html#kafka.api;RequestOrResponse.requestId" title="=&gt; Option[Short]">requestId</a>.<span title="=&gt; Short">get</span> match <span class="delimiter">{</span>
          case <a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys" title="kafka.api.RequestKeys.type">RequestKeys</a>.<a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys.LeaderAndIsrKey" title="=&gt; Short">LeaderAndIsrKey</a> =&gt;
            <a href="#kafka.controller;RequestSendThread.doWork.response" title="kafka.api.RequestOrResponse">response</a> = <a href="../api/LeaderAndIsrResponse.scala.html#kafka.api.LeaderAndIsrResponse" title="kafka.api.LeaderAndIsrResponse.type">LeaderAndIsrResponse</a>.<a href="../api/LeaderAndIsrResponse.scala.html#kafka.api.LeaderAndIsrResponse.readFrom" title="(buffer: java.nio.ByteBuffer)kafka.api.LeaderAndIsrResponse">readFrom</a><span class="delimiter">(</span><a href="#kafka.controller;RequestSendThread.doWork.receive" title="kafka.network.Receive">receive</a>.<a href="../network/Transmission.scala.html#kafka.network;Receive.buffer" title="=&gt; java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
          case <a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys" title="kafka.api.RequestKeys.type">RequestKeys</a>.<a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys.StopReplicaKey" title="=&gt; Short">StopReplicaKey</a> =&gt;
            <a href="#kafka.controller;RequestSendThread.doWork.response" title="kafka.api.RequestOrResponse">response</a> = <a href="../api/StopReplicaResponse.scala.html#kafka.api.StopReplicaResponse" title="kafka.api.StopReplicaResponse.type">StopReplicaResponse</a>.<a href="../api/StopReplicaResponse.scala.html#kafka.api.StopReplicaResponse.readFrom" title="(buffer: java.nio.ByteBuffer)kafka.api.StopReplicaResponse">readFrom</a><span class="delimiter">(</span><a href="#kafka.controller;RequestSendThread.doWork.receive" title="kafka.network.Receive">receive</a>.<a href="../network/Transmission.scala.html#kafka.network;Receive.buffer" title="=&gt; java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
          case <a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys" title="kafka.api.RequestKeys.type">RequestKeys</a>.<a href="../api/RequestKeys.scala.html#kafka.api.RequestKeys.UpdateMetadataKey" title="=&gt; Short">UpdateMetadataKey</a> =&gt;
            <a href="#kafka.controller;RequestSendThread.doWork.response" title="kafka.api.RequestOrResponse">response</a> = <a href="../api/UpdateMetadataResponse.scala.html#kafka.api.UpdateMetadataResponse" title="kafka.api.UpdateMetadataResponse.type">UpdateMetadataResponse</a>.<a href="../api/UpdateMetadataResponse.scala.html#kafka.api.UpdateMetadataResponse.readFrom" title="(buffer: java.nio.ByteBuffer)kafka.api.UpdateMetadataResponse">readFrom</a><span class="delimiter">(</span><a href="#kafka.controller;RequestSendThread.doWork.receive" title="kafka.network.Receive">receive</a>.<a href="../network/Transmission.scala.html#kafka.network;Receive.buffer" title="=&gt; java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#kafka.controller;RequestSendThread.stateChangeLogger" title="=&gt; kafka.controller.KafkaController.StateChangeLogger">stateChangeLogger</a>.<a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Controller %d epoch %d received response %s for a request sent to broker %s&quot;</span>
                                  .<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.controller;RequestSendThread.controllerId" title="=&gt; Int">controllerId</a>, <a href="#kafka.controller;RequestSendThread.controllerContext" title="=&gt; kafka.controller.ControllerContext">controllerContext</a>.<a href="KafkaController.scala.html#kafka.controller;ControllerContext.epoch" title="=&gt; Int">epoch</a>, <a href="#kafka.controller;RequestSendThread.doWork.response" title="kafka.api.RequestOrResponse">response</a>.<span title="()String">toString</span>, <a href="#kafka.controller;RequestSendThread.toBroker" title="=&gt; kafka.cluster.Broker">toBroker</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.toString" title="()String">toString</a><span class="delimiter">)</span><span class="delimiter">)</span>

        if<span class="delimiter">(</span><a href="#kafka.controller;RequestSendThread.doWork.callback" title="kafka.api.RequestOrResponse =&gt; Unit">callback</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#kafka.controller;RequestSendThread.doWork.callback" title="(v1: kafka.api.RequestOrResponse)Unit">callback</a><span class="delimiter">(</span><a href="#kafka.controller;RequestSendThread.doWork.response" title="kafka.api.RequestOrResponse">response</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> catch <span class="delimiter">{</span>
      case <span title="Throwable">e</span>: <span title="Throwable">Throwable</span> =&gt;
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">error</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Controller %d fails to send a request to broker %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.controller;RequestSendThread.controllerId" title="=&gt; Int">controllerId</a>, <a href="#kafka.controller;RequestSendThread.toBroker" title="=&gt; kafka.cluster.Broker">toBroker</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.toString" title="()String">toString</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="Throwable">e</span><span class="delimiter">)</span>
        <span class="comment">// If there is any socket error (eg, socket timeout), the channel is no longer usable and needs to be recreated.</span>
        <a href="#kafka.controller;RequestSendThread.channel" title="=&gt; kafka.network.BlockingChannel">channel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.disconnect" title="()Unit">disconnect</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(broker: kafka.cluster.Broker, channel: kafka.network.BlockingChannel)Unit" id="kafka.controller;RequestSendThread.connectToBroker">connectToBroker</a><span class="delimiter">(</span><a title="kafka.cluster.Broker" id="kafka.controller;RequestSendThread.connectToBroker.broker">broker</a>: <a href="../cluster/Broker.scala.html#kafka.cluster;Broker" title="kafka.cluster.Broker">Broker</a>, <a title="kafka.network.BlockingChannel" id="kafka.controller;RequestSendThread.connectToBroker.channel">channel</a>: <a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel" title="kafka.network.BlockingChannel">BlockingChannel</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    try <span class="delimiter">{</span>
      <a href="#kafka.controller;RequestSendThread.connectToBroker.channel" title="kafka.network.BlockingChannel">channel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.connect" title="()Unit">connect</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Controller %d connected to %s for sending state change requests&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.controller;RequestSendThread.controllerId" title="=&gt; Int">controllerId</a>, <a href="#kafka.controller;RequestSendThread.connectToBroker.broker" title="kafka.cluster.Broker">broker</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.toString" title="()String">toString</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> catch <span class="delimiter">{</span>
      case <a title="Throwable" id="kafka.controller;RequestSendThread.connectToBroker.e">e</a>: <span title="Throwable">Throwable</span> =&gt; <span class="delimiter">{</span>
        <a href="#kafka.controller;RequestSendThread.connectToBroker.channel" title="kafka.network.BlockingChannel">channel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.disconnect" title="()Unit">disconnect</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">error</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Controller %d's connection to broker %s was unsuccessful&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.controller;RequestSendThread.controllerId" title="=&gt; Int">controllerId</a>, <a href="#kafka.controller;RequestSendThread.connectToBroker.broker" title="kafka.cluster.Broker">broker</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.toString" title="()String">toString</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#kafka.controller;RequestSendThread.connectToBroker.e" title="Throwable">e</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

class <a title="class ControllerBrokerRequestBatch extends AnyRef with kafka.utils.Logging" id="kafka.controller;ControllerBrokerRequestBatch">ControllerBrokerRequestBatch</a><a href="#kafka.controller;ControllerBrokerRequestBatch" title="kafka.controller.ControllerBrokerRequestBatch" class="delimiter">(</a><a title="kafka.controller.KafkaController" id="kafka.controller;ControllerBrokerRequestBatch.controller">controller</a>: <a href="KafkaController.scala.html#kafka.controller;KafkaController" title="kafka.controller.KafkaController">KafkaController</a><span class="delimiter">)</span> extends  <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> <span class="delimiter">{</span>
  val <a title="kafka.controller.ControllerContext" id="kafka.controller;ControllerBrokerRequestBatch.controllerContext">controllerContext</a> = <a href="#kafka.controller;ControllerBrokerRequestBatch.controller" title="kafka.controller.KafkaController">controller</a>.<a href="KafkaController.scala.html#kafka.controller;KafkaController.controllerContext" title="=&gt; kafka.controller.ControllerContext">controllerContext</a>
  val <a title="Int" id="kafka.controller;ControllerBrokerRequestBatch.controllerId">controllerId</a>: <span title="Int">Int</span> = <a href="#kafka.controller;ControllerBrokerRequestBatch.controller" title="kafka.controller.KafkaController">controller</a>.<a href="KafkaController.scala.html#kafka.controller;KafkaController.config" title="=&gt; kafka.server.KafkaConfig">config</a>.<a href="../server/KafkaConfig.scala.html#kafka.server;KafkaConfig.brokerId" title="=&gt; Int">brokerId</a>
  val <a title="String" id="kafka.controller;ControllerBrokerRequestBatch.clientId">clientId</a>: <span title="String">String</span> = <a href="#kafka.controller;ControllerBrokerRequestBatch.controller" title="kafka.controller.KafkaController">controller</a>.<a href="KafkaController.scala.html#kafka.controller;KafkaController.clientId" title="=&gt; String">clientId</a>
  val <a title="scala.collection.mutable.HashMap[Int,scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo]]" id="kafka.controller;ControllerBrokerRequestBatch.leaderAndIsrRequestMap">leaderAndIsrRequestMap</a> = new mutable.<span title="scala.collection.mutable.HashMap[Int,scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo]]">HashMap</span><span class="delimiter">[</span>Int, mutable.HashMap<span class="delimiter">[</span><span class="delimiter">(</span>String, Int<span class="delimiter">)</span>, PartitionStateInfo<span class="delimiter">]</span><span class="delimiter">]</span>
  val <a title="scala.collection.mutable.HashMap[Int,Seq[kafka.controller.StopReplicaRequestInfo]]" id="kafka.controller;ControllerBrokerRequestBatch.stopReplicaRequestMap">stopReplicaRequestMap</a> = new mutable.<span title="scala.collection.mutable.HashMap[Int,Seq[kafka.controller.StopReplicaRequestInfo]]">HashMap</span><span class="delimiter">[</span>Int, Seq<span class="delimiter">[</span>StopReplicaRequestInfo<span class="delimiter">]</span><span class="delimiter">]</span>
  val <a title="scala.collection.mutable.HashMap[Int,scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]]" id="kafka.controller;ControllerBrokerRequestBatch.updateMetadataRequestMap">updateMetadataRequestMap</a> = new mutable.<span title="scala.collection.mutable.HashMap[Int,scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]]">HashMap</span><span class="delimiter">[</span>Int, mutable.HashMap<span class="delimiter">[</span>TopicAndPartition, PartitionStateInfo<span class="delimiter">]</span><span class="delimiter">]</span>
  private val <a title="kafka.controller.KafkaController.StateChangeLogger" id="kafka.controller;ControllerBrokerRequestBatch.stateChangeLogger">stateChangeLogger</a> = <a href="KafkaController.scala.html#kafka.controller.KafkaController" title="kafka.controller.KafkaController.type">KafkaController</a>.<a href="KafkaController.scala.html#kafka.controller.KafkaController.stateChangeLogger" title="=&gt; kafka.controller.KafkaController.StateChangeLogger">stateChangeLogger</a>

  def <a title="()Unit" id="kafka.controller;ControllerBrokerRequestBatch.newBatch">newBatch</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="comment">// raise error if the previous batch is not empty</span>
    if<span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.leaderAndIsrRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo]]">leaderAndIsrRequestMap</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      throw new <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;Controller to broker state change requests batch is not empty while creating &quot;)" class="string">&quot;Controller to broker state change requests batch is not empty while creating &quot;</span> <span title="(x$1: Any)String">+</span>
        <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;a new one. Some LeaderAndIsr state changes %s might be lost &quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.leaderAndIsrRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo]]">leaderAndIsrRequestMap</a>.<span title="()String">toString</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    if<span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.stopReplicaRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,Seq[kafka.controller.StopReplicaRequestInfo]]">stopReplicaRequestMap</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      throw new <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;Controller to broker state change requests batch is not empty while creating a &quot;)" class="string">&quot;Controller to broker state change requests batch is not empty while creating a &quot;</span> <span title="(x$1: Any)String">+</span>
        <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;new one. Some StopReplica state changes %s might be lost &quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.stopReplicaRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,Seq[kafka.controller.StopReplicaRequestInfo]]">stopReplicaRequestMap</a>.<span title="()String">toString</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    if<span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.updateMetadataRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]]">updateMetadataRequestMap</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      throw new <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;Controller to broker state change requests batch is not empty while creating a &quot;)" class="string">&quot;Controller to broker state change requests batch is not empty while creating a &quot;</span> <span title="(x$1: Any)String">+</span>
        <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;new one. Some UpdateMetadata state changes %s might be lost &quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.updateMetadataRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]]">updateMetadataRequestMap</a>.<span title="()String">toString</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(brokerIds: Seq[Int], topic: String, partition: Int, leaderIsrAndControllerEpoch: kafka.controller.LeaderIsrAndControllerEpoch, replicas: Seq[Int], callback: kafka.api.RequestOrResponse =&gt; Unit)Unit" id="kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers">addLeaderAndIsrRequestForBrokers</a><span class="delimiter">(</span><a title="Seq[Int]" id="kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.brokerIds">brokerIds</a>: <span title="Seq[Int]">Seq</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>, <a title="String" id="kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.topic">topic</a>: <span title="String">String</span>, <a title="Int" id="kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.partition">partition</a>: <span title="Int">Int</span>,
                                       <a title="kafka.controller.LeaderIsrAndControllerEpoch" id="kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.leaderIsrAndControllerEpoch">leaderIsrAndControllerEpoch</a>: <a href="KafkaController.scala.html#kafka.controller;LeaderIsrAndControllerEpoch" title="kafka.controller.LeaderIsrAndControllerEpoch">LeaderIsrAndControllerEpoch</a>,
                                       <a title="Seq[Int]" id="kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.replicas">replicas</a>: <span title="Seq[Int]">Seq</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>, <a title="kafka.api.RequestOrResponse =&gt; Unit" id="kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers$default$6">callback</a>: <span class="delimiter">(</span>RequestOrResponse<span class="delimiter">)</span> =&gt; Unit = null<span class="delimiter">)</span> <span class="delimiter">{</span>
    val <a title="kafka.common.TopicAndPartition" id="kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.topicAndPartition">topicAndPartition</a>: <a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition" title="kafka.common.TopicAndPartition">TopicAndPartition</a> = <a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition" title="(topic: String, partition: Int)kafka.common.TopicAndPartition">TopicAndPartition</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.topic" title="String">topic</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.partition" title="Int">partition</a><span class="delimiter">)</span>

    <a href="#kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.brokerIds" title="Seq[Int]">brokerIds</a>.<span title="(p: Int =&gt; Boolean)Seq[Int]">filter</span><span class="delimiter">(</span><a title="Int" id="kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.$anonfun.b">b</a> =&gt; <a href="#kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.$anonfun.b" title="Int">b</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Option[kafka.api.PartitionStateInfo])Unit">foreach</span> <span class="delimiter">{</span>
      <a title="Int" id="kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.$anonfun.brokerId">brokerId</a> =&gt;
        <a href="#kafka.controller;ControllerBrokerRequestBatch.leaderAndIsrRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo]]">leaderAndIsrRequestMap</a>.<span title="(key: Int, op: =&gt; scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo])scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo]">getOrElseUpdate</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.$anonfun.brokerId" title="Int">brokerId</a>, new mutable.<span title="scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo]">HashMap</span><span class="delimiter">[</span><span class="delimiter">(</span>String, Int<span class="delimiter">)</span>, PartitionStateInfo<span class="delimiter">]</span><span class="delimiter">)</span>
        <a href="#kafka.controller;ControllerBrokerRequestBatch.leaderAndIsrRequestMap" title="(key: Int)scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo]">leaderAndIsrRequestMap</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.$anonfun.brokerId" title="Int">brokerId</a><span class="delimiter">)</span>.<span title="(key: (String, Int), value: kafka.api.PartitionStateInfo)Option[kafka.api.PartitionStateInfo]">put</span><span class="delimiter">(</span><span title="(_1: String, _2: Int)(String, Int)" class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.topic" title="String">topic</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.partition" title="Int">partition</a><span class="delimiter">)</span>,
          <a href="../api/LeaderAndIsrRequest.scala.html#kafka.api;PartitionStateInfo" title="(leaderIsrAndControllerEpoch: kafka.controller.LeaderIsrAndControllerEpoch, allReplicas: scala.collection.Set[Int])kafka.api.PartitionStateInfo">PartitionStateInfo</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.leaderIsrAndControllerEpoch" title="kafka.controller.LeaderIsrAndControllerEpoch">leaderIsrAndControllerEpoch</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.replicas" title="Seq[Int]">replicas</a>.<span title="scala.collection.immutable.Set[Int]">toSet</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers" title="(brokerIds: Seq[Int], partitions: scala.collection.Set[kafka.common.TopicAndPartition], callback: kafka.api.RequestOrResponse =&gt; Unit)Unit">addUpdateMetadataRequestForBrokers</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.controllerContext" title="=&gt; kafka.controller.ControllerContext">controllerContext</a>.<a href="KafkaController.scala.html#kafka.controller;ControllerContext.liveOrShuttingDownBrokerIds" title="=&gt; scala.collection.Set[Int]">liveOrShuttingDownBrokerIds</a>.<span title="=&gt; Seq[Int]">toSeq</span>,
                                       <span title="(elems: kafka.common.TopicAndPartition*)scala.collection.Set[kafka.common.TopicAndPartition]">Set</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addLeaderAndIsrRequestForBrokers.topicAndPartition" title="kafka.common.TopicAndPartition">topicAndPartition</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(brokerIds: Seq[Int], topic: String, partition: Int, deletePartition: Boolean, callback: (kafka.api.RequestOrResponse, Int) =&gt; Unit)Unit" id="kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers">addStopReplicaRequestForBrokers</a><span class="delimiter">(</span><a title="Seq[Int]" id="kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.brokerIds">brokerIds</a>: <span title="Seq[Int]">Seq</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>, <a title="String" id="kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.topic">topic</a>: <span title="String">String</span>, <a title="Int" id="kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.partition">partition</a>: <span title="Int">Int</span>, <a title="Boolean" id="kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.deletePartition">deletePartition</a>: <span title="Boolean">Boolean</span>,
                                      <a title="(kafka.api.RequestOrResponse, Int) =&gt; Unit" id="kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers$default$5">callback</a>: <span class="delimiter">(</span>RequestOrResponse, Int<span class="delimiter">)</span> =&gt; Unit = null<span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.brokerIds" title="Seq[Int]">brokerIds</a>.<span title="(p: Int =&gt; Boolean)Seq[Int]">filter</span><span class="delimiter">(</span><a title="Int" id="kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.$anonfun.b">b</a> =&gt; <a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.$anonfun.b" title="Int">b</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="Int" id="kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.$anonfun.brokerId">brokerId</a> =&gt;
      <a href="#kafka.controller;ControllerBrokerRequestBatch.stopReplicaRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,Seq[kafka.controller.StopReplicaRequestInfo]]">stopReplicaRequestMap</a>.<span title="(key: Int, op: =&gt; Seq[kafka.controller.StopReplicaRequestInfo])Seq[kafka.controller.StopReplicaRequestInfo]">getOrElseUpdate</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.$anonfun.brokerId" title="Int">brokerId</a>, <span title="scala.collection.Seq.type">Seq</span>.<span title="[A]=&gt; Seq[A]">empty</span><span title="Seq[kafka.controller.StopReplicaRequestInfo]" class="delimiter">[</span><a href="#kafka.controller.StopReplicaRequestInfo.readResolve" title="kafka.controller.StopReplicaRequestInfo">StopReplicaRequestInfo</a><span class="delimiter">]</span><span class="delimiter">)</span>
      val <a title="Seq[kafka.controller.StopReplicaRequestInfo]" id="kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.$anonfun.v">v</a> = <a href="#kafka.controller;ControllerBrokerRequestBatch.stopReplicaRequestMap" title="(key: Int)Seq[kafka.controller.StopReplicaRequestInfo]">stopReplicaRequestMap</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.$anonfun.brokerId" title="Int">brokerId</a><span class="delimiter">)</span>
      if<span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers$default$5" title="(kafka.api.RequestOrResponse, Int) =&gt; Unit">callback</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
        <a href="#kafka.controller;ControllerBrokerRequestBatch.stopReplicaRequestMap" title="(key: Int, value: Seq[kafka.controller.StopReplicaRequestInfo])Unit">stopReplicaRequestMap</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.$anonfun.brokerId" title="Int">brokerId</a><span class="delimiter">)</span> = <a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.$anonfun.v" title="Seq[kafka.controller.StopReplicaRequestInfo]">v</a> <span title="(elem: kafka.controller.StopReplicaRequestInfo)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[kafka.controller.StopReplicaRequestInfo],kafka.controller.StopReplicaRequestInfo,Seq[kafka.controller.StopReplicaRequestInfo]])Seq[kafka.controller.StopReplicaRequestInfo]">:+</span> <a href="#kafka.controller.StopReplicaRequestInfo.readResolve" title="(replica: kafka.controller.PartitionAndReplica, deletePartition: Boolean, callback: kafka.api.RequestOrResponse =&gt; Unit)kafka.controller.StopReplicaRequestInfo">StopReplicaRequestInfo</a><span class="delimiter">(</span><a href="KafkaController.scala.html#kafka.controller;PartitionAndReplica" title="(topic: String, partition: Int, replica: Int)kafka.controller.PartitionAndReplica">PartitionAndReplica</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.topic" title="String">topic</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.partition" title="Int">partition</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.$anonfun.brokerId" title="Int">brokerId</a><span class="delimiter">)</span>,
          <a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.deletePartition" title="Boolean">deletePartition</a>, <span class="delimiter">(</span>r: <a href="../api/RequestOrResponse.scala.html#kafka.api;RequestOrResponse" title="kafka.api.RequestOrResponse">RequestOrResponse</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span> <a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers$default$5" title="(v1: kafka.api.RequestOrResponse, v2: Int)Unit">callback</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.$anonfun.$anonfun.r" title="kafka.api.RequestOrResponse">r</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.$anonfun.brokerId" title="Int">brokerId</a><span class="delimiter">)</span> <span class="delimiter">}</span><span class="delimiter">)</span>
      else
        <a href="#kafka.controller;ControllerBrokerRequestBatch.stopReplicaRequestMap" title="(key: Int, value: Seq[kafka.controller.StopReplicaRequestInfo])Unit">stopReplicaRequestMap</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.$anonfun.brokerId" title="Int">brokerId</a><span class="delimiter">)</span> = <a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.$anonfun.v" title="Seq[kafka.controller.StopReplicaRequestInfo]">v</a> <span title="(elem: kafka.controller.StopReplicaRequestInfo)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[kafka.controller.StopReplicaRequestInfo],kafka.controller.StopReplicaRequestInfo,Seq[kafka.controller.StopReplicaRequestInfo]])Seq[kafka.controller.StopReplicaRequestInfo]">:+</span> <a href="#kafka.controller.StopReplicaRequestInfo.readResolve" title="(replica: kafka.controller.PartitionAndReplica, deletePartition: Boolean, callback: kafka.api.RequestOrResponse =&gt; Unit)kafka.controller.StopReplicaRequestInfo">StopReplicaRequestInfo</a><span class="delimiter">(</span><a href="KafkaController.scala.html#kafka.controller;PartitionAndReplica" title="(topic: String, partition: Int, replica: Int)kafka.controller.PartitionAndReplica">PartitionAndReplica</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.topic" title="String">topic</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.partition" title="Int">partition</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.$anonfun.brokerId" title="Int">brokerId</a><span class="delimiter">)</span>,
          <a href="#kafka.controller;ControllerBrokerRequestBatch.addStopReplicaRequestForBrokers.deletePartition" title="Boolean">deletePartition</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Send UpdateMetadataRequest to the given brokers for the given partitions and partitions that are being deleted */</span>
  def <a title="(brokerIds: Seq[Int], partitions: scala.collection.Set[kafka.common.TopicAndPartition], callback: kafka.api.RequestOrResponse =&gt; Unit)Unit" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers">addUpdateMetadataRequestForBrokers</a><span class="delimiter">(</span><a title="Seq[Int]" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.brokerIds">brokerIds</a>: <span title="Seq[Int]">Seq</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>,
                                         <a title="scala.collection.Set[kafka.common.TopicAndPartition]" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers$default$2">partitions</a>: collection.<span title="scala.collection.Set[kafka.common.TopicAndPartition]">Set</span><span class="delimiter">[</span>TopicAndPartition<span class="delimiter">]</span> = <span title="scala.collection.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.Set[A]">empty</span><span title="scala.collection.Set[kafka.common.TopicAndPartition]" class="delimiter">[</span><a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition" title="kafka.common.TopicAndPartition">TopicAndPartition</a><span class="delimiter">]</span>,
                                         <a title="kafka.api.RequestOrResponse =&gt; Unit" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers$default$3">callback</a>: <span class="delimiter">(</span>RequestOrResponse<span class="delimiter">)</span> =&gt; Unit = null<span class="delimiter">)</span> <span class="delimiter">{</span>
    def <a title="(partition: kafka.common.TopicAndPartition, beingDeleted: Boolean)Unit" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor">updateMetadataRequestMapFor</a><span class="delimiter">(</span><a title="kafka.common.TopicAndPartition" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.partition">partition</a>: <a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition" title="kafka.common.TopicAndPartition">TopicAndPartition</a>, <a title="Boolean" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.beingDeleted">beingDeleted</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="Option[kafka.controller.LeaderIsrAndControllerEpoch]" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.leaderIsrAndControllerEpochOpt">leaderIsrAndControllerEpochOpt</a> = <a href="#kafka.controller;ControllerBrokerRequestBatch.controllerContext" title="=&gt; kafka.controller.ControllerContext">controllerContext</a>.<a href="KafkaController.scala.html#kafka.controller;ControllerContext.partitionLeadershipInfo" title="=&gt; scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.controller.LeaderIsrAndControllerEpoch]">partitionLeadershipInfo</a>.<span title="(key: kafka.common.TopicAndPartition)Option[kafka.controller.LeaderIsrAndControllerEpoch]">get</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.partition" title="kafka.common.TopicAndPartition">partition</a><span class="delimiter">)</span>
      <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.leaderIsrAndControllerEpochOpt" title="Option[kafka.controller.LeaderIsrAndControllerEpoch]">leaderIsrAndControllerEpochOpt</a> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><a title="kafka.controller.LeaderIsrAndControllerEpoch" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.leaderIsrAndControllerEpoch">leaderIsrAndControllerEpoch</a><span class="delimiter">)</span> =&gt;
          val <a title="scala.collection.immutable.Set[Int]" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.replicas">replicas</a> = <a href="#kafka.controller;ControllerBrokerRequestBatch.controllerContext" title="=&gt; kafka.controller.ControllerContext">controllerContext</a>.<a href="KafkaController.scala.html#kafka.controller;ControllerContext.partitionReplicaAssignment" title="(key: kafka.common.TopicAndPartition)Seq[Int]">partitionReplicaAssignment</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.partition" title="kafka.common.TopicAndPartition">partition</a><span class="delimiter">)</span>.<span title="scala.collection.immutable.Set[Int]">toSet</span>
          val <a title="kafka.api.PartitionStateInfo" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.partitionStateInfo">partitionStateInfo</a> = if <span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.beingDeleted" title="Boolean">beingDeleted</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            val <a title="kafka.api.LeaderAndIsr" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.partitionStateInfo.leaderAndIsr">leaderAndIsr</a> = new <a href="../api/LeaderAndIsrRequest.scala.html#kafka.api;LeaderAndIsr" title="kafka.api.LeaderAndIsr">LeaderAndIsr</a><span class="delimiter">(</span><a href="../api/LeaderAndIsrRequest.scala.html#kafka.api.LeaderAndIsr" title="kafka.api.LeaderAndIsr.type">LeaderAndIsr</a>.<a href="../api/LeaderAndIsrRequest.scala.html#kafka.api.LeaderAndIsr.LeaderDuringDelete" title="=&gt; Int">LeaderDuringDelete</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.leaderIsrAndControllerEpoch" title="kafka.controller.LeaderIsrAndControllerEpoch">leaderIsrAndControllerEpoch</a>.<a href="KafkaController.scala.html#kafka.controller;LeaderIsrAndControllerEpoch.leaderAndIsr" title="=&gt; kafka.api.LeaderAndIsr">leaderAndIsr</a>.<a href="../api/LeaderAndIsrRequest.scala.html#kafka.api;LeaderAndIsr.isr" title="=&gt; List[Int]">isr</a><span class="delimiter">)</span>
            <a href="../api/LeaderAndIsrRequest.scala.html#kafka.api;PartitionStateInfo" title="(leaderIsrAndControllerEpoch: kafka.controller.LeaderIsrAndControllerEpoch, allReplicas: scala.collection.Set[Int])kafka.api.PartitionStateInfo">PartitionStateInfo</a><span class="delimiter">(</span><a href="KafkaController.scala.html#kafka.controller;LeaderIsrAndControllerEpoch" title="(leaderAndIsr: kafka.api.LeaderAndIsr, controllerEpoch: Int)kafka.controller.LeaderIsrAndControllerEpoch">LeaderIsrAndControllerEpoch</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.partitionStateInfo.leaderAndIsr" title="kafka.api.LeaderAndIsr">leaderAndIsr</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.leaderIsrAndControllerEpoch" title="kafka.controller.LeaderIsrAndControllerEpoch">leaderIsrAndControllerEpoch</a>.<a href="KafkaController.scala.html#kafka.controller;LeaderIsrAndControllerEpoch.controllerEpoch" title="=&gt; Int">controllerEpoch</a><span class="delimiter">)</span>, <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.replicas" title="scala.collection.immutable.Set[Int]">replicas</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> else <span class="delimiter">{</span>
            <a href="../api/LeaderAndIsrRequest.scala.html#kafka.api;PartitionStateInfo" title="(leaderIsrAndControllerEpoch: kafka.controller.LeaderIsrAndControllerEpoch, allReplicas: scala.collection.Set[Int])kafka.api.PartitionStateInfo">PartitionStateInfo</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.leaderIsrAndControllerEpoch" title="kafka.controller.LeaderIsrAndControllerEpoch">leaderIsrAndControllerEpoch</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.replicas" title="scala.collection.immutable.Set[Int]">replicas</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.brokerIds" title="Seq[Int]">brokerIds</a>.<span title="(p: Int =&gt; Boolean)Seq[Int]">filter</span><span class="delimiter">(</span><a title="Int" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.$anonfun.b">b</a> =&gt; <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.$anonfun.b" title="Int">b</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Option[kafka.api.PartitionStateInfo])Unit">foreach</span> <span class="delimiter">{</span> <a title="Int" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.$anonfun.brokerId">brokerId</a> =&gt;
            <a href="#kafka.controller;ControllerBrokerRequestBatch.updateMetadataRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]]">updateMetadataRequestMap</a>.<span title="(key: Int, op: =&gt; scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo])scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]">getOrElseUpdate</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.$anonfun.brokerId" title="Int">brokerId</a>, new mutable.<span title="scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]">HashMap</span><span class="delimiter">[</span>TopicAndPartition, PartitionStateInfo<span class="delimiter">]</span><span class="delimiter">)</span>
            <a href="#kafka.controller;ControllerBrokerRequestBatch.updateMetadataRequestMap" title="(key: Int)scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]">updateMetadataRequestMap</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.$anonfun.brokerId" title="Int">brokerId</a><span class="delimiter">)</span>.<span title="(key: kafka.common.TopicAndPartition, value: kafka.api.PartitionStateInfo)Option[kafka.api.PartitionStateInfo]">put</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.partition" title="kafka.common.TopicAndPartition">partition</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.partitionStateInfo" title="kafka.api.PartitionStateInfo">partitionStateInfo</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        case <span title="None.type">None</span> =&gt;
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Leader not yet assigned for partition %s. Skip sending UpdateMetadataRequest.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor.partition" title="kafka.common.TopicAndPartition">partition</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    val <a title="scala.collection.Set[kafka.common.TopicAndPartition]" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.filteredPartitions">filteredPartitions</a> = <span class="delimiter">{</span>
      val <a title="scala.collection.Set[kafka.common.TopicAndPartition]" id="kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.filteredPartitions.givenPartitions">givenPartitions</a> = if <span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers$default$2" title="scala.collection.Set[kafka.common.TopicAndPartition]">partitions</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
        <a href="#kafka.controller;ControllerBrokerRequestBatch.controllerContext" title="=&gt; kafka.controller.ControllerContext">controllerContext</a>.<a href="KafkaController.scala.html#kafka.controller;ControllerContext.partitionLeadershipInfo" title="=&gt; scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.controller.LeaderIsrAndControllerEpoch]">partitionLeadershipInfo</a>.<span title="=&gt; scala.collection.Set[kafka.common.TopicAndPartition]">keySet</span>
      else
        <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers$default$2" title="scala.collection.Set[kafka.common.TopicAndPartition]">partitions</a>
      if <span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.controller" title="kafka.controller.KafkaController">controller</a>.<a href="KafkaController.scala.html#kafka.controller;KafkaController.deleteTopicManager" title="=&gt; kafka.controller.TopicDeletionManager">deleteTopicManager</a>.<a href="TopicDeletionManager.scala.html#kafka.controller;TopicDeletionManager.partitionsToBeDeleted" title="=&gt; scala.collection.mutable.Set[kafka.common.TopicAndPartition]">partitionsToBeDeleted</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
        <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.filteredPartitions.givenPartitions" title="scala.collection.Set[kafka.common.TopicAndPartition]">givenPartitions</a>
      else
        <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.filteredPartitions.givenPartitions" title="scala.collection.Set[kafka.common.TopicAndPartition]">givenPartitions</a> <span title="(xs: scala.collection.GenTraversableOnce[kafka.common.TopicAndPartition])scala.collection.Set[kafka.common.TopicAndPartition]">--</span> <a href="#kafka.controller;ControllerBrokerRequestBatch.controller" title="kafka.controller.KafkaController">controller</a>.<a href="KafkaController.scala.html#kafka.controller;KafkaController.deleteTopicManager" title="=&gt; kafka.controller.TopicDeletionManager">deleteTopicManager</a>.<a href="TopicDeletionManager.scala.html#kafka.controller;TopicDeletionManager.partitionsToBeDeleted" title="=&gt; scala.collection.mutable.Set[kafka.common.TopicAndPartition]">partitionsToBeDeleted</a>
    <span class="delimiter">}</span>
    <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.filteredPartitions" title="scala.collection.Set[kafka.common.TopicAndPartition]">filteredPartitions</a>.<span title="(f: kafka.common.TopicAndPartition =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><span title="kafka.common.TopicAndPartition">partition</span> =&gt; <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor" title="(partition: kafka.common.TopicAndPartition, beingDeleted: Boolean)Unit">updateMetadataRequestMapFor</a><span class="delimiter">(</span><span title="kafka.common.TopicAndPartition">partition</span>, beingDeleted = false<span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#kafka.controller;ControllerBrokerRequestBatch.controller" title="kafka.controller.KafkaController">controller</a>.<a href="KafkaController.scala.html#kafka.controller;KafkaController.deleteTopicManager" title="=&gt; kafka.controller.TopicDeletionManager">deleteTopicManager</a>.<a href="TopicDeletionManager.scala.html#kafka.controller;TopicDeletionManager.partitionsToBeDeleted" title="=&gt; scala.collection.mutable.Set[kafka.common.TopicAndPartition]">partitionsToBeDeleted</a>.<span title="(f: kafka.common.TopicAndPartition =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><span title="kafka.common.TopicAndPartition">partition</span> =&gt; <a href="#kafka.controller;ControllerBrokerRequestBatch.addUpdateMetadataRequestForBrokers.updateMetadataRequestMapFor" title="(partition: kafka.common.TopicAndPartition, beingDeleted: Boolean)Unit">updateMetadataRequestMapFor</a><span class="delimiter">(</span><span title="kafka.common.TopicAndPartition">partition</span>, beingDeleted = true<span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(controllerEpoch: Int, correlationId: Int)Unit" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers">sendRequestsToBrokers</a><span class="delimiter">(</span><a title="Int" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.controllerEpoch">controllerEpoch</a>: <span title="Int">Int</span>, <a title="Int" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.correlationId">correlationId</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.controller;ControllerBrokerRequestBatch.leaderAndIsrRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo]]">leaderAndIsrRequestMap</a>.<span title="(f: ((Int, scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo])) =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <span title="(Int, scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo])">m</span> =&gt;
      val <span title="Int">broker</span> = <span title="(Int, scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo])">m</span>.<span title="=&gt; Int">_1</span>
      val <span title="scala.collection.immutable.Map[(String, Int),kafka.api.PartitionStateInfo]">partitionStateInfos</span> = <span title="(Int, scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo])">m</span>.<span title="=&gt; scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo]">_2</span>.<span title="(implicit ev: &lt;:&lt;[((String, Int), kafka.api.PartitionStateInfo),((String, Int), kafka.api.PartitionStateInfo)])scala.collection.immutable.Map[(String, Int),kafka.api.PartitionStateInfo]">toMap</span>
      val <a title="scala.collection.immutable.Set[Int]" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.leaderIds">leaderIds</a> = <span title="scala.collection.immutable.Map[(String, Int),kafka.api.PartitionStateInfo]">partitionStateInfos</span>.<span title="(f: (((String, Int), kafka.api.PartitionStateInfo)) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[(String, Int),kafka.api.PartitionStateInfo],Int,scala.collection.immutable.Iterable[Int]])scala.collection.immutable.Iterable[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Iterable.Coll,Int,scala.collection.immutable.Iterable[Int]]" class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.leaderIds.$anonfun.x$2" title="((String, Int), kafka.api.PartitionStateInfo)">_</a>.<span title="=&gt; kafka.api.PartitionStateInfo">_2</span>.<a href="../api/LeaderAndIsrRequest.scala.html#kafka.api;PartitionStateInfo.leaderIsrAndControllerEpoch" title="=&gt; kafka.controller.LeaderIsrAndControllerEpoch">leaderIsrAndControllerEpoch</a>.<a href="KafkaController.scala.html#kafka.controller;LeaderIsrAndControllerEpoch.leaderAndIsr" title="=&gt; kafka.api.LeaderAndIsr">leaderAndIsr</a>.<a href="../api/LeaderAndIsrRequest.scala.html#kafka.api;LeaderAndIsr.leader" title="=&gt; Int">leader</a><span class="delimiter">)</span>.<span title="scala.collection.immutable.Set[Int]">toSet</span>
      val <a title="scala.collection.Set[kafka.cluster.Broker]" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.leaders">leaders</a> = <a href="#kafka.controller;ControllerBrokerRequestBatch.controllerContext" title="=&gt; kafka.controller.ControllerContext">controllerContext</a>.<a href="KafkaController.scala.html#kafka.controller;ControllerContext.liveOrShuttingDownBrokers" title="=&gt; scala.collection.Set[kafka.cluster.Broker]">liveOrShuttingDownBrokers</a>.<span title="(p: kafka.cluster.Broker =&gt; Boolean)scala.collection.Set[kafka.cluster.Broker]">filter</span><span class="delimiter">(</span><a title="kafka.cluster.Broker" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.leaders.$anonfun.b">b</a> =&gt; <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.leaderIds" title="scala.collection.immutable.Set[Int]">leaderIds</a>.<span title="(elem: Int)Boolean">contains</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.leaders.$anonfun.b" title="kafka.cluster.Broker">b</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.id" title="=&gt; Int">id</a><span class="delimiter">)</span><span class="delimiter">)</span>
      val <a title="kafka.api.LeaderAndIsrRequest" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.leaderAndIsrRequest">leaderAndIsrRequest</a> = new <a href="../api/LeaderAndIsrRequest.scala.html#kafka.api;LeaderAndIsrRequest" title="kafka.api.LeaderAndIsrRequest">LeaderAndIsrRequest</a><span class="delimiter">(</span><span title="scala.collection.immutable.Map[(String, Int),kafka.api.PartitionStateInfo]">partitionStateInfos</span>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.leaders" title="scala.collection.Set[kafka.cluster.Broker]">leaders</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.controllerId" title="=&gt; Int">controllerId</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.controllerEpoch" title="Int">controllerEpoch</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.correlationId" title="Int">correlationId</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.clientId" title="=&gt; String">clientId</a><span class="delimiter">)</span>
      for <span class="delimiter">(</span><span title="((String, Int), kafka.api.PartitionStateInfo)">p</span> &lt;- <span title="(f: (((String, Int), kafka.api.PartitionStateInfo)) =&gt; Unit)Unit">partitionStateInfos</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        val <a title="String" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.$anonfun.typeOfRequest">typeOfRequest</a> = if <span class="delimiter">(</span><span title="Int">broker</span> <span title="(x: Int)Boolean">==</span> <span title="((String, Int), kafka.api.PartitionStateInfo)">p</span>.<span title="=&gt; kafka.api.PartitionStateInfo">_2</span>.<a href="../api/LeaderAndIsrRequest.scala.html#kafka.api;PartitionStateInfo.leaderIsrAndControllerEpoch" title="=&gt; kafka.controller.LeaderIsrAndControllerEpoch">leaderIsrAndControllerEpoch</a>.<a href="KafkaController.scala.html#kafka.controller;LeaderIsrAndControllerEpoch.leaderAndIsr" title="=&gt; kafka.api.LeaderAndIsr">leaderAndIsr</a>.<a href="../api/LeaderAndIsrRequest.scala.html#kafka.api;LeaderAndIsr.leader" title="=&gt; Int">leader</a><span class="delimiter">)</span> <span title="String(&quot;become-leader&quot;)" class="string">&quot;become-leader&quot;</span> else <span title="String(&quot;become-follower&quot;)" class="string">&quot;become-follower&quot;</span>
        <a href="#kafka.controller;ControllerBrokerRequestBatch.stateChangeLogger" title="=&gt; kafka.controller.KafkaController.StateChangeLogger">stateChangeLogger</a>.<a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="string">&quot;Controller %d epoch %d sending %s LeaderAndIsr request %s with correlationId %d to broker %d &quot;</span> <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">+</span>
                                 <span class="string">&quot;for partition [%s,%d]&quot;</span><span class="delimiter">)</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.controllerId" title="=&gt; Int">controllerId</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.controllerEpoch" title="Int">controllerEpoch</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.$anonfun.typeOfRequest" title="String">typeOfRequest</a>,
                                                                 <span title="((String, Int), kafka.api.PartitionStateInfo)">p</span>.<span title="=&gt; kafka.api.PartitionStateInfo">_2</span>.<a href="../api/LeaderAndIsrRequest.scala.html#kafka.api;PartitionStateInfo.leaderIsrAndControllerEpoch" title="=&gt; kafka.controller.LeaderIsrAndControllerEpoch">leaderIsrAndControllerEpoch</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.correlationId" title="Int">correlationId</a>, <span title="Int">broker</span>,
                                                                 <span title="((String, Int), kafka.api.PartitionStateInfo)">p</span>.<span title="=&gt; (String, Int)">_1</span>.<span title="=&gt; String">_1</span>, <span title="((String, Int), kafka.api.PartitionStateInfo)">p</span>.<span title="=&gt; (String, Int)">_1</span>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#kafka.controller;ControllerBrokerRequestBatch.controller" title="kafka.controller.KafkaController">controller</a>.<a href="KafkaController.scala.html#kafka.controller;KafkaController.sendRequest" title="(brokerId: Int, request: kafka.api.RequestOrResponse, callback: kafka.api.RequestOrResponse =&gt; Unit)Unit">sendRequest</a><span class="delimiter">(</span><span title="Int">broker</span>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.leaderAndIsrRequest" title="kafka.api.LeaderAndIsrRequest">leaderAndIsrRequest</a>, null<span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#kafka.controller;ControllerBrokerRequestBatch.leaderAndIsrRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,scala.collection.mutable.HashMap[(String, Int),kafka.api.PartitionStateInfo]]">leaderAndIsrRequestMap</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#kafka.controller;ControllerBrokerRequestBatch.updateMetadataRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]]">updateMetadataRequestMap</a>.<span title="(f: ((Int, scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo])) =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <span title="(Int, scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo])">m</span> =&gt;
      val <span title="Int">broker</span> = <span title="(Int, scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo])">m</span>.<span title="=&gt; Int">_1</span>
      val <span title="scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]">partitionStateInfos</span> = <span title="(Int, scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo])">m</span>.<span title="=&gt; scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]">_2</span>.<span title="(implicit ev: &lt;:&lt;[(kafka.common.TopicAndPartition, kafka.api.PartitionStateInfo),(kafka.common.TopicAndPartition, kafka.api.PartitionStateInfo)])scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]">toMap</span>
      val <a title="kafka.api.UpdateMetadataRequest" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.updateMetadataRequest">updateMetadataRequest</a> = new <a href="../api/UpdateMetadataRequest.scala.html#kafka.api;UpdateMetadataRequest" title="kafka.api.UpdateMetadataRequest">UpdateMetadataRequest</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.controllerId" title="=&gt; Int">controllerId</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.controllerEpoch" title="Int">controllerEpoch</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.correlationId" title="Int">correlationId</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.clientId" title="=&gt; String">clientId</a>,
        <span title="scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]">partitionStateInfos</span>, <a href="#kafka.controller;ControllerBrokerRequestBatch.controllerContext" title="=&gt; kafka.controller.ControllerContext">controllerContext</a>.<a href="KafkaController.scala.html#kafka.controller;ControllerContext.liveOrShuttingDownBrokers" title="=&gt; scala.collection.Set[kafka.cluster.Broker]">liveOrShuttingDownBrokers</a><span class="delimiter">)</span>
      <span title="scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]">partitionStateInfos</span>.<span title="(f: ((kafka.common.TopicAndPartition, kafka.api.PartitionStateInfo)) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><span title="(kafka.common.TopicAndPartition, kafka.api.PartitionStateInfo)">p</span> =&gt; <a href="#kafka.controller;ControllerBrokerRequestBatch.stateChangeLogger" title="=&gt; kafka.controller.KafkaController.StateChangeLogger">stateChangeLogger</a>.<a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="string">&quot;Controller %d epoch %d sending UpdateMetadata request %s with &quot;</span> <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">+</span>
        <span class="string">&quot;correlationId %d to broker %d for partition %s&quot;</span><span class="delimiter">)</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.controllerId" title="=&gt; Int">controllerId</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.controllerEpoch" title="Int">controllerEpoch</a>, <span title="(kafka.common.TopicAndPartition, kafka.api.PartitionStateInfo)">p</span>.<span title="=&gt; kafka.api.PartitionStateInfo">_2</span>.<a href="../api/LeaderAndIsrRequest.scala.html#kafka.api;PartitionStateInfo.leaderIsrAndControllerEpoch" title="=&gt; kafka.controller.LeaderIsrAndControllerEpoch">leaderIsrAndControllerEpoch</a>,
        <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.correlationId" title="Int">correlationId</a>, <span title="Int">broker</span>, <span title="(kafka.common.TopicAndPartition, kafka.api.PartitionStateInfo)">p</span>.<span title="=&gt; kafka.common.TopicAndPartition">_1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#kafka.controller;ControllerBrokerRequestBatch.controller" title="kafka.controller.KafkaController">controller</a>.<a href="KafkaController.scala.html#kafka.controller;KafkaController.sendRequest" title="(brokerId: Int, request: kafka.api.RequestOrResponse, callback: kafka.api.RequestOrResponse =&gt; Unit)Unit">sendRequest</a><span class="delimiter">(</span><span title="Int">broker</span>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.updateMetadataRequest" title="kafka.api.UpdateMetadataRequest">updateMetadataRequest</a>, null<span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#kafka.controller;ControllerBrokerRequestBatch.updateMetadataRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,scala.collection.mutable.HashMap[kafka.common.TopicAndPartition,kafka.api.PartitionStateInfo]]">updateMetadataRequestMap</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#kafka.controller;ControllerBrokerRequestBatch.stopReplicaRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,Seq[kafka.controller.StopReplicaRequestInfo]]">stopReplicaRequestMap</a> <span title="(f: ((Int, Seq[kafka.controller.StopReplicaRequestInfo])) =&gt; Unit)Unit">foreach</span> <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.x0$1" title="Unit" class="delimiter">{</a> case<span class="delimiter">(</span><span title="Int">broker</span>, <a title="Seq[kafka.controller.StopReplicaRequestInfo]" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.replicaInfoList">replicaInfoList</a><span class="delimiter">)</span> =&gt;
      val <a title="scala.collection.immutable.Set[kafka.controller.PartitionAndReplica]" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.stopReplicaWithDelete">stopReplicaWithDelete</a> = <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.replicaInfoList" title="Seq[kafka.controller.StopReplicaRequestInfo]">replicaInfoList</a>.<span title="(p: kafka.controller.StopReplicaRequestInfo =&gt; Boolean)Seq[kafka.controller.StopReplicaRequestInfo]">filter</span><span class="delimiter">(</span><a title="kafka.controller.StopReplicaRequestInfo" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.stopReplicaWithDelete.$anonfun.p">p</a> =&gt; <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.stopReplicaWithDelete.$anonfun.p" title="kafka.controller.StopReplicaRequestInfo">p</a>.<a href="#kafka.controller;StopReplicaRequestInfo.deletePartition" title="=&gt; Boolean">deletePartition</a> <span title="(x: Boolean)Boolean">==</span> true<span class="delimiter">)</span>.<span title="(f: kafka.controller.StopReplicaRequestInfo =&gt; kafka.controller.PartitionAndReplica)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[kafka.controller.StopReplicaRequestInfo],kafka.controller.PartitionAndReplica,Seq[kafka.controller.PartitionAndReplica]])Seq[kafka.controller.PartitionAndReplica]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,kafka.controller.PartitionAndReplica,Seq[kafka.controller.PartitionAndReplica]]" class="delimiter">(</span><a title="kafka.controller.StopReplicaRequestInfo" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.stopReplicaWithDelete.$anonfun.i">i</a> =&gt; <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.stopReplicaWithDelete.$anonfun.i" title="kafka.controller.StopReplicaRequestInfo">i</a>.<a href="#kafka.controller;StopReplicaRequestInfo.replica" title="=&gt; kafka.controller.PartitionAndReplica">replica</a><span class="delimiter">)</span>.<span title="scala.collection.immutable.Set[kafka.controller.PartitionAndReplica]">toSet</span>
      val <a title="scala.collection.immutable.Set[kafka.controller.PartitionAndReplica]" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.stopReplicaWithoutDelete">stopReplicaWithoutDelete</a> = <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.replicaInfoList" title="Seq[kafka.controller.StopReplicaRequestInfo]">replicaInfoList</a>.<span title="(p: kafka.controller.StopReplicaRequestInfo =&gt; Boolean)Seq[kafka.controller.StopReplicaRequestInfo]">filter</span><span class="delimiter">(</span><a title="kafka.controller.StopReplicaRequestInfo" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.stopReplicaWithoutDelete.$anonfun.p">p</a> =&gt; <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.stopReplicaWithoutDelete.$anonfun.p" title="kafka.controller.StopReplicaRequestInfo">p</a>.<a href="#kafka.controller;StopReplicaRequestInfo.deletePartition" title="=&gt; Boolean">deletePartition</a> <span title="(x: Boolean)Boolean">==</span> false<span class="delimiter">)</span>.<span title="(f: kafka.controller.StopReplicaRequestInfo =&gt; kafka.controller.PartitionAndReplica)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[kafka.controller.StopReplicaRequestInfo],kafka.controller.PartitionAndReplica,Seq[kafka.controller.PartitionAndReplica]])Seq[kafka.controller.PartitionAndReplica]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,kafka.controller.PartitionAndReplica,Seq[kafka.controller.PartitionAndReplica]]" class="delimiter">(</span><a title="kafka.controller.StopReplicaRequestInfo" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.stopReplicaWithoutDelete.$anonfun.i">i</a> =&gt; <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.stopReplicaWithoutDelete.$anonfun.i" title="kafka.controller.StopReplicaRequestInfo">i</a>.<a href="#kafka.controller;StopReplicaRequestInfo.replica" title="=&gt; kafka.controller.PartitionAndReplica">replica</a><span class="delimiter">)</span>.<span title="scala.collection.immutable.Set[kafka.controller.PartitionAndReplica]">toSet</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;The stop replica request (delete = true) sent to broker %d is %s&quot;</span>
        .<span title="(args: Any*)String">format</span><span class="delimiter">(</span><span title="Int">broker</span>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.stopReplicaWithDelete" title="scala.collection.immutable.Set[kafka.controller.PartitionAndReplica]">stopReplicaWithDelete</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;The stop replica request (delete = false) sent to broker %d is %s&quot;</span>
        .<span title="(args: Any*)String">format</span><span class="delimiter">(</span><span title="Int">broker</span>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.stopReplicaWithoutDelete" title="scala.collection.immutable.Set[kafka.controller.PartitionAndReplica]">stopReplicaWithoutDelete</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.replicaInfoList" title="Seq[kafka.controller.StopReplicaRequestInfo]">replicaInfoList</a>.<span title="(f: kafka.controller.StopReplicaRequestInfo =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="kafka.controller.StopReplicaRequestInfo" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.$anonfun.r">r</a> =&gt;
        val <a title="kafka.api.StopReplicaRequest" id="kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.$anonfun.stopReplicaRequest">stopReplicaRequest</a> = new <a href="../api/StopReplicaRequest.scala.html#kafka.api;StopReplicaRequest" title="kafka.api.StopReplicaRequest">StopReplicaRequest</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.$anonfun.r" title="kafka.controller.StopReplicaRequestInfo">r</a>.<a href="#kafka.controller;StopReplicaRequestInfo.deletePartition" title="=&gt; Boolean">deletePartition</a>,
          <span title="(elems: kafka.common.TopicAndPartition*)scala.collection.Set[kafka.common.TopicAndPartition]">Set</span><span class="delimiter">(</span><a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition" title="(topic: String, partition: Int)kafka.common.TopicAndPartition">TopicAndPartition</a><span class="delimiter">(</span><a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.$anonfun.r" title="kafka.controller.StopReplicaRequestInfo">r</a>.<a href="#kafka.controller;StopReplicaRequestInfo.replica" title="=&gt; kafka.controller.PartitionAndReplica">replica</a>.<a href="KafkaController.scala.html#kafka.controller;PartitionAndReplica.topic" title="=&gt; String">topic</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.$anonfun.r" title="kafka.controller.StopReplicaRequestInfo">r</a>.<a href="#kafka.controller;StopReplicaRequestInfo.replica" title="=&gt; kafka.controller.PartitionAndReplica">replica</a>.<a href="KafkaController.scala.html#kafka.controller;PartitionAndReplica.partition" title="=&gt; Int">partition</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#kafka.controller;ControllerBrokerRequestBatch.controllerId" title="=&gt; Int">controllerId</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.controllerEpoch" title="Int">controllerEpoch</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.correlationId" title="Int">correlationId</a><span class="delimiter">)</span>
        <a href="#kafka.controller;ControllerBrokerRequestBatch.controller" title="kafka.controller.KafkaController">controller</a>.<a href="KafkaController.scala.html#kafka.controller;KafkaController.sendRequest" title="(brokerId: Int, request: kafka.api.RequestOrResponse, callback: kafka.api.RequestOrResponse =&gt; Unit)Unit">sendRequest</a><span class="delimiter">(</span><span title="Int">broker</span>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.$anonfun.stopReplicaRequest" title="kafka.api.StopReplicaRequest">stopReplicaRequest</a>, <a href="#kafka.controller;ControllerBrokerRequestBatch.sendRequestsToBrokers.$anonfun.$anonfun.r" title="kafka.controller.StopReplicaRequestInfo">r</a>.<a href="#kafka.controller.StopReplicaRequestInfo.<init>$default$3" title="=&gt; kafka.api.RequestOrResponse =&gt; Unit">callback</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#kafka.controller;ControllerBrokerRequestBatch.stopReplicaRequestMap" title="=&gt; scala.collection.mutable.HashMap[Int,Seq[kafka.controller.StopReplicaRequestInfo]]">stopReplicaRequestMap</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

case class <a title="class ControllerBrokerStateInfo extends AnyRef with Product with Serializable" id="kafka.controller.ControllerBrokerStateInfo.readResolve">ControllerBrokerStateInfo</a><a href="#kafka.controller.ControllerBrokerStateInfo.readResolve" title="Product" class="delimiter">(</a><a title="kafka.network.BlockingChannel" id="kafka.controller;ControllerBrokerStateInfo.channel">channel</a>: <a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel" title="kafka.network.BlockingChannel">BlockingChannel</a>,
                                     <a title="kafka.cluster.Broker" id="kafka.controller;ControllerBrokerStateInfo.broker">broker</a>: <a href="../cluster/Broker.scala.html#kafka.cluster;Broker" title="kafka.cluster.Broker">Broker</a>,
                                     <a title="java.util.concurrent.BlockingQueue[(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)]" id="kafka.controller;ControllerBrokerStateInfo.messageQueue">messageQueue</a>: <span title="java.util.concurrent.BlockingQueue[(kafka.api.RequestOrResponse, kafka.api.RequestOrResponse =&gt; Unit)]">BlockingQueue</span><span class="delimiter">[</span><span class="delimiter">(</span>RequestOrResponse, <span class="delimiter">(</span>RequestOrResponse<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span><span class="delimiter">]</span>,
                                     <a title="kafka.controller.RequestSendThread" id="kafka.controller;ControllerBrokerStateInfo.requestSendThread">requestSendThread</a>: <a href="#kafka.controller;RequestSendThread" title="kafka.controller.RequestSendThread">RequestSendThread</a><span class="delimiter">)</span>

case class <a title="class StopReplicaRequestInfo extends AnyRef with Product with Serializable" id="kafka.controller.StopReplicaRequestInfo.readResolve">StopReplicaRequestInfo</a><a href="#kafka.controller.StopReplicaRequestInfo.readResolve" title="Product" class="delimiter">(</a><a title="kafka.controller.PartitionAndReplica" id="kafka.controller;StopReplicaRequestInfo.replica">replica</a>: <a href="KafkaController.scala.html#kafka.controller;PartitionAndReplica" title="kafka.controller.PartitionAndReplica">PartitionAndReplica</a>, <a title="Boolean" id="kafka.controller;StopReplicaRequestInfo.deletePartition">deletePartition</a>: <span title="Boolean">Boolean</span>, <a title="kafka.api.RequestOrResponse =&gt; Unit" id="kafka.controller.StopReplicaRequestInfo.<init>$default$3">callback</a>: <span class="delimiter">(</span>RequestOrResponse<span class="delimiter">)</span> =&gt; Unit = null<span class="delimiter">)</span>

class <a title="class Callbacks extends AnyRef" id="kafka.controller;Callbacks">Callbacks</a> private <span class="delimiter">(</span>var <a title="kafka.api.RequestOrResponse =&gt; Unit" id="kafka.controller.Callbacks.<init>$default$1">leaderAndIsrResponseCallback</a>:<span class="delimiter">(</span>RequestOrResponse<span class="delimiter">)</span> =&gt; Unit = null,
                         var <a title="kafka.api.RequestOrResponse =&gt; Unit" id="kafka.controller.Callbacks.<init>$default$2">updateMetadataResponseCallback</a>:<span class="delimiter">(</span>RequestOrResponse<span class="delimiter">)</span> =&gt; Unit = null,
                         var <a title="(kafka.api.RequestOrResponse, Int) =&gt; Unit" id="kafka.controller.Callbacks.<init>$default$3">stopReplicaResponseCallback</a>:<span class="delimiter">(</span>RequestOrResponse, Int<span class="delimiter">)</span> =&gt; Unit = null<span class="delimiter">)</span>

object <a title="kafka.controller.Callbacks.type" id="kafka.controller.Callbacks">Callbacks</a> <a href="#kafka.controller.Callbacks" title="kafka.controller.Callbacks.type" class="delimiter">{</a>
  class <a title="class CallbackBuilder extends AnyRef" id="kafka.controller.Callbacks;CallbackBuilder">CallbackBuilder</a> <a href="#kafka.controller.Callbacks;CallbackBuilder" title="kafka.controller.Callbacks.CallbackBuilder" class="delimiter">{</a>
    var <a title="kafka.api.RequestOrResponse =&gt; Unit" id="kafka.controller.Callbacks;CallbackBuilder.leaderAndIsrResponseCbk_=">leaderAndIsrResponseCbk</a>:<span class="delimiter">(</span>RequestOrResponse<span class="delimiter">)</span> =&gt; Unit = null
    var <a title="kafka.api.RequestOrResponse =&gt; Unit" id="kafka.controller.Callbacks;CallbackBuilder.updateMetadataResponseCbk_=">updateMetadataResponseCbk</a>:<span class="delimiter">(</span>RequestOrResponse<span class="delimiter">)</span> =&gt; Unit = null
    var <a title="(kafka.api.RequestOrResponse, Int) =&gt; Unit" id="kafka.controller.Callbacks;CallbackBuilder.stopReplicaResponseCbk_=">stopReplicaResponseCbk</a>:<span class="delimiter">(</span>RequestOrResponse, Int<span class="delimiter">)</span> =&gt; Unit = null

    def <a title="(cbk: kafka.api.RequestOrResponse =&gt; Unit)kafka.controller.Callbacks.CallbackBuilder" id="kafka.controller.Callbacks;CallbackBuilder.leaderAndIsrCallback">leaderAndIsrCallback</a><span class="delimiter">(</span><a title="kafka.api.RequestOrResponse =&gt; Unit" id="kafka.controller.Callbacks;CallbackBuilder.leaderAndIsrCallback.cbk">cbk</a>: <span class="delimiter">(</span>RequestOrResponse<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span>: <a href="#kafka.controller.Callbacks;CallbackBuilder" title="kafka.controller.Callbacks.CallbackBuilder">CallbackBuilder</a> = <span class="delimiter">{</span>
      <a href="#kafka.controller.Callbacks;CallbackBuilder.leaderAndIsrResponseCbk_=" title="(x$1: kafka.api.RequestOrResponse =&gt; Unit)Unit">leaderAndIsrResponseCbk</a> = <a href="#kafka.controller.Callbacks;CallbackBuilder.leaderAndIsrCallback.cbk" title="kafka.api.RequestOrResponse =&gt; Unit">cbk</a>
      this
    <span class="delimiter">}</span>

    def <a title="(cbk: kafka.api.RequestOrResponse =&gt; Unit)kafka.controller.Callbacks.CallbackBuilder" id="kafka.controller.Callbacks;CallbackBuilder.updateMetadataCallback">updateMetadataCallback</a><span class="delimiter">(</span><a title="kafka.api.RequestOrResponse =&gt; Unit" id="kafka.controller.Callbacks;CallbackBuilder.updateMetadataCallback.cbk">cbk</a>: <span class="delimiter">(</span>RequestOrResponse<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span>: <a href="#kafka.controller.Callbacks;CallbackBuilder" title="kafka.controller.Callbacks.CallbackBuilder">CallbackBuilder</a> = <span class="delimiter">{</span>
      <a href="#kafka.controller.Callbacks;CallbackBuilder.updateMetadataResponseCbk_=" title="(x$1: kafka.api.RequestOrResponse =&gt; Unit)Unit">updateMetadataResponseCbk</a> = <a href="#kafka.controller.Callbacks;CallbackBuilder.updateMetadataCallback.cbk" title="kafka.api.RequestOrResponse =&gt; Unit">cbk</a>
      this
    <span class="delimiter">}</span>

    def <a title="(cbk: (kafka.api.RequestOrResponse, Int) =&gt; Unit)kafka.controller.Callbacks.CallbackBuilder" id="kafka.controller.Callbacks;CallbackBuilder.stopReplicaCallback">stopReplicaCallback</a><span class="delimiter">(</span><a title="(kafka.api.RequestOrResponse, Int) =&gt; Unit" id="kafka.controller.Callbacks;CallbackBuilder.stopReplicaCallback.cbk">cbk</a>: <span class="delimiter">(</span>RequestOrResponse, Int<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span>: <a href="#kafka.controller.Callbacks;CallbackBuilder" title="kafka.controller.Callbacks.CallbackBuilder">CallbackBuilder</a> = <span class="delimiter">{</span>
      <a href="#kafka.controller.Callbacks;CallbackBuilder.stopReplicaResponseCbk_=" title="(x$1: (kafka.api.RequestOrResponse, Int) =&gt; Unit)Unit">stopReplicaResponseCbk</a> = <a href="#kafka.controller.Callbacks;CallbackBuilder.stopReplicaCallback.cbk" title="(kafka.api.RequestOrResponse, Int) =&gt; Unit">cbk</a>
      this
    <span class="delimiter">}</span>

    def <a title="=&gt; kafka.controller.Callbacks" id="kafka.controller.Callbacks;CallbackBuilder.build">build</a>: <a href="#kafka.controller;Callbacks" title="kafka.controller.Callbacks">Callbacks</a> = <span class="delimiter">{</span>
      new <a href="#kafka.controller;Callbacks" title="kafka.controller.Callbacks">Callbacks</a><span class="delimiter">(</span><a href="#kafka.controller.Callbacks;CallbackBuilder.leaderAndIsrResponseCbk_=" title="=&gt; kafka.api.RequestOrResponse =&gt; Unit">leaderAndIsrResponseCbk</a>, <a href="#kafka.controller.Callbacks;CallbackBuilder.updateMetadataResponseCbk_=" title="=&gt; kafka.api.RequestOrResponse =&gt; Unit">updateMetadataResponseCbk</a>, <a href="#kafka.controller.Callbacks;CallbackBuilder.stopReplicaResponseCbk_=" title="=&gt; (kafka.api.RequestOrResponse, Int) =&gt; Unit">stopReplicaResponseCbk</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<a href="#kafka.controller.Callbacks;CallbackBuilder" title="AnyRef" class="delimiter">}</a>

        </pre>
    </body>
</html>
