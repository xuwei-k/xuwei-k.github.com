<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>kafka/kafka/consumer/ZookeeperConsumerConnector.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

package kafka.consumer

import java.net.InetAddress
import java.util.UUID
import java.util.concurrent._
import java.util.concurrent.atomic._
import java.util.concurrent.locks.ReentrantLock

import com.yammer.metrics.core.Gauge
import kafka.api._
import kafka.client.ClientUtils
import kafka.cluster._
import kafka.common._
import kafka.metrics._
import kafka.network.BlockingChannel
import kafka.serializer._
import kafka.utils.<a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.inLock
import kafka.utils.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>._
import kafka.utils._
import org.I0Itec.zkclient.exception.ZkNodeExistsException
import org.I0Itec.zkclient.<span class="delimiter">{</span>IZkChildListener, IZkDataListener, IZkStateListener, ZkClient<span class="delimiter">}</span>
import org.apache.zookeeper.<span title="org.apache.zookeeper.Watcher.type">Watcher</span>.<span title="org.apache.zookeeper.Watcher.Event.type">Event</span>.KeeperState

import scala.collection._


<span class="comment">/**
 * This class handles the consumers interaction with zookeeper
 *
 * Directories:
 * 1. Consumer id registry:
 * /consumers/[group_id]/ids[consumer_id] -&gt; topic1,...topicN
 * A consumer has a unique consumer id within a consumer group. A consumer registers its id as an ephemeral znode
 * and puts all topics that it subscribes to as the value of the znode. The znode is deleted when the client is gone.
 * A consumer subscribes to event changes of the consumer id registry within its group.
 *
 * The consumer id is picked up from configuration, instead of the sequential id assigned by ZK. Generated sequential
 * ids are hard to recover during temporary connection loss to ZK, since it's difficult for the client to figure out
 * whether the creation of a sequential znode has succeeded or not. More details can be found at
 * (http://wiki.apache.org/hadoop/ZooKeeper/ErrorHandling)
 *
 * 2. Broker node registry:
 * /brokers/[0...N] --&gt; { &quot;host&quot; : &quot;host:port&quot;,
 *                        &quot;topics&quot; : {&quot;topic1&quot;: [&quot;partition1&quot; ... &quot;partitionN&quot;], ...,
 *                                    &quot;topicN&quot;: [&quot;partition1&quot; ... &quot;partitionN&quot;] } }
 * This is a list of all present broker brokers. A unique logical node id is configured on each broker node. A broker
 * node registers itself on start-up and creates a znode with the logical node id under /brokers. The value of the znode
 * is a JSON String that contains (1) the host name and the port the broker is listening to, (2) a list of topics that
 * the broker serves, (3) a list of logical partitions assigned to each topic on the broker.
 * A consumer subscribes to event changes of the broker node registry.
 *
 * 3. Partition owner registry:
 * /consumers/[group_id]/owner/[topic]/[broker_id-partition_id] --&gt; consumer_node_id
 * This stores the mapping before broker partitions and consumers. Each partition is owned by a unique consumer
 * within a consumer group. The mapping is reestablished after each rebalancing.
 *
 * 4. Consumer offset tracking:
 * /consumers/[group_id]/offsets/[topic]/[broker_id-partition_id] --&gt; offset_counter_value
 * Each consumer tracks the offset of the latest message consumed for each partition.
 *
 */</span>
private<span class="delimiter">[</span>kafka<span class="delimiter">]</span> object <a title="kafka.consumer.ZookeeperConsumerConnector.type" id="kafka.consumer.ZookeeperConsumerConnector">ZookeeperConsumerConnector</a> <a href="#kafka.consumer.ZookeeperConsumerConnector" title="kafka.consumer.ZookeeperConsumerConnector.type" class="delimiter">{</a>
  val <a title="kafka.consumer.FetchedDataChunk" id="kafka.consumer.ZookeeperConsumerConnector.shutdownCommand">shutdownCommand</a>: <a href="FetchedDataChunk.scala.html#kafka.consumer;FetchedDataChunk" title="kafka.consumer.FetchedDataChunk">FetchedDataChunk</a> = new <a href="FetchedDataChunk.scala.html#kafka.consumer;FetchedDataChunk" title="kafka.consumer.FetchedDataChunk">FetchedDataChunk</a><span class="delimiter">(</span>null, null, -<span title="Long(-1L)" class="long">1L</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

private<span class="delimiter">[</span>kafka<span class="delimiter">]</span> class <a title="class ZookeeperConsumerConnector extends AnyRef with kafka.consumer.ConsumerConnector with kafka.utils.Logging with kafka.metrics.KafkaMetricsGroup" id="kafka.consumer;ZookeeperConsumerConnector">ZookeeperConsumerConnector</a><a href="#kafka.consumer;ZookeeperConsumerConnector" title="kafka.consumer.ZookeeperConsumerConnector" class="delimiter">(</a>val <a title="kafka.consumer.ConsumerConfig" id="kafka.consumer;ZookeeperConsumerConnector.config">config</a>: <a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig" title="kafka.consumer.ConsumerConfig">ConsumerConfig</a>,
                                                val <a title="Boolean" id="kafka.consumer;ZookeeperConsumerConnector.enableFetcher">enableFetcher</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="comment">// for testing only</span>
        extends <a href="ConsumerConnector.scala.html#kafka.consumer;ConsumerConnector" title="kafka.consumer.ConsumerConnector">ConsumerConnector</a> with <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> with <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup" title="kafka.metrics.KafkaMetricsGroup">KafkaMetricsGroup</a> <span class="delimiter">{</span>

  private val <a title="java.util.concurrent.atomic.AtomicBoolean" id="kafka.consumer;ZookeeperConsumerConnector.isShuttingDown">isShuttingDown</a> = new <span title="java.util.concurrent.atomic.AtomicBoolean">AtomicBoolean</span><span class="delimiter">(</span>false<span class="delimiter">)</span>
  private val <a title="Object" id="kafka.consumer;ZookeeperConsumerConnector.rebalanceLock">rebalanceLock</a> = new <span title="Object">Object</span>
  private var <a title="Option[kafka.consumer.ConsumerFetcherManager]" id="kafka.consumer;ZookeeperConsumerConnector.fetcher_=">fetcher</a>: <span title="Option[kafka.consumer.ConsumerFetcherManager]">Option</span><span class="delimiter">[</span>ConsumerFetcherManager<span class="delimiter">]</span> = <span title="None.type">None</span>
  private var <a title="org.I0Itec.zkclient.ZkClient" id="kafka.consumer;ZookeeperConsumerConnector.zkClient_=">zkClient</a>: <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span> = null
  private var <a title="kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]" id="kafka.consumer;ZookeeperConsumerConnector.topicRegistry_=">topicRegistry</a> = new <a href="../utils/Pool.scala.html#kafka.utils;Pool" title="kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">Pool</a><span class="delimiter">[</span>String, Pool<span class="delimiter">[</span>Int, PartitionTopicInfo<span class="delimiter">]</span><span class="delimiter">]</span>
  private val <a title="kafka.utils.Pool[kafka.common.TopicAndPartition,Long]" id="kafka.consumer;ZookeeperConsumerConnector.checkpointedZkOffsets">checkpointedZkOffsets</a> = new <a href="../utils/Pool.scala.html#kafka.utils;Pool" title="kafka.utils.Pool[kafka.common.TopicAndPartition,Long]">Pool</a><span class="delimiter">[</span>TopicAndPartition, Long<span class="delimiter">]</span>
  private val <a title="kafka.utils.Pool[(String, kafka.consumer.ConsumerThreadId),java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]" id="kafka.consumer;ZookeeperConsumerConnector.topicThreadIdAndQueues">topicThreadIdAndQueues</a> = new <a href="../utils/Pool.scala.html#kafka.utils;Pool" title="kafka.utils.Pool[(String, kafka.consumer.ConsumerThreadId),java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]">Pool</a><span class="delimiter">[</span><span class="delimiter">(</span>String, ConsumerThreadId<span class="delimiter">)</span>, BlockingQueue<span class="delimiter">[</span>FetchedDataChunk<span class="delimiter">]</span><span class="delimiter">]</span>
  private val <a title="kafka.utils.KafkaScheduler" id="kafka.consumer;ZookeeperConsumerConnector.scheduler">scheduler</a> = new <a href="../utils/KafkaScheduler.scala.html#kafka.utils;KafkaScheduler" title="kafka.utils.KafkaScheduler">KafkaScheduler</a><span class="delimiter">(</span>threads = <span title="Int(1)" class="int">1</span>, threadNamePrefix = <span title="String(&quot;kafka-consumer-scheduler-&quot;)" class="string">&quot;kafka-consumer-scheduler-&quot;</span><span class="delimiter">)</span>
  private val <a title="java.util.concurrent.atomic.AtomicBoolean" id="kafka.consumer;ZookeeperConsumerConnector.messageStreamCreated">messageStreamCreated</a> = new <span title="java.util.concurrent.atomic.AtomicBoolean">AtomicBoolean</span><span class="delimiter">(</span>false<span class="delimiter">)</span>

  private var <a title="ZookeeperConsumerConnector.this.ZKSessionExpireListener" id="kafka.consumer;ZookeeperConsumerConnector.sessionExpirationListener_=">sessionExpirationListener</a>: <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener" title="ZookeeperConsumerConnector.this.ZKSessionExpireListener">ZKSessionExpireListener</a> = null
  private var <a title="ZookeeperConsumerConnector.this.ZKTopicPartitionChangeListener" id="kafka.consumer;ZookeeperConsumerConnector.topicPartitionChangeListener_=">topicPartitionChangeListener</a>: <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener" title="ZookeeperConsumerConnector.this.ZKTopicPartitionChangeListener">ZKTopicPartitionChangeListener</a> = null
  private var <a title="ZookeeperConsumerConnector.this.ZKRebalancerListener" id="kafka.consumer;ZookeeperConsumerConnector.loadBalancerListener_=">loadBalancerListener</a>: <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener" title="ZookeeperConsumerConnector.this.ZKRebalancerListener">ZKRebalancerListener</a> = null

  private var <a title="kafka.network.BlockingChannel" id="kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=">offsetsChannel</a>: <a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel" title="kafka.network.BlockingChannel">BlockingChannel</a> = null
  private val <a title="Object" id="kafka.consumer;ZookeeperConsumerConnector.offsetsChannelLock">offsetsChannelLock</a> = new <span title="Object">Object</span>

  private var <a title="kafka.consumer.ZookeeperTopicEventWatcher" id="kafka.consumer;ZookeeperConsumerConnector.wildcardTopicWatcher_=">wildcardTopicWatcher</a>: <a href="ZookeeperTopicEventWatcher.scala.html#kafka.consumer;ZookeeperTopicEventWatcher" title="kafka.consumer.ZookeeperTopicEventWatcher">ZookeeperTopicEventWatcher</a> = null

  <span class="comment">// useful for tracking migration of consumers to store offsets in kafka</span>
  private val <a title="com.yammer.metrics.core.Meter" id="kafka.consumer;ZookeeperConsumerConnector.kafkaCommitMeter">kafkaCommitMeter</a> = <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newMeter" title="(name: String, eventType: String, timeUnit: java.util.concurrent.TimeUnit, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Meter">newMeter</a><span class="delimiter">(</span><span title="String(&quot;KafkaCommitsPerSec&quot;)" class="string">&quot;KafkaCommitsPerSec&quot;</span>, <span title="String(&quot;commits&quot;)" class="string">&quot;commits&quot;</span>, TimeUnit.<span title="java.util.concurrent.TimeUnit(SECONDS)">SECONDS</span>, <span title="(elems: (String, String)*)scala.collection.Map[String,String]">Map</span><span class="delimiter">(</span><span title="(self: String)ArrowAssoc[String]" class="string">&quot;clientId&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.clientId" title="=&gt; String">clientId</a><span class="delimiter">)</span><span class="delimiter">)</span>
  private val <a title="com.yammer.metrics.core.Meter" id="kafka.consumer;ZookeeperConsumerConnector.zkCommitMeter">zkCommitMeter</a> = <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newMeter" title="(name: String, eventType: String, timeUnit: java.util.concurrent.TimeUnit, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Meter">newMeter</a><span class="delimiter">(</span><span title="String(&quot;ZooKeeperCommitsPerSec&quot;)" class="string">&quot;ZooKeeperCommitsPerSec&quot;</span>, <span title="String(&quot;commits&quot;)" class="string">&quot;commits&quot;</span>, TimeUnit.<span title="java.util.concurrent.TimeUnit(SECONDS)">SECONDS</span>, <span title="(elems: (String, String)*)scala.collection.Map[String,String]">Map</span><span class="delimiter">(</span><span title="(self: String)ArrowAssoc[String]" class="string">&quot;clientId&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.clientId" title="=&gt; String">clientId</a><span class="delimiter">)</span><span class="delimiter">)</span>
  private val <a title="kafka.metrics.KafkaTimer" id="kafka.consumer;ZookeeperConsumerConnector.rebalanceTimer">rebalanceTimer</a> = new <a href="../metrics/KafkaTimer.scala.html#kafka.metrics;KafkaTimer" title="kafka.metrics.KafkaTimer">KafkaTimer</a><span class="delimiter">(</span><a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newTimer" title="(name: String, durationUnit: java.util.concurrent.TimeUnit, rateUnit: java.util.concurrent.TimeUnit, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Timer">newTimer</a><span class="delimiter">(</span><span title="String(&quot;RebalanceRateAndTime&quot;)" class="string">&quot;RebalanceRateAndTime&quot;</span>, TimeUnit.<span title="java.util.concurrent.TimeUnit(MILLISECONDS)">MILLISECONDS</span>, TimeUnit.<span title="java.util.concurrent.TimeUnit(SECONDS)">SECONDS</span>, <span title="(elems: (String, String)*)scala.collection.Map[String,String]">Map</span><span class="delimiter">(</span><span title="(self: String)ArrowAssoc[String]" class="string">&quot;clientId&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.clientId" title="=&gt; String">clientId</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

  val <a title="String" id="kafka.consumer;ZookeeperConsumerConnector.consumerIdString">consumerIdString</a> = <span class="delimiter">{</span>
    var <a title="String" id="kafka.consumer;ZookeeperConsumerConnector.consumerIdString.consumerUuid">consumerUuid</a> : <span title="String">String</span> = null
    <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.consumerId" title="=&gt; Option[String]">consumerId</a> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="String" id="kafka.consumer;ZookeeperConsumerConnector.consumerIdString.consumerId">consumerId</a><span class="delimiter">)</span> <span class="comment">// for testing only</span>
      =&gt; <a href="#kafka.consumer;ZookeeperConsumerConnector.consumerIdString.consumerUuid" title="String">consumerUuid</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.consumerIdString.consumerId" title="String">consumerId</a>
      case <span title="None.type">None</span> <span class="comment">// generate unique consumerId automatically</span>
      =&gt; val <a title="java.util.UUID" id="kafka.consumer;ZookeeperConsumerConnector.consumerIdString.uuid">uuid</a> = <span title="java.util.UUID.type">UUID</span>.<span title="()java.util.UUID">randomUUID</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.consumerIdString.consumerUuid" title="String">consumerUuid</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%s-%d-%s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span>
        <span title="java.net.InetAddress.type">InetAddress</span>.<span title="()java.net.InetAddress">getLocalHost</span>.<span title="()String">getHostName</span>, <span title="System.type">System</span>.<span title="()Long">currentTimeMillis</span>,
        <a href="#kafka.consumer;ZookeeperConsumerConnector.consumerIdString.uuid" title="java.util.UUID">uuid</a>.<span title="()Long">getMostSignificantBits</span><span title="implicit scala.LowPriorityImplicits.longWrapper : (x: Long)scala.runtime.RichLong" class="delimiter">(</span><span class="delimiter">)</span>.<span title="=&gt; String">toHexString</span>.<span title="(x$1: Int, x$2: Int)String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>,<span title="Int(8)" class="int">8</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.groupId" title="=&gt; String">groupId</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;_&quot;)" class="string">&quot;_&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.consumerIdString.consumerUuid" title="String">consumerUuid</a>
  <span class="delimiter">}</span>
  this.<a href="../utils/Logging.scala.html#kafka.utils;Logging.logIdent_=" title="(x$1: String)Unit">logIdent</a> = <span title="String(&quot;[&quot;)" class="string">&quot;[&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.consumerIdString" title="=&gt; String">consumerIdString</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;], &quot;)" class="string">&quot;], &quot;</span>

  <a href="#kafka.consumer;ZookeeperConsumerConnector.connectZk" title="()Unit">connectZk</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <a href="#kafka.consumer;ZookeeperConsumerConnector.createFetcher" title="()Unit">createFetcher</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <a href="#kafka.consumer;ZookeeperConsumerConnector.ensureOffsetManagerConnected" title="()Unit">ensureOffsetManagerConnected</a><span class="delimiter">(</span><span class="delimiter">)</span>

  if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.autoCommitEnable" title="=&gt; Boolean">autoCommitEnable</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.scheduler" title="=&gt; kafka.utils.KafkaScheduler">scheduler</a>.<a href="../utils/KafkaScheduler.scala.html#kafka.utils;KafkaScheduler.startup" title="()Unit">startup</a>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;starting auto committer every &quot;)" class="string">&quot;starting auto committer every &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.autoCommitIntervalMs" title="=&gt; Int">autoCommitIntervalMs</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; ms&quot;)" class="string">&quot; ms&quot;</span><span class="delimiter">)</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.scheduler" title="=&gt; kafka.utils.KafkaScheduler">scheduler</a>.<a href="../utils/KafkaScheduler.scala.html#kafka.utils;KafkaScheduler.schedule" title="(name: String, fun: () =&gt; Unit, delay: Long, period: Long, unit: java.util.concurrent.TimeUnit)Unit">schedule</a><span class="delimiter">(</span><span title="String(&quot;kafka-consumer-autocommit&quot;)" class="string">&quot;kafka-consumer-autocommit&quot;</span>,
                       <a href="#kafka.consumer;ZookeeperConsumerConnector.autoCommit" title="()Unit">autoCommit</a>,
                       delay = <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.autoCommitIntervalMs" title="=&gt; Long">autoCommitIntervalMs</a>,
                       period = <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.autoCommitIntervalMs" title="=&gt; Long">autoCommitIntervalMs</a>,
                       unit = TimeUnit.<span title="java.util.concurrent.TimeUnit(MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <a href="../metrics/KafkaMetricsReporter.scala.html#kafka.metrics.KafkaMetricsReporter" title="kafka.metrics.KafkaMetricsReporter.type">KafkaMetricsReporter</a>.<a href="../metrics/KafkaMetricsReporter.scala.html#kafka.metrics.KafkaMetricsReporter.startReporters" title="(verifiableProps: kafka.utils.VerifiableProperties)Unit">startReporters</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.props" title="=&gt; kafka.utils.VerifiableProperties">props</a><span class="delimiter">)</span>
  <a href="../common/AppInfo.scala.html#kafka.common.AppInfo" title="kafka.common.AppInfo.type">AppInfo</a>.<a href="../common/AppInfo.scala.html#kafka.common.AppInfo.registerInfo" title="()Unit">registerInfo</a><span class="delimiter">(</span><span class="delimiter">)</span>

  def this<span class="delimiter">(</span><a title="kafka.consumer.ConsumerConfig" id="kafka.consumer;ZookeeperConsumerConnector.<init>(d2b1672736).config">config</a>: <a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig" title="kafka.consumer.ConsumerConfig">ConsumerConfig</a><span class="delimiter">)</span> = this<span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.<init>(d2b1672736).config" title="kafka.consumer.ConsumerConfig">config</a>, true<span class="delimiter">)</span>

  def <a title="(topicCountMap: scala.collection.Map[String,Int])scala.collection.Map[String,List[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]]]" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreams(335be28082)">createMessageStreams</a><span class="delimiter">(</span><a title="scala.collection.Map[String,Int]" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreams(335be28082).topicCountMap">topicCountMap</a>: <span title="scala.collection.Map[String,Int]">Map</span><span class="delimiter">[</span>String,Int<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]]]">Map</span><span class="delimiter">[</span>String, List<span class="delimiter">[</span>KafkaStream<span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>,Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span> =
    <a href="#kafka.consumer;ZookeeperConsumerConnector.createMessageStreams(f5ab801b11)" title="(topicCountMap: scala.collection.Map[String,Int], keyDecoder: kafka.serializer.Decoder[Array[Byte]], valueDecoder: kafka.serializer.Decoder[Array[Byte]])scala.collection.Map[String,List[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]]]">createMessageStreams</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.createMessageStreams(335be28082).topicCountMap" title="scala.collection.Map[String,Int]">topicCountMap</a>, new <a href="../serializer/Decoder.scala.html#kafka.serializer;DefaultDecoder" title="kafka.serializer.DefaultDecoder">DefaultDecoder</a><span class="delimiter">(</span><span class="delimiter">)</span>, new <a href="../serializer/Decoder.scala.html#kafka.serializer;DefaultDecoder" title="kafka.serializer.DefaultDecoder">DefaultDecoder</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

  def <a title="[K, V](topicCountMap: scala.collection.Map[String,Int], keyDecoder: kafka.serializer.Decoder[K], valueDecoder: kafka.serializer.Decoder[V])scala.collection.Map[String,List[kafka.consumer.KafkaStream[K,V]]]" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreams(f5ab801b11)">createMessageStreams</a><span class="delimiter">[</span><a title="" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreams(f5ab801b11);K">K</a>,<a title="" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreams(f5ab801b11);V">V</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.collection.Map[String,Int]" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreams(f5ab801b11).topicCountMap">topicCountMap</a>: <span title="scala.collection.Map[String,Int]">Map</span><span class="delimiter">[</span>String,Int<span class="delimiter">]</span>, <a title="kafka.serializer.Decoder[K]" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreams(f5ab801b11).keyDecoder">keyDecoder</a>: <a href="../serializer/Decoder.scala.html#kafka.serializer;Decoder" title="kafka.serializer.Decoder[K]">Decoder</a><span class="delimiter">[</span>K<span class="delimiter">]</span>, <a title="kafka.serializer.Decoder[V]" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreams(f5ab801b11).valueDecoder">valueDecoder</a>: <a href="../serializer/Decoder.scala.html#kafka.serializer;Decoder" title="kafka.serializer.Decoder[V]">Decoder</a><span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">)</span>
      : <span title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[K,V]]]">Map</span><span class="delimiter">[</span>String, List<span class="delimiter">[</span>KafkaStream<span class="delimiter">[</span>K,V<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.messageStreamCreated" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">messageStreamCreated</a>.<span title="(x$1: Boolean)Boolean">getAndSet</span><span class="delimiter">(</span>true<span class="delimiter">)</span><span class="delimiter">)</span>
      throw new <a href="../common/MessageStreamsExistException.scala.html#kafka.common;MessageStreamsExistException" title="kafka.common.MessageStreamsExistException">MessageStreamsExistException</a><span class="delimiter">(</span>this.<span title="()Class[_]">getClass</span>.<span title="()String">getSimpleName</span> <span title="(x$1: Any)String">+</span>
                                   <span title="String(&quot; can create message streams at most once&quot;)" class="string">&quot; can create message streams at most once&quot;</span>,null<span class="delimiter">)</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.consume" title="(topicCountMap: scala.collection.Map[String,Int], keyDecoder: kafka.serializer.Decoder[K], valueDecoder: kafka.serializer.Decoder[V])scala.collection.Map[String,List[kafka.consumer.KafkaStream[K,V]]]">consume</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.createMessageStreams(f5ab801b11).topicCountMap" title="scala.collection.Map[String,Int]">topicCountMap</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.createMessageStreams(f5ab801b11).keyDecoder" title="kafka.serializer.Decoder[K]">keyDecoder</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.createMessageStreams(f5ab801b11).valueDecoder" title="kafka.serializer.Decoder[V]">valueDecoder</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="[K, V](topicFilter: kafka.consumer.TopicFilter, numStreams: Int, keyDecoder: kafka.serializer.Decoder[K], valueDecoder: kafka.serializer.Decoder[V])Seq[kafka.consumer.KafkaStream[K,V]]" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreamsByFilter">createMessageStreamsByFilter</a><span class="delimiter">[</span><a title="" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreamsByFilter$default$4;K">K</a>,<a title="" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreamsByFilter$default$4;V">V</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="kafka.consumer.TopicFilter" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreamsByFilter.topicFilter">topicFilter</a>: <a href="TopicFilter.scala.html#kafka.consumer;TopicFilter" title="kafka.consumer.TopicFilter">TopicFilter</a>,
                                        <a title="Int" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreamsByFilter.numStreams">numStreams</a>: <span title="Int">Int</span>,
                                        <a title="kafka.serializer.Decoder[K]" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreamsByFilter$default$3">keyDecoder</a>: <a href="../serializer/Decoder.scala.html#kafka.serializer;Decoder" title="kafka.serializer.Decoder[K]">Decoder</a><span class="delimiter">[</span>K<span class="delimiter">]</span> = new <a href="../serializer/Decoder.scala.html#kafka.serializer;DefaultDecoder" title="kafka.serializer.DefaultDecoder">DefaultDecoder</a><span class="delimiter">(</span><span class="delimiter">)</span>,
                                        <a title="kafka.serializer.Decoder[V]" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreamsByFilter$default$4">valueDecoder</a>: <a href="../serializer/Decoder.scala.html#kafka.serializer;Decoder" title="kafka.serializer.Decoder[V]">Decoder</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = new <a href="../serializer/Decoder.scala.html#kafka.serializer;DefaultDecoder" title="kafka.serializer.DefaultDecoder">DefaultDecoder</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    val <a title="ZookeeperConsumerConnector.this.WildcardStreamsHandler[K,V]" id="kafka.consumer;ZookeeperConsumerConnector.createMessageStreamsByFilter.wildcardStreamsHandler">wildcardStreamsHandler</a> = new <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler" title="ZookeeperConsumerConnector.this.WildcardStreamsHandler[K,V]">WildcardStreamsHandler</a><span class="delimiter">[</span>K,V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.createMessageStreamsByFilter.topicFilter" title="kafka.consumer.TopicFilter">topicFilter</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.createMessageStreamsByFilter.numStreams" title="Int">numStreams</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.createMessageStreamsByFilter$default$3" title="kafka.serializer.Decoder[K]">keyDecoder</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.createMessageStreamsByFilter$default$4" title="kafka.serializer.Decoder[V]">valueDecoder</a><span class="delimiter">)</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.createMessageStreamsByFilter.wildcardStreamsHandler" title="ZookeeperConsumerConnector.this.WildcardStreamsHandler[K,V]">wildcardStreamsHandler</a>.<a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.streams" title="=&gt; Seq[kafka.consumer.KafkaStream[K,V]]">streams</a>
  <span class="delimiter">}</span>

  private def <a title="()Unit" id="kafka.consumer;ZookeeperConsumerConnector.createFetcher">createFetcher</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.enableFetcher" title="=&gt; Boolean">enableFetcher</a><span class="delimiter">)</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.fetcher_=" title="(x$1: Option[kafka.consumer.ConsumerFetcherManager])Unit">fetcher</a> = <span title="(x: kafka.consumer.ConsumerFetcherManager)Some[kafka.consumer.ConsumerFetcherManager]">Some</span><span class="delimiter">(</span>new <a href="ConsumerFetcherManager.scala.html#kafka.consumer;ConsumerFetcherManager" title="kafka.consumer.ConsumerFetcherManager">ConsumerFetcherManager</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.consumerIdString" title="=&gt; String">consumerIdString</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private def <a title="()Unit" id="kafka.consumer;ZookeeperConsumerConnector.connectZk">connectZk</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Connecting to zookeeper instance at &quot;)" class="string">&quot;Connecting to zookeeper instance at &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkConnect" title="=&gt; String">zkConnect</a><span class="delimiter">)</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="(x$1: org.I0Itec.zkclient.ZkClient)Unit">zkClient</a> = new <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkConnect" title="=&gt; String">zkConnect</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkSessionTimeoutMs" title="=&gt; Int">zkSessionTimeoutMs</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkConnectionTimeoutMs" title="=&gt; Int">zkConnectionTimeoutMs</a>, <a href="../utils/ZkUtils.scala.html#kafka.utils.ZKStringSerializer" title="kafka.utils.ZKStringSerializer.type">ZKStringSerializer</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">// Blocks until the offset manager is located and a channel is established to it.</span>
  private def <a title="()Unit" id="kafka.consumer;ZookeeperConsumerConnector.ensureOffsetManagerConnected">ensureOffsetManagerConnected</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.offsetsStorage" title="=&gt; String">offsetsStorage</a> <span title="(x$1: Any)Boolean">==</span> <span title="String(&quot;kafka&quot;)" class="string">&quot;kafka&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a> <span title="(x$1: Any)Boolean">==</span> null <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.isConnected" title="=&gt; Boolean">isConnected</a><span class="delimiter">)</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="(x$1: kafka.network.BlockingChannel)Unit">offsetsChannel</a> = <a href="../client/ClientUtils.scala.html#kafka.client.ClientUtils" title="kafka.client.ClientUtils.type">ClientUtils</a>.<a href="../client/ClientUtils.scala.html#kafka.client.ClientUtils.channelToOffsetManager" title="(group: String, zkClient: org.I0Itec.zkclient.ZkClient, socketTimeoutMs: Int, retryBackOffMs: Int)kafka.network.BlockingChannel">channelToOffsetManager</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.groupId" title="=&gt; String">groupId</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.offsetsChannelSocketTimeoutMs" title="=&gt; Int">offsetsChannelSocketTimeoutMs</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.offsetsChannelBackoffMs" title="=&gt; Int">offsetsChannelBackoffMs</a><span class="delimiter">)</span>

      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Connected to offset manager %s:%d.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.host" title="=&gt; String">host</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.port" title="=&gt; Int">port</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="()Unit" id="kafka.consumer;ZookeeperConsumerConnector.shutdown">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    val <a title="Boolean" id="kafka.consumer;ZookeeperConsumerConnector.shutdown.canShutdown">canShutdown</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.isShuttingDown" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">isShuttingDown</a>.<span title="(x$1: Boolean, x$2: Boolean)Boolean">compareAndSet</span><span class="delimiter">(</span>false, true<span class="delimiter">)</span>
    if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.shutdown.canShutdown" title="Boolean">canShutdown</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;ZKConsumerConnector shutting down&quot;)" class="string">&quot;ZKConsumerConnector shutting down&quot;</span><span class="delimiter">)</span>
      val <a title="Long" id="kafka.consumer;ZookeeperConsumerConnector.shutdown.startTime">startTime</a> = <span title="System.type">System</span>.<span title="()Long">nanoTime</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics.KafkaMetricsGroup" title="kafka.metrics.KafkaMetricsGroup.type">KafkaMetricsGroup</a>.<a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics.KafkaMetricsGroup.removeAllConsumerMetrics" title="(clientId: String)Unit">removeAllConsumerMetrics</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.clientId" title="=&gt; String">clientId</a><span class="delimiter">)</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.rebalanceLock" title="=&gt; Object">rebalanceLock</a> <span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
        if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.wildcardTopicWatcher_=" title="=&gt; kafka.consumer.ZookeeperTopicEventWatcher">wildcardTopicWatcher</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
          <a href="#kafka.consumer;ZookeeperConsumerConnector.wildcardTopicWatcher_=" title="=&gt; kafka.consumer.ZookeeperTopicEventWatcher">wildcardTopicWatcher</a>.<a href="ZookeeperTopicEventWatcher.scala.html#kafka.consumer;ZookeeperTopicEventWatcher.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
        try <span class="delimiter">{</span>
          if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.autoCommitEnable" title="=&gt; Boolean">autoCommitEnable</a><span class="delimiter">)</span>
	        <a href="#kafka.consumer;ZookeeperConsumerConnector.scheduler" title="=&gt; kafka.utils.KafkaScheduler">scheduler</a>.<a href="../utils/KafkaScheduler.scala.html#kafka.utils;KafkaScheduler.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#kafka.consumer;ZookeeperConsumerConnector.fetcher_=" title="=&gt; Option[kafka.consumer.ConsumerFetcherManager]">fetcher</a> match <span class="delimiter">{</span>
            case Some<span class="delimiter">(</span><a title="kafka.consumer.ConsumerFetcherManager" id="kafka.consumer;ZookeeperConsumerConnector.shutdown.f">f</a><span class="delimiter">)</span> =&gt; <a href="#kafka.consumer;ZookeeperConsumerConnector.shutdown.f" title="kafka.consumer.ConsumerFetcherManager">f</a>.<a href="ConsumerFetcherManager.scala.html#kafka.consumer;ConsumerFetcherManager.stopConnections" title="()Unit">stopConnections</a>
            case <span title="None.type">None</span> =&gt;
          <span class="delimiter">}</span>
          <a href="#kafka.consumer;ZookeeperConsumerConnector.sendShutdownToAllQueues" title="()Unit">sendShutdownToAllQueues</a><span class="delimiter">(</span><span class="delimiter">)</span>
          if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.autoCommitEnable" title="=&gt; Boolean">autoCommitEnable</a><span class="delimiter">)</span>
            <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f)" title="(isAutoCommit: Boolean)Unit">commitOffsets</a><span class="delimiter">(</span>true<span class="delimiter">)</span>
          if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
            <a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="(x$1: org.I0Itec.zkclient.ZkClient)Unit">zkClient</a> = null
          <span class="delimiter">}</span>

          if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.disconnect" title="()Unit">disconnect</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> catch <span class="delimiter">{</span>
          case <a title="Throwable" id="kafka.consumer;ZookeeperConsumerConnector.shutdown.e">e</a>: <span title="Throwable">Throwable</span> =&gt;
            <a href="../utils/Logging.scala.html#kafka.utils;Logging.fatal(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">fatal</a><span class="delimiter">(</span><span title="String(&quot;error during consumer connector shutdown&quot;)" class="string">&quot;error during consumer connector shutdown&quot;</span>, <a href="#kafka.consumer;ZookeeperConsumerConnector.shutdown.e" title="Throwable">e</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;ZKConsumerConnector shutdown completed in &quot;)" class="string">&quot;ZKConsumerConnector shutdown completed in &quot;</span> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span><span title="System.type">System</span>.<span title="()Long">nanoTime</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Long)Long">-</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.shutdown.startTime" title="Long">startTime</a><span class="delimiter">)</span> <span title="(x: Int)Long">/</span> <span title="Int(1000000)" class="int">1000000</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; ms&quot;)" class="string">&quot; ms&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="[K, V](topicCountMap: scala.collection.Map[String,Int], keyDecoder: kafka.serializer.Decoder[K], valueDecoder: kafka.serializer.Decoder[V])scala.collection.Map[String,List[kafka.consumer.KafkaStream[K,V]]]" id="kafka.consumer;ZookeeperConsumerConnector.consume">consume</a><span class="delimiter">[</span><a title="" id="kafka.consumer;ZookeeperConsumerConnector.consume;K">K</a>, <a title="" id="kafka.consumer;ZookeeperConsumerConnector.consume;V">V</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.collection.Map[String,Int]" id="kafka.consumer;ZookeeperConsumerConnector.consume.topicCountMap">topicCountMap</a>: scala.collection.<span title="scala.collection.Map[String,Int]">Map</span><span class="delimiter">[</span>String,Int<span class="delimiter">]</span>, <a title="kafka.serializer.Decoder[K]" id="kafka.consumer;ZookeeperConsumerConnector.consume.keyDecoder">keyDecoder</a>: <a href="../serializer/Decoder.scala.html#kafka.serializer;Decoder" title="kafka.serializer.Decoder[K]">Decoder</a><span class="delimiter">[</span>K<span class="delimiter">]</span>, <a title="kafka.serializer.Decoder[V]" id="kafka.consumer;ZookeeperConsumerConnector.consume.valueDecoder">valueDecoder</a>: <a href="../serializer/Decoder.scala.html#kafka.serializer;Decoder" title="kafka.serializer.Decoder[V]">Decoder</a><span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">)</span>
      : <span title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[K,V]]]">Map</span><span class="delimiter">[</span>String,List<span class="delimiter">[</span>KafkaStream<span class="delimiter">[</span>K,V<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;entering consume &quot;)" class="string">&quot;entering consume &quot;</span><span class="delimiter">)</span>
    if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.consume.topicCountMap" title="scala.collection.Map[String,Int]">topicCountMap</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span>
      throw new <span title="RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="String(&quot;topicCountMap is null&quot;)" class="string">&quot;topicCountMap is null&quot;</span><span class="delimiter">)</span>

    val <a title="kafka.consumer.StaticTopicCount" id="kafka.consumer;ZookeeperConsumerConnector.consume.topicCount">topicCount</a> = <a href="TopicCount.scala.html#kafka.consumer.TopicCount" title="kafka.consumer.TopicCount.type">TopicCount</a>.<a href="TopicCount.scala.html#kafka.consumer.TopicCount.constructTopicCount(aa9cbb2f82)" title="(consumerIdString: String, topicCount: scala.collection.Map[String,Int])kafka.consumer.StaticTopicCount">constructTopicCount</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.consumerIdString" title="=&gt; String">consumerIdString</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.consume.topicCountMap" title="scala.collection.Map[String,Int]">topicCountMap</a><span class="delimiter">)</span>

    val <a title="scala.collection.mutable.HashMap[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]]" id="kafka.consumer;ZookeeperConsumerConnector.consume.topicThreadIds">topicThreadIds</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.consume.topicCount" title="kafka.consumer.StaticTopicCount">topicCount</a>.<a href="TopicCount.scala.html#kafka.consumer;StaticTopicCount.getConsumerThreadIdsPerTopic" title="=&gt; scala.collection.mutable.HashMap[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]]">getConsumerThreadIdsPerTopic</a>

    <span class="comment">// make a list of (queue,stream) pairs, one pair for each threadId</span>
    val <a title="List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]" id="kafka.consumer;ZookeeperConsumerConnector.consume.queuesAndStreams">queuesAndStreams</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.consume.topicThreadIds" title="scala.collection.mutable.HashMap[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]]">topicThreadIds</a>.<span title="=&gt; Iterable[scala.collection.Set[kafka.consumer.ConsumerThreadId]]">values</span>.<span title="(f: scala.collection.Set[kafka.consumer.ConsumerThreadId] =&gt; scala.collection.Set[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])])(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[scala.collection.Set[kafka.consumer.ConsumerThreadId]],scala.collection.Set[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])],Iterable[scala.collection.Set[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]]])Iterable[scala.collection.Set[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,scala.collection.Set[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])],Iterable[scala.collection.Set[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]]]" class="delimiter">(</span><a title="scala.collection.Set[kafka.consumer.ConsumerThreadId]" id="kafka.consumer;ZookeeperConsumerConnector.consume.queuesAndStreams.$anonfun.threadIdSet">threadIdSet</a> =&gt;
      <a href="#kafka.consumer;ZookeeperConsumerConnector.consume.queuesAndStreams.$anonfun.threadIdSet" title="scala.collection.Set[kafka.consumer.ConsumerThreadId]">threadIdSet</a>.<span title="(f: kafka.consumer.ConsumerThreadId =&gt; (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.Set[kafka.consumer.ConsumerThreadId],(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]),scala.collection.Set[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]])scala.collection.Set[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Set.Coll,(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]),scala.collection.Set[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]]" class="delimiter">(</span><a title="kafka.consumer.ConsumerThreadId" id="kafka.consumer;ZookeeperConsumerConnector.consume.queuesAndStreams.$anonfun.$anonfun.x$1">_</a> =&gt; <span class="delimiter">{</span>
        val <a title="java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk]" id="kafka.consumer;ZookeeperConsumerConnector.consume.queuesAndStreams.$anonfun.$anonfun.queue">queue</a> =  new <span title="java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk]">LinkedBlockingQueue</span><span class="delimiter">[</span>FetchedDataChunk<span class="delimiter">]</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.queuedMaxMessages" title="=&gt; Int">queuedMaxMessages</a><span class="delimiter">)</span>
        val <a title="kafka.consumer.KafkaStream[K,V]" id="kafka.consumer;ZookeeperConsumerConnector.consume.queuesAndStreams.$anonfun.$anonfun.stream">stream</a> = new <a href="KafkaStream.scala.html#kafka.consumer;KafkaStream" title="kafka.consumer.KafkaStream[K,V]">KafkaStream</a><span class="delimiter">[</span>K,V<span class="delimiter">]</span><span class="delimiter">(</span>
          <a href="#kafka.consumer;ZookeeperConsumerConnector.consume.queuesAndStreams.$anonfun.$anonfun.queue" title="java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk]">queue</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.consumerTimeoutMs" title="=&gt; Int">consumerTimeoutMs</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.consume.keyDecoder" title="kafka.serializer.Decoder[K]">keyDecoder</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.consume.valueDecoder" title="kafka.serializer.Decoder[V]">valueDecoder</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.clientId" title="=&gt; String">clientId</a><span class="delimiter">)</span>
        <span title="(_1: java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], _2: kafka.consumer.KafkaStream[K,V])(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.consume.queuesAndStreams.$anonfun.$anonfun.queue" title="java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk]">queue</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.consume.queuesAndStreams.$anonfun.$anonfun.stream" title="kafka.consumer.KafkaStream[K,V]">stream</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">)</span>.<span title="(implicit asTraversable: scala.collection.Set[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])] =&gt; scala.collection.GenTraversableOnce[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])])Iterable[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">flatten</span>.<span title="=&gt; List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">toList</span>

    val <a title="kafka.utils.ZKGroupDirs" id="kafka.consumer;ZookeeperConsumerConnector.consume.dirs">dirs</a> = new <a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupDirs" title="kafka.utils.ZKGroupDirs">ZKGroupDirs</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.groupId" title="=&gt; String">groupId</a><span class="delimiter">)</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK" title="(dirs: kafka.utils.ZKGroupDirs, consumerIdString: String, topicCount: kafka.consumer.TopicCount)Unit">registerConsumerInZK</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.consume.dirs" title="kafka.utils.ZKGroupDirs">dirs</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.consumerIdString" title="=&gt; String">consumerIdString</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.consume.topicCount" title="kafka.consumer.StaticTopicCount">topicCount</a><span class="delimiter">)</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer" title="(topicCount: kafka.consumer.TopicCount, queuesAndStreams: List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])])Unit">reinitializeConsumer</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.consume.topicCount" title="kafka.consumer.StaticTopicCount">topicCount</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.consume.queuesAndStreams" title="List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">queuesAndStreams</a><span class="delimiter">)</span>

    <a href="#kafka.consumer;ZookeeperConsumerConnector.loadBalancerListener_=" title="=&gt; ZookeeperConsumerConnector.this.ZKRebalancerListener">loadBalancerListener</a>.<a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.kafkaMessageAndMetadataStreams" title="=&gt; scala.collection.mutable.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">kafkaMessageAndMetadataStreams</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[K,V]]]" class="delimiter">[</span><span title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[K,V]]]">Map</span><span class="delimiter">[</span>String, List<span class="delimiter">[</span>KafkaStream<span class="delimiter">[</span>K,V<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="comment">// this API is used by unit tests only</span>
  def <a title="=&gt; kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]" id="kafka.consumer;ZookeeperConsumerConnector.getTopicRegistry">getTopicRegistry</a>: <a href="../utils/Pool.scala.html#kafka.utils;Pool" title="kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">Pool</a><span class="delimiter">[</span>String, Pool<span class="delimiter">[</span>Int, PartitionTopicInfo<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#kafka.consumer;ZookeeperConsumerConnector.topicRegistry_=" title="=&gt; kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">topicRegistry</a>

  private def <a title="(dirs: kafka.utils.ZKGroupDirs, consumerIdString: String, topicCount: kafka.consumer.TopicCount)Unit" id="kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK">registerConsumerInZK</a><span class="delimiter">(</span><a title="kafka.utils.ZKGroupDirs" id="kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.dirs">dirs</a>: <a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupDirs" title="kafka.utils.ZKGroupDirs">ZKGroupDirs</a>, <a title="String" id="kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.consumerIdString">consumerIdString</a>: <span title="String">String</span>, <a title="kafka.consumer.TopicCount" id="kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.topicCount">topicCount</a>: <a href="TopicCount.scala.html#kafka.consumer;TopicCount" title="kafka.consumer.TopicCount">TopicCount</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;begin registering consumer &quot;)" class="string">&quot;begin registering consumer &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.consumerIdString" title="String">consumerIdString</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; in ZK&quot;)" class="string">&quot; in ZK&quot;</span><span class="delimiter">)</span>
    val <a title="String" id="kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.timestamp">timestamp</a> = <a href="../utils/Time.scala.html#kafka.utils.SystemTime" title="kafka.utils.SystemTime.type">SystemTime</a>.<a href="../utils/Time.scala.html#kafka.utils.SystemTime.milliseconds" title="=&gt; Long">milliseconds</a>.<span title="()String">toString</span>
    val <a title="String" id="kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.consumerRegistrationInfo">consumerRegistrationInfo</a> = <a href="../utils/Json.scala.html#kafka.utils.Json" title="kafka.utils.Json.type">Json</a>.<a href="../utils/Json.scala.html#kafka.utils.Json.encode" title="(obj: Any)String">encode</a><span class="delimiter">(</span><span title="(elems: (String, Any)*)scala.collection.Map[String,Any]">Map</span><span class="delimiter">(</span><span title="(self: String)ArrowAssoc[String]" class="string">&quot;version&quot;</span> <span title="(y: Int)(String, Int)">-&gt;</span> <span title="Int(1)" class="int">1</span>, <span title="(self: String)ArrowAssoc[String]" class="string">&quot;subscription&quot;</span> <span title="(y: scala.collection.Map[String,Int])(String, scala.collection.Map[String,Int])">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.topicCount" title="kafka.consumer.TopicCount">topicCount</a>.<a href="TopicCount.scala.html#kafka.consumer;TopicCount.getTopicCountMap" title="=&gt; scala.collection.Map[String,Int]">getTopicCountMap</a>, <span title="(self: String)ArrowAssoc[String]" class="string">&quot;pattern&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.topicCount" title="kafka.consumer.TopicCount">topicCount</a>.<a href="TopicCount.scala.html#kafka.consumer;TopicCount.pattern" title="=&gt; String">pattern</a>,
                                                  <span title="(self: String)ArrowAssoc[String]" class="string">&quot;timestamp&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.timestamp" title="String">timestamp</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.createEphemeralPathExpectConflictHandleZKBug" title="(zkClient: org.I0Itec.zkclient.ZkClient, path: String, data: String, expectedCallerData: Any, checker: (String, Any) =&gt; Boolean, backoffTime: Int)Unit">createEphemeralPathExpectConflictHandleZKBug</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.dirs" title="kafka.utils.ZKGroupDirs">dirs</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupDirs.consumerRegistryDir" title="=&gt; String">consumerRegistryDir</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.consumerIdString" title="String">consumerIdString</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.consumerRegistrationInfo" title="String">consumerRegistrationInfo</a>, null,
                                                 <span class="delimiter">(</span><a title="String" id="kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.$anonfun.consumerZKString">consumerZKString</a>, <a title="Any" id="kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.$anonfun.consumer">consumer</a><span class="delimiter">)</span> =&gt; true, <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKConfig.zkSessionTimeoutMs" title="=&gt; Int">zkSessionTimeoutMs</a><span class="delimiter">)</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;end registering consumer &quot;)" class="string">&quot;end registering consumer &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK.consumerIdString" title="String">consumerIdString</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; in ZK&quot;)" class="string">&quot; in ZK&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private def <a title="()Unit" id="kafka.consumer;ZookeeperConsumerConnector.sendShutdownToAllQueues">sendShutdownToAllQueues</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    for <span class="delimiter">(</span><a title="java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]" id="kafka.consumer;ZookeeperConsumerConnector.sendShutdownToAllQueues.$anonfun.queue">queue</a> &lt;- <a href="#kafka.consumer;ZookeeperConsumerConnector.topicThreadIdAndQueues" title="=&gt; kafka.utils.Pool[(String, kafka.consumer.ConsumerThreadId),java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]">topicThreadIdAndQueues</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.values" title="=&gt; Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]">values</a>.<span title="[B &gt;: java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]=&gt; scala.collection.immutable.Set[B]">toSet</span><span title="(f: java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk] =&gt; Unit)Unit" class="delimiter">[</span><span title="java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]">BlockingQueue</span><span class="delimiter">[</span>FetchedDataChunk<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Clearing up queue&quot;)" class="string">&quot;Clearing up queue&quot;</span><span class="delimiter">)</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.sendShutdownToAllQueues.$anonfun.queue" title="java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]">queue</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.sendShutdownToAllQueues.$anonfun.queue" title="java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]">queue</a>.<span title="(x$1: kafka.consumer.FetchedDataChunk)Unit">put</span><span class="delimiter">(</span><a href="#kafka.consumer.ZookeeperConsumerConnector" title="kafka.consumer.ZookeeperConsumerConnector.type">ZookeeperConsumerConnector</a>.<a href="#kafka.consumer.ZookeeperConsumerConnector.shutdownCommand" title="=&gt; kafka.consumer.FetchedDataChunk">shutdownCommand</a><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Cleared queue and sent shutdown command&quot;)" class="string">&quot;Cleared queue and sent shutdown command&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="()Unit" id="kafka.consumer;ZookeeperConsumerConnector.autoCommit">autoCommit</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="String(&quot;auto committing&quot;)" class="string">&quot;auto committing&quot;</span><span class="delimiter">)</span>
    try <span class="delimiter">{</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f)" title="(isAutoCommit: Boolean)Unit">commitOffsets</a><span class="delimiter">(</span>isAutoCommit = false<span class="delimiter">)</span>
    <span class="delimiter">}</span>
    catch <span class="delimiter">{</span>
      case <a title="Throwable" id="kafka.consumer;ZookeeperConsumerConnector.autoCommit.t">t</a>: <span title="Throwable">Throwable</span> =&gt;
      <span class="comment">// log it and let it go</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;exception during autoCommit: &quot;)" class="string">&quot;exception during autoCommit: &quot;</span>, <a href="#kafka.consumer;ZookeeperConsumerConnector.autoCommit.t" title="Throwable">t</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(topicPartition: kafka.common.TopicAndPartition, offset: Long)Unit" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsetToZooKeeper">commitOffsetToZooKeeper</a><span class="delimiter">(</span><a title="kafka.common.TopicAndPartition" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsetToZooKeeper.topicPartition">topicPartition</a>: <a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition" title="kafka.common.TopicAndPartition">TopicAndPartition</a>, <a title="Long" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsetToZooKeeper.offset">offset</a>: <span title="Long">Long</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.checkpointedZkOffsets" title="=&gt; kafka.utils.Pool[kafka.common.TopicAndPartition,Long]">checkpointedZkOffsets</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.get" title="(key: kafka.common.TopicAndPartition)Long">get</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsetToZooKeeper.topicPartition" title="kafka.common.TopicAndPartition">topicPartition</a><span class="delimiter">)</span> <span title="(x: Long)Boolean">!=</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsetToZooKeeper.offset" title="Long">offset</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="kafka.utils.ZKGroupTopicDirs" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsetToZooKeeper.topicDirs">topicDirs</a> = new <a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupTopicDirs" title="kafka.utils.ZKGroupTopicDirs">ZKGroupTopicDirs</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.groupId" title="=&gt; String">groupId</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsetToZooKeeper.topicPartition" title="kafka.common.TopicAndPartition">topicPartition</a>.<a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition.topic" title="=&gt; String">topic</a><span class="delimiter">)</span>
      <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.updatePersistentPath" title="(client: org.I0Itec.zkclient.ZkClient, path: String, data: String)Unit">updatePersistentPath</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsetToZooKeeper.topicDirs" title="kafka.utils.ZKGroupTopicDirs">topicDirs</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupTopicDirs.consumerOffsetDir" title="=&gt; String">consumerOffsetDir</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsetToZooKeeper.topicPartition" title="kafka.common.TopicAndPartition">topicPartition</a>.<a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition.partition" title="=&gt; Int">partition</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsetToZooKeeper.offset" title="Long">offset</a>.<span title="()String">toString</span><span class="delimiter">)</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.checkpointedZkOffsets" title="=&gt; kafka.utils.Pool[kafka.common.TopicAndPartition,Long]">checkpointedZkOffsets</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.put" title="(k: kafka.common.TopicAndPartition, v: Long)Long">put</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsetToZooKeeper.topicPartition" title="kafka.common.TopicAndPartition">topicPartition</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsetToZooKeeper.offset" title="Long">offset</a><span class="delimiter">)</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.zkCommitMeter" title="=&gt; com.yammer.metrics.core.Meter">zkCommitMeter</a>.<span title="()Unit">mark</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(isAutoCommit: Boolean)Unit" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f)">commitOffsets</a><span class="delimiter">(</span><a title="Boolean" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).isAutoCommit">isAutoCommit</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    var retriesRemaining = <span title="Int(1)" class="int">1</span> <a title="Int" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).retriesRemaining">+</a> <span class="delimiter">(</span>if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).isAutoCommit" title="Boolean">isAutoCommit</a><span class="delimiter">)</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.offsetsCommitMaxRetries" title="=&gt; Int">offsetsCommitMaxRetries</a> else <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">// no retries for commits from auto-commit</span>
    var <a title="Boolean" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).done">done</a> = false

    while <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).done" title="Boolean">done</a><span class="delimiter">)</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).while$1" title="()Unit" class="delimiter">{</a>
      val committed = <a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannelLock" title="=&gt; Object">offsetsChannelLock</a> <a title="Boolean" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed">synchronized</a> <span class="delimiter">{</span> <span class="comment">// committed when we receive either no error codes or only MetadataTooLarge errors</span>
        val <a title="scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.common.OffsetAndMetadata]" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit">offsetsToCommit</a> = immutable.<span title="(elems: (kafka.common.TopicAndPartition, kafka.common.OffsetAndMetadata)*)scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.common.OffsetAndMetadata]">Map</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.topicRegistry_=" title="=&gt; kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">topicRegistry</a>.<span title="(f: ((String, kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo])) =&gt; scala.collection.GenTraversableOnce[(kafka.common.TopicAndPartition, kafka.common.OffsetAndMetadata)])(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[(String, kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo])],(kafka.common.TopicAndPartition, kafka.common.OffsetAndMetadata),Iterable[(kafka.common.TopicAndPartition, kafka.common.OffsetAndMetadata)]])Iterable[(kafka.common.TopicAndPartition, kafka.common.OffsetAndMetadata)]">flatMap</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit.$anonfun.x0$1" title="Iterable[(kafka.common.TopicAndPartition, kafka.common.OffsetAndMetadata)]" class="delimiter">{</a> case <span class="delimiter">(</span><a title="String" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit.$anonfun.topic">topic</a>, <a title="kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit.$anonfun.partitionTopicInfos">partitionTopicInfos</a><span class="delimiter">)</span> =&gt;
          <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit.$anonfun.partitionTopicInfos" title="kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]">partitionTopicInfos</a>.<span title="(f: ((Int, kafka.consumer.PartitionTopicInfo)) =&gt; (kafka.common.TopicAndPartition, kafka.common.OffsetAndMetadata))(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[(Int, kafka.consumer.PartitionTopicInfo)],(kafka.common.TopicAndPartition, kafka.common.OffsetAndMetadata),Iterable[(kafka.common.TopicAndPartition, kafka.common.OffsetAndMetadata)]])Iterable[(kafka.common.TopicAndPartition, kafka.common.OffsetAndMetadata)]">map</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit.$anonfun.$anonfun.x0$2" title="(kafka.common.TopicAndPartition, kafka.common.OffsetAndMetadata)" class="delimiter">{</a> case <span class="delimiter">(</span><a title="Int" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit.$anonfun.$anonfun.partition">partition</a>, <a title="kafka.consumer.PartitionTopicInfo" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit.$anonfun.$anonfun.info">info</a><span class="delimiter">)</span> =&gt;
            <a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition" title="(topic: String, partition: Int)kafka.common.TopicAndPartition">TopicAndPartition</a><span title="(self: kafka.common.TopicAndPartition)ArrowAssoc[kafka.common.TopicAndPartition]" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit.$anonfun.$anonfun.info" title="kafka.consumer.PartitionTopicInfo">info</a>.<a href="PartitionTopicInfo.scala.html#kafka.consumer;PartitionTopicInfo.topic" title="=&gt; String">topic</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit.$anonfun.$anonfun.info" title="kafka.consumer.PartitionTopicInfo">info</a>.<a href="PartitionTopicInfo.scala.html#kafka.consumer;PartitionTopicInfo.partitionId" title="=&gt; Int">partitionId</a><span class="delimiter">)</span> <span title="(y: kafka.common.OffsetAndMetadata)(kafka.common.TopicAndPartition, kafka.common.OffsetAndMetadata)">-&gt;</span> <a href="../common/OffsetMetadataAndError.scala.html#kafka.common;OffsetAndMetadata" title="(offset: Long, metadata: String, timestamp: Long)kafka.common.OffsetAndMetadata">OffsetAndMetadata</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit.$anonfun.$anonfun.info" title="kafka.consumer.PartitionTopicInfo">info</a>.<a href="PartitionTopicInfo.scala.html#kafka.consumer;PartitionTopicInfo.getConsumeOffset" title="()Long">getConsumeOffset</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>.<span title="=&gt; Seq[(kafka.common.TopicAndPartition, kafka.common.OffsetAndMetadata)]">toSeq</span>:_*<span class="delimiter">)</span>

        if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit" title="scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.common.OffsetAndMetadata]">offsetsToCommit</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.offsetsStorage" title="=&gt; String">offsetsStorage</a> <span title="(x$1: Any)Boolean">==</span> <span title="String(&quot;zookeeper&quot;)" class="string">&quot;zookeeper&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit" title="scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.common.OffsetAndMetadata]">offsetsToCommit</a>.<span title="(f: ((kafka.common.TopicAndPartition, kafka.common.OffsetAndMetadata)) =&gt; Unit)Unit">foreach</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.$anonfun.x0$3" title="Unit" class="delimiter">{</a> case<span class="delimiter">(</span><a title="kafka.common.TopicAndPartition" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.$anonfun.topicAndPartition">topicAndPartition</a>, <a title="kafka.common.OffsetAndMetadata" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.$anonfun.offsetAndMetadata">offsetAndMetadata</a><span class="delimiter">)</span> =&gt;
              <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsetToZooKeeper" title="(topicPartition: kafka.common.TopicAndPartition, offset: Long)Unit">commitOffsetToZooKeeper</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.$anonfun.topicAndPartition" title="kafka.common.TopicAndPartition">topicAndPartition</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.$anonfun.offsetAndMetadata" title="kafka.common.OffsetAndMetadata">offsetAndMetadata</a>.<a href="../common/OffsetMetadataAndError.scala.html#kafka.common;OffsetAndMetadata.offset" title="=&gt; Long">offset</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            true
          <span class="delimiter">}</span> else <span class="delimiter">{</span>
            val <a title="kafka.api.OffsetCommitRequest" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetCommitRequest">offsetCommitRequest</a> = <a href="../api/OffsetCommitRequest.scala.html#kafka.api.OffsetCommitRequest.apply$default$3" title="Short" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetCommitRequest.x$20">OffsetCommitRequest</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.groupId" title="String" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetCommitRequest.x$14">groupId</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit" title="scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.common.OffsetAndMetadata]" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetCommitRequest.x$15">offsetsToCommit</a>, clientId = <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.clientId" title="String" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetCommitRequest.x$16">clientId</a><span class="delimiter">)</span>
            <a href="#kafka.consumer;ZookeeperConsumerConnector.ensureOffsetManagerConnected" title="()Unit">ensureOffsetManagerConnected</a><span class="delimiter">(</span><span class="delimiter">)</span>
            try <span class="delimiter">{</span>
              <a href="#kafka.consumer;ZookeeperConsumerConnector.kafkaCommitMeter" title="=&gt; com.yammer.metrics.core.Meter">kafkaCommitMeter</a>.<span title="(x$1: Long)Unit">mark</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit" title="scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.common.OffsetAndMetadata]">offsetsToCommit</a>.<span title="=&gt; Long">size</span><span class="delimiter">)</span>
              <a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.send" title="(request: kafka.api.RequestOrResponse)Int">send</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetCommitRequest" title="kafka.api.OffsetCommitRequest">offsetCommitRequest</a><span class="delimiter">)</span>
              val <a title="kafka.api.OffsetCommitResponse" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetCommitResponse">offsetCommitResponse</a> = <a href="../api/OffsetCommitResponse.scala.html#kafka.api.OffsetCommitResponse" title="kafka.api.OffsetCommitResponse.type">OffsetCommitResponse</a>.<a href="../api/OffsetCommitResponse.scala.html#kafka.api.OffsetCommitResponse.readFrom" title="(buffer: java.nio.ByteBuffer)kafka.api.OffsetCommitResponse">readFrom</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.receive" title="()kafka.network.Receive">receive</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../network/Transmission.scala.html#kafka.network;Receive.buffer" title="=&gt; java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
              <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Offset commit response: %s.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetCommitResponse" title="kafka.api.OffsetCommitResponse">offsetCommitResponse</a><span class="delimiter">)</span><span class="delimiter">)</span>

              val <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.commitFailed" title="(Boolean, Boolean, Boolean, Int)" class="delimiter">(</a><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2" title="Boolean" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.commitFailed">commitFailed</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2" title="Boolean" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.retryableIfFailed">retryableIfFailed</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2" title="Boolean" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.shouldRefreshCoordinator">shouldRefreshCoordinator</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2" title="Int" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.errorCount">errorCount</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
                <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetCommitResponse" title="kafka.api.OffsetCommitResponse">offsetCommitResponse</a>.<a href="../api/OffsetCommitResponse.scala.html#kafka.api;OffsetCommitResponse.commitStatus" title="=&gt; Map[kafka.common.TopicAndPartition,Short]">commitStatus</a>.<span title="(z: (Boolean, Boolean, Boolean, Int))(op: ((Boolean, Boolean, Boolean, Int), (kafka.common.TopicAndPartition, Short)) =&gt; (Boolean, Boolean, Boolean, Int))(Boolean, Boolean, Boolean, Int)">foldLeft</span><span title="(_1: Boolean, _2: Boolean, _3: Boolean, _4: Int)(Boolean, Boolean, Boolean, Int)" class="delimiter">(</span>false, false, false, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.x0$4" title="(Boolean, Boolean, Boolean, Int)" class="delimiter">{</a> case<span class="delimiter">(</span><a title="(Boolean, Boolean, Boolean, Int)" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.folded">folded</a>, <span class="delimiter">(</span><a title="kafka.common.TopicAndPartition" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.topicPartition">topicPartition</a>, <a title="Short" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.errorCode">errorCode</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;

                  if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.errorCode" title="Short">errorCode</a> <span title="(x: Short)Boolean">==</span> <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.NoError" title="=&gt; Short">NoError</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.dualCommitEnabled" title="=&gt; Boolean">dualCommitEnabled</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                      val <a title="Long" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.offset">offset</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.offsetsToCommit" title="(key: kafka.common.TopicAndPartition)kafka.common.OffsetAndMetadata">offsetsToCommit</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.topicPartition" title="kafka.common.TopicAndPartition">topicPartition</a><span class="delimiter">)</span>.<a href="../common/OffsetMetadataAndError.scala.html#kafka.common;OffsetAndMetadata.offset" title="=&gt; Long">offset</a>
                      <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsetToZooKeeper" title="(topicPartition: kafka.common.TopicAndPartition, offset: Long)Unit">commitOffsetToZooKeeper</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.topicPartition" title="kafka.common.TopicAndPartition">topicPartition</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.offset" title="Long">offset</a><span class="delimiter">)</span>
                  <span class="delimiter">}</span>

                  <span title="(_1: Boolean, _2: Boolean, _3: Boolean, _4: Int)(Boolean, Boolean, Boolean, Int)" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.folded" title="(Boolean, Boolean, Boolean, Int)">folded</a>.<span title="=&gt; Boolean">_1</span> <span title="(x: Boolean)Boolean">||</span> <span class="comment">// update commitFailed</span>
                     <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.errorCode" title="Short">errorCode</a> <span title="(x: Short)Boolean">!=</span> <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.NoError" title="=&gt; Short">NoError</a>,

                  <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.folded" title="(Boolean, Boolean, Boolean, Int)">folded</a>.<span title="=&gt; Boolean">_2</span> <span title="(x: Boolean)Boolean">||</span> <span class="comment">// update retryableIfFailed - (only metadata too large is not retryable)</span>
                    <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.errorCode" title="Short">errorCode</a> <span title="(x: Short)Boolean">!=</span> <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.NoError" title="=&gt; Short">NoError</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.errorCode" title="Short">errorCode</a> <span title="(x: Short)Boolean">!=</span> <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.OffsetMetadataTooLargeCode" title="=&gt; Short">OffsetMetadataTooLargeCode</a><span class="delimiter">)</span>,

                  <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.folded" title="(Boolean, Boolean, Boolean, Int)">folded</a>.<span title="=&gt; Boolean">_3</span> <span title="(x: Boolean)Boolean">||</span> <span class="comment">// update shouldRefreshCoordinator</span>
                    <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.errorCode" title="Short">errorCode</a> <span title="(x: Short)Boolean">==</span> <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.NotCoordinatorForConsumerCode" title="=&gt; Short">NotCoordinatorForConsumerCode</a> <span title="(x: Boolean)Boolean">||</span>
                    <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.errorCode" title="Short">errorCode</a> <span title="(x: Short)Boolean">==</span> <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.ConsumerCoordinatorNotAvailableCode" title="=&gt; Short">ConsumerCoordinatorNotAvailableCode</a>,

                  <span class="comment">// update error count</span>
                  <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.folded" title="(Boolean, Boolean, Boolean, Int)">folded</a>.<span title="=&gt; Int">_4</span> <span title="(x: Int)Int">+</span> <span class="delimiter">(</span>if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.x$2.$anonfun.errorCode" title="Short">errorCode</a> <span title="(x: Short)Boolean">!=</span> <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.NoError" title="=&gt; Short">NoError</a><span class="delimiter">)</span> <span title="Int(1)" class="int">1</span> else <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>
              <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.errorCount" title="Int">errorCount</a> <span title="(x: String)String">+</span> <span title="String(&quot; errors in offset commit response.&quot;)" class="string">&quot; errors in offset commit response.&quot;</span><span class="delimiter">)</span>


              if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.shouldRefreshCoordinator" title="Boolean">shouldRefreshCoordinator</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Could not commit offsets (because offset coordinator has moved or is unavailable).&quot;)" class="string">&quot;Could not commit offsets (because offset coordinator has moved or is unavailable).&quot;</span><span class="delimiter">)</span>
                <a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.disconnect" title="()Unit">disconnect</a><span class="delimiter">(</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>

              if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.commitFailed" title="Boolean">commitFailed</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.retryableIfFailed" title="Boolean">retryableIfFailed</a><span class="delimiter">)</span>
                false
              else
                true
            <span class="delimiter">}</span>
            catch <span class="delimiter">{</span>
              case <a title="Throwable" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.t">t</a>: <span title="Throwable">Throwable</span> =&gt;
                <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;Error while committing offsets.&quot;)" class="string">&quot;Error while committing offsets.&quot;</span>, <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed.t" title="Throwable">t</a><span class="delimiter">)</span>
                <a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.disconnect" title="()Unit">disconnect</a><span class="delimiter">(</span><span class="delimiter">)</span>
                false
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> else <span class="delimiter">{</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;No updates to offsets since last commit.&quot;)" class="string">&quot;No updates to offsets since last commit.&quot;</span><span class="delimiter">)</span>
          true
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).done" title="Boolean">done</a> = if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.isShuttingDown" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">isShuttingDown</a>.<span title="()Boolean">get</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).isAutoCommit" title="Boolean">isAutoCommit</a><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">// should not retry indefinitely if shutting down</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).retriesRemaining" title="Int">retriesRemaining</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).retriesRemaining" title="Int">retriesRemaining</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">||</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).committed" title="Boolean">committed</a>
      <span class="delimiter">}</span> else
        true

      if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f).done" title="Boolean">done</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Retrying offset commit in %d ms&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.offsetsChannelBackoffMs" title="=&gt; Int">offsetsChannelBackoffMs</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="Thread.type">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.offsetsChannelBackoffMs" title="=&gt; Long">offsetsChannelBackoffMs</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * KAFKA-1743: This method added for backward compatibility.
   */</span>
  def <a title="=&gt; Unit" id="kafka.consumer;ZookeeperConsumerConnector.commitOffsets(daa10c302f)">commitOffsets</a> <span class="delimiter">{</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f)" title="(isAutoCommit: Boolean)Unit">commitOffsets</a><span class="delimiter">(</span>true<span class="delimiter">)</span> <span class="delimiter">}</span>

  private def <a title="(topicPartition: kafka.common.TopicAndPartition)(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsetFromZooKeeper">fetchOffsetFromZooKeeper</a><span class="delimiter">(</span><a title="kafka.common.TopicAndPartition" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsetFromZooKeeper.topicPartition">topicPartition</a>: <a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition" title="kafka.common.TopicAndPartition">TopicAndPartition</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    val <a title="kafka.utils.ZKGroupTopicDirs" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsetFromZooKeeper.dirs">dirs</a> = new <a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupTopicDirs" title="kafka.utils.ZKGroupTopicDirs">ZKGroupTopicDirs</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.groupId" title="=&gt; String">groupId</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsetFromZooKeeper.topicPartition" title="kafka.common.TopicAndPartition">topicPartition</a>.<a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition.topic" title="=&gt; String">topic</a><span class="delimiter">)</span>
    val <a title="Option[String]" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsetFromZooKeeper.offsetString">offsetString</a> = <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.readDataMaybeNull" title="(client: org.I0Itec.zkclient.ZkClient, path: String)(Option[String], org.apache.zookeeper.data.Stat)">readDataMaybeNull</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsetFromZooKeeper.dirs" title="kafka.utils.ZKGroupTopicDirs">dirs</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupTopicDirs.consumerOffsetDir" title="=&gt; String">consumerOffsetDir</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsetFromZooKeeper.topicPartition" title="kafka.common.TopicAndPartition">topicPartition</a>.<a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition.partition" title="=&gt; Int">partition</a><span class="delimiter">)</span>.<span title="=&gt; Option[String]">_1</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsetFromZooKeeper.offsetString" title="Option[String]">offsetString</a> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="String" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsetFromZooKeeper.offsetStr">offsetStr</a><span class="delimiter">)</span> =&gt; <span title="(_1: kafka.common.TopicAndPartition, _2: kafka.common.OffsetMetadataAndError)(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsetFromZooKeeper.topicPartition" title="kafka.common.TopicAndPartition">topicPartition</a>, <a href="../common/OffsetMetadataAndError.scala.html#kafka.common;OffsetMetadataAndError" title="(offset: Long, metadata: String, error: Short)kafka.common.OffsetMetadataAndError">OffsetMetadataAndError</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsetFromZooKeeper.offsetStr" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">offsetStr</a>.<span title="=&gt; Long">toLong</span>, <a href="../common/OffsetMetadataAndError.scala.html#kafka.common.OffsetAndMetadata" title="kafka.common.OffsetAndMetadata.type">OffsetAndMetadata</a>.<a href="../common/OffsetMetadataAndError.scala.html#kafka.common.OffsetAndMetadata.NoMetadata" title="=&gt; String">NoMetadata</a>, <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.NoError" title="=&gt; Short">NoError</a><span class="delimiter">)</span><span class="delimiter">)</span>
      case <span title="None.type">None</span> =&gt; <span title="(_1: kafka.common.TopicAndPartition, _2: kafka.common.OffsetMetadataAndError)(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsetFromZooKeeper.topicPartition" title="kafka.common.TopicAndPartition">topicPartition</a>, <a href="../common/OffsetMetadataAndError.scala.html#kafka.common.OffsetMetadataAndError" title="kafka.common.OffsetMetadataAndError.type">OffsetMetadataAndError</a>.<a href="../common/OffsetMetadataAndError.scala.html#kafka.common.OffsetMetadataAndError.NoOffset" title="=&gt; kafka.common.OffsetMetadataAndError">NoOffset</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(partitions: Seq[kafka.common.TopicAndPartition])Option[kafka.api.OffsetFetchResponse]" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets">fetchOffsets</a><span class="delimiter">(</span><a title="Seq[kafka.common.TopicAndPartition]" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.partitions">partitions</a>: <span title="Seq[kafka.common.TopicAndPartition]">Seq</span><span class="delimiter">[</span>TopicAndPartition<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.partitions" title="Seq[kafka.common.TopicAndPartition]">partitions</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
      <span title="(x: kafka.api.OffsetFetchResponse)Some[kafka.api.OffsetFetchResponse]">Some</span><span class="delimiter">(</span><a href="../api/OffsetFetchResponse.scala.html#kafka.api;OffsetFetchResponse" title="(requestInfo: Map[kafka.common.TopicAndPartition,kafka.common.OffsetMetadataAndError], correlationId: Int)kafka.api.OffsetFetchResponse">OffsetFetchResponse</a><span class="delimiter">(</span><span title="scala.collection.Map.type">Map</span>.<span title="scala.collection.immutable.Map[kafka.common.TopicAndPartition,Nothing]">empty</span><span class="delimiter">)</span><span class="delimiter">)</span>
    else if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.offsetsStorage" title="=&gt; String">offsetsStorage</a> <span title="(x$1: Any)Boolean">==</span> <span title="String(&quot;zookeeper&quot;)" class="string">&quot;zookeeper&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="Seq[(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)]" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsets">offsets</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.partitions" title="Seq[kafka.common.TopicAndPartition]">partitions</a>.<span title="(f: kafka.common.TopicAndPartition =&gt; (kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[kafka.common.TopicAndPartition],(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError),Seq[(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)]])Seq[(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError),Seq[(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)]]" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsetFromZooKeeper" title="(topicPartition: kafka.common.TopicAndPartition)(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)">fetchOffsetFromZooKeeper</a><span class="delimiter">)</span>
      <span title="(x: kafka.api.OffsetFetchResponse)Some[kafka.api.OffsetFetchResponse]">Some</span><span class="delimiter">(</span><a href="../api/OffsetFetchResponse.scala.html#kafka.api;OffsetFetchResponse" title="(requestInfo: Map[kafka.common.TopicAndPartition,kafka.common.OffsetMetadataAndError], correlationId: Int)kafka.api.OffsetFetchResponse">OffsetFetchResponse</a><span class="delimiter">(</span>immutable.<span title="(elems: (kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)*)scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.common.OffsetMetadataAndError]">Map</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsets" title="Seq[(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)]">offsets</a>:_*<span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> else <span class="delimiter">{</span>
      val <a title="kafka.api.OffsetFetchRequest" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchRequest">offsetFetchRequest</a> = <a href="../api/OffsetFetchRequest.scala.html#kafka.api.OffsetFetchRequest.apply$default$3" title="Short" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchRequest.x$25">OffsetFetchRequest</a><span class="delimiter">(</span>groupId = <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.groupId" title="String" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchRequest.x$21">groupId</a>, requestInfo = <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.partitions" title="Seq[kafka.common.TopicAndPartition]" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchRequest.x$22">partitions</a>, clientId = <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.clientId" title="String" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchRequest.x$23">clientId</a><span class="delimiter">)</span>

      var <a title="Option[kafka.api.OffsetFetchResponse]" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchResponseOpt">offsetFetchResponseOpt</a>: <span title="Option[kafka.api.OffsetFetchResponse]">Option</span><span class="delimiter">[</span>OffsetFetchResponse<span class="delimiter">]</span> = <span title="None.type">None</span>
      while <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.consumer;ZookeeperConsumerConnector.isShuttingDown" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">isShuttingDown</a>.<span title="()Boolean">get</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchResponseOpt" title="Option[kafka.api.OffsetFetchResponse]">offsetFetchResponseOpt</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.while$2" title="()Unit" class="delimiter">{</a>
        <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchResponseOpt" title="Option[kafka.api.OffsetFetchResponse]">offsetFetchResponseOpt</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannelLock" title="=&gt; Object">offsetsChannelLock</a> <span title="(x$1: Option[kafka.api.OffsetFetchResponse])Option[kafka.api.OffsetFetchResponse]">synchronized</span> <span class="delimiter">{</span>
          <a href="#kafka.consumer;ZookeeperConsumerConnector.ensureOffsetManagerConnected" title="()Unit">ensureOffsetManagerConnected</a><span class="delimiter">(</span><span class="delimiter">)</span>
          try <span class="delimiter">{</span>
            <a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.send" title="(request: kafka.api.RequestOrResponse)Int">send</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchRequest" title="kafka.api.OffsetFetchRequest">offsetFetchRequest</a><span class="delimiter">)</span>
            val <a title="kafka.api.OffsetFetchResponse" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchResponse">offsetFetchResponse</a> = <a href="../api/OffsetFetchResponse.scala.html#kafka.api.OffsetFetchResponse" title="kafka.api.OffsetFetchResponse.type">OffsetFetchResponse</a>.<a href="../api/OffsetFetchResponse.scala.html#kafka.api.OffsetFetchResponse.readFrom" title="(buffer: java.nio.ByteBuffer)kafka.api.OffsetFetchResponse">readFrom</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.receive" title="()kafka.network.Receive">receive</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../network/Transmission.scala.html#kafka.network;Receive.buffer" title="=&gt; java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
            <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Offset fetch response: %s.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchResponse" title="kafka.api.OffsetFetchResponse">offsetFetchResponse</a><span class="delimiter">)</span><span class="delimiter">)</span>

            val <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.leaderChanged" title="(Boolean, Boolean)" class="delimiter">(</a><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.x$3" title="Boolean" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.leaderChanged">leaderChanged</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.x$3" title="Boolean" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.loadInProgress">loadInProgress</a><span class="delimiter">)</span> =
              <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchResponse" title="kafka.api.OffsetFetchResponse">offsetFetchResponse</a>.<a href="../api/OffsetFetchResponse.scala.html#kafka.api;OffsetFetchResponse.requestInfo" title="=&gt; Map[kafka.common.TopicAndPartition,kafka.common.OffsetMetadataAndError]">requestInfo</a>.<span title="(z: (Boolean, Boolean))(op: ((Boolean, Boolean), (kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)) =&gt; (Boolean, Boolean))(Boolean, Boolean)">foldLeft</span><span title="(_1: Boolean, _2: Boolean)(Boolean, Boolean)" class="delimiter">(</span>false, false<span class="delimiter">)</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.x$3.$anonfun.x0$5" title="(Boolean, Boolean)" class="delimiter">{</a> case<span class="delimiter">(</span><a title="(Boolean, Boolean)" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.x$3.$anonfun.folded">folded</a>, <span class="delimiter">(</span><a title="kafka.common.TopicAndPartition" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.x$3.$anonfun.topicPartition">topicPartition</a>, <a title="kafka.common.OffsetMetadataAndError" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.x$3.$anonfun.offsetMetadataAndError">offsetMetadataAndError</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
                <span title="(_1: Boolean, _2: Boolean)(Boolean, Boolean)" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.x$3.$anonfun.folded" title="(Boolean, Boolean)">folded</a>.<span title="=&gt; Boolean">_1</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.x$3.$anonfun.offsetMetadataAndError" title="kafka.common.OffsetMetadataAndError">offsetMetadataAndError</a>.<a href="../common/OffsetMetadataAndError.scala.html#kafka.common;OffsetMetadataAndError.error" title="=&gt; Short">error</a> <span title="(x: Short)Boolean">==</span> <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.NotCoordinatorForConsumerCode" title="=&gt; Short">NotCoordinatorForConsumerCode</a><span class="delimiter">)</span>,
                 <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.x$3.$anonfun.folded" title="(Boolean, Boolean)">folded</a>.<span title="=&gt; Boolean">_2</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.x$3.$anonfun.offsetMetadataAndError" title="kafka.common.OffsetMetadataAndError">offsetMetadataAndError</a>.<a href="../common/OffsetMetadataAndError.scala.html#kafka.common;OffsetMetadataAndError.error" title="=&gt; Short">error</a> <span title="(x: Short)Boolean">==</span> <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.OffsetsLoadInProgressCode" title="=&gt; Short">OffsetsLoadInProgressCode</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>

            if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.leaderChanged" title="Boolean">leaderChanged</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.disconnect" title="()Unit">disconnect</a><span class="delimiter">(</span><span class="delimiter">)</span>
              <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Could not fetch offsets (because offset manager has moved).&quot;)" class="string">&quot;Could not fetch offsets (because offset manager has moved).&quot;</span><span class="delimiter">)</span>
              <span title="None.type">None</span> <span class="comment">// retry</span>
            <span class="delimiter">}</span>
            else if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.loadInProgress" title="Boolean">loadInProgress</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Could not fetch offsets (because offset cache is being loaded).&quot;)" class="string">&quot;Could not fetch offsets (because offset cache is being loaded).&quot;</span><span class="delimiter">)</span>
              <span title="None.type">None</span> <span class="comment">// retry</span>
            <span class="delimiter">}</span>
            else <span class="delimiter">{</span>
              if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.dualCommitEnabled" title="=&gt; Boolean">dualCommitEnabled</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="comment">// if dual-commit is enabled (i.e., if a consumer group is migrating offsets to kafka), then pick the</span>
                <span class="comment">// maximum between offsets in zookeeper and kafka.</span>
                val <a title="Map[kafka.common.TopicAndPartition,kafka.common.OffsetMetadataAndError]" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.kafkaOffsets">kafkaOffsets</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchResponse" title="kafka.api.OffsetFetchResponse">offsetFetchResponse</a>.<a href="../api/OffsetFetchResponse.scala.html#kafka.api;OffsetFetchResponse.requestInfo" title="=&gt; Map[kafka.common.TopicAndPartition,kafka.common.OffsetMetadataAndError]">requestInfo</a>
                val <a title="scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.common.OffsetMetadataAndError]" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.mostRecentOffsets">mostRecentOffsets</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.kafkaOffsets" title="Map[kafka.common.TopicAndPartition,kafka.common.OffsetMetadataAndError]">kafkaOffsets</a>.<span title="(f: ((kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)) =&gt; (kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.common.OffsetMetadataAndError],(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError),scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.common.OffsetMetadataAndError]])scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.common.OffsetMetadataAndError]">map</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.mostRecentOffsets.$anonfun.x0$6" title="(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)" class="delimiter">{</a> case <span class="delimiter">(</span><a title="kafka.common.TopicAndPartition" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.mostRecentOffsets.$anonfun.topicPartition">topicPartition</a>, <a title="kafka.common.OffsetMetadataAndError" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.mostRecentOffsets.$anonfun.kafkaOffset">kafkaOffset</a><span class="delimiter">)</span> =&gt;
                  val <a title="Long" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.mostRecentOffsets.$anonfun.zkOffset">zkOffset</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsetFromZooKeeper" title="(topicPartition: kafka.common.TopicAndPartition)(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)">fetchOffsetFromZooKeeper</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.mostRecentOffsets.$anonfun.topicPartition" title="kafka.common.TopicAndPartition">topicPartition</a><span class="delimiter">)</span>.<span title="=&gt; kafka.common.OffsetMetadataAndError">_2</span>.<a href="../common/OffsetMetadataAndError.scala.html#kafka.common;OffsetMetadataAndError.offset" title="=&gt; Long">offset</a>
                  val <a title="Long" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.mostRecentOffsets.$anonfun.mostRecentOffset">mostRecentOffset</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.mostRecentOffsets.$anonfun.zkOffset" title="implicit scala.LowPriorityImplicits.longWrapper : (x: Long)scala.runtime.RichLong">zkOffset</a>.<span title="(that: Long)Long">max</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.mostRecentOffsets.$anonfun.kafkaOffset" title="kafka.common.OffsetMetadataAndError">kafkaOffset</a>.<a href="../common/OffsetMetadataAndError.scala.html#kafka.common;OffsetMetadataAndError.offset" title="=&gt; Long">offset</a><span class="delimiter">)</span>
                  <span title="(_1: kafka.common.TopicAndPartition, _2: kafka.common.OffsetMetadataAndError)(kafka.common.TopicAndPartition, kafka.common.OffsetMetadataAndError)" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.mostRecentOffsets.$anonfun.topicPartition" title="kafka.common.TopicAndPartition">topicPartition</a>, <a href="../common/OffsetMetadataAndError.scala.html#kafka.common;OffsetMetadataAndError" title="(offset: Long, metadata: String, error: Short)kafka.common.OffsetMetadataAndError">OffsetMetadataAndError</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.mostRecentOffsets.$anonfun.mostRecentOffset" title="Long">mostRecentOffset</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.mostRecentOffsets.$anonfun.kafkaOffset" title="kafka.common.OffsetMetadataAndError">kafkaOffset</a>.<a href="../common/OffsetMetadataAndError.scala.html#kafka.common;OffsetMetadataAndError.metadata" title="=&gt; String">metadata</a>, <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.NoError" title="=&gt; Short">NoError</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
                <span title="(x: kafka.api.OffsetFetchResponse)Some[kafka.api.OffsetFetchResponse]">Some</span><span class="delimiter">(</span><a href="../api/OffsetFetchResponse.scala.html#kafka.api;OffsetFetchResponse" title="(requestInfo: Map[kafka.common.TopicAndPartition,kafka.common.OffsetMetadataAndError], correlationId: Int)kafka.api.OffsetFetchResponse">OffsetFetchResponse</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.mostRecentOffsets" title="scala.collection.immutable.Map[kafka.common.TopicAndPartition,kafka.common.OffsetMetadataAndError]">mostRecentOffsets</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
              else
                <span title="(x: kafka.api.OffsetFetchResponse)Some[kafka.api.OffsetFetchResponse]">Some</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchResponse" title="kafka.api.OffsetFetchResponse">offsetFetchResponse</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
          catch <span class="delimiter">{</span>
            case <a title="Exception" id="kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.e">e</a>: <span title="Exception">Exception</span> =&gt;
              <a href="../utils/Logging.scala.html#kafka.utils;Logging.warn(1729dbc42f)" title="(msg: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Error while fetching offsets from %s:%d. Possible cause: %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.host" title="=&gt; String">host</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.port" title="=&gt; Int">port</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.e" title="Exception">e</a>.<span title="()String">getMessage</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <a href="#kafka.consumer;ZookeeperConsumerConnector.offsetsChannel_=" title="=&gt; kafka.network.BlockingChannel">offsetsChannel</a>.<a href="../network/BlockingChannel.scala.html#kafka.network;BlockingChannel.disconnect" title="()Unit">disconnect</a><span class="delimiter">(</span><span class="delimiter">)</span>
              <span title="None.type">None</span> <span class="comment">// retry</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchResponseOpt" title="Option[kafka.api.OffsetFetchResponse]">offsetFetchResponseOpt</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Retrying offset fetch in %d ms&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.offsetsChannelBackoffMs" title="=&gt; Int">offsetsChannelBackoffMs</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Thread.type">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.offsetsChannelBackoffMs" title="=&gt; Long">offsetsChannelBackoffMs</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets.offsetFetchResponseOpt" title="Option[kafka.api.OffsetFetchResponse]">offsetFetchResponseOpt</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  class <a title="class ZKSessionExpireListener extends Object with org.I0Itec.zkclient.IZkStateListener" id="kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener">ZKSessionExpireListener</a><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener" title="ZookeeperConsumerConnector.this.ZKSessionExpireListener" class="delimiter">(</a>val <a title="kafka.utils.ZKGroupDirs" id="kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener.dirs">dirs</a>: <a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupDirs" title="kafka.utils.ZKGroupDirs">ZKGroupDirs</a>,
                                 val <a title="String" id="kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener.consumerIdString">consumerIdString</a>: <span title="String">String</span>,
                                 val <a title="kafka.consumer.TopicCount" id="kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener.topicCount">topicCount</a>: <a href="TopicCount.scala.html#kafka.consumer;TopicCount" title="kafka.consumer.TopicCount">TopicCount</a>,
                                 val <a title="ZookeeperConsumerConnector.this.ZKRebalancerListener" id="kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener.loadBalancerListener">loadBalancerListener</a>: <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener" title="ZookeeperConsumerConnector.this.ZKRebalancerListener">ZKRebalancerListener</a><span class="delimiter">)</span>
    extends <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener" title="org.I0Itec.zkclient.IZkStateListener">IZkStateListener</a> <span class="delimiter">{</span>
    @throws<span class="delimiter">(</span>classOf<span class="delimiter">[</span>Exception<span class="delimiter">]</span><span class="delimiter">)</span>
    def <a title="(state: org.apache.zookeeper.Watcher.Event.KeeperState)Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener.handleStateChanged">handleStateChanged</a><span class="delimiter">(</span><a title="org.apache.zookeeper.Watcher.Event.KeeperState" id="kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener.handleStateChanged.state">state</a>: <span title="org.apache.zookeeper.Watcher.Event.KeeperState">KeeperState</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span>
      <span class="comment">// do nothing, since zkclient will do reconnect for us.</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Called after the zookeeper session has expired and a new session has been created. You would have to re-create
     * any ephemeral nodes here.
     *
     * @throws Exception
     *             On any error.
     */</span>
    @throws<span class="delimiter">(</span>classOf<span class="delimiter">[</span>Exception<span class="delimiter">]</span><span class="delimiter">)</span>
    def <a title="()Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener.handleNewSession">handleNewSession</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">/**
       *  When we get a SessionExpired event, we lost all ephemeral nodes and zkclient has reestablished a
       *  connection for us. We need to release the ownership of the current consumer and re-register this
       *  consumer in the consumer registry and trigger a rebalance.
       */</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;ZK expired; release old broker parition ownership; re-register consumer &quot;)" class="string">&quot;ZK expired; release old broker parition ownership; re-register consumer &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener.consumerIdString" title="=&gt; String">consumerIdString</a><span class="delimiter">)</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener.loadBalancerListener" title="=&gt; ZookeeperConsumerConnector.this.ZKRebalancerListener">loadBalancerListener</a>.<a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.resetState" title="()Unit">resetState</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK" title="(dirs: kafka.utils.ZKGroupDirs, consumerIdString: String, topicCount: kafka.consumer.TopicCount)Unit">registerConsumerInZK</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener.dirs" title="=&gt; kafka.utils.ZKGroupDirs">dirs</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener.consumerIdString" title="=&gt; String">consumerIdString</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener.topicCount" title="=&gt; kafka.consumer.TopicCount">topicCount</a><span class="delimiter">)</span>
      <span class="comment">// explicitly trigger load balancing for this consumer</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener.loadBalancerListener" title="=&gt; ZookeeperConsumerConnector.this.ZKRebalancerListener">loadBalancerListener</a>.<a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance" title="()Unit">syncedRebalance</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="comment">// There is no need to resubscribe to child and state changes.</span>
      <span class="comment">// The child change watchers will be set inside rebalance when we read the children list.</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  class <a title="class ZKTopicPartitionChangeListener extends Object with org.I0Itec.zkclient.IZkDataListener" id="kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener">ZKTopicPartitionChangeListener</a><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener" title="ZookeeperConsumerConnector.this.ZKTopicPartitionChangeListener" class="delimiter">(</a>val <a title="ZookeeperConsumerConnector.this.ZKRebalancerListener" id="kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener.loadBalancerListener">loadBalancerListener</a>: <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener" title="ZookeeperConsumerConnector.this.ZKRebalancerListener">ZKRebalancerListener</a><span class="delimiter">)</span>
    extends <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener" title="org.I0Itec.zkclient.IZkDataListener">IZkDataListener</a> <span class="delimiter">{</span>

    def <a title="(dataPath: String, data: Object)Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener.handleDataChange">handleDataChange</a><span class="delimiter">(</span><a title="String" id="kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener.handleDataChange.dataPath">dataPath</a> : <span title="String">String</span>, <a title="Object" id="kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener.handleDataChange.data">data</a>: <span title="Object">Object</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      try <span class="delimiter">{</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Topic info for path &quot;)" class="string">&quot;Topic info for path &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener.handleDataChange.dataPath" title="String">dataPath</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; changed to &quot;)" class="string">&quot; changed to &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener.handleDataChange.data" title="Object">data</a>.<span title="()String">toString</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot;, triggering rebalance&quot;)" class="string">&quot;, triggering rebalance&quot;</span><span class="delimiter">)</span>
        <span class="comment">// queue up the rebalance event</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener.loadBalancerListener" title="=&gt; ZookeeperConsumerConnector.this.ZKRebalancerListener">loadBalancerListener</a>.<a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalanceEventTriggered" title="()Unit">rebalanceEventTriggered</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="comment">// There is no need to re-subscribe the watcher since it will be automatically</span>
        <span class="comment">// re-registered upon firing of this event by zkClient</span>
      <span class="delimiter">}</span> catch <span class="delimiter">{</span>
        case <a title="Throwable" id="kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener.handleDataChange.e">e</a>: <span title="Throwable">Throwable</span> =&gt; <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;Error while handling topic partition change for data path &quot;)" class="string">&quot;Error while handling topic partition change for data path &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener.handleDataChange.dataPath" title="String">dataPath</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener.handleDataChange.e" title="Throwable">e</a> <span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    @throws<span class="delimiter">(</span>classOf<span class="delimiter">[</span>Exception<span class="delimiter">]</span><span class="delimiter">)</span>
    def <a title="(dataPath: String)Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener.handleDataDeleted">handleDataDeleted</a><span class="delimiter">(</span><a title="String" id="kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener.handleDataDeleted.dataPath">dataPath</a> : <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// TODO: This need to be implemented when we support delete topic</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.warn(1729dbc42f)" title="(msg: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="String(&quot;Topic for path &quot;)" class="string">&quot;Topic for path &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener.handleDataDeleted.dataPath" title="String">dataPath</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; gets deleted, which should not happen at this time&quot;)" class="string">&quot; gets deleted, which should not happen at this time&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  class <a title="class ZKRebalancerListener extends Object with org.I0Itec.zkclient.IZkChildListener" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener">ZKRebalancerListener</a><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener" title="ZookeeperConsumerConnector.this.ZKRebalancerListener" class="delimiter">(</a>val <a title="String" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.group">group</a>: <span title="String">String</span>, val <a title="String" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.consumerIdString">consumerIdString</a>: <span title="String">String</span>,
                             val <a title="scala.collection.mutable.Map[String,List[kafka.consumer.KafkaStream[_, _]]]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.kafkaMessageAndMetadataStreams">kafkaMessageAndMetadataStreams</a>: mutable.<span title="scala.collection.mutable.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">Map</span><span class="delimiter">[</span>String,List<span class="delimiter">[</span>KafkaStream<span class="delimiter">[</span>_,_<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
    extends <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener" title="org.I0Itec.zkclient.IZkChildListener">IZkChildListener</a> <span class="delimiter">{</span>

    private val <a title="&lt;refinement of kafka.consumer.PartitionAssignor with kafka.utils.Logging&gt; extends kafka.consumer.PartitionAssignor with kafka.utils.Logging" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.partitionAssignor">partitionAssignor</a> = <a href="PartitionAssignor.scala.html#kafka.consumer.PartitionAssignor" title="kafka.consumer.PartitionAssignor.type">PartitionAssignor</a>.<a href="PartitionAssignor.scala.html#kafka.consumer.PartitionAssignor.createInstance" title="(assignmentStrategy: String)kafka.consumer.PartitionAssignor with kafka.utils.Logging{def assign(ctx: kafka.consumer.AssignmentContext): scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]}">createInstance</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.partitionAssignmentStrategy" title="=&gt; String">partitionAssignmentStrategy</a><span class="delimiter">)</span>

    private var <a title="Boolean" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.isWatcherTriggered_=">isWatcherTriggered</a> = false
    private val <a title="java.util.concurrent.locks.ReentrantLock" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.lock">lock</a> = new <span title="java.util.concurrent.locks.ReentrantLock">ReentrantLock</span>
    private val <a title="java.util.concurrent.locks.Condition" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.cond">cond</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.lock" title="=&gt; java.util.concurrent.locks.ReentrantLock">lock</a>.<span title="()java.util.concurrent.locks.Condition">newCondition</span><span class="delimiter">(</span><span class="delimiter">)</span>

    @volatile private var <a title="Int" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.allTopicsOwnedPartitionsCount_=">allTopicsOwnedPartitionsCount</a> = <span title="Int(0)" class="int">0</span>
    <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newGauge" title="(name: String, metric: com.yammer.metrics.core.Gauge[Int], tags: scala.collection.Map[String,String])com.yammer.metrics.core.Gauge[Int]">newGauge</a><span class="delimiter">(</span><span title="String(&quot;OwnedPartitionsCount&quot;)" class="string">&quot;OwnedPartitionsCount&quot;</span>,
      new <a title="&lt;$anon: com.yammer.metrics.core.Gauge[Int]&gt; extends com.yammer.metrics.core.Gauge[Int]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.<local ZKRebalancerListener>;$anon">Gauge</a><span class="delimiter">[</span>Int<span class="delimiter">]</span> <span class="delimiter">{</span>
        def <a title="()Int" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.<local ZKRebalancerListener>;$anon.value">value</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.allTopicsOwnedPartitionsCount_=" title="=&gt; Int">allTopicsOwnedPartitionsCount</a>
      <span class="delimiter">}</span>,
      <span title="(elems: (String, String)*)scala.collection.Map[String,String]">Map</span><span class="delimiter">(</span><span title="(self: String)ArrowAssoc[String]" class="string">&quot;clientId&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.clientId" title="=&gt; String">clientId</a>, <span title="(self: String)ArrowAssoc[String]" class="string">&quot;groupId&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.groupId" title="=&gt; String">groupId</a><span class="delimiter">)</span><span class="delimiter">)</span>

    private def <a title="(topic: String)scala.collection.Map[String,String]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.ownedPartitionsCountMetricTags">ownedPartitionsCountMetricTags</a><span class="delimiter">(</span><a title="String" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.ownedPartitionsCountMetricTags.topic">topic</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="(elems: (String, String)*)scala.collection.Map[String,String]">Map</span><span class="delimiter">(</span><span title="(self: String)ArrowAssoc[String]" class="string">&quot;clientId&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.clientId" title="=&gt; String">clientId</a>, <span title="(self: String)ArrowAssoc[String]" class="string">&quot;groupId&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.groupId" title="=&gt; String">groupId</a>, <span title="(self: String)ArrowAssoc[String]" class="string">&quot;topic&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.ownedPartitionsCountMetricTags.topic" title="String">topic</a><span class="delimiter">)</span>

    private val <a title="Thread" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.watcherExecutorThread">watcherExecutorThread</a> = new <a title="&lt;$anon: Thread&gt; extends Thread" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.watcherExecutorThread;$anon">Thread</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.consumerIdString" title="=&gt; String">consumerIdString</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;_watcher_executor&quot;)" class="string">&quot;_watcher_executor&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      override def <a title="()Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.watcherExecutorThread;$anon.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;starting watcher executor thread for consumer &quot;)" class="string">&quot;starting watcher executor thread for consumer &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.consumerIdString" title="=&gt; String">consumerIdString</a><span class="delimiter">)</span>
        var <a title="Boolean" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.watcherExecutorThread;$anon.run.doRebalance">doRebalance</a> = false
        while <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.consumer;ZookeeperConsumerConnector.isShuttingDown" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">isShuttingDown</a>.<span title="()Boolean">get</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          try <span class="delimiter">{</span>
            <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.lock" title="=&gt; java.util.concurrent.locks.ReentrantLock">lock</a>.<span title="()Unit">lock</span><span class="delimiter">(</span><span class="delimiter">)</span>
            try <span class="delimiter">{</span>
              if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.isWatcherTriggered_=" title="=&gt; Boolean">isWatcherTriggered</a><span class="delimiter">)</span>
                <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.cond" title="=&gt; java.util.concurrent.locks.Condition">cond</a>.<span title="(x$1: Long, x$2: java.util.concurrent.TimeUnit)Boolean">await</span><span class="delimiter">(</span><span title="Long(1000L)" class="int">1000</span>, TimeUnit.<span title="java.util.concurrent.TimeUnit(MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span> <span class="comment">// wake up periodically so that it can check the shutdown flag</span>
            <span class="delimiter">}</span> finally <span class="delimiter">{</span>
              <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.watcherExecutorThread;$anon.run.doRebalance" title="Boolean">doRebalance</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.isWatcherTriggered_=" title="=&gt; Boolean">isWatcherTriggered</a>
              <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.isWatcherTriggered_=" title="(x$1: Boolean)Unit">isWatcherTriggered</a> = false
              <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.lock" title="=&gt; java.util.concurrent.locks.ReentrantLock">lock</a>.<span title="()Unit">unlock</span><span class="delimiter">(</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.watcherExecutorThread;$anon.run.doRebalance" title="Boolean">doRebalance</a><span class="delimiter">)</span>
              <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance" title="()Unit">syncedRebalance</a>
          <span class="delimiter">}</span> catch <span class="delimiter">{</span>
            case <a title="Throwable" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.watcherExecutorThread;$anon.run.t">t</a>: <span title="Throwable">Throwable</span> =&gt; <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;error during syncedRebalance&quot;)" class="string">&quot;error during syncedRebalance&quot;</span>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.watcherExecutorThread;$anon.run.t" title="Throwable">t</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;stopping watcher executor thread for consumer &quot;)" class="string">&quot;stopping watcher executor thread for consumer &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.consumerIdString" title="=&gt; String">consumerIdString</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.watcherExecutorThread" title="=&gt; Thread">watcherExecutorThread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

    @throws<span class="delimiter">(</span>classOf<span class="delimiter">[</span>Exception<span class="delimiter">]</span><span class="delimiter">)</span>
    def <a title="(parentPath: String, curChilds: java.util.List[String])Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.handleChildChange">handleChildChange</a><span class="delimiter">(</span><a title="String" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.handleChildChange.parentPath">parentPath</a> : <span title="String">String</span>, <a title="java.util.List[String]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.handleChildChange.curChilds">curChilds</a> : java.util.<span title="java.util.List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalanceEventTriggered" title="()Unit">rebalanceEventTriggered</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    def <a title="()Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalanceEventTriggered">rebalanceEventTriggered</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../utils/Utils.scala.html#kafka.utils.Utils.inLock" title="(lock: java.util.concurrent.locks.Lock)(fun: =&gt; Unit)Unit">inLock</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.lock" title="=&gt; java.util.concurrent.locks.ReentrantLock">lock</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.isWatcherTriggered_=" title="(x$1: Boolean)Unit">isWatcherTriggered</a> = true
        <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.cond" title="=&gt; java.util.concurrent.locks.Condition">cond</a>.<span title="()Unit">signalAll</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    private def <a title="(topic: String, partition: Int)Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.deletePartitionOwnershipFromZK">deletePartitionOwnershipFromZK</a><span class="delimiter">(</span><a title="String" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.deletePartitionOwnershipFromZK.topic">topic</a>: <span title="String">String</span>, <a title="Int" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.deletePartitionOwnershipFromZK.partition">partition</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="kafka.utils.ZKGroupTopicDirs" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.deletePartitionOwnershipFromZK.topicDirs">topicDirs</a> = new <a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupTopicDirs" title="kafka.utils.ZKGroupTopicDirs">ZKGroupTopicDirs</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.group" title="=&gt; String">group</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.deletePartitionOwnershipFromZK.topic" title="String">topic</a><span class="delimiter">)</span>
      val znode = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.deletePartitionOwnershipFromZK.topicDirs" title="kafka.utils.ZKGroupTopicDirs">topicDirs</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupTopicDirs.consumerOwnerDir" title="=&gt; String">consumerOwnerDir</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <a title="String" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.deletePartitionOwnershipFromZK.znode">+</a> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.deletePartitionOwnershipFromZK.partition" title="Int">partition</a>
      <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.deletePath" title="(client: org.I0Itec.zkclient.ZkClient, path: String)Boolean">deletePath</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.deletePartitionOwnershipFromZK.znode" title="String">znode</a><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Consumer &quot;)" class="string">&quot;Consumer &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.consumerIdString" title="=&gt; String">consumerIdString</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; releasing &quot;)" class="string">&quot; releasing &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.deletePartitionOwnershipFromZK.znode" title="String">znode</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    private def <a title="(localTopicRegistry: kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]])Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.releasePartitionOwnership">releasePartitionOwnership</a><span class="delimiter">(</span><a title="kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.releasePartitionOwnership.localTopicRegistry">localTopicRegistry</a>: <a href="../utils/Pool.scala.html#kafka.utils;Pool" title="kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">Pool</a><span class="delimiter">[</span>String, Pool<span class="delimiter">[</span>Int, PartitionTopicInfo<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>= <span class="delimiter">{</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Releasing partition ownership&quot;)" class="string">&quot;Releasing partition ownership&quot;</span><span class="delimiter">)</span>
      for <span class="delimiter">(</span><span class="delimiter">(</span><a title="String" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.releasePartitionOwnership.$anonfun.topic">topic</a>, <a title="kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.releasePartitionOwnership.$anonfun.infos">infos</a><span class="delimiter">)</span> &lt;- <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.releasePartitionOwnership.localTopicRegistry" title="(f: ((String, kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo])) =&gt; kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo])Unit">localTopicRegistry</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        for<span class="delimiter">(</span><a title="Int" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.releasePartitionOwnership.$anonfun.$anonfun.partition">partition</a> &lt;- <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.releasePartitionOwnership.$anonfun.infos" title="kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]">infos</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.keys" title="(f: Int =&gt; Unit)Unit">keys</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.deletePartitionOwnershipFromZK" title="(topic: String, partition: Int)Unit">deletePartitionOwnershipFromZK</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.releasePartitionOwnership.$anonfun.topic" title="String">topic</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.releasePartitionOwnership.$anonfun.$anonfun.partition" title="Int">partition</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.removeMetric" title="(name: String, tags: scala.collection.Map[String,String])Unit">removeMetric</a><span class="delimiter">(</span><span title="String(&quot;OwnedPartitionsCount&quot;)" class="string">&quot;OwnedPartitionsCount&quot;</span>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.ownedPartitionsCountMetricTags" title="(topic: String)scala.collection.Map[String,String]">ownedPartitionsCountMetricTags</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.releasePartitionOwnership.$anonfun.topic" title="String">topic</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.releasePartitionOwnership.localTopicRegistry" title="kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">localTopicRegistry</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.remove" title="(key: String)kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]">remove</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.releasePartitionOwnership.$anonfun.topic" title="String">topic</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.allTopicsOwnedPartitionsCount_=" title="(x$1: Int)Unit">allTopicsOwnedPartitionsCount</a> = <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span>

    def <a title="()Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.resetState">resetState</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.topicRegistry_=" title="=&gt; kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">topicRegistry</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.clear" title="()Unit">clear</a>
    <span class="delimiter">}</span>

    def <a title="()Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance">syncedRebalance</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.rebalanceLock" title="=&gt; Object">rebalanceLock</a> <span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector.rebalanceTimer" title="=&gt; kafka.metrics.KafkaTimer">rebalanceTimer</a>.<a href="../metrics/KafkaTimer.scala.html#kafka.metrics;KafkaTimer.time" title="(f: =&gt; Unit)Unit">time</a> <span class="delimiter">{</span>
          if<span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.isShuttingDown" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">isShuttingDown</a>.<span title="()Boolean">get</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>  <span class="delimiter">{</span>
            return
          <span class="delimiter">}</span> else <span class="delimiter">{</span>
            for <span class="delimiter">(</span><a title="Int" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance.$anonfun.i">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(f: Int =&gt; Unit)Unit">until</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.rebalanceMaxRetries" title="=&gt; Int">rebalanceMaxRetries</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;begin rebalancing consumer &quot;)" class="string">&quot;begin rebalancing consumer &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.consumerIdString" title="=&gt; String">consumerIdString</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; try #&quot;)" class="string">&quot; try #&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance.$anonfun.i" title="Int">i</a><span class="delimiter">)</span>
              var <a title="Boolean" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance.$anonfun.done">done</a> = false
              var <a title="kafka.cluster.Cluster" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance.$anonfun.cluster">cluster</a>: <a href="../cluster/Cluster.scala.html#kafka.cluster;Cluster" title="kafka.cluster.Cluster">Cluster</a> = null
              try <span class="delimiter">{</span>
                <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance.$anonfun.cluster" title="kafka.cluster.Cluster">cluster</a> = <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.getCluster" title="(zkClient: org.I0Itec.zkclient.ZkClient)kafka.cluster.Cluster">getCluster</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a><span class="delimiter">)</span>
                <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance.$anonfun.done" title="Boolean">done</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance" title="(cluster: kafka.cluster.Cluster)Boolean">rebalance</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance.$anonfun.cluster" title="kafka.cluster.Cluster">cluster</a><span class="delimiter">)</span>
              <span class="delimiter">}</span> catch <span class="delimiter">{</span>
                case <a title="Throwable" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance.$anonfun.e">e</a>: <span title="Throwable">Throwable</span> =&gt;
                  <span class="comment">/** occasionally, we may hit a ZK exception because the ZK state is changing while we are iterating.
                    * For example, a ZK node can disappear between the time we get all children and the time we try to get
                    * the value of a child. Just let this go since another rebalance will be triggered.
                    **/</span>
                  <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;exception during rebalance &quot;)" class="string">&quot;exception during rebalance &quot;</span>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance.$anonfun.e" title="Throwable">e</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
              <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;end rebalancing consumer &quot;)" class="string">&quot;end rebalancing consumer &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.consumerIdString" title="=&gt; String">consumerIdString</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; try #&quot;)" class="string">&quot; try #&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance.$anonfun.i" title="Int">i</a><span class="delimiter">)</span>
              if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance.$anonfun.done" title="Boolean">done</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                return
              <span class="delimiter">}</span> else <span class="delimiter">{</span>
                <span class="comment">/* Here the cache is at a risk of being stale. To take future rebalancing decisions correctly, we should
                 * clear the cache */</span>
                <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Rebalancing attempt failed. Clearing the cache before the next rebalancing operation is triggered&quot;)" class="string">&quot;Rebalancing attempt failed. Clearing the cache before the next rebalancing operation is triggered&quot;</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
              <span class="comment">// stop all fetchers and clear all the queues to avoid data duplication</span>
              <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues" title="(cluster: kafka.cluster.Cluster, messageStreams: scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]], queuesToBeCleared: Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]])Unit">closeFetchersForQueues</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance.$anonfun.cluster" title="kafka.cluster.Cluster">cluster</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.kafkaMessageAndMetadataStreams" title="=&gt; scala.collection.mutable.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">kafkaMessageAndMetadataStreams</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.topicThreadIdAndQueues" title="=&gt; kafka.utils.Pool[(String, kafka.consumer.ConsumerThreadId),java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]">topicThreadIdAndQueues</a>.<span title="(f: (((String, kafka.consumer.ConsumerThreadId), java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])) =&gt; java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[((String, kafka.consumer.ConsumerThreadId), java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])],java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk],Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]])Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk],Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]]" class="delimiter">(</span><a title="((String, kafka.consumer.ConsumerThreadId), java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance.$anonfun.$anonfun.q">q</a> =&gt; <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance.$anonfun.$anonfun.q" title="((String, kafka.consumer.ConsumerThreadId), java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])">q</a>.<span title="=&gt; java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span title="Thread.type">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.rebalanceBackoffMs" title="=&gt; Long">rebalanceBackoffMs</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      throw new <a href="../common/ConsumerReblanceFailedException.scala.html#kafka.common;ConsumerRebalanceFailedException" title="kafka.common.ConsumerRebalanceFailedException">ConsumerRebalanceFailedException</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.consumerIdString" title="=&gt; String">consumerIdString</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; can\'t rebalance after &quot;)" class="string">&quot; can't rebalance after &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.rebalanceMaxRetries" title="=&gt; Int">rebalanceMaxRetries</a> <span title="(x$1: Any)String">+</span><span title="String(&quot; retries&quot;)" class="string">&quot; retries&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    private def <a title="(cluster: kafka.cluster.Cluster)Boolean" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance">rebalance</a><span class="delimiter">(</span><a title="kafka.cluster.Cluster" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.cluster">cluster</a>: <a href="../cluster/Cluster.scala.html#kafka.cluster;Cluster" title="kafka.cluster.Cluster">Cluster</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      val <a title="scala.collection.Map[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.myTopicThreadIdsMap">myTopicThreadIdsMap</a> = <a href="TopicCount.scala.html#kafka.consumer.TopicCount" title="kafka.consumer.TopicCount.type">TopicCount</a>.<a href="TopicCount.scala.html#kafka.consumer.TopicCount.constructTopicCount(14f9b37225)" title="(group: String, consumerId: String, zkClient: org.I0Itec.zkclient.ZkClient, excludeInternalTopics: Boolean)kafka.consumer.TopicCount">constructTopicCount</a><span class="delimiter">(</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.group" title="=&gt; String">group</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.consumerIdString" title="=&gt; String">consumerIdString</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.excludeInternalTopics" title="=&gt; Boolean">excludeInternalTopics</a><span class="delimiter">)</span>.<a href="TopicCount.scala.html#kafka.consumer;TopicCount.getConsumerThreadIdsPerTopic" title="=&gt; scala.collection.Map[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]]">getConsumerThreadIdsPerTopic</a>
      val <a title="Seq[kafka.cluster.Broker]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.brokers">brokers</a> = <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.getAllBrokersInCluster" title="(zkClient: org.I0Itec.zkclient.ZkClient)Seq[kafka.cluster.Broker]">getAllBrokersInCluster</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.brokers" title="Seq[kafka.cluster.Broker]">brokers</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">// This can happen in a rare case when there are no brokers available in the cluster when the consumer is started.</span>
        <span class="comment">// We log an warning and register for child changes on brokers/id so that rebalance can be triggered when the brokers</span>
        <span class="comment">// are up.</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.warn(1729dbc42f)" title="(msg: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="String(&quot;no brokers found when trying to rebalance.&quot;)" class="string">&quot;no brokers found when trying to rebalance.&quot;</span><span class="delimiter">)</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>.<span title="(x$1: String, x$2: org.I0Itec.zkclient.IZkChildListener)java.util.List[String]">subscribeChildChanges</span><span class="delimiter">(</span><a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.BrokerIdsPath" title="=&gt; String">BrokerIdsPath</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.loadBalancerListener_=" title="=&gt; ZookeeperConsumerConnector.this.ZKRebalancerListener">loadBalancerListener</a><span class="delimiter">)</span>
        true
      <span class="delimiter">}</span>
      else <span class="delimiter">{</span>
        <span class="comment">/**
         * fetchers must be stopped to avoid data duplication, since if the current
         * rebalancing attempt fails, the partitions that are released could be owned by another consumer.
         * But if we don't stop the fetchers first, this consumer would continue returning data for released
         * partitions in parallel. So, not stopping the fetchers leads to duplicate data.
         */</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchers" title="(cluster: kafka.cluster.Cluster, messageStreams: scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]], relevantTopicThreadIdsMap: scala.collection.Map[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]])Unit">closeFetchers</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.cluster" title="kafka.cluster.Cluster">cluster</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.kafkaMessageAndMetadataStreams" title="=&gt; scala.collection.mutable.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">kafkaMessageAndMetadataStreams</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.myTopicThreadIdsMap" title="scala.collection.Map[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]]">myTopicThreadIdsMap</a><span class="delimiter">)</span>

        <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.releasePartitionOwnership" title="(localTopicRegistry: kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]])Unit">releasePartitionOwnership</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.topicRegistry_=" title="=&gt; kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">topicRegistry</a><span class="delimiter">)</span>

        val <a title="kafka.consumer.AssignmentContext" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.assignmentContext">assignmentContext</a> = new <a href="PartitionAssignor.scala.html#kafka.consumer;AssignmentContext" title="kafka.consumer.AssignmentContext">AssignmentContext</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.group" title="=&gt; String">group</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.consumerIdString" title="=&gt; String">consumerIdString</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.excludeInternalTopics" title="=&gt; Boolean">excludeInternalTopics</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a><span class="delimiter">)</span>
        val <a title="scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.partitionOwnershipDecision">partitionOwnershipDecision</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.partitionAssignor" title="=&gt; kafka.consumer.PartitionAssignor with kafka.utils.Logging{def assign(ctx: kafka.consumer.AssignmentContext): scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]}">partitionAssignor</a>.<span title="(ctx: kafka.consumer.AssignmentContext)scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]">assign</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.assignmentContext" title="kafka.consumer.AssignmentContext">assignmentContext</a><span class="delimiter">)</span>
        val <a title="kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.currentTopicRegistry">currentTopicRegistry</a> = new <a href="../utils/Pool.scala.html#kafka.utils;Pool" title="kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">Pool</a><span class="delimiter">[</span>String, Pool<span class="delimiter">[</span>Int, PartitionTopicInfo<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span>
          valueFactory = <span title="(x: String =&gt; kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo])Some[String =&gt; kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">Some</span><span class="delimiter">(</span><span class="delimiter">(</span>topic: <span title="String">String</span><span class="delimiter">)</span> =&gt; new <a href="../utils/Pool.scala.html#kafka.utils;Pool" title="kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]">Pool</a><span class="delimiter">[</span>Int, PartitionTopicInfo<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="comment">// fetch current offsets for all topic-partitions</span>
        val <a title="Seq[kafka.common.TopicAndPartition]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.topicPartitions">topicPartitions</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.partitionOwnershipDecision" title="scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]">partitionOwnershipDecision</a>.<span title="=&gt; scala.collection.Set[kafka.common.TopicAndPartition]">keySet</span>.<span title="=&gt; Seq[kafka.common.TopicAndPartition]">toSeq</span>

        val <a title="Option[kafka.api.OffsetFetchResponse]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.offsetFetchResponseOpt">offsetFetchResponseOpt</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.fetchOffsets" title="(partitions: Seq[kafka.common.TopicAndPartition])Option[kafka.api.OffsetFetchResponse]">fetchOffsets</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.topicPartitions" title="Seq[kafka.common.TopicAndPartition]">topicPartitions</a><span class="delimiter">)</span>

        if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.isShuttingDown" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">isShuttingDown</a>.<span title="()Boolean">get</span> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.offsetFetchResponseOpt" title="Option[kafka.api.OffsetFetchResponse]">offsetFetchResponseOpt</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span>
          false
        else <span class="delimiter">{</span>
          val <a title="kafka.api.OffsetFetchResponse" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.offsetFetchResponse">offsetFetchResponse</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.offsetFetchResponseOpt" title="Option[kafka.api.OffsetFetchResponse]">offsetFetchResponseOpt</a>.<span title="=&gt; kafka.api.OffsetFetchResponse">get</span>
          <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.topicPartitions" title="Seq[kafka.common.TopicAndPartition]">topicPartitions</a>.<span title="(f: kafka.common.TopicAndPartition =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="kafka.common.TopicAndPartition" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.topicAndPartition">topicAndPartition</a> =&gt; <span class="delimiter">{</span>
            val <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.x$5.topic" title="(String, Int)" class="delimiter">(</a><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.x$5" title="String" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.x$5.topic">topic</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.x$5" title="Int" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.partition">partition</a><span class="delimiter">)</span> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.topicAndPartition" title="kafka.common.TopicAndPartition">topicAndPartition</a>.<a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition.asTuple" title="=&gt; (String, Int)">asTuple</a>
            val <a title="Long" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.offset">offset</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.offsetFetchResponse" title="kafka.api.OffsetFetchResponse">offsetFetchResponse</a>.<a href="../api/OffsetFetchResponse.scala.html#kafka.api;OffsetFetchResponse.requestInfo" title="(key: kafka.common.TopicAndPartition)kafka.common.OffsetMetadataAndError">requestInfo</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.topicAndPartition" title="kafka.common.TopicAndPartition">topicAndPartition</a><span class="delimiter">)</span>.<a href="../common/OffsetMetadataAndError.scala.html#kafka.common;OffsetMetadataAndError.offset" title="=&gt; Long">offset</a>
            val <a title="kafka.consumer.ConsumerThreadId" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.threadId">threadId</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.partitionOwnershipDecision" title="(key: kafka.common.TopicAndPartition)kafka.consumer.ConsumerThreadId">partitionOwnershipDecision</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.topicAndPartition" title="kafka.common.TopicAndPartition">topicAndPartition</a><span class="delimiter">)</span>
            <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo" title="(currentTopicRegistry: kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]], partition: Int, topic: String, offset: Long, consumerThreadId: kafka.consumer.ConsumerThreadId)Unit">addPartitionTopicInfo</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.currentTopicRegistry" title="kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">currentTopicRegistry</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.partition" title="Int">partition</a>, <span title="String">topic</span>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.offset" title="Long">offset</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.threadId" title="kafka.consumer.ConsumerThreadId">threadId</a><span class="delimiter">)</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>

          <span class="comment">/**
           * move the partition ownership here, since that can be used to indicate a truly successful rebalancing attempt
           * A rebalancing attempt is completed successfully only after the fetchers have been started correctly
           */</span>
          if<span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision" title="(partitionOwnershipDecision: scala.collection.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId])Boolean">reflectPartitionOwnershipDecision</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.partitionOwnershipDecision" title="scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]">partitionOwnershipDecision</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.allTopicsOwnedPartitionsCount_=" title="(x$1: Int)Unit">allTopicsOwnedPartitionsCount</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.partitionOwnershipDecision" title="scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]">partitionOwnershipDecision</a>.<span title="=&gt; Int">size</span>

            <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.partitionOwnershipDecision" title="scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]">partitionOwnershipDecision</a>.<span title="=&gt; scala.collection.IterableView[(kafka.common.TopicAndPartition, kafka.consumer.ConsumerThreadId),scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]]">view</span>.<span title="(f: ((kafka.common.TopicAndPartition, kafka.consumer.ConsumerThreadId)) =&gt; String)scala.collection.immutable.Map[String,scala.collection.IterableView[(kafka.common.TopicAndPartition, kafka.consumer.ConsumerThreadId),scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]]]">groupBy</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.x0$7" title="String" class="delimiter">{</a> case<span class="delimiter">(</span><a title="kafka.common.TopicAndPartition" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.topicPartition">topicPartition</a>, <a title="kafka.consumer.ConsumerThreadId" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.consumerThreadId">consumerThreadId</a><span class="delimiter">)</span> =&gt; <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.topicPartition" title="kafka.common.TopicAndPartition">topicPartition</a>.<a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition.topic" title="=&gt; String">topic</a> <span class="delimiter">}</span>
                                      .<span title="(f: ((String, scala.collection.IterableView[(kafka.common.TopicAndPartition, kafka.consumer.ConsumerThreadId),scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]])) =&gt; com.yammer.metrics.core.Gauge[Int])Unit">foreach</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.x0$8" title="com.yammer.metrics.core.Gauge[Int]" class="delimiter">{</a> case <span class="delimiter">(</span><span title="String">topic</span>, <a title="scala.collection.IterableView[(kafka.common.TopicAndPartition, kafka.consumer.ConsumerThreadId),scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.partitionThreadPairs">partitionThreadPairs</a><span class="delimiter">)</span> =&gt;
              <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newGauge" title="(name: String, metric: com.yammer.metrics.core.Gauge[Int], tags: scala.collection.Map[String,String])com.yammer.metrics.core.Gauge[Int]">newGauge</a><span class="delimiter">(</span><span title="String(&quot;OwnedPartitionsCount&quot;)" class="string">&quot;OwnedPartitionsCount&quot;</span>,
                new <a title="&lt;$anon: com.yammer.metrics.core.Gauge[Int]&gt; extends com.yammer.metrics.core.Gauge[Int]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun;$anon">Gauge</a><span class="delimiter">[</span>Int<span class="delimiter">]</span> <span class="delimiter">{</span>
                  def <a title="()Int" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun;$anon.value">value</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.$anonfun.partitionThreadPairs" title="scala.collection.IterableView[(kafka.common.TopicAndPartition, kafka.consumer.ConsumerThreadId),scala.collection.mutable.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]]">partitionThreadPairs</a>.<span title="=&gt; Int">size</span>
                <span class="delimiter">}</span>,
                <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.ownedPartitionsCountMetricTags" title="(topic: String)scala.collection.Map[String,String]">ownedPartitionsCountMetricTags</a><span class="delimiter">(</span><span title="String">topic</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>

            <a href="#kafka.consumer;ZookeeperConsumerConnector.topicRegistry_=" title="(x$1: kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]])Unit">topicRegistry</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.currentTopicRegistry" title="kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">currentTopicRegistry</a>
            <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher" title="(cluster: kafka.cluster.Cluster)Unit">updateFetcher</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.rebalance.cluster" title="kafka.cluster.Cluster">cluster</a><span class="delimiter">)</span>
            true
          <span class="delimiter">}</span> else <span class="delimiter">{</span>
            false
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    private def <a title="(cluster: kafka.cluster.Cluster, messageStreams: scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]], queuesToBeCleared: Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]])Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues">closeFetchersForQueues</a><span class="delimiter">(</span><a title="kafka.cluster.Cluster" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues.cluster">cluster</a>: <a href="../cluster/Cluster.scala.html#kafka.cluster;Cluster" title="kafka.cluster.Cluster">Cluster</a>,
                                       <a title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues.messageStreams">messageStreams</a>: <span title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">Map</span><span class="delimiter">[</span>String,List<span class="delimiter">[</span>KafkaStream<span class="delimiter">[</span>_,_<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>,
                                       <a title="Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues.queuesToBeCleared">queuesToBeCleared</a>: <span title="Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]">Iterable</span><span class="delimiter">[</span>BlockingQueue<span class="delimiter">[</span>FetchedDataChunk<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="Iterable[kafka.consumer.PartitionTopicInfo]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues.allPartitionInfos">allPartitionInfos</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.topicRegistry_=" title="=&gt; kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">topicRegistry</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.values" title="=&gt; Iterable[kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">values</a>.<span title="(f: kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo] =&gt; Iterable[kafka.consumer.PartitionTopicInfo])(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]],Iterable[kafka.consumer.PartitionTopicInfo],Iterable[Iterable[kafka.consumer.PartitionTopicInfo]]])Iterable[Iterable[kafka.consumer.PartitionTopicInfo]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,Iterable[kafka.consumer.PartitionTopicInfo],Iterable[Iterable[kafka.consumer.PartitionTopicInfo]]]" class="delimiter">(</span><a title="kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues.allPartitionInfos.$anonfun.p">p</a> =&gt; <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues.allPartitionInfos.$anonfun.p" title="kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]">p</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.values" title="=&gt; Iterable[kafka.consumer.PartitionTopicInfo]">values</a><span class="delimiter">)</span>.<span title="(implicit asTraversable: Iterable[kafka.consumer.PartitionTopicInfo] =&gt; scala.collection.GenTraversableOnce[kafka.consumer.PartitionTopicInfo])Iterable[kafka.consumer.PartitionTopicInfo]">flatten</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.fetcher_=" title="=&gt; Option[kafka.consumer.ConsumerFetcherManager]">fetcher</a> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><a title="kafka.consumer.ConsumerFetcherManager" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues.f">f</a><span class="delimiter">)</span> =&gt;
          <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues.f" title="kafka.consumer.ConsumerFetcherManager">f</a>.<a href="ConsumerFetcherManager.scala.html#kafka.consumer;ConsumerFetcherManager.stopConnections" title="()Unit">stopConnections</a>
          <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.clearFetcherQueues" title="(topicInfos: Iterable[kafka.consumer.PartitionTopicInfo], cluster: kafka.cluster.Cluster, queuesTobeCleared: Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]], messageStreams: scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]])Unit">clearFetcherQueues</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues.allPartitionInfos" title="Iterable[kafka.consumer.PartitionTopicInfo]">allPartitionInfos</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues.cluster" title="kafka.cluster.Cluster">cluster</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues.queuesToBeCleared" title="Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]">queuesToBeCleared</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues.messageStreams" title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">messageStreams</a><span class="delimiter">)</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Committing all offsets after clearing the fetcher queues&quot;)" class="string">&quot;Committing all offsets after clearing the fetcher queues&quot;</span><span class="delimiter">)</span>
          <span class="comment">/**
          * here, we need to commit offsets before stopping the consumer from returning any more messages
          * from the current data chunk. Since partition ownership is not yet released, this commit offsets
          * call will ensure that the offsets committed now will be used by the next consumer thread owning the partition
          * for the current data chunk. Since the fetchers are already shutdown and this is the last chunk to be iterated
          * by the consumer, there will be no more messages returned by this iterator until the rebalancing finishes
          * successfully and the fetchers restart to fetch more data chunks
          **/</span>
        if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.autoCommitEnable" title="=&gt; Boolean">autoCommitEnable</a><span class="delimiter">)</span>
          <a href="#kafka.consumer;ZookeeperConsumerConnector.commitOffsets(e3e274127f)" title="(isAutoCommit: Boolean)Unit">commitOffsets</a><span class="delimiter">(</span>true<span class="delimiter">)</span>
        case <span title="None.type">None</span> =&gt;
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    private def <a title="(topicInfos: Iterable[kafka.consumer.PartitionTopicInfo], cluster: kafka.cluster.Cluster, queuesTobeCleared: Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]], messageStreams: scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]])Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.clearFetcherQueues">clearFetcherQueues</a><span class="delimiter">(</span><a title="Iterable[kafka.consumer.PartitionTopicInfo]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.clearFetcherQueues.topicInfos">topicInfos</a>: <span title="Iterable[kafka.consumer.PartitionTopicInfo]">Iterable</span><span class="delimiter">[</span>PartitionTopicInfo<span class="delimiter">]</span>, <a title="kafka.cluster.Cluster" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.clearFetcherQueues.cluster">cluster</a>: <a href="../cluster/Cluster.scala.html#kafka.cluster;Cluster" title="kafka.cluster.Cluster">Cluster</a>,
                                   <a title="Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.clearFetcherQueues.queuesTobeCleared">queuesTobeCleared</a>: <span title="Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]">Iterable</span><span class="delimiter">[</span>BlockingQueue<span class="delimiter">[</span>FetchedDataChunk<span class="delimiter">]</span><span class="delimiter">]</span>,
                                   <a title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.clearFetcherQueues.messageStreams">messageStreams</a>: <span title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">Map</span><span class="delimiter">[</span>String,List<span class="delimiter">[</span>KafkaStream<span class="delimiter">[</span>_,_<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>

      <span class="comment">// Clear all but the currently iterated upon chunk in the consumer thread's queue</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.clearFetcherQueues.queuesTobeCleared" title="Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]">queuesTobeCleared</a>.<span title="(f: java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk] =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.clearFetcherQueues.$anonfun.x$6" title="java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]">_</a>.<span title="()Unit">clear</span><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Cleared all relevant queues for this fetcher&quot;)" class="string">&quot;Cleared all relevant queues for this fetcher&quot;</span><span class="delimiter">)</span>

      <span class="comment">// Also clear the currently iterated upon chunk in the consumer threads</span>
      if<span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.clearFetcherQueues.messageStreams" title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">messageStreams</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
         <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.clearFetcherQueues.messageStreams" title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">messageStreams</a>.<span title="(f: ((String, List[kafka.consumer.KafkaStream[_, _]])) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.clearFetcherQueues.$anonfun.x$7" title="(String, List[kafka.consumer.KafkaStream[_, _]])">_</a>.<span title="=&gt; List[kafka.consumer.KafkaStream[_, _]]">_2</span>.<span title="(f: kafka.consumer.KafkaStream[_, _] =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="kafka.consumer.KafkaStream[_, _]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.clearFetcherQueues.$anonfun.$anonfun.s">s</a> =&gt; <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.clearFetcherQueues.$anonfun.$anonfun.s" title="kafka.consumer.KafkaStream[_, _]">s</a>.<a href="KafkaStream.scala.html#kafka.consumer;KafkaStream.clear" title="()Unit">clear</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Cleared the data chunks in all the consumer message iterators&quot;)" class="string">&quot;Cleared the data chunks in all the consumer message iterators&quot;</span><span class="delimiter">)</span>

    <span class="delimiter">}</span>

    private def <a title="(cluster: kafka.cluster.Cluster, messageStreams: scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]], relevantTopicThreadIdsMap: scala.collection.Map[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]])Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchers">closeFetchers</a><span class="delimiter">(</span><a title="kafka.cluster.Cluster" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchers.cluster">cluster</a>: <a href="../cluster/Cluster.scala.html#kafka.cluster;Cluster" title="kafka.cluster.Cluster">Cluster</a>, <a title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchers.messageStreams">messageStreams</a>: <span title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">Map</span><span class="delimiter">[</span>String,List<span class="delimiter">[</span>KafkaStream<span class="delimiter">[</span>_,_<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>,
                              <a title="scala.collection.Map[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchers.relevantTopicThreadIdsMap">relevantTopicThreadIdsMap</a>: <span title="scala.collection.Map[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]]">Map</span><span class="delimiter">[</span>String, Set<span class="delimiter">[</span>ConsumerThreadId<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// only clear the fetcher queues for certain topic partitions that *might* no longer be served by this consumer</span>
      <span class="comment">// after this rebalancing attempt</span>
      val <a title="Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchers.queuesTobeCleared">queuesTobeCleared</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.topicThreadIdAndQueues" title="=&gt; kafka.utils.Pool[(String, kafka.consumer.ConsumerThreadId),java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]">topicThreadIdAndQueues</a>.<span title="(p: (((String, kafka.consumer.ConsumerThreadId), java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])) =&gt; Boolean)Iterable[((String, kafka.consumer.ConsumerThreadId), java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])]">filter</span><span class="delimiter">(</span><span title="((String, kafka.consumer.ConsumerThreadId), java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])">q</span> =&gt; <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchers.relevantTopicThreadIdsMap" title="scala.collection.Map[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]]">relevantTopicThreadIdsMap</a>.<span title="(key: String)Boolean">contains</span><span class="delimiter">(</span><span title="((String, kafka.consumer.ConsumerThreadId), java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])">q</span>.<span title="=&gt; (String, kafka.consumer.ConsumerThreadId)">_1</span>.<span title="=&gt; String">_1</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: (((String, kafka.consumer.ConsumerThreadId), java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])) =&gt; java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[((String, kafka.consumer.ConsumerThreadId), java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])],java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk],Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]])Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk],Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]]" class="delimiter">(</span><span title="((String, kafka.consumer.ConsumerThreadId), java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])">q</span> =&gt; <span title="((String, kafka.consumer.ConsumerThreadId), java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])">q</span>.<span title="=&gt; java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]">_2</span><span class="delimiter">)</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchersForQueues" title="(cluster: kafka.cluster.Cluster, messageStreams: scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]], queuesToBeCleared: Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]])Unit">closeFetchersForQueues</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchers.cluster" title="kafka.cluster.Cluster">cluster</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchers.messageStreams" title="scala.collection.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">messageStreams</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.closeFetchers.queuesTobeCleared" title="Iterable[java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]">queuesTobeCleared</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    private def <a title="(cluster: kafka.cluster.Cluster)Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher">updateFetcher</a><span class="delimiter">(</span><a title="kafka.cluster.Cluster" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.cluster">cluster</a>: <a href="../cluster/Cluster.scala.html#kafka.cluster;Cluster" title="kafka.cluster.Cluster">Cluster</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// update partitions for fetcher</span>
      var <a title="List[kafka.consumer.PartitionTopicInfo]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.allPartitionInfos">allPartitionInfos</a> : <span title="List[kafka.consumer.PartitionTopicInfo]">List</span><span class="delimiter">[</span>PartitionTopicInfo<span class="delimiter">]</span> = <span title="scala.collection.immutable.Nil.type">Nil</span>
      for <span class="delimiter">(</span><a title="kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.$anonfun.partitionInfos">partitionInfos</a> &lt;- <a href="#kafka.consumer;ZookeeperConsumerConnector.topicRegistry_=" title="=&gt; kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">topicRegistry</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.values" title="(f: kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo] =&gt; Unit)Unit">values</a><span class="delimiter">)</span>
        for <span class="delimiter">(</span><a title="kafka.consumer.PartitionTopicInfo" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.$anonfun.$anonfun.partition">partition</a> &lt;- <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.$anonfun.partitionInfos" title="kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]">partitionInfos</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.values" title="(f: kafka.consumer.PartitionTopicInfo =&gt; Unit)Unit">values</a><span class="delimiter">)</span>
          <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.allPartitionInfos" title="List[kafka.consumer.PartitionTopicInfo]">allPartitionInfos</a> <span title="(x: kafka.consumer.PartitionTopicInfo)List[kafka.consumer.PartitionTopicInfo]">::=</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.$anonfun.$anonfun.partition" title="kafka.consumer.PartitionTopicInfo">partition</a>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Consumer &quot;)" class="string">&quot;Consumer &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.consumerIdString" title="=&gt; String">consumerIdString</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; selected partitions : &quot;)" class="string">&quot; selected partitions : &quot;</span> <span title="(x$1: Any)String">+</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.allPartitionInfos" title="List[kafka.consumer.PartitionTopicInfo]">allPartitionInfos</a>.<span title="(lt: (kafka.consumer.PartitionTopicInfo, kafka.consumer.PartitionTopicInfo) =&gt; Boolean)List[kafka.consumer.PartitionTopicInfo]">sortWith</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="kafka.consumer.PartitionTopicInfo" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.$anonfun.s">s</a>,<a title="kafka.consumer.PartitionTopicInfo" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.$anonfun.t">t</a><span class="delimiter">)</span> =&gt; <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.$anonfun.s" title="kafka.consumer.PartitionTopicInfo">s</a>.<a href="PartitionTopicInfo.scala.html#kafka.consumer;PartitionTopicInfo.partitionId" title="=&gt; Int">partitionId</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.$anonfun.t" title="kafka.consumer.PartitionTopicInfo">t</a>.<a href="PartitionTopicInfo.scala.html#kafka.consumer;PartitionTopicInfo.partitionId" title="=&gt; Int">partitionId</a><span class="delimiter">)</span>.<span title="(f: kafka.consumer.PartitionTopicInfo =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[kafka.consumer.PartitionTopicInfo],String,List[String]])List[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.$anonfun.x$8" title="kafka.consumer.PartitionTopicInfo">_</a>.<a href="PartitionTopicInfo.scala.html#kafka.consumer;PartitionTopicInfo.toString" title="()String">toString</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#kafka.consumer;ZookeeperConsumerConnector.fetcher_=" title="=&gt; Option[kafka.consumer.ConsumerFetcherManager]">fetcher</a> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><a title="kafka.consumer.ConsumerFetcherManager" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.f">f</a><span class="delimiter">)</span> =&gt;
          <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.f" title="kafka.consumer.ConsumerFetcherManager">f</a>.<a href="ConsumerFetcherManager.scala.html#kafka.consumer;ConsumerFetcherManager.startConnections" title="(topicInfos: Iterable[kafka.consumer.PartitionTopicInfo], cluster: kafka.cluster.Cluster)Unit">startConnections</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.allPartitionInfos" title="List[kafka.consumer.PartitionTopicInfo]">allPartitionInfos</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.updateFetcher.cluster" title="kafka.cluster.Cluster">cluster</a><span class="delimiter">)</span>
        case <span title="None.type">None</span> =&gt;
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    private def <a title="(partitionOwnershipDecision: scala.collection.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId])Boolean" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision">reflectPartitionOwnershipDecision</a><span class="delimiter">(</span><a title="scala.collection.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipDecision">partitionOwnershipDecision</a>: <span title="scala.collection.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]">Map</span><span class="delimiter">[</span>TopicAndPartition, ConsumerThreadId<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      var <a title="List[(String, Int)]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.successfullyOwnedPartitions">successfullyOwnedPartitions</a> : <span title="List[(String, Int)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>String, Int<span class="delimiter">)</span><span class="delimiter">]</span> = <span title="scala.collection.immutable.Nil.type">Nil</span>
      val <a title="Iterable[Boolean]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful">partitionOwnershipSuccessful</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipDecision" title="scala.collection.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId]">partitionOwnershipDecision</a>.<span title="(f: ((kafka.common.TopicAndPartition, kafka.consumer.ConsumerThreadId)) =&gt; Boolean)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.Map[kafka.common.TopicAndPartition,kafka.consumer.ConsumerThreadId],Boolean,Iterable[Boolean]])Iterable[Boolean]">map</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,Boolean,Iterable[Boolean]]" class="delimiter">{</span> <a title="(kafka.common.TopicAndPartition, kafka.consumer.ConsumerThreadId)" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.partitionOwner">partitionOwner</a> =&gt;
        val <a title="String" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.topic">topic</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.partitionOwner" title="(kafka.common.TopicAndPartition, kafka.consumer.ConsumerThreadId)">partitionOwner</a>.<span title="=&gt; kafka.common.TopicAndPartition">_1</span>.<a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition.topic" title="=&gt; String">topic</a>
        val <a title="Int" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.partition">partition</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.partitionOwner" title="(kafka.common.TopicAndPartition, kafka.consumer.ConsumerThreadId)">partitionOwner</a>.<span title="=&gt; kafka.common.TopicAndPartition">_1</span>.<a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition.partition" title="=&gt; Int">partition</a>
        val <a title="kafka.consumer.ConsumerThreadId" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.consumerThreadId">consumerThreadId</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.partitionOwner" title="(kafka.common.TopicAndPartition, kafka.consumer.ConsumerThreadId)">partitionOwner</a>.<span title="=&gt; kafka.consumer.ConsumerThreadId">_2</span>
        val <a title="String" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.partitionOwnerPath">partitionOwnerPath</a> = <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.getConsumerPartitionOwnerPath" title="(group: String, topic: String, partition: Int)String">getConsumerPartitionOwnerPath</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.group" title="=&gt; String">group</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.topic" title="String">topic</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.partition" title="Int">partition</a><span class="delimiter">)</span>
        try <span class="delimiter">{</span>
          <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.createEphemeralPathExpectConflict" title="(client: org.I0Itec.zkclient.ZkClient, path: String, data: String)Unit">createEphemeralPathExpectConflict</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.partitionOwnerPath" title="String">partitionOwnerPath</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.consumerThreadId" title="kafka.consumer.ConsumerThreadId">consumerThreadId</a>.<a href="TopicCount.scala.html#kafka.consumer;ConsumerThreadId.toString" title="()String">toString</a><span class="delimiter">)</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.consumerThreadId" title="(self: kafka.consumer.ConsumerThreadId)any2stringadd[kafka.consumer.ConsumerThreadId]">consumerThreadId</a> <span title="(other: String)String">+</span> <span title="String(&quot; successfully owned partition &quot;)" class="string">&quot; successfully owned partition &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.partition" title="Int">partition</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; for topic &quot;)" class="string">&quot; for topic &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.topic" title="String">topic</a><span class="delimiter">)</span>
          <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.successfullyOwnedPartitions" title="List[(String, Int)]">successfullyOwnedPartitions</a> <span title="(x: (String, Int))List[(String, Int)]">::=</span> <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.topic" title="String">topic</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.partition" title="Int">partition</a><span class="delimiter">)</span>
          true
        <span class="delimiter">}</span> catch <span class="delimiter">{</span>
          case <a title="org.I0Itec.zkclient.exception.ZkNodeExistsException" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.e">e</a>: <span title="org.I0Itec.zkclient.exception.ZkNodeExistsException">ZkNodeExistsException</span> =&gt;
            <span class="comment">// The node hasn't been deleted by the original owner. So wait a bit and retry.</span>
            <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;waiting for the partition ownership to be deleted: &quot;)" class="string">&quot;waiting for the partition ownership to be deleted: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.partition" title="Int">partition</a><span class="delimiter">)</span>
            false
          case <a title="Throwable" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.e2">e2</a>: <span title="Throwable">Throwable</span> =&gt; throw <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful.$anonfun.e2" title="Throwable">e2</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      val <a title="Int" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.hasPartitionOwnershipFailed">hasPartitionOwnershipFailed</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.partitionOwnershipSuccessful" title="Iterable[Boolean]">partitionOwnershipSuccessful</a>.<span title="(z: Int)(op: (Int, Boolean) =&gt; Int)Int">foldLeft</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="Int" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.hasPartitionOwnershipFailed.$anonfun.sum">sum</a>, <a title="Boolean" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.hasPartitionOwnershipFailed.$anonfun.decision">decision</a><span class="delimiter">)</span> =&gt; <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.hasPartitionOwnershipFailed.$anonfun.sum" title="Int">sum</a> <span title="(x: Int)Int">+</span> <span class="delimiter">(</span>if<span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.hasPartitionOwnershipFailed.$anonfun.decision" title="Boolean">decision</a><span class="delimiter">)</span> <span title="Int(0)" class="int">0</span> else <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="comment">/* even if one of the partition ownership attempt has failed, return false */</span>
      if<span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.hasPartitionOwnershipFailed" title="Int">hasPartitionOwnershipFailed</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">// remove all paths that we have owned in ZK</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.successfullyOwnedPartitions" title="List[(String, Int)]">successfullyOwnedPartitions</a>.<span title="(f: ((String, Int)) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="(String, Int)" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.$anonfun.topicAndPartition">topicAndPartition</a> =&gt; <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.deletePartitionOwnershipFromZK" title="(topic: String, partition: Int)Unit">deletePartitionOwnershipFromZK</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.$anonfun.topicAndPartition" title="(String, Int)">topicAndPartition</a>.<span title="=&gt; String">_1</span>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.reflectPartitionOwnershipDecision.$anonfun.topicAndPartition" title="(String, Int)">topicAndPartition</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>
        false
      <span class="delimiter">}</span>
      else true
    <span class="delimiter">}</span>

    private def <a title="(currentTopicRegistry: kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]], partition: Int, topic: String, offset: Long, consumerThreadId: kafka.consumer.ConsumerThreadId)Unit" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo">addPartitionTopicInfo</a><span class="delimiter">(</span><a title="kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.currentTopicRegistry">currentTopicRegistry</a>: <a href="../utils/Pool.scala.html#kafka.utils;Pool" title="kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">Pool</a><span class="delimiter">[</span>String, Pool<span class="delimiter">[</span>Int, PartitionTopicInfo<span class="delimiter">]</span><span class="delimiter">]</span>,
                                      <a title="Int" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.partition">partition</a>: <span title="Int">Int</span>, <a title="String" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.topic">topic</a>: <span title="String">String</span>,
                                      <a title="Long" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.offset">offset</a>: <span title="Long">Long</span>, <a title="kafka.consumer.ConsumerThreadId" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.consumerThreadId">consumerThreadId</a>: <a href="TopicCount.scala.html#kafka.consumer;ConsumerThreadId" title="kafka.consumer.ConsumerThreadId">ConsumerThreadId</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.partTopicInfoMap">partTopicInfoMap</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.currentTopicRegistry" title="kafka.utils.Pool[String,kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]]">currentTopicRegistry</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.getAndMaybePut" title="(key: String)kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]">getAndMaybePut</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.topic" title="String">topic</a><span class="delimiter">)</span>

      val <a title="java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.queue">queue</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.topicThreadIdAndQueues" title="=&gt; kafka.utils.Pool[(String, kafka.consumer.ConsumerThreadId),java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]">topicThreadIdAndQueues</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.get" title="(key: (String, kafka.consumer.ConsumerThreadId))java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]">get</a><span class="delimiter">(</span><span title="(_1: String, _2: kafka.consumer.ConsumerThreadId)(String, kafka.consumer.ConsumerThreadId)" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.topic" title="String">topic</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.consumerThreadId" title="kafka.consumer.ConsumerThreadId">consumerThreadId</a><span class="delimiter">)</span><span class="delimiter">)</span>
      val <a title="java.util.concurrent.atomic.AtomicLong" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.consumedOffset">consumedOffset</a> = new <span title="java.util.concurrent.atomic.AtomicLong">AtomicLong</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.offset" title="Long">offset</a><span class="delimiter">)</span>
      val <a title="java.util.concurrent.atomic.AtomicLong" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.fetchedOffset">fetchedOffset</a> = new <span title="java.util.concurrent.atomic.AtomicLong">AtomicLong</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.offset" title="Long">offset</a><span class="delimiter">)</span>
      val <a title="kafka.consumer.PartitionTopicInfo" id="kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.partTopicInfo">partTopicInfo</a> = new <a href="PartitionTopicInfo.scala.html#kafka.consumer;PartitionTopicInfo" title="kafka.consumer.PartitionTopicInfo">PartitionTopicInfo</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.topic" title="String">topic</a>,
                                                 <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.partition" title="Int">partition</a>,
                                                 <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.queue" title="java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]">queue</a>,
                                                 <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.consumedOffset" title="java.util.concurrent.atomic.AtomicLong">consumedOffset</a>,
                                                 <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.fetchedOffset" title="java.util.concurrent.atomic.AtomicLong">fetchedOffset</a>,
                                                 new <span title="java.util.concurrent.atomic.AtomicInteger">AtomicInteger</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.fetchMessageMaxBytes" title="=&gt; Int">fetchMessageMaxBytes</a><span class="delimiter">)</span>,
                                                 <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.clientId" title="=&gt; String">clientId</a><span class="delimiter">)</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.partTopicInfoMap" title="kafka.utils.Pool[Int,kafka.consumer.PartitionTopicInfo]">partTopicInfoMap</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.put" title="(k: Int, v: kafka.consumer.PartitionTopicInfo)kafka.consumer.PartitionTopicInfo">put</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.partition" title="Int">partition</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.partTopicInfo" title="kafka.consumer.PartitionTopicInfo">partTopicInfo</a><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.partTopicInfo" title="(self: kafka.consumer.PartitionTopicInfo)any2stringadd[kafka.consumer.PartitionTopicInfo]">partTopicInfo</a> <span title="(other: String)String">+</span> <span title="String(&quot; selected new offset &quot;)" class="string">&quot; selected new offset &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.offset" title="Long">offset</a><span class="delimiter">)</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.checkpointedZkOffsets" title="=&gt; kafka.utils.Pool[kafka.common.TopicAndPartition,Long]">checkpointedZkOffsets</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.put" title="(k: kafka.common.TopicAndPartition, v: Long)Long">put</a><span title="Unit" class="delimiter">(</span><a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition" title="(topic: String, partition: Int)kafka.common.TopicAndPartition">TopicAndPartition</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.topic" title="String">topic</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.partition" title="Int">partition</a><span class="delimiter">)</span>, <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.addPartitionTopicInfo.offset" title="Long">offset</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="[K, V](topicCount: kafka.consumer.TopicCount, queuesAndStreams: List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])])Unit" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer">reinitializeConsumer</a><span class="delimiter">[</span><a title="" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer;K">K</a>,<a title="" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer;V">V</a><span class="delimiter">]</span><span class="delimiter">(</span>
      <a title="kafka.consumer.TopicCount" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.topicCount">topicCount</a>: <a href="TopicCount.scala.html#kafka.consumer;TopicCount" title="kafka.consumer.TopicCount">TopicCount</a>,
      <a title="List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.queuesAndStreams">queuesAndStreams</a>: <span title="List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>LinkedBlockingQueue<span class="delimiter">[</span>FetchedDataChunk<span class="delimiter">]</span>,KafkaStream<span class="delimiter">[</span>K,V<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>

    val <a title="kafka.utils.ZKGroupDirs" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.dirs">dirs</a> = new <a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupDirs" title="kafka.utils.ZKGroupDirs">ZKGroupDirs</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.groupId" title="=&gt; String">groupId</a><span class="delimiter">)</span>

    <span class="comment">// listener to consumer and partition changes</span>
    if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.loadBalancerListener_=" title="=&gt; ZookeeperConsumerConnector.this.ZKRebalancerListener">loadBalancerListener</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
      val <span title="scala.collection.mutable.HashMap[String,List[kafka.consumer.KafkaStream[K,V]]]">topicStreamsMap</span> = new mutable.<span title="scala.collection.mutable.HashMap[String,List[kafka.consumer.KafkaStream[K,V]]]">HashMap</span><span class="delimiter">[</span>String,List<span class="delimiter">[</span>KafkaStream<span class="delimiter">[</span>K,V<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.loadBalancerListener_=" title="(x$1: ZookeeperConsumerConnector.this.ZKRebalancerListener)Unit">loadBalancerListener</a> = new <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener" title="ZookeeperConsumerConnector.this.ZKRebalancerListener">ZKRebalancerListener</a><span class="delimiter">(</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.groupId" title="=&gt; String">groupId</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.consumerIdString" title="=&gt; String">consumerIdString</a>, <span title="scala.collection.mutable.HashMap[String,List[kafka.consumer.KafkaStream[K,V]]]">topicStreamsMap</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.collection.mutable.Map[String,List[kafka.consumer.KafkaStream[_, _]]]" class="delimiter">[</span>scala.collection.mutable.<span title="scala.collection.mutable.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">Map</span><span class="delimiter">[</span>String, List<span class="delimiter">[</span>KafkaStream<span class="delimiter">[</span>_,_<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">// create listener for session expired event if not exist yet</span>
    if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.sessionExpirationListener_=" title="=&gt; ZookeeperConsumerConnector.this.ZKSessionExpireListener">sessionExpirationListener</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.sessionExpirationListener_=" title="(x$1: ZookeeperConsumerConnector.this.ZKSessionExpireListener)Unit">sessionExpirationListener</a> = new <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKSessionExpireListener" title="ZookeeperConsumerConnector.this.ZKSessionExpireListener">ZKSessionExpireListener</a><span class="delimiter">(</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.dirs" title="kafka.utils.ZKGroupDirs">dirs</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.consumerIdString" title="=&gt; String">consumerIdString</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.topicCount" title="kafka.consumer.TopicCount">topicCount</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.loadBalancerListener_=" title="=&gt; ZookeeperConsumerConnector.this.ZKRebalancerListener">loadBalancerListener</a><span class="delimiter">)</span>

    <span class="comment">// create listener for topic partition change event if not exist yet</span>
    if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.topicPartitionChangeListener_=" title="=&gt; ZookeeperConsumerConnector.this.ZKTopicPartitionChangeListener">topicPartitionChangeListener</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.topicPartitionChangeListener_=" title="(x$1: ZookeeperConsumerConnector.this.ZKTopicPartitionChangeListener)Unit">topicPartitionChangeListener</a> = new <a href="#kafka.consumer;ZookeeperConsumerConnector;ZKTopicPartitionChangeListener" title="ZookeeperConsumerConnector.this.ZKTopicPartitionChangeListener">ZKTopicPartitionChangeListener</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.loadBalancerListener_=" title="=&gt; ZookeeperConsumerConnector.this.ZKRebalancerListener">loadBalancerListener</a><span class="delimiter">)</span>

    val <span title="scala.collection.mutable.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">topicStreamsMap</span> = <a href="#kafka.consumer;ZookeeperConsumerConnector.loadBalancerListener_=" title="=&gt; ZookeeperConsumerConnector.this.ZKRebalancerListener">loadBalancerListener</a>.<a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.kafkaMessageAndMetadataStreams" title="=&gt; scala.collection.mutable.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">kafkaMessageAndMetadataStreams</a>

    <span class="comment">// map of {topic -&gt; Set(thread-1, thread-2, ...)}</span>
    val <a title="scala.collection.Map[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]]" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.consumerThreadIdsPerTopic">consumerThreadIdsPerTopic</a>: <span title="scala.collection.Map[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]]">Map</span><span class="delimiter">[</span>String, Set<span class="delimiter">[</span>ConsumerThreadId<span class="delimiter">]</span><span class="delimiter">]</span> =
      <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.topicCount" title="kafka.consumer.TopicCount">topicCount</a>.<a href="TopicCount.scala.html#kafka.consumer;TopicCount.getConsumerThreadIdsPerTopic" title="=&gt; scala.collection.Map[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]]">getConsumerThreadIdsPerTopic</a>

    val <a title="List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.allQueuesAndStreams">allQueuesAndStreams</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.topicCount" title="kafka.consumer.TopicCount">topicCount</a> match <span class="delimiter">{</span>
      case <a title="kafka.consumer.WildcardTopicCount" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.allQueuesAndStreams.wildTopicCount">wildTopicCount</a>: <a href="TopicCount.scala.html#kafka.consumer;WildcardTopicCount" title="kafka.consumer.WildcardTopicCount">WildcardTopicCount</a> =&gt;
        <span class="comment">/*
         * Wild-card consumption streams share the same queues, so we need to
         * duplicate the list for the subsequent zip operation.
         */</span>
        <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.consumerThreadIdsPerTopic" title="scala.collection.Map[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]]">consumerThreadIdsPerTopic</a>.<span title="=&gt; scala.collection.Set[String]">keySet</span>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; scala.collection.GenTraversableOnce[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Int],(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]),scala.collection.immutable.IndexedSeq[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]])scala.collection.immutable.IndexedSeq[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq.Coll,(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]),scala.collection.immutable.IndexedSeq[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]]" class="delimiter">(</span><a title="Int" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.allQueuesAndStreams.$anonfun.x$9">_</a> =&gt; <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.queuesAndStreams" title="List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">queuesAndStreams</a><span class="delimiter">)</span>.<span title="=&gt; List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">toList</span>
      case <a title="kafka.consumer.StaticTopicCount" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.allQueuesAndStreams.statTopicCount">statTopicCount</a>: <a href="TopicCount.scala.html#kafka.consumer;StaticTopicCount" title="kafka.consumer.StaticTopicCount">StaticTopicCount</a> =&gt;
        <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.queuesAndStreams" title="List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">queuesAndStreams</a>
    <span class="delimiter">}</span>

    val <a title="Iterable[(String, kafka.consumer.ConsumerThreadId)]" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.topicThreadIds">topicThreadIds</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.consumerThreadIdsPerTopic" title="scala.collection.Map[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]]">consumerThreadIdsPerTopic</a>.<span title="(f: ((String, scala.collection.Set[kafka.consumer.ConsumerThreadId])) =&gt; scala.collection.Set[(String, kafka.consumer.ConsumerThreadId)])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.Map[String,scala.collection.Set[kafka.consumer.ConsumerThreadId]],scala.collection.Set[(String, kafka.consumer.ConsumerThreadId)],Iterable[scala.collection.Set[(String, kafka.consumer.ConsumerThreadId)]]])Iterable[scala.collection.Set[(String, kafka.consumer.ConsumerThreadId)]]">map</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.topicThreadIds.$anonfun.x0$9" title="scala.collection.Set[(String, kafka.consumer.ConsumerThreadId)]" class="delimiter">{</a>
      case<span class="delimiter">(</span><a title="String" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.topicThreadIds.$anonfun.topic">topic</a>, <a title="scala.collection.Set[kafka.consumer.ConsumerThreadId]" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.topicThreadIds.$anonfun.threadIds">threadIds</a><span class="delimiter">)</span> =&gt;
        <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.topicThreadIds.$anonfun.threadIds" title="scala.collection.Set[kafka.consumer.ConsumerThreadId]">threadIds</a>.<span title="(f: kafka.consumer.ConsumerThreadId =&gt; (String, kafka.consumer.ConsumerThreadId))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.Set[kafka.consumer.ConsumerThreadId],(String, kafka.consumer.ConsumerThreadId),scala.collection.Set[(String, kafka.consumer.ConsumerThreadId)]])scala.collection.Set[(String, kafka.consumer.ConsumerThreadId)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Set.Coll,(String, kafka.consumer.ConsumerThreadId),scala.collection.Set[(String, kafka.consumer.ConsumerThreadId)]]" class="delimiter">(</span><span title="(_1: String, _2: kafka.consumer.ConsumerThreadId)(String, kafka.consumer.ConsumerThreadId)" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.topicThreadIds.$anonfun.topic" title="String">topic</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.topicThreadIds.$anonfun.$anonfun.x$10" title="kafka.consumer.ConsumerThreadId">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="(implicit asTraversable: scala.collection.Set[(String, kafka.consumer.ConsumerThreadId)] =&gt; scala.collection.GenTraversableOnce[(String, kafka.consumer.ConsumerThreadId)])Iterable[(String, kafka.consumer.ConsumerThreadId)]">flatten</span>

    <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.topicThreadIds" title="Iterable[(String, kafka.consumer.ConsumerThreadId)]">topicThreadIds</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.allQueuesAndStreams" title="List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">allQueuesAndStreams</a>.<span title="=&gt; Int">size</span>,
      <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Mismatch between thread ID count (%d) and queue count (%d)&quot;</span>
      .<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.topicThreadIds" title="Iterable[(String, kafka.consumer.ConsumerThreadId)]">topicThreadIds</a>.<span title="=&gt; Int">size</span>, <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.allQueuesAndStreams" title="List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">allQueuesAndStreams</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span><span class="delimiter">)</span>
    val <a title="Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))]" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.threadQueueStreamPairs">threadQueueStreamPairs</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.topicThreadIds" title="Iterable[(String, kafka.consumer.ConsumerThreadId)]">topicThreadIds</a>.<span title="(that: scala.collection.GenIterable[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])])(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[(String, kafka.consumer.ConsumerThreadId)],((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])),Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))]])Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))]">zip</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])),Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))]]" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.allQueuesAndStreams" title="List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">allQueuesAndStreams</a><span class="delimiter">)</span>

    <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.threadQueueStreamPairs" title="Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))]">threadQueueStreamPairs</a>.<span title="(f: (((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))) =&gt; com.yammer.metrics.core.Gauge[Int])Unit">foreach</span><span class="delimiter">(</span><span title="((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))">e</span> =&gt; <span class="delimiter">{</span>
      val <a title="(String, kafka.consumer.ConsumerThreadId)" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.topicThreadId">topicThreadId</a> = <span title="((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))">e</span>.<span title="=&gt; (String, kafka.consumer.ConsumerThreadId)">_1</span>
      val <a title="java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk]" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.q">q</a> = <span title="((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))">e</span>.<span title="=&gt; (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])">_2</span>.<span title="=&gt; java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk]">_1</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.topicThreadIdAndQueues" title="=&gt; kafka.utils.Pool[(String, kafka.consumer.ConsumerThreadId),java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]]">topicThreadIdAndQueues</a>.<a href="../utils/Pool.scala.html#kafka.utils;Pool.put" title="(k: (String, kafka.consumer.ConsumerThreadId), v: java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk])java.util.concurrent.BlockingQueue[kafka.consumer.FetchedDataChunk]">put</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.topicThreadId" title="(String, kafka.consumer.ConsumerThreadId)">topicThreadId</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.q" title="java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk]">q</a><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Adding topicThreadId %s and queue %s to topicThreadIdAndQueues data structure&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.topicThreadId" title="(String, kafka.consumer.ConsumerThreadId)">topicThreadId</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.q" title="java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk]">q</a>.<span title="()String">toString</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newGauge" title="(name: String, metric: com.yammer.metrics.core.Gauge[Int], tags: scala.collection.Map[String,String])com.yammer.metrics.core.Gauge[Int]">newGauge</a><span class="delimiter">(</span>
        <span title="String(&quot;FetchQueueSize&quot;)" class="string">&quot;FetchQueueSize&quot;</span>,
        new <a title="&lt;$anon: com.yammer.metrics.core.Gauge[Int]&gt; extends com.yammer.metrics.core.Gauge[Int]" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun;$anon">Gauge</a><span class="delimiter">[</span>Int<span class="delimiter">]</span> <span class="delimiter">{</span>
          def <a title="()Int" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun;$anon.value">value</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.q" title="java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk]">q</a>.<span title="()Int">size</span>
        <span class="delimiter">}</span>,
        <span title="(elems: (String, String)*)scala.collection.Map[String,String]">Map</span><span class="delimiter">(</span><span title="(self: String)ArrowAssoc[String]" class="string">&quot;clientId&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.clientId" title="=&gt; String">clientId</a>,
          <span title="(self: String)ArrowAssoc[String]" class="string">&quot;topic&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.topicThreadId" title="(String, kafka.consumer.ConsumerThreadId)">topicThreadId</a>.<span title="=&gt; String">_1</span>,
          <span title="(self: String)ArrowAssoc[String]" class="string">&quot;threadId&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.topicThreadId" title="(String, kafka.consumer.ConsumerThreadId)">topicThreadId</a>.<span title="=&gt; kafka.consumer.ConsumerThreadId">_2</span>.<a href="TopicCount.scala.html#kafka.consumer;ConsumerThreadId.threadId" title="=&gt; Int">threadId</a>.<span title="()String">toString</span><span class="delimiter">)</span>
      <span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    val <a title="scala.collection.immutable.Map[String,Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))]]" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.groupedByTopic">groupedByTopic</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.threadQueueStreamPairs" title="Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))]">threadQueueStreamPairs</a>.<span title="(f: (((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))) =&gt; String)scala.collection.immutable.Map[String,Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))]]">groupBy</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.groupedByTopic.$anonfun.x$11" title="((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))">_</a>.<span title="=&gt; (String, kafka.consumer.ConsumerThreadId)">_1</span>.<span title="=&gt; String">_1</span><span class="delimiter">)</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.groupedByTopic" title="scala.collection.immutable.Map[String,Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))]]">groupedByTopic</a>.<span title="(f: ((String, Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))])) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><span title="(String, Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))])">e</span> =&gt; <span class="delimiter">{</span>
      val <a title="String" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.topic">topic</a> = <span title="(String, Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))])">e</span>.<span title="=&gt; String">_1</span>
      val <a title="List[kafka.consumer.KafkaStream[K,V]]" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.streams">streams</a> = <span title="(String, Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))])">e</span>.<span title="=&gt; Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))]">_2</span>.<span title="(f: (((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))) =&gt; kafka.consumer.KafkaStream[K,V])(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))],kafka.consumer.KafkaStream[K,V],Iterable[kafka.consumer.KafkaStream[K,V]]])Iterable[kafka.consumer.KafkaStream[K,V]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,kafka.consumer.KafkaStream[K,V],Iterable[kafka.consumer.KafkaStream[K,V]]]" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.streams.$anonfun.x$12" title="((String, kafka.consumer.ConsumerThreadId), (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))">_</a>.<span title="=&gt; (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])">_2</span>.<span title="=&gt; kafka.consumer.KafkaStream[K,V]">_2</span><span class="delimiter">)</span>.<span title="=&gt; List[kafka.consumer.KafkaStream[K,V]]">toList</span>
      <span title="scala.collection.mutable.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">topicStreamsMap</span> <span title="(kv: (String, List[kafka.consumer.KafkaStream[_, _]]))topicStreamsMap.type">+=</span> <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.topic" title="(self: String)ArrowAssoc[String]">topic</a> <span title="(y: List[kafka.consumer.KafkaStream[K,V]])(String, List[kafka.consumer.KafkaStream[K,V]])">-&gt;</span> <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.streams" title="List[kafka.consumer.KafkaStream[K,V]]">streams</a><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;adding topic %s and %d streams to map.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.topic" title="String">topic</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.streams" title="List[kafka.consumer.KafkaStream[K,V]]">streams</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <span class="comment">// listener to consumer and partition changes</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>.<span title="(x$1: org.I0Itec.zkclient.IZkStateListener)Unit">subscribeStateChanges</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.sessionExpirationListener_=" title="=&gt; ZookeeperConsumerConnector.this.ZKSessionExpireListener">sessionExpirationListener</a><span class="delimiter">)</span>

    <a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>.<span title="(x$1: String, x$2: org.I0Itec.zkclient.IZkChildListener)java.util.List[String]">subscribeChildChanges</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.dirs" title="kafka.utils.ZKGroupDirs">dirs</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupDirs.consumerRegistryDir" title="=&gt; String">consumerRegistryDir</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.loadBalancerListener_=" title="=&gt; ZookeeperConsumerConnector.this.ZKRebalancerListener">loadBalancerListener</a><span class="delimiter">)</span>

    <span title="scala.collection.mutable.Map[String,List[kafka.consumer.KafkaStream[_, _]]]">topicStreamsMap</span>.<span title="(f: ((String, List[kafka.consumer.KafkaStream[_, _]])) =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="(String, List[kafka.consumer.KafkaStream[_, _]])" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.topicAndStreams">topicAndStreams</a> =&gt;
      <span class="comment">// register on broker partition path changes</span>
      val topicPath = <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.BrokerTopicsPath" title="=&gt; String">BrokerTopicsPath</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <a title="String" id="kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.topicPath">+</a> <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.topicAndStreams" title="(String, List[kafka.consumer.KafkaStream[_, _]])">topicAndStreams</a>.<span title="=&gt; String">_1</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>.<span title="(x$1: String, x$2: org.I0Itec.zkclient.IZkDataListener)Unit">subscribeDataChanges</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer.$anonfun.topicPath" title="String">topicPath</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.topicPartitionChangeListener_=" title="=&gt; ZookeeperConsumerConnector.this.ZKTopicPartitionChangeListener">topicPartitionChangeListener</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">// explicitly trigger load balancing for this consumer</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.loadBalancerListener_=" title="=&gt; ZookeeperConsumerConnector.this.ZKRebalancerListener">loadBalancerListener</a>.<a href="#kafka.consumer;ZookeeperConsumerConnector;ZKRebalancerListener.syncedRebalance" title="()Unit">syncedRebalance</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  class <a title="class WildcardStreamsHandler[K, V] extends AnyRef with kafka.consumer.TopicEventHandler[String]" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler">WildcardStreamsHandler</a><span class="delimiter">[</span><a title="" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler;K">K</a>,<a title="" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler;V">V</a><span class="delimiter">]</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler" title="ZookeeperConsumerConnector.this.WildcardStreamsHandler[K,V]" class="delimiter">(</a><a title="kafka.consumer.TopicFilter" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.topicFilter">topicFilter</a>: <a href="TopicFilter.scala.html#kafka.consumer;TopicFilter" title="kafka.consumer.TopicFilter">TopicFilter</a>,
                                  <a title="Int" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.numStreams">numStreams</a>: <span title="Int">Int</span>,
                                  <a title="kafka.serializer.Decoder[K]" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.keyDecoder">keyDecoder</a>: <a href="../serializer/Decoder.scala.html#kafka.serializer;Decoder" title="kafka.serializer.Decoder[K]">Decoder</a><span class="delimiter">[</span>K<span class="delimiter">]</span>,
                                  <a title="kafka.serializer.Decoder[V]" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.valueDecoder">valueDecoder</a>: <a href="../serializer/Decoder.scala.html#kafka.serializer;Decoder" title="kafka.serializer.Decoder[V]">Decoder</a><span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">)</span>
                                extends <a href="TopicEventHandler.scala.html#kafka.consumer;TopicEventHandler" title="kafka.consumer.TopicEventHandler[String]">TopicEventHandler</a><span class="delimiter">[</span>String<span class="delimiter">]</span> <span class="delimiter">{</span>

    if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.messageStreamCreated" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">messageStreamCreated</a>.<span title="(x$1: Boolean)Boolean">getAndSet</span><span class="delimiter">(</span>true<span class="delimiter">)</span><span class="delimiter">)</span>
      throw new <span title="RuntimeException">RuntimeException</span><span class="delimiter">(</span><span class="string">&quot;Each consumer connector can create &quot;</span> <span title="String(&quot;Each consumer connector can create message streams by filter at most once.&quot;)">+</span>
        <span class="string">&quot;message streams by filter at most once.&quot;</span><span class="delimiter">)</span>

    private val <a title="List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardQueuesAndStreams">wildcardQueuesAndStreams</a> = <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.numStreams" title="Int">numStreams</a><span class="delimiter">)</span>
      .<span title="(f: Int =&gt; (java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Int],(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]),scala.collection.immutable.IndexedSeq[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]])scala.collection.immutable.IndexedSeq[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq.Coll,(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V]),scala.collection.immutable.IndexedSeq[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]]" class="delimiter">(</span><a title="Int" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardQueuesAndStreams.$anonfun.e">e</a> =&gt; <span class="delimiter">{</span>
        val <a title="java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk]" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardQueuesAndStreams.$anonfun.queue">queue</a> = new <span title="java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk]">LinkedBlockingQueue</span><span class="delimiter">[</span>FetchedDataChunk<span class="delimiter">]</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.queuedMaxMessages" title="=&gt; Int">queuedMaxMessages</a><span class="delimiter">)</span>
        val <a title="kafka.consumer.KafkaStream[K,V]" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardQueuesAndStreams.$anonfun.stream">stream</a> = new <a href="KafkaStream.scala.html#kafka.consumer;KafkaStream" title="kafka.consumer.KafkaStream[K,V]">KafkaStream</a><span class="delimiter">[</span>K,V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardQueuesAndStreams.$anonfun.queue" title="java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk]">queue</a>,
                                          <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.consumerTimeoutMs" title="=&gt; Int">consumerTimeoutMs</a>,
                                          <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.keyDecoder" title="kafka.serializer.Decoder[K]">keyDecoder</a>,
                                          <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.valueDecoder" title="kafka.serializer.Decoder[V]">valueDecoder</a>,
                                          <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.clientId" title="=&gt; String">clientId</a><span class="delimiter">)</span>
        <span title="(_1: java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], _2: kafka.consumer.KafkaStream[K,V])(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardQueuesAndStreams.$anonfun.queue" title="java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk]">queue</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardQueuesAndStreams.$anonfun.stream" title="kafka.consumer.KafkaStream[K,V]">stream</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="=&gt; List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">toList</span>

     <span class="comment">// bootstrap with existing topics</span>
    private var <a title="Seq[String]" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardTopics_=">wildcardTopics</a> =
      <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.getChildrenParentMayNotExist" title="(client: org.I0Itec.zkclient.ZkClient, path: String)Seq[String]">getChildrenParentMayNotExist</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.BrokerTopicsPath" title="=&gt; String">BrokerTopicsPath</a><span class="delimiter">)</span>
        .<span title="(p: String =&gt; Boolean)Seq[String]">filter</span><span class="delimiter">(</span><a title="String" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardTopics.$anonfun.topic">topic</a> =&gt; <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.topicFilter" title="kafka.consumer.TopicFilter">topicFilter</a>.<a href="TopicFilter.scala.html#kafka.consumer;TopicFilter.isTopicAllowed" title="(topic: String, excludeInternalTopics: Boolean)Boolean">isTopicAllowed</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardTopics.$anonfun.topic" title="String">topic</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.excludeInternalTopics" title="=&gt; Boolean">excludeInternalTopics</a><span class="delimiter">)</span><span class="delimiter">)</span>

    private val <a title="kafka.consumer.WildcardTopicCount" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardTopicCount">wildcardTopicCount</a> = <a href="TopicCount.scala.html#kafka.consumer.TopicCount" title="kafka.consumer.TopicCount.type">TopicCount</a>.<a href="TopicCount.scala.html#kafka.consumer.TopicCount.constructTopicCount(addd7c4fb4)" title="(consumerIdString: String, filter: kafka.consumer.TopicFilter, numStreams: Int, zkClient: org.I0Itec.zkclient.ZkClient, excludeInternalTopics: Boolean)kafka.consumer.WildcardTopicCount">constructTopicCount</a><span class="delimiter">(</span>
      <a href="#kafka.consumer;ZookeeperConsumerConnector.consumerIdString" title="=&gt; String">consumerIdString</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.topicFilter" title="kafka.consumer.TopicFilter">topicFilter</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.numStreams" title="Int">numStreams</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.excludeInternalTopics" title="=&gt; Boolean">excludeInternalTopics</a><span class="delimiter">)</span>

    val <a title="kafka.utils.ZKGroupDirs" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.dirs">dirs</a> = new <a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupDirs" title="kafka.utils.ZKGroupDirs">ZKGroupDirs</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.groupId" title="=&gt; String">groupId</a><span class="delimiter">)</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.registerConsumerInZK" title="(dirs: kafka.utils.ZKGroupDirs, consumerIdString: String, topicCount: kafka.consumer.TopicCount)Unit">registerConsumerInZK</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.dirs" title="=&gt; kafka.utils.ZKGroupDirs">dirs</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.consumerIdString" title="=&gt; String">consumerIdString</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardTopicCount" title="=&gt; kafka.consumer.WildcardTopicCount">wildcardTopicCount</a><span class="delimiter">)</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer" title="(topicCount: kafka.consumer.TopicCount, queuesAndStreams: List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])])Unit">reinitializeConsumer</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardTopicCount" title="=&gt; kafka.consumer.WildcardTopicCount">wildcardTopicCount</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardQueuesAndStreams" title="=&gt; List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">wildcardQueuesAndStreams</a><span class="delimiter">)</span>

    <span class="comment">/*
     * Topic events will trigger subsequent synced rebalances.
     */</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Creating topic event watcher for topics &quot;)" class="string">&quot;Creating topic event watcher for topics &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.topicFilter" title="kafka.consumer.TopicFilter">topicFilter</a><span class="delimiter">)</span>
    <a href="#kafka.consumer;ZookeeperConsumerConnector.wildcardTopicWatcher_=" title="(x$1: kafka.consumer.ZookeeperTopicEventWatcher)Unit">wildcardTopicWatcher</a> = new <a href="ZookeeperTopicEventWatcher.scala.html#kafka.consumer;ZookeeperTopicEventWatcher" title="kafka.consumer.ZookeeperTopicEventWatcher">ZookeeperTopicEventWatcher</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector.zkClient_=" title="=&gt; org.I0Itec.zkclient.ZkClient">zkClient</a>, this<span class="delimiter">)</span>

    def <a title="(allTopics: Seq[String])Unit" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent">handleTopicEvent</a><span class="delimiter">(</span><a title="Seq[String]" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.allTopics">allTopics</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Handling topic event&quot;)" class="string">&quot;Handling topic event&quot;</span><span class="delimiter">)</span>

      val <a title="Seq[String]" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.updatedTopics">updatedTopics</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.allTopics" title="Seq[String]">allTopics</a>.<span title="(p: String =&gt; Boolean)Seq[String]">filter</span><span class="delimiter">(</span><a title="String" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.updatedTopics.$anonfun.topic">topic</a> =&gt; <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.topicFilter" title="kafka.consumer.TopicFilter">topicFilter</a>.<a href="TopicFilter.scala.html#kafka.consumer;TopicFilter.isTopicAllowed" title="(topic: String, excludeInternalTopics: Boolean)Boolean">isTopicAllowed</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.updatedTopics.$anonfun.topic" title="String">topic</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector.config" title="=&gt; kafka.consumer.ConsumerConfig">config</a>.<a href="ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig.excludeInternalTopics" title="=&gt; Boolean">excludeInternalTopics</a><span class="delimiter">)</span><span class="delimiter">)</span>

      val addedTopics = <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.updatedTopics" title="Seq[String]">updatedTopics</a> <a title="Seq[String]" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.addedTopics">filterNot</a> <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardTopics_=" title="=&gt; Seq[String]">wildcardTopics</a> <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.addedTopics.$anonfun.elem" title="(elem: Any)Boolean">contains</a><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.addedTopics" title="Seq[String]">addedTopics</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Topic event: added topics = %s&quot;</span>
                             .<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.addedTopics" title="Seq[String]">addedTopics</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="comment">/*
       * TODO: Deleted topics are interesting (and will not be a concern until
       * 0.8 release). We may need to remove these topics from the rebalance
       * listener's map in reinitializeConsumer.
       */</span>
      val deletedTopics = <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardTopics_=" title="=&gt; Seq[String]">wildcardTopics</a> <a title="Seq[String]" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.deletedTopics">filterNot</a> <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.updatedTopics" title="Seq[String]">updatedTopics</a> <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.deletedTopics.$anonfun.elem" title="(elem: Any)Boolean">contains</a><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.deletedTopics" title="Seq[String]">deletedTopics</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Topic event: deleted topics = %s&quot;</span>
                             .<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.deletedTopics" title="Seq[String]">deletedTopics</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardTopics_=" title="(x$1: Seq[String])Unit">wildcardTopics</a> = <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.updatedTopics" title="Seq[String]">updatedTopics</a>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Topics to consume = %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardTopics_=" title="=&gt; Seq[String]">wildcardTopics</a><span class="delimiter">)</span><span class="delimiter">)</span>

      if <span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.addedTopics" title="Seq[String]">addedTopics</a>.<span title="=&gt; Boolean">nonEmpty</span> <span title="(x: Boolean)Boolean">||</span> <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.handleTopicEvent.deletedTopics" title="Seq[String]">deletedTopics</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span>
        <a href="#kafka.consumer;ZookeeperConsumerConnector.reinitializeConsumer" title="(topicCount: kafka.consumer.TopicCount, queuesAndStreams: List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])])Unit">reinitializeConsumer</a><span class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardTopicCount" title="=&gt; kafka.consumer.WildcardTopicCount">wildcardTopicCount</a>, <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardQueuesAndStreams" title="=&gt; List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">wildcardQueuesAndStreams</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    def <a title="=&gt; Seq[kafka.consumer.KafkaStream[K,V]]" id="kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.streams">streams</a>: <span title="Seq[kafka.consumer.KafkaStream[K,V]]">Seq</span><span class="delimiter">[</span>KafkaStream<span class="delimiter">[</span>K,V<span class="delimiter">]</span><span class="delimiter">]</span> =
      <a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.wildcardQueuesAndStreams" title="=&gt; List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])]">wildcardQueuesAndStreams</a>.<span title="(f: ((java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])) =&gt; kafka.consumer.KafkaStream[K,V])(implicit bf: scala.collection.generic.CanBuildFrom[List[(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])],kafka.consumer.KafkaStream[K,V],Seq[kafka.consumer.KafkaStream[K,V]]])Seq[kafka.consumer.KafkaStream[K,V]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,kafka.consumer.KafkaStream[K,V],List[kafka.consumer.KafkaStream[K,V]]]" class="delimiter">(</span><a href="#kafka.consumer;ZookeeperConsumerConnector;WildcardStreamsHandler.streams.$anonfun.x$13" title="(java.util.concurrent.LinkedBlockingQueue[kafka.consumer.FetchedDataChunk], kafka.consumer.KafkaStream[K,V])">_</a>.<span title="=&gt; kafka.consumer.KafkaStream[K,V]">_2</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
