<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>kafka/kafka/admin/PreferredReplicaLeaderElectionCommand.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>
package kafka.admin

import joptsimple.OptionParser
import kafka.utils._
import org.I0Itec.zkclient.ZkClient
import org.I0Itec.zkclient.exception.ZkNodeExistsException
import kafka.common.<span class="delimiter">{</span>TopicAndPartition, AdminCommandFailedException<span class="delimiter">}</span>
import collection._
import mutable.ListBuffer

object <a title="kafka.admin.PreferredReplicaLeaderElectionCommand.type" id="kafka.admin.PreferredReplicaLeaderElectionCommand">PreferredReplicaLeaderElectionCommand</a> extends <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> <span class="delimiter">{</span>

  def <a title="(args: Array[String])Unit" id="kafka.admin.PreferredReplicaLeaderElectionCommand.main">main</a><span class="delimiter">(</span><a title="Array[String]" id="kafka.admin.PreferredReplicaLeaderElectionCommand.main.args">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val <a title="joptsimple.OptionParser" id="kafka.admin.PreferredReplicaLeaderElectionCommand.main.parser">parser</a> = new <span title="joptsimple.OptionParser">OptionParser</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.admin.PreferredReplicaLeaderElectionCommand.main.jsonFileOpt">jsonFileOpt</a> = <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;path-to-json-file&quot;)" class="string">&quot;path-to-json-file&quot;</span>, <span class="string">&quot;The JSON file with the list of partitions &quot;</span> +
      <span class="string">&quot;for which preferred replica leader election should be done, in the following format - \n&quot;</span> +
       <span class="string">&quot;{\&quot;partitions\&quot;:\n\t[{\&quot;topic\&quot;: \&quot;foo\&quot;, \&quot;partition\&quot;: 1},\n\t {\&quot;topic\&quot;: \&quot;foobar\&quot;, \&quot;partition\&quot;: 2}]\n}\n&quot;</span> <span title="String(&quot;The JSON file with the list of partitions for which preferred replica leader election should be done, in the following format - \n{\&quot;partitions\&quot;:\n\t[{\&quot;topic\&quot;: \&quot;foo\&quot;, \&quot;partition\&quot;: 1},\n\t {\&quot;topic\&quot;: \&quot;foobar\&quot;, \&quot;partition\&quot;: 2}]\n}\nDefaults to all existing partitions&quot;)">+</span>
      <span class="string">&quot;Defaults to all existing partitions&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;list of partitions for which preferred replica leader election needs to be triggered&quot;)" class="string">&quot;list of partitions for which preferred replica leader election needs to be triggered&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.admin.PreferredReplicaLeaderElectionCommand.main.zkConnectOpt">zkConnectOpt</a> = <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;zookeeper&quot;)" class="string">&quot;zookeeper&quot;</span>, <span class="string">&quot;REQUIRED: The connection string for the zookeeper connection in the &quot;</span> <span title="String(&quot;REQUIRED: The connection string for the zookeeper connection in the form host:port. Multiple URLS can be given to allow fail-over.&quot;)">+</span>
      <span class="string">&quot;form host:port. Multiple URLS can be given to allow fail-over.&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;urls&quot;)" class="string">&quot;urls&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>
      
    if<span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.args" title="Array[String]">args</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils" title="kafka.utils.CommandLineUtils.type">CommandLineUtils</a>.<a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils.printUsageAndDie" title="(parser: joptsimple.OptionParser, message: String)Unit">printUsageAndDie</a><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.parser" title="joptsimple.OptionParser">parser</a>, <span class="string">&quot;This tool causes leadership for each partition to be transferred back to the 'preferred replica',&quot;</span> <span title="String(&quot;This tool causes leadership for each partition to be transferred back to the \'preferred replica\', it can be used to balance leadership among the servers.&quot;)">+</span> 
                                                <span class="string">&quot; it can be used to balance leadership among the servers.&quot;</span><span class="delimiter">)</span>

    val <a title="joptsimple.OptionSet" id="kafka.admin.PreferredReplicaLeaderElectionCommand.main.options">options</a> = <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String*)joptsimple.OptionSet">parse</span><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.args" title="Array[String]">args</a> : _*<span class="delimiter">)</span>

    <a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils" title="kafka.utils.CommandLineUtils.type">CommandLineUtils</a>.<a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils.checkRequiredArgs" title="(parser: joptsimple.OptionParser, options: joptsimple.OptionSet, required: joptsimple.OptionSpec[_]*)Unit">checkRequiredArgs</a><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.parser" title="joptsimple.OptionParser">parser</a>, <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.options" title="joptsimple.OptionSet">options</a>, <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.zkConnectOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">zkConnectOpt</a><span class="delimiter">)</span>

    val <a title="String" id="kafka.admin.PreferredReplicaLeaderElectionCommand.main.zkConnect">zkConnect</a> = <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])String">valueOf</span><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.zkConnectOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">zkConnectOpt</a><span class="delimiter">)</span>
    var <a title="org.I0Itec.zkclient.ZkClient" id="kafka.admin.PreferredReplicaLeaderElectionCommand.main.zkClient">zkClient</a>: <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span> = null

    try <span class="delimiter">{</span>
      <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a> = new <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.zkConnect" title="String">zkConnect</a>, <span title="Int(30000)" class="int">30000</span>, <span title="Int(30000)" class="int">30000</span>, <a href="../utils/ZkUtils.scala.html#kafka.utils.ZKStringSerializer" title="kafka.utils.ZKStringSerializer.type">ZKStringSerializer</a><span class="delimiter">)</span>
      val <a title="scala.collection.Set[kafka.common.TopicAndPartition]" id="kafka.admin.PreferredReplicaLeaderElectionCommand.main.partitionsForPreferredReplicaElection">partitionsForPreferredReplicaElection</a> =
        if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.jsonFileOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">jsonFileOpt</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.getAllPartitions" title="(zkClient: org.I0Itec.zkclient.ZkClient)scala.collection.Set[kafka.common.TopicAndPartition]">getAllPartitions</a><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a><span class="delimiter">)</span>
        else
          <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData" title="(jsonString: String)scala.collection.immutable.Set[kafka.common.TopicAndPartition]">parsePreferredReplicaElectionData</a><span class="delimiter">(</span><a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Utils.scala.html#kafka.utils.Utils.readFileAsString" title="(path: String, charset: java.nio.charset.Charset)String">readFileAsString</a><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])String">valueOf</span><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.jsonFileOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">jsonFileOpt</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      val <a title="kafka.admin.PreferredReplicaLeaderElectionCommand" id="kafka.admin.PreferredReplicaLeaderElectionCommand.main.preferredReplicaElectionCommand">preferredReplicaElectionCommand</a> = new <a href="#kafka.admin;PreferredReplicaLeaderElectionCommand" title="kafka.admin.PreferredReplicaLeaderElectionCommand">PreferredReplicaLeaderElectionCommand</a><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.partitionsForPreferredReplicaElection" title="scala.collection.Set[kafka.common.TopicAndPartition]">partitionsForPreferredReplicaElection</a><span class="delimiter">)</span>

      <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.preferredReplicaElectionCommand" title="kafka.admin.PreferredReplicaLeaderElectionCommand">preferredReplicaElectionCommand</a>.<a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.moveLeaderToPreferredReplica" title="()Unit">moveLeaderToPreferredReplica</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Successfully started preferred replica election for partitions %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.partitionsForPreferredReplicaElection" title="scala.collection.Set[kafka.common.TopicAndPartition]">partitionsForPreferredReplicaElection</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> catch <span class="delimiter">{</span>
      case <a title="Throwable" id="kafka.admin.PreferredReplicaLeaderElectionCommand.main.e">e</a>: <span title="Throwable">Throwable</span> =&gt;
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;Failed to start preferred replica election&quot;)" class="string">&quot;Failed to start preferred replica election&quot;</span><span class="delimiter">)</span>
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Utils.scala.html#kafka.utils.Utils.stackTrace" title="(e: Throwable)String">stackTrace</a><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.e" title="Throwable">e</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> finally <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
        <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.main.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(jsonString: String)scala.collection.immutable.Set[kafka.common.TopicAndPartition]" id="kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData">parsePreferredReplicaElectionData</a><span class="delimiter">(</span><a title="String" id="kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.jsonString">jsonString</a>: <span title="String">String</span><span class="delimiter">)</span>: immutable.<span title="scala.collection.immutable.Set[kafka.common.TopicAndPartition]">Set</span><span class="delimiter">[</span>TopicAndPartition<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="../utils/Json.scala.html#kafka.utils.Json" title="kafka.utils.Json.type">Json</a>.<a href="../utils/Json.scala.html#kafka.utils.Json.parseFull" title="(input: String)Option[Any]">parseFull</a><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.jsonString" title="String">jsonString</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="Any" id="kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.m">m</a><span class="delimiter">)</span> =&gt;
        <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.m" title="Any">m</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.collection.Map[String,Any]" class="delimiter">[</span><span title="scala.collection.Map[String,Any]">Map</span><span class="delimiter">[</span>String, Any<span class="delimiter">]</span><span class="delimiter">]</span>.<span title="(key: String)Option[Any]">get</span><span class="delimiter">(</span><span title="String(&quot;partitions&quot;)" class="string">&quot;partitions&quot;</span><span class="delimiter">)</span> match <span class="delimiter">{</span>
          case Some<span class="delimiter">(</span><a title="Any" id="kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitionsList">partitionsList</a><span class="delimiter">)</span> =&gt;
            val <a title="List[scala.collection.Map[String,Any]]" id="kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitionsRaw">partitionsRaw</a> = <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitionsList" title="Any">partitionsList</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="List[scala.collection.Map[String,Any]]" class="delimiter">[</span><span title="List[scala.collection.Map[String,Any]]">List</span><span class="delimiter">[</span>Map<span class="delimiter">[</span>String, Any<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>
            val <a title="List[kafka.common.TopicAndPartition]" id="kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitions">partitions</a> = <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitionsRaw" title="List[scala.collection.Map[String,Any]]">partitionsRaw</a>.<span title="(f: scala.collection.Map[String,Any] =&gt; kafka.common.TopicAndPartition)(implicit bf: scala.collection.generic.CanBuildFrom[List[scala.collection.Map[String,Any]],kafka.common.TopicAndPartition,List[kafka.common.TopicAndPartition]])List[kafka.common.TopicAndPartition]">map</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,kafka.common.TopicAndPartition,List[kafka.common.TopicAndPartition]]" class="delimiter">{</span> <a title="scala.collection.Map[String,Any]" id="kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitions.$anonfun.p">p</a> =&gt;
              val <a title="String" id="kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitions.$anonfun.topic">topic</a> = <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitions.$anonfun.p" title="scala.collection.Map[String,Any]">p</a>.<span title="(key: String)Option[Any]">get</span><span class="delimiter">(</span><span title="String(&quot;topic&quot;)" class="string">&quot;topic&quot;</span><span class="delimiter">)</span>.<span title="=&gt; Any">get</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="String" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span>
              val <a title="Int" id="kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitions.$anonfun.partition">partition</a> = <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitions.$anonfun.p" title="scala.collection.Map[String,Any]">p</a>.<span title="(key: String)Option[Any]">get</span><span class="delimiter">(</span><span title="String(&quot;partition&quot;)" class="string">&quot;partition&quot;</span><span class="delimiter">)</span>.<span title="=&gt; Any">get</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Int" class="delimiter">[</span><span title="Int">Int</span><span class="delimiter">]</span>
              <a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition" title="(topic: String, partition: Int)kafka.common.TopicAndPartition">TopicAndPartition</a><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitions.$anonfun.topic" title="String">topic</a>, <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitions.$anonfun.partition" title="Int">partition</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            val <a title="Iterable[kafka.common.TopicAndPartition]" id="kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.duplicatePartitions">duplicatePartitions</a> = <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Utils.scala.html#kafka.utils.Utils.duplicates" title="(s: Traversable[kafka.common.TopicAndPartition])Iterable[kafka.common.TopicAndPartition]">duplicates</a><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitions" title="List[kafka.common.TopicAndPartition]">partitions</a><span class="delimiter">)</span>
            val <a title="scala.collection.immutable.Set[kafka.common.TopicAndPartition]" id="kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitionsSet">partitionsSet</a> = <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitions" title="List[kafka.common.TopicAndPartition]">partitions</a>.<span title="scala.collection.immutable.Set[kafka.common.TopicAndPartition]">toSet</span>
            if <span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.duplicatePartitions" title="Iterable[kafka.common.TopicAndPartition]">duplicatePartitions</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span>
              throw new <a href="AdminOperationException.scala.html#kafka.admin;AdminOperationException" title="kafka.admin.AdminOperationException">AdminOperationException</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Preferred replica election data contains duplicate partitions: %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.duplicatePartitions" title="Iterable[kafka.common.TopicAndPartition]">duplicatePartitions</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData.partitionsSet" title="scala.collection.immutable.Set[kafka.common.TopicAndPartition]">partitionsSet</a>
          case <span title="None.type">None</span> =&gt; throw new <a href="AdminOperationException.scala.html#kafka.admin;AdminOperationException" title="kafka.admin.AdminOperationException">AdminOperationException</a><span class="delimiter">(</span><span title="String(&quot;Preferred replica election data is empty&quot;)" class="string">&quot;Preferred replica election data is empty&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      case <span title="None.type">None</span> =&gt; throw new <a href="AdminOperationException.scala.html#kafka.admin;AdminOperationException" title="kafka.admin.AdminOperationException">AdminOperationException</a><span class="delimiter">(</span><span title="String(&quot;Preferred replica election data is empty&quot;)" class="string">&quot;Preferred replica election data is empty&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(zkClient: org.I0Itec.zkclient.ZkClient, partitionsUndergoingPreferredReplicaElection: scala.collection.Set[kafka.common.TopicAndPartition])Unit" id="kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData">writePreferredReplicaElectionData</a><span class="delimiter">(</span><a title="org.I0Itec.zkclient.ZkClient" id="kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.zkClient">zkClient</a>: <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span>,
                                        <span title="scala.collection.Set[kafka.common.TopicAndPartition]">partitionsUndergoingPreferredReplicaElection</span>: scala.collection.<span title="scala.collection.Set[kafka.common.TopicAndPartition]">Set</span><span class="delimiter">[</span>TopicAndPartition<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    val <a title="String" id="kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.zkPath">zkPath</a> = <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.PreferredReplicaLeaderElectionPath" title="=&gt; String">PreferredReplicaLeaderElectionPath</a>
    val <a title="scala.collection.Set[scala.collection.Map[String,Any]]" id="kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.partitionsList">partitionsList</a> = <span title="scala.collection.Set[kafka.common.TopicAndPartition]">partitionsUndergoingPreferredReplicaElection</span>.<span title="(f: kafka.common.TopicAndPartition =&gt; scala.collection.Map[String,Any])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.Set[kafka.common.TopicAndPartition],scala.collection.Map[String,Any],scala.collection.Set[scala.collection.Map[String,Any]]])scala.collection.Set[scala.collection.Map[String,Any]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Set.Coll,scala.collection.Map[String,Any],scala.collection.Set[scala.collection.Map[String,Any]]]" class="delimiter">(</span><a title="kafka.common.TopicAndPartition" id="kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.partitionsList.$anonfun.e">e</a> =&gt; <span title="(elems: (String, Any)*)scala.collection.Map[String,Any]">Map</span><span class="delimiter">(</span><span title="(self: String)ArrowAssoc[String]" class="string">&quot;topic&quot;</span> <span title="(y: String)(String, String)">-&gt;</span> <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.partitionsList.$anonfun.e" title="kafka.common.TopicAndPartition">e</a>.<a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition.topic" title="=&gt; String">topic</a>, <span title="(self: String)ArrowAssoc[String]" class="string">&quot;partition&quot;</span> <span title="(y: Int)(String, Int)">-&gt;</span> <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.partitionsList.$anonfun.e" title="kafka.common.TopicAndPartition">e</a>.<a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition.partition" title="=&gt; Int">partition</a><span class="delimiter">)</span><span class="delimiter">)</span>
    val <a title="String" id="kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.jsonData">jsonData</a> = <a href="../utils/Json.scala.html#kafka.utils.Json" title="kafka.utils.Json.type">Json</a>.<a href="../utils/Json.scala.html#kafka.utils.Json.encode" title="(obj: Any)String">encode</a><span class="delimiter">(</span><span title="(elems: (String, Any)*)scala.collection.Map[String,Any]">Map</span><span class="delimiter">(</span><span title="(self: String)ArrowAssoc[String]" class="string">&quot;version&quot;</span> <span title="(y: Int)(String, Int)">-&gt;</span> <span title="Int(1)" class="int">1</span>, <span title="(self: String)ArrowAssoc[String]" class="string">&quot;partitions&quot;</span> <span title="(y: scala.collection.Set[scala.collection.Map[String,Any]])(String, scala.collection.Set[scala.collection.Map[String,Any]])">-&gt;</span> <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.partitionsList" title="scala.collection.Set[scala.collection.Map[String,Any]]">partitionsList</a><span class="delimiter">)</span><span class="delimiter">)</span>
    try <span class="delimiter">{</span>
      <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.createPersistentPath" title="(client: org.I0Itec.zkclient.ZkClient, path: String, data: String)Unit">createPersistentPath</a><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.zkPath" title="String">zkPath</a>, <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.jsonData" title="String">jsonData</a><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Created preferred replica election path with %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.jsonData" title="String">jsonData</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> catch <span class="delimiter">{</span>
      case <a title="org.I0Itec.zkclient.exception.ZkNodeExistsException" id="kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.nee">nee</a>: <span title="org.I0Itec.zkclient.exception.ZkNodeExistsException">ZkNodeExistsException</span> =&gt;
        val <span title="scala.collection.immutable.Set[kafka.common.TopicAndPartition]">partitionsUndergoingPreferredReplicaElection</span> =
          <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand" title="kafka.admin.PreferredReplicaLeaderElectionCommand.type">PreferredReplicaLeaderElectionCommand</a>.<a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.parsePreferredReplicaElectionData" title="(jsonString: String)scala.collection.immutable.Set[kafka.common.TopicAndPartition]">parsePreferredReplicaElectionData</a><span class="delimiter">(</span><a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.readData" title="(client: org.I0Itec.zkclient.ZkClient, path: String)(String, org.apache.zookeeper.data.Stat)">readData</a><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.zkPath" title="String">zkPath</a><span class="delimiter">)</span>.<span title="=&gt; String">_1</span><span class="delimiter">)</span>
        throw new <a href="AdminOperationException.scala.html#kafka.admin;AdminOperationException" title="kafka.admin.AdminOperationException">AdminOperationException</a><span class="delimiter">(</span><span title="String(&quot;Preferred replica leader election currently in progress for &quot;)" class="string">&quot;Preferred replica leader election currently in progress for &quot;</span> <span title="(x$1: Any)String">+</span>
          <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%s. Aborting operation&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><span title="scala.collection.immutable.Set[kafka.common.TopicAndPartition]">partitionsUndergoingPreferredReplicaElection</span><span class="delimiter">)</span><span class="delimiter">)</span>
      case <a title="Throwable" id="kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.e2">e2</a>: <span title="Throwable">Throwable</span> =&gt; throw new <a href="AdminOperationException.scala.html#kafka.admin;AdminOperationException" title="kafka.admin.AdminOperationException">AdminOperationException</a><span class="delimiter">(</span><a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData.e2" title="Throwable">e2</a>.<span title="()String">toString</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

class <a title="class PreferredReplicaLeaderElectionCommand extends AnyRef with kafka.utils.Logging" id="kafka.admin;PreferredReplicaLeaderElectionCommand">PreferredReplicaLeaderElectionCommand</a><a href="#kafka.admin;PreferredReplicaLeaderElectionCommand" title="kafka.admin.PreferredReplicaLeaderElectionCommand" class="delimiter">(</a><a title="org.I0Itec.zkclient.ZkClient" id="kafka.admin;PreferredReplicaLeaderElectionCommand.zkClient">zkClient</a>: <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span>, <a title="scala.collection.Set[kafka.common.TopicAndPartition]" id="kafka.admin;PreferredReplicaLeaderElectionCommand.partitions">partitions</a>: scala.collection.<span title="scala.collection.Set[kafka.common.TopicAndPartition]">Set</span><span class="delimiter">[</span>TopicAndPartition<span class="delimiter">]</span><span class="delimiter">)</span>
  extends <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> <span class="delimiter">{</span>
  def <a title="()Unit" id="kafka.admin;PreferredReplicaLeaderElectionCommand.moveLeaderToPreferredReplica">moveLeaderToPreferredReplica</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    try <span class="delimiter">{</span>
      val <a title="scala.collection.Set[kafka.common.TopicAndPartition]" id="kafka.admin;PreferredReplicaLeaderElectionCommand.moveLeaderToPreferredReplica.validPartitions">validPartitions</a> = <a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.partitions" title="scala.collection.Set[kafka.common.TopicAndPartition]">partitions</a>.<span title="(p: kafka.common.TopicAndPartition =&gt; Boolean)scala.collection.Set[kafka.common.TopicAndPartition]">filter</span><span class="delimiter">(</span><a title="kafka.common.TopicAndPartition" id="kafka.admin;PreferredReplicaLeaderElectionCommand.moveLeaderToPreferredReplica.validPartitions.$anonfun.p">p</a> =&gt; <a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition" title="(zkClient: org.I0Itec.zkclient.ZkClient, topic: String, partition: Int)Boolean">validatePartition</a><span class="delimiter">(</span><a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.moveLeaderToPreferredReplica.validPartitions.$anonfun.p" title="kafka.common.TopicAndPartition">p</a>.<a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition.topic" title="=&gt; String">topic</a>, <a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.moveLeaderToPreferredReplica.validPartitions.$anonfun.p" title="kafka.common.TopicAndPartition">p</a>.<a href="../common/TopicAndPartition.scala.html#kafka.common;TopicAndPartition.partition" title="=&gt; Int">partition</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#kafka.admin.PreferredReplicaLeaderElectionCommand" title="kafka.admin.PreferredReplicaLeaderElectionCommand.type">PreferredReplicaLeaderElectionCommand</a>.<a href="#kafka.admin.PreferredReplicaLeaderElectionCommand.writePreferredReplicaElectionData" title="(zkClient: org.I0Itec.zkclient.ZkClient, partitionsUndergoingPreferredReplicaElection: scala.collection.Set[kafka.common.TopicAndPartition])Unit">writePreferredReplicaElectionData</a><span class="delimiter">(</span><a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.moveLeaderToPreferredReplica.validPartitions" title="scala.collection.Set[kafka.common.TopicAndPartition]">validPartitions</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> catch <span class="delimiter">{</span>
      case <a title="Throwable" id="kafka.admin;PreferredReplicaLeaderElectionCommand.moveLeaderToPreferredReplica.e">e</a>: <span title="Throwable">Throwable</span> =&gt; throw new <a href="../common/AdminCommandFailedException.scala.html#kafka.common;AdminCommandFailedException" title="kafka.common.AdminCommandFailedException">AdminCommandFailedException</a><span class="delimiter">(</span><span title="String(&quot;Admin command failed&quot;)" class="string">&quot;Admin command failed&quot;</span>, <a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.moveLeaderToPreferredReplica.e" title="Throwable">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(zkClient: org.I0Itec.zkclient.ZkClient, topic: String, partition: Int)Boolean" id="kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition">validatePartition</a><span class="delimiter">(</span><a title="org.I0Itec.zkclient.ZkClient" id="kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.zkClient">zkClient</a>: <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span>, <a title="String" id="kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.topic">topic</a>: <span title="String">String</span>, <a title="Int" id="kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.partition">partition</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="comment">// check if partition exists</span>
    val <a title="Option[Seq[Int]]" id="kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.partitionsOpt">partitionsOpt</a> = <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.getPartitionsForTopics" title="(zkClient: org.I0Itec.zkclient.ZkClient, topics: Seq[String])scala.collection.mutable.Map[String,Seq[Int]]">getPartitionsForTopics</a><span class="delimiter">(</span><a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a>, <span title="(xs: String*)List[String]">List</span><span class="delimiter">(</span><a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.topic" title="String">topic</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(key: String)Option[Seq[Int]]">get</span><span class="delimiter">(</span><a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.topic" title="String">topic</a><span class="delimiter">)</span>
    <a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.partitionsOpt" title="Option[Seq[Int]]">partitionsOpt</a> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="Seq[Int]" id="kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.partitions">partitions</a><span class="delimiter">)</span> =&gt;
        if<span class="delimiter">(</span><a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.partitions" title="Seq[Int]">partitions</a>.<span title="(elem: Int)Boolean">contains</span><span class="delimiter">(</span><a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.partition" title="Int">partition</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          true
        <span class="delimiter">}</span> else <span class="delimiter">{</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(1729dbc42f)" title="(msg: =&gt; String)Unit">error</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Skipping preferred replica leader election for partition [%s,%d] &quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.topic" title="String">topic</a>, <a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.partition" title="Int">partition</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span>
            <span title="String(&quot;since it doesn\'t exist&quot;)" class="string">&quot;since it doesn't exist&quot;</span><span class="delimiter">)</span>
          false
        <span class="delimiter">}</span>
      case <span title="None.type">None</span> =&gt; <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(1729dbc42f)" title="(msg: =&gt; String)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;Skipping preferred replica leader election for partition &quot;)" class="string">&quot;Skipping preferred replica leader election for partition &quot;</span> <span title="(x$1: Any)String">+</span>
        <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;[%s,%d] since topic %s doesn't exist&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.topic" title="String">topic</a>, <a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.partition" title="Int">partition</a>, <a href="#kafka.admin;PreferredReplicaLeaderElectionCommand.validatePartition.topic" title="String">topic</a><span class="delimiter">)</span><span class="delimiter">)</span>
        false
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
