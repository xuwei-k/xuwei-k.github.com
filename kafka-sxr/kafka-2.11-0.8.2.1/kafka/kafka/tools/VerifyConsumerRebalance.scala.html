<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>kafka/kafka/tools/VerifyConsumerRebalance.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

package kafka.tools

import joptsimple.OptionParser
import org.I0Itec.zkclient.ZkClient
import kafka.utils.<span class="delimiter">{</span>Logging, ZKGroupTopicDirs, ZkUtils, ZKStringSerializer, CommandLineUtils<span class="delimiter">}</span>

object <a title="kafka.tools.VerifyConsumerRebalance.type" id="kafka.tools.VerifyConsumerRebalance">VerifyConsumerRebalance</a> extends <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> <span class="delimiter">{</span>
  def <a title="(args: Array[String])Unit" id="kafka.tools.VerifyConsumerRebalance.main">main</a><span class="delimiter">(</span><a title="Array[String]" id="kafka.tools.VerifyConsumerRebalance.main.args">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    val <a title="joptsimple.OptionParser" id="kafka.tools.VerifyConsumerRebalance.main.parser">parser</a> = new <span title="joptsimple.OptionParser">OptionParser</span><span class="delimiter">(</span><span class="delimiter">)</span>

    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.tools.VerifyConsumerRebalance.main.zkConnectOpt">zkConnectOpt</a> = <a href="#kafka.tools.VerifyConsumerRebalance.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;zookeeper.connect&quot;)" class="string">&quot;zookeeper.connect&quot;</span>, <span title="String(&quot;ZooKeeper connect string.&quot;)" class="string">&quot;ZooKeeper connect string.&quot;</span><span class="delimiter">)</span>.
      <span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: String, x$2: String*)joptsimple.ArgumentAcceptingOptionSpec[String]">defaultsTo</span><span class="delimiter">(</span><span title="String(&quot;localhost:2181&quot;)" class="string">&quot;localhost:2181&quot;</span><span class="delimiter">)</span>.<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.tools.VerifyConsumerRebalance.main.groupOpt">groupOpt</a> = <a href="#kafka.tools.VerifyConsumerRebalance.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;group&quot;)" class="string">&quot;group&quot;</span>, <span title="String(&quot;Consumer group.&quot;)" class="string">&quot;Consumer group.&quot;</span><span class="delimiter">)</span>.
      <span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>
    <a href="#kafka.tools.VerifyConsumerRebalance.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;help&quot;)" class="string">&quot;help&quot;</span>, <span title="String(&quot;Print this message.&quot;)" class="string">&quot;Print this message.&quot;</span><span class="delimiter">)</span>
    
    if<span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.main.args" title="Array[String]">args</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils" title="kafka.utils.CommandLineUtils.type">CommandLineUtils</a>.<a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils.printUsageAndDie" title="(parser: joptsimple.OptionParser, message: String)Unit">printUsageAndDie</a><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.main.parser" title="joptsimple.OptionParser">parser</a>, <span title="String(&quot;Validate that all partitions have a consumer for a given consumer group.&quot;)" class="string">&quot;Validate that all partitions have a consumer for a given consumer group.&quot;</span><span class="delimiter">)</span>

    val <a title="joptsimple.OptionSet" id="kafka.tools.VerifyConsumerRebalance.main.options">options</a> = <a href="#kafka.tools.VerifyConsumerRebalance.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String*)joptsimple.OptionSet">parse</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.main.args" title="Array[String]">args</a> : _*<span class="delimiter">)</span>

    if <span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: String)Boolean">has</span><span class="delimiter">(</span><span title="String(&quot;help&quot;)" class="string">&quot;help&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#kafka.tools.VerifyConsumerRebalance.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: java.io.OutputStream)Unit">printHelpOn</span><span class="delimiter">(</span><span title="System.type">System</span>.<span title="java.io.PrintStream">out</span><span class="delimiter">)</span>
      <span title="System.type">System</span>.<span title="(x$1: Int)Unit">exit</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils" title="kafka.utils.CommandLineUtils.type">CommandLineUtils</a>.<a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils.checkRequiredArgs" title="(parser: joptsimple.OptionParser, options: joptsimple.OptionSet, required: joptsimple.OptionSpec[_]*)Unit">checkRequiredArgs</a><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.main.parser" title="joptsimple.OptionParser">parser</a>, <a href="#kafka.tools.VerifyConsumerRebalance.main.options" title="joptsimple.OptionSet">options</a>, <a href="#kafka.tools.VerifyConsumerRebalance.main.groupOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">groupOpt</a><span class="delimiter">)</span>

    val <a title="String" id="kafka.tools.VerifyConsumerRebalance.main.zkConnect">zkConnect</a> = <a href="#kafka.tools.VerifyConsumerRebalance.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])String">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.main.zkConnectOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">zkConnectOpt</a><span class="delimiter">)</span>
    val <a title="String" id="kafka.tools.VerifyConsumerRebalance.main.group">group</a> = <a href="#kafka.tools.VerifyConsumerRebalance.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])String">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.main.groupOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">groupOpt</a><span class="delimiter">)</span>

    var <a title="org.I0Itec.zkclient.ZkClient" id="kafka.tools.VerifyConsumerRebalance.main.zkClient">zkClient</a>: <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span> = null
    try <span class="delimiter">{</span>
      <a href="#kafka.tools.VerifyConsumerRebalance.main.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a> = new <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.main.zkConnect" title="String">zkConnect</a>, <span title="Int(30000)" class="int">30000</span>, <span title="Int(30000)" class="int">30000</span>, <a href="../utils/ZkUtils.scala.html#kafka.utils.ZKStringSerializer" title="kafka.utils.ZKStringSerializer.type">ZKStringSerializer</a><span class="delimiter">)</span>

      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;zkConnect = %s; group = %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.main.zkConnect" title="String">zkConnect</a>, <a href="#kafka.tools.VerifyConsumerRebalance.main.group" title="String">group</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="comment">// check if the rebalancing operation succeeded.</span>
      try <span class="delimiter">{</span>
        if<span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation" title="(zkClient: org.I0Itec.zkclient.ZkClient, group: String)Boolean">validateRebalancingOperation</a><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.main.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.tools.VerifyConsumerRebalance.main.group" title="String">group</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;Rebalance operation successful !&quot;)" class="string">&quot;Rebalance operation successful !&quot;</span><span class="delimiter">)</span>
        else
          <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;Rebalance operation failed !&quot;)" class="string">&quot;Rebalance operation failed !&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> catch <span class="delimiter">{</span>
        case <a title="Throwable" id="kafka.tools.VerifyConsumerRebalance.main.e2">e2</a>: <span title="Throwable">Throwable</span> =&gt; <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;Error while verifying current rebalancing operation&quot;)" class="string">&quot;Error while verifying current rebalancing operation&quot;</span>, <a href="#kafka.tools.VerifyConsumerRebalance.main.e2" title="Throwable">e2</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    finally <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.main.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span>
        <a href="#kafka.tools.VerifyConsumerRebalance.main.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(zkClient: org.I0Itec.zkclient.ZkClient, group: String)Boolean" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation">validateRebalancingOperation</a><span class="delimiter">(</span><a title="org.I0Itec.zkclient.ZkClient" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.zkClient">zkClient</a>: <span title="org.I0Itec.zkclient.ZkClient">ZkClient</span>, <a title="String" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.group">group</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Verifying rebalancing operation for consumer group &quot;)" class="string">&quot;Verifying rebalancing operation for consumer group &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.group" title="String">group</a><span class="delimiter">)</span>
    var <a title="Boolean" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.rebalanceSucceeded">rebalanceSucceeded</a>: <span title="Boolean">Boolean</span> = true
    <span class="comment">/**
     * A successful rebalancing operation would select an owner for each available partition
     * This means that for each partition registered under /brokers/topics/[topic]/[broker-id], an owner exists
     * under /consumers/[consumer_group]/owners/[topic]/[broker_id-partition_id]
     */</span>
    val <a title="scala.collection.mutable.Map[String,List[kafka.consumer.ConsumerThreadId]]" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.consumersPerTopicMap">consumersPerTopicMap</a> = <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.getConsumersPerTopic" title="(zkClient: org.I0Itec.zkclient.ZkClient, group: String, excludeInternalTopics: Boolean)scala.collection.mutable.Map[String,List[kafka.consumer.ConsumerThreadId]]">getConsumersPerTopic</a><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.group" title="String">group</a>, excludeInternalTopics = false<span class="delimiter">)</span>
    val <a title="scala.collection.mutable.Map[String,Seq[Int]]" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.partitionsPerTopicMap">partitionsPerTopicMap</a> = <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.getPartitionsForTopics" title="(zkClient: org.I0Itec.zkclient.ZkClient, topics: Seq[String])scala.collection.mutable.Map[String,Seq[Int]]">getPartitionsForTopics</a><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.consumersPerTopicMap" title="scala.collection.mutable.Map[String,List[kafka.consumer.ConsumerThreadId]]">consumersPerTopicMap</a>.<span title="=&gt; scala.collection.Set[String]">keySet</span>.<span title="=&gt; Seq[String]">toSeq</span><span class="delimiter">)</span>

    <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.partitionsPerTopicMap" title="scala.collection.mutable.Map[String,Seq[Int]]">partitionsPerTopicMap</a>.<span title="(f: ((String, Seq[Int])) =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="(String, Seq[Int])" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.partitionsForTopic">partitionsForTopic</a> =&gt;
      val <a title="String" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topic">topic</a> = <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.partitionsForTopic" title="(String, Seq[Int])">partitionsForTopic</a>.<span title="=&gt; String">_1</span>
      val <a title="Seq[Int]" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.partitions">partitions</a> = <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.partitionsForTopic" title="(String, Seq[Int])">partitionsForTopic</a>.<span title="=&gt; Seq[Int]">_2</span>
      val <a title="kafka.utils.ZKGroupTopicDirs" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topicDirs">topicDirs</a> = new <a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupTopicDirs" title="kafka.utils.ZKGroupTopicDirs">ZKGroupTopicDirs</a><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.group" title="String">group</a>, <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topic" title="String">topic</a><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Alive partitions for topic %s are %s &quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topic" title="String">topic</a>, <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.partitions" title="Seq[Int]">partitions</a>.<span title="()String">toString</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Alive consumers for topic %s =&gt; %s &quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topic" title="String">topic</a>, <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.consumersPerTopicMap" title="scala.collection.mutable.Map[String,List[kafka.consumer.ConsumerThreadId]]">consumersPerTopicMap</a>.<span title="(key: String)Option[List[kafka.consumer.ConsumerThreadId]]">get</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topic" title="String">topic</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      val <a title="Seq[String]" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.partitionsWithOwners">partitionsWithOwners</a> = <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.getChildrenParentMayNotExist" title="(client: org.I0Itec.zkclient.ZkClient, path: String)Seq[String]">getChildrenParentMayNotExist</a><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topicDirs" title="kafka.utils.ZKGroupTopicDirs">topicDirs</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupTopicDirs.consumerOwnerDir" title="=&gt; String">consumerOwnerDir</a><span class="delimiter">)</span>
      if<span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.partitionsWithOwners" title="Seq[String]">partitionsWithOwners</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(1729dbc42f)" title="(msg: =&gt; String)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;No owners for any partitions for topic &quot;)" class="string">&quot;No owners for any partitions for topic &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topic" title="String">topic</a><span class="delimiter">)</span>
        <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.rebalanceSucceeded" title="Boolean">rebalanceSucceeded</a> = false
      <span class="delimiter">}</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Children of &quot;)" class="string">&quot;Children of &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topicDirs" title="kafka.utils.ZKGroupTopicDirs">topicDirs</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupTopicDirs.consumerOwnerDir" title="=&gt; String">consumerOwnerDir</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; = &quot;)" class="string">&quot; = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.partitionsWithOwners" title="Seq[String]">partitionsWithOwners</a>.<span title="()String">toString</span><span class="delimiter">)</span>
      val <a title="Option[List[kafka.consumer.ConsumerThreadId]]" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.consumerIdsForTopic">consumerIdsForTopic</a> = <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.consumersPerTopicMap" title="scala.collection.mutable.Map[String,List[kafka.consumer.ConsumerThreadId]]">consumersPerTopicMap</a>.<span title="(key: String)Option[List[kafka.consumer.ConsumerThreadId]]">get</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topic" title="String">topic</a><span class="delimiter">)</span>

      <span class="comment">// for each available partition for topic, check if an owner exists</span>
      <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.partitions" title="Seq[Int]">partitions</a>.<span title="(f: Int =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="Int" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partition">partition</a> =&gt;
      <span class="comment">// check if there is a node for [partition]</span>
        if<span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.partitionsWithOwners" title="Seq[String]">partitionsWithOwners</a>.<span title="(p: String =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a title="String" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.$anonfun.p">p</a> =&gt; <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.$anonfun.p" title="String">p</a>.<span title="(x$1: Any)Boolean">equals</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partition" title="Int">partition</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(1729dbc42f)" title="(msg: =&gt; String)Unit">error</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;No owner for partition [%s,%d]&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topic" title="String">topic</a>, <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partition" title="Int">partition</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.rebalanceSucceeded" title="Boolean">rebalanceSucceeded</a> = false
        <span class="delimiter">}</span>
        <span class="comment">// try reading the partition owner path for see if a valid consumer id exists there</span>
        val partitionOwnerPath = <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topicDirs" title="kafka.utils.ZKGroupTopicDirs">topicDirs</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils;ZKGroupTopicDirs.consumerOwnerDir" title="=&gt; String">consumerOwnerDir</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <a title="String" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partitionOwnerPath">+</a> <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partition" title="Int">partition</a>
        val <a title="String" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partitionOwner">partitionOwner</a> = <a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils" title="kafka.utils.ZkUtils.type">ZkUtils</a>.<a href="../utils/ZkUtils.scala.html#kafka.utils.ZkUtils.readDataMaybeNull" title="(client: org.I0Itec.zkclient.ZkClient, path: String)(Option[String], org.apache.zookeeper.data.Stat)">readDataMaybeNull</a><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.zkClient" title="org.I0Itec.zkclient.ZkClient">zkClient</a>, <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partitionOwnerPath" title="String">partitionOwnerPath</a><span class="delimiter">)</span>.<span title="=&gt; Option[String]">_1</span> match <span class="delimiter">{</span>
          case Some<span class="delimiter">(</span><a title="String" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partitionOwner.m">m</a><span class="delimiter">)</span> =&gt; <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partitionOwner.m" title="String">m</a>
          case <span title="None.type">None</span> =&gt; null
        <span class="delimiter">}</span>
        if<span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partitionOwner" title="String">partitionOwner</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(1729dbc42f)" title="(msg: =&gt; String)Unit">error</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;No owner for partition [%s,%d]&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topic" title="String">topic</a>, <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partition" title="Int">partition</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.rebalanceSucceeded" title="Boolean">rebalanceSucceeded</a> = false
        <span class="delimiter">}</span>
        else <span class="delimiter">{</span>
          <span class="comment">// check if the owner is a valid consumer id</span>
          <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.consumerIdsForTopic" title="Option[List[kafka.consumer.ConsumerThreadId]]">consumerIdsForTopic</a> match <span class="delimiter">{</span>
            case Some<span class="delimiter">(</span><a title="List[kafka.consumer.ConsumerThreadId]" id="kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.consumerIds">consumerIds</a><span class="delimiter">)</span> =&gt;
              if<span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.consumerIds" title="List[kafka.consumer.ConsumerThreadId]">consumerIds</a>.<span title="(elem: Comparable[_ &gt;: kafka.consumer.ConsumerThreadId with String &lt;: Comparable[_ &gt;: kafka.consumer.ConsumerThreadId with String &lt;: java.io.Serializable] with java.io.Serializable] with java.io.Serializable)Boolean">contains</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partitionOwner" title="String">partitionOwner</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(1729dbc42f)" title="(msg: =&gt; String)Unit">error</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="string">&quot;Owner %s for partition [%s,%d] is not a valid member of consumer &quot;</span> <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">+</span>
                  <span class="string">&quot;group %s&quot;</span><span class="delimiter">)</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partitionOwner" title="String">partitionOwner</a>, <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topic" title="String">topic</a>, <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partition" title="Int">partition</a>, <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.group" title="String">group</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.rebalanceSucceeded" title="Boolean">rebalanceSucceeded</a> = false
              <span class="delimiter">}</span>
              else
                <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Owner of partition [%s,%d] is %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topic" title="String">topic</a>, <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partition" title="Int">partition</a>, <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.$anonfun.partitionOwner" title="String">partitionOwner</a><span class="delimiter">)</span><span class="delimiter">)</span>
            case <span title="None.type">None</span> =&gt; <span class="delimiter">{</span>
              <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(1729dbc42f)" title="(msg: =&gt; String)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;No consumer ids registered for topic &quot;)" class="string">&quot;No consumer ids registered for topic &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.$anonfun.topic" title="String">topic</a><span class="delimiter">)</span>
              <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.rebalanceSucceeded" title="Boolean">rebalanceSucceeded</a> = false
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span>

    <a href="#kafka.tools.VerifyConsumerRebalance.validateRebalancingOperation.rebalanceSucceeded" title="Boolean">rebalanceSucceeded</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
