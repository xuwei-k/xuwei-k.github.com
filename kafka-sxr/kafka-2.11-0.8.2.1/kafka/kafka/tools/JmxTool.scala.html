<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>kafka/kafka/tools/JmxTool.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */</span>
package kafka.tools

import java.util.Date
import java.text.SimpleDateFormat
import javax.management._
import javax.management.remote._
import joptsimple.OptionParser
import scala.collection.<span title="scala.collection.JavaConversions.type">JavaConversions</span>._
import scala.collection.mutable
import scala.math._
import kafka.utils.<span class="delimiter">{</span>CommandLineUtils, Logging<span class="delimiter">}</span>

object <a title="kafka.tools.JmxTool.type" id="kafka.tools.JmxTool">JmxTool</a> extends <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> <span class="delimiter">{</span>

  def <a title="(args: Array[String])Unit" id="kafka.tools.JmxTool.main">main</a><span class="delimiter">(</span><a title="Array[String]" id="kafka.tools.JmxTool.main.args">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="comment">// Parse command line</span>
    val <a title="joptsimple.OptionParser" id="kafka.tools.JmxTool.main.parser">parser</a> = new <span title="joptsimple.OptionParser">OptionParser</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.tools.JmxTool.main.objectNameOpt">objectNameOpt</a> =
      <a href="#kafka.tools.JmxTool.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;object-name&quot;)" class="string">&quot;object-name&quot;</span>, <span class="string">&quot;A JMX object name to use as a query. This can contain wild cards, and this option &quot;</span> +
        <span class="string">&quot;can be given multiple times to specify more than one query. If no objects are specified &quot;</span> <span title="String(&quot;A JMX object name to use as a query. This can contain wild cards, and this option can be given multiple times to specify more than one query. If no objects are specified all objects will be queried.&quot;)">+</span>
        <span class="string">&quot;all objects will be queried.&quot;</span><span class="delimiter">)</span>
        .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span>
        .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;name&quot;)" class="string">&quot;name&quot;</span><span class="delimiter">)</span>
        .<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.tools.JmxTool.main.attributesOpt">attributesOpt</a> =
      <a href="#kafka.tools.JmxTool.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;attributes&quot;)" class="string">&quot;attributes&quot;</span>, <span class="string">&quot;The whitelist of attributes to query. This is a comma-separated list. If no &quot;</span> <span title="String(&quot;The whitelist of attributes to query. This is a comma-separated list. If no attributes are specified all objects will be queried.&quot;)">+</span>
        <span class="string">&quot;attributes are specified all objects will be queried.&quot;</span><span class="delimiter">)</span>
        .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span>
        .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;name&quot;)" class="string">&quot;name&quot;</span><span class="delimiter">)</span>
        .<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[Integer]" id="kafka.tools.JmxTool.main.reportingIntervalOpt">reportingIntervalOpt</a> = <a href="#kafka.tools.JmxTool.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;reporting-interval&quot;)" class="string">&quot;reporting-interval&quot;</span>, <span title="String(&quot;Interval in MS with which to poll jmx stats.&quot;)" class="string">&quot;Interval in MS with which to poll jmx stats.&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;ms&quot;)" class="string">&quot;ms&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[Integer])joptsimple.ArgumentAcceptingOptionSpec[Integer]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[Integer](classOf[java.lang.Integer])" class="delimiter">[</span>java.lang.Integer<span class="delimiter">]</span><span class="delimiter">)</span>
      .<span title="(x$1: Integer, x$2: Integer*)joptsimple.ArgumentAcceptingOptionSpec[Integer]">defaultsTo</span><span class="delimiter">(</span><span title="implicit scala.Predef.int2Integer : (x: Int)Integer" class="int">2000</span><span class="delimiter">)</span>
    val <a title="joptsimple.OptionSpecBuilder" id="kafka.tools.JmxTool.main.helpOpt">helpOpt</a> = <a href="#kafka.tools.JmxTool.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;help&quot;)" class="string">&quot;help&quot;</span>, <span title="String(&quot;Print usage information.&quot;)" class="string">&quot;Print usage information.&quot;</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.tools.JmxTool.main.dateFormatOpt">dateFormatOpt</a> = <a href="#kafka.tools.JmxTool.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;date-format&quot;)" class="string">&quot;date-format&quot;</span>, <span class="string">&quot;The date format to use for formatting the time field. &quot;</span> <span title="String(&quot;The date format to use for formatting the time field. See java.text.SimpleDateFormat for options.&quot;)">+</span>
      <span class="string">&quot;See java.text.SimpleDateFormat for options.&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;format&quot;)" class="string">&quot;format&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.tools.JmxTool.main.jmxServiceUrlOpt">jmxServiceUrlOpt</a> =
      <a href="#kafka.tools.JmxTool.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;jmx-url&quot;)" class="string">&quot;jmx-url&quot;</span>, <span title="String(&quot;The url to connect to to poll JMX data. See Oracle javadoc for JMXServiceURL for details.&quot;)" class="string">&quot;The url to connect to to poll JMX data. See Oracle javadoc for JMXServiceURL for details.&quot;</span><span class="delimiter">)</span>
        .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span>
        .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;service-url&quot;)" class="string">&quot;service-url&quot;</span><span class="delimiter">)</span>
        .<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>
        .<span title="(x$1: String, x$2: String*)joptsimple.ArgumentAcceptingOptionSpec[String]">defaultsTo</span><span class="delimiter">(</span><span title="String(&quot;service:jmx:rmi:///jndi/rmi://:9999/jmxrmi&quot;)" class="string">&quot;service:jmx:rmi:///jndi/rmi://:9999/jmxrmi&quot;</span><span class="delimiter">)</span>
        
    if<span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.args" title="Array[String]">args</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils" title="kafka.utils.CommandLineUtils.type">CommandLineUtils</a>.<a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils.printUsageAndDie" title="(parser: joptsimple.OptionParser, message: String)Unit">printUsageAndDie</a><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.parser" title="joptsimple.OptionParser">parser</a>, <span title="String(&quot;Dump JMX values to standard output.&quot;)" class="string">&quot;Dump JMX values to standard output.&quot;</span><span class="delimiter">)</span>

    val <a title="joptsimple.OptionSet" id="kafka.tools.JmxTool.main.options">options</a> = <a href="#kafka.tools.JmxTool.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String*)joptsimple.OptionSet">parse</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.args" title="Array[String]">args</a> : _*<span class="delimiter">)</span>

    if<span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.helpOpt" title="joptsimple.OptionSpecBuilder">helpOpt</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#kafka.tools.JmxTool.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: java.io.OutputStream)Unit">printHelpOn</span><span class="delimiter">(</span><span title="System.type">System</span>.<span title="java.io.PrintStream">out</span><span class="delimiter">)</span>
      <span title="System.type">System</span>.<span title="(x$1: Int)Unit">exit</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    val <a title="javax.management.remote.JMXServiceURL" id="kafka.tools.JmxTool.main.url">url</a> = new <span title="javax.management.remote.JMXServiceURL">JMXServiceURL</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])String">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.jmxServiceUrlOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">jmxServiceUrlOpt</a><span class="delimiter">)</span><span class="delimiter">)</span>
    val <a title="Int" id="kafka.tools.JmxTool.main.interval">interval</a> = <a href="#kafka.tools.JmxTool.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.reportingIntervalOpt" title="joptsimple.ArgumentAcceptingOptionSpec[Integer]">reportingIntervalOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span>
    val <a title="Boolean" id="kafka.tools.JmxTool.main.attributesWhitelistExists">attributesWhitelistExists</a> = <a href="#kafka.tools.JmxTool.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.attributesOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">attributesOpt</a><span class="delimiter">)</span>
    val <a title="Option[Array[String]]" id="kafka.tools.JmxTool.main.attributesWhitelist">attributesWhitelist</a> = if<span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.attributesWhitelistExists" title="Boolean">attributesWhitelistExists</a><span class="delimiter">)</span> <span title="(x: Array[String])Some[Array[String]]">Some</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])String">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.attributesOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">attributesOpt</a><span class="delimiter">)</span>.<span title="(x$1: String)Array[String]">split</span><span class="delimiter">(</span><span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> else <span title="None.type">None</span>
    val <a title="Boolean" id="kafka.tools.JmxTool.main.dateFormatExists">dateFormatExists</a> = <a href="#kafka.tools.JmxTool.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.dateFormatOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">dateFormatOpt</a><span class="delimiter">)</span>
    val <a title="Option[java.text.SimpleDateFormat]" id="kafka.tools.JmxTool.main.dateFormat">dateFormat</a> = if<span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.dateFormatExists" title="Boolean">dateFormatExists</a><span class="delimiter">)</span> <span title="(x: java.text.SimpleDateFormat)Some[java.text.SimpleDateFormat]">Some</span><span class="delimiter">(</span>new <span title="java.text.SimpleDateFormat">SimpleDateFormat</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])String">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.dateFormatOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">dateFormatOpt</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> else <span title="None.type">None</span>
    val <a title="javax.management.remote.JMXConnector" id="kafka.tools.JmxTool.main.jmxc">jmxc</a> = <span title="javax.management.remote.JMXConnectorFactory.type">JMXConnectorFactory</span>.<span title="(x$1: javax.management.remote.JMXServiceURL, x$2: java.util.Map[String, _])javax.management.remote.JMXConnector">connect</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.url" title="javax.management.remote.JMXServiceURL">url</a>, null<span class="delimiter">)</span>
    val <a title="javax.management.MBeanServerConnection" id="kafka.tools.JmxTool.main.mbsc">mbsc</a> = <a href="#kafka.tools.JmxTool.main.jmxc" title="javax.management.remote.JMXConnector">jmxc</a>.<span title="()javax.management.MBeanServerConnection">getMBeanServerConnection</span><span class="delimiter">(</span><span class="delimiter">)</span>

    val <a title="Iterable[javax.management.ObjectName]" id="kafka.tools.JmxTool.main.queries">queries</a>: <span title="Iterable[javax.management.ObjectName]">Iterable</span><span class="delimiter">[</span>ObjectName<span class="delimiter">]</span> =
      if<span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.objectNameOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">objectNameOpt</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#kafka.tools.JmxTool.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])java.util.List[String]">valuesOf</span><span title="(l: java.util.List[String])scala.collection.mutable.Buffer[String]" class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.objectNameOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">objectNameOpt</a><span class="delimiter">)</span>.<span title="(f: String =&gt; javax.management.ObjectName)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[String],javax.management.ObjectName,Iterable[javax.management.ObjectName]])Iterable[javax.management.ObjectName]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,javax.management.ObjectName,scala.collection.mutable.Buffer[javax.management.ObjectName]]" class="delimiter">(</span>new <span title="javax.management.ObjectName">ObjectName</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.queries.$anonfun.x$1" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      else
        <span title="(xs: Null*)List[Null]">List</span><span class="delimiter">(</span>null<span class="delimiter">)</span>

    val <a title="Iterable[javax.management.ObjectName]" id="kafka.tools.JmxTool.main.names">names</a> = <a href="#kafka.tools.JmxTool.main.queries" title="Iterable[javax.management.ObjectName]">queries</a>.<span title="(f: javax.management.ObjectName =&gt; scala.collection.mutable.Set[javax.management.ObjectName])(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[javax.management.ObjectName],scala.collection.mutable.Set[javax.management.ObjectName],Iterable[scala.collection.mutable.Set[javax.management.ObjectName]]])Iterable[scala.collection.mutable.Set[javax.management.ObjectName]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,scala.collection.mutable.Set[javax.management.ObjectName],Iterable[scala.collection.mutable.Set[javax.management.ObjectName]]]" class="delimiter">(</span><span class="delimiter">(</span>name: <span title="javax.management.ObjectName">ObjectName</span><span class="delimiter">)</span> =&gt; <a href="#kafka.tools.JmxTool.main.mbsc" title="javax.management.MBeanServerConnection">mbsc</a>.<span title="(x$1: javax.management.ObjectName, x$2: javax.management.QueryExp)java.util.Set[javax.management.ObjectName]">queryNames</span><span title="(s: java.util.Set[javax.management.ObjectName])scala.collection.mutable.Set[javax.management.ObjectName]" class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.names.$anonfun.name" title="javax.management.ObjectName">name</a>, null<span class="delimiter">)</span>: mutable.<span title="scala.collection.mutable.Set[javax.management.ObjectName]">Set</span><span class="delimiter">[</span>ObjectName<span class="delimiter">]</span><span class="delimiter">)</span>.<span title="(implicit asTraversable: scala.collection.mutable.Set[javax.management.ObjectName] =&gt; scala.collection.GenTraversableOnce[javax.management.ObjectName])Iterable[javax.management.ObjectName]">flatten</span>
    val <a title="Iterable[(javax.management.ObjectName, Array[String])]" id="kafka.tools.JmxTool.main.allAttributes">allAttributes</a>: <span title="Iterable[(javax.management.ObjectName, Array[String])]">Iterable</span><span class="delimiter">[</span><span class="delimiter">(</span>ObjectName, Array<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span> =
      <a href="#kafka.tools.JmxTool.main.names" title="Iterable[javax.management.ObjectName]">names</a>.<span title="(f: javax.management.ObjectName =&gt; (javax.management.ObjectName, Array[String]))(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[javax.management.ObjectName],(javax.management.ObjectName, Array[String]),Iterable[(javax.management.ObjectName, Array[String])]])Iterable[(javax.management.ObjectName, Array[String])]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,(javax.management.ObjectName, Array[String]),Iterable[(javax.management.ObjectName, Array[String])]]" class="delimiter">(</span><span class="delimiter">(</span>name: <span title="javax.management.ObjectName">ObjectName</span><span class="delimiter">)</span> =&gt; <span title="(_1: javax.management.ObjectName, _2: Array[String])(javax.management.ObjectName, Array[String])" class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.allAttributes.$anonfun.name" title="javax.management.ObjectName">name</a>, <a href="#kafka.tools.JmxTool.main.mbsc" title="javax.management.MBeanServerConnection">mbsc</a>.<span title="(x$1: javax.management.ObjectName)javax.management.MBeanInfo">getMBeanInfo</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.allAttributes.$anonfun.name" title="javax.management.ObjectName">name</a><span class="delimiter">)</span>.<span title="()Array[javax.management.MBeanAttributeInfo]">getAttributes</span><span title="(xs: Array[javax.management.MBeanAttributeInfo])scala.collection.mutable.ArrayOps[javax.management.MBeanAttributeInfo]" class="delimiter">(</span><span class="delimiter">)</span>.<span title="(f: javax.management.MBeanAttributeInfo =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Array[javax.management.MBeanAttributeInfo],String,Array[String]])Array[String]">map</span><span title="(implicit t: scala.reflect.ClassTag[String])scala.collection.generic.CanBuildFrom[Array[_],String,Array[String]]" class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.allAttributes.$anonfun.$anonfun.x$2" title="javax.management.MBeanAttributeInfo">_</a>.<span title="()String">getName</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>


    val <a title="Map[javax.management.ObjectName,Int]" id="kafka.tools.JmxTool.main.numExpectedAttributes">numExpectedAttributes</a>: <span title="Map[javax.management.ObjectName,Int]">Map</span><span class="delimiter">[</span>ObjectName, Int<span class="delimiter">]</span> =
      <a href="#kafka.tools.JmxTool.main.attributesWhitelistExists" title="Boolean">attributesWhitelistExists</a> match <span class="delimiter">{</span>
        case true =&gt; <a href="#kafka.tools.JmxTool.main.queries" title="Iterable[javax.management.ObjectName]">queries</a>.<span title="(f: javax.management.ObjectName =&gt; (javax.management.ObjectName, Int))(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[javax.management.ObjectName],(javax.management.ObjectName, Int),Iterable[(javax.management.ObjectName, Int)]])Iterable[(javax.management.ObjectName, Int)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,(javax.management.ObjectName, Int),Iterable[(javax.management.ObjectName, Int)]]" class="delimiter">(</span><span title="(_1: javax.management.ObjectName, _2: Int)(javax.management.ObjectName, Int)" class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.numExpectedAttributes.$anonfun.x$3" title="javax.management.ObjectName">_</a>, <a href="#kafka.tools.JmxTool.main.attributesWhitelist" title="Option[Array[String]]">attributesWhitelist</a>.<span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">get</span>.<span title="=&gt; Int">size</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit ev: &lt;:&lt;[(javax.management.ObjectName, Int),(javax.management.ObjectName, Int)])scala.collection.immutable.Map[javax.management.ObjectName,Int]">toMap</span>
        case false =&gt; <a href="#kafka.tools.JmxTool.main.names" title="Iterable[javax.management.ObjectName]">names</a>.<span title="(f: javax.management.ObjectName =&gt; (javax.management.ObjectName, Int))(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[javax.management.ObjectName],(javax.management.ObjectName, Int),Iterable[(javax.management.ObjectName, Int)]])Iterable[(javax.management.ObjectName, Int)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,(javax.management.ObjectName, Int),Iterable[(javax.management.ObjectName, Int)]]" class="delimiter">(</span><span class="delimiter">(</span>name: <span title="javax.management.ObjectName">ObjectName</span><span class="delimiter">)</span> =&gt;
          <span title="(_1: javax.management.ObjectName, _2: Int)(javax.management.ObjectName, Int)" class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.numExpectedAttributes.$anonfun.name" title="javax.management.ObjectName">name</a>, <a href="#kafka.tools.JmxTool.main.mbsc" title="javax.management.MBeanServerConnection">mbsc</a>.<span title="(x$1: javax.management.ObjectName)javax.management.MBeanInfo">getMBeanInfo</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.numExpectedAttributes.$anonfun.name" title="javax.management.ObjectName">name</a><span class="delimiter">)</span>.<span title="()Array[javax.management.MBeanAttributeInfo]">getAttributes</span><span title="(xs: Array[javax.management.MBeanAttributeInfo])scala.collection.mutable.ArrayOps[javax.management.MBeanAttributeInfo]" class="delimiter">(</span><span class="delimiter">)</span>.<span title="(f: javax.management.MBeanAttributeInfo =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Array[javax.management.MBeanAttributeInfo],String,Array[String]])Array[String]">map</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.numExpectedAttributes.$anonfun.$anonfun.x$4" title="javax.management.MBeanAttributeInfo">_</a>.<span title="()String">getName</span><span class="delimiter">)</span>.<span title="=&gt; Int">size</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit ev: &lt;:&lt;[(javax.management.ObjectName, Int),(javax.management.ObjectName, Int)])scala.collection.immutable.Map[javax.management.ObjectName,Int]">toMap</span>
      <span class="delimiter">}</span>

    <span class="comment">// print csv header</span>
    val keys = <span title="(xs: String*)List[String]">List</span><span class="delimiter">(</span><span title="String(&quot;time&quot;)" class="string">&quot;time&quot;</span><span class="delimiter">)</span> <a title="List[String]" id="kafka.tools.JmxTool.main.keys">++</a> <a href="#kafka.tools.JmxTool.queryAttributes" title="(mbsc: javax.management.MBeanServerConnection, names: Iterable[javax.management.ObjectName], attributesWhitelist: Option[Array[String]])scala.collection.mutable.HashMap[String,Any]">queryAttributes</a><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.mbsc" title="javax.management.MBeanServerConnection">mbsc</a>, <a href="#kafka.tools.JmxTool.main.names" title="Iterable[javax.management.ObjectName]">names</a>, <a href="#kafka.tools.JmxTool.main.attributesWhitelist" title="Option[Array[String]]">attributesWhitelist</a><span class="delimiter">)</span>.<span title="=&gt; Iterable[String]">keys</span>.<span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">toArray</span>.<span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">sorted</span>
    if<span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.keys" title="List[String]">keys</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#kafka.tools.JmxTool.main.numExpectedAttributes" title="Map[javax.management.ObjectName,Int]">numExpectedAttributes</a>.<span title="(f: ((javax.management.ObjectName, Int)) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[javax.management.ObjectName,Int],Int,scala.collection.immutable.Iterable[Int]])scala.collection.immutable.Iterable[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Iterable.Coll,Int,scala.collection.immutable.Iterable[Int]]" class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.$anonfun.x$5" title="(javax.management.ObjectName, Int)">_</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span>.<span title="(z: Int)(op: (Int, Int) =&gt; Int)Int">foldLeft</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.$anonfun.x$6" title="Int">_</a> <span title="(x: Int)Int">+</span> <a href="#kafka.tools.JmxTool.main.$anonfun.x$7" title="Int">_</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.keys" title="List[String]">keys</a>.<span title="(f: String =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],String,List[String]])List[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><span title="String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.JmxTool.main.$anonfun.x$8" title="String">_</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

    while<span class="delimiter">(</span>true<span class="delimiter">)</span> <a href="#kafka.tools.JmxTool.main.while$1" title="()Unit" class="delimiter">{</a>
      val <a title="Long" id="kafka.tools.JmxTool.main.start">start</a> = <span title="System.type">System</span>.<span title="()Long">currentTimeMillis</span>
      val <a title="scala.collection.mutable.HashMap[String,Any]" id="kafka.tools.JmxTool.main.attributes">attributes</a> = <a href="#kafka.tools.JmxTool.queryAttributes" title="(mbsc: javax.management.MBeanServerConnection, names: Iterable[javax.management.ObjectName], attributesWhitelist: Option[Array[String]])scala.collection.mutable.HashMap[String,Any]">queryAttributes</a><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.mbsc" title="javax.management.MBeanServerConnection">mbsc</a>, <a href="#kafka.tools.JmxTool.main.names" title="Iterable[javax.management.ObjectName]">names</a>, <a href="#kafka.tools.JmxTool.main.attributesWhitelist" title="Option[Array[String]]">attributesWhitelist</a><span class="delimiter">)</span>
      <a href="#kafka.tools.JmxTool.main.attributes" title="(key: String, value: Any)Unit">attributes</a><span class="delimiter">(</span><span title="String(&quot;time&quot;)" class="string">&quot;time&quot;</span><span class="delimiter">)</span> = <a href="#kafka.tools.JmxTool.main.dateFormat" title="Option[java.text.SimpleDateFormat]">dateFormat</a> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><a title="java.text.SimpleDateFormat" id="kafka.tools.JmxTool.main.dFormat">dFormat</a><span class="delimiter">)</span> =&gt; <a href="#kafka.tools.JmxTool.main.dFormat" title="java.text.SimpleDateFormat">dFormat</a>.<span title="(x$1: java.util.Date)String">format</span><span class="delimiter">(</span>new <span title="java.util.Date">Date</span><span class="delimiter">)</span>
        case <span title="None.type">None</span> =&gt; <span title="System.type">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()String">toString</span>
      <span class="delimiter">}</span>
      if<span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.attributes" title="scala.collection.mutable.HashMap[String,Any]">attributes</a>.<span title="=&gt; scala.collection.Set[String]">keySet</span>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#kafka.tools.JmxTool.main.numExpectedAttributes" title="Map[javax.management.ObjectName,Int]">numExpectedAttributes</a>.<span title="(f: ((javax.management.ObjectName, Int)) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[javax.management.ObjectName,Int],Int,scala.collection.immutable.Iterable[Int]])scala.collection.immutable.Iterable[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Iterable.Coll,Int,scala.collection.immutable.Iterable[Int]]" class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.$anonfun.x$9" title="(javax.management.ObjectName, Int)">_</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span>.<span title="(z: Int)(op: (Int, Int) =&gt; Int)Int">foldLeft</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.$anonfun.x$10" title="Int">_</a> <span title="(x: Int)Int">+</span> <a href="#kafka.tools.JmxTool.main.$anonfun.x$11" title="Int">_</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.keys" title="List[String]">keys</a>.<span title="(f: String =&gt; Any)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],Any,List[Any]])List[Any]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,Any,List[Any]]" class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.attributes" title="(key: String)Any">attributes</a><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.$anonfun.x$12" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      val <a title="Long" id="kafka.tools.JmxTool.main.sleep">sleep</a> = <span title="(x: Long, y: Long)Long">max</span><span class="delimiter">(</span><span title="Long(0L)" class="int">0</span>, <a href="#kafka.tools.JmxTool.main.interval" title="Int">interval</a> <span title="(x: Long)Long">-</span> <span class="delimiter">(</span><span title="System.type">System</span>.<span title="()Long">currentTimeMillis</span> <span title="(x: Long)Long">-</span> <a href="#kafka.tools.JmxTool.main.start" title="Long">start</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Thread.type">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.main.sleep" title="Long">sleep</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(mbsc: javax.management.MBeanServerConnection, names: Iterable[javax.management.ObjectName], attributesWhitelist: Option[Array[String]])scala.collection.mutable.HashMap[String,Any]" id="kafka.tools.JmxTool.queryAttributes">queryAttributes</a><span class="delimiter">(</span><a title="javax.management.MBeanServerConnection" id="kafka.tools.JmxTool.queryAttributes.mbsc">mbsc</a>: <span title="javax.management.MBeanServerConnection">MBeanServerConnection</span>, <a title="Iterable[javax.management.ObjectName]" id="kafka.tools.JmxTool.queryAttributes.names">names</a>: <span title="Iterable[javax.management.ObjectName]">Iterable</span><span class="delimiter">[</span>ObjectName<span class="delimiter">]</span>, <a title="Option[Array[String]]" id="kafka.tools.JmxTool.queryAttributes.attributesWhitelist">attributesWhitelist</a>: <span title="Option[Array[String]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    var <a title="scala.collection.mutable.HashMap[String,Any]" id="kafka.tools.JmxTool.queryAttributes.attributes">attributes</a> = new mutable.<span title="scala.collection.mutable.HashMap[String,Any]">HashMap</span><span class="delimiter">[</span>String, Any<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    for<span class="delimiter">(</span><a title="javax.management.ObjectName" id="kafka.tools.JmxTool.queryAttributes.$anonfun.name">name</a> &lt;- <a href="#kafka.tools.JmxTool.queryAttributes.names" title="(f: javax.management.ObjectName =&gt; Unit)Unit">names</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="javax.management.MBeanInfo" id="kafka.tools.JmxTool.queryAttributes.$anonfun.mbean">mbean</a> = <a href="#kafka.tools.JmxTool.queryAttributes.mbsc" title="javax.management.MBeanServerConnection">mbsc</a>.<span title="(x$1: javax.management.ObjectName)javax.management.MBeanInfo">getMBeanInfo</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.queryAttributes.$anonfun.name" title="javax.management.ObjectName">name</a><span class="delimiter">)</span>
      for<span class="delimiter">(</span><a title="Object" id="kafka.tools.JmxTool.queryAttributes.$anonfun.$anonfun.attrObj">attrObj</a> &lt;- <a href="#kafka.tools.JmxTool.queryAttributes.mbsc" title="javax.management.MBeanServerConnection">mbsc</a>.<span title="(x$1: javax.management.ObjectName, x$2: Array[String])javax.management.AttributeList">getAttributes</span><span title="(f: Object =&gt; Unit)Unit" class="delimiter">(</span><a href="#kafka.tools.JmxTool.queryAttributes.$anonfun.name" title="javax.management.ObjectName">name</a>, <a href="#kafka.tools.JmxTool.queryAttributes.$anonfun.mbean" title="javax.management.MBeanInfo">mbean</a>.<span title="(xs: Array[javax.management.MBeanAttributeInfo])scala.collection.mutable.ArrayOps[javax.management.MBeanAttributeInfo]">getAttributes</span>.<span title="(f: javax.management.MBeanAttributeInfo =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Array[javax.management.MBeanAttributeInfo],String,Array[String]])Array[String]">map</span><span title="(implicit t: scala.reflect.ClassTag[String])scala.collection.generic.CanBuildFrom[Array[_],String,Array[String]]" class="delimiter">(</span><a href="#kafka.tools.JmxTool.queryAttributes.$anonfun.$anonfun.x$13" title="javax.management.MBeanAttributeInfo">_</a>.<span title="()String">getName</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        val <a title="javax.management.Attribute" id="kafka.tools.JmxTool.queryAttributes.$anonfun.$anonfun.attr">attr</a> = <a href="#kafka.tools.JmxTool.queryAttributes.$anonfun.$anonfun.attrObj" title="Object">attrObj</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="javax.management.Attribute" class="delimiter">[</span><span title="javax.management.Attribute">Attribute</span><span class="delimiter">]</span>
        <a href="#kafka.tools.JmxTool.queryAttributes.attributesWhitelist" title="Option[Array[String]]">attributesWhitelist</a> match <span class="delimiter">{</span>
          case Some<span class="delimiter">(</span><a title="Array[String]" id="kafka.tools.JmxTool.queryAttributes.$anonfun.$anonfun.allowedAttributes">allowedAttributes</a><span class="delimiter">)</span> =&gt;
            if<span class="delimiter">(</span><a href="#kafka.tools.JmxTool.queryAttributes.$anonfun.$anonfun.allowedAttributes" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">allowedAttributes</a>.<span title="(elem: String)Boolean">contains</span><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.queryAttributes.$anonfun.$anonfun.attr" title="javax.management.Attribute">attr</a>.<span title="()String">getName</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <a href="#kafka.tools.JmxTool.queryAttributes.attributes" title="(key: String, value: Any)Unit">attributes</a><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.queryAttributes.$anonfun.name" title="(self: javax.management.ObjectName)any2stringadd[javax.management.ObjectName]">name</a> <span title="(other: String)String">+</span> <span title="String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.JmxTool.queryAttributes.$anonfun.$anonfun.attr" title="javax.management.Attribute">attr</a>.<span title="()String">getName</span><span class="delimiter">)</span> = <a href="#kafka.tools.JmxTool.queryAttributes.$anonfun.$anonfun.attr" title="javax.management.Attribute">attr</a>.<span title="()Object">getValue</span>
          case <span title="None.type">None</span> =&gt; <a href="#kafka.tools.JmxTool.queryAttributes.attributes" title="(key: String, value: Any)Unit">attributes</a><span class="delimiter">(</span><a href="#kafka.tools.JmxTool.queryAttributes.$anonfun.name" title="(self: javax.management.ObjectName)any2stringadd[javax.management.ObjectName]">name</a> <span title="(other: String)String">+</span> <span title="String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.JmxTool.queryAttributes.$anonfun.$anonfun.attr" title="javax.management.Attribute">attr</a>.<span title="()String">getName</span><span class="delimiter">)</span> = <a href="#kafka.tools.JmxTool.queryAttributes.$anonfun.$anonfun.attr" title="javax.management.Attribute">attr</a>.<span title="()Object">getValue</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#kafka.tools.JmxTool.queryAttributes.attributes" title="scala.collection.mutable.HashMap[String,Any]">attributes</a>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>
        </pre>
    </body>
</html>
