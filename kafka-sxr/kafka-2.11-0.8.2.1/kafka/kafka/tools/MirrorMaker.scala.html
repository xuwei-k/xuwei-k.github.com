<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>kafka/kafka/tools/MirrorMaker.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

package kafka.tools

import kafka.consumer._
import kafka.metrics.KafkaMetricsGroup
import kafka.producer.<span class="delimiter">{</span>BaseProducer, NewShinyProducer, OldProducer<span class="delimiter">}</span>
import kafka.serializer._
import kafka.utils._
import org.apache.kafka.clients.producer.<span class="delimiter">{</span>ProducerConfig, ProducerRecord<span class="delimiter">}</span>

import java.util.Random
import java.util.concurrent.atomic.<span class="delimiter">{</span>AtomicBoolean, AtomicInteger<span class="delimiter">}</span>
import java.util.concurrent.<span class="delimiter">{</span>BlockingQueue, ArrayBlockingQueue, CountDownLatch, TimeUnit<span class="delimiter">}</span>

import scala.collection.<span title="scala.collection.JavaConversions.type">JavaConversions</span>._

import joptsimple.OptionParser

object <a title="kafka.tools.MirrorMaker.type" id="kafka.tools.MirrorMaker">MirrorMaker</a> extends <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> <span class="delimiter">{</span>

  private var <a title="Seq[kafka.consumer.ZookeeperConsumerConnector]" id="kafka.tools.MirrorMaker.connectors_=">connectors</a>: <span title="Seq[kafka.consumer.ZookeeperConsumerConnector]">Seq</span><span class="delimiter">[</span>ZookeeperConsumerConnector<span class="delimiter">]</span> = null
  private var <a title="Seq[kafka.tools.MirrorMaker.ConsumerThread]" id="kafka.tools.MirrorMaker.consumerThreads_=">consumerThreads</a>: <span title="Seq[kafka.tools.MirrorMaker.ConsumerThread]">Seq</span><span class="delimiter">[</span>ConsumerThread<span class="delimiter">]</span> = null
  private var <a title="Seq[kafka.tools.MirrorMaker.ProducerThread]" id="kafka.tools.MirrorMaker.producerThreads_=">producerThreads</a>: <span title="Seq[kafka.tools.MirrorMaker.ProducerThread]">Seq</span><span class="delimiter">[</span>ProducerThread<span class="delimiter">]</span> = null
  private val <a title="java.util.concurrent.atomic.AtomicBoolean" id="kafka.tools.MirrorMaker.isShuttingdown">isShuttingdown</a>: <span title="java.util.concurrent.atomic.AtomicBoolean">AtomicBoolean</span> = new <span title="java.util.concurrent.atomic.AtomicBoolean">AtomicBoolean</span><span class="delimiter">(</span>false<span class="delimiter">)</span>

  private val <a title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]" id="kafka.tools.MirrorMaker.shutdownMessage">shutdownMessage</a> : <span title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">ProducerRecord</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>,Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span> = new <span title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">ProducerRecord</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>,Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="String(&quot;shutdown&quot;)" class="string">&quot;shutdown&quot;</span>, <span title="String(&quot;shutdown&quot;)" class="string">&quot;shutdown&quot;</span>.<span title="()Array[Byte]">getBytes</span><span class="delimiter">)</span>

  def <a title="(args: Array[String])Unit" id="kafka.tools.MirrorMaker.main">main</a><span class="delimiter">(</span><a title="Array[String]" id="kafka.tools.MirrorMaker.main.args">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a> <span class="delimiter">(</span><span title="String(&quot;Starting mirror maker&quot;)" class="string">&quot;Starting mirror maker&quot;</span><span class="delimiter">)</span>
    val <a title="joptsimple.OptionParser" id="kafka.tools.MirrorMaker.main.parser">parser</a> = new <span title="joptsimple.OptionParser">OptionParser</span>

    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.tools.MirrorMaker.main.consumerConfigOpt">consumerConfigOpt</a> = <a href="#kafka.tools.MirrorMaker.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;consumer.config&quot;)" class="string">&quot;consumer.config&quot;</span>,
      <span class="string">&quot;Consumer config to consume from a source cluster. &quot;</span> <span title="String(&quot;Consumer config to consume from a source cluster. You may specify multiple of these.&quot;)">+</span>
      <span class="string">&quot;You may specify multiple of these.&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;config file&quot;)" class="string">&quot;config file&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>

    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.tools.MirrorMaker.main.producerConfigOpt">producerConfigOpt</a> = <a href="#kafka.tools.MirrorMaker.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;producer.config&quot;)" class="string">&quot;producer.config&quot;</span>,
      <span title="String(&quot;Embedded producer config.&quot;)" class="string">&quot;Embedded producer config.&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;config file&quot;)" class="string">&quot;config file&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>

    val <a title="joptsimple.OptionSpecBuilder" id="kafka.tools.MirrorMaker.main.useNewProducerOpt">useNewProducerOpt</a> = <a href="#kafka.tools.MirrorMaker.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;new.producer&quot;)" class="string">&quot;new.producer&quot;</span>,
      <span title="String(&quot;Use the new producer implementation.&quot;)" class="string">&quot;Use the new producer implementation.&quot;</span><span class="delimiter">)</span>

    val <a title="joptsimple.ArgumentAcceptingOptionSpec[Integer]" id="kafka.tools.MirrorMaker.main.numProducersOpt">numProducersOpt</a> = <a href="#kafka.tools.MirrorMaker.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;num.producers&quot;)" class="string">&quot;num.producers&quot;</span>,
      <span title="String(&quot;Number of producer instances&quot;)" class="string">&quot;Number of producer instances&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;Number of producers&quot;)" class="string">&quot;Number of producers&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[Integer])joptsimple.ArgumentAcceptingOptionSpec[Integer]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[Integer](classOf[java.lang.Integer])" class="delimiter">[</span>java.lang.Integer<span class="delimiter">]</span><span class="delimiter">)</span>
      .<span title="(x$1: Integer, x$2: Integer*)joptsimple.ArgumentAcceptingOptionSpec[Integer]">defaultsTo</span><span class="delimiter">(</span><span title="implicit scala.Predef.int2Integer : (x: Int)Integer" class="int">1</span><span class="delimiter">)</span>
    
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[Integer]" id="kafka.tools.MirrorMaker.main.numStreamsOpt">numStreamsOpt</a> = <a href="#kafka.tools.MirrorMaker.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;num.streams&quot;)" class="string">&quot;num.streams&quot;</span>,
      <span title="String(&quot;Number of consumption streams.&quot;)" class="string">&quot;Number of consumption streams.&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;Number of threads&quot;)" class="string">&quot;Number of threads&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[Integer])joptsimple.ArgumentAcceptingOptionSpec[Integer]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[Integer](classOf[java.lang.Integer])" class="delimiter">[</span>java.lang.Integer<span class="delimiter">]</span><span class="delimiter">)</span>
      .<span title="(x$1: Integer, x$2: Integer*)joptsimple.ArgumentAcceptingOptionSpec[Integer]">defaultsTo</span><span class="delimiter">(</span><span title="implicit scala.Predef.int2Integer : (x: Int)Integer" class="int">1</span><span class="delimiter">)</span>

    val <a title="joptsimple.ArgumentAcceptingOptionSpec[Integer]" id="kafka.tools.MirrorMaker.main.bufferSizeOpt">bufferSizeOpt</a> =  <a href="#kafka.tools.MirrorMaker.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;queue.size&quot;)" class="string">&quot;queue.size&quot;</span>,
      <span title="String(&quot;Number of messages that are buffered between the consumer and producer&quot;)" class="string">&quot;Number of messages that are buffered between the consumer and producer&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;Queue size in terms of number of messages&quot;)" class="string">&quot;Queue size in terms of number of messages&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[Integer])joptsimple.ArgumentAcceptingOptionSpec[Integer]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[Integer](classOf[java.lang.Integer])" class="delimiter">[</span>java.lang.Integer<span class="delimiter">]</span><span class="delimiter">)</span>
      .<span title="(x$1: Integer, x$2: Integer*)joptsimple.ArgumentAcceptingOptionSpec[Integer]">defaultsTo</span><span class="delimiter">(</span><span title="implicit scala.Predef.int2Integer : (x: Int)Integer" class="int">10000</span><span class="delimiter">)</span>

    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.tools.MirrorMaker.main.whitelistOpt">whitelistOpt</a> = <a href="#kafka.tools.MirrorMaker.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;whitelist&quot;)" class="string">&quot;whitelist&quot;</span>,
      <span title="String(&quot;Whitelist of topics to mirror.&quot;)" class="string">&quot;Whitelist of topics to mirror.&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;Java regex (String)&quot;)" class="string">&quot;Java regex (String)&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>

    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.tools.MirrorMaker.main.blacklistOpt">blacklistOpt</a> = <a href="#kafka.tools.MirrorMaker.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;blacklist&quot;)" class="string">&quot;blacklist&quot;</span>,
      <span title="String(&quot;Blacklist of topics to mirror.&quot;)" class="string">&quot;Blacklist of topics to mirror.&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;Java regex (String)&quot;)" class="string">&quot;Java regex (String)&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>

    val <a title="joptsimple.OptionSpecBuilder" id="kafka.tools.MirrorMaker.main.helpOpt">helpOpt</a> = <a href="#kafka.tools.MirrorMaker.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;help&quot;)" class="string">&quot;help&quot;</span>, <span title="String(&quot;Print this message.&quot;)" class="string">&quot;Print this message.&quot;</span><span class="delimiter">)</span>
    
    if<span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.args" title="Array[String]">args</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils" title="kafka.utils.CommandLineUtils.type">CommandLineUtils</a>.<a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils.printUsageAndDie" title="(parser: joptsimple.OptionParser, message: String)Unit">printUsageAndDie</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.parser" title="joptsimple.OptionParser">parser</a>, <span title="String(&quot;Continuously copy data between two Kafka clusters.&quot;)" class="string">&quot;Continuously copy data between two Kafka clusters.&quot;</span><span class="delimiter">)</span>

    val <a title="joptsimple.OptionSet" id="kafka.tools.MirrorMaker.main.options">options</a> = <a href="#kafka.tools.MirrorMaker.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: String*)joptsimple.OptionSet">parse</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.args" title="Array[String]">args</a> : _*<span class="delimiter">)</span>

    if <span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.helpOpt" title="joptsimple.OptionSpecBuilder">helpOpt</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#kafka.tools.MirrorMaker.main.parser" title="joptsimple.OptionParser">parser</a>.<span title="(x$1: java.io.OutputStream)Unit">printHelpOn</span><span class="delimiter">(</span><span title="System.type">System</span>.<span title="java.io.PrintStream">out</span><span class="delimiter">)</span>
      <span title="System.type">System</span>.<span title="(x$1: Int)Unit">exit</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils" title="kafka.utils.CommandLineUtils.type">CommandLineUtils</a>.<a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils.checkRequiredArgs" title="(parser: joptsimple.OptionParser, options: joptsimple.OptionSet, required: joptsimple.OptionSpec[_]*)Unit">checkRequiredArgs</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.parser" title="joptsimple.OptionParser">parser</a>, <a href="#kafka.tools.MirrorMaker.main.options" title="joptsimple.OptionSet">options</a>, <a href="#kafka.tools.MirrorMaker.main.consumerConfigOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">consumerConfigOpt</a>, <a href="#kafka.tools.MirrorMaker.main.producerConfigOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">producerConfigOpt</a><span class="delimiter">)</span>
    if <span class="delimiter">(</span><span title="(xs: joptsimple.ArgumentAcceptingOptionSpec[String]*)List[joptsimple.ArgumentAcceptingOptionSpec[String]]">List</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.whitelistOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">whitelistOpt</a>, <a href="#kafka.tools.MirrorMaker.main.blacklistOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">blacklistOpt</a><span class="delimiter">)</span>.<span title="(p: joptsimple.ArgumentAcceptingOptionSpec[String] =&gt; Boolean)Int">count</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.options" title="joptsimple.OptionSet">options</a>.<a href="#kafka.tools.MirrorMaker.main.$anonfun.x$1" title="(x$1: joptsimple.OptionSpec[_])Boolean">has</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;Exactly one of whitelist or blacklist is required.&quot;)" class="string">&quot;Exactly one of whitelist or blacklist is required.&quot;</span><span class="delimiter">)</span>
      <span title="System.type">System</span>.<span title="(x$1: Int)Unit">exit</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    val <a title="Int" id="kafka.tools.MirrorMaker.main.numProducers">numProducers</a> = <a href="#kafka.tools.MirrorMaker.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.numProducersOpt" title="joptsimple.ArgumentAcceptingOptionSpec[Integer]">numProducersOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="Int" id="kafka.tools.MirrorMaker.main.numStreams">numStreams</a> = <a href="#kafka.tools.MirrorMaker.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.numStreamsOpt" title="joptsimple.ArgumentAcceptingOptionSpec[Integer]">numStreamsOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="Int" id="kafka.tools.MirrorMaker.main.bufferSize">bufferSize</a> = <a href="#kafka.tools.MirrorMaker.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.bufferSizeOpt" title="joptsimple.ArgumentAcceptingOptionSpec[Integer]">bufferSizeOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="comment">// create consumer streams</span>
    <a href="#kafka.tools.MirrorMaker.connectors_=" title="(x$1: Seq[kafka.consumer.ZookeeperConsumerConnector])Unit">connectors</a> = <a href="#kafka.tools.MirrorMaker.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])java.util.List[String]">valuesOf</span><span title="(l: java.util.List[String])scala.collection.mutable.Buffer[String]" class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.consumerConfigOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">consumerConfigOpt</a><span class="delimiter">)</span>.<span title="=&gt; List[String]">toList</span>
      .<span title="(f: String =&gt; kafka.consumer.ConsumerConfig)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],kafka.consumer.ConsumerConfig,List[kafka.consumer.ConsumerConfig]])List[kafka.consumer.ConsumerConfig]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,kafka.consumer.ConsumerConfig,List[kafka.consumer.ConsumerConfig]]" class="delimiter">(</span><a title="String" id="kafka.tools.MirrorMaker.main.$anonfun.cfg">cfg</a> =&gt; new <a href="../consumer/ConsumerConfig.scala.html#kafka.consumer;ConsumerConfig" title="kafka.consumer.ConsumerConfig">ConsumerConfig</a><span class="delimiter">(</span><a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Utils.scala.html#kafka.utils.Utils.loadProps" title="(filename: String)java.util.Properties">loadProps</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.$anonfun.cfg" title="String">cfg</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      .<span title="(f: kafka.consumer.ConsumerConfig =&gt; kafka.consumer.ZookeeperConsumerConnector)(implicit bf: scala.collection.generic.CanBuildFrom[List[kafka.consumer.ConsumerConfig],kafka.consumer.ZookeeperConsumerConnector,Seq[kafka.consumer.ZookeeperConsumerConnector]])Seq[kafka.consumer.ZookeeperConsumerConnector]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,kafka.consumer.ZookeeperConsumerConnector,List[kafka.consumer.ZookeeperConsumerConnector]]" class="delimiter">(</span>new <a href="../consumer/ZookeeperConsumerConnector.scala.html#kafka.consumer;ZookeeperConsumerConnector" title="kafka.consumer.ZookeeperConsumerConnector">ZookeeperConsumerConnector</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.$anonfun.x$1" title="kafka.consumer.ConsumerConfig">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    val numConsumers = <a href="#kafka.tools.MirrorMaker.connectors_=" title="=&gt; Seq[kafka.consumer.ZookeeperConsumerConnector]">connectors</a>.<span title="=&gt; Int">size</span> <a title="Int" id="kafka.tools.MirrorMaker.main.numConsumers">*</a> <a href="#kafka.tools.MirrorMaker.main.numStreams" title="Int">numStreams</a>

    <span class="comment">// create a data channel btw the consumers and the producers</span>
    val <a title="kafka.tools.MirrorMaker.DataChannel" id="kafka.tools.MirrorMaker.main.mirrorDataChannel">mirrorDataChannel</a> = new <a href="#kafka.tools.MirrorMaker;DataChannel" title="kafka.tools.MirrorMaker.DataChannel">DataChannel</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.bufferSize" title="Int">bufferSize</a>, <a href="#kafka.tools.MirrorMaker.main.numConsumers" title="Int">numConsumers</a>, <a href="#kafka.tools.MirrorMaker.main.numProducers" title="Int">numProducers</a><span class="delimiter">)</span>

    <span class="comment">// create producer threads</span>
    val <a title="Boolean" id="kafka.tools.MirrorMaker.main.useNewProducer">useNewProducer</a> = <a href="#kafka.tools.MirrorMaker.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.useNewProducerOpt" title="joptsimple.OptionSpecBuilder">useNewProducerOpt</a><span class="delimiter">)</span>
    val <a title="java.util.Properties" id="kafka.tools.MirrorMaker.main.producerProps">producerProps</a> = <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Utils.scala.html#kafka.utils.Utils.loadProps" title="(filename: String)java.util.Properties">loadProps</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])String">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.producerConfigOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">producerConfigOpt</a><span class="delimiter">)</span><span class="delimiter">)</span>
    val <a title="String" id="kafka.tools.MirrorMaker.main.clientId">clientId</a> = <a href="#kafka.tools.MirrorMaker.main.producerProps" title="java.util.Properties">producerProps</a>.<span title="(x$1: String, x$2: String)String">getProperty</span><span class="delimiter">(</span><span title="String(&quot;client.id&quot;)" class="string">&quot;client.id&quot;</span>, <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
    <a href="#kafka.tools.MirrorMaker.producerThreads_=" title="(x$1: Seq[kafka.tools.MirrorMaker.ProducerThread])Unit">producerThreads</a> = <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range">until</span> <a href="#kafka.tools.MirrorMaker.main.numProducers" title="Int">numProducers</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; kafka.tools.MirrorMaker.ProducerThread)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Int],kafka.tools.MirrorMaker.ProducerThread,Seq[kafka.tools.MirrorMaker.ProducerThread]])Seq[kafka.tools.MirrorMaker.ProducerThread]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq.Coll,kafka.tools.MirrorMaker.ProducerThread,scala.collection.immutable.IndexedSeq[kafka.tools.MirrorMaker.ProducerThread]]" class="delimiter">(</span><a title="Int" id="kafka.tools.MirrorMaker.main.$anonfun.i">i</a> =&gt; <span class="delimiter">{</span>
      <a href="#kafka.tools.MirrorMaker.main.producerProps" title="java.util.Properties">producerProps</a>.<span title="(x$1: String, x$2: String)Object">setProperty</span><span class="delimiter">(</span><span title="String(&quot;client.id&quot;)" class="string">&quot;client.id&quot;</span>, <a href="#kafka.tools.MirrorMaker.main.clientId" title="String">clientId</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;-&quot;)" class="string">&quot;-&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.MirrorMaker.main.$anonfun.i" title="Int">i</a><span class="delimiter">)</span>
      val <a title="kafka.producer.BaseProducer" id="kafka.tools.MirrorMaker.main.$anonfun.producer">producer</a> =
      if <span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.useNewProducer" title="Boolean">useNewProducer</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#kafka.tools.MirrorMaker.main.producerProps" title="java.util.Properties">producerProps</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span>ProducerConfig.<span title="String(&quot;key.serializer&quot;)">KEY_SERIALIZER_CLASS_CONFIG</span>, <span title="String(&quot;org.apache.kafka.common.serialization.ByteArraySerializer&quot;)" class="string">&quot;org.apache.kafka.common.serialization.ByteArraySerializer&quot;</span><span class="delimiter">)</span>
        <a href="#kafka.tools.MirrorMaker.main.producerProps" title="java.util.Properties">producerProps</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span>ProducerConfig.<span title="String(&quot;value.serializer&quot;)">VALUE_SERIALIZER_CLASS_CONFIG</span>, <span title="String(&quot;org.apache.kafka.common.serialization.ByteArraySerializer&quot;)" class="string">&quot;org.apache.kafka.common.serialization.ByteArraySerializer&quot;</span><span class="delimiter">)</span>
        new <a href="../producer/BaseProducer.scala.html#kafka.producer;NewShinyProducer" title="kafka.producer.NewShinyProducer">NewShinyProducer</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.producerProps" title="java.util.Properties">producerProps</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      else
        new <a href="../producer/BaseProducer.scala.html#kafka.producer;OldProducer" title="kafka.producer.OldProducer">OldProducer</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.producerProps" title="java.util.Properties">producerProps</a><span class="delimiter">)</span>
      new <a href="#kafka.tools.MirrorMaker;ProducerThread" title="kafka.tools.MirrorMaker.ProducerThread">ProducerThread</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.mirrorDataChannel" title="kafka.tools.MirrorMaker.DataChannel">mirrorDataChannel</a>, <a href="#kafka.tools.MirrorMaker.main.$anonfun.producer" title="kafka.producer.BaseProducer">producer</a>, <a href="#kafka.tools.MirrorMaker.main.$anonfun.i" title="Int">i</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <span class="comment">// create consumer threads</span>
    val <a title="&lt;refinement of kafka.consumer.TopicFilter with Product&gt; extends kafka.consumer.TopicFilter with Product with Serializable" id="kafka.tools.MirrorMaker.main.filterSpec">filterSpec</a> = if <span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.whitelistOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">whitelistOpt</a><span class="delimiter">)</span><span class="delimiter">)</span>
      new <a href="../consumer/TopicFilter.scala.html#kafka.consumer;Whitelist" title="kafka.consumer.Whitelist">Whitelist</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])String">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.whitelistOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">whitelistOpt</a><span class="delimiter">)</span><span class="delimiter">)</span>
    else
      new <a href="../consumer/TopicFilter.scala.html#kafka.consumer;Blacklist" title="kafka.consumer.Blacklist">Blacklist</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.options" title="joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])String">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.blacklistOpt" title="joptsimple.ArgumentAcceptingOptionSpec[String]">blacklistOpt</a><span class="delimiter">)</span><span class="delimiter">)</span>

    var <a title="Seq[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]]" id="kafka.tools.MirrorMaker.main.streams">streams</a>: <span title="Seq[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]]">Seq</span><span class="delimiter">[</span>KafkaStream<span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>, Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span> = <span title="scala.collection.immutable.Nil.type">Nil</span>
    try <span class="delimiter">{</span>
      <a href="#kafka.tools.MirrorMaker.main.streams" title="Seq[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]]">streams</a> = <a href="#kafka.tools.MirrorMaker.connectors_=" title="=&gt; Seq[kafka.consumer.ZookeeperConsumerConnector]">connectors</a>.<span title="(f: kafka.consumer.ZookeeperConsumerConnector =&gt; Seq[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[kafka.consumer.ZookeeperConsumerConnector],Seq[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]],Seq[Seq[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]]]])Seq[Seq[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Seq[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]],Seq[Seq[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]]]]" class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.$anonfun.x$2" title="kafka.consumer.ZookeeperConsumerConnector">_</a>.<a href="../consumer/ZookeeperConsumerConnector.scala.html#kafka.consumer;ZookeeperConsumerConnector.createMessageStreamsByFilter" title="(topicFilter: kafka.consumer.TopicFilter, numStreams: Int, keyDecoder: kafka.serializer.Decoder[Array[Byte]], valueDecoder: kafka.serializer.Decoder[Array[Byte]])Seq[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]]">createMessageStreamsByFilter</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.filterSpec" title="&lt;refinement of kafka.consumer.TopicFilter with Product&gt; extends kafka.consumer.TopicFilter with Product with Serializable">filterSpec</a>, <a href="#kafka.tools.MirrorMaker.main.numStreams" title="Int">numStreams</a>, new <a href="../serializer/Decoder.scala.html#kafka.serializer;DefaultDecoder" title="kafka.serializer.DefaultDecoder">DefaultDecoder</a><span class="delimiter">(</span><span class="delimiter">)</span>, new <a href="../serializer/Decoder.scala.html#kafka.serializer;DefaultDecoder" title="kafka.serializer.DefaultDecoder">DefaultDecoder</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit asTraversable: Seq[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]] =&gt; scala.collection.GenTraversableOnce[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]])Seq[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]]">flatten</span>
    <span class="delimiter">}</span> catch <span class="delimiter">{</span>
      case <a title="Throwable" id="kafka.tools.MirrorMaker.main.t">t</a>: <span title="Throwable">Throwable</span> =&gt;
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.fatal(1729dbc42f)" title="(msg: =&gt; String)Unit">fatal</a><span class="delimiter">(</span><span title="String(&quot;Unable to create stream - shutting down mirror maker.&quot;)" class="string">&quot;Unable to create stream - shutting down mirror maker.&quot;</span><span class="delimiter">)</span>
        <a href="#kafka.tools.MirrorMaker.connectors_=" title="=&gt; Seq[kafka.consumer.ZookeeperConsumerConnector]">connectors</a>.<span title="(f: kafka.consumer.ZookeeperConsumerConnector =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.$anonfun.x$3" title="kafka.consumer.ZookeeperConsumerConnector">_</a>.<a href="../consumer/ZookeeperConsumerConnector.scala.html#kafka.consumer;ZookeeperConsumerConnector.shutdown" title="()Unit">shutdown</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#kafka.tools.MirrorMaker.consumerThreads_=" title="(x$1: Seq[kafka.tools.MirrorMaker.ConsumerThread])Unit">consumerThreads</a> = <a href="#kafka.tools.MirrorMaker.main.streams" title="Seq[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]]">streams</a>.<span title="(implicit bf: scala.collection.generic.CanBuildFrom[Seq[kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]],(kafka.consumer.KafkaStream[Array[Byte],Array[Byte]], Int),Seq[(kafka.consumer.KafkaStream[Array[Byte],Array[Byte]], Int)]])Seq[(kafka.consumer.KafkaStream[Array[Byte],Array[Byte]], Int)]">zipWithIndex</span>.<span title="(f: ((kafka.consumer.KafkaStream[Array[Byte],Array[Byte]], Int)) =&gt; kafka.tools.MirrorMaker.ConsumerThread)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(kafka.consumer.KafkaStream[Array[Byte],Array[Byte]], Int)],kafka.tools.MirrorMaker.ConsumerThread,Seq[kafka.tools.MirrorMaker.ConsumerThread]])Seq[kafka.tools.MirrorMaker.ConsumerThread]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,kafka.tools.MirrorMaker.ConsumerThread,Seq[kafka.tools.MirrorMaker.ConsumerThread]]" class="delimiter">(</span><a title="(kafka.consumer.KafkaStream[Array[Byte],Array[Byte]], Int)" id="kafka.tools.MirrorMaker.main.$anonfun.streamAndIndex">streamAndIndex</a> =&gt; new <a href="#kafka.tools.MirrorMaker;ConsumerThread" title="kafka.tools.MirrorMaker.ConsumerThread">ConsumerThread</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.$anonfun.streamAndIndex" title="(kafka.consumer.KafkaStream[Array[Byte],Array[Byte]], Int)">streamAndIndex</a>.<span title="=&gt; kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]">_1</span>, <a href="#kafka.tools.MirrorMaker.main.mirrorDataChannel" title="kafka.tools.MirrorMaker.DataChannel">mirrorDataChannel</a>, <a href="#kafka.tools.MirrorMaker.main.$anonfun.streamAndIndex" title="(kafka.consumer.KafkaStream[Array[Byte],Array[Byte]], Int)">streamAndIndex</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.consumerThreads_=" title="=&gt; Seq[kafka.tools.MirrorMaker.ConsumerThread]">consumerThreads</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#kafka.tools.MirrorMaker.main.numConsumers" title="Int">numConsumers</a><span class="delimiter">)</span>

    <span title="Runtime.type">Runtime</span>.<span title="()Runtime">getRuntime</span>.<span title="(x$1: Thread)Unit">addShutdownHook</span><span class="delimiter">(</span>new <a title="&lt;$anon: Thread&gt; extends Thread" id="kafka.tools.MirrorMaker.main;$anon">Thread</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      override def <a title="()Unit" id="kafka.tools.MirrorMaker.main;$anon.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#kafka.tools.MirrorMaker.cleanShutdown" title="()Unit">cleanShutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <a href="#kafka.tools.MirrorMaker.consumerThreads_=" title="=&gt; Seq[kafka.tools.MirrorMaker.ConsumerThread]">consumerThreads</a>.<span title="(f: kafka.tools.MirrorMaker.ConsumerThread =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.$anonfun.x$4" title="kafka.tools.MirrorMaker.ConsumerThread">_</a>.<span title="()Unit">start</span><span class="delimiter">)</span>
    <a href="#kafka.tools.MirrorMaker.producerThreads_=" title="=&gt; Seq[kafka.tools.MirrorMaker.ProducerThread]">producerThreads</a>.<span title="(f: kafka.tools.MirrorMaker.ProducerThread =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.$anonfun.x$5" title="kafka.tools.MirrorMaker.ProducerThread">_</a>.<span title="()Unit">start</span><span class="delimiter">)</span>

    <span class="comment">// we wait on producer's shutdown latch instead of consumers</span>
    <span class="comment">// since the consumer threads can hit a timeout/other exception;</span>
    <span class="comment">// but in this case the producer should still be able to shutdown</span>
    <span class="comment">// based on the shutdown message in the channel</span>
    <a href="#kafka.tools.MirrorMaker.producerThreads_=" title="=&gt; Seq[kafka.tools.MirrorMaker.ProducerThread]">producerThreads</a>.<span title="(f: kafka.tools.MirrorMaker.ProducerThread =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.main.$anonfun.x$6" title="kafka.tools.MirrorMaker.ProducerThread">_</a>.<a href="#kafka.tools.MirrorMaker;ProducerThread.awaitShutdown" title="=&gt; Unit">awaitShutdown</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="()Unit" id="kafka.tools.MirrorMaker.cleanShutdown">cleanShutdown</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.isShuttingdown" title="=&gt; java.util.concurrent.atomic.AtomicBoolean">isShuttingdown</a>.<span title="(x$1: Boolean, x$2: Boolean)Boolean">compareAndSet</span><span class="delimiter">(</span>false, true<span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.connectors_=" title="=&gt; Seq[kafka.consumer.ZookeeperConsumerConnector]">connectors</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <a href="#kafka.tools.MirrorMaker.connectors_=" title="=&gt; Seq[kafka.consumer.ZookeeperConsumerConnector]">connectors</a>.<span title="(f: kafka.consumer.ZookeeperConsumerConnector =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.cleanShutdown.$anonfun.x$7" title="kafka.consumer.ZookeeperConsumerConnector">_</a>.<a href="../consumer/ZookeeperConsumerConnector.scala.html#kafka.consumer;ZookeeperConsumerConnector.shutdown" title="()Unit">shutdown</a><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.consumerThreads_=" title="=&gt; Seq[kafka.tools.MirrorMaker.ConsumerThread]">consumerThreads</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <a href="#kafka.tools.MirrorMaker.consumerThreads_=" title="=&gt; Seq[kafka.tools.MirrorMaker.ConsumerThread]">consumerThreads</a>.<span title="(f: kafka.tools.MirrorMaker.ConsumerThread =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.cleanShutdown.$anonfun.x$8" title="kafka.tools.MirrorMaker.ConsumerThread">_</a>.<a href="#kafka.tools.MirrorMaker;ConsumerThread.awaitShutdown" title="()Unit">awaitShutdown</a><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.producerThreads_=" title="=&gt; Seq[kafka.tools.MirrorMaker.ProducerThread]">producerThreads</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#kafka.tools.MirrorMaker.producerThreads_=" title="=&gt; Seq[kafka.tools.MirrorMaker.ProducerThread]">producerThreads</a>.<span title="(f: kafka.tools.MirrorMaker.ProducerThread =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.cleanShutdown.$anonfun.x$9" title="kafka.tools.MirrorMaker.ProducerThread">_</a>.<a href="#kafka.tools.MirrorMaker;ProducerThread.shutdown" title="=&gt; Unit">shutdown</a><span class="delimiter">)</span>
        <a href="#kafka.tools.MirrorMaker.producerThreads_=" title="=&gt; Seq[kafka.tools.MirrorMaker.ProducerThread]">producerThreads</a>.<span title="(f: kafka.tools.MirrorMaker.ProducerThread =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.cleanShutdown.$anonfun.x$10" title="kafka.tools.MirrorMaker.ProducerThread">_</a>.<a href="#kafka.tools.MirrorMaker;ProducerThread.awaitShutdown" title="=&gt; Unit">awaitShutdown</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Kafka mirror maker shutdown successfully&quot;)" class="string">&quot;Kafka mirror maker shutdown successfully&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  class <a title="class DataChannel extends AnyRef with kafka.metrics.KafkaMetricsGroup" id="kafka.tools.MirrorMaker;DataChannel">DataChannel</a><a href="#kafka.tools.MirrorMaker;DataChannel" title="kafka.tools.MirrorMaker.DataChannel" class="delimiter">(</a><a title="Int" id="kafka.tools.MirrorMaker;DataChannel.capacity">capacity</a>: <span title="Int">Int</span>, <a title="Int" id="kafka.tools.MirrorMaker;DataChannel.numInputs">numInputs</a>: <span title="Int">Int</span>, <a title="Int" id="kafka.tools.MirrorMaker;DataChannel.numOutputs">numOutputs</a>: <span title="Int">Int</span><span class="delimiter">)</span> extends <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup" title="kafka.metrics.KafkaMetricsGroup">KafkaMetricsGroup</a> <span class="delimiter">{</span>

    val <a title="Array[java.util.concurrent.BlockingQueue[org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]]]" id="kafka.tools.MirrorMaker;DataChannel.queues">queues</a> = new <span title="Array[java.util.concurrent.BlockingQueue[org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]]]">Array</span><span class="delimiter">[</span>BlockingQueue<span class="delimiter">[</span>ProducerRecord<span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>,Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;DataChannel.numOutputs" title="Int">numOutputs</a><span class="delimiter">)</span>
    for <span class="delimiter">(</span><a title="Int" id="kafka.tools.MirrorMaker;DataChannel.<local DataChannel>.$anonfun.i">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(f: Int =&gt; Unit)Unit">until</span> <a href="#kafka.tools.MirrorMaker;DataChannel.numOutputs" title="Int">numOutputs</a><span class="delimiter">)</span>
      <a href="#kafka.tools.MirrorMaker;DataChannel.queues" title="(i: Int, x: java.util.concurrent.BlockingQueue[org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]])Unit">queues</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;DataChannel.<local DataChannel>.$anonfun.i" title="Int">i</a><span class="delimiter">)</span> = new <span title="java.util.concurrent.ArrayBlockingQueue[org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]]">ArrayBlockingQueue</span><span class="delimiter">[</span>ProducerRecord<span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>,Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;DataChannel.capacity" title="Int">capacity</a><span class="delimiter">)</span>

    private val <a title="java.util.concurrent.atomic.AtomicInteger" id="kafka.tools.MirrorMaker;DataChannel.counter">counter</a> = new <span title="java.util.concurrent.atomic.AtomicInteger">AtomicInteger</span><span class="delimiter">(</span>new <span title="java.util.Random">Random</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Int">nextInt</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="comment">// We use a single meter for aggregated wait percentage for the data channel.</span>
    <span class="comment">// Since meter is calculated as total_recorded_value / time_window and</span>
    <span class="comment">// time_window is independent of the number of threads, each recorded wait</span>
    <span class="comment">// time should be discounted by # threads.</span>
    private val <a title="com.yammer.metrics.core.Meter" id="kafka.tools.MirrorMaker;DataChannel.waitPut">waitPut</a> = <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newMeter" title="(name: String, eventType: String, timeUnit: java.util.concurrent.TimeUnit, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Meter">newMeter</a><span class="delimiter">(</span><span title="String(&quot;MirrorMaker-DataChannel-WaitOnPut&quot;)" class="string">&quot;MirrorMaker-DataChannel-WaitOnPut&quot;</span>, <span title="String(&quot;percent&quot;)" class="string">&quot;percent&quot;</span>, TimeUnit.<span title="java.util.concurrent.TimeUnit(NANOSECONDS)">NANOSECONDS</span><span class="delimiter">)</span>
    private val <a title="com.yammer.metrics.core.Meter" id="kafka.tools.MirrorMaker;DataChannel.waitTake">waitTake</a> = <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newMeter" title="(name: String, eventType: String, timeUnit: java.util.concurrent.TimeUnit, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Meter">newMeter</a><span class="delimiter">(</span><span title="String(&quot;MirrorMaker-DataChannel-WaitOnTake&quot;)" class="string">&quot;MirrorMaker-DataChannel-WaitOnTake&quot;</span>, <span title="String(&quot;percent&quot;)" class="string">&quot;percent&quot;</span>, TimeUnit.<span title="java.util.concurrent.TimeUnit(NANOSECONDS)">NANOSECONDS</span><span class="delimiter">)</span>
    private val <a title="com.yammer.metrics.core.Histogram" id="kafka.tools.MirrorMaker;DataChannel.channelSizeHist">channelSizeHist</a> = <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup.newHistogram" title="(name: String, biased: Boolean, tags: scala.collection.Map[String,String])com.yammer.metrics.core.Histogram">newHistogram</a><span class="delimiter">(</span><span title="String(&quot;MirrorMaker-DataChannel-Size&quot;)" class="string">&quot;MirrorMaker-DataChannel-Size&quot;</span><span class="delimiter">)</span>

    def <a title="(record: org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]])Unit" id="kafka.tools.MirrorMaker;DataChannel.put(6e380272aa)">put</a><span class="delimiter">(</span><a title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]" id="kafka.tools.MirrorMaker;DataChannel.put(6e380272aa).record">record</a>: <span title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">ProducerRecord</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>,Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// If the key of the message is empty, use round-robin to select the queue</span>
      <span class="comment">// Otherwise use the queue based on the key value so that same key-ed messages go to the same queue</span>
      val <a title="Int" id="kafka.tools.MirrorMaker;DataChannel.put(6e380272aa).queueId">queueId</a> =
        if<span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;DataChannel.put(6e380272aa).record" title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">record</a>.<span title="()Array[Byte]">key</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Utils.scala.html#kafka.utils.Utils.abs" title="(n: Int)Int">abs</a><span class="delimiter">(</span>java.util.<span title="java.util.Arrays.type">Arrays</span>.<span title="(x$1: Array[Byte])Int">hashCode</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;DataChannel.put(6e380272aa).record" title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">record</a>.<span title="()Array[Byte]">key</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Int)Int">%</span> <a href="#kafka.tools.MirrorMaker;DataChannel.numOutputs" title="Int">numOutputs</a>
        <span class="delimiter">}</span> else <span class="delimiter">{</span>
          <a href="../utils/Utils.scala.html#kafka.utils.Utils" title="kafka.utils.Utils.type">Utils</a>.<a href="../utils/Utils.scala.html#kafka.utils.Utils.abs" title="(n: Int)Int">abs</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;DataChannel.counter" title="=&gt; java.util.concurrent.atomic.AtomicInteger">counter</a>.<span title="()Int">getAndIncrement</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Int)Int">%</span> <a href="#kafka.tools.MirrorMaker;DataChannel.numOutputs" title="Int">numOutputs</a>
        <span class="delimiter">}</span>
      <a href="#kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6)" title="(record: org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]], queueId: Int)Unit">put</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;DataChannel.put(6e380272aa).record" title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">record</a>, <a href="#kafka.tools.MirrorMaker;DataChannel.put(6e380272aa).queueId" title="Int">queueId</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    def <a title="(record: org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]], queueId: Int)Unit" id="kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6)">put</a><span class="delimiter">(</span><a title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]" id="kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6).record">record</a>: <span title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">ProducerRecord</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>,Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Int" id="kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6).queueId">queueId</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="java.util.concurrent.BlockingQueue[org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]]" id="kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6).queue">queue</a> = <a href="#kafka.tools.MirrorMaker;DataChannel.queues" title="(i: Int)java.util.concurrent.BlockingQueue[org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]]">queues</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6).queueId" title="Int">queueId</a><span class="delimiter">)</span>

      var <a title="Boolean" id="kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6).putSucceed">putSucceed</a> = false
      while <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6).putSucceed" title="Boolean">putSucceed</a><span class="delimiter">)</span> <a href="#kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6).while$1" title="()Unit" class="delimiter">{</a>
        val <a title="Long" id="kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6).startPutTime">startPutTime</a> = <a href="../utils/Time.scala.html#kafka.utils.SystemTime" title="kafka.utils.SystemTime.type">SystemTime</a>.<a href="../utils/Time.scala.html#kafka.utils.SystemTime.nanoseconds" title="=&gt; Long">nanoseconds</a>
        <a href="#kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6).putSucceed" title="Boolean">putSucceed</a> = <a href="#kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6).queue" title="java.util.concurrent.BlockingQueue[org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]]">queue</a>.<span title="(x$1: org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]], x$2: Long, x$3: java.util.concurrent.TimeUnit)Boolean">offer</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6).record" title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">record</a>, <span title="Long(500L)" class="int">500</span>, TimeUnit.<span title="java.util.concurrent.TimeUnit(MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>
        <a href="#kafka.tools.MirrorMaker;DataChannel.waitPut" title="=&gt; com.yammer.metrics.core.Meter">waitPut</a>.<span title="(x$1: Long)Unit">mark</span><span class="delimiter">(</span><span class="delimiter">(</span><a href="../utils/Time.scala.html#kafka.utils.SystemTime" title="kafka.utils.SystemTime.type">SystemTime</a>.<a href="../utils/Time.scala.html#kafka.utils.SystemTime.nanoseconds" title="=&gt; Long">nanoseconds</a> <span title="(x: Long)Long">-</span> <a href="#kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6).startPutTime" title="Long">startPutTime</a><span class="delimiter">)</span> <span title="(x: Int)Long">/</span> <a href="#kafka.tools.MirrorMaker;DataChannel.numInputs" title="Int">numInputs</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#kafka.tools.MirrorMaker;DataChannel.channelSizeHist" title="=&gt; com.yammer.metrics.core.Histogram">channelSizeHist</a>.<span title="(x$1: Int)Unit">update</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6).queue" title="java.util.concurrent.BlockingQueue[org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]]">queue</a>.<span title="()Int">size</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    def <a title="(queueId: Int)org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]" id="kafka.tools.MirrorMaker;DataChannel.take">take</a><span class="delimiter">(</span><a title="Int" id="kafka.tools.MirrorMaker;DataChannel.take.queueId">queueId</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">ProducerRecord</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>,Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      val <a title="java.util.concurrent.BlockingQueue[org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]]" id="kafka.tools.MirrorMaker;DataChannel.take.queue">queue</a> = <a href="#kafka.tools.MirrorMaker;DataChannel.queues" title="(i: Int)java.util.concurrent.BlockingQueue[org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]]">queues</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;DataChannel.take.queueId" title="Int">queueId</a><span class="delimiter">)</span>
      var <a title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]" id="kafka.tools.MirrorMaker;DataChannel.take.data">data</a>: <span title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">ProducerRecord</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>,Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span> = null
      while <span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;DataChannel.take.data" title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">data</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span> <a href="#kafka.tools.MirrorMaker;DataChannel.take.while$2" title="()Unit" class="delimiter">{</a>
        val <a title="Long" id="kafka.tools.MirrorMaker;DataChannel.take.startTakeTime">startTakeTime</a> = <a href="../utils/Time.scala.html#kafka.utils.SystemTime" title="kafka.utils.SystemTime.type">SystemTime</a>.<a href="../utils/Time.scala.html#kafka.utils.SystemTime.nanoseconds" title="=&gt; Long">nanoseconds</a>
        <a href="#kafka.tools.MirrorMaker;DataChannel.take.data" title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">data</a> = <a href="#kafka.tools.MirrorMaker;DataChannel.take.queue" title="java.util.concurrent.BlockingQueue[org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]]">queue</a>.<span title="(x$1: Long, x$2: java.util.concurrent.TimeUnit)org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">poll</span><span class="delimiter">(</span><span title="Long(500L)" class="int">500</span>, TimeUnit.<span title="java.util.concurrent.TimeUnit(MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>
        <a href="#kafka.tools.MirrorMaker;DataChannel.waitTake" title="=&gt; com.yammer.metrics.core.Meter">waitTake</a>.<span title="(x$1: Long)Unit">mark</span><span class="delimiter">(</span><span class="delimiter">(</span><a href="../utils/Time.scala.html#kafka.utils.SystemTime" title="kafka.utils.SystemTime.type">SystemTime</a>.<a href="../utils/Time.scala.html#kafka.utils.SystemTime.nanoseconds" title="=&gt; Long">nanoseconds</a> <span title="(x: Long)Long">-</span> <a href="#kafka.tools.MirrorMaker;DataChannel.take.startTakeTime" title="Long">startTakeTime</a><span class="delimiter">)</span> <span title="(x: Int)Long">/</span> <a href="#kafka.tools.MirrorMaker;DataChannel.numOutputs" title="Int">numOutputs</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#kafka.tools.MirrorMaker;DataChannel.channelSizeHist" title="=&gt; com.yammer.metrics.core.Histogram">channelSizeHist</a>.<span title="(x$1: Int)Unit">update</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;DataChannel.take.queue" title="java.util.concurrent.BlockingQueue[org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]]">queue</a>.<span title="()Int">size</span><span class="delimiter">)</span>
      <a href="#kafka.tools.MirrorMaker;DataChannel.take.data" title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">data</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  class <a title="class ConsumerThread extends Thread with kafka.utils.Logging with kafka.metrics.KafkaMetricsGroup" id="kafka.tools.MirrorMaker;ConsumerThread">ConsumerThread</a><a href="#kafka.tools.MirrorMaker;ConsumerThread" title="kafka.tools.MirrorMaker.ConsumerThread" class="delimiter">(</a><a title="kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]" id="kafka.tools.MirrorMaker;ConsumerThread.stream">stream</a>: <a href="../consumer/KafkaStream.scala.html#kafka.consumer;KafkaStream" title="kafka.consumer.KafkaStream[Array[Byte],Array[Byte]]">KafkaStream</a><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>, Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>,
                       <a title="kafka.tools.MirrorMaker.DataChannel" id="kafka.tools.MirrorMaker;ConsumerThread.mirrorDataChannel">mirrorDataChannel</a>: <a href="#kafka.tools.MirrorMaker;DataChannel" title="kafka.tools.MirrorMaker.DataChannel">DataChannel</a>,
                       <a title="Int" id="kafka.tools.MirrorMaker;ConsumerThread.threadId">threadId</a>: <span title="Int">Int</span><span class="delimiter">)</span>
          extends <a href="#kafka.tools.MirrorMaker;ConsumerThread" title="Thread">Thread</a> with <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> with <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup" title="kafka.metrics.KafkaMetricsGroup">KafkaMetricsGroup</a> <span class="delimiter">{</span>

    private val <a title="java.util.concurrent.CountDownLatch" id="kafka.tools.MirrorMaker;ConsumerThread.shutdownLatch">shutdownLatch</a> = new <span title="java.util.concurrent.CountDownLatch">CountDownLatch</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    private val threadName = <span title="String(&quot;mirrormaker-consumer-&quot;)" class="string">&quot;mirrormaker-consumer-&quot;</span> <a title="String" id="kafka.tools.MirrorMaker;ConsumerThread.threadName">+</a> <a href="#kafka.tools.MirrorMaker;ConsumerThread.threadId" title="Int">threadId</a>
    private var <a title="Boolean" id="kafka.tools.MirrorMaker;ConsumerThread.isCleanShutdown_=">isCleanShutdown</a>: <span title="Boolean">Boolean</span> = true
    this.<a href="../utils/Logging.scala.html#kafka.utils;Logging.logIdent_=" title="(x$1: String)Unit">logIdent</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;[%s] &quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;ConsumerThread.threadName" title="=&gt; String">threadName</a><span class="delimiter">)</span>

    this.<span title="(x$1: String)Unit">setName</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;ConsumerThread.threadName" title="=&gt; String">threadName</a><span class="delimiter">)</span>

    override def <a title="()Unit" id="kafka.tools.MirrorMaker;ConsumerThread.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Starting mirror maker consumer thread &quot;)" class="string">&quot;Starting mirror maker consumer thread &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.MirrorMaker;ConsumerThread.threadName" title="=&gt; String">threadName</a><span class="delimiter">)</span>
      try <span class="delimiter">{</span>
        for <span class="delimiter">(</span><a title="kafka.message.MessageAndMetadata[Array[Byte],Array[Byte]]" id="kafka.tools.MirrorMaker;ConsumerThread.run.$anonfun.msgAndMetadata">msgAndMetadata</a> &lt;- <a href="#kafka.tools.MirrorMaker;ConsumerThread.stream" title="(f: kafka.message.MessageAndMetadata[Array[Byte],Array[Byte]] =&gt; Unit)Unit">stream</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          val <a title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]" id="kafka.tools.MirrorMaker;ConsumerThread.run.$anonfun.data">data</a> = new <span title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">ProducerRecord</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>,Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;ConsumerThread.run.$anonfun.msgAndMetadata" title="kafka.message.MessageAndMetadata[Array[Byte],Array[Byte]]">msgAndMetadata</a>.<a href="../message/MessageAndMetadata.scala.html#kafka.message;MessageAndMetadata.topic" title="=&gt; String">topic</a>, <a href="#kafka.tools.MirrorMaker;ConsumerThread.run.$anonfun.msgAndMetadata" title="kafka.message.MessageAndMetadata[Array[Byte],Array[Byte]]">msgAndMetadata</a>.<a href="../message/MessageAndMetadata.scala.html#kafka.message;MessageAndMetadata.key" title="()Array[Byte]">key</a>, <a href="#kafka.tools.MirrorMaker;ConsumerThread.run.$anonfun.msgAndMetadata" title="kafka.message.MessageAndMetadata[Array[Byte],Array[Byte]]">msgAndMetadata</a>.<a href="../message/MessageAndMetadata.scala.html#kafka.message;MessageAndMetadata.message" title="()Array[Byte]">message</a><span class="delimiter">)</span>
          <a href="#kafka.tools.MirrorMaker;ConsumerThread.mirrorDataChannel" title="kafka.tools.MirrorMaker.DataChannel">mirrorDataChannel</a>.<a href="#kafka.tools.MirrorMaker;DataChannel.put(6e380272aa)" title="(record: org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]])Unit">put</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;ConsumerThread.run.$anonfun.data" title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">data</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> catch <span class="delimiter">{</span>
        case <a title="Throwable" id="kafka.tools.MirrorMaker;ConsumerThread.run.e">e</a>: <span title="Throwable">Throwable</span> =&gt; <span class="delimiter">{</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.fatal(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">fatal</a><span class="delimiter">(</span><span title="String(&quot;Stream unexpectedly exited.&quot;)" class="string">&quot;Stream unexpectedly exited.&quot;</span>, <a href="#kafka.tools.MirrorMaker;ConsumerThread.run.e" title="Throwable">e</a><span class="delimiter">)</span>
          <a href="#kafka.tools.MirrorMaker;ConsumerThread.isCleanShutdown_=" title="(x$1: Boolean)Unit">isCleanShutdown</a> = false
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> finally <span class="delimiter">{</span>
        <a href="#kafka.tools.MirrorMaker;ConsumerThread.shutdownLatch" title="=&gt; java.util.concurrent.CountDownLatch">shutdownLatch</a>.<span title="()Unit">countDown</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Consumer thread stopped&quot;)" class="string">&quot;Consumer thread stopped&quot;</span><span class="delimiter">)</span>
        <span class="comment">// If it exits accidentally, stop the entire mirror maker.</span>
        if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.tools.MirrorMaker;ConsumerThread.isCleanShutdown_=" title="=&gt; Boolean">isCleanShutdown</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.fatal(1729dbc42f)" title="(msg: =&gt; String)Unit">fatal</a><span class="delimiter">(</span><span title="String(&quot;Consumer thread exited abnormally, stopping the whole mirror maker.&quot;)" class="string">&quot;Consumer thread exited abnormally, stopping the whole mirror maker.&quot;</span><span class="delimiter">)</span>
          <span title="System.type">System</span>.<span title="(x$1: Int)Unit">exit</span><span class="delimiter">(</span>-<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    def <a title="()Unit" id="kafka.tools.MirrorMaker;ConsumerThread.awaitShutdown">awaitShutdown</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      try <span class="delimiter">{</span>
        <a href="#kafka.tools.MirrorMaker;ConsumerThread.shutdownLatch" title="=&gt; java.util.concurrent.CountDownLatch">shutdownLatch</a>.<span title="()Unit">await</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Consumer thread shutdown complete&quot;)" class="string">&quot;Consumer thread shutdown complete&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> catch <span class="delimiter">{</span>
        case <a title="InterruptedException" id="kafka.tools.MirrorMaker;ConsumerThread.awaitShutdown.e">e</a>: <span title="InterruptedException">InterruptedException</span> =&gt; <a href="../utils/Logging.scala.html#kafka.utils;Logging.fatal(1729dbc42f)" title="(msg: =&gt; String)Unit">fatal</a><span class="delimiter">(</span><span title="String(&quot;Shutdown of the consumer thread interrupted. This might leak data!&quot;)" class="string">&quot;Shutdown of the consumer thread interrupted. This might leak data!&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  class <a title="class ProducerThread extends Thread with kafka.utils.Logging with kafka.metrics.KafkaMetricsGroup" id="kafka.tools.MirrorMaker;ProducerThread">ProducerThread</a> <a href="#kafka.tools.MirrorMaker;ProducerThread" title="kafka.tools.MirrorMaker.ProducerThread" class="delimiter">(</a>val <a title="kafka.tools.MirrorMaker.DataChannel" id="kafka.tools.MirrorMaker;ProducerThread.dataChannel">dataChannel</a>: <a href="#kafka.tools.MirrorMaker;DataChannel" title="kafka.tools.MirrorMaker.DataChannel">DataChannel</a>,
                        val <a title="kafka.producer.BaseProducer" id="kafka.tools.MirrorMaker;ProducerThread.producer">producer</a>: <a href="../producer/BaseProducer.scala.html#kafka.producer;BaseProducer" title="kafka.producer.BaseProducer">BaseProducer</a>,
                        val <a title="Int" id="kafka.tools.MirrorMaker;ProducerThread.threadId">threadId</a>: <span title="Int">Int</span><span class="delimiter">)</span> extends <a href="#kafka.tools.MirrorMaker;ProducerThread" title="Thread">Thread</a> with <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> with <a href="../metrics/KafkaMetricsGroup.scala.html#kafka.metrics;KafkaMetricsGroup" title="kafka.metrics.KafkaMetricsGroup">KafkaMetricsGroup</a> <span class="delimiter">{</span>
    private val threadName = <span title="String(&quot;mirrormaker-producer-&quot;)" class="string">&quot;mirrormaker-producer-&quot;</span> <a title="String" id="kafka.tools.MirrorMaker;ProducerThread.threadName">+</a> <a href="#kafka.tools.MirrorMaker;ProducerThread.threadId" title="=&gt; Int">threadId</a>
    private val <a title="java.util.concurrent.CountDownLatch" id="kafka.tools.MirrorMaker;ProducerThread.shutdownComplete">shutdownComplete</a>: <span title="java.util.concurrent.CountDownLatch">CountDownLatch</span> = new <span title="java.util.concurrent.CountDownLatch">CountDownLatch</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    private var <a title="Boolean" id="kafka.tools.MirrorMaker;ProducerThread.isCleanShutdown_=">isCleanShutdown</a>: <span title="Boolean">Boolean</span> = true
    this.<a href="../utils/Logging.scala.html#kafka.utils;Logging.logIdent_=" title="(x$1: String)Unit">logIdent</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;[%s] &quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;ProducerThread.threadName" title="=&gt; String">threadName</a><span class="delimiter">)</span>

    <a href="#kafka.tools.MirrorMaker;ProducerThread" title="(x$1: String)Unit">setName</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;ProducerThread.threadName" title="=&gt; String">threadName</a><span class="delimiter">)</span>

    override def <a title="()Unit" id="kafka.tools.MirrorMaker;ProducerThread.run">run</a> <span class="delimiter">{</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Starting mirror maker producer thread &quot;)" class="string">&quot;Starting mirror maker producer thread &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.MirrorMaker;ProducerThread.threadName" title="=&gt; String">threadName</a><span class="delimiter">)</span>
      try <span class="delimiter">{</span>
        while <span class="delimiter">(</span>true<span class="delimiter">)</span> <a href="#kafka.tools.MirrorMaker;ProducerThread.run.while$3" title="()Unit" class="delimiter">{</a>
          val <a title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]" id="kafka.tools.MirrorMaker;ProducerThread.run.data">data</a>: <span title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">ProducerRecord</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>,Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#kafka.tools.MirrorMaker;ProducerThread.dataChannel" title="=&gt; kafka.tools.MirrorMaker.DataChannel">dataChannel</a>.<a href="#kafka.tools.MirrorMaker;DataChannel.take" title="(queueId: Int)org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">take</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;ProducerThread.threadId" title="=&gt; Int">threadId</a><span class="delimiter">)</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Sending message with value size %d&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;ProducerThread.run.data" title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">data</a>.<span title="()Array[Byte]">value</span><span title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]" class="delimiter">(</span><span class="delimiter">)</span>.<span title="=&gt; Int">size</span><span class="delimiter">)</span><span class="delimiter">)</span>
          if<span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;ProducerThread.run.data" title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">data</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#kafka.tools.MirrorMaker.shutdownMessage" title="=&gt; org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">shutdownMessage</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Received shutdown message&quot;)" class="string">&quot;Received shutdown message&quot;</span><span class="delimiter">)</span>
            return
          <span class="delimiter">}</span>
          <a href="#kafka.tools.MirrorMaker;ProducerThread.producer" title="=&gt; kafka.producer.BaseProducer">producer</a>.<a href="../producer/BaseProducer.scala.html#kafka.producer;BaseProducer.send" title="(topic: String, key: Array[Byte], value: Array[Byte])Unit">send</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker;ProducerThread.run.data" title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">data</a>.<span title="()String">topic</span><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#kafka.tools.MirrorMaker;ProducerThread.run.data" title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">data</a>.<span title="()Array[Byte]">key</span><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#kafka.tools.MirrorMaker;ProducerThread.run.data" title="org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">data</a>.<span title="()Array[Byte]">value</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> catch <span class="delimiter">{</span>
        case <a title="Throwable" id="kafka.tools.MirrorMaker;ProducerThread.run.t">t</a>: <span title="Throwable">Throwable</span> =&gt; <span class="delimiter">{</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.fatal(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">fatal</a><span class="delimiter">(</span><span title="String(&quot;Producer thread failure due to &quot;)" class="string">&quot;Producer thread failure due to &quot;</span>, <a href="#kafka.tools.MirrorMaker;ProducerThread.run.t" title="Throwable">t</a><span class="delimiter">)</span>
          <a href="#kafka.tools.MirrorMaker;ProducerThread.isCleanShutdown_=" title="(x$1: Boolean)Unit">isCleanShutdown</a> = false
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> finally <span class="delimiter">{</span>
        <a href="#kafka.tools.MirrorMaker;ProducerThread.shutdownComplete" title="=&gt; java.util.concurrent.CountDownLatch">shutdownComplete</a>.<span title="()Unit">countDown</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Producer thread stopped&quot;)" class="string">&quot;Producer thread stopped&quot;</span><span class="delimiter">)</span>
        <span class="comment">// If it exits accidentally, stop the entire mirror maker.</span>
        if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.tools.MirrorMaker;ProducerThread.isCleanShutdown_=" title="=&gt; Boolean">isCleanShutdown</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.fatal(1729dbc42f)" title="(msg: =&gt; String)Unit">fatal</a><span class="delimiter">(</span><span title="String(&quot;Producer thread exited abnormally, stopping the whole mirror maker.&quot;)" class="string">&quot;Producer thread exited abnormally, stopping the whole mirror maker.&quot;</span><span class="delimiter">)</span>
          <span title="System.type">System</span>.<span title="(x$1: Int)Unit">exit</span><span class="delimiter">(</span>-<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    def <a title="=&gt; Unit" id="kafka.tools.MirrorMaker;ProducerThread.shutdown">shutdown</a> <span class="delimiter">{</span>
      try <span class="delimiter">{</span>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Producer thread &quot;)" class="string">&quot;Producer thread &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.MirrorMaker;ProducerThread.threadName" title="=&gt; String">threadName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; shutting down&quot;)" class="string">&quot; shutting down&quot;</span><span class="delimiter">)</span>
        <a href="#kafka.tools.MirrorMaker;ProducerThread.dataChannel" title="=&gt; kafka.tools.MirrorMaker.DataChannel">dataChannel</a>.<a href="#kafka.tools.MirrorMaker;DataChannel.put(c6c55131b6)" title="(record: org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]], queueId: Int)Unit">put</a><span class="delimiter">(</span><a href="#kafka.tools.MirrorMaker.shutdownMessage" title="=&gt; org.apache.kafka.clients.producer.ProducerRecord[Array[Byte],Array[Byte]]">shutdownMessage</a>, <a href="#kafka.tools.MirrorMaker;ProducerThread.threadId" title="=&gt; Int">threadId</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      catch <span class="delimiter">{</span>
        case <a title="InterruptedException" id="kafka.tools.MirrorMaker;ProducerThread.shutdown.ie">ie</a>: <span title="InterruptedException">InterruptedException</span> =&gt; <span class="delimiter">{</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.warn(1729dbc42f)" title="(msg: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="String(&quot;Interrupt during shutdown of ProducerThread&quot;)" class="string">&quot;Interrupt during shutdown of ProducerThread&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    def <a title="=&gt; Unit" id="kafka.tools.MirrorMaker;ProducerThread.awaitShutdown">awaitShutdown</a> <span class="delimiter">{</span>
      try <span class="delimiter">{</span>
        <a href="#kafka.tools.MirrorMaker;ProducerThread.shutdownComplete" title="=&gt; java.util.concurrent.CountDownLatch">shutdownComplete</a>.<span title="()Unit">await</span>
        <a href="#kafka.tools.MirrorMaker;ProducerThread.producer" title="=&gt; kafka.producer.BaseProducer">producer</a>.<a href="../producer/BaseProducer.scala.html#kafka.producer;BaseProducer.close" title="()Unit">close</a>
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.info(1729dbc42f)" title="(msg: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Producer thread shutdown complete&quot;)" class="string">&quot;Producer thread shutdown complete&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> catch <span class="delimiter">{</span>
        case <a title="InterruptedException" id="kafka.tools.MirrorMaker;ProducerThread.awaitShutdown.ie">ie</a>: <span title="InterruptedException">InterruptedException</span> =&gt; <span class="delimiter">{</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.warn(1729dbc42f)" title="(msg: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="String(&quot;Shutdown of the producer thread interrupted&quot;)" class="string">&quot;Shutdown of the producer thread interrupted&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>
