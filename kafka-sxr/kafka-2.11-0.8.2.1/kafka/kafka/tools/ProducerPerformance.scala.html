<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>kafka/kafka/tools/ProducerPerformance.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

package kafka.tools

import kafka.metrics.KafkaMetricsReporter
import kafka.producer.<span class="delimiter">{</span>OldProducer, NewShinyProducer<span class="delimiter">}</span>
import kafka.utils.<span class="delimiter">{</span>ToolsUtils, VerifiableProperties, Logging, CommandLineUtils<span class="delimiter">}</span>
import kafka.message.CompressionCodec
import kafka.serializer._

import java.util.concurrent.<span class="delimiter">{</span>CountDownLatch, Executors<span class="delimiter">}</span>
import java.util.concurrent.atomic.AtomicLong
import java.util._
import java.text.SimpleDateFormat
import java.math.BigInteger

import org.apache.log4j.Logger

<span class="comment">/**
 * Load test for the producer
 */</span>
object <a title="kafka.tools.ProducerPerformance.type" id="kafka.tools.ProducerPerformance">ProducerPerformance</a> extends <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> <span class="delimiter">{</span>

  def <a title="(args: Array[String])Unit" id="kafka.tools.ProducerPerformance.main">main</a><span class="delimiter">(</span><a title="Array[String]" id="kafka.tools.ProducerPerformance.main.args">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>

    val <a title="org.apache.log4j.Logger" id="kafka.tools.ProducerPerformance.main.logger">logger</a> = <span title="org.apache.log4j.Logger.type">Logger</span>.<span title="(x$1: Class[_])org.apache.log4j.Logger">getLogger</span><span class="delimiter">(</span><span title="()Class[_]">getClass</span><span class="delimiter">)</span>
    val <a title="kafka.tools.ProducerPerformance.ProducerPerfConfig" id="kafka.tools.ProducerPerformance.main.config">config</a> = new <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig" title="kafka.tools.ProducerPerformance.ProducerPerfConfig">ProducerPerfConfig</a><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance.main.args" title="Array[String]">args</a><span class="delimiter">)</span>
    if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.tools.ProducerPerformance.main.config" title="kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.isFixedSize_=" title="=&gt; Boolean">isFixedSize</a><span class="delimiter">)</span>
      <a href="#kafka.tools.ProducerPerformance.main.logger" title="org.apache.log4j.Logger">logger</a>.<span title="(x$1: Any)Unit">info</span><span class="delimiter">(</span><span title="String(&quot;WARN: Throughput will be slower due to changing message size per request&quot;)" class="string">&quot;WARN: Throughput will be slower due to changing message size per request&quot;</span><span class="delimiter">)</span>

    val <a title="java.util.concurrent.atomic.AtomicLong" id="kafka.tools.ProducerPerformance.main.totalBytesSent">totalBytesSent</a> = new <span title="java.util.concurrent.atomic.AtomicLong">AtomicLong</span><span class="delimiter">(</span><span title="Long(0L)" class="int">0</span><span class="delimiter">)</span>
    val <a title="java.util.concurrent.atomic.AtomicLong" id="kafka.tools.ProducerPerformance.main.totalMessagesSent">totalMessagesSent</a> = new <span title="java.util.concurrent.atomic.AtomicLong">AtomicLong</span><span class="delimiter">(</span><span title="Long(0L)" class="int">0</span><span class="delimiter">)</span>
    val <a title="java.util.concurrent.ExecutorService" id="kafka.tools.ProducerPerformance.main.executor">executor</a> = <span title="java.util.concurrent.Executors.type">Executors</span>.<span title="(x$1: Int)java.util.concurrent.ExecutorService">newFixedThreadPool</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance.main.config" title="kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.numThreads_=" title="=&gt; Int">numThreads</a><span class="delimiter">)</span>
    val <a title="java.util.concurrent.CountDownLatch" id="kafka.tools.ProducerPerformance.main.allDone">allDone</a> = new <span title="java.util.concurrent.CountDownLatch">CountDownLatch</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance.main.config" title="kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.numThreads_=" title="=&gt; Int">numThreads</a><span class="delimiter">)</span>
    val <a title="Long" id="kafka.tools.ProducerPerformance.main.startMs">startMs</a> = <span title="System.type">System</span>.<span title="()Long">currentTimeMillis</span>
    val <a title="java.util.Random" id="kafka.tools.ProducerPerformance.main.rand">rand</a> = new java.util.<span title="java.util.Random">Random</span>

    if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.tools.ProducerPerformance.main.config" title="kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.hideHeader" title="=&gt; Boolean">hideHeader</a><span class="delimiter">)</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span class="string">&quot;start.time, end.time, compression, message.size, batch.size, total.data.sent.in.MB, MB.sec, &quot;</span> <span title="String(&quot;start.time, end.time, compression, message.size, batch.size, total.data.sent.in.MB, MB.sec, total.data.sent.in.nMsg, nMsg.sec&quot;)">+</span>
        <span class="string">&quot;total.data.sent.in.nMsg, nMsg.sec&quot;</span><span class="delimiter">)</span>

    for <span class="delimiter">(</span><a title="Int" id="kafka.tools.ProducerPerformance.main.$anonfun.i">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(f: Int =&gt; Unit)Unit">until</span> <a href="#kafka.tools.ProducerPerformance.main.config" title="kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.numThreads_=" title="=&gt; Int">numThreads</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#kafka.tools.ProducerPerformance.main.executor" title="java.util.concurrent.ExecutorService">executor</a>.<span title="(x$1: Runnable)Unit">execute</span><span class="delimiter">(</span>new <a href="#kafka.tools.ProducerPerformance;ProducerThread" title="kafka.tools.ProducerPerformance.ProducerThread">ProducerThread</a><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance.main.$anonfun.i" title="Int">i</a>, <a href="#kafka.tools.ProducerPerformance.main.config" title="kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>, <a href="#kafka.tools.ProducerPerformance.main.totalBytesSent" title="java.util.concurrent.atomic.AtomicLong">totalBytesSent</a>, <a href="#kafka.tools.ProducerPerformance.main.totalMessagesSent" title="java.util.concurrent.atomic.AtomicLong">totalMessagesSent</a>, <a href="#kafka.tools.ProducerPerformance.main.allDone" title="java.util.concurrent.CountDownLatch">allDone</a>, <a href="#kafka.tools.ProducerPerformance.main.rand" title="java.util.Random">rand</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#kafka.tools.ProducerPerformance.main.allDone" title="java.util.concurrent.CountDownLatch">allDone</a>.<span title="()Unit">await</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="Long" id="kafka.tools.ProducerPerformance.main.endMs">endMs</a> = <span title="System.type">System</span>.<span title="()Long">currentTimeMillis</span>
    val elapsedSecs = <span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance.main.endMs" title="Long">endMs</a> <span title="(x: Long)Long">-</span> <a href="#kafka.tools.ProducerPerformance.main.startMs" title="Long">startMs</a><span class="delimiter">)</span> <a title="Double" id="kafka.tools.ProducerPerformance.main.elapsedSecs">/</a> <span title="Double(1000.0)" class="double">1000.0</span>
    val totalMBSent = <span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance.main.totalBytesSent" title="java.util.concurrent.atomic.AtomicLong">totalBytesSent</a>.<span title="()Long">get</span> <span title="(x: Double)Double">*</span> <span title="Double(1.0)" class="double">1.0</span><span class="delimiter">)</span> <a title="Double" id="kafka.tools.ProducerPerformance.main.totalMBSent">/</a> <span class="delimiter">(</span><span class="int">1024</span> <span title="Int(1048576)">*</span> <span class="int">1024</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%s, %s, %d, %d, %d, %.2f, %.4f, %d, %.4f&quot;</span><span class="delimiter">)</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span>
      <a href="#kafka.tools.ProducerPerformance.main.config" title="kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.dateFormat" title="=&gt; java.text.SimpleDateFormat">dateFormat</a>.<span title="(x$1: Any)String">format</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance.main.startMs" title="Long">startMs</a><span class="delimiter">)</span>, <a href="#kafka.tools.ProducerPerformance.main.config" title="kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.dateFormat" title="=&gt; java.text.SimpleDateFormat">dateFormat</a>.<span title="(x$1: Any)String">format</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance.main.endMs" title="Long">endMs</a><span class="delimiter">)</span>,
      <a href="#kafka.tools.ProducerPerformance.main.config" title="kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.compressionCodec" title="=&gt; kafka.message.CompressionCodec">compressionCodec</a>.<a href="../message/CompressionCodec.scala.html#kafka.message;CompressionCodec.codec" title="=&gt; Int">codec</a>, <a href="#kafka.tools.ProducerPerformance.main.config" title="kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.messageSize" title="=&gt; Int">messageSize</a>, <a href="#kafka.tools.ProducerPerformance.main.config" title="kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.batchSize_=" title="=&gt; Int">batchSize</a>, <a href="#kafka.tools.ProducerPerformance.main.totalMBSent" title="Double">totalMBSent</a>,
      <a href="#kafka.tools.ProducerPerformance.main.totalMBSent" title="Double">totalMBSent</a> <span title="(x: Double)Double">/</span> <a href="#kafka.tools.ProducerPerformance.main.elapsedSecs" title="Double">elapsedSecs</a>, <a href="#kafka.tools.ProducerPerformance.main.totalMessagesSent" title="java.util.concurrent.atomic.AtomicLong">totalMessagesSent</a>.<span title="()Long">get</span>, <a href="#kafka.tools.ProducerPerformance.main.totalMessagesSent" title="java.util.concurrent.atomic.AtomicLong">totalMessagesSent</a>.<span title="()Long">get</span> <span title="(x: Double)Double">/</span> <a href="#kafka.tools.ProducerPerformance.main.elapsedSecs" title="Double">elapsedSecs</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="System.type">System</span>.<span title="(x$1: Int)Unit">exit</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  class <a title="class ProducerPerfConfig extends kafka.tools.PerfConfig" id="kafka.tools.ProducerPerformance;ProducerPerfConfig">ProducerPerfConfig</a><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig" title="kafka.tools.ProducerPerformance.ProducerPerfConfig" class="delimiter">(</a><a title="Array[String]" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.args">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> extends <a href="PerfConfig.scala.html#kafka.tools;PerfConfig" title="kafka.tools.PerfConfig">PerfConfig</a><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.args" title="Array[String]">args</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.brokerListOpt">brokerListOpt</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;broker-list&quot;)" class="string">&quot;broker-list&quot;</span>, <span title="String(&quot;REQUIRED: broker info (the list of broker host and port for bootstrap.&quot;)" class="string">&quot;REQUIRED: broker info (the list of broker host and port for bootstrap.&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;hostname:port,..,hostname:port&quot;)" class="string">&quot;hostname:port,..,hostname:port&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.topicsOpt">topicsOpt</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;topics&quot;)" class="string">&quot;topics&quot;</span>, <span title="String(&quot;REQUIRED: The comma separated list of topics to produce to&quot;)" class="string">&quot;REQUIRED: The comma separated list of topics to produce to&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;topic1,topic2..&quot;)" class="string">&quot;topic1,topic2..&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[Integer]" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRequestTimeoutMsOpt">producerRequestTimeoutMsOpt</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;request-timeout-ms&quot;)" class="string">&quot;request-timeout-ms&quot;</span>, <span title="String(&quot;The produce request timeout in ms&quot;)" class="string">&quot;The produce request timeout in ms&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[Integer])joptsimple.ArgumentAcceptingOptionSpec[Integer]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[Integer](classOf[java.lang.Integer])" class="delimiter">[</span>java.lang.Integer<span class="delimiter">]</span><span class="delimiter">)</span>
      .<span title="(x$1: Integer, x$2: Integer*)joptsimple.ArgumentAcceptingOptionSpec[Integer]">defaultsTo</span><span class="delimiter">(</span><span title="implicit scala.Predef.int2Integer : (x: Int)Integer" class="int">3000</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[Integer]" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.producerNumRetriesOpt">producerNumRetriesOpt</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;producer-num-retries&quot;)" class="string">&quot;producer-num-retries&quot;</span>, <span title="String(&quot;The producer retries number&quot;)" class="string">&quot;The producer retries number&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[Integer])joptsimple.ArgumentAcceptingOptionSpec[Integer]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[Integer](classOf[java.lang.Integer])" class="delimiter">[</span>java.lang.Integer<span class="delimiter">]</span><span class="delimiter">)</span>
      .<span title="(x$1: Integer, x$2: Integer*)joptsimple.ArgumentAcceptingOptionSpec[Integer]">defaultsTo</span><span class="delimiter">(</span><span title="implicit scala.Predef.int2Integer : (x: Int)Integer" class="int">3</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[Integer]" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRetryBackOffMsOpt">producerRetryBackOffMsOpt</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;producer-retry-backoff-ms&quot;)" class="string">&quot;producer-retry-backoff-ms&quot;</span>, <span title="String(&quot;The producer retry backoff time in milliseconds&quot;)" class="string">&quot;The producer retry backoff time in milliseconds&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[Integer])joptsimple.ArgumentAcceptingOptionSpec[Integer]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[Integer](classOf[java.lang.Integer])" class="delimiter">[</span>java.lang.Integer<span class="delimiter">]</span><span class="delimiter">)</span>
      .<span title="(x$1: Integer, x$2: Integer*)joptsimple.ArgumentAcceptingOptionSpec[Integer]">defaultsTo</span><span class="delimiter">(</span><span title="implicit scala.Predef.int2Integer : (x: Int)Integer" class="int">100</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[Integer]" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRequestRequiredAcksOpt">producerRequestRequiredAcksOpt</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;request-num-acks&quot;)" class="string">&quot;request-num-acks&quot;</span>, <span class="string">&quot;Number of acks required for producer request &quot;</span> <span title="String(&quot;Number of acks required for producer request to complete&quot;)">+</span>
      <span class="string">&quot;to complete&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[Integer])joptsimple.ArgumentAcceptingOptionSpec[Integer]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[Integer](classOf[java.lang.Integer])" class="delimiter">[</span>java.lang.Integer<span class="delimiter">]</span><span class="delimiter">)</span>
      .<span title="(x$1: Integer, x$2: Integer*)joptsimple.ArgumentAcceptingOptionSpec[Integer]">defaultsTo</span><span class="delimiter">(</span>-<span title="implicit scala.Predef.int2Integer : (x: Int)Integer" class="int">1</span><span class="delimiter">)</span>
    val <a title="joptsimple.OptionSpecBuilder" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.varyMessageSizeOpt">varyMessageSizeOpt</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;vary-message-size&quot;)" class="string">&quot;vary-message-size&quot;</span>, <span title="String(&quot;If set, message size will vary up to the given maximum.&quot;)" class="string">&quot;If set, message size will vary up to the given maximum.&quot;</span><span class="delimiter">)</span>
    val <a title="joptsimple.OptionSpecBuilder" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.syncOpt">syncOpt</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;sync&quot;)" class="string">&quot;sync&quot;</span>, <span title="String(&quot;If set, messages are sent synchronously.&quot;)" class="string">&quot;If set, messages are sent synchronously.&quot;</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[Integer]" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.numThreadsOpt">numThreadsOpt</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;threads&quot;)" class="string">&quot;threads&quot;</span>, <span title="String(&quot;Number of sending threads.&quot;)" class="string">&quot;Number of sending threads.&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;number of threads&quot;)" class="string">&quot;number of threads&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[Integer])joptsimple.ArgumentAcceptingOptionSpec[Integer]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[Integer](classOf[java.lang.Integer])" class="delimiter">[</span>java.lang.Integer<span class="delimiter">]</span><span class="delimiter">)</span>
      .<span title="(x$1: Integer, x$2: Integer*)joptsimple.ArgumentAcceptingOptionSpec[Integer]">defaultsTo</span><span class="delimiter">(</span><span title="implicit scala.Predef.int2Integer : (x: Int)Integer" class="int">1</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[Integer]" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.initialMessageIdOpt">initialMessageIdOpt</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;initial-message-id&quot;)" class="string">&quot;initial-message-id&quot;</span>, <span class="string">&quot;The is used for generating test data, If set, messages will be tagged with an &quot;</span> +
      <span class="string">&quot;ID and sent by producer starting from this ID sequentially. Message content will be String type and &quot;</span> <span title="String(&quot;The is used for generating test data, If set, messages will be tagged with an ID and sent by producer starting from this ID sequentially. Message content will be String type and in the form of \'Message:000...1:xxx...\'&quot;)">+</span>
      <span class="string">&quot;in the form of 'Message:000...1:xxx...'&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;initial message id&quot;)" class="string">&quot;initial message id&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[Integer])joptsimple.ArgumentAcceptingOptionSpec[Integer]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[Integer](classOf[java.lang.Integer])" class="delimiter">[</span>java.lang.Integer<span class="delimiter">]</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[Integer]" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.messageSendGapMsOpt">messageSendGapMsOpt</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;message-send-gap-ms&quot;)" class="string">&quot;message-send-gap-ms&quot;</span>, <span title="String(&quot;If set, the send thread will wait for specified time between two sends&quot;)" class="string">&quot;If set, the send thread will wait for specified time between two sends&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span><span class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;message send time gap&quot;)" class="string">&quot;message send time gap&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[Integer])joptsimple.ArgumentAcceptingOptionSpec[Integer]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[Integer](classOf[java.lang.Integer])" class="delimiter">[</span>java.lang.Integer<span class="delimiter">]</span><span class="delimiter">)</span>
      .<span title="(x$1: Integer, x$2: Integer*)joptsimple.ArgumentAcceptingOptionSpec[Integer]">defaultsTo</span><span class="delimiter">(</span><span title="implicit scala.Predef.int2Integer : (x: Int)Integer" class="int">0</span><span class="delimiter">)</span>
    val <a title="joptsimple.OptionSpecBuilder" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.csvMetricsReporterEnabledOpt">csvMetricsReporterEnabledOpt</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;csv-reporter-enabled&quot;)" class="string">&quot;csv-reporter-enabled&quot;</span>, <span title="String(&quot;If set, the CSV metrics reporter will be enabled&quot;)" class="string">&quot;If set, the CSV metrics reporter will be enabled&quot;</span><span class="delimiter">)</span>
    val <a title="joptsimple.ArgumentAcceptingOptionSpec[String]" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.metricsDirectoryOpt">metricsDirectoryOpt</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;metrics-dir&quot;)" class="string">&quot;metrics-dir&quot;</span>, <span class="string">&quot;If csv-reporter-enable is set, and this parameter is&quot;</span> <span title="String(&quot;If csv-reporter-enable is set, and this parameter isset, the csv metrics will be outputed here&quot;)">+</span>
      <span class="string">&quot;set, the csv metrics will be outputed here&quot;</span><span class="delimiter">)</span>
      .<span title="()joptsimple.ArgumentAcceptingOptionSpec[String]">withRequiredArg</span>
      .<span title="(x$1: String)joptsimple.ArgumentAcceptingOptionSpec[String]">describedAs</span><span class="delimiter">(</span><span title="String(&quot;metrics dictory&quot;)" class="string">&quot;metrics dictory&quot;</span><span class="delimiter">)</span>
      .<span title="(x$1: Class[String])joptsimple.ArgumentAcceptingOptionSpec[String]">ofType</span><span class="delimiter">(</span>classOf<span title="Class[String](classOf[java.lang.String])" class="delimiter">[</span>java.lang.String<span class="delimiter">]</span><span class="delimiter">)</span>
    val <a title="joptsimple.OptionSpecBuilder" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.useNewProducerOpt">useNewProducerOpt</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String, x$2: String)joptsimple.OptionSpecBuilder">accepts</span><span class="delimiter">(</span><span title="String(&quot;new-producer&quot;)" class="string">&quot;new-producer&quot;</span>, <span title="String(&quot;Use the new producer implementation.&quot;)" class="string">&quot;Use the new producer implementation.&quot;</span><span class="delimiter">)</span>

    val <a title="joptsimple.OptionSet" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.options">options</a> = <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>.<span title="(x$1: String*)joptsimple.OptionSet">parse</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.args" title="Array[String]">args</a>: _*<span class="delimiter">)</span>
    <a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils" title="kafka.utils.CommandLineUtils.type">CommandLineUtils</a>.<a href="../utils/CommandLineUtils.scala.html#kafka.utils.CommandLineUtils.checkRequiredArgs" title="(parser: joptsimple.OptionParser, options: joptsimple.OptionSet, required: joptsimple.OptionSpec[_]*)Unit">checkRequiredArgs</a><span class="delimiter">(</span><a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>, <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>, <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.topicsOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[String]">topicsOpt</a>, <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.brokerListOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[String]">brokerListOpt</a>, <a href="PerfConfig.scala.html#kafka.tools;PerfConfig.numMessagesOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[Long]">numMessagesOpt</a><span class="delimiter">)</span>

    val <a title="String" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.topicsStr">topicsStr</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])String">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.topicsOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[String]">topicsOpt</a><span class="delimiter">)</span>
    val <a title="Array[String]" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.topics">topics</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.topicsStr" title="=&gt; String">topicsStr</a>.<span title="(x$1: String)Array[String]">split</span><span class="delimiter">(</span><span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span>
    val <a title="Long" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.numMessages">numMessages</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Long])Long">valueOf</span><span class="delimiter">(</span><a href="PerfConfig.scala.html#kafka.tools;PerfConfig.numMessagesOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[Long]">numMessagesOpt</a><span class="delimiter">)</span>.<span title="()Long">longValue</span>
    val <a title="Int" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.reportingInterval">reportingInterval</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="PerfConfig.scala.html#kafka.tools;PerfConfig.reportingIntervalOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[Integer]">reportingIntervalOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span>
    val <a title="java.text.SimpleDateFormat" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.dateFormat">dateFormat</a> = new <span title="java.text.SimpleDateFormat">SimpleDateFormat</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])String">valueOf</span><span class="delimiter">(</span><a href="PerfConfig.scala.html#kafka.tools;PerfConfig.dateFormatOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[String]">dateFormatOpt</a><span class="delimiter">)</span><span class="delimiter">)</span>
    val <a title="Boolean" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.hideHeader">hideHeader</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="PerfConfig.scala.html#kafka.tools;PerfConfig.hideHeaderOpt" title="=&gt; joptsimple.OptionSpecBuilder">hideHeaderOpt</a><span class="delimiter">)</span>
    val <a title="String" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.brokerList">brokerList</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])String">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.brokerListOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[String]">brokerListOpt</a><span class="delimiter">)</span>
    <a href="../utils/ToolsUtils.scala.html#kafka.utils.ToolsUtils" title="kafka.utils.ToolsUtils.type">ToolsUtils</a>.<a href="../utils/ToolsUtils.scala.html#kafka.utils.ToolsUtils.validatePortOrDie" title="(parser: joptsimple.OptionParser, hostPort: String)Unit">validatePortOrDie</a><span class="delimiter">(</span><a href="PerfConfig.scala.html#kafka.tools;PerfConfig.parser" title="=&gt; joptsimple.OptionParser">parser</a>,<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.brokerList" title="=&gt; String">brokerList</a><span class="delimiter">)</span>
    val <a title="Int" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.messageSize">messageSize</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="PerfConfig.scala.html#kafka.tools;PerfConfig.messageSizeOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[Integer]">messageSizeOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span>
    var <a title="Boolean" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.isFixedSize_=">isFixedSize</a> = <span title="=&gt; Boolean">!</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.varyMessageSizeOpt" title="=&gt; joptsimple.OptionSpecBuilder">varyMessageSizeOpt</a><span class="delimiter">)</span>
    var <a title="Boolean" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.isSync_=">isSync</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.syncOpt" title="=&gt; joptsimple.OptionSpecBuilder">syncOpt</a><span class="delimiter">)</span>
    var <a title="Int" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.batchSize_=">batchSize</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="PerfConfig.scala.html#kafka.tools;PerfConfig.batchSizeOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[Integer]">batchSizeOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span>
    var <a title="Int" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.numThreads_=">numThreads</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.numThreadsOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[Integer]">numThreadsOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span>
    val <a title="kafka.message.CompressionCodec" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.compressionCodec">compressionCodec</a> = <a href="../message/CompressionCodec.scala.html#kafka.message.CompressionCodec" title="kafka.message.CompressionCodec.type">CompressionCodec</a>.<a href="../message/CompressionCodec.scala.html#kafka.message.CompressionCodec.getCompressionCodec(1b407f509f)" title="(codec: Int)kafka.message.CompressionCodec">getCompressionCodec</a><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="PerfConfig.scala.html#kafka.tools;PerfConfig.compressionCodecOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[Integer]">compressionCodecOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span><span class="delimiter">)</span>
    val <a title="Boolean" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.seqIdMode">seqIdMode</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.initialMessageIdOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[Integer]">initialMessageIdOpt</a><span class="delimiter">)</span>
    var <a title="Int" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.initialMessageId_=">initialMessageId</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>
    if <span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.seqIdMode" title="=&gt; Boolean">seqIdMode</a><span class="delimiter">)</span>
      <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.initialMessageId_=" title="(x$1: Int)Unit">initialMessageId</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.initialMessageIdOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[Integer]">initialMessageIdOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="Int" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRequestTimeoutMs">producerRequestTimeoutMs</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRequestTimeoutMsOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[Integer]">producerRequestTimeoutMsOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="Int" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRequestRequiredAcks">producerRequestRequiredAcks</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRequestRequiredAcksOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[Integer]">producerRequestRequiredAcksOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="Int" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.producerNumRetries">producerNumRetries</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.producerNumRetriesOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[Integer]">producerNumRetriesOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="Int" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRetryBackoffMs">producerRetryBackoffMs</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRetryBackOffMsOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[Integer]">producerRetryBackOffMsOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="Boolean" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.useNewProducer">useNewProducer</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.useNewProducerOpt" title="=&gt; joptsimple.OptionSpecBuilder">useNewProducerOpt</a><span class="delimiter">)</span>

    val <a title="Boolean" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.csvMetricsReporterEnabled">csvMetricsReporterEnabled</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.csvMetricsReporterEnabledOpt" title="=&gt; joptsimple.OptionSpecBuilder">csvMetricsReporterEnabledOpt</a><span class="delimiter">)</span>

    if <span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.csvMetricsReporterEnabled" title="=&gt; Boolean">csvMetricsReporterEnabled</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="java.util.Properties" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.<local ProducerPerfConfig>.props">props</a> = new <span title="java.util.Properties">Properties</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.<local ProducerPerfConfig>.props" title="java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;kafka.metrics.polling.interval.secs&quot;)" class="string">&quot;kafka.metrics.polling.interval.secs&quot;</span>, <span title="String(&quot;1&quot;)" class="string">&quot;1&quot;</span><span class="delimiter">)</span>
      <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.<local ProducerPerfConfig>.props" title="java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;kafka.metrics.reporters&quot;)" class="string">&quot;kafka.metrics.reporters&quot;</span>, <span title="String(&quot;kafka.metrics.KafkaCSVMetricsReporter&quot;)" class="string">&quot;kafka.metrics.KafkaCSVMetricsReporter&quot;</span><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[_])Boolean">has</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.metricsDirectoryOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[String]">metricsDirectoryOpt</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.<local ProducerPerfConfig>.props" title="java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;kafka.csv.metrics.dir&quot;)" class="string">&quot;kafka.csv.metrics.dir&quot;</span>, <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[String])String">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.metricsDirectoryOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[String]">metricsDirectoryOpt</a><span class="delimiter">)</span><span class="delimiter">)</span>
      else
        <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.<local ProducerPerfConfig>.props" title="java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;kafka.csv.metrics.dir&quot;)" class="string">&quot;kafka.csv.metrics.dir&quot;</span>, <span title="String(&quot;kafka_metrics&quot;)" class="string">&quot;kafka_metrics&quot;</span><span class="delimiter">)</span>
      <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.<local ProducerPerfConfig>.props" title="java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;kafka.csv.metrics.reporter.enabled&quot;)" class="string">&quot;kafka.csv.metrics.reporter.enabled&quot;</span>, <span title="String(&quot;true&quot;)" class="string">&quot;true&quot;</span><span class="delimiter">)</span>
      val <a title="kafka.utils.VerifiableProperties" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.<local ProducerPerfConfig>.verifiableProps">verifiableProps</a> = new <a href="../utils/VerifiableProperties.scala.html#kafka.utils;VerifiableProperties" title="kafka.utils.VerifiableProperties">VerifiableProperties</a><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.<local ProducerPerfConfig>.props" title="java.util.Properties">props</a><span class="delimiter">)</span>
      <a href="../metrics/KafkaMetricsReporter.scala.html#kafka.metrics.KafkaMetricsReporter" title="kafka.metrics.KafkaMetricsReporter.type">KafkaMetricsReporter</a>.<a href="../metrics/KafkaMetricsReporter.scala.html#kafka.metrics.KafkaMetricsReporter.startReporters" title="(verifiableProps: kafka.utils.VerifiableProperties)Unit">startReporters</a><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.<local ProducerPerfConfig>.verifiableProps" title="kafka.utils.VerifiableProperties">verifiableProps</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    val <a title="Int" id="kafka.tools.ProducerPerformance;ProducerPerfConfig.messageSendGapMs">messageSendGapMs</a> = <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.options" title="=&gt; joptsimple.OptionSet">options</a>.<span title="(x$1: joptsimple.OptionSpec[Integer])Integer">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.messageSendGapMsOpt" title="=&gt; joptsimple.ArgumentAcceptingOptionSpec[Integer]">messageSendGapMsOpt</a><span class="delimiter">)</span>.<span title="()Int">intValue</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  class <a title="class ProducerThread extends Object with Runnable" id="kafka.tools.ProducerPerformance;ProducerThread">ProducerThread</a><a href="#kafka.tools.ProducerPerformance;ProducerThread" title="kafka.tools.ProducerPerformance.ProducerThread" class="delimiter">(</a>val <a title="Int" id="kafka.tools.ProducerPerformance;ProducerThread.threadId">threadId</a>: <span title="Int">Int</span>,
    val <a title="kafka.tools.ProducerPerformance.ProducerPerfConfig" id="kafka.tools.ProducerPerformance;ProducerThread.config">config</a>: <a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig" title="kafka.tools.ProducerPerformance.ProducerPerfConfig">ProducerPerfConfig</a>,
    val <a title="java.util.concurrent.atomic.AtomicLong" id="kafka.tools.ProducerPerformance;ProducerThread.totalBytesSent">totalBytesSent</a>: <span title="java.util.concurrent.atomic.AtomicLong">AtomicLong</span>,
    val <a title="java.util.concurrent.atomic.AtomicLong" id="kafka.tools.ProducerPerformance;ProducerThread.totalMessagesSent">totalMessagesSent</a>: <span title="java.util.concurrent.atomic.AtomicLong">AtomicLong</span>,
    val <a title="java.util.concurrent.CountDownLatch" id="kafka.tools.ProducerPerformance;ProducerThread.allDone">allDone</a>: <span title="java.util.concurrent.CountDownLatch">CountDownLatch</span>,
    val <a title="java.util.Random" id="kafka.tools.ProducerPerformance;ProducerThread.rand">rand</a>: <span title="java.util.Random">Random</span><span class="delimiter">)</span> extends <a href="#kafka.tools.ProducerPerformance;ProducerThread" title="Runnable">Runnable</a> <span class="delimiter">{</span>
    val <a title="Int" id="kafka.tools.ProducerPerformance;ProducerThread.seqIdNumDigit">seqIdNumDigit</a> = <span title="Int(10)" class="int">10</span> <span class="comment">// no. of digits for max int value</span>

    val messagesPerThread = <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.numMessages" title="=&gt; Long">numMessages</a> <a title="Long" id="kafka.tools.ProducerPerformance;ProducerThread.messagesPerThread">/</a> <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.numThreads_=" title="=&gt; Int">numThreads</a>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Messages per thread = &quot;)" class="string">&quot;Messages per thread = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.ProducerPerformance;ProducerThread.messagesPerThread" title="=&gt; Long">messagesPerThread</a><span class="delimiter">)</span>
    val <a title="java.util.Properties" id="kafka.tools.ProducerPerformance;ProducerThread.props">props</a> = new <span title="java.util.Properties">Properties</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="kafka.producer.BaseProducer" id="kafka.tools.ProducerPerformance;ProducerThread.producer">producer</a> =
      if <span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.useNewProducer" title="=&gt; Boolean">useNewProducer</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        import org.apache.kafka.clients.producer.ProducerConfig
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span>ProducerConfig.<span title="String(&quot;bootstrap.servers&quot;)">BOOTSTRAP_SERVERS_CONFIG</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.brokerList" title="=&gt; String">brokerList</a><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span>ProducerConfig.<span title="String(&quot;send.buffer.bytes&quot;)">SEND_BUFFER_CONFIG</span>, <span class="delimiter">(</span><span class="int">64</span> <span title="Int(65536)">*</span> <span class="int">1024</span><span class="delimiter">)</span>.<span title="()String">toString</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span>ProducerConfig.<span title="String(&quot;client.id&quot;)">CLIENT_ID_CONFIG</span>, <span title="String(&quot;producer-performance&quot;)" class="string">&quot;producer-performance&quot;</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span>ProducerConfig.<span title="String(&quot;acks&quot;)">ACKS_CONFIG</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRequestRequiredAcks" title="=&gt; Int">producerRequestRequiredAcks</a>.<span title="()String">toString</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span>ProducerConfig.<span title="String(&quot;timeout.ms&quot;)">TIMEOUT_CONFIG</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRequestTimeoutMs" title="=&gt; Int">producerRequestTimeoutMs</a>.<span title="()String">toString</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span>ProducerConfig.<span title="String(&quot;retries&quot;)">RETRIES_CONFIG</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.producerNumRetries" title="=&gt; Int">producerNumRetries</a>.<span title="()String">toString</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span>ProducerConfig.<span title="String(&quot;retry.backoff.ms&quot;)">RETRY_BACKOFF_MS_CONFIG</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRetryBackoffMs" title="=&gt; Int">producerRetryBackoffMs</a>.<span title="()String">toString</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span>ProducerConfig.<span title="String(&quot;compression.type&quot;)">COMPRESSION_TYPE_CONFIG</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.compressionCodec" title="=&gt; kafka.message.CompressionCodec">compressionCodec</a>.<a href="../message/CompressionCodec.scala.html#kafka.message;CompressionCodec.name" title="=&gt; String">name</a><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span>ProducerConfig.<span title="String(&quot;key.serializer&quot;)">KEY_SERIALIZER_CLASS_CONFIG</span>, <span title="String(&quot;org.apache.kafka.common.serialization.ByteArraySerializer&quot;)" class="string">&quot;org.apache.kafka.common.serialization.ByteArraySerializer&quot;</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span>ProducerConfig.<span title="String(&quot;value.serializer&quot;)">VALUE_SERIALIZER_CLASS_CONFIG</span>, <span title="String(&quot;org.apache.kafka.common.serialization.ByteArraySerializer&quot;)" class="string">&quot;org.apache.kafka.common.serialization.ByteArraySerializer&quot;</span><span class="delimiter">)</span>
        new <a href="../producer/BaseProducer.scala.html#kafka.producer;NewShinyProducer" title="kafka.producer.NewShinyProducer">NewShinyProducer</a><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> else <span class="delimiter">{</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;metadata.broker.list&quot;)" class="string">&quot;metadata.broker.list&quot;</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.brokerList" title="=&gt; String">brokerList</a><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;compression.codec&quot;)" class="string">&quot;compression.codec&quot;</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.compressionCodec" title="=&gt; kafka.message.CompressionCodec">compressionCodec</a>.<a href="../message/CompressionCodec.scala.html#kafka.message;CompressionCodec.codec" title="=&gt; Int">codec</a>.<span title="()String">toString</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;send.buffer.bytes&quot;)" class="string">&quot;send.buffer.bytes&quot;</span>, <span class="delimiter">(</span><span class="int">64</span> <span title="Int(65536)">*</span> <span class="int">1024</span><span class="delimiter">)</span>.<span title="()String">toString</span><span class="delimiter">)</span>
        if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.isSync_=" title="=&gt; Boolean">isSync</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;producer.type&quot;)" class="string">&quot;producer.type&quot;</span>, <span title="String(&quot;async&quot;)" class="string">&quot;async&quot;</span><span class="delimiter">)</span>
          <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;batch.num.messages&quot;)" class="string">&quot;batch.num.messages&quot;</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.batchSize_=" title="=&gt; Int">batchSize</a>.<span title="()String">toString</span><span class="delimiter">)</span>
          <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;queue.enqueue.timeout.ms&quot;)" class="string">&quot;queue.enqueue.timeout.ms&quot;</span>, <span title="String(&quot;-1&quot;)" class="string">&quot;-1&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;client.id&quot;)" class="string">&quot;client.id&quot;</span>, <span title="String(&quot;producer-performance&quot;)" class="string">&quot;producer-performance&quot;</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;request.required.acks&quot;)" class="string">&quot;request.required.acks&quot;</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRequestRequiredAcks" title="=&gt; Int">producerRequestRequiredAcks</a>.<span title="()String">toString</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;request.timeout.ms&quot;)" class="string">&quot;request.timeout.ms&quot;</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRequestTimeoutMs" title="=&gt; Int">producerRequestTimeoutMs</a>.<span title="()String">toString</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;message.send.max.retries&quot;)" class="string">&quot;message.send.max.retries&quot;</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.producerNumRetries" title="=&gt; Int">producerNumRetries</a>.<span title="()String">toString</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;retry.backoff.ms&quot;)" class="string">&quot;retry.backoff.ms&quot;</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.producerRetryBackoffMs" title="=&gt; Int">producerRetryBackoffMs</a>.<span title="()String">toString</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;serializer.class&quot;)" class="string">&quot;serializer.class&quot;</span>, classOf<span title="Class[kafka.serializer.DefaultEncoder](classOf[kafka.serializer.DefaultEncoder])" class="delimiter">[</span>DefaultEncoder<span class="delimiter">]</span>.<span title="()String">getName</span><span class="delimiter">)</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a>.<span title="(x$1: Object, x$2: Object)Object">put</span><span class="delimiter">(</span><span title="String(&quot;key.serializer.class&quot;)" class="string">&quot;key.serializer.class&quot;</span>, classOf<span title="Class[kafka.serializer.NullEncoder[Long]](classOf[kafka.serializer.NullEncoder])" class="delimiter">[</span>NullEncoder<span class="delimiter">[</span>Long<span class="delimiter">]</span><span class="delimiter">]</span>.<span title="()String">getName</span><span class="delimiter">)</span>
        new <a href="../producer/BaseProducer.scala.html#kafka.producer;OldProducer" title="kafka.producer.OldProducer">OldProducer</a><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.props" title="=&gt; java.util.Properties">props</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="comment">// generate the sequential message ID</span>
    private val <a title="String" id="kafka.tools.ProducerPerformance;ProducerThread.SEP">SEP</a> = <span title="String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span class="comment">// message field separator</span>
    private val <a title="String" id="kafka.tools.ProducerPerformance;ProducerThread.messageIdLabel">messageIdLabel</a> = <span title="String(&quot;MessageID&quot;)" class="string">&quot;MessageID&quot;</span>
    private val <a title="String" id="kafka.tools.ProducerPerformance;ProducerThread.threadIdLabel">threadIdLabel</a> = <span title="String(&quot;ThreadID&quot;)" class="string">&quot;ThreadID&quot;</span>
    private val <a title="String" id="kafka.tools.ProducerPerformance;ProducerThread.topicLabel">topicLabel</a> = <span title="String(&quot;Topic&quot;)" class="string">&quot;Topic&quot;</span>
    private var <a title="String" id="kafka.tools.ProducerPerformance;ProducerThread.leftPaddedSeqId_=">leftPaddedSeqId</a>: <span title="String">String</span> = <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>

    private def <a title="(topic: String, msgId: Long, msgSize: Int)Array[Byte]" id="kafka.tools.ProducerPerformance;ProducerThread.generateMessageWithSeqId">generateMessageWithSeqId</a><span class="delimiter">(</span><a title="String" id="kafka.tools.ProducerPerformance;ProducerThread.generateMessageWithSeqId.topic">topic</a>: <span title="String">String</span>, <a title="Long" id="kafka.tools.ProducerPerformance;ProducerThread.generateMessageWithSeqId.msgId">msgId</a>: <span title="Long">Long</span>, <a title="Int" id="kafka.tools.ProducerPerformance;ProducerThread.generateMessageWithSeqId.msgSize">msgSize</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="comment">// Each thread gets a unique range of sequential no. for its ids.</span>
      <span class="comment">// Eg. 1000 msg in 10 threads =&gt; 100 msg per thread</span>
      <span class="comment">// thread 0 IDs :   0 ~  99</span>
      <span class="comment">// thread 1 IDs : 100 ~ 199</span>
      <span class="comment">// thread 2 IDs : 200 ~ 299</span>
      <span class="comment">// . . .</span>
      <a href="#kafka.tools.ProducerPerformance;ProducerThread.leftPaddedSeqId_=" title="(x$1: String)Unit">leftPaddedSeqId</a> = <span title="String.type">String</span>.<span title="(x$1: String, x$2: Object*)String">format</span><span class="delimiter">(</span><span title="String(&quot;%0&quot;)" class="string">&quot;%0&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.ProducerPerformance;ProducerThread.seqIdNumDigit" title="=&gt; Int">seqIdNumDigit</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;d&quot;)" class="string">&quot;d&quot;</span>, <span title="implicit scala.Predef.long2Long : (x: Long)Long">long2Long</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.generateMessageWithSeqId.msgId" title="Long">msgId</a><span class="delimiter">)</span><span class="delimiter">)</span>

      val msgHeader = <a href="#kafka.tools.ProducerPerformance;ProducerThread.topicLabel" title="=&gt; String">topicLabel</a> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.ProducerPerformance;ProducerThread.SEP" title="=&gt; String">SEP</a> <span title="(x$1: Any)String">+</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.generateMessageWithSeqId.topic" title="String">topic</a> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.ProducerPerformance;ProducerThread.SEP" title="=&gt; String">SEP</a> <span title="(x$1: Any)String">+</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.threadIdLabel" title="=&gt; String">threadIdLabel</a> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.ProducerPerformance;ProducerThread.SEP" title="=&gt; String">SEP</a> <span title="(x$1: Any)String">+</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.threadId" title="=&gt; Int">threadId</a> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.ProducerPerformance;ProducerThread.SEP" title="=&gt; String">SEP</a> <span title="(x$1: Any)String">+</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.messageIdLabel" title="=&gt; String">messageIdLabel</a> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.ProducerPerformance;ProducerThread.SEP" title="=&gt; String">SEP</a> <span title="(x$1: Any)String">+</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.leftPaddedSeqId_=" title="=&gt; String">leftPaddedSeqId</a> <a title="String" id="kafka.tools.ProducerPerformance;ProducerThread.generateMessageWithSeqId.msgHeader">+</a> <a href="#kafka.tools.ProducerPerformance;ProducerThread.SEP" title="=&gt; String">SEP</a>

      val <a title="String" id="kafka.tools.ProducerPerformance;ProducerThread.generateMessageWithSeqId.seqMsgString">seqMsgString</a> = <span title="String.type">String</span>.<span title="(x$1: String, x$2: Object*)String">format</span><span class="delimiter">(</span><span title="String(&quot;%1$-&quot;)" class="string">&quot;%1$-&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.tools.ProducerPerformance;ProducerThread.generateMessageWithSeqId.msgSize" title="Int">msgSize</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;s&quot;)" class="string">&quot;s&quot;</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.generateMessageWithSeqId.msgHeader" title="String">msgHeader</a><span class="delimiter">)</span>.<span title="(x$1: Char, x$2: Char)String">replace</span><span class="delimiter">(</span><span title="Char(' ')" class="char">' '</span>, <span title="Char('x')" class="char">'x'</span><span class="delimiter">)</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.generateMessageWithSeqId.seqMsgString" title="String">seqMsgString</a><span class="delimiter">)</span>
      return <a href="#kafka.tools.ProducerPerformance;ProducerThread.generateMessageWithSeqId.seqMsgString" title="String">seqMsgString</a>.<span title="()Array[Byte]">getBytes</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    private def <a title="(topic: String, messageId: Long)Array[Byte]" id="kafka.tools.ProducerPerformance;ProducerThread.generateProducerData">generateProducerData</a><span class="delimiter">(</span><a title="String" id="kafka.tools.ProducerPerformance;ProducerThread.generateProducerData.topic">topic</a>: <span title="String">String</span>, <a title="Long" id="kafka.tools.ProducerPerformance;ProducerThread.generateProducerData.messageId">messageId</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">{</span>
      val <a title="Int" id="kafka.tools.ProducerPerformance;ProducerThread.generateProducerData.msgSize">msgSize</a> = if <span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.isFixedSize_=" title="=&gt; Boolean">isFixedSize</a><span class="delimiter">)</span> <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.messageSize" title="=&gt; Int">messageSize</a> else <span title="Int(1)" class="int">1</span> <span title="(x: Int)Int">+</span> <a href="#kafka.tools.ProducerPerformance;ProducerThread.rand" title="=&gt; java.util.Random">rand</a>.<span title="(x$1: Int)Int">nextInt</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.messageSize" title="=&gt; Int">messageSize</a><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.seqIdMode" title="=&gt; Boolean">seqIdMode</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        val seqId = <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.initialMessageId_=" title="=&gt; Int">initialMessageId</a> <span title="(x: Long)Long">+</span> <span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.messagesPerThread" title="=&gt; Long">messagesPerThread</a> <span title="(x: Int)Long">*</span> <a href="#kafka.tools.ProducerPerformance;ProducerThread.threadId" title="=&gt; Int">threadId</a><span class="delimiter">)</span> <a title="Long" id="kafka.tools.ProducerPerformance;ProducerThread.generateProducerData.seqId">+</a> <a href="#kafka.tools.ProducerPerformance;ProducerThread.generateProducerData.messageId" title="Long">messageId</a>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.generateMessageWithSeqId" title="(topic: String, msgId: Long, msgSize: Int)Array[Byte]">generateMessageWithSeqId</a><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.generateProducerData.topic" title="String">topic</a>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.generateProducerData.seqId" title="Long">seqId</a>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.generateProducerData.msgSize" title="Int">msgSize</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> else <span class="delimiter">{</span>
        new <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.generateProducerData.msgSize" title="Int">msgSize</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    override def <a title="()Unit" id="kafka.tools.ProducerPerformance;ProducerThread.run">run</a> <span class="delimiter">{</span>
      var <a title="Long" id="kafka.tools.ProducerPerformance;ProducerThread.run.bytesSent">bytesSent</a> = <span title="Long(0L)" class="long">0L</span>
      var <a title="Int" id="kafka.tools.ProducerPerformance;ProducerThread.run.nSends">nSends</a> = <span title="Int(0)" class="int">0</span>
      var <a title="Long" id="kafka.tools.ProducerPerformance;ProducerThread.run.i">i</a>: <span title="Long">Long</span> = <span title="Long(0L)" class="long">0L</span>
      var <a title="Array[Byte]" id="kafka.tools.ProducerPerformance;ProducerThread.run.message">message</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = null

      while <span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.run.i" title="Long">i</a> <span title="(x: Long)Boolean">&lt;</span> <a href="#kafka.tools.ProducerPerformance;ProducerThread.messagesPerThread" title="=&gt; Long">messagesPerThread</a><span class="delimiter">)</span> <a href="#kafka.tools.ProducerPerformance;ProducerThread.run.while$1" title="()Unit" class="delimiter">{</a>
        try <span class="delimiter">{</span>
          <a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.topics" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">topics</a>.<span title="(f: String =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span>
            <a title="String" id="kafka.tools.ProducerPerformance;ProducerThread.run.$anonfun.topic">topic</a> =&gt; <span class="delimiter">{</span>
              <a href="#kafka.tools.ProducerPerformance;ProducerThread.run.message" title="Array[Byte]">message</a> = <a href="#kafka.tools.ProducerPerformance;ProducerThread.generateProducerData" title="(topic: String, messageId: Long)Array[Byte]">generateProducerData</a><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.run.$anonfun.topic" title="String">topic</a>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.run.i" title="Long">i</a><span class="delimiter">)</span>
              <a href="#kafka.tools.ProducerPerformance;ProducerThread.producer" title="=&gt; kafka.producer.BaseProducer">producer</a>.<a href="../producer/BaseProducer.scala.html#kafka.producer;BaseProducer.send" title="(topic: String, key: Array[Byte], value: Array[Byte])Unit">send</a><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.run.$anonfun.topic" title="String">topic</a>, <span title="java.math.BigInteger.type">BigInteger</span>.<span title="(x$1: Long)java.math.BigInteger">valueOf</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.run.i" title="Long">i</a><span class="delimiter">)</span>.<span title="()Array[Byte]">toByteArray</span>, <a href="#kafka.tools.ProducerPerformance;ProducerThread.run.message" title="Array[Byte]">message</a><span class="delimiter">)</span>
              <a href="#kafka.tools.ProducerPerformance;ProducerThread.run.bytesSent" title="Long">bytesSent</a> <span title="(x: Int)Long">+=</span> <a href="#kafka.tools.ProducerPerformance;ProducerThread.run.message" title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">message</a>.<span title="=&gt; Int">size</span>
              <a href="#kafka.tools.ProducerPerformance;ProducerThread.run.nSends" title="Int">nSends</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
              if <span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.messageSendGapMs" title="=&gt; Int">messageSendGapMs</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
                <span title="Thread.type">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.config" title="=&gt; kafka.tools.ProducerPerformance.ProducerPerfConfig">config</a>.<a href="#kafka.tools.ProducerPerformance;ProducerPerfConfig.messageSendGapMs" title="=&gt; Long">messageSendGapMs</a><span class="delimiter">)</span>
            <span class="delimiter">}</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> catch <span class="delimiter">{</span>
          case <span title="Throwable">e</span>: <span title="Throwable">Throwable</span> =&gt; <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;Error when sending message &quot;)" class="string">&quot;Error when sending message &quot;</span> <span title="(x$1: Any)String">+</span> new <span title="String">String</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.run.message" title="Array[Byte]">message</a><span class="delimiter">)</span>, <span title="Throwable">e</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.run.i" title="Long">i</a> <span title="(x: Int)Long">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="delimiter">}</span>
      try <span class="delimiter">{</span>
        <a href="#kafka.tools.ProducerPerformance;ProducerThread.producer" title="=&gt; kafka.producer.BaseProducer">producer</a>.<a href="../producer/BaseProducer.scala.html#kafka.producer;BaseProducer.close" title="()Unit">close</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> catch <span class="delimiter">{</span>
        case <span title="Throwable">e</span>: <span title="Throwable">Throwable</span> =&gt; <a href="../utils/Logging.scala.html#kafka.utils;Logging.error(cfd112d89b)" title="(msg: =&gt; String, e: =&gt; Throwable)Unit">error</a><span class="delimiter">(</span><span title="String(&quot;Error when closing producer&quot;)" class="string">&quot;Error when closing producer&quot;</span>, <span title="Throwable">e</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#kafka.tools.ProducerPerformance;ProducerThread.totalBytesSent" title="=&gt; java.util.concurrent.atomic.AtomicLong">totalBytesSent</a>.<span title="(x$1: Long)Long">addAndGet</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.run.bytesSent" title="Long">bytesSent</a><span class="delimiter">)</span>
      <a href="#kafka.tools.ProducerPerformance;ProducerThread.totalMessagesSent" title="=&gt; java.util.concurrent.atomic.AtomicLong">totalMessagesSent</a>.<span title="(x$1: Long)Long">addAndGet</span><span class="delimiter">(</span><a href="#kafka.tools.ProducerPerformance;ProducerThread.run.nSends" title="=&gt; Long">nSends</a><span class="delimiter">)</span>
      <a href="#kafka.tools.ProducerPerformance;ProducerThread.allDone" title="=&gt; java.util.concurrent.CountDownLatch">allDone</a>.<span title="()Unit">countDown</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
