<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>kafka/kafka/producer/BrokerPartitionInfo.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
*/</span>
package kafka.producer

import collection.mutable.HashMap
import kafka.api.TopicMetadata
import kafka.common.KafkaException
import kafka.utils.Logging
import kafka.common.ErrorMapping
import kafka.client.ClientUtils


class <a title="class BrokerPartitionInfo extends AnyRef with kafka.utils.Logging" id="kafka.producer;BrokerPartitionInfo">BrokerPartitionInfo</a><a href="#kafka.producer;BrokerPartitionInfo" title="kafka.producer.BrokerPartitionInfo" class="delimiter">(</a><a title="kafka.producer.ProducerConfig" id="kafka.producer;BrokerPartitionInfo.producerConfig">producerConfig</a>: <a href="ProducerConfig.scala.html#kafka.producer;ProducerConfig" title="kafka.producer.ProducerConfig">ProducerConfig</a>,
                          <a title="kafka.producer.ProducerPool" id="kafka.producer;BrokerPartitionInfo.producerPool">producerPool</a>: <a href="ProducerPool.scala.html#kafka.producer;ProducerPool" title="kafka.producer.ProducerPool">ProducerPool</a>,
                          <a title="scala.collection.mutable.HashMap[String,kafka.api.TopicMetadata]" id="kafka.producer;BrokerPartitionInfo.topicPartitionInfo">topicPartitionInfo</a>: <span title="scala.collection.mutable.HashMap[String,kafka.api.TopicMetadata]">HashMap</span><span class="delimiter">[</span>String, TopicMetadata<span class="delimiter">]</span><span class="delimiter">)</span>
        extends <a href="../utils/Logging.scala.html#kafka.utils;Logging" title="kafka.utils.Logging">Logging</a> <span class="delimiter">{</span>
  val <a title="String" id="kafka.producer;BrokerPartitionInfo.brokerList">brokerList</a> = <a href="#kafka.producer;BrokerPartitionInfo.producerConfig" title="kafka.producer.ProducerConfig">producerConfig</a>.<a href="ProducerConfig.scala.html#kafka.producer;ProducerConfig.brokerList" title="=&gt; String">brokerList</a>
  val <a title="Seq[kafka.cluster.Broker]" id="kafka.producer;BrokerPartitionInfo.brokers">brokers</a> = <a href="../client/ClientUtils.scala.html#kafka.client.ClientUtils" title="kafka.client.ClientUtils.type">ClientUtils</a>.<a href="../client/ClientUtils.scala.html#kafka.client.ClientUtils.parseBrokerList" title="(brokerListStr: String)Seq[kafka.cluster.Broker]">parseBrokerList</a><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.brokerList" title="=&gt; String">brokerList</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Return a sequence of (brokerId, numPartitions).
   * @param topic the topic for which this information is to be returned
   * @return a sequence of (brokerId, numPartitions). Returns a zero-length
   * sequence if no brokers are available.
   */</span>
  def <a title="(topic: String, correlationId: Int)Seq[kafka.producer.PartitionAndLeader]" id="kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo">getBrokerPartitionInfo</a><span class="delimiter">(</span><a title="String" id="kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.topic">topic</a>: <span title="String">String</span>, <a title="Int" id="kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.correlationId">correlationId</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Seq[kafka.producer.PartitionAndLeader]">Seq</span><span class="delimiter">[</span>PartitionAndLeader<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Getting broker partition info for topic %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.topic" title="String">topic</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="comment">// check if the cache has metadata for this topic</span>
    val <a title="Option[kafka.api.TopicMetadata]" id="kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.topicMetadata">topicMetadata</a> = <a href="#kafka.producer;BrokerPartitionInfo.topicPartitionInfo" title="scala.collection.mutable.HashMap[String,kafka.api.TopicMetadata]">topicPartitionInfo</a>.<span title="(key: String)Option[kafka.api.TopicMetadata]">get</span><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.topic" title="String">topic</a><span class="delimiter">)</span>
    val <a title="kafka.api.TopicMetadata" id="kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.metadata">metadata</a>: <a href="../api/TopicMetadata.scala.html#kafka.api;TopicMetadata" title="kafka.api.TopicMetadata">TopicMetadata</a> =
      <a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.topicMetadata" title="Option[kafka.api.TopicMetadata]">topicMetadata</a> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><span title="kafka.api.TopicMetadata">m</span><span class="delimiter">)</span> =&gt; <span title="kafka.api.TopicMetadata">m</span>
        case <span title="None.type">None</span> =&gt;
          <span class="comment">// refresh the topic metadata cache</span>
          <a href="#kafka.producer;BrokerPartitionInfo.updateInfo" title="(topics: Set[String], correlationId: Int)Unit">updateInfo</a><span class="delimiter">(</span><span title="(elems: String*)scala.collection.immutable.Set[String]">Set</span><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.topic" title="String">topic</a><span class="delimiter">)</span>, <a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.correlationId" title="Int">correlationId</a><span class="delimiter">)</span>
          val <a title="Option[kafka.api.TopicMetadata]" id="kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.metadata.topicMetadata">topicMetadata</a> = <a href="#kafka.producer;BrokerPartitionInfo.topicPartitionInfo" title="scala.collection.mutable.HashMap[String,kafka.api.TopicMetadata]">topicPartitionInfo</a>.<span title="(key: String)Option[kafka.api.TopicMetadata]">get</span><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.topic" title="String">topic</a><span class="delimiter">)</span>
          <a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.metadata.topicMetadata" title="Option[kafka.api.TopicMetadata]">topicMetadata</a> match <span class="delimiter">{</span>
            case Some<span class="delimiter">(</span><span title="kafka.api.TopicMetadata">m</span><span class="delimiter">)</span> =&gt; <span title="kafka.api.TopicMetadata">m</span>
            case <span title="None.type">None</span> =&gt; throw new <a href="../common/KafkaException.scala.html#kafka.common;KafkaException" title="kafka.common.KafkaException">KafkaException</a><span class="delimiter">(</span><span title="String(&quot;Failed to fetch topic metadata for topic: &quot;)" class="string">&quot;Failed to fetch topic metadata for topic: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.topic" title="String">topic</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    val <a title="Seq[kafka.api.PartitionMetadata]" id="kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.partitionMetadata">partitionMetadata</a> = <a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.metadata" title="kafka.api.TopicMetadata">metadata</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;TopicMetadata.partitionsMetadata" title="=&gt; Seq[kafka.api.PartitionMetadata]">partitionsMetadata</a>
    if<span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.partitionMetadata" title="Seq[kafka.api.PartitionMetadata]">partitionMetadata</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      if<span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.metadata" title="kafka.api.TopicMetadata">metadata</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;TopicMetadata.errorCode" title="=&gt; Short">errorCode</a> <span title="(x: Short)Boolean">!=</span> <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.NoError" title="=&gt; Short">NoError</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        throw new <a href="../common/KafkaException.scala.html#kafka.common;KafkaException" title="kafka.common.KafkaException">KafkaException</a><span class="delimiter">(</span><a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.exceptionFor" title="(code: Short)Throwable">exceptionFor</a><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.metadata" title="kafka.api.TopicMetadata">metadata</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;TopicMetadata.errorCode" title="=&gt; Short">errorCode</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> else <span class="delimiter">{</span>
        throw new <a href="../common/KafkaException.scala.html#kafka.common;KafkaException" title="kafka.common.KafkaException">KafkaException</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Topic metadata %s has empty partition metadata and no error code&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.metadata" title="kafka.api.TopicMetadata">metadata</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.partitionMetadata" title="Seq[kafka.api.PartitionMetadata]">partitionMetadata</a>.<span title="(f: kafka.api.PartitionMetadata =&gt; kafka.producer.PartitionAndLeader)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[kafka.api.PartitionMetadata],kafka.producer.PartitionAndLeader,Seq[kafka.producer.PartitionAndLeader]])Seq[kafka.producer.PartitionAndLeader]">map</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,kafka.producer.PartitionAndLeader,Seq[kafka.producer.PartitionAndLeader]]" class="delimiter">{</span> <a title="kafka.api.PartitionMetadata" id="kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.$anonfun.m">m</a> =&gt;
      <a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.$anonfun.m" title="kafka.api.PartitionMetadata">m</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;PartitionMetadata.leader" title="=&gt; Option[kafka.cluster.Broker]">leader</a> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><a title="kafka.cluster.Broker" id="kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.$anonfun.leader">leader</a><span class="delimiter">)</span> =&gt;
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Partition [%s,%d] has leader %d&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.topic" title="String">topic</a>, <a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.$anonfun.m" title="kafka.api.PartitionMetadata">m</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;PartitionMetadata.partitionId" title="=&gt; Int">partitionId</a>, <a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.$anonfun.leader" title="kafka.cluster.Broker">leader</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.id" title="=&gt; Int">id</a><span class="delimiter">)</span><span class="delimiter">)</span>
          new <a href="#kafka.producer.PartitionAndLeader.readResolve" title="kafka.producer.PartitionAndLeader">PartitionAndLeader</a><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.topic" title="String">topic</a>, <a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.$anonfun.m" title="kafka.api.PartitionMetadata">m</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;PartitionMetadata.partitionId" title="=&gt; Int">partitionId</a>, <span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.$anonfun.leader" title="kafka.cluster.Broker">leader</a>.<a href="../cluster/Broker.scala.html#kafka.cluster;Broker.id" title="=&gt; Int">id</a><span class="delimiter">)</span><span class="delimiter">)</span>
        case <span title="None.type">None</span> =&gt;
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.debug(1729dbc42f)" title="(msg: =&gt; String)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Partition [%s,%d] does not have a leader yet&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.topic" title="String">topic</a>, <a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.$anonfun.m" title="kafka.api.PartitionMetadata">m</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;PartitionMetadata.partitionId" title="=&gt; Int">partitionId</a><span class="delimiter">)</span><span class="delimiter">)</span>
          new <a href="#kafka.producer.PartitionAndLeader.readResolve" title="kafka.producer.PartitionAndLeader">PartitionAndLeader</a><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.topic" title="String">topic</a>, <a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.$anonfun.m" title="kafka.api.PartitionMetadata">m</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;PartitionMetadata.partitionId" title="=&gt; Int">partitionId</a>, <span title="None.type">None</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>.<span title="(lt: (kafka.producer.PartitionAndLeader, kafka.producer.PartitionAndLeader) =&gt; Boolean)Seq[kafka.producer.PartitionAndLeader]">sortWith</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="kafka.producer.PartitionAndLeader" id="kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.$anonfun.s">s</a>, <a title="kafka.producer.PartitionAndLeader" id="kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.$anonfun.t">t</a><span class="delimiter">)</span> =&gt; <a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.$anonfun.s" title="kafka.producer.PartitionAndLeader">s</a>.<a href="#kafka.producer;PartitionAndLeader.partitionId" title="=&gt; Int">partitionId</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#kafka.producer;BrokerPartitionInfo.getBrokerPartitionInfo.$anonfun.t" title="kafka.producer.PartitionAndLeader">t</a>.<a href="#kafka.producer;PartitionAndLeader.partitionId" title="=&gt; Int">partitionId</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * It updates the cache by issuing a get topic metadata request to a random broker.
   * @param topics the topics for which the metadata is to be fetched
   */</span>
  def <a title="(topics: Set[String], correlationId: Int)Unit" id="kafka.producer;BrokerPartitionInfo.updateInfo">updateInfo</a><span class="delimiter">(</span><a title="Set[String]" id="kafka.producer;BrokerPartitionInfo.updateInfo.topics">topics</a>: <span title="Set[String]">Set</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="Int" id="kafka.producer;BrokerPartitionInfo.updateInfo.correlationId">correlationId</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    var <a title="Seq[kafka.api.TopicMetadata]" id="kafka.producer;BrokerPartitionInfo.updateInfo.topicsMetadata">topicsMetadata</a>: <span title="Seq[kafka.api.TopicMetadata]">Seq</span><span class="delimiter">[</span>TopicMetadata<span class="delimiter">]</span> = <span title="scala.collection.immutable.Nil.type">Nil</span>
    val <a title="kafka.api.TopicMetadataResponse" id="kafka.producer;BrokerPartitionInfo.updateInfo.topicMetadataResponse">topicMetadataResponse</a> = <a href="../client/ClientUtils.scala.html#kafka.client.ClientUtils" title="kafka.client.ClientUtils.type">ClientUtils</a>.<a href="../client/ClientUtils.scala.html#kafka.client.ClientUtils.fetchTopicMetadata(cbd8040d72)" title="(topics: scala.collection.Set[String], brokers: Seq[kafka.cluster.Broker], producerConfig: kafka.producer.ProducerConfig, correlationId: Int)kafka.api.TopicMetadataResponse">fetchTopicMetadata</a><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.updateInfo.topics" title="Set[String]">topics</a>, <a href="#kafka.producer;BrokerPartitionInfo.brokers" title="=&gt; Seq[kafka.cluster.Broker]">brokers</a>, <a href="#kafka.producer;BrokerPartitionInfo.producerConfig" title="kafka.producer.ProducerConfig">producerConfig</a>, <a href="#kafka.producer;BrokerPartitionInfo.updateInfo.correlationId" title="Int">correlationId</a><span class="delimiter">)</span>
    <a href="#kafka.producer;BrokerPartitionInfo.updateInfo.topicsMetadata" title="Seq[kafka.api.TopicMetadata]">topicsMetadata</a> = <a href="#kafka.producer;BrokerPartitionInfo.updateInfo.topicMetadataResponse" title="kafka.api.TopicMetadataResponse">topicMetadataResponse</a>.<a href="../api/TopicMetadataResponse.scala.html#kafka.api;TopicMetadataResponse.topicsMetadata" title="=&gt; Seq[kafka.api.TopicMetadata]">topicsMetadata</a>
    <span class="comment">// throw partition specific exception</span>
    <a href="#kafka.producer;BrokerPartitionInfo.updateInfo.topicsMetadata" title="Seq[kafka.api.TopicMetadata]">topicsMetadata</a>.<span title="(f: kafka.api.TopicMetadata =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="kafka.api.TopicMetadata" id="kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.tmd">tmd</a> =&gt;<span class="delimiter">{</span>
      <a href="../utils/Logging.scala.html#kafka.utils;Logging.trace(1729dbc42f)" title="(msg: =&gt; String)Unit">trace</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Metadata for topic %s is %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.tmd" title="kafka.api.TopicMetadata">tmd</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;TopicMetadata.topic" title="=&gt; String">topic</a>, <a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.tmd" title="kafka.api.TopicMetadata">tmd</a><span class="delimiter">)</span><span class="delimiter">)</span>
      if<span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.tmd" title="kafka.api.TopicMetadata">tmd</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;TopicMetadata.errorCode" title="=&gt; Short">errorCode</a> <span title="(x: Short)Boolean">==</span> <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.NoError" title="=&gt; Short">NoError</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#kafka.producer;BrokerPartitionInfo.topicPartitionInfo" title="scala.collection.mutable.HashMap[String,kafka.api.TopicMetadata]">topicPartitionInfo</a>.<span title="(key: String, value: kafka.api.TopicMetadata)Option[kafka.api.TopicMetadata]">put</span><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.tmd" title="kafka.api.TopicMetadata">tmd</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;TopicMetadata.topic" title="=&gt; String">topic</a>, <a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.tmd" title="kafka.api.TopicMetadata">tmd</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> else
        <a href="../utils/Logging.scala.html#kafka.utils;Logging.warn(1729dbc42f)" title="(msg: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Error while fetching metadata [%s] for topic [%s]: %s &quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.tmd" title="kafka.api.TopicMetadata">tmd</a>, <a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.tmd" title="kafka.api.TopicMetadata">tmd</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;TopicMetadata.topic" title="=&gt; String">topic</a>, <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.exceptionFor" title="(code: Short)Throwable">exceptionFor</a><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.tmd" title="kafka.api.TopicMetadata">tmd</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;TopicMetadata.errorCode" title="=&gt; Short">errorCode</a><span class="delimiter">)</span>.<span title="()Class[_]">getClass</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.tmd" title="kafka.api.TopicMetadata">tmd</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;TopicMetadata.partitionsMetadata" title="=&gt; Seq[kafka.api.PartitionMetadata]">partitionsMetadata</a>.<span title="(f: kafka.api.PartitionMetadata =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="kafka.api.PartitionMetadata" id="kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.$anonfun.pmd">pmd</a> =&gt;<span class="delimiter">{</span>
        if <span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.$anonfun.pmd" title="kafka.api.PartitionMetadata">pmd</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;PartitionMetadata.errorCode" title="=&gt; Short">errorCode</a> <span title="(x: Short)Boolean">!=</span> <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.NoError" title="=&gt; Short">NoError</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.$anonfun.pmd" title="kafka.api.PartitionMetadata">pmd</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;PartitionMetadata.errorCode" title="=&gt; Short">errorCode</a> <span title="(x: Short)Boolean">==</span> <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.LeaderNotAvailableCode" title="=&gt; Short">LeaderNotAvailableCode</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../utils/Logging.scala.html#kafka.utils;Logging.warn(1729dbc42f)" title="(msg: =&gt; String)Unit">warn</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Error while fetching metadata %s for topic partition [%s,%d]: [%s]&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.$anonfun.pmd" title="kafka.api.PartitionMetadata">pmd</a>, <a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.tmd" title="kafka.api.TopicMetadata">tmd</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;TopicMetadata.topic" title="=&gt; String">topic</a>, <a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.$anonfun.pmd" title="kafka.api.PartitionMetadata">pmd</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;PartitionMetadata.partitionId" title="=&gt; Int">partitionId</a>,
            <a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping" title="kafka.common.ErrorMapping.type">ErrorMapping</a>.<a href="../common/ErrorMapping.scala.html#kafka.common.ErrorMapping.exceptionFor" title="(code: Short)Throwable">exceptionFor</a><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.updateInfo.$anonfun.$anonfun.pmd" title="kafka.api.PartitionMetadata">pmd</a>.<a href="../api/TopicMetadata.scala.html#kafka.api;PartitionMetadata.errorCode" title="=&gt; Short">errorCode</a><span class="delimiter">)</span>.<span title="()Class[_]">getClass</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="comment">// any other error code (e.g. ReplicaNotAvailable) can be ignored since the producer does not need to access the replica and isr metadata</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#kafka.producer;BrokerPartitionInfo.producerPool" title="kafka.producer.ProducerPool">producerPool</a>.<a href="ProducerPool.scala.html#kafka.producer;ProducerPool.updateProducer" title="(topicMetadata: Seq[kafka.api.TopicMetadata])Unit">updateProducer</a><span class="delimiter">(</span><a href="#kafka.producer;BrokerPartitionInfo.updateInfo.topicsMetadata" title="Seq[kafka.api.TopicMetadata]">topicsMetadata</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
<span class="delimiter">}</span>

case class <a title="class PartitionAndLeader extends AnyRef with Product with Serializable" id="kafka.producer.PartitionAndLeader.readResolve">PartitionAndLeader</a><a href="#kafka.producer.PartitionAndLeader.readResolve" title="Product" class="delimiter">(</a><a title="String" id="kafka.producer;PartitionAndLeader.topic">topic</a>: <span title="String">String</span>, <a title="Int" id="kafka.producer;PartitionAndLeader.partitionId">partitionId</a>: <span title="Int">Int</span>, <a title="Option[Int]" id="kafka.producer;PartitionAndLeader.leaderBrokerIdOpt">leaderBrokerIdOpt</a>: <span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span><span class="delimiter">)</span>

        </pre>
    </body>
</html>
