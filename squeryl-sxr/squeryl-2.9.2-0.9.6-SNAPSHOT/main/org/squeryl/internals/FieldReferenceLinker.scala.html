<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>main/org/squeryl/internals/FieldReferenceLinker.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/*******************************************************************************
 * Copyright 2010 Maxime LÃ©vesque
 * 
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ***************************************************************************** */
<span class="keyword">package</span> org.squeryl.internals

<span class="keyword">import</span> net.sf.cglib.proxy._
<span class="keyword">import</span> collection.mutable.<span class="delimiter">{</span>HashSet, ArrayBuffer<span class="delimiter">}</span>
<span class="keyword">import</span> org.squeryl.dsl.ast._
<span class="keyword">import</span> org.squeryl.dsl.CompositeKey
<span class="keyword">import</span> org.squeryl.dsl.TypedExpression
<span class="keyword">import</span> java.lang.reflect.<span class="delimiter">{</span>Field, Method<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="org.squeryl.internals.FieldReferenceLinker.type" id="8099">FieldReferenceLinker</a> <a href="#8100" title="org.squeryl.internals.FieldReferenceLinker.type" class="delimiter">{</a>

  <span class="keyword">def</span> <a title="[T](e: () =&gt; org.squeryl.dsl.TypedExpression[T, _])T" id="65021">pushExpressionOrCollectValue</a><span class="delimiter">[</span><a title="" id="65023">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="() =&gt; org.squeryl.dsl.TypedExpression[T, _]" id="75585">e</a>: <span class="delimiter">(</span><span class="delimiter">)</span>=&gt;TypedExpression<span class="delimiter">[</span>T,_<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#65023" title="T">T</a> = <span class="delimiter">{</span>
    <span title="T" class="keyword">if</span> <span class="delimiter">(</span><a href="#65025" title="=&gt; Boolean">isYieldInspectionMode</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" id="99978">yi</a> = <a href="#65039" title="=&gt; ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="()org.squeryl.internals.FieldReferenceLinker.YieldInspection">get</span>
      <span class="keyword">val</span> <a title="org.squeryl.dsl.TypedExpression[T, _]" id="99979">expr</a> = <a href="#99978" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#92255" title="(f: () =&gt; org.squeryl.dsl.TypedExpression[T, _])org.squeryl.dsl.TypedExpression[T, _]">callWithoutReentrance</a><span class="delimiter">(</span><a href="#75585" title="() =&gt; org.squeryl.dsl.TypedExpression[T, _]">e</a><span class="delimiter">)</span>
      <a href="#99978" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#92258" title="(e: org.squeryl.dsl.ast.SelectElement)Unit">addSelectElement</a><span class="delimiter">(</span><span title="org.squeryl.dsl.ast.ValueSelectElement" class="keyword">new</span> <a href="../dsl/ast/SelectElement.scala.html#7713" title="org.squeryl.dsl.ast.ValueSelectElement">ValueSelectElement</a><span class="delimiter">(</span><a href="#99979" title="org.squeryl.dsl.TypedExpression[T, _]">expr</a>, <a href="#99978" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#92259" title="=&gt; org.squeryl.internals.ResultSetMapper">resultSetMapper</a>, <a href="#99979" title="org.squeryl.dsl.TypedExpression[T, _]">expr</a>.<a href="../dsl/TypedExpression.scala.html#31887" title="=&gt; org.squeryl.internals.OutMapper[T]">mapper</a>, <a href="#99978" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#92249" title="=&gt; org.squeryl.dsl.ast.QueryExpressionNode[_]">queryExpressionNode</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="T" id="99980">r</a> = <a href="#99979" title="org.squeryl.dsl.TypedExpression[T, _]">expr</a>.<a href="../dsl/TypedExpression.scala.html#31886" title="=&gt; T">sample</a>
      <a href="#99980" title="T">r</a>
    <span class="delimiter">}</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="T" id="99998">r</a> = <a href="#65027" title="=&gt; ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]">_yieldValues</a>.<span title="()scala.collection.mutable.ArrayBuffer[AnyRef]">get</span>.<span title="(n: Int)AnyRef">remove</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#65023" title="T">T</a><span class="delimiter">]</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#65027" title="=&gt; ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]">_yieldValues</a>.<span title="()scala.collection.mutable.ArrayBuffer[AnyRef]">get</span>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#65027" title="=&gt; ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]">_yieldValues</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#99998" title="T">r</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(v: AnyRef)Unit" id="65024">pushYieldValue</a><span class="delimiter">(</span><a title="AnyRef" id="100022">v</a>:<span title="AnyRef">AnyRef</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="scala.collection.mutable.ArrayBuffer[AnyRef]" id="100023">a</a> = <a href="#65027" title="=&gt; ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]">_yieldValues</a>.<span title="()scala.collection.mutable.ArrayBuffer[AnyRef]">get</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#100023" title="scala.collection.mutable.ArrayBuffer[AnyRef]">a</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#100023" title="scala.collection.mutable.ArrayBuffer[AnyRef]">a</a> = <span title="()scala.collection.mutable.ArrayBuffer[AnyRef]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[AnyRef]">ArrayBuffer</span><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span>
      <a href="#65027" title="=&gt; ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]">_yieldValues</a>.<span title="(x$1: scala.collection.mutable.ArrayBuffer[AnyRef])Unit">set</span><span class="delimiter">(</span><a href="#100023" title="scala.collection.mutable.ArrayBuffer[AnyRef]">a</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#100023" title="scala.collection.mutable.ArrayBuffer[AnyRef]">a</a>.<span title="(elems: AnyRef*)Unit">append</span><span class="delimiter">(</span><a href="#100022" title="AnyRef">v</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="65025">isYieldInspectionMode</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" id="92241">yi</a> = <a href="#65039" title="=&gt; ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="()org.squeryl.internals.FieldReferenceLinker.YieldInspection">get</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#92241" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#92241" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#92254" title="=&gt; Boolean">isOn</a>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#65039" title="=&gt; ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; org.squeryl.dsl.ast.QueryExpressionNode[_]" id="65026">inspectedQueryExpressionNode</a> = <a href="#65039" title="=&gt; ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="()org.squeryl.internals.FieldReferenceLinker.YieldInspection">get</span>.<a href="#92249" title="=&gt; org.squeryl.dsl.ast.QueryExpressionNode[_]">queryExpressionNode</a>
  
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]" id="65027">_yieldValues</a> = <span title="ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]" class="keyword">new</span> <span title="ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]">ThreadLocal</span><span class="delimiter">[</span>ArrayBuffer<span class="delimiter">[</span>AnyRef<span class="delimiter">]</span><span class="delimiter">]</span>
  
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="ThreadLocal[Option[org.squeryl.dsl.ast.SelectElement]]" id="65029">__lastAccessedFieldReference</a> = <span title="ThreadLocal[Option[org.squeryl.dsl.ast.SelectElement]]" class="keyword">new</span> <span title="ThreadLocal[Option[org.squeryl.dsl.ast.SelectElement]]">ThreadLocal</span><span class="delimiter">[</span>Option<span class="delimiter">[</span>SelectElement<span class="delimiter">]</span><span class="delimiter">]</span>

  <span class="keyword">private</span> <span class="delimiter">[</span>squeryl<span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; Option[org.squeryl.dsl.ast.SelectElement]" id="65031">_lastAccessedFieldReference</a>: <span title="Option[org.squeryl.dsl.ast.SelectElement]">Option</span><span class="delimiter">[</span>SelectElement<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Option[org.squeryl.dsl.ast.SelectElement]" id="100035">fr</a> = <a href="#65029" title="=&gt; ThreadLocal[Option[org.squeryl.dsl.ast.SelectElement]]">__lastAccessedFieldReference</a>.<span title="()Option[org.squeryl.dsl.ast.SelectElement]">get</span>
    <span title="Option[org.squeryl.dsl.ast.SelectElement]" class="keyword">if</span> <span class="delimiter">(</span><a href="#100035" title="Option[org.squeryl.dsl.ast.SelectElement]">fr</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="None.type">None</span> <span class="keyword">else</span> <a href="#100035" title="Option[org.squeryl.dsl.ast.SelectElement]">fr</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="delimiter">[</span>squeryl<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(se: Option[org.squeryl.dsl.ast.SelectElement])Unit" id="65032">_lastAccessedFieldReference_=</a><span class="delimiter">(</span><a title="Option[org.squeryl.dsl.ast.SelectElement]" id="92276">se</a>: <span title="Option[org.squeryl.dsl.ast.SelectElement]">Option</span><span class="delimiter">[</span>SelectElement<span class="delimiter">]</span><span class="delimiter">)</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#92276" title="Option[org.squeryl.dsl.ast.SelectElement]">se</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="None.type">None</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#65029" title="=&gt; ThreadLocal[Option[org.squeryl.dsl.ast.SelectElement]]">__lastAccessedFieldReference</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#65029" title="=&gt; ThreadLocal[Option[org.squeryl.dsl.ast.SelectElement]]">__lastAccessedFieldReference</a>.<span title="(x$1: Option[org.squeryl.dsl.ast.SelectElement])Unit">set</span><span class="delimiter">(</span><a href="#92276" title="Option[org.squeryl.dsl.ast.SelectElement]">se</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]" id="65033">_compositeKeyMembers</a> = <span title="ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]" class="keyword">new</span> <span title="ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]">ThreadLocal</span><span class="delimiter">[</span>Option<span class="delimiter">[</span>ArrayBuffer<span class="delimiter">[</span>SelectElement<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>

  /**
   * _lastAccessedFieldReference is unique per thread, AST construction can be nested and can interfere with
   * one another, this method is used for  preserving the previous _lastAccessedFieldReference when a nested
   * AST construction takes place *and* during the construction of 'sample' POSOs, because they are proxied,
   * and can call their intercepted fields during construction, calling the constructor for 'sample' POSO construction
   * without wrapping with this methor would have the effect of 'polluting' the _lastAccessedFieldReference (issue 68). 
   */
  <span class="keyword">def</span> <a title="[A](expressionWithSideEffectsASTConstructionThreadLocalState: =&gt; A)A" id="65035">executeAndRestoreLastAccessedFieldReference</a><span class="delimiter">[</span><a title="" id="65037">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; A" id="65055">expressionWithSideEffectsASTConstructionThreadLocalState</a>: =&gt;A<span class="delimiter">)</span>: <a href="#65037" title="A">A</a> = <span class="delimiter">{</span>
    // if we are currently building an AST, we must save the (last) _lastAccessedFieldReference
    <span class="keyword">val</span> <a title="Option[org.squeryl.dsl.ast.SelectElement]" id="100040">prev</a> = <a href="#8099" title="org.squeryl.internals.FieldReferenceLinker.type">FieldReferenceLinker</a>.<a href="#65031" title="=&gt; Option[org.squeryl.dsl.ast.SelectElement]">_lastAccessedFieldReference</a>
    <span class="keyword">val</span> <a title="A" id="100041">a</a> = <a href="#65055" title="=&gt; A">expressionWithSideEffectsASTConstructionThreadLocalState</a>
    // and restore it to the previous state (issue19)
    <a href="#8099" title="org.squeryl.internals.FieldReferenceLinker.type">FieldReferenceLinker</a>.<a href="#65032" title="(se: Option[org.squeryl.dsl.ast.SelectElement])Unit">_lastAccessedFieldReference</a> = <a href="#100040" title="Option[org.squeryl.dsl.ast.SelectElement]">prev</a>
    <a href="#100041" title="A">a</a>
  <span class="delimiter">}</span>
  
  <span class="keyword">class</span> <a title="class YieldInspection extends Object" id="65038">YieldInspection</a> <a href="#65038" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" class="delimiter">{</a>
    
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]" id="92243">_utilizedFields</a> = <span title="()scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]">ArrayBuffer</span><span class="delimiter">[</span>SelectElement<span class="delimiter">]</span>
    <span class="keyword">var</span> <a title="Boolean" id="92246">_on</a> = <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">var</span> <a title="org.squeryl.dsl.ast.QueryExpressionNode[_]" id="92249">queryExpressionNode</a>: <a href="../dsl/ast/QueryExpressionNode.scala.html#7699" title="org.squeryl.dsl.ast.QueryExpressionNode[_]">QueryExpressionNode</a><span class="delimiter">[</span>_<span class="delimiter">]</span> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">var</span> <a title="org.squeryl.internals.ResultSetMapper" id="92252">_resultSetMapper</a>: <a href="ResultSetMapper.scala.html#8168" title="org.squeryl.internals.ResultSetMapper">ResultSetMapper</a> = <span title="Null(null)" class="keyword">null</span>

    <span class="keyword">def</span> <a title="=&gt; Boolean" id="92254">isOn</a> = <a href="#92246" title="=&gt; Boolean">_on</a>

    <span class="keyword">def</span> <a title="[U](f: () =&gt; U)U" id="92255">callWithoutReentrance</a><span class="delimiter">[</span><a title="" id="92257">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="() =&gt; U" id="99981">f</a>: <span class="delimiter">(</span><span class="delimiter">)</span>=&gt;U<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Boolean" id="99982">prev</a> = <a href="#92246" title="=&gt; Boolean">_on</a>
      <a href="#92246" title="(x$1: Boolean)Unit">_on</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">val</span> <a title="U" id="99983">res</a> = <a href="#99981" title="()U">f</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#92246" title="(x$1: Boolean)Unit">_on</a> = <a href="#99982" title="Boolean">prev</a>
      <a href="#99983" title="U">res</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(e: org.squeryl.dsl.ast.SelectElement)Unit" id="92258">addSelectElement</a><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.SelectElement" id="92272">e</a>: <a href="../dsl/ast/SelectElement.scala.html#7710" title="org.squeryl.dsl.ast.SelectElement">SelectElement</a><span class="delimiter">)</span> =
      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#92272" title="org.squeryl.dsl.ast.SelectElement">e</a>.<a href="../dsl/ast/SelectElement.scala.html#56554" title="=&gt; Boolean">inhibited</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#92243" title="=&gt; scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]">_utilizedFields</a>.<span title="(elems: org.squeryl.dsl.ast.SelectElement*)Unit">append</span><span class="delimiter">(</span><a href="#92272" title="org.squeryl.dsl.ast.SelectElement">e</a><span class="delimiter">)</span>
        <a href="#92272" title="org.squeryl.dsl.ast.SelectElement">e</a>.<a href="../dsl/ast/SelectElement.scala.html#56552" title="(index: Int)Unit">prepareColumnMapper</a><span class="delimiter">(</span><a href="#92243" title="=&gt; scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]">_utilizedFields</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="=&gt; org.squeryl.internals.ResultSetMapper" id="92259">resultSetMapper</a> = <a href="#92252" title="=&gt; org.squeryl.internals.ResultSetMapper">_resultSetMapper</a>

    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="92261">_reentranceDepth</a> = <span title="Int(0)" class="int">0</span>

     <span class="keyword">def</span> <a title="=&gt; Int" id="92263">reentranceDepth</a> = <a href="#92261" title="=&gt; Int">_reentranceDepth</a>

     <span class="keyword">def</span> <a title="=&gt; Unit" id="92264">incrementReentranceDepth</a> =
       <a href="#92261" title="(x$1: Int)Unit">_reentranceDepth</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>

     <span class="keyword">def</span> <a title="=&gt; Unit" id="92265">decrementReentranceDepth</a> =
       <a href="#92261" title="(x$1: Int)Unit">_reentranceDepth</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>

    <span class="keyword">def</span> <a title="(q: org.squeryl.dsl.ast.QueryExpressionNode[_], rsm: org.squeryl.internals.ResultSetMapper)Unit" id="92266">turnOn</a><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.QueryExpressionNode[_]" id="92931">q</a>: <a href="../dsl/ast/QueryExpressionNode.scala.html#7699" title="org.squeryl.dsl.ast.QueryExpressionNode[_]">QueryExpressionNode</a><span class="delimiter">[</span>_<span class="delimiter">]</span>, <a title="org.squeryl.internals.ResultSetMapper" id="92932">rsm</a>: <a href="ResultSetMapper.scala.html#8168" title="org.squeryl.internals.ResultSetMapper">ResultSetMapper</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#92261" title="(x$1: Int)Unit">_reentranceDepth</a> = <span title="Int(0)" class="int">0</span>
      <a href="#92249" title="(x$1: org.squeryl.dsl.ast.QueryExpressionNode[_])Unit">queryExpressionNode</a> = <a href="#92931" title="org.squeryl.dsl.ast.QueryExpressionNode[_]">q</a>
      <a href="#92246" title="(x$1: Boolean)Unit">_on</a> = <span title="Boolean(true)" class="keyword">true</span>
      <a href="#92252" title="(x$1: org.squeryl.internals.ResultSetMapper)Unit">_resultSetMapper</a> = <a href="#92932" title="org.squeryl.internals.ResultSetMapper">rsm</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; List[org.squeryl.dsl.ast.SelectElement]" id="92267">outExpressions</a>: <span title="List[org.squeryl.dsl.ast.SelectElement]">List</span><span class="delimiter">[</span>SelectElement<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <a href="#92243" title="=&gt; scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]">_utilizedFields</a>.<span title="=&gt; List[org.squeryl.dsl.ast.SelectElement]">toList</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]" id="65039">_yieldInspectionTL</a> = <span title="ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]" class="keyword">new</span> <span title="ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">ThreadLocal</span><span class="delimiter">[</span>YieldInspection<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="(e: org.squeryl.dsl.ast.SelectElement)Unit" id="65041">putLastAccessedSelectElement</a><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.SelectElement" id="92240">e</a>: <a href="../dsl/ast/SelectElement.scala.html#7710" title="org.squeryl.dsl.ast.SelectElement">SelectElement</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#65025" title="=&gt; Boolean">isYieldInspectionMode</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#65039" title="=&gt; ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="()org.squeryl.internals.FieldReferenceLinker.YieldInspection">get</span>.<a href="#92258" title="(e: org.squeryl.dsl.ast.SelectElement)Unit">addSelectElement</a><span class="delimiter">(</span><span title="org.squeryl.dsl.ast.ExportedSelectElement" class="keyword">new</span> <a href="../dsl/ast/SelectElement.scala.html#7717" title="org.squeryl.dsl.ast.ExportedSelectElement">ExportedSelectElement</a><span class="delimiter">(</span><a href="#92240" title="org.squeryl.dsl.ast.SelectElement">e</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span>
    <a href="#65032" title="(se: Option[org.squeryl.dsl.ast.SelectElement])Unit">_lastAccessedFieldReference</a> = <span title="(x: org.squeryl.dsl.ast.SelectElement)Some[org.squeryl.dsl.ast.SelectElement]">Some</span><span class="delimiter">(</span><a href="#92240" title="org.squeryl.dsl.ast.SelectElement">e</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Option[org.squeryl.dsl.ast.SelectElement]" id="65042">takeLastAccessedFieldReference</a>: <span title="Option[org.squeryl.dsl.ast.SelectElement]">Option</span><span class="delimiter">[</span>SelectElement<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Option[org.squeryl.dsl.ast.SelectElement]" id="100062">res</a> = <a href="#65031" title="=&gt; Option[org.squeryl.dsl.ast.SelectElement]">_lastAccessedFieldReference</a>
    <a href="#65032" title="(se: Option[org.squeryl.dsl.ast.SelectElement])Unit">_lastAccessedFieldReference</a> = <span title="None.type">None</span>
    <a href="#100062" title="Option[org.squeryl.dsl.ast.SelectElement]">res</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; org.squeryl.dsl.ast.SelectElementReference[_, _]" id="65043">_takeLastAccessedUntypedFieldReference</a>: <a href="../dsl/ast/SelectElement.scala.html#7714" title="org.squeryl.dsl.ast.SelectElementReference[_, _]">SelectElementReference</a><span class="delimiter">[</span>_,_<span class="delimiter">]</span> =
    <a href="#8099" title="org.squeryl.internals.FieldReferenceLinker.type">FieldReferenceLinker</a>.<a href="#65042" title="=&gt; Option[org.squeryl.dsl.ast.SelectElement]">takeLastAccessedFieldReference</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Some<a href="#424976" title="org.squeryl.dsl.ast.SelectElementReference[Any,Nothing]" id="424977" class="delimiter">(</a><a href="#424977" title="org.squeryl.dsl.ast.SelectElement" id="100072">n</a>:SelectElement<span class="delimiter">)</span> =&gt; <a href="#424982" title="(x: org.squeryl.dsl.ast.SelectElementReference[Any,Nothing])org.squeryl.dsl.ast.SelectElementReference[Any,Nothing]" class="keyword">new</a> <a href="../dsl/ast/SelectElement.scala.html#7714" title="org.squeryl.dsl.ast.SelectElementReference[Any,Nothing]">SelectElementReference</a><span class="delimiter">(</span>n,<a href="ResultSetMapper.scala.html#8164" title="org.squeryl.internals.NoOpOutMapper.type">NoOpOutMapper</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#424976" title="org.squeryl.dsl.ast.SelectElementReference[Any,Nothing]" id="424980">None</a> =&gt; org.squeryl.internals.<a href="Utils.scala.html#8187" title="org.squeryl.internals.Utils.type">Utils</a>.<a href="Utils.scala.html#32420" title="(msg: String)Nothing">throwError</a><a href="#424982" title="(x: org.squeryl.dsl.ast.SelectElementReference[Any,Nothing])org.squeryl.dsl.ast.SelectElementReference[Any,Nothing]" class="delimiter">(</a><span title="String(&quot;Thread local does not have a last accessed field... this is a severe bug !&quot;)" class="string">&quot;Thread local does not have a last accessed field... this is a severe bug !&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(e: Any, c: Any)org.squeryl.dsl.ast.LogicalBoolean" id="65044">createEqualityExpressionWithLastAccessedFieldReferenceAndConstant</a><span class="delimiter">(</span><a title="Any" id="65460">e</a>: <span title="Any">Any</span>, <a title="Any" id="65461">c</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <a href="../dsl/ast/ExpressionNode.scala.html#7651" title="org.squeryl.dsl.ast.LogicalBoolean">LogicalBoolean</a> = <span class="delimiter">{</span>

    <span title="org.squeryl.dsl.ast.LogicalBoolean" class="keyword">if</span><span class="delimiter">(</span><a href="#65460" title="Any">e</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../dsl/CompositeKey.scala.html#7375" title="org.squeryl.dsl.CompositeKey">CompositeKey</a><span class="delimiter">]</span><span class="delimiter">)</span>
      <a href="#65460" title="Any">e</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.CompositeKey" class="delimiter">[</span><a href="../dsl/CompositeKey.scala.html#7375" title="org.squeryl.dsl.CompositeKey">CompositeKey</a><span class="delimiter">]</span>.<a href="../dsl/CompositeKey.scala.html#33403" title="(ck: org.squeryl.dsl.CompositeKey)org.squeryl.dsl.ast.LogicalBoolean">buildEquality</a><span class="delimiter">(</span><a href="#65461" title="Any">c</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.CompositeKey" class="delimiter">[</span><a href="../dsl/CompositeKey.scala.html#7375" title="org.squeryl.dsl.CompositeKey">CompositeKey</a><span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">else</span>
      <a href="#65045" title="(c: Any)org.squeryl.dsl.ast.LogicalBoolean">createEqualityExpressionWithLastAccessedFieldReferenceAndConstant</a><span class="delimiter">(</span><a href="#65461" title="Any">c</a><span class="delimiter">)</span>    
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(c: Any)org.squeryl.dsl.ast.LogicalBoolean" id="65045">createEqualityExpressionWithLastAccessedFieldReferenceAndConstant</a><span class="delimiter">(</span><a title="Any" id="65459">c</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <a href="../dsl/ast/ExpressionNode.scala.html#7651" title="org.squeryl.dsl.ast.LogicalBoolean">LogicalBoolean</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.SelectElementReference[_, _]" id="100095">fr</a> = <a href="#65043" title="=&gt; org.squeryl.dsl.ast.SelectElementReference[_, _]">_takeLastAccessedUntypedFieldReference</a>

    <a href="../dsl/ast/ExpressionNode.scala.html#72077" title="org.squeryl.dsl.ast.BinaryOperatorNodeLogicalBoolean" class="keyword">new</a> <a href="../dsl/ast/ExpressionNode.scala.html#7645" title="org.squeryl.dsl.ast.BinaryOperatorNodeLogicalBoolean">BinaryOperatorNodeLogicalBoolean</a><span class="delimiter">(</span>
      <a href="#100095" title="org.squeryl.dsl.ast.SelectElementReference[_, _]">fr</a>,
      <span title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode" class="keyword">new</span> <a href="../dsl/ast/ExpressionNode.scala.html#7659" title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode">InputOnlyConstantExpressionNode</a><span class="delimiter">(</span><a href="#65459" title="Any">c</a><span class="delimiter">)</span>,
      <span title="String(&quot;=&quot;)" class="string">&quot;=&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  /**
   * It is assumed that yield invocation for inspection will never be nested, since
   * a query is completely built (and it's yield inspection is done) before it can
   * be nested, this is unlikely to change, but documenting this assumption was
   * deemed usefull, because this method would stop working (without complaining)
   * if (the assumption) was broken.   
   */

  <span class="keyword">def</span> <a title="(q: org.squeryl.dsl.ast.QueryExpressionNode[_], rsm: org.squeryl.internals.ResultSetMapper, selectClosure: () =&gt; AnyRef)(List[org.squeryl.dsl.ast.SelectElement], AnyRef)" id="65046">determineColumnsUtilizedInYeldInvocation</a><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.QueryExpressionNode[_]" id="92922">q</a>: <a href="../dsl/ast/QueryExpressionNode.scala.html#7699" title="org.squeryl.dsl.ast.QueryExpressionNode[_]">QueryExpressionNode</a><span class="delimiter">[</span>_<span class="delimiter">]</span>, <a title="org.squeryl.internals.ResultSetMapper" id="92923">rsm</a>: <a href="ResultSetMapper.scala.html#8168" title="org.squeryl.internals.ResultSetMapper">ResultSetMapper</a>, <a title="() =&gt; AnyRef" id="92924">selectClosure</a>: <span class="delimiter">(</span><span class="delimiter">)</span>=&gt;AnyRef<span class="delimiter">)</span> = <span class="delimiter">{</span>
    
    <span class="keyword">val</span> <a title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" id="92925">yi</a> = <span title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" class="keyword">new</span> <a href="#65038" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">YieldInspection</a>
      <a href="#65039" title="=&gt; ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="(x$1: org.squeryl.internals.FieldReferenceLinker.YieldInspection)Unit">set</span><span class="delimiter">(</span><a href="#92925" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="(List[org.squeryl.dsl.ast.SelectElement], AnyRef)" id="92926">result</a>:<span title="(List[org.squeryl.dsl.ast.SelectElement], AnyRef)" class="delimiter">(</span>List<span class="delimiter">[</span>SelectElement<span class="delimiter">]</span>,AnyRef<span class="delimiter">)</span> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#92925" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#92266" title="(q: org.squeryl.dsl.ast.QueryExpressionNode[_], rsm: org.squeryl.internals.ResultSetMapper)Unit">turnOn</a><span class="delimiter">(</span><a href="#92922" title="org.squeryl.dsl.ast.QueryExpressionNode[_]">q</a>, <a href="#92923" title="org.squeryl.internals.ResultSetMapper">rsm</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Option[org.squeryl.dsl.ast.SelectElement]" id="92928">prev</a> = <a href="#65031" title="=&gt; Option[org.squeryl.dsl.ast.SelectElement]">_lastAccessedFieldReference</a>
      <span class="keyword">val</span> <a title="AnyRef" id="92929">res0</a> =
        <span class="keyword">try</span> <span class="delimiter">{</span>
          <a href="#92924" title="()AnyRef">selectClosure</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">finally</span> <span class="delimiter">{</span>
          <a href="#65032" title="(se: Option[org.squeryl.dsl.ast.SelectElement])Unit">_lastAccessedFieldReference</a> = <a href="#92928" title="Option[org.squeryl.dsl.ast.SelectElement]">prev</a>
        <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#92929" title="AnyRef">res0</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
        org.squeryl.internals.<a href="Utils.scala.html#8187" title="org.squeryl.internals.Utils.type">Utils</a>.<a href="Utils.scala.html#32420" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="String(&quot;query &quot;)" class="string">&quot;query &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#92922" title="org.squeryl.dsl.ast.QueryExpressionNode[_]">q</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; yielded null&quot;)" class="string">&quot; yielded null&quot;</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="java.util.IdentityHashMap[AnyRef,AnyRef]" id="92930">visitedSet</a> = <span title="java.util.IdentityHashMap[AnyRef,AnyRef]" class="keyword">new</span> java.util.<span title="java.util.IdentityHashMap[AnyRef,AnyRef]">IdentityHashMap</span><span class="delimiter">[</span>AnyRef, AnyRef<span class="delimiter">]</span>
        
      <a href="#65049" title="(visited: java.util.IdentityHashMap[AnyRef,AnyRef], yi: org.squeryl.internals.FieldReferenceLinker.YieldInspection, q: org.squeryl.dsl.ast.QueryExpressionElements, o: AnyRef)Unit">_populateSelectColsRecurse</a><span class="delimiter">(</span><a href="#92930" title="java.util.IdentityHashMap[AnyRef,AnyRef]">visitedSet</a>, <a href="#92925" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>, <a href="#92922" title="org.squeryl.dsl.ast.QueryExpressionNode[_]">q</a>, <a href="#92929" title="AnyRef">res0</a><span class="delimiter">)</span>

      <a href="#92926" title="(List[org.squeryl.dsl.ast.SelectElement], AnyRef)">result</a> = <span title="(_1: List[org.squeryl.dsl.ast.SelectElement], _2: AnyRef)(List[org.squeryl.dsl.ast.SelectElement], AnyRef)" class="delimiter">(</span><a href="#92925" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#92267" title="=&gt; List[org.squeryl.dsl.ast.SelectElement]">outExpressions</a>, <a href="#92929" title="AnyRef">res0</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#65039" title="=&gt; ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>      
    <span class="delimiter">}</span>
    <a href="#92926" title="(List[org.squeryl.dsl.ast.SelectElement], AnyRef)">result</a>
  <span class="delimiter">}</span>
  
  /*
   * The theory here is that setting the var is an atomic operation, so
   * it should be ok to perform without synchronization.
   * Worst case scenario would be that one thread overwrites the map
   * created by a previous thread, but since it's just a cache and the fields
   * can be retrieved at any time, that's ok.
   */
  <span class="keyword">private</span> <span class="keyword">object</span> <a title="org.squeryl.internals.FieldReferenceLinker._declaredFieldCache.type" id="65047">_declaredFieldCache</a> <a href="#65048" title="org.squeryl.internals.FieldReferenceLinker._declaredFieldCache.type" class="delimiter">{</a>
  
	  @volatile <span class="keyword">var</span> <a title="Map[Class[_],Array[java.lang.reflect.Field]]" id="100105">_cache</a>: <span title="Map[Class[_],Array[java.lang.reflect.Field]]">Map</span><span class="delimiter">[</span>Class<span class="delimiter">[</span>_<span class="delimiter">]</span>, Array<span class="delimiter">[</span>Field<span class="delimiter">]</span><span class="delimiter">]</span> =
			  <span title="[A, B](elems: (A, B)*)scala.collection.immutable.Map[A,B]">Map</span><span title="(elems: (Class[_], Array[java.lang.reflect.Field])*)scala.collection.immutable.Map[Class[_],Array[java.lang.reflect.Field]]" class="delimiter">[</span><span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span>, <span title="Array[java.lang.reflect.Field]">Array</span><span class="delimiter">[</span>Field<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
			  
	  <span class="keyword">def</span> <a title="(cls: Class[_])Array[java.lang.reflect.Field]" id="100107">apply</a><span class="delimiter">(</span><a title="Class[_]" id="100133">cls</a>: <span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span> =
	    <a href="#100105" title="=&gt; Map[Class[_],Array[java.lang.reflect.Field]]">_cache</a>.<span title="(key: Class[_])Option[Array[java.lang.reflect.Field]]">get</span><span class="delimiter">(</span><a href="#100133" title="Class[_]">cls</a><span class="delimiter">)</span> <span title="(default: =&gt; Array[java.lang.reflect.Field])Array[java.lang.reflect.Field]">getOrElse</span> <span class="delimiter">{</span>
	      <span class="keyword">val</span> <a title="Array[java.lang.reflect.Field]" id="100154">declaredFields</a> = <a href="#100133" title="Class[_]">cls</a>.<span title="()Array[java.lang.reflect.Field]">getDeclaredFields</span><span class="delimiter">(</span><span class="delimiter">)</span>
	      <a href="#100105" title="(x$1: Map[Class[_],Array[java.lang.reflect.Field]])Unit">_cache</a> <span title="(kv: (Class[_], Array[java.lang.reflect.Field]))scala.collection.immutable.Map[Class[_],Array[java.lang.reflect.Field]]">+=</span> <span class="delimiter">(</span><span title="(_1: Class[_$9], _2: Array[java.lang.reflect.Field])(Class[_$9], Array[java.lang.reflect.Field])" class="delimiter">(</span><a href="#100133" title="Class[_]">cls</a>, <a href="#100154" title="Array[java.lang.reflect.Field]">declaredFields</a><span class="delimiter">)</span><span class="delimiter">)</span>
	      <a href="#100154" title="Array[java.lang.reflect.Field]">declaredFields</a>
	    <span class="delimiter">}</span>
	  
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(visited: java.util.IdentityHashMap[AnyRef,AnyRef], yi: org.squeryl.internals.FieldReferenceLinker.YieldInspection, q: org.squeryl.dsl.ast.QueryExpressionElements, o: AnyRef)Unit" id="65049">_populateSelectColsRecurse</a><span class="delimiter">(</span><a title="java.util.IdentityHashMap[AnyRef,AnyRef]" id="93185">visited</a>: java.util.<span title="java.util.IdentityHashMap[AnyRef,AnyRef]">IdentityHashMap</span><span class="delimiter">[</span>AnyRef, AnyRef<span class="delimiter">]</span> , <a title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" id="93186">yi</a>: <a href="#65038" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">YieldInspection</a>,<a title="org.squeryl.dsl.ast.QueryExpressionElements" id="93187">q</a>: <a href="../dsl/ast/QueryExpressionElements.scala.html#7692" title="org.squeryl.dsl.ast.QueryExpressionElements">QueryExpressionElements</a>, <a title="AnyRef" id="93188">o</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
	  <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#93188" title="AnyRef">o</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#93188" title="AnyRef">o</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="None.type">None</span><span class="delimiter">)</span> <span class="delimiter">{</span>
		  <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#93185" title="java.util.IdentityHashMap[AnyRef,AnyRef]">visited</a>.<span title="(x$1: Any)Boolean">containsKey</span><span class="delimiter">(</span><a href="#93188" title="AnyRef">o</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
			  <span class="keyword">val</span> <a title="Class[_ &lt;: AnyRef]" id="100282">clazz</a> = <a href="#93188" title="AnyRef">o</a>.<span title="()Class[_]">getClass</span>
			  <span class="keyword">val</span> <a title="String" id="100283">clazzName</a> = <a href="#100282" title="Class[_ &lt;: AnyRef]">clazz</a>.<span title="()String">getName</span>
			  //println(&quot;Looking at &quot; + clazzName)
			  <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#100283" title="String">clazzName</a>.<span title="(x$1: String)Boolean">startsWith</span><span class="delimiter">(</span><span title="String(&quot;java.&quot;)" class="string">&quot;java.&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
					  <span title="=&gt; Boolean">!</span><a href="#100283" title="String">clazzName</a>.<span title="(x$1: String)Boolean">startsWith</span><span class="delimiter">(</span><span title="String(&quot;net.sf.cglib.&quot;)" class="string">&quot;net.sf.cglib.&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
					  <span title="=&gt; Boolean">!</span><a href="#100283" title="String">clazzName</a>.<span title="(x$1: String)Boolean">startsWith</span><span class="delimiter">(</span><span title="String(&quot;scala.Enumeration&quot;)" class="string">&quot;scala.Enumeration&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
				  <a href="#93185" title="java.util.IdentityHashMap[AnyRef,AnyRef]">visited</a>.<span title="(x$1: AnyRef, x$2: AnyRef)AnyRef">put</span><span class="delimiter">(</span><a href="#93188" title="AnyRef">o</a>,<a href="#93188" title="AnyRef">o</a><span class="delimiter">)</span>
				  <a href="#65050" title="(yi: org.squeryl.internals.FieldReferenceLinker.YieldInspection, q: org.squeryl.dsl.ast.QueryExpressionElements, sample: AnyRef)Unit">_populateSelectCols</a><span class="delimiter">(</span><a href="#93186" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>, <a href="#93187" title="org.squeryl.dsl.ast.QueryExpressionElements">q</a>, <a href="#93188" title="AnyRef">o</a><span class="delimiter">)</span>
				  <span class="keyword">for</span><span class="delimiter">(</span><a title="java.lang.reflect.Field" id="101023">f</a> &lt;- <a href="#100107" title="(cls: Class[_])Array[java.lang.reflect.Field]">_declaredFieldCache</a><span title="(f: java.lang.reflect.Field =&gt; Unit)Unit" class="delimiter">(</span><a href="#100282" title="Class[_ &lt;: AnyRef]">clazz</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
					  <a href="#101023" title="java.lang.reflect.Field">f</a>.<span title="(x$1: Boolean)Unit">setAccessible</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>;
					  <span class="keyword">val</span> <a title="Object" id="101024">ob</a> = <a href="#101023" title="java.lang.reflect.Field">f</a>.<span title="(x$1: Any)Object">get</span><span class="delimiter">(</span><a href="#93188" title="AnyRef">o</a><span class="delimiter">)</span>
					  <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#101023" title="java.lang.reflect.Field">f</a>.<span title="()String">getName</span>.<span title="(x$1: String)Boolean">startsWith</span><span class="delimiter">(</span><span title="String(&quot;CGLIB$&quot;)" class="string">&quot;CGLIB$&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
					        <span title="=&gt; Boolean">!</span><a href="#101023" title="java.lang.reflect.Field">f</a>.<span title="()Class[_]">getType</span>.<span title="()String">getName</span>.<span title="(x$1: String)Boolean">startsWith</span><span class="delimiter">(</span><span title="String(&quot;scala.Function&quot;)" class="string">&quot;scala.Function&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
					        <span title="=&gt; Boolean">!</span><a href="FieldMetaData.scala.html#8088" title="org.squeryl.internals.FieldMetaData.type">FieldMetaData</a>.<a href="FieldMetaData.scala.html#46840" title="=&gt; org.squeryl.internals.FieldMetaDataFactory">factory</a>.<a href="FieldMetaData.scala.html#46850" title="(o: AnyRef, f: java.lang.reflect.Field)Boolean">hideFromYieldInspection</a><span class="delimiter">(</span><a href="#93188" title="AnyRef">o</a>, <a href="#101023" title="java.lang.reflect.Field">f</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
						  <a href="#65049" title="(visited: java.util.IdentityHashMap[AnyRef,AnyRef], yi: org.squeryl.internals.FieldReferenceLinker.YieldInspection, q: org.squeryl.dsl.ast.QueryExpressionElements, o: AnyRef)Unit">_populateSelectColsRecurse</a><span class="delimiter">(</span><a href="#93185" title="java.util.IdentityHashMap[AnyRef,AnyRef]">visited</a>, <a href="#93186" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>, <a href="#93187" title="org.squeryl.dsl.ast.QueryExpressionElements">q</a>, <a href="#101024" title="Object">ob</a><span class="delimiter">)</span>
					  <span class="delimiter">}</span>
				  <span class="delimiter">}</span>
			  <span class="delimiter">}</span>
		  <span class="delimiter">}</span>
	  <span class="delimiter">}</span>
  
  
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(yi: org.squeryl.internals.FieldReferenceLinker.YieldInspection, q: org.squeryl.dsl.ast.QueryExpressionElements, sample: AnyRef)Unit" id="65050">_populateSelectCols</a><span class="delimiter">(</span><a title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" id="100299">yi</a>: <a href="#65038" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">YieldInspection</a>,<a title="org.squeryl.dsl.ast.QueryExpressionElements" id="100300">q</a>: <a href="../dsl/ast/QueryExpressionElements.scala.html#7692" title="org.squeryl.dsl.ast.QueryExpressionElements">QueryExpressionElements</a>, <a title="AnyRef" id="100301">sample</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Option[org.squeryl.dsl.ast.QueryableExpressionNode]" id="101031">owner</a> = <a href="#65052" title="(sample: AnyRef, q: org.squeryl.dsl.ast.QueryExpressionElements)Option[org.squeryl.dsl.ast.QueryableExpressionNode]">_findQENThatOwns</a><span class="delimiter">(</span><a href="#100301" title="AnyRef">sample</a>, <a href="#100300" title="org.squeryl.dsl.ast.QueryExpressionElements">q</a><span class="delimiter">)</span>
    <a href="#101031" title="Option[org.squeryl.dsl.ast.QueryableExpressionNode]">owner</a> <span title="(f: org.squeryl.dsl.ast.QueryableExpressionNode =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="org.squeryl.dsl.ast.QueryableExpressionNode" id="101038">o</a> =&gt;
      <span class="keyword">for</span><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.SelectElement" id="101057">e</a> &lt;- <a href="#101038" title="org.squeryl.dsl.ast.QueryableExpressionNode">o</a>.<a href="../dsl/ast/ExpressionNode.scala.html#64980" title="(forScope: org.squeryl.dsl.ast.QueryExpressionElements)Iterable[org.squeryl.dsl.ast.SelectElement]">getOrCreateAllSelectElements</a><span title="(f: org.squeryl.dsl.ast.SelectElement =&gt; Unit)Unit" class="delimiter">(</span><a href="#100300" title="org.squeryl.dsl.ast.QueryExpressionElements">q</a><span class="delimiter">)</span><span class="delimiter">)</span>
    	  <a href="#100299" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#92258" title="(e: org.squeryl.dsl.ast.SelectElement)Unit">addSelectElement</a><span class="delimiter">(</span><a href="#101057" title="org.squeryl.dsl.ast.SelectElement">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(s: AnyRef)Option[org.squeryl.dsl.ast.QueryableExpressionNode]" id="65051">findOwnerOfSample</a><span class="delimiter">(</span><a title="AnyRef" id="101060">s</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <span title="Option[org.squeryl.dsl.ast.QueryableExpressionNode]">Option</span><span class="delimiter">[</span>QueryableExpressionNode<span class="delimiter">]</span> =
// TODO: could we enforce that Query[AnyVal] are not nested in some other way ?   
//    if(s.isInstanceOf[AnyVal])
//      org.squeryl.internals.Utils.throwError(&quot;A query that returns a AnyVal cannot be nested &quot; + Utils.failSafeString(FieldReferenceLinker.inspectedQueryExpressionNode.toString))
//    else
     <a href="#65052" title="(sample: AnyRef, q: org.squeryl.dsl.ast.QueryExpressionElements)Option[org.squeryl.dsl.ast.QueryableExpressionNode]">_findQENThatOwns</a><span class="delimiter">(</span><a href="#101060" title="AnyRef">s</a>, <a href="#8099" title="org.squeryl.internals.FieldReferenceLinker.type">FieldReferenceLinker</a>.<a href="#65026" title="=&gt; org.squeryl.dsl.ast.QueryExpressionNode[_]">inspectedQueryExpressionNode</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sample: AnyRef, q: org.squeryl.dsl.ast.QueryExpressionElements)Option[org.squeryl.dsl.ast.QueryableExpressionNode]" id="65052">_findQENThatOwns</a><span class="delimiter">(</span><a title="AnyRef" id="101032">sample</a>: <span title="AnyRef">AnyRef</span>, <a title="org.squeryl.dsl.ast.QueryExpressionElements" id="101033">q</a>: <a href="../dsl/ast/QueryExpressionElements.scala.html#7692" title="org.squeryl.dsl.ast.QueryExpressionElements">QueryExpressionElements</a><span class="delimiter">)</span>: <span title="Option[org.squeryl.dsl.ast.QueryableExpressionNode]">Option</span><span class="delimiter">[</span>QueryableExpressionNode<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <a href="#101033" title="org.squeryl.dsl.ast.QueryExpressionElements">q</a>.<a href="../dsl/ast/ExpressionNode.scala.html#31651" title="[T](implicit manifest: Manifest[T])Iterable[T]">filterDescendantsOfType</a><span title="(implicit manifest: Manifest[org.squeryl.dsl.ast.QueryableExpressionNode])Iterable[org.squeryl.dsl.ast.QueryableExpressionNode]" class="delimiter">[</span><a href="../dsl/ast/ExpressionNode.scala.html#7677" title="org.squeryl.dsl.ast.QueryableExpressionNode">QueryableExpressionNode</a><span class="delimiter">]</span>.<span title="(p: org.squeryl.dsl.ast.QueryableExpressionNode =&gt; Boolean)Option[org.squeryl.dsl.ast.QueryableExpressionNode]">find</span><span class="delimiter">(</span><a href="#101086" title="org.squeryl.dsl.ast.QueryableExpressionNode">_</a>.<a href="../dsl/ast/ExpressionNode.scala.html#64977" title="(aSample: AnyRef)Boolean">owns</a><span class="delimiter">(</span><a href="#101032" title="AnyRef">sample</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(v: org.squeryl.dsl.ast.ViewExpressionNode[_])net.sf.cglib.proxy.Callback" id="65053">createCallBack</a><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.ViewExpressionNode[_]" id="65061">v</a>: <a href="../dsl/ast/ViewExpressionNode.scala.html#7730" title="org.squeryl.dsl.ast.ViewExpressionNode[_]">ViewExpressionNode</a><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="net.sf.cglib.proxy.Callback">Callback</span> =
    <span title="org.squeryl.internals.FieldReferenceLinker.PosoPropertyAccessInterceptor" class="keyword">new</span> <a href="#65054" title="org.squeryl.internals.FieldReferenceLinker.PosoPropertyAccessInterceptor">PosoPropertyAccessInterceptor</a><span class="delimiter">(</span><a href="#65061" title="org.squeryl.dsl.ast.ViewExpressionNode[_]">v</a><span class="delimiter">)</span>
  
  <span class="keyword">private</span> <span class="keyword">class</span> <a title="class PosoPropertyAccessInterceptor extends Object with net.sf.cglib.proxy.MethodInterceptor" id="65054">PosoPropertyAccessInterceptor</a><a href="#65054" title="org.squeryl.internals.FieldReferenceLinker.PosoPropertyAccessInterceptor" class="delimiter">(</a><span class="keyword">val</span> <a title="org.squeryl.dsl.ast.ViewExpressionNode[_]" id="101100">viewExpressionNode</a>: <a href="../dsl/ast/ViewExpressionNode.scala.html#7730" title="org.squeryl.dsl.ast.ViewExpressionNode[_]">ViewExpressionNode</a><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="net.sf.cglib.proxy.MethodInterceptor">MethodInterceptor</span> <span class="delimiter">{</span>

      <span class="keyword">def</span> <a title="(m: java.lang.reflect.Method)Option[org.squeryl.internals.FieldMetaData]" id="101097">fmd4Method</a><span class="delimiter">(</span><a title="java.lang.reflect.Method" id="101113">m</a>: <span title="java.lang.reflect.Method">Method</span><span class="delimiter">)</span> =
        <a href="#101100" title="=&gt; org.squeryl.dsl.ast.ViewExpressionNode[_]">viewExpressionNode</a>.<a href="../dsl/ast/ViewExpressionNode.scala.html#64983" title="=&gt; org.squeryl.View[_$11]">view</a>.<a href="../View.scala.html#37965" title="(name: String)Option[org.squeryl.internals.FieldMetaData]">findFieldMetaDataForProperty</a><span class="delimiter">(</span><a href="#101113" title="java.lang.reflect.Method">m</a>.<span title="()String">getName</span><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(o: Object, m: java.lang.reflect.Method, args: Array[Object], proxy: net.sf.cglib.proxy.MethodProxy)Object" id="101098">intercept</a><span class="delimiter">(</span><a title="Object" id="101117">o</a>: <span title="Object">Object</span>, <a title="java.lang.reflect.Method" id="101118">m</a>: <span title="java.lang.reflect.Method">Method</span>, <a title="Array[Object]" id="101119">args</a>: <span title="Array[Object]">Array</span><span class="delimiter">[</span>Object<span class="delimiter">]</span>, <a title="net.sf.cglib.proxy.MethodProxy" id="101120">proxy</a>: <span title="net.sf.cglib.proxy.MethodProxy">MethodProxy</span><span class="delimiter">)</span>: <span title="Object">Object</span> = <span class="delimiter">{</span>

        <span class="keyword">val</span> <a title="Option[org.squeryl.internals.FieldMetaData]" id="101377">fmd</a> = <a href="#101097" title="(m: java.lang.reflect.Method)Option[org.squeryl.internals.FieldMetaData]">fmd4Method</a><span class="delimiter">(</span><a href="#101118" title="java.lang.reflect.Method">m</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" id="101378">yi</a> = <span title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" class="keyword">if</span> <span class="delimiter">(</span><a href="#65025" title="=&gt; Boolean">isYieldInspectionMode</a><span class="delimiter">)</span> <a href="#65039" title="=&gt; ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="()org.squeryl.internals.FieldReferenceLinker.YieldInspection">get</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
        <span class="keyword">val</span> <a title="Boolean" id="101379">isComposite</a> =
          classOf<span title="Class[org.squeryl.dsl.CompositeKey](classOf[org.squeryl.dsl.CompositeKey])" class="delimiter">[</span>CompositeKey<span class="delimiter">]</span>.<span title="(x$1: Class[_])Boolean">isAssignableFrom</span><span class="delimiter">(</span><a href="#101118" title="java.lang.reflect.Method">m</a>.<span title="()Class[_]">getReturnType</span><span class="delimiter">)</span>

        <span class="keyword">try</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#101377" title="Option[org.squeryl.internals.FieldMetaData]">fmd</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="None.type">None</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#101378" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
            <a href="#101378" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#92264" title="=&gt; Unit">incrementReentranceDepth</a>

          <a href="#101099" title="(o: Object, m: java.lang.reflect.Method, args: Array[Object], proxy: net.sf.cglib.proxy.MethodProxy, fmd: Option[org.squeryl.internals.FieldMetaData], yi: org.squeryl.internals.FieldReferenceLinker.YieldInspection, isComposite: Boolean)Object">_intercept</a><span class="delimiter">(</span><a href="#101117" title="Object">o</a>, <a href="#101118" title="java.lang.reflect.Method">m</a>, <a href="#101119" title="Array[Object]">args</a>, <a href="#101120" title="net.sf.cglib.proxy.MethodProxy">proxy</a>, <a href="#101377" title="Option[org.squeryl.internals.FieldMetaData]">fmd</a>, <a href="#101378" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>, <a href="#101379" title="Boolean">isComposite</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">finally</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#101377" title="Option[org.squeryl.internals.FieldMetaData]">fmd</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="None.type">None</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#101378" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
            <a href="#101378" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#92265" title="=&gt; Unit">decrementReentranceDepth</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">private</span> <span class="keyword">def</span> <a title="(o: Object, m: java.lang.reflect.Method, args: Array[Object], proxy: net.sf.cglib.proxy.MethodProxy, fmd: Option[org.squeryl.internals.FieldMetaData], yi: org.squeryl.internals.FieldReferenceLinker.YieldInspection, isComposite: Boolean)Object" id="101099">_intercept</a><span class="delimiter">(</span><a title="Object" id="101390">o</a>: <span title="Object">Object</span>, <a title="java.lang.reflect.Method" id="101391">m</a>: <span title="java.lang.reflect.Method">Method</span>, <a title="Array[Object]" id="101392">args</a>: <span title="Array[Object]">Array</span><span class="delimiter">[</span>Object<span class="delimiter">]</span>, <a title="net.sf.cglib.proxy.MethodProxy" id="101393">proxy</a>: <span title="net.sf.cglib.proxy.MethodProxy">MethodProxy</span>, <a title="Option[org.squeryl.internals.FieldMetaData]" id="101394">fmd</a>: <span title="Option[org.squeryl.internals.FieldMetaData]">Option</span><span class="delimiter">[</span>FieldMetaData<span class="delimiter">]</span>, <a title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" id="101395">yi</a>: <a href="#65038" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">YieldInspection</a>, <a title="Boolean" id="101396">isComposite</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Object">Object</span> = <span class="delimiter">{</span>

        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#101396" title="Boolean">isComposite</a><span class="delimiter">)</span>
          <a href="#65033" title="=&gt; ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]">_compositeKeyMembers</a>.<span title="(x$1: Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]])Unit">set</span><span class="delimiter">(</span><span title="(x: scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement])Some[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]">Some</span><span class="delimiter">(</span><span title="()scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]">ArrayBuffer</span><span class="delimiter">[</span>SelectElement<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">var</span> <a title="Object" id="101406">res</a> = <a href="#101393" title="net.sf.cglib.proxy.MethodProxy">proxy</a>.<span title="(x$1: Any, x$2: Array[Object])Object">invokeSuper</span><span class="delimiter">(</span><a href="#101390" title="Object">o</a>, <a href="#101392" title="Array[Object]">args</a><span class="delimiter">)</span>;

        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#101396" title="Boolean">isComposite</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="org.squeryl.dsl.CompositeKey" id="101420">ck</a> = <a href="#101406" title="Object">res</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.CompositeKey" class="delimiter">[</span><a href="../dsl/CompositeKey.scala.html#7375" title="org.squeryl.dsl.CompositeKey">CompositeKey</a><span class="delimiter">]</span>
          <a href="#101420" title="org.squeryl.dsl.CompositeKey">ck</a>.<a href="../dsl/CompositeKey.scala.html#33395" title="(x$1: Option[Seq[org.squeryl.dsl.ast.SelectElementReference[_, _]]])Unit">_members</a> = <span title="(x: Seq[org.squeryl.dsl.ast.SelectElementReference[_, _]])Some[Seq[org.squeryl.dsl.ast.SelectElementReference[_, _]]]">Some</span><span class="delimiter">(</span><a href="#65033" title="=&gt; ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]">_compositeKeyMembers</a>.<span title="()Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]">get</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]">get</span>.<span title="(f: org.squeryl.dsl.ast.SelectElement =&gt; org.squeryl.dsl.ast.SelectElementReference[Any,Any])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement],org.squeryl.dsl.ast.SelectElementReference[Any,Any],Seq[org.squeryl.dsl.ast.SelectElementReference[_, _]]])Seq[org.squeryl.dsl.ast.SelectElementReference[_, _]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,org.squeryl.dsl.ast.SelectElementReference[Any,Any],scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElementReference[Any,Any]]]" class="delimiter">(</span><span title="org.squeryl.dsl.ast.SelectElementReference[Any,Any]" class="keyword">new</span> <a href="../dsl/ast/SelectElement.scala.html#7714" title="org.squeryl.dsl.ast.SelectElementReference[Any,Any]">SelectElementReference</a><span class="delimiter">[</span>Any,Any<span class="delimiter">]</span><span class="delimiter">(</span><a href="#101449" title="org.squeryl.dsl.ast.SelectElement">_</a>,<a href="ResultSetMapper.scala.html#8164" title="org.squeryl.internals.NoOpOutMapper.type">NoOpOutMapper</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#101420" title="org.squeryl.dsl.CompositeKey">ck</a>.<a href="../dsl/CompositeKey.scala.html#33398" title="(x$1: Option[String])Unit">_propertyName</a> = <span title="(x: String)Some[String]">Some</span><span class="delimiter">(</span><a href="#101391" title="java.lang.reflect.Method">m</a>.<span title="()String">getName</span><span class="delimiter">)</span>
          <a href="#65033" title="=&gt; ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]">_compositeKeyMembers</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#101391" title="java.lang.reflect.Method">m</a>.<span title="()String">getName</span>.<span title="(x$1: Any)Boolean">equals</span><span class="delimiter">(</span><span title="String(&quot;toString&quot;)" class="string">&quot;toString&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#101391" title="java.lang.reflect.Method">m</a>.<span title="()Array[Class[_]]">getParameterTypes</span>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
          <a href="#101406" title="Object">res</a> = <span title="String(&quot;sample:&quot;)" class="string">&quot;sample:&quot;</span><span title="(x$1: Any)String">+</span><a href="#101100" title="=&gt; org.squeryl.dsl.ast.ViewExpressionNode[_]">viewExpressionNode</a>.<a href="../dsl/ast/ViewExpressionNode.scala.html#64983" title="=&gt; org.squeryl.View[_$11]">view</a>.<a href="../View.scala.html#37961" title="=&gt; String">name</a><span title="(x$1: Any)String">+</span><span title="String(&quot;[&quot;)" class="string">&quot;[&quot;</span><span title="(x$1: Any)String">+</span><span title="Integer.type">Integer</span>.<span title="(x$1: Int)String">toHexString</span><span class="delimiter">(</span><span title="System.type">System</span>.<span title="(x$1: Any)Int">identityHashCode</span><span class="delimiter">(</span><a href="#101390" title="Object">o</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot;]&quot;)" class="string">&quot;]&quot;</span>

        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#101394" title="Option[org.squeryl.internals.FieldMetaData]">fmd</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="None.type">None</span><span class="delimiter">)</span> <span class="delimiter">{</span>

          <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#101395" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>  <a href="#101395" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#92263" title="=&gt; Int">reentranceDepth</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
            <a href="#101395" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#92258" title="(e: org.squeryl.dsl.ast.SelectElement)Unit">addSelectElement</a><span class="delimiter">(</span><a href="#101100" title="=&gt; org.squeryl.dsl.ast.ViewExpressionNode[_]">viewExpressionNode</a>.<a href="../dsl/ast/ViewExpressionNode.scala.html#64992" title="(fmd: org.squeryl.internals.FieldMetaData, forScope: org.squeryl.dsl.ast.QueryExpressionElements)org.squeryl.dsl.ast.SelectElement">getOrCreateSelectElement</a><span class="delimiter">(</span><a href="#101394" title="Option[org.squeryl.internals.FieldMetaData]">fmd</a>.<span title="=&gt; org.squeryl.internals.FieldMetaData">get</span>, <a href="#101395" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#92249" title="=&gt; org.squeryl.dsl.ast.QueryExpressionNode[_]">queryExpressionNode</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#65033" title="=&gt; ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]">_compositeKeyMembers</a>.<span title="()Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]">get</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#65033" title="=&gt; ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]">_compositeKeyMembers</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
            <a href="#65032" title="(se: Option[org.squeryl.dsl.ast.SelectElement])Unit">_lastAccessedFieldReference</a> = <span title="(x: org.squeryl.dsl.ast.SelectElement)Some[org.squeryl.dsl.ast.SelectElement]">Some</span><span class="delimiter">(</span><a href="#101100" title="=&gt; org.squeryl.dsl.ast.ViewExpressionNode[_]">viewExpressionNode</a>.<a href="../dsl/ast/ViewExpressionNode.scala.html#64991" title="(fmd: org.squeryl.internals.FieldMetaData)org.squeryl.dsl.ast.SelectElement">getOrCreateSelectElement</a><span class="delimiter">(</span><a href="#101394" title="Option[org.squeryl.internals.FieldMetaData]">fmd</a>.<span title="=&gt; org.squeryl.internals.FieldMetaData">get</span><span class="delimiter">)</span><span class="delimiter">)</span>;
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <a href="#65033" title="=&gt; ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]">_compositeKeyMembers</a>.<span title="()Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]">get</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]">get</span>.<span title="(elems: org.squeryl.dsl.ast.SelectElement*)Unit">append</span><span class="delimiter">(</span><a href="#101100" title="=&gt; org.squeryl.dsl.ast.ViewExpressionNode[_]">viewExpressionNode</a>.<a href="../dsl/ast/ViewExpressionNode.scala.html#64991" title="(fmd: org.squeryl.internals.FieldMetaData)org.squeryl.dsl.ast.SelectElement">getOrCreateSelectElement</a><span class="delimiter">(</span><a href="#101394" title="Option[org.squeryl.internals.FieldMetaData]">fmd</a>.<span title="=&gt; org.squeryl.internals.FieldMetaData">get</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <a href="#101406" title="Object">res</a>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>