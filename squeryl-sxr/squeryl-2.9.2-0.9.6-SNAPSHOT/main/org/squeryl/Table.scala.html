<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>main/org/squeryl/Table.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/*******************************************************************************
 * Copyright 2010 Maxime LÃ©vesque
 * 
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ***************************************************************************** */
<span class="keyword">package</span> org.squeryl;

<span class="keyword">import</span> dsl.ast._
<span class="keyword">import</span> dsl.<span class="delimiter">{</span>CompositeKey, QueryDsl<span class="delimiter">}</span>
<span class="keyword">import</span> internals._
<span class="keyword">import</span> java.sql.<span class="delimiter">{</span>Statement<span class="delimiter">}</span>
<span class="keyword">import</span> logging.StackMarker
<span class="keyword">import</span> scala.reflect.Manifest
<span class="keyword">import</span> collection.mutable.ArrayBuffer
<span class="keyword">import</span> javax.swing.<span title="javax.swing.UIDefaults.type">UIDefaults</span>.LazyValue

//private [squeryl] object DummySchema extends Schema

<span class="keyword">class</span> <a title="class Table[T] extends org.squeryl.View[T]" id="7209">Table</a><span class="delimiter">[</span><a title="" id="7210">T</a><span class="delimiter">]</span> <a href="#7209" title="org.squeryl.Table[T]" class="keyword">private</a> <span class="delimiter">[</span>squeryl<span class="delimiter">]</span> <span class="delimiter">(</span><a title="String" id="52791">n</a>: <span title="String">String</span>, <a title="Class[T]" id="52792">c</a>: <span title="Class[T]">Class</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="org.squeryl.Schema" id="52793">schema</a>: <a href="Schema.scala.html#7184" title="org.squeryl.Schema">Schema</a>, <a title="Option[String]" id="52794">_prefix</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="Option[org.squeryl.KeyedEntityDef[T, _]]" id="52795">ked</a>: <span title="Option[org.squeryl.KeyedEntityDef[T, _]]">Option</span><span class="delimiter">[</span>KeyedEntityDef<span class="delimiter">[</span>T,_<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="View.scala.html#7217" title="org.squeryl.View[T]">View</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">(</span><a href="#52791" title="String">n</a>, <a href="#52792" title="Class[T]">c</a>, <a href="#52793" title="org.squeryl.Schema">schema</a>, <a href="#52794" title="Option[String]">_prefix</a>, <a href="#52795" title="Option[org.squeryl.KeyedEntityDef[T, _]]">ked</a><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; org.squeryl.internals.DatabaseAdapter" id="37996">_dbAdapter</a> = <a href="Session.scala.html#7193" title="org.squeryl.Session.type">Session</a>.<a href="Session.scala.html#38067" title="=&gt; org.squeryl.Session">currentSession</a>.<a href="Session.scala.html#38076" title="=&gt; org.squeryl.internals.DatabaseAdapter">databaseAdapter</a>

  /**
   * @throws SquerylSQLException When a database error occurs or the insert
   * does not result in 1 row
   */
  <span class="keyword">def</span> <a title="(t: T)T" id="37997">insert</a><span class="delimiter">(</span><a title="T" id="57852">t</a>: <a href="#7210" title="T">T</a><span class="delimiter">)</span>: <a href="#7210" title="T">T</a> = <a href="logging/StatisticsListener.scala.html#8219" title="org.squeryl.logging.StackMarker.type">StackMarker</a>.<a href="logging/StatisticsListener.scala.html#62596" title="(a: =&gt; T)T">lastSquerylStackFrame</a> <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="AnyRef" id="62603">o</a> = <a href="View.scala.html#37959" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56992" title="(a: AnyRef)AnyRef">beforeInsert</a><span class="delimiter">(</span><a href="#57852" title="T">t</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.squeryl.Session" id="62604">sess</a> = <a href="Session.scala.html#7193" title="org.squeryl.Session.type">Session</a>.<a href="Session.scala.html#38067" title="=&gt; org.squeryl.Session">currentSession</a>
    <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="62605">sw</a> = <a href="internals/StatementWriter.scala.html#41655" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#8175" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#37996" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a><span class="delimiter">)</span>
    <a href="#37996" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#38159" title="(o: T, t: org.squeryl.Table[T], sw: org.squeryl.internals.StatementWriter)Unit">writeInsert</a><span class="delimiter">(</span><a href="#62603" title="AnyRef">o</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#7210" title="T">T</a><span class="delimiter">]</span>, <a href="#7209" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#62605" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="java.sql.PreparedStatement" id="62606">st</a> =
      <a href="#424047" title="(_1: Boolean, _2: Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]])(Boolean, Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]])" class="delimiter">(</a><a href="#37996" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#38137" title="=&gt; Boolean">supportsAutoIncrementInColumnDeclaration</a>, <a href="View.scala.html#37966" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#38378" title="=&gt; Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]]">primaryKey</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span class="delimiter">(</span><a href="#424047" title="Boolean" id="424058" class="keyword">true</a>, <a href="#424047" title="Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]]" id="63037">a</a>:Any<span class="delimiter">)</span> =&gt; <a href="#62604" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#38074" title="=&gt; java.sql.Connection">connection</a>.<span title="(x$1: String, x$2: Int)java.sql.PreparedStatement">prepareStatement</span><a href="#424064" title="(x: java.sql.PreparedStatement)java.sql.PreparedStatement" class="delimiter">(</a><a href="#62605" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#41664" title="=&gt; String">statement</a>, Statement.<span title="Int(1)">RETURN_GENERATED_KEYS</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span class="delimiter">(</span><a href="#424047" title="Boolean" id="424060" class="keyword">false</a>, Some<a href="#424047" title="Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]]" id="424056" class="delimiter">(</a>Left<a href="#424056" title="Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]" id="424057" class="delimiter">(</a><a href="#424057" title="org.squeryl.internals.FieldMetaData" id="63215">pk</a>:FieldMetaData<span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#424064" title="(x: java.sql.PreparedStatement)java.sql.PreparedStatement" class="delimiter">{</a>
          <span class="keyword">val</span> <a title="Array[String]" id="63216">autoIncPk</a> = <span title="Array[String]" class="keyword">new</span> <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <a href="#63216" title="(i: Int, x: String)Unit">autoIncPk</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> = pk.<a href="internals/FieldMetaData.scala.html#49738" title="=&gt; String">columnName</a>
          <a href="#62604" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#38074" title="=&gt; java.sql.Connection">connection</a>.<span title="(x$1: String, x$2: Array[String])java.sql.PreparedStatement">prepareStatement</span><span class="delimiter">(</span><a href="#62605" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#41664" title="=&gt; String">statement</a>, <a href="#63216" title="Array[String]">autoIncPk</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <a href="#424047" title="java.sql.PreparedStatement" id="424062">a</a>:Any =&gt; <a href="#62604" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#38074" title="=&gt; java.sql.Connection">connection</a>.<span title="(x$1: String)java.sql.PreparedStatement">prepareStatement</span><a href="#424064" title="(x: java.sql.PreparedStatement)java.sql.PreparedStatement" class="delimiter">(</a><a href="#62605" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#41664" title="=&gt; String">statement</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>        

    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="63226">cnt</a> = <a href="#37996" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#38157" title="(s: org.squeryl.Session, sw: org.squeryl.internals.StatementWriter, ps: java.sql.PreparedStatement)Int">executeUpdateForInsert</a><span class="delimiter">(</span><a href="#62604" title="org.squeryl.Session">sess</a>, <a href="#62605" title="org.squeryl.internals.StatementWriter">sw</a>, <a href="#62606" title="java.sql.PreparedStatement">st</a><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#63226" title="Int">cnt</a> <span title="(x: Int)Boolean">!=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">throw</span> <a href="KeyedEntity.scala.html#15660" title="(message: String)org.squeryl.SquerylSQLException">SquerylSQLException</a><span class="delimiter">(</span><span title="String(&quot;failed to insert.  Expected 1 row, got &quot;)" class="string">&quot;failed to insert.  Expected 1 row, got &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#63226" title="Int">cnt</a><span class="delimiter">)</span>

      <a href="View.scala.html#37966" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#38378" title="=&gt; Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]]">primaryKey</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Some<a href="#424076" title="Unit" id="424078" class="delimiter">(</a>Left<a href="#424078" title="Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]" id="424079" class="delimiter">(</a><a href="#424079" title="org.squeryl.internals.FieldMetaData" id="63258">pk</a>:FieldMetaData<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#424083" title="(x: Unit)Unit" class="keyword">if</a><span class="delimiter">(</span>pk.<a href="internals/FieldMetaData.scala.html#49746" title="=&gt; Boolean">isAutoIncremented</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="java.sql.ResultSet" id="63267">rs</a> = <a href="#62606" title="java.sql.PreparedStatement">st</a>.<span title="()java.sql.ResultSet">getGeneratedKeys</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#63267" title="java.sql.ResultSet">rs</a>.<span title="()Boolean">next</span>,
              <span class="string">&quot;getGeneratedKeys returned no rows for the auto incremented\n&quot;</span><span title="String(&quot;getGeneratedKeys returned no rows for the auto incremented\n primary key of table \'&quot;)">+</span>
              <span class="string">&quot; primary key of table '&quot;</span> <span title="(x$1: Any)String">+</span> <a href="View.scala.html#37961" title="=&gt; String">name</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\' JDBC3 feature might not be supported, \n or&quot;)" class="string">&quot;' JDBC3 feature might not be supported, \n or&quot;</span><span title="(x$1: Any)String">+</span>
              <span title="String(&quot; column might not be defined as auto increment&quot;)" class="string">&quot; column might not be defined as auto increment&quot;</span><span class="delimiter">)</span>
            pk.<a href="internals/FieldMetaData.scala.html#49751" title="(target: AnyRef, rs: java.sql.ResultSet, index: Int)Unit">setFromResultSet</a><span class="delimiter">(</span><a href="#62603" title="AnyRef">o</a>, <a href="#63267" title="java.sql.ResultSet">rs</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">finally</span> <span class="delimiter">{</span>
            <a href="#63267" title="java.sql.ResultSet">rs</a>.<span title="()Unit">close</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <a href="#424076" title="Unit" id="424081">a</a>:Any =&gt;<a href="#424083" title="(x: Unit)Unit" class="delimiter">{</a><span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#62606" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">close</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="T" id="62607">r</a> = <a href="View.scala.html#37959" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56993" title="(a: AnyRef)AnyRef">afterInsert</a><span class="delimiter">(</span><a href="#62603" title="AnyRef">o</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#7210" title="T">T</a><span class="delimiter">]</span>

    <a href="View.scala.html#37971" title="(v1: T)Unit">_setPersisted</a><span class="delimiter">(</span><a href="#62607" title="T">r</a><span class="delimiter">)</span>

    <a href="#62607" title="T">r</a>
  <span class="delimiter">}</span>

//  def insert(t: Query[T]) = org.squeryl.internals.Utils.throwError(&quot;not implemented&quot;)

  <span class="keyword">def</span> <a title="(e: Iterable[T])Unit" id="37998">insert</a><span class="delimiter">(</span><a title="Iterable[T]" id="57850">e</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> =
    <a href="#37999" title="(e: Iterable[T], fmdCallback: T =&gt; Iterable[org.squeryl.internals.FieldMetaData], isInsert: Boolean, checkOCC: Boolean)Unit">_batchedUpdateOrInsert</a><span class="delimiter">(</span><a href="#57850" title="Iterable[T]">e</a>, <a title="T" id="63434">t</a> =&gt; <a href="View.scala.html#37966" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#38374" title="=&gt; Iterable[org.squeryl.internals.FieldMetaData]">fieldsMetaData</a>.<span title="(p: org.squeryl.internals.FieldMetaData =&gt; Boolean)Iterable[org.squeryl.internals.FieldMetaData]">filter</span><span class="delimiter">(</span><a title="org.squeryl.internals.FieldMetaData" id="63440">fmd</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#63440" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#49746" title="=&gt; Boolean">isAutoIncremented</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#63440" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#49747" title="=&gt; Boolean">isInsertable</a><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

  /**
   * isInsert if statement is insert otherwise update
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(e: Iterable[T], fmdCallback: T =&gt; Iterable[org.squeryl.internals.FieldMetaData], isInsert: Boolean, checkOCC: Boolean)Unit" id="37999">_batchedUpdateOrInsert</a><span class="delimiter">(</span><a title="Iterable[T]" id="63429">e</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="T =&gt; Iterable[org.squeryl.internals.FieldMetaData]" id="63430">fmdCallback</a>: T =&gt; Iterable<span class="delimiter">[</span>FieldMetaData<span class="delimiter">]</span>, <a title="Boolean" id="63431">isInsert</a>: <span title="Boolean">Boolean</span>, <a title="Boolean" id="63432">checkOCC</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> = <span class="delimiter">{</span>
    
    <span class="keyword">val</span> <a title="Iterator[T]" id="63449">it</a> = <a href="#63429" title="Iterable[T]">e</a>.<span title="=&gt; Iterator[T]">iterator</span>

    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#63449" title="Iterator[T]">it</a>.<span title="=&gt; Boolean">hasNext</span><span class="delimiter">)</span> <span class="delimiter">{</span>

      <span class="keyword">val</span> <a title="T" id="63450">e0</a> = <a href="#63449" title="Iterator[T]">it</a>.<span title="()T">next</span>
      <span class="keyword">val</span> <a title="Iterable[org.squeryl.internals.FieldMetaData]" id="63451">fmds</a> = <a href="#63430" title="(v1: T)Iterable[org.squeryl.internals.FieldMetaData]">fmdCallback</a><span class="delimiter">(</span><a href="#63450" title="T">e0</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="org.squeryl.Session" id="63452">sess</a> = <a href="Session.scala.html#7193" title="org.squeryl.Session.type">Session</a>.<a href="Session.scala.html#38067" title="=&gt; org.squeryl.Session">currentSession</a>
      <span class="keyword">val</span> <a title="org.squeryl.internals.DatabaseAdapter" id="63453">dba</a> = <a href="#37996" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>
      <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="63454">sw</a> = <a href="internals/StatementWriter.scala.html#41655" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#8175" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#63453" title="org.squeryl.internals.DatabaseAdapter">dba</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[AnyRef]" id="63455">forAfterUpdateOrInsert</a> = <span title="()scala.collection.mutable.ArrayBuffer[AnyRef]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[AnyRef]">ArrayBuffer</span><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#63431" title="Boolean">isInsert</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="AnyRef" id="63462">z</a> = <a href="View.scala.html#37959" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56992" title="(a: AnyRef)AnyRef">beforeInsert</a><span class="delimiter">(</span><a href="#63450" title="T">e0</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
        <a href="#63455" title="scala.collection.mutable.ArrayBuffer[AnyRef]">forAfterUpdateOrInsert</a>.<span title="(elems: AnyRef*)Unit">append</span><span class="delimiter">(</span><a href="#63462" title="AnyRef">z</a><span class="delimiter">)</span>
        <a href="#63453" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#38159" title="(o: T, t: org.squeryl.Table[T], sw: org.squeryl.internals.StatementWriter)Unit">writeInsert</a><span class="delimiter">(</span><a href="#63462" title="AnyRef">z</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#7210" title="T">T</a><span class="delimiter">]</span>, <a href="#7209" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#63454" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="AnyRef" id="63471">z</a> = <a href="View.scala.html#37959" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56996" title="(a: AnyRef)AnyRef">beforeUpdate</a><span class="delimiter">(</span><a href="#63450" title="T">e0</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
        <a href="#63455" title="scala.collection.mutable.ArrayBuffer[AnyRef]">forAfterUpdateOrInsert</a>.<span title="(elems: AnyRef*)Unit">append</span><span class="delimiter">(</span><a href="#63471" title="AnyRef">z</a><span class="delimiter">)</span>
        <a href="#63453" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#38169" title="(o: T, t: org.squeryl.Table[T], sw: org.squeryl.internals.StatementWriter, checkOCC: Boolean)Unit">writeUpdate</a><span class="delimiter">(</span><a href="#63471" title="AnyRef">z</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#7210" title="T">T</a><span class="delimiter">]</span>, <a href="#7209" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#63454" title="org.squeryl.internals.StatementWriter">sw</a>, <a href="#63432" title="Boolean">checkOCC</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#63452" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#38088" title="=&gt; Boolean">isLoggingEnabled</a><span class="delimiter">)</span>
        <a href="#63452" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#38089" title="(s: String)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;Performing batched &quot;)" class="string">&quot;Performing batched &quot;</span> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span><span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#63431" title="Boolean">isInsert</a><span class="delimiter">)</span> <span title="String(&quot;insert&quot;)" class="string">&quot;insert&quot;</span> <span class="keyword">else</span> <span title="String(&quot;update&quot;)" class="string">&quot;update&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; with &quot;)" class="string">&quot; with &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#63454" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#41664" title="=&gt; String">statement</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="java.sql.PreparedStatement" id="63456">st</a> = <a href="#63452" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#38074" title="=&gt; java.sql.Connection">connection</a>.<span title="(x$1: String)java.sql.PreparedStatement">prepareStatement</span><span class="delimiter">(</span><a href="#63454" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#41664" title="=&gt; String">statement</a><span class="delimiter">)</span>

      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#63453" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#38142" title="(params: Iterable[AnyRef], s: java.sql.PreparedStatement)Unit">fillParamsInto</a><span class="delimiter">(</span><a href="#63453" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#38141" title="(params: Iterable[AnyRef])Iterable[AnyRef]">convertParamsForJdbc</a><span class="delimiter">(</span><a href="#63454" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#41661" title="=&gt; Iterable[AnyRef]">paramsZ</a><span class="delimiter">)</span>, <a href="#63456" title="java.sql.PreparedStatement">st</a><span class="delimiter">)</span>
        <a href="#63456" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">addBatch</span>

        <span class="keyword">var</span> <a title="Int" id="63902">updateCount</a> = <span title="Int(1)" class="int">1</span>

        <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#63449" title="Iterator[T]">it</a>.<span title="=&gt; Boolean">hasNext</span><span class="delimiter">)</span> <a href="#63904" title="()Unit" class="delimiter">{</a>
          <span class="keyword">val</span> <a title="AnyRef" id="63946">eN0</a> = <a href="#63449" title="Iterator[T]">it</a>.<span title="()T">next</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span>
          <span class="keyword">val</span> <a title="AnyRef" id="63947">eN</a> =
            <span title="AnyRef" class="keyword">if</span><span class="delimiter">(</span><a href="#63431" title="Boolean">isInsert</a><span class="delimiter">)</span>
              <a href="View.scala.html#37959" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56992" title="(a: AnyRef)AnyRef">beforeInsert</a><span class="delimiter">(</span><a href="#63946" title="AnyRef">eN0</a><span class="delimiter">)</span>
            <span class="keyword">else</span>
              <a href="View.scala.html#37959" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56996" title="(a: AnyRef)AnyRef">beforeUpdate</a><span class="delimiter">(</span><a href="#63946" title="AnyRef">eN0</a><span class="delimiter">)</span>

          <a href="#63455" title="scala.collection.mutable.ArrayBuffer[AnyRef]">forAfterUpdateOrInsert</a>.<span title="(elems: AnyRef*)Unit">append</span><span class="delimiter">(</span><a href="#63947" title="AnyRef">eN</a><span class="delimiter">)</span>

          <span class="keyword">var</span> <a title="Int" id="63948">idx</a> = <span title="Int(1)" class="int">1</span>
          <a href="#63451" title="Iterable[org.squeryl.internals.FieldMetaData]">fmds</a>.<span title="(f: org.squeryl.internals.FieldMetaData =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="org.squeryl.internals.FieldMetaData" id="63965">fmd</a> =&gt; <span class="delimiter">{</span>
            <a href="#63456" title="java.sql.PreparedStatement">st</a>.<span title="(x$1: Int, x$2: Any)Unit">setObject</span><span class="delimiter">(</span><a href="#63948" title="Int">idx</a>, <a href="#63453" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#38162" title="(r: AnyRef)AnyRef">convertToJdbcValue</a><span class="delimiter">(</span><a href="#63965" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#49750" title="(o: AnyRef)AnyRef">getNativeJdbcValue</a><span class="delimiter">(</span><a href="#63947" title="AnyRef">eN</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#63948" title="Int">idx</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>
          <a href="#63456" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">addBatch</span>
          <a href="#63902" title="Int">updateCount</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
        <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="Array[Int]" id="63903">execResults</a> = <a href="#63456" title="java.sql.PreparedStatement">st</a>.<span title="()Array[Int]">executeBatch</span>

        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#63432" title="Boolean">checkOCC</a><span class="delimiter">)</span>
          <span class="keyword">for</span><span class="delimiter">(</span><a title="Int" id="64748">b</a> &lt;- <a href="#63903" title="(f: Int =&gt; Unit)Unit">execResults</a><span class="delimiter">)</span>
            <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#64748" title="Int">b</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="String" id="64753">updateOrInsert</a> = <span title="String" class="keyword">if</span><span class="delimiter">(</span><a href="#63431" title="Boolean">isInsert</a><span class="delimiter">)</span> <span title="String(&quot;insert&quot;)" class="string">&quot;insert&quot;</span> <span class="keyword">else</span> <span title="String(&quot;update&quot;)" class="string">&quot;update&quot;</span>
              <span title="Nothing" class="keyword">throw</span> <span title="org.squeryl.StaleUpdateException" class="keyword">new</span> <a href="KeyedEntity.scala.html#7136" title="org.squeryl.StaleUpdateException">StaleUpdateException</a><span class="delimiter">(</span>
                <span title="String(&quot;Attemped to &quot;)" class="string">&quot;Attemped to &quot;</span><span title="(x$1: Any)String">+</span><a href="#64753" title="String">updateOrInsert</a><span title="(x$1: Any)String">+</span><span title="String(&quot; stale object under optimistic concurrency control&quot;)" class="string">&quot; stale object under optimistic concurrency control&quot;</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">finally</span> <span class="delimiter">{</span>
        <a href="#63456" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">close</span>
      <span class="delimiter">}</span>

      <span class="keyword">for</span><span class="delimiter">(</span><a title="AnyRef" id="64775">a</a> &lt;- <a href="#63455" title="(f: AnyRef =&gt; Any)Unit">forAfterUpdateOrInsert</a><span class="delimiter">)</span>
        <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="#63431" title="Boolean">isInsert</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="View.scala.html#37971" title="(v1: T)Unit">_setPersisted</a><span class="delimiter">(</span><a href="View.scala.html#37959" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56993" title="(a: AnyRef)AnyRef">afterInsert</a><span class="delimiter">(</span><a href="#64775" title="AnyRef">a</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#7210" title="T">T</a><span class="delimiter">]</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">else</span>
          <a href="View.scala.html#37959" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56997" title="(a: AnyRef)AnyRef">afterUpdate</a><span class="delimiter">(</span><a href="#64775" title="AnyRef">a</a><span class="delimiter">)</span>

    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /**
   * Updates without any Optimistic Concurrency Control check 
   * @throws SquerylSQLException When a database error occurs or the update
   * does not result in 1 row
   */
  <span class="keyword">def</span> <a title="(o: T)(implicit ked: org.squeryl.KeyedEntityDef[T, _])AnyRef" id="38000">forceUpdate</a><span class="delimiter">(</span><a title="T" id="64781">o</a>: <a href="#7210" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.squeryl.KeyedEntityDef[T, _]" id="64782">ked</a>: <a href="KeyedEntity.scala.html#7120" title="org.squeryl.KeyedEntityDef[T, _]">KeyedEntityDef</a><span class="delimiter">[</span>T,_<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="#38004" title="(o: T, checkOCC: Boolean, ked: org.squeryl.KeyedEntityDef[T, _])AnyRef">_update</a><span class="delimiter">(</span><a href="#64781" title="T">o</a>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#64782" title="org.squeryl.KeyedEntityDef[T, _]">ked</a><span class="delimiter">)</span>
  
  /**
   * @throws SquerylSQLException When a database error occurs or the update
   * does not result in 1 row
   */
  <span class="keyword">def</span> <a title="(o: T)(implicit ked: org.squeryl.KeyedEntityDef[T, _])Unit" id="38001">update</a><span class="delimiter">(</span><a title="T" id="57870">o</a>: <a href="#7210" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.squeryl.KeyedEntityDef[T, _]" id="57871">ked</a>: <a href="KeyedEntity.scala.html#7120" title="org.squeryl.KeyedEntityDef[T, _]">KeyedEntityDef</a><span class="delimiter">[</span>T,_<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> =
    <a href="#38004" title="(o: T, checkOCC: Boolean, ked: org.squeryl.KeyedEntityDef[T, _])AnyRef">_update</a><span title="Unit" class="delimiter">(</span><a href="#57870" title="T">o</a>, <span title="Boolean(true)" class="keyword">true</span>, <a href="#57871" title="org.squeryl.KeyedEntityDef[T, _]">ked</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(o: Iterable[T])(implicit ked: org.squeryl.KeyedEntityDef[T, _])Unit" id="38002">update</a><span class="delimiter">(</span><a title="Iterable[T]" id="57863">o</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.squeryl.KeyedEntityDef[T, _]" id="57864">ked</a>: <a href="KeyedEntity.scala.html#7120" title="org.squeryl.KeyedEntityDef[T, _]">KeyedEntityDef</a><span class="delimiter">[</span>T,_<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> =
    <a href="#38005" title="(e: Iterable[T], checkOCC: Boolean)Unit">_update</a><span class="delimiter">(</span><a href="#57863" title="Iterable[T]">o</a>, <a href="#57864" title="org.squeryl.KeyedEntityDef[T, _]">ked</a>.<a href="KeyedEntity.scala.html#8842" title="=&gt; Boolean">isOptimistic</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(o: Iterable[T])(implicit ked: org.squeryl.KeyedEntityDef[T, _])Unit" id="38003">forceUpdate</a><span class="delimiter">(</span><a title="Iterable[T]" id="64853">o</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.squeryl.KeyedEntityDef[T, _]" id="64854">ked</a>: <a href="KeyedEntity.scala.html#7120" title="org.squeryl.KeyedEntityDef[T, _]">KeyedEntityDef</a><span class="delimiter">[</span>T,_<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> =
    <a href="#38005" title="(e: Iterable[T], checkOCC: Boolean)Unit">_update</a><span class="delimiter">(</span><a href="#64853" title="Iterable[T]">o</a>, <a href="#64854" title="org.squeryl.KeyedEntityDef[T, _]">ked</a>.<a href="KeyedEntity.scala.html#8842" title="=&gt; Boolean">isOptimistic</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(o: T, checkOCC: Boolean, ked: org.squeryl.KeyedEntityDef[T, _])AnyRef" id="38004">_update</a><span class="delimiter">(</span><a title="T" id="64789">o</a>: <a href="#7210" title="T">T</a>, <a title="Boolean" id="64790">checkOCC</a>: <span title="Boolean">Boolean</span>, <a title="org.squeryl.KeyedEntityDef[T, _]" id="64791">ked</a>: <a href="KeyedEntity.scala.html#7120" title="org.squeryl.KeyedEntityDef[T, _]">KeyedEntityDef</a><span class="delimiter">[</span>T,_<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="org.squeryl.internals.DatabaseAdapter" id="64792">dba</a> = <a href="Session.scala.html#7193" title="org.squeryl.Session.type">Session</a>.<a href="Session.scala.html#38067" title="=&gt; org.squeryl.Session">currentSession</a>.<a href="Session.scala.html#38076" title="=&gt; org.squeryl.internals.DatabaseAdapter">databaseAdapter</a>
    <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="64793">sw</a> = <a href="internals/StatementWriter.scala.html#41655" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#8175" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#64792" title="org.squeryl.internals.DatabaseAdapter">dba</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="T" id="64794">o0</a> = <a href="View.scala.html#37959" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56996" title="(a: AnyRef)AnyRef">beforeUpdate</a><span class="delimiter">(</span><a href="#64789" title="T">o</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#7210" title="T">T</a><span class="delimiter">]</span>
    <a href="#64792" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#38169" title="(o: T, t: org.squeryl.Table[T], sw: org.squeryl.internals.StatementWriter, checkOCC: Boolean)Unit">writeUpdate</a><span class="delimiter">(</span><a href="#64794" title="T">o0</a>, <a href="#7209" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#64793" title="org.squeryl.internals.StatementWriter">sw</a>, <a href="#64790" title="Boolean">checkOCC</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Int" id="64795">cnt</a>  = <a href="#64792" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#38156" title="(s: org.squeryl.Session, sw: org.squeryl.internals.StatementWriter)Int">executeUpdateAndCloseStatement</a><span class="delimiter">(</span><a href="Session.scala.html#7193" title="org.squeryl.Session.type">Session</a>.<a href="Session.scala.html#38067" title="=&gt; org.squeryl.Session">currentSession</a>, <a href="#64793" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#64795" title="Int">cnt</a> <span title="(x: Int)Boolean">!=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">if</span><span class="delimiter">(</span><a href="#64790" title="Boolean">checkOCC</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="View.scala.html#37966" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#38370" title="=&gt; Boolean">isOptimistic</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="AnyRef" id="64820">version</a> = <a href="View.scala.html#37966" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#38380" title="=&gt; Option[org.squeryl.internals.FieldMetaData]">optimisticCounter</a>.<span title="=&gt; org.squeryl.internals.FieldMetaData">get</span>.<a href="internals/FieldMetaData.scala.html#49750" title="(o: AnyRef)AnyRef">getNativeJdbcValue</a><span class="delimiter">(</span><a href="#64789" title="T">o</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">throw</span> <span title="org.squeryl.StaleUpdateException" class="keyword">new</span> <a href="KeyedEntity.scala.html#7136" title="org.squeryl.StaleUpdateException">StaleUpdateException</a><span class="delimiter">(</span>
           <span title="String(&quot;Object &quot;)" class="string">&quot;Object &quot;</span><span title="(x$1: Any)String">+</span><a href="View.scala.html#37963" title="=&gt; String">prefixedName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;(id=&quot;)" class="string">&quot;(id=&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#64791" title="org.squeryl.KeyedEntityDef[T, _]">ked</a>.<a href="KeyedEntity.scala.html#8838" title="(a: T)_$6">getId</a><span class="delimiter">(</span><a href="#64789" title="T">o</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot;, occVersionNumber=&quot;)" class="string">&quot;, occVersionNumber=&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#64820" title="AnyRef">version</a> <span title="(x$1: Any)String">+</span>
           <span title="String(&quot;) has become stale, it cannot be updated under optimistic concurrency control&quot;)" class="string">&quot;) has become stale, it cannot be updated under optimistic concurrency control&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">else</span>
        <span title="Nothing" class="keyword">throw</span> <a href="KeyedEntity.scala.html#15660" title="(message: String)org.squeryl.SquerylSQLException">SquerylSQLException</a><span class="delimiter">(</span><span title="String(&quot;failed to update.  Expected 1 row, got &quot;)" class="string">&quot;failed to update.  Expected 1 row, got &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#64795" title="Int">cnt</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="View.scala.html#37959" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56997" title="(a: AnyRef)AnyRef">afterUpdate</a><span class="delimiter">(</span><a href="#64794" title="T">o0</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(e: Iterable[T], checkOCC: Boolean)Unit" id="38005">_update</a><span class="delimiter">(</span><a title="Iterable[T]" id="64787">e</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="Boolean" id="64788">checkOCC</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> = <span class="delimiter">{</span>

    <span class="keyword">def</span> <a title="(t: T)Iterable[org.squeryl.internals.FieldMetaData]" id="64863">buildFmds</a><span class="delimiter">(</span><a title="T" id="64864">t</a>: <a href="#7210" title="T">T</a><span class="delimiter">)</span>: <span title="Iterable[org.squeryl.internals.FieldMetaData]">Iterable</span><span class="delimiter">[</span>FieldMetaData<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[org.squeryl.internals.FieldMetaData]" id="64865">pkList</a> = <a href="View.scala.html#37966" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#38378" title="=&gt; Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]]">primaryKey</a>.<span title="(default: =&gt; Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method])Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]">getOrElse</span><span class="delimiter">(</span>
        org.squeryl.internals.<a href="internals/Utils.scala.html#8187" title="org.squeryl.internals.Utils.type">Utils</a>.<a href="internals/Utils.scala.html#32420" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="String(&quot;method was called with &quot;)" class="string">&quot;method was called with &quot;</span> <span title="(x$1: Any)String">+</span> <a href="View.scala.html#37966" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#38361" title="=&gt; Class[T]">clasz</a>.<span title="()String">getName</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; that is not a KeyedEntity[]&quot;)" class="string">&quot; that is not a KeyedEntity[]&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(fa: org.squeryl.internals.FieldMetaData =&gt; List[org.squeryl.internals.FieldMetaData], fb: java.lang.reflect.Method =&gt; List[org.squeryl.internals.FieldMetaData])List[org.squeryl.internals.FieldMetaData]">fold</span><span class="delimiter">(</span>
        <a title="org.squeryl.internals.FieldMetaData" id="64875">pkMd</a> =&gt; <span title="(xs: org.squeryl.internals.FieldMetaData*)List[org.squeryl.internals.FieldMetaData]">List</span><span class="delimiter">(</span><a href="#64875" title="org.squeryl.internals.FieldMetaData">pkMd</a><span class="delimiter">)</span>,
        <a title="java.lang.reflect.Method" id="64884">pkGetter</a> =&gt; <span class="delimiter">{</span>
          // Just for side-effect...
          <span class="keyword">var</span> <a title="Option[List[org.squeryl.internals.FieldMetaData]]" id="64885">fields</a>: <span title="Option[List[org.squeryl.internals.FieldMetaData]]">Option</span><span class="delimiter">[</span>List<span class="delimiter">[</span>FieldMetaData<span class="delimiter">]</span><span class="delimiter">]</span>  = <span title="None.type">None</span>
          <a href="internals/Utils.scala.html#8187" title="org.squeryl.internals.Utils.type">Utils</a>.<a href="internals/Utils.scala.html#32412" title="(q: org.squeryl.Queryable[T], whereClause: T =&gt; org.squeryl.dsl.ast.LogicalBoolean)org.squeryl.dsl.ast.QueryExpressionElements">createQuery4WhereClause</a><span class="delimiter">(</span><a href="#7209" title="org.squeryl.Table[T]" class="keyword">this</a>, <span class="delimiter">(</span>t0:<a href="#7210" title="T">T</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="org.squeryl.dsl.CompositeKey" id="64891">ck</a> = <a href="#64884" title="java.lang.reflect.Method">pkGetter</a>.<span title="(x$1: Any, x$2: &lt;repeated...&gt;[Object])Object">invoke</span><span class="delimiter">(</span><a href="#64890" title="T">t0</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.CompositeKey" class="delimiter">[</span><a href="dsl/CompositeKey.scala.html#7375" title="org.squeryl.dsl.CompositeKey">CompositeKey</a><span class="delimiter">]</span>

            <a href="#64885" title="Option[List[org.squeryl.internals.FieldMetaData]]">fields</a> = <span title="(x: List[org.squeryl.internals.FieldMetaData])Some[List[org.squeryl.internals.FieldMetaData]]">Some</span><span class="delimiter">(</span><a href="#64891" title="org.squeryl.dsl.CompositeKey">ck</a>.<a href="dsl/CompositeKey.scala.html#33400" title="=&gt; Seq[org.squeryl.internals.FieldMetaData]">_fields</a>.<span title="=&gt; List[org.squeryl.internals.FieldMetaData]">toList</span><span class="delimiter">)</span>

            <span title="org.squeryl.dsl.ast.EqualityExpression" class="keyword">new</span> <a href="dsl/ast/ExpressionNode.scala.html#7642" title="org.squeryl.dsl.ast.EqualityExpression">EqualityExpression</a><span class="delimiter">(</span><span title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode" class="keyword">new</span> <a href="dsl/ast/ExpressionNode.scala.html#7659" title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode">InputOnlyConstantExpressionNode</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode" class="keyword">new</span> <a href="dsl/ast/ExpressionNode.scala.html#7659" title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode">InputOnlyConstantExpressionNode</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>

          <a href="#64885" title="Option[List[org.squeryl.internals.FieldMetaData]]">fields</a> <span title="(default: =&gt; List[org.squeryl.internals.FieldMetaData])List[org.squeryl.internals.FieldMetaData]">getOrElse</span> <span class="delimiter">(</span>internals.<a href="internals/Utils.scala.html#8187" title="org.squeryl.internals.Utils.type">Utils</a>.<a href="internals/Utils.scala.html#32420" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="String(&quot;No PK fields found&quot;)" class="string">&quot;No PK fields found&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">)</span>

      <span title="(xs: List[org.squeryl.internals.FieldMetaData]*)List[List[org.squeryl.internals.FieldMetaData]]">List</span><span class="delimiter">(</span>
        <a href="View.scala.html#37966" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#38374" title="=&gt; Iterable[org.squeryl.internals.FieldMetaData]">fieldsMetaData</a>.<span title="(p: org.squeryl.internals.FieldMetaData =&gt; Boolean)Iterable[org.squeryl.internals.FieldMetaData]">filter</span><span class="delimiter">(</span><a title="org.squeryl.internals.FieldMetaData" id="64933">fmd</a>=&gt; <span title="=&gt; Boolean">!</span> <a href="#64933" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#49726" title="=&gt; Boolean">isIdFieldOfKeyedEntity</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span> <a href="#64933" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#49710" title="=&gt; Boolean">isOptimisticCounter</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#64933" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#49748" title="=&gt; Boolean">isUpdatable</a><span class="delimiter">)</span>.<span title="=&gt; List[org.squeryl.internals.FieldMetaData]">toList</span>,
        <a href="#64865" title="List[org.squeryl.internals.FieldMetaData]">pkList</a>,
        <a href="View.scala.html#37966" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#38380" title="=&gt; Option[org.squeryl.internals.FieldMetaData]">optimisticCounter</a>.<span title="=&gt; List[org.squeryl.internals.FieldMetaData]">toList</span>
      <span class="delimiter">)</span>.<span title="(implicit asTraversable: List[org.squeryl.internals.FieldMetaData] =&gt; scala.collection.GenTraversableOnce[org.squeryl.internals.FieldMetaData])List[org.squeryl.internals.FieldMetaData]">flatten</span>
    <span class="delimiter">}</span>

    <a href="#37999" title="(e: Iterable[T], fmdCallback: T =&gt; Iterable[org.squeryl.internals.FieldMetaData], isInsert: Boolean, checkOCC: Boolean)Unit">_batchedUpdateOrInsert</a><span class="delimiter">(</span><a href="#64787" title="Iterable[T]">e</a>, <a href="#64863" title="(t: T)Iterable[org.squeryl.internals.FieldMetaData]">buildFmds</a> _, <span title="Boolean(false)" class="keyword">false</span>, <a href="#64788" title="Boolean">checkOCC</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">def</span> <a title="(s: T =&gt; org.squeryl.dsl.ast.UpdateStatement)Int" id="38006">update</a><span class="delimiter">(</span><a title="T =&gt; org.squeryl.dsl.ast.UpdateStatement" id="57861">s</a>: T =&gt;UpdateStatement<span class="delimiter">)</span>:<span title="Int">Int</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.ViewExpressionNode[T]" id="64951">vxn</a> = <span title="org.squeryl.dsl.ast.ViewExpressionNode[T]" class="keyword">new</span> <a href="dsl/ast/ViewExpressionNode.scala.html#7730" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">ViewExpressionNode</a><span class="delimiter">(</span><a href="#7209" title="org.squeryl.Table[T]" class="keyword">this</a><span class="delimiter">)</span>
    <a href="#64951" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a>.<a href="dsl/ast/ViewExpressionNode.scala.html#65000" title="(d: T)Unit">sample</a> =
       <a href="View.scala.html#37966" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#38384" title="(cb: net.sf.cglib.proxy.Callback)T">createSample</a><span class="delimiter">(</span><a href="internals/FieldReferenceLinker.scala.html#8099" title="org.squeryl.internals.FieldReferenceLinker.type">FieldReferenceLinker</a>.<a href="internals/FieldReferenceLinker.scala.html#65053" title="(v: org.squeryl.dsl.ast.ViewExpressionNode[_])net.sf.cglib.proxy.Callback">createCallBack</a><span class="delimiter">(</span><a href="#64951" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a><span class="delimiter">)</span><span class="delimiter">)</span>    
    <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.UpdateStatement" id="64952">us</a> = <a href="#57861" title="(v1: T)org.squeryl.dsl.ast.UpdateStatement">s</a><span class="delimiter">(</span><a href="#64951" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a>.<a href="dsl/ast/ViewExpressionNode.scala.html#65001" title="=&gt; T">sample</a><span class="delimiter">)</span>
    <a href="#64951" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a>.<a href="dsl/ast/ExpressionNode.scala.html#31638" title="(x$1: Option[org.squeryl.dsl.ast.ExpressionNode])Unit">parent</a> = <span title="(x: org.squeryl.dsl.ast.UpdateStatement)Some[org.squeryl.dsl.ast.UpdateStatement]">Some</span><span class="delimiter">(</span><a href="#64952" title="org.squeryl.dsl.ast.UpdateStatement">us</a><span class="delimiter">)</span>

    <span class="keyword">var</span> <a title="Int" id="64953">idGen</a> = <span title="Int(0)" class="int">0</span>
    <a href="#64952" title="org.squeryl.dsl.ast.UpdateStatement">us</a>.<a href="dsl/ast/ExpressionNode.scala.html#31654" title="(visitor: (org.squeryl.dsl.ast.ExpressionNode, Option[org.squeryl.dsl.ast.ExpressionNode], Int) =&gt; Unit)Unit">visitDescendants</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.ExpressionNode" id="65076">node</a>,<a title="Option[org.squeryl.dsl.ast.ExpressionNode]" id="65077">parent</a>,<a title="Int" id="65078">i</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#65076" title="org.squeryl.dsl.ast.ExpressionNode">node</a>.<a href="dsl/ast/ExpressionNode.scala.html#31637" title="=&gt; Option[org.squeryl.dsl.ast.ExpressionNode]">parent</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="None.type">None</span><span class="delimiter">)</span>
        <a href="#65076" title="org.squeryl.dsl.ast.ExpressionNode">node</a>.<a href="dsl/ast/ExpressionNode.scala.html#31638" title="(x$1: Option[org.squeryl.dsl.ast.ExpressionNode])Unit">parent</a> = <a href="#65077" title="Option[org.squeryl.dsl.ast.ExpressionNode]">parent</a>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#65076" title="org.squeryl.dsl.ast.ExpressionNode">node</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="dsl/ast/ExpressionNode.scala.html#7676" title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired">UniqueIdInAliaseRequired</a><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired" id="65084">nxn</a> = <a href="#65076" title="org.squeryl.dsl.ast.ExpressionNode">node</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired" class="delimiter">[</span><a href="dsl/ast/ExpressionNode.scala.html#7676" title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired">UniqueIdInAliaseRequired</a><span class="delimiter">]</span>
        <a href="#65084" title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired">nxn</a>.<a href="dsl/ast/ExpressionNode.scala.html#56586" title="(x$1: Option[Int])Unit">uniqueId</a> = <span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><a href="#64953" title="Int">idGen</a><span class="delimiter">)</span>
        <a href="#64953" title="Int">idGen</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <a href="#64951" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a>.<a href="dsl/ast/ExpressionNode.scala.html#56586" title="(x$1: Option[Int])Unit">uniqueId</a> = <span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><a href="#64953" title="Int">idGen</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="org.squeryl.internals.DatabaseAdapter" id="64954">dba</a> = <a href="#37996" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>
    <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="64955">sw</a> = <a href="internals/StatementWriter.scala.html#41655" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#8175" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#64954" title="org.squeryl.internals.DatabaseAdapter">dba</a><span class="delimiter">)</span>
    <a href="#64954" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#38179" title="(t: org.squeryl.Table[_], us: org.squeryl.dsl.ast.UpdateStatement, sw: org.squeryl.internals.StatementWriter)Unit">writeUpdate</a><span class="delimiter">(</span><a href="#7209" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#64952" title="org.squeryl.dsl.ast.UpdateStatement">us</a>, <a href="#64955" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>
    <a href="#64954" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#38156" title="(s: org.squeryl.Session, sw: org.squeryl.internals.StatementWriter)Int">executeUpdateAndCloseStatement</a><span class="delimiter">(</span><a href="Session.scala.html#7193" title="org.squeryl.Session.type">Session</a>.<a href="Session.scala.html#38067" title="=&gt; org.squeryl.Session">currentSession</a>, <a href="#64955" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>    
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(q: org.squeryl.Query[T])Int" id="38007">delete</a><span class="delimiter">(</span><a title="org.squeryl.Query[T]" id="65109">q</a>: <a href="Query.scala.html#7162" title="org.squeryl.Query[T]">Query</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.QueryExpressionElements" id="65110">queryAst</a> = <a href="#65109" title="org.squeryl.Query[T]">q</a>.<a href="Query.scala.html#24188" title="=&gt; org.squeryl.dsl.ast.ExpressionNode">ast</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.ast.QueryExpressionElements" class="delimiter">[</span><a href="dsl/ast/QueryExpressionElements.scala.html#7692" title="org.squeryl.dsl.ast.QueryExpressionElements">QueryExpressionElements</a><span class="delimiter">]</span>
    <a href="#65110" title="org.squeryl.dsl.ast.QueryExpressionElements">queryAst</a>.<a href="dsl/ast/QueryExpressionElements.scala.html#63852" title="(x$1: Boolean)Unit">inhibitAliasOnSelectElementReference</a> = <span title="Boolean(true)" class="keyword">true</span>

    <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="65111">sw</a> = <a href="internals/StatementWriter.scala.html#41655" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#8175" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#37996" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a><span class="delimiter">)</span>
    <a href="#37996" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#38172" title="(t: org.squeryl.Table[T], whereClause: Option[org.squeryl.dsl.ast.ExpressionNode], sw: org.squeryl.internals.StatementWriter)Unit">writeDelete</a><span class="delimiter">(</span><a href="#7209" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#65110" title="org.squeryl.dsl.ast.QueryExpressionElements">queryAst</a>.<a href="dsl/ast/QueryExpressionElements.scala.html#63864" title="=&gt; Option[org.squeryl.dsl.ast.ExpressionNode]">whereClause</a>, <a href="#65111" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>

    <a href="#37996" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#38156" title="(s: org.squeryl.Session, sw: org.squeryl.internals.StatementWriter)Int">executeUpdateAndCloseStatement</a><span class="delimiter">(</span><a href="Session.scala.html#7193" title="org.squeryl.Session.type">Session</a>.<a href="Session.scala.html#38067" title="=&gt; org.squeryl.Session">currentSession</a>, <a href="#65111" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(whereClause: T =&gt; org.squeryl.dsl.ast.LogicalBoolean)(implicit dsl: org.squeryl.dsl.QueryDsl)Int" id="38008">deleteWhere</a><span class="delimiter">(</span><a title="T =&gt; org.squeryl.dsl.ast.LogicalBoolean" id="65136">whereClause</a>: T =&gt; LogicalBoolean<span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.squeryl.dsl.QueryDsl" id="65137">dsl</a>: <a href="dsl/QueryDsl.scala.html#7512" title="org.squeryl.dsl.QueryDsl">QueryDsl</a><span class="delimiter">)</span>: <span title="Int">Int</span> =
    <a href="#38007" title="(q: org.squeryl.Query[T])Int">delete</a><span class="delimiter">(</span><a href="#65137" title="org.squeryl.dsl.QueryDsl">dsl</a>.<a href="dsl/boilerplate/FromSignatures.scala.html#25268" title="(t1: org.squeryl.Queryable[T])(f: T =&gt; org.squeryl.dsl.QueryYield[T])org.squeryl.Query[T]">from</a><span class="delimiter">(</span><a href="#7209" title="org.squeryl.Table[T]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="T" id="65300">t</a> =&gt; <a href="#65137" title="org.squeryl.dsl.QueryDsl">dsl</a>.<a href="dsl/QueryDsl.scala.html#24552" title="(b: =&gt; org.squeryl.dsl.ast.LogicalBoolean)org.squeryl.dsl.fsm.WhereState[org.squeryl.dsl.fsm.Conditioned]">where</a><span class="delimiter">(</span><a href="#65136" title="(v1: T)org.squeryl.dsl.ast.LogicalBoolean">whereClause</a><span class="delimiter">(</span><a href="#65300" title="T">t</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="dsl/fsm/StartState.scala.html#24510" title="(yieldClosure: =&gt; T)org.squeryl.dsl.fsm.SelectState[T]">select</a><span class="delimiter">(</span><a href="#65300" title="T">t</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>      

  <span class="keyword">def</span> <a title="[K](k: K)(implicit ked: org.squeryl.KeyedEntityDef[T,K], implicit dsl: org.squeryl.dsl.QueryDsl)Boolean" id="38009">delete</a><span class="delimiter">[</span><a title="" id="38011">K</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="K" id="65142">k</a>: <a href="#38011" title="K">K</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.squeryl.KeyedEntityDef[T,K]" id="65143">ked</a>: <a href="KeyedEntity.scala.html#7120" title="org.squeryl.KeyedEntityDef[T,K]">KeyedEntityDef</a><span class="delimiter">[</span>T,K<span class="delimiter">]</span>, <a title="org.squeryl.dsl.QueryDsl" id="65144">dsl</a>: <a href="dsl/QueryDsl.scala.html#7512" title="org.squeryl.dsl.QueryDsl">QueryDsl</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span>  = <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#65144" title="org.squeryl.dsl.QueryDsl">dsl</a>._
    <span class="keyword">val</span> <a title="org.squeryl.Query[T]" id="65308">q</a> = <a href="dsl/boilerplate/FromSignatures.scala.html#25268" title="(t1: org.squeryl.Queryable[T])(f: T =&gt; org.squeryl.dsl.QueryYield[T])org.squeryl.Query[T]">from</a><span class="delimiter">(</span><a href="#7209" title="org.squeryl.Table[T]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="T" id="65456">a</a> =&gt; <a href="#65144" title="org.squeryl.dsl.QueryDsl">dsl</a>.<a href="dsl/QueryDsl.scala.html#24552" title="(b: =&gt; org.squeryl.dsl.ast.LogicalBoolean)org.squeryl.dsl.fsm.WhereState[org.squeryl.dsl.fsm.Conditioned]">where</a> <span class="delimiter">{</span>
      <a href="internals/FieldReferenceLinker.scala.html#8099" title="org.squeryl.internals.FieldReferenceLinker.type">FieldReferenceLinker</a>.<a href="internals/FieldReferenceLinker.scala.html#65044" title="(e: Any, c: Any)org.squeryl.dsl.ast.LogicalBoolean">createEqualityExpressionWithLastAccessedFieldReferenceAndConstant</a><span class="delimiter">(</span><a href="#65143" title="org.squeryl.KeyedEntityDef[T,K]">ked</a>.<a href="KeyedEntity.scala.html#8838" title="(a: T)K">getId</a><span class="delimiter">(</span><a href="#65456" title="T">a</a><span class="delimiter">)</span>, <a href="#65142" title="K">k</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <a href="dsl/fsm/StartState.scala.html#24510" title="(yieldClosure: =&gt; T)org.squeryl.dsl.fsm.SelectState[T]">select</a><span class="delimiter">(</span><a href="#65456" title="T">a</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Option[T]" id="65310">z</a> = <a href="#65308" title="org.squeryl.Query[T]">q</a>.<a href="Query.scala.html#24192" title="=&gt; Option[T]">headOption</a>

    <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="View.scala.html#37959" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56989" title="=&gt; Boolean">hasBeforeDelete</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#65309" title="=&gt; Option[T]">z</a>.<span title="(f: T =&gt; AnyRef)Option[AnyRef]">map</span><span class="delimiter">(</span><a title="T" id="65473">x</a> =&gt; <a href="View.scala.html#37959" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56994" title="(a: AnyRef)AnyRef">beforeDelete</a><span class="delimiter">(</span><a href="#65473" title="T">x</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="Int" id="65311">deleteCount</a> = <a href="#7209" title="Table.this.type" class="keyword">this</a>.<a href="#38007" title="(q: org.squeryl.Query[T])Int">delete</a><span class="delimiter">(</span><a href="#65308" title="org.squeryl.Query[T]">q</a><span class="delimiter">)</span>

    <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="View.scala.html#37959" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56990" title="=&gt; Boolean">hasAfterDelete</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#65309" title="=&gt; Option[T]">z</a>.<span title="(f: T =&gt; AnyRef)Option[AnyRef]">map</span><span class="delimiter">(</span><a title="T" id="65519">x</a> =&gt; <a href="View.scala.html#37959" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56995" title="(a: AnyRef)AnyRef">afterDelete</a><span class="delimiter">(</span><a href="#65519" title="T">x</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#65311" title="Int">deleteCount</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(1)" class="int">1</span>, <span title="String(&quot;Query :\n&quot;)" class="string">&quot;Query :\n&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#65308" title="org.squeryl.Query[T]">q</a>.<a href="Query.scala.html#24186" title="=&gt; String">dumpAst</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\nshould have deleted at most 1 row but has deleted &quot;)" class="string">&quot;\nshould have deleted at most 1 row but has deleted &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#65311" title="Int">deleteCount</a><span class="delimiter">)</span>
    <a href="#65311" title="Int">deleteCount</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span>
  <span class="delimiter">}</span>

  /**
   * @throws SquerylSQLException When a database error occurs or the operation
   * does not result in 1 row
   */
  <span class="keyword">def</span> <a title="(o: T)(implicit ked: org.squeryl.KeyedEntityDef[T, _])T" id="38012">insertOrUpdate</a><span class="delimiter">(</span><a title="T" id="65537">o</a>: <a href="#7210" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.squeryl.KeyedEntityDef[T, _]" id="65538">ked</a>: <a href="KeyedEntity.scala.html#7120" title="org.squeryl.KeyedEntityDef[T, _]">KeyedEntityDef</a><span class="delimiter">[</span>T,_<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#7210" title="T">T</a> = <span class="delimiter">{</span>
    <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="#65538" title="org.squeryl.KeyedEntityDef[T, _]">ked</a>.<a href="KeyedEntity.scala.html#8839" title="(a: T)Boolean">isPersisted</a><span class="delimiter">(</span><a href="#65537" title="T">o</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#38001" title="(o: T)(implicit ked: org.squeryl.KeyedEntityDef[T, _])Unit">update</a><a href="#65538" title="org.squeryl.KeyedEntityDef[T, _]" class="delimiter">(</a><a href="#65537" title="T">o</a><span class="delimiter">)</span>
    <span class="keyword">else</span>
      <a href="#37997" title="(t: T)T">insert</a><span class="delimiter">(</span><a href="#65537" title="T">o</a><span class="delimiter">)</span>
    <a href="#65537" title="T">o</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>