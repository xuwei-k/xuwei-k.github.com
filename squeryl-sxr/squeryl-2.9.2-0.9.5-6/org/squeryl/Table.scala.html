<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>org/squeryl/Table.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*******************************************************************************
 * Copyright 2010 Maxime LÃ©vesque
 * 
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ***************************************************************************** */</span>
<span class="keyword">package</span> org.squeryl;

<span class="keyword">import</span> dsl.ast._
<span class="keyword">import</span> dsl.<span class="delimiter">{</span>CompositeKey, QueryDsl<span class="delimiter">}</span>
<span class="keyword">import</span> internals._
<span class="keyword">import</span> java.sql.<span class="delimiter">{</span>Statement<span class="delimiter">}</span>
<span class="keyword">import</span> logging.StackMarker
<span class="keyword">import</span> scala.reflect.Manifest
<span class="keyword">import</span> collection.mutable.ArrayBuffer
<span class="keyword">import</span> javax.swing.<span title="object javax.swing.UIDefaults">UIDefaults</span>.LazyValue

<span class="keyword">private</span> <span class="delimiter">[</span>squeryl<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object org.squeryl.DummySchema" id="9791">DummySchema</a> <span title="ScalaObject" class="keyword">extends</span> <a href="Schema.scala.html#10171" title="org.squeryl.Schema">Schema</a>

<span class="keyword">class</span> <a title="class Table[T] extends org.squeryl.View[T] with ScalaObject" id="10243">Table</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="10340">T</a><span class="delimiter">]</span> <a href="#10243" title="ScalaObject" class="keyword">private</a> <span class="delimiter">[</span>squeryl<span class="delimiter">]</span> <span class="delimiter">(</span><a title="String" id="51485">n</a>: <span title="String">String</span>, <a title="Class[T]" id="51486">c</a>: <span title="Class[T]">Class</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="org.squeryl.Schema" id="51487">schema</a>: <a href="Schema.scala.html#10171" title="org.squeryl.Schema">Schema</a>, <a title="Option[String]" id="51488">_prefix</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="View.scala.html#10081" title="org.squeryl.View[T]">View</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">(</span><a href="#51485" title="String">n</a>, <a href="#51486" title="Class[T]">c</a>, <a href="#51487" title="org.squeryl.Schema">schema</a>, <a href="#51488" title="Option[String]">_prefix</a><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(n: String)(implicit manifestT: scala.reflect.Manifest[T])org.squeryl.Table[T]" id="36873" class="keyword">this</a><span class="delimiter">(</span><a title="String" id="51482">n</a>:<span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.reflect.Manifest[T]" id="51483">manifestT</a>: <span title="scala.reflect.Manifest[T]">Manifest</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="#10243" title="Table.this.type" class="keyword">this</a><span class="delimiter">(</span><a href="#51482" title="String">n</a>, <a href="#51483" title="scala.reflect.Manifest[T]">manifestT</a>.<span title="=&gt; java.lang.Class[_]">erasure</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Class[T]" class="delimiter">[</span><span title="Class[T]">Class</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span>, <a href="#9791" title="object org.squeryl.DummySchema">DummySchema</a>, <span title="object None">None</span><span class="delimiter">)</span>  

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; org.squeryl.internals.DatabaseAdapter" id="36874">_dbAdapter</a> = <a href="Session.scala.html#10079" title="object org.squeryl.Session">Session</a>.<a href="Session.scala.html#36953" title="=&gt; org.squeryl.Session">currentSession</a>.<a href="Session.scala.html#36964" title="=&gt; org.squeryl.internals.DatabaseAdapter">databaseAdapter</a>

  <span class="keyword">def</span> <a title="(t: T)T" id="36875">insert</a><span class="delimiter">(</span><a title="T" id="57321">t</a>: <a href="#10340" title="T">T</a><span class="delimiter">)</span>: <a href="#10340" title="T">T</a> = <a href="logging/StatisticsListener.scala.html#13396" title="object org.squeryl.logging.StackMarker">StackMarker</a>.<a href="logging/StatisticsListener.scala.html#62189" title="(a: =&gt; T)T">lastSquerylStackFrame</a> <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="AnyRef" id="62198">o</a> = <a href="View.scala.html#22721" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56190" title="(a: AnyRef)AnyRef">beforeInsert</a><span class="delimiter">(</span><a href="#57321" title="T">t</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.squeryl.Session" id="62199">sess</a> = <a href="Session.scala.html#10079" title="object org.squeryl.Session">Session</a>.<a href="Session.scala.html#36953" title="=&gt; org.squeryl.Session">currentSession</a>
    <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="62200">sw</a> = <a href="internals/StatementWriter.scala.html#40641" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#12931" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#36874" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a><span class="delimiter">)</span>
    <a href="#36874" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#37042" title="(o: T, t: org.squeryl.Table[T], sw: org.squeryl.internals.StatementWriter)Unit">writeInsert</a><span class="delimiter">(</span><a href="#62198" title="AnyRef">o</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#10340" title="T">T</a><span class="delimiter">]</span>, <a href="#10243" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#62200" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="java.sql.PreparedStatement" id="62201">st</a> =
      <span title="(_1: Boolean, _2: Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]])(Boolean, Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]])" class="delimiter">(</span><a href="#36874" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#37020" title="=&gt; Boolean">supportsAutoIncrementInColumnDeclaration</a>, <a href="View.scala.html#22728" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#37263" title="=&gt; Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]]">primaryKey</a><span class="delimiter">)</span> <span title="java.sql.PreparedStatement" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="java.sql.PreparedStatement" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <a title="Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]]" id="62645">a</a>:<span title="Any">Any</span><span class="delimiter">)</span> =&gt; <a href="#62199" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#36962" title="=&gt; java.sql.Connection">connection</a>.<span title="(x$1: java.lang.String, x$2: Int)java.sql.PreparedStatement">prepareStatement</span><span class="delimiter">(</span><a href="#62200" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#40650" title="=&gt; java.lang.String">statement</a>, Statement.<span title="Int(1)">RETURN_GENERATED_KEYS</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="java.sql.PreparedStatement" class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, Some<span class="delimiter">(</span>Left<span class="delimiter">(</span><a title="org.squeryl.internals.FieldMetaData" id="62823">pk</a>:<a href="internals/FieldMetaData.scala.html#12577" title="org.squeryl.internals.FieldMetaData">FieldMetaData</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Array[String]" id="62824">autoIncPk</a> = <span title="Array[String]" class="keyword">new</span> <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <a href="#62824" title="(i: Int, x: String)Unit">autoIncPk</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> = <a href="#62823" title="org.squeryl.internals.FieldMetaData">pk</a>.<a href="internals/FieldMetaData.scala.html#48404" title="=&gt; String">columnName</a>
          <a href="#62199" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#36962" title="=&gt; java.sql.Connection">connection</a>.<span title="(x$1: java.lang.String, x$2: Array[java.lang.String])java.sql.PreparedStatement">prepareStatement</span><span class="delimiter">(</span><a href="#62200" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#40650" title="=&gt; java.lang.String">statement</a>, <a href="#62824" title="Array[String]">autoIncPk</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <a title="java.sql.PreparedStatement" id="62833">a</a>:<span title="Any">Any</span> =&gt; <a href="#62199" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#36962" title="=&gt; java.sql.Connection">connection</a>.<span title="(x$1: java.lang.String)java.sql.PreparedStatement">prepareStatement</span><span class="delimiter">(</span><a href="#62200" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#40650" title="=&gt; java.lang.String">statement</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>        

    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="62836">cnt</a> = <a href="#36874" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#37040" title="(s: org.squeryl.Session, sw: org.squeryl.internals.StatementWriter, ps: java.sql.PreparedStatement)Int">executeUpdateForInsert</a><span class="delimiter">(</span><a href="#62199" title="org.squeryl.Session">sess</a>, <a href="#62200" title="org.squeryl.internals.StatementWriter">sw</a>, <a href="#62201" title="java.sql.PreparedStatement">st</a><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#62836" title="Int">cnt</a> <span title="(x: Int)Boolean">!=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        org.squeryl.internals.<a href="internals/Utils.scala.html#13022" title="object org.squeryl.internals.Utils">Utils</a>.<a href="internals/Utils.scala.html#32775" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;failed to insert&quot;)" class="string">&quot;failed to insert&quot;</span><span class="delimiter">)</span>

      <a href="View.scala.html#22728" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#37263" title="=&gt; Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]]">primaryKey</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span>Left<span class="delimiter">(</span><a title="org.squeryl.internals.FieldMetaData" id="62878">pk</a>:<a href="internals/FieldMetaData.scala.html#12577" title="org.squeryl.internals.FieldMetaData">FieldMetaData</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#62878" title="org.squeryl.internals.FieldMetaData">pk</a>.<a href="internals/FieldMetaData.scala.html#48411" title="=&gt; Boolean">isAutoIncremented</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="java.sql.ResultSet" id="62890">rs</a> = <a href="#62201" title="java.sql.PreparedStatement">st</a>.<span title="()java.sql.ResultSet">getGeneratedKeys</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#62890" title="java.sql.ResultSet">rs</a>.<span title="()Boolean">next</span>,
              <span class="string">&quot;getGeneratedKeys returned no rows for the auto incremented\n&quot;</span><span title="java.lang.String(&quot;getGeneratedKeys returned no rows for the auto incremented\012 primary key of table \'&quot;)">+</span>
              <span class="string">&quot; primary key of table '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="View.scala.html#22723" title="=&gt; String">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\' JDBC3 feature might not be supported, \012 or&quot;)" class="string">&quot;' JDBC3 feature might not be supported, \n or&quot;</span><span title="(x$1: Any)java.lang.String">+</span>
              <span title="java.lang.String(&quot; column might not be defined as auto increment&quot;)" class="string">&quot; column might not be defined as auto increment&quot;</span><span class="delimiter">)</span>
            <a href="#62878" title="org.squeryl.internals.FieldMetaData">pk</a>.<a href="internals/FieldMetaData.scala.html#48415" title="(target: AnyRef, rs: java.sql.ResultSet, index: Int)Unit">setFromResultSet</a><span class="delimiter">(</span><a href="#62198" title="AnyRef">o</a>, <a href="#62890" title="java.sql.ResultSet">rs</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">finally</span> <span class="delimiter">{</span>
            <a href="#62890" title="java.sql.ResultSet">rs</a>.<span title="()Unit">close</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <a title="Unit" id="63769">a</a>:<span title="Any">Any</span> =&gt;<span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#62201" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">close</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="T" id="62202">r</a> = <a href="View.scala.html#22721" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56191" title="(a: AnyRef)AnyRef">afterInsert</a><span class="delimiter">(</span><a href="#62198" title="AnyRef">o</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#10340" title="T">T</a><span class="delimiter">]</span>

    <a href="View.scala.html#22733" title="(v1: T)Unit">_setPersisted</a><span class="delimiter">(</span><a href="#62202" title="T">r</a><span class="delimiter">)</span>

    <a href="#62202" title="T">r</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(t: org.squeryl.Query[T])Nothing" id="36876">insert</a><span class="delimiter">(</span><a title="org.squeryl.Query[T]" id="57317">t</a>: <a href="Query.scala.html#9943" title="org.squeryl.Query[T]">Query</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> = org.squeryl.internals.<a href="internals/Utils.scala.html#13022" title="object org.squeryl.internals.Utils">Utils</a>.<a href="internals/Utils.scala.html#32775" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;not implemented&quot;)" class="string">&quot;not implemented&quot;</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(e: Iterable[T])Unit" id="36877">insert</a><span class="delimiter">(</span><a title="Iterable[T]" id="57314">e</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> =
    <a href="#36878" title="(e: Iterable[T], fmdCallback: T =&gt; Iterable[org.squeryl.internals.FieldMetaData], isInsert: Boolean, checkOCC: Boolean)Unit">_batchedUpdateOrInsert</a><span class="delimiter">(</span><a href="#57314" title="Iterable[T]">e</a>, <a title="T" id="63783">t</a> =&gt; <a href="View.scala.html#22728" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#37261" title="=&gt; Iterable[org.squeryl.internals.FieldMetaData]">fieldsMetaData</a>.<span title="(p: org.squeryl.internals.FieldMetaData =&gt; Boolean)Iterable[org.squeryl.internals.FieldMetaData]">filter</span><span class="delimiter">(</span><a title="org.squeryl.internals.FieldMetaData" id="63787">fmd</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#63787" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#48411" title="=&gt; Boolean">isAutoIncremented</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#63787" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#48412" title="=&gt; Boolean">isInsertable</a><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

  <span class="comment">/**
   * isInsert if statement is insert otherwise update
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(e: Iterable[T], fmdCallback: T =&gt; Iterable[org.squeryl.internals.FieldMetaData], isInsert: Boolean, checkOCC: Boolean)Unit" id="36878">_batchedUpdateOrInsert</a><span class="delimiter">(</span><a title="Iterable[T]" id="63777">e</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="T =&gt; Iterable[org.squeryl.internals.FieldMetaData]" id="63778">fmdCallback</a>: T =&gt; Iterable<span class="delimiter">[</span>FieldMetaData<span class="delimiter">]</span>, <a title="Boolean" id="63779">isInsert</a>: <span title="Boolean">Boolean</span>, <a title="Boolean" id="63780">checkOCC</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> = <span class="delimiter">{</span>
    
    <span class="keyword">val</span> <a title="Iterator[T]" id="63799">it</a> = <a href="#63777" title="Iterable[T]">e</a>.<span title="=&gt; Iterator[T]">iterator</span>

    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#63799" title="Iterator[T]">it</a>.<span title="=&gt; Boolean">hasNext</span><span class="delimiter">)</span> <span class="delimiter">{</span>

      <span class="keyword">val</span> <a title="T" id="63800">e0</a> = <a href="#63799" title="Iterator[T]">it</a>.<span title="()T">next</span>
      <span class="keyword">val</span> <a title="Iterable[org.squeryl.internals.FieldMetaData]" id="63801">fmds</a> = <a href="#63778" title="(v1: T)Iterable[org.squeryl.internals.FieldMetaData]">fmdCallback</a><span class="delimiter">(</span><a href="#63800" title="T">e0</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="org.squeryl.Session" id="63802">sess</a> = <a href="Session.scala.html#10079" title="object org.squeryl.Session">Session</a>.<a href="Session.scala.html#36953" title="=&gt; org.squeryl.Session">currentSession</a>
      <span class="keyword">val</span> <a title="org.squeryl.internals.DatabaseAdapter" id="63803">dba</a> = <a href="#36874" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>
      <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="63804">sw</a> = <a href="internals/StatementWriter.scala.html#40641" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#12931" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#63803" title="org.squeryl.internals.DatabaseAdapter">dba</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[AnyRef]" id="63805">forAfterUpdateOrInsert</a> = <span title="()scala.collection.mutable.ArrayBuffer[AnyRef]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[AnyRef]">ArrayBuffer</span><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#63779" title="Boolean">isInsert</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="AnyRef" id="63812">z</a> = <a href="View.scala.html#22721" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56190" title="(a: AnyRef)AnyRef">beforeInsert</a><span class="delimiter">(</span><a href="#63800" title="T">e0</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
        <a href="#63805" title="scala.collection.mutable.ArrayBuffer[AnyRef]">forAfterUpdateOrInsert</a>.<span title="(elems: AnyRef*)Unit">append</span><span class="delimiter">(</span><a href="#63812" title="AnyRef">z</a><span class="delimiter">)</span>
        <a href="#63803" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#37042" title="(o: T, t: org.squeryl.Table[T], sw: org.squeryl.internals.StatementWriter)Unit">writeInsert</a><span class="delimiter">(</span><a href="#63812" title="AnyRef">z</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#10340" title="T">T</a><span class="delimiter">]</span>, <a href="#10243" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#63804" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="AnyRef" id="63821">z</a> = <a href="View.scala.html#22721" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56194" title="(a: AnyRef)AnyRef">beforeUpdate</a><span class="delimiter">(</span><a href="#63800" title="T">e0</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
        <a href="#63805" title="scala.collection.mutable.ArrayBuffer[AnyRef]">forAfterUpdateOrInsert</a>.<span title="(elems: AnyRef*)Unit">append</span><span class="delimiter">(</span><a href="#63821" title="AnyRef">z</a><span class="delimiter">)</span>
        <a href="#63803" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#37052" title="(o: T, t: org.squeryl.Table[T], sw: org.squeryl.internals.StatementWriter, checkOCC: Boolean)Unit">writeUpdate</a><span class="delimiter">(</span><a href="#63821" title="AnyRef">z</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#10340" title="T">T</a><span class="delimiter">]</span>, <a href="#10243" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#63804" title="org.squeryl.internals.StatementWriter">sw</a>, <a href="#63780" title="Boolean">checkOCC</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#63802" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#36976" title="=&gt; Boolean">isLoggingEnabled</a><span class="delimiter">)</span>
        <a href="#63802" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#36977" title="(s: String)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Performing batched &quot;)" class="string">&quot;Performing batched &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#63779" title="Boolean">isInsert</a><span class="delimiter">)</span> <span title="java.lang.String(&quot;insert&quot;)" class="string">&quot;insert&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;update&quot;)" class="string">&quot;update&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with &quot;)" class="string">&quot; with &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#63804" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#40650" title="=&gt; java.lang.String">statement</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="java.sql.PreparedStatement" id="63806">st</a> = <a href="#63802" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#36962" title="=&gt; java.sql.Connection">connection</a>.<span title="(x$1: java.lang.String)java.sql.PreparedStatement">prepareStatement</span><span class="delimiter">(</span><a href="#63804" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#40650" title="=&gt; java.lang.String">statement</a><span class="delimiter">)</span>

      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#63803" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#37025" title="(params: Iterable[AnyRef], s: java.sql.PreparedStatement)Unit">fillParamsInto</a><span class="delimiter">(</span><a href="#63803" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#37024" title="(params: Iterable[AnyRef])Iterable[AnyRef]">convertParamsForJdbc</a><span class="delimiter">(</span><a href="#63804" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#40647" title="=&gt; Iterable[AnyRef]">paramsZ</a><span class="delimiter">)</span>, <a href="#63806" title="java.sql.PreparedStatement">st</a><span class="delimiter">)</span>
        <a href="#63806" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">addBatch</span>

        <span class="keyword">var</span> <a title="Int" id="64258">updateCount</a> = <span title="Int(1)" class="int">1</span>

        <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#63799" title="Iterator[T]">it</a>.<span title="=&gt; Boolean">hasNext</span><span class="delimiter">)</span> <a href="#64260" title="()Unit" class="delimiter">{</a>
          <span class="keyword">val</span> <a title="AnyRef" id="64306">eN0</a> = <a href="#63799" title="Iterator[T]">it</a>.<span title="()T">next</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span>
          <span class="keyword">val</span> <a title="AnyRef" id="64307">eN</a> =
            <span title="AnyRef" class="keyword">if</span><span class="delimiter">(</span><a href="#63779" title="Boolean">isInsert</a><span class="delimiter">)</span>
              <a href="View.scala.html#22721" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56190" title="(a: AnyRef)AnyRef">beforeInsert</a><span class="delimiter">(</span><a href="#64306" title="AnyRef">eN0</a><span class="delimiter">)</span>
            <span class="keyword">else</span>
              <a href="View.scala.html#22721" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56194" title="(a: AnyRef)AnyRef">beforeUpdate</a><span class="delimiter">(</span><a href="#64306" title="AnyRef">eN0</a><span class="delimiter">)</span>

          <a href="#63805" title="scala.collection.mutable.ArrayBuffer[AnyRef]">forAfterUpdateOrInsert</a>.<span title="(elems: AnyRef*)Unit">append</span><span class="delimiter">(</span><a href="#64307" title="AnyRef">eN</a><span class="delimiter">)</span>

          <span class="keyword">var</span> <a title="Int" id="64308">idx</a> = <span title="Int(1)" class="int">1</span>
          <a href="#63801" title="Iterable[org.squeryl.internals.FieldMetaData]">fmds</a>.<span title="(f: org.squeryl.internals.FieldMetaData =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="org.squeryl.internals.FieldMetaData" id="64325">fmd</a> =&gt; <span class="delimiter">{</span>
            <a href="#63806" title="java.sql.PreparedStatement">st</a>.<span title="(x$1: Int, x$2: Any)Unit">setObject</span><span class="delimiter">(</span><a href="#64308" title="Int">idx</a>, <a href="#63803" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#37045" title="(r: AnyRef)AnyRef">convertToJdbcValue</a><span class="delimiter">(</span><a href="#64325" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#48414" title="(o: AnyRef)AnyRef">get</a><span class="delimiter">(</span><a href="#64307" title="AnyRef">eN</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#64308" title="Int">idx</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>
          <a href="#63806" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">addBatch</span>
          <a href="#64258" title="Int">updateCount</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
        <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="Array[Int]" id="64259">execResults</a> = <a href="#63806" title="java.sql.PreparedStatement">st</a>.<span title="()Array[Int]">executeBatch</span>

        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#63780" title="Boolean">checkOCC</a><span class="delimiter">)</span>
          <span class="keyword">for</span><span class="delimiter">(</span><a title="Int" id="65121">b</a> &lt;- <a href="#64259" title="(f: Int =&gt; Unit)Unit">execResults</a><span class="delimiter">)</span>
            <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#65121" title="Int">b</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="java.lang.String" id="65126">updateOrInsert</a> = <span title="java.lang.String" class="keyword">if</span><span class="delimiter">(</span><a href="#63779" title="Boolean">isInsert</a><span class="delimiter">)</span> <span title="java.lang.String(&quot;insert&quot;)" class="string">&quot;insert&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;update&quot;)" class="string">&quot;update&quot;</span>
              <span title="Nothing" class="keyword">throw</span> <span title="org.squeryl.StaleUpdateException" class="keyword">new</span> <a href="KeyedEntity.scala.html#10267" title="org.squeryl.StaleUpdateException">StaleUpdateException</a><span class="delimiter">(</span>
                <span title="java.lang.String(&quot;Attemped to &quot;)" class="string">&quot;Attemped to &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#65126" title="java.lang.String">updateOrInsert</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; stale object under optimistic concurrency control&quot;)" class="string">&quot; stale object under optimistic concurrency control&quot;</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">finally</span> <span class="delimiter">{</span>
        <a href="#63806" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">close</span>
      <span class="delimiter">}</span>

      <span class="keyword">for</span><span class="delimiter">(</span><a title="AnyRef" id="65150">a</a> &lt;- <a href="#63805" title="(f: AnyRef =&gt; AnyRef)Unit">forAfterUpdateOrInsert</a><span class="delimiter">)</span>
        <span title="AnyRef" class="keyword">if</span><span class="delimiter">(</span><a href="#63779" title="Boolean">isInsert</a><span class="delimiter">)</span>
          <a href="View.scala.html#22721" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56191" title="(a: AnyRef)AnyRef">afterInsert</a><span class="delimiter">(</span><a href="#65150" title="AnyRef">a</a><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="View.scala.html#22721" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56195" title="(a: AnyRef)AnyRef">afterUpdate</a><span class="delimiter">(</span><a href="#65150" title="AnyRef">a</a><span class="delimiter">)</span>

    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Updates without any Optimistic Concurrency Control check 
   */</span>
  <span class="keyword">def</span> <a title="(o: T)(implicit ev: &lt;:&lt;[T,org.squeryl.KeyedEntity[_]])AnyRef" id="36879">forceUpdate</a><span class="delimiter">(</span><a title="T" id="65152">o</a>: <a href="#10340" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]" id="65153">ev</a>: T <span title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]">&lt;:&lt;</span> KeyedEntity<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="#36883" title="(o: T, checkOCC: Boolean)AnyRef">_update</a><span class="delimiter">(</span><a href="#65152" title="T">o</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
  
  <span class="keyword">def</span> <a title="(o: T)(implicit ev: &lt;:&lt;[T,org.squeryl.KeyedEntity[_]])Unit" id="36880">update</a><span class="delimiter">(</span><a title="T" id="57343">o</a>: <a href="#10340" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]" id="57344">ev</a>: T <span title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]">&lt;:&lt;</span> KeyedEntity<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> =
    <a href="#36883" title="(o: T, checkOCC: Boolean)AnyRef">_update</a><span title="Unit" class="delimiter">(</span><a href="#57343" title="T">o</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(o: Iterable[T])(implicit ev: &lt;:&lt;[T,org.squeryl.KeyedEntity[_]])Unit" id="36881">update</a><span class="delimiter">(</span><a title="Iterable[T]" id="57336">o</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]" id="57337">ev</a>: T <span title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]">&lt;:&lt;</span> KeyedEntity<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> =
    <a href="#36884" title="(e: Iterable[T], checkOCC: Boolean)Unit">_update</a><span class="delimiter">(</span><a href="#57336" title="Iterable[T]">o</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(o: Iterable[T])(implicit ev: &lt;:&lt;[T,org.squeryl.KeyedEntity[_]])Unit" id="36882">forceUpdate</a><span class="delimiter">(</span><a title="Iterable[T]" id="65222">o</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]" id="65223">ev</a>: T <span title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]">&lt;:&lt;</span> KeyedEntity<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> =
    <a href="#36884" title="(e: Iterable[T], checkOCC: Boolean)Unit">_update</a><span class="delimiter">(</span><a href="#65222" title="Iterable[T]">o</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(o: T, checkOCC: Boolean)AnyRef" id="36883">_update</a><span class="delimiter">(</span><a title="T" id="65163">o</a>: <a href="#10340" title="T">T</a>, <a title="Boolean" id="65164">checkOCC</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="org.squeryl.internals.DatabaseAdapter" id="65167">dba</a> = <a href="Session.scala.html#10079" title="object org.squeryl.Session">Session</a>.<a href="Session.scala.html#36953" title="=&gt; org.squeryl.Session">currentSession</a>.<a href="Session.scala.html#36964" title="=&gt; org.squeryl.internals.DatabaseAdapter">databaseAdapter</a>
    <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="65168">sw</a> = <a href="internals/StatementWriter.scala.html#40641" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#12931" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#65167" title="org.squeryl.internals.DatabaseAdapter">dba</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="T" id="65169">o0</a> = <a href="View.scala.html#22721" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56194" title="(a: AnyRef)AnyRef">beforeUpdate</a><span class="delimiter">(</span><a href="#65163" title="T">o</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#10340" title="T">T</a><span class="delimiter">]</span>
    <a href="#65167" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#37052" title="(o: T, t: org.squeryl.Table[T], sw: org.squeryl.internals.StatementWriter, checkOCC: Boolean)Unit">writeUpdate</a><span class="delimiter">(</span><a href="#65169" title="T">o0</a>, <a href="#10243" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#65168" title="org.squeryl.internals.StatementWriter">sw</a>, <a href="#65164" title="Boolean">checkOCC</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Int" id="65170">cnt</a>  = <a href="#65167" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#37039" title="(s: org.squeryl.Session, sw: org.squeryl.internals.StatementWriter)Int">executeUpdateAndCloseStatement</a><span class="delimiter">(</span><a href="Session.scala.html#10079" title="object org.squeryl.Session">Session</a>.<a href="Session.scala.html#36953" title="=&gt; org.squeryl.Session">currentSession</a>, <a href="#65168" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#65170" title="Int">cnt</a> <span title="(x: Int)Boolean">!=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">if</span><span class="delimiter">(</span><a href="#65164" title="Boolean">checkOCC</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="View.scala.html#22728" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#37256" title="=&gt; Boolean">isOptimistic</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="AnyRef" id="65196">version</a> = <a href="View.scala.html#22728" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#37265" title="=&gt; Option[org.squeryl.internals.FieldMetaData]">optimisticCounter</a>.<span title="=&gt; org.squeryl.internals.FieldMetaData">get</span>.<a href="internals/FieldMetaData.scala.html#48414" title="(o: AnyRef)AnyRef">get</a><span class="delimiter">(</span><a href="#65163" title="T">o</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">throw</span> <span title="org.squeryl.StaleUpdateException" class="keyword">new</span> <a href="KeyedEntity.scala.html#10267" title="org.squeryl.StaleUpdateException">StaleUpdateException</a><span class="delimiter">(</span>
           <span title="java.lang.String(&quot;Object &quot;)" class="string">&quot;Object &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="View.scala.html#22725" title="=&gt; java.lang.String">prefixedName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;(id=&quot;)" class="string">&quot;(id=&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#65163" title="T">o</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.KeyedEntity[_$5]" class="delimiter">[</span><a href="KeyedEntity.scala.html#10195" title="org.squeryl.KeyedEntity[_]">KeyedEntity</a><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span>.<a href="KeyedEntity.scala.html#13560" title="=&gt; _$5">id</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, occVersionNumber=&quot;)" class="string">&quot;, occVersionNumber=&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#65196" title="AnyRef">version</a> <span title="(x$1: Any)java.lang.String">+</span>
           <span title="java.lang.String(&quot;) has become stale, it cannot be updated under optimistic concurrency control&quot;)" class="string">&quot;) has become stale, it cannot be updated under optimistic concurrency control&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">else</span>
        org.squeryl.internals.<a href="internals/Utils.scala.html#13022" title="object org.squeryl.internals.Utils">Utils</a>.<a href="internals/Utils.scala.html#32775" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;failed to update&quot;)" class="string">&quot;failed to update&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="View.scala.html#22721" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56195" title="(a: AnyRef)AnyRef">afterUpdate</a><span class="delimiter">(</span><a href="#65169" title="T">o0</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(e: Iterable[T], checkOCC: Boolean)Unit" id="36884">_update</a><span class="delimiter">(</span><a title="Iterable[T]" id="65160">e</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="Boolean" id="65161">checkOCC</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> = <span class="delimiter">{</span>

    <span class="keyword">def</span> <a title="(t: T)Iterable[org.squeryl.internals.FieldMetaData]" id="65234">buildFmds</a><span class="delimiter">(</span><a title="T" id="65235">t</a>: <a href="#10340" title="T">T</a><span class="delimiter">)</span>: <span title="Iterable[org.squeryl.internals.FieldMetaData]">Iterable</span><span class="delimiter">[</span>FieldMetaData<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[org.squeryl.internals.FieldMetaData]" id="65236">pkList</a> = <a href="View.scala.html#22728" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#37263" title="=&gt; Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]]">primaryKey</a>.<span title="(default: =&gt; Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method])Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]">getOrElse</span><span class="delimiter">(</span>
        org.squeryl.internals.<a href="internals/Utils.scala.html#13022" title="object org.squeryl.internals.Utils">Utils</a>.<a href="internals/Utils.scala.html#32775" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;method was called with &quot;)" class="string">&quot;method was called with &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="View.scala.html#22728" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#37247" title="=&gt; java.lang.Class[T]">clasz</a>.<span title="()java.lang.String">getName</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; that is not a KeyedEntity[]&quot;)" class="string">&quot; that is not a KeyedEntity[]&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(fa: org.squeryl.internals.FieldMetaData =&gt; List[org.squeryl.internals.FieldMetaData], fb: java.lang.reflect.Method =&gt; List[org.squeryl.internals.FieldMetaData])List[org.squeryl.internals.FieldMetaData]">fold</span><span class="delimiter">(</span>
        <a title="org.squeryl.internals.FieldMetaData" id="65246">pkMd</a> =&gt; <span title="(xs: org.squeryl.internals.FieldMetaData*)List[org.squeryl.internals.FieldMetaData]">List</span><span class="delimiter">(</span><a href="#65246" title="org.squeryl.internals.FieldMetaData">pkMd</a><span class="delimiter">)</span>,
        <a title="java.lang.reflect.Method" id="65255">pkGetter</a> =&gt; <span class="delimiter">{</span>
          <span class="comment">// Just for side-effect...</span>
          <span class="keyword">var</span> <a title="Option[List[org.squeryl.internals.FieldMetaData]]" id="65256">fields</a>: <span title="Option[List[org.squeryl.internals.FieldMetaData]]">Option</span><span class="delimiter">[</span>List<span class="delimiter">[</span>FieldMetaData<span class="delimiter">]</span><span class="delimiter">]</span>  = <span title="object None">None</span>
          <a href="internals/Utils.scala.html#13022" title="object org.squeryl.internals.Utils">Utils</a>.<a href="internals/Utils.scala.html#32767" title="(q: org.squeryl.Queryable[T], whereClause: T =&gt; org.squeryl.dsl.ast.LogicalBoolean)org.squeryl.dsl.ast.QueryExpressionElements">createQuery4WhereClause</a><span class="delimiter">(</span><a href="#10243" title="org.squeryl.Table[T]" class="keyword">this</a>, <span class="delimiter">(</span>t0:<a href="#10340" title="T">T</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="org.squeryl.dsl.CompositeKey" id="65262">ck</a> = <a href="#65255" title="java.lang.reflect.Method">pkGetter</a>.<span title="(x$1: Any, x$2: &lt;repeated...&gt;[java.lang.Object])java.lang.Object">invoke</span><span class="delimiter">(</span><a href="#65261" title="T">t0</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.CompositeKey" class="delimiter">[</span><a href="dsl/CompositeKey.scala.html#11003" title="org.squeryl.dsl.CompositeKey">CompositeKey</a><span class="delimiter">]</span>

            <a href="#65256" title="Option[List[org.squeryl.internals.FieldMetaData]]">fields</a> = <span title="(x: List[org.squeryl.internals.FieldMetaData])Some[List[org.squeryl.internals.FieldMetaData]]">Some</span><span class="delimiter">(</span><a href="#65262" title="org.squeryl.dsl.CompositeKey">ck</a>.<a href="dsl/CompositeKey.scala.html#20814" title="=&gt; Seq[org.squeryl.internals.FieldMetaData]">_fields</a>.<span title="=&gt; List[org.squeryl.internals.FieldMetaData]">toList</span><span class="delimiter">)</span>

            <span title="org.squeryl.dsl.ast.EqualityExpression" class="keyword">new</span> <a href="dsl/ast/ExpressionNode.scala.html#11700" title="org.squeryl.dsl.ast.EqualityExpression">EqualityExpression</a><span class="delimiter">(</span><span title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode[Int]" class="keyword">new</span> <a href="dsl/ast/ExpressionNode.scala.html#11733" title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode[Int]">InputOnlyConstantExpressionNode</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode[Int]" class="keyword">new</span> <a href="dsl/ast/ExpressionNode.scala.html#11733" title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode[Int]">InputOnlyConstantExpressionNode</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>

          <a href="#65256" title="Option[List[org.squeryl.internals.FieldMetaData]]">fields</a> <span title="(default: =&gt; List[org.squeryl.internals.FieldMetaData])List[org.squeryl.internals.FieldMetaData]">getOrElse</span> <span class="delimiter">(</span>internals.<a href="internals/Utils.scala.html#13022" title="object org.squeryl.internals.Utils">Utils</a>.<a href="internals/Utils.scala.html#32775" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;No PK fields found&quot;)" class="string">&quot;No PK fields found&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">)</span>

      <span title="(xs: List[org.squeryl.internals.FieldMetaData]*)List[List[org.squeryl.internals.FieldMetaData]]">List</span><span class="delimiter">(</span>
        <a href="View.scala.html#22728" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#37261" title="=&gt; Iterable[org.squeryl.internals.FieldMetaData]">fieldsMetaData</a>.<span title="(p: org.squeryl.internals.FieldMetaData =&gt; Boolean)Iterable[org.squeryl.internals.FieldMetaData]">filter</span><span class="delimiter">(</span><a title="org.squeryl.internals.FieldMetaData" id="65309">fmd</a>=&gt; <span title="=&gt; Boolean">!</span> <a href="#65309" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#48393" title="=&gt; Boolean">isIdFieldOfKeyedEntity</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span> <a href="#65309" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#48379" title="=&gt; Boolean">isOptimisticCounter</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#65309" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#48413" title="=&gt; Boolean">isUpdatable</a><span class="delimiter">)</span>.<span title="=&gt; List[org.squeryl.internals.FieldMetaData]">toList</span>,
        <a href="#65236" title="List[org.squeryl.internals.FieldMetaData]">pkList</a>,
        <a href="View.scala.html#22728" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#37265" title="=&gt; Option[org.squeryl.internals.FieldMetaData]">optimisticCounter</a>.<span title="=&gt; List[org.squeryl.internals.FieldMetaData]">toList</span>
      <span class="delimiter">)</span>.<span title="(implicit asTraversable: List[org.squeryl.internals.FieldMetaData] =&gt; scala.collection.TraversableOnce[org.squeryl.internals.FieldMetaData])List[org.squeryl.internals.FieldMetaData]">flatten</span>
    <span class="delimiter">}</span>

    <a href="#36878" title="(e: Iterable[T], fmdCallback: T =&gt; Iterable[org.squeryl.internals.FieldMetaData], isInsert: Boolean, checkOCC: Boolean)Unit">_batchedUpdateOrInsert</a><span class="delimiter">(</span><a href="#65160" title="Iterable[T]">e</a>, <a href="#65234" title="(t: T)Iterable[org.squeryl.internals.FieldMetaData]">buildFmds</a> _, <span title="Boolean(false)" class="keyword">false</span>, <a href="#65161" title="Boolean">checkOCC</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">def</span> <a title="(s: T =&gt; org.squeryl.dsl.ast.UpdateStatement)Int" id="36885">update</a><span class="delimiter">(</span><a title="T =&gt; org.squeryl.dsl.ast.UpdateStatement" id="57333">s</a>: T =&gt;UpdateStatement<span class="delimiter">)</span>:<span title="Int">Int</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.ViewExpressionNode[T]" id="65358">vxn</a> = <span title="org.squeryl.dsl.ast.ViewExpressionNode[T]" class="keyword">new</span> <a href="dsl/ast/ViewExpressionNode.scala.html#11532" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">ViewExpressionNode</a><span class="delimiter">(</span><a href="#10243" title="org.squeryl.Table[T]" class="keyword">this</a><span class="delimiter">)</span>
    <a href="#65358" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a>.<a href="dsl/ast/ViewExpressionNode.scala.html#65407" title="(d: T)Unit">sample</a> =
       <a href="View.scala.html#22728" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#37269" title="(cb: net.sf.cglib.proxy.Callback)T">createSample</a><span class="delimiter">(</span><a href="internals/FieldReferenceLinker.scala.html#12686" title="object org.squeryl.internals.FieldReferenceLinker">FieldReferenceLinker</a>.<a href="internals/FieldReferenceLinker.scala.html#20503" title="(v: org.squeryl.dsl.ast.ViewExpressionNode[_])net.sf.cglib.proxy.Callback">createCallBack</a><span class="delimiter">(</span><a href="#65358" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a><span class="delimiter">)</span><span class="delimiter">)</span>    
    <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.UpdateStatement" id="65359">us</a> = <a href="#57333" title="(v1: T)org.squeryl.dsl.ast.UpdateStatement">s</a><span class="delimiter">(</span><a href="#65358" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a>.<a href="dsl/ast/ViewExpressionNode.scala.html#65408" title="=&gt; T">sample</a><span class="delimiter">)</span>
    <a href="#65358" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a>.<a href="dsl/ast/ExpressionNode.scala.html#20362" title="(x$1: Option[org.squeryl.dsl.ast.ExpressionNode])Unit">parent</a> = <span title="(x: org.squeryl.dsl.ast.UpdateStatement)Some[org.squeryl.dsl.ast.UpdateStatement]">Some</span><span class="delimiter">(</span><a href="#65359" title="org.squeryl.dsl.ast.UpdateStatement">us</a><span class="delimiter">)</span>

    <span class="keyword">var</span> <a title="Int" id="65360">idGen</a> = <span title="Int(0)" class="int">0</span>
    <a href="#65359" title="org.squeryl.dsl.ast.UpdateStatement">us</a>.<a href="dsl/ast/ExpressionNode.scala.html#20378" title="(visitor: (org.squeryl.dsl.ast.ExpressionNode, Option[org.squeryl.dsl.ast.ExpressionNode], Int) =&gt; Unit)Unit">visitDescendants</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.ExpressionNode" id="65455">node</a>,<a title="Option[org.squeryl.dsl.ast.ExpressionNode]" id="65456">parent</a>,<a title="Int" id="65457">i</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#65455" title="org.squeryl.dsl.ast.ExpressionNode">node</a>.<a href="dsl/ast/ExpressionNode.scala.html#20361" title="=&gt; Option[org.squeryl.dsl.ast.ExpressionNode]">parent</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="object None">None</span><span class="delimiter">)</span>
        <a href="#65455" title="org.squeryl.dsl.ast.ExpressionNode">node</a>.<a href="dsl/ast/ExpressionNode.scala.html#20362" title="(x$1: Option[org.squeryl.dsl.ast.ExpressionNode])Unit">parent</a> = <a href="#65456" title="Option[org.squeryl.dsl.ast.ExpressionNode]">parent</a>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#65455" title="org.squeryl.dsl.ast.ExpressionNode">node</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="dsl/ast/ExpressionNode.scala.html#11571" title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired">UniqueIdInAliaseRequired</a><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired" id="65463">nxn</a> = <a href="#65455" title="org.squeryl.dsl.ast.ExpressionNode">node</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired" class="delimiter">[</span><a href="dsl/ast/ExpressionNode.scala.html#11571" title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired">UniqueIdInAliaseRequired</a><span class="delimiter">]</span>
        <a href="#65463" title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired">nxn</a>.<a href="dsl/ast/ExpressionNode.scala.html#55834" title="(x$1: Option[Int])Unit">uniqueId</a> = <span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><a href="#65360" title="Int">idGen</a><span class="delimiter">)</span>
        <a href="#65360" title="Int">idGen</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <a href="#65358" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a>.<a href="dsl/ast/ExpressionNode.scala.html#55834" title="(x$1: Option[Int])Unit">uniqueId</a> = <span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><a href="#65360" title="Int">idGen</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="org.squeryl.internals.DatabaseAdapter" id="65361">dba</a> = <a href="#36874" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>
    <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="65362">sw</a> = <a href="internals/StatementWriter.scala.html#40641" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#12931" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#65361" title="org.squeryl.internals.DatabaseAdapter">dba</a><span class="delimiter">)</span>
    <a href="#65361" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#37062" title="(t: org.squeryl.Table[_], us: org.squeryl.dsl.ast.UpdateStatement, sw: org.squeryl.internals.StatementWriter)Unit">writeUpdate</a><span class="delimiter">(</span><a href="#10243" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#65359" title="org.squeryl.dsl.ast.UpdateStatement">us</a>, <a href="#65362" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>
    <a href="#65361" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#37039" title="(s: org.squeryl.Session, sw: org.squeryl.internals.StatementWriter)Int">executeUpdateAndCloseStatement</a><span class="delimiter">(</span><a href="Session.scala.html#10079" title="object org.squeryl.Session">Session</a>.<a href="Session.scala.html#36953" title="=&gt; org.squeryl.Session">currentSession</a>, <a href="#65362" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>    
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(q: org.squeryl.Query[T])Int" id="36886">delete</a><span class="delimiter">(</span><a title="org.squeryl.Query[T]" id="65486">q</a>: <a href="Query.scala.html#9943" title="org.squeryl.Query[T]">Query</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.QueryExpressionElements" id="65488">queryAst</a> = <a href="#65486" title="org.squeryl.Query[T]">q</a>.<a href="Query.scala.html#16338" title="=&gt; org.squeryl.dsl.ast.ExpressionNode">ast</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.ast.QueryExpressionElements" class="delimiter">[</span><a href="dsl/ast/QueryExpressionElements.scala.html#11562" title="org.squeryl.dsl.ast.QueryExpressionElements">QueryExpressionElements</a><span class="delimiter">]</span>
    <a href="#65488" title="org.squeryl.dsl.ast.QueryExpressionElements">queryAst</a>.<a href="dsl/ast/QueryExpressionElements.scala.html#64205" title="(x$1: Boolean)Unit">inhibitAliasOnSelectElementReference</a> = <span title="Boolean(true)" class="keyword">true</span>

    <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="65489">sw</a> = <a href="internals/StatementWriter.scala.html#40641" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#12931" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#36874" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a><span class="delimiter">)</span>
    <a href="#36874" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#37055" title="(t: org.squeryl.Table[T], whereClause: Option[org.squeryl.dsl.ast.ExpressionNode], sw: org.squeryl.internals.StatementWriter)Unit">writeDelete</a><span class="delimiter">(</span><a href="#10243" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#65488" title="org.squeryl.dsl.ast.QueryExpressionElements">queryAst</a>.<a href="dsl/ast/QueryExpressionElements.scala.html#64217" title="=&gt; Option[org.squeryl.dsl.ast.ExpressionNode]">whereClause</a>, <a href="#65489" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>

    <a href="#36874" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#37039" title="(s: org.squeryl.Session, sw: org.squeryl.internals.StatementWriter)Int">executeUpdateAndCloseStatement</a><span class="delimiter">(</span><a href="Session.scala.html#10079" title="object org.squeryl.Session">Session</a>.<a href="Session.scala.html#36953" title="=&gt; org.squeryl.Session">currentSession</a>, <a href="#65489" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(whereClause: T =&gt; org.squeryl.dsl.ast.LogicalBoolean)(implicit dsl: org.squeryl.dsl.QueryDsl)Int" id="36887">deleteWhere</a><span class="delimiter">(</span><a title="T =&gt; org.squeryl.dsl.ast.LogicalBoolean" id="65516">whereClause</a>: T =&gt; LogicalBoolean<span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.squeryl.dsl.QueryDsl" id="65517">dsl</a>: <a href="dsl/QueryDsl.scala.html#11288" title="org.squeryl.dsl.QueryDsl">QueryDsl</a><span class="delimiter">)</span>: <span title="Int">Int</span> =
    <a href="#36886" title="(q: org.squeryl.Query[T])Int">delete</a><span class="delimiter">(</span><a href="#65517" title="org.squeryl.dsl.QueryDsl">dsl</a>.<a href="dsl/boilerplate/FromSignatures.scala.html#18262" title="(t1: org.squeryl.Queryable[T])(f: T =&gt; org.squeryl.dsl.QueryYield[T])org.squeryl.Query[T]">from</a><span class="delimiter">(</span><a href="#10243" title="org.squeryl.Table[T]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="T" id="65682">t</a> =&gt; <a href="#65517" title="org.squeryl.dsl.QueryDsl">dsl</a>.<a href="dsl/QueryDsl.scala.html#17539" title="(b: =&gt; org.squeryl.dsl.ast.LogicalBoolean)org.squeryl.dsl.fsm.WhereState[org.squeryl.dsl.fsm.Conditioned]">where</a><span class="delimiter">(</span><a href="#65516" title="(v1: T)org.squeryl.dsl.ast.LogicalBoolean">whereClause</a><span class="delimiter">(</span><a href="#65682" title="T">t</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="dsl/fsm/StartState.scala.html#18040" title="(yieldClosure: =&gt; T)org.squeryl.dsl.fsm.SelectState[T]">select</a><span class="delimiter">(</span><a href="#65682" title="T">t</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>      

  <span class="keyword">def</span> <a title="[K](k: K)(implicit ev: &lt;:&lt;[T,org.squeryl.KeyedEntity[K]], implicit dsl: org.squeryl.dsl.QueryDsl)Boolean" id="36888">delete</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="36890">K</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="K" id="65523">k</a>: <a href="#36890" title="K">K</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="&lt;:&lt;[T,org.squeryl.KeyedEntity[K]]" id="65524">ev</a>: T <span title="&lt;:&lt;[T,org.squeryl.KeyedEntity[K]]">&lt;:&lt;</span> KeyedEntity<span class="delimiter">[</span>K<span class="delimiter">]</span>, <a title="org.squeryl.dsl.QueryDsl" id="65525">dsl</a>: <a href="dsl/QueryDsl.scala.html#11288" title="org.squeryl.dsl.QueryDsl">QueryDsl</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span>  = <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#65525" title="org.squeryl.dsl.QueryDsl">dsl</a>._
    <span class="keyword">val</span> <a title="org.squeryl.Query[T]" id="65690">q</a> = <a href="dsl/boilerplate/FromSignatures.scala.html#18262" title="(t1: org.squeryl.Queryable[T])(f: T =&gt; org.squeryl.dsl.QueryYield[T])org.squeryl.Query[T]">from</a><span class="delimiter">(</span><a href="#10243" title="org.squeryl.Table[T]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="T" id="65838">a</a> =&gt; <a href="#65525" title="org.squeryl.dsl.QueryDsl">dsl</a>.<a href="dsl/QueryDsl.scala.html#17539" title="(b: =&gt; org.squeryl.dsl.ast.LogicalBoolean)org.squeryl.dsl.fsm.WhereState[org.squeryl.dsl.fsm.Conditioned]">where</a> <span class="delimiter">{</span>
      <a href="internals/FieldReferenceLinker.scala.html#12686" title="object org.squeryl.internals.FieldReferenceLinker">FieldReferenceLinker</a>.<a href="internals/FieldReferenceLinker.scala.html#20494" title="(e: Any, c: Any)org.squeryl.dsl.ast.LogicalBoolean">createEqualityExpressionWithLastAccessedFieldReferenceAndConstant</a><span class="delimiter">(</span><a href="#65524" title="(v1: T)org.squeryl.KeyedEntity[K]">a</a>.<a href="KeyedEntity.scala.html#13560" title="=&gt; K">id</a>, <a href="#65523" title="K">k</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <a href="dsl/fsm/StartState.scala.html#18040" title="(yieldClosure: =&gt; T)org.squeryl.dsl.fsm.SelectState[T]">select</a><span class="delimiter">(</span><a href="#65838" title="T">a</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Option[T]" id="65692">z</a> = <a href="#65690" title="org.squeryl.Query[T]">q</a>.<a href="Query.scala.html#16341" title="=&gt; Option[T]">headOption</a>

    <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="View.scala.html#22721" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56187" title="=&gt; Boolean">hasBeforeDelete</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#65691" title="=&gt; Option[T]">z</a>.<span title="(f: T =&gt; AnyRef)Option[AnyRef]">map</span><span class="delimiter">(</span><a title="T" id="66668">x</a> =&gt; <a href="View.scala.html#22721" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56192" title="(a: AnyRef)AnyRef">beforeDelete</a><span class="delimiter">(</span><a href="#66668" title="T">x</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="Int" id="65693">deleteCount</a> = <a href="#10243" title="Table.this.type" class="keyword">this</a>.<a href="#36886" title="(q: org.squeryl.Query[T])Int">delete</a><span class="delimiter">(</span><a href="#65690" title="org.squeryl.Query[T]">q</a><span class="delimiter">)</span>

    <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="View.scala.html#22721" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56188" title="=&gt; Boolean">hasAfterDelete</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#65691" title="=&gt; Option[T]">z</a>.<span title="(f: T =&gt; AnyRef)Option[AnyRef]">map</span><span class="delimiter">(</span><a title="T" id="66721">x</a> =&gt; <a href="View.scala.html#22721" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#56193" title="(a: AnyRef)AnyRef">afterDelete</a><span class="delimiter">(</span><a href="#66721" title="T">x</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#65693" title="Int">deleteCount</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(1)" class="int">1</span>, <span title="java.lang.String(&quot;Query :\012&quot;)" class="string">&quot;Query :\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#65690" title="org.squeryl.Query[T]">q</a>.<a href="Query.scala.html#16336" title="=&gt; String">dumpAst</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012should have deleted at most 1 row but has deleted &quot;)" class="string">&quot;\nshould have deleted at most 1 row but has deleted &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#65693" title="Int">deleteCount</a><span class="delimiter">)</span>
    <a href="#65693" title="Int">deleteCount</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(o: T)(implicit ev: &lt;:&lt;[T,org.squeryl.KeyedEntity[_]])T" id="36891">insertOrUpdate</a><span class="delimiter">(</span><a title="T" id="66742">o</a>: <a href="#10340" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]" id="66743">ev</a>: T <span title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]">&lt;:&lt;</span> KeyedEntity<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#10340" title="T">T</a> = <span class="delimiter">{</span>
    <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="#66743" title="(v1: T)org.squeryl.KeyedEntity[_]">o</a>.<a href="KeyedEntity.scala.html#13558" title="=&gt; Boolean">isPersisted</a><span class="delimiter">)</span>
      <a href="#36880" title="(o: T)(implicit ev: &lt;:&lt;[T,org.squeryl.KeyedEntity[_]])Unit">update</a><a href="#66743" title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]" class="delimiter">(</a><a href="#66742" title="T">o</a><span class="delimiter">)</span>
    <span class="keyword">else</span>
      <a href="#36875" title="(t: T)T">insert</a><span class="delimiter">(</span><a href="#66742" title="T">o</a><span class="delimiter">)</span>
    <a href="#66742" title="T">o</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>