<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>org/squeryl/internals/FieldReferenceLinker.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*******************************************************************************
 * Copyright 2010 Maxime LÃ©vesque
 * 
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ***************************************************************************** */</span>
<span class="keyword">package</span> org.squeryl.internals

<span class="keyword">import</span> java.lang.reflect.Method
<span class="keyword">import</span> net.sf.cglib.proxy._
<span class="keyword">import</span> collection.mutable.<span class="delimiter">{</span>HashSet, ArrayBuffer<span class="delimiter">}</span>
<span class="keyword">import</span> org.squeryl.dsl.ast._
<span class="keyword">import</span> org.squeryl.dsl.CompositeKey
<span class="keyword">import</span> java.lang.reflect.<span class="delimiter">{</span>Field, Method<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object org.squeryl.internals.FieldReferenceLinker" id="12686">FieldReferenceLinker</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="keyword">def</span> <a title="[T](e: () =&gt; org.squeryl.dsl.ast.TypedExpressionNode[T])T" id="20471">pushExpressionOrCollectValue</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="20473">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="() =&gt; org.squeryl.dsl.ast.TypedExpressionNode[T]" id="78708">e</a>: <span class="delimiter">(</span><span class="delimiter">)</span>=&gt;TypedExpressionNode<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#20473" title="T">T</a> = <span class="delimiter">{</span>
    <span title="T" class="keyword">if</span> <span class="delimiter">(</span><a href="#20475" title="=&gt; Boolean">isYieldInspectionMode</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" id="100227">yi</a> = <a href="#20489" title="=&gt; java.lang.ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="()org.squeryl.internals.FieldReferenceLinker.YieldInspection">get</span>
      <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.TypedExpressionNode[T]" id="100228">expr</a> = <a href="#100227" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#93123" title="(f: () =&gt; org.squeryl.dsl.ast.TypedExpressionNode[T])org.squeryl.dsl.ast.TypedExpressionNode[T]">callWithoutReentrance</a><span class="delimiter">(</span><a href="#78708" title="() =&gt; org.squeryl.dsl.ast.TypedExpressionNode[T]">e</a><span class="delimiter">)</span>
      <a href="#100227" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#93126" title="(e: org.squeryl.dsl.ast.SelectElement)Unit">addSelectElement</a><span class="delimiter">(</span><span title="org.squeryl.dsl.ast.ValueSelectElement" class="keyword">new</span> <a href="../dsl/ast/SelectElement.scala.html#11565" title="org.squeryl.dsl.ast.ValueSelectElement">ValueSelectElement</a><span class="delimiter">(</span><a href="#100228" title="org.squeryl.dsl.ast.TypedExpressionNode[T]">expr</a>, <a href="#100227" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#93127" title="=&gt; org.squeryl.internals.ResultSetMapper">resultSetMapper</a>, <a href="#100228" title="org.squeryl.dsl.ast.TypedExpressionNode[T]">expr</a>.<a href="../dsl/ast/ExpressionNode.scala.html#20386" title="=&gt; org.squeryl.internals.OutMapper[T]">mapper</a>, <a href="#100227" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#93117" title="=&gt; org.squeryl.dsl.ast.QueryExpressionNode[_]">queryExpressionNode</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="T" id="100229">r</a> = <a href="#100228" title="org.squeryl.dsl.ast.TypedExpressionNode[T]">expr</a>.<a href="../dsl/ast/ExpressionNode.scala.html#20385" title="=&gt; T">sample</a>
      <a href="#100229" title="T">r</a>
    <span class="delimiter">}</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="T" id="100245">r</a> = <a href="#20477" title="=&gt; java.lang.ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]">_yieldValues</a>.<span title="()scala.collection.mutable.ArrayBuffer[AnyRef]">get</span>.<span title="(n: Int)AnyRef">remove</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#20473" title="T">T</a><span class="delimiter">]</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#20477" title="=&gt; java.lang.ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]">_yieldValues</a>.<span title="()scala.collection.mutable.ArrayBuffer[AnyRef]">get</span>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#20477" title="=&gt; java.lang.ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]">_yieldValues</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#100245" title="T">r</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(v: AnyRef)Unit" id="20474">pushYieldValue</a><span class="delimiter">(</span><a title="AnyRef" id="100269">v</a>:<span title="AnyRef">AnyRef</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="scala.collection.mutable.ArrayBuffer[AnyRef]" id="100272">a</a> = <a href="#20477" title="=&gt; java.lang.ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]">_yieldValues</a>.<span title="()scala.collection.mutable.ArrayBuffer[AnyRef]">get</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#100272" title="scala.collection.mutable.ArrayBuffer[AnyRef]">a</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#100272" title="scala.collection.mutable.ArrayBuffer[AnyRef]">a</a> = <span title="()scala.collection.mutable.ArrayBuffer[AnyRef]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[AnyRef]">ArrayBuffer</span><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span>
      <a href="#20477" title="=&gt; java.lang.ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]">_yieldValues</a>.<span title="(x$1: scala.collection.mutable.ArrayBuffer[AnyRef])Unit">set</span><span class="delimiter">(</span><a href="#100272" title="scala.collection.mutable.ArrayBuffer[AnyRef]">a</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#100272" title="scala.collection.mutable.ArrayBuffer[AnyRef]">a</a>.<span title="(elems: AnyRef*)Unit">append</span><span class="delimiter">(</span><a href="#100269" title="AnyRef">v</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="20475">isYieldInspectionMode</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" id="93109">yi</a> = <a href="#20489" title="=&gt; java.lang.ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="()org.squeryl.internals.FieldReferenceLinker.YieldInspection">get</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#93109" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#93109" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#93122" title="=&gt; Boolean">isOn</a>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#20489" title="=&gt; java.lang.ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; org.squeryl.dsl.ast.QueryExpressionNode[_]" id="20476">inspectedQueryExpressionNode</a> = <a href="#20489" title="=&gt; java.lang.ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="()org.squeryl.internals.FieldReferenceLinker.YieldInspection">get</span>.<a href="#93117" title="=&gt; org.squeryl.dsl.ast.QueryExpressionNode[_]">queryExpressionNode</a>
  
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]" id="20477">_yieldValues</a> = <span title="java.lang.ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]" class="keyword">new</span> <span title="java.lang.ThreadLocal[scala.collection.mutable.ArrayBuffer[AnyRef]]">ThreadLocal</span><span class="delimiter">[</span>ArrayBuffer<span class="delimiter">[</span>AnyRef<span class="delimiter">]</span><span class="delimiter">]</span>
  
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.ThreadLocal[Option[org.squeryl.dsl.ast.SelectElement]]" id="20479">__lastAccessedFieldReference</a> = <span title="java.lang.ThreadLocal[Option[org.squeryl.dsl.ast.SelectElement]]" class="keyword">new</span> <span title="java.lang.ThreadLocal[Option[org.squeryl.dsl.ast.SelectElement]]">ThreadLocal</span><span class="delimiter">[</span>Option<span class="delimiter">[</span>SelectElement<span class="delimiter">]</span><span class="delimiter">]</span>

  <span class="keyword">private</span> <span class="delimiter">[</span>squeryl<span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; Option[org.squeryl.dsl.ast.SelectElement]" id="20481">_lastAccessedFieldReference</a>: <span title="Option[org.squeryl.dsl.ast.SelectElement]">Option</span><span class="delimiter">[</span>SelectElement<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Option[org.squeryl.dsl.ast.SelectElement]" id="100287">fr</a> = <a href="#20479" title="=&gt; java.lang.ThreadLocal[Option[org.squeryl.dsl.ast.SelectElement]]">__lastAccessedFieldReference</a>.<span title="()Option[org.squeryl.dsl.ast.SelectElement]">get</span>
    <span title="Option[org.squeryl.dsl.ast.SelectElement]" class="keyword">if</span> <span class="delimiter">(</span><a href="#100287" title="Option[org.squeryl.dsl.ast.SelectElement]">fr</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="object None">None</span> <span class="keyword">else</span> <a href="#100287" title="Option[org.squeryl.dsl.ast.SelectElement]">fr</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="delimiter">[</span>squeryl<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(se: Option[org.squeryl.dsl.ast.SelectElement])Unit" id="20482">_lastAccessedFieldReference_=</a><span class="delimiter">(</span><a title="Option[org.squeryl.dsl.ast.SelectElement]" id="93152">se</a>: <span title="Option[org.squeryl.dsl.ast.SelectElement]">Option</span><span class="delimiter">[</span>SelectElement<span class="delimiter">]</span><span class="delimiter">)</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#93152" title="Option[org.squeryl.dsl.ast.SelectElement]">se</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="object None">None</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#20479" title="=&gt; java.lang.ThreadLocal[Option[org.squeryl.dsl.ast.SelectElement]]">__lastAccessedFieldReference</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#20479" title="=&gt; java.lang.ThreadLocal[Option[org.squeryl.dsl.ast.SelectElement]]">__lastAccessedFieldReference</a>.<span title="(x$1: Option[org.squeryl.dsl.ast.SelectElement])Unit">set</span><span class="delimiter">(</span><a href="#93152" title="Option[org.squeryl.dsl.ast.SelectElement]">se</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]" id="20483">_compositeKeyMembers</a> = <span title="java.lang.ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]" class="keyword">new</span> <span title="java.lang.ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]">ThreadLocal</span><span class="delimiter">[</span>Option<span class="delimiter">[</span>ArrayBuffer<span class="delimiter">[</span>SelectElement<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>

  <span class="comment">/**
   * _lastAccessedFieldReference is unique per thread, AST construction can be nested and can interfere with
   * one another, this method is used for  preserving the previous _lastAccessedFieldReference when a nested
   * AST construction takes place *and* during the construction of 'sample' POSOs, because they are proxied,
   * and can call their intercepted fields during construction, calling the constructor for 'sample' POSO construction
   * without wrapping with this methor would have the effect of 'polluting' the _lastAccessedFieldReference (issue 68). 
   */</span>
  <span class="keyword">def</span> <a title="[A](expressionWithSideEffectsASTConstructionThreadLocalState: =&gt; A)A" id="20485">executeAndRestoreLastAccessedFieldReference</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="20487">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; A" id="65429">expressionWithSideEffectsASTConstructionThreadLocalState</a>: =&gt;A<span class="delimiter">)</span>: <a href="#20487" title="A">A</a> = <span class="delimiter">{</span>
    <span class="comment">// if we are currently building an AST, we must save the (last) _lastAccessedFieldReference</span>
    <span class="keyword">val</span> <a title="Option[org.squeryl.dsl.ast.SelectElement]" id="100292">prev</a> = <a href="#12686" title="object org.squeryl.internals.FieldReferenceLinker">FieldReferenceLinker</a>.<a href="#20481" title="=&gt; Option[org.squeryl.dsl.ast.SelectElement]">_lastAccessedFieldReference</a>
    <span class="keyword">val</span> <a title="A" id="100293">a</a> = <a href="#65429" title="=&gt; A">expressionWithSideEffectsASTConstructionThreadLocalState</a>
    <span class="comment">// and restore it to the previous state (issue19)</span>
    <a href="#12686" title="object org.squeryl.internals.FieldReferenceLinker">FieldReferenceLinker</a>.<a href="#20482" title="(se: Option[org.squeryl.dsl.ast.SelectElement])Unit">_lastAccessedFieldReference</a> = <a href="#100292" title="Option[org.squeryl.dsl.ast.SelectElement]">prev</a>
    <a href="#100293" title="A">a</a>
  <span class="delimiter">}</span>
  
  <span class="keyword">class</span> <a title="class YieldInspection extends java.lang.Object with ScalaObject" id="20488">YieldInspection</a> <a href="#20488" title="ScalaObject" class="delimiter">{</a>
    
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]" id="93111">_utilizedFields</a> = <span title="()scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]">ArrayBuffer</span><span class="delimiter">[</span>SelectElement<span class="delimiter">]</span>
    <span class="keyword">var</span> <a title="Boolean" id="93114">_on</a> = <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">var</span> <a title="org.squeryl.dsl.ast.QueryExpressionNode[_]" id="93117">queryExpressionNode</a>: <a href="../dsl/ast/QueryExpressionNode.scala.html#11772" title="org.squeryl.dsl.ast.QueryExpressionNode[_]">QueryExpressionNode</a><span class="delimiter">[</span>_<span class="delimiter">]</span> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">var</span> <a title="org.squeryl.internals.ResultSetMapper" id="93120">_resultSetMapper</a>: <a href="ResultSetMapper.scala.html#12886" title="org.squeryl.internals.ResultSetMapper">ResultSetMapper</a> = <span title="Null(null)" class="keyword">null</span>

    <span class="keyword">def</span> <a title="=&gt; Boolean" id="93122">isOn</a> = <a href="#93114" title="=&gt; Boolean">_on</a>

    <span class="keyword">def</span> <a title="[U](f: () =&gt; U)U" id="93123">callWithoutReentrance</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="93125">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="() =&gt; U" id="100230">f</a>: <span class="delimiter">(</span><span class="delimiter">)</span>=&gt;U<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Boolean" id="100233">prev</a> = <a href="#93114" title="=&gt; Boolean">_on</a>
      <a href="#93114" title="(x$1: Boolean)Unit">_on</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">val</span> <a title="U" id="100234">res</a> = <a href="#100230" title="()U">f</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#93114" title="(x$1: Boolean)Unit">_on</a> = <a href="#100233" title="Boolean">prev</a>
      <a href="#100234" title="U">res</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(e: org.squeryl.dsl.ast.SelectElement)Unit" id="93126">addSelectElement</a><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.SelectElement" id="93143">e</a>: <a href="../dsl/ast/SelectElement.scala.html#11682" title="org.squeryl.dsl.ast.SelectElement">SelectElement</a><span class="delimiter">)</span> =
      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#93143" title="org.squeryl.dsl.ast.SelectElement">e</a>.<a href="../dsl/ast/SelectElement.scala.html#20678" title="=&gt; Boolean">inhibited</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#93111" title="=&gt; scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]">_utilizedFields</a>.<span title="(elems: org.squeryl.dsl.ast.SelectElement*)Unit">append</span><span class="delimiter">(</span><a href="#93143" title="org.squeryl.dsl.ast.SelectElement">e</a><span class="delimiter">)</span>
        <a href="#93143" title="org.squeryl.dsl.ast.SelectElement">e</a>.<a href="../dsl/ast/SelectElement.scala.html#20676" title="(index: Int)Unit">prepareColumnMapper</a><span class="delimiter">(</span><a href="#93111" title="=&gt; scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]">_utilizedFields</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="=&gt; org.squeryl.internals.ResultSetMapper" id="93127">resultSetMapper</a> = <a href="#93120" title="=&gt; org.squeryl.internals.ResultSetMapper">_resultSetMapper</a>

    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="93129">_reentranceDepth</a> = <span title="Int(0)" class="int">0</span>

     <span class="keyword">def</span> <a title="=&gt; Int" id="93131">reentranceDepth</a> = <a href="#93129" title="=&gt; Int">_reentranceDepth</a>

     <span class="keyword">def</span> <a title="=&gt; Unit" id="93132">incrementReentranceDepth</a> =
       <a href="#93129" title="(x$1: Int)Unit">_reentranceDepth</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>

     <span class="keyword">def</span> <a title="=&gt; Unit" id="93133">decrementReentranceDepth</a> =
       <a href="#93129" title="(x$1: Int)Unit">_reentranceDepth</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>

    <span class="keyword">def</span> <a title="(q: org.squeryl.dsl.ast.QueryExpressionNode[_], rsm: org.squeryl.internals.ResultSetMapper)Unit" id="93134">turnOn</a><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.QueryExpressionNode[_]" id="93759">q</a>: <a href="../dsl/ast/QueryExpressionNode.scala.html#11772" title="org.squeryl.dsl.ast.QueryExpressionNode[_]">QueryExpressionNode</a><span class="delimiter">[</span>_<span class="delimiter">]</span>, <a title="org.squeryl.internals.ResultSetMapper" id="93760">rsm</a>: <a href="ResultSetMapper.scala.html#12886" title="org.squeryl.internals.ResultSetMapper">ResultSetMapper</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#93129" title="(x$1: Int)Unit">_reentranceDepth</a> = <span title="Int(0)" class="int">0</span>
      <a href="#93117" title="(x$1: org.squeryl.dsl.ast.QueryExpressionNode[_])Unit">queryExpressionNode</a> = <a href="#93759" title="org.squeryl.dsl.ast.QueryExpressionNode[_]">q</a>
      <a href="#93114" title="(x$1: Boolean)Unit">_on</a> = <span title="Boolean(true)" class="keyword">true</span>
      <a href="#93120" title="(x$1: org.squeryl.internals.ResultSetMapper)Unit">_resultSetMapper</a> = <a href="#93760" title="org.squeryl.internals.ResultSetMapper">rsm</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; List[org.squeryl.dsl.ast.SelectElement]" id="93135">outExpressions</a>: <span title="List[org.squeryl.dsl.ast.SelectElement]">List</span><span class="delimiter">[</span>SelectElement<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <a href="#93111" title="=&gt; scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]">_utilizedFields</a>.<span title="=&gt; List[org.squeryl.dsl.ast.SelectElement]">toList</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]" id="20489">_yieldInspectionTL</a> = <span title="java.lang.ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]" class="keyword">new</span> <span title="java.lang.ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">ThreadLocal</span><span class="delimiter">[</span>YieldInspection<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="(e: org.squeryl.dsl.ast.SelectElement)Unit" id="20491">putLastAccessedSelectElement</a><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.SelectElement" id="93103">e</a>: <a href="../dsl/ast/SelectElement.scala.html#11682" title="org.squeryl.dsl.ast.SelectElement">SelectElement</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#20475" title="=&gt; Boolean">isYieldInspectionMode</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#20489" title="=&gt; java.lang.ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="()org.squeryl.internals.FieldReferenceLinker.YieldInspection">get</span>.<a href="#93126" title="(e: org.squeryl.dsl.ast.SelectElement)Unit">addSelectElement</a><span class="delimiter">(</span><span title="org.squeryl.dsl.ast.ExportedSelectElement" class="keyword">new</span> <a href="../dsl/ast/SelectElement.scala.html#11649" title="org.squeryl.dsl.ast.ExportedSelectElement">ExportedSelectElement</a><span class="delimiter">(</span><a href="#93103" title="org.squeryl.dsl.ast.SelectElement">e</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span>
    <a href="#20482" title="(se: Option[org.squeryl.dsl.ast.SelectElement])Unit">_lastAccessedFieldReference</a> = <span title="(x: org.squeryl.dsl.ast.SelectElement)Some[org.squeryl.dsl.ast.SelectElement]">Some</span><span class="delimiter">(</span><a href="#93103" title="org.squeryl.dsl.ast.SelectElement">e</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Option[org.squeryl.dsl.ast.SelectElement]" id="20492">takeLastAccessedFieldReference</a>: <span title="Option[org.squeryl.dsl.ast.SelectElement]">Option</span><span class="delimiter">[</span>SelectElement<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Option[org.squeryl.dsl.ast.SelectElement]" id="100320">res</a> = <a href="#20481" title="=&gt; Option[org.squeryl.dsl.ast.SelectElement]">_lastAccessedFieldReference</a>
    <a href="#20482" title="(se: Option[org.squeryl.dsl.ast.SelectElement])Unit">_lastAccessedFieldReference</a> = <span title="object None">None</span>
    <a href="#100320" title="Option[org.squeryl.dsl.ast.SelectElement]">res</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; org.squeryl.dsl.ast.SelectElementReference[_]" id="20493">_takeLastAccessedUntypedFieldReference</a>: <a href="../dsl/ast/SelectElement.scala.html#11568" title="org.squeryl.dsl.ast.SelectElementReference[_]">SelectElementReference</a><span class="delimiter">[</span>_<span class="delimiter">]</span> =
    <a href="#12686" title="object org.squeryl.internals.FieldReferenceLinker">FieldReferenceLinker</a>.<a href="#20492" title="=&gt; Option[org.squeryl.dsl.ast.SelectElement]">takeLastAccessedFieldReference</a> <span title="org.squeryl.dsl.ast.SelectElementReference[Any]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="org.squeryl.dsl.ast.SelectElementReference[Any]">Some</span><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.SelectElement" id="100328">n</a>:<a href="../dsl/ast/SelectElement.scala.html#11682" title="org.squeryl.dsl.ast.SelectElement">SelectElement</a><span class="delimiter">)</span> =&gt; <span title="org.squeryl.dsl.ast.SelectElementReference[Any]" class="keyword">new</span> <a href="../dsl/ast/SelectElement.scala.html#11568" title="org.squeryl.dsl.ast.SelectElementReference[Any]">SelectElementReference</a><span class="delimiter">(</span><a href="#100328" title="org.squeryl.dsl.ast.SelectElement">n</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="ResultSetMapper.scala.html#12809" title="object org.squeryl.internals.NoOpOutMapper">NoOpOutMapper</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Nothing">None</span> =&gt; org.squeryl.internals.<a href="Utils.scala.html#13022" title="object org.squeryl.internals.Utils">Utils</a>.<a href="Utils.scala.html#32775" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Thread local does not have a last accessed field... this is a severe bug !&quot;)" class="string">&quot;Thread local does not have a last accessed field... this is a severe bug !&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(e: Any, c: Any)org.squeryl.dsl.ast.LogicalBoolean" id="20494">createEqualityExpressionWithLastAccessedFieldReferenceAndConstant</a><span class="delimiter">(</span><a title="Any" id="65843">e</a>: <span title="Any">Any</span>, <a title="Any" id="65844">c</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <a href="../dsl/ast/ExpressionNode.scala.html#11586" title="org.squeryl.dsl.ast.LogicalBoolean">LogicalBoolean</a> = <span class="delimiter">{</span>

    <span title="org.squeryl.dsl.ast.LogicalBoolean" class="keyword">if</span><span class="delimiter">(</span><a href="#65843" title="Any">e</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../dsl/CompositeKey.scala.html#11003" title="org.squeryl.dsl.CompositeKey">CompositeKey</a><span class="delimiter">]</span><span class="delimiter">)</span>
      <a href="#65843" title="Any">e</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.CompositeKey" class="delimiter">[</span><a href="../dsl/CompositeKey.scala.html#11003" title="org.squeryl.dsl.CompositeKey">CompositeKey</a><span class="delimiter">]</span>.<a href="../dsl/CompositeKey.scala.html#20817" title="(ck: org.squeryl.dsl.CompositeKey)org.squeryl.dsl.ast.LogicalBoolean">buildEquality</a><span class="delimiter">(</span><a href="#65844" title="Any">c</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.CompositeKey" class="delimiter">[</span><a href="../dsl/CompositeKey.scala.html#11003" title="org.squeryl.dsl.CompositeKey">CompositeKey</a><span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">else</span>
      <a href="#20495" title="(c: Any)org.squeryl.dsl.ast.LogicalBoolean">createEqualityExpressionWithLastAccessedFieldReferenceAndConstant</a><span class="delimiter">(</span><a href="#65844" title="Any">c</a><span class="delimiter">)</span>    
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(c: Any)org.squeryl.dsl.ast.LogicalBoolean" id="20495">createEqualityExpressionWithLastAccessedFieldReferenceAndConstant</a><span class="delimiter">(</span><a title="Any" id="65841">c</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <a href="../dsl/ast/ExpressionNode.scala.html#11586" title="org.squeryl.dsl.ast.LogicalBoolean">LogicalBoolean</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.SelectElementReference[_]" id="100348">fr</a> = <a href="#20493" title="=&gt; org.squeryl.dsl.ast.SelectElementReference[_]">_takeLastAccessedUntypedFieldReference</a>

    <a href="../dsl/ast/ExpressionNode.scala.html#74814" title="org.squeryl.dsl.ast.BinaryOperatorNodeLogicalBoolean" class="keyword">new</a> <a href="../dsl/ast/ExpressionNode.scala.html#11547" title="org.squeryl.dsl.ast.BinaryOperatorNodeLogicalBoolean">BinaryOperatorNodeLogicalBoolean</a><span class="delimiter">(</span>
      <a href="#100348" title="org.squeryl.dsl.ast.SelectElementReference[_]">fr</a>,
      <span title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode[Any]" class="keyword">new</span> <a href="../dsl/ast/ExpressionNode.scala.html#11733" title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode[Any]">InputOnlyConstantExpressionNode</a><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">(</span><a href="#65841" title="Any">c</a><span class="delimiter">)</span>,
      <span title="java.lang.String(&quot;=&quot;)" class="string">&quot;=&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/**
   * It is assumed that yield invocation for inspection will never be nested, since
   * a query is completely built (and it's yield inspection is done) before it can
   * be nested, this is unlikely to change, but documenting this assumption was
   * deemed usefull, because this method would stop working (without complaining)
   * if (the assumption) was broken.   
   */</span>

  <span class="keyword">def</span> <a title="(q: org.squeryl.dsl.ast.QueryExpressionNode[_], rsm: org.squeryl.internals.ResultSetMapper, selectClosure: () =&gt; AnyRef)(List[org.squeryl.dsl.ast.SelectElement], AnyRef)" id="20496">determineColumnsUtilizedInYeldInvocation</a><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.QueryExpressionNode[_]" id="93748">q</a>: <a href="../dsl/ast/QueryExpressionNode.scala.html#11772" title="org.squeryl.dsl.ast.QueryExpressionNode[_]">QueryExpressionNode</a><span class="delimiter">[</span>_<span class="delimiter">]</span>, <a title="org.squeryl.internals.ResultSetMapper" id="93749">rsm</a>: <a href="ResultSetMapper.scala.html#12886" title="org.squeryl.internals.ResultSetMapper">ResultSetMapper</a>, <a title="() =&gt; AnyRef" id="93750">selectClosure</a>: <span class="delimiter">(</span><span class="delimiter">)</span>=&gt;AnyRef<span class="delimiter">)</span> = <span class="delimiter">{</span>
    
    <span class="keyword">val</span> <a title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" id="93753">yi</a> = <span title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" class="keyword">new</span> <a href="#20488" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">YieldInspection</a>
      <a href="#20489" title="=&gt; java.lang.ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="(x$1: org.squeryl.internals.FieldReferenceLinker.YieldInspection)Unit">set</span><span class="delimiter">(</span><a href="#93753" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="(List[org.squeryl.dsl.ast.SelectElement], AnyRef)" id="93754">result</a>:<span title="(List[org.squeryl.dsl.ast.SelectElement], AnyRef)" class="delimiter">(</span>List<span class="delimiter">[</span>SelectElement<span class="delimiter">]</span>,AnyRef<span class="delimiter">)</span> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#93753" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#93134" title="(q: org.squeryl.dsl.ast.QueryExpressionNode[_], rsm: org.squeryl.internals.ResultSetMapper)Unit">turnOn</a><span class="delimiter">(</span><a href="#93748" title="org.squeryl.dsl.ast.QueryExpressionNode[_]">q</a>, <a href="#93749" title="org.squeryl.internals.ResultSetMapper">rsm</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Option[org.squeryl.dsl.ast.SelectElement]" id="93756">prev</a> = <a href="#20481" title="=&gt; Option[org.squeryl.dsl.ast.SelectElement]">_lastAccessedFieldReference</a>
      <span class="keyword">val</span> <a title="AnyRef" id="93757">res0</a> =
        <span class="keyword">try</span> <span class="delimiter">{</span>
          <a href="#93750" title="()AnyRef">selectClosure</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">finally</span> <span class="delimiter">{</span>
          <a href="#20482" title="(se: Option[org.squeryl.dsl.ast.SelectElement])Unit">_lastAccessedFieldReference</a> = <a href="#93756" title="Option[org.squeryl.dsl.ast.SelectElement]">prev</a>
        <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#93757" title="AnyRef">res0</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
        org.squeryl.internals.<a href="Utils.scala.html#13022" title="object org.squeryl.internals.Utils">Utils</a>.<a href="Utils.scala.html#32775" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;query &quot;)" class="string">&quot;query &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#93748" title="org.squeryl.dsl.ast.QueryExpressionNode[_]">q</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; yielded null&quot;)" class="string">&quot; yielded null&quot;</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="java.util.IdentityHashMap[AnyRef,AnyRef]" id="93758">visitedSet</a> = <span title="java.util.IdentityHashMap[AnyRef,AnyRef]" class="keyword">new</span> java.util.<span title="java.util.IdentityHashMap[AnyRef,AnyRef]">IdentityHashMap</span><span class="delimiter">[</span>AnyRef, AnyRef<span class="delimiter">]</span>
        
      <a href="#20499" title="(visited: java.util.IdentityHashMap[AnyRef,AnyRef], yi: org.squeryl.internals.FieldReferenceLinker.YieldInspection, q: org.squeryl.dsl.ast.QueryExpressionElements, o: AnyRef)Unit">_populateSelectColsRecurse</a><span class="delimiter">(</span><a href="#93758" title="java.util.IdentityHashMap[AnyRef,AnyRef]">visitedSet</a>, <a href="#93753" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>, <a href="#93748" title="org.squeryl.dsl.ast.QueryExpressionNode[_]">q</a>, <a href="#93757" title="AnyRef">res0</a><span class="delimiter">)</span>

      <a href="#93754" title="(List[org.squeryl.dsl.ast.SelectElement], AnyRef)">result</a> = <span title="(_1: List[org.squeryl.dsl.ast.SelectElement], _2: AnyRef)(List[org.squeryl.dsl.ast.SelectElement], AnyRef)" class="delimiter">(</span><a href="#93753" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#93135" title="=&gt; List[org.squeryl.dsl.ast.SelectElement]">outExpressions</a>, <a href="#93757" title="AnyRef">res0</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#20489" title="=&gt; java.lang.ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>      
    <span class="delimiter">}</span>
    <a href="#93754" title="(List[org.squeryl.dsl.ast.SelectElement], AnyRef)">result</a>
  <span class="delimiter">}</span>
  
  <span class="comment">/*
   * The theory here is that setting the var is an atomic operation, so
   * it should be ok to perform without synchronization.
   * Worst case scenario would be that one thread overwrites the map
   * created by a previous thread, but since it's just a cache and the fields
   * can be retrieved at any time, that's ok.
   */</span>
  <span class="keyword">private</span> <span class="keyword">object</span> <a title="object org.squeryl.internals.FieldReferenceLinker._declaredFieldCache" id="20497">_declaredFieldCache</a> <span title="ScalaObject" class="delimiter">{</span>
  
	  @volatile <span class="keyword">var</span> <a title="Map[Class[_],Array[java.lang.reflect.Field]]" id="100356">_cache</a>: <span title="Map[Class[_],Array[java.lang.reflect.Field]]">Map</span><span class="delimiter">[</span>Class<span class="delimiter">[</span>_<span class="delimiter">]</span>, Array<span class="delimiter">[</span>Field<span class="delimiter">]</span><span class="delimiter">]</span> =
			  <span title="[A, B](elems: (A, B)*)scala.collection.immutable.Map[A,B]">Map</span><span title="(elems: (Class[_], Array[java.lang.reflect.Field])*)scala.collection.immutable.Map[Class[_],Array[java.lang.reflect.Field]]" class="delimiter">[</span><span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span>, <span title="Array[java.lang.reflect.Field]">Array</span><span class="delimiter">[</span>Field<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    
	  <span class="keyword">def</span> <a title="(cls: Class[_])Array[java.lang.reflect.Field]" id="100358">apply</a><span class="delimiter">(</span><a title="Class[_]" id="100379">cls</a>: <span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span> =
	    <a href="#100356" title="=&gt; Map[Class[_],Array[java.lang.reflect.Field]]">_cache</a>.<span title="(key: Class[_])Option[Array[java.lang.reflect.Field]]">get</span><span class="delimiter">(</span><a href="#100379" title="Class[_]">cls</a><span class="delimiter">)</span> <span title="(default: =&gt; Array[java.lang.reflect.Field])Array[java.lang.reflect.Field]">getOrElse</span> <span class="delimiter">{</span>
	      <span class="keyword">val</span> <a title="Array[java.lang.reflect.Field]" id="100402">declaredFields</a> = <a href="#100379" title="Class[_]">cls</a>.<span title="()Array[java.lang.reflect.Field]">getDeclaredFields</span><span class="delimiter">(</span><span class="delimiter">)</span>
	      <a href="#100356" title="(x$1: Map[Class[_],Array[java.lang.reflect.Field]])Unit">_cache</a> <span title="(kv: (Class[_], Array[java.lang.reflect.Field]))scala.collection.immutable.Map[Class[_],Array[java.lang.reflect.Field]]">+=</span> <span class="delimiter">(</span><span title="(_1: Class[_$7], _2: Array[java.lang.reflect.Field])(Class[_$7], Array[java.lang.reflect.Field])" class="delimiter">(</span><a href="#100379" title="Class[_]">cls</a>, <a href="#100402" title="Array[java.lang.reflect.Field]">declaredFields</a><span class="delimiter">)</span><span class="delimiter">)</span>
	      <a href="#100402" title="Array[java.lang.reflect.Field]">declaredFields</a>
	    <span class="delimiter">}</span>
	  
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(visited: java.util.IdentityHashMap[AnyRef,AnyRef], yi: org.squeryl.internals.FieldReferenceLinker.YieldInspection, q: org.squeryl.dsl.ast.QueryExpressionElements, o: AnyRef)Unit" id="20499">_populateSelectColsRecurse</a><span class="delimiter">(</span><a title="java.util.IdentityHashMap[AnyRef,AnyRef]" id="94039">visited</a>: java.util.<span title="java.util.IdentityHashMap[AnyRef,AnyRef]">IdentityHashMap</span><span class="delimiter">[</span>AnyRef, AnyRef<span class="delimiter">]</span> , <a title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" id="94040">yi</a>: <a href="#20488" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">YieldInspection</a>,<a title="org.squeryl.dsl.ast.QueryExpressionElements" id="94041">q</a>: <a href="../dsl/ast/QueryExpressionElements.scala.html#11562" title="org.squeryl.dsl.ast.QueryExpressionElements">QueryExpressionElements</a>, <a title="AnyRef" id="94042">o</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
	  <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#94042" title="AnyRef">o</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#94042" title="AnyRef">o</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="object None">None</span><span class="delimiter">)</span> <span class="delimiter">{</span>
		  <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#94039" title="java.util.IdentityHashMap[AnyRef,AnyRef]">visited</a>.<span title="(x$1: Any)Boolean">containsKey</span><span class="delimiter">(</span><a href="#94042" title="AnyRef">o</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
			  <span class="keyword">val</span> <a title="java.lang.Class[_ &lt;: AnyRef]" id="100532">clazz</a> = <a href="#94042" title="AnyRef">o</a>.<span title="()java.lang.Class[_]">getClass</span>
			  <span class="keyword">val</span> <a title="java.lang.String" id="100533">clazzName</a> = <a href="#100532" title="java.lang.Class[_ &lt;: AnyRef]">clazz</a>.<span title="()java.lang.String">getName</span>
			  <span class="comment">//println(&quot;Looking at &quot; + clazzName)</span>
			  <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#100533" title="java.lang.String">clazzName</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;java.&quot;)" class="string">&quot;java.&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
					  <span title="=&gt; Boolean">!</span><a href="#100533" title="java.lang.String">clazzName</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;net.sf.cglib.&quot;)" class="string">&quot;net.sf.cglib.&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
					  <span title="=&gt; Boolean">!</span><a href="#100533" title="java.lang.String">clazzName</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;scala.Enumeration&quot;)" class="string">&quot;scala.Enumeration&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
				  <a href="#94039" title="java.util.IdentityHashMap[AnyRef,AnyRef]">visited</a>.<span title="(x$1: AnyRef, x$2: AnyRef)AnyRef">put</span><span class="delimiter">(</span><a href="#94042" title="AnyRef">o</a>,<a href="#94042" title="AnyRef">o</a><span class="delimiter">)</span>
				  <a href="#20500" title="(yi: org.squeryl.internals.FieldReferenceLinker.YieldInspection, q: org.squeryl.dsl.ast.QueryExpressionElements, sample: AnyRef)Unit">_populateSelectCols</a><span class="delimiter">(</span><a href="#94040" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>, <a href="#94041" title="org.squeryl.dsl.ast.QueryExpressionElements">q</a>, <a href="#94042" title="AnyRef">o</a><span class="delimiter">)</span>
				  <span class="keyword">for</span><span class="delimiter">(</span><a title="java.lang.reflect.Field" id="101274">f</a> &lt;- <a href="#100358" title="(cls: Class[_])Array[java.lang.reflect.Field]">_declaredFieldCache</a><span title="(f: java.lang.reflect.Field =&gt; Unit)Unit" class="delimiter">(</span><a href="#100532" title="java.lang.Class[_ &lt;: AnyRef]">clazz</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
					  <a href="#101274" title="java.lang.reflect.Field">f</a>.<span title="(x$1: Boolean)Unit">setAccessible</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>;
					  <span class="keyword">val</span> <a title="java.lang.Object" id="101275">ob</a> = <a href="#101274" title="java.lang.reflect.Field">f</a>.<span title="(x$1: Any)java.lang.Object">get</span><span class="delimiter">(</span><a href="#94042" title="AnyRef">o</a><span class="delimiter">)</span>
					  <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#101274" title="java.lang.reflect.Field">f</a>.<span title="()java.lang.String">getName</span>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;CGLIB$&quot;)" class="string">&quot;CGLIB$&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
					        <span title="=&gt; Boolean">!</span><a href="#101274" title="java.lang.reflect.Field">f</a>.<span title="()java.lang.Class[_]">getType</span>.<span title="()java.lang.String">getName</span>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;scala.Function&quot;)" class="string">&quot;scala.Function&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
					        <span title="=&gt; Boolean">!</span><a href="FieldMetaData.scala.html#12578" title="object org.squeryl.internals.FieldMetaData">FieldMetaData</a>.<a href="FieldMetaData.scala.html#45516" title="=&gt; java.lang.Object with org.squeryl.internals.FieldMetaDataFactory">factory</a>.<a href="FieldMetaData.scala.html#45535" title="(o: AnyRef, f: java.lang.reflect.Field)Boolean">hideFromYieldInspection</a><span class="delimiter">(</span><a href="#94042" title="AnyRef">o</a>, <a href="#101274" title="java.lang.reflect.Field">f</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
						  <a href="#20499" title="(visited: java.util.IdentityHashMap[AnyRef,AnyRef], yi: org.squeryl.internals.FieldReferenceLinker.YieldInspection, q: org.squeryl.dsl.ast.QueryExpressionElements, o: AnyRef)Unit">_populateSelectColsRecurse</a><span class="delimiter">(</span><a href="#94039" title="java.util.IdentityHashMap[AnyRef,AnyRef]">visited</a>, <a href="#94040" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>, <a href="#94041" title="org.squeryl.dsl.ast.QueryExpressionElements">q</a>, <a href="#101275" title="java.lang.Object">ob</a><span class="delimiter">)</span>
					  <span class="delimiter">}</span>
				  <span class="delimiter">}</span>
			  <span class="delimiter">}</span>
		  <span class="delimiter">}</span>
	  <span class="delimiter">}</span>
  
  
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(yi: org.squeryl.internals.FieldReferenceLinker.YieldInspection, q: org.squeryl.dsl.ast.QueryExpressionElements, sample: AnyRef)Unit" id="20500">_populateSelectCols</a><span class="delimiter">(</span><a title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" id="100549">yi</a>: <a href="#20488" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">YieldInspection</a>,<a title="org.squeryl.dsl.ast.QueryExpressionElements" id="100550">q</a>: <a href="../dsl/ast/QueryExpressionElements.scala.html#11562" title="org.squeryl.dsl.ast.QueryExpressionElements">QueryExpressionElements</a>, <a title="AnyRef" id="100551">sample</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Option[org.squeryl.dsl.ast.QueryableExpressionNode]" id="101282">owner</a> = <a href="#20502" title="(sample: AnyRef, q: org.squeryl.dsl.ast.QueryExpressionElements)Option[org.squeryl.dsl.ast.QueryableExpressionNode]">_findQENThatOwns</a><span class="delimiter">(</span><a href="#100551" title="AnyRef">sample</a>, <a href="#100550" title="org.squeryl.dsl.ast.QueryExpressionElements">q</a><span class="delimiter">)</span>
    <a href="#101282" title="Option[org.squeryl.dsl.ast.QueryableExpressionNode]">owner</a> <span title="(f: org.squeryl.dsl.ast.QueryableExpressionNode =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="org.squeryl.dsl.ast.QueryableExpressionNode" id="101290">o</a> =&gt;
      <span class="keyword">for</span><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.SelectElement" id="101309">e</a> &lt;- <a href="#101290" title="org.squeryl.dsl.ast.QueryableExpressionNode">o</a>.<a href="../dsl/ast/ExpressionNode.scala.html#65387" title="(forScope: org.squeryl.dsl.ast.QueryExpressionElements)Iterable[org.squeryl.dsl.ast.SelectElement]">getOrCreateAllSelectElements</a><span title="(f: org.squeryl.dsl.ast.SelectElement =&gt; Unit)Unit" class="delimiter">(</span><a href="#100550" title="org.squeryl.dsl.ast.QueryExpressionElements">q</a><span class="delimiter">)</span><span class="delimiter">)</span>
    	  <a href="#100549" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#93126" title="(e: org.squeryl.dsl.ast.SelectElement)Unit">addSelectElement</a><span class="delimiter">(</span><a href="#101309" title="org.squeryl.dsl.ast.SelectElement">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(s: AnyRef)Option[org.squeryl.dsl.ast.QueryableExpressionNode]" id="20501">findOwnerOfSample</a><span class="delimiter">(</span><a title="AnyRef" id="101312">s</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <span title="Option[org.squeryl.dsl.ast.QueryableExpressionNode]">Option</span><span class="delimiter">[</span>QueryableExpressionNode<span class="delimiter">]</span> =
<span class="comment">// TODO: could we enforce that Query[AnyVal] are not nested in some other way ?   </span>
<span class="comment">//    if(s.isInstanceOf[AnyVal])</span>
<span class="comment">//      org.squeryl.internals.Utils.throwError(&quot;A query that returns a AnyVal cannot be nested &quot; + Utils.failSafeString(FieldReferenceLinker.inspectedQueryExpressionNode.toString))</span>
<span class="comment">//    else</span>
     <a href="#20502" title="(sample: AnyRef, q: org.squeryl.dsl.ast.QueryExpressionElements)Option[org.squeryl.dsl.ast.QueryableExpressionNode]">_findQENThatOwns</a><span class="delimiter">(</span><a href="#101312" title="AnyRef">s</a>, <a href="#12686" title="object org.squeryl.internals.FieldReferenceLinker">FieldReferenceLinker</a>.<a href="#20476" title="=&gt; org.squeryl.dsl.ast.QueryExpressionNode[_]">inspectedQueryExpressionNode</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sample: AnyRef, q: org.squeryl.dsl.ast.QueryExpressionElements)Option[org.squeryl.dsl.ast.QueryableExpressionNode]" id="20502">_findQENThatOwns</a><span class="delimiter">(</span><a title="AnyRef" id="101283">sample</a>: <span title="AnyRef">AnyRef</span>, <a title="org.squeryl.dsl.ast.QueryExpressionElements" id="101284">q</a>: <a href="../dsl/ast/QueryExpressionElements.scala.html#11562" title="org.squeryl.dsl.ast.QueryExpressionElements">QueryExpressionElements</a><span class="delimiter">)</span>: <span title="Option[org.squeryl.dsl.ast.QueryableExpressionNode]">Option</span><span class="delimiter">[</span>QueryableExpressionNode<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <a href="#101284" title="org.squeryl.dsl.ast.QueryExpressionElements">q</a>.<a href="../dsl/ast/ExpressionNode.scala.html#20375" title="[T](implicit manifest: Manifest[T])Iterable[T]">filterDescendantsOfType</a><span title="(implicit manifest: Manifest[org.squeryl.dsl.ast.QueryableExpressionNode])Iterable[org.squeryl.dsl.ast.QueryableExpressionNode]" class="delimiter">[</span><a href="../dsl/ast/ExpressionNode.scala.html#11499" title="org.squeryl.dsl.ast.QueryableExpressionNode">QueryableExpressionNode</a><span class="delimiter">]</span>.<span title="(p: org.squeryl.dsl.ast.QueryableExpressionNode =&gt; Boolean)Option[org.squeryl.dsl.ast.QueryableExpressionNode]">find</span><span class="delimiter">(</span><a href="#101333" title="org.squeryl.dsl.ast.QueryableExpressionNode">_</a>.<a href="../dsl/ast/ExpressionNode.scala.html#65384" title="(aSample: AnyRef)Boolean">owns</a><span class="delimiter">(</span><a href="#101283" title="AnyRef">sample</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(v: org.squeryl.dsl.ast.ViewExpressionNode[_])net.sf.cglib.proxy.Callback" id="20503">createCallBack</a><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.ViewExpressionNode[_]" id="65436">v</a>: <a href="../dsl/ast/ViewExpressionNode.scala.html#11532" title="org.squeryl.dsl.ast.ViewExpressionNode[_]">ViewExpressionNode</a><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="net.sf.cglib.proxy.Callback">Callback</span> =
    <span title="org.squeryl.internals.FieldReferenceLinker.PosoPropertyAccessInterceptor" class="keyword">new</span> <a href="#20504" title="org.squeryl.internals.FieldReferenceLinker.PosoPropertyAccessInterceptor">PosoPropertyAccessInterceptor</a><span class="delimiter">(</span><a href="#65436" title="org.squeryl.dsl.ast.ViewExpressionNode[_]">v</a><span class="delimiter">)</span>
  
  <span class="keyword">private</span> <span class="keyword">class</span> <a title="class PosoPropertyAccessInterceptor extends java.lang.Object with net.sf.cglib.proxy.MethodInterceptor with ScalaObject" id="20504">PosoPropertyAccessInterceptor</a><a href="#20504" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="org.squeryl.dsl.ast.ViewExpressionNode[_]" id="101347">viewExpressionNode</a>: <a href="../dsl/ast/ViewExpressionNode.scala.html#11532" title="org.squeryl.dsl.ast.ViewExpressionNode[_]">ViewExpressionNode</a><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="net.sf.cglib.proxy.MethodInterceptor">MethodInterceptor</span> <span class="delimiter">{</span>

      <span class="keyword">def</span> <a title="(m: java.lang.reflect.Method)Option[org.squeryl.internals.FieldMetaData]" id="101344">fmd4Method</a><span class="delimiter">(</span><a title="java.lang.reflect.Method" id="101364">m</a>: <span title="java.lang.reflect.Method">Method</span><span class="delimiter">)</span> =
        <a href="#101347" title="=&gt; org.squeryl.dsl.ast.ViewExpressionNode[_]">viewExpressionNode</a>.<a href="../dsl/ast/ViewExpressionNode.scala.html#65390" title="(=&gt; org.squeryl.View[_$9]) forSome { type _$9 }">view</a>.<a href="../View.scala.html#22727" title="(name: String)Option[org.squeryl.internals.FieldMetaData]">findFieldMetaDataForProperty</a><span class="delimiter">(</span><a href="#101364" title="java.lang.reflect.Method">m</a>.<span title="()java.lang.String">getName</span><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(o: java.lang.Object, m: java.lang.reflect.Method, args: Array[java.lang.Object], proxy: net.sf.cglib.proxy.MethodProxy)java.lang.Object" id="101345">intercept</a><span class="delimiter">(</span><a title="java.lang.Object" id="101369">o</a>: <span title="java.lang.Object">Object</span>, <a title="java.lang.reflect.Method" id="101370">m</a>: <span title="java.lang.reflect.Method">Method</span>, <a title="Array[java.lang.Object]" id="101371">args</a>: <span title="Array[java.lang.Object]">Array</span><span class="delimiter">[</span>Object<span class="delimiter">]</span>, <a title="net.sf.cglib.proxy.MethodProxy" id="101372">proxy</a>: <span title="net.sf.cglib.proxy.MethodProxy">MethodProxy</span><span class="delimiter">)</span>: <span title="java.lang.Object">Object</span> = <span class="delimiter">{</span>

        <span class="keyword">val</span> <a title="Option[org.squeryl.internals.FieldMetaData]" id="101634">fmd</a> = <a href="#101344" title="(m: java.lang.reflect.Method)Option[org.squeryl.internals.FieldMetaData]">fmd4Method</a><span class="delimiter">(</span><a href="#101370" title="java.lang.reflect.Method">m</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" id="101635">yi</a> = <span title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" class="keyword">if</span> <span class="delimiter">(</span><a href="#20475" title="=&gt; Boolean">isYieldInspectionMode</a><span class="delimiter">)</span> <a href="#20489" title="=&gt; java.lang.ThreadLocal[org.squeryl.internals.FieldReferenceLinker.YieldInspection]">_yieldInspectionTL</a>.<span title="()org.squeryl.internals.FieldReferenceLinker.YieldInspection">get</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
        <span class="keyword">val</span> <a title="Boolean" id="101636">isComposite</a> =
          classOf<span title="java.lang.Class[org.squeryl.dsl.CompositeKey](classOf[org.squeryl.dsl.CompositeKey])" class="delimiter">[</span>CompositeKey<span class="delimiter">]</span>.<span title="(x$1: java.lang.Class[_])Boolean">isAssignableFrom</span><span class="delimiter">(</span><a href="#101370" title="java.lang.reflect.Method">m</a>.<span title="()java.lang.Class[_]">getReturnType</span><span class="delimiter">)</span>

        <span class="keyword">try</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#101634" title="Option[org.squeryl.internals.FieldMetaData]">fmd</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="object None">None</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#101635" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
            <a href="#101635" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#93132" title="=&gt; Unit">incrementReentranceDepth</a>

          <a href="#101346" title="(o: java.lang.Object, m: java.lang.reflect.Method, args: Array[java.lang.Object], proxy: net.sf.cglib.proxy.MethodProxy, fmd: Option[org.squeryl.internals.FieldMetaData], yi: org.squeryl.internals.FieldReferenceLinker.YieldInspection, isComposite: Boolean)java.lang.Object">_intercept</a><span class="delimiter">(</span><a href="#101369" title="java.lang.Object">o</a>, <a href="#101370" title="java.lang.reflect.Method">m</a>, <a href="#101371" title="Array[java.lang.Object]">args</a>, <a href="#101372" title="net.sf.cglib.proxy.MethodProxy">proxy</a>, <a href="#101634" title="Option[org.squeryl.internals.FieldMetaData]">fmd</a>, <a href="#101635" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>, <a href="#101636" title="Boolean">isComposite</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">finally</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#101634" title="Option[org.squeryl.internals.FieldMetaData]">fmd</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="object None">None</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#101635" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
            <a href="#101635" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#93133" title="=&gt; Unit">decrementReentranceDepth</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">private</span> <span class="keyword">def</span> <a title="(o: java.lang.Object, m: java.lang.reflect.Method, args: Array[java.lang.Object], proxy: net.sf.cglib.proxy.MethodProxy, fmd: Option[org.squeryl.internals.FieldMetaData], yi: org.squeryl.internals.FieldReferenceLinker.YieldInspection, isComposite: Boolean)java.lang.Object" id="101346">_intercept</a><span class="delimiter">(</span><a title="java.lang.Object" id="101647">o</a>: <span title="java.lang.Object">Object</span>, <a title="java.lang.reflect.Method" id="101648">m</a>: <span title="java.lang.reflect.Method">Method</span>, <a title="Array[java.lang.Object]" id="101649">args</a>: <span title="Array[java.lang.Object]">Array</span><span class="delimiter">[</span>Object<span class="delimiter">]</span>, <a title="net.sf.cglib.proxy.MethodProxy" id="101650">proxy</a>: <span title="net.sf.cglib.proxy.MethodProxy">MethodProxy</span>, <a title="Option[org.squeryl.internals.FieldMetaData]" id="101651">fmd</a>: <span title="Option[org.squeryl.internals.FieldMetaData]">Option</span><span class="delimiter">[</span>FieldMetaData<span class="delimiter">]</span>, <a title="org.squeryl.internals.FieldReferenceLinker.YieldInspection" id="101652">yi</a>: <a href="#20488" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">YieldInspection</a>, <a title="Boolean" id="101653">isComposite</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="java.lang.Object">Object</span> = <span class="delimiter">{</span>

        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#101653" title="Boolean">isComposite</a><span class="delimiter">)</span>
          <a href="#20483" title="=&gt; java.lang.ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]">_compositeKeyMembers</a>.<span title="(x$1: Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]])Unit">set</span><span class="delimiter">(</span><span title="(x: scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement])Some[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]">Some</span><span class="delimiter">(</span><span title="()scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]">ArrayBuffer</span><span class="delimiter">[</span>SelectElement<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">var</span> <a title="java.lang.Object" id="101663">res</a> = <a href="#101650" title="net.sf.cglib.proxy.MethodProxy">proxy</a>.<span title="(x$1: Any, x$2: Array[java.lang.Object])java.lang.Object">invokeSuper</span><span class="delimiter">(</span><a href="#101647" title="java.lang.Object">o</a>, <a href="#101649" title="Array[java.lang.Object]">args</a><span class="delimiter">)</span>;

        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#101653" title="Boolean">isComposite</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="org.squeryl.dsl.CompositeKey" id="101677">ck</a> = <a href="#101663" title="java.lang.Object">res</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.CompositeKey" class="delimiter">[</span><a href="../dsl/CompositeKey.scala.html#11003" title="org.squeryl.dsl.CompositeKey">CompositeKey</a><span class="delimiter">]</span>
          <a href="#101677" title="org.squeryl.dsl.CompositeKey">ck</a>.<a href="../dsl/CompositeKey.scala.html#20809" title="(x$1: Option[Seq[org.squeryl.dsl.ast.SelectElementReference[Any]]])Unit">_members</a> = <span title="(x: Seq[org.squeryl.dsl.ast.SelectElementReference[Any]])Some[Seq[org.squeryl.dsl.ast.SelectElementReference[Any]]]">Some</span><span class="delimiter">(</span><a href="#20483" title="=&gt; java.lang.ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]">_compositeKeyMembers</a>.<span title="()Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]">get</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]">get</span>.<span title="(f: org.squeryl.dsl.ast.SelectElement =&gt; org.squeryl.dsl.ast.SelectElementReference[Any])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement],org.squeryl.dsl.ast.SelectElementReference[Any],Seq[org.squeryl.dsl.ast.SelectElementReference[Any]]])Seq[org.squeryl.dsl.ast.SelectElementReference[Any]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,org.squeryl.dsl.ast.SelectElementReference[Any],scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElementReference[Any]]]" class="delimiter">(</span><span title="org.squeryl.dsl.ast.SelectElementReference[Any]" class="keyword">new</span> <a href="../dsl/ast/SelectElement.scala.html#11568" title="org.squeryl.dsl.ast.SelectElementReference[Any]">SelectElementReference</a><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">(</span><a href="#101715" title="org.squeryl.dsl.ast.SelectElement">_</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="ResultSetMapper.scala.html#12809" title="object org.squeryl.internals.NoOpOutMapper">NoOpOutMapper</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#101677" title="org.squeryl.dsl.CompositeKey">ck</a>.<a href="../dsl/CompositeKey.scala.html#20812" title="(x$1: Option[String])Unit">_propertyName</a> = <span title="(x: java.lang.String)Some[java.lang.String]">Some</span><span class="delimiter">(</span><a href="#101648" title="java.lang.reflect.Method">m</a>.<span title="()java.lang.String">getName</span><span class="delimiter">)</span>
          <a href="#20483" title="=&gt; java.lang.ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]">_compositeKeyMembers</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#101648" title="java.lang.reflect.Method">m</a>.<span title="()java.lang.String">getName</span>.<span title="(x$1: Any)Boolean">equals</span><span class="delimiter">(</span><span title="java.lang.String(&quot;toString&quot;)" class="string">&quot;toString&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#101648" title="java.lang.reflect.Method">m</a>.<span title="()Array[java.lang.Class[_]]">getParameterTypes</span>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
          <a href="#101663" title="java.lang.Object">res</a> = <span title="java.lang.String(&quot;sample:&quot;)" class="string">&quot;sample:&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#101347" title="=&gt; org.squeryl.dsl.ast.ViewExpressionNode[_]">viewExpressionNode</a>.<a href="../dsl/ast/ViewExpressionNode.scala.html#65390" title="(=&gt; org.squeryl.View[_$9]) forSome { type _$9 }">view</a>.<a href="../View.scala.html#22723" title="=&gt; String">name</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;[&quot;)" class="string">&quot;[&quot;</span><span title="(x$1: Any)java.lang.String">+</span><span title="object java.lang.Integer">Integer</span>.<span title="(x$1: Int)java.lang.String">toHexString</span><span class="delimiter">(</span><span title="object java.lang.System">System</span>.<span title="(x$1: Any)Int">identityHashCode</span><span class="delimiter">(</span><a href="#101647" title="java.lang.Object">o</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span>

        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#101651" title="Option[org.squeryl.internals.FieldMetaData]">fmd</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="object None">None</span><span class="delimiter">)</span> <span class="delimiter">{</span>

          <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#101652" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>  <a href="#101652" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#93131" title="=&gt; Int">reentranceDepth</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
            <a href="#101652" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#93126" title="(e: org.squeryl.dsl.ast.SelectElement)Unit">addSelectElement</a><span class="delimiter">(</span><a href="#101347" title="=&gt; org.squeryl.dsl.ast.ViewExpressionNode[_]">viewExpressionNode</a>.<a href="../dsl/ast/ViewExpressionNode.scala.html#65399" title="(fmd: org.squeryl.internals.FieldMetaData, forScope: org.squeryl.dsl.ast.QueryExpressionElements)org.squeryl.dsl.ast.SelectElement">getOrCreateSelectElement</a><span class="delimiter">(</span><a href="#101651" title="Option[org.squeryl.internals.FieldMetaData]">fmd</a>.<span title="=&gt; org.squeryl.internals.FieldMetaData">get</span>, <a href="#101652" title="org.squeryl.internals.FieldReferenceLinker.YieldInspection">yi</a>.<a href="#93117" title="=&gt; org.squeryl.dsl.ast.QueryExpressionNode[_]">queryExpressionNode</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#20483" title="=&gt; java.lang.ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]">_compositeKeyMembers</a>.<span title="()Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]">get</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#20483" title="=&gt; java.lang.ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]">_compositeKeyMembers</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
            <a href="#20482" title="(se: Option[org.squeryl.dsl.ast.SelectElement])Unit">_lastAccessedFieldReference</a> = <span title="(x: org.squeryl.dsl.ast.SelectElement)Some[org.squeryl.dsl.ast.SelectElement]">Some</span><span class="delimiter">(</span><a href="#101347" title="=&gt; org.squeryl.dsl.ast.ViewExpressionNode[_]">viewExpressionNode</a>.<a href="../dsl/ast/ViewExpressionNode.scala.html#65398" title="(fmd: org.squeryl.internals.FieldMetaData)org.squeryl.dsl.ast.SelectElement">getOrCreateSelectElement</a><span class="delimiter">(</span><a href="#101651" title="Option[org.squeryl.internals.FieldMetaData]">fmd</a>.<span title="=&gt; org.squeryl.internals.FieldMetaData">get</span><span class="delimiter">)</span><span class="delimiter">)</span>;
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <a href="#20483" title="=&gt; java.lang.ThreadLocal[Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]]">_compositeKeyMembers</a>.<span title="()Option[scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]]">get</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[org.squeryl.dsl.ast.SelectElement]">get</span>.<span title="(elems: org.squeryl.dsl.ast.SelectElement*)Unit">append</span><span class="delimiter">(</span><a href="#101347" title="=&gt; org.squeryl.dsl.ast.ViewExpressionNode[_]">viewExpressionNode</a>.<a href="../dsl/ast/ViewExpressionNode.scala.html#65398" title="(fmd: org.squeryl.internals.FieldMetaData)org.squeryl.dsl.ast.SelectElement">getOrCreateSelectElement</a><span class="delimiter">(</span><a href="#101651" title="Option[org.squeryl.internals.FieldMetaData]">fmd</a>.<span title="=&gt; org.squeryl.internals.FieldMetaData">get</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <a href="#101663" title="java.lang.Object">res</a>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>