<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>main/org/squeryl/Table.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*******************************************************************************
 * Copyright 2010 Maxime LÃ©vesque
 * 
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ***************************************************************************** */</span>
<span class="keyword">package</span> org.squeryl;

<span class="keyword">import</span> dsl.ast._
<span class="keyword">import</span> dsl.<span class="delimiter">{</span>CompositeKey, QueryDsl<span class="delimiter">}</span>
<span class="keyword">import</span> internals._
<span class="keyword">import</span> java.sql.<span class="delimiter">{</span>Statement<span class="delimiter">}</span>
<span class="keyword">import</span> logging.StackMarker
<span class="keyword">import</span> scala.reflect.Manifest
<span class="keyword">import</span> collection.mutable.ArrayBuffer
<span class="keyword">import</span> javax.swing.<span title="object javax.swing.UIDefaults">UIDefaults</span>.LazyValue

<span class="keyword">private</span> <span class="delimiter">[</span>squeryl<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object org.squeryl.DummySchema" id="9864">DummySchema</a> <span title="ScalaObject" class="keyword">extends</span> <a href="Schema.scala.html#9839" title="org.squeryl.Schema">Schema</a>

<span class="keyword">class</span> <a title="class Table[T] extends org.squeryl.View[T] with ScalaObject" id="9866">Table</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="9867">T</a><span class="delimiter">]</span> <a href="#9866" title="ScalaObject" class="keyword">private</a> <span class="delimiter">[</span>squeryl<span class="delimiter">]</span> <span class="delimiter">(</span><a title="String" id="49212">n</a>: <span title="String">String</span>, <a title="Class[T]" id="49213">c</a>: <span title="Class[T]">Class</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="org.squeryl.Schema" id="49214">schema</a>: <a href="Schema.scala.html#9839" title="org.squeryl.Schema">Schema</a>, <a title="Option[String]" id="49215">_prefix</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="View.scala.html#9874" title="org.squeryl.View[T]">View</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">(</span><a href="#49212" title="String">n</a>, <a href="#49213" title="Class[T]">c</a>, <a href="#49214" title="org.squeryl.Schema">schema</a>, <a href="#49215" title="Option[String]">_prefix</a><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(n: String)(implicit manifestT: scala.reflect.Manifest[T])org.squeryl.Table[T]" id="34600" class="keyword">this</a><span class="delimiter">(</span><a title="String" id="49209">n</a>:<span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.reflect.Manifest[T]" id="49210">manifestT</a>: <span title="scala.reflect.Manifest[T]">Manifest</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="#9866" title="Table.this.type" class="keyword">this</a><span class="delimiter">(</span><a href="#49209" title="String">n</a>, <a href="#49210" title="scala.reflect.Manifest[T]">manifestT</a>.<span title="=&gt; java.lang.Class[_]">erasure</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Class[T]" class="delimiter">[</span><span title="Class[T]">Class</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span>, <a href="#9864" title="object org.squeryl.DummySchema">DummySchema</a>, <span title="object None">None</span><span class="delimiter">)</span>  

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; org.squeryl.internals.DatabaseAdapter" id="34601">_dbAdapter</a> = <a href="Session.scala.html#9848" title="object org.squeryl.Session">Session</a>.<a href="Session.scala.html#34680" title="=&gt; org.squeryl.Session">currentSession</a>.<a href="Session.scala.html#34691" title="=&gt; org.squeryl.internals.DatabaseAdapter">databaseAdapter</a>

  <span class="keyword">def</span> <a title="(t: T)T" id="34602">insert</a><span class="delimiter">(</span><a title="T" id="55048">t</a>: <a href="#9867" title="T">T</a><span class="delimiter">)</span>: <a href="#9867" title="T">T</a> = <a href="logging/StatisticsListener.scala.html#10858" title="object org.squeryl.logging.StackMarker">StackMarker</a>.<a href="logging/StatisticsListener.scala.html#59916" title="(a: =&gt; T)T">lastSquerylStackFrame</a> <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="AnyRef" id="59925">o</a> = <a href="View.scala.html#20448" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#53917" title="(a: AnyRef)AnyRef">beforeInsert</a><span class="delimiter">(</span><a href="#55048" title="T">t</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.squeryl.Session" id="59926">sess</a> = <a href="Session.scala.html#9848" title="object org.squeryl.Session">Session</a>.<a href="Session.scala.html#34680" title="=&gt; org.squeryl.Session">currentSession</a>
    <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="59927">sw</a> = <a href="internals/StatementWriter.scala.html#38368" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#10817" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#34601" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a><span class="delimiter">)</span>
    <a href="#34601" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#34769" title="(o: T, t: org.squeryl.Table[T], sw: org.squeryl.internals.StatementWriter)Unit">writeInsert</a><span class="delimiter">(</span><a href="#59925" title="AnyRef">o</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#9867" title="T">T</a><span class="delimiter">]</span>, <a href="#9866" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#59927" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="java.sql.PreparedStatement" id="59928">st</a> =
      <span title="(_1: Boolean, _2: Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]])(Boolean, Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]])" class="delimiter">(</span><a href="#34601" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#34747" title="=&gt; Boolean">supportsAutoIncrementInColumnDeclaration</a>, <a href="View.scala.html#20455" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#34990" title="=&gt; Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]]">primaryKey</a><span class="delimiter">)</span> <span title="java.sql.PreparedStatement" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="java.sql.PreparedStatement" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <a title="Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]]" id="60372">a</a>:<span title="Any">Any</span><span class="delimiter">)</span> =&gt; <a href="#59926" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#34689" title="=&gt; java.sql.Connection">connection</a>.<span title="(x$1: java.lang.String, x$2: Int)java.sql.PreparedStatement">prepareStatement</span><span class="delimiter">(</span><a href="#59927" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#38377" title="=&gt; java.lang.String">statement</a>, Statement.<span title="Int(1)">RETURN_GENERATED_KEYS</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="java.sql.PreparedStatement" class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, Some<span class="delimiter">(</span>Left<span class="delimiter">(</span><a title="org.squeryl.internals.FieldMetaData" id="60550">pk</a>:<a href="internals/FieldMetaData.scala.html#10742" title="org.squeryl.internals.FieldMetaData">FieldMetaData</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Array[String]" id="60551">autoIncPk</a> = <span title="Array[String]" class="keyword">new</span> <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <a href="#60551" title="(i: Int, x: String)Unit">autoIncPk</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> = <a href="#60550" title="org.squeryl.internals.FieldMetaData">pk</a>.<a href="internals/FieldMetaData.scala.html#46131" title="=&gt; String">columnName</a>
          <a href="#59926" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#34689" title="=&gt; java.sql.Connection">connection</a>.<span title="(x$1: java.lang.String, x$2: Array[java.lang.String])java.sql.PreparedStatement">prepareStatement</span><span class="delimiter">(</span><a href="#59927" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#38377" title="=&gt; java.lang.String">statement</a>, <a href="#60551" title="Array[String]">autoIncPk</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <a title="java.sql.PreparedStatement" id="60560">a</a>:<span title="Any">Any</span> =&gt; <a href="#59926" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#34689" title="=&gt; java.sql.Connection">connection</a>.<span title="(x$1: java.lang.String)java.sql.PreparedStatement">prepareStatement</span><span class="delimiter">(</span><a href="#59927" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#38377" title="=&gt; java.lang.String">statement</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>        

    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="60563">cnt</a> = <a href="#34601" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#34767" title="(s: org.squeryl.Session, sw: org.squeryl.internals.StatementWriter, ps: java.sql.PreparedStatement)Int">executeUpdateForInsert</a><span class="delimiter">(</span><a href="#59926" title="org.squeryl.Session">sess</a>, <a href="#59927" title="org.squeryl.internals.StatementWriter">sw</a>, <a href="#59928" title="java.sql.PreparedStatement">st</a><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#60563" title="Int">cnt</a> <span title="(x: Int)Boolean">!=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        org.squeryl.internals.<a href="internals/Utils.scala.html#10829" title="object org.squeryl.internals.Utils">Utils</a>.<a href="internals/Utils.scala.html#30502" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;failed to insert&quot;)" class="string">&quot;failed to insert&quot;</span><span class="delimiter">)</span>

      <a href="View.scala.html#20455" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#34990" title="=&gt; Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]]">primaryKey</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span>Left<span class="delimiter">(</span><a title="org.squeryl.internals.FieldMetaData" id="60605">pk</a>:<a href="internals/FieldMetaData.scala.html#10742" title="org.squeryl.internals.FieldMetaData">FieldMetaData</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#60605" title="org.squeryl.internals.FieldMetaData">pk</a>.<a href="internals/FieldMetaData.scala.html#46138" title="=&gt; Boolean">isAutoIncremented</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="java.sql.ResultSet" id="60617">rs</a> = <a href="#59928" title="java.sql.PreparedStatement">st</a>.<span title="()java.sql.ResultSet">getGeneratedKeys</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#60617" title="java.sql.ResultSet">rs</a>.<span title="()Boolean">next</span>,
              <span class="string">&quot;getGeneratedKeys returned no rows for the auto incremented\n&quot;</span><span title="java.lang.String(&quot;getGeneratedKeys returned no rows for the auto incremented\012 primary key of table \'&quot;)">+</span>
              <span class="string">&quot; primary key of table '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="View.scala.html#20450" title="=&gt; String">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\' JDBC3 feature might not be supported, \012 or&quot;)" class="string">&quot;' JDBC3 feature might not be supported, \n or&quot;</span><span title="(x$1: Any)java.lang.String">+</span>
              <span title="java.lang.String(&quot; column might not be defined as auto increment&quot;)" class="string">&quot; column might not be defined as auto increment&quot;</span><span class="delimiter">)</span>
            <a href="#60605" title="org.squeryl.internals.FieldMetaData">pk</a>.<a href="internals/FieldMetaData.scala.html#46142" title="(target: AnyRef, rs: java.sql.ResultSet, index: Int)Unit">setFromResultSet</a><span class="delimiter">(</span><a href="#59925" title="AnyRef">o</a>, <a href="#60617" title="java.sql.ResultSet">rs</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">finally</span> <span class="delimiter">{</span>
            <a href="#60617" title="java.sql.ResultSet">rs</a>.<span title="()Unit">close</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <a title="Unit" id="61496">a</a>:<span title="Any">Any</span> =&gt;<span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#59928" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">close</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="T" id="59929">r</a> = <a href="View.scala.html#20448" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#53918" title="(a: AnyRef)AnyRef">afterInsert</a><span class="delimiter">(</span><a href="#59925" title="AnyRef">o</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#9867" title="T">T</a><span class="delimiter">]</span>

    <a href="View.scala.html#20460" title="(v1: T)Unit">_setPersisted</a><span class="delimiter">(</span><a href="#59929" title="T">r</a><span class="delimiter">)</span>

    <a href="#59929" title="T">r</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(t: org.squeryl.Query[T])Nothing" id="34603">insert</a><span class="delimiter">(</span><a title="org.squeryl.Query[T]" id="55044">t</a>: <a href="Query.scala.html#9818" title="org.squeryl.Query[T]">Query</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> = org.squeryl.internals.<a href="internals/Utils.scala.html#10829" title="object org.squeryl.internals.Utils">Utils</a>.<a href="internals/Utils.scala.html#30502" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;not implemented&quot;)" class="string">&quot;not implemented&quot;</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(e: Iterable[T])Unit" id="34604">insert</a><span class="delimiter">(</span><a title="Iterable[T]" id="55041">e</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> =
    <a href="#34605" title="(e: Iterable[T], fmdCallback: T =&gt; Iterable[org.squeryl.internals.FieldMetaData], isInsert: Boolean, checkOCC: Boolean)Unit">_batchedUpdateOrInsert</a><span class="delimiter">(</span><a href="#55041" title="Iterable[T]">e</a>, <a title="T" id="61510">t</a> =&gt; <a href="View.scala.html#20455" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#34988" title="=&gt; Iterable[org.squeryl.internals.FieldMetaData]">fieldsMetaData</a>.<span title="(p: org.squeryl.internals.FieldMetaData =&gt; Boolean)Iterable[org.squeryl.internals.FieldMetaData]">filter</span><span class="delimiter">(</span><a title="org.squeryl.internals.FieldMetaData" id="61514">fmd</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#61514" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#46138" title="=&gt; Boolean">isAutoIncremented</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#61514" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#46139" title="=&gt; Boolean">isInsertable</a><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

  <span class="comment">/**
   * isInsert if statement is insert otherwise update
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(e: Iterable[T], fmdCallback: T =&gt; Iterable[org.squeryl.internals.FieldMetaData], isInsert: Boolean, checkOCC: Boolean)Unit" id="34605">_batchedUpdateOrInsert</a><span class="delimiter">(</span><a title="Iterable[T]" id="61504">e</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="T =&gt; Iterable[org.squeryl.internals.FieldMetaData]" id="61505">fmdCallback</a>: T =&gt; Iterable<span class="delimiter">[</span>FieldMetaData<span class="delimiter">]</span>, <a title="Boolean" id="61506">isInsert</a>: <span title="Boolean">Boolean</span>, <a title="Boolean" id="61507">checkOCC</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> = <span class="delimiter">{</span>
    
    <span class="keyword">val</span> <a title="Iterator[T]" id="61526">it</a> = <a href="#61504" title="Iterable[T]">e</a>.<span title="=&gt; Iterator[T]">iterator</span>

    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#61526" title="Iterator[T]">it</a>.<span title="=&gt; Boolean">hasNext</span><span class="delimiter">)</span> <span class="delimiter">{</span>

      <span class="keyword">val</span> <a title="T" id="61527">e0</a> = <a href="#61526" title="Iterator[T]">it</a>.<span title="()T">next</span>
      <span class="keyword">val</span> <a title="Iterable[org.squeryl.internals.FieldMetaData]" id="61528">fmds</a> = <a href="#61505" title="(v1: T)Iterable[org.squeryl.internals.FieldMetaData]">fmdCallback</a><span class="delimiter">(</span><a href="#61527" title="T">e0</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="org.squeryl.Session" id="61529">sess</a> = <a href="Session.scala.html#9848" title="object org.squeryl.Session">Session</a>.<a href="Session.scala.html#34680" title="=&gt; org.squeryl.Session">currentSession</a>
      <span class="keyword">val</span> <a title="org.squeryl.internals.DatabaseAdapter" id="61530">dba</a> = <a href="#34601" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>
      <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="61531">sw</a> = <a href="internals/StatementWriter.scala.html#38368" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#10817" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#61530" title="org.squeryl.internals.DatabaseAdapter">dba</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[AnyRef]" id="61532">forAfterUpdateOrInsert</a> = <span title="()scala.collection.mutable.ArrayBuffer[AnyRef]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[AnyRef]">ArrayBuffer</span><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#61506" title="Boolean">isInsert</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="AnyRef" id="61539">z</a> = <a href="View.scala.html#20448" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#53917" title="(a: AnyRef)AnyRef">beforeInsert</a><span class="delimiter">(</span><a href="#61527" title="T">e0</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
        <a href="#61532" title="scala.collection.mutable.ArrayBuffer[AnyRef]">forAfterUpdateOrInsert</a>.<span title="(elems: AnyRef*)Unit">append</span><span class="delimiter">(</span><a href="#61539" title="AnyRef">z</a><span class="delimiter">)</span>
        <a href="#61530" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#34769" title="(o: T, t: org.squeryl.Table[T], sw: org.squeryl.internals.StatementWriter)Unit">writeInsert</a><span class="delimiter">(</span><a href="#61539" title="AnyRef">z</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#9867" title="T">T</a><span class="delimiter">]</span>, <a href="#9866" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#61531" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="AnyRef" id="61548">z</a> = <a href="View.scala.html#20448" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#53921" title="(a: AnyRef)AnyRef">beforeUpdate</a><span class="delimiter">(</span><a href="#61527" title="T">e0</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
        <a href="#61532" title="scala.collection.mutable.ArrayBuffer[AnyRef]">forAfterUpdateOrInsert</a>.<span title="(elems: AnyRef*)Unit">append</span><span class="delimiter">(</span><a href="#61548" title="AnyRef">z</a><span class="delimiter">)</span>
        <a href="#61530" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#34779" title="(o: T, t: org.squeryl.Table[T], sw: org.squeryl.internals.StatementWriter, checkOCC: Boolean)Unit">writeUpdate</a><span class="delimiter">(</span><a href="#61548" title="AnyRef">z</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#9867" title="T">T</a><span class="delimiter">]</span>, <a href="#9866" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#61531" title="org.squeryl.internals.StatementWriter">sw</a>, <a href="#61507" title="Boolean">checkOCC</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#61529" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#34703" title="=&gt; Boolean">isLoggingEnabled</a><span class="delimiter">)</span>
        <a href="#61529" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#34704" title="(s: String)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Performing batched &quot;)" class="string">&quot;Performing batched &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#61506" title="Boolean">isInsert</a><span class="delimiter">)</span> <span title="java.lang.String(&quot;insert&quot;)" class="string">&quot;insert&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;update&quot;)" class="string">&quot;update&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with &quot;)" class="string">&quot; with &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#61531" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#38377" title="=&gt; java.lang.String">statement</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="java.sql.PreparedStatement" id="61533">st</a> = <a href="#61529" title="org.squeryl.Session">sess</a>.<a href="Session.scala.html#34689" title="=&gt; java.sql.Connection">connection</a>.<span title="(x$1: java.lang.String)java.sql.PreparedStatement">prepareStatement</span><span class="delimiter">(</span><a href="#61531" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#38377" title="=&gt; java.lang.String">statement</a><span class="delimiter">)</span>

      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#61530" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#34752" title="(params: Iterable[AnyRef], s: java.sql.PreparedStatement)Unit">fillParamsInto</a><span class="delimiter">(</span><a href="#61530" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#34751" title="(params: Iterable[AnyRef])Iterable[AnyRef]">convertParamsForJdbc</a><span class="delimiter">(</span><a href="#61531" title="org.squeryl.internals.StatementWriter">sw</a>.<a href="internals/StatementWriter.scala.html#38374" title="=&gt; Iterable[AnyRef]">paramsZ</a><span class="delimiter">)</span>, <a href="#61533" title="java.sql.PreparedStatement">st</a><span class="delimiter">)</span>
        <a href="#61533" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">addBatch</span>

        <span class="keyword">var</span> <a title="Int" id="61985">updateCount</a> = <span title="Int(1)" class="int">1</span>

        <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#61526" title="Iterator[T]">it</a>.<span title="=&gt; Boolean">hasNext</span><span class="delimiter">)</span> <a href="#61987" title="()Unit" class="delimiter">{</a>
          <span class="keyword">val</span> <a title="AnyRef" id="62033">eN0</a> = <a href="#61526" title="Iterator[T]">it</a>.<span title="()T">next</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span>
          <span class="keyword">val</span> <a title="AnyRef" id="62034">eN</a> =
            <span title="AnyRef" class="keyword">if</span><span class="delimiter">(</span><a href="#61506" title="Boolean">isInsert</a><span class="delimiter">)</span>
              <a href="View.scala.html#20448" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#53917" title="(a: AnyRef)AnyRef">beforeInsert</a><span class="delimiter">(</span><a href="#62033" title="AnyRef">eN0</a><span class="delimiter">)</span>
            <span class="keyword">else</span>
              <a href="View.scala.html#20448" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#53921" title="(a: AnyRef)AnyRef">beforeUpdate</a><span class="delimiter">(</span><a href="#62033" title="AnyRef">eN0</a><span class="delimiter">)</span>

          <a href="#61532" title="scala.collection.mutable.ArrayBuffer[AnyRef]">forAfterUpdateOrInsert</a>.<span title="(elems: AnyRef*)Unit">append</span><span class="delimiter">(</span><a href="#62034" title="AnyRef">eN</a><span class="delimiter">)</span>

          <span class="keyword">var</span> <a title="Int" id="62035">idx</a> = <span title="Int(1)" class="int">1</span>
          <a href="#61528" title="Iterable[org.squeryl.internals.FieldMetaData]">fmds</a>.<span title="(f: org.squeryl.internals.FieldMetaData =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="org.squeryl.internals.FieldMetaData" id="62052">fmd</a> =&gt; <span class="delimiter">{</span>
            <a href="#61533" title="java.sql.PreparedStatement">st</a>.<span title="(x$1: Int, x$2: Any)Unit">setObject</span><span class="delimiter">(</span><a href="#62035" title="Int">idx</a>, <a href="#61530" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#34772" title="(r: AnyRef)AnyRef">convertToJdbcValue</a><span class="delimiter">(</span><a href="#62052" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#46141" title="(o: AnyRef)AnyRef">get</a><span class="delimiter">(</span><a href="#62034" title="AnyRef">eN</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#62035" title="Int">idx</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>
          <a href="#61533" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">addBatch</span>
          <a href="#61985" title="Int">updateCount</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
        <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="Array[Int]" id="61986">execResults</a> = <a href="#61533" title="java.sql.PreparedStatement">st</a>.<span title="()Array[Int]">executeBatch</span>

        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#61507" title="Boolean">checkOCC</a><span class="delimiter">)</span>
          <span class="keyword">for</span><span class="delimiter">(</span><a title="Int" id="62848">b</a> &lt;- <a href="#61986" title="(f: Int =&gt; Unit)Unit">execResults</a><span class="delimiter">)</span>
            <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#62848" title="Int">b</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="java.lang.String" id="62853">updateOrInsert</a> = <span title="java.lang.String" class="keyword">if</span><span class="delimiter">(</span><a href="#61506" title="Boolean">isInsert</a><span class="delimiter">)</span> <span title="java.lang.String(&quot;insert&quot;)" class="string">&quot;insert&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;update&quot;)" class="string">&quot;update&quot;</span>
              <span title="Nothing" class="keyword">throw</span> <span title="org.squeryl.StaleUpdateException" class="keyword">new</span> <a href="KeyedEntity.scala.html#9795" title="org.squeryl.StaleUpdateException">StaleUpdateException</a><span class="delimiter">(</span>
                <span title="java.lang.String(&quot;Attemped to &quot;)" class="string">&quot;Attemped to &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#62853" title="java.lang.String">updateOrInsert</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; stale object under optimistic concurrency control&quot;)" class="string">&quot; stale object under optimistic concurrency control&quot;</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">finally</span> <span class="delimiter">{</span>
        <a href="#61533" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">close</span>
      <span class="delimiter">}</span>

      <span class="keyword">for</span><span class="delimiter">(</span><a title="AnyRef" id="62877">a</a> &lt;- <a href="#61532" title="(f: AnyRef =&gt; AnyRef)Unit">forAfterUpdateOrInsert</a><span class="delimiter">)</span>
        <span title="AnyRef" class="keyword">if</span><span class="delimiter">(</span><a href="#61506" title="Boolean">isInsert</a><span class="delimiter">)</span>
          <a href="View.scala.html#20448" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#53918" title="(a: AnyRef)AnyRef">afterInsert</a><span class="delimiter">(</span><a href="#62877" title="AnyRef">a</a><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="View.scala.html#20448" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#53922" title="(a: AnyRef)AnyRef">afterUpdate</a><span class="delimiter">(</span><a href="#62877" title="AnyRef">a</a><span class="delimiter">)</span>

    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Updates without any Optimistic Concurrency Control check 
   */</span>
  <span class="keyword">def</span> <a title="(o: T)(implicit ev: &lt;:&lt;[T,org.squeryl.KeyedEntity[_]])AnyRef" id="34606">forceUpdate</a><span class="delimiter">(</span><a title="T" id="62879">o</a>: <a href="#9867" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]" id="62880">ev</a>: T <span title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]">&lt;:&lt;</span> KeyedEntity<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="#34610" title="(o: T, checkOCC: Boolean)AnyRef">_update</a><span class="delimiter">(</span><a href="#62879" title="T">o</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
  
  <span class="keyword">def</span> <a title="(o: T)(implicit ev: &lt;:&lt;[T,org.squeryl.KeyedEntity[_]])Unit" id="34607">update</a><span class="delimiter">(</span><a title="T" id="55070">o</a>: <a href="#9867" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]" id="55071">ev</a>: T <span title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]">&lt;:&lt;</span> KeyedEntity<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> =
    <a href="#34610" title="(o: T, checkOCC: Boolean)AnyRef">_update</a><span title="Unit" class="delimiter">(</span><a href="#55070" title="T">o</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(o: Iterable[T])(implicit ev: &lt;:&lt;[T,org.squeryl.KeyedEntity[_]])Unit" id="34608">update</a><span class="delimiter">(</span><a title="Iterable[T]" id="55063">o</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]" id="55064">ev</a>: T <span title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]">&lt;:&lt;</span> KeyedEntity<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> =
    <a href="#34611" title="(e: Iterable[T], checkOCC: Boolean)Unit">_update</a><span class="delimiter">(</span><a href="#55063" title="Iterable[T]">o</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(o: Iterable[T])(implicit ev: &lt;:&lt;[T,org.squeryl.KeyedEntity[_]])Unit" id="34609">forceUpdate</a><span class="delimiter">(</span><a title="Iterable[T]" id="62949">o</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]" id="62950">ev</a>: T <span title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]">&lt;:&lt;</span> KeyedEntity<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> =
    <a href="#34611" title="(e: Iterable[T], checkOCC: Boolean)Unit">_update</a><span class="delimiter">(</span><a href="#62949" title="Iterable[T]">o</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(o: T, checkOCC: Boolean)AnyRef" id="34610">_update</a><span class="delimiter">(</span><a title="T" id="62890">o</a>: <a href="#9867" title="T">T</a>, <a title="Boolean" id="62891">checkOCC</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="org.squeryl.internals.DatabaseAdapter" id="62894">dba</a> = <a href="Session.scala.html#9848" title="object org.squeryl.Session">Session</a>.<a href="Session.scala.html#34680" title="=&gt; org.squeryl.Session">currentSession</a>.<a href="Session.scala.html#34691" title="=&gt; org.squeryl.internals.DatabaseAdapter">databaseAdapter</a>
    <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="62895">sw</a> = <a href="internals/StatementWriter.scala.html#38368" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#10817" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#62894" title="org.squeryl.internals.DatabaseAdapter">dba</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="T" id="62896">o0</a> = <a href="View.scala.html#20448" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#53921" title="(a: AnyRef)AnyRef">beforeUpdate</a><span class="delimiter">(</span><a href="#62890" title="T">o</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#9867" title="T">T</a><span class="delimiter">]</span>
    <a href="#62894" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#34779" title="(o: T, t: org.squeryl.Table[T], sw: org.squeryl.internals.StatementWriter, checkOCC: Boolean)Unit">writeUpdate</a><span class="delimiter">(</span><a href="#62896" title="T">o0</a>, <a href="#9866" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#62895" title="org.squeryl.internals.StatementWriter">sw</a>, <a href="#62891" title="Boolean">checkOCC</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Int" id="62897">cnt</a>  = <a href="#62894" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#34766" title="(s: org.squeryl.Session, sw: org.squeryl.internals.StatementWriter)Int">executeUpdateAndCloseStatement</a><span class="delimiter">(</span><a href="Session.scala.html#9848" title="object org.squeryl.Session">Session</a>.<a href="Session.scala.html#34680" title="=&gt; org.squeryl.Session">currentSession</a>, <a href="#62895" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#62897" title="Int">cnt</a> <span title="(x: Int)Boolean">!=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">if</span><span class="delimiter">(</span><a href="#62891" title="Boolean">checkOCC</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="View.scala.html#20455" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#34983" title="=&gt; Boolean">isOptimistic</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="AnyRef" id="62923">version</a> = <a href="View.scala.html#20455" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#34992" title="=&gt; Option[org.squeryl.internals.FieldMetaData]">optimisticCounter</a>.<span title="=&gt; org.squeryl.internals.FieldMetaData">get</span>.<a href="internals/FieldMetaData.scala.html#46141" title="(o: AnyRef)AnyRef">get</a><span class="delimiter">(</span><a href="#62890" title="T">o</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">throw</span> <span title="org.squeryl.StaleUpdateException" class="keyword">new</span> <a href="KeyedEntity.scala.html#9795" title="org.squeryl.StaleUpdateException">StaleUpdateException</a><span class="delimiter">(</span>
           <span title="java.lang.String(&quot;Object &quot;)" class="string">&quot;Object &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="View.scala.html#20452" title="=&gt; java.lang.String">prefixedName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;(id=&quot;)" class="string">&quot;(id=&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#62890" title="T">o</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.KeyedEntity[_$5]" class="delimiter">[</span><a href="KeyedEntity.scala.html#9788" title="org.squeryl.KeyedEntity[_]">KeyedEntity</a><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span>.<a href="KeyedEntity.scala.html#11285" title="=&gt; _$5">id</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, occVersionNumber=&quot;)" class="string">&quot;, occVersionNumber=&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#62923" title="AnyRef">version</a> <span title="(x$1: Any)java.lang.String">+</span>
           <span title="java.lang.String(&quot;) has become stale, it cannot be updated under optimistic concurrency control&quot;)" class="string">&quot;) has become stale, it cannot be updated under optimistic concurrency control&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">else</span>
        org.squeryl.internals.<a href="internals/Utils.scala.html#10829" title="object org.squeryl.internals.Utils">Utils</a>.<a href="internals/Utils.scala.html#30502" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;failed to update&quot;)" class="string">&quot;failed to update&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="View.scala.html#20448" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#53922" title="(a: AnyRef)AnyRef">afterUpdate</a><span class="delimiter">(</span><a href="#62896" title="T">o0</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(e: Iterable[T], checkOCC: Boolean)Unit" id="34611">_update</a><span class="delimiter">(</span><a title="Iterable[T]" id="62887">e</a>: <span title="Iterable[T]">Iterable</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="Boolean" id="62888">checkOCC</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> = <span class="delimiter">{</span>

    <span class="keyword">def</span> <a title="(t: T)Iterable[org.squeryl.internals.FieldMetaData]" id="62961">buildFmds</a><span class="delimiter">(</span><a title="T" id="62962">t</a>: <a href="#9867" title="T">T</a><span class="delimiter">)</span>: <span title="Iterable[org.squeryl.internals.FieldMetaData]">Iterable</span><span class="delimiter">[</span>FieldMetaData<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[org.squeryl.internals.FieldMetaData]" id="62963">pkList</a> = <a href="View.scala.html#20455" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#34990" title="=&gt; Option[Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]]">primaryKey</a>.<span title="(default: =&gt; Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method])Either[org.squeryl.internals.FieldMetaData,java.lang.reflect.Method]">getOrElse</span><span class="delimiter">(</span>
        org.squeryl.internals.<a href="internals/Utils.scala.html#10829" title="object org.squeryl.internals.Utils">Utils</a>.<a href="internals/Utils.scala.html#30502" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;method was called with &quot;)" class="string">&quot;method was called with &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="View.scala.html#20455" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#34974" title="=&gt; java.lang.Class[T]">clasz</a>.<span title="()java.lang.String">getName</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; that is not a KeyedEntity[]&quot;)" class="string">&quot; that is not a KeyedEntity[]&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(fa: org.squeryl.internals.FieldMetaData =&gt; List[org.squeryl.internals.FieldMetaData], fb: java.lang.reflect.Method =&gt; List[org.squeryl.internals.FieldMetaData])List[org.squeryl.internals.FieldMetaData]">fold</span><span class="delimiter">(</span>
        <a title="org.squeryl.internals.FieldMetaData" id="62973">pkMd</a> =&gt; <span title="(xs: org.squeryl.internals.FieldMetaData*)List[org.squeryl.internals.FieldMetaData]">List</span><span class="delimiter">(</span><a href="#62973" title="org.squeryl.internals.FieldMetaData">pkMd</a><span class="delimiter">)</span>,
        <a title="java.lang.reflect.Method" id="62982">pkGetter</a> =&gt; <span class="delimiter">{</span>
          <span class="comment">// Just for side-effect...</span>
          <span class="keyword">var</span> <a title="Option[List[org.squeryl.internals.FieldMetaData]]" id="62983">fields</a>: <span title="Option[List[org.squeryl.internals.FieldMetaData]]">Option</span><span class="delimiter">[</span>List<span class="delimiter">[</span>FieldMetaData<span class="delimiter">]</span><span class="delimiter">]</span>  = <span title="object None">None</span>
          <a href="internals/Utils.scala.html#10829" title="object org.squeryl.internals.Utils">Utils</a>.<a href="internals/Utils.scala.html#30494" title="(q: org.squeryl.Queryable[T], whereClause: T =&gt; org.squeryl.dsl.ast.LogicalBoolean)org.squeryl.dsl.ast.QueryExpressionElements">createQuery4WhereClause</a><span class="delimiter">(</span><a href="#9866" title="org.squeryl.Table[T]" class="keyword">this</a>, <span class="delimiter">(</span>t0:<a href="#9867" title="T">T</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="org.squeryl.dsl.CompositeKey" id="62989">ck</a> = <a href="#62982" title="java.lang.reflect.Method">pkGetter</a>.<span title="(x$1: Any, x$2: &lt;repeated...&gt;[java.lang.Object])java.lang.Object">invoke</span><span class="delimiter">(</span><a href="#62988" title="T">t0</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.CompositeKey" class="delimiter">[</span><a href="dsl/CompositeKey.scala.html#10030" title="org.squeryl.dsl.CompositeKey">CompositeKey</a><span class="delimiter">]</span>

            <a href="#62983" title="Option[List[org.squeryl.internals.FieldMetaData]]">fields</a> = <span title="(x: List[org.squeryl.internals.FieldMetaData])Some[List[org.squeryl.internals.FieldMetaData]]">Some</span><span class="delimiter">(</span><a href="#62989" title="org.squeryl.dsl.CompositeKey">ck</a>.<a href="dsl/CompositeKey.scala.html#18541" title="=&gt; Seq[org.squeryl.internals.FieldMetaData]">_fields</a>.<span title="=&gt; List[org.squeryl.internals.FieldMetaData]">toList</span><span class="delimiter">)</span>

            <span title="org.squeryl.dsl.ast.EqualityExpression" class="keyword">new</span> <a href="dsl/ast/ExpressionNode.scala.html#10273" title="org.squeryl.dsl.ast.EqualityExpression">EqualityExpression</a><span class="delimiter">(</span><span title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode[Int]" class="keyword">new</span> <a href="dsl/ast/ExpressionNode.scala.html#10292" title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode[Int]">InputOnlyConstantExpressionNode</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode[Int]" class="keyword">new</span> <a href="dsl/ast/ExpressionNode.scala.html#10292" title="org.squeryl.dsl.ast.InputOnlyConstantExpressionNode[Int]">InputOnlyConstantExpressionNode</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>

          <a href="#62983" title="Option[List[org.squeryl.internals.FieldMetaData]]">fields</a> <span title="(default: =&gt; List[org.squeryl.internals.FieldMetaData])List[org.squeryl.internals.FieldMetaData]">getOrElse</span> <span class="delimiter">(</span>internals.<a href="internals/Utils.scala.html#10829" title="object org.squeryl.internals.Utils">Utils</a>.<a href="internals/Utils.scala.html#30502" title="(msg: String)Nothing">throwError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;No PK fields found&quot;)" class="string">&quot;No PK fields found&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">)</span>

      <span title="(xs: List[org.squeryl.internals.FieldMetaData]*)List[List[org.squeryl.internals.FieldMetaData]]">List</span><span class="delimiter">(</span>
        <a href="View.scala.html#20455" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#34988" title="=&gt; Iterable[org.squeryl.internals.FieldMetaData]">fieldsMetaData</a>.<span title="(p: org.squeryl.internals.FieldMetaData =&gt; Boolean)Iterable[org.squeryl.internals.FieldMetaData]">filter</span><span class="delimiter">(</span><a title="org.squeryl.internals.FieldMetaData" id="63036">fmd</a>=&gt; <span title="=&gt; Boolean">!</span> <a href="#63036" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#46120" title="=&gt; Boolean">isIdFieldOfKeyedEntity</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span> <a href="#63036" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#46106" title="=&gt; Boolean">isOptimisticCounter</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#63036" title="org.squeryl.internals.FieldMetaData">fmd</a>.<a href="internals/FieldMetaData.scala.html#46140" title="=&gt; Boolean">isUpdatable</a><span class="delimiter">)</span>.<span title="=&gt; List[org.squeryl.internals.FieldMetaData]">toList</span>,
        <a href="#62963" title="List[org.squeryl.internals.FieldMetaData]">pkList</a>,
        <a href="View.scala.html#20455" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#34992" title="=&gt; Option[org.squeryl.internals.FieldMetaData]">optimisticCounter</a>.<span title="=&gt; List[org.squeryl.internals.FieldMetaData]">toList</span>
      <span class="delimiter">)</span>.<span title="(implicit asTraversable: List[org.squeryl.internals.FieldMetaData] =&gt; scala.collection.TraversableOnce[org.squeryl.internals.FieldMetaData])List[org.squeryl.internals.FieldMetaData]">flatten</span>
    <span class="delimiter">}</span>

    <a href="#34605" title="(e: Iterable[T], fmdCallback: T =&gt; Iterable[org.squeryl.internals.FieldMetaData], isInsert: Boolean, checkOCC: Boolean)Unit">_batchedUpdateOrInsert</a><span class="delimiter">(</span><a href="#62887" title="Iterable[T]">e</a>, <a href="#62961" title="(t: T)Iterable[org.squeryl.internals.FieldMetaData]">buildFmds</a> _, <span title="Boolean(false)" class="keyword">false</span>, <a href="#62888" title="Boolean">checkOCC</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">def</span> <a title="(s: T =&gt; org.squeryl.dsl.ast.UpdateStatement)Int" id="34612">update</a><span class="delimiter">(</span><a title="T =&gt; org.squeryl.dsl.ast.UpdateStatement" id="55060">s</a>: T =&gt;UpdateStatement<span class="delimiter">)</span>:<span title="Int">Int</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.ViewExpressionNode[T]" id="63085">vxn</a> = <span title="org.squeryl.dsl.ast.ViewExpressionNode[T]" class="keyword">new</span> <a href="dsl/ast/ViewExpressionNode.scala.html#10362" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">ViewExpressionNode</a><span class="delimiter">(</span><a href="#9866" title="org.squeryl.Table[T]" class="keyword">this</a><span class="delimiter">)</span>
    <a href="#63085" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a>.<a href="dsl/ast/ViewExpressionNode.scala.html#63134" title="(d: T)Unit">sample</a> =
       <a href="View.scala.html#20455" title="=&gt; org.squeryl.internals.PosoMetaData[T]">posoMetaData</a>.<a href="internals/PosoMetaData.scala.html#34996" title="(cb: net.sf.cglib.proxy.Callback)T">createSample</a><span class="delimiter">(</span><a href="internals/FieldReferenceLinker.scala.html#10755" title="object org.squeryl.internals.FieldReferenceLinker">FieldReferenceLinker</a>.<a href="internals/FieldReferenceLinker.scala.html#18228" title="(v: org.squeryl.dsl.ast.ViewExpressionNode[_])net.sf.cglib.proxy.Callback">createCallBack</a><span class="delimiter">(</span><a href="#63085" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a><span class="delimiter">)</span><span class="delimiter">)</span>    
    <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.UpdateStatement" id="63086">us</a> = <a href="#55060" title="(v1: T)org.squeryl.dsl.ast.UpdateStatement">s</a><span class="delimiter">(</span><a href="#63085" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a>.<a href="dsl/ast/ViewExpressionNode.scala.html#63135" title="=&gt; T">sample</a><span class="delimiter">)</span>
    <a href="#63085" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a>.<a href="dsl/ast/ExpressionNode.scala.html#18087" title="(x$1: Option[org.squeryl.dsl.ast.ExpressionNode])Unit">parent</a> = <span title="(x: org.squeryl.dsl.ast.UpdateStatement)Some[org.squeryl.dsl.ast.UpdateStatement]">Some</span><span class="delimiter">(</span><a href="#63086" title="org.squeryl.dsl.ast.UpdateStatement">us</a><span class="delimiter">)</span>

    <span class="keyword">var</span> <a title="Int" id="63087">idGen</a> = <span title="Int(0)" class="int">0</span>
    <a href="#63086" title="org.squeryl.dsl.ast.UpdateStatement">us</a>.<a href="dsl/ast/ExpressionNode.scala.html#18103" title="(visitor: (org.squeryl.dsl.ast.ExpressionNode, Option[org.squeryl.dsl.ast.ExpressionNode], Int) =&gt; Unit)Unit">visitDescendants</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="org.squeryl.dsl.ast.ExpressionNode" id="63182">node</a>,<a title="Option[org.squeryl.dsl.ast.ExpressionNode]" id="63183">parent</a>,<a title="Int" id="63184">i</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#63182" title="org.squeryl.dsl.ast.ExpressionNode">node</a>.<a href="dsl/ast/ExpressionNode.scala.html#18086" title="=&gt; Option[org.squeryl.dsl.ast.ExpressionNode]">parent</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="object None">None</span><span class="delimiter">)</span>
        <a href="#63182" title="org.squeryl.dsl.ast.ExpressionNode">node</a>.<a href="dsl/ast/ExpressionNode.scala.html#18087" title="(x$1: Option[org.squeryl.dsl.ast.ExpressionNode])Unit">parent</a> = <a href="#63183" title="Option[org.squeryl.dsl.ast.ExpressionNode]">parent</a>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#63182" title="org.squeryl.dsl.ast.ExpressionNode">node</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="dsl/ast/ExpressionNode.scala.html#10310" title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired">UniqueIdInAliaseRequired</a><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired" id="63190">nxn</a> = <a href="#63182" title="org.squeryl.dsl.ast.ExpressionNode">node</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired" class="delimiter">[</span><a href="dsl/ast/ExpressionNode.scala.html#10310" title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired">UniqueIdInAliaseRequired</a><span class="delimiter">]</span>
        <a href="#63190" title="org.squeryl.dsl.ast.UniqueIdInAliaseRequired">nxn</a>.<a href="dsl/ast/ExpressionNode.scala.html#53561" title="(x$1: Option[Int])Unit">uniqueId</a> = <span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><a href="#63087" title="Int">idGen</a><span class="delimiter">)</span>
        <a href="#63087" title="Int">idGen</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <a href="#63085" title="org.squeryl.dsl.ast.ViewExpressionNode[T]">vxn</a>.<a href="dsl/ast/ExpressionNode.scala.html#53561" title="(x$1: Option[Int])Unit">uniqueId</a> = <span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><a href="#63087" title="Int">idGen</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="org.squeryl.internals.DatabaseAdapter" id="63088">dba</a> = <a href="#34601" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>
    <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="63089">sw</a> = <a href="internals/StatementWriter.scala.html#38368" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#10817" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#63088" title="org.squeryl.internals.DatabaseAdapter">dba</a><span class="delimiter">)</span>
    <a href="#63088" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#34789" title="(t: org.squeryl.Table[_], us: org.squeryl.dsl.ast.UpdateStatement, sw: org.squeryl.internals.StatementWriter)Unit">writeUpdate</a><span class="delimiter">(</span><a href="#9866" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#63086" title="org.squeryl.dsl.ast.UpdateStatement">us</a>, <a href="#63089" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>
    <a href="#63088" title="org.squeryl.internals.DatabaseAdapter">dba</a>.<a href="internals/DatabaseAdapter.scala.html#34766" title="(s: org.squeryl.Session, sw: org.squeryl.internals.StatementWriter)Int">executeUpdateAndCloseStatement</a><span class="delimiter">(</span><a href="Session.scala.html#9848" title="object org.squeryl.Session">Session</a>.<a href="Session.scala.html#34680" title="=&gt; org.squeryl.Session">currentSession</a>, <a href="#63089" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>    
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(q: org.squeryl.Query[T])Int" id="34613">delete</a><span class="delimiter">(</span><a title="org.squeryl.Query[T]" id="63213">q</a>: <a href="Query.scala.html#9818" title="org.squeryl.Query[T]">Query</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="org.squeryl.dsl.ast.QueryExpressionElements" id="63215">queryAst</a> = <a href="#63213" title="org.squeryl.Query[T]">q</a>.<a href="Query.scala.html#14063" title="=&gt; org.squeryl.dsl.ast.ExpressionNode">ast</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.squeryl.dsl.ast.QueryExpressionElements" class="delimiter">[</span><a href="dsl/ast/QueryExpressionElements.scala.html#10326" title="org.squeryl.dsl.ast.QueryExpressionElements">QueryExpressionElements</a><span class="delimiter">]</span>
    <a href="#63215" title="org.squeryl.dsl.ast.QueryExpressionElements">queryAst</a>.<a href="dsl/ast/QueryExpressionElements.scala.html#61932" title="(x$1: Boolean)Unit">inhibitAliasOnSelectElementReference</a> = <span title="Boolean(true)" class="keyword">true</span>

    <span class="keyword">val</span> <a title="org.squeryl.internals.StatementWriter" id="63216">sw</a> = <a href="internals/StatementWriter.scala.html#38368" title="(databaseAdapter: org.squeryl.internals.DatabaseAdapter)org.squeryl.internals.StatementWriter" class="keyword">new</a> <a href="internals/StatementWriter.scala.html#10817" title="org.squeryl.internals.StatementWriter">StatementWriter</a><span class="delimiter">(</span><a href="#34601" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a><span class="delimiter">)</span>
    <a href="#34601" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#34782" title="(t: org.squeryl.Table[T], whereClause: Option[org.squeryl.dsl.ast.ExpressionNode], sw: org.squeryl.internals.StatementWriter)Unit">writeDelete</a><span class="delimiter">(</span><a href="#9866" title="org.squeryl.Table[T]" class="keyword">this</a>, <a href="#63215" title="org.squeryl.dsl.ast.QueryExpressionElements">queryAst</a>.<a href="dsl/ast/QueryExpressionElements.scala.html#61944" title="=&gt; Option[org.squeryl.dsl.ast.ExpressionNode]">whereClause</a>, <a href="#63216" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>

    <a href="#34601" title="=&gt; org.squeryl.internals.DatabaseAdapter">_dbAdapter</a>.<a href="internals/DatabaseAdapter.scala.html#34766" title="(s: org.squeryl.Session, sw: org.squeryl.internals.StatementWriter)Int">executeUpdateAndCloseStatement</a><span class="delimiter">(</span><a href="Session.scala.html#9848" title="object org.squeryl.Session">Session</a>.<a href="Session.scala.html#34680" title="=&gt; org.squeryl.Session">currentSession</a>, <a href="#63216" title="org.squeryl.internals.StatementWriter">sw</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(whereClause: T =&gt; org.squeryl.dsl.ast.LogicalBoolean)(implicit dsl: org.squeryl.dsl.QueryDsl)Int" id="34614">deleteWhere</a><span class="delimiter">(</span><a title="T =&gt; org.squeryl.dsl.ast.LogicalBoolean" id="63243">whereClause</a>: T =&gt; LogicalBoolean<span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.squeryl.dsl.QueryDsl" id="63244">dsl</a>: <a href="dsl/QueryDsl.scala.html#10196" title="org.squeryl.dsl.QueryDsl">QueryDsl</a><span class="delimiter">)</span>: <span title="Int">Int</span> =
    <a href="#34613" title="(q: org.squeryl.Query[T])Int">delete</a><span class="delimiter">(</span><a href="#63244" title="org.squeryl.dsl.QueryDsl">dsl</a>.<a href="dsl/boilerplate/FromSignatures.scala.html#15987" title="(t1: org.squeryl.Queryable[T])(f: T =&gt; org.squeryl.dsl.QueryYield[T])org.squeryl.Query[T]">from</a><span class="delimiter">(</span><a href="#9866" title="org.squeryl.Table[T]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="T" id="63409">t</a> =&gt; <a href="#63244" title="org.squeryl.dsl.QueryDsl">dsl</a>.<a href="dsl/QueryDsl.scala.html#15264" title="(b: =&gt; org.squeryl.dsl.ast.LogicalBoolean)org.squeryl.dsl.fsm.WhereState[org.squeryl.dsl.fsm.Conditioned]">where</a><span class="delimiter">(</span><a href="#63243" title="(v1: T)org.squeryl.dsl.ast.LogicalBoolean">whereClause</a><span class="delimiter">(</span><a href="#63409" title="T">t</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="dsl/fsm/StartState.scala.html#15765" title="(yieldClosure: =&gt; T)org.squeryl.dsl.fsm.SelectState[T]">select</a><span class="delimiter">(</span><a href="#63409" title="T">t</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>      

  <span class="keyword">def</span> <a title="[K](k: K)(implicit ev: &lt;:&lt;[T,org.squeryl.KeyedEntity[K]], implicit dsl: org.squeryl.dsl.QueryDsl)Boolean" id="34615">delete</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="34617">K</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="K" id="63250">k</a>: <a href="#34617" title="K">K</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="&lt;:&lt;[T,org.squeryl.KeyedEntity[K]]" id="63251">ev</a>: T <span title="&lt;:&lt;[T,org.squeryl.KeyedEntity[K]]">&lt;:&lt;</span> KeyedEntity<span class="delimiter">[</span>K<span class="delimiter">]</span>, <a title="org.squeryl.dsl.QueryDsl" id="63252">dsl</a>: <a href="dsl/QueryDsl.scala.html#10196" title="org.squeryl.dsl.QueryDsl">QueryDsl</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span>  = <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#63252" title="org.squeryl.dsl.QueryDsl">dsl</a>._
    <span class="keyword">val</span> <a title="org.squeryl.Query[T]" id="63417">q</a> = <a href="dsl/boilerplate/FromSignatures.scala.html#15987" title="(t1: org.squeryl.Queryable[T])(f: T =&gt; org.squeryl.dsl.QueryYield[T])org.squeryl.Query[T]">from</a><span class="delimiter">(</span><a href="#9866" title="org.squeryl.Table[T]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="T" id="63565">a</a> =&gt; <a href="#63252" title="org.squeryl.dsl.QueryDsl">dsl</a>.<a href="dsl/QueryDsl.scala.html#15264" title="(b: =&gt; org.squeryl.dsl.ast.LogicalBoolean)org.squeryl.dsl.fsm.WhereState[org.squeryl.dsl.fsm.Conditioned]">where</a> <span class="delimiter">{</span>
      <a href="internals/FieldReferenceLinker.scala.html#10755" title="object org.squeryl.internals.FieldReferenceLinker">FieldReferenceLinker</a>.<a href="internals/FieldReferenceLinker.scala.html#18219" title="(e: Any, c: Any)org.squeryl.dsl.ast.LogicalBoolean">createEqualityExpressionWithLastAccessedFieldReferenceAndConstant</a><span class="delimiter">(</span><a href="#63251" title="(v1: T)org.squeryl.KeyedEntity[K]">a</a>.<a href="KeyedEntity.scala.html#11285" title="=&gt; K">id</a>, <a href="#63250" title="K">k</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <a href="dsl/fsm/StartState.scala.html#15765" title="(yieldClosure: =&gt; T)org.squeryl.dsl.fsm.SelectState[T]">select</a><span class="delimiter">(</span><a href="#63565" title="T">a</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Option[T]" id="63419">z</a> = <a href="#63417" title="org.squeryl.Query[T]">q</a>.<a href="Query.scala.html#14066" title="=&gt; Option[T]">headOption</a>

    <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="View.scala.html#20448" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#53914" title="=&gt; Boolean">hasBeforeDelete</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#63418" title="=&gt; Option[T]">z</a>.<span title="(f: T =&gt; AnyRef)Option[AnyRef]">map</span><span class="delimiter">(</span><a title="T" id="64395">x</a> =&gt; <a href="View.scala.html#20448" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#53919" title="(a: AnyRef)AnyRef">beforeDelete</a><span class="delimiter">(</span><a href="#64395" title="T">x</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="Int" id="63420">deleteCount</a> = <a href="#9866" title="Table.this.type" class="keyword">this</a>.<a href="#34613" title="(q: org.squeryl.Query[T])Int">delete</a><span class="delimiter">(</span><a href="#63417" title="org.squeryl.Query[T]">q</a><span class="delimiter">)</span>

    <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="View.scala.html#20448" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#53915" title="=&gt; Boolean">hasAfterDelete</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#63418" title="=&gt; Option[T]">z</a>.<span title="(f: T =&gt; AnyRef)Option[AnyRef]">map</span><span class="delimiter">(</span><a title="T" id="64448">x</a> =&gt; <a href="View.scala.html#20448" title="=&gt; org.squeryl.internals.PosoLifecycleEventListener">_callbacks</a>.<a href="internals/PosoLifecycleEvent.scala.html#53920" title="(a: AnyRef)AnyRef">afterDelete</a><span class="delimiter">(</span><a href="#64448" title="T">x</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#63420" title="Int">deleteCount</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(1)" class="int">1</span>, <span title="java.lang.String(&quot;Query :\012&quot;)" class="string">&quot;Query :\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#63417" title="org.squeryl.Query[T]">q</a>.<a href="Query.scala.html#14061" title="=&gt; String">dumpAst</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012should have deleted at most 1 row but has deleted &quot;)" class="string">&quot;\nshould have deleted at most 1 row but has deleted &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#63420" title="Int">deleteCount</a><span class="delimiter">)</span>
    <a href="#63420" title="Int">deleteCount</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(o: T)(implicit ev: &lt;:&lt;[T,org.squeryl.KeyedEntity[_]])T" id="34618">insertOrUpdate</a><span class="delimiter">(</span><a title="T" id="64469">o</a>: <a href="#9867" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]" id="64470">ev</a>: T <span title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]">&lt;:&lt;</span> KeyedEntity<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#9867" title="T">T</a> = <span class="delimiter">{</span>
    <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="#64470" title="(v1: T)org.squeryl.KeyedEntity[_]">o</a>.<a href="KeyedEntity.scala.html#11283" title="=&gt; Boolean">isPersisted</a><span class="delimiter">)</span>
      <a href="#34607" title="(o: T)(implicit ev: &lt;:&lt;[T,org.squeryl.KeyedEntity[_]])Unit">update</a><a href="#64470" title="&lt;:&lt;[T,org.squeryl.KeyedEntity[_]]" class="delimiter">(</a><a href="#64469" title="T">o</a><span class="delimiter">)</span>
    <span class="keyword">else</span>
      <a href="#34602" title="(t: T)T">insert</a><span class="delimiter">(</span><a href="#64469" title="T">o</a><span class="delimiter">)</span>
    <a href="#64469" title="T">o</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>