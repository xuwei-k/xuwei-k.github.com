<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>org/specs2/html/Htmlx.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> org.specs2
<span class="keyword">package</span> html

<span class="keyword">import</span> scala.xml._
<span class="keyword">import</span> transform.<span class="delimiter">{</span>RuleTransformer, RewriteRule<span class="delimiter">}</span>
<span class="keyword">import</span> org.specs2.internal.scalaz.<span class="delimiter">{</span> TreeLoc, Scalaz, Show <span class="delimiter">}</span>
<span class="keyword">import</span> <span title="object org.specs2.internal.scalaz.Scalaz">Scalaz</span>._
<span class="keyword">import</span> xml.<a href="../xml/Nodex.scala.html#13373" title="object org.specs2.xml.Nodex">Nodex</a>._
<span class="keyword">import</span> java.net.URLDecoder
<span class="keyword">import</span> io.<a href="../io/Paths.scala.html#10546" title="object org.specs2.io.Paths">Paths</a>._
<span class="keyword">import</span> scala.collection.mutable
<span class="keyword">import</span> data.UniqueNames

<span class="comment">/**
 * This trait provide additional methods on a NodeSeq or a Node representing an html document
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>specs2<span class="delimiter">]</span>
<span class="keyword">trait</span> <a title="trait Htmlx extends java.lang.Object with ScalaObject" id="10422">Htmlx</a> <span title="ScalaObject" class="delimiter">{</span> outer =&gt;

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit org.specs2.html.Htmlx.extendHtmlNodeSeq : (ns: scala.xml.NodeSeq)Htmlx.this.ExtendedHtml" id="146228">extendHtmlNodeSeq</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="146278">ns</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span> = <a href="#146283" title="(ns: scala.xml.NodeSeq)Htmlx.this.ExtendedHtml">ExtendedHtml</a><span class="delimiter">(</span><a href="#146278" title="scala.xml.NodeSeq">ns</a><span class="delimiter">)</span>
  case <span class="keyword">class</span> <a title="class ExtendedHtml extends java.lang.Object with ScalaObject with Product with Serializable" id="146283">ExtendedHtml</a><a href="#146283" title="ScalaObject" class="delimiter">(</a><a title="scala.xml.NodeSeq" id="146292">ns</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; scala.xml.NodeSeq" id="146288">headers</a> = <a href="#10422" title="Htmlx.this.type">outer</a>.<a href="#146243" title="(nodes: scala.xml.NodeSeq)scala.xml.NodeSeq">headers</a><span class="delimiter">(</span><a href="#146292" title="=&gt; scala.xml.NodeSeq">ns</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; org.specs2.internal.scalaz.Tree[Htmlx.this.Header]" id="146289">headersTree</a> = <a href="#10422" title="Htmlx.this.type">outer</a>.<a href="#146244" title="(body: scala.xml.NodeSeq, headers: org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header])org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">headersToTree</a><span class="delimiter">(</span><a href="#146228" title="implicit org.specs2.html.Htmlx.extendHtmlNodeSeq : (ns: scala.xml.NodeSeq)Htmlx.this.ExtendedHtml">ns</a>.<a href="#146288" title="=&gt; scala.xml.NodeSeq">headers</a><span class="delimiter">)</span>.<span title="=&gt; org.specs2.internal.scalaz.Tree[Htmlx.this.Header]">toTree</span>
  <span class="delimiter">}</span>

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit org.specs2.html.Htmlx.extendHtmlNode : (n: scala.xml.Node)Htmlx.this.ExtendedHtmlNode" id="146232">extendHtmlNode</a><span class="delimiter">(</span><a title="scala.xml.Node" id="146296">n</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> = <a href="#146301" title="(n: scala.xml.Node)Htmlx.this.ExtendedHtmlNode">ExtendedHtmlNode</a><span class="delimiter">(</span><a href="#146296" title="scala.xml.Node">n</a><span class="delimiter">)</span>
  case <span class="keyword">class</span> <a title="class ExtendedHtmlNode extends java.lang.Object with ScalaObject with Product with Serializable" id="146301">ExtendedHtmlNode</a><a href="#146301" title="ScalaObject" class="delimiter">(</a><a title="scala.xml.Node" id="146309">n</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; Seq[scala.xml.Node]" id="146306">addHeadersAnchors</a> = <a href="#10422" title="Htmlx.this.type">outer</a>.<a href="#146267" title="=&gt; scala.xml.transform.RewriteRule{val namer: org.specs2.data.UniqueNames; def applyTransformation(ns: Seq[scala.xml.Node]): Seq[scala.xml.Node]; def applyTransformation(n: scala.xml.Node): Seq[scala.xml.Node]; def addTo(n: scala.xml.Node): Seq[scala.xml.Node]}">headersAnchors</a>.<a href="#147053" title="(n: scala.xml.Node)Seq[scala.xml.Node]">addTo</a><span class="delimiter">(</span><a href="#146309" title="=&gt; scala.xml.Node">n</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit org.specs2.html.Htmlx.extendHtmlSeqNode : (ns: Seq[scala.xml.Node])Htmlx.this.ExtendedHtmlSeqNode" id="146236">extendHtmlSeqNode</a><span class="delimiter">(</span><a title="Seq[scala.xml.Node]" id="146313">ns</a>: <span title="Seq[scala.xml.Node]">Seq</span><span class="delimiter">[</span>Node<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#146318" title="(ns: Seq[scala.xml.Node])Htmlx.this.ExtendedHtmlSeqNode">ExtendedHtmlSeqNode</a><span class="delimiter">(</span><a href="#146313" title="Seq[scala.xml.Node]">ns</a><span class="delimiter">)</span>
  case <span class="keyword">class</span> <a title="class ExtendedHtmlSeqNode extends java.lang.Object with ScalaObject with Product with Serializable" id="146318">ExtendedHtmlSeqNode</a><a href="#146318" title="ScalaObject" class="delimiter">(</a><a title="Seq[scala.xml.Node]" id="146328">ns</a>: <span title="Seq[scala.xml.Node]">Seq</span><span class="delimiter">[</span>Node<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(f: PartialFunction[scala.xml.Node,scala.xml.Node])scala.xml.NodeSeq" id="146323">updateHead</a><span class="delimiter">(</span><a title="PartialFunction[scala.xml.Node,scala.xml.Node]" id="147098">f</a>: <span title="PartialFunction[scala.xml.Node,scala.xml.Node]">PartialFunction</span><span class="delimiter">[</span>Node, Node<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#10422" title="Htmlx.this.type">outer</a>.<a href="#146240" title="(ns: scala.xml.NodeSeq)(f: PartialFunction[scala.xml.Node,scala.xml.Node])scala.xml.NodeSeq">updateHead</a><span class="delimiter">(</span><a href="#146328" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">ns</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#147098" title="PartialFunction[scala.xml.Node,scala.xml.Node]">f</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(name: String, value: String)scala.xml.NodeSeq" id="146324">updateHeadAttribute</a><span class="delimiter">(</span><a title="String" id="147224">name</a>: <span title="String">String</span>, <a title="String" id="147225">value</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <a href="#10422" title="Htmlx.this.type">outer</a>.<a href="#146241" title="(ns: scala.xml.NodeSeq, name: String, value: String)scala.xml.NodeSeq">updateHeadAttribute</a><span class="delimiter">(</span><a href="#146328" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">ns</a>, <a href="#147224" title="String">name</a>, <a href="#147225" title="String">value</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(name: String, value: Int)scala.xml.NodeSeq" id="146325">updateHeadAttribute</a><span class="delimiter">(</span><a title="String" id="147374">name</a>: <span title="String">String</span>, <a title="Int" id="147375">value</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <a href="#10422" title="Htmlx.this.type">outer</a>.<a href="#146242" title="(ns: scala.xml.NodeSeq, name: String, value: Int)scala.xml.NodeSeq">updateHeadAttribute</a><span class="delimiter">(</span><a href="#146328" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">ns</a>, <a href="#147374" title="String">name</a>, <a href="#147375" title="Int">value</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** @return a NodeSeq where the first Node is updated with a partial function */</span>
  <span class="keyword">def</span> <a title="(ns: scala.xml.NodeSeq)(f: PartialFunction[scala.xml.Node,scala.xml.Node])scala.xml.NodeSeq" id="146240">updateHead</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="147101">ns</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="PartialFunction[scala.xml.Node,scala.xml.Node]" id="147102">f</a>: <span title="PartialFunction[scala.xml.Node,scala.xml.Node]">PartialFunction</span><span class="delimiter">[</span>Node, Node<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="delimiter">(</span><a href="#147101" title="scala.xml.NodeSeq">ns</a>.<span title="=&gt; List[scala.xml.Node]">toList</span> <a href="../xml/Nodex.scala.html#62837" title="implicit org.specs2.xml.Nodex.reducable : (ns: Seq[scala.xml.NodeSeq])org.specs2.xml.Nodex.Reducable" class="keyword">match</a> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="List[scala.xml.Node]" class="delimiter">(</span><a title="scala.xml.Node" id="147109">e</a>:<span title="scala.xml.Node">Node</span><span class="delimiter">)</span> :: <a title="List[scala.xml.Node]" id="147110">rest</a> <span class="keyword">if</span> <a href="#147102" title="PartialFunction[scala.xml.Node,scala.xml.Node]">f</a>.<span title="(x: scala.xml.Node)Boolean">isDefinedAt</span><span class="delimiter">(</span><a href="#147109" title="scala.xml.Node">e</a><span class="delimiter">)</span> =&gt; <a href="#147102" title="(v1: scala.xml.Node)scala.xml.Node">f</a><span class="delimiter">(</span><a href="#147109" title="scala.xml.Node">e</a><span class="delimiter">)</span> <a href="#147112" title="(x: scala.xml.Node)List[scala.xml.Node]">::</a> <a href="#147110" title="List[scala.xml.Node]">rest</a>
      <span class="keyword">case</span> <a title="List[scala.xml.Node]" id="147119">other</a>                                =&gt; <a href="#147119" title="List[scala.xml.Node]">other</a>
    <span class="delimiter">}</span><span class="delimiter">)</span>.<a href="../xml/Nodex.scala.html#127398" title="=&gt; scala.xml.NodeSeq">reduceNodes</a>
  <span class="delimiter">}</span>

  <span class="comment">/** @return a NodeSeq where the first Node attribute named 'named' has a new value */</span>
  <span class="keyword">def</span> <a title="(ns: scala.xml.NodeSeq, name: String, value: String)scala.xml.NodeSeq" id="146241">updateHeadAttribute</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="147233">ns</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>, <a title="String" id="147234">name</a>: <span title="String">String</span>, <a title="String" id="147235">value</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <a href="#146240" title="(ns: scala.xml.NodeSeq)(f: PartialFunction[scala.xml.Node,scala.xml.Node])scala.xml.NodeSeq">updateHead</a><span class="delimiter">(</span><a href="#147233" title="scala.xml.NodeSeq">ns</a><span class="delimiter">)</span> <a href="#147553" title="scala.xml.Node" class="delimiter">{</a> <span class="keyword">case</span> <span title="scala.xml.Elem" class="delimiter">(</span><a title="scala.xml.Elem" id="147554">e</a>: <span title="scala.xml.Elem">Elem</span><span class="delimiter">)</span> =&gt; <a href="#147554" title="scala.xml.Elem">e</a> <span title="(updates: scala.xml.MetaData)scala.xml.Elem">%</span> <span class="delimiter">(</span><a href="#147234" title="(x: String)ArrowAssoc[String]">name</a> <a href="../xml/Nodex.scala.html#62846" title="implicit org.specs2.xml.Nodex.pairToUnprefixedAttribute : (pair: (Any, Any))scala.xml.UnprefixedAttribute">-&gt;</a> <a href="#147235" title="String">value</a><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="comment">/** @return a NodeSeq where the first Node attribute named 'named' has a new value, from an Int */</span>
  <span class="keyword">def</span> <a title="(ns: scala.xml.NodeSeq, name: String, value: Int)scala.xml.NodeSeq" id="146242">updateHeadAttribute</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="147229">ns</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>, <a title="String" id="147230">name</a>: <span title="String">String</span>, <a title="Int" id="147231">value</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <a href="#146241" title="(ns: scala.xml.NodeSeq, name: String, value: String)scala.xml.NodeSeq">updateHeadAttribute</a><span class="delimiter">(</span><a href="#147229" title="scala.xml.NodeSeq">ns</a>, <a href="#147230" title="String">name</a>, <a href="#147231" title="Int">value</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>

  <span class="comment">/**
   * @return all the headers and all the subtoc elements of a document
   */</span>
  <span class="keyword">def</span> <a title="(nodes: scala.xml.NodeSeq)scala.xml.NodeSeq" id="146243">headers</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="146647">nodes</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <a href="../xml/Nodex.scala.html#62833" title="implicit org.specs2.xml.Nodex.extendNodeSeq : (ns: scala.xml.NodeSeq)org.specs2.xml.Nodex.ExtendedNodeSeq">nodes</a>.<a href="../xml/Nodex.scala.html#129298" title="(condition: scala.xml.Node =&gt; Boolean, recurse: scala.xml.Node =&gt; Boolean)scala.xml.NodeSeq">filterNodes</a><span class="delimiter">(</span><span class="delimiter">(</span>e: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> =&gt; <a href="#146264" title="(e: scala.xml.Node)Boolean">isHeader</a><span class="delimiter">(</span><a href="#147670" title="scala.xml.Node">e</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#146266" title="(e: scala.xml.Node)Boolean">isSubtoc</a><span class="delimiter">(</span><a href="#147670" title="scala.xml.Node">e</a><span class="delimiter">)</span>, <span title="=&gt; Boolean">!</span><a href="#146265" title="(e: scala.xml.Node)Boolean">isNotoc</a><span class="delimiter">(</span><a href="#147675" title="scala.xml.Node">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/** collect all the headers as a Tree */</span>
  <span class="keyword">def</span> <a title="(body: scala.xml.NodeSeq, headers: org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header])org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]" id="146244">headersToTree</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="146652">body</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>, <a title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]" id="146655">headers</a>: <span title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">TreeLoc</span><span class="delimiter">[</span>Header<span class="delimiter">]</span> = <span title="(root: =&gt; Htmlx.this.Header)org.specs2.internal.scalaz.Tree[Htmlx.this.Header]">leaf</span><span class="delimiter">(</span><a href="#147683" title="(level: Int, node: scala.xml.Node, namer: org.specs2.data.UniqueNames)Htmlx.this.Header">Header</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">loc</span><span class="delimiter">)</span>: <span title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">TreeLoc</span><span class="delimiter">[</span>Header<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(headers: org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header], level: Int)org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]" id="147722">goUpUntil</a><span class="delimiter">(</span><a title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]" id="147726">headers</a>: <span title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">TreeLoc</span><span class="delimiter">[</span>Header<span class="delimiter">]</span>, <a title="Int" id="147727">level</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">TreeLoc</span><span class="delimiter">[</span>Header<span class="delimiter">]</span> =
      <span title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]" class="keyword">if</span> <span class="delimiter">(</span><a href="#147726" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">headers</a>.<span title="=&gt; org.specs2.internal.scalaz.Tree[Htmlx.this.Header]">tree</span>.<span title="=&gt; Htmlx.this.Header">rootLabel</span>.<a href="#147702" title="=&gt; Int">level</a> <span title="(x: Int)Boolean">&gt;</span> <a href="#147727" title="Int">level</a><span class="delimiter">)</span> <a href="#147726" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">headers</a>.<span title="=&gt; Option[org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]]">parent</span>.<span title="(f: org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header] =&gt; org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header])Option[org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]]">map</span><span class="delimiter">(</span><a href="#147722" title="(headers: org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header], level: Int)org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">goUpUntil</a><span class="delimiter">(</span><a href="#147736" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">_</a>, <a href="#147727" title="Int">level</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header])org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">getOrElse</span><span class="delimiter">(</span><a href="#147726" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">headers</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="#147726" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">headers</a>

    <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Int" id="147724">currentLevel</a> = <a href="#146655" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">headers</a>.<span title="=&gt; org.specs2.internal.scalaz.Tree[Htmlx.this.Header]">tree</span>.<span title="=&gt; Htmlx.this.Header">rootLabel</span>.<a href="#147702" title="=&gt; Int">level</a>

    <span class="keyword">def</span> <a title="(eLevel: Int, e: scala.xml.Node, rest: scala.xml.NodeSeq)org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]" id="147725">insertHeader</a><span class="delimiter">(</span><a title="Int" id="147743">eLevel</a>: <span title="Int">Int</span>, <a title="scala.xml.Node" id="147744">e</a>: <span title="scala.xml.Node">Node</span>, <a title="scala.xml.NodeSeq" id="147745">rest</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span>: <span title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">TreeLoc</span><span class="delimiter">[</span>Header<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="org.specs2.internal.scalaz.Tree[Htmlx.this.Header]" id="147746">header</a> = <span title="(root: =&gt; Htmlx.this.Header)org.specs2.internal.scalaz.Tree[Htmlx.this.Header]">leaf</span><span class="delimiter">(</span><a href="#147683" title="(level: Int, node: scala.xml.Node, namer: org.specs2.data.UniqueNames)Htmlx.this.Header">Header</a><span class="delimiter">(</span><a href="#147743" title="Int">eLevel</a>, <a href="#147744" title="scala.xml.Node">e</a>, <a href="#146655" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">headers</a>.<span title="=&gt; Htmlx.this.Header">getLabel</span>.<a href="#147704" title="=&gt; org.specs2.data.UniqueNames">namer</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]" id="147747">newHeaders</a> = <span title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]" class="keyword">if</span> <span class="delimiter">(</span><a href="#147743" title="Int">eLevel</a> <span title="(x: Int)Boolean">==</span> <a href="#147723" title="=&gt; Int">currentLevel</a><span class="delimiter">)</span>
        <a href="#146655" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">headers</a>.<span title="(t: org.specs2.internal.scalaz.Tree[Htmlx.this.Header])org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">insertRight</span><span class="delimiter">(</span><a href="#147746" title="org.specs2.internal.scalaz.Tree[Htmlx.this.Header]">header</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]" class="keyword">if</span> <span class="delimiter">(</span><a href="#147743" title="Int">eLevel</a> <span title="(x: Int)Boolean">&gt;</span> <a href="#147723" title="=&gt; Int">currentLevel</a><span class="delimiter">)</span>
        <a href="#146655" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">headers</a>.<span title="(t: org.specs2.internal.scalaz.Tree[Htmlx.this.Header])org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">insertDownLast</span><span class="delimiter">(</span><a href="#147746" title="org.specs2.internal.scalaz.Tree[Htmlx.this.Header]">header</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]" id="147769">parent</a> = <a href="#147722" title="(headers: org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header], level: Int)org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">goUpUntil</a><span class="delimiter">(</span><a href="#146655" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">headers</a>, <a href="#147743" title="Int">eLevel</a><span class="delimiter">)</span>
        <span title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]" class="keyword">if</span> <span class="delimiter">(</span><a href="#147769" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">parent</a>.<span title="=&gt; org.specs2.internal.scalaz.Tree[Htmlx.this.Header]">tree</span>.<span title="=&gt; Htmlx.this.Header">rootLabel</span>.<a href="#147702" title="=&gt; Int">level</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <a href="#147769" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">parent</a>.<span title="(t: org.specs2.internal.scalaz.Tree[Htmlx.this.Header])org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">insertDownLast</span><span class="delimiter">(</span><a href="#147746" title="org.specs2.internal.scalaz.Tree[Htmlx.this.Header]">header</a><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="#147769" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">parent</a>.<span title="(t: org.specs2.internal.scalaz.Tree[Htmlx.this.Header])org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">insertRight</span><span class="delimiter">(</span><a href="#147746" title="org.specs2.internal.scalaz.Tree[Htmlx.this.Header]">header</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#146244" title="(body: scala.xml.NodeSeq, headers: org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header])org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">headersToTree</a><span class="delimiter">(</span><a href="#147745" title="scala.xml.NodeSeq">rest</a>, <a href="#147747" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">newHeaders</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#146652" title="scala.xml.NodeSeq">body</a>.<span title="=&gt; List[scala.xml.Node]">toList</span> <span title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]" id="147789">e</a> :: <a title="List[scala.xml.Node]" id="147790">rest</a> <span class="keyword">if</span> <a href="#146264" title="(e: scala.xml.Node)Boolean">isHeader</a><span class="delimiter">(</span><a href="#147789" title="scala.xml.Node">e</a><span class="delimiter">)</span> =&gt; <a href="#147725" title="(eLevel: Int, e: scala.xml.Node, rest: scala.xml.NodeSeq)org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">insertHeader</a><span class="delimiter">(</span><a href="#146245" title="(e: scala.xml.Node)Int">headerNumber</a><span class="delimiter">(</span><a href="#147789" title="scala.xml.Node">e</a><span class="delimiter">)</span>, <a href="#147789" title="scala.xml.Node">e</a>, <a href="#147790" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">rest</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]" id="147832">e</a> :: <a title="List[scala.xml.Node]" id="147833">rest</a> <span class="keyword">if</span> <a href="#146266" title="(e: scala.xml.Node)Boolean">isSubtoc</a><span class="delimiter">(</span><a href="#147832" title="scala.xml.Node">e</a><span class="delimiter">)</span> =&gt; <a href="#147725" title="(eLevel: Int, e: scala.xml.Node, rest: scala.xml.NodeSeq)org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">insertHeader</a><span class="delimiter">(</span><a href="#147723" title="=&gt; Int">currentLevel</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="#147832" title="scala.xml.Node">e</a>, <a href="#147833" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">rest</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">_</span>                        =&gt; <a href="#146655" title="org.specs2.internal.scalaz.TreeLoc[Htmlx.this.Header]">headers</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="comment">/** @return the header number if any. By convention -1 means &quot;no header&quot; */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(e: scala.xml.Node)Int" id="146245">headerNumber</a><span class="delimiter">(</span><a title="scala.xml.Node" id="147791">e</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#147791" title="scala.xml.Node">e</a>.<span title="=&gt; String">label</span> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#146258" title="Int">HeaderTag</a><span class="delimiter">(</span><a title="String" id="147795">i</a><span class="delimiter">)</span> =&gt; <span title="object java.lang.Integer">Integer</span>.<span title="(x$1: java.lang.String)java.lang.Integer">valueOf</span><span class="delimiter">(</span><a href="#147795" title="String">i</a><span class="delimiter">)</span>.<span title="()Int">intValue</span>
      <span class="keyword">case</span> <span title="Int(-1)">_</span>            =&gt; -<span title="Int(-1)" class="int">1</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit org.specs2.html.Htmlx.href : (s: String)Htmlx.this.HRef" id="146246">href</a><span class="delimiter">(</span><a title="String" id="146332">s</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#146337" title="(s: String)Htmlx.this.HRef">HRef</a><span class="delimiter">(</span><a href="#146332" title="String">s</a><span class="delimiter">)</span>
  case <span class="keyword">class</span> <a title="class HRef extends java.lang.Object with ScalaObject with Product with Serializable" id="146337">HRef</a><a href="#146337" title="ScalaObject" class="delimiter">(</a><a title="String" id="146346">s</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="146342">sanitize</a> = <a href="#10422" title="Htmlx.this.type">outer</a>.<a href="#146250" title="(s: String)java.lang.String">sanitize</a><span class="delimiter">(</span><a href="#146346" title="=&gt; String">s</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="146343">anchorName</a> = <a href="#10422" title="Htmlx.this.type">outer</a>.<a href="#146251" title="(name: String)java.lang.String">anchorName</a><span class="delimiter">(</span><a href="#146346" title="=&gt; String">s</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** sanitize a string so that it can be used as a href */</span>
  <span class="keyword">def</span> <a title="(s: String)java.lang.String" id="146250">sanitize</a><span class="delimiter">(</span><a title="String" id="146888">s</a>: <span title="String">String</span><span class="delimiter">)</span> = java.net.<span title="object java.net.URLEncoder">URLEncoder</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">encode</span><span class="delimiter">(</span><a href="#146888" title="String">s</a>, <span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span>
  <span class="comment">/** create a sanitized anchor name */</span>
  <span class="keyword">def</span> <a title="(name: String)java.lang.String" id="146251">anchorName</a><span class="delimiter">(</span><a title="String" id="148071">name</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="java.lang.String(&quot;#&quot;)" class="string">&quot;#&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#146250" title="(s: String)java.lang.String">sanitize</a><span class="delimiter">(</span><a href="#148071" title="String">name</a><span class="delimiter">)</span>

  case <span class="keyword">class</span> <a title="class Header extends java.lang.Object with ScalaObject with Product with Serializable" id="147683">Header</a><a href="#147683" title="ScalaObject" class="delimiter">(</a><a title="Int" id="147702">level</a>: <span title="Int">Int</span> = <span title="Int(1)" class="int">1</span>, <a title="scala.xml.Node" id="147703">node</a>: <span title="scala.xml.Node">Node</span> = <span title="scala.xml.Atom[java.lang.String]" class="keyword">new</span> <span title="scala.xml.Atom[java.lang.String]">Atom</span><span class="delimiter">(</span><span title="java.lang.String(&quot;first level&quot;)" class="string">&quot;first level&quot;</span><span class="delimiter">)</span>, <a title="org.specs2.data.UniqueNames" id="147704">namer</a>: <a href="../data/UniqueNames.scala.html#10075" title="org.specs2.data.UniqueNames">UniqueNames</a> = <a href="#146269" title="=&gt; org.specs2.data.UniqueNames">uniqueNamer</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; String" id="147694">name</a> = <a href="#146257" title="(n: scala.xml.Node)String">nodeText</a><span class="delimiter">(</span><a href="#147703" title="=&gt; scala.xml.Node">node</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="147695">isRoot</a> = <a href="#147694" title="=&gt; String">name</a>.<span title="()Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#147696" title="=&gt; Boolean">isSubtoc</a>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="147696">isSubtoc</a> = <a href="#10422" title="Htmlx.this.type">outer</a>.<a href="#146266" title="(e: scala.xml.Node)Boolean">isSubtoc</a><span class="delimiter">(</span><a href="#147703" title="=&gt; scala.xml.Node">node</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="=&gt; org.specs2.html.package.SpecId" id="147697">specId</a>: <a href="../data/TaggedTypes.scala.html#148146" title="org.specs2.html.package.SpecId">SpecId</a> = <a href="package.scala.html#13407" title="(id: String)org.specs2.html.package.SpecId">SpecId</a><span class="delimiter">(</span><a href="#147703" title="=&gt; scala.xml.Node">node</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>.<span title="(key: String)Option[Seq[scala.xml.Node]]">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;specId&quot;)" class="string">&quot;specId&quot;</span><span class="delimiter">)</span>.<span title="(f: Seq[scala.xml.Node] =&gt; String)Option[String]">map</span><span class="delimiter">(</span><a href="#148162" title="Seq[scala.xml.Node]">_</a>.<span title="()String">toString</span><span class="delimiter">)</span>.<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; String" id="147698">anchorName</a>: <span title="String">String</span> = <a href="#146246" title="implicit org.specs2.html.Htmlx.href : (s: String)Htmlx.this.HRef">name</a>.<a href="#146343" title="=&gt; java.lang.String">anchorName</a>
    <span class="keyword">def</span> <a title="(baseUrl: String)String" id="147699">anchorName</a><span class="delimiter">(</span><a title="String" id="148200">baseUrl</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#146268" title="(text: String, namer: org.specs2.data.UniqueNames)java.lang.String">createAnchorNameForNode</a><span class="delimiter">(</span><a href="#148200" title="String">baseUrl</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#147698" title="=&gt; String">anchorName</a>, <a href="#147704" title="=&gt; org.specs2.data.UniqueNames">namer</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">implicit</span> <span class="keyword">object</span> <a title="object Htmlx.this.HeaderShow" id="146255">HeaderShow</a> <span title="ScalaObject" class="keyword">extends</span> <span title="org.specs2.internal.scalaz.Show[Htmlx.this.Header]">Show</span><span class="delimiter">[</span>Header<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(h: Htmlx.this.Header)List[Char]" id="146526">show</a><span class="delimiter">(</span><a title="Htmlx.this.Header" id="148276">h</a> : <a href="#147683" title="Htmlx.this.Header">Header</a><span class="delimiter">)</span> = <a href="#148276" title="Htmlx.this.Header">h</a>.<a href="#147694" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">name</a>.<span title="=&gt; List[Char]">toList</span>
  <span class="delimiter">}</span>

  <span class="comment">/** @return the text of the first child of a Node, removing notoc elements */</span>
  <span class="keyword">def</span> <a title="(n: scala.xml.Node)String" id="146257">nodeText</a><span class="delimiter">(</span><a title="scala.xml.Node" id="146866">n</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> = &lt;<a title="scala.xml.Elem" id="146869">a</a>&gt;<span class="delimiter">{</span><a href="#146866" title="scala.xml.Node">n</a>.<span title="=&gt; Seq[scala.xml.Node]">child</span>.<span title="(p: scala.xml.Node =&gt; Boolean)Seq[scala.xml.Node]">filterNot</span><span class="delimiter">(</span><a href="#146875" title="scala.xml.Node">_</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#146260" title="=&gt; scala.util.matching.Regex">NotocTag</a>.<span title="()String">toString</span><span class="delimiter">)</span><span class="delimiter">}</span>&lt;/a&gt;.<span title="=&gt; String">text</span>
  <span class="comment">/** regular expression for a Header Tag */</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="146258">HeaderTag</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;h(\\d)&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
  <span class="comment">/** regular expression for a notoc Tag */</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="146260">NotocTag</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;notoc&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
  <span class="comment">/** regular expression for a Subtoc Tag */</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="146262">SubtocTag</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;subtoc&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
  <span class="comment">/** @return true if the element is a header */</span>
  <span class="keyword">def</span> <a title="(e: scala.xml.Node)Boolean" id="146264">isHeader</a><span class="delimiter">(</span><a title="scala.xml.Node" id="146852">e</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> = <a href="#146852" title="scala.xml.Node">e</a>.<span title="=&gt; String">label</span>.<span title="(x$1: java.lang.String)Boolean">matches</span><span class="delimiter">(</span><a href="#146258" title="=&gt; scala.util.matching.Regex">HeaderTag</a>.<span title="()String">toString</span><span class="delimiter">)</span>
  <span class="comment">/** @return true if the element is a &lt;notoc/&gt; element */</span>
  <span class="keyword">def</span> <a title="(e: scala.xml.Node)Boolean" id="146265">isNotoc</a><span class="delimiter">(</span><a title="scala.xml.Node" id="147676">e</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> = <a href="#147676" title="scala.xml.Node">e</a>.<span title="=&gt; String">label</span>.<span title="(x$1: java.lang.String)Boolean">matches</span><span class="delimiter">(</span><a href="#146260" title="=&gt; scala.util.matching.Regex">NotocTag</a>.<span title="()String">toString</span><span class="delimiter">)</span>
  <span class="comment">/** @return true if the element is a subtoc element */</span>
  <span class="keyword">def</span> <a title="(e: scala.xml.Node)Boolean" id="146266">isSubtoc</a><span class="delimiter">(</span><a title="scala.xml.Node" id="147671">e</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> = <a href="#147671" title="scala.xml.Node">e</a>.<span title="=&gt; String">label</span>.<span title="(x$1: java.lang.String)Boolean">matches</span><span class="delimiter">(</span><a href="#146262" title="=&gt; scala.util.matching.Regex">SubtocTag</a>.<span title="()String">toString</span><span class="delimiter">)</span>

  <span class="comment">/** This rule can be used to add anchors to header elements */</span>
  <span class="keyword">def</span> <a title="=&gt; scala.xml.transform.RewriteRule{val namer: org.specs2.data.UniqueNames; def applyTransformation(ns: Seq[scala.xml.Node]): Seq[scala.xml.Node]; def applyTransformation(n: scala.xml.Node): Seq[scala.xml.Node]; def addTo(n: scala.xml.Node): Seq[scala.xml.Node]}" id="146267">headersAnchors</a> = <a href="#146737" title="scala.xml.transform.RewriteRule{val namer: org.specs2.data.UniqueNames; def applyTransformation(ns: Seq[scala.xml.Node]): Seq[scala.xml.Node]; def applyTransformation(n: scala.xml.Node): Seq[scala.xml.Node]; def addTo(n: scala.xml.Node): Seq[scala.xml.Node]}" class="keyword">new</a> <a title="anonymous class $anon extends scala.xml.transform.RewriteRule" id="146737">RewriteRule</a> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.specs2.data.UniqueNames" id="146746">namer</a> = <a href="#146269" title="=&gt; org.specs2.data.UniqueNames">uniqueNamer</a>

    <span class="keyword">def</span> <a title="(ns: Seq[scala.xml.Node])Seq[scala.xml.Node]" id="146748">applyTransformation</a><span class="delimiter">(</span><a title="Seq[scala.xml.Node]" id="146769">ns</a>: <span title="Seq[scala.xml.Node]">Seq</span><span class="delimiter">[</span>Node<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Seq[scala.xml.Node]">Seq</span><span class="delimiter">[</span>Node<span class="delimiter">]</span> = <span title="Seq[scala.xml.Node]" class="keyword">if</span> <span class="delimiter">(</span><a href="#146769" title="Seq[scala.xml.Node]">ns</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#146769" title="Seq[scala.xml.Node]">ns</a> <span class="keyword">else</span> <span class="delimiter">(</span><a href="#146749" title="(n: scala.xml.Node)Seq[scala.xml.Node]">applyTransformation</a><span class="delimiter">(</span><a href="#146769" title="Seq[scala.xml.Node]">ns</a>.<span title="=&gt; scala.xml.Node">head</span><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[scala.xml.Node])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[scala.xml.Node],scala.xml.Node,Seq[scala.xml.Node]])Seq[scala.xml.Node]">++</span> <a href="#146748" title="(ns: Seq[scala.xml.Node])Seq[scala.xml.Node]">applyTransformation</a><span class="delimiter">(</span><a href="#146769" title="Seq[scala.xml.Node]">ns</a>.<span title="=&gt; Seq[scala.xml.Node]">tail</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(n: scala.xml.Node)Seq[scala.xml.Node]" id="146749">applyTransformation</a><span class="delimiter">(</span><a title="scala.xml.Node" id="146770">n</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span>: <span title="Seq[scala.xml.Node]">Seq</span><span class="delimiter">[</span>Node<span class="delimiter">]</span> = <a href="#146770" title="scala.xml.Node">n</a> <span title="Seq[scala.xml.Node]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="scala.xml.Elem" id="146851">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#146264" title="(e: scala.xml.Node)Boolean">isHeader</a><span class="delimiter">(</span><a href="#146851" title="scala.xml.Elem">e</a><span class="delimiter">)</span> =&gt; &lt;<a title="scala.xml.MetaData" id="146979">a</a> name = <span class="delimiter">{</span><a href="#146268" title="(text: String, namer: org.specs2.data.UniqueNames)java.lang.String">createAnchorNameForNode</a><span class="delimiter">(</span><a href="#146257" title="(n: scala.xml.Node)String">nodeText</a><a href="#146246" title="implicit org.specs2.html.Htmlx.href : (s: String)Htmlx.this.HRef" class="delimiter">(</a><a href="#146851" title="scala.xml.Elem">e</a><span class="delimiter">)</span>.<a href="#146342" title="=&gt; java.lang.String">sanitize</a>, <a href="#146746" title="=&gt; org.specs2.data.UniqueNames">namer</a><span class="delimiter">)</span><span class="delimiter">}</span>&gt;<span class="delimiter">{</span><a href="#146851" title="scala.xml.Elem">e</a><span class="delimiter">}</span>&lt;/a&gt;
      <span class="keyword">case</span> <span title="scala.xml.Group">Group</span><span class="delimiter">(</span><a title="Seq[scala.xml.Node]" id="147012">xs</a><span class="delimiter">)</span>              =&gt; <span title="(nodes: Seq[scala.xml.Node])scala.xml.Group">Group</span><span class="delimiter">(</span><a href="#146748" title="(ns: Seq[scala.xml.Node])Seq[scala.xml.Node]">applyTransformation</a><span class="delimiter">(</span><a href="#147012" title="Seq[scala.xml.Node]">xs</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Seq[scala.xml.Node]" id="147021">other</a>                  =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Seq[scala.xml.Node]" id="147022">ch</a> = <a href="#146770" title="scala.xml.Node">n</a>.<span title="=&gt; Seq[scala.xml.Node]">child</span>
        <span class="keyword">val</span> <a title="Seq[scala.xml.Node]" id="147023">nch</a> = <a href="#146748" title="(ns: Seq[scala.xml.Node])Seq[scala.xml.Node]">applyTransformation</a><span class="delimiter">(</span><a href="#147022" title="Seq[scala.xml.Node]">ch</a><span class="delimiter">)</span>
        <span title="Seq[scala.xml.Node]" class="keyword">if</span> <span class="delimiter">(</span><a href="#147022" title="Seq[scala.xml.Node]">ch</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#147023" title="Seq[scala.xml.Node]">nch</a><span class="delimiter">)</span> <a href="#146770" title="scala.xml.Node">n</a>
        <span class="keyword">else</span>           <span title="(prefix: String, label: String, attributes: scala.xml.MetaData, scope: scala.xml.NamespaceBinding, child: scala.xml.Node*)scala.xml.Elem">Elem</span><span class="delimiter">(</span><a href="#146770" title="scala.xml.Node">n</a>.<span title="=&gt; String">prefix</span>, <a href="#146770" title="scala.xml.Node">n</a>.<span title="=&gt; String">label</span>, <a href="#146770" title="scala.xml.Node">n</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <a href="#146770" title="scala.xml.Node">n</a>.<span title="=&gt; scala.xml.NamespaceBinding">scope</span>, <a href="#147023" title="Seq[scala.xml.Node]">nch</a>: _*<span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(n: scala.xml.Node)Seq[scala.xml.Node]" id="146750">addTo</a><span class="delimiter">(</span><a title="scala.xml.Node" id="146771">n</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> = <a href="#146749" title="(n: scala.xml.Node)Seq[scala.xml.Node]">applyTransformation</a><span class="delimiter">(</span><a href="#146771" title="scala.xml.Node">n</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** @return a unique anchor name for that node, so that 2 nodes having the same name will not direct to the same anchor in the same page */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(text: String, namer: org.specs2.data.UniqueNames)java.lang.String" id="146268">createAnchorNameForNode</a><span class="delimiter">(</span><a title="String" id="146860">text</a>: <span title="String">String</span>, <a title="org.specs2.data.UniqueNames" id="146861">namer</a>: <a href="../data/UniqueNames.scala.html#10075" title="org.specs2.data.UniqueNames">UniqueNames</a><span class="delimiter">)</span> = <a href="#146861" title="org.specs2.data.UniqueNames">namer</a>.<a href="../data/UniqueNames.scala.html#118722" title="(name: String)java.lang.String">uniqueName</a><span class="delimiter">(</span><a href="#146860" title="String">text</a><span class="delimiter">)</span>
  <span class="comment">/** @return a unique namer adding + and an id if a name has already been used */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; org.specs2.data.UniqueNames" id="146269">uniqueNamer</a> = <a href="../data/UniqueNames.scala.html#118736" title="(separator: String)org.specs2.data.UniqueNames">UniqueNames</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/** @return the href urls in &lt;a/&gt; elements */</span>
  <span class="keyword">def</span> <a title="(ns: scala.xml.NodeSeq, filePath: String)Seq[String]" id="146270">urls</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="148368">ns</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>, <a title="String" id="148371">filePath</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(href: String)java.lang.String" id="148372">decode</a><span class="delimiter">(</span><a title="String" id="148373">href</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Seq[java.lang.String]" id="148374">splitted</a> = <a href="#148373" title="String">href</a>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;#&quot;)" class="string">&quot;#&quot;</span><span class="delimiter">)</span>.<span title="=&gt; Seq[java.lang.String]">toSeq</span>
      <span class="keyword">val</span> <a title="java.lang.String" id="148375">url</a>    = <span title="object java.net.URLDecoder">URLDecoder</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">decode</span><a href="../io/Paths.scala.html#51223" title="implicit org.specs2.io.Paths.toPath : (s: String)org.specs2.io.Path" class="delimiter">(</a><a href="#148374" title="(idx: Int)java.lang.String">splitted</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span>.<a href="../io/Paths.scala.html#146548" title="(path: String)java.lang.String">unrelativeTo</a><span class="delimiter">(</span><a href="#148371" title="String">filePath</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.lang.String" id="148376">anchor</a> = <a href="#148374" title="Seq[java.lang.String]">splitted</a>.<span title="(n: Int)Seq[java.lang.String]">drop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="=&gt; Option[java.lang.String]">lastOption</span>.<span title="(f: java.lang.String =&gt; java.lang.String)Option[java.lang.String]">map</span><span class="delimiter">(</span><a title="java.lang.String" id="148722">anchor</a> =&gt; <span title="java.lang.String(&quot;#&quot;)" class="string">&quot;#&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#148722" title="java.lang.String">anchor</a><span class="delimiter">)</span>.<span title="(default: =&gt; java.lang.String)java.lang.String">getOrElse</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
      <a href="#148375" title="java.lang.String">url</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#148376" title="java.lang.String">anchor</a>
    <span class="delimiter">}</span>
    <span class="delimiter">(</span><a href="#148368" title="scala.xml.NodeSeq">ns</a> <span title="(that: String)scala.xml.NodeSeq">\\</span> <span title="java.lang.String(&quot;a&quot;)" class="string">&quot;a&quot;</span><span class="delimiter">)</span>.<span title="(f: scala.xml.Node =&gt; scala.collection.GenTraversableOnce[java.lang.String])(implicit bf: scala.collection.generic.CanBuildFrom[scala.xml.NodeSeq,java.lang.String,Seq[String]])Seq[String]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Seq.Coll,java.lang.String,scala.collection.immutable.Seq[java.lang.String]]" class="delimiter">(</span><a title="scala.xml.Node" id="148746">a</a> =&gt; <a href="#148746" title="scala.xml.Node">a</a>.<span title="(key: String)Option[Seq[scala.xml.Node]]">attribute</span><span class="delimiter">(</span><span title="java.lang.String(&quot;href&quot;)" class="string">&quot;href&quot;</span><span class="delimiter">)</span>.<span title="(f: Seq[scala.xml.Node] =&gt; java.lang.String)Option[java.lang.String]">map</span><span title="(xo: Option[java.lang.String])Iterable[java.lang.String]" class="delimiter">(</span><a title="Seq[scala.xml.Node]" id="148753">href</a> =&gt; <a href="#148372" title="(href: String)java.lang.String">decode</a><span class="delimiter">(</span><a href="#148753" title="Seq[scala.xml.Node]">href</a>.<span title="=&gt; String">mkString</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="keyword">private</span><span class="delimiter">[</span>specs2<span class="delimiter">]</span>
<span class="keyword">object</span> <a title="object org.specs2.html.Htmlx" id="10423">Htmlx</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#10422" title="org.specs2.html.Htmlx">Html</a>x
        </pre>
    </body>
</html>