<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>org/specs2/io/Location.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> org.specs2
<span class="keyword">package</span> io

<span class="comment">/**
 * Location of a Fragment in a file.
 *
 * This class behavior is highly dependent on method calls in the FragmentsBuilder trait.
 *
 * Depending on the method that's called to create a fragment or to &quot;link&quot; it to another one, we have to do ad-hoc stacktrace
 * manipulations to determine the exact location of a Fragment.
 */</span>
<span class="keyword">class</span> <a title="class Location extends java.lang.Object with ScalaObject" id="10510">Location</a> <a href="#10510" title="ScalaObject" class="delimiter">{</a>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="org.specs2.control.TraceLocation" id="155606">location</a> = <a href="FromSource.scala.html#10505" title="object org.specs2.io.FromSource">FromSource</a>.<a href="FromSource.scala.html#34281" title="(stackFilter: Seq[java.lang.StackTraceElement] =&gt; Seq[java.lang.StackTraceElement])org.specs2.control.TraceLocation">location</a><span class="delimiter">(</span><a href="#155613" title="=&gt; Seq[java.lang.StackTraceElement] =&gt; Seq[java.lang.StackTraceElement]">fragmentFilter</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="155608">file</a>: <span title="String">String</span> = <a href="#155606" title="=&gt; org.specs2.control.TraceLocation">location</a>.<a href="../control/Throwablex.scala.html#97242" title="=&gt; String">fileName</a>
  <span class="keyword">def</span> <a title="=&gt; Int" id="155609">lineNumber</a>: <span title="Int">Int</span> = <a href="#155606" title="=&gt; org.specs2.control.TraceLocation">location</a>.<a href="../control/Throwablex.scala.html#97246" title="=&gt; Int">lineNumber</a>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="155610">toString</a> = <a href="#155606" title="=&gt; org.specs2.control.TraceLocation">location</a>.<a href="../control/Throwablex.scala.html#97253" title="=&gt; String">fullLocation</a>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(a: Any)Boolean" id="155611">equals</a><span class="delimiter">(</span><a title="Any" id="155791">a</a>: <span title="Any">Any</span><span class="delimiter">)</span> = <a href="#155791" title="Any">a</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="Boolean" id="155794">l</a>: <a href="#10510" title="org.specs2.io.Location">Location</a> =&gt; <a href="#155794" title="org.specs2.io.Location">l</a>.<a href="#155610" title="()String">toString</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#10510" title="Location.this.type" class="keyword">this</a>.<a href="#155610" title="()String">toString</a>
    <span class="keyword">case</span> <a title="Boolean(false)" id="155800">other</a>       =&gt; <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(s: String)Boolean" id="155612">isFragmentDefinition</a><span class="delimiter">(</span><a title="String" id="155637">s</a>: <span title="String">String</span><span class="delimiter">)</span> =
    <span title="(elems: java.lang.String*)Seq[java.lang.String]">Seq</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Described&quot;)" class="string">&quot;Described&quot;</span>,
        <span title="java.lang.String(&quot;InExample&quot;)" class="string">&quot;InExample&quot;</span>
  <span class="delimiter">)</span>.<span title="(f: java.lang.String =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[java.lang.String],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><span title="java.lang.String(&quot;org.specs2.mutable.FragmentsBuilder$&quot;)" class="string">&quot;org.specs2.mutable.FragmentsBuilder$&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#155662" title="java.lang.String">_</a><span class="delimiter">)</span>.<span title="(p: java.lang.String =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#155637" title="String">s</a>.<a href="#155690" title="(x$1: java.lang.CharSequence)Boolean">contains</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; Seq[java.lang.StackTraceElement] =&gt; Seq[java.lang.StackTraceElement]" id="155613">fragmentFilter</a> = <span class="delimiter">(</span>st: <span title="Seq[java.lang.StackTraceElement]">Seq</span><span class="delimiter">[</span>StackTraceElement<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
    <span class="comment">// for a mutable specification we drop the stacktrace until there are fragment</span>
    <span class="comment">// definitions then we drop the definition calls</span>
    <span title="Seq[java.lang.StackTraceElement]" class="keyword">if</span> <span class="delimiter">(</span><a href="#155617" title="(st: Seq[java.lang.StackTraceElement])Boolean">isMutableSpecification</a><span class="delimiter">(</span><a href="#155623" title="Seq[java.lang.StackTraceElement]">st</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#155623" title="Seq[java.lang.StackTraceElement]">st</a>.<span title="(p: java.lang.StackTraceElement =&gt; Boolean)Seq[java.lang.StackTraceElement]">dropWhile</span><span class="delimiter">(</span><a title="java.lang.StackTraceElement" id="155636">s</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#155612" title="(s: String)Boolean">isFragmentDefinition</a><span class="delimiter">(</span><a href="#155636" title="java.lang.StackTraceElement">s</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span><span class="delimiter">)</span>.
         <span title="(p: java.lang.StackTraceElement =&gt; Boolean)Seq[java.lang.StackTraceElement]">dropWhile</span><span class="delimiter">(</span><a title="java.lang.StackTraceElement" id="155696">s</a> =&gt; <a href="#155612" title="(s: String)Boolean">isFragmentDefinition</a><span class="delimiter">(</span><a href="#155696" title="java.lang.StackTraceElement">s</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="comment">// for an acceptance specification we have to drop some stacktrace element and adjust the line number of the method calls</span>
    <span class="comment">// to find out the exact location of a fragment</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Seq[java.lang.String]" id="155697">fragmentsMethods</a> = <span title="(elems: java.lang.String*)Seq[java.lang.String]">Seq</span><span class="delimiter">(</span><span title="java.lang.String(&quot;org.specs2&quot;)" class="string">&quot;org.specs2&quot;</span>, <span title="java.lang.String(&quot;.textStart&quot;)" class="string">&quot;.textStart&quot;</span>, <span title="java.lang.String(&quot;.textFragment&quot;)" class="string">&quot;.textFragment&quot;</span>, <span title="java.lang.String(&quot;.fragmentsFragments&quot;)" class="string">&quot;.fragmentsFragments&quot;</span>, <span title="java.lang.String(&quot;.p(&quot;)" class="string">&quot;.p(&quot;</span>, <span title="java.lang.String(&quot;.br(&quot;)" class="string">&quot;.br(&quot;</span>, <span title="java.lang.String(&quot;.t(&quot;)" class="string">&quot;.t(&quot;</span>, <span title="java.lang.String(&quot;.bt(&quot;)" class="string">&quot;.bt(&quot;</span>, <span title="java.lang.String(&quot;.end(&quot;)" class="string">&quot;.end(&quot;</span>, <span title="java.lang.String(&quot;.endp(&quot;)" class="string">&quot;.endp(&quot;</span>, <span title="java.lang.String(&quot;.endbr(&quot;)" class="string">&quot;.endbr(&quot;</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a href="#155699" title="(Seq[java.lang.StackTraceElement], Seq[java.lang.StackTraceElement])" class="delimiter">(</a><a href="#155698" title="Seq[java.lang.StackTraceElement]" id="155699">start</a>, <a href="#155698" title="Seq[java.lang.StackTraceElement]" id="155700">end</a><span class="delimiter">)</span> = <a href="#155623" title="Seq[java.lang.StackTraceElement]">st</a>.<span title="(p: java.lang.StackTraceElement =&gt; Boolean)(Seq[java.lang.StackTraceElement], Seq[java.lang.StackTraceElement])">span</span><span title="(Seq[java.lang.StackTraceElement], Seq[java.lang.StackTraceElement]) @unchecked" class="delimiter">(</span><a title="java.lang.StackTraceElement" id="155707">s</a> =&gt; <a href="#155697" title="Seq[java.lang.String]">fragmentsMethods</a>.<span title="(p: java.lang.String =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#155707" title="java.lang.StackTraceElement">s</a>.<a href="#155712" title="()java.lang.String">toString</a>.<a href="#155714" title="(x$1: java.lang.CharSequence)Boolean">contains</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="comment">// 155 is the magic line number of the &quot;FragmentsFragment::def ^(t: String) = fs add Text(t)&quot; method</span>
      <span title="Seq[java.lang.StackTraceElement]" class="keyword">if</span> <span class="delimiter">(</span><a href="#155615" title="(st: Seq[java.lang.StackTraceElement], method: String)Boolean">lastContains</a><span class="delimiter">(</span><a href="#155699" title="Seq[java.lang.StackTraceElement]">start</a>, <span title="java.lang.String(&quot;$up(FragmentsBuilder.scala:155&quot;)" class="string">&quot;$up(FragmentsBuilder.scala:155&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#155614" title="(st: Seq[java.lang.StackTraceElement])Boolean">isTextStart</a><span class="delimiter">(</span><a href="#155699" title="Seq[java.lang.StackTraceElement]">start</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#155616" title="(st: Seq[java.lang.StackTraceElement], defaultValue: java.lang.StackTraceElement, lineOffset: Int)Seq[java.lang.StackTraceElement]">takeHead</a><span class="delimiter">(</span><a href="#155700" title="Seq[java.lang.StackTraceElement]">end</a>, <a href="#155623" title="(idx: Int)java.lang.StackTraceElement">st</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, lineOffset = <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="Seq[java.lang.StackTraceElement]" class="keyword">if</span> <span class="delimiter">(</span><a href="#155615" title="(st: Seq[java.lang.StackTraceElement], method: String)Boolean">lastContains</a><span class="delimiter">(</span><a href="#155699" title="Seq[java.lang.StackTraceElement]">start</a>, <span title="java.lang.String(&quot;$up&quot;)" class="string">&quot;$up&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>                                              <a href="#155616" title="(st: Seq[java.lang.StackTraceElement], defaultValue: java.lang.StackTraceElement, lineOffset: Int)Seq[java.lang.StackTraceElement]">takeHead</a><span class="delimiter">(</span><a href="#155700" title="Seq[java.lang.StackTraceElement]">end</a>, <a href="#155623" title="(idx: Int)java.lang.StackTraceElement">st</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">else</span>                                                                              <a href="#155700" title="Seq[java.lang.StackTraceElement]">end</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(st: Seq[java.lang.StackTraceElement])Boolean" id="155614">isTextStart</a><span class="delimiter">(</span><a title="Seq[java.lang.StackTraceElement]" id="155740">st</a>: <span title="Seq[java.lang.StackTraceElement]">Seq</span><span class="delimiter">[</span>StackTraceElement<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#155740" title="Seq[java.lang.StackTraceElement]">st</a>.<span title="(p: java.lang.StackTraceElement =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#155748" title="java.lang.StackTraceElement">_</a>.<span title="()java.lang.String">toString</span>.<span title="(x$1: java.lang.CharSequence)Boolean">contains</span><span class="delimiter">(</span><span title="java.lang.String(&quot;.textStart&quot;)" class="string">&quot;.textStart&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(st: Seq[java.lang.StackTraceElement], method: String)Boolean" id="155615">lastContains</a><span class="delimiter">(</span><a title="Seq[java.lang.StackTraceElement]" id="155725">st</a>: <span title="Seq[java.lang.StackTraceElement]">Seq</span><span class="delimiter">[</span>StackTraceElement<span class="delimiter">]</span>, <a title="String" id="155726">method</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#155725" title="Seq[java.lang.StackTraceElement]">st</a>.<span title="=&gt; Option[java.lang.StackTraceElement]">lastOption</span>.<span title="(f: java.lang.StackTraceElement =&gt; Boolean)Option[Boolean]">map</span><span class="delimiter">(</span><a href="#155733" title="java.lang.StackTraceElement">_</a>.<span title="()java.lang.String">toString</span>.<span title="(x$1: java.lang.CharSequence)Boolean">contains</span><span class="delimiter">(</span><a href="#155726" title="String">method</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; Boolean)Boolean">getOrElse</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(st: Seq[java.lang.StackTraceElement], defaultValue: java.lang.StackTraceElement, lineOffset: Int)Seq[java.lang.StackTraceElement]" id="155616">takeHead</a><span class="delimiter">(</span><a title="Seq[java.lang.StackTraceElement]" id="155749">st</a>: <span title="Seq[java.lang.StackTraceElement]">Seq</span><span class="delimiter">[</span>StackTraceElement<span class="delimiter">]</span>, <a title="java.lang.StackTraceElement" id="155750">defaultValue</a>: <span title="java.lang.StackTraceElement">StackTraceElement</span>, <a title="Int" id="155754">lineOffset</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.lang.StackTraceElement" id="155755">stElement</a> = <a href="#155749" title="Seq[java.lang.StackTraceElement]">st</a>.<span title="=&gt; Option[java.lang.StackTraceElement]">headOption</span>.<span title="(default: =&gt; java.lang.StackTraceElement)java.lang.StackTraceElement">getOrElse</span><span class="delimiter">(</span><a href="#155750" title="java.lang.StackTraceElement">defaultValue</a><span class="delimiter">)</span>
    <span title="(elems: java.lang.StackTraceElement*)Seq[java.lang.StackTraceElement]">Seq</span><span class="delimiter">(</span><span title="java.lang.StackTraceElement" class="keyword">new</span> <span title="java.lang.StackTraceElement">StackTraceElement</span><span class="delimiter">(</span><a href="#155755" title="java.lang.StackTraceElement">stElement</a>.<span title="()java.lang.String">getClassName</span>, <a href="#155755" title="java.lang.StackTraceElement">stElement</a>.<span title="()java.lang.String">getMethodName</span>, <a href="#155755" title="java.lang.StackTraceElement">stElement</a>.<span title="()java.lang.String">getFileName</span>, <a href="#155755" title="java.lang.StackTraceElement">stElement</a>.<span title="()Int">getLineNumber</span><span title="(x: Int)Int">+</span><a href="#155754" title="Int">lineOffset</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(st: Seq[java.lang.StackTraceElement])Boolean" id="155617">isMutableSpecification</a><span class="delimiter">(</span><a title="Seq[java.lang.StackTraceElement]" id="155624">st</a>: <span title="Seq[java.lang.StackTraceElement]">Seq</span><span class="delimiter">[</span>StackTraceElement<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#155624" title="Seq[java.lang.StackTraceElement]">st</a>.<span title="(p: java.lang.StackTraceElement =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#155632" title="java.lang.StackTraceElement">_</a>.<span title="()java.lang.String">toString</span>.<span title="(x$1: java.lang.CharSequence)Boolean">contains</span><span class="delimiter">(</span><span title="java.lang.String(&quot;org.specs2.mutable.FragmentsBuilder&quot;)" class="string">&quot;org.specs2.mutable.FragmentsBuilder&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>