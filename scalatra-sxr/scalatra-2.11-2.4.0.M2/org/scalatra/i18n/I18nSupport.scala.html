<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>org/scalatra/i18n/I18nSupport.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
package org.scalatra
package i18n

import java.util.Locale
import javax.servlet.http.HttpServletRequest

object <a title="org.scalatra.i18n.I18nSupport.type" id="org.scalatra.i18n.I18nSupport">I18nSupport</a> <a href="#org.scalatra.i18n.I18nSupport" title="org.scalatra.i18n.I18nSupport.type" class="delimiter">{</a>
  val <a title="String" id="org.scalatra.i18n.I18nSupport.LocaleKey">LocaleKey</a> = <span title="String(&quot;org.scalatra.i18n.locale&quot;)" class="string">&quot;org.scalatra.i18n.locale&quot;</span>

  val <a title="String" id="org.scalatra.i18n.I18nSupport.UserLocalesKey">UserLocalesKey</a> = <span title="String(&quot;org.scalatra.i18n.userLocales&quot;)" class="string">&quot;org.scalatra.i18n.userLocales&quot;</span>

  val <a title="String" id="org.scalatra.i18n.I18nSupport.MessagesKey">MessagesKey</a> = <span title="String(&quot;messages&quot;)" class="string">&quot;messages&quot;</span>
<span class="delimiter">}</span>

trait <a title="trait I18nSupport extends AnyRef" id="org.scalatra.i18n;I18nSupport">I18nSupport</a> <span title="Unit" class="delimiter">{</span>

  this: ScalatraBase =&gt;

  import <a href="#org.scalatra.i18n.I18nSupport" title="org.scalatra.i18n.I18nSupport.type">I18nSupport</a>._


  def <a title="(implicit request: javax.servlet.http.HttpServletRequest)java.util.Locale" id="org.scalatra.i18n;I18nSupport.locale">locale</a><span class="delimiter">(</span>implicit <a title="javax.servlet.http.HttpServletRequest" id="org.scalatra.i18n;I18nSupport.locale.request">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span><span class="delimiter">)</span>: <span title="java.util.Locale">Locale</span>  = if <span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.locale.request" title="javax.servlet.http.HttpServletRequest">request</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
    throw new <a href="../exceptions.scala.html#org.scalatra;ScalatraException" title="org.scalatra.ScalatraException">ScalatraException</a><span class="delimiter">(</span><span title="String(&quot;There needs to be a request in scope to call locale&quot;)" class="string">&quot;There needs to be a request in scope to call locale&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span> else <span class="delimiter">{</span>
    <a href="../servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichRequest" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichRequest : (request: javax.servlet.http.HttpServletRequest)org.scalatra.servlet.RichRequest">request</a>.<a href="../servlet/AttributesMap.scala.html#org.scalatra.servlet;AttributesMap.get(adc3586498)" title="(key: String)Option[Any]">get</a><span class="delimiter">(</span><a href="#org.scalatra.i18n.I18nSupport.LocaleKey" title="=&gt; String">LocaleKey</a><span class="delimiter">)</span>.<span title="(f: Any =&gt; java.util.Locale)Option[java.util.Locale]">map</span><span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.locale.$anonfun.x$1" title="Any">_</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="java.util.Locale" class="delimiter">[</span><span title="java.util.Locale">Locale</span><span class="delimiter">]</span><span class="delimiter">)</span>.<span title="(implicit ev: &lt;:&lt;[Null,java.util.Locale])java.util.Locale">orNull</span>
  <span class="delimiter">}</span>

  def <a title="(implicit request: javax.servlet.http.HttpServletRequest)Array[java.util.Locale]" id="org.scalatra.i18n;I18nSupport.userLocales">userLocales</a><span class="delimiter">(</span>implicit <a title="javax.servlet.http.HttpServletRequest" id="org.scalatra.i18n;I18nSupport.userLocales.request">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span><span class="delimiter">)</span>: <span title="Array[java.util.Locale]">Array</span><span class="delimiter">[</span>Locale<span class="delimiter">]</span> = if <span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.userLocales.request" title="javax.servlet.http.HttpServletRequest">request</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
    throw new <a href="../exceptions.scala.html#org.scalatra;ScalatraException" title="org.scalatra.ScalatraException">ScalatraException</a><span class="delimiter">(</span><span title="String(&quot;There needs to be a request in scope to call userLocales&quot;)" class="string">&quot;There needs to be a request in scope to call userLocales&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span> else <span class="delimiter">{</span>
    <a href="../servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichRequest" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichRequest : (request: javax.servlet.http.HttpServletRequest)org.scalatra.servlet.RichRequest">request</a>.<a href="../servlet/AttributesMap.scala.html#org.scalatra.servlet;AttributesMap.get(adc3586498)" title="(key: String)Option[Any]">get</a><span class="delimiter">(</span><a href="#org.scalatra.i18n.I18nSupport.UserLocalesKey" title="=&gt; String">UserLocalesKey</a><span class="delimiter">)</span>.<span title="(f: Any =&gt; Array[java.util.Locale])Option[Array[java.util.Locale]]">map</span><span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.userLocales.$anonfun.x$2" title="Any">_</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Array[java.util.Locale]" class="delimiter">[</span><span title="Array[java.util.Locale]">Array</span><span class="delimiter">[</span>Locale<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>.<span title="(implicit ev: &lt;:&lt;[Null,Array[java.util.Locale]])Array[java.util.Locale]">orNull</span>
  <span class="delimiter">}</span>

  def <a title="(key: String)(implicit request: javax.servlet.http.HttpServletRequest)String" id="org.scalatra.i18n;I18nSupport.messages(3a8be32ac5)">messages</a><span class="delimiter">(</span><a title="String" id="org.scalatra.i18n;I18nSupport.messages(3a8be32ac5).key">key</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span>implicit <a title="javax.servlet.http.HttpServletRequest" id="org.scalatra.i18n;I18nSupport.messages(3a8be32ac5).request">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#org.scalatra.i18n;I18nSupport.messages(3b49e671ac)" title="(implicit request: javax.servlet.http.HttpServletRequest)org.scalatra.i18n.Messages">messages</a><a href="Messages.scala.html#org.scalatra.i18n;Messages.apply(7f807f64cc)" title="(key: String)String" class="delimiter">(</a><a href="#org.scalatra.i18n;I18nSupport.messages(3a8be32ac5).request" title="javax.servlet.http.HttpServletRequest">request</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.messages(3a8be32ac5).key" title="String">key</a><span class="delimiter">)</span>
  def <a title="(implicit request: javax.servlet.http.HttpServletRequest)org.scalatra.i18n.Messages" id="org.scalatra.i18n;I18nSupport.messages(3b49e671ac)">messages</a><span class="delimiter">(</span>implicit <a title="javax.servlet.http.HttpServletRequest" id="org.scalatra.i18n;I18nSupport.messages(3b49e671ac).request">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span><span class="delimiter">)</span>: <a href="Messages.scala.html#org.scalatra.i18n;Messages" title="org.scalatra.i18n.Messages">Messages</a> = if <span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.messages(3b49e671ac).request" title="javax.servlet.http.HttpServletRequest">request</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
    throw new <a href="../exceptions.scala.html#org.scalatra;ScalatraException" title="org.scalatra.ScalatraException">ScalatraException</a><span class="delimiter">(</span><span title="String(&quot;There needs to be a request in scope to call messages&quot;)" class="string">&quot;There needs to be a request in scope to call messages&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span> else <span class="delimiter">{</span>
    <a href="../servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichRequest" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichRequest : (request: javax.servlet.http.HttpServletRequest)org.scalatra.servlet.RichRequest">request</a>.<a href="../servlet/AttributesMap.scala.html#org.scalatra.servlet;AttributesMap.get(adc3586498)" title="(key: String)Option[Any]">get</a><span class="delimiter">(</span><a href="#org.scalatra.i18n.I18nSupport.MessagesKey" title="=&gt; String">MessagesKey</a><span class="delimiter">)</span>.<span title="(f: Any =&gt; org.scalatra.i18n.Messages)Option[org.scalatra.i18n.Messages]">map</span><span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.messages(3b49e671ac).$anonfun.x$3" title="Any">_</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.scalatra.i18n.Messages" class="delimiter">[</span><a href="Messages.scala.html#org.scalatra.i18n;Messages" title="org.scalatra.i18n.Messages">Messages</a><span class="delimiter">]</span><span class="delimiter">)</span>.<span title="(implicit ev: &lt;:&lt;[Null,org.scalatra.i18n.Messages])org.scalatra.i18n.Messages">orNull</span>
  <span class="delimiter">}</span>


  <a href="../ScalatraBase.scala.html#org.scalatra;ScalatraBase.before" title="(transformers: org.scalatra.RouteTransformer*)(fun: =&gt; Any)Unit">before</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichRequest" title="(key: String, value: Any)Unit">request</a><span class="delimiter">(</span><a href="#org.scalatra.i18n.I18nSupport.LocaleKey" title="=&gt; String">LocaleKey</a><span class="delimiter">)</span> = <a href="#org.scalatra.i18n;I18nSupport.resolveLocale" title="=&gt; java.util.Locale">resolveLocale</a>
    <a href="../servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichRequest" title="(key: String, value: Any)Unit">request</a><span class="delimiter">(</span><a href="#org.scalatra.i18n.I18nSupport.MessagesKey" title="=&gt; String">MessagesKey</a><span class="delimiter">)</span> = <a href="#org.scalatra.i18n;I18nSupport.provideMessages" title="(locale: java.util.Locale)org.scalatra.i18n.Messages">provideMessages</a><span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.locale" title="(implicit request: javax.servlet.http.HttpServletRequest)java.util.Locale">locale</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Provides a default Message resolver
   *
   * @param locale Locale used to create instance
   * @return a new instance of Messages, override to provide own implementation
   */</span>
  def <a title="(locale: java.util.Locale)org.scalatra.i18n.Messages" id="org.scalatra.i18n;I18nSupport.provideMessages">provideMessages</a><span class="delimiter">(</span><a title="java.util.Locale" id="org.scalatra.i18n;I18nSupport.provideMessages.locale">locale</a>:<span title="java.util.Locale">Locale</span><span class="delimiter">)</span> : <a href="Messages.scala.html#org.scalatra.i18n;Messages" title="org.scalatra.i18n.Messages">Messages</a> = <a href="Messages.scala.html#org.scalatra.i18n.Messages.apply" title="(locale: java.util.Locale, bundlePath: String)org.scalatra.i18n.Messages">Messages</a><span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.provideMessages.locale" title="java.util.Locale">locale</a><span class="delimiter">)</span>

  <span class="comment">/*
  * Resolve Locale based on HTTP request parameter or Cookie
  */</span>
  private def <a title="=&gt; java.util.Locale" id="org.scalatra.i18n;I18nSupport.resolveLocale">resolveLocale</a>: <span title="java.util.Locale">Locale</span> = <span class="delimiter">{</span>
    <a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocale" title="=&gt; Option[java.util.Locale]">resolveHttpLocale</a> <span title="(default: =&gt; java.util.Locale)java.util.Locale">getOrElse</span> <a href="#org.scalatra.i18n;I18nSupport.defaultLocale" title="=&gt; java.util.Locale">defaultLocale</a>
  <span class="delimiter">}</span>

  <span class="comment">/*
   * Get locale either from HTTP param, Cookie or Accept-Language header.
   * 
   * If locale string is found in HTTP param, it will be set
   * in cookie. Later requests will read locale string directly from this
   *
   * If it's not found, then look at Accept-Language header.
   *
   * Locale strings are transformed to [[java.util.Locale]]
   *
   */</span>
  private def <a title="=&gt; Option[java.util.Locale]" id="org.scalatra.i18n;I18nSupport.resolveHttpLocale">resolveHttpLocale</a>: <span title="Option[java.util.Locale]">Option</span><span class="delimiter">[</span>Locale<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="delimiter">(</span><a href="../ScalatraBase.scala.html#org.scalatra;ScalatraBase.params(253444d747)" title="(implicit request: javax.servlet.http.HttpServletRequest)org.scalatra.Params">params</a>.<a href="../util/MultiMapHeadView.scala.html#org.scalatra.util;MultiMapHeadView.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="#org.scalatra.i18n.I18nSupport.LocaleKey" title="=&gt; String">LocaleKey</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="String" id="org.scalatra.i18n;I18nSupport.resolveHttpLocale.localeValue">localeValue</a><span class="delimiter">)</span> =&gt;
        <a href="../CookieSupport.scala.html#org.scalatra;CookieContext.cookies" title="=&gt; org.scalatra.SweetCookies">cookies</a>.<a href="../CookieSupport.scala.html#org.scalatra;SweetCookies.set" title="(name: String, value: String)(implicit cookieOptions: org.scalatra.CookieOptions)org.scalatra.Cookie">set</a><a href="../CookieSupport.scala.html#org.scalatra;CookieContext.cookieOptions" title="=&gt; org.scalatra.CookieOptions" class="delimiter">(</a><a href="#org.scalatra.i18n.I18nSupport.LocaleKey" title="=&gt; String">LocaleKey</a>, <a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocale.localeValue" title="String">localeValue</a><span class="delimiter">)</span>
        <span title="(x: String)Some[String]">Some</span><span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocale.localeValue" title="String">localeValue</a><span class="delimiter">)</span>
      case _ =&gt; <a href="../CookieSupport.scala.html#org.scalatra;CookieContext.cookies" title="=&gt; org.scalatra.SweetCookies">cookies</a>.<a href="../CookieSupport.scala.html#org.scalatra;SweetCookies.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="#org.scalatra.i18n.I18nSupport.LocaleKey" title="=&gt; String">LocaleKey</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="(f: String =&gt; java.util.Locale)Option[java.util.Locale]">map</span><span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.localeFromString" title="(in: String)java.util.Locale">localeFromString</a><span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocale.$anonfun.x$4" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[java.util.Locale])Option[java.util.Locale]">orElse</span> <a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent" title="=&gt; Option[java.util.Locale]">resolveHttpLocaleFromUserAgent</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Accept-Language header looks like &quot;de-DE,de;q=0.8,en-US;q=0.6,en;q=0.4&quot;
   * Specification see [[http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html]]
   * 
   * @return first preferred found locale or None
   */</span>
  private def <a title="=&gt; Option[java.util.Locale]" id="org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent">resolveHttpLocaleFromUserAgent</a>: <span title="Option[java.util.Locale]">Option</span><span class="delimiter">[</span>Locale<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <a href="../servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichRequest" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichRequest : (request: javax.servlet.http.HttpServletRequest)org.scalatra.servlet.RichRequest">request</a>.<a href="../servlet/RichRequest.scala.html#org.scalatra.servlet;RichRequest.headers" title="org.scalatra.servlet.RichRequest#headers.type">headers</a>.<a href="../servlet/RichRequest.scala.html#org.scalatra.servlet;RichRequest.headers.get" title="(name: String)Option[String]">get</a><span class="delimiter">(</span><span title="String(&quot;Accept-Language&quot;)" class="string">&quot;Accept-Language&quot;</span><span class="delimiter">)</span> <span title="(f: String =&gt; java.util.Locale)Option[java.util.Locale]">map</span> <span class="delimiter">{</span> <a title="String" id="org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.s">s</a> =&gt;
      val <a title="Array[java.util.Locale]" id="org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales">locales</a> = <a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.s" title="String">s</a>.<span title="(x$1: String)Array[String]">split</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span>.<span title="(f: String =&gt; java.util.Locale)(implicit bf: scala.collection.generic.CanBuildFrom[Array[String],java.util.Locale,Array[java.util.Locale]])Array[java.util.Locale]">map</span><span title="(implicit t: scala.reflect.ClassTag[java.util.Locale])scala.collection.generic.CanBuildFrom[Array[_],java.util.Locale,Array[java.util.Locale]]" class="delimiter">(</span><a title="String" id="org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.s">s</a> =&gt; <span class="delimiter">{</span>
        def <a title="(s: String)java.util.Locale" id="org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.splitLanguageCountry">splitLanguageCountry</a><span class="delimiter">(</span><a title="String" id="org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.splitLanguageCountry.s">s</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="java.util.Locale">Locale</span> = <span class="delimiter">{</span>
          val <a title="Array[String]" id="org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.splitLanguageCountry.langCountry">langCountry</a> = <a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.splitLanguageCountry.s" title="String">s</a>.<span title="(x$1: String)Array[String]">split</span><span class="delimiter">(</span><span title="String(&quot;-&quot;)" class="string">&quot;-&quot;</span><span class="delimiter">)</span>
          if <span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.splitLanguageCountry.langCountry" title="Array[String]">langCountry</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            new <span title="java.util.Locale">Locale</span><span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.splitLanguageCountry.langCountry" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">langCountry</a>.<span title="=&gt; String">head</span>, <a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.splitLanguageCountry.langCountry" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">langCountry</a>.<span title="=&gt; String">last</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> else <span class="delimiter">{</span>
            new <span title="java.util.Locale">Locale</span><span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.splitLanguageCountry.langCountry" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">langCountry</a>.<span title="=&gt; String">head</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span class="comment">// If this language has a quality index:</span>
        if <span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.s" title="String">s</a>.<span title="(x$1: String)Int">indexOf</span><span class="delimiter">(</span><span title="String(&quot;;&quot;)" class="string">&quot;;&quot;</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          val <a title="Array[String]" id="org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.qualityLocale">qualityLocale</a> = <a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.s" title="String">s</a>.<span title="(x$1: String)Array[String]">split</span><span class="delimiter">(</span><span title="String(&quot;;&quot;)" class="string">&quot;;&quot;</span><span class="delimiter">)</span>
          <a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.splitLanguageCountry" title="(s: String)java.util.Locale">splitLanguageCountry</a><span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.qualityLocale" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">qualityLocale</a>.<span title="=&gt; String">head</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> else <span class="delimiter">{</span>
          <a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.splitLanguageCountry" title="(s: String)java.util.Locale">splitLanguageCountry</a><span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales.$anonfun.s" title="String">s</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      <span class="comment">// save all found locales for later user</span>
      <a href="../DynamicScope.scala.html#org.scalatra;DynamicScope.request" title="=&gt; javax.servlet.http.HttpServletRequest">request</a>.<span title="(x$1: String, x$2: Any)Unit">setAttribute</span><span class="delimiter">(</span><a href="#org.scalatra.i18n.I18nSupport.UserLocalesKey" title="=&gt; String">UserLocalesKey</a>, <a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales" title="Array[java.util.Locale]">locales</a><span class="delimiter">)</span>

      <span class="comment">// We assume that all accept-languages are stored in order of quality</span>
      <span class="comment">// (so first language is preferred)</span>
      <a href="#org.scalatra.i18n;I18nSupport.resolveHttpLocaleFromUserAgent.$anonfun.locales" title="(xs: Array[java.util.Locale])scala.collection.mutable.ArrayOps[java.util.Locale]">locales</a>.<span title="=&gt; java.util.Locale">head</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Reads a locale from a String
   * @param in a string like en_GB or de_DE
   */</span>
  private def <a title="(in: String)java.util.Locale" id="org.scalatra.i18n;I18nSupport.localeFromString">localeFromString</a><span class="delimiter">(</span><a title="String" id="org.scalatra.i18n;I18nSupport.localeFromString.in">in</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="java.util.Locale">Locale</span> = <span class="delimiter">{</span>

      val <a title="Array[String]" id="org.scalatra.i18n;I18nSupport.localeFromString.token">token</a> = <a href="#org.scalatra.i18n;I18nSupport.localeFromString.in" title="String">in</a>.<span title="(x$1: String)Array[String]">split</span><span class="delimiter">(</span><span title="String(&quot;_&quot;)" class="string">&quot;_&quot;</span><span class="delimiter">)</span>
      new <span title="java.util.Locale">Locale</span><span class="delimiter">(</span><a href="#org.scalatra.i18n;I18nSupport.localeFromString.token" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">token</a>.<span title="=&gt; String">head</span>, <a href="#org.scalatra.i18n;I18nSupport.localeFromString.token" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">token</a>.<span title="=&gt; String">last</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private def <a title="=&gt; java.util.Locale" id="org.scalatra.i18n;I18nSupport.defaultLocale">defaultLocale</a>: <span title="java.util.Locale">Locale</span> = <span class="delimiter">{</span>
    <span title="java.util.Locale.type">Locale</span>.<span title="()java.util.Locale">getDefault</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
