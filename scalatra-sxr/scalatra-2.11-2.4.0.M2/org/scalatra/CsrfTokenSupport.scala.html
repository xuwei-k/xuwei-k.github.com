<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>org/scalatra/CsrfTokenSupport.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
package org.scalatra


import java.security.SecureRandom
import javax.servlet.http.HttpServletRequest

object <a title="org.scalatra.GenerateId.type" id="org.scalatra.GenerateId">GenerateId</a> <a href="#org.scalatra.GenerateId" title="org.scalatra.GenerateId.type" class="delimiter">{</a>
  def <a title="()String" id="org.scalatra.GenerateId.apply">apply</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <a href="#org.scalatra.GenerateId.generateCsrfToken" title="()String">generateCsrfToken</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private<span class="delimiter">[</span>this<span class="delimiter">]</span> def <a title="(bytes: Array[Byte])String" id="org.scalatra.GenerateId.hexEncode">hexEncode</a><span class="delimiter">(</span><a title="Array[Byte]" id="org.scalatra.GenerateId.hexEncode.bytes">bytes</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span> =  <span class="delimiter">(</span><span class="delimiter">(</span>new <span title="StringBuilder">StringBuilder</span><span class="delimiter">(</span><a href="#org.scalatra.GenerateId.hexEncode.bytes" title="Array[Byte]">bytes</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">*</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <a href="#org.scalatra.GenerateId.hexEncode.x$1" title="(z: StringBuilder)(op: (StringBuilder, Byte) =&gt; StringBuilder)StringBuilder">/:</a> <a href="#org.scalatra.GenerateId.hexEncode.bytes" title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">bytes</a><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="StringBuilder" id="org.scalatra.GenerateId.hexEncode.$anonfun.sb">sb</a>, <a title="Byte" id="org.scalatra.GenerateId.hexEncode.$anonfun.b">b</a><span class="delimiter">)</span> =&gt;
    if<span class="delimiter">(</span><span class="delimiter">(</span><a href="#org.scalatra.GenerateId.hexEncode.$anonfun.b" title="Byte">b</a>.<span title="=&gt; Int">toInt</span> <span title="(x: Int)Int">&amp;</span> <span title="Int(255)" class="int">0xff</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(16)" class="int">0x10</span><span class="delimiter">)</span> <a href="#org.scalatra.GenerateId.hexEncode.$anonfun.sb" title="StringBuilder">sb</a>.<span title="(s: String)StringBuilder">append</span><span class="delimiter">(</span><span title="String(&quot;0&quot;)" class="string">&quot;0&quot;</span><span class="delimiter">)</span>
    <a href="#org.scalatra.GenerateId.hexEncode.$anonfun.sb" title="StringBuilder">sb</a>.<span title="(s: String)StringBuilder">append</span><span class="delimiter">(</span><span title="Integer.type">Integer</span>.<span title="(x$1: Int, x$2: Int)String">toString</span><span class="delimiter">(</span><a href="#org.scalatra.GenerateId.hexEncode.$anonfun.b" title="Byte">b</a>.<span title="=&gt; Int">toInt</span> <span title="(x: Int)Int">&amp;</span> <span title="Int(255)" class="int">0xff</span>, <span title="Int(16)" class="int">16</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="()String">toString</span>

  protected def <a title="()String" id="org.scalatra.GenerateId.generateCsrfToken">generateCsrfToken</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    val <a title="Array[Byte]" id="org.scalatra.GenerateId.generateCsrfToken.tokenVal">tokenVal</a> = new <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(20)" class="int">20</span><span class="delimiter">)</span>
    <span class="delimiter">(</span>new <span title="java.security.SecureRandom">SecureRandom</span><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])Unit">nextBytes</span><span class="delimiter">(</span><a href="#org.scalatra.GenerateId.generateCsrfToken.tokenVal" title="Array[Byte]">tokenVal</a><span class="delimiter">)</span>
    <a href="#org.scalatra.GenerateId.hexEncode" title="(bytes: Array[Byte])String">hexEncode</a><span class="delimiter">(</span><a href="#org.scalatra.GenerateId.generateCsrfToken.tokenVal" title="Array[Byte]">tokenVal</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  @deprecated<span class="delimiter">(</span><span class="string">&quot;Use generateCsrfToken()&quot;</span>, <span class="string">&quot;2.0.0&quot;</span><span class="delimiter">)</span>
  protected def <a title="()String" id="org.scalatra.GenerateId.generateCSRFToken">generateCSRFToken</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#org.scalatra.GenerateId.generateCsrfToken" title="()String">generateCsrfToken</a><span class="delimiter">(</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

object <a title="org.scalatra.CsrfTokenSupport.type" id="org.scalatra.CsrfTokenSupport">CsrfTokenSupport</a> <a href="#org.scalatra.CsrfTokenSupport" title="org.scalatra.CsrfTokenSupport.type" class="delimiter">{</a>
  val <a title="String" id="org.scalatra.CsrfTokenSupport.DefaultKey">DefaultKey</a> = <span title="String(&quot;org.scalatra.CsrfTokenSupport.key&quot;)" class="string">&quot;org.scalatra.CsrfTokenSupport.key&quot;</span>
  val <a title="scala.collection.immutable.Vector[String]" id="org.scalatra.CsrfTokenSupport.HeaderNames">HeaderNames</a> = <span title="(elems: String*)scala.collection.immutable.Vector[String]">Vector</span><span class="delimiter">(</span><span title="String(&quot;X-CSRF-TOKEN&quot;)" class="string">&quot;X-CSRF-TOKEN&quot;</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Provides cross-site request forgery protection.
 *
 * Adds a before filter.  If a request is determined to be forged, the
 * `handleForgery()` hook is invoked.  Otherwise, a token for the next
 * request is prepared with `prepareCsrfToken`.
 */</span>
trait <a title="trait CsrfTokenSupport extends AnyRef" id="org.scalatra;CsrfTokenSupport">CsrfTokenSupport</a> <span title="Unit" class="delimiter">{</span> this: ScalatraBase =&gt;



  <a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.before" title="(transformers: org.scalatra.RouteTransformer*)(fun: =&gt; Any)Unit">before</a><span class="delimiter">(</span><a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.booleanBlock2RouteMatcher" title="implicit org.scalatra.ScalatraBase.booleanBlock2RouteMatcher : (block: =&gt; Boolean)org.scalatra.RouteMatcher">isForged</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#org.scalatra;CsrfTokenSupport.handleForgery" title="()Unit">handleForgery</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>
  <a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.before" title="(transformers: org.scalatra.RouteTransformer*)(fun: =&gt; Any)Unit">before</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#org.scalatra;CsrfTokenSupport.prepareCsrfToken" title="()Any">prepareCsrfToken</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="comment">/**
   * Tests whether a request with a unsafe method is a potential cross-site
   * forgery.
   *
   * @return true if the request is an unsafe method (POST, PUT, DELETE, TRACE,
   * CONNECT, PATCH) and the request parameter at `csrfKey` does not match
   * the session key of the same name.
   */</span>
  protected def <a title="=&gt; Boolean" id="org.scalatra;CsrfTokenSupport.isForged">isForged</a>: <span title="Boolean">Boolean</span> =
    <span title="=&gt; Boolean">!</span><a href="servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichRequest" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichRequest : (request: javax.servlet.http.HttpServletRequest)org.scalatra.servlet.RichRequest">request</a>.<a href="servlet/RichRequest.scala.html#org.scalatra.servlet;RichRequest.requestMethod" title="=&gt; org.scalatra.HttpMethod">requestMethod</a>.<a href="HttpMethod.scala.html#org.scalatra;HttpMethod.isSafe" title="=&gt; Boolean">isSafe</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
      <a href="servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichSession" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichSession : (session: javax.servlet.http.HttpSession)org.scalatra.servlet.RichSession">session</a>.<a href="servlet/AttributesMap.scala.html#org.scalatra.servlet;AttributesMap.get(adc3586498)" title="(key: String)Option[Any]">get</a><span class="delimiter">(</span><a href="#org.scalatra;CsrfTokenSupport.csrfKey" title="=&gt; String">csrfKey</a><span class="delimiter">)</span> <span title="(x$1: Any)Boolean">!=</span> <a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.params(253444d747)" title="(implicit request: javax.servlet.http.HttpServletRequest)org.scalatra.Params">params</a>.<a href="util/MultiMapHeadView.scala.html#org.scalatra.util;MultiMapHeadView.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="#org.scalatra;CsrfTokenSupport.csrfKey" title="=&gt; String">csrfKey</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
      <span title="=&gt; Boolean">!</span><a href="#org.scalatra.CsrfTokenSupport" title="org.scalatra.CsrfTokenSupport.type">CsrfTokenSupport</a>.<a href="#org.scalatra.CsrfTokenSupport.HeaderNames" title="=&gt; scala.collection.immutable.Vector[String]">HeaderNames</a>.<span title="(f: String =&gt; Option[String])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector[String],Option[String],scala.collection.immutable.Vector[Option[String]]])scala.collection.immutable.Vector[Option[String]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector.Coll,Option[String],scala.collection.immutable.Vector[Option[String]]]" class="delimiter">(</span><a href="servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichRequest" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichRequest : (request: javax.servlet.http.HttpServletRequest)org.scalatra.servlet.RichRequest">request</a>.<a href="servlet/RichRequest.scala.html#org.scalatra.servlet;RichRequest.headers" title="org.scalatra.servlet.RichRequest#headers.type">headers</a>.<a href="servlet/RichRequest.scala.html#org.scalatra.servlet;RichRequest.headers.get" title="(name: String)Option[String]">get</a><span class="delimiter">)</span>.<span title="(elem: Option[Any])Boolean">contains</span><span class="delimiter">(</span><a href="servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichSession" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichSession : (session: javax.servlet.http.HttpSession)org.scalatra.servlet.RichSession">session</a>.<a href="servlet/AttributesMap.scala.html#org.scalatra.servlet;AttributesMap.get(adc3586498)" title="(key: String)Option[Any]">get</a><span class="delimiter">(</span><a href="#org.scalatra;CsrfTokenSupport.csrfKey" title="=&gt; String">csrfKey</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Take an action when a forgery is detected. The default action
   * halts further request processing and returns a 403 HTTP status code.
   */</span>
  protected def <a title="()Unit" id="org.scalatra;CsrfTokenSupport.handleForgery">handleForgery</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="control.scala.html#org.scalatra;Control.halt(aaab4af702)" title="(status: Integer, body: String, headers: Map[String,String], reason: String)(implicit evidence$1: Manifest[String])Nothing">halt</a><span title="(clazz: Class[_])scala.reflect.Manifest[String]" class="delimiter">(</span><span title="implicit scala.Predef.int2Integer : (x: Int)Integer" class="int">403</span>, <span title="String(&quot;Request tampering detected!&quot;)" class="string">&quot;Request tampering detected!&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Prepares a CSRF token.  The default implementation uses `GenerateId`
   * and stores it on the session.
   */</span>
  protected def <a title="()Any" id="org.scalatra;CsrfTokenSupport.prepareCsrfToken">prepareCsrfToken</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichSession" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichSession : (session: javax.servlet.http.HttpSession)org.scalatra.servlet.RichSession">session</a>.<span title="(key: String, op: =&gt; Any)Any">getOrElseUpdate</span><span class="delimiter">(</span><a href="#org.scalatra;CsrfTokenSupport.csrfKey" title="=&gt; String">csrfKey</a>, <a href="#org.scalatra.GenerateId.apply" title="()String">GenerateId</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  @deprecated<span class="delimiter">(</span><span class="string">&quot;Use prepareCsrfToken()&quot;</span>, <span class="string">&quot;2.0.0&quot;</span><span class="delimiter">)</span>
  protected def <a title="()Any" id="org.scalatra;CsrfTokenSupport.prepareCSRFToken">prepareCSRFToken</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#org.scalatra;CsrfTokenSupport.prepareCsrfToken" title="()Any">prepareCsrfToken</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/**
   * The key used to store the token on the session, as well as the parameter
   * of the request.
   */</span>
  def <a title="=&gt; String" id="org.scalatra;CsrfTokenSupport.csrfKey">csrfKey</a>: <span title="String">String</span> = <a href="#org.scalatra.CsrfTokenSupport" title="org.scalatra.CsrfTokenSupport.type">CsrfTokenSupport</a>.<a href="#org.scalatra.CsrfTokenSupport.DefaultKey" title="=&gt; String">DefaultKey</a>

  <span class="comment">/**
   * Returns the token from the session.
   */</span>
  protected<span class="delimiter">[</span>scalatra<span class="delimiter">]</span> def <a title="(implicit request: javax.servlet.http.HttpServletRequest)String" id="org.scalatra;CsrfTokenSupport.csrfToken">csrfToken</a><span class="delimiter">(</span>implicit <a title="javax.servlet.http.HttpServletRequest" id="org.scalatra;CsrfTokenSupport.csrfToken.request">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span><span class="delimiter">)</span>: <span title="String">String</span> =
    <a href="#org.scalatra;CsrfTokenSupport.csrfToken.request" title="javax.servlet.http.HttpServletRequest">request</a>.<span title="()javax.servlet.http.HttpSession">getSession</span>.<span title="(x$1: String)Object">getAttribute</span><span class="delimiter">(</span><a href="#org.scalatra;CsrfTokenSupport.csrfKey" title="=&gt; String">csrfKey</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="String" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span>
<span class="delimiter">}</span>


trait <a title="trait XsrfTokenSupport extends AnyRef" id="org.scalatra;XsrfTokenSupport">XsrfTokenSupport</a> <span title="Unit" class="delimiter">{</span> this: ScalatraBase =&gt;

  import <a href="#org.scalatra.XsrfTokenSupport" title="org.scalatra.XsrfTokenSupport.type">XsrfTokenSupport</a>._
  <span class="comment">/**
   * The key used to store the token on the session, as well as the parameter
   * of the request.
   */</span>
  def <a title="=&gt; String" id="org.scalatra;XsrfTokenSupport.xsrfKey">xsrfKey</a>: <span title="String">String</span> = <a href="#org.scalatra.XsrfTokenSupport.DefaultKey" title="=&gt; String">DefaultKey</a>

  <span class="comment">/**
   * Returns the token from the session.
   */</span>
  def <a title="(implicit request: javax.servlet.http.HttpServletRequest)String" id="org.scalatra;XsrfTokenSupport.xsrfToken">xsrfToken</a><span class="delimiter">(</span>implicit <a title="javax.servlet.http.HttpServletRequest" id="org.scalatra;XsrfTokenSupport.xsrfToken.request">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span><span class="delimiter">)</span>: <span title="String">String</span> =
    <a href="#org.scalatra;XsrfTokenSupport.xsrfToken.request" title="javax.servlet.http.HttpServletRequest">request</a>.<span title="()javax.servlet.http.HttpSession">getSession</span>.<span title="(x$1: String)Object">getAttribute</span><span class="delimiter">(</span><a href="#org.scalatra;XsrfTokenSupport.xsrfKey" title="=&gt; String">xsrfKey</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="String" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span>

  def <a title="(only: org.scalatra.RouteTransformer*)Unit" id="org.scalatra;XsrfTokenSupport.xsrfGuard">xsrfGuard</a><span class="delimiter">(</span><a title="org.scalatra.RouteTransformer*" id="org.scalatra;XsrfTokenSupport.xsrfGuard.only">only</a>: <span title="org.scalatra.RouteTransformer*">RouteTransformer</span>*<span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.before" title="(transformers: org.scalatra.RouteTransformer*)(fun: =&gt; Any)Unit">before</a><span class="delimiter">(</span><span class="delimiter">(</span><a href="#org.scalatra;XsrfTokenSupport.xsrfGuard.only" title="org.scalatra.RouteTransformer*">only</a>.<span title="=&gt; Seq[org.scalatra.RouteTransformer]">toSeq</span> <span title="(that: scala.collection.GenTraversableOnce[org.scalatra.RouteTransformer])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.scalatra.RouteTransformer],org.scalatra.RouteTransformer,Seq[org.scalatra.RouteTransformer]])Seq[org.scalatra.RouteTransformer]">++</span> <span title="[A](elems: A*)Seq[A]">Seq</span><span title="(elems: org.scalatra.RouteTransformer*)Seq[org.scalatra.RouteTransformer]" class="delimiter">[</span><a href="package.scala.html#org.scalatra.package;RouteTransformer" title="org.scalatra.RouteTransformer">RouteTransformer</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.booleanBlock2RouteMatcher" title="implicit org.scalatra.ScalatraBase.booleanBlock2RouteMatcher : (block: =&gt; Boolean)org.scalatra.RouteMatcher">isForged</a><span class="delimiter">)</span><span class="delimiter">)</span>:_*<span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#org.scalatra;XsrfTokenSupport.handleForgery" title="()Unit">handleForgery</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.before" title="(transformers: org.scalatra.RouteTransformer*)(fun: =&gt; Any)Unit">before</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#org.scalatra;XsrfTokenSupport.prepareXsrfToken" title="()Any">prepareXsrfToken</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="comment">/**
   * Tests whether a request with a unsafe method is a potential cross-site
   * forgery.
   *
   * @return true if the request is an unsafe method (POST, PUT, DELETE, TRACE,
   * CONNECT, PATCH) and the request parameter at `xsrfKey` does not match
   * the session key of the same name.
   */</span>
  protected def <a title="=&gt; Boolean" id="org.scalatra;XsrfTokenSupport.isForged">isForged</a>: <span title="Boolean">Boolean</span> =
    <span title="=&gt; Boolean">!</span><a href="servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichRequest" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichRequest : (request: javax.servlet.http.HttpServletRequest)org.scalatra.servlet.RichRequest">request</a>.<a href="servlet/RichRequest.scala.html#org.scalatra.servlet;RichRequest.requestMethod" title="=&gt; org.scalatra.HttpMethod">requestMethod</a>.<a href="HttpMethod.scala.html#org.scalatra;HttpMethod.isSafe" title="=&gt; Boolean">isSafe</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
      <a href="servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichSession" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichSession : (session: javax.servlet.http.HttpSession)org.scalatra.servlet.RichSession">session</a>.<a href="servlet/AttributesMap.scala.html#org.scalatra.servlet;AttributesMap.get(adc3586498)" title="(key: String)Option[Any]">get</a><span class="delimiter">(</span><a href="#org.scalatra;XsrfTokenSupport.xsrfKey" title="=&gt; String">xsrfKey</a><span class="delimiter">)</span> <span title="(x$1: Any)Boolean">!=</span> <a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.params(253444d747)" title="(implicit request: javax.servlet.http.HttpServletRequest)org.scalatra.Params">params</a>.<a href="util/MultiMapHeadView.scala.html#org.scalatra.util;MultiMapHeadView.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="#org.scalatra;XsrfTokenSupport.xsrfKey" title="=&gt; String">xsrfKey</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
      <span title="=&gt; Boolean">!</span><a href="#org.scalatra.XsrfTokenSupport.HeaderNames" title="=&gt; scala.collection.immutable.Vector[String]">HeaderNames</a>.<span title="(f: String =&gt; Option[String])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector[String],Option[String],scala.collection.immutable.Vector[Option[String]]])scala.collection.immutable.Vector[Option[String]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector.Coll,Option[String],scala.collection.immutable.Vector[Option[String]]]" class="delimiter">(</span><a href="servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichRequest" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichRequest : (request: javax.servlet.http.HttpServletRequest)org.scalatra.servlet.RichRequest">request</a>.<a href="servlet/RichRequest.scala.html#org.scalatra.servlet;RichRequest.headers" title="org.scalatra.servlet.RichRequest#headers.type">headers</a>.<a href="servlet/RichRequest.scala.html#org.scalatra.servlet;RichRequest.headers.get" title="(name: String)Option[String]">get</a><span class="delimiter">)</span>.<span title="(elem: Option[Any])Boolean">contains</span><span class="delimiter">(</span><a href="servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichSession" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichSession : (session: javax.servlet.http.HttpSession)org.scalatra.servlet.RichSession">session</a>.<a href="servlet/AttributesMap.scala.html#org.scalatra.servlet;AttributesMap.get(adc3586498)" title="(key: String)Option[Any]">get</a><span class="delimiter">(</span><a href="#org.scalatra;XsrfTokenSupport.xsrfKey" title="=&gt; String">xsrfKey</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Take an action when a forgery is detected. The default action
   * halts further request processing and returns a 403 HTTP status code.
   */</span>
  protected def <a title="()Unit" id="org.scalatra;XsrfTokenSupport.handleForgery">handleForgery</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="control.scala.html#org.scalatra;Control.halt(aaab4af702)" title="(status: Integer, body: String, headers: Map[String,String], reason: String)(implicit evidence$1: Manifest[String])Nothing">halt</a><span title="(clazz: Class[_])scala.reflect.Manifest[String]" class="delimiter">(</span><span title="implicit scala.Predef.int2Integer : (x: Int)Integer" class="int">403</span>, <span title="String(&quot;Request tampering detected!&quot;)" class="string">&quot;Request tampering detected!&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Prepares a XSRF token.  The default implementation uses `GenerateId`
   * and stores it on the session.
   */</span>
  protected def <a title="()Any" id="org.scalatra;XsrfTokenSupport.prepareXsrfToken">prepareXsrfToken</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichSession" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichSession : (session: javax.servlet.http.HttpSession)org.scalatra.servlet.RichSession">session</a>.<span title="(key: String, op: =&gt; Any)Any">getOrElseUpdate</span><span class="delimiter">(</span><a href="#org.scalatra;XsrfTokenSupport.xsrfKey" title="=&gt; String">xsrfKey</a>, <a href="#org.scalatra.GenerateId.apply" title="()String">GenerateId</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    val <a title="Option[String]" id="org.scalatra;XsrfTokenSupport.prepareXsrfToken.cookieOpt">cookieOpt</a> = <a href="CookieSupport.scala.html#org.scalatra;CookieContext.cookies" title="=&gt; org.scalatra.SweetCookies">cookies</a>.<a href="CookieSupport.scala.html#org.scalatra;SweetCookies.get" title="(key: String)Option[String]">get</a><span class="delimiter">(</span><a href="#org.scalatra.XsrfTokenSupport.CookieKey" title="=&gt; String">CookieKey</a><span class="delimiter">)</span>
    if <span class="delimiter">(</span><a href="#org.scalatra;XsrfTokenSupport.prepareXsrfToken.cookieOpt" title="Option[String]">cookieOpt</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">||</span> <a href="#org.scalatra;XsrfTokenSupport.prepareXsrfToken.cookieOpt" title="Option[String]">cookieOpt</a> <span title="(x$1: Any)Boolean">!=</span> <a href="servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichSession" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichSession : (session: javax.servlet.http.HttpSession)org.scalatra.servlet.RichSession">session</a>.<a href="servlet/AttributesMap.scala.html#org.scalatra.servlet;AttributesMap.get(adc3586498)" title="(key: String)Option[Any]">get</a><span class="delimiter">(</span><a href="#org.scalatra;XsrfTokenSupport.xsrfKey" title="=&gt; String">xsrfKey</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="CookieSupport.scala.html#org.scalatra;CookieContext.cookies" title="=&gt; org.scalatra.SweetCookies">cookies</a> <a href="CookieSupport.scala.html#org.scalatra;SweetCookies.+=" title="(keyValuePair: (String, String))(implicit cookieOptions: org.scalatra.CookieOptions)org.scalatra.Cookie">+=</a> <a href="#org.scalatra.XsrfTokenSupport.CookieKey" title="(self: String)ArrowAssoc[String]">CookieKey</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#org.scalatra;XsrfTokenSupport.xsrfToken" title="(implicit request: javax.servlet.http.HttpServletRequest)String">xsrfToken</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

object <a title="org.scalatra.XsrfTokenSupport.type" id="org.scalatra.XsrfTokenSupport">XsrfTokenSupport</a> <a href="#org.scalatra.XsrfTokenSupport" title="org.scalatra.XsrfTokenSupport.type" class="delimiter">{</a>
  val <a title="String" id="org.scalatra.XsrfTokenSupport.DefaultKey">DefaultKey</a> = <span title="String(&quot;org.scalatra.XsrfTokenSupport.key&quot;)" class="string">&quot;org.scalatra.XsrfTokenSupport.key&quot;</span>
  val <a title="scala.collection.immutable.Vector[String]" id="org.scalatra.XsrfTokenSupport.HeaderNames">HeaderNames</a> = <span title="(elems: String*)scala.collection.immutable.Vector[String]">Vector</span><span class="delimiter">(</span><span title="String(&quot;X-XSRF-TOKEN&quot;)" class="string">&quot;X-XSRF-TOKEN&quot;</span><span class="delimiter">)</span>
  val <a title="String" id="org.scalatra.XsrfTokenSupport.CookieKey">CookieKey</a> = <span title="String(&quot;XSRF-TOKEN&quot;)" class="string">&quot;XSRF-TOKEN&quot;</span>
<span class="delimiter">}</span>



        </pre>
    </body>
</html>
