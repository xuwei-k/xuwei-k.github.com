<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>org/scalatra/commands/CommandSupport.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
package org.scalatra
package commands

import util.<span class="delimiter">{</span>ParamsValueReaderProperties, MultiMap<span class="delimiter">}</span>
import java.util.Date
import org.joda.time.DateTime
import collection.<span title="scala.collection.JavaConverters.type">JavaConverters</span>._
import java.util.concurrent.ConcurrentHashMap
import grizzled.slf4j.Logger
import scala.collection.concurrent.<span class="delimiter">{</span> Map =&gt; ConcurrentMap <span class="delimiter">}</span>
import javax.servlet.http.HttpServletRequest
import scala.concurrent.<span class="delimiter">{</span>Future, ExecutionContext<span class="delimiter">}</span>


<span class="comment">/**
* Support for [[org.scalatra.commands.Command]] binding and validation.
*/</span>
trait <a title="trait CommandSupport extends AnyRef with org.scalatra.util.ParamsValueReaderProperties with org.scalatra.commands.CommandExecutors" id="org.scalatra.commands;CommandSupport">CommandSupport</a> extends <a href="../util/valueReader.scala.html#org.scalatra.util;ParamsValueReaderProperties" title="org.scalatra.util.ParamsValueReaderProperties">ParamsValueReaderProperties</a> with <a href="executors.scala.html#org.scalatra.commands;CommandExecutors" title="org.scalatra.commands.CommandExecutors">CommandExecutors</a> <span class="delimiter">{</span> this: ScalatraBase =&gt;

  type <a title=" &lt;: org.scalatra.commands.Command" id="org.scalatra.commands;CommandSupport;CommandType">CommandType</a> &lt;: Command

  private<span class="delimiter">[</span>this<span class="delimiter">]</span> val <a title="scala.collection.concurrent.Map[Class[_],() =&gt; org.scalatra.commands.Command]" id="org.scalatra.commands;CommandSupport.commandFactories">commandFactories</a>: <span title="scala.collection.concurrent.Map[Class[_],() =&gt; org.scalatra.commands.Command]">ConcurrentMap</span><span class="delimiter">[</span>Class<span class="delimiter">[</span>_<span class="delimiter">]</span>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Command<span class="delimiter">]</span> = new <span title="java.util.concurrent.ConcurrentHashMap[Class[_],() =&gt; org.scalatra.commands.Command]">ConcurrentHashMap</span><span class="delimiter">[</span>Class<span class="delimiter">[</span>_<span class="delimiter">]</span>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Command<span class="delimiter">]</span>.<span title="=&gt; scala.collection.concurrent.Map[Class[_],() =&gt; org.scalatra.commands.Command]">asScala</span>

  def <a title="[T &lt;: org.scalatra.commands.Command](cmd: =&gt; T)(implicit mf: Manifest[T])Unit" id="org.scalatra.commands;CommandSupport.registerCommand">registerCommand</a><span class="delimiter">[</span><a title=" &lt;: org.scalatra.commands.Command" id="org.scalatra.commands;CommandSupport.registerCommand;T">T</a> &lt;: Command<span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; T" id="org.scalatra.commands;CommandSupport.registerCommand.cmd">cmd</a>: =&gt; T<span class="delimiter">)</span><span class="delimiter">(</span>implicit <a title="Manifest[T]" id="org.scalatra.commands;CommandSupport.registerCommand.mf">mf</a>: <span title="Manifest[T]">Manifest</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#org.scalatra.commands;CommandSupport.commandFactories" title="scala.collection.concurrent.Map[Class[_],() =&gt; org.scalatra.commands.Command]">commandFactories</a> <span title="(kv: (Class[_], () =&gt; org.scalatra.commands.Command))CommandSupport.this.commandFactories.type">+=</span> <span class="delimiter">(</span><a href="#org.scalatra.commands;CommandSupport.registerCommand.mf" title="Manifest[T]">mf</a>.<span title="(self: Class[_$1])ArrowAssoc[Class[_$1]]">erasure</span> <span title="(y: () =&gt; T)(Class[_$1], () =&gt; T)">-&gt;</span> <span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#org.scalatra.commands;CommandSupport.registerCommand.cmd" title="=&gt; T">cmd</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Create and bind a [[org.scalatra.commands.Command]] of the given type with the current Scalatra params.
   *
   * For every command type, creation and binding is performed only once and then stored into
   * a request attribute.
   */</span>
  def <a title="[T &lt;: CommandSupport.this.CommandType](implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])T" id="org.scalatra.commands;CommandSupport.command">command</a><span class="delimiter">[</span><a title=" &lt;: CommandSupport.this.CommandType" id="org.scalatra.commands;CommandSupport.command;T">T</a> &lt;: CommandType<span class="delimiter">]</span><span class="delimiter">(</span>implicit <a title="javax.servlet.http.HttpServletRequest" id="org.scalatra.commands;CommandSupport.command.request">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span>, <a title="Manifest[T]" id="org.scalatra.commands;CommandSupport.command.mf">mf</a>: <span title="Manifest[T]">Manifest</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#org.scalatra.commands;CommandSupport.command;T" title="T">T</a> = <span class="delimiter">{</span>
    def <a title="=&gt; T" id="org.scalatra.commands;CommandSupport.command.createCommand">createCommand</a> = <a href="#org.scalatra.commands;CommandSupport.commandFactories" title="scala.collection.concurrent.Map[Class[_],() =&gt; org.scalatra.commands.Command]">commandFactories</a>.<span title="(key: Class[_])Option[() =&gt; org.scalatra.commands.Command]">get</span><span class="delimiter">(</span><a href="#org.scalatra.commands;CommandSupport.command.mf" title="Manifest[T]">mf</a>.<span title="=&gt; Class[_]">erasure</span><span class="delimiter">)</span>.<span title="(f: (() =&gt; org.scalatra.commands.Command) =&gt; org.scalatra.commands.Command)Option[org.scalatra.commands.Command]">map</span><span class="delimiter">(</span><a href="#org.scalatra.commands;CommandSupport.command.createCommand.$anonfun.x$1" title="()org.scalatra.commands.Command">_</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; Any)Any">getOrElse</span><span class="delimiter">(</span><a href="#org.scalatra.commands;CommandSupport.command.mf" title="Manifest[T]">mf</a>.<span title="=&gt; Class[_]">erasure</span>.<span title="()_$1">newInstance</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#org.scalatra.commands;CommandSupport.command;T" title="T">T</a><span class="delimiter">]</span>
    <a href="#org.scalatra.commands;CommandSupport.commandOption" title="[T &lt;: CommandSupport.this.CommandType](implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])Option[T]">commandOption</a><a href="#org.scalatra.commands;CommandSupport.command.request" title="(implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])Option[T]" class="delimiter">[</a><a href="#org.scalatra.commands;CommandSupport.command;T" title="T">T</a><span class="delimiter">]</span> <span title="(default: =&gt; T)T">getOrElse</span> <a href="#org.scalatra.commands;CommandSupport.bindCommand" title="(newCommand: T)(implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])T">bindCommand</a><a href="#org.scalatra.commands;CommandSupport.command.request" title="javax.servlet.http.HttpServletRequest" class="delimiter">(</a><a href="#org.scalatra.commands;CommandSupport.command.createCommand" title="=&gt; T">createCommand</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Create and bind a [[org.scalatra.commands.Command]] of the given type with the current Scalatra params.
   *
   * For every command type, creation and binding is performed only once and then stored into
   * a request attribute.
   */</span>
  def <a title="[T &lt;: CommandSupport.this.CommandType](factory: =&gt; T)(implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])T" id="org.scalatra.commands;CommandSupport.commandOrElse">commandOrElse</a><span class="delimiter">[</span><a title=" &lt;: CommandSupport.this.CommandType" id="org.scalatra.commands;CommandSupport.commandOrElse;T">T</a> &lt;: CommandType<span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; T" id="org.scalatra.commands;CommandSupport.commandOrElse.factory">factory</a>: â‡’ T<span class="delimiter">)</span><span class="delimiter">(</span>implicit <a title="javax.servlet.http.HttpServletRequest" id="org.scalatra.commands;CommandSupport.commandOrElse.request">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span>, <a title="Manifest[T]" id="org.scalatra.commands;CommandSupport.commandOrElse.mf">mf</a>: <span title="Manifest[T]">Manifest</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#org.scalatra.commands;CommandSupport.commandOrElse;T" title="T">T</a> = <span class="delimiter">{</span>
    <a href="#org.scalatra.commands;CommandSupport.commandOption" title="[T &lt;: CommandSupport.this.CommandType](implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])Option[T]">commandOption</a><a href="#org.scalatra.commands;CommandSupport.commandOrElse.request" title="(implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])Option[T]" class="delimiter">[</a><a href="#org.scalatra.commands;CommandSupport.commandOrElse;T" title="T">T</a><span class="delimiter">]</span> <span title="(default: =&gt; T)T">getOrElse</span> <a href="#org.scalatra.commands;CommandSupport.bindCommand" title="(newCommand: T)(implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])T">bindCommand</a><a href="#org.scalatra.commands;CommandSupport.commandOrElse.request" title="javax.servlet.http.HttpServletRequest" class="delimiter">(</a><a href="#org.scalatra.commands;CommandSupport.commandOrElse.factory" title="=&gt; T">factory</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  protected def <a title="[T &lt;: CommandSupport.this.CommandType](newCommand: T)(implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])T" id="org.scalatra.commands;CommandSupport.bindCommand">bindCommand</a><span class="delimiter">[</span><a title=" &lt;: CommandSupport.this.CommandType" id="org.scalatra.commands;CommandSupport.bindCommand;T">T</a> &lt;: CommandType<span class="delimiter">]</span><span class="delimiter">(</span><a title="T" id="org.scalatra.commands;CommandSupport.bindCommand.newCommand">newCommand</a>: <a href="#org.scalatra.commands;CommandSupport.bindCommand;T" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span>implicit <a title="javax.servlet.http.HttpServletRequest" id="org.scalatra.commands;CommandSupport.bindCommand.request">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span>, <a title="Manifest[T]" id="org.scalatra.commands;CommandSupport.bindCommand.mf">mf</a>: <span title="Manifest[T]">Manifest</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#org.scalatra.commands;CommandSupport.bindCommand;T" title="T">T</a> = <span class="delimiter">{</span>
    <a href="#org.scalatra.commands;CommandSupport.bindCommand.newCommand" title="T">newCommand</a>.<a href="Command.scala.html#org.scalatra.commands;Command.bindTo" title="(data: org.scalatra.Params, params: org.scalatra.MultiParams, headers: Map[String,String])(implicit r: org.scalatra.Params =&gt; org.scalatra.util.ValueReader[org.scalatra.Params,String], implicit mi: Manifest[String], implicit multiParams: org.scalatra.MultiParams =&gt; org.scalatra.util.ValueReader[org.scalatra.MultiParams,Seq[String]])newCommand.type">bindTo</a><a href="../util/valueReader.scala.html#org.scalatra.util;ParamsValueReaderProperties.multiMapHeadViewMapValueReader" title="(d: org.scalatra.Params)org.scalatra.util.ValueReader[org.scalatra.Params,String]" class="delimiter">(</a><a href="../ScalatraBase.scala.html#org.scalatra;ScalatraBase.params(253444d747)" title="(implicit request: javax.servlet.http.HttpServletRequest)org.scalatra.Params">params</a><span class="delimiter">(</span><a href="#org.scalatra.commands;CommandSupport.bindCommand.request" title="javax.servlet.http.HttpServletRequest">request</a><span class="delimiter">)</span>, <a href="../ScalatraBase.scala.html#org.scalatra;ScalatraBase.multiParams(53d1ef321f)" title="(implicit request: javax.servlet.http.HttpServletRequest)org.scalatra.MultiParams">multiParams</a><span class="delimiter">(</span><a href="#org.scalatra.commands;CommandSupport.bindCommand.request" title="javax.servlet.http.HttpServletRequest">request</a><span class="delimiter">)</span>, <a href="../servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichRequest" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichRequest : (request: javax.servlet.http.HttpServletRequest)org.scalatra.servlet.RichRequest">request</a>.<a href="../servlet/RichRequest.scala.html#org.scalatra.servlet;RichRequest.headers" title="org.scalatra.servlet.RichRequest#headers.type">headers</a><span class="delimiter">)</span>
    <a href="#org.scalatra.commands;CommandSupport.bindCommand.newCommand" title="T">newCommand</a>
  <span class="delimiter">}</span>

  def <a title="[T &lt;: CommandSupport.this.CommandType](implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])Option[T]" id="org.scalatra.commands;CommandSupport.commandOption">commandOption</a><span class="delimiter">[</span><a title=" &lt;: CommandSupport.this.CommandType" id="org.scalatra.commands;CommandSupport.commandOption;T">T</a> &lt;: CommandType<span class="delimiter">]</span><span class="delimiter">(</span>implicit <a title="javax.servlet.http.HttpServletRequest" id="org.scalatra.commands;CommandSupport.commandOption.request">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span>, <a title="Manifest[T]" id="org.scalatra.commands;CommandSupport.commandOption.mf">mf</a>: <span title="Manifest[T]">Manifest</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> : <span title="Option[T]">Option</span><span class="delimiter">[</span>T<span class="delimiter">]</span> =
    <a href="../servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichRequest" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichRequest : (request: javax.servlet.http.HttpServletRequest)org.scalatra.servlet.RichRequest">request</a>.<a href="../servlet/AttributesMap.scala.html#org.scalatra.servlet;AttributesMap.get(adc3586498)" title="(key: String)Option[Any]">get</a><span class="delimiter">(</span><a href="#org.scalatra.commands;CommandSupport.commandRequestKey" title="[T &lt;: CommandSupport.this.CommandType](implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])String">commandRequestKey</a><a href="#org.scalatra.commands;CommandSupport.commandOption.request" title="(implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])String" class="delimiter">[</a><a href="#org.scalatra.commands;CommandSupport.commandOption;T" title="T">T</a><span class="delimiter">]</span><span class="delimiter">)</span>.<span title="(f: Any =&gt; T)Option[T]">map</span><span class="delimiter">(</span><a href="#org.scalatra.commands;CommandSupport.commandOption.$anonfun.x$2" title="Any">_</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#org.scalatra.commands;CommandSupport.commandOption;T" title="T">T</a><span class="delimiter">]</span><span class="delimiter">)</span>

  private<span class="delimiter">[</span>commands<span class="delimiter">]</span> def <a title="[T &lt;: CommandSupport.this.CommandType](implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])String" id="org.scalatra.commands;CommandSupport.commandRequestKey">commandRequestKey</a><span class="delimiter">[</span><a title=" &lt;: CommandSupport.this.CommandType" id="org.scalatra.commands;CommandSupport.commandRequestKey;T">T</a> &lt;: CommandType<span class="delimiter">]</span><span class="delimiter">(</span>implicit <a title="javax.servlet.http.HttpServletRequest" id="org.scalatra.commands;CommandSupport.commandRequestKey.request">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span>, <a title="Manifest[T]" id="org.scalatra.commands;CommandSupport.commandRequestKey.mf">mf</a>: <span title="Manifest[T]">Manifest</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> =
    <span title="String(&quot;_command_&quot;)" class="string">&quot;_command_&quot;</span> <span title="(x$1: Any)String">+</span> <span title="[T](implicit m: Manifest[T])Manifest[T]">manifest</span><a href="#org.scalatra.commands;CommandSupport.commandRequestKey.mf" title="(implicit m: Manifest[T])Manifest[T]" class="delimiter">[</a><a href="#org.scalatra.commands;CommandSupport.commandRequestKey;T" title="T">T</a><span class="delimiter">]</span>.<span title="=&gt; Class[_]">erasure</span>.<span title="()String">getName</span>

  private class <a title="class CommandRouteMatcher[T &lt;: CommandSupport.this.CommandType] extends AnyRef with org.scalatra.RouteMatcher" id="org.scalatra.commands;CommandSupport;CommandRouteMatcher">CommandRouteMatcher</a><span class="delimiter">[</span><a title=" &lt;: CommandSupport.this.CommandType" id="org.scalatra.commands;CommandSupport;CommandRouteMatcher;T">T</a> &lt;: CommandType <span class="delimiter">]</span><a href="#org.scalatra.commands;CommandSupport;CommandRouteMatcher" title="CommandSupport.this.CommandRouteMatcher[T]" class="delimiter">(</a>implicit <a title="Manifest[T]" id="org.scalatra.commands;CommandSupport;CommandRouteMatcher.mf">mf</a>: <span title="Manifest[T]">Manifest</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> extends <a href="../routeMatcher.scala.html#org.scalatra;RouteMatcher" title="org.scalatra.RouteMatcher">RouteMatcher</a> <span class="delimiter">{</span>

    override def <a title="(requestPath: String)Option[org.scalatra.MultiParams]" id="org.scalatra.commands;CommandSupport;CommandRouteMatcher.apply(aeb9a10625)">apply</a><span class="delimiter">(</span><a title="String" id="org.scalatra.commands;CommandSupport;CommandRouteMatcher.apply(aeb9a10625).requestPath">requestPath</a>: <span title="String">String</span><span class="delimiter">)</span> = if <span class="delimiter">(</span><a href="#org.scalatra.commands;CommandSupport.command" title="[T &lt;: CommandSupport.this.CommandType](implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])T">command</a><a href="../DynamicScope.scala.html#org.scalatra;DynamicScope.request" title="(implicit request: javax.servlet.http.HttpServletRequest, implicit mf: Manifest[T])T" class="delimiter">[</a><a href="#org.scalatra.commands;CommandSupport;CommandRouteMatcher;T" title="T">T</a><span class="delimiter">]</span>.<a href="Command.scala.html#org.scalatra.commands;Command.isValid" title="=&gt; Boolean">isValid</a><span class="delimiter">)</span> <span title="(x: org.scalatra.util.MultiMap)Some[org.scalatra.util.MultiMap]">Some</span><span class="delimiter">(</span><a href="../util/MultiMap.scala.html#org.scalatra.util.MultiMap.apply(e1dc036e3f)" title="()org.scalatra.util.MultiMap">MultiMap</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> else <span title="None.type">None</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Create a [[org.scalatra.RouteMatcher]] that evaluates '''true''' only if a command is valid.
   */</span>
  def <a title="[T &lt;: CommandSupport.this.CommandType](implicit mf: Manifest[T])org.scalatra.RouteMatcher" id="org.scalatra.commands;CommandSupport.ifValid">ifValid</a><span class="delimiter">[</span><a title=" &lt;: CommandSupport.this.CommandType" id="org.scalatra.commands;CommandSupport.ifValid;T">T</a> &lt;: CommandType<span class="delimiter">]</span><span class="delimiter">(</span>implicit <a title="Manifest[T]" id="org.scalatra.commands;CommandSupport.ifValid.mf">mf</a>: <span title="Manifest[T]">Manifest</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../routeMatcher.scala.html#org.scalatra;RouteMatcher" title="org.scalatra.RouteMatcher">RouteMatcher</a> = new <a href="#org.scalatra.commands;CommandSupport;CommandRouteMatcher" title="CommandSupport.this.CommandRouteMatcher[T]">CommandRouteMatcher</a><span class="delimiter">[</span>T<span class="delimiter">]</span>


<span class="delimiter">}</span>

trait <a title="trait ParamsOnlyCommandSupport extends AnyRef with org.scalatra.commands.CommandSupport" id="org.scalatra.commands;ParamsOnlyCommandSupport">ParamsOnlyCommandSupport</a> extends <a href="#org.scalatra.commands;CommandSupport" title="org.scalatra.commands.CommandSupport">CommandSupport</a> <span class="delimiter">{</span> this: ScalatraBase =&gt;
  type <a title="org.scalatra.commands.ParamsOnlyCommand" id="org.scalatra.commands;ParamsOnlyCommandSupport;CommandType">CommandType</a> = <a href="Command.scala.html#org.scalatra.commands;ParamsOnlyCommand" title="org.scalatra.commands.ParamsOnlyCommand">ParamsOnlyCommand</a>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
