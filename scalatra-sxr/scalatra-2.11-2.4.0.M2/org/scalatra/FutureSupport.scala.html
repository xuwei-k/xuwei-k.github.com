<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>org/scalatra/FutureSupport.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
package org.scalatra

import scala.concurrent.duration._
import java.util.concurrent.atomic.AtomicBoolean
import javax.servlet.<span class="delimiter">{</span>ServletContext, AsyncEvent, AsyncListener<span class="delimiter">}</span>
import servlet.AsyncSupport
import javax.servlet.http.<span class="delimiter">{</span>HttpServletResponse, HttpServletRequest<span class="delimiter">}</span>
import scala.concurrent.<span class="delimiter">{</span>ExecutionContext, Future<span class="delimiter">}</span>
import scala.util.<span class="delimiter">{</span>Failure, Success, Try<span class="delimiter">}</span>

abstract class <a title="class AsyncResult extends AnyRef with org.scalatra.ScalatraContext" id="org.scalatra;AsyncResult">AsyncResult</a><a href="#org.scalatra;AsyncResult" title="org.scalatra.AsyncResult" class="delimiter">(</a>implicit override val <a title="org.scalatra.ScalatraContext" id="org.scalatra;AsyncResult.scalatraContext">scalatraContext</a>: <a href="ScalatraContext.scala.html#org.scalatra;ScalatraContext" title="org.scalatra.ScalatraContext">ScalatraContext</a><span class="delimiter">)</span> extends <a href="ScalatraContext.scala.html#org.scalatra;ScalatraContext" title="org.scalatra.ScalatraContext">ScalatraContext</a>  <span class="delimiter">{</span>

  implicit val <a title="javax.servlet.http.HttpServletRequest" id="org.scalatra;AsyncResult.request">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span> = <a href="#org.scalatra;AsyncResult.scalatraContext" title="=&gt; org.scalatra.ScalatraContext">scalatraContext</a>.<a href="ScalatraContext.scala.html#org.scalatra;ScalatraContext.request" title="=&gt; javax.servlet.http.HttpServletRequest">request</a>
  implicit val <a title="javax.servlet.http.HttpServletResponse" id="org.scalatra;AsyncResult.response">response</a>: <span title="javax.servlet.http.HttpServletResponse">HttpServletResponse</span> = <a href="#org.scalatra;AsyncResult.scalatraContext" title="=&gt; org.scalatra.ScalatraContext">scalatraContext</a>.<a href="ScalatraContext.scala.html#org.scalatra;ScalatraContext.response" title="=&gt; javax.servlet.http.HttpServletResponse">response</a>
  val <a title="javax.servlet.ServletContext" id="org.scalatra;AsyncResult.servletContext">servletContext</a>: <span title="javax.servlet.ServletContext">ServletContext</span> = <a href="#org.scalatra;AsyncResult.scalatraContext" title="=&gt; org.scalatra.ScalatraContext">scalatraContext</a>.<a href="ScalatraContext.scala.html#org.scalatra;ScalatraContext.servletContext" title="=&gt; javax.servlet.ServletContext">servletContext</a>

  <span class="comment">// This is a Duration instead of a timeout because a duration has the concept of infinity</span>
  implicit def <a title="=&gt; scala.concurrent.duration.Duration" id="org.scalatra;AsyncResult.timeout">timeout</a>: <span title="scala.concurrent.duration.Duration">Duration</span> = <span title="implicit scala.concurrent.duration.package.DurationInt : (n: Int)concurrent.duration.DurationInt" class="int">30</span> <span title="=&gt; scala.concurrent.duration.FiniteDuration">seconds</span>
  val <a title="=&gt; scala.concurrent.Future[_]" id="org.scalatra;AsyncResult.is">is</a>: <span title="scala.concurrent.Future[_]">Future</span><span class="delimiter">[</span>_<span class="delimiter">]</span>
<span class="delimiter">}</span>

trait <a title="trait FutureSupport extends AnyRef with org.scalatra.servlet.AsyncSupport" id="org.scalatra;FutureSupport">FutureSupport</a> extends <a href="servlet/AsyncSupport.scala.html#org.scalatra.servlet;AsyncSupport" title="org.scalatra.servlet.AsyncSupport">AsyncSupport</a> <span class="delimiter">{</span>

  implicit protected def <a title="=&gt; scala.concurrent.ExecutionContext" id="org.scalatra;FutureSupport.executor">executor</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span>

  override def <a title="(f: =&gt; Any)org.scalatra.Action" id="org.scalatra;FutureSupport.asynchronously">asynchronously</a><span class="delimiter">(</span><a title="=&gt; Any" id="org.scalatra;FutureSupport.asynchronously.f">f</a>: ⇒ Any<span class="delimiter">)</span>: <span title="org.scalatra.Action">Action</span> = <span class="delimiter">(</span><span class="delimiter">)</span> ⇒ <span title="(body: =&gt; Any)(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[Any]">Future</span><a href="#org.scalatra;FutureSupport.executor" title="=&gt; scala.concurrent.ExecutionContext" class="delimiter">(</a><a href="#org.scalatra;FutureSupport.asynchronously.f" title="=&gt; Any">f</a><span class="delimiter">)</span>

  <span class="comment">// Still thinking of the best way to specify this before making it public.</span>
  <span class="comment">// In the meantime, this gives us enough control for our test.</span>
  <span class="comment">// IPC: it may not be perfect but I need to be able to configure this timeout in an application</span>
  <span class="comment">// This is a Duration instead of a timeout because a duration has the concept of infinity</span>
  @deprecated<span class="delimiter">(</span><span class="string">&quot;Override the `timeout` method on a `org.scalatra.AsyncResult` instead.&quot;</span>, <span class="string">&quot;2.2&quot;</span><span class="delimiter">)</span>
  protected def <a title="=&gt; scala.concurrent.duration.Duration" id="org.scalatra;FutureSupport.asyncTimeout">asyncTimeout</a>: <span title="scala.concurrent.duration.Duration">Duration</span> = <span title="implicit scala.concurrent.duration.package.DurationInt : (n: Int)concurrent.duration.DurationInt" class="int">30</span> <span title="=&gt; scala.concurrent.duration.FiniteDuration">seconds</span>


  override protected def <a title="(result: Any)Boolean" id="org.scalatra;FutureSupport.isAsyncExecutable">isAsyncExecutable</a><span class="delimiter">(</span><a title="Any" id="org.scalatra;FutureSupport.isAsyncExecutable.result">result</a>: <span title="Any">Any</span><span class="delimiter">)</span> =
    classOf<span title="Class[scala.concurrent.Future[_]](classOf[scala.concurrent.Future])" class="delimiter">[</span>Future<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span>.<span title="(x$1: Class[_])Boolean">isAssignableFrom</span><span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.isAsyncExecutable.result" title="Any">result</a>.<span title="()Class[_]">getClass</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span>
      classOf<span title="Class[org.scalatra.AsyncResult](classOf[org.scalatra.AsyncResult])" class="delimiter">[</span>AsyncResult<span class="delimiter">]</span>.<span title="(x$1: Class[_])Boolean">isAssignableFrom</span><span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.isAsyncExecutable.result" title="Any">result</a>.<span title="()Class[_]">getClass</span><span class="delimiter">)</span>

  override protected def <a title="(actionResult: Any)Unit" id="org.scalatra;FutureSupport.renderResponse">renderResponse</a><span class="delimiter">(</span><a title="Any" id="org.scalatra;FutureSupport.renderResponse.actionResult">actionResult</a>: <span title="Any">Any</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#org.scalatra;FutureSupport.renderResponse.actionResult" title="Any">actionResult</a> match <span class="delimiter">{</span>
      case <a title="org.scalatra.AsyncResult" id="org.scalatra;FutureSupport.renderResponse.r">r</a>: <a href="#org.scalatra;AsyncResult" title="org.scalatra.AsyncResult">AsyncResult</a> ⇒ <a href="#org.scalatra;FutureSupport.handleFuture" title="(f: scala.concurrent.Future[_], timeout: scala.concurrent.duration.Duration)Unit">handleFuture</a><span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.renderResponse.r" title="org.scalatra.AsyncResult">r</a>.<a href="#org.scalatra;AsyncResult.is" title="=&gt; scala.concurrent.Future[_]">is</a> , <a href="#org.scalatra;FutureSupport.renderResponse.r" title="org.scalatra.AsyncResult">r</a>.<a href="#org.scalatra;AsyncResult.timeout" title="=&gt; scala.concurrent.duration.Duration">timeout</a><span class="delimiter">)</span>
      case <a title="scala.concurrent.Future[_]" id="org.scalatra;FutureSupport.renderResponse.f">f</a>: <span title="scala.concurrent.Future[_]">Future</span><span class="delimiter">[</span>_<span class="delimiter">]</span>   ⇒ <a href="#org.scalatra;FutureSupport.handleFuture" title="(f: scala.concurrent.Future[_], timeout: scala.concurrent.duration.Duration)Unit">handleFuture</a><span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.renderResponse.f" title="scala.concurrent.Future[_]">f</a>, <a href="#org.scalatra;FutureSupport.asyncTimeout" title="=&gt; scala.concurrent.duration.Duration">asyncTimeout</a><span class="delimiter">)</span>
      case <a title="Any" id="org.scalatra;FutureSupport.renderResponse.a">a</a>              ⇒ super.<a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.renderResponse" title="(actionResult: Any)Unit">renderResponse</a><span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.renderResponse.a" title="Any">a</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private<span class="delimiter">[</span>this<span class="delimiter">]</span> def <a title="(f: scala.concurrent.Future[_], timeout: scala.concurrent.duration.Duration)Unit" id="org.scalatra;FutureSupport.handleFuture">handleFuture</a><span class="delimiter">(</span><a title="scala.concurrent.Future[_]" id="org.scalatra;FutureSupport.handleFuture.f">f</a>: <span title="scala.concurrent.Future[_]">Future</span><span class="delimiter">[</span>_<span class="delimiter">]</span>, <a title="scala.concurrent.duration.Duration" id="org.scalatra;FutureSupport.handleFuture.timeout">timeout</a>: <span title="scala.concurrent.duration.Duration">Duration</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    val <a title="java.util.concurrent.atomic.AtomicBoolean" id="org.scalatra;FutureSupport.handleFuture.gotResponseAlready">gotResponseAlready</a> = new <span title="java.util.concurrent.atomic.AtomicBoolean">AtomicBoolean</span><span class="delimiter">(</span>false<span class="delimiter">)</span>
    val <a title="javax.servlet.AsyncContext" id="org.scalatra;FutureSupport.handleFuture.context">context</a> = <a href="DynamicScope.scala.html#org.scalatra;DynamicScope.request" title="=&gt; javax.servlet.http.HttpServletRequest">request</a>.<span title="(x$1: javax.servlet.ServletRequest, x$2: javax.servlet.ServletResponse)javax.servlet.AsyncContext">startAsync</span><span class="delimiter">(</span><a href="DynamicScope.scala.html#org.scalatra;DynamicScope.request" title="=&gt; javax.servlet.http.HttpServletRequest">request</a>, <a href="DynamicScope.scala.html#org.scalatra;DynamicScope.response" title="=&gt; javax.servlet.http.HttpServletResponse">response</a><span class="delimiter">)</span>
    if <span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.handleFuture.timeout" title="scala.concurrent.duration.Duration">timeout</a>.<span title="()Boolean">isFinite</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#org.scalatra;FutureSupport.handleFuture.context" title="javax.servlet.AsyncContext">context</a>.<span title="(x$1: Long)Unit">setTimeout</span><span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.handleFuture.timeout" title="scala.concurrent.duration.Duration">timeout</a>.<span title="=&gt; Long">toMillis</span><span class="delimiter">)</span> else <a href="#org.scalatra;FutureSupport.handleFuture.context" title="javax.servlet.AsyncContext">context</a>.<span title="(x$1: Long)Unit">setTimeout</span><span class="delimiter">(</span>-<span title="Long(-1L)" class="int">1</span><span class="delimiter">)</span>

    def <a title="(f: scala.concurrent.Future[_])Unit" id="org.scalatra;FutureSupport.handleFuture.renderFutureResult">renderFutureResult</a><span class="delimiter">(</span><a title="scala.concurrent.Future[_]" id="org.scalatra;FutureSupport.handleFuture.renderFutureResult.f">f</a>: <span title="scala.concurrent.Future[_]">Future</span><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#org.scalatra;FutureSupport.handleFuture.renderFutureResult.f" title="scala.concurrent.Future[_]">f</a> <a href="#org.scalatra;FutureSupport.executor" title="(f: scala.util.Try[_$4] =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)Unit">onComplete</a> <a href="#org.scalatra;FutureSupport.handleFuture.renderFutureResult.$anonfun.x0$1" title="Unit" class="delimiter">{</a>
        <span class="comment">// Loop until we have a non-future result</span>
        case Success<span class="delimiter">(</span><a title="scala.concurrent.Future[_]" id="org.scalatra;FutureSupport.handleFuture.renderFutureResult.$anonfun.f2">f2</a>: <span title="scala.concurrent.Future[_]">Future</span><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; <a href="#org.scalatra;FutureSupport.handleFuture.renderFutureResult" title="(f: scala.concurrent.Future[_])Unit">renderFutureResult</a><span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.handleFuture.renderFutureResult.$anonfun.f2" title="scala.concurrent.Future[_]">f2</a><span class="delimiter">)</span>
        case Success<span class="delimiter">(</span><a title="org.scalatra.AsyncResult" id="org.scalatra;FutureSupport.handleFuture.renderFutureResult.$anonfun.r">r</a>: <a href="#org.scalatra;AsyncResult" title="org.scalatra.AsyncResult">AsyncResult</a><span class="delimiter">)</span> =&gt; <a href="#org.scalatra;FutureSupport.handleFuture.renderFutureResult" title="(f: scala.concurrent.Future[_])Unit">renderFutureResult</a><span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.handleFuture.renderFutureResult.$anonfun.r" title="org.scalatra.AsyncResult">r</a>.<a href="#org.scalatra;AsyncResult.is" title="=&gt; scala.concurrent.Future[_]">is</a><span class="delimiter">)</span>
        case <a title="scala.util.Try[_$4]" id="org.scalatra;FutureSupport.handleFuture.renderFutureResult.$anonfun.t">t</a> ⇒ <span class="delimiter">{</span>

          if <span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.handleFuture.gotResponseAlready" title="java.util.concurrent.atomic.AtomicBoolean">gotResponseAlready</a>.<span title="(x$1: Boolean, x$2: Boolean)Boolean">compareAndSet</span><span class="delimiter">(</span>false, true<span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="servlet/AsyncSupport.scala.html#org.scalatra.servlet;AsyncSupport.withinAsyncContext" title="(context: javax.servlet.AsyncContext)(thunk: =&gt; Any)Unit">withinAsyncContext</a><span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.handleFuture.context" title="javax.servlet.AsyncContext">context</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              try <span class="delimiter">{</span>
                <a href="#org.scalatra;FutureSupport.handleFuture.renderFutureResult.$anonfun.t" title="scala.util.Try[_$4]">t</a> <span title="(f: _$4 =&gt; Unit)scala.util.Try[Unit]">map</span> <span class="delimiter">{</span> <a title="_$4" id="org.scalatra;FutureSupport.handleFuture.renderFutureResult.$anonfun.$anonfun.result">result</a> ⇒
                  <a href="#org.scalatra;FutureSupport.renderResponse" title="(actionResult: Any)Unit">renderResponse</a><span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.handleFuture.renderFutureResult.$anonfun.$anonfun.result" title="_$4">result</a><span class="delimiter">)</span>
                <span class="delimiter">}</span> <span title="(f: PartialFunction[Throwable,Unit])scala.util.Try[Unit]">recover</span> <a title="&lt;$anon: Throwable =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Throwable,Unit] with Serializable" id="org.scalatra;FutureSupport.handleFuture.renderFutureResult.$anonfun;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
                  case <span title="org.scalatra.HaltException">e</span>: <a href="control.scala.html#org.scalatra;HaltException" title="org.scalatra.HaltException">HaltException</a> ⇒
                    <a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.renderHaltException" title="(e: org.scalatra.HaltException)Unit">renderHaltException</a><span title="Boolean(true)" class="delimiter">(</span><span title="org.scalatra.HaltException">e</span><span class="delimiter">)</span>
                  case <span title="Throwable">e</span> ⇒
                    try <span class="delimiter">{</span>
                      <a href="#org.scalatra;FutureSupport.renderResponse" title="(actionResult: Any)Unit">renderResponse</a><span class="delimiter">(</span><a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.errorHandler" title="(v1: Throwable)Any">errorHandler</a><span class="delimiter">(</span><span title="Throwable">e</span><span class="delimiter">)</span><span class="delimiter">)</span>
                    <span class="delimiter">}</span> catch <span class="delimiter">{</span>
                      case <span title="Throwable">e</span>: <span title="Throwable">Throwable</span> =&gt;
                        <a href="ScalatraBase.scala.html#org.scalatra.ScalatraBase" title="org.scalatra.ScalatraBase.type">ScalatraBase</a>.<a href="ScalatraBase.scala.html#org.scalatra.ScalatraBase.runCallbacks" title="(data: scala.util.Try[Any])(implicit request: javax.servlet.http.HttpServletRequest)Unit">runCallbacks</a><a href="DynamicScope.scala.html#org.scalatra;DynamicScope.request" title="=&gt; javax.servlet.http.HttpServletRequest" class="delimiter">(</a><span title="(exception: Throwable)scala.util.Failure[Nothing]">Failure</span><span class="delimiter">(</span><span title="Throwable">e</span><span class="delimiter">)</span><span class="delimiter">)</span>
                        <a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.renderUncaughtException" title="(e: Throwable)(implicit request: javax.servlet.http.HttpServletRequest, implicit response: javax.servlet.http.HttpServletResponse)Unit">renderUncaughtException</a><a href="DynamicScope.scala.html#org.scalatra;DynamicScope.request" title="=&gt; javax.servlet.http.HttpServletRequest" class="delimiter">(</a><span title="Throwable">e</span><span class="delimiter">)</span>
                        <a href="ScalatraBase.scala.html#org.scalatra.ScalatraBase" title="org.scalatra.ScalatraBase.type">ScalatraBase</a>.<a href="ScalatraBase.scala.html#org.scalatra.ScalatraBase.runRenderCallbacks" title="(data: scala.util.Try[Any])(implicit request: javax.servlet.http.HttpServletRequest)Unit">runRenderCallbacks</a><a href="DynamicScope.scala.html#org.scalatra;DynamicScope.request" title="=&gt; javax.servlet.http.HttpServletRequest" class="delimiter">(</a><span title="(exception: Throwable)scala.util.Failure[Nothing]">Failure</span><span class="delimiter">(</span><span title="Throwable">e</span><span class="delimiter">)</span><span class="delimiter">)</span>
                    <span class="delimiter">}</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span> finally <span class="delimiter">{</span>
                <a href="#org.scalatra;FutureSupport.handleFuture.context" title="javax.servlet.AsyncContext">context</a>.<span title="()Unit">complete</span><span class="delimiter">(</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#org.scalatra;FutureSupport.handleFuture.context" title="javax.servlet.AsyncContext">context</a> <span title="(x$1: javax.servlet.AsyncListener)Unit">addListener</span> new <a title="&lt;$anon: javax.servlet.AsyncListener&gt; extends Object with javax.servlet.AsyncListener" id="org.scalatra;FutureSupport.handleFuture;$anon">AsyncListener</a> <span class="delimiter">{</span>
      def <a title="(event: javax.servlet.AsyncEvent)Unit" id="org.scalatra;FutureSupport.handleFuture;$anon.onTimeout">onTimeout</a><span class="delimiter">(</span><a title="javax.servlet.AsyncEvent" id="org.scalatra;FutureSupport.handleFuture;$anon.onTimeout.event">event</a>: <span title="javax.servlet.AsyncEvent">AsyncEvent</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="servlet/AsyncSupport.scala.html#org.scalatra.servlet;AsyncSupport.onAsyncEvent" title="(event: javax.servlet.AsyncEvent)(thunk: =&gt; Any)Unit">onAsyncEvent</a><span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.handleFuture;$anon.onTimeout.event" title="javax.servlet.AsyncEvent">event</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          if <span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.handleFuture.gotResponseAlready" title="java.util.concurrent.atomic.AtomicBoolean">gotResponseAlready</a>.<span title="(x$1: Boolean, x$2: Boolean)Boolean">compareAndSet</span><span class="delimiter">(</span>false, true<span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.renderHaltException" title="(e: org.scalatra.HaltException)Unit">renderHaltException</a><span class="delimiter">(</span><a href="control.scala.html#org.scalatra;HaltException" title="(status: Option[Int], reason: Option[String], headers: Map[String,String], body: Any)org.scalatra.HaltException">HaltException</a><span class="delimiter">(</span><span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><span title="Int(504)" class="int">504</span><span class="delimiter">)</span>, <span title="None.type">None</span>, <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="scala.collection.immutable.Map[String,Nothing]">empty</span>, <span title="String(&quot;Gateway timeout&quot;)" class="string">&quot;Gateway timeout&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#org.scalatra;FutureSupport.handleFuture;$anon.onTimeout.event" title="javax.servlet.AsyncEvent">event</a>.<span title="()javax.servlet.AsyncContext">getAsyncContext</span>.<span title="()Unit">complete</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      def <a title="(event: javax.servlet.AsyncEvent)Unit" id="org.scalatra;FutureSupport.handleFuture;$anon.onComplete">onComplete</a><span class="delimiter">(</span><a title="javax.servlet.AsyncEvent" id="org.scalatra;FutureSupport.handleFuture;$anon.onComplete.event">event</a>: <span title="javax.servlet.AsyncEvent">AsyncEvent</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
      def <a title="(event: javax.servlet.AsyncEvent)Unit" id="org.scalatra;FutureSupport.handleFuture;$anon.onError">onError</a><span class="delimiter">(</span><a title="javax.servlet.AsyncEvent" id="org.scalatra;FutureSupport.handleFuture;$anon.onError.event">event</a>: <span title="javax.servlet.AsyncEvent">AsyncEvent</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="servlet/AsyncSupport.scala.html#org.scalatra.servlet;AsyncSupport.onAsyncEvent" title="(event: javax.servlet.AsyncEvent)(thunk: =&gt; Any)Unit">onAsyncEvent</a><span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.handleFuture;$anon.onError.event" title="javax.servlet.AsyncEvent">event</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          if <span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.handleFuture.gotResponseAlready" title="java.util.concurrent.atomic.AtomicBoolean">gotResponseAlready</a>.<span title="(x$1: Boolean, x$2: Boolean)Boolean">compareAndSet</span><span class="delimiter">(</span>false, true<span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#org.scalatra;FutureSupport.handleFuture;$anon.onError.event" title="javax.servlet.AsyncEvent">event</a>.<span title="()Throwable">getThrowable</span> match <span class="delimiter">{</span>
              case <span title="org.scalatra.HaltException">e</span>: <a href="control.scala.html#org.scalatra;HaltException" title="org.scalatra.HaltException">HaltException</a> =&gt; <a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.renderHaltException" title="(e: org.scalatra.HaltException)Unit">renderHaltException</a><span class="delimiter">(</span><span title="org.scalatra.HaltException">e</span><span class="delimiter">)</span>
              case <span title="Throwable">e</span> =&gt;
                try <span class="delimiter">{</span>
                  <a href="#org.scalatra;FutureSupport.renderResponse" title="(actionResult: Any)Unit">renderResponse</a><span class="delimiter">(</span><a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.errorHandler" title="(v1: Throwable)Any">errorHandler</a><span class="delimiter">(</span><span title="Throwable">e</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span> catch <span class="delimiter">{</span>
                  case <span title="Throwable">e</span>: <span title="Throwable">Throwable</span> =&gt;
                    <a href="ScalatraBase.scala.html#org.scalatra.ScalatraBase" title="org.scalatra.ScalatraBase.type">ScalatraBase</a>.<a href="ScalatraBase.scala.html#org.scalatra.ScalatraBase.runCallbacks" title="(data: scala.util.Try[Any])(implicit request: javax.servlet.http.HttpServletRequest)Unit">runCallbacks</a><a href="DynamicScope.scala.html#org.scalatra;DynamicScope.request" title="=&gt; javax.servlet.http.HttpServletRequest" class="delimiter">(</a><span title="(exception: Throwable)scala.util.Failure[Nothing]">Failure</span><span class="delimiter">(</span><span title="Throwable">e</span><span class="delimiter">)</span><span class="delimiter">)</span>
                    <a href="ScalatraBase.scala.html#org.scalatra;ScalatraBase.renderUncaughtException" title="(e: Throwable)(implicit request: javax.servlet.http.HttpServletRequest, implicit response: javax.servlet.http.HttpServletResponse)Unit">renderUncaughtException</a><a href="DynamicScope.scala.html#org.scalatra;DynamicScope.request" title="=&gt; javax.servlet.http.HttpServletRequest" class="delimiter">(</a><span title="Throwable">e</span><span class="delimiter">)</span>
                    <a href="ScalatraBase.scala.html#org.scalatra.ScalatraBase" title="org.scalatra.ScalatraBase.type">ScalatraBase</a>.<a href="ScalatraBase.scala.html#org.scalatra.ScalatraBase.runRenderCallbacks" title="(data: scala.util.Try[Any])(implicit request: javax.servlet.http.HttpServletRequest)Unit">runRenderCallbacks</a><a href="DynamicScope.scala.html#org.scalatra;DynamicScope.request" title="=&gt; javax.servlet.http.HttpServletRequest" class="delimiter">(</a><span title="(exception: Throwable)scala.util.Failure[Nothing]">Failure</span><span class="delimiter">(</span><span title="Throwable">e</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      def <a title="(event: javax.servlet.AsyncEvent)Unit" id="org.scalatra;FutureSupport.handleFuture;$anon.onStartAsync">onStartAsync</a><span class="delimiter">(</span><a title="javax.servlet.AsyncEvent" id="org.scalatra;FutureSupport.handleFuture;$anon.onStartAsync.event">event</a>: <span title="javax.servlet.AsyncEvent">AsyncEvent</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#org.scalatra;FutureSupport.handleFuture.renderFutureResult" title="(f: scala.concurrent.Future[_])Unit">renderFutureResult</a><span class="delimiter">(</span><a href="#org.scalatra;FutureSupport.handleFuture.f" title="scala.concurrent.Future[_]">f</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>





        </pre>
    </body>
</html>
