<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>org/scalatra/atmosphere/package.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
package org.scalatra

import scala.concurrent.Future
import scala.concurrent.Promise
import scala.concurrent.duration._
import _root_.akka.actor.ActorSystem
import org.atmosphere.cpr.AtmosphereResource
import scala.util.control.<span title="scala.util.control.Exception.type">Exception</span>._

package object <a title="org.scalatra.atmosphere.package.type" id="org.scalatra.atmosphere.package">atmosphere</a> <a href="#org.scalatra.atmosphere.package" title="org.scalatra.atmosphere.package.type" class="delimiter">{</a>

  type <a title="PartialFunction[org.scalatra.atmosphere.InboundMessage,Unit]" id="org.scalatra.atmosphere.package;AtmoReceive">AtmoReceive</a> = <span title="PartialFunction[org.scalatra.atmosphere.InboundMessage,Unit]">PartialFunction</span><span class="delimiter">[</span>InboundMessage, Unit<span class="delimiter">]</span>

  abstract class <a title="class ClientFilter extends AnyRef with Function[org.atmosphere.cpr.AtmosphereResource,Boolean]" id="org.scalatra.atmosphere.package;ClientFilter">ClientFilter</a><a href="#org.scalatra.atmosphere.package;ClientFilter" title="org.scalatra.atmosphere.package.ClientFilter" class="delimiter">(</a>val <a title="String" id="org.scalatra.atmosphere.package;ClientFilter.uuid">uuid</a>: <span title="String">String</span><span class="delimiter">)</span> extends <a href="#org.scalatra.atmosphere.package;ClientFilter" title="Function[org.atmosphere.cpr.AtmosphereResource,Boolean]">Function</a><span class="delimiter">[</span>AtmosphereResource, Boolean<span class="delimiter">]</span>

  class <a title="class Everyone extends org.scalatra.atmosphere.package.ClientFilter" id="org.scalatra.atmosphere.package;Everyone">Everyone</a> extends <a href="#org.scalatra.atmosphere.package;ClientFilter" title="org.scalatra.atmosphere.package.ClientFilter">ClientFilter</a><span class="delimiter">(</span>null<span class="delimiter">)</span> <span class="delimiter">{</span>
    def <a title="(v1: org.atmosphere.cpr.AtmosphereResource)Boolean" id="org.scalatra.atmosphere.package;Everyone.apply">apply</a><span class="delimiter">(</span><a title="org.atmosphere.cpr.AtmosphereResource" id="org.scalatra.atmosphere.package;Everyone.apply.v1">v1</a>: <span title="org.atmosphere.cpr.AtmosphereResource">AtmosphereResource</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = true
    override def <a title="()String" id="org.scalatra.atmosphere.package;Everyone.toString">toString</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="String(&quot;Everyone&quot;)" class="string">&quot;Everyone&quot;</span>
  <span class="delimiter">}</span>

  class <a title="class OnlySelf extends org.scalatra.atmosphere.package.ClientFilter" id="org.scalatra.atmosphere.package;OnlySelf">OnlySelf</a><a href="#org.scalatra.atmosphere.package;OnlySelf" title="org.scalatra.atmosphere.package.OnlySelf" class="delimiter">(</a><a title="String" id="org.scalatra.atmosphere.package;OnlySelf.uuid">uuid</a>: <span title="String">String</span><span class="delimiter">)</span> extends <a href="#org.scalatra.atmosphere.package;ClientFilter" title="org.scalatra.atmosphere.package.ClientFilter">ClientFilter</a><span class="delimiter">(</span><a href="#org.scalatra.atmosphere.package;OnlySelf.uuid" title="String">uuid</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    def <a title="(v1: org.atmosphere.cpr.AtmosphereResource)Boolean" id="org.scalatra.atmosphere.package;OnlySelf.apply">apply</a><span class="delimiter">(</span><a title="org.atmosphere.cpr.AtmosphereResource" id="org.scalatra.atmosphere.package;OnlySelf.apply.v1">v1</a>: <span title="org.atmosphere.cpr.AtmosphereResource">AtmosphereResource</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#org.scalatra.atmosphere.package;OnlySelf.apply.v1" title="org.atmosphere.cpr.AtmosphereResource">v1</a>.<span title="()String">uuid</span> <span title="(x$1: Any)Boolean">==</span> <a href="#org.scalatra.atmosphere.package;OnlySelf.uuid" title="String">uuid</a>
    override def <a title="()String" id="org.scalatra.atmosphere.package;OnlySelf.toString">toString</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="String(&quot;OnlySelf&quot;)" class="string">&quot;OnlySelf&quot;</span>
  <span class="delimiter">}</span>

  class <a title="class SkipSelf extends org.scalatra.atmosphere.package.ClientFilter" id="org.scalatra.atmosphere.package;SkipSelf">SkipSelf</a><a href="#org.scalatra.atmosphere.package;SkipSelf" title="org.scalatra.atmosphere.package.SkipSelf" class="delimiter">(</a><a title="String" id="org.scalatra.atmosphere.package;SkipSelf.uuid">uuid</a>: <span title="String">String</span><span class="delimiter">)</span> extends <a href="#org.scalatra.atmosphere.package;ClientFilter" title="org.scalatra.atmosphere.package.ClientFilter">ClientFilter</a><span class="delimiter">(</span><a href="#org.scalatra.atmosphere.package;SkipSelf.uuid" title="String">uuid</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    def <a title="(v1: org.atmosphere.cpr.AtmosphereResource)Boolean" id="org.scalatra.atmosphere.package;SkipSelf.apply">apply</a><span class="delimiter">(</span><a title="org.atmosphere.cpr.AtmosphereResource" id="org.scalatra.atmosphere.package;SkipSelf.apply.v1">v1</a>: <span title="org.atmosphere.cpr.AtmosphereResource">AtmosphereResource</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#org.scalatra.atmosphere.package;SkipSelf.apply.v1" title="org.atmosphere.cpr.AtmosphereResource">v1</a>.<span title="()String">uuid</span> <span title="(x$1: Any)Boolean">!=</span> <a href="#org.scalatra.atmosphere.package;SkipSelf.uuid" title="String">uuid</a>
    override def <a title="()String" id="org.scalatra.atmosphere.package;SkipSelf.toString">toString</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="String(&quot;Others&quot;)" class="string">&quot;Others&quot;</span>
  <span class="delimiter">}</span>

  val <a title="String" id="org.scalatra.atmosphere.package.AtmosphereClientKey">AtmosphereClientKey</a> = <span title="String(&quot;org.scalatra.atmosphere.AtmosphereClientConnection&quot;)" class="string">&quot;org.scalatra.atmosphere.AtmosphereClientConnection&quot;</span>
  val <a title="String" id="org.scalatra.atmosphere.package.AtmosphereRouteKey">AtmosphereRouteKey</a> = <span title="String(&quot;org.scalatra.atmosphere.AtmosphereRoute&quot;)" class="string">&quot;org.scalatra.atmosphere.AtmosphereRoute&quot;</span>
  val <a title="String" id="org.scalatra.atmosphere.package.ActorSystemKey">ActorSystemKey</a> = <span title="String(&quot;org.scalatra.atmosphere.ActorSystem&quot;)" class="string">&quot;org.scalatra.atmosphere.ActorSystem&quot;</span>
  val <a title="String" id="org.scalatra.atmosphere.package.TrackMessageSize">TrackMessageSize</a> = <span title="String(&quot;org.scalatra.atmosphere.TrackMessageSize&quot;)" class="string">&quot;org.scalatra.atmosphere.TrackMessageSize&quot;</span>

  import org.scalatra.servlet.<a href="../servlet/ServletApiImplicits.scala.html#org.scalatra.servlet.ServletApiImplicits" title="org.scalatra.servlet.ServletApiImplicits.type">ServletApiImplicits</a>._

  implicit def <a title="implicit org.scalatra.atmosphere.package.atmoResourceWithClient : (res: org.atmosphere.cpr.AtmosphereResource)AnyRef{def clientOption: Option[org.scalatra.atmosphere.AtmosphereClient]; def client: org.scalatra.atmosphere.AtmosphereClient}" id="org.scalatra.atmosphere.package.atmoResourceWithClient">atmoResourceWithClient</a><span class="delimiter">(</span><a title="org.atmosphere.cpr.AtmosphereResource" id="org.scalatra.atmosphere.package.atmoResourceWithClient.res">res</a>: <span title="org.atmosphere.cpr.AtmosphereResource">AtmosphereResource</span><span class="delimiter">)</span> = new <a title="&lt;$anon: AnyRef&gt; extends AnyRef" id="org.scalatra.atmosphere.package.atmoResourceWithClient;$anon" class="delimiter">{</a>
    def <a title="=&gt; Option[org.scalatra.atmosphere.AtmosphereClient]" id="org.scalatra.atmosphere.package.atmoResourceWithClient;$anon.clientOption">clientOption</a> = <a href="#org.scalatra.atmosphere.package.atmoResourceWithClient.res" title="org.atmosphere.cpr.AtmosphereResource">res</a>.<a href="../servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichSession" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichSession : (session: javax.servlet.http.HttpSession)org.scalatra.servlet.RichSession">session</a>.<a href="../servlet/AttributesMap.scala.html#org.scalatra.servlet;AttributesMap.get(adc3586498)" title="(key: String)Option[Any]">get</a><span class="delimiter">(</span><a href="#org.scalatra.atmosphere.package.AtmosphereClientKey" title="=&gt; String">AtmosphereClientKey</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Option[org.scalatra.atmosphere.AtmosphereClient]" class="delimiter">[</span><span title="Option[org.scalatra.atmosphere.AtmosphereClient]">Option</span><span class="delimiter">[</span>AtmosphereClient<span class="delimiter">]</span><span class="delimiter">]</span>
    def <a title="=&gt; org.scalatra.atmosphere.AtmosphereClient" id="org.scalatra.atmosphere.package.atmoResourceWithClient;$anon.client">client</a> = <a href="#org.scalatra.atmosphere.package.atmoResourceWithClient.res" title="org.atmosphere.cpr.AtmosphereResource">res</a>.<a href="../servlet/ServletApiImplicits.scala.html#org.scalatra.servlet;ServletApiImplicits.enrichSession" title="implicit org.scalatra.servlet.ServletApiImplicits.enrichSession : (session: javax.servlet.http.HttpSession)org.scalatra.servlet.RichSession">session</a>.<span title="(key: String)Any">apply</span><span class="delimiter">(</span><a href="#org.scalatra.atmosphere.package.AtmosphereClientKey" title="=&gt; String">AtmosphereClientKey</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.scalatra.atmosphere.AtmosphereClient" class="delimiter">[</span><a href="AtmosphereClient.scala.html#org.scalatra.atmosphere;AtmosphereClient" title="org.scalatra.atmosphere.AtmosphereClient">AtmosphereClient</a><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  private<span class="delimiter">[</span>atmosphere<span class="delimiter">]</span> implicit def <a title="[T](javaFuture: java.util.concurrent.Future[T])(implicit system: akka.actor.ActorSystem)scala.concurrent.Future[T]" id="org.scalatra.atmosphere.package.jucFuture2akkaFuture">jucFuture2akkaFuture</a><span class="delimiter">[</span><a title="" id="org.scalatra.atmosphere.package.jucFuture2akkaFuture;T">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="java.util.concurrent.Future[T]" id="org.scalatra.atmosphere.package.jucFuture2akkaFuture.javaFuture">javaFuture</a>: java.util.concurrent.<span title="java.util.concurrent.Future[T]">Future</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span>implicit <a title="akka.actor.ActorSystem" id="org.scalatra.atmosphere.package.jucFuture2akkaFuture.system">system</a>: <span title="akka.actor.ActorSystem">ActorSystem</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[T]">Future</span><span class="delimiter">[</span>T<span class="delimiter">]</span> = <span class="delimiter">{</span>
    implicit val <a title="scala.concurrent.ExecutionContextExecutor" id="org.scalatra.atmosphere.package.jucFuture2akkaFuture.execContext">execContext</a> = <a href="#org.scalatra.atmosphere.package.jucFuture2akkaFuture.system" title="akka.actor.ActorSystem">system</a>.<span title="=&gt; scala.concurrent.ExecutionContextExecutor">dispatcher</span>
    val <a title="scala.concurrent.Promise[T]" id="org.scalatra.atmosphere.package.jucFuture2akkaFuture.promise">promise</a> = <span title="[T]()scala.concurrent.Promise[T]">Promise</span><span title="()scala.concurrent.Promise[T]" class="delimiter">[</span><a href="#org.scalatra.atmosphere.package.jucFuture2akkaFuture;T" title="T">T</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled" title="(javaFuture: java.util.concurrent.Future[T], promise: scala.concurrent.Promise[T], maybeTimeout: Option[scala.concurrent.duration.Deadline])(implicit system: akka.actor.ActorSystem)Unit">pollJavaFutureUntilDoneOrCancelled</a><a href="#org.scalatra.atmosphere.package.jucFuture2akkaFuture.system" title="akka.actor.ActorSystem" class="delimiter">(</a><a href="#org.scalatra.atmosphere.package.jucFuture2akkaFuture.javaFuture" title="java.util.concurrent.Future[T]">javaFuture</a>, <a href="#org.scalatra.atmosphere.package.jucFuture2akkaFuture.promise" title="scala.concurrent.Promise[T]">promise</a><span class="delimiter">)</span>
    <a href="#org.scalatra.atmosphere.package.jucFuture2akkaFuture.promise" title="scala.concurrent.Promise[T]">promise</a>.<span title="=&gt; scala.concurrent.Future[T]">future</span>
  <span class="delimiter">}</span>

  <span class="comment">// See here: http://stackoverflow.com/questions/11529145/how-do-i-wrap-a-java-util-concurrent-future-in-an-akka-future</span>
  private<span class="delimiter">[</span>atmosphere<span class="delimiter">]</span> def <a title="[T](javaFuture: java.util.concurrent.Future[T], promise: scala.concurrent.Promise[T], maybeTimeout: Option[scala.concurrent.duration.Deadline])(implicit system: akka.actor.ActorSystem)Unit" id="org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled">pollJavaFutureUntilDoneOrCancelled</a><span class="delimiter">[</span><a title="" id="org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled$default$3;T">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="java.util.concurrent.Future[T]" id="org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.javaFuture">javaFuture</a>: java.util.concurrent.<span title="java.util.concurrent.Future[T]">Future</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="scala.concurrent.Promise[T]" id="org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.promise">promise</a>: <span title="scala.concurrent.Promise[T]">Promise</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="Option[scala.concurrent.duration.Deadline]" id="org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled$default$3">maybeTimeout</a>: <span title="Option[scala.concurrent.duration.Deadline]">Option</span><span class="delimiter">[</span>Deadline<span class="delimiter">]</span> = <span title="None.type">None</span><span class="delimiter">)</span><span class="delimiter">(</span>implicit <a title="akka.actor.ActorSystem" id="org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.system">system</a>: <span title="akka.actor.ActorSystem">ActorSystem</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    implicit val <a title="scala.concurrent.ExecutionContextExecutor" id="org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.execContext">execContext</a> = <a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.system" title="akka.actor.ActorSystem">system</a>.<span title="=&gt; scala.concurrent.ExecutionContextExecutor">dispatcher</span>
    if <span class="delimiter">(</span><a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled$default$3" title="Option[scala.concurrent.duration.Deadline]">maybeTimeout</a>.<span title="(p: scala.concurrent.duration.Deadline =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.$anonfun.x$1" title="scala.concurrent.duration.Deadline">_</a>.<span title="()Boolean">isOverdue</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.javaFuture" title="java.util.concurrent.Future[T]">javaFuture</a>.<span title="(x$1: Boolean)Boolean">cancel</span><span class="delimiter">(</span>true<span class="delimiter">)</span>

    if <span class="delimiter">(</span><a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.javaFuture" title="java.util.concurrent.Future[T]">javaFuture</a>.<span title="()Boolean">isDone</span> <span title="(x: Boolean)Boolean">||</span> <a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.javaFuture" title="java.util.concurrent.Future[T]">javaFuture</a>.<span title="()Boolean">isCancelled</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.promise" title="scala.concurrent.Promise[T]">promise</a>.<span title="(result: scala.util.Try[T])promise.type">complete</span><span class="delimiter">(</span><span title="util.control.Exception.Catch[Nothing]">allCatch</span> <span title="(body: =&gt; T)scala.util.Try[T]">withTry</span> <span class="delimiter">{</span> <a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.javaFuture" title="java.util.concurrent.Future[T]">javaFuture</a>.<span title="()T">get</span> <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="=&gt; scala.concurrent.Future[T]">future</span>
    <span class="delimiter">}</span> else <span class="delimiter">{</span>
      <a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.system" title="akka.actor.ActorSystem">system</a>.<span title="=&gt; akka.actor.Scheduler">scheduler</span>.<span title="(delay: scala.concurrent.duration.FiniteDuration)(f: =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)akka.actor.Cancellable">scheduleOnce</span><span class="delimiter">(</span><span title="implicit scala.concurrent.duration.package.DurationInt : (n: Int)concurrent.duration.DurationInt" class="int">10</span> <span title="=&gt; scala.concurrent.duration.FiniteDuration">milliseconds</span><span class="delimiter">)</span> <a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.execContext" title="scala.concurrent.ExecutionContextExecutor" class="delimiter">{</a>
        <a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled" title="(javaFuture: java.util.concurrent.Future[T], promise: scala.concurrent.Promise[T], maybeTimeout: Option[scala.concurrent.duration.Deadline])(implicit system: akka.actor.ActorSystem)Unit">pollJavaFutureUntilDoneOrCancelled</a><a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.system" title="akka.actor.ActorSystem" class="delimiter">(</a><a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.javaFuture" title="java.util.concurrent.Future[T]">javaFuture</a>, <a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled.promise" title="scala.concurrent.Promise[T]">promise</a>, <a href="#org.scalatra.atmosphere.package.pollJavaFutureUntilDoneOrCancelled$default$3" title="Option[scala.concurrent.duration.Deadline]">maybeTimeout</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="comment">//  private[atmoshpere] val atmoScheduler = Executors.newScheduledThreadPool(1)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
