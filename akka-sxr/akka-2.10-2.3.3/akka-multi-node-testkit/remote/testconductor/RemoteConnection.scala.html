<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>akka-multi-node-testkit/remote/testconductor/RemoteConnection.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> akka.remote.testconductor

<span class="keyword">import</span> org.jboss.netty.channel.<span class="delimiter">{</span> Channel, ChannelPipeline, ChannelPipelineFactory, ChannelUpstreamHandler, SimpleChannelUpstreamHandler, DefaultChannelPipeline <span class="delimiter">}</span>
<span class="keyword">import</span> org.jboss.netty.channel.socket.nio.<span class="delimiter">{</span> NioClientSocketChannelFactory, NioServerSocketChannelFactory <span class="delimiter">}</span>
<span class="keyword">import</span> org.jboss.netty.bootstrap.<span class="delimiter">{</span> ClientBootstrap, ServerBootstrap <span class="delimiter">}</span>
<span class="keyword">import</span> org.jboss.netty.handler.codec.frame.<span class="delimiter">{</span> LengthFieldBasedFrameDecoder, LengthFieldPrepender <span class="delimiter">}</span>
<span class="keyword">import</span> org.jboss.netty.handler.codec.compression.<span class="delimiter">{</span> ZlibDecoder, ZlibEncoder <span class="delimiter">}</span>
<span class="keyword">import</span> org.jboss.netty.handler.codec.protobuf.<span class="delimiter">{</span> ProtobufDecoder, ProtobufEncoder <span class="delimiter">}</span>
<span class="keyword">import</span> org.jboss.netty.handler.timeout.<span class="delimiter">{</span> ReadTimeoutHandler, ReadTimeoutException <span class="delimiter">}</span>
<span class="keyword">import</span> java.net.InetSocketAddress
<span class="keyword">import</span> java.util.concurrent.Executors
<span class="keyword">import</span> akka.event.Logging
<span class="keyword">import</span> akka.util.Helpers

<span class="comment">/**
 * INTERNAL API.
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">class</span> <a title="class TestConductorPipelineFactory extends Object with org.jboss.netty.channel.ChannelPipelineFactory" id="akka.remote.testconductor;TestConductorPipelineFactory">TestConductorPipelineFactory</a><a href="#akka.remote.testconductor;TestConductorPipelineFactory" title="akka.remote.testconductor.TestConductorPipelineFactory" class="delimiter">(</a><a title="org.jboss.netty.channel.ChannelUpstreamHandler" id="akka.remote.testconductor;TestConductorPipelineFactory.handler">handler</a>: <span title="org.jboss.netty.channel.ChannelUpstreamHandler">ChannelUpstreamHandler</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="org.jboss.netty.channel.ChannelPipelineFactory">ChannelPipelineFactory</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="()org.jboss.netty.channel.ChannelPipeline" id="akka.remote.testconductor;TestConductorPipelineFactory.getPipeline">getPipeline</a>: <span title="org.jboss.netty.channel.ChannelPipeline">ChannelPipeline</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="List[org.jboss.netty.channel.ChannelHandler]" id="akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.encap">encap</a> = <span title="(xs: org.jboss.netty.channel.ChannelHandler*)List[org.jboss.netty.channel.ChannelHandler]">List</span><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.frame.LengthFieldPrepender" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.frame.LengthFieldPrepender">LengthFieldPrepender</span><span class="delimiter">(</span><span title="Int(4)" class="int">4</span><span class="delimiter">)</span>, <span title="(x$1: Int, x$2: Int, x$3: Int, x$4: Int, x$5: Int)org.jboss.netty.handler.codec.frame.LengthFieldBasedFrameDecoder" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.frame.LengthFieldBasedFrameDecoder">LengthFieldBasedFrameDecoder</span><span class="delimiter">(</span><span title="Int(10000)" class="int">10000</span>, <span title="Int(0)" class="int">0</span>, <span title="Int(4)" class="int">4</span>, <span title="Int(0)" class="int">0</span>, <span title="Int(4)" class="int">4</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[org.jboss.netty.channel.ChannelHandler]" id="akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.proto">proto</a> = <span title="(xs: org.jboss.netty.channel.ChannelHandler*)List[org.jboss.netty.channel.ChannelHandler]">List</span><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.protobuf.ProtobufEncoder" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.protobuf.ProtobufEncoder">ProtobufEncoder</span>, <span title="org.jboss.netty.handler.codec.protobuf.ProtobufDecoder" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.protobuf.ProtobufDecoder">ProtobufDecoder</span><span class="delimiter">(</span><span title="akka.remote.testconductor.TestConductorProtocol.type">TestConductorProtocol</span>.<span title="akka.remote.testconductor.TestConductorProtocol.Wrapper.type">Wrapper</span>.<span title="()akka.remote.testconductor.TestConductorProtocol.Wrapper">getDefaultInstance</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[org.jboss.netty.channel.ChannelHandler]" id="akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.msg">msg</a> = <span title="(xs: org.jboss.netty.channel.ChannelHandler*)List[org.jboss.netty.channel.ChannelHandler]">List</span><span class="delimiter">(</span><span title="akka.remote.testconductor.MsgEncoder" class="keyword">new</span> <a href="DataTypes.scala.html#akka.remote.testconductor;MsgEncoder" title="akka.remote.testconductor.MsgEncoder">MsgEncoder</a>, <span title="akka.remote.testconductor.MsgDecoder" class="keyword">new</span> <a href="DataTypes.scala.html#akka.remote.testconductor;MsgDecoder" title="akka.remote.testconductor.MsgDecoder">MsgDecoder</a><span class="delimiter">)</span>
    <span class="delimiter">(</span><a href="#akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.encap" title="List[org.jboss.netty.channel.ChannelHandler]">encap</a> <a href="#akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.x$4" title="(prefix: List[org.jboss.netty.channel.ChannelHandler])List[org.jboss.netty.channel.ChannelHandler]">:::</a> <a href="#akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.proto" title="List[org.jboss.netty.channel.ChannelHandler]">proto</a> <a href="#akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.x$3" title="(prefix: List[org.jboss.netty.channel.ChannelHandler])List[org.jboss.netty.channel.ChannelHandler]">:::</a> <a href="#akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.msg" title="List[org.jboss.netty.channel.ChannelHandler]">msg</a> <a href="#akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.x$2" title="(prefix: List[org.jboss.netty.channel.ChannelHandler])List[org.jboss.netty.channel.ChannelHandler]">:::</a> <a href="#akka.remote.testconductor;TestConductorPipelineFactory.handler" title="org.jboss.netty.channel.ChannelUpstreamHandler">handler</a> <a href="#akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.x$1" title="(x: org.jboss.netty.channel.ChannelUpstreamHandler)List[org.jboss.netty.channel.ChannelUpstreamHandler]">::</a> <span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span>.<span title="(z: org.jboss.netty.channel.DefaultChannelPipeline)(f: (org.jboss.netty.channel.DefaultChannelPipeline, org.jboss.netty.channel.ChannelHandler) =&gt; org.jboss.netty.channel.DefaultChannelPipeline)org.jboss.netty.channel.DefaultChannelPipeline">foldLeft</span><span class="delimiter">(</span><span title="org.jboss.netty.channel.DefaultChannelPipeline" class="keyword">new</span> <span title="org.jboss.netty.channel.DefaultChannelPipeline">DefaultChannelPipeline</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="delimiter">(</span><a title="org.jboss.netty.channel.DefaultChannelPipeline" id="akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.$anonfun.pipe">pipe</a>, <a title="org.jboss.netty.channel.ChannelHandler" id="akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.$anonfun.handler">handler</a><span class="delimiter">)</span> ⇒ <a href="#akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.$anonfun.pipe" title="org.jboss.netty.channel.DefaultChannelPipeline">pipe</a>.<span title="(x$1: String, x$2: org.jboss.netty.channel.ChannelHandler)Unit">addLast</span><span class="delimiter">(</span><a href="../../../akka-actor/event/Logging.scala.html#akka.event.Logging" title="akka.event.Logging.type">Logging</a>.<a href="../../../akka-actor/event/Logging.scala.html#akka.event.Logging.simpleName(77f1808904)" title="(clazz: Class[_])String">simpleName</a><span class="delimiter">(</span><a href="#akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.$anonfun.handler" title="org.jboss.netty.channel.ChannelHandler">handler</a>.<span title="()Class[_]">getClass</span><span class="delimiter">)</span>, <a href="#akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.$anonfun.handler" title="org.jboss.netty.channel.ChannelHandler">handler</a><span class="delimiter">)</span>; <a href="#akka.remote.testconductor;TestConductorPipelineFactory.getPipeline.$anonfun.pipe" title="org.jboss.netty.channel.DefaultChannelPipeline">pipe</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API.
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait Role extends AnyRef" id="akka.remote.testconductor;Role">Role</a>
<span class="comment">/**
 * INTERNAL API.
 */</span>
<span title="AnyRef" class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">case object</span> <a href="#akka.remote.testconductor.Client.productElement.x$1" title="akka.remote.testconductor.Client.type" id="akka.remote.testconductor.Client.readResolve">Client</a> <span title="Product" class="keyword">extends</span> <a href="#akka.remote.testconductor;Role" title="akka.remote.testconductor.Role">Role</a>
<span class="comment">/**
 * INTERNAL API.
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">case object</span> <a href="#akka.remote.testconductor.Server.productElement.x$1" title="akka.remote.testconductor.Server.type" id="akka.remote.testconductor.Server.readResolve">Server</a> <span title="Product" class="keyword">extends</span> <a href="#akka.remote.testconductor;Role" title="akka.remote.testconductor.Role">Role</a>

<span class="comment">/**
 * INTERNAL API.
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">object</span> <a title="akka.remote.testconductor.RemoteConnection.type" id="akka.remote.testconductor.RemoteConnection">RemoteConnection</a> <a href="#akka.remote.testconductor.RemoteConnection" title="akka.remote.testconductor.RemoteConnection.type" class="delimiter">{</a>
  <span class="keyword">def</span> <a title="(role: akka.remote.testconductor.Role, sockaddr: java.net.InetSocketAddress, poolSize: Int, handler: org.jboss.netty.channel.ChannelUpstreamHandler)org.jboss.netty.channel.Channel" id="akka.remote.testconductor.RemoteConnection.apply">apply</a><span class="delimiter">(</span><a title="akka.remote.testconductor.Role" id="akka.remote.testconductor.RemoteConnection.apply.role">role</a>: <a href="#akka.remote.testconductor;Role" title="akka.remote.testconductor.Role">Role</a>, <a title="java.net.InetSocketAddress" id="akka.remote.testconductor.RemoteConnection.apply.sockaddr">sockaddr</a>: <span title="java.net.InetSocketAddress">InetSocketAddress</span>, <a title="Int" id="akka.remote.testconductor.RemoteConnection.apply.poolSize">poolSize</a>: <span title="Int">Int</span>, <a title="org.jboss.netty.channel.ChannelUpstreamHandler" id="akka.remote.testconductor.RemoteConnection.apply.handler">handler</a>: <span title="org.jboss.netty.channel.ChannelUpstreamHandler">ChannelUpstreamHandler</span><span class="delimiter">)</span>: <span title="org.jboss.netty.channel.Channel">Channel</span> = <span class="delimiter">{</span>
    <a href="#akka.remote.testconductor.RemoteConnection.apply.role" title="akka.remote.testconductor.Role">role</a> <span title="org.jboss.netty.channel.Channel" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#akka.remote.testconductor.Client.readResolve" title="akka.remote.testconductor.Client.type">Client</a> ⇒
        <span class="keyword">val</span> <span title="org.jboss.netty.channel.socket.nio.NioClientSocketChannelFactory">socketfactory</span> = <span title="(x$1: java.util.concurrent.Executor, x$2: java.util.concurrent.Executor, x$3: Int)org.jboss.netty.channel.socket.nio.NioClientSocketChannelFactory" class="keyword">new</span> <span title="org.jboss.netty.channel.socket.nio.NioClientSocketChannelFactory">NioClientSocketChannelFactory</span><span class="delimiter">(</span><span title="java.util.concurrent.Executors.type">Executors</span>.<span title="()java.util.concurrent.ExecutorService">newCachedThreadPool</span>, <span title="java.util.concurrent.Executors.type">Executors</span>.<span title="()java.util.concurrent.ExecutorService">newCachedThreadPool</span>,
          <a href="#akka.remote.testconductor.RemoteConnection.apply.poolSize" title="Int">poolSize</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <span title="org.jboss.netty.bootstrap.ClientBootstrap">bootstrap</span> = <span title="(x$1: org.jboss.netty.channel.ChannelFactory)org.jboss.netty.bootstrap.ClientBootstrap" class="keyword">new</span> <span title="org.jboss.netty.bootstrap.ClientBootstrap">ClientBootstrap</span><span class="delimiter">(</span><span title="org.jboss.netty.channel.socket.nio.NioClientSocketChannelFactory">socketfactory</span><span class="delimiter">)</span>
        <span title="org.jboss.netty.bootstrap.ClientBootstrap">bootstrap</span>.<span title="(x$1: org.jboss.netty.channel.ChannelPipelineFactory)Unit">setPipelineFactory</span><span class="delimiter">(</span><span title="akka.remote.testconductor.TestConductorPipelineFactory" class="keyword">new</span> <a href="#akka.remote.testconductor;TestConductorPipelineFactory" title="akka.remote.testconductor.TestConductorPipelineFactory">TestConductorPipelineFactory</a><span class="delimiter">(</span><a href="#akka.remote.testconductor.RemoteConnection.apply.handler" title="org.jboss.netty.channel.ChannelUpstreamHandler">handler</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="org.jboss.netty.bootstrap.ClientBootstrap">bootstrap</span>.<span title="(x$1: String, x$2: Any)Unit">setOption</span><span class="delimiter">(</span><span title="String(&quot;tcpNoDelay&quot;)" class="string">&quot;tcpNoDelay&quot;</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span title="org.jboss.netty.bootstrap.ClientBootstrap">bootstrap</span>.<span title="(x$1: java.net.SocketAddress)org.jboss.netty.channel.ChannelFuture">connect</span><span class="delimiter">(</span><a href="#akka.remote.testconductor.RemoteConnection.apply.sockaddr" title="java.net.InetSocketAddress">sockaddr</a><span class="delimiter">)</span>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>
      <span class="keyword">case</span> <a href="#akka.remote.testconductor.Server.readResolve" title="akka.remote.testconductor.Server.type">Server</a> ⇒
        <span class="keyword">val</span> <span title="org.jboss.netty.channel.socket.nio.NioServerSocketChannelFactory">socketfactory</span> = <span title="(x$1: java.util.concurrent.Executor, x$2: java.util.concurrent.Executor, x$3: Int)org.jboss.netty.channel.socket.nio.NioServerSocketChannelFactory" class="keyword">new</span> <span title="org.jboss.netty.channel.socket.nio.NioServerSocketChannelFactory">NioServerSocketChannelFactory</span><span class="delimiter">(</span><span title="java.util.concurrent.Executors.type">Executors</span>.<span title="()java.util.concurrent.ExecutorService">newCachedThreadPool</span>, <span title="java.util.concurrent.Executors.type">Executors</span>.<span title="()java.util.concurrent.ExecutorService">newCachedThreadPool</span>,
          <a href="#akka.remote.testconductor.RemoteConnection.apply.poolSize" title="Int">poolSize</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <span title="org.jboss.netty.bootstrap.ServerBootstrap">bootstrap</span> = <span title="(x$1: org.jboss.netty.channel.ChannelFactory)org.jboss.netty.bootstrap.ServerBootstrap" class="keyword">new</span> <span title="org.jboss.netty.bootstrap.ServerBootstrap">ServerBootstrap</span><span class="delimiter">(</span><span title="org.jboss.netty.channel.socket.nio.NioServerSocketChannelFactory">socketfactory</span><span class="delimiter">)</span>
        <span title="org.jboss.netty.bootstrap.ServerBootstrap">bootstrap</span>.<span title="(x$1: org.jboss.netty.channel.ChannelPipelineFactory)Unit">setPipelineFactory</span><span class="delimiter">(</span><span title="akka.remote.testconductor.TestConductorPipelineFactory" class="keyword">new</span> <a href="#akka.remote.testconductor;TestConductorPipelineFactory" title="akka.remote.testconductor.TestConductorPipelineFactory">TestConductorPipelineFactory</a><span class="delimiter">(</span><a href="#akka.remote.testconductor.RemoteConnection.apply.handler" title="org.jboss.netty.channel.ChannelUpstreamHandler">handler</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="org.jboss.netty.bootstrap.ServerBootstrap">bootstrap</span>.<span title="(x$1: String, x$2: Any)Unit">setOption</span><span class="delimiter">(</span><span title="String(&quot;reuseAddress&quot;)" class="string">&quot;reuseAddress&quot;</span>, <span title="=&gt; Boolean">!</span><a href="../../../akka-actor/util/Helpers.scala.html#akka.util.Helpers" title="akka.util.Helpers.type">Helpers</a>.<a href="../../../akka-actor/util/Helpers.scala.html#akka.util.Helpers.isWindows" title="=&gt; Boolean">isWindows</a><span class="delimiter">)</span>
        <span title="org.jboss.netty.bootstrap.ServerBootstrap">bootstrap</span>.<span title="(x$1: String, x$2: Any)Unit">setOption</span><span class="delimiter">(</span><span title="String(&quot;child.tcpNoDelay&quot;)" class="string">&quot;child.tcpNoDelay&quot;</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span title="org.jboss.netty.bootstrap.ServerBootstrap">bootstrap</span>.<span title="(x$1: java.net.SocketAddress)org.jboss.netty.channel.Channel">bind</span><span class="delimiter">(</span><a href="#akka.remote.testconductor.RemoteConnection.apply.sockaddr" title="java.net.InetSocketAddress">sockaddr</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(channel: org.jboss.netty.channel.Channel)String" id="akka.remote.testconductor.RemoteConnection.getAddrString">getAddrString</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.Channel" id="akka.remote.testconductor.RemoteConnection.getAddrString.channel">channel</a>: <span title="org.jboss.netty.channel.Channel">Channel</span><span class="delimiter">)</span> = <a href="#akka.remote.testconductor.RemoteConnection.getAddrString.channel" title="org.jboss.netty.channel.Channel">channel</a>.<span title="()java.net.SocketAddress">getRemoteAddress</span> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="java.net.InetSocketAddress" id="akka.remote.testconductor.RemoteConnection.getAddrString.i">i</a>: <span title="java.net.InetSocketAddress">InetSocketAddress</span> ⇒ <a href="#akka.remote.testconductor.RemoteConnection.getAddrString.i" title="java.net.InetSocketAddress">i</a>.<span title="()String">toString</span>
    <span class="keyword">case</span> _                    ⇒ <span title="String(&quot;[unknown]&quot;)" class="string">&quot;[unknown]&quot;</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(channel: org.jboss.netty.channel.Channel)org.jboss.netty.channel.ChannelFuture" id="akka.remote.testconductor.RemoteConnection.shutdown">shutdown</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.Channel" id="akka.remote.testconductor.RemoteConnection.shutdown.channel">channel</a>: <span title="org.jboss.netty.channel.Channel">Channel</span><span class="delimiter">)</span> =
    <span class="keyword">try</span> <a href="#akka.remote.testconductor.RemoteConnection.shutdown.channel" title="org.jboss.netty.channel.Channel">channel</a>.<span title="()org.jboss.netty.channel.ChannelFuture">close</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="keyword">finally</span> <span class="keyword">try</span> <a href="#akka.remote.testconductor.RemoteConnection.shutdown.channel" title="org.jboss.netty.channel.Channel">channel</a>.<span title="()org.jboss.netty.channel.ChannelFactory">getFactory</span>.<span title="()Unit">shutdown</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="keyword">finally</span> <a href="#akka.remote.testconductor.RemoteConnection.shutdown.channel" title="org.jboss.netty.channel.Channel">channel</a>.<span title="()org.jboss.netty.channel.ChannelFactory">getFactory</span>.<span title="()Unit">releaseExternalResources</span><span class="delimiter">(</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
