<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>akka-actor/util/Index.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> akka.util

<span class="keyword">import</span> annotation.tailrec

<span class="keyword">import</span> java.util.concurrent.<span class="delimiter">{</span> ConcurrentSkipListSet, ConcurrentHashMap <span class="delimiter">}</span>
<span class="keyword">import</span> java.util.Comparator
<span class="keyword">import</span> scala.collection.<span title="scala.collection.JavaConverters.type">JavaConverters</span>.<span class="delimiter">{</span> asScalaIteratorConverter, collectionAsScalaIterableConverter <span class="delimiter">}</span>
<span class="keyword">import</span> scala.collection.mutable

<span class="comment">/**
 * An implementation of a ConcurrentMultiMap
 * Adds/remove is serialized over the specified key
 * Reads are fully concurrent &lt;-- el-cheapo
 */</span>
<span class="keyword">class</span> <a title="class Index[K, V] extends AnyRef" id="akka.util;Index">Index</a><span class="delimiter">[</span><a title="" id="akka.util;Index;K">K</a>, <a title="" id="akka.util;Index;V">V</a><span class="delimiter">]</span><a href="#akka.util;Index" title="akka.util.Index[K,V]" class="delimiter">(</a><span class="keyword">val</span> <a title="Int" id="akka.util;Index.mapSize">mapSize</a>: <span title="Int">Int</span>, <span class="keyword">val</span> <a title="java.util.Comparator[V]" id="akka.util;Index.valueComparator">valueComparator</a>: <span title="java.util.Comparator[V]">Comparator</span><span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(mapSize: Int, cmp: (V, V) =&gt; Int)akka.util.Index[K,V]" id="akka.util;Index.<init>(4f8b58a93f)" class="keyword">this</a><span class="delimiter">(</span><a title="Int" id="akka.util;Index.<init>(4f8b58a93f).mapSize">mapSize</a>: <span title="Int">Int</span>, <a title="(V, V) =&gt; Int" id="akka.util;Index.<init>(4f8b58a93f).cmp">cmp</a>: <span class="delimiter">(</span>V, V<span class="delimiter">)</span> ⇒ Int<span class="delimiter">)</span> = <a href="#akka.util;Index" title="Index.this.type" class="keyword">this</a><span class="delimiter">(</span><a href="#akka.util;Index.<init>(4f8b58a93f).mapSize" title="Int">mapSize</a>, <a href="#akka.util;Index.<init>(4f8b58a93f);$anon" title="java.util.Comparator[V]" class="keyword">new</a> <a title="anonymous class $anon extends Object with java.util.Comparator[V]" id="akka.util;Index.<init>(4f8b58a93f);$anon">Comparator</a><span class="delimiter">[</span>V<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(a: V, b: V)Int" id="akka.util;Index.<init>(4f8b58a93f);$anon.compare">compare</a><span class="delimiter">(</span><a title="V" id="akka.util;Index.<init>(4f8b58a93f);$anon.compare.a">a</a>: <a href="#akka.util;Index;V" title="V">V</a>, <a title="V" id="akka.util;Index.<init>(4f8b58a93f);$anon.compare.b">b</a>: <a href="#akka.util;Index;V" title="V">V</a><span class="delimiter">)</span>: <span title="Int">Int</span> = <a href="#akka.util;Index.<init>(4f8b58a93f).cmp" title="(v1: V, v2: V)Int">cmp</a><span class="delimiter">(</span><a href="#akka.util;Index.<init>(4f8b58a93f);$anon.compare.a" title="V">a</a>, <a href="#akka.util;Index.<init>(4f8b58a93f);$anon.compare.b" title="V">b</a><span class="delimiter">)</span>
  <span class="delimiter">}</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]" id="akka.util;Index.container">container</a> = <span title="(x$1: Int)java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">ConcurrentHashMap</span><span class="delimiter">[</span>K, ConcurrentSkipListSet<span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.util;Index.mapSize" title="=&gt; Int">mapSize</a><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentSkipListSet[V]" id="akka.util;Index.emptySet">emptySet</a> = <span title="java.util.concurrent.ConcurrentSkipListSet[V]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentSkipListSet[V]">ConcurrentSkipListSet</span><span class="delimiter">[</span>V<span class="delimiter">]</span>

  <span class="comment">/**
   * Associates the value of type V with the key of type K
   * @return true if the value didn't exist for the key previously, and false otherwise
   */</span>
  <span class="keyword">def</span> <a title="(key: K, value: V)Boolean" id="akka.util;Index.put">put</a><span class="delimiter">(</span><a title="K" id="akka.util;Index.put.key">key</a>: <a href="#akka.util;Index;K" title="K">K</a>, <a title="V" id="akka.util;Index.put.value">value</a>: <a href="#akka.util;Index;V" title="V">V</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="comment">//Tailrecursive spin-locking put</span>
    @tailrec
    <span class="keyword">def</span> <a title="(k: K, v: V)Boolean" id="akka.util;Index.put.spinPut">spinPut</a><span class="delimiter">(</span><a title="K" id="akka.util;Index.put.spinPut.k">k</a>: <a href="#akka.util;Index;K" title="K">K</a>, <a title="V" id="akka.util;Index.put.spinPut.v">v</a>: <a href="#akka.util;Index;V" title="V">V</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="Boolean" id="akka.util;Index.put.spinPut.retry">retry</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">var</span> <a title="Boolean" id="akka.util;Index.put.spinPut.added">added</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentSkipListSet[V]" id="akka.util;Index.put.spinPut.set">set</a> = <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a> <span title="(x$1: Any)java.util.concurrent.ConcurrentSkipListSet[V]">get</span> <a href="#akka.util;Index.put.spinPut.k" title="K">k</a>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.util;Index.put.spinPut.set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.util;Index.put.spinPut.set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a>.<span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.util;Index.put.spinPut.set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#akka.util;Index.put.spinPut.retry" title="Boolean">retry</a> = <span title="Boolean(true)" class="keyword">true</span> <span class="comment">//IF the set is empty then it has been removed, so signal retry</span>
          <span class="keyword">else</span> <span class="delimiter">{</span> <span class="comment">//Else add the value to the set and signal that retry is not needed</span>
            <a href="#akka.util;Index.put.spinPut.added" title="Boolean">added</a> = <a href="#akka.util;Index.put.spinPut.set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a> <span title="(x$1: V)Boolean">add</span> <a href="#akka.util;Index.put.spinPut.v" title="V">v</a>
            <a href="#akka.util;Index.put.spinPut.retry" title="Boolean">retry</a> = <span title="Boolean(false)" class="keyword">false</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentSkipListSet[V]" id="akka.util;Index.put.spinPut.newSet">newSet</a> = <span title="(x$1: java.util.Comparator[_ &gt;: V])java.util.concurrent.ConcurrentSkipListSet[V]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentSkipListSet[V]">ConcurrentSkipListSet</span><span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.util;Index.valueComparator" title="=&gt; java.util.Comparator[V]">valueComparator</a><span class="delimiter">)</span>
        <a href="#akka.util;Index.put.spinPut.newSet" title="java.util.concurrent.ConcurrentSkipListSet[V]">newSet</a> <span title="(x$1: V)Boolean">add</span> <a href="#akka.util;Index.put.spinPut.v" title="V">v</a>

        <span class="comment">// Parry for two simultaneous putIfAbsent(id,newSet)</span>
        <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentSkipListSet[V]" id="akka.util;Index.put.spinPut.oldSet">oldSet</a> = <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a>.<span title="(x$1: K, x$2: java.util.concurrent.ConcurrentSkipListSet[V])java.util.concurrent.ConcurrentSkipListSet[V]">putIfAbsent</span><span class="delimiter">(</span><a href="#akka.util;Index.put.spinPut.k" title="K">k</a>, <a href="#akka.util;Index.put.spinPut.newSet" title="java.util.concurrent.ConcurrentSkipListSet[V]">newSet</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.util;Index.put.spinPut.oldSet" title="java.util.concurrent.ConcurrentSkipListSet[V]">oldSet</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#akka.util;Index.put.spinPut.oldSet" title="java.util.concurrent.ConcurrentSkipListSet[V]">oldSet</a>.<span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.util;Index.put.spinPut.oldSet" title="java.util.concurrent.ConcurrentSkipListSet[V]">oldSet</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#akka.util;Index.put.spinPut.retry" title="Boolean">retry</a> = <span title="Boolean(true)" class="keyword">true</span> <span class="comment">//IF the set is empty then it has been removed, so signal retry</span>
            <span class="keyword">else</span> <span class="delimiter">{</span> <span class="comment">//Else try to add the value to the set and signal that retry is not needed</span>
              <a href="#akka.util;Index.put.spinPut.added" title="Boolean">added</a> = <a href="#akka.util;Index.put.spinPut.oldSet" title="java.util.concurrent.ConcurrentSkipListSet[V]">oldSet</a> <span title="(x$1: V)Boolean">add</span> <a href="#akka.util;Index.put.spinPut.v" title="V">v</a>
              <a href="#akka.util;Index.put.spinPut.retry" title="Boolean">retry</a> = <span title="Boolean(false)" class="keyword">false</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#akka.util;Index.put.spinPut.added" title="Boolean">added</a> = <span title="Boolean(true)" class="keyword">true</span>
      <span class="delimiter">}</span>

      <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.util;Index.put.spinPut.retry" title="Boolean">retry</a><span class="delimiter">)</span> <a href="#akka.util;Index.put.spinPut" title="(k: K, v: V)Boolean">spinPut</a><span class="delimiter">(</span><a href="#akka.util;Index.put.spinPut.k" title="K">k</a>, <a href="#akka.util;Index.put.spinPut.v" title="V">v</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="#akka.util;Index.put.spinPut.added" title="Boolean">added</a>
    <span class="delimiter">}</span>

    <a href="#akka.util;Index.put.spinPut" title="(k: K, v: V)Boolean">spinPut</a><span class="delimiter">(</span><a href="#akka.util;Index.put.key" title="K">key</a>, <a href="#akka.util;Index.put.value" title="V">value</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * @return Some(value) for the first matching value where the supplied function returns true for the given key,
   * if no matches it returns None
   */</span>
  <span class="keyword">def</span> <a title="(key: K)(f: V =&gt; Boolean)Option[V]" id="akka.util;Index.findValue">findValue</a><span class="delimiter">(</span><a title="K" id="akka.util;Index.findValue.key">key</a>: <a href="#akka.util;Index;K" title="K">K</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="V =&gt; Boolean" id="akka.util;Index.findValue.f">f</a>: <span class="delimiter">(</span>V<span class="delimiter">)</span> ⇒ Boolean<span class="delimiter">)</span>: <span title="Option[V]">Option</span><span class="delimiter">[</span>V<span class="delimiter">]</span> =
    <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a> <span title="(x$1: Any)java.util.concurrent.ConcurrentSkipListSet[V]">get</span> <a href="#akka.util;Index.findValue.key" title="K">key</a> <span title="Option[V]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> ⇒ <span title="None.type">None</span>
      <span class="keyword">case</span> <a title="java.util.concurrent.ConcurrentSkipListSet[V]" id="akka.util;Index.findValue.set">set</a>  ⇒ <a href="#akka.util;Index.findValue.set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a>.<span title="(i: java.util.Iterator[V])scala.collection.convert.Decorators.AsScala[Iterator[V]]">iterator</span>.<span title="=&gt; Iterator[V]">asScala</span> <span title="(p: V =&gt; Boolean)Option[V]">find</span> <a href="#akka.util;Index.findValue.f" title="V =&gt; Boolean">f</a>
    <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns an Iterator of V containing the values for the supplied key, or an empty iterator if the key doesn't exist
   */</span>
  <span class="keyword">def</span> <a title="(key: K)Iterator[V]" id="akka.util;Index.valueIterator">valueIterator</a><span class="delimiter">(</span><a title="K" id="akka.util;Index.valueIterator.key">key</a>: <a href="#akka.util;Index;K" title="K">K</a><span class="delimiter">)</span>: scala.<span title="Iterator[V]">Iterator</span><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a>.<span title="(x$1: Any)java.util.concurrent.ConcurrentSkipListSet[V]">get</span><span class="delimiter">(</span><a href="#akka.util;Index.valueIterator.key" title="K">key</a><span class="delimiter">)</span> <span title="Iterator[V]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> ⇒ <span title="=&gt; collection.Iterator.type">Iterator</span>.<span title="=&gt; Iterator[Nothing]">empty</span>
      <span class="keyword">case</span> <a title="java.util.concurrent.ConcurrentSkipListSet[V]" id="akka.util;Index.valueIterator.some">some</a> ⇒ <a href="#akka.util;Index.valueIterator.some" title="java.util.concurrent.ConcurrentSkipListSet[V]">some</a>.<span title="(i: java.util.Iterator[V])scala.collection.convert.Decorators.AsScala[Iterator[V]]">iterator</span>.<span title="=&gt; Iterator[V]">asScala</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Applies the supplied function to all keys and their values
   */</span>
  <span class="keyword">def</span> <a title="(fun: (K, V) =&gt; Unit)Unit" id="akka.util;Index.foreach">foreach</a><span class="delimiter">(</span><a title="(K, V) =&gt; Unit" id="akka.util;Index.foreach.fun">fun</a>: <span class="delimiter">(</span>K, V<span class="delimiter">)</span> ⇒ Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a>.<span title="()java.util.Set[java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]]">entrySet</span>.<span title="(i: java.util.Iterator[java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]])scala.collection.convert.Decorators.AsScala[Iterator[java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]]]">iterator</span>.<span title="=&gt; Iterator[java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]]">asScala</span> <span title="(f: java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]] =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]" id="akka.util;Index.foreach.$anonfun.e">e</a> ⇒ <a href="#akka.util;Index.foreach.$anonfun.e" title="java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]">e</a>.<span title="()java.util.concurrent.ConcurrentSkipListSet[V]">getValue</span>.<span title="(i: java.util.Iterator[V])scala.collection.convert.Decorators.AsScala[Iterator[V]]">iterator</span>.<span title="=&gt; Iterator[V]">asScala</span>.<span title="(f: V =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#akka.util;Index.foreach.fun" title="(v1: K, v2: V)Unit">fun</a><span class="delimiter">(</span><a href="#akka.util;Index.foreach.$anonfun.e" title="java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]">e</a>.<span title="()K">getKey</span>, <a href="#akka.util;Index.foreach.$anonfun.$anonfun.x$1" title="V">_</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns the union of all value sets.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Set[V]" id="akka.util;Index.values">values</a>: <span title="Set[V]">Set</span><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.Builder[V,scala.collection.immutable.Set[V]]" id="akka.util;Index.values.builder">builder</a> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.mutable.Builder[A,scala.collection.immutable.Set[A]]">newBuilder</span><span title="scala.collection.mutable.Builder[V,scala.collection.immutable.Set[V]]" class="delimiter">[</span><a href="#akka.util;Index;V" title="V">V</a><span class="delimiter">]</span>
    <span class="keyword">for</span> <span class="delimiter">{</span>
      <a title="java.util.concurrent.ConcurrentSkipListSet[V]" id="akka.util;Index.values.$anonfun.values">values</a> ← <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a>.<span title="()java.util.Collection[java.util.concurrent.ConcurrentSkipListSet[V]]">values</span>.<span title="(i: java.util.Iterator[java.util.concurrent.ConcurrentSkipListSet[V]])scala.collection.convert.Decorators.AsScala[Iterator[java.util.concurrent.ConcurrentSkipListSet[V]]]">iterator</span>.<span title="(f: java.util.concurrent.ConcurrentSkipListSet[V] =&gt; Unit)Unit">asScala</span>
      <a title="V" id="akka.util;Index.values.$anonfun.$anonfun.v">v</a> ← <a href="#akka.util;Index.values.$anonfun.values" title="java.util.concurrent.ConcurrentSkipListSet[V]">values</a>.<span title="(i: java.util.Iterator[V])scala.collection.convert.Decorators.AsScala[Iterator[V]]">iterator</span>.<span title="(f: V =&gt; scala.collection.mutable.Builder[V,scala.collection.immutable.Set[V]])Unit">asScala</span>
    <span class="delimiter">}</span> <a href="#akka.util;Index.values.builder" title="scala.collection.mutable.Builder[V,scala.collection.immutable.Set[V]]">builder</a> <span title="(elem: V)builder.type">+=</span> <a href="#akka.util;Index.values.$anonfun.$anonfun.v" title="V">v</a>
    <a href="#akka.util;Index.values.builder" title="scala.collection.mutable.Builder[V,scala.collection.immutable.Set[V]]">builder</a>.<span title="()scala.collection.immutable.Set[V]">result</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns the key set.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Iterable[K]" id="akka.util;Index.keys">keys</a>: <span title="Iterable[K]">Iterable</span><span class="delimiter">[</span>K<span class="delimiter">]</span> = <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a>.<span title="(i: java.util.Collection[K])scala.collection.convert.Decorators.AsScala[Iterable[K]]">keySet</span>.<span title="=&gt; Iterable[K]">asScala</span>

  <span class="comment">/**
   * Disassociates the value of type V from the key of type K
   * @return true if the value was disassociated from the key and false if it wasn't previously associated with the key
   */</span>
  <span class="keyword">def</span> <a title="(key: K, value: V)Boolean" id="akka.util;Index.remove(8d181fb718)">remove</a><span class="delimiter">(</span><a title="K" id="akka.util;Index.remove(8d181fb718).key">key</a>: <a href="#akka.util;Index;K" title="K">K</a>, <a title="V" id="akka.util;Index.remove(8d181fb718).value">value</a>: <a href="#akka.util;Index;V" title="V">V</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentSkipListSet[V]" id="akka.util;Index.remove(8d181fb718).set">set</a> = <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a> <span title="(x$1: Any)java.util.concurrent.ConcurrentSkipListSet[V]">get</span> <a href="#akka.util;Index.remove(8d181fb718).key" title="K">key</a>

    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.util;Index.remove(8d181fb718).set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.util;Index.remove(8d181fb718).set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a>.<span title="(x$1: Boolean)Boolean">synchronized</span> <span class="delimiter">{</span>
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.util;Index.remove(8d181fb718).set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a>.<span title="(x$1: Any)Boolean">remove</span><span class="delimiter">(</span><a href="#akka.util;Index.remove(8d181fb718).value" title="V">value</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">//If we can remove the value</span>
          <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.util;Index.remove(8d181fb718).set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <span class="comment">//and the set becomes empty</span>
            <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a>.<span title="(x$1: Any, x$2: Any)Boolean">remove</span><span class="delimiter">(</span><a href="#akka.util;Index.remove(8d181fb718).key" title="K">key</a>, <a href="#akka.util;Index.emptySet" title="=&gt; java.util.concurrent.ConcurrentSkipListSet[V]">emptySet</a><span class="delimiter">)</span> <span class="comment">//We try to remove the key if it's mapped to an empty set</span>

          <span title="Boolean(true)" class="keyword">true</span> <span class="comment">//Remove succeeded</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span> <span class="comment">//Remove failed</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span> <span class="comment">//Remove failed</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Disassociates all the values for the specified key
   * @return None if the key wasn't associated at all, or Some(scala.Iterable[V]) if it was associated
   */</span>
  <span class="keyword">def</span> <a title="(key: K)Option[Iterable[V]]" id="akka.util;Index.remove(93939913bf)">remove</a><span class="delimiter">(</span><a title="K" id="akka.util;Index.remove(93939913bf).key">key</a>: <a href="#akka.util;Index;K" title="K">K</a><span class="delimiter">)</span>: <span title="Option[Iterable[V]]">Option</span><span class="delimiter">[</span>Iterable<span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentSkipListSet[V]" id="akka.util;Index.remove(93939913bf).set">set</a> = <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a> <span title="(x$1: Any)java.util.concurrent.ConcurrentSkipListSet[V]">get</span> <a href="#akka.util;Index.remove(93939913bf).key" title="K">key</a>

    <span title="Option[Iterable[V]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.util;Index.remove(93939913bf).set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.util;Index.remove(93939913bf).set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a>.<span title="(x$1: Some[Iterable[V]])Some[Iterable[V]]">synchronized</span> <span class="delimiter">{</span>
        <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a>.<span title="(x$1: Any, x$2: Any)Boolean">remove</span><span class="delimiter">(</span><a href="#akka.util;Index.remove(93939913bf).key" title="K">key</a>, <a href="#akka.util;Index.remove(93939913bf).set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Iterable[V]" id="akka.util;Index.remove(93939913bf).ret">ret</a> = <span title="(i: java.util.Collection[V])scala.collection.convert.Decorators.AsScala[Iterable[V]]">collectionAsScalaIterableConverter</span><span class="delimiter">(</span><a href="#akka.util;Index.remove(93939913bf).set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a>.<span title="()java.util.concurrent.ConcurrentSkipListSet[V]">clone</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; Iterable[V]">asScala</span> <span class="comment">// Make copy since we need to clear the original</span>
        <a href="#akka.util;Index.remove(93939913bf).set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="comment">// Clear the original set to signal to any pending writers that there was a conflict</span>
        <span title="(x: Iterable[V])Some[Iterable[V]]">Some</span><span class="delimiter">(</span><a href="#akka.util;Index.remove(93939913bf).ret" title="Iterable[V]">ret</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="None.type">None</span> <span class="comment">//Remove failed</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Removes the specified value from all keys
   */</span>
  <span class="keyword">def</span> <a title="(value: V)Unit" id="akka.util;Index.removeValue">removeValue</a><span class="delimiter">(</span><a title="V" id="akka.util;Index.removeValue.value">value</a>: <a href="#akka.util;Index;V" title="V">V</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.util.Iterator[java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]]" id="akka.util;Index.removeValue.i">i</a> = <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a>.<span title="()java.util.Set[java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]]">entrySet</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.util.Iterator[java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]]">iterator</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#akka.util;Index.removeValue.i" title="java.util.Iterator[java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]]">i</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <a href="#akka.util;Index.removeValue.while$1" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]" id="akka.util;Index.removeValue.e">e</a> = <a href="#akka.util;Index.removeValue.i" title="java.util.Iterator[java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]]">i</a>.<span title="()java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]">next</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentSkipListSet[V]" id="akka.util;Index.removeValue.set">set</a> = <a href="#akka.util;Index.removeValue.e" title="java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]">e</a>.<span title="()java.util.concurrent.ConcurrentSkipListSet[V]">getValue</span><span class="delimiter">(</span><span class="delimiter">)</span>

      <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.util;Index.removeValue.set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.util;Index.removeValue.set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a>.<span title="(x$1: AnyVal)AnyVal">synchronized</span> <span class="delimiter">{</span>
          <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.util;Index.removeValue.set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a>.<span title="(x$1: Any)Boolean">remove</span><span class="delimiter">(</span><a href="#akka.util;Index.removeValue.value" title="V">value</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">//If we can remove the value</span>
            <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.util;Index.removeValue.set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <span class="comment">//and the set becomes empty</span>
              <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a>.<span title="(x$1: Any, x$2: Any)Boolean">remove</span><span class="delimiter">(</span><a href="#akka.util;Index.removeValue.e" title="java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]">e</a>.<span title="()K">getKey</span>, <a href="#akka.util;Index.emptySet" title="=&gt; java.util.concurrent.ConcurrentSkipListSet[V]">emptySet</a><span class="delimiter">)</span> <span class="comment">//We try to remove the key if it's mapped to an empty set</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * @return true if the underlying containers is empty, may report false negatives when the last remove is underway
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="akka.util;Index.isEmpty">isEmpty</a>: <span title="Boolean">Boolean</span> = <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a>.<span title="()Boolean">isEmpty</span>

  <span class="comment">/**
   *  Removes all keys and all values
   */</span>
  <span class="keyword">def</span> <a title="()Unit" id="akka.util;Index.clear">clear</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.util.Iterator[java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]]" id="akka.util;Index.clear.i">i</a> = <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a>.<span title="()java.util.Set[java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]]">entrySet</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.util.Iterator[java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]]">iterator</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#akka.util;Index.clear.i" title="java.util.Iterator[java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]]">i</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <a href="#akka.util;Index.clear.while$2" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]" id="akka.util;Index.clear.e">e</a> = <a href="#akka.util;Index.clear.i" title="java.util.Iterator[java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]]">i</a>.<span title="()java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]">next</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentSkipListSet[V]" id="akka.util;Index.clear.set">set</a> = <a href="#akka.util;Index.clear.e" title="java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]">e</a>.<span title="()java.util.concurrent.ConcurrentSkipListSet[V]">getValue</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.util;Index.clear.set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#akka.util;Index.clear.set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a>.<span title="(x$1: Boolean)Boolean">synchronized</span> <span class="delimiter">{</span> <a href="#akka.util;Index.clear.set" title="java.util.concurrent.ConcurrentSkipListSet[V]">set</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>; <a href="#akka.util;Index.container" title="=&gt; java.util.concurrent.ConcurrentHashMap[K,java.util.concurrent.ConcurrentSkipListSet[V]]">container</a>.<span title="(x$1: Any, x$2: Any)Boolean">remove</span><span class="delimiter">(</span><a href="#akka.util;Index.clear.e" title="java.util.Map.Entry[K,java.util.concurrent.ConcurrentSkipListSet[V]]">e</a>.<span title="()K">getKey</span>, <a href="#akka.util;Index.emptySet" title="=&gt; java.util.concurrent.ConcurrentSkipListSet[V]">emptySet</a><span class="delimiter">)</span> <span class="delimiter">}</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * An implementation of a ConcurrentMultiMap
 * Adds/remove is serialized over the specified key
 * Reads are fully concurrent &lt;-- el-cheapo
 */</span>
<span title="AnyRef" class="keyword">class</span> <a title="class ConcurrentMultiMap[K, V] extends akka.util.Index[K,V]" id="akka.util;ConcurrentMultiMap">ConcurrentMultiMap</a><span class="delimiter">[</span><a title="" id="akka.util;ConcurrentMultiMap;K">K</a>, <a title="" id="akka.util;ConcurrentMultiMap;V">V</a><span class="delimiter">]</span><a href="#akka.util;ConcurrentMultiMap" title="akka.util.ConcurrentMultiMap[K,V]" class="delimiter">(</a><a title="Int" id="akka.util;ConcurrentMultiMap.mapSize">mapSize</a>: <span title="Int">Int</span>, <a title="java.util.Comparator[V]" id="akka.util;ConcurrentMultiMap.valueComparator">valueComparator</a>: <span title="java.util.Comparator[V]">Comparator</span><span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.util;Index" title="akka.util.Index[K,V]">Index</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.util;ConcurrentMultiMap.mapSize" title="Int">mapSize</a>, <a href="#akka.util;ConcurrentMultiMap.valueComparator" title="java.util.Comparator[V]">valueComparator</a><span class="delimiter">)</span>

        </pre>
    </body>
</html>
