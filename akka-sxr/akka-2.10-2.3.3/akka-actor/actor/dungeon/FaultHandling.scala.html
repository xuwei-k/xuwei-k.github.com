<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>akka-actor/actor/dungeon/FaultHandling.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

<span class="keyword">package</span> akka.actor.dungeon

<span class="keyword">import</span> akka.actor.PostRestartException
<span class="keyword">import</span> akka.actor.PreRestartException
<span class="keyword">import</span> akka.actor.<span class="delimiter">{</span> InternalActorRef, ActorRef, ActorInterruptedException, ActorCell, Actor <span class="delimiter">}</span>
<span class="keyword">import</span> akka.dispatch._
<span class="keyword">import</span> akka.dispatch.sysmsg._
<span class="keyword">import</span> akka.event.Logging
<span class="keyword">import</span> akka.event.<a href="../../event/Logging.scala.html#akka.event.Logging" title="akka.event.Logging.type">Logging</a>.Debug
<span class="keyword">import</span> akka.event.<a href="../../event/Logging.scala.html#akka.event.Logging" title="akka.event.Logging.type">Logging</a>.Error
<span class="keyword">import</span> scala.collection.immutable
<span class="keyword">import</span> scala.concurrent.duration.Duration
<span class="keyword">import</span> scala.util.control.<span title="scala.util.control.Exception.type">Exception</span>._
<span class="keyword">import</span> scala.util.control.NonFatal
<span class="keyword">import</span> akka.actor.ActorRefScope

<span class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait FaultHandling extends AnyRef" id="akka.actor.dungeon;FaultHandling">FaultHandling</a> <span title="Unit" class="delimiter">{</span> <span class="keyword">this</span>: ActorCell ⇒

  <span class="comment">/* =================
   * T H E   R U L E S
   * =================
   *
   * Actors can be suspended for two reasons:
   * - they fail
   * - their supervisor gets suspended
   *
   * In particular they are not suspended multiple times because of cascading
   * own failures, i.e. while currentlyFailed() they do not fail again. In case
   * of a restart, failures in constructor/preStart count as new failures.
   */</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor.dungeon;FaultHandling.suspendNonRecursive">suspendNonRecursive</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="../ActorCell.scala.html#akka.actor;ActorCell.dispatcher" title="=&gt; akka.dispatch.MessageDispatcher">dispatcher</a> <a href="../../dispatch/AbstractDispatcher.scala.html#akka.dispatch;MessageDispatcher.suspend" title="(actor: akka.actor.ActorCell)Unit">suspend</a> <a href="#akka.actor.dungeon;FaultHandling" title="akka.actor.ActorCell" class="keyword">this</a>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor.dungeon;FaultHandling.resumeNonRecursive">resumeNonRecursive</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="../ActorCell.scala.html#akka.actor;ActorCell.dispatcher" title="=&gt; akka.dispatch.MessageDispatcher">dispatcher</a> <a href="../../dispatch/AbstractDispatcher.scala.html#akka.dispatch;MessageDispatcher.resume" title="(actor: akka.actor.ActorCell)Unit">resume</a> <a href="#akka.actor.dungeon;FaultHandling" title="akka.actor.ActorCell" class="keyword">this</a>

  <span class="comment">/*
   * have we told our supervisor that we Failed() and have not yet heard back?
   * (actually: we might have heard back but not yet acted upon it, in case of
   * a restart with dying children)
   * might well be replaced by ref to a Cancellable in the future (see #2299)
   */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="akka.actor.ActorRef" id="akka.actor.dungeon;FaultHandling._failed_=">_failed</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <span title="Null(null)" class="keyword">null</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="akka.actor.dungeon;FaultHandling.isFailed">isFailed</a>: <span title="Boolean">Boolean</span> = <a href="#akka.actor.dungeon;FaultHandling._failed_=" title="=&gt; akka.actor.ActorRef">_failed</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(perpetrator: akka.actor.ActorRef)Unit" id="akka.actor.dungeon;FaultHandling.setFailed">setFailed</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.dungeon;FaultHandling.setFailed.perpetrator">perpetrator</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.actor.dungeon;FaultHandling._failed_=" title="(x$1: akka.actor.ActorRef)Unit">_failed</a> = <a href="#akka.actor.dungeon;FaultHandling.setFailed.perpetrator" title="akka.actor.ActorRef">perpetrator</a>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor.dungeon;FaultHandling.clearFailed">clearFailed</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.actor.dungeon;FaultHandling._failed_=" title="(x$1: akka.actor.ActorRef)Unit">_failed</a> = <span title="Null(null)" class="keyword">null</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; akka.actor.ActorRef" id="akka.actor.dungeon;FaultHandling.perpetrator">perpetrator</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <a href="#akka.actor.dungeon;FaultHandling._failed_=" title="=&gt; akka.actor.ActorRef">_failed</a>

  <span class="comment">/**
   * Do re-create the actor in response to a failure.
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(cause: Throwable)Unit" id="akka.actor.dungeon;FaultHandling.faultRecreate">faultRecreate</a><span class="delimiter">(</span><a title="Throwable" id="akka.actor.dungeon;FaultHandling.faultRecreate.cause">cause</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../ActorCell.scala.html#akka.actor;ActorCell.system" title="=&gt; akka.actor.ActorSystemImpl">system</a>.<a href="../ActorSystem.scala.html#akka.actor;ActorSystemImpl.eventStream" title="=&gt; akka.event.EventStream">eventStream</a>.<a href="../../event/EventBus.scala.html#akka.event;SubchannelClassification.publish(de973626dc)" title="(event: FaultHandling.this.system.eventStream.Event)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging.Error.apply(cd2da58a36)" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Error">Error</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span>,
        <span title="String(&quot;changing Recreate into Create after &quot;)" class="string">&quot;changing Recreate into Create after &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.dungeon;FaultHandling.faultRecreate.cause" title="Throwable">cause</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.actor.dungeon;FaultHandling.faultCreate" title="()Unit">faultCreate</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="Children.scala.html#akka.actor.dungeon;Children.isNormal" title="=&gt; Boolean">isNormal</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="akka.actor.Actor" id="akka.actor.dungeon;FaultHandling.faultRecreate.failedActor">failedActor</a> = <a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.system" title="=&gt; akka.actor.ActorSystemImpl">system</a>.<a href="../ActorSystem.scala.html#akka.actor;ActorSystemImpl.settings" title="=&gt; akka.actor.ActorSystem.Settings">settings</a>.<a href="../ActorSystem.scala.html#akka.actor.ActorSystem;Settings.DebugLifecycle" title="=&gt; Boolean">DebugLifecycle</a><span class="delimiter">)</span> <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Debug" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Debug">Debug</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.faultRecreate.failedActor" title="akka.actor.Actor">failedActor</a><span class="delimiter">)</span>, <span title="String(&quot;restarting&quot;)" class="string">&quot;restarting&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.faultRecreate.failedActor" title="akka.actor.Actor">failedActor</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Option[Any]" id="akka.actor.dungeon;FaultHandling.faultRecreate.optionalMessage">optionalMessage</a> = <span title="Option[Any]" class="keyword">if</span> <span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.currentMessage" title="=&gt; akka.dispatch.Envelope">currentMessage</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="(x: Any)Some[Any]">Some</span><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.currentMessage" title="=&gt; akka.dispatch.Envelope">currentMessage</a>.<a href="../../dispatch/AbstractDispatcher.scala.html#akka.dispatch;Envelope.message" title="=&gt; Any">message</a><span class="delimiter">)</span> <span class="keyword">else</span> <span title="None.type">None</span>
        <a title="Throwable" id="akka.actor.dungeon;FaultHandling.faultRecreate.x1" class="keyword">try</a> <span class="delimiter">{</span>
          <span class="comment">// if the actor fails in preRestart, we can do nothing but log it: it’s best-effort</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.faultRecreate.failedActor" title="akka.actor.Actor">failedActor</a>.<a href="../Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#akka.actor.dungeon;FaultHandling.faultRecreate.failedActor" title="akka.actor.Actor">failedActor</a>.<a href="../Actor.scala.html#akka.actor;Actor.aroundPreRestart" title="(reason: Throwable, message: Option[Any])Unit">aroundPreRestart</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.faultRecreate.cause" title="Throwable">cause</a>, <a href="#akka.actor.dungeon;FaultHandling.faultRecreate.optionalMessage" title="Option[Any]">optionalMessage</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">catch</span> <a href="#akka.actor.dungeon;FaultHandling.handleNonFatalOrInterruptedException" title="(thunk: Throwable =&gt; Unit)util.control.Exception.Catcher[Unit]">handleNonFatalOrInterruptedException</a> <a title="util.control.Exception.Catcher[Unit]" id="akka.actor.dungeon;FaultHandling.faultRecreate.catchExpr1" class="delimiter">{</a> <a title="Throwable" id="akka.actor.dungeon;FaultHandling.faultRecreate.catchExpr1.$anonfun.e">e</a> ⇒
          <span class="keyword">val</span> <a title="akka.actor.PreRestartException" id="akka.actor.dungeon;FaultHandling.faultRecreate.catchExpr1.$anonfun.ex">ex</a> = <span title="akka.actor.PreRestartException" class="keyword">new</span> <a href="../Actor.scala.html#akka.actor;PreRestartException" title="akka.actor.PreRestartException">PreRestartException</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>, <a href="#akka.actor.dungeon;FaultHandling.faultRecreate.catchExpr1.$anonfun.e" title="Throwable">e</a>, <a href="#akka.actor.dungeon;FaultHandling.faultRecreate.cause" title="Throwable">cause</a>, <a href="#akka.actor.dungeon;FaultHandling.faultRecreate.optionalMessage" title="Option[Any]">optionalMessage</a><span class="delimiter">)</span>
          <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Error" title="(cause: Throwable, logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Error">Error</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.faultRecreate.catchExpr1.$anonfun.ex" title="akka.actor.PreRestartException">ex</a>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.faultRecreate.failedActor" title="akka.actor.Actor">failedActor</a><span class="delimiter">)</span>, <a href="#akka.actor.dungeon;FaultHandling.faultRecreate.catchExpr1.$anonfun.e" title="Throwable">e</a>.<span title="()String">getMessage</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
          <a href="../ActorCell.scala.html#akka.actor;ActorCell.clearActorFields" title="(actorInstance: akka.actor.Actor)Unit">clearActorFields</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.faultRecreate.failedActor" title="akka.actor.Actor">failedActor</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="Dispatch.scala.html#akka.actor.dungeon;Dispatch.mailbox" title="=&gt; akka.dispatch.Mailbox">mailbox</a>.<a href="../../dispatch/Mailbox.scala.html#akka.dispatch;Mailbox.isSuspended" title="=&gt; Boolean">isSuspended</a>, <span title="String(&quot;mailbox must be suspended during restart, status=&quot;)" class="string">&quot;mailbox must be suspended during restart, status=&quot;</span> <span title="(x$1: Any)String">+</span> <a href="Dispatch.scala.html#akka.actor.dungeon;Dispatch.mailbox" title="=&gt; akka.dispatch.Mailbox">mailbox</a>.<a href="../../dispatch/Mailbox.scala.html#akka.dispatch;Mailbox.status" title="=&gt; akka.dispatch.Mailbox.Status">status</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="Children.scala.html#akka.actor.dungeon;Children.setChildrenTerminationReason" title="(reason: akka.actor.dungeon.ChildrenContainer.SuspendReason)Boolean">setChildrenTerminationReason</a><span class="delimiter">(</span><a href="ChildrenContainer.scala.html#akka.actor.dungeon.ChildrenContainer" title="akka.actor.dungeon.ChildrenContainer.type">ChildrenContainer</a>.<a href="ChildrenContainer.scala.html#akka.actor.dungeon.ChildrenContainer;Recreation" title="(cause: Throwable)akka.actor.dungeon.ChildrenContainer.Recreation">Recreation</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.faultRecreate.cause" title="Throwable">cause</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.actor.dungeon;FaultHandling.finishRecreate" title="(cause: Throwable, failedActor: akka.actor.Actor)Unit">finishRecreate</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.faultRecreate.cause" title="Throwable">cause</a>, <a href="#akka.actor.dungeon;FaultHandling.faultRecreate.failedActor" title="akka.actor.Actor">failedActor</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="comment">// need to keep that suspend counter balanced</span>
      <a href="#akka.actor.dungeon;FaultHandling.faultResume" title="(causedByFailure: Throwable)Unit">faultResume</a><span class="delimiter">(</span>causedByFailure = <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="comment">/**
   * Do suspend the actor in response to a failure of a parent (i.e. the
   * “recursive suspend” feature).
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor.dungeon;FaultHandling.faultSuspend">faultSuspend</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="comment">// done always to keep that suspend counter balanced</span>
    <a href="#akka.actor.dungeon;FaultHandling.suspendNonRecursive" title="()Unit">suspendNonRecursive</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="Children.scala.html#akka.actor.dungeon;Children.suspendChildren" title="(exceptFor: Set[akka.actor.ActorRef])Unit">suspendChildren</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Do resume the actor in response to a failure.
   *
   * @param causedByFailure signifies if it was our own failure which
   *        prompted this action.
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(causedByFailure: Throwable)Unit" id="akka.actor.dungeon;FaultHandling.faultResume">faultResume</a><span class="delimiter">(</span><a title="Throwable" id="akka.actor.dungeon;FaultHandling.faultResume.causedByFailure">causedByFailure</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../ActorCell.scala.html#akka.actor;ActorCell.system" title="=&gt; akka.actor.ActorSystemImpl">system</a>.<a href="../ActorSystem.scala.html#akka.actor;ActorSystemImpl.eventStream" title="=&gt; akka.event.EventStream">eventStream</a>.<a href="../../event/EventBus.scala.html#akka.event;SubchannelClassification.publish(de973626dc)" title="(event: FaultHandling.this.system.eventStream.Event)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging.Error.apply(cd2da58a36)" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Error">Error</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span>,
        <span title="String(&quot;changing Resume into Create after &quot;)" class="string">&quot;changing Resume into Create after &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.dungeon;FaultHandling.faultResume.causedByFailure" title="Throwable">causedByFailure</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.actor.dungeon;FaultHandling.faultCreate" title="()Unit">faultCreate</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a>.<a href="../Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.actor.dungeon;FaultHandling.faultResume.causedByFailure" title="Throwable">causedByFailure</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../ActorCell.scala.html#akka.actor;ActorCell.system" title="=&gt; akka.actor.ActorSystemImpl">system</a>.<a href="../ActorSystem.scala.html#akka.actor;ActorSystemImpl.eventStream" title="=&gt; akka.event.EventStream">eventStream</a>.<a href="../../event/EventBus.scala.html#akka.event;SubchannelClassification.publish(de973626dc)" title="(event: FaultHandling.this.system.eventStream.Event)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging.Error.apply(cd2da58a36)" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Error">Error</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span>,
        <span title="String(&quot;changing Resume into Restart after &quot;)" class="string">&quot;changing Resume into Restart after &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.dungeon;FaultHandling.faultResume.causedByFailure" title="Throwable">causedByFailure</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.actor.dungeon;FaultHandling.faultRecreate" title="(cause: Throwable)Unit">faultRecreate</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.faultResume.causedByFailure" title="Throwable">causedByFailure</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="akka.actor.ActorRef" id="akka.actor.dungeon;FaultHandling.faultResume.perp">perp</a> = <a href="#akka.actor.dungeon;FaultHandling.perpetrator" title="=&gt; akka.actor.ActorRef">perpetrator</a>
      <span class="comment">// done always to keep that suspend counter balanced</span>
      <span class="comment">// must happen “atomically”</span>
      <span class="keyword">try</span> <a href="#akka.actor.dungeon;FaultHandling.resumeNonRecursive" title="()Unit">resumeNonRecursive</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">finally</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.faultResume.causedByFailure" title="Throwable">causedByFailure</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#akka.actor.dungeon;FaultHandling.clearFailed" title="()Unit">clearFailed</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="Children.scala.html#akka.actor.dungeon;Children.resumeChildren" title="(causedByFailure: Throwable, perp: akka.actor.ActorRef)Unit">resumeChildren</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.faultResume.causedByFailure" title="Throwable">causedByFailure</a>, <a href="#akka.actor.dungeon;FaultHandling.faultResume.perp" title="akka.actor.ActorRef">perp</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Do create the actor in response to a failure.
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor.dungeon;FaultHandling.faultCreate">faultCreate</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="Dispatch.scala.html#akka.actor.dungeon;Dispatch.mailbox" title="=&gt; akka.dispatch.Mailbox">mailbox</a>.<a href="../../dispatch/Mailbox.scala.html#akka.dispatch;Mailbox.isSuspended" title="=&gt; Boolean">isSuspended</a>, <span title="String(&quot;mailbox must be suspended during failed creation, status=&quot;)" class="string">&quot;mailbox must be suspended during failed creation, status=&quot;</span> <span title="(x$1: Any)String">+</span> <a href="Dispatch.scala.html#akka.actor.dungeon;Dispatch.mailbox" title="=&gt; akka.dispatch.Mailbox">mailbox</a>.<a href="../../dispatch/Mailbox.scala.html#akka.dispatch;Mailbox.status" title="=&gt; akka.dispatch.Mailbox.Status">status</a><span class="delimiter">)</span>
    <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.perpetrator" title="=&gt; akka.actor.ActorRef">perpetrator</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a><span class="delimiter">)</span>

    <a href="ReceiveTimeout.scala.html#akka.actor.dungeon;ReceiveTimeout.setReceiveTimeout" title="(timeout: scala.concurrent.duration.Duration)Unit">setReceiveTimeout</a><span class="delimiter">(</span><span title="scala.concurrent.duration.Duration.type">Duration</span>.<span title="=&gt; scala.concurrent.duration.Duration.Infinite">Undefined</span><span class="delimiter">)</span>
    <a href="ReceiveTimeout.scala.html#akka.actor.dungeon;ReceiveTimeout.cancelReceiveTimeout" title="()Unit">cancelReceiveTimeout</a>

    <span class="comment">// stop all children, which will turn childrenRefs into TerminatingChildrenContainer (if there are children)</span>
    <a href="Children.scala.html#akka.actor.dungeon;Children.children" title="=&gt; scala.collection.immutable.Iterable[akka.actor.ActorRef]">children</a> <span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span> <a href="Children.scala.html#akka.actor.dungeon;Children.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="Children.scala.html#akka.actor.dungeon;Children.setChildrenTerminationReason" title="(reason: akka.actor.dungeon.ChildrenContainer.SuspendReason)Boolean">setChildrenTerminationReason</a><span class="delimiter">(</span><a href="ChildrenContainer.scala.html#akka.actor.dungeon.ChildrenContainer" title="akka.actor.dungeon.ChildrenContainer.type">ChildrenContainer</a>.<a href="ChildrenContainer.scala.html#akka.actor.dungeon.ChildrenContainer;Creation" title="()akka.actor.dungeon.ChildrenContainer.Creation">Creation</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.actor.dungeon;FaultHandling.finishCreate" title="()Unit">finishCreate</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor.dungeon;FaultHandling.finishCreate">finishCreate</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">try</span> <a href="#akka.actor.dungeon;FaultHandling.resumeNonRecursive" title="()Unit">resumeNonRecursive</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">finally</span> <a href="#akka.actor.dungeon;FaultHandling.clearFailed" title="()Unit">clearFailed</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a title="Throwable" id="akka.actor.dungeon;FaultHandling.finishCreate.x2" class="keyword">try</a> <a href="../ActorCell.scala.html#akka.actor;ActorCell.create" title="(failure: Option[akka.actor.ActorInitializationException])Unit">create</a><span class="delimiter">(</span><span title="None.type">None</span><span class="delimiter">)</span>
    <span class="keyword">catch</span> <a href="#akka.actor.dungeon;FaultHandling.handleNonFatalOrInterruptedException" title="(thunk: Throwable =&gt; Unit)util.control.Exception.Catcher[Unit]">handleNonFatalOrInterruptedException</a> <a title="util.control.Exception.Catcher[Unit]" id="akka.actor.dungeon;FaultHandling.finishCreate.catchExpr2" class="delimiter">{</a> <a title="Throwable" id="akka.actor.dungeon;FaultHandling.finishCreate.catchExpr2.$anonfun.e">e</a> ⇒
      <a href="#akka.actor.dungeon;FaultHandling.handleInvokeFailure" title="(childrenNotToSuspend: scala.collection.immutable.Iterable[akka.actor.ActorRef], t: Throwable)Unit">handleInvokeFailure</a><span class="delimiter">(</span><span title="scala.collection.immutable.Nil.type">Nil</span>, <a href="#akka.actor.dungeon;FaultHandling.finishCreate.catchExpr2.$anonfun.e" title="Throwable">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor.dungeon;FaultHandling.terminate">terminate</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="ReceiveTimeout.scala.html#akka.actor.dungeon;ReceiveTimeout.setReceiveTimeout" title="(timeout: scala.concurrent.duration.Duration)Unit">setReceiveTimeout</a><span class="delimiter">(</span><span title="scala.concurrent.duration.Duration.type">Duration</span>.<span title="=&gt; scala.concurrent.duration.Duration.Infinite">Undefined</span><span class="delimiter">)</span>
    <a href="ReceiveTimeout.scala.html#akka.actor.dungeon;ReceiveTimeout.cancelReceiveTimeout" title="()Unit">cancelReceiveTimeout</a>

    <span class="comment">// prevent Deadletter(Terminated) messages</span>
    <a href="DeathWatch.scala.html#akka.actor.dungeon;DeathWatch.unwatchWatchedActors" title="(actor: akka.actor.Actor)Unit">unwatchWatchedActors</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span>

    <span class="comment">// stop all children, which will turn childrenRefs into TerminatingChildrenContainer (if there are children)</span>
    <a href="Children.scala.html#akka.actor.dungeon;Children.children" title="=&gt; scala.collection.immutable.Iterable[akka.actor.ActorRef]">children</a> <span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span> <a href="Children.scala.html#akka.actor.dungeon;Children.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.systemImpl" title="=&gt; akka.actor.ActorSystemImpl">systemImpl</a>.<a href="../ActorSystem.scala.html#akka.actor;ActorSystemImpl.aborting" title="=&gt; Boolean">aborting</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// separate iteration because this is a very rare case that should not penalize normal operation</span>
      <a href="Children.scala.html#akka.actor.dungeon;Children.children" title="=&gt; scala.collection.immutable.Iterable[akka.actor.ActorRef]">children</a> <span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span> <a href="#akka.actor.dungeon;FaultHandling.terminate.$anonfun.x0$1" title="Unit" class="delimiter">{</a>
        <span class="keyword">case</span> <a title="actor extends akka.actor.ActorRef with akka.actor.ActorRefScope" id="akka.actor.dungeon;FaultHandling.terminate.$anonfun.ref">ref</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRefScope" title="akka.actor.ActorRefScope">ActorRefScope</a> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#akka.actor.dungeon;FaultHandling.terminate.$anonfun.ref" title="actor extends akka.actor.ActorRef with akka.actor.ActorRefScope">ref</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRefScope.isLocal" title="=&gt; Boolean">isLocal</a> ⇒ <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;InternalActorRef.sendSystemMessage" title="(message: akka.dispatch.sysmsg.SystemMessage)Unit">sendSystemMessage</a><span class="delimiter">(</span><a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;DeathWatchNotification" title="(actor: akka.actor.ActorRef, existenceConfirmed: Boolean, addressTerminated: Boolean)akka.dispatch.sysmsg.DeathWatchNotification">DeathWatchNotification</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.terminate.$anonfun.ref" title="actor extends akka.actor.ActorRef with akka.actor.ActorRefScope">ref</a>, <span title="Boolean(true)" class="keyword">true</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> _                                  ⇒
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="Boolean" id="akka.actor.dungeon;FaultHandling.terminate.wasTerminating">wasTerminating</a> = <a href="Children.scala.html#akka.actor.dungeon;Children.isTerminating" title="=&gt; Boolean">isTerminating</a>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="Children.scala.html#akka.actor.dungeon;Children.setChildrenTerminationReason" title="(reason: akka.actor.dungeon.ChildrenContainer.SuspendReason)Boolean">setChildrenTerminationReason</a><span class="delimiter">(</span><a href="ChildrenContainer.scala.html#akka.actor.dungeon.ChildrenContainer" title="akka.actor.dungeon.ChildrenContainer.type">ChildrenContainer</a>.<a href="ChildrenContainer.scala.html#akka.actor.dungeon.ChildrenContainer.Termination" title="akka.actor.dungeon.ChildrenContainer.Termination.type">Termination</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.dungeon;FaultHandling.terminate.wasTerminating" title="Boolean">wasTerminating</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">// do not process normal messages while waiting for all children to terminate</span>
        <a href="#akka.actor.dungeon;FaultHandling.suspendNonRecursive" title="()Unit">suspendNonRecursive</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="comment">// do not propagate failures during shutdown to the supervisor</span>
        <a href="#akka.actor.dungeon;FaultHandling.setFailed" title="(perpetrator: akka.actor.ActorRef)Unit">setFailed</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.system" title="=&gt; akka.actor.ActorSystemImpl">system</a>.<a href="../ActorSystem.scala.html#akka.actor;ActorSystemImpl.settings" title="=&gt; akka.actor.ActorSystem.Settings">settings</a>.<a href="../ActorSystem.scala.html#akka.actor.ActorSystem;Settings.DebugLifecycle" title="=&gt; Boolean">DebugLifecycle</a><span class="delimiter">)</span> <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Debug" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Debug">Debug</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span>, <span title="String(&quot;stopping&quot;)" class="string">&quot;stopping&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="Children.scala.html#akka.actor.dungeon;Children.setTerminated" title="()Unit">setTerminated</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#akka.actor.dungeon;FaultHandling.finishTerminate" title="()Unit">finishTerminate</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(childrenNotToSuspend: scala.collection.immutable.Iterable[akka.actor.ActorRef], t: Throwable)Unit" id="akka.actor.dungeon;FaultHandling.handleInvokeFailure">handleInvokeFailure</a><span class="delimiter">(</span><a title="scala.collection.immutable.Iterable[akka.actor.ActorRef]" id="akka.actor.dungeon;FaultHandling.handleInvokeFailure.childrenNotToSuspend">childrenNotToSuspend</a>: immutable.<span title="scala.collection.immutable.Iterable[akka.actor.ActorRef]">Iterable</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span>, <a title="Throwable" id="akka.actor.dungeon;FaultHandling.handleInvokeFailure.t">t</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="comment">// prevent any further messages to be processed until the actor has been restarted</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.dungeon;FaultHandling.isFailed" title="=&gt; Boolean">isFailed</a><span class="delimiter">)</span> <a title="Throwable" id="akka.actor.dungeon;FaultHandling.handleInvokeFailure.x3" class="keyword">try</a> <span class="delimiter">{</span>
      <a href="#akka.actor.dungeon;FaultHandling.suspendNonRecursive" title="()Unit">suspendNonRecursive</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="comment">// suspend children</span>
      <span class="keyword">val</span> <a title="Set[akka.actor.ActorRef]" id="akka.actor.dungeon;FaultHandling.handleInvokeFailure.skip">skip</a>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <a href="../ActorCell.scala.html#akka.actor;ActorCell.currentMessage" title="=&gt; akka.dispatch.Envelope">currentMessage</a> <span title="Set[akka.actor.ActorRef]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Envelope<span class="delimiter">(</span>Failed<span class="delimiter">(</span>_, _, _<span class="delimiter">)</span>, <a title="akka.actor.ActorRef" id="akka.actor.dungeon;FaultHandling.handleInvokeFailure.skip.child">child</a><span class="delimiter">)</span> ⇒ <span class="delimiter">{</span> <a href="#akka.actor.dungeon;FaultHandling.setFailed" title="(perpetrator: akka.actor.ActorRef)Unit">setFailed</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.handleInvokeFailure.skip.child" title="akka.actor.ActorRef">child</a><span class="delimiter">)</span>; <span title="(elems: akka.actor.ActorRef*)scala.collection.immutable.Set[akka.actor.ActorRef]">Set</span><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.handleInvokeFailure.skip.child" title="akka.actor.ActorRef">child</a><span class="delimiter">)</span> <span class="delimiter">}</span>
        <span class="keyword">case</span> _                                ⇒ <span class="delimiter">{</span> <a href="#akka.actor.dungeon;FaultHandling.setFailed" title="(perpetrator: akka.actor.ActorRef)Unit">setFailed</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a><span class="delimiter">)</span>; <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.actor.ActorRef]">empty</span> <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="Children.scala.html#akka.actor.dungeon;Children.suspendChildren" title="(exceptFor: Set[akka.actor.ActorRef])Unit">suspendChildren</a><span class="delimiter">(</span>exceptFor = <a href="#akka.actor.dungeon;FaultHandling.handleInvokeFailure.skip" title="Set[akka.actor.ActorRef]">skip</a> <span title="(elems: scala.collection.GenTraversableOnce[akka.actor.ActorRef])scala.collection.immutable.Set[akka.actor.ActorRef]">++</span> <a href="#akka.actor.dungeon;FaultHandling.handleInvokeFailure.childrenNotToSuspend" title="scala.collection.immutable.Iterable[akka.actor.ActorRef]">childrenNotToSuspend</a><span class="delimiter">)</span>
      <a href="#akka.actor.dungeon;FaultHandling.handleInvokeFailure.t" title="Throwable">t</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="comment">// tell supervisor</span>
        <span class="keyword">case</span> _: <span title="InterruptedException">InterruptedException</span> ⇒
          <span class="comment">// ➡➡➡ NEVER SEND THE SAME SYSTEM MESSAGE OBJECT TO TWO ACTORS ⬅⬅⬅</span>
          <a href="../ActorCell.scala.html#akka.actor;ActorCell.parent" title="=&gt; akka.actor.InternalActorRef">parent</a>.<a href="../ActorRef.scala.html#akka.actor;InternalActorRef.sendSystemMessage" title="(message: akka.dispatch.sysmsg.SystemMessage)Unit">sendSystemMessage</a><span class="delimiter">(</span><a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Failed" title="(child: akka.actor.ActorRef, cause: Throwable, uid: Int)akka.dispatch.sysmsg.Failed">Failed</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>, <span title="akka.actor.ActorInterruptedException" class="keyword">new</span> <a href="../Actor.scala.html#akka.actor;ActorInterruptedException" title="akka.actor.ActorInterruptedException">ActorInterruptedException</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.handleInvokeFailure.t" title="Throwable">t</a><span class="delimiter">)</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.uid" title="=&gt; Int">uid</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> _ ⇒
          <span class="comment">// ➡➡➡ NEVER SEND THE SAME SYSTEM MESSAGE OBJECT TO TWO ACTORS ⬅⬅⬅</span>
          <a href="../ActorCell.scala.html#akka.actor;ActorCell.parent" title="=&gt; akka.actor.InternalActorRef">parent</a>.<a href="../ActorRef.scala.html#akka.actor;InternalActorRef.sendSystemMessage" title="(message: akka.dispatch.sysmsg.SystemMessage)Unit">sendSystemMessage</a><span class="delimiter">(</span><a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Failed" title="(child: akka.actor.ActorRef, cause: Throwable, uid: Int)akka.dispatch.sysmsg.Failed">Failed</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>, <a href="#akka.actor.dungeon;FaultHandling.handleInvokeFailure.t" title="Throwable">t</a>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.uid" title="=&gt; Int">uid</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <a href="#akka.actor.dungeon;FaultHandling.handleNonFatalOrInterruptedException" title="(thunk: Throwable =&gt; Unit)util.control.Exception.Catcher[Unit]">handleNonFatalOrInterruptedException</a> <a title="util.control.Exception.Catcher[Unit]" id="akka.actor.dungeon;FaultHandling.handleInvokeFailure.catchExpr3" class="delimiter">{</a> <a title="Throwable" id="akka.actor.dungeon;FaultHandling.handleInvokeFailure.catchExpr3.$anonfun.e">e</a> ⇒
      <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Error" title="(cause: Throwable, logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Error">Error</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.handleInvokeFailure.catchExpr3.$anonfun.e" title="Throwable">e</a>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span>,
        <span title="String(&quot;emergency stop: exception in failure handling for &quot;)" class="string">&quot;emergency stop: exception in failure handling for &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.dungeon;FaultHandling.handleInvokeFailure.t" title="Throwable">t</a>.<span title="()Class[_]">getClass</span> <span title="(x$1: Any)String">+</span> <a href="../../event/Logging.scala.html#akka.event.Logging" title="akka.event.Logging.type">Logging</a>.<a href="../../event/Logging.scala.html#akka.event.Logging.stackTraceFor" title="(e: Throwable)String">stackTraceFor</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.handleInvokeFailure.t" title="Throwable">t</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">try</span> <a href="Children.scala.html#akka.actor.dungeon;Children.children" title="=&gt; scala.collection.immutable.Iterable[akka.actor.ActorRef]">children</a> <span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span> <a href="Children.scala.html#akka.actor.dungeon;Children.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a>
      <span class="keyword">finally</span> <a href="#akka.actor.dungeon;FaultHandling.finishTerminate" title="()Unit">finishTerminate</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor.dungeon;FaultHandling.finishTerminate">finishTerminate</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="akka.actor.Actor" id="akka.actor.dungeon;FaultHandling.finishTerminate.a">a</a> = <a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a>
    <span class="comment">/* The following order is crucial for things to work properly. Only change this if you're very confident and lucky.
     *
     * Please note that if a parent is also a watcher then ChildTerminated and Terminated must be processed in this
     * specific order.
     */</span>
    <a title="Throwable" id="akka.actor.dungeon;FaultHandling.finishTerminate.x4" class="keyword">try</a> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.finishTerminate.a" title="akka.actor.Actor">a</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#akka.actor.dungeon;FaultHandling.finishTerminate.a" title="akka.actor.Actor">a</a>.<a href="../Actor.scala.html#akka.actor;Actor.aroundPostStop" title="()Unit">aroundPostStop</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">catch</span> <a href="#akka.actor.dungeon;FaultHandling.handleNonFatalOrInterruptedException" title="(thunk: Throwable =&gt; Unit)util.control.Exception.Catcher[Unit]">handleNonFatalOrInterruptedException</a> <a title="util.control.Exception.Catcher[Unit]" id="akka.actor.dungeon;FaultHandling.finishTerminate.catchExpr4" class="delimiter">{</a> <a title="Throwable" id="akka.actor.dungeon;FaultHandling.finishTerminate.catchExpr4.$anonfun.e">e</a> ⇒ <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Error" title="(cause: Throwable, logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Error">Error</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.finishTerminate.catchExpr4.$anonfun.e" title="Throwable">e</a>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.finishTerminate.a" title="akka.actor.Actor">a</a><span class="delimiter">)</span>, <a href="#akka.actor.dungeon;FaultHandling.finishTerminate.catchExpr4.$anonfun.e" title="Throwable">e</a>.<span title="()String">getMessage</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="keyword">finally</span> <span class="keyword">try</span> <a href="../ActorCell.scala.html#akka.actor;ActorCell.dispatcher" title="=&gt; akka.dispatch.MessageDispatcher">dispatcher</a>.<a href="../../dispatch/AbstractDispatcher.scala.html#akka.dispatch;MessageDispatcher.detach" title="(actor: akka.actor.ActorCell)Unit">detach</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling" title="akka.actor.ActorCell" class="keyword">this</a><span class="delimiter">)</span>
    <span class="keyword">finally</span> <span class="keyword">try</span> <a href="../ActorCell.scala.html#akka.actor;ActorCell.parent" title="=&gt; akka.actor.InternalActorRef">parent</a>.<a href="../ActorRef.scala.html#akka.actor;InternalActorRef.sendSystemMessage" title="(message: akka.dispatch.sysmsg.SystemMessage)Unit">sendSystemMessage</a><span class="delimiter">(</span><a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;DeathWatchNotification" title="(actor: akka.actor.ActorRef, existenceConfirmed: Boolean, addressTerminated: Boolean)akka.dispatch.sysmsg.DeathWatchNotification">DeathWatchNotification</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>, existenceConfirmed = <span title="Boolean(true)" class="keyword">true</span>, addressTerminated = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">finally</span> <span class="keyword">try</span> <a href="DeathWatch.scala.html#akka.actor.dungeon;DeathWatch.tellWatchersWeDied" title="()Unit">tellWatchersWeDied</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">finally</span> <span class="keyword">try</span> <a href="DeathWatch.scala.html#akka.actor.dungeon;DeathWatch.unwatchWatchedActors" title="(actor: akka.actor.Actor)Unit">unwatchWatchedActors</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.finishTerminate.a" title="akka.actor.Actor">a</a><span class="delimiter">)</span> <span class="comment">// stay here as we expect an emergency stop from handleInvokeFailure</span>
    <span class="keyword">finally</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.system" title="=&gt; akka.actor.ActorSystemImpl">system</a>.<a href="../ActorSystem.scala.html#akka.actor;ActorSystemImpl.settings" title="=&gt; akka.actor.ActorSystem.Settings">settings</a>.<a href="../ActorSystem.scala.html#akka.actor.ActorSystem;Settings.DebugLifecycle" title="=&gt; Boolean">DebugLifecycle</a><span class="delimiter">)</span>
        <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Debug" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Debug">Debug</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.finishTerminate.a" title="akka.actor.Actor">a</a><span class="delimiter">)</span>, <span title="String(&quot;stopped&quot;)" class="string">&quot;stopped&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="../ActorCell.scala.html#akka.actor;ActorCell.clearActorFields" title="(actorInstance: akka.actor.Actor)Unit">clearActorFields</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.finishTerminate.a" title="akka.actor.Actor">a</a><span class="delimiter">)</span>
      <a href="../ActorCell.scala.html#akka.actor;ActorCell.clearActorCellFields" title="(cell: akka.actor.ActorCell)Unit">clearActorCellFields</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling" title="akka.actor.ActorCell" class="keyword">this</a><span class="delimiter">)</span>
      <a href="../ActorCell.scala.html#akka.actor;ActorCell.actor_=" title="(a: akka.actor.Actor)Unit">actor</a> = <span title="Null(null)" class="keyword">null</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(cause: Throwable, failedActor: akka.actor.Actor)Unit" id="akka.actor.dungeon;FaultHandling.finishRecreate">finishRecreate</a><span class="delimiter">(</span><a title="Throwable" id="akka.actor.dungeon;FaultHandling.finishRecreate.cause">cause</a>: <span title="Throwable">Throwable</span>, <a title="akka.actor.Actor" id="akka.actor.dungeon;FaultHandling.finishRecreate.failedActor">failedActor</a>: <a href="../Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="comment">// need to keep a snapshot of the surviving children before the new actor instance creates new ones</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.Iterable[akka.actor.ActorRef]" id="akka.actor.dungeon;FaultHandling.finishRecreate.survivors">survivors</a> = <a href="Children.scala.html#akka.actor.dungeon;Children.children" title="=&gt; scala.collection.immutable.Iterable[akka.actor.ActorRef]">children</a>

    <a title="Throwable" id="akka.actor.dungeon;FaultHandling.finishRecreate.x6" class="keyword">try</a> <span class="delimiter">{</span>
      <span class="keyword">try</span> <a href="#akka.actor.dungeon;FaultHandling.resumeNonRecursive" title="()Unit">resumeNonRecursive</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">finally</span> <a href="#akka.actor.dungeon;FaultHandling.clearFailed" title="()Unit">clearFailed</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="comment">// must happen in any case, so that failure is propagated</span>

      <span class="keyword">val</span> <a title="akka.actor.Actor" id="akka.actor.dungeon;FaultHandling.finishRecreate.freshActor">freshActor</a> = <a href="../ActorCell.scala.html#akka.actor;ActorCell.newActor" title="()akka.actor.Actor">newActor</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="../ActorCell.scala.html#akka.actor;ActorCell.actor_=" title="(a: akka.actor.Actor)Unit">actor</a> = <a href="#akka.actor.dungeon;FaultHandling.finishRecreate.freshActor" title="akka.actor.Actor">freshActor</a> <span class="comment">// this must happen before postRestart has a chance to fail</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.finishRecreate.freshActor" title="akka.actor.Actor">freshActor</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#akka.actor.dungeon;FaultHandling.finishRecreate.failedActor" title="akka.actor.Actor">failedActor</a><span class="delimiter">)</span> <a href="../ActorCell.scala.html#akka.actor;ActorCell.setActorFields" title="(actorInstance: akka.actor.Actor, context: akka.actor.ActorContext, self: akka.actor.ActorRef)Unit">setActorFields</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.finishRecreate.freshActor" title="akka.actor.Actor">freshActor</a>, <a href="#akka.actor.dungeon;FaultHandling" title="akka.actor.ActorCell" class="keyword">this</a>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a><span class="delimiter">)</span> <span class="comment">// If the creator returns the same instance, we need to restore our nulled out fields.</span>

      <a href="#akka.actor.dungeon;FaultHandling.finishRecreate.freshActor" title="akka.actor.Actor">freshActor</a>.<a href="../Actor.scala.html#akka.actor;Actor.aroundPostRestart" title="(reason: Throwable)Unit">aroundPostRestart</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.finishRecreate.cause" title="Throwable">cause</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.system" title="=&gt; akka.actor.ActorSystemImpl">system</a>.<a href="../ActorSystem.scala.html#akka.actor;ActorSystemImpl.settings" title="=&gt; akka.actor.ActorSystem.Settings">settings</a>.<a href="../ActorSystem.scala.html#akka.actor.ActorSystem;Settings.DebugLifecycle" title="=&gt; Boolean">DebugLifecycle</a><span class="delimiter">)</span> <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Debug" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Debug">Debug</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.finishRecreate.freshActor" title="akka.actor.Actor">freshActor</a><span class="delimiter">)</span>, <span title="String(&quot;restarted&quot;)" class="string">&quot;restarted&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="comment">// only after parent is up and running again do restart the children which were not stopped</span>
      <a href="#akka.actor.dungeon;FaultHandling.finishRecreate.survivors" title="scala.collection.immutable.Iterable[akka.actor.ActorRef]">survivors</a> <span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span> <span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.dungeon;FaultHandling.finishRecreate.$anonfun.child">child</a> ⇒
        <a title="Throwable" id="akka.actor.dungeon;FaultHandling.finishRecreate.$anonfun.x5" class="keyword">try</a> <a href="#akka.actor.dungeon;FaultHandling.finishRecreate.$anonfun.child" title="akka.actor.ActorRef">child</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.actor.InternalActorRef" class="delimiter">[</span><a href="../ActorRef.scala.html#akka.actor;InternalActorRef" title="akka.actor.InternalActorRef">InternalActorRef</a><span class="delimiter">]</span>.<a href="../ActorRef.scala.html#akka.actor;InternalActorRef.restart" title="(cause: Throwable)Unit">restart</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.finishRecreate.cause" title="Throwable">cause</a><span class="delimiter">)</span>
        <span class="keyword">catch</span> <a href="#akka.actor.dungeon;FaultHandling.handleNonFatalOrInterruptedException" title="(thunk: Throwable =&gt; Unit)util.control.Exception.Catcher[Unit]">handleNonFatalOrInterruptedException</a> <a title="util.control.Exception.Catcher[Unit]" id="akka.actor.dungeon;FaultHandling.finishRecreate.$anonfun.catchExpr5" class="delimiter">{</a> <a title="Throwable" id="akka.actor.dungeon;FaultHandling.finishRecreate.$anonfun.catchExpr5.$anonfun.e">e</a> ⇒
          <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Error" title="(cause: Throwable, logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Error">Error</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.finishRecreate.$anonfun.catchExpr5.$anonfun.e" title="Throwable">e</a>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.finishRecreate.freshActor" title="akka.actor.Actor">freshActor</a><span class="delimiter">)</span>, <span title="String(&quot;restarting &quot;)" class="string">&quot;restarting &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.dungeon;FaultHandling.finishRecreate.$anonfun.child" title="akka.actor.ActorRef">child</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <a href="#akka.actor.dungeon;FaultHandling.handleNonFatalOrInterruptedException" title="(thunk: Throwable =&gt; Unit)util.control.Exception.Catcher[Unit]">handleNonFatalOrInterruptedException</a> <a title="util.control.Exception.Catcher[Unit]" id="akka.actor.dungeon;FaultHandling.finishRecreate.catchExpr6" class="delimiter">{</a> <a title="Throwable" id="akka.actor.dungeon;FaultHandling.finishRecreate.catchExpr6.$anonfun.e">e</a> ⇒
      <a href="../ActorCell.scala.html#akka.actor;ActorCell.clearActorFields" title="(actorInstance: akka.actor.Actor)Unit">clearActorFields</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span> <span class="comment">// in order to prevent preRestart() from happening again</span>
      <a href="#akka.actor.dungeon;FaultHandling.handleInvokeFailure" title="(childrenNotToSuspend: scala.collection.immutable.Iterable[akka.actor.ActorRef], t: Throwable)Unit">handleInvokeFailure</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.finishRecreate.survivors" title="scala.collection.immutable.Iterable[akka.actor.ActorRef]">survivors</a>, <span title="akka.actor.PostRestartException" class="keyword">new</span> <a href="../Actor.scala.html#akka.actor;PostRestartException" title="akka.actor.PostRestartException">PostRestartException</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>, <a href="#akka.actor.dungeon;FaultHandling.finishRecreate.catchExpr6.$anonfun.e" title="Throwable">e</a>, <a href="#akka.actor.dungeon;FaultHandling.finishRecreate.cause" title="Throwable">cause</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(f: akka.dispatch.sysmsg.Failed)Unit" id="akka.actor.dungeon;FaultHandling.handleFailure">handleFailure</a><span class="delimiter">(</span><a title="akka.dispatch.sysmsg.Failed" id="akka.actor.dungeon;FaultHandling.handleFailure.f">f</a>: <a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Failed" title="akka.dispatch.sysmsg.Failed">Failed</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="../ActorCell.scala.html#akka.actor;ActorCell.currentMessage_=" title="(x$1: akka.dispatch.Envelope)Unit">currentMessage</a> = <a href="../../dispatch/AbstractDispatcher.scala.html#akka.dispatch.Envelope.apply(fd4a9d0721)" title="(message: Any, sender: akka.actor.ActorRef, system: akka.actor.ActorSystem)akka.dispatch.Envelope">Envelope</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.handleFailure.f" title="akka.dispatch.sysmsg.Failed">f</a>, <a href="#akka.actor.dungeon;FaultHandling.handleFailure.f" title="akka.dispatch.sysmsg.Failed">f</a>.<a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Failed.child" title="=&gt; akka.actor.ActorRef">child</a>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.system" title="=&gt; akka.actor.ActorSystemImpl">system</a><span class="delimiter">)</span>
    <a href="Children.scala.html#akka.actor.dungeon;Children.getChildByRef" title="(ref: akka.actor.ActorRef)Option[akka.actor.ChildRestartStats]">getChildByRef</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.handleFailure.f" title="akka.dispatch.sysmsg.Failed">f</a>.<a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Failed.child" title="=&gt; akka.actor.ActorRef">child</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="comment">/*
       * only act upon the failure, if it comes from a currently known child;
       * the UID protects against reception of a Failed from a child which was
       * killed in preRestart and re-created in postRestart
       */</span>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="akka.actor.ChildRestartStats">stats</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="akka.actor.ChildRestartStats">stats</span>.<a href="../FaultHandling.scala.html#akka.actor;ChildRestartStats.uid" title="=&gt; Int">uid</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.actor.dungeon;FaultHandling.handleFailure.f" title="akka.dispatch.sysmsg.Failed">f</a>.<a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Failed.uid" title="=&gt; Int">uid</a> ⇒
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a>.<a href="../Actor.scala.html#akka.actor;Actor.supervisorStrategy" title="=&gt; akka.actor.SupervisorStrategy">supervisorStrategy</a>.<a href="../FaultHandling.scala.html#akka.actor;SupervisorStrategy.handleFailure" title="(context: akka.actor.ActorContext, child: akka.actor.ActorRef, cause: Throwable, stats: akka.actor.ChildRestartStats, children: Iterable[akka.actor.ChildRestartStats])Boolean">handleFailure</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling" title="akka.actor.ActorCell" class="keyword">this</a>, <a href="#akka.actor.dungeon;FaultHandling.handleFailure.f" title="akka.dispatch.sysmsg.Failed">f</a>.<a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Failed.child" title="=&gt; akka.actor.ActorRef">child</a>, <a href="#akka.actor.dungeon;FaultHandling.handleFailure.f" title="akka.dispatch.sysmsg.Failed">f</a>.<a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Failed.cause" title="=&gt; Throwable">cause</a>, <span title="akka.actor.ChildRestartStats">stats</span>, <a href="Children.scala.html#akka.actor.dungeon;Children.getAllChildStats" title="=&gt; scala.collection.immutable.Iterable[akka.actor.ChildRestartStats]">getAllChildStats</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <a href="#akka.actor.dungeon;FaultHandling.handleFailure.f" title="akka.dispatch.sysmsg.Failed">f</a>.<a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Failed.cause" title="=&gt; Throwable">cause</a>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="akka.actor.ChildRestartStats">stats</span><span class="delimiter">)</span> ⇒
        <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Debug" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Debug">Debug</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span>,
          <span title="String(&quot;dropping Failed(&quot;)" class="string">&quot;dropping Failed(&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.dungeon;FaultHandling.handleFailure.f" title="akka.dispatch.sysmsg.Failed">f</a>.<a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Failed.cause" title="=&gt; Throwable">cause</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;) from old child &quot;)" class="string">&quot;) from old child &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.dungeon;FaultHandling.handleFailure.f" title="akka.dispatch.sysmsg.Failed">f</a>.<a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Failed.child" title="=&gt; akka.actor.ActorRef">child</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; (uid=&quot;)" class="string">&quot; (uid=&quot;</span> <span title="(x$1: Any)String">+</span> <span title="akka.actor.ChildRestartStats">stats</span>.<a href="../FaultHandling.scala.html#akka.actor;ChildRestartStats.uid" title="=&gt; Int">uid</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; != &quot;)" class="string">&quot; != &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.dungeon;FaultHandling.handleFailure.f" title="akka.dispatch.sysmsg.Failed">f</a>.<a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Failed.uid" title="=&gt; Int">uid</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="None.type">None</span> ⇒
        <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Debug" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Debug">Debug</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span>, <span title="String(&quot;dropping Failed(&quot;)" class="string">&quot;dropping Failed(&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.dungeon;FaultHandling.handleFailure.f" title="akka.dispatch.sysmsg.Failed">f</a>.<a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Failed.cause" title="=&gt; Throwable">cause</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;) from unknown child &quot;)" class="string">&quot;) from unknown child &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.dungeon;FaultHandling.handleFailure.f" title="akka.dispatch.sysmsg.Failed">f</a>.<a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Failed.child" title="=&gt; akka.actor.ActorRef">child</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(child: akka.actor.ActorRef)Unit" id="akka.actor.dungeon;FaultHandling.handleChildTerminated">handleChildTerminated</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.dungeon;FaultHandling.handleChildTerminated.child">child</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Option[akka.actor.dungeon.ChildrenContainer.SuspendReason]" id="akka.actor.dungeon;FaultHandling.handleChildTerminated.status">status</a> = <a href="Children.scala.html#akka.actor.dungeon;Children.removeChildAndGetStateChange" title="(child: akka.actor.ActorRef)Option[akka.actor.dungeon.ChildrenContainer.SuspendReason]">removeChildAndGetStateChange</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.handleChildTerminated.child" title="akka.actor.ActorRef">child</a><span class="delimiter">)</span>
    <span class="comment">/*
     * if this fails, we do nothing in case of terminating/restarting state,
     * otherwise tell the supervisor etc. (in that second case, the match
     * below will hit the empty default case, too)
     */</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a title="Throwable" id="akka.actor.dungeon;FaultHandling.handleChildTerminated.x7" class="keyword">try</a> <a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a>.<a href="../Actor.scala.html#akka.actor;Actor.supervisorStrategy" title="=&gt; akka.actor.SupervisorStrategy">supervisorStrategy</a>.<a href="../FaultHandling.scala.html#akka.actor;SupervisorStrategy.handleChildTerminated" title="(context: akka.actor.ActorContext, child: akka.actor.ActorRef, children: Iterable[akka.actor.ActorRef])Unit">handleChildTerminated</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling" title="akka.actor.ActorCell" class="keyword">this</a>, <a href="#akka.actor.dungeon;FaultHandling.handleChildTerminated.child" title="akka.actor.ActorRef">child</a>, <a href="Children.scala.html#akka.actor.dungeon;Children.children" title="=&gt; scala.collection.immutable.Iterable[akka.actor.ActorRef]">children</a><span class="delimiter">)</span>
      <span class="keyword">catch</span> <a href="#akka.actor.dungeon;FaultHandling.handleNonFatalOrInterruptedException" title="(thunk: Throwable =&gt; Unit)util.control.Exception.Catcher[Unit]">handleNonFatalOrInterruptedException</a> <a title="util.control.Exception.Catcher[Unit]" id="akka.actor.dungeon;FaultHandling.handleChildTerminated.catchExpr7" class="delimiter">{</a> <a title="Throwable" id="akka.actor.dungeon;FaultHandling.handleChildTerminated.catchExpr7.$anonfun.e">e</a> ⇒
        <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Error" title="(cause: Throwable, logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Error">Error</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.handleChildTerminated.catchExpr7.$anonfun.e" title="Throwable">e</a>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span>, <span title="String(&quot;handleChildTerminated failed&quot;)" class="string">&quot;handleChildTerminated failed&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.actor.dungeon;FaultHandling.handleInvokeFailure" title="(childrenNotToSuspend: scala.collection.immutable.Iterable[akka.actor.ActorRef], t: Throwable)Unit">handleInvokeFailure</a><span class="delimiter">(</span><span title="scala.collection.immutable.Nil.type">Nil</span>, <a href="#akka.actor.dungeon;FaultHandling.handleChildTerminated.catchExpr7.$anonfun.e" title="Throwable">e</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="comment">/*
     * if the removal changed the state of the (terminating) children container,
     * then we are continuing the previously suspended recreate/create/terminate action
     */</span>
    <a href="#akka.actor.dungeon;FaultHandling.handleChildTerminated.status" title="Option[akka.actor.dungeon.ChildrenContainer.SuspendReason]">status</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="akka.actor.dungeon.ChildrenContainer.Recreation">c</span> @ ChildrenContainer.Recreation<span class="delimiter">(</span><a title="Throwable" id="akka.actor.dungeon;FaultHandling.handleChildTerminated.cause">cause</a><span class="delimiter">)</span><span class="delimiter">)</span> ⇒ <a href="#akka.actor.dungeon;FaultHandling.finishRecreate" title="(cause: Throwable, failedActor: akka.actor.Actor)Unit">finishRecreate</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;FaultHandling.handleChildTerminated.cause" title="Throwable">cause</a>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="akka.actor.dungeon.ChildrenContainer.Creation">c</span> @ ChildrenContainer.Creation<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒ <a href="#akka.actor.dungeon;FaultHandling.finishCreate" title="()Unit">finishCreate</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><a href="ChildrenContainer.scala.html#akka.actor.dungeon.ChildrenContainer" title="akka.actor.dungeon.ChildrenContainer.type">ChildrenContainer</a>.<a href="ChildrenContainer.scala.html#akka.actor.dungeon.ChildrenContainer.Termination" title="akka.actor.dungeon.ChildrenContainer.Termination.type">Termination</a><span class="delimiter">)</span> ⇒ <a href="#akka.actor.dungeon;FaultHandling.finishTerminate" title="()Unit">finishTerminate</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">case</span> _ ⇒
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(thunk: Throwable =&gt; Unit)util.control.Exception.Catcher[Unit]" id="akka.actor.dungeon;FaultHandling.handleNonFatalOrInterruptedException">handleNonFatalOrInterruptedException</a><span class="delimiter">(</span><a title="Throwable =&gt; Unit" id="akka.actor.dungeon;FaultHandling.handleNonFatalOrInterruptedException.thunk">thunk</a>: <span class="delimiter">(</span>Throwable<span class="delimiter">)</span> ⇒ Unit<span class="delimiter">)</span>: <span title="util.control.Exception.Catcher[Unit]">Catcher</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Throwable,Unit] with Serializable" id="akka.actor.dungeon;FaultHandling.handleNonFatalOrInterruptedException;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> <span title="InterruptedException">e</span>: <span title="InterruptedException">InterruptedException</span> ⇒
      <a href="#akka.actor.dungeon;FaultHandling.handleNonFatalOrInterruptedException.thunk" title="(v1: Throwable)Unit">thunk</a><span class="delimiter">(</span><span title="InterruptedException">e</span><span class="delimiter">)</span>
      <span title="Thread.type">Thread</span>.<span title="()Thread">currentThread</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Unit">interrupt</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#akka.actor.dungeon;FaultHandling.handleNonFatalOrInterruptedException;$anonfun.applyOrElse.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><span title="Throwable">e</span><span class="delimiter">)</span> ⇒
      <a href="#akka.actor.dungeon;FaultHandling.handleNonFatalOrInterruptedException.thunk" title="(v1: Throwable)Unit">thunk</a><span title="Boolean(true)" class="delimiter">(</span><span title="Throwable">e</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
