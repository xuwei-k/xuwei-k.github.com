<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>akka-cluster/cluster/routing/AdaptiveLoadBalancing.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> akka.cluster.routing

<span class="keyword">import</span> java.util.Arrays
<span class="keyword">import</span> java.util.concurrent.atomic.AtomicReference

<span class="keyword">import</span> scala.annotation.tailrec
<span class="keyword">import</span> scala.collection.immutable
<span class="keyword">import</span> scala.concurrent.forkjoin.ThreadLocalRandom

<span class="keyword">import</span> com.typesafe.config.Config

<span class="keyword">import</span> akka.actor.Actor
<span class="keyword">import</span> akka.actor.ActorSystem
<span class="keyword">import</span> akka.actor.Address
<span class="keyword">import</span> akka.actor.DynamicAccess
<span class="keyword">import</span> akka.actor.NoSerializationVerificationNeeded
<span class="keyword">import</span> akka.actor.Props
<span class="keyword">import</span> akka.actor.SupervisorStrategy
<span class="keyword">import</span> akka.cluster.Cluster
<span class="keyword">import</span> akka.cluster.<a href="../ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.ClusterMetricsChanged
<span class="keyword">import</span> akka.cluster.<a href="../ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.CurrentClusterState
<span class="keyword">import</span> akka.cluster.NodeMetrics
<span class="keyword">import</span> akka.cluster.<a href="../ClusterMetricsCollector.scala.html#akka.cluster.StandardMetrics" title="akka.cluster.StandardMetrics.type">StandardMetrics</a>.Cpu
<span class="keyword">import</span> akka.cluster.<a href="../ClusterMetricsCollector.scala.html#akka.cluster.StandardMetrics" title="akka.cluster.StandardMetrics.type">StandardMetrics</a>.HeapMemory
<span class="keyword">import</span> akka.dispatch.Dispatchers
<span class="keyword">import</span> akka.japi.<a href="../../../akka-actor/japi/JavaAPI.scala.html#akka.japi.Util" title="akka.japi.Util.type">Util</a>.immutableSeq
<span class="keyword">import</span> akka.routing._

<span class="comment">/**
 * Load balancing of messages to cluster nodes based on cluster metric data.
 *
 * It uses random selection of routees based on probabilities derived from
 * the remaining capacity of corresponding node.
 *
 * @param system the actor system hosting this router
 *
 * @param metricsSelector decides what probability to use for selecting a routee, based
 *   on remaining capacity as indicated by the node metrics
 */</span>
<span class="keyword">final</span> <span class="keyword">case class</span> <a title="class AdaptiveLoadBalancingRoutingLogic extends AnyRef with akka.routing.RoutingLogic with akka.actor.NoSerializationVerificationNeeded with Product with Serializable" id="akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic.readResolve">AdaptiveLoadBalancingRoutingLogic</a><a href="#akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorSystem" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.system">system</a>: <a href="../../../akka-actor/actor/ActorSystem.scala.html#akka.actor;ActorSystem" title="akka.actor.ActorSystem">ActorSystem</a>, <a title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic.apply$default$2">metricsSelector</a>: <a href="#akka.cluster.routing;MetricsSelector" title="akka.cluster.routing.MetricsSelector">MetricsSelector</a> = <a href="#akka.cluster.routing.MixMetricsSelector.readResolve" title="akka.cluster.routing.MixMetricsSelector.type">MixMetricsSelector</a><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;RoutingLogic" title="akka.routing.RoutingLogic">RoutingLogic</a> <span class="keyword">with</span> <a href="../../../akka-actor/actor/Actor.scala.html#akka.actor;NoSerializationVerificationNeeded" title="akka.actor.NoSerializationVerificationNeeded">NoSerializationVerificationNeeded</a> <span class="delimiter">{</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="akka.cluster.Cluster" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.cluster">cluster</a> = <a href="../../../akka-actor/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>

  <span class="comment">// The current weighted routees, if any. Weights are produced by the metricsSelector</span>
  <span class="comment">// via the metricsListener Actor. It's only updated by the actor, but accessed from</span>
  <span class="comment">// the threads of the sender()s.</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.atomic.AtomicReference[(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])]" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.weightedRouteesRef">weightedRouteesRef</a> =
    <span title="java.util.concurrent.atomic.AtomicReference[(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])]" class="keyword">new</span> <span title="java.util.concurrent.atomic.AtomicReference[(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])]">AtomicReference</span><span class="delimiter">[</span><span class="delimiter">(</span>immutable.IndexedSeq<span class="delimiter">[</span>Routee<span class="delimiter">]</span>, Set<span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span>, Option<span class="delimiter">[</span>WeightedRoutees<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">(</span>
      <span title="(_1: scala.collection.immutable.Vector[Nothing], _2: scala.collection.immutable.Set[akka.cluster.NodeMetrics], _3: None.type)(scala.collection.immutable.Vector[Nothing], scala.collection.immutable.Set[akka.cluster.NodeMetrics], None.type)" class="delimiter">(</span><span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span>, <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.cluster.NodeMetrics]">empty</span>, <span title="None.type">None</span><span class="delimiter">)</span><span class="delimiter">)</span>

  @tailrec <span class="keyword">final</span> <span class="keyword">def</span> <a title="(event: akka.cluster.ClusterEvent.ClusterMetricsChanged)Unit" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged">metricsChanged</a><span class="delimiter">(</span><a title="akka.cluster.ClusterEvent.ClusterMetricsChanged" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged.event">event</a>: <a href="../ClusterEvent.scala.html#akka.cluster.ClusterEvent;ClusterMetricsChanged" title="akka.cluster.ClusterEvent.ClusterMetricsChanged">ClusterMetricsChanged</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged.oldValue">oldValue</a> = <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.weightedRouteesRef" title="=&gt; java.util.concurrent.atomic.AtomicReference[(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])]">weightedRouteesRef</a>.<span title="()(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])">get</span>
    <span class="keyword">val</span> <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged.routees.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged.routees" class="delimiter">(</a><a title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged.routees.routees">routees</a>, _, _<span class="delimiter">)</span> = <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged.oldValue" title="(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])">oldValue</a>
    <span class="keyword">val</span> <a title="Some[akka.cluster.routing.WeightedRoutees]" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged.weightedRoutees">weightedRoutees</a> = <span title="(x: akka.cluster.routing.WeightedRoutees)Some[akka.cluster.routing.WeightedRoutees]">Some</span><span class="delimiter">(</span><span title="akka.cluster.routing.WeightedRoutees" class="keyword">new</span> <a href="#akka.cluster.routing;WeightedRoutees" title="akka.cluster.routing.WeightedRoutees">WeightedRoutees</a><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a>, <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a>,
      <a href="#akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic.apply$default$2" title="=&gt; akka.cluster.routing.MetricsSelector">metricsSelector</a>.<a href="#akka.cluster.routing;MetricsSelector.weights" title="(nodeMetrics: Set[akka.cluster.NodeMetrics])Map[akka.actor.Address,Int]">weights</a><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged.event" title="akka.cluster.ClusterEvent.ClusterMetricsChanged">event</a>.<a href="../ClusterEvent.scala.html#akka.cluster.ClusterEvent;ClusterMetricsChanged.nodeMetrics" title="=&gt; Set[akka.cluster.NodeMetrics]">nodeMetrics</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="comment">// retry when CAS failure</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.weightedRouteesRef" title="=&gt; java.util.concurrent.atomic.AtomicReference[(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])]">weightedRouteesRef</a>.<span title="(x$1: (scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees]), x$2: (scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees]))Boolean">compareAndSet</span><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged.oldValue" title="(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])">oldValue</a>, <span title="(_1: scala.collection.immutable.IndexedSeq[akka.routing.Routee], _2: Set[akka.cluster.NodeMetrics], _3: Some[akka.cluster.routing.WeightedRoutees])(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Some[akka.cluster.routing.WeightedRoutees])" class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a>, <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged.event" title="akka.cluster.ClusterEvent.ClusterMetricsChanged">event</a>.<a href="../ClusterEvent.scala.html#akka.cluster.ClusterEvent;ClusterMetricsChanged.nodeMetrics" title="=&gt; Set[akka.cluster.NodeMetrics]">nodeMetrics</a>, <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged.weightedRoutees" title="Some[akka.cluster.routing.WeightedRoutees]">weightedRoutees</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged" title="(event: akka.cluster.ClusterEvent.ClusterMetricsChanged)Unit">metricsChanged</a><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged.event" title="akka.cluster.ClusterEvent.ClusterMetricsChanged">event</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(message: Any, routees: scala.collection.immutable.IndexedSeq[akka.routing.Routee])akka.routing.Routee" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select">select</a><span class="delimiter">(</span><a title="Any" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.message">message</a>: <span title="Any">Any</span>, <a title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.routees">routees</a>: immutable.<span title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">IndexedSeq</span><span class="delimiter">[</span>Routee<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;Routee" title="akka.routing.Routee">Routee</a> =
    <span title="akka.routing.Routee" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="../../../akka-actor/routing/Router.scala.html#akka.routing.NoRoutee" title="akka.routing.NoRoutee.type">NoRoutee</a>
    <span class="keyword">else</span> <span class="delimiter">{</span>

      <span class="keyword">def</span> <a title="()Option[akka.cluster.routing.WeightedRoutees]" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees">updateWeightedRoutees</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Option[akka.cluster.routing.WeightedRoutees]">Option</span><span class="delimiter">[</span>WeightedRoutees<span class="delimiter">]</span> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldValue">oldValue</a> = <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.weightedRouteesRef" title="=&gt; java.util.concurrent.atomic.AtomicReference[(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])]">weightedRouteesRef</a>.<span title="()(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])">get</span>
        <span class="keyword">val</span> <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldRoutees" title="(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])" class="delimiter">(</a><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.x$1" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldRoutees">oldRoutees</a>, <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.x$1" title="Set[akka.cluster.NodeMetrics]" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldMetrics">oldMetrics</a>, <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.x$1" title="Option[akka.cluster.routing.WeightedRoutees]" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldWeightedRoutees">oldWeightedRoutees</a><span class="delimiter">)</span> = <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldValue" title="(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])">oldValue</a>

        <span title="Option[akka.cluster.routing.WeightedRoutees]" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldRoutees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">oldRoutees</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Some[akka.cluster.routing.WeightedRoutees]" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.weightedRoutees">weightedRoutees</a> = <span title="(x: akka.cluster.routing.WeightedRoutees)Some[akka.cluster.routing.WeightedRoutees]">Some</span><span class="delimiter">(</span><span title="akka.cluster.routing.WeightedRoutees" class="keyword">new</span> <a href="#akka.cluster.routing;WeightedRoutees" title="akka.cluster.routing.WeightedRoutees">WeightedRoutees</a><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a>, <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a>,
            <a href="#akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic.apply$default$2" title="=&gt; akka.cluster.routing.MetricsSelector">metricsSelector</a>.<a href="#akka.cluster.routing;MetricsSelector.weights" title="(nodeMetrics: Set[akka.cluster.NodeMetrics])Map[akka.actor.Address,Int]">weights</a><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldMetrics" title="Set[akka.cluster.NodeMetrics]">oldMetrics</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="comment">// ignore, don't update, in case of CAS failure</span>
          <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.weightedRouteesRef" title="=&gt; java.util.concurrent.atomic.AtomicReference[(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])]">weightedRouteesRef</a>.<span title="(x$1: (scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees]), x$2: (scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees]))Boolean">compareAndSet</span><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldValue" title="(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Option[akka.cluster.routing.WeightedRoutees])">oldValue</a>, <span title="(_1: scala.collection.immutable.IndexedSeq[akka.routing.Routee], _2: Set[akka.cluster.NodeMetrics], _3: Some[akka.cluster.routing.WeightedRoutees])(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.NodeMetrics], Some[akka.cluster.routing.WeightedRoutees])" class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a>, <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldMetrics" title="Set[akka.cluster.NodeMetrics]">oldMetrics</a>, <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.weightedRoutees" title="Some[akka.cluster.routing.WeightedRoutees]">weightedRoutees</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.weightedRoutees" title="Some[akka.cluster.routing.WeightedRoutees]">weightedRoutees</a>
        <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldWeightedRoutees" title="Option[akka.cluster.routing.WeightedRoutees]">oldWeightedRoutees</a>
      <span class="delimiter">}</span>

      <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees" title="()Option[akka.cluster.routing.WeightedRoutees]">updateWeightedRoutees</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="akka.routing.Routee" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="akka.cluster.routing.WeightedRoutees" id="akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.weighted">weighted</a><span class="delimiter">)</span> ⇒
          <span title="akka.routing.Routee" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.weighted" title="akka.cluster.routing.WeightedRoutees">weighted</a>.<a href="#akka.cluster.routing;WeightedRoutees.isEmpty" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="../../../akka-actor/routing/Router.scala.html#akka.routing.NoRoutee" title="akka.routing.NoRoutee.type">NoRoutee</a>
          <span class="keyword">else</span> <a href="#akka.cluster.routing;WeightedRoutees.apply" title="(value: Int)akka.routing.Routee">weighted</a><span class="delimiter">(</span><span title="scala.concurrent.forkjoin.ThreadLocalRandom.type">ThreadLocalRandom</span>.<span title="()scala.concurrent.forkjoin.ThreadLocalRandom">current</span>.<span title="(x$1: Int)Int">nextInt</span><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.weighted" title="akka.cluster.routing.WeightedRoutees">weighted</a>.<a href="#akka.cluster.routing;WeightedRoutees.total" title="=&gt; Int">total</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="None.type">None</span> ⇒
          <a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.routees" title="(idx: Int)akka.routing.Routee">routees</a><span class="delimiter">(</span><span title="scala.concurrent.forkjoin.ThreadLocalRandom.type">ThreadLocalRandom</span>.<span title="()scala.concurrent.forkjoin.ThreadLocalRandom">current</span>.<span title="(x$1: Int)Int">nextInt</span><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.select.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * A router pool that performs load balancing of messages to cluster nodes based on
 * cluster metric data.
 *
 * It uses random selection of routees based on probabilities derived from
 * the remaining capacity of corresponding node.
 *
 * The configuration parameter trumps the constructor arguments. This means that
 * if you provide `nrOfInstances` during instantiation they will be ignored if
 * the router is defined in the configuration file for the actor being used.
 *
 * &lt;h1&gt;Supervision Setup&lt;/h1&gt;
 *
 * Any routees that are created by a router will be created as the router's children.
 * The router is therefore also the children's supervisor.
 *
 * The supervision strategy of the router actor can be configured with
 * [[#withSupervisorStrategy]]. If no strategy is provided, routers default to
 * a strategy of “always escalate”. This means that errors are passed up to the
 * router's supervisor for handling.
 *
 * The router's supervisor will treat the error as an error with the router itself.
 * Therefore a directive to stop or restart will cause the router itself to stop or
 * restart. The router, in turn, will cause its children to stop and restart.
 *
 * @param metricsSelector decides what probability to use for selecting a routee, based
 *   on remaining capacity as indicated by the node metrics
 *
 * @param nrOfInstances initial number of routees in the pool
 *
 * @param supervisorStrategy strategy for supervising the routees, see 'Supervision Setup'
 *
 * @param routerDispatcher dispatcher to use for the router head actor, which handles
 *   supervision, death watch and router management messages
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
<span class="keyword">final</span> <span class="keyword">case class</span> <a title="class AdaptiveLoadBalancingPool extends AnyRef with akka.routing.Pool with Product with Serializable" id="akka.cluster.routing.AdaptiveLoadBalancingPool.readResolve">AdaptiveLoadBalancingPool</a><a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.readResolve" title="Product" class="delimiter">(</a>
  <a title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing.AdaptiveLoadBalancingPool.apply$default$1">metricsSelector</a>: <a href="#akka.cluster.routing;MetricsSelector" title="akka.cluster.routing.MetricsSelector">MetricsSelector</a> = <a href="#akka.cluster.routing.MixMetricsSelector.readResolve" title="akka.cluster.routing.MixMetricsSelector.type">MixMetricsSelector</a>,
  <span class="keyword">override</span> <span class="keyword">val</span> <a title="Int" id="akka.cluster.routing.AdaptiveLoadBalancingPool.apply$default$2">nrOfInstances</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>,
  <span class="keyword">override</span> <span class="keyword">val</span> <a title="akka.actor.SupervisorStrategy" id="akka.cluster.routing.AdaptiveLoadBalancingPool.apply$default$3">supervisorStrategy</a>: <a href="../../../akka-actor/actor/FaultHandling.scala.html#akka.actor;SupervisorStrategy" title="akka.actor.SupervisorStrategy">SupervisorStrategy</a> = <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing.Pool" title="akka.routing.Pool.type">Pool</a>.<a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing.Pool.defaultSupervisorStrategy" title="=&gt; akka.actor.SupervisorStrategy">defaultSupervisorStrategy</a>,
  <span class="keyword">override</span> <span class="keyword">val</span> <a title="String" id="akka.cluster.routing.AdaptiveLoadBalancingPool.apply$default$4">routerDispatcher</a>: <span title="String">String</span> = Dispatchers.<span title="String(&quot;akka.actor.default-dispatcher&quot;)">DefaultDispatcherId</span>,
  <span class="keyword">override</span> <span class="keyword">val</span> <a title="Boolean" id="akka.cluster.routing.AdaptiveLoadBalancingPool.apply$default$5">usePoolDispatcher</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing;Pool" title="akka.routing.Pool">Pool</a> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(config: com.typesafe.config.Config, dynamicAccess: akka.actor.DynamicAccess)akka.cluster.routing.AdaptiveLoadBalancingPool" id="akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(d8f6b3a08e)" class="keyword">this</a><span class="delimiter">(</span><a title="com.typesafe.config.Config" id="akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(d8f6b3a08e).config">config</a>: <span title="com.typesafe.config.Config">Config</span>, <a title="akka.actor.DynamicAccess" id="akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(d8f6b3a08e).dynamicAccess">dynamicAccess</a>: <a href="../../../akka-actor/actor/DynamicAccess.scala.html#akka.actor;DynamicAccess" title="akka.actor.DynamicAccess">DynamicAccess</a><span class="delimiter">)</span> =
    <a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.apply$default$3" title="akka.actor.SupervisorStrategy" id="akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(d8f6b3a08e).x$8" class="keyword">this</a><span class="delimiter">(</span>nrOfInstances = <a href="#akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(d8f6b3a08e).config" title="com.typesafe.config.Config">config</a>.<span title="(x$1: String)Int">getInt</span><a title="Int" id="akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(d8f6b3a08e).x$4" class="delimiter">(</a><span title="String(&quot;nr-of-instances&quot;)" class="string">&quot;nr-of-instances&quot;</span><span class="delimiter">)</span>,
      metricsSelector = <a href="#akka.cluster.routing.MetricsSelector.readResolve" title="akka.cluster.routing.MetricsSelector.type">MetricsSelector</a>.<a href="#akka.cluster.routing.MetricsSelector.fromConfig" title="(config: com.typesafe.config.Config, dynamicAccess: akka.actor.DynamicAccess)akka.cluster.routing.MetricsSelector">fromConfig</a><a title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(d8f6b3a08e).x$5" class="delimiter">(</a><a href="#akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(d8f6b3a08e).config" title="com.typesafe.config.Config">config</a>, <a href="#akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(d8f6b3a08e).dynamicAccess" title="akka.actor.DynamicAccess">dynamicAccess</a><span class="delimiter">)</span>,
      usePoolDispatcher = <a href="#akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(d8f6b3a08e).config" title="com.typesafe.config.Config">config</a>.<span title="(x$1: String)Boolean">hasPath</span><a title="Boolean" id="akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(d8f6b3a08e).x$6" class="delimiter">(</a><span title="String(&quot;pool-dispatcher&quot;)" class="string">&quot;pool-dispatcher&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API
   * @param metricsSelector decides what probability to use for selecting a routee, based
   *   on remaining capacity as indicated by the node metrics
   * @param nr initial number of routees in the pool
   */</span>
  <span class="keyword">def</span> <a title="(metricsSelector: akka.cluster.routing.MetricsSelector, nr: Int)akka.cluster.routing.AdaptiveLoadBalancingPool" id="akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(b3eeb293b5)" class="keyword">this</a><span class="delimiter">(</span><a title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(b3eeb293b5).metricsSelector">metricsSelector</a>: <a href="#akka.cluster.routing;MetricsSelector" title="akka.cluster.routing.MetricsSelector">MetricsSelector</a>, <a title="Int" id="akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(b3eeb293b5).nr">nr</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.apply$default$1" title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(b3eeb293b5).x$13" class="keyword">this</a><span class="delimiter">(</span>nrOfInstances = <a href="#akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(b3eeb293b5).nr" title="Int" id="akka.cluster.routing;AdaptiveLoadBalancingPool.<init>(b3eeb293b5).x$9">nr</a><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Option[akka.routing.Resizer]" id="akka.cluster.routing;AdaptiveLoadBalancingPool.resizer">resizer</a>: <span title="Option[akka.routing.Resizer]">Option</span><span class="delimiter">[</span>Resizer<span class="delimiter">]</span> = <span title="None.type">None</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(system: akka.actor.ActorSystem)akka.routing.Router" id="akka.cluster.routing;AdaptiveLoadBalancingPool.createRouter">createRouter</a><span class="delimiter">(</span><a title="akka.actor.ActorSystem" id="akka.cluster.routing;AdaptiveLoadBalancingPool.createRouter.system">system</a>: <a href="../../../akka-actor/actor/ActorSystem.scala.html#akka.actor;ActorSystem" title="akka.actor.ActorSystem">ActorSystem</a><span class="delimiter">)</span>: <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;Router" title="akka.routing.Router">Router</a> =
    <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;Router.<init>(e072339920)" title="(logic: akka.routing.RoutingLogic)akka.routing.Router" class="keyword">new</a> <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;Router" title="akka.routing.Router">Router</a><span class="delimiter">(</span><a href="#akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic.readResolve" title="(system: akka.actor.ActorSystem, metricsSelector: akka.cluster.routing.MetricsSelector)akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic">AdaptiveLoadBalancingRoutingLogic</a><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingPool.createRouter.system" title="akka.actor.ActorSystem">system</a>, <a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.apply$default$1" title="=&gt; akka.cluster.routing.MetricsSelector">metricsSelector</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(routingLogic: akka.routing.RoutingLogic)Option[akka.actor.Props]" id="akka.cluster.routing;AdaptiveLoadBalancingPool.routingLogicController">routingLogicController</a><span class="delimiter">(</span><a title="akka.routing.RoutingLogic" id="akka.cluster.routing;AdaptiveLoadBalancingPool.routingLogicController.routingLogic">routingLogic</a>: <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;RoutingLogic" title="akka.routing.RoutingLogic">RoutingLogic</a><span class="delimiter">)</span>: <span title="Option[akka.actor.Props]">Option</span><span class="delimiter">[</span>Props<span class="delimiter">]</span> =
    <span title="(x: akka.actor.Props)Some[akka.actor.Props]">Some</span><span class="delimiter">(</span><a href="../../../akka-actor/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.cluster.routing.AdaptiveLoadBalancingMetricsListener](classOf[akka.cluster.routing.AdaptiveLoadBalancingMetricsListener])" class="delimiter">[</span>AdaptiveLoadBalancingMetricsListener<span class="delimiter">]</span>,
      <a href="#akka.cluster.routing;AdaptiveLoadBalancingPool.routingLogicController.routingLogic" title="akka.routing.RoutingLogic">routingLogic</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic" class="delimiter">[</span><a href="#akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic">AdaptiveLoadBalancingRoutingLogic</a><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Setting the supervisor strategy to be used for the “head” Router actor.
   */</span>
  <span class="keyword">def</span> <a title="(strategy: akka.actor.SupervisorStrategy)akka.cluster.routing.AdaptiveLoadBalancingPool" id="akka.cluster.routing;AdaptiveLoadBalancingPool.withSupervisorStrategy">withSupervisorStrategy</a><span class="delimiter">(</span><a title="akka.actor.SupervisorStrategy" id="akka.cluster.routing;AdaptiveLoadBalancingPool.withSupervisorStrategy.strategy">strategy</a>: <a href="../../../akka-actor/actor/FaultHandling.scala.html#akka.actor;SupervisorStrategy" title="akka.actor.SupervisorStrategy">SupervisorStrategy</a><span class="delimiter">)</span>: <a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingPool">AdaptiveLoadBalancingPool</a> = <a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.apply$default$1" title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingPool.withSupervisorStrategy.x$18">copy</a><span class="delimiter">(</span>supervisorStrategy = <a href="#akka.cluster.routing;AdaptiveLoadBalancingPool.withSupervisorStrategy.strategy" title="akka.actor.SupervisorStrategy" id="akka.cluster.routing;AdaptiveLoadBalancingPool.withSupervisorStrategy.x$14">strategy</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Setting the dispatcher to be used for the router head actor,  which handles
   * supervision, death watch and router management messages.
   */</span>
  <span class="keyword">def</span> <a title="(dispatcherId: String)akka.cluster.routing.AdaptiveLoadBalancingPool" id="akka.cluster.routing;AdaptiveLoadBalancingPool.withDispatcher">withDispatcher</a><span class="delimiter">(</span><a title="String" id="akka.cluster.routing;AdaptiveLoadBalancingPool.withDispatcher.dispatcherId">dispatcherId</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingPool">AdaptiveLoadBalancingPool</a> = <a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.apply$default$1" title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingPool.withDispatcher.x$23">copy</a><span class="delimiter">(</span>routerDispatcher = <a href="#akka.cluster.routing;AdaptiveLoadBalancingPool.withDispatcher.dispatcherId" title="String" id="akka.cluster.routing;AdaptiveLoadBalancingPool.withDispatcher.x$19">dispatcherId</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Uses the supervisor strategy of the given Routerconfig
   * if this RouterConfig doesn't have one
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(other: akka.routing.RouterConfig)akka.routing.RouterConfig" id="akka.cluster.routing;AdaptiveLoadBalancingPool.withFallback">withFallback</a><span class="delimiter">(</span><a title="akka.routing.RouterConfig" id="akka.cluster.routing;AdaptiveLoadBalancingPool.withFallback.other">other</a>: <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing;RouterConfig" title="akka.routing.RouterConfig">RouterConfig</a><span class="delimiter">)</span>: <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing;RouterConfig" title="akka.routing.RouterConfig">RouterConfig</a> =
    <span title="akka.routing.RouterConfig" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.readResolve" title="AdaptiveLoadBalancingPool.this.type" class="keyword">this</a>.<a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.apply$default$3" title="=&gt; akka.actor.SupervisorStrategy">supervisorStrategy</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing.Pool" title="akka.routing.Pool.type">Pool</a>.<a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing.Pool.defaultSupervisorStrategy" title="=&gt; akka.actor.SupervisorStrategy">defaultSupervisorStrategy</a><span class="delimiter">)</span> <a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingPool" class="keyword">this</a>
    <span class="keyword">else</span> <a href="#akka.cluster.routing;AdaptiveLoadBalancingPool.withFallback.other" title="akka.routing.RouterConfig">other</a> <span title="akka.routing.RouterConfig" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> _: <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing;FromConfig" title="akka.routing.FromConfig">FromConfig</a> | _: <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing;NoRouter" title="akka.routing.NoRouter">NoRouter</a> ⇒ <a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingPool" class="keyword">this</a> <span class="comment">// NoRouter is the default, hence “neutral”</span>
      <span class="keyword">case</span> <span title="akka.cluster.routing.AdaptiveLoadBalancingPool">otherRouter</span>: <a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingPool">AdaptiveLoadBalancingPool</a> ⇒
        <span title="akka.cluster.routing.AdaptiveLoadBalancingPool" class="keyword">if</span> <span class="delimiter">(</span><span title="akka.cluster.routing.AdaptiveLoadBalancingPool">otherRouter</span>.<a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.apply$default$3" title="=&gt; akka.actor.SupervisorStrategy">supervisorStrategy</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing.Pool" title="akka.routing.Pool.type">Pool</a>.<a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing.Pool.defaultSupervisorStrategy" title="=&gt; akka.actor.SupervisorStrategy">defaultSupervisorStrategy</a><span class="delimiter">)</span> <a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingPool" class="keyword">this</a>
        <span class="keyword">else</span> <a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.readResolve" title="AdaptiveLoadBalancingPool.this.type" class="keyword">this</a>.<a href="#akka.cluster.routing;AdaptiveLoadBalancingPool.withSupervisorStrategy" title="(strategy: akka.actor.SupervisorStrategy)akka.cluster.routing.AdaptiveLoadBalancingPool">withSupervisorStrategy</a><span class="delimiter">(</span><span title="akka.cluster.routing.AdaptiveLoadBalancingPool">otherRouter</span>.<a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.apply$default$3" title="=&gt; akka.actor.SupervisorStrategy">supervisorStrategy</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="akka.cluster.routing.AdaptiveLoadBalancingRouter">otherRouter</span>: <a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingRouter">AdaptiveLoadBalancingRouter</a> ⇒
        <span title="akka.cluster.routing.AdaptiveLoadBalancingPool" class="keyword">if</span> <span class="delimiter">(</span><span title="akka.cluster.routing.AdaptiveLoadBalancingRouter">otherRouter</span>.<a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$6" title="=&gt; akka.actor.SupervisorStrategy">supervisorStrategy</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing.Pool" title="akka.routing.Pool.type">Pool</a>.<a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing.Pool.defaultSupervisorStrategy" title="=&gt; akka.actor.SupervisorStrategy">defaultSupervisorStrategy</a><span class="delimiter">)</span> <a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingPool" class="keyword">this</a>
        <span class="keyword">else</span> <a href="#akka.cluster.routing.AdaptiveLoadBalancingPool.readResolve" title="AdaptiveLoadBalancingPool.this.type" class="keyword">this</a>.<a href="#akka.cluster.routing;AdaptiveLoadBalancingPool.withSupervisorStrategy" title="(strategy: akka.actor.SupervisorStrategy)akka.cluster.routing.AdaptiveLoadBalancingPool">withSupervisorStrategy</a><span class="delimiter">(</span><span title="akka.cluster.routing.AdaptiveLoadBalancingRouter">otherRouter</span>.<a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$6" title="=&gt; akka.actor.SupervisorStrategy">supervisorStrategy</a><span class="delimiter">)</span>
      <span class="keyword">case</span> _ ⇒ <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IllegalArgumentException" class="keyword">new</span> <span title="IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Expected AdaptiveLoadBalancingPool, got [%s]&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingPool.withFallback.other" title="akka.routing.RouterConfig">other</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * A router group that performs load balancing of messages to cluster nodes based on
 * cluster metric data.
 *
 * It uses random selection of routees based on probabilities derived from
 * the remaining capacity of corresponding node.
 *
 * The configuration parameter trumps the constructor arguments. This means that
 * if you provide `paths` during instantiation they will be ignored if
 * the router is defined in the configuration file for the actor being used.
 *
 * @param metricsSelector decides what probability to use for selecting a routee, based
 *   on remaining capacity as indicated by the node metrics
 *
 * @param paths string representation of the actor paths of the routees, messages are
 *   sent with [[akka.actor.ActorSelection]] to these paths
 *
 * @param routerDispatcher dispatcher to use for the router head actor, which handles
 *   router management messages
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
<span class="keyword">final</span> <span class="keyword">case class</span> <a title="class AdaptiveLoadBalancingGroup extends AnyRef with akka.routing.Group with Product with Serializable" id="akka.cluster.routing.AdaptiveLoadBalancingGroup.readResolve">AdaptiveLoadBalancingGroup</a><a href="#akka.cluster.routing.AdaptiveLoadBalancingGroup.readResolve" title="Product" class="delimiter">(</a>
  <a title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing.AdaptiveLoadBalancingGroup.apply$default$1">metricsSelector</a>: <a href="#akka.cluster.routing;MetricsSelector" title="akka.cluster.routing.MetricsSelector">MetricsSelector</a> = <a href="#akka.cluster.routing.MixMetricsSelector.readResolve" title="akka.cluster.routing.MixMetricsSelector.type">MixMetricsSelector</a>,
  <a title="scala.collection.immutable.Iterable[String]" id="akka.cluster.routing.AdaptiveLoadBalancingGroup.apply$default$2">paths</a>: immutable.<span title="scala.collection.immutable.Iterable[String]">Iterable</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span title="scala.collection.immutable.Nil.type">Nil</span>,
  <span class="keyword">override</span> <span class="keyword">val</span> <a title="String" id="akka.cluster.routing.AdaptiveLoadBalancingGroup.apply$default$3">routerDispatcher</a>: <span title="String">String</span> = Dispatchers.<span title="String(&quot;akka.actor.default-dispatcher&quot;)">DefaultDispatcherId</span><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing;Group" title="akka.routing.Group">Group</a> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(config: com.typesafe.config.Config, dynamicAccess: akka.actor.DynamicAccess)akka.cluster.routing.AdaptiveLoadBalancingGroup" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.<init>(2d76c36b81)" class="keyword">this</a><span class="delimiter">(</span><a title="com.typesafe.config.Config" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.<init>(2d76c36b81).config">config</a>: <span title="com.typesafe.config.Config">Config</span>, <a title="akka.actor.DynamicAccess" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.<init>(2d76c36b81).dynamicAccess">dynamicAccess</a>: <a href="../../../akka-actor/actor/DynamicAccess.scala.html#akka.actor;DynamicAccess" title="akka.actor.DynamicAccess">DynamicAccess</a><span class="delimiter">)</span> =
    <a href="#akka.cluster.routing.AdaptiveLoadBalancingGroup.readResolve" title="AdaptiveLoadBalancingGroup.this.type" class="keyword">this</a><span class="delimiter">(</span>metricsSelector = <a href="#akka.cluster.routing.MetricsSelector.readResolve" title="akka.cluster.routing.MetricsSelector.type">MetricsSelector</a>.<a href="#akka.cluster.routing.MetricsSelector.fromConfig" title="(config: com.typesafe.config.Config, dynamicAccess: akka.actor.DynamicAccess)akka.cluster.routing.MetricsSelector">fromConfig</a><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingGroup.<init>(2d76c36b81).config" title="com.typesafe.config.Config">config</a>, <a href="#akka.cluster.routing;AdaptiveLoadBalancingGroup.<init>(2d76c36b81).dynamicAccess" title="akka.actor.DynamicAccess">dynamicAccess</a><span class="delimiter">)</span>,
      paths = <a href="../../../akka-actor/japi/JavaAPI.scala.html#akka.japi.Util.immutableSeq(42d3e3f9ec)" title="(iterable: Iterable[String])scala.collection.immutable.Seq[String]">immutableSeq</a><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingGroup.<init>(2d76c36b81).config" title="com.typesafe.config.Config">config</a>.<span title="(x$1: String)java.util.List[String]">getStringList</span><span class="delimiter">(</span><span title="String(&quot;routees.paths&quot;)" class="string">&quot;routees.paths&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API
   * @param metricsSelector decides what probability to use for selecting a routee, based
   *   on remaining capacity as indicated by the node metrics
   * @param routeesPaths string representation of the actor paths of the routees, messages are
   *   sent with [[akka.actor.ActorSelection]] to these paths
   */</span>
  <span class="keyword">def</span> <a title="(metricsSelector: akka.cluster.routing.MetricsSelector, routeesPaths: Iterable[String])akka.cluster.routing.AdaptiveLoadBalancingGroup" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.<init>(bbb619b5c1)" class="keyword">this</a><span class="delimiter">(</span><a title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.<init>(bbb619b5c1).metricsSelector">metricsSelector</a>: <a href="#akka.cluster.routing;MetricsSelector" title="akka.cluster.routing.MetricsSelector">MetricsSelector</a>,
           <a title="Iterable[String]" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.<init>(bbb619b5c1).routeesPaths">routeesPaths</a>: java.lang.<span title="Iterable[String]">Iterable</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#akka.cluster.routing.AdaptiveLoadBalancingGroup.apply$default$1" title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.<init>(bbb619b5c1).x$26" class="keyword">this</a><span class="delimiter">(</span>paths = <a href="../../../akka-actor/japi/JavaAPI.scala.html#akka.japi.Util.immutableSeq(42d3e3f9ec)" title="(iterable: Iterable[String])scala.collection.immutable.Seq[String]">immutableSeq</a><a title="scala.collection.immutable.Seq[String]" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.<init>(bbb619b5c1).x$24" class="delimiter">(</a><a href="#akka.cluster.routing;AdaptiveLoadBalancingGroup.<init>(bbb619b5c1).routeesPaths" title="Iterable[String]">routeesPaths</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(system: akka.actor.ActorSystem)akka.routing.Router" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.createRouter">createRouter</a><span class="delimiter">(</span><a title="akka.actor.ActorSystem" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.createRouter.system">system</a>: <a href="../../../akka-actor/actor/ActorSystem.scala.html#akka.actor;ActorSystem" title="akka.actor.ActorSystem">ActorSystem</a><span class="delimiter">)</span>: <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;Router" title="akka.routing.Router">Router</a> =
    <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;Router.<init>(e072339920)" title="(logic: akka.routing.RoutingLogic)akka.routing.Router" class="keyword">new</a> <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;Router" title="akka.routing.Router">Router</a><span class="delimiter">(</span><a href="#akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic.readResolve" title="(system: akka.actor.ActorSystem, metricsSelector: akka.cluster.routing.MetricsSelector)akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic">AdaptiveLoadBalancingRoutingLogic</a><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingGroup.createRouter.system" title="akka.actor.ActorSystem">system</a>, <a href="#akka.cluster.routing.AdaptiveLoadBalancingGroup.apply$default$1" title="=&gt; akka.cluster.routing.MetricsSelector">metricsSelector</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(routingLogic: akka.routing.RoutingLogic)Option[akka.actor.Props]" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.routingLogicController">routingLogicController</a><span class="delimiter">(</span><a title="akka.routing.RoutingLogic" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.routingLogicController.routingLogic">routingLogic</a>: <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;RoutingLogic" title="akka.routing.RoutingLogic">RoutingLogic</a><span class="delimiter">)</span>: <span title="Option[akka.actor.Props]">Option</span><span class="delimiter">[</span>Props<span class="delimiter">]</span> =
    <span title="(x: akka.actor.Props)Some[akka.actor.Props]">Some</span><span class="delimiter">(</span><a href="../../../akka-actor/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.cluster.routing.AdaptiveLoadBalancingMetricsListener](classOf[akka.cluster.routing.AdaptiveLoadBalancingMetricsListener])" class="delimiter">[</span>AdaptiveLoadBalancingMetricsListener<span class="delimiter">]</span>,
      <a href="#akka.cluster.routing;AdaptiveLoadBalancingGroup.routingLogicController.routingLogic" title="akka.routing.RoutingLogic">routingLogic</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic" class="delimiter">[</span><a href="#akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic">AdaptiveLoadBalancingRoutingLogic</a><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Setting the dispatcher to be used for the router head actor, which handles
   * router management messages
   */</span>
  <span class="keyword">def</span> <a title="(dispatcherId: String)akka.cluster.routing.AdaptiveLoadBalancingGroup" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.withDispatcher">withDispatcher</a><span class="delimiter">(</span><a title="String" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.withDispatcher.dispatcherId">dispatcherId</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#akka.cluster.routing.AdaptiveLoadBalancingGroup.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingGroup">AdaptiveLoadBalancingGroup</a> = <a href="#akka.cluster.routing.AdaptiveLoadBalancingGroup.apply$default$1" title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.withDispatcher.x$29">copy</a><span class="delimiter">(</span>routerDispatcher = <a href="#akka.cluster.routing;AdaptiveLoadBalancingGroup.withDispatcher.dispatcherId" title="String" id="akka.cluster.routing;AdaptiveLoadBalancingGroup.withDispatcher.x$27">dispatcherId</a><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * MetricsSelector that uses the heap metrics.
 * Low heap capacity =&gt; small weight.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
<span class="keyword">case object</span> <a href="#akka.cluster.routing.HeapMetricsSelector.productElement.x$1" title="akka.cluster.routing.HeapMetricsSelector.type" id="akka.cluster.routing.HeapMetricsSelector.readResolve">HeapMetricsSelector</a> <span title="Product" class="keyword">extends</span> <a href="#akka.cluster.routing;CapacityMetricsSelector" title="akka.cluster.routing.CapacityMetricsSelector">CapacityMetricsSelector</a> <span class="delimiter">{</span>
  <span class="comment">/**
   * Java API: get the singleton instance
   */</span>
  <span class="keyword">def</span> <a title="=&gt; akka.cluster.routing.HeapMetricsSelector.type" id="akka.cluster.routing.HeapMetricsSelector.getInstance">getInstance</a> = <span class="keyword">this</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(nodeMetrics: Set[akka.cluster.NodeMetrics])Map[akka.actor.Address,Double]" id="akka.cluster.routing.HeapMetricsSelector.capacity">capacity</a><span class="delimiter">(</span><a title="Set[akka.cluster.NodeMetrics]" id="akka.cluster.routing.HeapMetricsSelector.capacity.nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Double]">Map</span><span class="delimiter">[</span>Address, Double<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.routing.HeapMetricsSelector.capacity.nodeMetrics" title="Set[akka.cluster.NodeMetrics]">nodeMetrics</a>.<span title="(pf: PartialFunction[akka.cluster.NodeMetrics,(akka.actor.Address, Double)])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set[akka.cluster.NodeMetrics],(akka.actor.Address, Double),scala.collection.immutable.Set[(akka.actor.Address, Double)]])scala.collection.immutable.Set[(akka.actor.Address, Double)]">collect</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[akka.cluster.NodeMetrics,(akka.actor.Address, Double)] with Serializable" id="akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> <a href="../ClusterMetricsCollector.scala.html#akka.cluster.StandardMetrics.HeapMemory.unapply(d33dbba0b5)" title="(nodeMetrics: akka.cluster.NodeMetrics)Option[(akka.actor.Address, Long, Long, Long, Option[Long])]">HeapMemory</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.address">address</a>, _, <a title="Long" id="akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.used">used</a>, <a title="Long" id="akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.committed">committed</a>, <a title="Option[Long]" id="akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.max">max</a><span class="delimiter">)</span> ⇒
        <span class="keyword">val</span> <a title="Double" id="akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.applyOrElse.capacity">capacity</a> = <a href="#akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.max" title="Option[Long]">max</a> <span title="Double" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="None.type">None</span>    ⇒ <span class="delimiter">(</span><a href="#akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.committed" title="Long">committed</a> <span title="(x: Long)Long">-</span> <a href="#akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.used" title="Long">used</a><span class="delimiter">)</span>.<span title="=&gt; Double">toDouble</span> <span title="(x: Long)Double">/</span> <a href="#akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.committed" title="Long">committed</a>
          <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="Long" id="akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.applyOrElse.capacity.m">m</a><span class="delimiter">)</span> ⇒ <span class="delimiter">(</span><a href="#akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.applyOrElse.capacity.m" title="Long">m</a> <span title="(x: Long)Long">-</span> <a href="#akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.used" title="Long">used</a><span class="delimiter">)</span>.<span title="=&gt; Double">toDouble</span> <span title="(x: Long)Double">/</span> <a href="#akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.applyOrElse.capacity.m" title="Long">m</a>
        <span class="delimiter">}</span>
        <span title="(_1: akka.actor.Address, _2: Double)(akka.actor.Address, Double)" class="delimiter">(</span><a href="#akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.address" title="akka.actor.Address">address</a>, <a href="#akka.cluster.routing.HeapMetricsSelector.capacity;$anonfun.applyOrElse.capacity" title="Double">capacity</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="(implicit ev: &lt;:&lt;[(akka.actor.Address, Double),(akka.actor.Address, Double)])scala.collection.immutable.Map[akka.actor.Address,Double]">toMap</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * MetricsSelector that uses the combined CPU metrics.
 * Combined CPU is sum of User + Sys + Nice + Wait, in percentage.
 * Low cpu capacity =&gt; small weight.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
<span class="keyword">case object</span> <a href="#akka.cluster.routing.CpuMetricsSelector.productElement.x$1" title="akka.cluster.routing.CpuMetricsSelector.type" id="akka.cluster.routing.CpuMetricsSelector.readResolve">CpuMetricsSelector</a> <span title="Product" class="keyword">extends</span> <a href="#akka.cluster.routing;CapacityMetricsSelector" title="akka.cluster.routing.CapacityMetricsSelector">CapacityMetricsSelector</a> <span class="delimiter">{</span>
  <span class="comment">/**
   * Java API: get the singleton instance
   */</span>
  <span class="keyword">def</span> <a title="=&gt; akka.cluster.routing.CpuMetricsSelector.type" id="akka.cluster.routing.CpuMetricsSelector.getInstance">getInstance</a> = <span class="keyword">this</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(nodeMetrics: Set[akka.cluster.NodeMetrics])Map[akka.actor.Address,Double]" id="akka.cluster.routing.CpuMetricsSelector.capacity">capacity</a><span class="delimiter">(</span><a title="Set[akka.cluster.NodeMetrics]" id="akka.cluster.routing.CpuMetricsSelector.capacity.nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Double]">Map</span><span class="delimiter">[</span>Address, Double<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.routing.CpuMetricsSelector.capacity.nodeMetrics" title="Set[akka.cluster.NodeMetrics]">nodeMetrics</a>.<span title="(pf: PartialFunction[akka.cluster.NodeMetrics,(akka.actor.Address, Double)])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set[akka.cluster.NodeMetrics],(akka.actor.Address, Double),scala.collection.immutable.Set[(akka.actor.Address, Double)]])scala.collection.immutable.Set[(akka.actor.Address, Double)]">collect</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[akka.cluster.NodeMetrics,(akka.actor.Address, Double)] with Serializable" id="akka.cluster.routing.CpuMetricsSelector.capacity;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> <a href="../ClusterMetricsCollector.scala.html#akka.cluster.StandardMetrics.Cpu.unapply(6e61a56573)" title="(nodeMetrics: akka.cluster.NodeMetrics)Option[(akka.actor.Address, Long, Option[Double], Option[Double], Int)]">Cpu</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.routing.CpuMetricsSelector.capacity;$anonfun.isDefinedAt.address">address</a>, _, _, Some<span class="delimiter">(</span><a title="Double" id="akka.cluster.routing.CpuMetricsSelector.capacity;$anonfun.isDefinedAt.cpuCombined">cpuCombined</a><span class="delimiter">)</span>, _<span class="delimiter">)</span> ⇒
        <span class="keyword">val</span> <a title="Double" id="akka.cluster.routing.CpuMetricsSelector.capacity;$anonfun.applyOrElse.capacity">capacity</a> = <span title="Double(1.0)" class="double">1.0</span> <span title="(x: Double)Double">-</span> <a href="#akka.cluster.routing.CpuMetricsSelector.capacity;$anonfun.isDefinedAt.cpuCombined" title="Double">cpuCombined</a>
        <span title="(_1: akka.actor.Address, _2: Double)(akka.actor.Address, Double)" class="delimiter">(</span><a href="#akka.cluster.routing.CpuMetricsSelector.capacity;$anonfun.isDefinedAt.address" title="akka.actor.Address">address</a>, <a href="#akka.cluster.routing.CpuMetricsSelector.capacity;$anonfun.applyOrElse.capacity" title="Double">capacity</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="(implicit ev: &lt;:&lt;[(akka.actor.Address, Double),(akka.actor.Address, Double)])scala.collection.immutable.Map[akka.actor.Address,Double]">toMap</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * MetricsSelector that uses the system load average metrics.
 * System load average is OS-specific average load on the CPUs in the system,
 * for the past 1 minute. The system is possibly nearing a bottleneck if the
 * system load average is nearing number of cpus/cores.
 * Low load average capacity =&gt; small weight.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
<span class="keyword">case object</span> <a href="#akka.cluster.routing.SystemLoadAverageMetricsSelector.productElement.x$1" title="akka.cluster.routing.SystemLoadAverageMetricsSelector.type" id="akka.cluster.routing.SystemLoadAverageMetricsSelector.readResolve">SystemLoadAverageMetricsSelector</a> <span title="Product" class="keyword">extends</span> <a href="#akka.cluster.routing;CapacityMetricsSelector" title="akka.cluster.routing.CapacityMetricsSelector">CapacityMetricsSelector</a> <span class="delimiter">{</span>
  <span class="comment">/**
   * Java API: get the singleton instance
   */</span>
  <span class="keyword">def</span> <a title="=&gt; akka.cluster.routing.SystemLoadAverageMetricsSelector.type" id="akka.cluster.routing.SystemLoadAverageMetricsSelector.getInstance">getInstance</a> = <span class="keyword">this</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(nodeMetrics: Set[akka.cluster.NodeMetrics])Map[akka.actor.Address,Double]" id="akka.cluster.routing.SystemLoadAverageMetricsSelector.capacity">capacity</a><span class="delimiter">(</span><a title="Set[akka.cluster.NodeMetrics]" id="akka.cluster.routing.SystemLoadAverageMetricsSelector.capacity.nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Double]">Map</span><span class="delimiter">[</span>Address, Double<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.routing.SystemLoadAverageMetricsSelector.capacity.nodeMetrics" title="Set[akka.cluster.NodeMetrics]">nodeMetrics</a>.<span title="(pf: PartialFunction[akka.cluster.NodeMetrics,(akka.actor.Address, Double)])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set[akka.cluster.NodeMetrics],(akka.actor.Address, Double),scala.collection.immutable.Set[(akka.actor.Address, Double)]])scala.collection.immutable.Set[(akka.actor.Address, Double)]">collect</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[akka.cluster.NodeMetrics,(akka.actor.Address, Double)] with Serializable" id="akka.cluster.routing.SystemLoadAverageMetricsSelector.capacity;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> <a href="../ClusterMetricsCollector.scala.html#akka.cluster.StandardMetrics.Cpu.unapply(6e61a56573)" title="(nodeMetrics: akka.cluster.NodeMetrics)Option[(akka.actor.Address, Long, Option[Double], Option[Double], Int)]">Cpu</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.routing.SystemLoadAverageMetricsSelector.capacity;$anonfun.isDefinedAt.address">address</a>, _, Some<span class="delimiter">(</span><a title="Double" id="akka.cluster.routing.SystemLoadAverageMetricsSelector.capacity;$anonfun.isDefinedAt.systemLoadAverage">systemLoadAverage</a><span class="delimiter">)</span>, _, <a title="Int" id="akka.cluster.routing.SystemLoadAverageMetricsSelector.capacity;$anonfun.isDefinedAt.processors">processors</a><span class="delimiter">)</span> ⇒
        <span class="keyword">val</span> <a title="Double" id="akka.cluster.routing.SystemLoadAverageMetricsSelector.capacity;$anonfun.applyOrElse.capacity">capacity</a> = <span title="Double(1.0)" class="double">1.0</span> <span title="(x: Double)Double">-</span> math.<span title="(x: Double, y: Double)Double">min</span><span class="delimiter">(</span><span title="Double(1.0)" class="double">1.0</span>, <a href="#akka.cluster.routing.SystemLoadAverageMetricsSelector.capacity;$anonfun.isDefinedAt.systemLoadAverage" title="Double">systemLoadAverage</a> <span title="(x: Int)Double">/</span> <a href="#akka.cluster.routing.SystemLoadAverageMetricsSelector.capacity;$anonfun.isDefinedAt.processors" title="Int">processors</a><span class="delimiter">)</span>
        <span title="(_1: akka.actor.Address, _2: Double)(akka.actor.Address, Double)" class="delimiter">(</span><a href="#akka.cluster.routing.SystemLoadAverageMetricsSelector.capacity;$anonfun.isDefinedAt.address" title="akka.actor.Address">address</a>, <a href="#akka.cluster.routing.SystemLoadAverageMetricsSelector.capacity;$anonfun.applyOrElse.capacity" title="Double">capacity</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="(implicit ev: &lt;:&lt;[(akka.actor.Address, Double),(akka.actor.Address, Double)])scala.collection.immutable.Map[akka.actor.Address,Double]">toMap</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Singleton instance of the default MixMetricsSelector, which uses [akka.cluster.routing.HeapMetricsSelector],
 * [akka.cluster.routing.CpuMetricsSelector], and [akka.cluster.routing.SystemLoadAverageMetricsSelector]
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
<span class="keyword">object</span> <a title="akka.cluster.routing.MixMetricsSelector.type" id="akka.cluster.routing.MixMetricsSelector.readResolve">MixMetricsSelector</a> <a href="#akka.cluster.routing.MixMetricsSelector.readResolve" title="akka.cluster.routing.MixMetricsSelector.type" class="keyword">extends</a> <a href="#akka.cluster.routing;MixMetricsSelectorBase" title="akka.cluster.routing.MixMetricsSelectorBase">MixMetricsSelectorBase</a><span class="delimiter">(</span>
  <span title="(elems: akka.cluster.routing.CapacityMetricsSelector with Product*)scala.collection.immutable.Vector[akka.cluster.routing.CapacityMetricsSelector with Product]">Vector</span><span class="delimiter">(</span><a href="#akka.cluster.routing.HeapMetricsSelector.readResolve" title="akka.cluster.routing.HeapMetricsSelector.type">HeapMetricsSelector</a>, <a href="#akka.cluster.routing.CpuMetricsSelector.readResolve" title="akka.cluster.routing.CpuMetricsSelector.type">CpuMetricsSelector</a>, <a href="#akka.cluster.routing.SystemLoadAverageMetricsSelector.readResolve" title="akka.cluster.routing.SystemLoadAverageMetricsSelector.type">SystemLoadAverageMetricsSelector</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="comment">/**
   * Java API: get the default singleton instance
   */</span>
  <span class="keyword">def</span> <a title="=&gt; akka.cluster.routing.MixMetricsSelector.type" id="akka.cluster.routing.MixMetricsSelector.getInstance">getInstance</a> = <span class="keyword">this</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * MetricsSelector that combines other selectors and aggregates their capacity
 * values. By default it uses [akka.cluster.routing.HeapMetricsSelector],
 * [akka.cluster.routing.CpuMetricsSelector], and [akka.cluster.routing.SystemLoadAverageMetricsSelector]
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
<span class="keyword">case class</span> <a title="(selectors: scala.collection.immutable.IndexedSeq[akka.cluster.routing.CapacityMetricsSelector])akka.cluster.routing.MixMetricsSelector" id="akka.cluster.routing;MixMetricsSelector.equals">MixMetricsSelector</a><a href="#akka.cluster.routing;MixMetricsSelector.equals" title="Product" class="delimiter">(</a>
  <a title="scala.collection.immutable.IndexedSeq[akka.cluster.routing.CapacityMetricsSelector]" id="akka.cluster.routing;MixMetricsSelector.copy$default$1">selectors</a>: immutable.<span title="scala.collection.immutable.IndexedSeq[akka.cluster.routing.CapacityMetricsSelector]">IndexedSeq</span><span class="delimiter">[</span>CapacityMetricsSelector<span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="#akka.cluster.routing;MixMetricsSelectorBase" title="akka.cluster.routing.MixMetricsSelectorBase">MixMetricsSelectorBase</a><span class="delimiter">(</span><a href="#akka.cluster.routing;MixMetricsSelector.copy$default$1" title="scala.collection.immutable.IndexedSeq[akka.cluster.routing.CapacityMetricsSelector]">selectors</a><span class="delimiter">)</span>

<span class="comment">/**
 * Base class for MetricsSelector that combines other selectors and aggregates their capacity.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class MixMetricsSelectorBase extends akka.cluster.routing.CapacityMetricsSelector" id="akka.cluster.routing;MixMetricsSelectorBase">MixMetricsSelectorBase</a><a href="#akka.cluster.routing;MixMetricsSelectorBase" title="akka.cluster.routing.MixMetricsSelectorBase" class="delimiter">(</a><a title="scala.collection.immutable.IndexedSeq[akka.cluster.routing.CapacityMetricsSelector]" id="akka.cluster.routing;MixMetricsSelectorBase.selectors">selectors</a>: immutable.<span title="scala.collection.immutable.IndexedSeq[akka.cluster.routing.CapacityMetricsSelector]">IndexedSeq</span><span class="delimiter">[</span>CapacityMetricsSelector<span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="#akka.cluster.routing;CapacityMetricsSelector" title="akka.cluster.routing.CapacityMetricsSelector">CapacityMetricsSelector</a> <span class="delimiter">{</span>

  <span class="comment">/**
   * Java API: construct a mix-selector from a sequence of selectors
   */</span>
  <span class="keyword">def</span> <a title="(selectors: Iterable[akka.cluster.routing.CapacityMetricsSelector])akka.cluster.routing.MixMetricsSelectorBase" id="akka.cluster.routing;MixMetricsSelectorBase.<init>(db2105577f)" class="keyword">this</a><span class="delimiter">(</span><a title="Iterable[akka.cluster.routing.CapacityMetricsSelector]" id="akka.cluster.routing;MixMetricsSelectorBase.<init>(db2105577f).selectors">selectors</a>: java.lang.<span title="Iterable[akka.cluster.routing.CapacityMetricsSelector]">Iterable</span><span class="delimiter">[</span>CapacityMetricsSelector<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#akka.cluster.routing;MixMetricsSelectorBase" title="MixMetricsSelectorBase.this.type" class="keyword">this</a><span class="delimiter">(</span><a href="../../../akka-actor/japi/JavaAPI.scala.html#akka.japi.Util.immutableSeq(42d3e3f9ec)" title="(iterable: Iterable[akka.cluster.routing.CapacityMetricsSelector])scala.collection.immutable.Seq[akka.cluster.routing.CapacityMetricsSelector]">immutableSeq</a><span class="delimiter">(</span><a href="#akka.cluster.routing;MixMetricsSelectorBase.<init>(db2105577f).selectors" title="Iterable[akka.cluster.routing.CapacityMetricsSelector]">selectors</a><span class="delimiter">)</span>.<span title="=&gt; Vector[akka.cluster.routing.CapacityMetricsSelector]">toVector</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(nodeMetrics: Set[akka.cluster.NodeMetrics])Map[akka.actor.Address,Double]" id="akka.cluster.routing;MixMetricsSelectorBase.capacity">capacity</a><span class="delimiter">(</span><a title="Set[akka.cluster.NodeMetrics]" id="akka.cluster.routing;MixMetricsSelectorBase.capacity.nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Double]">Map</span><span class="delimiter">[</span>Address, Double<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.IndexedSeq[(akka.actor.Address, Double)]" id="akka.cluster.routing;MixMetricsSelectorBase.capacity.combined">combined</a>: immutable.<span title="scala.collection.immutable.IndexedSeq[(akka.actor.Address, Double)]">IndexedSeq</span><span class="delimiter">[</span><span class="delimiter">(</span>Address, Double<span class="delimiter">)</span><span class="delimiter">]</span> = <a href="#akka.cluster.routing;MixMetricsSelectorBase.selectors" title="scala.collection.immutable.IndexedSeq[akka.cluster.routing.CapacityMetricsSelector]">selectors</a>.<span title="(f: akka.cluster.routing.CapacityMetricsSelector =&gt; scala.collection.GenTraversableOnce[(akka.actor.Address, Double)])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[akka.cluster.routing.CapacityMetricsSelector],(akka.actor.Address, Double),scala.collection.immutable.IndexedSeq[(akka.actor.Address, Double)]])scala.collection.immutable.IndexedSeq[(akka.actor.Address, Double)]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq.Coll,(akka.actor.Address, Double),scala.collection.immutable.IndexedSeq[(akka.actor.Address, Double)]]" class="delimiter">(</span><a href="#akka.cluster.routing;MixMetricsSelectorBase.capacity.combined.$anonfun.x$2" title="akka.cluster.routing.CapacityMetricsSelector">_</a>.<a href="#akka.cluster.routing;CapacityMetricsSelector.capacity" title="(nodeMetrics: Set[akka.cluster.NodeMetrics])Map[akka.actor.Address,Double]">capacity</a><span class="delimiter">(</span><a href="#akka.cluster.routing;MixMetricsSelectorBase.capacity.nodeMetrics" title="Set[akka.cluster.NodeMetrics]">nodeMetrics</a><span class="delimiter">)</span>.<span title="=&gt; Seq[(akka.actor.Address, Double)]">toSeq</span><span class="delimiter">)</span>
    <span class="comment">// aggregated average of the capacities by address</span>
    <a href="#akka.cluster.routing;MixMetricsSelectorBase.capacity.combined" title="scala.collection.immutable.IndexedSeq[(akka.actor.Address, Double)]">combined</a>.<span title="(z: scala.collection.immutable.Map[akka.actor.Address,(Double, Int)])(op: (scala.collection.immutable.Map[akka.actor.Address,(Double, Int)], (akka.actor.Address, Double)) =&gt; scala.collection.immutable.Map[akka.actor.Address,(Double, Int)])scala.collection.immutable.Map[akka.actor.Address,(Double, Int)]">foldLeft</span><span class="delimiter">(</span><span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.actor.Address,(Double, Int)]" class="delimiter">[</span><a href="../../../akka-actor/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a>, <span title="(Double, Int)" class="delimiter">(</span>Double, Int<span class="delimiter">)</span><span class="delimiter">]</span>.<span title="(d: (Double, Int))scala.collection.immutable.Map[akka.actor.Address,(Double, Int)]">withDefaultValue</span><span class="delimiter">(</span><span title="(_1: Double, _2: Int)(Double, Int)" class="delimiter">(</span><span title="Double(0.0)" class="double">0.0</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.x0$1" title="scala.collection.immutable.Map[akka.actor.Address,(Double, Int)]" class="delimiter">{</a>
      <span class="keyword">case</span> <span class="delimiter">(</span><a title="scala.collection.immutable.Map[akka.actor.Address,(Double, Int)]" id="akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.acc">acc</a>, <span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.address">address</a>, <a title="Double" id="akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.capacity">capacity</a><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
        <span class="keyword">val</span> <a href="#akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.x$3.sum" title="(Double, Int)" class="delimiter">(</a><a href="#akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.x$3" title="Double" id="akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.x$3.sum">sum</a>, <a href="#akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.x$3" title="Int" id="akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.x$3.count">count</a><span class="delimiter">)</span> = <a href="#akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.acc" title="(key: akka.actor.Address)(Double, Int)">acc</a><span title="(Double, Int) @unchecked" class="delimiter">(</span><a href="#akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.address" title="akka.actor.Address">address</a><span class="delimiter">)</span>
        <a href="#akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.acc" title="scala.collection.immutable.Map[akka.actor.Address,(Double, Int)]">acc</a> <span title="(kv: (akka.actor.Address, (Double, Int)))scala.collection.immutable.Map[akka.actor.Address,(Double, Int)]">+</span> <span class="delimiter">(</span><a href="#akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.address" title="(x: akka.actor.Address)ArrowAssoc[akka.actor.Address]">address</a> <span title="(y: (Double, Int))(akka.actor.Address, (Double, Int))">-&gt;</span> <span class="delimiter">(</span><span title="(_1: Double, _2: Int)(Double, Int)" class="delimiter">(</span><span title="Double">sum</span> <span title="(x: Double)Double">+</span> <a href="#akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.capacity" title="Double">capacity</a>, <span title="Int">count</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="(f: ((akka.actor.Address, (Double, Int))) =&gt; (akka.actor.Address, Double))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[akka.actor.Address,(Double, Int)],(akka.actor.Address, Double),Map[akka.actor.Address,Double]])Map[akka.actor.Address,Double]">map</span> <a href="#akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.x0$2" title="(akka.actor.Address, Double)" class="delimiter">{</a>
      <span class="keyword">case</span> <span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.addr">addr</a>, <span class="delimiter">(</span><span title="Double">sum</span>, <span title="Int">count</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒ <span class="delimiter">(</span><a href="#akka.cluster.routing;MixMetricsSelectorBase.capacity.$anonfun.addr" title="(x: akka.actor.Address)ArrowAssoc[akka.actor.Address]">addr</a> <span title="(y: Double)(akka.actor.Address, Double)">-&gt;</span> <span title="Double">sum</span> <span title="(x: Int)Double">/</span> <span title="Int">count</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="akka.cluster.routing.MetricsSelector.type" id="akka.cluster.routing.MetricsSelector.readResolve">MetricsSelector</a> <a href="#akka.cluster.routing.MetricsSelector.readResolve" title="akka.cluster.routing.MetricsSelector.type" class="delimiter">{</a>
  <span class="keyword">def</span> <a title="(config: com.typesafe.config.Config, dynamicAccess: akka.actor.DynamicAccess)akka.cluster.routing.MetricsSelector" id="akka.cluster.routing.MetricsSelector.fromConfig">fromConfig</a><span class="delimiter">(</span><a title="com.typesafe.config.Config" id="akka.cluster.routing.MetricsSelector.fromConfig.config">config</a>: <span title="com.typesafe.config.Config">Config</span>, <a title="akka.actor.DynamicAccess" id="akka.cluster.routing.MetricsSelector.fromConfig.dynamicAccess">dynamicAccess</a>: <a href="../../../akka-actor/actor/DynamicAccess.scala.html#akka.actor;DynamicAccess" title="akka.actor.DynamicAccess">DynamicAccess</a><span class="delimiter">)</span> =
    <a href="#akka.cluster.routing.MetricsSelector.fromConfig.config" title="com.typesafe.config.Config">config</a>.<span title="(x$1: String)String">getString</span><span class="delimiter">(</span><span title="String(&quot;metrics-selector&quot;)" class="string">&quot;metrics-selector&quot;</span><span class="delimiter">)</span> <span title="akka.cluster.routing.MetricsSelector" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="String(&quot;mix&quot;)" class="string">&quot;mix&quot;</span>  ⇒ <a href="#akka.cluster.routing.MixMetricsSelector.readResolve" title="akka.cluster.routing.MixMetricsSelector.type">MixMetricsSelector</a>
      <span class="keyword">case</span> <span title="String(&quot;heap&quot;)" class="string">&quot;heap&quot;</span> ⇒ <a href="#akka.cluster.routing.HeapMetricsSelector.readResolve" title="akka.cluster.routing.HeapMetricsSelector.type">HeapMetricsSelector</a>
      <span class="keyword">case</span> <span title="String(&quot;cpu&quot;)" class="string">&quot;cpu&quot;</span>  ⇒ <a href="#akka.cluster.routing.CpuMetricsSelector.readResolve" title="akka.cluster.routing.CpuMetricsSelector.type">CpuMetricsSelector</a>
      <span class="keyword">case</span> <span title="String(&quot;load&quot;)" class="string">&quot;load&quot;</span> ⇒ <a href="#akka.cluster.routing.SystemLoadAverageMetricsSelector.readResolve" title="akka.cluster.routing.SystemLoadAverageMetricsSelector.type">SystemLoadAverageMetricsSelector</a>
      <span class="keyword">case</span> <a title="String" id="akka.cluster.routing.MetricsSelector.fromConfig.fqn">fqn</a> ⇒
        <span class="keyword">val</span> <a title="List[(Class[com.typesafe.config.Config], com.typesafe.config.Config)]" id="akka.cluster.routing.MetricsSelector.fromConfig.args">args</a> = <span title="(xs: (Class[com.typesafe.config.Config], com.typesafe.config.Config)*)List[(Class[com.typesafe.config.Config], com.typesafe.config.Config)]">List</span><span class="delimiter">(</span>classOf<span title="(x: Class[com.typesafe.config.Config])ArrowAssoc[Class[com.typesafe.config.Config]]" class="delimiter">[</span>Config<span class="delimiter">]</span> <span title="(y: com.typesafe.config.Config)(Class[com.typesafe.config.Config], com.typesafe.config.Config)">-&gt;</span> <a href="#akka.cluster.routing.MetricsSelector.fromConfig.config" title="com.typesafe.config.Config">config</a><span class="delimiter">)</span>
        <a href="#akka.cluster.routing.MetricsSelector.fromConfig.dynamicAccess" title="akka.actor.DynamicAccess">dynamicAccess</a>.<a href="../../../akka-actor/actor/DynamicAccess.scala.html#akka.actor;DynamicAccess.createInstanceFor(b43a2b150b)" title="[T](fqcn: String, args: scala.collection.immutable.Seq[(Class[_], AnyRef)])(implicit evidence$3: scala.reflect.ClassTag[T])scala.util.Try[T]">createInstanceFor</a><span title="(fqcn: String, args: scala.collection.immutable.Seq[(Class[_], AnyRef)])(implicit evidence$3: scala.reflect.ClassTag[akka.cluster.routing.MetricsSelector])scala.util.Try[akka.cluster.routing.MetricsSelector]" class="delimiter">[</span><a href="#akka.cluster.routing;MetricsSelector" title="akka.cluster.routing.MetricsSelector">MetricsSelector</a><span class="delimiter">]</span><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[akka.cluster.routing.MetricsSelector]" class="delimiter">(</span><a href="#akka.cluster.routing.MetricsSelector.fromConfig.fqn" title="String">fqn</a>, <a href="#akka.cluster.routing.MetricsSelector.fromConfig.args" title="List[(Class[com.typesafe.config.Config], com.typesafe.config.Config)]">args</a><span class="delimiter">)</span>.<span title="(f: PartialFunction[Throwable,akka.cluster.routing.MetricsSelector])scala.util.Try[akka.cluster.routing.MetricsSelector]">recover</span><span class="delimiter">(</span><a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Throwable,Nothing] with Serializable" id="akka.cluster.routing.MetricsSelector.fromConfig;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
          <span class="keyword">case</span> <a title="Throwable" id="akka.cluster.routing.MetricsSelector.fromConfig;$anonfun.isDefinedAt.exception">exception</a> ⇒ <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String, x$2: Throwable)IllegalArgumentException" class="keyword">new</span> <span title="IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span>
            <span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Cannot instantiate metrics-selector [&quot;)">Cannot instantiate metrics-selector [$</span><a href="#akka.cluster.routing.MetricsSelector.fromConfig.fqn" title="String">fqn</a><span title="String(&quot;], &quot;)" class="string">], &quot;</span> <span title="(x$1: Any)String">+</span>
              <span title="String(&quot;make sure it extends [akka.cluster.routing.MetricsSelector] and &quot;)" class="string">&quot;make sure it extends [akka.cluster.routing.MetricsSelector] and &quot;</span> <span title="(x$1: Any)String">+</span>
              <span title="String(&quot;has constructor with [com.typesafe.config.Config] parameter&quot;)" class="string">&quot;has constructor with [com.typesafe.config.Config] parameter&quot;</span><span class="delimiter">)</span>, <a href="#akka.cluster.routing.MetricsSelector.fromConfig;$anonfun.isDefinedAt.exception" title="Throwable">exception</a><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="=&gt; akka.cluster.routing.MetricsSelector">get</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * A MetricsSelector is responsible for producing weights from the node metrics.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
<span class="keyword">trait</span> <a title="trait MetricsSelector extends AnyRef with Serializable" id="akka.cluster.routing;MetricsSelector">MetricsSelector</a> <span class="keyword">extends</span> <span title="Serializable">Serializable</span> <span class="delimiter">{</span>
  <span class="comment">/**
   * The weights per address, based on the the nodeMetrics.
   */</span>
  <span class="keyword">def</span> <a title="(nodeMetrics: Set[akka.cluster.NodeMetrics])Map[akka.actor.Address,Int]" id="akka.cluster.routing;MetricsSelector.weights">weights</a><span class="delimiter">(</span><a title="Set[akka.cluster.NodeMetrics]" id="akka.cluster.routing;MetricsSelector.weights.nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Int]">Map</span><span class="delimiter">[</span>Address, Int<span class="delimiter">]</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * A MetricsSelector producing weights from remaining capacity.
 * The weights are typically proportional to the remaining capacity.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class CapacityMetricsSelector extends AnyRef with akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;CapacityMetricsSelector">CapacityMetricsSelector</a> <a href="#akka.cluster.routing;CapacityMetricsSelector" title="akka.cluster.routing.CapacityMetricsSelector" class="keyword">extends</a> <a href="#akka.cluster.routing;MetricsSelector" title="akka.cluster.routing.MetricsSelector">MetricsSelector</a> <span class="delimiter">{</span>

  <span class="comment">/**
   * Remaining capacity for each node. The value is between
   * 0.0 and 1.0, where 0.0 means no remaining capacity (full
   * utilization) and 1.0 means full remaining capacity (zero
   * utilization).
   */</span>
  <span class="keyword">def</span> <a title="(nodeMetrics: Set[akka.cluster.NodeMetrics])Map[akka.actor.Address,Double]" id="akka.cluster.routing;CapacityMetricsSelector.capacity">capacity</a><span class="delimiter">(</span><a title="Set[akka.cluster.NodeMetrics]" id="akka.cluster.routing;CapacityMetricsSelector.capacity.nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Double]">Map</span><span class="delimiter">[</span>Address, Double<span class="delimiter">]</span>

  <span class="comment">/**
   * Converts the capacity values to weights. The node with lowest
   * capacity gets weight 1 (lowest usable capacity is 1%) and other
   * nodes gets weights proportional to their capacity compared to
   * the node with lowest capacity.
   */</span>
  <span class="keyword">def</span> <a title="(capacity: Map[akka.actor.Address,Double])Map[akka.actor.Address,Int]" id="akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c)">weights</a><span class="delimiter">(</span><a title="Map[akka.actor.Address,Double]" id="akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).capacity">capacity</a>: <span title="Map[akka.actor.Address,Double]">Map</span><span class="delimiter">[</span>Address, Double<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Int]">Map</span><span class="delimiter">[</span>Address, Int<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="scala.collection.immutable.Map[akka.actor.Address,Int]" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).capacity" title="Map[akka.actor.Address,Double]">capacity</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.actor.Address,Int]" class="delimiter">[</span><a href="../../../akka-actor/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a>, <span title="Int">Int</span><span class="delimiter">]</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a href="#akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).min.min" title="Double" id="akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).min" class="delimiter">(</a>_, <a title="Double" id="akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).min.min">min</a><span class="delimiter">)</span> = <a href="#akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).capacity" title="Map[akka.actor.Address,Double]">capacity</a>.<span title="(f: ((akka.actor.Address, Double)) =&gt; Double)(implicit cmp: Ordering[Double])(akka.actor.Address, Double)">minBy</span> <a href="#akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).min.$anonfun.x0$3" title="Double" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>_, <a title="Double" id="akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).min.$anonfun.c">c</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).min.$anonfun.c" title="Double">c</a> <span class="delimiter">}</span>
      <span class="comment">// lowest usable capacity is 1% (&gt;= 0.5% will be rounded to weight 1), also avoids div by zero</span>
      <span class="keyword">val</span> <a title="Double" id="akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).divisor">divisor</a> = math.<span title="(x: Double, y: Double)Double">max</span><span class="delimiter">(</span><span title="Double(0.01)" class="double">0.01</span>, <a href="#akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).min" title="Double">min</a><span class="delimiter">)</span>
      <a href="#akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).capacity" title="Map[akka.actor.Address,Double]">capacity</a> <span title="(f: ((akka.actor.Address, Double)) =&gt; (akka.actor.Address, Int))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[akka.actor.Address,Double],(akka.actor.Address, Int),Map[akka.actor.Address,Int]])Map[akka.actor.Address,Int]">map</span> <a href="#akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).$anonfun.x0$4" title="(akka.actor.Address, Int)" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).$anonfun.addr">addr</a>, <a title="Double" id="akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).$anonfun.c">c</a><span class="delimiter">)</span> ⇒ <span class="delimiter">(</span><a href="#akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).$anonfun.addr" title="(x: akka.actor.Address)ArrowAssoc[akka.actor.Address]">addr</a> <span title="(y: Int)(akka.actor.Address, Int)">-&gt;</span> math.<span title="(x: Double)Long">round</span><span class="delimiter">(</span><span class="delimiter">(</span><a href="#akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).$anonfun.c" title="Double">c</a><span class="delimiter">)</span> <span title="(x: Double)Double">/</span> <a href="#akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c).divisor" title="Double">divisor</a><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * The weights per address, based on the capacity produced by
   * the nodeMetrics.
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(nodeMetrics: Set[akka.cluster.NodeMetrics])Map[akka.actor.Address,Int]" id="akka.cluster.routing;CapacityMetricsSelector.weights(e60323d261)">weights</a><span class="delimiter">(</span><a title="Set[akka.cluster.NodeMetrics]" id="akka.cluster.routing;CapacityMetricsSelector.weights(e60323d261).nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Int]">Map</span><span class="delimiter">[</span>Address, Int<span class="delimiter">]</span> =
    <a href="#akka.cluster.routing;CapacityMetricsSelector.weights(e45d06905c)" title="(capacity: Map[akka.actor.Address,Double])Map[akka.actor.Address,Int]">weights</a><span class="delimiter">(</span><a href="#akka.cluster.routing;CapacityMetricsSelector.capacity" title="(nodeMetrics: Set[akka.cluster.NodeMetrics])Map[akka.actor.Address,Double]">capacity</a><span class="delimiter">(</span><a href="#akka.cluster.routing;CapacityMetricsSelector.weights(e60323d261).nodeMetrics" title="Set[akka.cluster.NodeMetrics]">nodeMetrics</a><span class="delimiter">)</span><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API
 *
 * Pick routee based on its weight. Higher weight, higher probability.
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>cluster<span class="delimiter">]</span> <span class="keyword">class</span> <a title="class WeightedRoutees extends AnyRef" id="akka.cluster.routing;WeightedRoutees">WeightedRoutees</a><a href="#akka.cluster.routing;WeightedRoutees" title="akka.cluster.routing.WeightedRoutees" class="delimiter">(</a><a title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]" id="akka.cluster.routing;WeightedRoutees.routees">routees</a>: immutable.<span title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">IndexedSeq</span><span class="delimiter">[</span>Routee<span class="delimiter">]</span>, <a title="akka.actor.Address" id="akka.cluster.routing;WeightedRoutees.selfAddress">selfAddress</a>: <a href="../../../akka-actor/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a>, <a title="Map[akka.actor.Address,Int]" id="akka.cluster.routing;WeightedRoutees.weights">weights</a>: <span title="Map[akka.actor.Address,Int]">Map</span><span class="delimiter">[</span>Address, Int<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="comment">// fill an array of same size as the refs with accumulated weights,</span>
  <span class="comment">// binarySearch is used to pick the right bucket from a requested value</span>
  <span class="comment">// from 1 to the total sum of the used weights.</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Array[Int]" id="akka.cluster.routing;WeightedRoutees.buckets">buckets</a>: <span title="Array[Int]">Array</span><span class="delimiter">[</span>Int<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(routee: akka.routing.Routee)akka.actor.Address" id="akka.cluster.routing;WeightedRoutees.buckets.fullAddress">fullAddress</a><span class="delimiter">(</span><a title="akka.routing.Routee" id="akka.cluster.routing;WeightedRoutees.buckets.fullAddress.routee">routee</a>: <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;Routee" title="akka.routing.Routee">Routee</a><span class="delimiter">)</span>: <a href="../../../akka-actor/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <span title="akka.actor.Address">a</span> = <a href="#akka.cluster.routing;WeightedRoutees.buckets.fullAddress.routee" title="akka.routing.Routee">routee</a> <span title="akka.actor.Address" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> ActorRefRoutee<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.routing;WeightedRoutees.buckets.fullAddress.a.ref">ref</a><span class="delimiter">)</span>       ⇒ <a href="#akka.cluster.routing;WeightedRoutees.buckets.fullAddress.a.ref" title="akka.actor.ActorRef">ref</a>.<a href="../../../akka-actor/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../akka-actor/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a>
        <span class="keyword">case</span> ActorSelectionRoutee<span class="delimiter">(</span><a title="akka.actor.ActorSelection" id="akka.cluster.routing;WeightedRoutees.buckets.fullAddress.a.sel">sel</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.routing;WeightedRoutees.buckets.fullAddress.a.sel" title="akka.actor.ActorSelection">sel</a>.<a href="../../../akka-actor/actor/ActorSelection.scala.html#akka.actor;ActorSelection.anchor" title="=&gt; akka.actor.ActorRef">anchor</a>.<a href="../../../akka-actor/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../akka-actor/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a>
      <span class="delimiter">}</span>
      <span title="akka.actor.Address">a</span> <span title="akka.actor.Address" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Address<span class="delimiter">(</span>_, _, <span title="None.type">None</span>, <span title="None.type">None</span><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.routing;WeightedRoutees.selfAddress" title="akka.actor.Address">selfAddress</a>
        <span class="keyword">case</span> <span title="akka.actor.Address">a</span>                         ⇒ <span title="akka.actor.Address">a</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="Array[Int]" id="akka.cluster.routing;WeightedRoutees.buckets.buckets">buckets</a> = <span title="Array.type">Array</span>.<span title="[T](n1: Int)(implicit evidence$3: scala.reflect.ClassTag[T])Array[T]">ofDim</span><span title="(n1: Int)(implicit evidence$3: scala.reflect.ClassTag[Int])Array[Int]" class="delimiter">[</span><span title="Int">Int</span><span class="delimiter">]</span><span title="=&gt; scala.reflect.ClassTag[Int]" class="delimiter">(</span><a href="#akka.cluster.routing;WeightedRoutees.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="akka.cluster.routing;WeightedRoutees.buckets.meanWeight">meanWeight</a> = <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.cluster.routing;WeightedRoutees.weights" title="Map[akka.actor.Address,Int]">weights</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="Int(1)" class="int">1</span> <span class="keyword">else</span> <a href="#akka.cluster.routing;WeightedRoutees.weights" title="Map[akka.actor.Address,Int]">weights</a>.<span title="=&gt; Iterable[Int]">values</span>.<span title="(implicit num: Numeric[Int])Int">sum</span> <span title="(x: Int)Int">/</span> <a href="#akka.cluster.routing;WeightedRoutees.weights" title="Map[akka.actor.Address,Int]">weights</a>.<span title="=&gt; Int">size</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[akka.actor.Address,Int]" id="akka.cluster.routing;WeightedRoutees.buckets.w">w</a> = <a href="#akka.cluster.routing;WeightedRoutees.weights" title="Map[akka.actor.Address,Int]">weights</a>.<span title="(d: Int)scala.collection.immutable.Map[akka.actor.Address,Int]">withDefaultValue</span><span class="delimiter">(</span><a href="#akka.cluster.routing;WeightedRoutees.buckets.meanWeight" title="Int">meanWeight</a><span class="delimiter">)</span> <span class="comment">// we don’t necessarily have metrics for all addresses</span>
    <span class="keyword">var</span> <a title="Int" id="akka.cluster.routing;WeightedRoutees.buckets.i">i</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">var</span> <a title="Int" id="akka.cluster.routing;WeightedRoutees.buckets.sum">sum</a> = <span title="Int(0)" class="int">0</span>
    <a href="#akka.cluster.routing;WeightedRoutees.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a> <span title="(f: akka.routing.Routee =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="akka.routing.Routee" id="akka.cluster.routing;WeightedRoutees.buckets.$anonfun.r">r</a> ⇒
      <a href="#akka.cluster.routing;WeightedRoutees.buckets.sum" title="Int">sum</a> <span title="(x: Int)Int">+=</span> <a href="#akka.cluster.routing;WeightedRoutees.buckets.w" title="(key: akka.actor.Address)Int">w</a><span class="delimiter">(</span><a href="#akka.cluster.routing;WeightedRoutees.buckets.fullAddress" title="(routee: akka.routing.Routee)akka.actor.Address">fullAddress</a><span class="delimiter">(</span><a href="#akka.cluster.routing;WeightedRoutees.buckets.$anonfun.r" title="akka.routing.Routee">r</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.cluster.routing;WeightedRoutees.buckets.buckets" title="(i: Int, x: Int)Unit">buckets</a><span class="delimiter">(</span><a href="#akka.cluster.routing;WeightedRoutees.buckets.i" title="Int">i</a><span class="delimiter">)</span> = <a href="#akka.cluster.routing;WeightedRoutees.buckets.sum" title="Int">sum</a>
      <a href="#akka.cluster.routing;WeightedRoutees.buckets.i" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>
    <a href="#akka.cluster.routing;WeightedRoutees.buckets.buckets" title="Array[Int]">buckets</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="akka.cluster.routing;WeightedRoutees.isEmpty">isEmpty</a>: <span title="Boolean">Boolean</span> = <a href="#akka.cluster.routing;WeightedRoutees.buckets" title="=&gt; Array[Int]">buckets</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">||</span> <a href="#akka.cluster.routing;WeightedRoutees.buckets" title="(i: Int)Int">buckets</a><span class="delimiter">(</span><a href="#akka.cluster.routing;WeightedRoutees.buckets" title="=&gt; Array[Int]">buckets</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span>

  <span class="keyword">def</span> <a title="=&gt; Int" id="akka.cluster.routing;WeightedRoutees.total">total</a>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.routing;WeightedRoutees.isEmpty" title="=&gt; Boolean">isEmpty</a>, <span title="String(&quot;WeightedRoutees must not be used when empty&quot;)" class="string">&quot;WeightedRoutees must not be used when empty&quot;</span><span class="delimiter">)</span>
    <a href="#akka.cluster.routing;WeightedRoutees.buckets" title="(i: Int)Int">buckets</a><span class="delimiter">(</span><a href="#akka.cluster.routing;WeightedRoutees.buckets" title="=&gt; Array[Int]">buckets</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Pick the routee matching a value, from 1 to total.
   */</span>
  <span class="keyword">def</span> <a title="(value: Int)akka.routing.Routee" id="akka.cluster.routing;WeightedRoutees.apply">apply</a><span class="delimiter">(</span><a title="Int" id="akka.cluster.routing;WeightedRoutees.apply.value">value</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;Routee" title="akka.routing.Routee">Routee</a> = <span class="delimiter">{</span>
    <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <span title="(x: Int)Boolean">&lt;=</span> <a href="#akka.cluster.routing;WeightedRoutees.apply.value" title="Int">value</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.cluster.routing;WeightedRoutees.apply.value" title="Int">value</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="#akka.cluster.routing;WeightedRoutees.total" title="=&gt; Int">total</a>, <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;value must be between [1 - %s]&quot;</span> <span title="(args: Any*)String">format</span> <a href="#akka.cluster.routing;WeightedRoutees.total" title="=&gt; Int">total</a><span class="delimiter">)</span>
    <a href="#akka.cluster.routing;WeightedRoutees.routees" title="(idx: Int)akka.routing.Routee">routees</a><span class="delimiter">(</span><a href="#akka.cluster.routing;WeightedRoutees.idx" title="(i: Int)Int">idx</a><span class="delimiter">(</span><span title="java.util.Arrays.type">Arrays</span>.<span title="(x$1: Array[Int], x$2: Int)Int">binarySearch</span><span class="delimiter">(</span><a href="#akka.cluster.routing;WeightedRoutees.buckets" title="=&gt; Array[Int]">buckets</a>, <a href="#akka.cluster.routing;WeightedRoutees.apply.value" title="Int">value</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Converts the result of Arrays.binarySearch into a index in the buckets array
   * see documentation of Arrays.binarySearch for what it returns
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(i: Int)Int" id="akka.cluster.routing;WeightedRoutees.idx">idx</a><span class="delimiter">(</span><a title="Int" id="akka.cluster.routing;WeightedRoutees.idx.i">i</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.cluster.routing;WeightedRoutees.idx.i" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#akka.cluster.routing;WeightedRoutees.idx.i" title="Int">i</a> <span class="comment">// exact match</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="akka.cluster.routing;WeightedRoutees.idx.j">j</a> = math.<span title="(x: Int)Int">abs</span><span class="delimiter">(</span><a href="#akka.cluster.routing;WeightedRoutees.idx.i" title="Int">i</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.cluster.routing;WeightedRoutees.idx.j" title="Int">j</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#akka.cluster.routing;WeightedRoutees.buckets" title="=&gt; Array[Int]">buckets</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IndexOutOfBoundsException" class="keyword">new</span> <span title="IndexOutOfBoundsException">IndexOutOfBoundsException</span><span class="delimiter">(</span>
        <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Requested index [%s] is &gt; max index [%s]&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#akka.cluster.routing;WeightedRoutees.idx.i" title="Int">i</a>, <a href="#akka.cluster.routing;WeightedRoutees.buckets" title="=&gt; Array[Int]">buckets</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="#akka.cluster.routing;WeightedRoutees.idx.j" title="Int">j</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API
 * subscribe to ClusterMetricsChanged and update routing logic
 */</span>
<span title="AnyRef" class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">class</span> <a title="class AdaptiveLoadBalancingMetricsListener extends AnyRef with akka.actor.Actor" id="akka.cluster.routing;AdaptiveLoadBalancingMetricsListener">AdaptiveLoadBalancingMetricsListener</a><a href="#akka.cluster.routing;AdaptiveLoadBalancingMetricsListener" title="akka.cluster.routing.AdaptiveLoadBalancingMetricsListener" class="delimiter">(</a><a title="akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic" id="akka.cluster.routing;AdaptiveLoadBalancingMetricsListener.routingLogic">routingLogic</a>: <a href="#akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic">AdaptiveLoadBalancingRoutingLogic</a><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="../../../akka-actor/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="delimiter">{</span>

  <span class="keyword">val</span> <a title="akka.cluster.Cluster" id="akka.cluster.routing;AdaptiveLoadBalancingMetricsListener.cluster">cluster</a> = <a href="../../../akka-actor/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="../../../akka-actor/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../akka-actor/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.cluster.routing;AdaptiveLoadBalancingMetricsListener.preStart">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.cluster.routing;AdaptiveLoadBalancingMetricsListener.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../Cluster.scala.html#akka.cluster;Cluster.subscribe(6cfb44d410)" title="(subscriber: akka.actor.ActorRef, to: Class[_]*)Unit">subscribe</a><span class="delimiter">(</span><a href="../../../akka-actor/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, classOf<span title="Class[akka.cluster.ClusterEvent.ClusterMetricsChanged](classOf[akka.cluster.ClusterEvent$$ClusterMetricsChanged])" class="delimiter">[</span>ClusterMetricsChanged<span class="delimiter">]</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.cluster.routing;AdaptiveLoadBalancingMetricsListener.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.cluster.routing;AdaptiveLoadBalancingMetricsListener.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../Cluster.scala.html#akka.cluster;Cluster.unsubscribe(134bd64d81)" title="(subscriber: akka.actor.ActorRef)Unit">unsubscribe</a><span class="delimiter">(</span><a href="../../../akka-actor/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; PartialFunction[Any,Unit]" id="akka.cluster.routing;AdaptiveLoadBalancingMetricsListener.receive">receive</a> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.routing;AdaptiveLoadBalancingMetricsListener.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> <a title="akka.cluster.ClusterEvent.ClusterMetricsChanged" id="akka.cluster.routing;AdaptiveLoadBalancingMetricsListener.receive;$anonfun.isDefinedAt.event">event</a>: <a href="../ClusterEvent.scala.html#akka.cluster.ClusterEvent;ClusterMetricsChanged" title="akka.cluster.ClusterEvent.ClusterMetricsChanged">ClusterMetricsChanged</a> ⇒ <a href="#akka.cluster.routing;AdaptiveLoadBalancingMetricsListener.routingLogic" title="akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic">routingLogic</a>.<a href="#akka.cluster.routing;AdaptiveLoadBalancingRoutingLogic.metricsChanged" title="(event: akka.cluster.ClusterEvent.ClusterMetricsChanged)Unit">metricsChanged</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingMetricsListener.receive;$anonfun.isDefinedAt.event" title="akka.cluster.ClusterEvent.ClusterMetricsChanged">event</a><span class="delimiter">)</span>
    <span class="keyword">case</span> _: <a href="../ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState" title="akka.cluster.ClusterEvent.CurrentClusterState">CurrentClusterState</a>       ⇒ <span class="comment">// ignore</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * A Router that performs load balancing of messages to cluster nodes based on
 * cluster metric data.
 *
 * It uses random selection of routees based on probabilities derived from
 * the remaining capacity of corresponding node.
 *
 * Please note that providing both 'nrOfInstances' and 'routees' does not make logical
 * sense as this means that the router should both create new actors and use the 'routees'
 * actor(s). In this case the 'nrOfInstances' will be ignored and the 'routees' will be used.
 * &lt;br&gt;
 * &lt;b&gt;The&lt;/b&gt; configuration parameter trumps the constructor arguments. This means that
 * if you provide either 'nrOfInstances' or 'routees' during instantiation they will
 * be ignored if the router is defined in the configuration file for the actor being used.
 *
 * &lt;h1&gt;Supervision Setup&lt;/h1&gt;
 *
 * Any routees that are created by a router will be created as the router's children.
 * The router is therefore also the children's supervisor.
 *
 * The supervision strategy of the router actor can be configured with
 * [[#withSupervisorStrategy]]. If no strategy is provided, routers default to
 * a strategy of “always escalate”. This means that errors are passed up to the
 * router's supervisor for handling.
 *
 * The router's supervisor will treat the error as an error with the router itself.
 * Therefore a directive to stop or restart will cause the router itself to stop or
 * restart. The router, in turn, will cause its children to stop and restart.
 *
 * @param metricsSelector decides what probability to use for selecting a routee, based
 *   on remaining capacity as indicated by the node metrics
 * @param routees string representation of the actor paths of the routees that will be looked up
 *   using `actorFor` in [[akka.actor.ActorRefProvider]]
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
@deprecated<span class="delimiter">(</span><span class="string">&quot;Use AdaptiveLoadBalancingPool or AdaptiveLoadBalancingGroup&quot;</span>, <span class="string">&quot;2.3&quot;</span><span class="delimiter">)</span>
<span class="keyword">case class</span> <a title="class AdaptiveLoadBalancingRouter extends AnyRef with akka.routing.DeprecatedRouterConfig with akka.routing.PoolOverrideUnsetConfig[akka.cluster.routing.AdaptiveLoadBalancingRouter] with Product with Serializable" id="akka.cluster.routing.AdaptiveLoadBalancingRouter.readResolve">AdaptiveLoadBalancingRouter</a><a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.readResolve" title="Product" class="delimiter">(</a>
  <a title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$1">metricsSelector</a>: <a href="#akka.cluster.routing;MetricsSelector" title="akka.cluster.routing.MetricsSelector">MetricsSelector</a> = <a href="#akka.cluster.routing.MixMetricsSelector.readResolve" title="akka.cluster.routing.MixMetricsSelector.type">MixMetricsSelector</a>,
  <a title="Int" id="akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$2">nrOfInstances</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>, <a title="scala.collection.immutable.Iterable[String]" id="akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$3">routees</a>: immutable.<span title="scala.collection.immutable.Iterable[String]">Iterable</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span title="scala.collection.immutable.Nil.type">Nil</span>,
  <span class="keyword">override</span> <span class="keyword">val</span> <a title="Option[akka.routing.Resizer]" id="akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$4">resizer</a>: <span title="Option[akka.routing.Resizer]">Option</span><span class="delimiter">[</span>Resizer<span class="delimiter">]</span> = <span title="None.type">None</span>,
  <span class="keyword">val</span> <a title="String" id="akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$5">routerDispatcher</a>: <span title="String">String</span> = Dispatchers.<span title="String(&quot;akka.actor.default-dispatcher&quot;)">DefaultDispatcherId</span>,
  <span class="keyword">val</span> <a title="akka.actor.SupervisorStrategy" id="akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$6">supervisorStrategy</a>: <a href="../../../akka-actor/actor/FaultHandling.scala.html#akka.actor;SupervisorStrategy" title="akka.actor.SupervisorStrategy">SupervisorStrategy</a> = <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing.Pool" title="akka.routing.Pool.type">Pool</a>.<a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing.Pool.defaultSupervisorStrategy" title="=&gt; akka.actor.SupervisorStrategy">defaultSupervisorStrategy</a><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="../../../akka-actor/routing/DeprecatedRouting.scala.html#akka.routing;DeprecatedRouterConfig" title="akka.routing.DeprecatedRouterConfig">DeprecatedRouterConfig</a> <span class="keyword">with</span> <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing;PoolOverrideUnsetConfig" title="akka.routing.PoolOverrideUnsetConfig[akka.cluster.routing.AdaptiveLoadBalancingRouter]">PoolOverrideUnsetConfig</a><span class="delimiter">[</span>AdaptiveLoadBalancingRouter<span class="delimiter">]</span> <span class="delimiter">{</span>

  <span class="comment">/**
   * Java API: Constructor that sets nrOfInstances to be created.
   *
   * @param selector the selector is responsible for producing weighted mix of routees from the node metrics
   * @param nr number of routees to create
   */</span>
  <span class="keyword">def</span> <a title="(selector: akka.cluster.routing.MetricsSelector, nr: Int)akka.cluster.routing.AdaptiveLoadBalancingRouter" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(1b0735752a)" class="keyword">this</a><span class="delimiter">(</span><a title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(1b0735752a).selector">selector</a>: <a href="#akka.cluster.routing;MetricsSelector" title="akka.cluster.routing.MetricsSelector">MetricsSelector</a>, <a title="Int" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(1b0735752a).nr">nr</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.readResolve" title="AdaptiveLoadBalancingRouter.this.type" class="keyword">this</a><span class="delimiter">(</span>metricsSelector = <a href="#akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(1b0735752a).selector" title="akka.cluster.routing.MetricsSelector">selector</a>, nrOfInstances = <a href="#akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(1b0735752a).nr" title="Int">nr</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API: Constructor that sets the routees to be used.
   *
   * @param selector the selector is responsible for producing weighted mix of routees from the node metrics
   * @param routeesPaths string representation of the actor paths of the routees that will be looked up
   *   using `actorFor` in [[akka.actor.ActorRefProvider]]
   */</span>
  <span class="keyword">def</span> <a title="(selector: akka.cluster.routing.MetricsSelector, routeesPaths: Iterable[String])akka.cluster.routing.AdaptiveLoadBalancingRouter" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(53798fe17c)" class="keyword">this</a><span class="delimiter">(</span><a title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(53798fe17c).selector">selector</a>: <a href="#akka.cluster.routing;MetricsSelector" title="akka.cluster.routing.MetricsSelector">MetricsSelector</a>, <a title="Iterable[String]" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(53798fe17c).routeesPaths">routeesPaths</a>: java.lang.<span title="Iterable[String]">Iterable</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$2" title="Int" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(53798fe17c).x$35" class="keyword">this</a><span class="delimiter">(</span>metricsSelector = <a href="#akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(53798fe17c).selector" title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(53798fe17c).x$30">selector</a>, routees = <a href="../../../akka-actor/japi/JavaAPI.scala.html#akka.japi.Util.immutableSeq(42d3e3f9ec)" title="(iterable: Iterable[String])scala.collection.immutable.Seq[String]">immutableSeq</a><a title="scala.collection.immutable.Seq[String]" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(53798fe17c).x$31" class="delimiter">(</a><a href="#akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(53798fe17c).routeesPaths" title="Iterable[String]">routeesPaths</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API: Constructor that sets the resizer to be used.
   *
   * @param selector the selector is responsible for producing weighted mix of routees from the node metrics
   */</span>
  <span class="keyword">def</span> <a title="(selector: akka.cluster.routing.MetricsSelector, resizer: akka.routing.Resizer)akka.cluster.routing.AdaptiveLoadBalancingRouter" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(bb249cfa7f)" class="keyword">this</a><span class="delimiter">(</span><a title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(bb249cfa7f).selector">selector</a>: <a href="#akka.cluster.routing;MetricsSelector" title="akka.cluster.routing.MetricsSelector">MetricsSelector</a>, <a title="akka.routing.Resizer" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(bb249cfa7f).resizer">resizer</a>: <a href="../../../akka-actor/routing/Resizer.scala.html#akka.routing;Resizer" title="akka.routing.Resizer">Resizer</a><span class="delimiter">)</span> =
    <a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$2" title="Int" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(bb249cfa7f).x$41" class="keyword">this</a><span class="delimiter">(</span>metricsSelector = <a href="#akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(bb249cfa7f).selector" title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(bb249cfa7f).x$36">selector</a>, resizer = <span title="(x: akka.routing.Resizer)Some[akka.routing.Resizer]">Some</span><a title="Some[akka.routing.Resizer]" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(bb249cfa7f).x$37" class="delimiter">(</a><a href="#akka.cluster.routing;AdaptiveLoadBalancingRouter.<init>(bb249cfa7f).resizer" title="akka.routing.Resizer">resizer</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.immutable.Iterable[String]" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.paths">paths</a>: immutable.<span title="scala.collection.immutable.Iterable[String]">Iterable</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$3" title="=&gt; scala.collection.immutable.Iterable[String]">routees</a>

  <span class="comment">/**
   * Java API for setting routerDispatcher
   */</span>
  <span class="keyword">def</span> <a title="(dispatcherId: String)akka.cluster.routing.AdaptiveLoadBalancingRouter" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.withDispatcher">withDispatcher</a><span class="delimiter">(</span><a title="String" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.withDispatcher.dispatcherId">dispatcherId</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingRouter">AdaptiveLoadBalancingRouter</a> =
    <a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$1" title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.withDispatcher.x$47">copy</a><span class="delimiter">(</span>routerDispatcher = <a href="#akka.cluster.routing;AdaptiveLoadBalancingRouter.withDispatcher.dispatcherId" title="String" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.withDispatcher.x$42">dispatcherId</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API for setting the supervisor strategy to be used for the “head”
   * Router actor.
   */</span>
  <span class="keyword">def</span> <a title="(strategy: akka.actor.SupervisorStrategy)akka.cluster.routing.AdaptiveLoadBalancingRouter" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.withSupervisorStrategy">withSupervisorStrategy</a><span class="delimiter">(</span><a title="akka.actor.SupervisorStrategy" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.withSupervisorStrategy.strategy">strategy</a>: <a href="../../../akka-actor/actor/FaultHandling.scala.html#akka.actor;SupervisorStrategy" title="akka.actor.SupervisorStrategy">SupervisorStrategy</a><span class="delimiter">)</span>: <a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingRouter">AdaptiveLoadBalancingRouter</a> =
    <a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$1" title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.withSupervisorStrategy.x$53">copy</a><span class="delimiter">(</span>supervisorStrategy = <a href="#akka.cluster.routing;AdaptiveLoadBalancingRouter.withSupervisorStrategy.strategy" title="akka.actor.SupervisorStrategy" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.withSupervisorStrategy.x$48">strategy</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API for setting the resizer to be used.
   */</span>
  <span class="keyword">def</span> <a title="(resizer: akka.routing.Resizer)akka.cluster.routing.AdaptiveLoadBalancingRouter" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.withResizer">withResizer</a><span class="delimiter">(</span><a title="akka.routing.Resizer" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.withResizer.resizer">resizer</a>: <a href="../../../akka-actor/routing/Resizer.scala.html#akka.routing;Resizer" title="akka.routing.Resizer">Resizer</a><span class="delimiter">)</span>: <a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingRouter">AdaptiveLoadBalancingRouter</a> = <a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$1" title="akka.cluster.routing.MetricsSelector" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.withResizer.x$59">copy</a><span class="delimiter">(</span>resizer = <span title="(x: akka.routing.Resizer)Some[akka.routing.Resizer]">Some</span><a title="Some[akka.routing.Resizer]" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.withResizer.x$54" class="delimiter">(</a><a href="#akka.cluster.routing;AdaptiveLoadBalancingRouter.withResizer.resizer" title="akka.routing.Resizer">resizer</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Uses the resizer and/or the supervisor strategy of the given Routerconfig
   * if this RouterConfig doesn't have one, i.e. the resizer defined in code is used if
   * resizer was not defined in config.
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(other: akka.routing.RouterConfig)akka.routing.RouterConfig" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.withFallback">withFallback</a><span class="delimiter">(</span><a title="akka.routing.RouterConfig" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.withFallback.other">other</a>: <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing;RouterConfig" title="akka.routing.RouterConfig">RouterConfig</a><span class="delimiter">)</span>: <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing;RouterConfig" title="akka.routing.RouterConfig">RouterConfig</a> = <a href="#akka.cluster.routing;AdaptiveLoadBalancingRouter.withFallback.other" title="akka.routing.RouterConfig">other</a> <span title="akka.routing.RouterConfig" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> _: <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing;FromConfig" title="akka.routing.FromConfig">FromConfig</a> | _: <a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing;NoRouter" title="akka.routing.NoRouter">NoRouter</a> | _: <a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingRouter">AdaptiveLoadBalancingRouter</a> ⇒ <a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.readResolve" title="AdaptiveLoadBalancingRouter.this.type" class="keyword">this</a>.<a href="../../../akka-actor/routing/RouterConfig.scala.html#akka.routing;PoolOverrideUnsetConfig.overrideUnsetConfig" title="(other: akka.routing.RouterConfig)akka.routing.RouterConfig">overrideUnsetConfig</a><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRouter.withFallback.other" title="akka.routing.RouterConfig">other</a><span class="delimiter">)</span>
    <span class="keyword">case</span> _ ⇒ <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IllegalArgumentException" class="keyword">new</span> <span title="IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Expected AdaptiveLoadBalancingRouter, got [%s]&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRouter.withFallback.other" title="akka.routing.RouterConfig">other</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(system: akka.actor.ActorSystem)akka.routing.Router" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.createRouter">createRouter</a><span class="delimiter">(</span><a title="akka.actor.ActorSystem" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.createRouter.system">system</a>: <a href="../../../akka-actor/actor/ActorSystem.scala.html#akka.actor;ActorSystem" title="akka.actor.ActorSystem">ActorSystem</a><span class="delimiter">)</span>: <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;Router" title="akka.routing.Router">Router</a> =
    <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;Router.<init>(e072339920)" title="(logic: akka.routing.RoutingLogic)akka.routing.Router" class="keyword">new</a> <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;Router" title="akka.routing.Router">Router</a><span class="delimiter">(</span><a href="#akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic.readResolve" title="(system: akka.actor.ActorSystem, metricsSelector: akka.cluster.routing.MetricsSelector)akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic">AdaptiveLoadBalancingRoutingLogic</a><span class="delimiter">(</span><a href="#akka.cluster.routing;AdaptiveLoadBalancingRouter.createRouter.system" title="akka.actor.ActorSystem">system</a>, <a href="#akka.cluster.routing.AdaptiveLoadBalancingRouter.apply$default$1" title="=&gt; akka.cluster.routing.MetricsSelector">metricsSelector</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(routingLogic: akka.routing.RoutingLogic)Option[akka.actor.Props]" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.routingLogicController">routingLogicController</a><span class="delimiter">(</span><a title="akka.routing.RoutingLogic" id="akka.cluster.routing;AdaptiveLoadBalancingRouter.routingLogicController.routingLogic">routingLogic</a>: <a href="../../../akka-actor/routing/Router.scala.html#akka.routing;RoutingLogic" title="akka.routing.RoutingLogic">RoutingLogic</a><span class="delimiter">)</span>: <span title="Option[akka.actor.Props]">Option</span><span class="delimiter">[</span>Props<span class="delimiter">]</span> =
    <span title="(x: akka.actor.Props)Some[akka.actor.Props]">Some</span><span class="delimiter">(</span><a href="../../../akka-actor/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.cluster.routing.AdaptiveLoadBalancingMetricsListener](classOf[akka.cluster.routing.AdaptiveLoadBalancingMetricsListener])" class="delimiter">[</span>AdaptiveLoadBalancingMetricsListener<span class="delimiter">]</span>,
      <a href="#akka.cluster.routing;AdaptiveLoadBalancingRouter.routingLogicController.routingLogic" title="akka.routing.RoutingLogic">routingLogic</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic" class="delimiter">[</span><a href="#akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic.readResolve" title="akka.cluster.routing.AdaptiveLoadBalancingRoutingLogic">AdaptiveLoadBalancingRoutingLogic</a><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>

<span class="delimiter">}</span>
        </pre>
    </body>
</html>
