<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>file-mailbox/akka/actor/mailbox/filebased/filequeue/tools/QDumper.scala</title>
        <script type="text/javascript" src="../../../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright 2009 Twitter, Inc.
 * Copyright 2009 Robey Pointer &lt;robeypointer@gmail.com&gt;
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may
 * not use this file except in compliance with the License. You may obtain
 * a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> akka.actor.mailbox.filebased.filequeue.tools

<span class="keyword">import</span> <span title="language.type">language</span>.reflectiveCalls

<span class="keyword">import</span> java.io.<span class="delimiter">{</span> FileNotFoundException, IOException <span class="delimiter">}</span>
<span class="keyword">import</span> scala.collection.mutable
<span class="keyword">import</span> akka.actor.mailbox.filebased.filequeue._
<span class="keyword">import</span> akka.event.LoggingAdapter
<span class="keyword">import</span> akka.actor.ActorSystem

@deprecated<span class="delimiter">(</span><span class="string">&quot;durable mailboxes are superseded by akka-persistence&quot;</span>, <span class="string">&quot;2.3&quot;</span><span class="delimiter">)</span>
<span class="keyword">class</span> <a title="class QueueDumper extends AnyRef" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper">QueueDumper</a><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper" title="akka.actor.mailbox.filebased.filequeue.tools.QueueDumper" class="delimiter">(</a><a title="String" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.filename">filename</a>: <span title="String">String</span>, <a title="akka.event.LoggingAdapter" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.log">log</a>: <a href="../../../../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter" title="akka.event.LoggingAdapter">LoggingAdapter</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">var</span> <a title="Long" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.offset_=">offset</a> = <span title="Long(0L)" class="long">0L</span>
  <span class="keyword">var</span> <a title="Long" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.operations_=">operations</a> = <span title="Long(0L)" class="long">0L</span>
  <span class="keyword">var</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.currentXid_=">currentXid</a> = <span title="Int(0)" class="int">0</span>

  <span class="keyword">val</span> <a title="queue extends scala.collection.mutable.Queue[Int]" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.queue">queue</a> = <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.queue;$anon" title="scala.collection.mutable.Queue[Int]{def unget(item: Int): Unit}" class="keyword">new</a> <a title="anonymous class $anon extends scala.collection.mutable.Queue[Int]" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.queue;$anon">mutable</a>.<span title="scala.collection.mutable.Queue[Int]">Queue</span><span class="delimiter">[</span>Int<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(item: Int)Unit" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.queue;$anon.unget">unget</a><span class="delimiter">(</span><a title="Int" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.queue;$anon.unget.item">item</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.queue;$anon" title="(elem: Int)Unit">prependElem</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.queue;$anon.unget.item" title="Int">item</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[Int,Int]" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.openTransactions">openTransactions</a> = <span title="()scala.collection.mutable.HashMap[Int,Int]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashMap[Int,Int]">HashMap</span><span class="delimiter">[</span>Int, Int<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply">apply</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="akka.actor.mailbox.filebased.filequeue.Journal" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.journal">journal</a> = <span title="akka.actor.mailbox.filebased.filequeue.Journal" class="keyword">new</span> <a href="../Journal.scala.html#akka.actor.mailbox.filebased.filequeue;Journal" title="akka.actor.mailbox.filebased.filequeue.Journal">Journal</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.filename" title="String">filename</a>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.log" title="akka.event.LoggingAdapter">log</a><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="Long" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.lastDisplay">lastDisplay</a> = <span title="Long(0L)" class="long">0L</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><span class="delimiter">(</span><a title="akka.actor.mailbox.filebased.filequeue.JournalItem" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.$anonfun.item">item</a>, <a title="Int" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.$anonfun.itemsize">itemsize</a><span class="delimiter">)</span> ← <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.journal" title="akka.actor.mailbox.filebased.filequeue.Journal">journal</a>.<a href="../Journal.scala.html#akka.actor.mailbox.filebased.filequeue;Journal.walk" title="()Iterator[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]{val in: java.nio.channels.FileChannel; def done: Boolean; def done_=(x$1: Boolean): Unit; def nextItem: Option[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]; def nextItem_=(x$1: Option[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]): Unit}">walk</a><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.$anonfun.check$ifrefutable$1" title="(f: ((akka.actor.mailbox.filebased.filequeue.JournalItem, Int)) =&gt; Unit)Unit" class="delimiter">(</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.operations_=" title="(x$1: Long)Unit">operations</a> <span title="(x: Int)Long">+=</span> <span title="Int(1)" class="int">1</span>
        <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem" title="(item: akka.actor.mailbox.filebased.filequeue.JournalItem)Unit">dumpItem</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.$anonfun.item" title="akka.actor.mailbox.filebased.filequeue.JournalItem">item</a><span class="delimiter">)</span>
        <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.offset_=" title="(x$1: Long)Unit">offset</a> <span title="(x: Int)Long">+=</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.$anonfun.itemsize" title="Int">itemsize</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper" title="akka.actor.mailbox.filebased.filequeue.tools.QDumper.type">QDumper</a>.<a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.quiet_=" title="=&gt; Boolean">quiet</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.offset_=" title="=&gt; Long">offset</a> <span title="(x: Long)Long">-</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.lastDisplay" title="Long">lastDisplay</a> <span title="(x: Int)Boolean">&gt;</span> <span class="int">1024</span> <span title="Int(1048576)">*</span> <span class="int">1024</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="(x: Any)Unit">print</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;\rReading journal: %-6s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="Util.scala.html#akka.actor.mailbox.filebased.filequeue.tools.Util" title="akka.actor.mailbox.filebased.filequeue.tools.Util.type">Util</a>.<a href="Util.scala.html#akka.actor.mailbox.filebased.filequeue.tools.Util.bytesToHuman" title="(bytes: Long, minDivisor: Long)String">bytesToHuman</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.offset_=" title="=&gt; Long">offset</a>, <span title="Long(0L)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Console.type">Console</span>.<span title="()Unit">flush</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.lastDisplay" title="Long">lastDisplay</a> = <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.offset_=" title="=&gt; Long">offset</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span title="(x: Any)Unit">print</span><span class="delimiter">(</span><span title="String(&quot;\r&quot;)" class="string">&quot;\r&quot;</span> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot; &quot;</span> <span title="(n: Int)String">*</span> <span title="Int(30)" class="int">30</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span title="()Unit">println</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.totalItems">totalItems</a> = <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.queue" title="=&gt; scala.collection.mutable.Queue[Int]{def unget(item: Int): Unit}">queue</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">+</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.openTransactions" title="=&gt; scala.collection.mutable.HashMap[Int,Int]">openTransactions</a>.<span title="=&gt; Int">size</span>
      <span class="keyword">val</span> <a title="Long" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.totalBytes">totalBytes</a> = <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.queue" title="=&gt; scala.collection.mutable.Queue[Int]{def unget(item: Int): Unit}">queue</a>.<span title="(z: Long)(f: (Long, Int) =&gt; Long)Long">foldLeft</span><span class="delimiter">(</span><span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.totalBytes.$anonfun.x$2" title="Long">_</a> <span title="(x: Int)Long">+</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.totalBytes.$anonfun.x$3" title="Int">_</a> <span class="delimiter">}</span> <span title="(x: Long)Long">+</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.openTransactions" title="=&gt; scala.collection.mutable.HashMap[Int,Int]">openTransactions</a>.<span title="=&gt; Iterable[Int]">values</span>.<span title="(z: Long)(op: (Long, Int) =&gt; Long)Long">foldLeft</span><span class="delimiter">(</span><span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.totalBytes.$anonfun.x$4" title="Long">_</a> <span title="(x: Int)Long">+</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.totalBytes.$anonfun.x$5" title="Int">_</a> <span class="delimiter">}</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Journal size: %d bytes, with %d operations.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.offset_=" title="=&gt; Long">offset</a>, <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.operations_=" title="=&gt; Long">operations</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%d items totalling %d bytes.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.totalItems" title="Int">totalItems</a>, <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply.totalBytes" title="Long">totalBytes</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="java.io.FileNotFoundException">e</span>: <span title="java.io.FileNotFoundException">FileNotFoundException</span> ⇒
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;Can\'t open journal file: &quot;)" class="string">&quot;Can't open journal file: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.filename" title="String">filename</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="java.io.IOException">e</span>: <span title="java.io.IOException">IOException</span> ⇒
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;Exception reading journal file: &quot;)" class="string">&quot;Exception reading journal file: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.filename" title="String">filename</a><span class="delimiter">)</span>
        <span title="java.io.IOException">e</span>.<span title="()Unit">printStackTrace</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(item: akka.actor.mailbox.filebased.filequeue.JournalItem)Unit" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem">dumpItem</a><span class="delimiter">(</span><a title="akka.actor.mailbox.filebased.filequeue.JournalItem" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.item">item</a>: <a href="../Journal.scala.html#akka.actor.mailbox.filebased.filequeue;JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem">JournalItem</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Long" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.now">now</a> = <span title="System.type">System</span>.<span title="()Long">currentTimeMillis</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper" title="akka.actor.mailbox.filebased.filequeue.tools.QDumper.type">QDumper</a>.<a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.quiet_=" title="=&gt; Boolean">quiet</a><span class="delimiter">)</span> <span title="(x: Any)Unit">print</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%08x  &quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.offset_=" title="=&gt; Long">offset</a> <span title="(x: Long)Long">&amp;</span> <span title="Long(4294967295L)" class="long">0xffffffffL</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.item" title="akka.actor.mailbox.filebased.filequeue.JournalItem">item</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> JournalItem.Add<span class="delimiter">(</span><a title="akka.actor.mailbox.filebased.filequeue.QItem" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.qitem">qitem</a><span class="delimiter">)</span> ⇒
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper" title="akka.actor.mailbox.filebased.filequeue.tools.QDumper.type">QDumper</a>.<a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.quiet_=" title="=&gt; Boolean">quiet</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="(x: Any)Unit">print</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;ADD %-6d&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.qitem" title="akka.actor.mailbox.filebased.filequeue.QItem">qitem</a>.<a href="../QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem.data" title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">data</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.qitem" title="akka.actor.mailbox.filebased.filequeue.QItem">qitem</a>.<a href="../QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem.xid" title="=&gt; Int">xid</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="(x: Any)Unit">print</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot; xid=%d&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.qitem" title="akka.actor.mailbox.filebased.filequeue.QItem">qitem</a>.<a href="../QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem.xid" title="=&gt; Int">xid</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.qitem" title="akka.actor.mailbox.filebased.filequeue.QItem">qitem</a>.<a href="../QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem.expiry" title="=&gt; Long">expiry</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.qitem" title="akka.actor.mailbox.filebased.filequeue.QItem">qitem</a>.<a href="../QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem.expiry" title="=&gt; Long">expiry</a> <span title="(x: Long)Long">-</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.now" title="Long">now</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span title="(x: Any)Unit">print</span><span class="delimiter">(</span><span title="String(&quot; expired&quot;)" class="string">&quot; expired&quot;</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
              <span title="(x: Any)Unit">print</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot; exp=%d&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.qitem" title="akka.actor.mailbox.filebased.filequeue.QItem">qitem</a>.<a href="../QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem.expiry" title="=&gt; Long">expiry</a> <span title="(x: Long)Long">-</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.now" title="Long">now</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
          <span title="()Unit">println</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.queue" title="=&gt; scala.collection.mutable.Queue[Int]{def unget(item: Int): Unit}">queue</a> <span title="(elem: Int)akka.actor.mailbox.filebased.filequeue.tools.QueueDumper.&lt;refinement&gt;.type">+=</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.qitem" title="akka.actor.mailbox.filebased.filequeue.QItem">qitem</a>.<a href="../QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem.data" title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">data</a>.<span title="=&gt; Int">size</span>
      <span class="keyword">case</span> <a href="../Journal.scala.html#akka.actor.mailbox.filebased.filequeue.JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem.type">JournalItem</a>.<a href="../Journal.scala.html#akka.actor.mailbox.filebased.filequeue.JournalItem.Remove" title="akka.actor.mailbox.filebased.filequeue.JournalItem.Remove.type">Remove</a> ⇒
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper" title="akka.actor.mailbox.filebased.filequeue.tools.QDumper.type">QDumper</a>.<a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.quiet_=" title="=&gt; Boolean">quiet</a><span class="delimiter">)</span> <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;REM&quot;)" class="string">&quot;REM&quot;</span><span class="delimiter">)</span>
        <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.queue" title="=&gt; scala.collection.mutable.Queue[Int]{def unget(item: Int): Unit}">queue</a>.<span title="()Int">dequeue</span>
      <span class="keyword">case</span> <a href="../Journal.scala.html#akka.actor.mailbox.filebased.filequeue.JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem.type">JournalItem</a>.<a href="../Journal.scala.html#akka.actor.mailbox.filebased.filequeue.JournalItem.RemoveTentative" title="akka.actor.mailbox.filebased.filequeue.JournalItem.RemoveTentative.type">RemoveTentative</a> ⇒
        <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.doWhile$1" title="Unit" class="keyword">do</a> <span class="delimiter">{</span>
          <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.currentXid_=" title="(x$1: Int)Unit">currentXid</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
        <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.openTransactions" title="=&gt; scala.collection.mutable.HashMap[Int,Int]">openTransactions</a> <span title="(key: Int)Boolean">contains</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.currentXid_=" title="=&gt; Int">currentXid</a><span class="delimiter">)</span>
        <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.openTransactions" title="(key: Int, value: Int)Unit">openTransactions</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.currentXid_=" title="=&gt; Int">currentXid</a><span class="delimiter">)</span> = <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.queue" title="=&gt; scala.collection.mutable.Queue[Int]{def unget(item: Int): Unit}">queue</a>.<span title="()Int">dequeue</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper" title="akka.actor.mailbox.filebased.filequeue.tools.QDumper.type">QDumper</a>.<a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.quiet_=" title="=&gt; Boolean">quiet</a><span class="delimiter">)</span> <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;RSV %d&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.currentXid_=" title="=&gt; Int">currentXid</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> JournalItem.SavedXid<span class="delimiter">(</span><span title="Int">xid</span><span class="delimiter">)</span> ⇒
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper" title="akka.actor.mailbox.filebased.filequeue.tools.QDumper.type">QDumper</a>.<a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.quiet_=" title="=&gt; Boolean">quiet</a><span class="delimiter">)</span> <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;XID %d&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><span title="Int">xid</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.currentXid_=" title="(x$1: Int)Unit">currentXid</a> = <span title="Int">xid</span>
      <span class="keyword">case</span> JournalItem.Unremove<span class="delimiter">(</span><span title="Int">xid</span><span class="delimiter">)</span> ⇒
        <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.queue" title="=&gt; scala.collection.mutable.Queue[Int]{def unget(item: Int): Unit}">queue</a>.<a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.queue;<refinement>.unget" title="(item: Int)Unit">unget</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.openTransactions" title="=&gt; scala.collection.mutable.HashMap[Int,Int]">openTransactions</a>.<span title="(key: Int)Option[Int]">remove</span><span class="delimiter">(</span><span title="Int">xid</span><span class="delimiter">)</span>.<span title="=&gt; Int">get</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper" title="akka.actor.mailbox.filebased.filequeue.tools.QDumper.type">QDumper</a>.<a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.quiet_=" title="=&gt; Boolean">quiet</a><span class="delimiter">)</span> <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;CAN %d&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><span title="Int">xid</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> JournalItem.ConfirmRemove<span class="delimiter">(</span><span title="Int">xid</span><span class="delimiter">)</span> ⇒
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper" title="akka.actor.mailbox.filebased.filequeue.tools.QDumper.type">QDumper</a>.<a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.quiet_=" title="=&gt; Boolean">quiet</a><span class="delimiter">)</span> <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;ACK %d&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><span title="Int">xid</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.openTransactions" title="=&gt; scala.collection.mutable.HashMap[Int,Int]">openTransactions</a>.<span title="(key: Int)Option[Int]">remove</span><span title="Unit" class="delimiter">(</span><span title="Int">xid</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="akka.actor.mailbox.filebased.filequeue.JournalItem" id="akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.x">x</a> ⇒
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper" title="akka.actor.mailbox.filebased.filequeue.tools.QDumper.type">QDumper</a>.<a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.quiet_=" title="=&gt; Boolean">quiet</a><span class="delimiter">)</span> <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.dumpItem.x" title="akka.actor.mailbox.filebased.filequeue.JournalItem">x</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

@deprecated<span class="delimiter">(</span><span class="string">&quot;durable mailboxes are superseded by akka-persistence&quot;</span>, <span class="string">&quot;2.3&quot;</span><span class="delimiter">)</span>
<span class="keyword">object</span> <a title="akka.actor.mailbox.filebased.filequeue.tools.QDumper.type" id="akka.actor.mailbox.filebased.filequeue.tools.QDumper">QDumper</a> <a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper" title="akka.actor.mailbox.filebased.filequeue.tools.QDumper.type" class="delimiter">{</a>
  <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[String]" id="akka.actor.mailbox.filebased.filequeue.tools.QDumper.filenames">filenames</a> = <span title="scala.collection.mutable.ListBuffer[String]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.ListBuffer[String]">ListBuffer</span><span class="delimiter">[</span>String<span class="delimiter">]</span>
  <span class="keyword">var</span> <a title="Boolean" id="akka.actor.mailbox.filebased.filequeue.tools.QDumper.quiet_=">quiet</a> = <span title="Boolean(false)" class="keyword">false</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.actor.mailbox.filebased.filequeue.tools.QDumper.usage">usage</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="()Unit">println</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;usage: qdump.sh &lt;journal-files...&gt;&quot;)" class="string">&quot;usage: qdump.sh &lt;journal-files...&gt;&quot;</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;    describe the contents of a kestrel journal file&quot;)" class="string">&quot;    describe the contents of a kestrel journal file&quot;</span><span class="delimiter">)</span>
    <span title="()Unit">println</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;options:&quot;)" class="string">&quot;options:&quot;</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;    -q      quiet: don\'t describe every line, just the summary&quot;)" class="string">&quot;    -q      quiet: don't describe every line, just the summary&quot;</span><span class="delimiter">)</span>
    <span title="()Unit">println</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(args: List[String])Unit" id="akka.actor.mailbox.filebased.filequeue.tools.QDumper.parseArgs">parseArgs</a><span class="delimiter">(</span><a title="List[String]" id="akka.actor.mailbox.filebased.filequeue.tools.QDumper.parseArgs.args">args</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.parseArgs.args" title="List[String]">args</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="scala.collection.immutable.Nil.type">Nil</span> ⇒
    <span class="keyword">case</span> <span title="String(&quot;--help&quot;)" class="string">&quot;--help&quot;</span> :: <span title="List[String]">xs</span> ⇒
      <a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.usage" title="()Unit">usage</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="System.type">System</span>.<span title="(x$1: Int)Unit">exit</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="String(&quot;-q&quot;)" class="string">&quot;-q&quot;</span> :: <span title="List[String]">xs</span> ⇒
      <a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.quiet_=" title="(x$1: Boolean)Unit">quiet</a> = <span title="Boolean(true)" class="keyword">true</span>
      <a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.parseArgs" title="(args: List[String])Unit">parseArgs</a><span class="delimiter">(</span><span title="List[String]">xs</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="String" id="akka.actor.mailbox.filebased.filequeue.tools.QDumper.parseArgs.x">x</a> :: <span title="List[String]">xs</span> ⇒
      <a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.filenames" title="=&gt; scala.collection.mutable.ListBuffer[String]">filenames</a> <span title="(x: String)akka.actor.mailbox.filebased.filequeue.tools.QDumper.filenames.type">+=</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.parseArgs.x" title="String">x</a>
      <a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.parseArgs" title="(args: List[String])Unit">parseArgs</a><span class="delimiter">(</span><span title="List[String]">xs</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="akka.actor.mailbox.filebased.filequeue.tools.QDumper.main">main</a><span class="delimiter">(</span><a title="Array[String]" id="akka.actor.mailbox.filebased.filequeue.tools.QDumper.main.args">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.parseArgs" title="(args: List[String])Unit">parseArgs</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.main.args" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">args</a>.<span title="=&gt; List[String]">toList</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.filenames" title="=&gt; scala.collection.mutable.ListBuffer[String]">filenames</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.usage" title="()Unit">usage</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="System.type">System</span>.<span title="(x$1: Int)Unit">exit</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="akka.actor.ActorSystem" id="akka.actor.mailbox.filebased.filequeue.tools.QDumper.main.system">system</a> = <a href="../../../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor.ActorSystem.apply(912b4daa99)" title="()akka.actor.ActorSystem">ActorSystem</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">for</span> <span class="delimiter">(</span><a title="String" id="akka.actor.mailbox.filebased.filequeue.tools.QDumper.main.$anonfun.filename">filename</a> ← <a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.filenames" title="(f: String =&gt; Unit)Unit">filenames</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;Queue: &quot;)" class="string">&quot;Queue: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.main.$anonfun.filename" title="String">filename</a><span class="delimiter">)</span>
      <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper.apply" title="()Unit" class="keyword">new</a> <a href="#akka.actor.mailbox.filebased.filequeue.tools;QueueDumper" title="akka.actor.mailbox.filebased.filequeue.tools.QueueDumper">QueueDumper</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.main.$anonfun.filename" title="String">filename</a>, <a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.main.system" title="akka.actor.ActorSystem">system</a>.<a href="../../../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.log" title="=&gt; akka.event.LoggingAdapter">log</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#akka.actor.mailbox.filebased.filequeue.tools.QDumper.main.system" title="akka.actor.ActorSystem">system</a>.<a href="../../../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
