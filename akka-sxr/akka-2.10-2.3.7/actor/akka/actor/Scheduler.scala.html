<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>actor/akka/actor/Scheduler.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

<span class="keyword">package</span> akka.actor

<span class="keyword">import</span> java.io.Closeable
<span class="keyword">import</span> java.util.concurrent.ThreadFactory
<span class="keyword">import</span> java.util.concurrent.atomic.<span class="delimiter">{</span> AtomicLong, AtomicReference, AtomicReferenceArray <span class="delimiter">}</span>
<span class="keyword">import</span> scala.annotation.tailrec
<span class="keyword">import</span> scala.collection.immutable
<span class="keyword">import</span> scala.concurrent.<span class="delimiter">{</span> Await, ExecutionContext, Future, Promise <span class="delimiter">}</span>
<span class="keyword">import</span> scala.concurrent.duration._
<span class="keyword">import</span> scala.util.control.<span class="delimiter">{</span> NoStackTrace, NonFatal <span class="delimiter">}</span>
<span class="keyword">import</span> com.typesafe.config.Config
<span class="keyword">import</span> akka.event.LoggingAdapter
<span class="keyword">import</span> akka.util.Helpers
<span class="keyword">import</span> akka.util.<a href="../util/Unsafe.java.html#akka.util.Unsafe" title="akka.util.Unsafe.type">Unsafe</a>.<span class="delimiter">{</span> instance ⇒ unsafe <span class="delimiter">}</span>
<span class="keyword">import</span> akka.dispatch.AbstractNodeQueue

<span class="comment">/**
 * This exception is thrown by Scheduler.schedule* when scheduling is not
 * possible, e.g. after shutting down the Scheduler.
 */</span>
<span class="keyword">private</span> <span class="keyword">case class</span> <a title="class SchedulerException extends akka.AkkaException with scala.util.control.NoStackTrace with Product with Serializable" id="akka.actor.SchedulerException.readResolve">SchedulerException</a><a href="../AkkaException.scala.html#akka;AkkaException.<init>(2ecfebd739)" title="Product" class="delimiter">(</a><a title="String" id="akka.actor;SchedulerException.msg">msg</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> akka.<a href="../AkkaException.scala.html#akka;AkkaException" title="akka.AkkaException">AkkaException</a><span class="delimiter">(</span><a href="#akka.actor;SchedulerException.msg" title="String">msg</a><span class="delimiter">)</span> <span class="keyword">with</span> <span title="scala.util.control.NoStackTrace">NoStackTrace</span>

<span class="comment">// The Scheduler trait is included in the documentation. KEEP THE LINES SHORT!!!</span>
<span class="comment">//#scheduler</span>
<span class="comment">/**
 * An Akka scheduler service. This one needs one special behavior: if
 * Closeable, it MUST execute all outstanding tasks upon .close() in order
 * to properly shutdown all dispatchers.
 *
 * Furthermore, this timer service MUST throw IllegalStateException if it
 * cannot schedule a task. Once scheduled, the task MUST be executed. If
 * executed upon close(), the task may execute before its timeout.
 *
 * Scheduler implementation are loaded reflectively at ActorSystem start-up
 * with the following constructor arguments:
 *  1) the system’s com.typesafe.config.Config (from system.settings.config)
 *  2) a akka.event.LoggingAdapter
 *  3) a java.util.concurrent.ThreadFactory
 */</span>
<span class="keyword">trait</span> <a title="trait Scheduler extends AnyRef" id="akka.actor;Scheduler">Scheduler</a> <span title="Unit" class="delimiter">{</span>
  <span class="comment">/**
   * Schedules a message to be sent repeatedly with an initial delay and
   * frequency. E.g. if you would like a message to be sent immediately and
   * thereafter every 500ms you would set delay=Duration.Zero and
   * interval=Duration(500, TimeUnit.MILLISECONDS)
   *
   * Java &amp; Scala API
   */</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable" id="akka.actor;Scheduler.schedule(abf8206fc2)">schedule</a><span class="delimiter">(</span>
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;Scheduler.schedule$default$6.initialDelay">initialDelay</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;Scheduler.schedule$default$6.interval">interval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
    <a title="akka.actor.ActorRef" id="akka.actor;Scheduler.schedule$default$6.receiver">receiver</a>: <a href="ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>,
    <a title="Any" id="akka.actor;Scheduler.schedule$default$6.message">message</a>: <span title="Any">Any</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.ExecutionContext" id="akka.actor;Scheduler.schedule(abf8206fc2).executor">executor</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span>,
                  <a title="akka.actor.ActorRef" id="akka.actor;Scheduler.schedule$default$6">sender</a>: <a href="ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <a href="Actor.scala.html#akka.actor.Actor" title="akka.actor.Actor.type">Actor</a>.<a href="Actor.scala.html#akka.actor.Actor.noSender" title="=&gt; akka.actor.ActorRef">noSender</a><span class="delimiter">)</span>: <a href="#akka.actor;Cancellable" title="akka.actor.Cancellable">Cancellable</a> =
    <a href="#akka.actor;Scheduler.schedule(a868249cb6)" title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration, runnable: Runnable)(implicit executor: scala.concurrent.ExecutionContext)akka.actor.Cancellable">schedule</a><a href="#akka.actor;Scheduler.schedule(abf8206fc2).executor" title="scala.concurrent.ExecutionContext" class="delimiter">(</a><a href="#akka.actor;Scheduler.schedule$default$6.initialDelay" title="scala.concurrent.duration.FiniteDuration">initialDelay</a>, <a href="#akka.actor;Scheduler.schedule$default$6.interval" title="scala.concurrent.duration.FiniteDuration">interval</a>, <a href="#akka.actor;Scheduler.schedule(abf8206fc2);$anon" title="Runnable" class="keyword">new</a> <a title="anonymous class $anon extends Object with Runnable" id="akka.actor;Scheduler.schedule(abf8206fc2);$anon">Runnable</a> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="()Unit" id="akka.actor;Scheduler.schedule(abf8206fc2);$anon.run">run</a> = <span class="delimiter">{</span>
        <a href="package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">receiver</a> <a href="ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.actor;Scheduler.schedule$default$6.message" title="Any">message</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor;Scheduler.schedule$default$6.receiver" title="akka.actor.ActorRef">receiver</a>.<a href="ActorRef.scala.html#akka.actor;ActorRef.isTerminated" title="=&gt; Boolean">isTerminated</a><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">throw</span> <span title="akka.actor.SchedulerException" class="keyword">new</span> <a href="#akka.actor.SchedulerException.readResolve" title="akka.actor.SchedulerException">SchedulerException</a><span class="delimiter">(</span><span title="String(&quot;timer active for terminated actor&quot;)" class="string">&quot;timer active for terminated actor&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Schedules a function to be run repeatedly with an initial delay and a
   * frequency. E.g. if you would like the function to be run after 2 seconds
   * and thereafter every 100ms you would set delay = Duration(2, TimeUnit.SECONDS)
   * and interval = Duration(100, TimeUnit.MILLISECONDS)
   *
   * Scala API
   */</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration)(f: =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)akka.actor.Cancellable" id="akka.actor;Scheduler.schedule(4e983b3fde)">schedule</a><span class="delimiter">(</span>
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;Scheduler.schedule(4e983b3fde).initialDelay">initialDelay</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;Scheduler.schedule(4e983b3fde).interval">interval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; Unit" id="akka.actor;Scheduler.schedule(4e983b3fde).f">f</a>: ⇒ Unit<span class="delimiter">)</span><span class="delimiter">(</span>
      <span class="keyword">implicit</span> <a title="scala.concurrent.ExecutionContext" id="akka.actor;Scheduler.schedule(4e983b3fde).executor">executor</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span>: <a href="#akka.actor;Cancellable" title="akka.actor.Cancellable">Cancellable</a> =
    <a href="#akka.actor;Scheduler.schedule(a868249cb6)" title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration, runnable: Runnable)(implicit executor: scala.concurrent.ExecutionContext)akka.actor.Cancellable">schedule</a><a href="#akka.actor;Scheduler.schedule(4e983b3fde).executor" title="scala.concurrent.ExecutionContext" class="delimiter">(</a><a href="#akka.actor;Scheduler.schedule(4e983b3fde).initialDelay" title="scala.concurrent.duration.FiniteDuration">initialDelay</a>, <a href="#akka.actor;Scheduler.schedule(4e983b3fde).interval" title="scala.concurrent.duration.FiniteDuration">interval</a>, <a href="#akka.actor;Scheduler.schedule(4e983b3fde);$anon" title="Runnable" class="keyword">new</a> <a title="anonymous class $anon extends Object with Runnable" id="akka.actor;Scheduler.schedule(4e983b3fde);$anon">Runnable</a> <span class="delimiter">{</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor;Scheduler.schedule(4e983b3fde);$anon.run">run</a> = <a href="#akka.actor;Scheduler.schedule(4e983b3fde).f" title="=&gt; Unit">f</a> <span class="delimiter">}</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Schedules a function to be run repeatedly with an initial delay and
   * a frequency. E.g. if you would like the function to be run after 2
   * seconds and thereafter every 100ms you would set delay = Duration(2,
   * TimeUnit.SECONDS) and interval = Duration(100, TimeUnit.MILLISECONDS)
   *
   * Java API
   */</span>
  <span class="keyword">def</span> <a title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration, runnable: Runnable)(implicit executor: scala.concurrent.ExecutionContext)akka.actor.Cancellable" id="akka.actor;Scheduler.schedule(a868249cb6)">schedule</a><span class="delimiter">(</span>
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;Scheduler.schedule(a868249cb6).initialDelay">initialDelay</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;Scheduler.schedule(a868249cb6).interval">interval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
    <a title="Runnable" id="akka.actor;Scheduler.schedule(a868249cb6).runnable">runnable</a>: <span title="Runnable">Runnable</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.ExecutionContext" id="akka.actor;Scheduler.schedule(a868249cb6).executor">executor</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span>: <a href="#akka.actor;Cancellable" title="akka.actor.Cancellable">Cancellable</a>

  <span class="comment">/**
   * Schedules a message to be sent once with a delay, i.e. a time period that has
   * to pass before the message is sent.
   *
   * Java &amp; Scala API
   */</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(delay: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable" id="akka.actor;Scheduler.scheduleOnce(a2d55b51db)">scheduleOnce</a><span class="delimiter">(</span>
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;Scheduler.scheduleOnce$default$5.delay">delay</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
    <a title="akka.actor.ActorRef" id="akka.actor;Scheduler.scheduleOnce$default$5.receiver">receiver</a>: <a href="ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>,
    <a title="Any" id="akka.actor;Scheduler.scheduleOnce$default$5.message">message</a>: <span title="Any">Any</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.ExecutionContext" id="akka.actor;Scheduler.scheduleOnce(a2d55b51db).executor">executor</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span>,
                  <a title="akka.actor.ActorRef" id="akka.actor;Scheduler.scheduleOnce$default$5">sender</a>: <a href="ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <a href="Actor.scala.html#akka.actor.Actor" title="akka.actor.Actor.type">Actor</a>.<a href="Actor.scala.html#akka.actor.Actor.noSender" title="=&gt; akka.actor.ActorRef">noSender</a><span class="delimiter">)</span>: <a href="#akka.actor;Cancellable" title="akka.actor.Cancellable">Cancellable</a> =
    <a href="#akka.actor;Scheduler.scheduleOnce(8318e51182)" title="(delay: scala.concurrent.duration.FiniteDuration, runnable: Runnable)(implicit executor: scala.concurrent.ExecutionContext)akka.actor.Cancellable">scheduleOnce</a><a href="#akka.actor;Scheduler.scheduleOnce(a2d55b51db).executor" title="scala.concurrent.ExecutionContext" class="delimiter">(</a><a href="#akka.actor;Scheduler.scheduleOnce$default$5.delay" title="scala.concurrent.duration.FiniteDuration">delay</a>, <a href="#akka.actor;Scheduler.scheduleOnce(a2d55b51db);$anon" title="Runnable" class="keyword">new</a> <a title="anonymous class $anon extends Object with Runnable" id="akka.actor;Scheduler.scheduleOnce(a2d55b51db);$anon">Runnable</a> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor;Scheduler.scheduleOnce(a2d55b51db);$anon.run">run</a> = <a href="package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">receiver</a> <a href="ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.actor;Scheduler.scheduleOnce$default$5.message" title="Any">message</a>
    <span class="delimiter">}</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Schedules a function to be run once with a delay, i.e. a time period that has
   * to pass before the function is run.
   *
   * Scala API
   */</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(delay: scala.concurrent.duration.FiniteDuration)(f: =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)akka.actor.Cancellable" id="akka.actor;Scheduler.scheduleOnce(066d40b78a)">scheduleOnce</a><span class="delimiter">(</span><a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;Scheduler.scheduleOnce(066d40b78a).delay">delay</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; Unit" id="akka.actor;Scheduler.scheduleOnce(066d40b78a).f">f</a>: ⇒ Unit<span class="delimiter">)</span><span class="delimiter">(</span>
    <span class="keyword">implicit</span> <a title="scala.concurrent.ExecutionContext" id="akka.actor;Scheduler.scheduleOnce(066d40b78a).executor">executor</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span>: <a href="#akka.actor;Cancellable" title="akka.actor.Cancellable">Cancellable</a> =
    <a href="#akka.actor;Scheduler.scheduleOnce(8318e51182)" title="(delay: scala.concurrent.duration.FiniteDuration, runnable: Runnable)(implicit executor: scala.concurrent.ExecutionContext)akka.actor.Cancellable">scheduleOnce</a><a href="#akka.actor;Scheduler.scheduleOnce(066d40b78a).executor" title="scala.concurrent.ExecutionContext" class="delimiter">(</a><a href="#akka.actor;Scheduler.scheduleOnce(066d40b78a).delay" title="scala.concurrent.duration.FiniteDuration">delay</a>, <a href="#akka.actor;Scheduler.scheduleOnce(066d40b78a);$anon" title="Runnable" class="keyword">new</a> <a title="anonymous class $anon extends Object with Runnable" id="akka.actor;Scheduler.scheduleOnce(066d40b78a);$anon">Runnable</a> <span class="delimiter">{</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor;Scheduler.scheduleOnce(066d40b78a);$anon.run">run</a> = <a href="#akka.actor;Scheduler.scheduleOnce(066d40b78a).f" title="=&gt; Unit">f</a> <span class="delimiter">}</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Schedules a Runnable to be run once with a delay, i.e. a time period that
   * has to pass before the runnable is executed.
   *
   * Java &amp; Scala API
   */</span>
  <span class="keyword">def</span> <a title="(delay: scala.concurrent.duration.FiniteDuration, runnable: Runnable)(implicit executor: scala.concurrent.ExecutionContext)akka.actor.Cancellable" id="akka.actor;Scheduler.scheduleOnce(8318e51182)">scheduleOnce</a><span class="delimiter">(</span>
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;Scheduler.scheduleOnce(8318e51182).delay">delay</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
    <a title="Runnable" id="akka.actor;Scheduler.scheduleOnce(8318e51182).runnable">runnable</a>: <span title="Runnable">Runnable</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.ExecutionContext" id="akka.actor;Scheduler.scheduleOnce(8318e51182).executor">executor</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span>: <a href="#akka.actor;Cancellable" title="akka.actor.Cancellable">Cancellable</a>

  <span class="comment">/**
   * The maximum supported task frequency of this scheduler, i.e. the inverse
   * of the minimum time interval between executions of a recurring task, in Hz.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Double" id="akka.actor;Scheduler.maxFrequency">maxFrequency</a>: <span title="Double">Double</span>

<span class="delimiter">}</span>
<span class="comment">//#scheduler</span>

<span class="comment">// this one is just here so we can present a nice AbstractScheduler for Java</span>
<span title="AnyRef" class="keyword">abstract</span> <span class="keyword">class</span> <a title="class AbstractSchedulerBase extends AnyRef with akka.actor.Scheduler" id="akka.actor;AbstractSchedulerBase">AbstractSchedulerBase</a> <a href="#akka.actor;AbstractSchedulerBase" title="akka.actor.AbstractSchedulerBase" class="keyword">extends</a> <a href="#akka.actor;Scheduler" title="akka.actor.Scheduler">Scheduler</a>

<span class="comment">//#cancellable</span>
<span class="comment">/**
 * Signifies something that can be cancelled
 * There is no strict guarantee that the implementation is thread-safe,
 * but it should be good practice to make it so.
 */</span>
<span class="keyword">trait</span> <a title="trait Cancellable extends AnyRef" id="akka.actor;Cancellable">Cancellable</a> <span class="delimiter">{</span>
  <span class="comment">/**
   * Cancels this Cancellable and returns true if that was successful.
   * If this cancellable was (concurrently) cancelled already, then this method
   * will return false although isCancelled will return true.
   *
   * Java &amp; Scala API
   */</span>
  <span class="keyword">def</span> <a title="()Boolean" id="akka.actor;Cancellable.cancel">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span>

  <span class="comment">/**
   * Returns true if and only if this Cancellable has been successfully cancelled
   *
   * Java &amp; Scala API
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="akka.actor;Cancellable.isCancelled">isCancelled</a>: <span title="Boolean">Boolean</span>
<span class="delimiter">}</span>
<span class="comment">//#cancellable</span>

<span class="comment">/**
 * This scheduler implementation is based on a revolving wheel of buckets,
 * like Netty’s HashedWheelTimer, which it advances at a fixed tick rate and
 * dispatches tasks it finds in the current bucket to their respective
 * ExecutionContexts. The tasks are held in TaskHolders, which upon
 * cancellation null out their reference to the actual task, leaving only this
 * shell to be cleaned up when the wheel reaches that bucket next time. This
 * enables the use of a simple linked list to chain the TaskHolders off the
 * wheel.
 *
 * Also noteworthy is that this scheduler does not obtain a current time stamp
 * when scheduling single-shot tasks, instead it always rounds up the task
 * delay to a full multiple of the TickDuration. This means that tasks are
 * scheduled possibly one tick later than they could be (if checking that
 * “now() + delay &lt;= nextTick” were done).
 */</span>
<span title="AnyRef" class="keyword">class</span> <a title="class LightArrayRevolverScheduler extends AnyRef with akka.actor.Scheduler with java.io.Closeable" id="akka.actor;LightArrayRevolverScheduler">LightArrayRevolverScheduler</a><a href="#akka.actor;LightArrayRevolverScheduler" title="akka.actor.LightArrayRevolverScheduler" class="delimiter">(</a><a title="com.typesafe.config.Config" id="akka.actor;LightArrayRevolverScheduler.config">config</a>: <span title="com.typesafe.config.Config">Config</span>,
                                  <a title="akka.event.LoggingAdapter" id="akka.actor;LightArrayRevolverScheduler.log">log</a>: <a href="../event/Logging.scala.html#akka.event;LoggingAdapter" title="akka.event.LoggingAdapter">LoggingAdapter</a>,
                                  <a title="java.util.concurrent.ThreadFactory" id="akka.actor;LightArrayRevolverScheduler.threadFactory">threadFactory</a>: <span title="java.util.concurrent.ThreadFactory">ThreadFactory</span><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="#akka.actor;Scheduler" title="akka.actor.Scheduler">Scheduler</a> <span class="keyword">with</span> <span title="java.io.Closeable">Closeable</span> <span class="delimiter">{</span>

  <span class="keyword">import</span> <a href="../util/Helpers.scala.html#akka.util.Helpers" title="akka.util.Helpers.type">Helpers</a>.Requiring
  <span class="keyword">import</span> <a href="../util/Helpers.scala.html#akka.util.Helpers" title="akka.util.Helpers.type">Helpers</a>.ConfigOps

  <span class="keyword">val</span> <a title="Int" id="akka.actor;LightArrayRevolverScheduler.WheelSize">WheelSize</a> =
    <a href="#akka.actor;LightArrayRevolverScheduler.config" title="com.typesafe.config.Config">config</a>.<span title="(x$1: String)Int">getInt</span><a href="../util/Helpers.scala.html#akka.util.Helpers.Requiring(1ee601cfa2)" title="(value: Int)akka.util.Helpers.Requiring[Int]" class="delimiter">(</a><span title="String(&quot;akka.scheduler.ticks-per-wheel&quot;)" class="string">&quot;akka.scheduler.ticks-per-wheel&quot;</span><span class="delimiter">)</span>
      .<a href="../util/Helpers.scala.html#akka.util.Helpers;Requiring.requiring(734662848f)" title="(cond: Int =&gt; Boolean, msg: =&gt; Any)Int">requiring</a><span class="delimiter">(</span><a title="Int" id="akka.actor;LightArrayRevolverScheduler.WheelSize.$anonfun.ticks">ticks</a> ⇒ <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.WheelSize.$anonfun.ticks" title="Int">ticks</a> <span title="(x: Int)Int">&amp;</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.WheelSize.$anonfun.ticks" title="Int">ticks</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span>, <span title="String(&quot;ticks-per-wheel must be a power of 2&quot;)" class="string">&quot;ticks-per-wheel must be a power of 2&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;LightArrayRevolverScheduler.TickDuration">TickDuration</a> =
    <a href="../util/Helpers.scala.html#akka.util.Helpers.ConfigOps(7001b1cdb7)" title="implicit akka.util.Helpers.ConfigOps : (config: com.typesafe.config.Config)akka.util.Helpers.ConfigOps">config</a>.<a href="../util/Helpers.scala.html#akka.util.Helpers;ConfigOps.getMillisDuration" title="(path: String)scala.concurrent.duration.FiniteDuration">getMillisDuration</a><a href="../util/Helpers.scala.html#akka.util.Helpers.Requiring(1ee601cfa2)" title="(value: scala.concurrent.duration.FiniteDuration)akka.util.Helpers.Requiring[scala.concurrent.duration.FiniteDuration]" class="delimiter">(</a><span title="String(&quot;akka.scheduler.tick-duration&quot;)" class="string">&quot;akka.scheduler.tick-duration&quot;</span><span class="delimiter">)</span>
      .<a href="../util/Helpers.scala.html#akka.util.Helpers;Requiring.requiring(734662848f)" title="(cond: scala.concurrent.duration.FiniteDuration =&gt; Boolean, msg: =&gt; Any)scala.concurrent.duration.FiniteDuration">requiring</a><a href="../util/Helpers.scala.html#akka.util.Helpers.Requiring(1ee601cfa2)" title="(value: scala.concurrent.duration.FiniteDuration)akka.util.Helpers.Requiring[scala.concurrent.duration.FiniteDuration]" class="delimiter">(</a><a href="#akka.actor;LightArrayRevolverScheduler.TickDuration.$anonfun.x$1" title="scala.concurrent.duration.FiniteDuration">_</a> <span title="(that: scala.concurrent.duration.Duration)Boolean">&gt;=</span> <span title="implicit scala.concurrent.duration.package.DurationInt : (n: Int)concurrent.duration.DurationInt" class="int">10</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">millis</span> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><a href="../util/Helpers.scala.html#akka.util.Helpers" title="akka.util.Helpers.type">Helpers</a>.<a href="../util/Helpers.scala.html#akka.util.Helpers.isWindows" title="=&gt; Boolean">isWindows</a>, <span title="String(&quot;minimum supported akka.scheduler.tick-duration on Windows is 10ms&quot;)" class="string">&quot;minimum supported akka.scheduler.tick-duration on Windows is 10ms&quot;</span><span class="delimiter">)</span>
      .<a href="../util/Helpers.scala.html#akka.util.Helpers;Requiring.requiring(734662848f)" title="(cond: scala.concurrent.duration.FiniteDuration =&gt; Boolean, msg: =&gt; Any)scala.concurrent.duration.FiniteDuration">requiring</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.TickDuration.$anonfun.x$2" title="scala.concurrent.duration.FiniteDuration">_</a> <span title="(that: scala.concurrent.duration.Duration)Boolean">&gt;=</span> <span title="implicit scala.concurrent.duration.package.DurationInt : (n: Int)concurrent.duration.DurationInt" class="int">1</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">millis</span>, <span title="String(&quot;minimum supported akka.scheduler.tick-duration is 1ms&quot;)" class="string">&quot;minimum supported akka.scheduler.tick-duration is 1ms&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;LightArrayRevolverScheduler.ShutdownTimeout">ShutdownTimeout</a> = <a href="../util/Helpers.scala.html#akka.util.Helpers.ConfigOps(7001b1cdb7)" title="implicit akka.util.Helpers.ConfigOps : (config: com.typesafe.config.Config)akka.util.Helpers.ConfigOps">config</a>.<a href="../util/Helpers.scala.html#akka.util.Helpers;ConfigOps.getMillisDuration" title="(path: String)scala.concurrent.duration.FiniteDuration">getMillisDuration</a><span class="delimiter">(</span><span title="String(&quot;akka.scheduler.shutdown-timeout&quot;)" class="string">&quot;akka.scheduler.shutdown-timeout&quot;</span><span class="delimiter">)</span>

  <span class="keyword">import</span> <a href="#akka.actor.LightArrayRevolverScheduler" title="akka.actor.LightArrayRevolverScheduler.type">LightArrayRevolverScheduler</a>._

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;LightArrayRevolverScheduler.oneNs">oneNs</a> = <span title="scala.concurrent.duration.Duration.type">Duration</span>.<span title="(nanos: Long)scala.concurrent.duration.FiniteDuration">fromNanos</span><span class="delimiter">(</span><span title="Long(1L)" class="long">1l</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(d: scala.concurrent.duration.FiniteDuration)scala.concurrent.duration.FiniteDuration" id="akka.actor;LightArrayRevolverScheduler.roundUp">roundUp</a><span class="delimiter">(</span><a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;LightArrayRevolverScheduler.roundUp.d">d</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span><span class="delimiter">)</span>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span> =
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="delimiter">(</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.roundUp.d" title="scala.concurrent.duration.FiniteDuration">d</a> <span title="(other: scala.concurrent.duration.FiniteDuration)scala.concurrent.duration.FiniteDuration">+</span> <a href="#akka.actor;LightArrayRevolverScheduler.TickDuration" title="=&gt; scala.concurrent.duration.FiniteDuration">TickDuration</a> <span title="(other: scala.concurrent.duration.FiniteDuration)scala.concurrent.duration.FiniteDuration">-</span> <a href="#akka.actor;LightArrayRevolverScheduler.oneNs" title="=&gt; scala.concurrent.duration.FiniteDuration">oneNs</a><span class="delimiter">)</span> <span title="(divisor: scala.concurrent.duration.Duration)Double">/</span> <a href="#akka.actor;LightArrayRevolverScheduler.TickDuration" title="=&gt; scala.concurrent.duration.FiniteDuration">TickDuration</a><span class="delimiter">)</span>.<span title="implicit scala.concurrent.duration.package.LongMult : (i: Long)concurrent.duration.LongMult">toLong</span> <span title="(d: scala.concurrent.duration.FiniteDuration)scala.concurrent.duration.FiniteDuration">*</span> <a href="#akka.actor;LightArrayRevolverScheduler.TickDuration" title="=&gt; scala.concurrent.duration.FiniteDuration">TickDuration</a>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> _: <span title="IllegalArgumentException">IllegalArgumentException</span> ⇒ <a href="#akka.actor;LightArrayRevolverScheduler.roundUp.d" title="scala.concurrent.duration.FiniteDuration">d</a> <span class="comment">// rouding up Long.MaxValue.nanos overflows</span>
    <span class="delimiter">}</span>

  <span class="comment">/**
   * Clock implementation is replaceable (for testing); the implementation must
   * return a monotonically increasing series of Long nanoseconds.
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="()Long" id="akka.actor;LightArrayRevolverScheduler.clock">clock</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <span title="System.type">System</span>.<span title="()Long">nanoTime</span>

  <span class="comment">/**
   * Overridable for tests
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; scala.concurrent.duration.FiniteDuration" id="akka.actor;LightArrayRevolverScheduler.getShutdownTimeout">getShutdownTimeout</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span> = <a href="#akka.actor;LightArrayRevolverScheduler.ShutdownTimeout" title="=&gt; scala.concurrent.duration.FiniteDuration">ShutdownTimeout</a>

  <span class="comment">/**
   * Overridable for tests
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(nanos: Long)Unit" id="akka.actor;LightArrayRevolverScheduler.waitNanos">waitNanos</a><span class="delimiter">(</span><a title="Long" id="akka.actor;LightArrayRevolverScheduler.waitNanos.nanos">nanos</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="comment">// see http://www.javamex.com/tutorials/threads/sleep_issues.shtml</span>
    <span class="keyword">val</span> <a title="Long" id="akka.actor;LightArrayRevolverScheduler.waitNanos.sleepMs">sleepMs</a> = <span title="Long" class="keyword">if</span> <span class="delimiter">(</span><a href="../util/Helpers.scala.html#akka.util.Helpers" title="akka.util.Helpers.type">Helpers</a>.<a href="../util/Helpers.scala.html#akka.util.Helpers.isWindows" title="=&gt; Boolean">isWindows</a><span class="delimiter">)</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.waitNanos.nanos" title="Long">nanos</a> <span title="(x: Int)Long">+</span> <span title="Int(4999999)" class="int">4999999</span><span class="delimiter">)</span> <span title="(x: Int)Long">/</span> <span title="Int(10000000)" class="int">10000000</span> <span title="(x: Int)Long">*</span> <span title="Int(10)" class="int">10</span> <span class="keyword">else</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.waitNanos.nanos" title="Long">nanos</a> <span title="(x: Int)Long">+</span> <span title="Int(999999)" class="int">999999</span><span class="delimiter">)</span> <span title="(x: Int)Long">/</span> <span title="Int(1000000)" class="int">1000000</span>
    <span class="keyword">try</span> <span title="Thread.type">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.waitNanos.sleepMs" title="Long">sleepMs</a><span class="delimiter">)</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> _: <span title="InterruptedException">InterruptedException</span> ⇒ <span title="Thread.type">Thread</span>.<span title="()Thread">currentThread</span>.<span title="()Unit">interrupt</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="comment">// we got woken up</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(initialDelay: scala.concurrent.duration.FiniteDuration, delay: scala.concurrent.duration.FiniteDuration, runnable: Runnable)(implicit executor: scala.concurrent.ExecutionContext)akka.actor.Cancellable" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801)">schedule</a><span class="delimiter">(</span><a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801).initialDelay">initialDelay</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
                        <a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801).delay">delay</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
                        <a title="Runnable" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801).runnable">runnable</a>: <span title="Runnable">Runnable</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.ExecutionContext" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801).executor">executor</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span>: <a href="#akka.actor;Cancellable" title="akka.actor.Cancellable">Cancellable</a> = <span class="delimiter">{</span>
    <a href="#akka.actor;LightArrayRevolverScheduler.checkMaxDelay" title="(delayNanos: Long)Unit">checkMaxDelay</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.roundUp" title="(d: scala.concurrent.duration.FiniteDuration)scala.concurrent.duration.FiniteDuration">roundUp</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801).delay" title="scala.concurrent.duration.FiniteDuration">delay</a><span class="delimiter">)</span>.<span title="=&gt; Long">toNanos</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.concurrent.ExecutionContext" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801).preparedEC">preparedEC</a> = <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801).executor" title="scala.concurrent.ExecutionContext">executor</a>.<span title="()scala.concurrent.ExecutionContext">prepare</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">try</span> <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon" title="java.util.concurrent.atomic.AtomicReference[akka.actor.Cancellable] with akka.actor.Cancellable{}" class="keyword">new</a> <a title="anonymous class $anon extends java.util.concurrent.atomic.AtomicReference[akka.actor.Cancellable] with akka.actor.Cancellable" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon">AtomicReference</a><span class="delimiter">[</span>Cancellable<span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.actor.LightArrayRevolverScheduler.InitialRepeatMarker" title="=&gt; akka.actor.Cancellable">InitialRepeatMarker</a><span class="delimiter">)</span> <span class="keyword">with</span> <a href="#akka.actor;Cancellable" title="akka.actor.Cancellable">Cancellable</a> <span class="delimiter">{</span> self ⇒
      <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon" title="(x$1: akka.actor.Cancellable, x$2: akka.actor.Cancellable)Boolean">compareAndSet</a><span class="delimiter">(</span><a href="#akka.actor.LightArrayRevolverScheduler.InitialRepeatMarker" title="=&gt; akka.actor.Cancellable">InitialRepeatMarker</a>, <a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0)" title="(ec: scala.concurrent.ExecutionContext, r: Runnable, delay: scala.concurrent.duration.FiniteDuration)akka.actor.LightArrayRevolverScheduler.TimerTask">schedule</a><span class="delimiter">(</span>
        <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801).preparedEC" title="scala.concurrent.ExecutionContext">preparedEC</a>,
        <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.<local $anon>;$anon" title="java.util.concurrent.atomic.AtomicLong with Runnable" class="keyword">new</a> <a title="anonymous class $anon extends java.util.concurrent.atomic.AtomicLong with Runnable" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.<local $anon>;$anon">AtomicLong</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.clock" title="()Long">clock</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Long)Long">+</span> <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801).initialDelay" title="scala.concurrent.duration.FiniteDuration">initialDelay</a>.<span title="=&gt; Long">toNanos</span><span class="delimiter">)</span> <span class="keyword">with</span> <span title="Runnable">Runnable</span> <span class="delimiter">{</span>
          <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.<local $anon>;$anon.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
            <span class="keyword">try</span> <span class="delimiter">{</span>
              <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801).runnable" title="Runnable">runnable</a>.<span title="()Unit">run</span><span class="delimiter">(</span><span class="delimiter">)</span>
              <span class="keyword">val</span> <a title="Long" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.<local $anon>;$anon.run.driftNanos">driftNanos</a> = <a href="#akka.actor;LightArrayRevolverScheduler.clock" title="()Long">clock</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Long)Long">-</span> <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.<local $anon>;$anon" title="(x$1: Long)Long">getAndAdd</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801).delay" title="scala.concurrent.duration.FiniteDuration">delay</a>.<span title="=&gt; Long">toNanos</span><span class="delimiter">)</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon" title="akka.actor.LightArrayRevolverScheduler.$anon.type">self</a>.<span title="()akka.actor.Cancellable">get</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
                <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.swap" title="(c: akka.actor.Cancellable)Unit">swap</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0)" title="(ec: scala.concurrent.ExecutionContext, r: Runnable, delay: scala.concurrent.duration.FiniteDuration)akka.actor.LightArrayRevolverScheduler.TimerTask">schedule</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801).preparedEC" title="scala.concurrent.ExecutionContext">preparedEC</a>, <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.<local $anon>;$anon" title="java.util.concurrent.atomic.AtomicLong with Runnable" class="keyword">this</a>, <span title="scala.concurrent.duration.Duration.type">Duration</span>.<span title="(nanos: Long)scala.concurrent.duration.FiniteDuration">fromNanos</span><span class="delimiter">(</span><span title="Math.type">Math</span>.<span title="(x$1: Long, x$2: Long)Long">max</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801).delay" title="scala.concurrent.duration.FiniteDuration">delay</a>.<span title="=&gt; Long">toNanos</span> <span title="(x: Long)Long">-</span> <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.<local $anon>;$anon.run.driftNanos" title="Long">driftNanos</a>, <span title="Long(1L)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> _: <a href="#akka.actor.SchedulerException.readResolve" title="akka.actor.SchedulerException">SchedulerException</a> ⇒ <span class="comment">// ignore failure to enqueue or terminated target actor</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>, <a href="#akka.actor;LightArrayRevolverScheduler.roundUp" title="(d: scala.concurrent.duration.FiniteDuration)scala.concurrent.duration.FiniteDuration">roundUp</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801).initialDelay" title="scala.concurrent.duration.FiniteDuration">initialDelay</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

      @tailrec <span class="keyword">private</span> <span class="keyword">def</span> <a title="(c: akka.actor.Cancellable)Unit" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.swap">swap</a><span class="delimiter">(</span><a title="akka.actor.Cancellable" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.swap.c">c</a>: <a href="#akka.actor;Cancellable" title="akka.actor.Cancellable">Cancellable</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon" title="()akka.actor.Cancellable">get</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> ⇒ <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.swap.c" title="akka.actor.Cancellable">c</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.swap.c" title="akka.actor.Cancellable">c</a>.<a href="#akka.actor;Cancellable.cancel" title="()Boolean">cancel</a><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a title="akka.actor.Cancellable" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.swap.old">old</a>  ⇒ <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon" title="(x$1: akka.actor.Cancellable, x$2: akka.actor.Cancellable)Boolean">compareAndSet</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.swap.old" title="akka.actor.Cancellable">old</a>, <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.swap.c" title="akka.actor.Cancellable">c</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.swap" title="(c: akka.actor.Cancellable)Unit">swap</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.swap.c" title="akka.actor.Cancellable">c</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      @tailrec <span class="keyword">final</span> <span class="keyword">def</span> <a title="()Boolean" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.cancel">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
        <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon" title="()akka.actor.Cancellable">get</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> ⇒ <span title="Boolean(false)" class="keyword">false</span>
          <span class="keyword">case</span> <a title="akka.actor.Cancellable" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.cancel.c">c</a> ⇒
            <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.cancel.c" title="akka.actor.Cancellable">c</a>.<a href="#akka.actor;Cancellable.cancel" title="()Boolean">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon" title="(x$1: akka.actor.Cancellable, x$2: akka.actor.Cancellable)Boolean">compareAndSet</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.cancel.c" title="akka.actor.Cancellable">c</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
            <span class="keyword">else</span> <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon" title="(x$1: akka.actor.Cancellable, x$2: akka.actor.Cancellable)Boolean">compareAndSet</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.cancel.c" title="akka.actor.Cancellable">c</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.cancel" title="()Boolean">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon.isCancelled">isCancelled</a>: <span title="Boolean">Boolean</span> = <a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801);$anon" title="()akka.actor.Cancellable">get</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> SchedulerException<span class="delimiter">(</span><a title="String" id="akka.actor;LightArrayRevolverScheduler.schedule(132591d801).msg">msg</a><span class="delimiter">)</span> ⇒ <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IllegalStateException" class="keyword">new</span> <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(132591d801).msg" title="String">msg</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(delay: scala.concurrent.duration.FiniteDuration, runnable: Runnable)(implicit executor: scala.concurrent.ExecutionContext)akka.actor.Cancellable" id="akka.actor;LightArrayRevolverScheduler.scheduleOnce(8318e51182)">scheduleOnce</a><span class="delimiter">(</span><a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;LightArrayRevolverScheduler.scheduleOnce(8318e51182).delay">delay</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>, <a title="Runnable" id="akka.actor;LightArrayRevolverScheduler.scheduleOnce(8318e51182).runnable">runnable</a>: <span title="Runnable">Runnable</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scala.concurrent.ExecutionContext" id="akka.actor;LightArrayRevolverScheduler.scheduleOnce(8318e51182).executor">executor</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span>: <a href="#akka.actor;Cancellable" title="akka.actor.Cancellable">Cancellable</a> =
    <span class="keyword">try</span> <a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0)" title="(ec: scala.concurrent.ExecutionContext, r: Runnable, delay: scala.concurrent.duration.FiniteDuration)akka.actor.LightArrayRevolverScheduler.TimerTask">schedule</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.scheduleOnce(8318e51182).executor" title="scala.concurrent.ExecutionContext">executor</a>.<span title="()scala.concurrent.ExecutionContext">prepare</span><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#akka.actor;LightArrayRevolverScheduler.scheduleOnce(8318e51182).runnable" title="Runnable">runnable</a>, <a href="#akka.actor;LightArrayRevolverScheduler.roundUp" title="(d: scala.concurrent.duration.FiniteDuration)scala.concurrent.duration.FiniteDuration">roundUp</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.scheduleOnce(8318e51182).delay" title="scala.concurrent.duration.FiniteDuration">delay</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> SchedulerException<span class="delimiter">(</span><a title="String" id="akka.actor;LightArrayRevolverScheduler.scheduleOnce(8318e51182).msg">msg</a><span class="delimiter">)</span> ⇒ <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IllegalStateException" class="keyword">new</span> <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.scheduleOnce(8318e51182).msg" title="String">msg</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor;LightArrayRevolverScheduler.close">close</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="scala.concurrent.Await.type">Await</span>.<span title="(awaitable: scala.concurrent.Awaitable[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]], atMost: scala.concurrent.duration.Duration)scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]">result</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.stop" title="()scala.concurrent.Future[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">stop</a><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#akka.actor;LightArrayRevolverScheduler.getShutdownTimeout" title="=&gt; scala.concurrent.duration.FiniteDuration">getShutdownTimeout</a><span class="delimiter">)</span> <span title="(f: akka.actor.LightArrayRevolverScheduler.TimerTask =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span>
    <a title="akka.actor.LightArrayRevolverScheduler.TimerTask" id="akka.actor;LightArrayRevolverScheduler.close.$anonfun.task">task</a> ⇒
      <span class="keyword">try</span> <a href="#akka.actor;LightArrayRevolverScheduler.close.$anonfun.task" title="akka.actor.LightArrayRevolverScheduler.TimerTask">task</a>.<span title="()Unit">run</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="InterruptedException">e</span>: <span title="InterruptedException">InterruptedException</span> ⇒ <span title="Nothing" class="keyword">throw</span> <span title="InterruptedException">e</span>
        <span class="keyword">case</span> _: <a href="#akka.actor.SchedulerException.readResolve" title="akka.actor.SchedulerException">SchedulerException</a>   ⇒ <span class="comment">// ignore terminated actors</span>
        <span class="keyword">case</span> <a href="#akka.actor;LightArrayRevolverScheduler.close.$anonfun.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><span title="Throwable">e</span><span class="delimiter">)</span>             ⇒ <a href="#akka.actor;LightArrayRevolverScheduler.log" title="akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.error(de736aeaab)" title="(cause: Throwable, message: String)Unit">error</a><span class="delimiter">(</span><span title="Throwable">e</span>, <span title="String(&quot;exception while executing timer task&quot;)" class="string">&quot;exception while executing timer task&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">val</span> <a title="Double" id="akka.actor;LightArrayRevolverScheduler.maxFrequency">maxFrequency</a>: <span title="Double">Double</span> = <span title="implicit scala.concurrent.duration.package.DurationInt : (n: Int)concurrent.duration.DurationInt" class="int">1</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">second</span> <span title="(divisor: scala.concurrent.duration.Duration)Double">/</span> <a href="#akka.actor;LightArrayRevolverScheduler.TickDuration" title="=&gt; scala.concurrent.duration.FiniteDuration">TickDuration</a>

  <span class="comment">/*
   * BELOW IS THE ACTUAL TIMER IMPLEMENTATION
   */</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Long" id="akka.actor;LightArrayRevolverScheduler.start">start</a> = <a href="#akka.actor;LightArrayRevolverScheduler.clock" title="()Long">clock</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Long" id="akka.actor;LightArrayRevolverScheduler.tickNanos">tickNanos</a> = <a href="#akka.actor;LightArrayRevolverScheduler.TickDuration" title="=&gt; scala.concurrent.duration.FiniteDuration">TickDuration</a>.<span title="=&gt; Long">toNanos</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="akka.actor;LightArrayRevolverScheduler.wheelMask">wheelMask</a> = <a href="#akka.actor;LightArrayRevolverScheduler.WheelSize" title="=&gt; Int">WheelSize</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="akka.actor.LightArrayRevolverScheduler.TaskQueue" id="akka.actor;LightArrayRevolverScheduler.queue">queue</a> = <span title="akka.actor.LightArrayRevolverScheduler.TaskQueue" class="keyword">new</span> <a href="#akka.actor.LightArrayRevolverScheduler;TaskQueue" title="akka.actor.LightArrayRevolverScheduler.TaskQueue">TaskQueue</a>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(ec: scala.concurrent.ExecutionContext, r: Runnable, delay: scala.concurrent.duration.FiniteDuration)akka.actor.LightArrayRevolverScheduler.TimerTask" id="akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0)">schedule</a><span class="delimiter">(</span><a title="scala.concurrent.ExecutionContext" id="akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).ec">ec</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span>, <a title="Runnable" id="akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).r">r</a>: <span title="Runnable">Runnable</span>, <a title="scala.concurrent.duration.FiniteDuration" id="akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).delay">delay</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span><span class="delimiter">)</span>: <a href="#akka.actor.LightArrayRevolverScheduler;TimerTask" title="akka.actor.LightArrayRevolverScheduler.TimerTask">TimerTask</a> =
    <span title="akka.actor.LightArrayRevolverScheduler.TimerTask" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).delay" title="scala.concurrent.duration.FiniteDuration">delay</a> <span title="(that: scala.concurrent.duration.Duration)Boolean">&lt;=</span> <span title="scala.concurrent.duration.Duration.type">Duration</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">Zero</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.stopped" title="=&gt; java.util.concurrent.atomic.AtomicReference[scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]]">stopped</a>.<span title="()scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">get</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <span title="akka.actor.SchedulerException" class="keyword">new</span> <a href="#akka.actor.SchedulerException.readResolve" title="akka.actor.SchedulerException">SchedulerException</a><span class="delimiter">(</span><span title="String(&quot;cannot enqueue after timer shutdown&quot;)" class="string">&quot;cannot enqueue after timer shutdown&quot;</span><span class="delimiter">)</span>
      <a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).ec" title="scala.concurrent.ExecutionContext">ec</a>.<span title="(runnable: Runnable)Unit">execute</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).r" title="Runnable">r</a><span class="delimiter">)</span>
      <a href="#akka.actor.LightArrayRevolverScheduler.NotCancellable" title="=&gt; akka.actor.LightArrayRevolverScheduler.TimerTask">NotCancellable</a>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="akka.actor.LightArrayRevolverScheduler.TimerTask" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.stopped" title="=&gt; java.util.concurrent.atomic.AtomicReference[scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]]">stopped</a>.<span title="()scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">get</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">throw</span> <span title="akka.actor.SchedulerException" class="keyword">new</span> <a href="#akka.actor.SchedulerException.readResolve" title="akka.actor.SchedulerException">SchedulerException</a><span class="delimiter">(</span><span title="String(&quot;cannot enqueue after timer shutdown&quot;)" class="string">&quot;cannot enqueue after timer shutdown&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Long" id="akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).delayNanos">delayNanos</a> = <a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).delay" title="scala.concurrent.duration.FiniteDuration">delay</a>.<span title="=&gt; Long">toNanos</span>
      <a href="#akka.actor;LightArrayRevolverScheduler.checkMaxDelay" title="(delayNanos: Long)Unit">checkMaxDelay</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).delayNanos" title="Long">delayNanos</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Int" id="akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).ticks">ticks</a> = <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).delayNanos" title="Long">delayNanos</a> <span title="(x: Long)Long">/</span> <a href="#akka.actor;LightArrayRevolverScheduler.tickNanos" title="=&gt; Long">tickNanos</a><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>
      <span class="keyword">val</span> <a title="akka.actor.LightArrayRevolverScheduler.TaskHolder" id="akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).task">task</a> = <span title="akka.actor.LightArrayRevolverScheduler.TaskHolder" class="keyword">new</span> <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder" title="akka.actor.LightArrayRevolverScheduler.TaskHolder">TaskHolder</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).r" title="Runnable">r</a>, <a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).ticks" title="Int">ticks</a>, <a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).ec" title="scala.concurrent.ExecutionContext">ec</a><span class="delimiter">)</span>
      <a href="#akka.actor;LightArrayRevolverScheduler.queue" title="=&gt; akka.actor.LightArrayRevolverScheduler.TaskQueue">queue</a>.<a href="../dispatch/AbstractNodeQueue.java.html#akka.dispatch;AbstractNodeQueue.add" title="(value: akka.actor.LightArrayRevolverScheduler.TaskHolder)Unit">add</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).task" title="akka.actor.LightArrayRevolverScheduler.TaskHolder">task</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.stopped" title="=&gt; java.util.concurrent.atomic.AtomicReference[scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]]">stopped</a>.<span title="()scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">get</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).task" title="akka.actor.LightArrayRevolverScheduler.TaskHolder">task</a>.<a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.cancel" title="()Boolean">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">throw</span> <span title="akka.actor.SchedulerException" class="keyword">new</span> <a href="#akka.actor.SchedulerException.readResolve" title="akka.actor.SchedulerException">SchedulerException</a><span class="delimiter">(</span><span title="String(&quot;cannot enqueue after timer shutdown&quot;)" class="string">&quot;cannot enqueue after timer shutdown&quot;</span><span class="delimiter">)</span>
      <a href="#akka.actor;LightArrayRevolverScheduler.schedule(438cb032c0).task" title="akka.actor.LightArrayRevolverScheduler.TaskHolder">task</a>
    <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(delayNanos: Long)Unit" id="akka.actor;LightArrayRevolverScheduler.checkMaxDelay">checkMaxDelay</a><span class="delimiter">(</span><a title="Long" id="akka.actor;LightArrayRevolverScheduler.checkMaxDelay.delayNanos">delayNanos</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.checkMaxDelay.delayNanos" title="Long">delayNanos</a> <span title="(x: Long)Long">/</span> <a href="#akka.actor;LightArrayRevolverScheduler.tickNanos" title="=&gt; Long">tickNanos</a> <span title="(x: Int)Boolean">&gt;</span> Int.<span title="Int(2147483647)">MaxValue</span><span class="delimiter">)</span>
      <span class="comment">// 1 second margin in the error message due to rounding</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IllegalArgumentException" class="keyword">new</span> <span title="IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Task scheduled with [&quot;)">Task scheduled with [$</span><span class="delimiter">{</span><a href="#akka.actor;LightArrayRevolverScheduler.checkMaxDelay.delayNanos" title="implicit scala.concurrent.duration.package.DurationLong : (n: Long)concurrent.duration.DurationLong">delayNanos</a>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">nanos</span>.<span title="=&gt; Long">toSeconds</span><span class="delimiter">}</span><span title="String(&quot;] seconds delay, &quot;)" class="string">] seconds delay, &quot;</span> <span title="(x$1: Any)String">+</span>
        <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;which is too far in future, maximum delay is [&quot;)">which is too far in future, maximum delay is [$</span><span class="delimiter">{</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.tickNanos" title="=&gt; Long">tickNanos</a> <span title="implicit scala.concurrent.duration.package.DurationLong : (n: Long)concurrent.duration.DurationLong">*</span> Int.<span title="Int(2147483647)">MaxValue</span><span class="delimiter">)</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">nanos</span>.<span title="=&gt; Long">toSeconds</span> <span title="(x: Int)Long">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">}</span><span title="String(&quot;] seconds&quot;)" class="string">] seconds&quot;</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.atomic.AtomicReference[scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]]" id="akka.actor;LightArrayRevolverScheduler.stopped">stopped</a> = <span title="()java.util.concurrent.atomic.AtomicReference[scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]]" class="keyword">new</span> <span title="java.util.concurrent.atomic.AtomicReference[scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]]">AtomicReference</span><span class="delimiter">[</span>Promise<span class="delimiter">[</span>immutable.Seq<span class="delimiter">[</span>TimerTask<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()scala.concurrent.Future[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]" id="akka.actor;LightArrayRevolverScheduler.stop">stop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">Future</span><span class="delimiter">[</span>immutable.Seq<span class="delimiter">[</span>TimerTask<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]" id="akka.actor;LightArrayRevolverScheduler.stop.p">p</a> = <span title="[T]()scala.concurrent.Promise[T]">Promise</span><span title="()scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]" class="delimiter">[</span>immutable.<span title="scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]">Seq</span><span class="delimiter">[</span>TimerTask<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="scala.concurrent.Future[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.stopped" title="=&gt; java.util.concurrent.atomic.AtomicReference[scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]]">stopped</a>.<span title="(x$1: scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]], x$2: scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]])Boolean">compareAndSet</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <a href="#akka.actor;LightArrayRevolverScheduler.stop.p" title="scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">p</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// Interrupting the timer thread to make it shut down faster is not good since</span>
      <span class="comment">// it could be in the middle of executing the scheduled tasks, which might not</span>
      <span class="comment">// respond well to being interrupted.</span>
      <span class="comment">// Instead we just wait one more tick for it to finish.</span>
      <a href="#akka.actor;LightArrayRevolverScheduler.stop.p" title="scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">p</a>.<span title="=&gt; scala.concurrent.Future[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">future</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: scala.collection.immutable.Nil.type)scala.concurrent.Future[scala.collection.immutable.Nil.type]">successful</span><span class="delimiter">(</span><span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  @volatile <span class="keyword">private</span> <span class="keyword">var</span> <a title="Thread" id="akka.actor;LightArrayRevolverScheduler.timerThread_=">timerThread</a>: <span title="Thread">Thread</span> = <a href="#akka.actor;LightArrayRevolverScheduler.threadFactory" title="java.util.concurrent.ThreadFactory">threadFactory</a>.<span title="(x$1: Runnable)Thread">newThread</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon" title="Runnable{}" class="keyword">new</a> <a title="anonymous class $anon extends Object with Runnable" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon">Runnable</a> <span class="delimiter">{</span>

    <span class="keyword">var</span> <a title="Int" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.tick_=">tick</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">val</span> <a title="Array[akka.actor.LightArrayRevolverScheduler.TaskQueue]" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.wheel">wheel</a> = <span title="Array.type">Array</span>.<span title="(n: Int)(elem: =&gt; akka.actor.LightArrayRevolverScheduler.TaskQueue)(implicit evidence$9: scala.reflect.ClassTag[akka.actor.LightArrayRevolverScheduler.TaskQueue])Array[akka.actor.LightArrayRevolverScheduler.TaskQueue]">fill</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.WheelSize" title="=&gt; Int">WheelSize</a><span class="delimiter">)</span><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[akka.actor.LightArrayRevolverScheduler.TaskQueue]" class="delimiter">(</span><span title="akka.actor.LightArrayRevolverScheduler.TaskQueue" class="keyword">new</span> <a href="#akka.actor.LightArrayRevolverScheduler;TaskQueue" title="akka.actor.LightArrayRevolverScheduler.TaskQueue">TaskQueue</a><span class="delimiter">)</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll">clearAll</a><span class="delimiter">(</span><span class="delimiter">)</span>: immutable.<span title="scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]">Seq</span><span class="delimiter">[</span>TimerTask<span class="delimiter">]</span> = <span class="delimiter">{</span>
      @tailrec <span class="keyword">def</span> <a title="(q: akka.actor.LightArrayRevolverScheduler.TaskQueue, acc: Vector[akka.actor.LightArrayRevolverScheduler.TimerTask])Vector[akka.actor.LightArrayRevolverScheduler.TimerTask]" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll.collect">collect</a><span class="delimiter">(</span><a title="akka.actor.LightArrayRevolverScheduler.TaskQueue" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll.collect.q">q</a>: <a href="#akka.actor.LightArrayRevolverScheduler;TaskQueue" title="akka.actor.LightArrayRevolverScheduler.TaskQueue">TaskQueue</a>, <a title="Vector[akka.actor.LightArrayRevolverScheduler.TimerTask]" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll.collect.acc">acc</a>: <span title="Vector[akka.actor.LightArrayRevolverScheduler.TimerTask]">Vector</span><span class="delimiter">[</span>TimerTask<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Vector[akka.actor.LightArrayRevolverScheduler.TimerTask]">Vector</span><span class="delimiter">[</span>TimerTask<span class="delimiter">]</span> = <span class="delimiter">{</span>
        <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll.collect.q" title="akka.actor.LightArrayRevolverScheduler.TaskQueue">q</a>.<a href="../dispatch/AbstractNodeQueue.java.html#akka.dispatch;AbstractNodeQueue.poll" title="()akka.actor.LightArrayRevolverScheduler.TaskHolder">poll</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Vector[akka.actor.LightArrayRevolverScheduler.TimerTask]" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> ⇒ <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll.collect.acc" title="Vector[akka.actor.LightArrayRevolverScheduler.TimerTask]">acc</a>
          <span class="keyword">case</span> <a title="akka.actor.LightArrayRevolverScheduler.TaskHolder" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll.collect.x">x</a>    ⇒ <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll.collect" title="(q: akka.actor.LightArrayRevolverScheduler.TaskQueue, acc: Vector[akka.actor.LightArrayRevolverScheduler.TimerTask])Vector[akka.actor.LightArrayRevolverScheduler.TimerTask]">collect</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll.collect.q" title="akka.actor.LightArrayRevolverScheduler.TaskQueue">q</a>, <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll.collect.acc" title="Vector[akka.actor.LightArrayRevolverScheduler.TimerTask]">acc</a> <span title="(elem: akka.actor.LightArrayRevolverScheduler.TimerTask)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector[akka.actor.LightArrayRevolverScheduler.TimerTask],akka.actor.LightArrayRevolverScheduler.TimerTask,Vector[akka.actor.LightArrayRevolverScheduler.TimerTask]])Vector[akka.actor.LightArrayRevolverScheduler.TimerTask]">:+</span> <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll.collect.x" title="akka.actor.LightArrayRevolverScheduler.TaskHolder">x</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="delimiter">(</span><span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range">until</span> <a href="#akka.actor;LightArrayRevolverScheduler.WheelSize" title="=&gt; Int">WheelSize</a><span class="delimiter">)</span> <span title="(f: Int =&gt; scala.collection.GenTraversableOnce[akka.actor.LightArrayRevolverScheduler.TimerTask])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Int],akka.actor.LightArrayRevolverScheduler.TimerTask,scala.collection.immutable.IndexedSeq[akka.actor.LightArrayRevolverScheduler.TimerTask]])scala.collection.immutable.IndexedSeq[akka.actor.LightArrayRevolverScheduler.TimerTask]">flatMap</span> <span class="delimiter">(</span><a title="Int" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll.$anonfun.i">i</a> ⇒ <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll.collect" title="(q: akka.actor.LightArrayRevolverScheduler.TaskQueue, acc: Vector[akka.actor.LightArrayRevolverScheduler.TimerTask])Vector[akka.actor.LightArrayRevolverScheduler.TimerTask]">collect</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.wheel" title="(i: Int)akka.actor.LightArrayRevolverScheduler.TaskQueue">wheel</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll.$anonfun.i" title="Int">i</a><span class="delimiter">)</span>, <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[akka.actor.LightArrayRevolverScheduler.TimerTask])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[akka.actor.LightArrayRevolverScheduler.TimerTask],akka.actor.LightArrayRevolverScheduler.TimerTask,scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]])scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]">++</span> <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll.collect" title="(q: akka.actor.LightArrayRevolverScheduler.TaskQueue, acc: Vector[akka.actor.LightArrayRevolverScheduler.TimerTask])Vector[akka.actor.LightArrayRevolverScheduler.TimerTask]">collect</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.queue" title="=&gt; akka.actor.LightArrayRevolverScheduler.TaskQueue">queue</a>, <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    @tailrec
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(time: Long)Unit" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue">checkQueue</a><span class="delimiter">(</span><a title="Long" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.time">time</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.actor;LightArrayRevolverScheduler.queue" title="=&gt; akka.actor.LightArrayRevolverScheduler.TaskQueue">queue</a>.<a href="../dispatch/AbstractNodeQueue.java.html#akka.dispatch;AbstractNodeQueue.pollNode" title="()akka.dispatch.AbstractNodeQueue.Node[akka.actor.LightArrayRevolverScheduler.TaskHolder]">pollNode</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> ⇒ <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="akka.dispatch.AbstractNodeQueue.Node[akka.actor.LightArrayRevolverScheduler.TaskHolder]" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.node">node</a> ⇒
        <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.node" title="akka.dispatch.AbstractNodeQueue.Node[akka.actor.LightArrayRevolverScheduler.TaskHolder]">node</a>.<a href="../dispatch/AbstractNodeQueue.java.html#akka.dispatch.AbstractNodeQueue;Node.value" title="akka.actor.LightArrayRevolverScheduler.TaskHolder">value</a>.<a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.ticks" title="=&gt; Int">ticks</a> <span title="AnyVal" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Int(0)" class="int">0</span> ⇒ <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.node" title="akka.dispatch.AbstractNodeQueue.Node[akka.actor.LightArrayRevolverScheduler.TaskHolder]">node</a>.<a href="../dispatch/AbstractNodeQueue.java.html#akka.dispatch.AbstractNodeQueue;Node.value" title="akka.actor.LightArrayRevolverScheduler.TaskHolder">value</a>.<a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.executeTask" title="()Boolean">executeTask</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a title="Int" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.ticks">ticks</a> ⇒
            <span class="keyword">val</span> <a title="Int" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.futureTick">futureTick</a> = <span class="delimiter">(</span><span class="delimiter">(</span>
              <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.time" title="Long">time</a> <span title="(x: Long)Long">-</span> <a href="#akka.actor;LightArrayRevolverScheduler.start" title="=&gt; Long">start</a> <span title="(x: Long)Long">+</span> <span class="comment">// calculate the nanos since timer start</span>
              <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.ticks" title="Int">ticks</a> <span title="(x: Long)Long">*</span> <a href="#akka.actor;LightArrayRevolverScheduler.tickNanos" title="=&gt; Long">tickNanos</a><span class="delimiter">)</span> <span title="(x: Long)Long">+</span> <span class="comment">// adding the desired delay</span>
              <a href="#akka.actor;LightArrayRevolverScheduler.tickNanos" title="=&gt; Long">tickNanos</a> <span title="(x: Int)Long">-</span> <span title="Int(1)" class="int">1</span> <span class="comment">// rounding up</span>
              <span class="delimiter">)</span> <span title="(x: Long)Long">/</span> <a href="#akka.actor;LightArrayRevolverScheduler.tickNanos" title="=&gt; Long">tickNanos</a><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span> <span class="comment">// and converting to slot number</span>
            <span class="comment">// tick is an Int that will wrap around, but toInt of futureTick gives us modulo operations</span>
            <span class="comment">// and the difference (offset) will be correct in any case </span>
            <span class="keyword">val</span> <a title="Int" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.offset">offset</a> = <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.futureTick" title="Int">futureTick</a> <span title="(x: Int)Int">-</span> <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.tick_=" title="=&gt; Int">tick</a>
            <span class="keyword">val</span> <a title="Int" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.bucket">bucket</a> = <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.futureTick" title="Int">futureTick</a> <span title="(x: Int)Int">&amp;</span> <a href="#akka.actor;LightArrayRevolverScheduler.wheelMask" title="=&gt; Int">wheelMask</a>
            <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.node" title="akka.dispatch.AbstractNodeQueue.Node[akka.actor.LightArrayRevolverScheduler.TaskHolder]">node</a>.<a href="../dispatch/AbstractNodeQueue.java.html#akka.dispatch.AbstractNodeQueue;Node.value" title="akka.actor.LightArrayRevolverScheduler.TaskHolder">value</a>.<a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.ticks" title="(x$1: Int)Unit">ticks</a> = <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.offset" title="Int">offset</a>
            <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.wheel" title="(i: Int)akka.actor.LightArrayRevolverScheduler.TaskQueue">wheel</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.bucket" title="Int">bucket</a><span class="delimiter">)</span>.<a href="../dispatch/AbstractNodeQueue.java.html#akka.dispatch;AbstractNodeQueue.addNode" title="(n: akka.dispatch.AbstractNodeQueue.Node[akka.actor.LightArrayRevolverScheduler.TaskHolder])Unit">addNode</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.node" title="akka.dispatch.AbstractNodeQueue.Node[akka.actor.LightArrayRevolverScheduler.TaskHolder]">node</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue" title="(time: Long)Unit">checkQueue</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue.time" title="Long">time</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.run">run</a> =
      <span class="keyword">try</span> <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick" title="()Unit">nextTick</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Throwable" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.run.t">t</a>: <span title="Throwable">Throwable</span> ⇒
          <a href="#akka.actor;LightArrayRevolverScheduler.log" title="akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.error(de736aeaab)" title="(cause: Throwable, message: String)Unit">error</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.run.t" title="Throwable">t</a>, <span title="String(&quot;exception on LARS’ timer thread&quot;)" class="string">&quot;exception on LARS’ timer thread&quot;</span><span class="delimiter">)</span>
          <a href="#akka.actor;LightArrayRevolverScheduler.stopped" title="=&gt; java.util.concurrent.atomic.AtomicReference[scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]]">stopped</a>.<span title="()scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">get</span> <span title="Any" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> ⇒
              <span class="keyword">val</span> <a title="Thread" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.run.thread">thread</a> = <a href="#akka.actor;LightArrayRevolverScheduler.threadFactory" title="java.util.concurrent.ThreadFactory">threadFactory</a>.<span title="(x$1: Runnable)Thread">newThread</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon" title="Runnable{}" class="keyword">this</a><span class="delimiter">)</span>
              <a href="#akka.actor;LightArrayRevolverScheduler.log" title="akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.info(cc2e600322)" title="(message: String)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;starting new LARS thread&quot;)" class="string">&quot;starting new LARS thread&quot;</span><span class="delimiter">)</span>
              <span class="keyword">try</span> <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.run.thread" title="Thread">thread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>
              <span class="keyword">catch</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a title="Throwable" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.run.e">e</a>: <span title="Throwable">Throwable</span> ⇒
                  <a href="#akka.actor;LightArrayRevolverScheduler.log" title="akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.error(de736aeaab)" title="(cause: Throwable, message: String)Unit">error</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.run.e" title="Throwable">e</a>, <span title="String(&quot;LARS cannot start new thread, ship’s going down!&quot;)" class="string">&quot;LARS cannot start new thread, ship’s going down!&quot;</span><span class="delimiter">)</span>
                  <a href="#akka.actor;LightArrayRevolverScheduler.stopped" title="=&gt; java.util.concurrent.atomic.AtomicReference[scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]]">stopped</a>.<span title="(x$1: scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]])Unit">set</span><span class="delimiter">(</span><span title="scala.concurrent.Promise.type">Promise</span> <span title="(result: scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask])scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">successful</span> <span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span>
                  <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll" title="()scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]">clearAll</a><span class="delimiter">(</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
              <a href="#akka.actor;LightArrayRevolverScheduler.timerThread_=" title="(x$1: Thread)Unit">timerThread</a> = <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.run.thread" title="Thread">thread</a>
            <span class="keyword">case</span> <a title="scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.run.p">p</a> ⇒
              <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.stopped" title="=&gt; java.util.concurrent.atomic.AtomicReference[scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]]">stopped</a>.<span title="(x$1: scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]], x$2: scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]])Boolean">compareAndSet</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.run.p" title="scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">p</a>, <span title="scala.concurrent.Promise.type">Promise</span> <span title="(result: scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask])scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">successful</span> <span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span>, <span title="String(&quot;Stop signal violated in LARS&quot;)" class="string">&quot;Stop signal violated in LARS&quot;</span><span class="delimiter">)</span>
              <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.run.p" title="scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">p</a> <span title="(v: scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask])p.type">success</span> <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll" title="()scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]">clearAll</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span title="Nothing" class="keyword">throw</span> <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.run.t" title="Throwable">t</a>
      <span class="delimiter">}</span>

    @tailrec <span class="keyword">final</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick">nextTick</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Long" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.time">time</a> = <a href="#akka.actor;LightArrayRevolverScheduler.clock" title="()Long">clock</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Long" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.sleepTime">sleepTime</a> = <a href="#akka.actor;LightArrayRevolverScheduler.start" title="=&gt; Long">start</a> <span title="(x: Long)Long">+</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.tick_=" title="=&gt; Int">tick</a> <span title="(x: Long)Long">*</span> <a href="#akka.actor;LightArrayRevolverScheduler.tickNanos" title="=&gt; Long">tickNanos</a><span class="delimiter">)</span> <span title="(x: Long)Long">-</span> <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.time" title="Long">time</a>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.sleepTime" title="Long">sleepTime</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">// check the queue before taking a nap</span>
        <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.checkQueue" title="(time: Long)Unit">checkQueue</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.time" title="Long">time</a><span class="delimiter">)</span>
        <a href="#akka.actor;LightArrayRevolverScheduler.waitNanos" title="(nanos: Long)Unit">waitNanos</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.sleepTime" title="Long">sleepTime</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Int" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.bucket">bucket</a> = <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.tick_=" title="=&gt; Int">tick</a> <span title="(x: Int)Int">&amp;</span> <a href="#akka.actor;LightArrayRevolverScheduler.wheelMask" title="=&gt; Int">wheelMask</a>
        <span class="keyword">val</span> <a title="akka.actor.LightArrayRevolverScheduler.TaskQueue" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.tasks">tasks</a> = <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.wheel" title="(i: Int)akka.actor.LightArrayRevolverScheduler.TaskQueue">wheel</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.bucket" title="Int">bucket</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="akka.actor.LightArrayRevolverScheduler.TaskQueue" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.putBack">putBack</a> = <span title="akka.actor.LightArrayRevolverScheduler.TaskQueue" class="keyword">new</span> <a href="#akka.actor.LightArrayRevolverScheduler;TaskQueue" title="akka.actor.LightArrayRevolverScheduler.TaskQueue">TaskQueue</a>

        @tailrec <span class="keyword">def</span> <a title="()Unit" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.executeBucket">executeBucket</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.tasks" title="akka.actor.LightArrayRevolverScheduler.TaskQueue">tasks</a>.<a href="../dispatch/AbstractNodeQueue.java.html#akka.dispatch;AbstractNodeQueue.pollNode" title="()akka.dispatch.AbstractNodeQueue.Node[akka.actor.LightArrayRevolverScheduler.TaskHolder]">pollNode</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> ⇒ <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a title="akka.dispatch.AbstractNodeQueue.Node[akka.actor.LightArrayRevolverScheduler.TaskHolder]" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.executeBucket.node">node</a> ⇒
            <span class="keyword">val</span> <a title="akka.actor.LightArrayRevolverScheduler.TaskHolder" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.executeBucket.task">task</a> = <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.executeBucket.node" title="akka.dispatch.AbstractNodeQueue.Node[akka.actor.LightArrayRevolverScheduler.TaskHolder]">node</a>.<a href="../dispatch/AbstractNodeQueue.java.html#akka.dispatch.AbstractNodeQueue;Node.value" title="akka.actor.LightArrayRevolverScheduler.TaskHolder">value</a>
            <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.executeBucket.task" title="akka.actor.LightArrayRevolverScheduler.TaskHolder">task</a>.<a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.isCancelled" title="=&gt; Boolean">isCancelled</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.executeBucket.task" title="akka.actor.LightArrayRevolverScheduler.TaskHolder">task</a>.<a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.ticks" title="=&gt; Int">ticks</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#akka.actor;LightArrayRevolverScheduler.WheelSize" title="=&gt; Int">WheelSize</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.executeBucket.task" title="akka.actor.LightArrayRevolverScheduler.TaskHolder">task</a>.<a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.ticks" title="(x$1: Int)Unit">ticks</a> <span title="(x: Int)Int">-=</span> <a href="#akka.actor;LightArrayRevolverScheduler.WheelSize" title="=&gt; Int">WheelSize</a>
                <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.putBack" title="akka.actor.LightArrayRevolverScheduler.TaskQueue">putBack</a>.<a href="../dispatch/AbstractNodeQueue.java.html#akka.dispatch;AbstractNodeQueue.addNode" title="(n: akka.dispatch.AbstractNodeQueue.Node[akka.actor.LightArrayRevolverScheduler.TaskHolder])Unit">addNode</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.executeBucket.node" title="akka.dispatch.AbstractNodeQueue.Node[akka.actor.LightArrayRevolverScheduler.TaskHolder]">node</a><span class="delimiter">)</span>
              <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.executeBucket.task" title="akka.actor.LightArrayRevolverScheduler.TaskHolder">task</a>.<a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.executeTask" title="()Boolean">executeTask</a><span class="delimiter">(</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.executeBucket" title="()Unit">executeBucket</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.executeBucket" title="()Unit">executeBucket</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.wheel" title="(i: Int, x: akka.actor.LightArrayRevolverScheduler.TaskQueue)Unit">wheel</a><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.bucket" title="Int">bucket</a><span class="delimiter">)</span> = <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.putBack" title="akka.actor.LightArrayRevolverScheduler.TaskQueue">putBack</a>

        <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.tick_=" title="(x$1: Int)Unit">tick</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="delimiter">}</span>
      <a href="#akka.actor;LightArrayRevolverScheduler.stopped" title="=&gt; java.util.concurrent.atomic.AtomicReference[scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]]">stopped</a>.<span title="()scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">get</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> ⇒ <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick" title="()Unit">nextTick</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]" id="akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.p">p</a> ⇒
          <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.stopped" title="=&gt; java.util.concurrent.atomic.AtomicReference[scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]]">stopped</a>.<span title="(x$1: scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]], x$2: scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]])Boolean">compareAndSet</span><span class="delimiter">(</span><a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.p" title="scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">p</a>, <span title="scala.concurrent.Promise.type">Promise</span> <span title="(result: scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask])scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">successful</span> <span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span>, <span title="String(&quot;Stop signal violated in LARS&quot;)" class="string">&quot;Stop signal violated in LARS&quot;</span><span class="delimiter">)</span>
          <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.nextTick.p" title="scala.concurrent.Promise[scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]]">p</a> <span title="(v: scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask])p.type">success</span> <a href="#akka.actor;LightArrayRevolverScheduler.timerThread;$anon.clearAll" title="()scala.collection.immutable.Seq[akka.actor.LightArrayRevolverScheduler.TimerTask]">clearAll</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span><span class="delimiter">)</span>

  <a href="#akka.actor;LightArrayRevolverScheduler.timerThread_=" title="=&gt; Thread">timerThread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="akka.actor.LightArrayRevolverScheduler.type" id="akka.actor.LightArrayRevolverScheduler">LightArrayRevolverScheduler</a> <a href="#akka.actor.LightArrayRevolverScheduler" title="akka.actor.LightArrayRevolverScheduler.type" class="delimiter">{</a>
  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="Long" id="akka.actor.LightArrayRevolverScheduler.taskOffset">taskOffset</a> = <a href="../util/Unsafe.java.html#akka.util.Unsafe.instance" title="sun.misc.Unsafe">unsafe</a>.<span title="(x$1: java.lang.reflect.Field)Long">objectFieldOffset</span><span class="delimiter">(</span>classOf<span title="Class[akka.actor.LightArrayRevolverScheduler.TaskHolder](classOf[akka.actor.LightArrayRevolverScheduler$$TaskHolder])" class="delimiter">[</span>TaskHolder<span class="delimiter">]</span>.<span title="(x$1: String)java.lang.reflect.Field">getDeclaredField</span><span class="delimiter">(</span><span title="String(&quot;task&quot;)" class="string">&quot;task&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">class</span> <a title="class TaskQueue extends akka.dispatch.AbstractNodeQueue[akka.actor.LightArrayRevolverScheduler.TaskHolder]" id="akka.actor.LightArrayRevolverScheduler;TaskQueue">TaskQueue</a> <a href="#akka.actor.LightArrayRevolverScheduler;TaskQueue" title="akka.actor.LightArrayRevolverScheduler.TaskQueue" class="keyword">extends</a> <a href="../dispatch/AbstractNodeQueue.java.html#akka.dispatch;AbstractNodeQueue" title="akka.dispatch.AbstractNodeQueue[akka.actor.LightArrayRevolverScheduler.TaskHolder]">AbstractNodeQueue</a><span class="delimiter">[</span>TaskHolder<span class="delimiter">]</span>

  <span class="comment">/**
   * INTERNAL API
   */</span>
  <span class="keyword">protected</span><span class="delimiter">[</span>actor<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait TimerTask extends Object with Runnable with akka.actor.Cancellable" id="akka.actor.LightArrayRevolverScheduler;TimerTask">TimerTask</a> <span class="keyword">extends</span> <span title="Runnable">Runnable</span> <span class="keyword">with</span> <a href="#akka.actor;Cancellable" title="akka.actor.Cancellable">Cancellable</a>

  <span class="comment">/**
   * INTERNAL API
   */</span>
  <span class="keyword">protected</span><span class="delimiter">[</span>actor<span class="delimiter">]</span> <span class="keyword">class</span> <a title="class TaskHolder extends Object with akka.actor.LightArrayRevolverScheduler.TimerTask" id="akka.actor.LightArrayRevolverScheduler;TaskHolder">TaskHolder</a><a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder" title="akka.actor.LightArrayRevolverScheduler.TaskHolder" class="delimiter">(</a>@volatile <span class="keyword">var</span> <a title="Runnable" id="akka.actor.LightArrayRevolverScheduler;TaskHolder.task">task</a>: <span title="Runnable">Runnable</span>, <span class="keyword">var</span> <a title="Int" id="akka.actor.LightArrayRevolverScheduler;TaskHolder.ticks">ticks</a>: <span title="Int">Int</span>, <a title="scala.concurrent.ExecutionContext" id="akka.actor.LightArrayRevolverScheduler;TaskHolder.executionContext">executionContext</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span>
    <span class="keyword">extends</span> <a href="#akka.actor.LightArrayRevolverScheduler;TimerTask" title="akka.actor.LightArrayRevolverScheduler.TimerTask">TimerTask</a> <span class="delimiter">{</span>

    @tailrec
    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="(replaceWith: Runnable)Runnable" id="akka.actor.LightArrayRevolverScheduler;TaskHolder.extractTask">extractTask</a><span class="delimiter">(</span><a title="Runnable" id="akka.actor.LightArrayRevolverScheduler;TaskHolder.extractTask.replaceWith">replaceWith</a>: <span title="Runnable">Runnable</span><span class="delimiter">)</span>: <span title="Runnable">Runnable</span> =
      <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.task" title="=&gt; Runnable">task</a> <span title="Runnable" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Runnable" id="akka.actor.LightArrayRevolverScheduler;TaskHolder.extractTask.t">t</a> @ <span class="delimiter">(</span><a href="#akka.actor.LightArrayRevolverScheduler.ExecutedTask" title="ExecutedTask extends Object with Runnable">ExecutedTask</a> | <a href="#akka.actor.LightArrayRevolverScheduler.CancelledTask" title="CancelledTask extends Object with Runnable">CancelledTask</a><span class="delimiter">)</span> ⇒ <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.extractTask.t" title="Runnable">t</a>
        <span class="keyword">case</span> <a title="Runnable" id="akka.actor.LightArrayRevolverScheduler;TaskHolder.extractTask.x">x</a>                                  ⇒ <span title="Runnable" class="keyword">if</span> <span class="delimiter">(</span><a href="../util/Unsafe.java.html#akka.util.Unsafe.instance" title="sun.misc.Unsafe">unsafe</a>.<span title="(x$1: Any, x$2: Long, x$3: Any, x$4: Any)Boolean">compareAndSwapObject</span><span class="delimiter">(</span><a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder" title="akka.actor.LightArrayRevolverScheduler.TaskHolder" class="keyword">this</a>, <a href="#akka.actor.LightArrayRevolverScheduler.taskOffset" title="Long">taskOffset</a>, <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.extractTask.x" title="Runnable">x</a>, <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.extractTask.replaceWith" title="Runnable">replaceWith</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.extractTask.x" title="Runnable">x</a> <span class="keyword">else</span> <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.extractTask" title="(replaceWith: Runnable)Runnable">extractTask</a><span class="delimiter">(</span><a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.extractTask.replaceWith" title="Runnable">replaceWith</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="()Boolean" id="akka.actor.LightArrayRevolverScheduler;TaskHolder.executeTask">executeTask</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.extractTask" title="(replaceWith: Runnable)Runnable">extractTask</a><span class="delimiter">(</span><a href="#akka.actor.LightArrayRevolverScheduler.ExecutedTask" title="ExecutedTask extends Object with Runnable">ExecutedTask</a><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#akka.actor.LightArrayRevolverScheduler.ExecutedTask" title="ExecutedTask extends Object with Runnable">ExecutedTask</a> | <a href="#akka.actor.LightArrayRevolverScheduler.CancelledTask" title="CancelledTask extends Object with Runnable">CancelledTask</a> ⇒ <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">case</span> <a title="Runnable" id="akka.actor.LightArrayRevolverScheduler;TaskHolder.executeTask.other">other</a> ⇒
        <span class="keyword">try</span> <span class="delimiter">{</span>
          <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.executionContext" title="scala.concurrent.ExecutionContext">executionContext</a> <span title="(runnable: Runnable)Unit">execute</span> <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.executeTask.other" title="Runnable">other</a>
          <span title="Boolean(true)" class="keyword">true</span>
        <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> _: <span title="InterruptedException">InterruptedException</span> ⇒ <span class="delimiter">{</span> <span title="Thread.type">Thread</span>.<span title="()Thread">currentThread</span>.<span title="()Unit">interrupt</span><span class="delimiter">(</span><span class="delimiter">)</span>; <span title="Boolean(false)" class="keyword">false</span> <span class="delimiter">}</span>
          <span class="keyword">case</span> <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.executeTask.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="akka.actor.LightArrayRevolverScheduler;TaskHolder.executeTask.e">e</a><span class="delimiter">)</span>             ⇒ <span class="delimiter">{</span> <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.executionContext" title="scala.concurrent.ExecutionContext">executionContext</a>.<span title="(t: Throwable)Unit">reportFailure</span><span class="delimiter">(</span><a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.executeTask.e" title="Throwable">e</a><span class="delimiter">)</span>; <span title="Boolean(false)" class="keyword">false</span> <span class="delimiter">}</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">// This should only be called in execDirectly</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor.LightArrayRevolverScheduler;TaskHolder.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.extractTask" title="(replaceWith: Runnable)Runnable">extractTask</a><span class="delimiter">(</span><a href="#akka.actor.LightArrayRevolverScheduler.ExecutedTask" title="ExecutedTask extends Object with Runnable">ExecutedTask</a><span class="delimiter">)</span>.<span title="()Unit">run</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Boolean" id="akka.actor.LightArrayRevolverScheduler;TaskHolder.cancel">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.extractTask" title="(replaceWith: Runnable)Runnable">extractTask</a><span class="delimiter">(</span><a href="#akka.actor.LightArrayRevolverScheduler.CancelledTask" title="CancelledTask extends Object with Runnable">CancelledTask</a><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#akka.actor.LightArrayRevolverScheduler.ExecutedTask" title="ExecutedTask extends Object with Runnable">ExecutedTask</a> | <a href="#akka.actor.LightArrayRevolverScheduler.CancelledTask" title="CancelledTask extends Object with Runnable">CancelledTask</a> ⇒ <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">case</span> _                            ⇒ <span title="Boolean(true)" class="keyword">true</span>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="akka.actor.LightArrayRevolverScheduler;TaskHolder.isCancelled">isCancelled</a>: <span title="Boolean">Boolean</span> = <a href="#akka.actor.LightArrayRevolverScheduler;TaskHolder.task" title="=&gt; Runnable">task</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#akka.actor.LightArrayRevolverScheduler.CancelledTask" title="CancelledTask extends Object with Runnable">CancelledTask</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="CancelledTask extends Object with Runnable" id="akka.actor.LightArrayRevolverScheduler.CancelledTask">CancelledTask</a> = <a href="#akka.actor.LightArrayRevolverScheduler.CancelledTask;$anon" title="Runnable" class="keyword">new</a> <a title="anonymous class $anon extends Object with Runnable" id="akka.actor.LightArrayRevolverScheduler.CancelledTask;$anon">Runnable</a> <span class="delimiter">{</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor.LightArrayRevolverScheduler.CancelledTask;$anon.run">run</a> = <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="ExecutedTask extends Object with Runnable" id="akka.actor.LightArrayRevolverScheduler.ExecutedTask">ExecutedTask</a> = <a href="#akka.actor.LightArrayRevolverScheduler.ExecutedTask;$anon" title="Runnable" class="keyword">new</a> <a title="anonymous class $anon extends Object with Runnable" id="akka.actor.LightArrayRevolverScheduler.ExecutedTask;$anon">Runnable</a> <span class="delimiter">{</span> <span class="keyword">def</span> <a title="()Unit" id="akka.actor.LightArrayRevolverScheduler.ExecutedTask;$anon.run">run</a> = <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="akka.actor.LightArrayRevolverScheduler.TimerTask" id="akka.actor.LightArrayRevolverScheduler.NotCancellable">NotCancellable</a>: <a href="#akka.actor.LightArrayRevolverScheduler;TimerTask" title="akka.actor.LightArrayRevolverScheduler.TimerTask">TimerTask</a> = <a href="#akka.actor.LightArrayRevolverScheduler.NotCancellable;$anon" title="akka.actor.LightArrayRevolverScheduler.TimerTask" class="keyword">new</a> <a title="anonymous class $anon extends Object with akka.actor.LightArrayRevolverScheduler.TimerTask" id="akka.actor.LightArrayRevolverScheduler.NotCancellable;$anon">TimerTask</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="()Boolean" id="akka.actor.LightArrayRevolverScheduler.NotCancellable;$anon.cancel">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="akka.actor.LightArrayRevolverScheduler.NotCancellable;$anon.isCancelled">isCancelled</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">def</span> <a title="()Unit" id="akka.actor.LightArrayRevolverScheduler.NotCancellable;$anon.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="akka.actor.Cancellable" id="akka.actor.LightArrayRevolverScheduler.InitialRepeatMarker">InitialRepeatMarker</a>: <a href="#akka.actor;Cancellable" title="akka.actor.Cancellable">Cancellable</a> = <a href="#akka.actor.LightArrayRevolverScheduler.InitialRepeatMarker;$anon" title="akka.actor.Cancellable" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with akka.actor.Cancellable" id="akka.actor.LightArrayRevolverScheduler.InitialRepeatMarker;$anon">Cancellable</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="()Boolean" id="akka.actor.LightArrayRevolverScheduler.InitialRepeatMarker;$anon.cancel">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="akka.actor.LightArrayRevolverScheduler.InitialRepeatMarker;$anon.isCancelled">isCancelled</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
