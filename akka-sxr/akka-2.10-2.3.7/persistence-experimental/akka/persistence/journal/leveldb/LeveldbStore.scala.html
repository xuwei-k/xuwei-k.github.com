<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>persistence-experimental/akka/persistence/journal/leveldb/LeveldbStore.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 * Copyright (C) 2012-2013 Eligotech BV.
 */</span>

<span class="keyword">package</span> akka.persistence.journal.leveldb

<span class="keyword">import</span> java.io.File

<span class="keyword">import</span> scala.collection.immutable
<span class="keyword">import</span> scala.util._

<span class="keyword">import</span> org.iq80.leveldb._

<span class="keyword">import</span> akka.actor._
<span class="keyword">import</span> akka.persistence._
<span class="keyword">import</span> akka.persistence.journal.AsyncWriteTarget
<span class="keyword">import</span> akka.serialization.SerializationExtension

<span class="comment">/**
 * INTERNAL API.
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>persistence<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait LeveldbStore extends AnyRef with akka.actor.Actor with akka.persistence.journal.leveldb.LeveldbIdMapping with akka.persistence.journal.leveldb.LeveldbRecovery" id="akka.persistence.journal.leveldb;LeveldbStore">LeveldbStore</a> <span title="Unit" class="keyword">extends</span> <a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="keyword">with</span> <a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping" title="akka.persistence.journal.leveldb.LeveldbIdMapping">LeveldbIdMapping</a> <span class="keyword">with</span> <a href="LeveldbRecovery.scala.html#akka.persistence.journal.leveldb;LeveldbRecovery" title="akka.persistence.journal.leveldb.LeveldbRecovery">LeveldbRecovery</a> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="=&gt; String" id="akka.persistence.journal.leveldb;LeveldbStore.configPath">configPath</a>: <span title="String">String</span>

  <span class="keyword">val</span> <a title="com.typesafe.config.Config" id="akka.persistence.journal.leveldb;LeveldbStore.config">config</a> = <a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.settings" title="=&gt; akka.actor.ActorSystem.Settings">settings</a>.<a href="../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor.ActorSystem;Settings.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)com.typesafe.config.Config">getConfig</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.configPath" title="=&gt; String">configPath</a><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="Boolean" id="akka.persistence.journal.leveldb;LeveldbStore.nativeLeveldb">nativeLeveldb</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)Boolean">getBoolean</span><span class="delimiter">(</span><span title="String(&quot;native&quot;)" class="string">&quot;native&quot;</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="org.iq80.leveldb.Options" id="akka.persistence.journal.leveldb;LeveldbStore.leveldbOptions">leveldbOptions</a> = <span title="org.iq80.leveldb.Options" class="keyword">new</span> <span title="org.iq80.leveldb.Options">Options</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Boolean)org.iq80.leveldb.Options">createIfMissing</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; org.iq80.leveldb.ReadOptions" id="akka.persistence.journal.leveldb;LeveldbStore.leveldbReadOptions">leveldbReadOptions</a> = <span title="org.iq80.leveldb.ReadOptions" class="keyword">new</span> <span title="org.iq80.leveldb.ReadOptions">ReadOptions</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Boolean)org.iq80.leveldb.ReadOptions">verifyChecksums</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)Boolean">getBoolean</span><span class="delimiter">(</span><span title="String(&quot;checksum&quot;)" class="string">&quot;checksum&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="org.iq80.leveldb.WriteOptions" id="akka.persistence.journal.leveldb;LeveldbStore.leveldbWriteOptions">leveldbWriteOptions</a> = <span title="org.iq80.leveldb.WriteOptions" class="keyword">new</span> <span title="org.iq80.leveldb.WriteOptions">WriteOptions</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Boolean)org.iq80.leveldb.WriteOptions">sync</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)Boolean">getBoolean</span><span class="delimiter">(</span><span title="String(&quot;fsync&quot;)" class="string">&quot;fsync&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(x$1: Boolean)org.iq80.leveldb.WriteOptions">snapshot</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="java.io.File" id="akka.persistence.journal.leveldb;LeveldbStore.leveldbDir">leveldbDir</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)String">getString</span><span class="delimiter">(</span><span title="String(&quot;dir&quot;)" class="string">&quot;dir&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="org.iq80.leveldb.DB" id="akka.persistence.journal.leveldb;LeveldbStore.leveldb_=">leveldb</a>: <span title="org.iq80.leveldb.DB">DB</span> = _

  <span class="keyword">def</span> <a title="=&gt; org.iq80.leveldb.DBFactory" id="akka.persistence.journal.leveldb;LeveldbStore.leveldbFactory">leveldbFactory</a> =
    <span title="org.iq80.leveldb.DBFactory" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.nativeLeveldb" title="=&gt; Boolean">nativeLeveldb</a><span class="delimiter">)</span> org.fusesource.leveldbjni.<span title="org.fusesource.leveldbjni.JniDBFactory.type">JniDBFactory</span>.<span title="org.fusesource.leveldbjni.JniDBFactory">factory</span>
    <span class="keyword">else</span> org.iq80.leveldb.impl.<span title="org.iq80.leveldb.impl.Iq80DBFactory.type">Iq80DBFactory</span>.<span title="org.iq80.leveldb.impl.Iq80DBFactory">factory</span>

  <span class="keyword">val</span> <a title="akka.serialization.Serialization" id="akka.persistence.journal.leveldb;LeveldbStore.serialization">serialization</a> = <a href="../../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.serialization.Serialization">SerializationExtension</a><span class="delimiter">(</span><a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>

  <span class="keyword">import</span> <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key" title="akka.persistence.journal.leveldb.Key.type">Key</a>._

  <span class="keyword">def</span> <a title="(messages: scala.collection.immutable.Seq[akka.persistence.PersistentRepr])Unit" id="akka.persistence.journal.leveldb;LeveldbStore.writeMessages">writeMessages</a><span class="delimiter">(</span><a title="scala.collection.immutable.Seq[akka.persistence.PersistentRepr]" id="akka.persistence.journal.leveldb;LeveldbStore.writeMessages.messages">messages</a>: immutable.<span title="scala.collection.immutable.Seq[akka.persistence.PersistentRepr]">Seq</span><span class="delimiter">[</span>PersistentRepr<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch" title="(body: org.iq80.leveldb.WriteBatch =&gt; Unit)Unit">withBatch</a><span class="delimiter">(</span><a title="org.iq80.leveldb.WriteBatch" id="akka.persistence.journal.leveldb;LeveldbStore.writeMessages.$anonfun.batch">batch</a> ⇒ <a href="#akka.persistence.journal.leveldb;LeveldbStore.writeMessages.messages" title="scala.collection.immutable.Seq[akka.persistence.PersistentRepr]">messages</a>.<span title="(f: akka.persistence.PersistentRepr =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="akka.persistence.PersistentRepr" id="akka.persistence.journal.leveldb;LeveldbStore.writeMessages.$anonfun.$anonfun.message">message</a> ⇒ <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch" title="(persistent: akka.persistence.PersistentRepr, batch: org.iq80.leveldb.WriteBatch)Unit">addToMessageBatch</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.writeMessages.$anonfun.$anonfun.message" title="akka.persistence.PersistentRepr">message</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.writeMessages.$anonfun.batch" title="org.iq80.leveldb.WriteBatch">batch</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(confirmations: scala.collection.immutable.Seq[akka.persistence.PersistentConfirmation])Unit" id="akka.persistence.journal.leveldb;LeveldbStore.writeConfirmations">writeConfirmations</a><span class="delimiter">(</span><a title="scala.collection.immutable.Seq[akka.persistence.PersistentConfirmation]" id="akka.persistence.journal.leveldb;LeveldbStore.writeConfirmations.confirmations">confirmations</a>: immutable.<span title="scala.collection.immutable.Seq[akka.persistence.PersistentConfirmation]">Seq</span><span class="delimiter">[</span>PersistentConfirmation<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch" title="(body: org.iq80.leveldb.WriteBatch =&gt; Unit)Unit">withBatch</a><span class="delimiter">(</span><a title="org.iq80.leveldb.WriteBatch" id="akka.persistence.journal.leveldb;LeveldbStore.writeConfirmations.$anonfun.batch">batch</a> ⇒ <a href="#akka.persistence.journal.leveldb;LeveldbStore.writeConfirmations.confirmations" title="scala.collection.immutable.Seq[akka.persistence.PersistentConfirmation]">confirmations</a>.<span title="(f: akka.persistence.PersistentConfirmation =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="akka.persistence.PersistentConfirmation" id="akka.persistence.journal.leveldb;LeveldbStore.writeConfirmations.$anonfun.$anonfun.confirmation">confirmation</a> ⇒ <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToConfirmationBatch" title="(confirmation: akka.persistence.PersistentConfirmation, batch: org.iq80.leveldb.WriteBatch)Unit">addToConfirmationBatch</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.writeConfirmations.$anonfun.$anonfun.confirmation" title="akka.persistence.PersistentConfirmation">confirmation</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.writeConfirmations.$anonfun.batch" title="org.iq80.leveldb.WriteBatch">batch</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(messageIds: scala.collection.immutable.Seq[akka.persistence.PersistentId], permanent: Boolean)Unit" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessages">deleteMessages</a><span class="delimiter">(</span><a title="scala.collection.immutable.Seq[akka.persistence.PersistentId]" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessages.messageIds">messageIds</a>: immutable.<span title="scala.collection.immutable.Seq[akka.persistence.PersistentId]">Seq</span><span class="delimiter">[</span>PersistentId<span class="delimiter">]</span>, <a title="Boolean" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessages.permanent">permanent</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch" title="(body: org.iq80.leveldb.WriteBatch =&gt; Unit)Unit">withBatch</a> <span class="delimiter">{</span> <a title="org.iq80.leveldb.WriteBatch" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessages.$anonfun.batch">batch</a> ⇒
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessages.messageIds" title="scala.collection.immutable.Seq[akka.persistence.PersistentId]">messageIds</a> <span title="(f: akka.persistence.PersistentId =&gt; org.iq80.leveldb.WriteBatch)Unit">foreach</span> <span class="delimiter">{</span> <a title="akka.persistence.PersistentId" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessages.$anonfun.$anonfun.messageId">messageId</a> ⇒
      <span title="org.iq80.leveldb.WriteBatch" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessages.permanent" title="Boolean">permanent</a><span class="delimiter">)</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessages.$anonfun.batch" title="org.iq80.leveldb.WriteBatch">batch</a>.<span title="(x$1: Array[Byte])org.iq80.leveldb.WriteBatch">delete</span><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key" title="(persistenceId: Int, sequenceNr: Long, channelId: Int)akka.persistence.journal.leveldb.Key">Key</a><span class="delimiter">(</span><a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.numericId" title="(id: String)Int">numericId</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessages.$anonfun.$anonfun.messageId" title="akka.persistence.PersistentId">messageId</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentId.persistenceId" title="=&gt; String">persistenceId</a><span class="delimiter">)</span>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessages.$anonfun.$anonfun.messageId" title="akka.persistence.PersistentId">messageId</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentId.sequenceNr" title="=&gt; Long">sequenceNr</a>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessages.$anonfun.batch" title="org.iq80.leveldb.WriteBatch">batch</a>.<span title="(x$1: Array[Byte], x$2: Array[Byte])org.iq80.leveldb.WriteBatch">put</span><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.deletionKey" title="(persistenceId: Int, sequenceNr: Long)akka.persistence.journal.leveldb.Key">deletionKey</a><span class="delimiter">(</span><a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.numericId" title="(id: String)Int">numericId</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessages.$anonfun.$anonfun.messageId" title="akka.persistence.PersistentId">messageId</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentId.persistenceId" title="=&gt; String">persistenceId</a><span class="delimiter">)</span>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessages.$anonfun.$anonfun.messageId" title="akka.persistence.PersistentId">messageId</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentId.sequenceNr" title="=&gt; Long">sequenceNr</a><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="Array.type">Array</span>.<span title="=&gt; Array[Byte]">emptyByteArray</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(persistenceId: String, toSequenceNr: Long, permanent: Boolean)Unit" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo">deleteMessagesTo</a><span class="delimiter">(</span><a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="Long" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.toSequenceNr">toSequenceNr</a>: <span title="Long">Long</span>, <a title="Boolean" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.permanent">permanent</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch" title="(body: org.iq80.leveldb.WriteBatch =&gt; Unit)Unit">withBatch</a> <span class="delimiter">{</span> <a title="org.iq80.leveldb.WriteBatch" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.batch">batch</a> ⇒
    <span class="keyword">val</span> <a title="Int" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.nid">nid</a> = <a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.numericId" title="(id: String)Int">numericId</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.persistenceId" title="String">persistenceId</a><span class="delimiter">)</span>

    <span class="comment">// seek to first existing message</span>
    <span class="keyword">val</span> <a title="Long" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.fromSequenceNr">fromSequenceNr</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.withIterator" title="(body: org.iq80.leveldb.DBIterator =&gt; Long)Long">withIterator</a> <span class="delimiter">{</span> <a title="org.iq80.leveldb.DBIterator" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.fromSequenceNr.$anonfun.iter">iter</a> ⇒
      <span class="keyword">val</span> <a title="akka.persistence.journal.leveldb.Key" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.fromSequenceNr.$anonfun.startKey">startKey</a> = <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key" title="(persistenceId: Int, sequenceNr: Long, channelId: Int)akka.persistence.journal.leveldb.Key">Key</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.nid" title="Int">nid</a>, <span title="Long(1L)" class="long">1L</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.fromSequenceNr.$anonfun.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="(x$1: Array[Byte])Unit">seek</span><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.fromSequenceNr.$anonfun.startKey" title="akka.persistence.journal.leveldb.Key">startKey</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Long" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.fromSequenceNr.$anonfun.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyFromBytes" title="(bytes: Array[Byte])akka.persistence.journal.leveldb.Key">keyFromBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.fromSequenceNr.$anonfun.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="()java.util.Map.Entry[Array[Byte],Array[Byte]]">peekNext</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Array[Byte]">getKey</span><span class="delimiter">)</span>.<a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key.sequenceNr" title="=&gt; Long">sequenceNr</a> <span class="keyword">else</span> Long.<span title="Long(9223372036854775807L)">MaxValue</span>
    <span class="delimiter">}</span>

    <a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.fromSequenceNr" title="implicit scala.LowPriorityImplicits.longWrapper : (x: Long)scala.runtime.RichLong">fromSequenceNr</a> <span title="(end: Long)scala.collection.immutable.NumericRange.Inclusive[Long]">to</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.toSequenceNr" title="Long">toSequenceNr</a> <span title="(f: Long =&gt; org.iq80.leveldb.WriteBatch)Unit">foreach</span> <span class="delimiter">{</span> <a title="Long" id="akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.$anonfun.sequenceNr">sequenceNr</a> ⇒
      <span title="org.iq80.leveldb.WriteBatch" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.permanent" title="Boolean">permanent</a><span class="delimiter">)</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.batch" title="org.iq80.leveldb.WriteBatch">batch</a>.<span title="(x$1: Array[Byte])org.iq80.leveldb.WriteBatch">delete</span><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key" title="(persistenceId: Int, sequenceNr: Long, channelId: Int)akka.persistence.journal.leveldb.Key">Key</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.nid" title="Int">nid</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.$anonfun.sequenceNr" title="Long">sequenceNr</a>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="comment">// TODO: delete confirmations and deletion markers, if any.</span>
      <span class="keyword">else</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.batch" title="org.iq80.leveldb.WriteBatch">batch</a>.<span title="(x$1: Array[Byte], x$2: Array[Byte])org.iq80.leveldb.WriteBatch">put</span><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.deletionKey" title="(persistenceId: Int, sequenceNr: Long)akka.persistence.journal.leveldb.Key">deletionKey</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.nid" title="Int">nid</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo.$anonfun.$anonfun.sequenceNr" title="Long">sequenceNr</a><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="Array.type">Array</span>.<span title="=&gt; Array[Byte]">emptyByteArray</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()org.iq80.leveldb.ReadOptions" id="akka.persistence.journal.leveldb;LeveldbStore.leveldbSnapshot">leveldbSnapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="org.iq80.leveldb.ReadOptions">ReadOptions</span> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldbReadOptions" title="=&gt; org.iq80.leveldb.ReadOptions">leveldbReadOptions</a>.<span title="(x$1: org.iq80.leveldb.Snapshot)org.iq80.leveldb.ReadOptions">snapshot</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldb_=" title="=&gt; org.iq80.leveldb.DB">leveldb</a>.<span title="()org.iq80.leveldb.Snapshot">getSnapshot</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="[R](body: org.iq80.leveldb.DBIterator =&gt; R)R" id="akka.persistence.journal.leveldb;LeveldbStore.withIterator">withIterator</a><span class="delimiter">[</span><a title="" id="akka.persistence.journal.leveldb;LeveldbStore.withIterator;R">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="org.iq80.leveldb.DBIterator =&gt; R" id="akka.persistence.journal.leveldb;LeveldbStore.withIterator.body">body</a>: DBIterator ⇒ R<span class="delimiter">)</span>: <a href="#akka.persistence.journal.leveldb;LeveldbStore.withIterator;R" title="R">R</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.iq80.leveldb.ReadOptions" id="akka.persistence.journal.leveldb;LeveldbStore.withIterator.ro">ro</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldbSnapshot" title="()org.iq80.leveldb.ReadOptions">leveldbSnapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.iq80.leveldb.DBIterator" id="akka.persistence.journal.leveldb;LeveldbStore.withIterator.iterator">iterator</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldb_=" title="=&gt; org.iq80.leveldb.DB">leveldb</a>.<span title="(x$1: org.iq80.leveldb.ReadOptions)org.iq80.leveldb.DBIterator">iterator</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.withIterator.ro" title="org.iq80.leveldb.ReadOptions">ro</a><span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.withIterator.body" title="(v1: org.iq80.leveldb.DBIterator)R">body</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.withIterator.iterator" title="org.iq80.leveldb.DBIterator">iterator</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.withIterator.iterator" title="org.iq80.leveldb.DBIterator">iterator</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.withIterator.ro" title="org.iq80.leveldb.ReadOptions">ro</a>.<span title="()org.iq80.leveldb.Snapshot">snapshot</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[R](body: org.iq80.leveldb.WriteBatch =&gt; R)R" id="akka.persistence.journal.leveldb;LeveldbStore.withBatch">withBatch</a><span class="delimiter">[</span><a title="" id="akka.persistence.journal.leveldb;LeveldbStore.withBatch;R">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="org.iq80.leveldb.WriteBatch =&gt; R" id="akka.persistence.journal.leveldb;LeveldbStore.withBatch.body">body</a>: WriteBatch ⇒ R<span class="delimiter">)</span>: <a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch;R" title="R">R</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.iq80.leveldb.WriteBatch" id="akka.persistence.journal.leveldb;LeveldbStore.withBatch.batch">batch</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldb_=" title="=&gt; org.iq80.leveldb.DB">leveldb</a>.<span title="()org.iq80.leveldb.WriteBatch">createWriteBatch</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="R" id="akka.persistence.journal.leveldb;LeveldbStore.withBatch.r">r</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch.body" title="(v1: org.iq80.leveldb.WriteBatch)R">body</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch.batch" title="org.iq80.leveldb.WriteBatch">batch</a><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldb_=" title="=&gt; org.iq80.leveldb.DB">leveldb</a>.<span title="(x$1: org.iq80.leveldb.WriteBatch, x$2: org.iq80.leveldb.WriteOptions)org.iq80.leveldb.Snapshot">write</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch.batch" title="org.iq80.leveldb.WriteBatch">batch</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldbWriteOptions" title="=&gt; org.iq80.leveldb.WriteOptions">leveldbWriteOptions</a><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch.r" title="R">r</a>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch.batch" title="org.iq80.leveldb.WriteBatch">batch</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(p: akka.persistence.PersistentRepr)Array[Byte]" id="akka.persistence.journal.leveldb;LeveldbStore.persistentToBytes">persistentToBytes</a><span class="delimiter">(</span><a title="akka.persistence.PersistentRepr" id="akka.persistence.journal.leveldb;LeveldbStore.persistentToBytes.p">p</a>: <a href="../../Persistent.scala.html#akka.persistence;PersistentRepr" title="akka.persistence.PersistentRepr">PersistentRepr</a><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.serialization" title="=&gt; akka.serialization.Serialization">serialization</a>.<a href="../../../../../actor/akka/serialization/Serialization.scala.html#akka.serialization;Serialization.serialize" title="(o: AnyRef)scala.util.Try[Array[Byte]]">serialize</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.persistentToBytes.p" title="akka.persistence.PersistentRepr">p</a><span class="delimiter">)</span>.<span title="=&gt; Array[Byte]">get</span>
  <span class="keyword">def</span> <a title="(a: Array[Byte])akka.persistence.PersistentRepr" id="akka.persistence.journal.leveldb;LeveldbStore.persistentFromBytes">persistentFromBytes</a><span class="delimiter">(</span><a title="Array[Byte]" id="akka.persistence.journal.leveldb;LeveldbStore.persistentFromBytes.a">a</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Persistent.scala.html#akka.persistence;PersistentRepr" title="akka.persistence.PersistentRepr">PersistentRepr</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.serialization" title="=&gt; akka.serialization.Serialization">serialization</a>.<a href="../../../../../actor/akka/serialization/Serialization.scala.html#akka.serialization;Serialization.deserialize(2392165273)" title="(bytes: Array[Byte], clazz: Class[akka.persistence.PersistentRepr])scala.util.Try[akka.persistence.PersistentRepr]">deserialize</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.persistentFromBytes.a" title="Array[Byte]">a</a>, classOf<span title="Class[akka.persistence.PersistentRepr](classOf[akka.persistence.PersistentRepr])" class="delimiter">[</span>PersistentRepr<span class="delimiter">]</span><span class="delimiter">)</span>.<span title="=&gt; akka.persistence.PersistentRepr">get</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(persistent: akka.persistence.PersistentRepr, batch: org.iq80.leveldb.WriteBatch)Unit" id="akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch">addToMessageBatch</a><span class="delimiter">(</span><a title="akka.persistence.PersistentRepr" id="akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.persistent">persistent</a>: <a href="../../Persistent.scala.html#akka.persistence;PersistentRepr" title="akka.persistence.PersistentRepr">PersistentRepr</a>, <a title="org.iq80.leveldb.WriteBatch" id="akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.batch">batch</a>: <span title="org.iq80.leveldb.WriteBatch">WriteBatch</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.nid">nid</a> = <a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.numericId" title="(id: String)Int">numericId</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.persistent" title="akka.persistence.PersistentRepr">persistent</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentId.persistenceId" title="=&gt; String">persistenceId</a><span class="delimiter">)</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.batch" title="org.iq80.leveldb.WriteBatch">batch</a>.<span title="(x$1: Array[Byte], x$2: Array[Byte])org.iq80.leveldb.WriteBatch">put</span><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.counterKey" title="(persistenceId: Int)akka.persistence.journal.leveldb.Key">counterKey</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.nid" title="Int">nid</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.counterToBytes" title="(ctr: Long)Array[Byte]">counterToBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.persistent" title="akka.persistence.PersistentRepr">persistent</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentId.sequenceNr" title="=&gt; Long">sequenceNr</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.batch" title="org.iq80.leveldb.WriteBatch">batch</a>.<span title="(x$1: Array[Byte], x$2: Array[Byte])org.iq80.leveldb.WriteBatch">put</span><span title="Unit" class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key" title="(persistenceId: Int, sequenceNr: Long, channelId: Int)akka.persistence.journal.leveldb.Key">Key</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.nid" title="Int">nid</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.persistent" title="akka.persistence.PersistentRepr">persistent</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentId.sequenceNr" title="=&gt; Long">sequenceNr</a>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.persistentToBytes" title="(p: akka.persistence.PersistentRepr)Array[Byte]">persistentToBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.persistent" title="akka.persistence.PersistentRepr">persistent</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(confirmation: akka.persistence.PersistentConfirmation, batch: org.iq80.leveldb.WriteBatch)Unit" id="akka.persistence.journal.leveldb;LeveldbStore.addToConfirmationBatch">addToConfirmationBatch</a><span class="delimiter">(</span><a title="akka.persistence.PersistentConfirmation" id="akka.persistence.journal.leveldb;LeveldbStore.addToConfirmationBatch.confirmation">confirmation</a>: <a href="../../Persistent.scala.html#akka.persistence;PersistentConfirmation" title="akka.persistence.PersistentConfirmation">PersistentConfirmation</a>, <a title="org.iq80.leveldb.WriteBatch" id="akka.persistence.journal.leveldb;LeveldbStore.addToConfirmationBatch.batch">batch</a>: <span title="org.iq80.leveldb.WriteBatch">WriteBatch</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="akka.persistence.journal.leveldb;LeveldbStore.addToConfirmationBatch.npid">npid</a> = <a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.numericId" title="(id: String)Int">numericId</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToConfirmationBatch.confirmation" title="akka.persistence.PersistentConfirmation">confirmation</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentConfirmation.persistenceId" title="=&gt; String">persistenceId</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="akka.persistence.journal.leveldb;LeveldbStore.addToConfirmationBatch.ncid">ncid</a> = <a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.numericId" title="(id: String)Int">numericId</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToConfirmationBatch.confirmation" title="akka.persistence.PersistentConfirmation">confirmation</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentConfirmation.channelId" title="=&gt; String">channelId</a><span class="delimiter">)</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToConfirmationBatch.batch" title="org.iq80.leveldb.WriteBatch">batch</a>.<span title="(x$1: Array[Byte], x$2: Array[Byte])org.iq80.leveldb.WriteBatch">put</span><span title="Unit" class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key" title="(persistenceId: Int, sequenceNr: Long, channelId: Int)akka.persistence.journal.leveldb.Key">Key</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToConfirmationBatch.npid" title="Int">npid</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToConfirmationBatch.confirmation" title="akka.persistence.PersistentConfirmation">confirmation</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentConfirmation.sequenceNr" title="=&gt; Long">sequenceNr</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToConfirmationBatch.ncid" title="Int">ncid</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToConfirmationBatch.confirmation" title="akka.persistence.PersistentConfirmation">confirmation</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentConfirmation.channelId" title="=&gt; String">channelId</a>.<span title="(x$1: String)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.persistence.journal.leveldb;LeveldbStore.preStart">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldb_=" title="(x$1: org.iq80.leveldb.DB)Unit">leveldb</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldbFactory" title="=&gt; org.iq80.leveldb.DBFactory">leveldbFactory</a>.<span title="(x$1: java.io.File, x$2: org.iq80.leveldb.Options)org.iq80.leveldb.DB">open</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldbDir" title="=&gt; java.io.File">leveldbDir</a>, <span title="org.iq80.leveldb.Options" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.nativeLeveldb" title="=&gt; Boolean">nativeLeveldb</a><span class="delimiter">)</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldbOptions" title="=&gt; org.iq80.leveldb.Options">leveldbOptions</a> <span class="keyword">else</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldbOptions" title="=&gt; org.iq80.leveldb.Options">leveldbOptions</a>.<span title="(x$1: org.iq80.leveldb.CompressionType)org.iq80.leveldb.Options">compressionType</span><span class="delimiter">(</span>CompressionType.<span title="org.iq80.leveldb.CompressionType(NONE)">NONE</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore" title="akka.persistence.journal.leveldb.LeveldbStore" class="keyword">super</a>.<a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.preStart" title="()Unit">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.persistence.journal.leveldb;LeveldbStore.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldb_=" title="=&gt; org.iq80.leveldb.DB">leveldb</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore" title="akka.persistence.journal.leveldb.LeveldbStore" class="keyword">super</a>.<a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.postStop" title="()Unit">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * A LevelDB store that can be shared by multiple actor systems. The shared store must be
 * set for each actor system that uses the store via `SharedLeveldbJournal.setStore`. The
 * shared LevelDB store is for testing only.
 */</span>
<span class="keyword">class</span> <a title="class SharedLeveldbStore extends AnyRef with akka.persistence.journal.leveldb.LeveldbStore" id="akka.persistence.journal.leveldb;SharedLeveldbStore">SharedLeveldbStore</a> <a href="#akka.persistence.journal.leveldb;SharedLeveldbStore" title="akka.persistence.journal.leveldb.SharedLeveldbStore" class="keyword">extends</a> <span class="delimiter">{</span> <span class="keyword">val</span> <a title="String" id="akka.persistence.journal.leveldb;SharedLeveldbStore.configPath">configPath</a> = <span title="String(&quot;akka.persistence.journal.leveldb-shared.store&quot;)" class="string">&quot;akka.persistence.journal.leveldb-shared.store&quot;</span> <span class="delimiter">}</span> <span class="keyword">with</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore" title="akka.persistence.journal.leveldb.LeveldbStore">LeveldbStore</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="../AsyncWriteProxy.scala.html#akka.persistence.journal.AsyncWriteTarget" title="akka.persistence.journal.AsyncWriteTarget.type">AsyncWriteTarget</a>._

  <span class="keyword">def</span> <a title="=&gt; PartialFunction[Any,Unit]" id="akka.persistence.journal.leveldb;SharedLeveldbStore.receive">receive</a> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> WriteMessages<span class="delimiter">(</span><a title="scala.collection.immutable.Seq[akka.persistence.PersistentRepr]" id="akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.msgs">msgs</a><span class="delimiter">)</span>                        ⇒ <a href="../../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">sender</a> <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.persistence.journal.leveldb;LeveldbStore.writeMessages" title="(messages: scala.collection.immutable.Seq[akka.persistence.PersistentRepr])Unit">writeMessages</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.msgs" title="scala.collection.immutable.Seq[akka.persistence.PersistentRepr]">msgs</a><span class="delimiter">)</span>
    <span class="keyword">case</span> WriteConfirmations<span class="delimiter">(</span><a title="scala.collection.immutable.Seq[akka.persistence.PersistentConfirmation]" id="akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.cnfs">cnfs</a><span class="delimiter">)</span>                   ⇒ <a href="../../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">sender</a> <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.persistence.journal.leveldb;LeveldbStore.writeConfirmations" title="(confirmations: scala.collection.immutable.Seq[akka.persistence.PersistentConfirmation])Unit">writeConfirmations</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.cnfs" title="scala.collection.immutable.Seq[akka.persistence.PersistentConfirmation]">cnfs</a><span class="delimiter">)</span>
    <span class="keyword">case</span> DeleteMessages<span class="delimiter">(</span><a title="scala.collection.immutable.Seq[akka.persistence.PersistentId]" id="akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.messageIds">messageIds</a>, <span title="Boolean">permanent</span><span class="delimiter">)</span>      ⇒ <a href="../../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">sender</a> <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessages" title="(messageIds: scala.collection.immutable.Seq[akka.persistence.PersistentId], permanent: Boolean)Unit">deleteMessages</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.messageIds" title="scala.collection.immutable.Seq[akka.persistence.PersistentId]">messageIds</a>, <span title="Boolean">permanent</span><span class="delimiter">)</span>
    <span class="keyword">case</span> DeleteMessagesTo<span class="delimiter">(</span><span title="String">pid</span>, <a title="Long" id="akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.tsnr">tsnr</a>, <span title="Boolean">permanent</span><span class="delimiter">)</span>     ⇒ <a href="../../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">sender</a> <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.persistence.journal.leveldb;LeveldbStore.deleteMessagesTo" title="(persistenceId: String, toSequenceNr: Long, permanent: Boolean)Unit">deleteMessagesTo</a><span class="delimiter">(</span><span title="String">pid</span>, <a href="#akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.tsnr" title="Long">tsnr</a>, <span title="Boolean">permanent</span><span class="delimiter">)</span>
    <span class="keyword">case</span> ReadHighestSequenceNr<span class="delimiter">(</span><span title="String">pid</span>, <a title="Long" id="akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.fromSequenceNr">fromSequenceNr</a><span class="delimiter">)</span> ⇒ <a href="../../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">sender</a> <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="LeveldbRecovery.scala.html#akka.persistence.journal.leveldb;LeveldbRecovery.readHighestSequenceNr" title="(persistenceId: Int)Long">readHighestSequenceNr</a><span class="delimiter">(</span><a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.numericId" title="(id: String)Int">numericId</a><span class="delimiter">(</span><span title="String">pid</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> ReplayMessages<span class="delimiter">(</span><span title="String">pid</span>, <a title="Long" id="akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.fromSnr">fromSnr</a>, <a title="Long" id="akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.toSnr">toSnr</a>, <a title="Long" id="akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.max">max</a><span class="delimiter">)</span> ⇒
      <span title="(r: =&gt; Unit)scala.util.Try[Unit]">Try</span><span class="delimiter">(</span><a href="LeveldbRecovery.scala.html#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages" title="(persistenceId: Int, fromSequenceNr: Long, toSequenceNr: Long, max: Long)(replayCallback: akka.persistence.PersistentRepr =&gt; Unit)Unit">replayMessages</a><span class="delimiter">(</span><a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.numericId" title="(id: String)Int">numericId</a><span class="delimiter">(</span><span title="String">pid</span><span class="delimiter">)</span>, <a href="#akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.fromSnr" title="Long">fromSnr</a>, <a href="#akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.isDefinedAt.toSnr" title="Long">toSnr</a>, <span title="Long">max</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">sender</a> <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.applyOrElse.$anonfun.x$1" title="akka.persistence.PersistentRepr">_</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Success<span class="delimiter">(</span><span title="Unit">max</span><span class="delimiter">)</span>   ⇒ <a href="../../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">sender</a> <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="../AsyncWriteProxy.scala.html#akka.persistence.journal.AsyncWriteTarget.ReplaySuccess" title="akka.persistence.journal.AsyncWriteTarget.ReplaySuccess.type">ReplaySuccess</a>
        <span class="keyword">case</span> Failure<span class="delimiter">(</span><a title="Throwable" id="akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.applyOrElse.cause">cause</a><span class="delimiter">)</span> ⇒ <a href="../../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">sender</a> <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="../AsyncWriteProxy.scala.html#akka.persistence.journal.AsyncWriteTarget;ReplayFailure" title="(cause: Throwable)akka.persistence.journal.AsyncWriteTarget.ReplayFailure">ReplayFailure</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;SharedLeveldbStore.receive;$anonfun.applyOrElse.cause" title="Throwable">cause</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
