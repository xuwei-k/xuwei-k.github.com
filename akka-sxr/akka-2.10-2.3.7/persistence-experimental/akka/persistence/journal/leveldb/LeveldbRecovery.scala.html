<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>persistence-experimental/akka/persistence/journal/leveldb/LeveldbRecovery.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 * Copyright (C) 2012-2013 Eligotech BV.
 */</span>

<span class="keyword">package</span> akka.persistence.journal.leveldb

<span class="keyword">import</span> scala.concurrent.Future

<span class="keyword">import</span> akka.persistence._
<span class="keyword">import</span> akka.persistence.journal.AsyncRecovery
<span class="keyword">import</span> org.iq80.leveldb.DBIterator

<span class="comment">/**
 * INTERNAL API.
 *
 * LevelDB backed message replay and sequence number recovery.
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>persistence<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait LeveldbRecovery extends AnyRef with akka.persistence.journal.AsyncRecovery" id="akka.persistence.journal.leveldb;LeveldbRecovery">LeveldbRecovery</a> <span title="Unit" class="keyword">extends</span> <a href="../AsyncRecovery.scala.html#akka.persistence.journal;AsyncRecovery" title="akka.persistence.journal.AsyncRecovery">AsyncRecovery</a> <span class="delimiter">{</span> <span class="keyword">this</span>: LeveldbStore ⇒
  <span class="keyword">import</span> <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key" title="akka.persistence.journal.leveldb.Key.type">Key</a>._

  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="String" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayDispatcherId">replayDispatcherId</a> = <a href="LeveldbStore.scala.html#akka.persistence.journal.leveldb;LeveldbStore.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)String">getString</span><span class="delimiter">(</span><span title="String(&quot;replay-dispatcher&quot;)" class="string">&quot;replay-dispatcher&quot;</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="akka.dispatch.MessageDispatcher" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayDispatcher">replayDispatcher</a> = <a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.dispatchers" title="=&gt; akka.dispatch.Dispatchers">dispatchers</a>.<a href="../../../../../actor/akka/dispatch/Dispatchers.scala.html#akka.dispatch;Dispatchers.lookup" title="(id: String)akka.dispatch.MessageDispatcher">lookup</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayDispatcherId" title="=&gt; String">replayDispatcherId</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(persistenceId: String, fromSequenceNr: Long)scala.concurrent.Future[Long]" id="akka.persistence.journal.leveldb;LeveldbRecovery.asyncReadHighestSequenceNr">asyncReadHighestSequenceNr</a><span class="delimiter">(</span><a title="String" id="akka.persistence.journal.leveldb;LeveldbRecovery.asyncReadHighestSequenceNr.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="Long" id="akka.persistence.journal.leveldb;LeveldbRecovery.asyncReadHighestSequenceNr.fromSequenceNr">fromSequenceNr</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Long]">Future</span><span class="delimiter">[</span>Long<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="akka.persistence.journal.leveldb;LeveldbRecovery.asyncReadHighestSequenceNr.nid">nid</a> = <a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.numericId" title="(id: String)Int">numericId</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.asyncReadHighestSequenceNr.persistenceId" title="String">persistenceId</a><span class="delimiter">)</span>
    <span title="(body: =&gt; Long)(implicit execctx: scala.concurrent.ExecutionContext)scala.concurrent.Future[Long]">Future</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.readHighestSequenceNr" title="(persistenceId: Int)Long">readHighestSequenceNr</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.asyncReadHighestSequenceNr.nid" title="Int">nid</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayDispatcher" title="=&gt; akka.dispatch.MessageDispatcher">replayDispatcher</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(persistenceId: String, fromSequenceNr: Long, toSequenceNr: Long, max: Long)(replayCallback: akka.persistence.PersistentRepr =&gt; Unit)scala.concurrent.Future[Unit]" id="akka.persistence.journal.leveldb;LeveldbRecovery.asyncReplayMessages">asyncReplayMessages</a><span class="delimiter">(</span><a title="String" id="akka.persistence.journal.leveldb;LeveldbRecovery.asyncReplayMessages.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="Long" id="akka.persistence.journal.leveldb;LeveldbRecovery.asyncReplayMessages.fromSequenceNr">fromSequenceNr</a>: <span title="Long">Long</span>, <a title="Long" id="akka.persistence.journal.leveldb;LeveldbRecovery.asyncReplayMessages.toSequenceNr">toSequenceNr</a>: <span title="Long">Long</span>, <a title="Long" id="akka.persistence.journal.leveldb;LeveldbRecovery.asyncReplayMessages.max">max</a>: <span title="Long">Long</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="akka.persistence.PersistentRepr =&gt; Unit" id="akka.persistence.journal.leveldb;LeveldbRecovery.asyncReplayMessages.replayCallback">replayCallback</a>: PersistentRepr ⇒ Unit<span class="delimiter">)</span>: <span title="scala.concurrent.Future[Unit]">Future</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="akka.persistence.journal.leveldb;LeveldbRecovery.asyncReplayMessages.nid">nid</a> = <a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.numericId" title="(id: String)Int">numericId</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.asyncReplayMessages.persistenceId" title="String">persistenceId</a><span class="delimiter">)</span>
    <span title="(body: =&gt; Unit)(implicit execctx: scala.concurrent.ExecutionContext)scala.concurrent.Future[Unit]">Future</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages" title="(persistenceId: Int, fromSequenceNr: Long, toSequenceNr: Long, max: Long)(replayCallback: akka.persistence.PersistentRepr =&gt; Unit)Unit">replayMessages</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.asyncReplayMessages.nid" title="Int">nid</a>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.asyncReplayMessages.fromSequenceNr" title="Long">fromSequenceNr</a>: <span title="Long">Long</span>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.asyncReplayMessages.toSequenceNr" title="Long">toSequenceNr</a>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.asyncReplayMessages.max" title="Long">max</a>: <span title="Long">Long</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.asyncReplayMessages.replayCallback" title="akka.persistence.PersistentRepr =&gt; Unit">replayCallback</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayDispatcher" title="=&gt; akka.dispatch.MessageDispatcher">replayDispatcher</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(persistenceId: Int, fromSequenceNr: Long, toSequenceNr: Long, max: Long)(replayCallback: akka.persistence.PersistentRepr =&gt; Unit)Unit" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages">replayMessages</a><span class="delimiter">(</span><a title="Int" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.persistenceId">persistenceId</a>: <span title="Int">Int</span>, <a title="Long" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.fromSequenceNr">fromSequenceNr</a>: <span title="Long">Long</span>, <a title="Long" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.toSequenceNr">toSequenceNr</a>: <span title="Long">Long</span>, <a title="Long" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.max">max</a>: <span title="Long">Long</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="akka.persistence.PersistentRepr =&gt; Unit" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.replayCallback">replayCallback</a>: PersistentRepr ⇒ Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    @scala.annotation.tailrec
    <span class="keyword">def</span> <a title="(iter: org.iq80.leveldb.DBIterator, key: akka.persistence.journal.leveldb.Key, ctr: Long, replayCallback: akka.persistence.PersistentRepr =&gt; Unit)Unit" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go">go</a><span class="delimiter">(</span><a title="org.iq80.leveldb.DBIterator" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.iter">iter</a>: <span title="org.iq80.leveldb.DBIterator">DBIterator</span>, <a title="akka.persistence.journal.leveldb.Key" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.key">key</a>: <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key" title="akka.persistence.journal.leveldb.Key">Key</a>, <a title="Long" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.ctr">ctr</a>: <span title="Long">Long</span>, <a title="akka.persistence.PersistentRepr =&gt; Unit" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.replayCallback">replayCallback</a>: PersistentRepr ⇒ Unit<span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="java.util.Map.Entry[Array[Byte],Array[Byte]]" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.nextEntry">nextEntry</a> = <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="()java.util.Map.Entry[Array[Byte],Array[Byte]]">next</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="akka.persistence.journal.leveldb.Key" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.nextKey">nextKey</a> = <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyFromBytes" title="(bytes: Array[Byte])akka.persistence.journal.leveldb.Key">keyFromBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.nextEntry" title="java.util.Map.Entry[Array[Byte],Array[Byte]]">nextEntry</a>.<span title="()Array[Byte]">getKey</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.nextKey" title="akka.persistence.journal.leveldb.Key">nextKey</a>.<a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key.sequenceNr" title="=&gt; Long">sequenceNr</a> <span title="(x: Long)Boolean">&gt;</span> <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.toSequenceNr" title="Long">toSequenceNr</a><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span>
          <span class="comment">// end iteration here</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.nextKey" title="akka.persistence.journal.leveldb.Key">nextKey</a>.<a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key.channelId" title="=&gt; Int">channelId</a> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="comment">// phantom confirmation (just advance iterator)</span>
          <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go" title="(iter: org.iq80.leveldb.DBIterator, key: akka.persistence.journal.leveldb.Key, ctr: Long, replayCallback: akka.persistence.PersistentRepr =&gt; Unit)Unit">go</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.iter" title="org.iq80.leveldb.DBIterator">iter</a>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.nextKey" title="akka.persistence.journal.leveldb.Key">nextKey</a>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.ctr" title="Long">ctr</a>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.replayCallback" title="akka.persistence.PersistentRepr =&gt; Unit">replayCallback</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.key" title="akka.persistence.journal.leveldb.Key">key</a>.<a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key.persistenceId" title="=&gt; Int">persistenceId</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.nextKey" title="akka.persistence.journal.leveldb.Key">nextKey</a>.<a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key.persistenceId" title="=&gt; Int">persistenceId</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="akka.persistence.PersistentRepr" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.msg">msg</a> = <a href="LeveldbStore.scala.html#akka.persistence.journal.leveldb;LeveldbStore.persistentFromBytes" title="(a: Array[Byte])akka.persistence.PersistentRepr">persistentFromBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.nextEntry" title="java.util.Map.Entry[Array[Byte],Array[Byte]]">nextEntry</a>.<span title="()Array[Byte]">getValue</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Boolean" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.del">del</a> = <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion" title="(iter: org.iq80.leveldb.DBIterator, key: akka.persistence.journal.leveldb.Key)Boolean">deletion</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.iter" title="org.iq80.leveldb.DBIterator">iter</a>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.nextKey" title="akka.persistence.journal.leveldb.Key">nextKey</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="List[String]" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.cnf">cnf</a> = <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms" title="(iter: org.iq80.leveldb.DBIterator, key: akka.persistence.journal.leveldb.Key, channelIds: List[String])List[String]">confirms</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.iter" title="org.iq80.leveldb.DBIterator">iter</a>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.nextKey" title="akka.persistence.journal.leveldb.Key">nextKey</a>, <span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.ctr" title="Long">ctr</a> <span title="(x: Long)Boolean">&lt;</span> <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.max" title="Long">max</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.replayCallback" title="(v1: akka.persistence.PersistentRepr)Unit">replayCallback</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.msg" title="akka.persistence.PersistentRepr">msg</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentRepr.update$default$1" title="Long" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.x$9">update</a><span class="delimiter">(</span>confirms = <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.cnf" title="List[String]" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.x$2">cnf</a>, deleted = <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.del" title="Boolean" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.x$3">del</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go" title="(iter: org.iq80.leveldb.DBIterator, key: akka.persistence.journal.leveldb.Key, ctr: Long, replayCallback: akka.persistence.PersistentRepr =&gt; Unit)Unit">go</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.iter" title="org.iq80.leveldb.DBIterator">iter</a>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.nextKey" title="akka.persistence.journal.leveldb.Key">nextKey</a>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.ctr" title="Long">ctr</a> <span title="(x: Long)Long">+</span> <span title="Long(1L)" class="long">1L</span>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go.replayCallback" title="akka.persistence.PersistentRepr =&gt; Unit">replayCallback</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    @scala.annotation.tailrec
    <span class="keyword">def</span> <a title="(iter: org.iq80.leveldb.DBIterator, key: akka.persistence.journal.leveldb.Key, channelIds: List[String])List[String]" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms">confirms</a><span class="delimiter">(</span><a title="org.iq80.leveldb.DBIterator" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.iter">iter</a>: <span title="org.iq80.leveldb.DBIterator">DBIterator</span>, <a title="akka.persistence.journal.leveldb.Key" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.key">key</a>: <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key" title="akka.persistence.journal.leveldb.Key">Key</a>, <a title="List[String]" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.channelIds">channelIds</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span title="List[String]" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="java.util.Map.Entry[Array[Byte],Array[Byte]]" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.nextEntry">nextEntry</a> = <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="()java.util.Map.Entry[Array[Byte],Array[Byte]]">peekNext</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="akka.persistence.journal.leveldb.Key" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.nextKey">nextKey</a> = <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyFromBytes" title="(bytes: Array[Byte])akka.persistence.journal.leveldb.Key">keyFromBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.nextEntry" title="java.util.Map.Entry[Array[Byte],Array[Byte]]">nextEntry</a>.<span title="()Array[Byte]">getKey</span><span class="delimiter">)</span>
        <span title="List[String]" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.key" title="akka.persistence.journal.leveldb.Key">key</a>.<a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key.persistenceId" title="=&gt; Int">persistenceId</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.nextKey" title="akka.persistence.journal.leveldb.Key">nextKey</a>.<a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key.persistenceId" title="=&gt; Int">persistenceId</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.key" title="akka.persistence.journal.leveldb.Key">key</a>.<a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key.sequenceNr" title="=&gt; Long">sequenceNr</a> <span title="(x: Long)Boolean">==</span> <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.nextKey" title="akka.persistence.journal.leveldb.Key">nextKey</a>.<a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key.sequenceNr" title="=&gt; Long">sequenceNr</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="String" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.nextValue">nextValue</a> = <span title="(x$1: Array[Byte], x$2: String)String" class="keyword">new</span> <span title="String">String</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.nextEntry" title="java.util.Map.Entry[Array[Byte],Array[Byte]]">nextEntry</a>.<span title="()Array[Byte]">getValue</span>, <span title="String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span>
          <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="()java.util.Map.Entry[Array[Byte],Array[Byte]]">next</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms" title="(iter: org.iq80.leveldb.DBIterator, key: akka.persistence.journal.leveldb.Key, channelIds: List[String])List[String]">confirms</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.iter" title="org.iq80.leveldb.DBIterator">iter</a>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.nextKey" title="akka.persistence.journal.leveldb.Key">nextKey</a>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.nextValue" title="String">nextValue</a> <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.x$1" title="(x: String)List[String]">::</a> <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.channelIds" title="List[String]">channelIds</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.channelIds" title="List[String]">channelIds</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.confirms.channelIds" title="List[String]">channelIds</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(iter: org.iq80.leveldb.DBIterator, key: akka.persistence.journal.leveldb.Key)Boolean" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion">deletion</a><span class="delimiter">(</span><a title="org.iq80.leveldb.DBIterator" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion.iter">iter</a>: <span title="org.iq80.leveldb.DBIterator">DBIterator</span>, <a title="akka.persistence.journal.leveldb.Key" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion.key">key</a>: <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key" title="akka.persistence.journal.leveldb.Key">Key</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="java.util.Map.Entry[Array[Byte],Array[Byte]]" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion.nextEntry">nextEntry</a> = <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="()java.util.Map.Entry[Array[Byte],Array[Byte]]">peekNext</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="akka.persistence.journal.leveldb.Key" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion.nextKey">nextKey</a> = <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyFromBytes" title="(bytes: Array[Byte])akka.persistence.journal.leveldb.Key">keyFromBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion.nextEntry" title="java.util.Map.Entry[Array[Byte],Array[Byte]]">nextEntry</a>.<span title="()Array[Byte]">getKey</span><span class="delimiter">)</span>
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion.key" title="akka.persistence.journal.leveldb.Key">key</a>.<a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key.persistenceId" title="=&gt; Int">persistenceId</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion.nextKey" title="akka.persistence.journal.leveldb.Key">nextKey</a>.<a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key.persistenceId" title="=&gt; Int">persistenceId</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion.key" title="akka.persistence.journal.leveldb.Key">key</a>.<a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key.sequenceNr" title="=&gt; Long">sequenceNr</a> <span title="(x: Long)Boolean">==</span> <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion.nextKey" title="akka.persistence.journal.leveldb.Key">nextKey</a>.<a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key.sequenceNr" title="=&gt; Long">sequenceNr</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.isDeletionKey" title="(key: akka.persistence.journal.leveldb.Key)Boolean">isDeletionKey</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion.nextKey" title="akka.persistence.journal.leveldb.Key">nextKey</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.deletion.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="()java.util.Map.Entry[Array[Byte],Array[Byte]]">next</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span title="Boolean(true)" class="keyword">true</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>

    <a href="LeveldbStore.scala.html#akka.persistence.journal.leveldb;LeveldbStore.withIterator" title="(body: org.iq80.leveldb.DBIterator =&gt; Unit)Unit">withIterator</a> <span class="delimiter">{</span> <a title="org.iq80.leveldb.DBIterator" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.$anonfun.iter">iter</a> ⇒
      <span class="keyword">val</span> <a title="akka.persistence.journal.leveldb.Key" id="akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.$anonfun.startKey">startKey</a> = <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key" title="(persistenceId: Int, sequenceNr: Long, channelId: Int)akka.persistence.journal.leveldb.Key">Key</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.persistenceId" title="Int">persistenceId</a>, <span title="Long" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.fromSequenceNr" title="Long">fromSequenceNr</a> <span title="(x: Long)Boolean">&lt;</span> <span title="Long(1L)" class="long">1L</span><span class="delimiter">)</span> <span title="Long(1L)" class="long">1L</span> <span class="keyword">else</span> <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.fromSequenceNr" title="Long">fromSequenceNr</a>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.$anonfun.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="(x$1: Array[Byte])Unit">seek</span><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.$anonfun.startKey" title="akka.persistence.journal.leveldb.Key">startKey</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.go" title="(iter: org.iq80.leveldb.DBIterator, key: akka.persistence.journal.leveldb.Key, ctr: Long, replayCallback: akka.persistence.PersistentRepr =&gt; Unit)Unit">go</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.$anonfun.iter" title="org.iq80.leveldb.DBIterator">iter</a>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.$anonfun.startKey" title="akka.persistence.journal.leveldb.Key">startKey</a>, <span title="Long(0L)" class="long">0L</span>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.replayMessages.replayCallback" title="akka.persistence.PersistentRepr =&gt; Unit">replayCallback</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(persistenceId: Int)Long" id="akka.persistence.journal.leveldb;LeveldbRecovery.readHighestSequenceNr">readHighestSequenceNr</a><span class="delimiter">(</span><a title="Int" id="akka.persistence.journal.leveldb;LeveldbRecovery.readHighestSequenceNr.persistenceId">persistenceId</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.iq80.leveldb.ReadOptions" id="akka.persistence.journal.leveldb;LeveldbRecovery.readHighestSequenceNr.ro">ro</a> = <a href="LeveldbStore.scala.html#akka.persistence.journal.leveldb;LeveldbStore.leveldbSnapshot" title="()org.iq80.leveldb.ReadOptions">leveldbSnapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="LeveldbStore.scala.html#akka.persistence.journal.leveldb;LeveldbStore.leveldb" title="=&gt; org.iq80.leveldb.DB">leveldb</a>.<span title="(x$1: Array[Byte], x$2: org.iq80.leveldb.ReadOptions)Array[Byte]">get</span><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.counterKey" title="(persistenceId: Int)akka.persistence.journal.leveldb.Key">counterKey</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.readHighestSequenceNr.persistenceId" title="Int">persistenceId</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.readHighestSequenceNr.ro" title="org.iq80.leveldb.ReadOptions">ro</a><span class="delimiter">)</span> <span title="Long" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span>  ⇒ <span title="Long(0L)" class="long">0L</span>
        <span class="keyword">case</span> <a title="Array[Byte]" id="akka.persistence.journal.leveldb;LeveldbRecovery.readHighestSequenceNr.bytes">bytes</a> ⇒ <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.counterFromBytes" title="(bytes: Array[Byte])Long">counterFromBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbRecovery.readHighestSequenceNr.bytes" title="Array[Byte]">bytes</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbRecovery.readHighestSequenceNr.ro" title="org.iq80.leveldb.ReadOptions">ro</a>.<span title="()org.iq80.leveldb.Snapshot">snapshot</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
