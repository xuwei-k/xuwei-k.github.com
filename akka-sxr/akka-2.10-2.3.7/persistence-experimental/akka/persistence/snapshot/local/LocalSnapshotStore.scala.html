<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>persistence-experimental/akka/persistence/snapshot/local/LocalSnapshotStore.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 * Copyright (C) 2012-2013 Eligotech BV.
 */</span>

<span class="keyword">package</span> akka.persistence.snapshot.local

<span class="keyword">import</span> java.io._
<span class="keyword">import</span> java.net.<span class="delimiter">{</span> URLDecoder, URLEncoder <span class="delimiter">}</span>

<span class="keyword">import</span> scala.collection.immutable
<span class="keyword">import</span> scala.concurrent.Future
<span class="keyword">import</span> scala.util._

<span class="keyword">import</span> akka.actor.ActorLogging
<span class="keyword">import</span> akka.persistence._
<span class="keyword">import</span> akka.persistence.snapshot._
<span class="keyword">import</span> akka.persistence.serialization._
<span class="keyword">import</span> akka.serialization.SerializationExtension

<span class="comment">/**
 * INTERNAL API.
 *
 * Local filesystem backed snapshot store.
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>persistence<span class="delimiter">]</span> <span class="keyword">class</span> <a title="class LocalSnapshotStore extends AnyRef with akka.persistence.snapshot.SnapshotStore with akka.actor.ActorLogging" id="akka.persistence.snapshot.local;LocalSnapshotStore">LocalSnapshotStore</a> <a href="#akka.persistence.snapshot.local;LocalSnapshotStore" title="akka.persistence.snapshot.local.LocalSnapshotStore" class="keyword">extends</a> <a href="../SnapshotStore.scala.html#akka.persistence.snapshot;SnapshotStore" title="akka.persistence.snapshot.SnapshotStore">SnapshotStore</a> <span class="keyword">with</span> <a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="akka.persistence.snapshot.local;LocalSnapshotStore.FilenamePattern">FilenamePattern</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;^snapshot-(.+)-(\d+)-(\d+)&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="com.typesafe.config.Config" id="akka.persistence.snapshot.local;LocalSnapshotStore.config">config</a> = <a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.settings" title="=&gt; akka.actor.ActorSystem.Settings">settings</a>.<a href="../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor.ActorSystem;Settings.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)com.typesafe.config.Config">getConfig</span><span class="delimiter">(</span><span title="String(&quot;akka.persistence.snapshot-store.local&quot;)" class="string">&quot;akka.persistence.snapshot-store.local&quot;</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="akka.dispatch.MessageDispatcher" id="akka.persistence.snapshot.local;LocalSnapshotStore.streamDispatcher">streamDispatcher</a> = <a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.dispatchers" title="=&gt; akka.dispatch.Dispatchers">dispatchers</a>.<a href="../../../../../actor/akka/dispatch/Dispatchers.scala.html#akka.dispatch;Dispatchers.lookup" title="(id: String)akka.dispatch.MessageDispatcher">lookup</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)String">getString</span><span class="delimiter">(</span><span title="String(&quot;stream-dispatcher&quot;)" class="string">&quot;stream-dispatcher&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.io.File" id="akka.persistence.snapshot.local;LocalSnapshotStore.snapshotDir">snapshotDir</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)String">getString</span><span class="delimiter">(</span><span title="String(&quot;dir&quot;)" class="string">&quot;dir&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="akka.serialization.Serialization" id="akka.persistence.snapshot.local;LocalSnapshotStore.serializationExtension">serializationExtension</a> = <a href="../../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.serialization.Serialization">SerializationExtension</a><span class="delimiter">(</span><a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="scala.collection.immutable.Set[akka.persistence.SnapshotMetadata]" id="akka.persistence.snapshot.local;LocalSnapshotStore.saving_=">saving</a> = immutable.<span title="scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.immutable.Set[A]">empty</span><span title="scala.collection.immutable.Set[akka.persistence.SnapshotMetadata]" class="delimiter">[</span><a href="../../Snapshot.scala.html#akka.persistence;SnapshotMetadata" title="akka.persistence.SnapshotMetadata">SnapshotMetadata</a><span class="delimiter">]</span> <span class="comment">// saving in progress</span>

  <span class="keyword">def</span> <a title="(persistenceId: String, criteria: akka.persistence.SnapshotSelectionCriteria)scala.concurrent.Future[Option[akka.persistence.SelectedSnapshot]]" id="akka.persistence.snapshot.local;LocalSnapshotStore.loadAsync">loadAsync</a><span class="delimiter">(</span><a title="String" id="akka.persistence.snapshot.local;LocalSnapshotStore.loadAsync.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="akka.persistence.SnapshotSelectionCriteria" id="akka.persistence.snapshot.local;LocalSnapshotStore.loadAsync.criteria">criteria</a>: <a href="../../Snapshot.scala.html#akka.persistence;SnapshotSelectionCriteria" title="akka.persistence.SnapshotSelectionCriteria">SnapshotSelectionCriteria</a><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Option[akka.persistence.SelectedSnapshot]]">Future</span><span class="delimiter">[</span>Option<span class="delimiter">[</span>SelectedSnapshot<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="comment">//</span>
    <span class="comment">// Heuristics:</span>
    <span class="comment">//</span>
    <span class="comment">// Select youngest 3 snapshots that match upper bound. This may help in situations</span>
    <span class="comment">// where saving of a snapshot could not be completed because of a JVM crash. Hence,</span>
    <span class="comment">// an attempt to load that snapshot will fail but loading an older snapshot may</span>
    <span class="comment">// succeed.</span>
    <span class="comment">//</span>
    <span class="comment">// TODO: make number of loading attempts configurable</span>
    <span class="comment">//</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata]" id="akka.persistence.snapshot.local;LocalSnapshotStore.loadAsync.metadata">metadata</a> = <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata" title="(persistenceId: String, criteria: akka.persistence.SnapshotSelectionCriteria)scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata]">snapshotMetadata</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.loadAsync.persistenceId" title="String">persistenceId</a>, <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.loadAsync.criteria" title="akka.persistence.SnapshotSelectionCriteria">criteria</a><span class="delimiter">)</span>.<a href="../../package.scala.html#akka.persistence.package.snapshotMetadataOrdering" title="(implicit ord: scala.math.Ordering[akka.persistence.SnapshotMetadata])scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata]">sorted</a>.<span title="(n: Int)scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata]">takeRight</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>
    <span title="(body: =&gt; Option[akka.persistence.SelectedSnapshot])(implicit execctx: scala.concurrent.ExecutionContext)scala.concurrent.Future[Option[akka.persistence.SelectedSnapshot]]">Future</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.load" title="(metadata: scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata])Option[akka.persistence.SelectedSnapshot]">load</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.loadAsync.metadata" title="scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata]">metadata</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.streamDispatcher" title="=&gt; akka.dispatch.MessageDispatcher">streamDispatcher</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(metadata: akka.persistence.SnapshotMetadata, snapshot: Any)scala.concurrent.Future[Unit]" id="akka.persistence.snapshot.local;LocalSnapshotStore.saveAsync">saveAsync</a><span class="delimiter">(</span><a title="akka.persistence.SnapshotMetadata" id="akka.persistence.snapshot.local;LocalSnapshotStore.saveAsync.metadata">metadata</a>: <a href="../../Snapshot.scala.html#akka.persistence;SnapshotMetadata" title="akka.persistence.SnapshotMetadata">SnapshotMetadata</a>, <a title="Any" id="akka.persistence.snapshot.local;LocalSnapshotStore.saveAsync.snapshot">snapshot</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Unit]">Future</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.saving_=" title="(x$1: scala.collection.immutable.Set[akka.persistence.SnapshotMetadata])Unit">saving</a> <span title="(elem: akka.persistence.SnapshotMetadata)scala.collection.immutable.Set[akka.persistence.SnapshotMetadata]">+=</span> <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.saveAsync.metadata" title="akka.persistence.SnapshotMetadata">metadata</a>
    <span title="(body: =&gt; Unit)(implicit execctx: scala.concurrent.ExecutionContext)scala.concurrent.Future[Unit]">Future</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.save" title="(metadata: akka.persistence.SnapshotMetadata, snapshot: Any)Unit">save</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.saveAsync.metadata" title="akka.persistence.SnapshotMetadata">metadata</a>, <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.saveAsync.snapshot" title="Any">snapshot</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.streamDispatcher" title="=&gt; akka.dispatch.MessageDispatcher">streamDispatcher</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(metadata: akka.persistence.SnapshotMetadata)Unit" id="akka.persistence.snapshot.local;LocalSnapshotStore.saved">saved</a><span class="delimiter">(</span><a title="akka.persistence.SnapshotMetadata" id="akka.persistence.snapshot.local;LocalSnapshotStore.saved.metadata">metadata</a>: <a href="../../Snapshot.scala.html#akka.persistence;SnapshotMetadata" title="akka.persistence.SnapshotMetadata">SnapshotMetadata</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.saving_=" title="(x$1: scala.collection.immutable.Set[akka.persistence.SnapshotMetadata])Unit">saving</a> <span title="(elem: akka.persistence.SnapshotMetadata)scala.collection.immutable.Set[akka.persistence.SnapshotMetadata]">-=</span> <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.saved.metadata" title="akka.persistence.SnapshotMetadata">metadata</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(metadata: akka.persistence.SnapshotMetadata)Unit" id="akka.persistence.snapshot.local;LocalSnapshotStore.delete(2a564723df)">delete</a><span class="delimiter">(</span><a title="akka.persistence.SnapshotMetadata" id="akka.persistence.snapshot.local;LocalSnapshotStore.delete(2a564723df).metadata">metadata</a>: <a href="../../Snapshot.scala.html#akka.persistence;SnapshotMetadata" title="akka.persistence.SnapshotMetadata">SnapshotMetadata</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.saving_=" title="(x$1: scala.collection.immutable.Set[akka.persistence.SnapshotMetadata])Unit">saving</a> <span title="(elem: akka.persistence.SnapshotMetadata)scala.collection.immutable.Set[akka.persistence.SnapshotMetadata]">-=</span> <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.delete(2a564723df).metadata" title="akka.persistence.SnapshotMetadata">metadata</a>
    <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotFile" title="(metadata: akka.persistence.SnapshotMetadata, extension: String)java.io.File">snapshotFile</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.delete(2a564723df).metadata" title="akka.persistence.SnapshotMetadata">metadata</a><span class="delimiter">)</span>.<span title="()Boolean">delete</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(persistenceId: String, criteria: akka.persistence.SnapshotSelectionCriteria)Unit" id="akka.persistence.snapshot.local;LocalSnapshotStore.delete(49d2613d09)">delete</a><span class="delimiter">(</span><a title="String" id="akka.persistence.snapshot.local;LocalSnapshotStore.delete(49d2613d09).persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="akka.persistence.SnapshotSelectionCriteria" id="akka.persistence.snapshot.local;LocalSnapshotStore.delete(49d2613d09).criteria">criteria</a>: <a href="../../Snapshot.scala.html#akka.persistence;SnapshotSelectionCriteria" title="akka.persistence.SnapshotSelectionCriteria">SnapshotSelectionCriteria</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata" title="(persistenceId: String, criteria: akka.persistence.SnapshotSelectionCriteria)scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata]">snapshotMetadata</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.delete(49d2613d09).persistenceId" title="String">persistenceId</a>, <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.delete(49d2613d09).criteria" title="akka.persistence.SnapshotSelectionCriteria">criteria</a><span class="delimiter">)</span>.<span title="(f: akka.persistence.SnapshotMetadata =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.delete(2a564723df)" title="(metadata: akka.persistence.SnapshotMetadata)Unit">delete</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  @scala.annotation.tailrec
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(metadata: scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata])Option[akka.persistence.SelectedSnapshot]" id="akka.persistence.snapshot.local;LocalSnapshotStore.load">load</a><span class="delimiter">(</span><a title="scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata]" id="akka.persistence.snapshot.local;LocalSnapshotStore.load.metadata">metadata</a>: immutable.<span title="scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata]">Seq</span><span class="delimiter">[</span>SnapshotMetadata<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[akka.persistence.SelectedSnapshot]">Option</span><span class="delimiter">[</span>SelectedSnapshot<span class="delimiter">]</span> = <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.load.metadata" title="scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata]">metadata</a>.<span title="=&gt; Option[akka.persistence.SnapshotMetadata]">lastOption</span> <span title="Option[akka.persistence.SelectedSnapshot]" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="None.type">None</span> ⇒ <span title="None.type">None</span>
    <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="akka.persistence.SnapshotMetadata" id="akka.persistence.snapshot.local;LocalSnapshotStore.load.md">md</a><span class="delimiter">)</span> ⇒
      <span title="(r: =&gt; akka.persistence.serialization.Snapshot)scala.util.Try[akka.persistence.serialization.Snapshot]">Try</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withInputStream" title="(metadata: akka.persistence.SnapshotMetadata)(p: java.io.InputStream =&gt; akka.persistence.serialization.Snapshot)akka.persistence.serialization.Snapshot">withInputStream</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.load.md" title="akka.persistence.SnapshotMetadata">md</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.deserialize" title="(inputStream: java.io.InputStream)akka.persistence.serialization.Snapshot">deserialize</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Option[akka.persistence.SelectedSnapshot]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Success<span class="delimiter">(</span><a title="akka.persistence.serialization.Snapshot" id="akka.persistence.snapshot.local;LocalSnapshotStore.load.s">s</a><span class="delimiter">)</span> ⇒ <span title="(x: akka.persistence.SelectedSnapshot)Some[akka.persistence.SelectedSnapshot]">Some</span><span class="delimiter">(</span><a href="../../Snapshot.scala.html#akka.persistence;SelectedSnapshot" title="(metadata: akka.persistence.SnapshotMetadata, snapshot: Any)akka.persistence.SelectedSnapshot">SelectedSnapshot</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.load.md" title="akka.persistence.SnapshotMetadata">md</a>, <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.load.s" title="akka.persistence.serialization.Snapshot">s</a>.<a href="../../serialization/SnapshotSerializer.scala.html#akka.persistence.serialization;Snapshot.data" title="=&gt; Any">data</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> Failure<span class="delimiter">(</span><a title="Throwable" id="akka.persistence.snapshot.local;LocalSnapshotStore.load.e">e</a><span class="delimiter">)</span> ⇒
          <a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.error(de736aeaab)" title="(cause: Throwable, message: String)Unit">error</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.load.e" title="Throwable">e</a>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Error loading snapshot [&quot;)">Error loading snapshot [$</span><span class="delimiter">{</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.load.md" title="akka.persistence.SnapshotMetadata">md</a><span class="delimiter">}</span><span title="String(&quot;]&quot;)" class="string">]&quot;</span><span class="delimiter">)</span>
          <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.load" title="(metadata: scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata])Option[akka.persistence.SelectedSnapshot]">load</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.load.metadata" title="scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata]">metadata</a>.<span title="=&gt; scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata]">init</span><span class="delimiter">)</span> <span class="comment">// try older snapshot</span>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(metadata: akka.persistence.SnapshotMetadata, snapshot: Any)Unit" id="akka.persistence.snapshot.local;LocalSnapshotStore.save">save</a><span class="delimiter">(</span><a title="akka.persistence.SnapshotMetadata" id="akka.persistence.snapshot.local;LocalSnapshotStore.save.metadata">metadata</a>: <a href="../../Snapshot.scala.html#akka.persistence;SnapshotMetadata" title="akka.persistence.SnapshotMetadata">SnapshotMetadata</a>, <a title="Any" id="akka.persistence.snapshot.local;LocalSnapshotStore.save.snapshot">snapshot</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.File" id="akka.persistence.snapshot.local;LocalSnapshotStore.save.tmpFile">tmpFile</a> = <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withOutputStream" title="(metadata: akka.persistence.SnapshotMetadata)(p: java.io.OutputStream =&gt; Unit)java.io.File">withOutputStream</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.save.metadata" title="akka.persistence.SnapshotMetadata">metadata</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.serialize" title="(outputStream: java.io.OutputStream, snapshot: akka.persistence.serialization.Snapshot)Unit">serialize</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.save.tmpFile.$anonfun.x$1" title="java.io.OutputStream">_</a>, <a href="../../serialization/SnapshotSerializer.scala.html#akka.persistence.serialization;Snapshot" title="(data: Any)akka.persistence.serialization.Snapshot">Snapshot</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.save.snapshot" title="Any">snapshot</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.save.tmpFile" title="java.io.File">tmpFile</a>.<span title="(x$1: java.io.File)Boolean">renameTo</span><span title="Unit" class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotFile" title="(metadata: akka.persistence.SnapshotMetadata, extension: String)java.io.File">snapshotFile</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.save.metadata" title="akka.persistence.SnapshotMetadata">metadata</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(inputStream: java.io.InputStream)akka.persistence.serialization.Snapshot" id="akka.persistence.snapshot.local;LocalSnapshotStore.deserialize">deserialize</a><span class="delimiter">(</span><a title="java.io.InputStream" id="akka.persistence.snapshot.local;LocalSnapshotStore.deserialize.inputStream">inputStream</a>: <span title="java.io.InputStream">InputStream</span><span class="delimiter">)</span>: <a href="../../serialization/SnapshotSerializer.scala.html#akka.persistence.serialization;Snapshot" title="akka.persistence.serialization.Snapshot">Snapshot</a> =
    <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.serializationExtension" title="=&gt; akka.serialization.Serialization">serializationExtension</a>.<a href="../../../../../actor/akka/serialization/Serialization.scala.html#akka.serialization;Serialization.deserialize(2392165273)" title="(bytes: Array[Byte], clazz: Class[akka.persistence.serialization.Snapshot])scala.util.Try[akka.persistence.serialization.Snapshot]">deserialize</a><span class="delimiter">(</span><a href="../../serialization/package.scala.html#akka.persistence.serialization.package.streamToBytes" title="(inputStream: java.io.InputStream)Array[Byte]">streamToBytes</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.deserialize.inputStream" title="java.io.InputStream">inputStream</a><span class="delimiter">)</span>, classOf<span title="Class[akka.persistence.serialization.Snapshot](classOf[akka.persistence.serialization.Snapshot])" class="delimiter">[</span>Snapshot<span class="delimiter">]</span><span class="delimiter">)</span>.<span title="=&gt; akka.persistence.serialization.Snapshot">get</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(outputStream: java.io.OutputStream, snapshot: akka.persistence.serialization.Snapshot)Unit" id="akka.persistence.snapshot.local;LocalSnapshotStore.serialize">serialize</a><span class="delimiter">(</span><a title="java.io.OutputStream" id="akka.persistence.snapshot.local;LocalSnapshotStore.serialize.outputStream">outputStream</a>: <span title="java.io.OutputStream">OutputStream</span>, <a title="akka.persistence.serialization.Snapshot" id="akka.persistence.snapshot.local;LocalSnapshotStore.serialize.snapshot">snapshot</a>: <a href="../../serialization/SnapshotSerializer.scala.html#akka.persistence.serialization;Snapshot" title="akka.persistence.serialization.Snapshot">Snapshot</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.serialize.outputStream" title="java.io.OutputStream">outputStream</a>.<span title="(x$1: Array[Byte])Unit">write</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.serializationExtension" title="=&gt; akka.serialization.Serialization">serializationExtension</a>.<a href="../../../../../actor/akka/serialization/Serialization.scala.html#akka.serialization;Serialization.findSerializerFor" title="(o: AnyRef)akka.serialization.Serializer">findSerializerFor</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.serialize.snapshot" title="akka.persistence.serialization.Snapshot">snapshot</a><span class="delimiter">)</span>.<a href="../../../../../actor/akka/serialization/Serializer.scala.html#akka.serialization;Serializer.toBinary" title="(o: AnyRef)Array[Byte]">toBinary</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.serialize.snapshot" title="akka.persistence.serialization.Snapshot">snapshot</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(metadata: akka.persistence.SnapshotMetadata)(p: java.io.OutputStream =&gt; Unit)java.io.File" id="akka.persistence.snapshot.local;LocalSnapshotStore.withOutputStream">withOutputStream</a><span class="delimiter">(</span><a title="akka.persistence.SnapshotMetadata" id="akka.persistence.snapshot.local;LocalSnapshotStore.withOutputStream.metadata">metadata</a>: <a href="../../Snapshot.scala.html#akka.persistence;SnapshotMetadata" title="akka.persistence.SnapshotMetadata">SnapshotMetadata</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="java.io.OutputStream =&gt; Unit" id="akka.persistence.snapshot.local;LocalSnapshotStore.withOutputStream.p">p</a>: <span class="delimiter">(</span>OutputStream<span class="delimiter">)</span> ⇒ Unit<span class="delimiter">)</span>: <span title="java.io.File">File</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.File" id="akka.persistence.snapshot.local;LocalSnapshotStore.withOutputStream.tmpFile">tmpFile</a> = <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotFile" title="(metadata: akka.persistence.SnapshotMetadata, extension: String)java.io.File">snapshotFile</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withOutputStream.metadata" title="akka.persistence.SnapshotMetadata">metadata</a>, extension = <span title="String(&quot;tmp&quot;)" class="string">&quot;tmp&quot;</span><span class="delimiter">)</span>
    <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withStream" title="(stream: java.io.BufferedOutputStream, p: java.io.BufferedOutputStream =&gt; Unit)Unit">withStream</a><span class="delimiter">(</span><span title="java.io.BufferedOutputStream" class="keyword">new</span> <span title="java.io.BufferedOutputStream">BufferedOutputStream</span><span class="delimiter">(</span><span title="(x$1: java.io.File)java.io.FileOutputStream" class="keyword">new</span> <span title="java.io.FileOutputStream">FileOutputStream</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withOutputStream.tmpFile" title="java.io.File">tmpFile</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withOutputStream.p" title="java.io.OutputStream =&gt; Unit">p</a><span class="delimiter">)</span>
    <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withOutputStream.tmpFile" title="java.io.File">tmpFile</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](metadata: akka.persistence.SnapshotMetadata)(p: java.io.InputStream =&gt; T)T" id="akka.persistence.snapshot.local;LocalSnapshotStore.withInputStream">withInputStream</a><span class="delimiter">[</span><a title="" id="akka.persistence.snapshot.local;LocalSnapshotStore.withInputStream;T">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="akka.persistence.SnapshotMetadata" id="akka.persistence.snapshot.local;LocalSnapshotStore.withInputStream.metadata">metadata</a>: <a href="../../Snapshot.scala.html#akka.persistence;SnapshotMetadata" title="akka.persistence.SnapshotMetadata">SnapshotMetadata</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="java.io.InputStream =&gt; T" id="akka.persistence.snapshot.local;LocalSnapshotStore.withInputStream.p">p</a>: <span class="delimiter">(</span>InputStream<span class="delimiter">)</span> ⇒ T<span class="delimiter">)</span>: <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withInputStream;T" title="T">T</a> =
    <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withStream" title="(stream: java.io.BufferedInputStream, p: java.io.BufferedInputStream =&gt; T)T">withStream</a><span class="delimiter">(</span><span title="java.io.BufferedInputStream" class="keyword">new</span> <span title="java.io.BufferedInputStream">BufferedInputStream</span><span class="delimiter">(</span><span title="(x$1: java.io.File)java.io.FileInputStream" class="keyword">new</span> <span title="java.io.FileInputStream">FileInputStream</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotFile" title="(metadata: akka.persistence.SnapshotMetadata, extension: String)java.io.File">snapshotFile</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withInputStream.metadata" title="akka.persistence.SnapshotMetadata">metadata</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withInputStream.p" title="java.io.InputStream =&gt; T">p</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[A &lt;: java.io.Closeable, B](stream: A, p: A =&gt; B)B" id="akka.persistence.snapshot.local;LocalSnapshotStore.withStream">withStream</a><span class="delimiter">[</span><a title=" &lt;: java.io.Closeable" id="akka.persistence.snapshot.local;LocalSnapshotStore.withStream;A">A</a> &lt;: Closeable, <a title="" id="akka.persistence.snapshot.local;LocalSnapshotStore.withStream;B">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A" id="akka.persistence.snapshot.local;LocalSnapshotStore.withStream.stream">stream</a>: <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withStream;A" title="A">A</a>, <a title="A =&gt; B" id="akka.persistence.snapshot.local;LocalSnapshotStore.withStream.p">p</a>: A ⇒ B<span class="delimiter">)</span>: <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withStream;B" title="B">B</a> =
    <span class="keyword">try</span> <span class="delimiter">{</span> <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withStream.p" title="(v1: A)B">p</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withStream.stream" title="A">stream</a><span class="delimiter">)</span> <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span> <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.withStream.stream" title="A">stream</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(metadata: akka.persistence.SnapshotMetadata, extension: String)java.io.File" id="akka.persistence.snapshot.local;LocalSnapshotStore.snapshotFile">snapshotFile</a><span class="delimiter">(</span><a title="akka.persistence.SnapshotMetadata" id="akka.persistence.snapshot.local;LocalSnapshotStore.snapshotFile.metadata">metadata</a>: <a href="../../Snapshot.scala.html#akka.persistence;SnapshotMetadata" title="akka.persistence.SnapshotMetadata">SnapshotMetadata</a>, <a title="String" id="akka.persistence.snapshot.local;LocalSnapshotStore.snapshotFile$default$2">extension</a>: <span title="String">String</span> = <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>: <span title="java.io.File">File</span> =
    <span title="(x$1: java.io.File, x$2: String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotDir" title="=&gt; java.io.File">snapshotDir</a>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;snapshot-&quot;)">snapshot-$</span><span class="delimiter">{</span><span title="java.net.URLEncoder.type">URLEncoder</span>.<span title="(x$1: String, x$2: String)String">encode</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotFile.metadata" title="akka.persistence.SnapshotMetadata">metadata</a>.<a href="../../Snapshot.scala.html#akka.persistence;SnapshotMetadata.persistenceId" title="=&gt; String">persistenceId</a>, <span title="String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span><span class="delimiter">}</span><span title="String(&quot;-&quot;)">-$</span><span class="delimiter">{</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotFile.metadata" title="akka.persistence.SnapshotMetadata">metadata</a>.<a href="../../Snapshot.scala.html#akka.persistence;SnapshotMetadata.sequenceNr" title="=&gt; Long">sequenceNr</a><span class="delimiter">}</span><span title="String(&quot;-&quot;)">-$</span><span class="delimiter">{</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotFile.metadata" title="akka.persistence.SnapshotMetadata">metadata</a>.<a href="../../Snapshot.scala.html#akka.persistence;SnapshotMetadata.timestamp" title="=&gt; Long">timestamp</a><span class="delimiter">}</span><span title="String(&quot;&quot;)">$</span><span class="delimiter">{</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotFile$default$2" title="String">extension</a><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(persistenceId: String, criteria: akka.persistence.SnapshotSelectionCriteria)scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata]" id="akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata">snapshotMetadata</a><span class="delimiter">(</span><a title="String" id="akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="akka.persistence.SnapshotSelectionCriteria" id="akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata.criteria">criteria</a>: <a href="../../Snapshot.scala.html#akka.persistence;SnapshotSelectionCriteria" title="akka.persistence.SnapshotSelectionCriteria">SnapshotSelectionCriteria</a><span class="delimiter">)</span>: immutable.<span title="scala.collection.immutable.Seq[akka.persistence.SnapshotMetadata]">Seq</span><span class="delimiter">[</span>SnapshotMetadata<span class="delimiter">]</span> =
    <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotDir" title="=&gt; java.io.File">snapshotDir</a>.<span title="(x$1: java.io.FilenameFilter)Array[java.io.File]">listFiles</span><span title="(xs: Array[java.io.File])scala.collection.mutable.ArrayOps[java.io.File]" class="delimiter">(</span><span title="LocalSnapshotStore.this.SnapshotFilenameFilter" class="keyword">new</span> <a href="#akka.persistence.snapshot.local;LocalSnapshotStore;SnapshotFilenameFilter" title="LocalSnapshotStore.this.SnapshotFilenameFilter">SnapshotFilenameFilter</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata.persistenceId" title="String">persistenceId</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: java.io.File =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.io.File],String,Array[String]])Array[String]">map</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata.$anonfun.x$2" title="java.io.File">_</a>.<span title="()String">getName</span><span class="delimiter">)</span>.<span title="(pf: PartialFunction[String,akka.persistence.SnapshotMetadata])(implicit bf: scala.collection.generic.CanBuildFrom[Array[String],akka.persistence.SnapshotMetadata,Array[akka.persistence.SnapshotMetadata]])Array[akka.persistence.SnapshotMetadata]">collect</span> <a title="(xs: Array[akka.persistence.SnapshotMetadata])scala.collection.mutable.ArrayOps[akka.persistence.SnapshotMetadata]" id="akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.FilenamePattern" title="(target: Any)Option[List[String]]">FilenamePattern</a><span class="delimiter">(</span><a title="String" id="akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata;$anonfun.isDefinedAt.pid">pid</a>, <a title="String" id="akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata;$anonfun.isDefinedAt.snr">snr</a>, <a title="String" id="akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata;$anonfun.isDefinedAt.tms">tms</a><span class="delimiter">)</span> ⇒ <a href="../../Snapshot.scala.html#akka.persistence;SnapshotMetadata" title="(persistenceId: String, sequenceNr: Long, timestamp: Long)akka.persistence.SnapshotMetadata">SnapshotMetadata</a><span title="Boolean(true)" class="delimiter">(</span><span title="java.net.URLDecoder.type">URLDecoder</span>.<span title="(x$1: String, x$2: String)String">decode</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata;$anonfun.isDefinedAt.pid" title="String">pid</a>, <span title="String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span>, <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata;$anonfun.isDefinedAt.snr" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">snr</a>.<span title="=&gt; Long">toLong</span>, <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata;$anonfun.isDefinedAt.tms" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">tms</a>.<span title="=&gt; Long">toLong</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="(p: akka.persistence.SnapshotMetadata =&gt; Boolean)Array[akka.persistence.SnapshotMetadata]">filter</span><span title="(xs: Array[akka.persistence.SnapshotMetadata])scala.collection.mutable.ArrayOps[akka.persistence.SnapshotMetadata]" class="delimiter">(</span><a title="akka.persistence.SnapshotMetadata" id="akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata.$anonfun.md">md</a> ⇒ <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata.criteria" title="akka.persistence.SnapshotSelectionCriteria">criteria</a>.<a href="../../Snapshot.scala.html#akka.persistence;SnapshotSelectionCriteria.matches" title="(metadata: akka.persistence.SnapshotMetadata)Boolean">matches</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata.$anonfun.md" title="akka.persistence.SnapshotMetadata">md</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.saving_=" title="=&gt; scala.collection.immutable.Set[akka.persistence.SnapshotMetadata]">saving</a>.<span title="(elem: akka.persistence.SnapshotMetadata)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotMetadata.$anonfun.md" title="akka.persistence.SnapshotMetadata">md</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; Vector[akka.persistence.SnapshotMetadata]">toVector</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.persistence.snapshot.local;LocalSnapshotStore.preStart">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotDir" title="=&gt; java.io.File">snapshotDir</a>.<span title="()Boolean">isDirectory</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// try to create the directory, on failure double check if someone else beat us to it</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotDir" title="=&gt; java.io.File">snapshotDir</a>.<span title="()Boolean">mkdirs</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotDir" title="=&gt; java.io.File">snapshotDir</a>.<span title="()Boolean">isDirectory</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)java.io.IOException" class="keyword">new</span> <span title="java.io.IOException">IOException</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Failed to create snapshot directory [&quot;)">Failed to create snapshot directory [$</span><span class="delimiter">{</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore.snapshotDir" title="=&gt; java.io.File">snapshotDir</a>.<span title="()String">getCanonicalPath</span><span class="delimiter">}</span><span title="String(&quot;]&quot;)" class="string">]&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#akka.persistence.snapshot.local;LocalSnapshotStore" title="akka.persistence.snapshot.local.LocalSnapshotStore" class="keyword">super</a>.<a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.preStart" title="()Unit">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">class</span> <a title="class SnapshotFilenameFilter extends Object with java.io.FilenameFilter" id="akka.persistence.snapshot.local;LocalSnapshotStore;SnapshotFilenameFilter">SnapshotFilenameFilter</a><a href="#akka.persistence.snapshot.local;LocalSnapshotStore;SnapshotFilenameFilter" title="LocalSnapshotStore.this.SnapshotFilenameFilter" class="delimiter">(</a><a title="String" id="akka.persistence.snapshot.local;LocalSnapshotStore;SnapshotFilenameFilter.persistenceId">persistenceId</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.io.FilenameFilter">FilenameFilter</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(dir: java.io.File, name: String)Boolean" id="akka.persistence.snapshot.local;LocalSnapshotStore;SnapshotFilenameFilter.accept">accept</a><span class="delimiter">(</span><a title="java.io.File" id="akka.persistence.snapshot.local;LocalSnapshotStore;SnapshotFilenameFilter.accept.dir">dir</a>: <span title="java.io.File">File</span>, <a title="String" id="akka.persistence.snapshot.local;LocalSnapshotStore;SnapshotFilenameFilter.accept.name">name</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> =
      <a href="#akka.persistence.snapshot.local;LocalSnapshotStore;SnapshotFilenameFilter.accept.name" title="String">name</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#akka.persistence.snapshot.local;LocalSnapshotStore.FilenamePattern" title="(target: Any)Option[List[String]]">FilenamePattern</a><span class="delimiter">(</span><a title="String" id="akka.persistence.snapshot.local;LocalSnapshotStore;SnapshotFilenameFilter.accept.pid">pid</a>, <a title="String" id="akka.persistence.snapshot.local;LocalSnapshotStore;SnapshotFilenameFilter.accept.snr">snr</a>, <a title="String" id="akka.persistence.snapshot.local;LocalSnapshotStore;SnapshotFilenameFilter.accept.tms">tms</a><span class="delimiter">)</span> ⇒ <a href="#akka.persistence.snapshot.local;LocalSnapshotStore;SnapshotFilenameFilter.accept.pid" title="String">pid</a>.<span title="(x$1: Any)Boolean">equals</span><span class="delimiter">(</span><span title="java.net.URLEncoder.type">URLEncoder</span>.<span title="(x$1: String)String">encode</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot.local;LocalSnapshotStore;SnapshotFilenameFilter.persistenceId" title="String">persistenceId</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> _                              ⇒ <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
