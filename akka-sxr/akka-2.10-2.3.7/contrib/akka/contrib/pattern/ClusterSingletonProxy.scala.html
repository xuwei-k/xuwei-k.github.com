<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>contrib/akka/contrib/pattern/ClusterSingletonProxy.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

<span class="keyword">package</span> akka.contrib.pattern

<span class="keyword">import</span> akka.actor._
<span class="keyword">import</span> akka.cluster.<span class="delimiter">{</span> MemberStatus, Cluster, Member <span class="delimiter">}</span>
<span class="keyword">import</span> scala.collection.immutable
<span class="keyword">import</span> akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>._
<span class="keyword">import</span> akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.MemberRemoved
<span class="keyword">import</span> akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.MemberUp
<span class="keyword">import</span> akka.actor.RootActorPath
<span class="keyword">import</span> akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.CurrentClusterState
<span class="keyword">import</span> akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.MemberExited
<span class="keyword">import</span> scala.concurrent.duration._
<span class="keyword">import</span> scala.<span title="language.type">language</span>.postfixOps

<span class="keyword">object</span> <a title="akka.contrib.pattern.ClusterSingletonProxy.type" id="akka.contrib.pattern.ClusterSingletonProxy">ClusterSingletonProxy</a> <a href="#akka.contrib.pattern.ClusterSingletonProxy" title="akka.contrib.pattern.ClusterSingletonProxy.type" class="delimiter">{</a>
  <span class="comment">/**
   * Scala API: Factory method for `ClusterSingletonProxy` [[akka.actor.Props]].
   *
   * @param singletonPath The logical path of the singleton, i.e., /user/singletonManager/singleton.
   * @param role The role of the cluster nodes where the singleton can be deployed. If None, then any node will do.
   * @param singletonIdentificationInterval Interval at which the proxy will try to resolve the singleton instance.
   * @return The singleton proxy Props.
   */</span>
  <span class="keyword">def</span> <a title="(singletonPath: String, role: Option[String], singletonIdentificationInterval: scala.concurrent.duration.FiniteDuration)akka.actor.Props" id="akka.contrib.pattern.ClusterSingletonProxy.props(18ac3775b6)">props</a><span class="delimiter">(</span><a title="String" id="akka.contrib.pattern.ClusterSingletonProxy.props(18ac3775b6).singletonPath">singletonPath</a>: <span title="String">String</span>, <a title="Option[String]" id="akka.contrib.pattern.ClusterSingletonProxy.props(18ac3775b6).role">role</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern.ClusterSingletonProxy.props$default$3">singletonIdentificationInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span> = <span title="implicit scala.concurrent.duration.package.DurationInt : (n: Int)concurrent.duration.DurationInt" class="int">1</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">second</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> = <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.contrib.pattern.ClusterSingletonProxy](classOf[akka.contrib.pattern.ClusterSingletonProxy])" class="delimiter">[</span>ClusterSingletonProxy<span class="delimiter">]</span>, <a href="#akka.contrib.pattern.ClusterSingletonProxy.props(18ac3775b6).singletonPath" title="String">singletonPath</a>, <a href="#akka.contrib.pattern.ClusterSingletonProxy.props(18ac3775b6).role" title="Option[String]">role</a>, <a href="#akka.contrib.pattern.ClusterSingletonProxy.props$default$3" title="scala.concurrent.duration.FiniteDuration">singletonIdentificationInterval</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API: Factory method for `ClusterSingletonProxy` [[akka.actor.Props]].
   *
   * @param singletonPath The logical path of the singleton, i.e., /user/singletonManager/singleton.
   * @param role The role of the cluster nodes where the singleton can be deployed. If null, then any node will do.
   * @param singletonIdentificationInterval Interval at which the proxy will try to resolve the singleton instance.
   * @return The singleton proxy Props.
   */</span>
  <span class="keyword">def</span> <a title="(singletonPath: String, role: String, singletonIdentificationInterval: scala.concurrent.duration.FiniteDuration)akka.actor.Props" id="akka.contrib.pattern.ClusterSingletonProxy.props(88a03a5794)">props</a><span class="delimiter">(</span><a title="String" id="akka.contrib.pattern.ClusterSingletonProxy.props(88a03a5794).singletonPath">singletonPath</a>: <span title="String">String</span>, <a title="String" id="akka.contrib.pattern.ClusterSingletonProxy.props(88a03a5794).role">role</a>: <span title="String">String</span>, <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern.ClusterSingletonProxy.props(88a03a5794).singletonIdentificationInterval">singletonIdentificationInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="#akka.contrib.pattern.ClusterSingletonProxy.props(18ac3775b6)" title="(singletonPath: String, role: Option[String], singletonIdentificationInterval: scala.concurrent.duration.FiniteDuration)akka.actor.Props">props</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonProxy.props(88a03a5794).singletonPath" title="String">singletonPath</a>, <a href="#akka.contrib.pattern.ClusterSingletonProxy.roleOption" title="(role: String)Option[String]">roleOption</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonProxy.props(88a03a5794).role" title="String">role</a><span class="delimiter">)</span>, <a href="#akka.contrib.pattern.ClusterSingletonProxy.props(88a03a5794).singletonIdentificationInterval" title="scala.concurrent.duration.FiniteDuration">singletonIdentificationInterval</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API: Factory method for `ClusterSingletonProxy` [[akka.actor.Props]]. The interval at which the proxy will try
   * to resolve the singleton instance is set to 1 second.
   *
   * @param singletonPath The logical path of the singleton, i.e., /user/singletonManager/singleton.
   * @param role The role of the cluster nodes where the singleton can be deployed. If null, then any node will do.
   * @return The singleton proxy Props.
   */</span>
  <span class="keyword">def</span> <a title="(singletonPath: String, role: String)akka.actor.Props" id="akka.contrib.pattern.ClusterSingletonProxy.defaultProps">defaultProps</a><span class="delimiter">(</span><a title="String" id="akka.contrib.pattern.ClusterSingletonProxy.defaultProps.singletonPath">singletonPath</a>: <span title="String">String</span>, <a title="String" id="akka.contrib.pattern.ClusterSingletonProxy.defaultProps.role">role</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> = <a href="#akka.contrib.pattern.ClusterSingletonProxy.props(88a03a5794)" title="(singletonPath: String, role: String, singletonIdentificationInterval: scala.concurrent.duration.FiniteDuration)akka.actor.Props">props</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonProxy.defaultProps.singletonPath" title="String">singletonPath</a>, <a href="#akka.contrib.pattern.ClusterSingletonProxy.defaultProps.role" title="String">role</a>, <span title="implicit scala.concurrent.duration.package.DurationInt : (n: Int)concurrent.duration.DurationInt" class="int">1</span> <span title="=&gt; scala.concurrent.duration.FiniteDuration">second</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(role: String)Option[String]" id="akka.contrib.pattern.ClusterSingletonProxy.roleOption">roleOption</a><span class="delimiter">(</span><a title="String" id="akka.contrib.pattern.ClusterSingletonProxy.roleOption.role">role</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#akka.contrib.pattern.ClusterSingletonProxy.roleOption.role" title="String">role</a> <span title="Option[String]" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> | <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> ⇒ <span title="None.type">None</span>
    <span class="keyword">case</span> _         ⇒ <span title="(x: String)Some[String]">Some</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonProxy.roleOption.role" title="String">role</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonProxy.TryToIdentifySingleton.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonProxy.TryToIdentifySingleton.type" id="akka.contrib.pattern.ClusterSingletonProxy.TryToIdentifySingleton.readResolve">TryToIdentifySingleton</a>

<a href="#akka.contrib.pattern.ClusterSingletonProxy.TryToIdentifySingleton.readResolve" title="akka.contrib.pattern.ClusterSingletonProxy.TryToIdentifySingleton.type" class="delimiter">}</a>

<span class="comment">/**
 * The `ClusterSingletonProxy` works together with the [[akka.contrib.pattern.ClusterSingletonManager]] to provide a
 * distributed proxy to the singleton actor.
 *
 * The proxy can be started on every node where the singleton needs to be reached and used as if it were the singleton
 * itself. It will then act as a router to the currently running singleton instance. If the singleton is not currently
 * available, e.g., during hand off or startup, the proxy will stash the messages sent to the singleton and then unstash
 * them when the singleton is finally available. The proxy mixes in the [[akka.actor.Stash]] trait, so it can be
 * configured accordingly.
 *
 * The proxy works by keeping track of the oldest cluster member. When a new oldest member is identified, e.g., because
 * the older one left the cluster, or at startup, the proxy will try to identify the singleton on the oldest member by
 * periodically sending an [[akka.actor.Identify]] message until the singleton responds with its
 * [[akka.actor.ActorIdentity]].
 *
 * Note that this is a best effort implementation: messages can always be lost due to the distributed nature of the
 * actors involved.
 *
 * @param singletonPathString The logical path of the singleton. This does not include the node address or actor system
 *                            name, e.g., it can be something like /user/singletonManager/singleton.
 * @param role Cluster role on which the singleton is deployed. This is required to keep track only of the members where
 *             the singleton can actually exist.
 * @param singletonIdentificationInterval Periodicity at which the proxy sends the `Identify` message to the current
 *                                        singleton actor selection.
 */</span>
<span title="AnyRef" class="keyword">class</span> <a title="class ClusterSingletonProxy extends AnyRef with akka.actor.Actor with akka.actor.Stash with akka.actor.ActorLogging" id="akka.contrib.pattern;ClusterSingletonProxy">ClusterSingletonProxy</a><a href="#akka.contrib.pattern;ClusterSingletonProxy" title="akka.contrib.pattern.ClusterSingletonProxy" class="delimiter">(</a><a title="String" id="akka.contrib.pattern;ClusterSingletonProxy.singletonPathString">singletonPathString</a>: <span title="String">String</span>, <a title="Option[String]" id="akka.contrib.pattern;ClusterSingletonProxy.role">role</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern;ClusterSingletonProxy.singletonIdentificationInterval">singletonIdentificationInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="keyword">with</span> <a href="../../../../actor/akka/actor/Stash.scala.html#akka.actor;Stash" title="akka.actor.Stash">Stash</a> <span class="keyword">with</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="delimiter">{</span>

  <span class="keyword">val</span> <a title="Array[String]" id="akka.contrib.pattern;ClusterSingletonProxy.singletonPath">singletonPath</a> = <a href="#akka.contrib.pattern;ClusterSingletonProxy.singletonPathString" title="String">singletonPathString</a>.<span title="(x$1: String)Array[String]">split</span><span class="delimiter">(</span><span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="Int" id="akka.contrib.pattern;ClusterSingletonProxy.identifyCounter_=">identifyCounter</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">var</span> <a title="String" id="akka.contrib.pattern;ClusterSingletonProxy.identifyId_=">identifyId</a> = <a href="#akka.contrib.pattern;ClusterSingletonProxy.createIdentifyId" title="(i: Int)String">createIdentifyId</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.identifyCounter_=" title="=&gt; Int">identifyCounter</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(i: Int)String" id="akka.contrib.pattern;ClusterSingletonProxy.createIdentifyId">createIdentifyId</a><span class="delimiter">(</span><a title="Int" id="akka.contrib.pattern;ClusterSingletonProxy.createIdentifyId.i">i</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span title="String(&quot;identify-singleton-&quot;)" class="string">&quot;identify-singleton-&quot;</span> <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">+</span> <a href="#akka.contrib.pattern;ClusterSingletonProxy.singletonPath" title="=&gt; Array[String]">singletonPath</a> <span title="(sep: String)String">mkString</span> <span title="String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.contrib.pattern;ClusterSingletonProxy.createIdentifyId.i" title="Int">i</a>
  <span class="keyword">var</span> <a title="Option[akka.actor.Cancellable]" id="akka.contrib.pattern;ClusterSingletonProxy.identifyTimer_=">identifyTimer</a>: <span title="Option[akka.actor.Cancellable]">Option</span><span class="delimiter">[</span>Cancellable<span class="delimiter">]</span> = <span title="None.type">None</span>

  <span class="keyword">val</span> <a title="akka.cluster.Cluster" id="akka.contrib.pattern;ClusterSingletonProxy.cluster">cluster</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="Option[akka.actor.ActorRef]" id="akka.contrib.pattern;ClusterSingletonProxy.singleton_=">singleton</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <span title="None.type">None</span>
  <span class="comment">// sort by age, oldest first</span>
  <span class="keyword">val</span> <a title="scala.math.Ordering[akka.cluster.Member]" id="akka.contrib.pattern;ClusterSingletonProxy.ageOrdering">ageOrdering</a> = <span title="=&gt; math.Ordering.type">Ordering</span>.<span title="[T](cmp: (T, T) =&gt; Boolean)scala.math.Ordering[T]">fromLessThan</span><span title="(cmp: (akka.cluster.Member, akka.cluster.Member) =&gt; Boolean)scala.math.Ordering[akka.cluster.Member]" class="delimiter">[</span><a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member" title="akka.cluster.Member">Member</a><span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern;ClusterSingletonProxy.ageOrdering.$anonfun.a">a</a>, <a title="akka.cluster.Member" id="akka.contrib.pattern;ClusterSingletonProxy.ageOrdering.$anonfun.b">b</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ClusterSingletonProxy.ageOrdering.$anonfun.a" title="akka.cluster.Member">a</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.isOlderThan" title="(other: akka.cluster.Member)Boolean">isOlderThan</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.ageOrdering.$anonfun.b" title="akka.cluster.Member">b</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">var</span> <a title="scala.collection.immutable.SortedSet[akka.cluster.Member]" id="akka.contrib.pattern;ClusterSingletonProxy.membersByAge_=">membersByAge</a>: immutable.<span title="scala.collection.immutable.SortedSet[akka.cluster.Member]">SortedSet</span><span class="delimiter">[</span>Member<span class="delimiter">]</span> = immutable.<span title="scala.collection.immutable.SortedSet.type">SortedSet</span>.<span title="(implicit ord: Ordering[akka.cluster.Member])scala.collection.immutable.SortedSet[akka.cluster.Member]">empty</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.ageOrdering" title="=&gt; scala.math.Ordering[akka.cluster.Member]">ageOrdering</a><span class="delimiter">)</span>

  <span class="comment">// subscribe to MemberEvent, re-subscribe when restart</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ClusterSingletonProxy.preStart">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.contrib.pattern;ClusterSingletonProxy.cancelTimer" title="()Unit">cancelTimer</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ClusterSingletonProxy.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.subscribe(6cfb44d410)" title="(subscriber: akka.actor.ActorRef, to: Class[_]*)Unit">subscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, classOf<span title="Class[akka.cluster.ClusterEvent.MemberEvent](classOf[akka.cluster.ClusterEvent$$MemberEvent])" class="delimiter">[</span>MemberEvent<span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ClusterSingletonProxy.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.contrib.pattern;ClusterSingletonProxy.cancelTimer" title="()Unit">cancelTimer</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ClusterSingletonProxy.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.unsubscribe(134bd64d81)" title="(subscriber: akka.actor.ActorRef)Unit">unsubscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ClusterSingletonProxy.cancelTimer">cancelTimer</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#akka.contrib.pattern;ClusterSingletonProxy.identifyTimer_=" title="=&gt; Option[akka.actor.Cancellable]">identifyTimer</a>.<span title="(f: akka.actor.Cancellable =&gt; Boolean)Unit">foreach</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.cancelTimer.$anonfun.x$1" title="akka.actor.Cancellable">_</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Cancellable.cancel" title="()Boolean">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ClusterSingletonProxy.identifyTimer_=" title="(x$1: Option[akka.actor.Cancellable])Unit">identifyTimer</a> = <span title="None.type">None</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(member: akka.cluster.Member)Boolean" id="akka.contrib.pattern;ClusterSingletonProxy.matchingRole">matchingRole</a><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern;ClusterSingletonProxy.matchingRole.member">member</a>: <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member" title="akka.cluster.Member">Member</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#akka.contrib.pattern;ClusterSingletonProxy.role" title="Option[String]">role</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="None.type">None</span>    ⇒ <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="String" id="akka.contrib.pattern;ClusterSingletonProxy.matchingRole.r">r</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ClusterSingletonProxy.matchingRole.member" title="akka.cluster.Member">member</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.hasRole" title="(role: String)Boolean">hasRole</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.matchingRole.r" title="String">r</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(state: akka.cluster.ClusterEvent.CurrentClusterState)Unit" id="akka.contrib.pattern;ClusterSingletonProxy.handleInitial">handleInitial</a><span class="delimiter">(</span><a title="akka.cluster.ClusterEvent.CurrentClusterState" id="akka.contrib.pattern;ClusterSingletonProxy.handleInitial.state">state</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState" title="akka.cluster.ClusterEvent.CurrentClusterState">CurrentClusterState</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.contrib.pattern;ClusterSingletonProxy.trackChange" title="(block: () =&gt; Unit)Unit">trackChange</a> <span class="delimiter">{</span>
      <span class="delimiter">(</span><span class="delimiter">)</span> ⇒
        <a href="#akka.contrib.pattern;ClusterSingletonProxy.membersByAge_=" title="(x$1: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit">membersByAge</a> = immutable.<span title="scala.collection.immutable.SortedSet.type">SortedSet</span>.<span title="(implicit ord: Ordering[akka.cluster.Member])scala.collection.immutable.SortedSet[akka.cluster.Member]">empty</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.ageOrdering" title="=&gt; scala.math.Ordering[akka.cluster.Member]">ageOrdering</a><span class="delimiter">)</span> <span title="(elems: scala.collection.GenTraversableOnce[akka.cluster.Member])scala.collection.immutable.SortedSet[akka.cluster.Member]">++</span> <a href="#akka.contrib.pattern;ClusterSingletonProxy.handleInitial.state" title="akka.cluster.ClusterEvent.CurrentClusterState">state</a>.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState.members" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">members</a>.<span title="(pf: PartialFunction[akka.cluster.Member,akka.cluster.Member])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.SortedSet[akka.cluster.Member],akka.cluster.Member,scala.collection.immutable.SortedSet[akka.cluster.Member]])scala.collection.immutable.SortedSet[akka.cluster.Member]">collect</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[akka.cluster.Member,akka.cluster.Member] with Serializable" id="akka.contrib.pattern;ClusterSingletonProxy.handleInitial.$anonfun;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
          <span class="keyword">case</span> <a title="akka.cluster.Member" id="akka.contrib.pattern;ClusterSingletonProxy.handleInitial.$anonfun;$anonfun.isDefinedAt.m">m</a> <span class="keyword">if</span> <a href="#akka.contrib.pattern;ClusterSingletonProxy.handleInitial.$anonfun;$anonfun.isDefinedAt.m" title="akka.cluster.Member">m</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.status" title="=&gt; akka.cluster.MemberStatus">status</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.MemberStatus" title="akka.cluster.MemberStatus.type">MemberStatus</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.MemberStatus.Up" title="akka.cluster.MemberStatus.Up.type">Up</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.contrib.pattern;ClusterSingletonProxy.matchingRole" title="(member: akka.cluster.Member)Boolean">matchingRole</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.handleInitial.$anonfun;$anonfun.isDefinedAt.m" title="akka.cluster.Member">m</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ClusterSingletonProxy.handleInitial.$anonfun;$anonfun.isDefinedAt.m" title="akka.cluster.Member">m</a>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Discard old singleton ActorRef and send a periodic message to self to identify the singleton.
   */</span>
  <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ClusterSingletonProxy.identifySingleton">identifySingleton</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Creating singleton identification timer...&quot;)" class="string">&quot;Creating singleton identification timer...&quot;</span><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ClusterSingletonProxy.identifyCounter_=" title="(x$1: Int)Unit">identifyCounter</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
    <a href="#akka.contrib.pattern;ClusterSingletonProxy.identifyId_=" title="(x$1: String)Unit">identifyId</a> = <a href="#akka.contrib.pattern;ClusterSingletonProxy.createIdentifyId" title="(i: Int)String">createIdentifyId</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.identifyCounter_=" title="=&gt; Int">identifyCounter</a><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ClusterSingletonProxy.singleton_=" title="(x$1: Option[akka.actor.ActorRef])Unit">singleton</a> = <span title="None.type">None</span>
    <a href="#akka.contrib.pattern;ClusterSingletonProxy.cancelTimer" title="()Unit">cancelTimer</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ClusterSingletonProxy.identifyTimer_=" title="(x$1: Option[akka.actor.Cancellable])Unit">identifyTimer</a> = <span title="(x: akka.actor.Cancellable)Some[akka.actor.Cancellable]">Some</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.schedule(abf8206fc2)" title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">schedule</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><span title="implicit scala.concurrent.duration.package.DurationInt : (n: Int)concurrent.duration.DurationInt" class="int">0</span> <span title="=&gt; scala.concurrent.duration.FiniteDuration">milliseconds</span>, <a href="#akka.contrib.pattern;ClusterSingletonProxy.singletonIdentificationInterval" title="scala.concurrent.duration.FiniteDuration">singletonIdentificationInterval</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.contrib.pattern.ClusterSingletonProxy" title="akka.contrib.pattern.ClusterSingletonProxy.type">ClusterSingletonProxy</a>.<a href="#akka.contrib.pattern.ClusterSingletonProxy.TryToIdentifySingleton.readResolve" title="akka.contrib.pattern.ClusterSingletonProxy.TryToIdentifySingleton.type">TryToIdentifySingleton</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(block: () =&gt; Unit)Unit" id="akka.contrib.pattern;ClusterSingletonProxy.trackChange">trackChange</a><span class="delimiter">(</span><a title="() =&gt; Unit" id="akka.contrib.pattern;ClusterSingletonProxy.trackChange.block">block</a>: <span class="delimiter">(</span><span class="delimiter">)</span> ⇒ Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Option[akka.cluster.Member]" id="akka.contrib.pattern;ClusterSingletonProxy.trackChange.before">before</a> = <a href="#akka.contrib.pattern;ClusterSingletonProxy.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a>.<span title="=&gt; Option[akka.cluster.Member]">headOption</span>
    <a href="#akka.contrib.pattern;ClusterSingletonProxy.trackChange.block" title="()Unit">block</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Option[akka.cluster.Member]" id="akka.contrib.pattern;ClusterSingletonProxy.trackChange.after">after</a> = <a href="#akka.contrib.pattern;ClusterSingletonProxy.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a>.<span title="=&gt; Option[akka.cluster.Member]">headOption</span>
    <span class="comment">// if the head has changed, I need to find the new singleton</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.trackChange.before" title="Option[akka.cluster.Member]">before</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#akka.contrib.pattern;ClusterSingletonProxy.trackChange.after" title="Option[akka.cluster.Member]">after</a><span class="delimiter">)</span> <a href="#akka.contrib.pattern;ClusterSingletonProxy.identifySingleton" title="()Unit">identifySingleton</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Adds new member if it has the right role.
   * @param m New cluster member.
   */</span>
  <span class="keyword">def</span> <a title="(m: akka.cluster.Member)Unit" id="akka.contrib.pattern;ClusterSingletonProxy.add">add</a><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern;ClusterSingletonProxy.add.m">m</a>: <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member" title="akka.cluster.Member">Member</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.matchingRole" title="(member: akka.cluster.Member)Boolean">matchingRole</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.add.m" title="akka.cluster.Member">m</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ClusterSingletonProxy.trackChange" title="(block: () =&gt; Unit)Unit">trackChange</a> <span class="delimiter">{</span>
        <span class="delimiter">(</span><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ClusterSingletonProxy.membersByAge_=" title="(x$1: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit">membersByAge</a> <span title="(elem: akka.cluster.Member)scala.collection.immutable.SortedSet[akka.cluster.Member]">+=</span> <a href="#akka.contrib.pattern;ClusterSingletonProxy.add.m" title="akka.cluster.Member">m</a>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Removes a member.
   * @param m Cluster member to remove.
   */</span>
  <span class="keyword">def</span> <a title="(m: akka.cluster.Member)Unit" id="akka.contrib.pattern;ClusterSingletonProxy.remove">remove</a><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern;ClusterSingletonProxy.remove.m">m</a>: <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member" title="akka.cluster.Member">Member</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.matchingRole" title="(member: akka.cluster.Member)Boolean">matchingRole</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.remove.m" title="akka.cluster.Member">m</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ClusterSingletonProxy.trackChange" title="(block: () =&gt; Unit)Unit">trackChange</a> <span class="delimiter">{</span>
        <span class="delimiter">(</span><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ClusterSingletonProxy.membersByAge_=" title="(x$1: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit">membersByAge</a> <span title="(elem: akka.cluster.Member)scala.collection.immutable.SortedSet[akka.cluster.Member]">-=</span> <a href="#akka.contrib.pattern;ClusterSingletonProxy.remove.m" title="akka.cluster.Member">m</a>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; PartialFunction[Any,Unit]" id="akka.contrib.pattern;ClusterSingletonProxy.receive">receive</a> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="comment">// cluster logic</span>
    <span class="keyword">case</span> <a title="akka.cluster.ClusterEvent.CurrentClusterState" id="akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.state">state</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState" title="akka.cluster.ClusterEvent.CurrentClusterState">CurrentClusterState</a> ⇒ <a href="#akka.contrib.pattern;ClusterSingletonProxy.handleInitial" title="(state: akka.cluster.ClusterEvent.CurrentClusterState)Unit">handleInitial</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.state" title="akka.cluster.ClusterEvent.CurrentClusterState">state</a><span class="delimiter">)</span>
    <span class="keyword">case</span> MemberUp<span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.m">m</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ClusterSingletonProxy.add" title="(m: akka.cluster.Member)Unit">add</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.m" title="akka.cluster.Member">m</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="akka.cluster.ClusterEvent.MemberEvent" id="akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.mEvent">mEvent</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;MemberEvent" title="akka.cluster.ClusterEvent.MemberEvent">MemberEvent</a> <span class="keyword">if</span> <a href="#akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.mEvent" title="akka.cluster.ClusterEvent.MemberEvent">mEvent</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;MemberExited" title="akka.cluster.ClusterEvent.MemberExited">MemberExited</a><span class="delimiter">]</span> <span title="(x: Boolean)Boolean">||</span> <a href="#akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.mEvent" title="akka.cluster.ClusterEvent.MemberEvent">mEvent</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;MemberRemoved" title="akka.cluster.ClusterEvent.MemberRemoved">MemberRemoved</a><span class="delimiter">]</span> ⇒ <a href="#akka.contrib.pattern;ClusterSingletonProxy.remove" title="(m: akka.cluster.Member)Unit">remove</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.mEvent" title="akka.cluster.ClusterEvent.MemberEvent">mEvent</a>.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;MemberEvent.member" title="=&gt; akka.cluster.Member">member</a><span class="delimiter">)</span>
    <span class="keyword">case</span> _: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;MemberEvent" title="akka.cluster.ClusterEvent.MemberEvent">MemberEvent</a> ⇒ <span class="comment">// do nothing</span>

    <span class="comment">// singleton identification logic</span>
    <span class="keyword">case</span> ActorIdentity<span class="delimiter">(</span><a title="Any" id="akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.identifyId">identifyId</a>, Some<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.s">s</a><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <span class="comment">// if the new singleton is defined, unstash all messages</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.info(dc73c33c91)" title="(template: String, arg1: Any)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Singleton identified: {}&quot;)" class="string">&quot;Singleton identified: {}&quot;</span>, <span title="akka.actor.ActorRef">s</span>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ClusterSingletonProxy.singleton_=" title="(x$1: Option[akka.actor.ActorRef])Unit">singleton</a> = <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">s</span><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ClusterSingletonProxy.cancelTimer" title="()Unit">cancelTimer</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Stash.scala.html#akka.actor;StashSupport.unstashAll(aa97cb1b3d)" title="()Unit">unstashAll</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">case</span> _: <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorIdentity" title="akka.actor.ActorIdentity">ActorIdentity</a> ⇒ <span class="comment">// do nothing</span>
    <span class="keyword">case</span> <a href="#akka.contrib.pattern.ClusterSingletonProxy" title="akka.contrib.pattern.ClusterSingletonProxy.type">ClusterSingletonProxy</a>.<a href="#akka.contrib.pattern.ClusterSingletonProxy.TryToIdentifySingleton.readResolve" title="akka.contrib.pattern.ClusterSingletonProxy.TryToIdentifySingleton.type">TryToIdentifySingleton</a> <span class="keyword">if</span> <a href="#akka.contrib.pattern;ClusterSingletonProxy.identifyTimer_=" title="=&gt; Option[akka.actor.Cancellable]">identifyTimer</a>.<span title="=&gt; Boolean">isDefined</span> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonProxy.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a>.<span title="=&gt; Option[akka.cluster.Member]">headOption</span>.<span title="(f: akka.cluster.Member =&gt; Unit)Unit">foreach</span> <span title="Boolean(true)" class="delimiter">{</span>
        <a title="akka.cluster.Member" id="akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.applyOrElse.$anonfun.oldest">oldest</a> ⇒
          <span class="keyword">val</span> <a title="akka.actor.ActorPath" id="akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.applyOrElse.$anonfun.singletonAddress">singletonAddress</a> = <a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;RootActorPath" title="(address: akka.actor.Address, name: String)akka.actor.RootActorPath">RootActorPath</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.applyOrElse.$anonfun.oldest" title="akka.cluster.Member">oldest</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath./(214d397cb8)" title="(child: Iterable[String])akka.actor.ActorPath">/</a> <a href="#akka.contrib.pattern;ClusterSingletonProxy.singletonPath" title="(xs: Array[String])scala.collection.mutable.WrappedArray[String]">singletonPath</a>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Trying to identify singleton at {}&quot;)" class="string">&quot;Trying to identify singleton at {}&quot;</span>, <a href="#akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.applyOrElse.$anonfun.singletonAddress" title="akka.actor.ActorPath">singletonAddress</a><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorSelection(e44b8bc960)" title="(path: akka.actor.ActorPath)akka.actor.ActorSelection">actorSelection</a><a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor.ActorSelection.toScala" title="implicit akka.actor.ActorSelection.toScala : (sel: akka.actor.ActorSelection)akka.actor.ScalaActorSelection" class="delimiter">(</a><a href="#akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.applyOrElse.$anonfun.singletonAddress" title="akka.actor.ActorPath">singletonAddress</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor;ScalaActorSelection.!" title="(msg: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Identify" title="(messageId: Any)akka.actor.Identify">Identify</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonProxy.identifyId_=" title="=&gt; String">identifyId</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="comment">// forwarding/stashing logic</span>
    <span class="keyword">case</span> <a title="Any" id="akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.msg">msg</a>: <span title="Any">Any</span> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonProxy.singleton_=" title="=&gt; Option[akka.actor.ActorRef]">singleton</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="akka.actor.ActorRef">s</span><span class="delimiter">)</span> ⇒
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Forwarding message to current singleton instance {}&quot;)" class="string">&quot;Forwarding message to current singleton instance {}&quot;</span>, <a href="#akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.msg" title="Any">msg</a><span class="delimiter">)</span>
          <span title="akka.actor.ActorRef">s</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.forward" title="(message: Any)(implicit context: akka.actor.ActorContext)Unit">forward</a> <a href="#akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.msg" title="Any">msg</a>
        <span class="keyword">case</span> <span title="None.type">None</span> ⇒
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;No singleton available, stashing message {}&quot;)" class="string">&quot;No singleton available, stashing message {}&quot;</span>, <a href="#akka.contrib.pattern;ClusterSingletonProxy.receive;$anonfun.isDefinedAt.msg" title="Any">msg</a><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Stash.scala.html#akka.actor;StashSupport.stash" title="()Unit">stash</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
