<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>contrib/akka/contrib/pattern/ClusterSharding.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> akka.contrib.pattern

<span class="keyword">import</span> java.net.URLEncoder
<span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap
<span class="keyword">import</span> scala.collection.immutable
<span class="keyword">import</span> scala.concurrent.Await
<span class="keyword">import</span> scala.concurrent.duration._
<span class="keyword">import</span> scala.concurrent.forkjoin.ThreadLocalRandom
<span class="keyword">import</span> akka.actor.Actor
<span class="keyword">import</span> akka.actor.ActorLogging
<span class="keyword">import</span> akka.actor.ActorRef
<span class="keyword">import</span> akka.actor.ActorSelection
<span class="keyword">import</span> akka.actor.ActorSystem
<span class="keyword">import</span> akka.actor.ExtendedActorSystem
<span class="keyword">import</span> akka.actor.Extension
<span class="keyword">import</span> akka.actor.ExtensionId
<span class="keyword">import</span> akka.actor.ExtensionIdProvider
<span class="keyword">import</span> akka.actor.NoSerializationVerificationNeeded
<span class="keyword">import</span> akka.actor.PoisonPill
<span class="keyword">import</span> akka.actor.Props
<span class="keyword">import</span> akka.actor.ReceiveTimeout
<span class="keyword">import</span> akka.actor.RootActorPath
<span class="keyword">import</span> akka.actor.Terminated
<span class="keyword">import</span> akka.cluster.Cluster
<span class="keyword">import</span> akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.CurrentClusterState
<span class="keyword">import</span> akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.MemberEvent
<span class="keyword">import</span> akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.MemberRemoved
<span class="keyword">import</span> akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.MemberUp
<span class="keyword">import</span> akka.cluster.Member
<span class="keyword">import</span> akka.cluster.MemberStatus
<span class="keyword">import</span> akka.pattern.ask
<span class="keyword">import</span> akka.persistence.PersistentActor
<span class="keyword">import</span> akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.ClusterDomainEvent
<span class="keyword">import</span> akka.persistence.SnapshotOffer
<span class="keyword">import</span> akka.persistence.SaveSnapshotSuccess
<span class="keyword">import</span> akka.persistence.SaveSnapshotFailure

<span class="comment">/**
 * This extension provides sharding functionality of actors in a cluster.
 * The typical use case is when you have many stateful actors that together consume
 * more resources (e.g. memory) than fit on one machine. You need to distribute them across
 * several nodes in the cluster and you want to be able to interact with them using their
 * logical identifier, but without having to care about their physical location in the cluster,
 * which might also change over time. It could for example be actors representing Aggregate Roots in
 * Domain-Driven Design terminology. Here we call these actors &quot;entries&quot;. These actors
 * typically have persistent (durable) state, but this feature is not limited to
 * actors with persistent state.
 *
 * In this context sharding means that actors with an identifier, so called entries,
 * can be automatically distributed across multiple nodes in the cluster. Each entry
 * actor runs only at one place, and messages can be sent to the entry without requiring
 * the sender to know the location of the destination actor. This is achieved by sending
 * the messages via a [[ShardRegion]] actor provided by this extension, which knows how
 * to route the message with the entry id to the final destination.
 *
 * This extension is supposed to be used by first, typically at system startup on each node
 * in the cluster, registering the supported entry types with the [[ClusterSharding#start]]
 * method and then the `ShardRegion` actor for a named entry type can be retrieved with
 * [[ClusterSharding#shardRegion]]. Messages to the entries are always sent via the local
 * `ShardRegion`. Some settings can be configured as described in the `akka.contrib.cluster.sharding`
 * section of the `reference.conf`.
 *
 * The `ShardRegion` actor is started on each node in the cluster, or group of nodes
 * tagged with a specific role. The `ShardRegion` is created with two application specific
 * functions to extract the entry identifier and the shard identifier from incoming messages.
 * A shard is a group of entries that will be managed together. For the first message in a
 * specific shard the `ShardRegion` request the location of the shard from a central coordinator,
 * the [[ShardCoordinator]]. The `ShardCoordinator` decides which `ShardRegion` that
 * owns the shard. The `ShardRegion` receives the decided home of the shard
 * and if that is the `ShardRegion` instance itself it will create a local child
 * actor representing the entry and direct all messages for that entry to it.
 * If the shard home is another `ShardRegion` instance messages will be forwarded
 * to that `ShardRegion` instance instead. While resolving the location of a
 * shard incoming messages for that shard are buffered and later delivered when the
 * shard home is known. Subsequent messages to the resolved shard can be delivered
 * to the target destination immediately without involving the `ShardCoordinator`.
 *
 * To make sure that at most one instance of a specific entry actor is running somewhere
 * in the cluster it is important that all nodes have the same view of where the shards
 * are located. Therefore the shard allocation decisions are taken by the central
 * `ShardCoordinator`, which is running as a cluster singleton, i.e. one instance on
 * the oldest member among all cluster nodes or a group of nodes tagged with a specific
 * role. The oldest member can be determined by [[akka.cluster.Member#isOlderThan]].
 *
 * The logic that decides where a shard is to be located is defined in a pluggable shard
 * allocation strategy. The default implementation [[ShardCoordinator.LeastShardAllocationStrategy]]
 * allocates new shards to the `ShardRegion` with least number of previously allocated shards.
 * This strategy can be replaced by an application specific implementation.
 *
 * To be able to use newly added members in the cluster the coordinator facilitates rebalancing
 * of shards, i.e. migrate entries from one node to another. In the rebalance process the
 * coordinator first notifies all `ShardRegion` actors that a handoff for a shard has started.
 * That means they will start buffering incoming messages for that shard, in the same way as if the
 * shard location is unknown. During the rebalance process the coordinator will not answer any
 * requests for the location of shards that are being rebalanced, i.e. local buffering will
 * continue until the handoff is completed. The `ShardRegion` responsible for the rebalanced shard
 * will stop all entries in that shard by sending `PoisonPill` to them. When all entries have
 * been terminated the `ShardRegion` owning the entries will acknowledge the handoff as completed
 * to the coordinator. Thereafter the coordinator will reply to requests for the location of
 * the shard and thereby allocate a new home for the shard and then buffered messages in the
 * `ShardRegion` actors are delivered to the new location. This means that the state of the entries
 * are not transferred or migrated. If the state of the entries are of importance it should be
 * persistent (durable), e.g. with `akka-persistence`, so that it can be recovered at the new
 * location.
 *
 * The logic that decides which shards to rebalance is defined in a pluggable shard
 * allocation strategy. The default implementation [[ShardCoordinator.LeastShardAllocationStrategy]]
 * picks shards for handoff from the `ShardRegion` with most number of previously allocated shards.
 * They will then be allocated to the `ShardRegion` with least number of previously allocated shards,
 * i.e. new members in the cluster. There is a configurable threshold of how large the difference
 * must be to begin the rebalancing. This strategy can be replaced by an application specific
 * implementation.
 *
 * The state of shard locations in the `ShardCoordinator` is persistent (durable) with
 * `akka-persistence` to survive failures. Since it is running in a cluster `akka-persistence`
 * must be configured with a distributed journal. When a crashed or unreachable coordinator
 * node has been removed (via down) from the cluster a new `ShardCoordinator` singleton
 * actor will take over and the state is recovered. During such a failure period shards
 * with known location are still available, while messages for new (unknown) shards
 * are buffered until the new `ShardCoordinator` becomes available.
 *
 * As long as a sender uses the same `ShardRegion` actor to deliver messages to an entry
 * actor the order of the messages is preserved. As long as the buffer limit is not reached
 * messages are delivered on a best effort basis, with at-most once delivery semantics,
 * in the same way as ordinary message sending. Reliable end-to-end messaging, with
 * at-least-once semantics can be added by using channels in `akka-persistence`.
 *
 * Some additional latency is introduced for messages targeted to new or previously
 * unused shards due to the round-trip to the coordinator. Rebalancing of shards may
 * also add latency. This should be considered when designing the application specific
 * shard resolution, e.g. to avoid too fine grained shards.
 *
 * The `ShardRegion` actor can also be started in proxy only mode, i.e. it will not
 * host any entries itself, but knows how to delegate messages to the right location.
 * A `ShardRegion` starts in proxy only mode if the roles of the node does not include
 * the node role specified in `akka.contrib.cluster.sharding.role` config property
 * or if the specified `entryProps` is `None`/`null`.
 *
 * If the state of the entries are persistent you may stop entries that are not used to
 * reduce memory consumption. This is done by the application specific implementation of
 * the entry actors for example by defining receive timeout (`context.setReceiveTimeout`).
 * If a message is already enqueued to the entry when it stops itself the enqueued message
 * in the mailbox will be dropped. To support graceful passivation without loosing such
 * messages the entry actor can send [[ShardRegion.Passivate]] to its parent `ShardRegion`.
 * The specified wrapped message in `Passivate` will be sent back to the entry, which is
 * then supposed to stop itself. Incoming messages will be buffered by the `ShardRegion`
 * between reception of `Passivate` and termination of the entry. Such buffered messages
 * are thereafter delivered to a new incarnation of the entry.
 *
 */</span>
<span class="keyword">object</span> <a title="akka.contrib.pattern.ClusterSharding.type" id="akka.contrib.pattern.ClusterSharding">ClusterSharding</a> <a href="#akka.contrib.pattern.ClusterSharding" title="akka.contrib.pattern.ClusterSharding.type" class="keyword">extends</a> <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId" title="akka.actor.ExtensionId[akka.contrib.pattern.ClusterSharding]">ExtensionId</a><span class="delimiter">[</span>ClusterSharding<span class="delimiter">]</span> <span class="keyword">with</span> <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionIdProvider" title="akka.actor.ExtensionIdProvider">ExtensionIdProvider</a> <span class="delimiter">{</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(system: akka.actor.ActorSystem)akka.contrib.pattern.ClusterSharding" id="akka.contrib.pattern.ClusterSharding.get">get</a><span class="delimiter">(</span><a title="akka.actor.ActorSystem" id="akka.contrib.pattern.ClusterSharding.get.system">system</a>: <a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem" title="akka.actor.ActorSystem">ActorSystem</a><span class="delimiter">)</span>: <a href="#akka.contrib.pattern;ClusterSharding" title="akka.contrib.pattern.ClusterSharding">ClusterSharding</a> = <span class="keyword">super</span>.<a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.get" title="(system: akka.actor.ActorSystem)akka.contrib.pattern.ClusterSharding">get</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSharding.get.system" title="akka.actor.ActorSystem">system</a><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()akka.contrib.pattern.ClusterSharding.type" id="akka.contrib.pattern.ClusterSharding.lookup">lookup</a> = <a href="#akka.contrib.pattern.ClusterSharding" title="akka.contrib.pattern.ClusterSharding.type">ClusterSharding</a>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(system: akka.actor.ExtendedActorSystem)akka.contrib.pattern.ClusterSharding" id="akka.contrib.pattern.ClusterSharding.createExtension">createExtension</a><span class="delimiter">(</span><a title="akka.actor.ExtendedActorSystem" id="akka.contrib.pattern.ClusterSharding.createExtension.system">system</a>: <a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ExtendedActorSystem" title="akka.actor.ExtendedActorSystem">ExtendedActorSystem</a><span class="delimiter">)</span>: <a href="#akka.contrib.pattern;ClusterSharding" title="akka.contrib.pattern.ClusterSharding">ClusterSharding</a> =
    <span title="akka.contrib.pattern.ClusterSharding" class="keyword">new</span> <a href="#akka.contrib.pattern;ClusterSharding" title="akka.contrib.pattern.ClusterSharding">ClusterSharding</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSharding.createExtension.system" title="akka.actor.ExtendedActorSystem">system</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * @see [[ClusterSharding$ ClusterSharding companion object]]
 */</span>
<span class="keyword">class</span> <a title="class ClusterSharding extends AnyRef with akka.actor.Extension" id="akka.contrib.pattern;ClusterSharding">ClusterSharding</a><a href="#akka.contrib.pattern;ClusterSharding" title="akka.contrib.pattern.ClusterSharding" class="delimiter">(</a><a title="akka.actor.ExtendedActorSystem" id="akka.contrib.pattern;ClusterSharding.system">system</a>: <a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ExtendedActorSystem" title="akka.actor.ExtendedActorSystem">ExtendedActorSystem</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;Extension" title="akka.actor.Extension">Extension</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ClusterShardingGuardian" title="akka.contrib.pattern.ClusterShardingGuardian.type">ClusterShardingGuardian</a>._
  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ShardCoordinator" title="akka.contrib.pattern.ShardCoordinator.type">ShardCoordinator</a>.ShardAllocationStrategy
  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ShardCoordinator" title="akka.contrib.pattern.ShardCoordinator.type">ShardCoordinator</a>.LeastShardAllocationStrategy

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="akka.cluster.Cluster" id="akka.contrib.pattern;ClusterSharding.cluster">cluster</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.system" title="akka.actor.ExtendedActorSystem">system</a><span class="delimiter">)</span>
  <span class="comment">/**
   * INTERNAL API
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">object</span> <a title="ClusterSharding.this.Settings.type" id="akka.contrib.pattern;ClusterSharding.Settings">Settings</a> <a href="#akka.contrib.pattern;ClusterSharding.Settings" title="ClusterSharding.this.Settings.type" class="delimiter">{</a>
    <span class="keyword">val</span> <a title="com.typesafe.config.Config" id="akka.contrib.pattern;ClusterSharding.Settings.config">config</a> = <a href="#akka.contrib.pattern;ClusterSharding.system" title="akka.actor.ExtendedActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.settings" title="=&gt; akka.actor.ActorSystem.Settings">settings</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor.ActorSystem;Settings.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)com.typesafe.config.Config">getConfig</span><span class="delimiter">(</span><span title="String(&quot;akka.contrib.cluster.sharding&quot;)" class="string">&quot;akka.contrib.cluster.sharding&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Option[String]" id="akka.contrib.pattern;ClusterSharding.Settings.Role">Role</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#akka.contrib.pattern;ClusterSharding.Settings.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)String">getString</span><span class="delimiter">(</span><span title="String(&quot;role&quot;)" class="string">&quot;role&quot;</span><span class="delimiter">)</span> <span title="Option[String]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> ⇒ <span title="None.type">None</span>
      <span class="keyword">case</span> <a title="String" id="akka.contrib.pattern;ClusterSharding.Settings.Role.r">r</a>  ⇒ <span title="(x: String)Some[String]">Some</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.Settings.Role.r" title="String">r</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="Boolean" id="akka.contrib.pattern;ClusterSharding.Settings.HasNecessaryClusterRole">HasNecessaryClusterRole</a>: <span title="Boolean">Boolean</span> = <a href="#akka.contrib.pattern;ClusterSharding.Settings.Role" title="=&gt; Option[String]">Role</a>.<span title="(p: String =&gt; Boolean)Boolean">forall</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfRoles" title="=&gt; Set[String]">selfRoles</a>.<a href="#akka.contrib.pattern;ClusterSharding.Settings.HasNecessaryClusterRole.$anonfun.elem" title="(elem: String)Boolean">contains</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="String" id="akka.contrib.pattern;ClusterSharding.Settings.GuardianName">GuardianName</a>: <span title="String">String</span> = <a href="#akka.contrib.pattern;ClusterSharding.Settings.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)String">getString</span><span class="delimiter">(</span><span title="String(&quot;guardian-name&quot;)" class="string">&quot;guardian-name&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern;ClusterSharding.Settings.CoordinatorFailureBackoff">CoordinatorFailureBackoff</a> = <a href="#akka.contrib.pattern;ClusterSharding.Settings.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String, x$2: java.util.concurrent.TimeUnit)Long">getDuration</span><span title="implicit scala.concurrent.duration.package.DurationLong : (n: Long)concurrent.duration.DurationLong" class="delimiter">(</span><span title="String(&quot;coordinator-failure-backoff&quot;)" class="string">&quot;coordinator-failure-backoff&quot;</span>, <span title="java.util.concurrent.TimeUnit(MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">millis</span>
    <span class="keyword">val</span> <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern;ClusterSharding.Settings.RetryInterval">RetryInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span> = <a href="#akka.contrib.pattern;ClusterSharding.Settings.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String, x$2: java.util.concurrent.TimeUnit)Long">getDuration</span><span title="implicit scala.concurrent.duration.package.DurationLong : (n: Long)concurrent.duration.DurationLong" class="delimiter">(</span><span title="String(&quot;retry-interval&quot;)" class="string">&quot;retry-interval&quot;</span>, <span title="java.util.concurrent.TimeUnit(MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">millis</span>
    <span class="keyword">val</span> <a title="Int" id="akka.contrib.pattern;ClusterSharding.Settings.BufferSize">BufferSize</a>: <span title="Int">Int</span> = <a href="#akka.contrib.pattern;ClusterSharding.Settings.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)Int">getInt</span><span class="delimiter">(</span><span title="String(&quot;buffer-size&quot;)" class="string">&quot;buffer-size&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern;ClusterSharding.Settings.HandOffTimeout">HandOffTimeout</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span> = <a href="#akka.contrib.pattern;ClusterSharding.Settings.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String, x$2: java.util.concurrent.TimeUnit)Long">getDuration</span><span title="implicit scala.concurrent.duration.package.DurationLong : (n: Long)concurrent.duration.DurationLong" class="delimiter">(</span><span title="String(&quot;handoff-timeout&quot;)" class="string">&quot;handoff-timeout&quot;</span>, <span title="java.util.concurrent.TimeUnit(MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">millis</span>
    <span class="keyword">val</span> <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern;ClusterSharding.Settings.RebalanceInterval">RebalanceInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span> = <a href="#akka.contrib.pattern;ClusterSharding.Settings.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String, x$2: java.util.concurrent.TimeUnit)Long">getDuration</span><span title="implicit scala.concurrent.duration.package.DurationLong : (n: Long)concurrent.duration.DurationLong" class="delimiter">(</span><span title="String(&quot;rebalance-interval&quot;)" class="string">&quot;rebalance-interval&quot;</span>, <span title="java.util.concurrent.TimeUnit(MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">millis</span>
    <span class="keyword">val</span> <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern;ClusterSharding.Settings.SnapshotInterval">SnapshotInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span> = <a href="#akka.contrib.pattern;ClusterSharding.Settings.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String, x$2: java.util.concurrent.TimeUnit)Long">getDuration</span><span title="implicit scala.concurrent.duration.package.DurationLong : (n: Long)concurrent.duration.DurationLong" class="delimiter">(</span><span title="String(&quot;snapshot-interval&quot;)" class="string">&quot;snapshot-interval&quot;</span>, <span title="java.util.concurrent.TimeUnit(MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">millis</span>
    <span class="keyword">val</span> <a title="Int" id="akka.contrib.pattern;ClusterSharding.Settings.LeastShardAllocationRebalanceThreshold">LeastShardAllocationRebalanceThreshold</a>: <span title="Int">Int</span> =
      <a href="#akka.contrib.pattern;ClusterSharding.Settings.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)Int">getInt</span><span class="delimiter">(</span><span title="String(&quot;least-shard-allocation-strategy.rebalance-threshold&quot;)" class="string">&quot;least-shard-allocation-strategy.rebalance-threshold&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="akka.contrib.pattern;ClusterSharding.Settings.LeastShardAllocationMaxSimultaneousRebalance">LeastShardAllocationMaxSimultaneousRebalance</a>: <span title="Int">Int</span> =
      <a href="#akka.contrib.pattern;ClusterSharding.Settings.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)Int">getInt</span><span class="delimiter">(</span><span title="String(&quot;least-shard-allocation-strategy.max-simultaneous-rebalance&quot;)" class="string">&quot;least-shard-allocation-strategy.max-simultaneous-rebalance&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="#akka.contrib.pattern;ClusterSharding.Settings" title="ClusterSharding.this.Settings.type">Settings</a>._
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[String,akka.actor.ActorRef]" id="akka.contrib.pattern;ClusterSharding.regions">regions</a>: <span title="java.util.concurrent.ConcurrentHashMap[String,akka.actor.ActorRef]">ConcurrentHashMap</span><span class="delimiter">[</span>String, ActorRef<span class="delimiter">]</span> = <span title="()java.util.concurrent.ConcurrentHashMap[String,akka.actor.ActorRef]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[String,akka.actor.ActorRef]">ConcurrentHashMap</span>
  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSharding.guardian">guardian</a> = <a href="#akka.contrib.pattern;ClusterSharding.system" title="akka.actor.ExtendedActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(874c98419a)" title="(props: akka.actor.Props, name: String)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0822e9e710)" title="[T &lt;: akka.actor.Actor]()(implicit evidence$1: scala.reflect.ClassTag[T])akka.actor.Props">Props</a><span title="()(implicit evidence$1: scala.reflect.ClassTag[akka.contrib.pattern.ClusterShardingGuardian])akka.actor.Props" class="delimiter">[</span><a href="#akka.contrib.pattern;ClusterShardingGuardian" title="akka.contrib.pattern.ClusterShardingGuardian">ClusterShardingGuardian</a><span class="delimiter">]</span>, <a href="#akka.contrib.pattern;ClusterSharding.Settings" title="ClusterSharding.this.Settings.type">Settings</a>.<a href="#akka.contrib.pattern;ClusterSharding.Settings.GuardianName" title="=&gt; String">GuardianName</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Scala API: Register a named entry type by defining the [[akka.actor.Props]] of the entry actor
   * and functions to extract entry and shard identifier from messages. The [[ShardRegion]] actor
   * for this type can later be retrieved with the [[#shardRegion]] method.
   *
   * Some settings can be configured as described in the `akka.contrib.cluster.sharding` section
   * of the `reference.conf`.
   *
   * @param typeName the name of the entry type
   * @param entryProps the `Props` of the entry actors that will be created by the `ShardRegion`,
   *   if not defined (None) the `ShardRegion` on this node will run in proxy only mode, i.e.
   *   it will delegate messages to other `ShardRegion` actors on other nodes, but not host any
   *   entry actors itself
   * @param idExtractor partial function to extract the entry id and the message to send to the
   *   entry from the incoming message, if the partial function does not match the message will
   *   be `unhandled`, i.e. posted as `Unhandled` messages on the event stream
   * @param shardResolver function to determine the shard id for an incoming message, only messages
   *   that passed the `idExtractor` will be used
   * @param allocationStrategy possibility to use a custom shard allocation and
   *   rebalancing logic
   * @return the actor ref of the [[ShardRegion]] that is to be responsible for the shard
   */</span>
  <span class="keyword">def</span> <a title="(typeName: String, entryProps: Option[akka.actor.Props], idExtractor: akka.contrib.pattern.ShardRegion.IdExtractor, shardResolver: akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId, allocationStrategy: akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy)akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSharding.start(479c264727)">start</a><span class="delimiter">(</span>
    <a title="String" id="akka.contrib.pattern;ClusterSharding.start(479c264727).typeName">typeName</a>: <span title="String">String</span>,
    <a title="Option[akka.actor.Props]" id="akka.contrib.pattern;ClusterSharding.start(479c264727).entryProps">entryProps</a>: <span title="Option[akka.actor.Props]">Option</span><span class="delimiter">[</span>Props<span class="delimiter">]</span>,
    <a title="akka.contrib.pattern.ShardRegion.IdExtractor" id="akka.contrib.pattern;ClusterSharding.start(479c264727).idExtractor">idExtractor</a>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.IdExtractor">IdExtractor</span>,
    <a title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern;ClusterSharding.start(479c264727).shardResolver">shardResolver</a>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId">ShardResolver</span>,
    <a title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy" id="akka.contrib.pattern;ClusterSharding.start(479c264727).allocationStrategy">allocationStrategy</a>: <a href="#akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy" title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy">ShardAllocationStrategy</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <span class="delimiter">{</span>

    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="akka.util.Timeout" id="akka.contrib.pattern;ClusterSharding.start(479c264727).timeout">timeout</a> = <a href="#akka.contrib.pattern;ClusterSharding.system" title="akka.actor.ExtendedActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.settings" title="=&gt; akka.actor.ActorSystem.Settings">settings</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor.ActorSystem;Settings.CreationTimeout" title="=&gt; akka.util.Timeout">CreationTimeout</a>
    <span class="keyword">val</span> <a title="akka.contrib.pattern.ClusterShardingGuardian.Start" id="akka.contrib.pattern;ClusterSharding.start(479c264727).startMsg">startMsg</a> = <a href="#akka.contrib.pattern.ClusterShardingGuardian.Start.readResolve" title="(typeName: String, entryProps: Option[akka.actor.Props], idExtractor: akka.contrib.pattern.ShardRegion.IdExtractor, shardResolver: akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId, allocationStrategy: akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy)akka.contrib.pattern.ClusterShardingGuardian.Start">Start</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.start(479c264727).typeName" title="String">typeName</a>, <a href="#akka.contrib.pattern;ClusterSharding.start(479c264727).entryProps" title="Option[akka.actor.Props]">entryProps</a>, <a href="#akka.contrib.pattern;ClusterSharding.start(479c264727).idExtractor" title="akka.contrib.pattern.ShardRegion.IdExtractor">idExtractor</a>, <a href="#akka.contrib.pattern;ClusterSharding.start(479c264727).shardResolver" title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId">shardResolver</a>, <a href="#akka.contrib.pattern;ClusterSharding.start(479c264727).allocationStrategy" title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy">allocationStrategy</a><span class="delimiter">)</span>
    <span class="keyword">val</span> Started<a href="#akka.contrib.pattern;ClusterSharding.start(479c264727).shardRegion.shardRegion" title="akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSharding.start(479c264727).shardRegion" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSharding.start(479c264727).shardRegion.shardRegion">shardRegion</a><span class="delimiter">)</span> = <span title="scala.concurrent.Await.type">Await</span>.<span title="(awaitable: scala.concurrent.Awaitable[Any], atMost: scala.concurrent.duration.Duration)Any">result</span><span title="Any @unchecked" class="delimiter">(</span><a href="../../../../actor/akka/pattern/AskSupport.scala.html#akka.pattern;AskSupport.ask(13940b1e32)" title="implicit akka.pattern.AskSupport.ask : (actorRef: akka.actor.ActorRef)akka.pattern.AskableActorRef">guardian</a> <a href="../../../../actor/akka/pattern/AskSupport.scala.html#akka.pattern;AskableActorRef.?" title="(message: Any)(implicit timeout: akka.util.Timeout)scala.concurrent.Future[Any]">?</a> <a href="#akka.contrib.pattern;ClusterSharding.start(479c264727).startMsg" title="akka.contrib.pattern.ClusterShardingGuardian.Start">startMsg</a>, <a href="#akka.contrib.pattern;ClusterSharding.start(479c264727).timeout" title="akka.util.Timeout">timeout</a>.<a href="../../../../actor/akka/util/Timeout.scala.html#akka.util;Timeout.duration" title="=&gt; scala.concurrent.duration.FiniteDuration">duration</a><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ClusterSharding.regions" title="=&gt; java.util.concurrent.ConcurrentHashMap[String,akka.actor.ActorRef]">regions</a>.<span title="(x$1: String, x$2: akka.actor.ActorRef)akka.actor.ActorRef">put</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.start(479c264727).typeName" title="String">typeName</a>, <a href="#akka.contrib.pattern;ClusterSharding.start(479c264727).shardRegion" title="akka.actor.ActorRef">shardRegion</a><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ClusterSharding.start(479c264727).shardRegion" title="akka.actor.ActorRef">shardRegion</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Register a named entry type by defining the [[akka.actor.Props]] of the entry actor and
   * functions to extract entry and shard identifier from messages. The [[ShardRegion]] actor
   * for this type can later be retrieved with the [[#shardRegion]] method.
   *
   * The default shard allocation strategy [[ShardCoordinator.LeastShardAllocationStrategy]]
   * is used.
   *
   * Some settings can be configured as described in the `akka.contrib.cluster.sharding` section
   * of the `reference.conf`.
   *
   * @param typeName the name of the entry type
   * @param entryProps the `Props` of the entry actors that will be created by the `ShardRegion`,
   *   if not defined (None) the `ShardRegion` on this node will run in proxy only mode, i.e.
   *   it will delegate messages to other `ShardRegion` actors on other nodes, but not host any
   *   entry actors itself
   * @param idExtractor partial function to extract the entry id and the message to send to the
   *   entry from the incoming message, if the partial function does not match the message will
   *   be `unhandled`, i.e. posted as `Unhandled` messages on the event stream
   * @param shardResolver function to determine the shard id for an incoming message, only messages
   *   that passed the `idExtractor` will be used
   * @return the actor ref of the [[ShardRegion]] that is to be responsible for the shard
   */</span>
  <span class="keyword">def</span> <a title="(typeName: String, entryProps: Option[akka.actor.Props], idExtractor: akka.contrib.pattern.ShardRegion.IdExtractor, shardResolver: akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId)akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSharding.start(9a14a7d8de)">start</a><span class="delimiter">(</span>
    <a title="String" id="akka.contrib.pattern;ClusterSharding.start(9a14a7d8de).typeName">typeName</a>: <span title="String">String</span>,
    <a title="Option[akka.actor.Props]" id="akka.contrib.pattern;ClusterSharding.start(9a14a7d8de).entryProps">entryProps</a>: <span title="Option[akka.actor.Props]">Option</span><span class="delimiter">[</span>Props<span class="delimiter">]</span>,
    <a title="akka.contrib.pattern.ShardRegion.IdExtractor" id="akka.contrib.pattern;ClusterSharding.start(9a14a7d8de).idExtractor">idExtractor</a>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.IdExtractor">IdExtractor</span>,
    <a title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern;ClusterSharding.start(9a14a7d8de).shardResolver">shardResolver</a>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId">ShardResolver</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <span class="delimiter">{</span>

    <a href="#akka.contrib.pattern;ClusterSharding.start(479c264727)" title="(typeName: String, entryProps: Option[akka.actor.Props], idExtractor: akka.contrib.pattern.ShardRegion.IdExtractor, shardResolver: akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId, allocationStrategy: akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy)akka.actor.ActorRef">start</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.start(9a14a7d8de).typeName" title="String">typeName</a>, <a href="#akka.contrib.pattern;ClusterSharding.start(9a14a7d8de).entryProps" title="Option[akka.actor.Props]">entryProps</a>, <a href="#akka.contrib.pattern;ClusterSharding.start(9a14a7d8de).idExtractor" title="akka.contrib.pattern.ShardRegion.IdExtractor">idExtractor</a>, <a href="#akka.contrib.pattern;ClusterSharding.start(9a14a7d8de).shardResolver" title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId">shardResolver</a>,
      <span title="akka.contrib.pattern.ShardCoordinator.LeastShardAllocationStrategy" class="keyword">new</span> <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy" title="akka.contrib.pattern.ShardCoordinator.LeastShardAllocationStrategy">LeastShardAllocationStrategy</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.Settings.LeastShardAllocationRebalanceThreshold" title="=&gt; Int">LeastShardAllocationRebalanceThreshold</a>, <a href="#akka.contrib.pattern;ClusterSharding.Settings.LeastShardAllocationMaxSimultaneousRebalance" title="=&gt; Int">LeastShardAllocationMaxSimultaneousRebalance</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Java API: Register a named entry type by defining the [[akka.actor.Props]] of the entry actor
   * and functions to extract entry and shard identifier from messages. The [[ShardRegion]] actor
   * for this type can later be retrieved with the [[#shardRegion]] method.
   *
   * Some settings can be configured as described in the `akka.contrib.cluster.sharding` section
   * of the `reference.conf`.
   *
   * @param typeName the name of the entry type
   * @param entryProps the `Props` of the entry actors that will be created by the `ShardRegion`,
   *   if not defined (null) the `ShardRegion` on this node will run in proxy only mode, i.e.
   *   it will delegate messages to other `ShardRegion` actors on other nodes, but not host any
   *   entry actors itself
   * @param messageExtractor functions to extract the entry id, shard id, and the message to send to the
   *   entry from the incoming message
   * @param allocationStrategy possibility to use a custom shard allocation and
   *   rebalancing logic
   * @return the actor ref of the [[ShardRegion]] that is to be responsible for the shard
   */</span>
  <span class="keyword">def</span> <a title="(typeName: String, entryProps: akka.actor.Props, messageExtractor: akka.contrib.pattern.ShardRegion.MessageExtractor, allocationStrategy: akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy)akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSharding.start(cba5fe1880)">start</a><span class="delimiter">(</span>
    <a title="String" id="akka.contrib.pattern;ClusterSharding.start(cba5fe1880).typeName">typeName</a>: <span title="String">String</span>,
    <a title="akka.actor.Props" id="akka.contrib.pattern;ClusterSharding.start(cba5fe1880).entryProps">entryProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a>,
    <a title="akka.contrib.pattern.ShardRegion.MessageExtractor" id="akka.contrib.pattern;ClusterSharding.start(cba5fe1880).messageExtractor">messageExtractor</a>: ShardRegion.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">MessageExtractor</a>,
    <a title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy" id="akka.contrib.pattern;ClusterSharding.start(cba5fe1880).allocationStrategy">allocationStrategy</a>: <a href="#akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy" title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy">ShardAllocationStrategy</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <span class="delimiter">{</span>

    <a href="#akka.contrib.pattern;ClusterSharding.start(479c264727)" title="(typeName: String, entryProps: Option[akka.actor.Props], idExtractor: akka.contrib.pattern.ShardRegion.IdExtractor, shardResolver: akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId, allocationStrategy: akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy)akka.actor.ActorRef">start</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.start(cba5fe1880).typeName" title="String">typeName</a>, entryProps = <span title="(x: akka.actor.Props)Option[akka.actor.Props]">Option</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.start(cba5fe1880).entryProps" title="akka.actor.Props">entryProps</a><span class="delimiter">)</span>,
      idExtractor = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[akka.contrib.pattern.ShardRegion.Msg,(akka.contrib.pattern.ShardRegion.EntryId, akka.contrib.pattern.ShardRegion.Msg)] with Serializable" id="akka.contrib.pattern;ClusterSharding.start(cba5fe1880);$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
        <span class="keyword">case</span> <a title="akka.contrib.pattern.ShardRegion.Msg" id="akka.contrib.pattern;ClusterSharding.start(cba5fe1880);$anonfun.isDefinedAt.msg">msg</a> <span class="keyword">if</span> <a href="#akka.contrib.pattern;ClusterSharding.start(cba5fe1880).messageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">messageExtractor</a>.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor.entryId" title="(message: Any)String">entryId</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.start(cba5fe1880);$anonfun.isDefinedAt.msg" title="akka.contrib.pattern.ShardRegion.Msg">msg</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span> ⇒
          <span title="(_1: String, _2: Any)(String, Any)" class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.start(cba5fe1880).messageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">messageExtractor</a>.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor.entryId" title="(message: Any)String">entryId</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.start(cba5fe1880);$anonfun.isDefinedAt.msg" title="akka.contrib.pattern.ShardRegion.Msg">msg</a><span class="delimiter">)</span>, <a href="#akka.contrib.pattern;ClusterSharding.start(cba5fe1880).messageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">messageExtractor</a>.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor.entryMessage" title="(message: Any)Any">entryMessage</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.start(cba5fe1880);$anonfun.isDefinedAt.msg" title="akka.contrib.pattern.ShardRegion.Msg">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>,
      shardResolver = <a title="akka.contrib.pattern.ShardRegion.Msg" id="akka.contrib.pattern;ClusterSharding.start(cba5fe1880).$anonfun.msg">msg</a> ⇒ <a href="#akka.contrib.pattern;ClusterSharding.start(cba5fe1880).messageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">messageExtractor</a>.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor.shardId" title="(message: Any)String">shardId</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.start(cba5fe1880).$anonfun.msg" title="akka.contrib.pattern.ShardRegion.Msg">msg</a><span class="delimiter">)</span>,
      allocationStrategy = <a href="#akka.contrib.pattern;ClusterSharding.start(cba5fe1880).allocationStrategy" title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy">allocationStrategy</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Java API: Register a named entry type by defining the [[akka.actor.Props]] of the entry actor
   * and functions to extract entry and shard identifier from messages. The [[ShardRegion]] actor
   * for this type can later be retrieved with the [[#shardRegion]] method.
   *
   * The default shard allocation strategy [[ShardCoordinator.LeastShardAllocationStrategy]]
   * is used.
   *
   * Some settings can be configured as described in the `akka.contrib.cluster.sharding` section
   * of the `reference.conf`.
   *
   * @param typeName the name of the entry type
   * @param entryProps the `Props` of the entry actors that will be created by the `ShardRegion`,
   *   if not defined (null) the `ShardRegion` on this node will run in proxy only mode, i.e.
   *   it will delegate messages to other `ShardRegion` actors on other nodes, but not host any
   *   entry actors itself
   * @param messageExtractor functions to extract the entry id, shard id, and the message to send to the
   *   entry from the incoming message
   * @return the actor ref of the [[ShardRegion]] that is to be responsible for the shard
   */</span>
  <span class="keyword">def</span> <a title="(typeName: String, entryProps: akka.actor.Props, messageExtractor: akka.contrib.pattern.ShardRegion.MessageExtractor)akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSharding.start(e0826548f1)">start</a><span class="delimiter">(</span>
    <a title="String" id="akka.contrib.pattern;ClusterSharding.start(e0826548f1).typeName">typeName</a>: <span title="String">String</span>,
    <a title="akka.actor.Props" id="akka.contrib.pattern;ClusterSharding.start(e0826548f1).entryProps">entryProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a>,
    <a title="akka.contrib.pattern.ShardRegion.MessageExtractor" id="akka.contrib.pattern;ClusterSharding.start(e0826548f1).messageExtractor">messageExtractor</a>: ShardRegion.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">MessageExtractor</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <span class="delimiter">{</span>

    <a href="#akka.contrib.pattern;ClusterSharding.start(cba5fe1880)" title="(typeName: String, entryProps: akka.actor.Props, messageExtractor: akka.contrib.pattern.ShardRegion.MessageExtractor, allocationStrategy: akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy)akka.actor.ActorRef">start</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.start(e0826548f1).typeName" title="String">typeName</a>, <a href="#akka.contrib.pattern;ClusterSharding.start(e0826548f1).entryProps" title="akka.actor.Props">entryProps</a>, <a href="#akka.contrib.pattern;ClusterSharding.start(e0826548f1).messageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">messageExtractor</a>,
      <span title="akka.contrib.pattern.ShardCoordinator.LeastShardAllocationStrategy" class="keyword">new</span> <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy" title="akka.contrib.pattern.ShardCoordinator.LeastShardAllocationStrategy">LeastShardAllocationStrategy</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.Settings.LeastShardAllocationRebalanceThreshold" title="=&gt; Int">LeastShardAllocationRebalanceThreshold</a>, <a href="#akka.contrib.pattern;ClusterSharding.Settings.LeastShardAllocationMaxSimultaneousRebalance" title="=&gt; Int">LeastShardAllocationMaxSimultaneousRebalance</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Retrieve the actor reference of the [[ShardRegion]] actor responsible for the named entry type.
   * The entry type must be registered with the [[#start]] method before it can be used here.
   * Messages to the entry is always sent via the `ShardRegion`.
   */</span>
  <span class="keyword">def</span> <a title="(typeName: String)akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSharding.shardRegion">shardRegion</a><span class="delimiter">(</span><a title="String" id="akka.contrib.pattern;ClusterSharding.shardRegion.typeName">typeName</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <a href="#akka.contrib.pattern;ClusterSharding.regions" title="=&gt; java.util.concurrent.ConcurrentHashMap[String,akka.actor.ActorRef]">regions</a>.<span title="(x$1: Any)akka.actor.ActorRef">get</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.shardRegion.typeName" title="String">typeName</a><span class="delimiter">)</span> <span title="akka.actor.ActorRef" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> ⇒ <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IllegalArgumentException" class="keyword">new</span> <span title="IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Shard type [&quot;)">Shard type [$</span><a href="#akka.contrib.pattern;ClusterSharding.shardRegion.typeName" title="String">typeName</a><span title="String(&quot;] must be started first&quot;)" class="string">] must be started first&quot;</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSharding.shardRegion.ref">ref</a>  ⇒ <a href="#akka.contrib.pattern;ClusterSharding.shardRegion.ref" title="akka.actor.ActorRef">ref</a>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API.
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">object</span> <a title="akka.contrib.pattern.ClusterShardingGuardian.type" id="akka.contrib.pattern.ClusterShardingGuardian">ClusterShardingGuardian</a> <a href="#akka.contrib.pattern.ClusterShardingGuardian" title="akka.contrib.pattern.ClusterShardingGuardian.type" class="delimiter">{</a>
  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ShardCoordinator" title="akka.contrib.pattern.ShardCoordinator.type">ShardCoordinator</a>.ShardAllocationStrategy
  <span class="keyword">case class</span> <a title="class Start extends AnyRef with akka.actor.NoSerializationVerificationNeeded with Product with Serializable" id="akka.contrib.pattern.ClusterShardingGuardian.Start.readResolve">Start</a><a href="#akka.contrib.pattern.ClusterShardingGuardian.Start.readResolve" title="Product" class="delimiter">(</a><a title="String" id="akka.contrib.pattern.ClusterShardingGuardian;Start.typeName">typeName</a>: <span title="String">String</span>, <a title="Option[akka.actor.Props]" id="akka.contrib.pattern.ClusterShardingGuardian;Start.entryProps">entryProps</a>: <span title="Option[akka.actor.Props]">Option</span><span class="delimiter">[</span>Props<span class="delimiter">]</span>, <a title="akka.contrib.pattern.ShardRegion.IdExtractor" id="akka.contrib.pattern.ClusterShardingGuardian;Start.idExtractor">idExtractor</a>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.IdExtractor">IdExtractor</span>,
                   <a title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ClusterShardingGuardian;Start.shardResolver">shardResolver</a>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId">ShardResolver</span>, <a title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy" id="akka.contrib.pattern.ClusterShardingGuardian;Start.allocationStrategy">allocationStrategy</a>: <a href="#akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy" title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy">ShardAllocationStrategy</a><span class="delimiter">)</span>
    <span class="keyword">extends</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;NoSerializationVerificationNeeded" title="akka.actor.NoSerializationVerificationNeeded">NoSerializationVerificationNeeded</a>
  <span class="keyword">case class</span> <a title="class Started extends AnyRef with akka.actor.NoSerializationVerificationNeeded with Product with Serializable" id="akka.contrib.pattern.ClusterShardingGuardian.Started.readResolve">Started</a><a href="#akka.contrib.pattern.ClusterShardingGuardian.Started.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ClusterShardingGuardian;Started.shardRegion">shardRegion</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;NoSerializationVerificationNeeded" title="akka.actor.NoSerializationVerificationNeeded">NoSerializationVerificationNeeded</a>
<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API. [[ShardRegion]] and [[ShardCoordinator]] actors are createad as children
 * of this actor.
 */</span>
<span title="AnyRef" class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">class</span> <a title="class ClusterShardingGuardian extends AnyRef with akka.actor.Actor" id="akka.contrib.pattern;ClusterShardingGuardian">ClusterShardingGuardian</a> <a href="#akka.contrib.pattern;ClusterShardingGuardian" title="akka.contrib.pattern.ClusterShardingGuardian" class="keyword">extends</a> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ClusterShardingGuardian" title="akka.contrib.pattern.ClusterShardingGuardian.type">ClusterShardingGuardian</a>._

  <span class="keyword">val</span> <a title="akka.cluster.Cluster" id="akka.contrib.pattern;ClusterShardingGuardian.cluster">cluster</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="akka.contrib.pattern.ClusterSharding" id="akka.contrib.pattern;ClusterShardingGuardian.sharding">sharding</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.contrib.pattern.ClusterSharding">ClusterSharding</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>
  <span class="keyword">import</span> <a href="#akka.contrib.pattern;ClusterShardingGuardian.sharding" title="=&gt; akka.contrib.pattern.ClusterSharding">sharding</a>.<a href="#akka.contrib.pattern;ClusterSharding.Settings" title="ClusterShardingGuardian.this.sharding.Settings.type">Settings</a>._

  <span class="keyword">def</span> <a title="=&gt; PartialFunction[Any,Unit]" id="akka.contrib.pattern;ClusterShardingGuardian.receive">receive</a> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> Start<span class="delimiter">(</span><a title="String" id="akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.isDefinedAt.typeName">typeName</a>, <a title="Option[akka.actor.Props]" id="akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.isDefinedAt.entryProps">entryProps</a>, <a title="akka.contrib.pattern.ShardRegion.IdExtractor" id="akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.isDefinedAt.idExtractor">idExtractor</a>, <a title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.isDefinedAt.shardResolver">shardResolver</a>, <a title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy" id="akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.isDefinedAt.allocationStrategy">allocationStrategy</a><span class="delimiter">)</span> ⇒
      <span class="keyword">val</span> <a title="String" id="akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.encName">encName</a> = <span title="java.net.URLEncoder.type">URLEncoder</span>.<span title="(x$1: String, x$2: String)String">encode</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.isDefinedAt.typeName" title="String">typeName</a>, <span title="String(&quot;utf-8&quot;)" class="string">&quot;utf-8&quot;</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="String" id="akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.coordinatorSingletonManagerName">coordinatorSingletonManagerName</a> = <a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.encName" title="String">encName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;Coordinator&quot;)" class="string">&quot;Coordinator&quot;</span>
      <span class="keyword">val</span> <a title="String" id="akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.coordinatorPath">coordinatorPath</a> = <span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a> <a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath./(833cf8d176)" title="(child: String)akka.actor.ActorPath">/</a> <a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.coordinatorSingletonManagerName" title="String">coordinatorSingletonManagerName</a> <a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath./(833cf8d176)" title="(child: String)akka.actor.ActorPath">/</a> <span title="String(&quot;singleton&quot;)" class="string">&quot;singleton&quot;</span> <a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath./(833cf8d176)" title="(child: String)akka.actor.ActorPath">/</a> <span title="String(&quot;coordinator&quot;)" class="string">&quot;coordinator&quot;</span><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.toStringWithoutAddress" title="=&gt; String">toStringWithoutAddress</a>
      <span class="keyword">val</span> <a title="akka.actor.ActorRef" id="akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.shardRegion">shardRegion</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.child" title="(name: String)Option[akka.actor.ActorRef]">child</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.encName" title="String">encName</a><span class="delimiter">)</span>.<span title="(default: =&gt; akka.actor.ActorRef)akka.actor.ActorRef">getOrElse</span> <span class="delimiter">{</span>
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.Settings.HasNecessaryClusterRole" title="=&gt; Boolean">HasNecessaryClusterRole</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.child" title="(name: String)Option[akka.actor.ActorRef]">child</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.coordinatorSingletonManagerName" title="String">coordinatorSingletonManagerName</a><span class="delimiter">)</span>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="akka.actor.Props" id="akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.shardRegion.coordinatorProps">coordinatorProps</a> = <a href="#akka.contrib.pattern.ShardCoordinator" title="akka.contrib.pattern.ShardCoordinator.type">ShardCoordinator</a>.<a href="#akka.contrib.pattern.ShardCoordinator.props" title="(handOffTimeout: scala.concurrent.duration.FiniteDuration, rebalanceInterval: scala.concurrent.duration.FiniteDuration, snapshotInterval: scala.concurrent.duration.FiniteDuration, allocationStrategy: akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy)akka.actor.Props">props</a><span class="delimiter">(</span>handOffTimeout = <a href="#akka.contrib.pattern;ClusterSharding.Settings.HandOffTimeout" title="=&gt; scala.concurrent.duration.FiniteDuration">HandOffTimeout</a>,
            rebalanceInterval = <a href="#akka.contrib.pattern;ClusterSharding.Settings.RebalanceInterval" title="=&gt; scala.concurrent.duration.FiniteDuration">RebalanceInterval</a>, snapshotInterval = <a href="#akka.contrib.pattern;ClusterSharding.Settings.SnapshotInterval" title="=&gt; scala.concurrent.duration.FiniteDuration">SnapshotInterval</a>, <a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.isDefinedAt.allocationStrategy" title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy">allocationStrategy</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="akka.actor.Props" id="akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.shardRegion.singletonProps">singletonProps</a> = <a href="#akka.contrib.pattern.ShardCoordinatorSupervisor" title="akka.contrib.pattern.ShardCoordinatorSupervisor.type">ShardCoordinatorSupervisor</a>.<a href="#akka.contrib.pattern.ShardCoordinatorSupervisor.props" title="(failureBackoff: scala.concurrent.duration.FiniteDuration, coordinatorProps: akka.actor.Props)akka.actor.Props">props</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.Settings.CoordinatorFailureBackoff" title="=&gt; scala.concurrent.duration.FiniteDuration">CoordinatorFailureBackoff</a>, <a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.shardRegion.coordinatorProps" title="akka.actor.Props">coordinatorProps</a><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(874c98419a)" title="(props: akka.actor.Props, name: String)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span><a href="ClusterSingletonManager.scala.html#akka.contrib.pattern.ClusterSingletonManager" title="akka.contrib.pattern.ClusterSingletonManager.type">ClusterSingletonManager</a>.<a href="ClusterSingletonManager.scala.html#akka.contrib.pattern.ClusterSingletonManager.props(2e1cc011fd)" title="(singletonProps: akka.actor.Props, singletonName: String, terminationMessage: Any, role: Option[String], maxHandOverRetries: Int, maxTakeOverRetries: Int, retryInterval: scala.concurrent.duration.FiniteDuration)akka.actor.Props">props</a><span class="delimiter">(</span>
            <a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.shardRegion.singletonProps" title="akka.actor.Props">singletonProps</a>,
            singletonName = <span title="String(&quot;singleton&quot;)" class="string">&quot;singleton&quot;</span>,
            terminationMessage = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.PoisonPill" title="akka.actor.PoisonPill.type">PoisonPill</a>,
            role = <a href="#akka.contrib.pattern;ClusterSharding.Settings.Role" title="=&gt; Option[String]">Role</a><span class="delimiter">)</span>,
            name = <a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.coordinatorSingletonManagerName" title="String">coordinatorSingletonManagerName</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(874c98419a)" title="(props: akka.actor.Props, name: String)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion" title="akka.contrib.pattern.ShardRegion.type">ShardRegion</a>.<a href="#akka.contrib.pattern.ShardRegion.props(bf47bcb125)" title="(entryProps: Option[akka.actor.Props], role: Option[String], coordinatorPath: String, retryInterval: scala.concurrent.duration.FiniteDuration, bufferSize: Int, idExtractor: akka.contrib.pattern.ShardRegion.IdExtractor, shardResolver: akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId)akka.actor.Props">props</a><span class="delimiter">(</span>
          entryProps = <span title="Option[akka.actor.Props]" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSharding.Settings.HasNecessaryClusterRole" title="=&gt; Boolean">HasNecessaryClusterRole</a><span class="delimiter">)</span> <a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.isDefinedAt.entryProps" title="Option[akka.actor.Props]">entryProps</a> <span class="keyword">else</span> <span title="None.type">None</span>,
          role = <a href="#akka.contrib.pattern;ClusterSharding.Settings.Role" title="=&gt; Option[String]">Role</a>,
          coordinatorPath = <a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.coordinatorPath" title="String">coordinatorPath</a>,
          retryInterval = <a href="#akka.contrib.pattern;ClusterSharding.Settings.RetryInterval" title="=&gt; scala.concurrent.duration.FiniteDuration">RetryInterval</a>,
          bufferSize = <a href="#akka.contrib.pattern;ClusterSharding.Settings.BufferSize" title="=&gt; Int">BufferSize</a>,
          idExtractor = <a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.isDefinedAt.idExtractor" title="akka.contrib.pattern.ShardRegion.IdExtractor">idExtractor</a>,
          shardResolver = <a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.isDefinedAt.shardResolver" title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId">shardResolver</a><span class="delimiter">)</span>,
          name = <a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.encName" title="String">encName</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ClusterShardingGuardian.Started.readResolve" title="(shardRegion: akka.actor.ActorRef)akka.contrib.pattern.ClusterShardingGuardian.Started">Started</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterShardingGuardian.receive;$anonfun.applyOrElse.shardRegion" title="akka.actor.ActorRef">shardRegion</a><span class="delimiter">)</span>

  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * @see [[ClusterSharding$ ClusterSharding extension]]
 */</span>
<span class="keyword">object</span> <a title="akka.contrib.pattern.ShardRegion.type" id="akka.contrib.pattern.ShardRegion">ShardRegion</a> <a href="#akka.contrib.pattern.ShardRegion" title="akka.contrib.pattern.ShardRegion.type" class="delimiter">{</a>

  <span class="comment">/**
   * Scala API: Factory method for the [[akka.actor.Props]] of the [[ShardRegion]] actor.
   */</span>
  <span class="keyword">def</span> <a title="(entryProps: Option[akka.actor.Props], role: Option[String], coordinatorPath: String, retryInterval: scala.concurrent.duration.FiniteDuration, bufferSize: Int, idExtractor: akka.contrib.pattern.ShardRegion.IdExtractor, shardResolver: akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId)akka.actor.Props" id="akka.contrib.pattern.ShardRegion.props(bf47bcb125)">props</a><span class="delimiter">(</span>
    <a title="Option[akka.actor.Props]" id="akka.contrib.pattern.ShardRegion.props(bf47bcb125).entryProps">entryProps</a>: <span title="Option[akka.actor.Props]">Option</span><span class="delimiter">[</span>Props<span class="delimiter">]</span>,
    <a title="Option[String]" id="akka.contrib.pattern.ShardRegion.props(bf47bcb125).role">role</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>,
    <a title="String" id="akka.contrib.pattern.ShardRegion.props(bf47bcb125).coordinatorPath">coordinatorPath</a>: <span title="String">String</span>,
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern.ShardRegion.props(bf47bcb125).retryInterval">retryInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
    <a title="Int" id="akka.contrib.pattern.ShardRegion.props(bf47bcb125).bufferSize">bufferSize</a>: <span title="Int">Int</span>,
    <a title="akka.contrib.pattern.ShardRegion.IdExtractor" id="akka.contrib.pattern.ShardRegion.props(bf47bcb125).idExtractor">idExtractor</a>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.IdExtractor">IdExtractor</span>,
    <a title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardRegion.props(bf47bcb125).shardResolver">shardResolver</a>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId">ShardResolver</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.contrib.pattern.ShardRegion](classOf[akka.contrib.pattern.ShardRegion])" class="delimiter">[</span>ShardRegion<span class="delimiter">]</span>, <a href="#akka.contrib.pattern.ShardRegion.props(bf47bcb125).entryProps" title="Option[akka.actor.Props]">entryProps</a>, <a href="#akka.contrib.pattern.ShardRegion.props(bf47bcb125).role" title="Option[String]">role</a>, <a href="#akka.contrib.pattern.ShardRegion.props(bf47bcb125).coordinatorPath" title="String">coordinatorPath</a>, <a href="#akka.contrib.pattern.ShardRegion.props(bf47bcb125).retryInterval" title="scala.concurrent.duration.FiniteDuration">retryInterval</a>, <a href="#akka.contrib.pattern.ShardRegion.props(bf47bcb125).bufferSize" title="Int">bufferSize</a>, <a href="#akka.contrib.pattern.ShardRegion.props(bf47bcb125).idExtractor" title="akka.contrib.pattern.ShardRegion.IdExtractor">idExtractor</a>, <a href="#akka.contrib.pattern.ShardRegion.props(bf47bcb125).shardResolver" title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId">shardResolver</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Scala API: Factory method for the [[akka.actor.Props]] of the [[ShardRegion]] actor.
   */</span>
  <span class="keyword">def</span> <a title="(entryProps: akka.actor.Props, role: Option[String], coordinatorPath: String, retryInterval: scala.concurrent.duration.FiniteDuration, bufferSize: Int, idExtractor: akka.contrib.pattern.ShardRegion.IdExtractor, shardResolver: akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId)akka.actor.Props" id="akka.contrib.pattern.ShardRegion.props(80708e1955)">props</a><span class="delimiter">(</span>
    <a title="akka.actor.Props" id="akka.contrib.pattern.ShardRegion.props(80708e1955).entryProps">entryProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a>,
    <a title="Option[String]" id="akka.contrib.pattern.ShardRegion.props(80708e1955).role">role</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>,
    <a title="String" id="akka.contrib.pattern.ShardRegion.props(80708e1955).coordinatorPath">coordinatorPath</a>: <span title="String">String</span>,
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern.ShardRegion.props(80708e1955).retryInterval">retryInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
    <a title="Int" id="akka.contrib.pattern.ShardRegion.props(80708e1955).bufferSize">bufferSize</a>: <span title="Int">Int</span>,
    <a title="akka.contrib.pattern.ShardRegion.IdExtractor" id="akka.contrib.pattern.ShardRegion.props(80708e1955).idExtractor">idExtractor</a>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.IdExtractor">IdExtractor</span>,
    <a title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardRegion.props(80708e1955).shardResolver">shardResolver</a>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId">ShardResolver</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="#akka.contrib.pattern.ShardRegion.props(bf47bcb125)" title="(entryProps: Option[akka.actor.Props], role: Option[String], coordinatorPath: String, retryInterval: scala.concurrent.duration.FiniteDuration, bufferSize: Int, idExtractor: akka.contrib.pattern.ShardRegion.IdExtractor, shardResolver: akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId)akka.actor.Props">props</a><span class="delimiter">(</span><span title="(x: akka.actor.Props)Some[akka.actor.Props]">Some</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.props(80708e1955).entryProps" title="akka.actor.Props">entryProps</a><span class="delimiter">)</span>, <a href="#akka.contrib.pattern.ShardRegion.props(80708e1955).role" title="Option[String]">role</a>, <a href="#akka.contrib.pattern.ShardRegion.props(80708e1955).coordinatorPath" title="String">coordinatorPath</a>, <a href="#akka.contrib.pattern.ShardRegion.props(80708e1955).retryInterval" title="scala.concurrent.duration.FiniteDuration">retryInterval</a>, <a href="#akka.contrib.pattern.ShardRegion.props(80708e1955).bufferSize" title="Int">bufferSize</a>, <a href="#akka.contrib.pattern.ShardRegion.props(80708e1955).idExtractor" title="akka.contrib.pattern.ShardRegion.IdExtractor">idExtractor</a>, <a href="#akka.contrib.pattern.ShardRegion.props(80708e1955).shardResolver" title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId">shardResolver</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API: Factory method for the [[akka.actor.Props]] of the [[ShardRegion]] actor.
   */</span>
  <span class="keyword">def</span> <a title="(entryProps: akka.actor.Props, role: String, coordinatorPath: String, retryInterval: scala.concurrent.duration.FiniteDuration, bufferSize: Int, messageExtractor: akka.contrib.pattern.ShardRegion.MessageExtractor)akka.actor.Props" id="akka.contrib.pattern.ShardRegion.props(72336c152e)">props</a><span class="delimiter">(</span>
    <a title="akka.actor.Props" id="akka.contrib.pattern.ShardRegion.props(72336c152e).entryProps">entryProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a>,
    <a title="String" id="akka.contrib.pattern.ShardRegion.props(72336c152e).role">role</a>: <span title="String">String</span>,
    <a title="String" id="akka.contrib.pattern.ShardRegion.props(72336c152e).coordinatorPath">coordinatorPath</a>: <span title="String">String</span>,
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern.ShardRegion.props(72336c152e).retryInterval">retryInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
    <a title="Int" id="akka.contrib.pattern.ShardRegion.props(72336c152e).bufferSize">bufferSize</a>: <span title="Int">Int</span>,
    <a title="akka.contrib.pattern.ShardRegion.MessageExtractor" id="akka.contrib.pattern.ShardRegion.props(72336c152e).messageExtractor">messageExtractor</a>: ShardRegion.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">MessageExtractor</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> = <span class="delimiter">{</span>

    <a href="#akka.contrib.pattern.ShardRegion.props(bf47bcb125)" title="(entryProps: Option[akka.actor.Props], role: Option[String], coordinatorPath: String, retryInterval: scala.concurrent.duration.FiniteDuration, bufferSize: Int, idExtractor: akka.contrib.pattern.ShardRegion.IdExtractor, shardResolver: akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId)akka.actor.Props">props</a><span class="delimiter">(</span><span title="(x: akka.actor.Props)Option[akka.actor.Props]">Option</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.props(72336c152e).entryProps" title="akka.actor.Props">entryProps</a><span class="delimiter">)</span>, <a href="#akka.contrib.pattern.ShardRegion.roleOption" title="(role: String)Option[String]">roleOption</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.props(72336c152e).role" title="String">role</a><span class="delimiter">)</span>, <a href="#akka.contrib.pattern.ShardRegion.props(72336c152e).coordinatorPath" title="String">coordinatorPath</a>, <a href="#akka.contrib.pattern.ShardRegion.props(72336c152e).retryInterval" title="scala.concurrent.duration.FiniteDuration">retryInterval</a>, <a href="#akka.contrib.pattern.ShardRegion.props(72336c152e).bufferSize" title="Int">bufferSize</a>,
      idExtractor = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[akka.contrib.pattern.ShardRegion.Msg,(akka.contrib.pattern.ShardRegion.EntryId, akka.contrib.pattern.ShardRegion.Msg)] with Serializable" id="akka.contrib.pattern.ShardRegion.props(72336c152e);$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
        <span class="keyword">case</span> <a title="akka.contrib.pattern.ShardRegion.Msg" id="akka.contrib.pattern.ShardRegion.props(72336c152e);$anonfun.isDefinedAt.msg">msg</a> <span class="keyword">if</span> <a href="#akka.contrib.pattern.ShardRegion.props(72336c152e).messageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">messageExtractor</a>.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor.entryId" title="(message: Any)String">entryId</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.props(72336c152e);$anonfun.isDefinedAt.msg" title="akka.contrib.pattern.ShardRegion.Msg">msg</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span> ⇒
          <span title="(_1: String, _2: Any)(String, Any)" class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.props(72336c152e).messageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">messageExtractor</a>.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor.entryId" title="(message: Any)String">entryId</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.props(72336c152e);$anonfun.isDefinedAt.msg" title="akka.contrib.pattern.ShardRegion.Msg">msg</a><span class="delimiter">)</span>, <a href="#akka.contrib.pattern.ShardRegion.props(72336c152e).messageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">messageExtractor</a>.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor.entryMessage" title="(message: Any)Any">entryMessage</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.props(72336c152e);$anonfun.isDefinedAt.msg" title="akka.contrib.pattern.ShardRegion.Msg">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.IdExtractor">IdExtractor</span>,
      shardResolver = <a title="Any" id="akka.contrib.pattern.ShardRegion.props(72336c152e).$anonfun.msg">msg</a> ⇒ <a href="#akka.contrib.pattern.ShardRegion.props(72336c152e).messageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">messageExtractor</a>.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor.shardId" title="(message: Any)String">shardId</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.props(72336c152e).$anonfun.msg" title="Any">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Scala API: Factory method for the [[akka.actor.Props]] of the [[ShardRegion]] actor
   * when using it in proxy only mode.
   */</span>
  <span class="keyword">def</span> <a title="(role: Option[String], coordinatorPath: String, retryInterval: scala.concurrent.duration.FiniteDuration, bufferSize: Int, idExtractor: akka.contrib.pattern.ShardRegion.IdExtractor, shardResolver: akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId)akka.actor.Props" id="akka.contrib.pattern.ShardRegion.proxyProps(cbec1914a8)">proxyProps</a><span class="delimiter">(</span>
    <a title="Option[String]" id="akka.contrib.pattern.ShardRegion.proxyProps(cbec1914a8).role">role</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>,
    <a title="String" id="akka.contrib.pattern.ShardRegion.proxyProps(cbec1914a8).coordinatorPath">coordinatorPath</a>: <span title="String">String</span>,
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern.ShardRegion.proxyProps(cbec1914a8).retryInterval">retryInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
    <a title="Int" id="akka.contrib.pattern.ShardRegion.proxyProps(cbec1914a8).bufferSize">bufferSize</a>: <span title="Int">Int</span>,
    <a title="akka.contrib.pattern.ShardRegion.IdExtractor" id="akka.contrib.pattern.ShardRegion.proxyProps(cbec1914a8).idExtractor">idExtractor</a>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.IdExtractor">IdExtractor</span>,
    <a title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardRegion.proxyProps(cbec1914a8).shardResolver">shardResolver</a>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId">ShardResolver</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.contrib.pattern.ShardRegion](classOf[akka.contrib.pattern.ShardRegion])" class="delimiter">[</span>ShardRegion<span class="delimiter">]</span>, <span title="None.type">None</span>, <a href="#akka.contrib.pattern.ShardRegion.proxyProps(cbec1914a8).role" title="Option[String]">role</a>, <a href="#akka.contrib.pattern.ShardRegion.proxyProps(cbec1914a8).coordinatorPath" title="String">coordinatorPath</a>, <a href="#akka.contrib.pattern.ShardRegion.proxyProps(cbec1914a8).retryInterval" title="scala.concurrent.duration.FiniteDuration">retryInterval</a>, <a href="#akka.contrib.pattern.ShardRegion.proxyProps(cbec1914a8).bufferSize" title="Int">bufferSize</a>, <a href="#akka.contrib.pattern.ShardRegion.proxyProps(cbec1914a8).idExtractor" title="akka.contrib.pattern.ShardRegion.IdExtractor">idExtractor</a>, <a href="#akka.contrib.pattern.ShardRegion.proxyProps(cbec1914a8).shardResolver" title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId">shardResolver</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API: : Factory method for the [[akka.actor.Props]] of the [[ShardRegion]] actor
   * when using it in proxy only mode.
   */</span>
  <span class="keyword">def</span> <a title="(role: String, coordinatorPath: String, retryInterval: scala.concurrent.duration.FiniteDuration, bufferSize: Int, messageExtractor: akka.contrib.pattern.ShardRegion.MessageExtractor)akka.actor.Props" id="akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff)">proxyProps</a><span class="delimiter">(</span>
    <a title="String" id="akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).role">role</a>: <span title="String">String</span>,
    <a title="String" id="akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).coordinatorPath">coordinatorPath</a>: <span title="String">String</span>,
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).retryInterval">retryInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
    <a title="Int" id="akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).bufferSize">bufferSize</a>: <span title="Int">Int</span>,
    <a title="akka.contrib.pattern.ShardRegion.MessageExtractor" id="akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).messageExtractor">messageExtractor</a>: ShardRegion.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">MessageExtractor</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> = <span class="delimiter">{</span>

    <a href="#akka.contrib.pattern.ShardRegion.proxyProps(cbec1914a8)" title="(role: Option[String], coordinatorPath: String, retryInterval: scala.concurrent.duration.FiniteDuration, bufferSize: Int, idExtractor: akka.contrib.pattern.ShardRegion.IdExtractor, shardResolver: akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId)akka.actor.Props">proxyProps</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.roleOption" title="(role: String)Option[String]">roleOption</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).role" title="String">role</a><span class="delimiter">)</span>, <a href="#akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).coordinatorPath" title="String">coordinatorPath</a>, <a href="#akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).retryInterval" title="scala.concurrent.duration.FiniteDuration">retryInterval</a>, <a href="#akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).bufferSize" title="Int">bufferSize</a>,
      idExtractor = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[akka.contrib.pattern.ShardRegion.Msg,(akka.contrib.pattern.ShardRegion.EntryId, akka.contrib.pattern.ShardRegion.Msg)] with Serializable" id="akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff);$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
        <span class="keyword">case</span> <a title="akka.contrib.pattern.ShardRegion.Msg" id="akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff);$anonfun.isDefinedAt.msg">msg</a> <span class="keyword">if</span> <a href="#akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).messageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">messageExtractor</a>.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor.entryId" title="(message: Any)String">entryId</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff);$anonfun.isDefinedAt.msg" title="akka.contrib.pattern.ShardRegion.Msg">msg</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span> ⇒
          <span title="(_1: String, _2: Any)(String, Any)" class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).messageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">messageExtractor</a>.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor.entryId" title="(message: Any)String">entryId</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff);$anonfun.isDefinedAt.msg" title="akka.contrib.pattern.ShardRegion.Msg">msg</a><span class="delimiter">)</span>, <a href="#akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).messageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">messageExtractor</a>.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor.entryMessage" title="(message: Any)Any">entryMessage</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff);$anonfun.isDefinedAt.msg" title="akka.contrib.pattern.ShardRegion.Msg">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>,
      shardResolver = <a title="akka.contrib.pattern.ShardRegion.Msg" id="akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).$anonfun.msg">msg</a> ⇒ <a href="#akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).messageExtractor" title="akka.contrib.pattern.ShardRegion.MessageExtractor">messageExtractor</a>.<a href="#akka.contrib.pattern.ShardRegion;MessageExtractor.shardId" title="(message: Any)String">shardId</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.proxyProps(5c27b7daff).$anonfun.msg" title="akka.contrib.pattern.ShardRegion.Msg">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Marker type of entry identifier (`String`).
   */</span>
  <span class="keyword">type</span> <a title="String" id="akka.contrib.pattern.ShardRegion;EntryId">EntryId</a> = <span title="String">String</span>
  <span class="comment">/**
   * Marker type of shard identifier (`String`).
   */</span>
  <span class="keyword">type</span> <a title="String" id="akka.contrib.pattern.ShardRegion;ShardId">ShardId</a> = <span title="String">String</span>
  <span class="comment">/**
   * Marker type of application messages (`Any`).
   */</span>
  <span class="keyword">type</span> <a title="Any" id="akka.contrib.pattern.ShardRegion;Msg">Msg</a> = <span title="Any">Any</span>
  <span class="comment">/**
   * Interface of the partial function used by the [[ShardRegion]] to
   * extract the entry id and the message to send to the entry from an
   * incoming message. The implementation is application specific.
   * If the partial function does not match the message will be
   * `unhandled`, i.e. posted as `Unhandled` messages on the event stream.
   * Note that the extracted  message does not have to be the same as the incoming
   * message to support wrapping in message envelope that is unwrapped before
   * sending to the entry actor.
   */</span>
  <span class="keyword">type</span> <a title="PartialFunction[akka.contrib.pattern.ShardRegion.Msg,(akka.contrib.pattern.ShardRegion.EntryId, akka.contrib.pattern.ShardRegion.Msg)]" id="akka.contrib.pattern.ShardRegion;IdExtractor">IdExtractor</a> = <span title="PartialFunction[akka.contrib.pattern.ShardRegion.Msg,(akka.contrib.pattern.ShardRegion.EntryId, akka.contrib.pattern.ShardRegion.Msg)]">PartialFunction</span><span class="delimiter">[</span>Msg, <span class="delimiter">(</span>EntryId, Msg<span class="delimiter">)</span><span class="delimiter">]</span>
  <span class="comment">/**
   * Interface of the function used by the [[ShardRegion]] to
   * extract the shard id from an incoming message.
   * Only messages that passed the [[IdExtractor]] will be used
   * as input to this function.
   */</span>
  <span class="keyword">type</span> <a title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardRegion;ShardResolver">ShardResolver</a> = Msg ⇒ ShardId

  <span class="comment">/**
   * Java API: Interface of functions to extract entry id,
   * shard id, and the message to send to the entry from an
   * incoming message.
   */</span>
  <span class="keyword">trait</span> <a title="trait MessageExtractor extends AnyRef" id="akka.contrib.pattern.ShardRegion;MessageExtractor">MessageExtractor</a> <span class="delimiter">{</span>
    <span class="comment">/**
     * Extract the entry id from an incoming `message`. If `null` is returned
     * the message will be `unhandled`, i.e. posted as `Unhandled` messages on the event stream
     */</span>
    <span class="keyword">def</span> <a title="(message: Any)String" id="akka.contrib.pattern.ShardRegion;MessageExtractor.entryId">entryId</a><span class="delimiter">(</span><a title="Any" id="akka.contrib.pattern.ShardRegion;MessageExtractor.entryId.message">message</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="String">String</span>
    <span class="comment">/**
     * Extract the message to send to the entry from an incoming `message`.
     * Note that the extracted message does not have to be the same as the incoming
     * message to support wrapping in message envelope that is unwrapped before
     * sending to the entry actor.
     */</span>
    <span class="keyword">def</span> <a title="(message: Any)Any" id="akka.contrib.pattern.ShardRegion;MessageExtractor.entryMessage">entryMessage</a><span class="delimiter">(</span><a title="Any" id="akka.contrib.pattern.ShardRegion;MessageExtractor.entryMessage.message">message</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Any">Any</span>
    <span class="comment">/**
     * Extract the entry id from an incoming `message`. Only messages that passed the [[#entryId]]
     * function will be used as input to this function.
     */</span>
    <span class="keyword">def</span> <a title="(message: Any)String" id="akka.contrib.pattern.ShardRegion;MessageExtractor.shardId">shardId</a><span class="delimiter">(</span><a title="Any" id="akka.contrib.pattern.ShardRegion;MessageExtractor.shardId.message">message</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="String">String</span>
  <span class="delimiter">}</span>

  <span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait ShardRegionCommand extends AnyRef" id="akka.contrib.pattern.ShardRegion;ShardRegionCommand">ShardRegionCommand</a>

  <span class="comment">/**
   * If the state of the entries are persistent you may stop entries that are not used to
   * reduce memory consumption. This is done by the application specific implementation of
   * the entry actors for example by defining receive timeout (`context.setReceiveTimeout`).
   * If a message is already enqueued to the entry when it stops itself the enqueued message
   * in the mailbox will be dropped. To support graceful passivation without loosing such
   * messages the entry actor can send this `Passivate` message to its parent `ShardRegion`.
   * The specified wrapped `stopMessage` will be sent back to the entry, which is
   * then supposed to stop itself. Incoming messages will be buffered by the `ShardRegion`
   * between reception of `Passivate` and termination of the entry. Such buffered messages
   * are thereafter delivered to a new incarnation of the entry.
   *
   * [[akka.actor.PoisonPill]] is a perfectly fine `stopMessage`.
   */</span>
  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class Passivate extends AnyRef with akka.contrib.pattern.ShardRegion.ShardRegionCommand with Product with Serializable" id="akka.contrib.pattern.ShardRegion.Passivate.readResolve">Passivate</a><a href="#akka.contrib.pattern.ShardRegion.Passivate.readResolve" title="Product" class="delimiter">(</a><a title="Any" id="akka.contrib.pattern.ShardRegion;Passivate.stopMessage">stopMessage</a>: <span title="Any">Any</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardRegion;ShardRegionCommand" title="akka.contrib.pattern.ShardRegion.ShardRegionCommand">ShardRegionCommand</a>

  <span class="keyword">private</span> <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ShardRegion.Retry.productElement.x$1" title="akka.contrib.pattern.ShardRegion.Retry.type" id="akka.contrib.pattern.ShardRegion.Retry.readResolve">Retry</a> <span title="Product" class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardRegion;ShardRegionCommand" title="akka.contrib.pattern.ShardRegion.ShardRegionCommand">ShardRegionCommand</a>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(role: String)Option[String]" id="akka.contrib.pattern.ShardRegion.roleOption">roleOption</a><span class="delimiter">(</span><a title="String" id="akka.contrib.pattern.ShardRegion.roleOption.role">role</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#akka.contrib.pattern.ShardRegion.roleOption.role" title="String">role</a> <span title="Option[String]" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> | <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> ⇒ <span title="None.type">None</span>
    <span class="keyword">case</span> _         ⇒ <span title="(x: String)Some[String]">Some</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion.roleOption.role" title="String">role</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * INTERNAL API. Sends `PoisonPill` to the entries and when all of them have terminated
   * it replies with `ShardStopped`.
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">class</span> <a title="class HandOffStopper extends AnyRef with akka.actor.Actor" id="akka.contrib.pattern.ShardRegion;HandOffStopper">HandOffStopper</a><a href="#akka.contrib.pattern.ShardRegion;HandOffStopper" title="akka.contrib.pattern.ShardRegion.HandOffStopper" class="delimiter">(</a><a title="String" id="akka.contrib.pattern.ShardRegion;HandOffStopper.shard">shard</a>: <span title="String">String</span>, <a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardRegion;HandOffStopper.replyTo">replyTo</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Set[akka.actor.ActorRef]" id="akka.contrib.pattern.ShardRegion;HandOffStopper.entries">entries</a>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#akka.contrib.pattern.ShardCoordinator" title="akka.contrib.pattern.ShardCoordinator.type">ShardCoordinator</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal" title="akka.contrib.pattern.ShardCoordinator.Internal.type">Internal</a>.ShardStopped

    <a href="#akka.contrib.pattern.ShardRegion;HandOffStopper.entries" title="Set[akka.actor.ActorRef]">entries</a>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardRegion;HandOffStopper.<local HandOffStopper>.$anonfun.a">a</a> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a> <a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a> <a href="#akka.contrib.pattern.ShardRegion;HandOffStopper.<local HandOffStopper>.$anonfun.a" title="akka.actor.ActorRef">a</a>
      <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">a</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.PoisonPill" title="akka.actor.PoisonPill.type">PoisonPill</a>
    <span class="delimiter">}</span>

    <span class="keyword">var</span> <a title="Set[akka.actor.ActorRef]" id="akka.contrib.pattern.ShardRegion;HandOffStopper.remaining_=">remaining</a> = <a href="#akka.contrib.pattern.ShardRegion;HandOffStopper.entries" title="Set[akka.actor.ActorRef]">entries</a>

    <span class="keyword">def</span> <a title="=&gt; PartialFunction[Any,Unit]" id="akka.contrib.pattern.ShardRegion;HandOffStopper.receive">receive</a> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.contrib.pattern.ShardRegion;HandOffStopper.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> Terminated<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardRegion;HandOffStopper.receive;$anonfun.isDefinedAt.ref">ref</a><span class="delimiter">)</span> ⇒
        <a href="#akka.contrib.pattern.ShardRegion;HandOffStopper.remaining_=" title="(x$1: Set[akka.actor.ActorRef])Unit">remaining</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-=</span> <a href="#akka.contrib.pattern.ShardRegion;HandOffStopper.receive;$anonfun.isDefinedAt.ref" title="akka.actor.ActorRef">ref</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion;HandOffStopper.remaining_=" title="=&gt; Set[akka.actor.ActorRef]">remaining</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">replyTo</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardStopped.readResolve" title="(shard: akka.contrib.pattern.ShardRegion.ShardId)akka.contrib.pattern.ShardCoordinator.Internal.ShardStopped">ShardStopped</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardRegion;HandOffStopper.shard" title="String">shard</a><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a> <a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * This actor creates children entry actors on demand for the shards that it is told to be
 * responsible for. It delegates messages targeted to other shards to the responsible
 * `ShardRegion` actor on other nodes.
 *
 * @see [[ClusterSharding$ ClusterSharding extension]]
 */</span>
<span title="AnyRef" class="keyword">class</span> <a title="class ShardRegion extends AnyRef with akka.actor.Actor with akka.actor.ActorLogging" id="akka.contrib.pattern;ShardRegion">ShardRegion</a><a href="#akka.contrib.pattern;ShardRegion" title="akka.contrib.pattern.ShardRegion" class="delimiter">(</a>
  <a title="Option[akka.actor.Props]" id="akka.contrib.pattern;ShardRegion.entryProps">entryProps</a>: <span title="Option[akka.actor.Props]">Option</span><span class="delimiter">[</span>Props<span class="delimiter">]</span>,
  <a title="Option[String]" id="akka.contrib.pattern;ShardRegion.role">role</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>,
  <a title="String" id="akka.contrib.pattern;ShardRegion.coordinatorPath">coordinatorPath</a>: <span title="String">String</span>,
  <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern;ShardRegion.retryInterval">retryInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
  <a title="Int" id="akka.contrib.pattern;ShardRegion.bufferSize">bufferSize</a>: <span title="Int">Int</span>,
  <a title="akka.contrib.pattern.ShardRegion.IdExtractor" id="akka.contrib.pattern;ShardRegion.idExtractor">idExtractor</a>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.IdExtractor">IdExtractor</span>,
  <a title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern;ShardRegion.shardResolver">shardResolver</a>: ShardRegion.<span title="akka.contrib.pattern.ShardRegion.Msg =&gt; akka.contrib.pattern.ShardRegion.ShardId">ShardResolver</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="keyword">with</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="delimiter">{</span>

  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ShardCoordinator" title="akka.contrib.pattern.ShardCoordinator.type">ShardCoordinator</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal" title="akka.contrib.pattern.ShardCoordinator.Internal.type">Internal</a>._
  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ShardRegion" title="akka.contrib.pattern.ShardRegion.type">ShardRegion</a>._

  <span class="keyword">val</span> <a title="akka.cluster.Cluster" id="akka.contrib.pattern;ShardRegion.cluster">cluster</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>

  <span class="comment">// sort by age, oldest first</span>
  <span class="keyword">val</span> <a title="scala.math.Ordering[akka.cluster.Member]" id="akka.contrib.pattern;ShardRegion.ageOrdering">ageOrdering</a> = <span title="=&gt; math.Ordering.type">Ordering</span>.<span title="[T](cmp: (T, T) =&gt; Boolean)scala.math.Ordering[T]">fromLessThan</span><span title="(cmp: (akka.cluster.Member, akka.cluster.Member) =&gt; Boolean)scala.math.Ordering[akka.cluster.Member]" class="delimiter">[</span><a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member" title="akka.cluster.Member">Member</a><span class="delimiter">]</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern;ShardRegion.ageOrdering.$anonfun.a">a</a>, <a title="akka.cluster.Member" id="akka.contrib.pattern;ShardRegion.ageOrdering.$anonfun.b">b</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ShardRegion.ageOrdering.$anonfun.a" title="akka.cluster.Member">a</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.isOlderThan" title="(other: akka.cluster.Member)Boolean">isOlderThan</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.ageOrdering.$anonfun.b" title="akka.cluster.Member">b</a><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="keyword">var</span> <a title="scala.collection.immutable.SortedSet[akka.cluster.Member]" id="akka.contrib.pattern;ShardRegion.membersByAge_=">membersByAge</a>: immutable.<span title="scala.collection.immutable.SortedSet[akka.cluster.Member]">SortedSet</span><span class="delimiter">[</span>Member<span class="delimiter">]</span> = immutable.<span title="scala.collection.immutable.SortedSet.type">SortedSet</span>.<span title="(implicit ord: Ordering[akka.cluster.Member])scala.collection.immutable.SortedSet[akka.cluster.Member]">empty</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.ageOrdering" title="=&gt; scala.math.Ordering[akka.cluster.Member]">ageOrdering</a><span class="delimiter">)</span>

  <span class="keyword">var</span> <a title="scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.contrib.pattern.ShardRegion.ShardId]]" id="akka.contrib.pattern;ShardRegion.regions_=">regions</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.contrib.pattern.ShardRegion.ShardId]]" class="delimiter">[</span><a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <span title="Set[akka.contrib.pattern.ShardRegion.ShardId]">Set</span><span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="keyword">var</span> <a title="scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]" id="akka.contrib.pattern;ShardRegion.regionByShard_=">regionByShard</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]" class="delimiter">[</span><span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span>, <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">]</span>
  <span class="keyword">var</span> <a title="scala.collection.immutable.Map[akka.actor.ActorRef,akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern;ShardRegion.entries_=">entries</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.actor.ActorRef,akka.contrib.pattern.ShardRegion.ShardId]" class="delimiter">[</span><a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span><span class="delimiter">]</span>
  <span class="keyword">var</span> <a title="scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Set[akka.actor.ActorRef]]" id="akka.contrib.pattern;ShardRegion.entriesByShard_=">entriesByShard</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Set[akka.actor.ActorRef]]" class="delimiter">[</span><span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span>, <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="keyword">var</span> <a title="scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]" id="akka.contrib.pattern;ShardRegion.shardBuffers_=">shardBuffers</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]" class="delimiter">[</span><span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span>, <span title="Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">Vector</span><span class="delimiter">[</span><span class="delimiter">(</span>Msg, ActorRef<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="keyword">var</span> <a title="scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]" id="akka.contrib.pattern;ShardRegion.passivatingBuffers_=">passivatingBuffers</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]" class="delimiter">[</span><a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <span title="Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">Vector</span><span class="delimiter">[</span><span class="delimiter">(</span>Msg, ActorRef<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="=&gt; Int" id="akka.contrib.pattern;ShardRegion.totalBufferSize">totalBufferSize</a> = <span class="delimiter">{</span>
    <a href="#akka.contrib.pattern;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(f: ((akka.contrib.pattern.ShardRegion.ShardId, Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)])) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]],Int,scala.collection.immutable.Iterable[Int]])scala.collection.immutable.Iterable[Int]">map</span> <a href="#akka.contrib.pattern;ShardRegion.totalBufferSize.$anonfun.x0$1" title="Int" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>_, <span title="Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span><span class="delimiter">)</span> ⇒ <span title="Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span>.<span title="=&gt; Int">size</span> <span class="delimiter">}</span>.<span title="(implicit num: Numeric[Int])Int">sum</span> <span title="(x: Int)Int">+</span>
      <a href="#akka.contrib.pattern;ShardRegion.passivatingBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">passivatingBuffers</a>.<span title="(f: ((akka.actor.ActorRef, Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)])) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]],Int,scala.collection.immutable.Iterable[Int]])scala.collection.immutable.Iterable[Int]">map</span> <a href="#akka.contrib.pattern;ShardRegion.totalBufferSize.$anonfun.x0$2" title="Int" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>_, <span title="Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span><span class="delimiter">)</span> ⇒ <span title="Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span>.<span title="=&gt; Int">size</span> <span class="delimiter">}</span>.<span title="(implicit num: Numeric[Int])Int">sum</span>
  <span class="delimiter">}</span>

  <span class="keyword">import</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher
  <span class="keyword">val</span> <a title="akka.actor.Cancellable" id="akka.contrib.pattern;ShardRegion.retryTask">retryTask</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.schedule(abf8206fc2)" title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">schedule</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="#akka.contrib.pattern;ShardRegion.retryInterval" title="scala.concurrent.duration.FiniteDuration">retryInterval</a>, <a href="#akka.contrib.pattern;ShardRegion.retryInterval" title="scala.concurrent.duration.FiniteDuration">retryInterval</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.contrib.pattern.ShardRegion.Retry.readResolve" title="akka.contrib.pattern.ShardRegion.Retry.type">Retry</a><span class="delimiter">)</span>

  <span class="comment">// subscribe to MemberEvent, re-subscribe when restart</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ShardRegion.preStart">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.contrib.pattern;ShardRegion.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.subscribe(6cfb44d410)" title="(subscriber: akka.actor.ActorRef, to: Class[_]*)Unit">subscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, classOf<span title="Class[akka.cluster.ClusterEvent.MemberEvent](classOf[akka.cluster.ClusterEvent$$MemberEvent])" class="delimiter">[</span>MemberEvent<span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ShardRegion.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.contrib.pattern;ShardRegion" title="akka.contrib.pattern.ShardRegion" class="keyword">super</a>.<a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.postStop" title="()Unit">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ShardRegion.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.unsubscribe(134bd64d81)" title="(subscriber: akka.actor.ActorRef)Unit">unsubscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ShardRegion.retryTask" title="=&gt; akka.actor.Cancellable">retryTask</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Cancellable.cancel" title="()Boolean">cancel</a><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(member: akka.cluster.Member)Boolean" id="akka.contrib.pattern;ShardRegion.matchingRole">matchingRole</a><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern;ShardRegion.matchingRole.member">member</a>: <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member" title="akka.cluster.Member">Member</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#akka.contrib.pattern;ShardRegion.role" title="Option[String]">role</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="None.type">None</span>    ⇒ <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="String" id="akka.contrib.pattern;ShardRegion.matchingRole.r">r</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ShardRegion.matchingRole.member" title="akka.cluster.Member">member</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.hasRole" title="(role: String)Boolean">hasRole</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.matchingRole.r" title="String">r</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Option[akka.actor.ActorSelection]" id="akka.contrib.pattern;ShardRegion.coordinatorSelection">coordinatorSelection</a>: <span title="Option[akka.actor.ActorSelection]">Option</span><span class="delimiter">[</span>ActorSelection<span class="delimiter">]</span> =
    <a href="#akka.contrib.pattern;ShardRegion.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a>.<span title="=&gt; Option[akka.cluster.Member]">headOption</span>.<span title="(f: akka.cluster.Member =&gt; akka.actor.ActorSelection)Option[akka.actor.ActorSelection]">map</span><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern;ShardRegion.coordinatorSelection.$anonfun.m">m</a> ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorSelection(271eeb39be)" title="(path: String)akka.actor.ActorSelection">actorSelection</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;RootActorPath" title="(address: akka.actor.Address, name: String)akka.actor.RootActorPath">RootActorPath</a><span title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd" class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.coordinatorSelection.$anonfun.m" title="akka.cluster.Member">m</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span> <span title="(other: String)String">+</span> <a href="#akka.contrib.pattern;ShardRegion.coordinatorPath" title="String">coordinatorPath</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">var</span> <a title="Option[akka.actor.ActorRef]" id="akka.contrib.pattern;ShardRegion.coordinator_=">coordinator</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <span title="None.type">None</span>

  <span class="keyword">def</span> <a title="(newMembers: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit" id="akka.contrib.pattern;ShardRegion.changeMembers">changeMembers</a><span class="delimiter">(</span><a title="scala.collection.immutable.SortedSet[akka.cluster.Member]" id="akka.contrib.pattern;ShardRegion.changeMembers.newMembers">newMembers</a>: immutable.<span title="scala.collection.immutable.SortedSet[akka.cluster.Member]">SortedSet</span><span class="delimiter">[</span>Member<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Option[akka.cluster.Member]" id="akka.contrib.pattern;ShardRegion.changeMembers.before">before</a> = <a href="#akka.contrib.pattern;ShardRegion.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a>.<span title="=&gt; Option[akka.cluster.Member]">headOption</span>
    <span class="keyword">val</span> <a title="Option[akka.cluster.Member]" id="akka.contrib.pattern;ShardRegion.changeMembers.after">after</a> = <a href="#akka.contrib.pattern;ShardRegion.changeMembers.newMembers" title="scala.collection.immutable.SortedSet[akka.cluster.Member]">newMembers</a>.<span title="=&gt; Option[akka.cluster.Member]">headOption</span>
    <a href="#akka.contrib.pattern;ShardRegion.membersByAge_=" title="(x$1: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit">membersByAge</a> = <a href="#akka.contrib.pattern;ShardRegion.changeMembers.newMembers" title="scala.collection.immutable.SortedSet[akka.cluster.Member]">newMembers</a>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.changeMembers.before" title="Option[akka.cluster.Member]">before</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#akka.contrib.pattern;ShardRegion.changeMembers.after" title="Option[akka.cluster.Member]">after</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.isDebugEnabled" title="=&gt; Boolean">isDebugEnabled</a><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Coordinator moved from [{}] to [{}]&quot;)" class="string">&quot;Coordinator moved from [{}] to [{}]&quot;</span>, <a href="#akka.contrib.pattern;ShardRegion.changeMembers.before" title="Option[akka.cluster.Member]">before</a>.<span title="(f: akka.cluster.Member =&gt; akka.actor.Address)Option[akka.actor.Address]">map</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.changeMembers.$anonfun.x$1" title="akka.cluster.Member">_</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>.<span title="(default: =&gt; java.io.Serializable)java.io.Serializable">getOrElse</span><span class="delimiter">(</span><span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>, <a href="#akka.contrib.pattern;ShardRegion.changeMembers.after" title="Option[akka.cluster.Member]">after</a>.<span title="(f: akka.cluster.Member =&gt; akka.actor.Address)Option[akka.actor.Address]">map</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.changeMembers.$anonfun.x$2" title="akka.cluster.Member">_</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>.<span title="(default: =&gt; java.io.Serializable)java.io.Serializable">getOrElse</span><span class="delimiter">(</span><span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ShardRegion.coordinator_=" title="(x$1: Option[akka.actor.ActorRef])Unit">coordinator</a> = <span title="None.type">None</span>
      <a href="#akka.contrib.pattern;ShardRegion.register" title="()Unit">register</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; PartialFunction[Any,Unit]" id="akka.contrib.pattern;ShardRegion.receive">receive</a> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.contrib.pattern;ShardRegion.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> Terminated<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardRegion.receive;$anonfun.isDefinedAt.ref">ref</a><span class="delimiter">)</span>                     ⇒ <a href="#akka.contrib.pattern;ShardRegion.receiveTerminated" title="(ref: akka.actor.ActorRef)Unit">receiveTerminated</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receive;$anonfun.isDefinedAt.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="akka.cluster.ClusterEvent.ClusterDomainEvent" id="akka.contrib.pattern;ShardRegion.receive;$anonfun.isDefinedAt.evt">evt</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;ClusterDomainEvent" title="akka.cluster.ClusterEvent.ClusterDomainEvent">ClusterDomainEvent</a>             ⇒ <a href="#akka.contrib.pattern;ShardRegion.receiveClusterEvent" title="(evt: akka.cluster.ClusterEvent.ClusterDomainEvent)Unit">receiveClusterEvent</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receive;$anonfun.isDefinedAt.evt" title="akka.cluster.ClusterEvent.ClusterDomainEvent">evt</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="akka.cluster.ClusterEvent.CurrentClusterState" id="akka.contrib.pattern;ShardRegion.receive;$anonfun.isDefinedAt.state">state</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState" title="akka.cluster.ClusterEvent.CurrentClusterState">CurrentClusterState</a>          ⇒ <a href="#akka.contrib.pattern;ShardRegion.receiveClusterState" title="(state: akka.cluster.ClusterEvent.CurrentClusterState)Unit">receiveClusterState</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receive;$anonfun.isDefinedAt.state" title="akka.cluster.ClusterEvent.CurrentClusterState">state</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage">msg</span>: <a href="#akka.contrib.pattern.ShardCoordinator.Internal;CoordinatorMessage" title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a>             ⇒ <a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage" title="(msg: akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage)Unit">receiveCoordinatorMessage</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage">msg</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="akka.contrib.pattern.ShardRegion.ShardRegionCommand" id="akka.contrib.pattern;ShardRegion.receive;$anonfun.isDefinedAt.cmd">cmd</a>: <a href="#akka.contrib.pattern.ShardRegion;ShardRegionCommand" title="akka.contrib.pattern.ShardRegion.ShardRegionCommand">ShardRegionCommand</a>             ⇒ <a href="#akka.contrib.pattern;ShardRegion.receiveCommand" title="(cmd: akka.contrib.pattern.ShardRegion.ShardRegionCommand)Unit">receiveCommand</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receive;$anonfun.isDefinedAt.cmd" title="akka.contrib.pattern.ShardRegion.ShardRegionCommand">cmd</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="Any">msg</span> <span class="keyword">if</span> <a href="#akka.contrib.pattern;ShardRegion.idExtractor" title="akka.contrib.pattern.ShardRegion.IdExtractor">idExtractor</a>.<span title="(x: akka.contrib.pattern.ShardRegion.Msg)Boolean">isDefinedAt</span><span class="delimiter">(</span><span title="Any">msg</span><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ShardRegion.deliverMessage" title="(msg: Any, snd: akka.actor.ActorRef)Unit">deliverMessage</a><span title="Boolean(true)" class="delimiter">(</span><span title="Any">msg</span>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(state: akka.cluster.ClusterEvent.CurrentClusterState)Unit" id="akka.contrib.pattern;ShardRegion.receiveClusterState">receiveClusterState</a><span class="delimiter">(</span><a title="akka.cluster.ClusterEvent.CurrentClusterState" id="akka.contrib.pattern;ShardRegion.receiveClusterState.state">state</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState" title="akka.cluster.ClusterEvent.CurrentClusterState">CurrentClusterState</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.contrib.pattern;ShardRegion.changeMembers" title="(newMembers: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit">changeMembers</a><span class="delimiter">(</span>immutable.<span title="scala.collection.immutable.SortedSet.type">SortedSet</span>.<span title="(implicit ord: Ordering[akka.cluster.Member])scala.collection.immutable.SortedSet[akka.cluster.Member]">empty</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.ageOrdering" title="=&gt; scala.math.Ordering[akka.cluster.Member]">ageOrdering</a><span class="delimiter">)</span> <span title="(elems: scala.collection.GenTraversableOnce[akka.cluster.Member])scala.collection.immutable.SortedSet[akka.cluster.Member]">++</span> <a href="#akka.contrib.pattern;ShardRegion.receiveClusterState.state" title="akka.cluster.ClusterEvent.CurrentClusterState">state</a>.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState.members" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">members</a>.<span title="(p: akka.cluster.Member =&gt; Boolean)scala.collection.immutable.SortedSet[akka.cluster.Member]">filter</span><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern;ShardRegion.receiveClusterState.$anonfun.m">m</a> ⇒
      <a href="#akka.contrib.pattern;ShardRegion.receiveClusterState.$anonfun.m" title="akka.cluster.Member">m</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.status" title="=&gt; akka.cluster.MemberStatus">status</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.MemberStatus" title="akka.cluster.MemberStatus.type">MemberStatus</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.MemberStatus.Up" title="akka.cluster.MemberStatus.Up.type">Up</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.contrib.pattern;ShardRegion.matchingRole" title="(member: akka.cluster.Member)Boolean">matchingRole</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveClusterState.$anonfun.m" title="akka.cluster.Member">m</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(evt: akka.cluster.ClusterEvent.ClusterDomainEvent)Unit" id="akka.contrib.pattern;ShardRegion.receiveClusterEvent">receiveClusterEvent</a><span class="delimiter">(</span><a title="akka.cluster.ClusterEvent.ClusterDomainEvent" id="akka.contrib.pattern;ShardRegion.receiveClusterEvent.evt">evt</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;ClusterDomainEvent" title="akka.cluster.ClusterEvent.ClusterDomainEvent">ClusterDomainEvent</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.contrib.pattern;ShardRegion.receiveClusterEvent.evt" title="akka.cluster.ClusterEvent.ClusterDomainEvent">evt</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> MemberUp<span class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span> ⇒
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.matchingRole" title="(member: akka.cluster.Member)Boolean">matchingRole</a><span class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.contrib.pattern;ShardRegion.changeMembers" title="(newMembers: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit">changeMembers</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a> <span title="(elem: akka.cluster.Member)scala.collection.immutable.SortedSet[akka.cluster.Member]">+</span> <span title="akka.cluster.Member">m</span><span class="delimiter">)</span>

    <span class="keyword">case</span> MemberRemoved<span class="delimiter">(</span><span title="akka.cluster.Member">m</span>, _<span class="delimiter">)</span> ⇒
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.matchingRole" title="(member: akka.cluster.Member)Boolean">matchingRole</a><span class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.contrib.pattern;ShardRegion.changeMembers" title="(newMembers: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit">changeMembers</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a> <span title="(elem: akka.cluster.Member)scala.collection.immutable.SortedSet[akka.cluster.Member]">-</span> <span title="akka.cluster.Member">m</span><span class="delimiter">)</span>

    <span class="keyword">case</span> _ ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.unhandled" title="(message: Any)Unit">unhandled</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveClusterEvent.evt" title="akka.cluster.ClusterEvent.ClusterDomainEvent">evt</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(msg: akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage)Unit" id="akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage">receiveCoordinatorMessage</a><span class="delimiter">(</span><a title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage" id="akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.msg">msg</a>: <a href="#akka.contrib.pattern.ShardCoordinator.Internal;CoordinatorMessage" title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.msg" title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage">msg</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> ShardHome<span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>, <a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.ref">ref</a><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Shard [{}] located at [{}]&quot;)" class="string">&quot;Shard [{}] located at [{}]&quot;</span>, <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>, <a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ShardRegion.regionByShard_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">regionByShard</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId)Option[akka.actor.ActorRef]">get</span><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.r">r</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.r" title="akka.actor.ActorRef">r</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a> ⇒
          <span class="comment">// should not happen, inconsistency between ShardRegion and ShardCoordinator</span>
          <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IllegalStateException" class="keyword">new</span> <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Unexpected change of shard [&quot;)">Unexpected change of shard [$</span><span class="delimiter">{</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">}</span><span title="String(&quot;] from self to [&quot;)">] from self to [$</span><span class="delimiter">{</span><a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">}</span><span title="String(&quot;]&quot;)" class="string">]&quot;</span><span class="delimiter">)</span>
        <span class="keyword">case</span> _ ⇒
      <span class="delimiter">}</span>
      <a href="#akka.contrib.pattern;ShardRegion.regionByShard_=" title="(x$1: scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef])Unit">regionByShard</a> = <a href="#akka.contrib.pattern;ShardRegion.regionByShard_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">regionByShard</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId, value: akka.actor.ActorRef)scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">updated</span><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>, <a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ShardRegion.regions_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.contrib.pattern.ShardRegion.ShardId]])Unit">regions</a> = <a href="#akka.contrib.pattern;ShardRegion.regions_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef, value: Set[akka.contrib.pattern.ShardRegion.ShardId])scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.contrib.pattern.ShardRegion.ShardId]]">updated</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a>, <a href="#akka.contrib.pattern;ShardRegion.regions_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef, default: =&gt; Set[akka.contrib.pattern.ShardRegion.ShardId])Set[akka.contrib.pattern.ShardRegion.ShardId]">getOrElse</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a>, <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]">empty</span><span class="delimiter">)</span> <span title="(elem: akka.contrib.pattern.ShardRegion.ShardId)scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]">+</span> <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId)Option[Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">get</span><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]" id="akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.buf">buf</a><span class="delimiter">)</span> ⇒
          <a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.buf" title="Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">buf</a>.<span title="(f: ((akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)) =&gt; Unit)Unit">foreach</span> <a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.$anonfun.x0$3" title="Unit" class="delimiter">{</a>
            <span class="keyword">case</span> <span class="delimiter">(</span><a title="Any" id="akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.$anonfun.msg">msg</a>, <a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.$anonfun.snd">snd</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ShardRegion.deliverMessage" title="(msg: Any, snd: akka.actor.ActorRef)Unit">deliverMessage</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.$anonfun.msg" title="Any">msg</a>, <a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.$anonfun.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#akka.contrib.pattern;ShardRegion.shardBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">shardBuffers</a> <span title="(key: akka.contrib.pattern.ShardRegion.ShardId)scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">-=</span> <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>
        <span class="keyword">case</span> <span title="None.type">None</span> ⇒
      <span class="delimiter">}</span>

    <span class="keyword">case</span> RegisterAck<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.coord">coord</a><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.coord" title="akka.actor.ActorRef">coord</a><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ShardRegion.coordinator_=" title="(x$1: Option[akka.actor.ActorRef])Unit">coordinator</a> = <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.coord" title="akka.actor.ActorRef">coord</a><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ShardRegion.requestShardBufferHomes" title="()Unit">requestShardBufferHomes</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">case</span> BeginHandOff<span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;BeginHandOff shard [{}]&quot;)" class="string">&quot;BeginHandOff shard [{}]&quot;</span>, <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.regionByShard_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">regionByShard</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.regionRef">regionRef</a> = <a href="#akka.contrib.pattern;ShardRegion.regionByShard_=" title="(key: akka.contrib.pattern.ShardRegion.ShardId)akka.actor.ActorRef">regionByShard</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.updatedShards">updatedShards</a> = <a href="#akka.contrib.pattern;ShardRegion.regions_=" title="(key: akka.actor.ActorRef)Set[akka.contrib.pattern.ShardRegion.ShardId]">regions</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.regionRef" title="akka.actor.ActorRef">regionRef</a><span class="delimiter">)</span> <span title="(elem: akka.contrib.pattern.ShardRegion.ShardId)scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]">-</span> <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.updatedShards" title="scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]">updatedShards</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#akka.contrib.pattern;ShardRegion.regions_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.contrib.pattern.ShardRegion.ShardId]])Unit">regions</a> <span title="(key: akka.actor.ActorRef)scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.contrib.pattern.ShardRegion.ShardId]]">-=</span> <a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.regionRef" title="akka.actor.ActorRef">regionRef</a>
        <span class="keyword">else</span> <a href="#akka.contrib.pattern;ShardRegion.regions_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.contrib.pattern.ShardRegion.ShardId]])Unit">regions</a> = <a href="#akka.contrib.pattern;ShardRegion.regions_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef, value: Set[akka.contrib.pattern.ShardRegion.ShardId])scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.contrib.pattern.ShardRegion.ShardId]]">updated</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.regionRef" title="akka.actor.ActorRef">regionRef</a>, <a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.updatedShards" title="scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]">updatedShards</a><span class="delimiter">)</span>
        <a href="#akka.contrib.pattern;ShardRegion.regionByShard_=" title="(x$1: scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef])Unit">regionByShard</a> <span title="(key: akka.contrib.pattern.ShardRegion.ShardId)scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">-=</span> <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>
      <span class="delimiter">}</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.BeginHandOffAck.readResolve" title="(shard: akka.contrib.pattern.ShardRegion.ShardId)akka.contrib.pattern.ShardCoordinator.Internal.BeginHandOffAck">BeginHandOffAck</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>

    <span class="keyword">case</span> HandOff<span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;HandOff shard [{}]&quot;)" class="string">&quot;HandOff shard [{}]&quot;</span>, <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>

      <span class="comment">// must drop requests that came in between the BeginHandOff and now,</span>
      <span class="comment">// because they might be forwarded from other regions and there</span>
      <span class="comment">// is a risk or message re-ordering otherwise</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.contrib.pattern;ShardRegion.shardBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">shardBuffers</a> <span title="(key: akka.contrib.pattern.ShardRegion.ShardId)scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">-=</span> <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.entriesByShard_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Set[akka.actor.ActorRef]]">entriesByShard</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(59f1e43182)" title="(props: akka.actor.Props)akka.actor.ActorRef">actorOf</a><span title="Unit" class="delimiter">(</span><a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.contrib.pattern.ShardRegion.HandOffStopper](classOf[akka.contrib.pattern.ShardRegion$$HandOffStopper])" class="delimiter">[</span>HandOffStopper<span class="delimiter">]</span>, <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#akka.contrib.pattern;ShardRegion.entriesByShard_=" title="(key: akka.contrib.pattern.ShardRegion.ShardId)Set[akka.actor.ActorRef]">entriesByShard</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">else</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardStopped.readResolve" title="(shard: akka.contrib.pattern.ShardRegion.ShardId)akka.contrib.pattern.ShardCoordinator.Internal.ShardStopped">ShardStopped</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>

    <span class="keyword">case</span> _ ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.unhandled" title="(message: Any)Unit">unhandled</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveCoordinatorMessage.msg" title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage">msg</a><span class="delimiter">)</span>

  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(cmd: akka.contrib.pattern.ShardRegion.ShardRegionCommand)Unit" id="akka.contrib.pattern;ShardRegion.receiveCommand">receiveCommand</a><span class="delimiter">(</span><a title="akka.contrib.pattern.ShardRegion.ShardRegionCommand" id="akka.contrib.pattern;ShardRegion.receiveCommand.cmd">cmd</a>: <a href="#akka.contrib.pattern.ShardRegion;ShardRegionCommand" title="akka.contrib.pattern.ShardRegion.ShardRegionCommand">ShardRegionCommand</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.contrib.pattern;ShardRegion.receiveCommand.cmd" title="akka.contrib.pattern.ShardRegion.ShardRegionCommand">cmd</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> Passivate<span class="delimiter">(</span><a title="Any" id="akka.contrib.pattern;ShardRegion.receiveCommand.stopMessage">stopMessage</a><span class="delimiter">)</span> ⇒
      <a href="#akka.contrib.pattern;ShardRegion.passivate" title="(entry: akka.actor.ActorRef, stopMessage: Any)Unit">passivate</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#akka.contrib.pattern;ShardRegion.receiveCommand.stopMessage" title="Any">stopMessage</a><span class="delimiter">)</span>

    <span class="keyword">case</span> <a href="#akka.contrib.pattern.ShardRegion.Retry.readResolve" title="akka.contrib.pattern.ShardRegion.Retry.type">Retry</a> ⇒
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.coordinator_=" title="=&gt; Option[akka.actor.ActorRef]">coordinator</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
        <a href="#akka.contrib.pattern;ShardRegion.register" title="()Unit">register</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">else</span>
        <a href="#akka.contrib.pattern;ShardRegion.requestShardBufferHomes" title="()Unit">requestShardBufferHomes</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">case</span> _ ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.unhandled" title="(message: Any)Unit">unhandled</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveCommand.cmd" title="akka.contrib.pattern.ShardRegion.ShardRegionCommand">cmd</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(ref: akka.actor.ActorRef)Unit" id="akka.contrib.pattern;ShardRegion.receiveTerminated">receiveTerminated</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardRegion.receiveTerminated.ref">ref</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.coordinator_=" title="=&gt; Option[akka.actor.ActorRef]">coordinator</a>.<span title="(p: akka.actor.ActorRef =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.$anonfun.x$3" title="akka.actor.ActorRef">_</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ShardRegion.coordinator_=" title="(x$1: Option[akka.actor.ActorRef])Unit">coordinator</a> = <span title="None.type">None</span>
    <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.regions_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Set[akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern;ShardRegion.receiveTerminated.shards">shards</a> = <a href="#akka.contrib.pattern;ShardRegion.regions_=" title="(key: akka.actor.ActorRef)Set[akka.contrib.pattern.ShardRegion.ShardId]">regions</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ShardRegion.regionByShard_=" title="(x$1: scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef])Unit">regionByShard</a> <span title="(xs: scala.collection.GenTraversableOnce[akka.contrib.pattern.ShardRegion.ShardId])scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">--=</span> <a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.shards" title="Set[akka.contrib.pattern.ShardRegion.ShardId]">shards</a>
      <a href="#akka.contrib.pattern;ShardRegion.regions_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.contrib.pattern.ShardRegion.ShardId]])Unit">regions</a> <span title="(key: akka.actor.ActorRef)scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.contrib.pattern.ShardRegion.ShardId]]">-=</span> <a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.isDebugEnabled" title="=&gt; Boolean">isDebugEnabled</a><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Region [{}] with shards [{}] terminated&quot;)" class="string">&quot;Region [{}] with shards [{}] terminated&quot;</span>, <a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a>, <a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.shards" title="Set[akka.contrib.pattern.ShardRegion.ShardId]">shards</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.entries_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,akka.contrib.pattern.ShardRegion.ShardId]">entries</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern;ShardRegion.receiveTerminated.shard">shard</a> = <a href="#akka.contrib.pattern;ShardRegion.entries_=" title="(key: akka.actor.ActorRef)akka.contrib.pattern.ShardRegion.ShardId">entries</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.immutable.Set[akka.actor.ActorRef]" id="akka.contrib.pattern;ShardRegion.receiveTerminated.newShardEntities">newShardEntities</a> = <a href="#akka.contrib.pattern;ShardRegion.entriesByShard_=" title="(key: akka.contrib.pattern.ShardRegion.ShardId)Set[akka.actor.ActorRef]">entriesByShard</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-</span> <a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.newShardEntities" title="scala.collection.immutable.Set[akka.actor.ActorRef]">newShardEntities</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
        <a href="#akka.contrib.pattern;ShardRegion.entriesByShard_=" title="(x$1: scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Set[akka.actor.ActorRef]])Unit">entriesByShard</a> <span title="(key: akka.contrib.pattern.ShardRegion.ShardId)scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Set[akka.actor.ActorRef]]">-=</span> <a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a>
      <span class="keyword">else</span>
        <a href="#akka.contrib.pattern;ShardRegion.entriesByShard_=" title="(x$1: scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Set[akka.actor.ActorRef]])Unit">entriesByShard</a> = <a href="#akka.contrib.pattern;ShardRegion.entriesByShard_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Set[akka.actor.ActorRef]]">entriesByShard</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId, value: Set[akka.actor.ActorRef])scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Set[akka.actor.ActorRef]]">updated</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a>, <a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.newShardEntities" title="scala.collection.immutable.Set[akka.actor.ActorRef]">newShardEntities</a><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ShardRegion.entries_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,akka.contrib.pattern.ShardRegion.ShardId])Unit">entries</a> <span title="(key: akka.actor.ActorRef)scala.collection.immutable.Map[akka.actor.ActorRef,akka.contrib.pattern.ShardRegion.ShardId]">-=</span> <a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.passivatingBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">passivatingBuffers</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Passivating completed {}, buffered [{}]&quot;)" class="string">&quot;Passivating completed {}, buffered [{}]&quot;</span>, <a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a>, <a href="#akka.contrib.pattern;ShardRegion.passivatingBuffers_=" title="(key: akka.actor.ActorRef)Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">passivatingBuffers</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
        <span class="comment">// deliver messages that were received between Passivate and Terminated, </span>
        <span class="comment">// will create new entry instance and deliver the messages to it</span>
        <a href="#akka.contrib.pattern;ShardRegion.passivatingBuffers_=" title="(key: akka.actor.ActorRef)Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">passivatingBuffers</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span> <span title="(f: ((akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)) =&gt; Unit)Unit">foreach</span> <a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.$anonfun.x0$4" title="Unit" class="delimiter">{</a>
          <span class="keyword">case</span> <span class="delimiter">(</span><a title="Any" id="akka.contrib.pattern;ShardRegion.receiveTerminated.$anonfun.msg">msg</a>, <a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardRegion.receiveTerminated.$anonfun.snd">snd</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ShardRegion.deliverMessage" title="(msg: Any, snd: akka.actor.ActorRef)Unit">deliverMessage</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.$anonfun.msg" title="Any">msg</a>, <a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.$anonfun.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#akka.contrib.pattern;ShardRegion.passivatingBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">passivatingBuffers</a> <span title="(key: akka.actor.ActorRef)scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">-=</span> <a href="#akka.contrib.pattern;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ShardRegion.register">register</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.contrib.pattern;ShardRegion.coordinatorSelection" title="=&gt; Option[akka.actor.ActorSelection]">coordinatorSelection</a>.<span title="(f: akka.actor.ActorSelection =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor.ActorSelection.toScala" title="implicit akka.actor.ActorSelection.toScala : (sel: akka.actor.ActorSelection)akka.actor.ScalaActorSelection">_</a> <a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor;ScalaActorSelection.!" title="(msg: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern;ShardRegion.registrationMessage" title="=&gt; Any">registrationMessage</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Any" id="akka.contrib.pattern;ShardRegion.registrationMessage">registrationMessage</a>: <span title="Any">Any</span> =
    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.entryProps" title="Option[akka.actor.Props]">entryProps</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.Register.readResolve" title="(shardRegion: akka.actor.ActorRef)akka.contrib.pattern.ShardCoordinator.Internal.Register">Register</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.RegisterProxy.readResolve" title="(shardRegionProxy: akka.actor.ActorRef)akka.contrib.pattern.ShardCoordinator.Internal.RegisterProxy">RegisterProxy</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ShardRegion.requestShardBufferHomes">requestShardBufferHomes</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.contrib.pattern;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(f: ((akka.contrib.pattern.ShardRegion.ShardId, Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)])) =&gt; Unit)Unit">foreach</span> <a href="#akka.contrib.pattern;ShardRegion.requestShardBufferHomes.$anonfun.x0$5" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span class="delimiter">(</span><a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern;ShardRegion.requestShardBufferHomes.$anonfun.shard">shard</a>, _<span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ShardRegion.coordinator_=" title="=&gt; Option[akka.actor.ActorRef]">coordinator</a>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardRegion.requestShardBufferHomes.$anonfun.$anonfun.c">c</a> ⇒
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Retry request for shard [{}] homes&quot;)" class="string">&quot;Retry request for shard [{}] homes&quot;</span>, <a href="#akka.contrib.pattern;ShardRegion.requestShardBufferHomes.$anonfun.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">c</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.GetShardHome.readResolve" title="(shard: akka.contrib.pattern.ShardRegion.ShardId)akka.contrib.pattern.ShardCoordinator.Internal.GetShardHome">GetShardHome</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.requestShardBufferHomes.$anonfun.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(msg: Any, snd: akka.actor.ActorRef)Unit" id="akka.contrib.pattern;ShardRegion.deliverMessage">deliverMessage</a><span class="delimiter">(</span><a title="Any" id="akka.contrib.pattern;ShardRegion.deliverMessage.msg">msg</a>: <span title="Any">Any</span>, <a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardRegion.deliverMessage.snd">snd</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern;ShardRegion.deliverMessage.shard">shard</a> = <a href="#akka.contrib.pattern;ShardRegion.shardResolver" title="(v1: akka.contrib.pattern.ShardRegion.Msg)akka.contrib.pattern.ShardRegion.ShardId">shardResolver</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.msg" title="Any">msg</a><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ShardRegion.regionByShard_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">regionByShard</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId)Option[akka.actor.ActorRef]">get</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="akka.actor.ActorRef">ref</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a> ⇒
        <span class="keyword">val</span> <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.id" title="(akka.contrib.pattern.ShardRegion.EntryId, Any)" class="delimiter">(</a><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.x$5" title="akka.contrib.pattern.ShardRegion.EntryId" id="akka.contrib.pattern;ShardRegion.deliverMessage.id">id</a>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.x$5" title="Any" id="akka.contrib.pattern;ShardRegion.deliverMessage.m">m</a><span class="delimiter">)</span> = <a href="#akka.contrib.pattern;ShardRegion.idExtractor" title="(v1: akka.contrib.pattern.ShardRegion.Msg)(akka.contrib.pattern.ShardRegion.EntryId, akka.contrib.pattern.ShardRegion.Msg)">idExtractor</a><span title="(akka.contrib.pattern.ShardRegion.EntryId, akka.contrib.pattern.ShardRegion.Msg) @unchecked" class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.msg" title="Any">msg</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.id" title="akka.contrib.pattern.ShardRegion.EntryId">id</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span> <span title="(x: Boolean)Boolean">||</span> <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.id" title="akka.contrib.pattern.ShardRegion.EntryId">id</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.warning(dc73c33c91)" title="(template: String, arg1: Any)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;Id must not be empty, dropping message [{}]&quot;)" class="string">&quot;Id must not be empty, dropping message [{}]&quot;</span>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.msg" title="Any">msg</a>.<span title="()Class[_]">getClass</span>.<span title="()String">getName</span><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">deadLetters</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.msg" title="Any">msg</a>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="String" id="akka.contrib.pattern;ShardRegion.deliverMessage.name">name</a> = <span title="java.net.URLEncoder.type">URLEncoder</span>.<span title="(x$1: String, x$2: String)String">encode</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.id" title="akka.contrib.pattern.ShardRegion.EntryId">id</a>, <span title="String(&quot;utf-8&quot;)" class="string">&quot;utf-8&quot;</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardRegion.deliverMessage.entry">entry</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.child" title="(name: String)Option[akka.actor.ActorRef]">child</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.name" title="String">name</a><span class="delimiter">)</span>.<span title="(default: =&gt; akka.actor.ActorRef)akka.actor.ActorRef">getOrElse</span> <span class="delimiter">{</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.entryProps" title="Option[akka.actor.Props]">entryProps</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
              <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IllegalStateException" class="keyword">new</span> <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;Shard must not be allocated to a proxy only ShardRegion&quot;)" class="string">&quot;Shard must not be allocated to a proxy only ShardRegion&quot;</span><span class="delimiter">)</span>
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Starting entry [{}] in shard [{}]&quot;)" class="string">&quot;Starting entry [{}] in shard [{}]&quot;</span>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.id" title="akka.contrib.pattern.ShardRegion.EntryId">id</a>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardRegion.deliverMessage.entry.a">a</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(874c98419a)" title="(props: akka.actor.Props, name: String)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.entryProps" title="Option[akka.actor.Props]">entryProps</a>.<span title="=&gt; akka.actor.Props">get</span>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.name" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#akka.contrib.pattern;ShardRegion.entries_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,akka.contrib.pattern.ShardRegion.ShardId])Unit">entries</a> = <a href="#akka.contrib.pattern;ShardRegion.entries_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,akka.contrib.pattern.ShardRegion.ShardId]">entries</a>.<span title="(key: akka.actor.ActorRef, value: akka.contrib.pattern.ShardRegion.ShardId)scala.collection.immutable.Map[akka.actor.ActorRef,akka.contrib.pattern.ShardRegion.ShardId]">updated</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.entry.a" title="akka.actor.ActorRef">a</a>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
            <a href="#akka.contrib.pattern;ShardRegion.entriesByShard_=" title="(x$1: scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Set[akka.actor.ActorRef]])Unit">entriesByShard</a> = <a href="#akka.contrib.pattern;ShardRegion.entriesByShard_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Set[akka.actor.ActorRef]]">entriesByShard</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId, value: Set[akka.actor.ActorRef])scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Set[akka.actor.ActorRef]]">updated</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a>, <a href="#akka.contrib.pattern;ShardRegion.entriesByShard_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Set[akka.actor.ActorRef]]">entriesByShard</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId, default: =&gt; Set[akka.actor.ActorRef])Set[akka.actor.ActorRef]">getOrElse</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a>, <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.actor.ActorRef]">empty</span><span class="delimiter">)</span> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">+</span> <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.entry.a" title="akka.actor.ActorRef">a</a><span class="delimiter">)</span>
            <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.entry.a" title="akka.actor.ActorRef">a</a>
          <span class="delimiter">}</span>
          <a href="#akka.contrib.pattern;ShardRegion.passivatingBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">passivatingBuffers</a>.<span title="(key: akka.actor.ActorRef)Option[Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">get</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.entry" title="akka.actor.ActorRef">entry</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="None.type">None</span> ⇒
              <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Message [{}] for shard [{}] sent to entry&quot;)" class="string">&quot;Message [{}] for shard [{}] sent to entry&quot;</span>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.m" title="Any">m</a>.<span title="()Class[_]">getClass</span>.<span title="()String">getName</span>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
              <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.entry" title="akka.actor.ActorRef">entry</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.tell" title="(msg: Any, sender: akka.actor.ActorRef)Unit">tell</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.m" title="Any">m</a>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span>
            <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span><span class="delimiter">)</span> ⇒
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.totalBufferSize" title="=&gt; Int">totalBufferSize</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#akka.contrib.pattern;ShardRegion.bufferSize" title="Int">bufferSize</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Buffer is full, dropping message for passivated entry in shard [{}]&quot;)" class="string">&quot;Buffer is full, dropping message for passivated entry in shard [{}]&quot;</span>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
                <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">deadLetters</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.msg" title="Any">msg</a>
              <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Message for shard [{}] buffered due to entry being passivated&quot;)" class="string">&quot;Message for shard [{}] buffered due to entry being passivated&quot;</span>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
                <a href="#akka.contrib.pattern;ShardRegion.passivatingBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">passivatingBuffers</a> = <a href="#akka.contrib.pattern;ShardRegion.passivatingBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">passivatingBuffers</a>.<span title="(key: akka.actor.ActorRef, value: Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)])scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">updated</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.entry" title="akka.actor.ActorRef">entry</a>, <span title="Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span> <span title="(elem: (akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)],(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef),Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]])Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">:+</span> <span class="delimiter">(</span><span title="(_1: Any, _2: akka.actor.ActorRef)(Any, akka.actor.ActorRef)" class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.msg" title="Any">msg</a>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span> ⇒
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Forwarding request for shard [{}] to [{}]&quot;)" class="string">&quot;Forwarding request for shard [{}] to [{}]&quot;</span>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a>, <span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span>
        <span title="akka.actor.ActorRef">ref</span>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.tell" title="(msg: Any, sender: akka.actor.ActorRef)Unit">tell</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.msg" title="Any">msg</a>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="None.type">None</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span> <span title="(x: Boolean)Boolean">||</span> <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> ⇒
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.warning(dc73c33c91)" title="(template: String, arg1: Any)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;Shard must not be empty, dropping message [{}]&quot;)" class="string">&quot;Shard must not be empty, dropping message [{}]&quot;</span>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.msg" title="Any">msg</a>.<span title="()Class[_]">getClass</span>.<span title="()String">getName</span><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">deadLetters</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.msg" title="Any">msg</a>
      <span class="keyword">case</span> <span title="None.type">None</span> ⇒
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.contrib.pattern;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Request shard [{}] home&quot;)" class="string">&quot;Request shard [{}] home&quot;</span>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
          <a href="#akka.contrib.pattern;ShardRegion.coordinator_=" title="=&gt; Option[akka.actor.ActorRef]">coordinator</a>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">_</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.GetShardHome.readResolve" title="(shard: akka.contrib.pattern.ShardRegion.ShardId)akka.contrib.pattern.ShardCoordinator.Internal.GetShardHome">GetShardHome</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.totalBufferSize" title="=&gt; Int">totalBufferSize</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#akka.contrib.pattern;ShardRegion.bufferSize" title="Int">bufferSize</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Buffer is full, dropping message for shard [{}]&quot;)" class="string">&quot;Buffer is full, dropping message for shard [{}]&quot;</span>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">deadLetters</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.msg" title="Any">msg</a>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <span title="Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span> = <a href="#akka.contrib.pattern;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId, default: =&gt; Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)])Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">getOrElse</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a>, <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span><span class="delimiter">)</span>
          <a href="#akka.contrib.pattern;ShardRegion.shardBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">shardBuffers</a> = <a href="#akka.contrib.pattern;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId, value: Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)])scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">updated</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a>, <span title="Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span> <span title="(elem: (akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)],(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef),Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]])Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]">:+</span> <span class="delimiter">(</span><span title="(_1: Any, _2: akka.actor.ActorRef)(Any, akka.actor.ActorRef)" class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.deliverMessage.msg" title="Any">msg</a>, <a href="#akka.contrib.pattern;ShardRegion.deliverMessage.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(entry: akka.actor.ActorRef, stopMessage: Any)Unit" id="akka.contrib.pattern;ShardRegion.passivate">passivate</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">entry</span>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Any" id="akka.contrib.pattern;ShardRegion.passivate.stopMessage">stopMessage</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <span title="akka.actor.ActorRef">entry</span> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardRegion.entries_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,akka.contrib.pattern.ShardRegion.ShardId]">entries</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">entry</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#akka.contrib.pattern;ShardRegion.passivatingBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">passivatingBuffers</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">entry</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Passivating started {}&quot;)" class="string">&quot;Passivating started {}&quot;</span>, <span title="akka.actor.ActorRef">entry</span><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ShardRegion.passivatingBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">passivatingBuffers</a> = <a href="#akka.contrib.pattern;ShardRegion.passivatingBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">passivatingBuffers</a>.<span title="(key: akka.actor.ActorRef, value: Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)])scala.collection.immutable.Map[akka.actor.ActorRef,Vector[(akka.contrib.pattern.ShardRegion.Msg, akka.actor.ActorRef)]]">updated</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">entry</span>, <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">entry</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern;ShardRegion.passivate.stopMessage" title="Any">stopMessage</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * @see [[ClusterSharding$ ClusterSharding extension]]
 */</span>
<span class="keyword">object</span> <a title="akka.contrib.pattern.ShardCoordinatorSupervisor.type" id="akka.contrib.pattern.ShardCoordinatorSupervisor">ShardCoordinatorSupervisor</a> <a href="#akka.contrib.pattern.ShardCoordinatorSupervisor" title="akka.contrib.pattern.ShardCoordinatorSupervisor.type" class="delimiter">{</a>
  <span class="comment">/**
   * Factory method for the [[akka.actor.Props]] of the [[ShardCoordinator]] actor.
   */</span>
  <span class="keyword">def</span> <a title="(failureBackoff: scala.concurrent.duration.FiniteDuration, coordinatorProps: akka.actor.Props)akka.actor.Props" id="akka.contrib.pattern.ShardCoordinatorSupervisor.props">props</a><span class="delimiter">(</span><a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern.ShardCoordinatorSupervisor.props.failureBackoff">failureBackoff</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>, <a title="akka.actor.Props" id="akka.contrib.pattern.ShardCoordinatorSupervisor.props.coordinatorProps">coordinatorProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.contrib.pattern.ShardCoordinatorSupervisor](classOf[akka.contrib.pattern.ShardCoordinatorSupervisor])" class="delimiter">[</span>ShardCoordinatorSupervisor<span class="delimiter">]</span>, <a href="#akka.contrib.pattern.ShardCoordinatorSupervisor.props.failureBackoff" title="scala.concurrent.duration.FiniteDuration">failureBackoff</a>, <a href="#akka.contrib.pattern.ShardCoordinatorSupervisor.props.coordinatorProps" title="akka.actor.Props">coordinatorProps</a><span class="delimiter">)</span>

  <span class="comment">/**
   * INTERNAL API
   */</span>
  <span class="keyword">private</span> <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ShardCoordinatorSupervisor.StartCoordinator.productElement.x$1" title="akka.contrib.pattern.ShardCoordinatorSupervisor.StartCoordinator.type" id="akka.contrib.pattern.ShardCoordinatorSupervisor.StartCoordinator.readResolve">StartCoordinator</a>
<a href="#akka.contrib.pattern.ShardCoordinatorSupervisor.StartCoordinator.readResolve" title="akka.contrib.pattern.ShardCoordinatorSupervisor.StartCoordinator.type" class="delimiter">}</a>

<span title="AnyRef" class="keyword">class</span> <a title="class ShardCoordinatorSupervisor extends AnyRef with akka.actor.Actor" id="akka.contrib.pattern;ShardCoordinatorSupervisor">ShardCoordinatorSupervisor</a><a href="#akka.contrib.pattern;ShardCoordinatorSupervisor" title="akka.contrib.pattern.ShardCoordinatorSupervisor" class="delimiter">(</a><a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern;ShardCoordinatorSupervisor.failureBackoff">failureBackoff</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>, <a title="akka.actor.Props" id="akka.contrib.pattern;ShardCoordinatorSupervisor.coordinatorProps">coordinatorProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ShardCoordinatorSupervisor" title="akka.contrib.pattern.ShardCoordinatorSupervisor.type">ShardCoordinatorSupervisor</a>._

  <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ShardCoordinatorSupervisor.startCoordinator">startCoordinator</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="comment">// it will be stopped in case of PersistenceFailure</span>
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span title="Unit" class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(874c98419a)" title="(props: akka.actor.Props, name: String)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinatorSupervisor.coordinatorProps" title="akka.actor.Props">coordinatorProps</a>, <span title="String(&quot;coordinator&quot;)" class="string">&quot;coordinator&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ShardCoordinatorSupervisor.preStart">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.contrib.pattern;ShardCoordinatorSupervisor.startCoordinator" title="()Unit">startCoordinator</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; PartialFunction[Any,Unit]" id="akka.contrib.pattern;ShardCoordinatorSupervisor.receive">receive</a> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.contrib.pattern;ShardCoordinatorSupervisor.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> Terminated<span class="delimiter">(</span>_<span class="delimiter">)</span> ⇒
      <span class="keyword">import</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.scheduleOnce(a2d55b51db)" title="(delay: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">scheduleOnce</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="#akka.contrib.pattern;ShardCoordinatorSupervisor.failureBackoff" title="scala.concurrent.duration.FiniteDuration">failureBackoff</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.contrib.pattern.ShardCoordinatorSupervisor.StartCoordinator.readResolve" title="akka.contrib.pattern.ShardCoordinatorSupervisor.StartCoordinator.type">StartCoordinator</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#akka.contrib.pattern.ShardCoordinatorSupervisor.StartCoordinator.readResolve" title="akka.contrib.pattern.ShardCoordinatorSupervisor.StartCoordinator.type">StartCoordinator</a> ⇒ <a href="#akka.contrib.pattern;ShardCoordinatorSupervisor.startCoordinator" title="()Unit">startCoordinator</a><span title="Boolean(true)" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * @see [[ClusterSharding$ ClusterSharding extension]]
 */</span>
<span class="keyword">object</span> <a title="akka.contrib.pattern.ShardCoordinator.type" id="akka.contrib.pattern.ShardCoordinator">ShardCoordinator</a> <a href="#akka.contrib.pattern.ShardCoordinator" title="akka.contrib.pattern.ShardCoordinator.type" class="delimiter">{</a>

  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ShardRegion" title="akka.contrib.pattern.ShardRegion.type">ShardRegion</a>.ShardId

  <span class="comment">/**
   * Factory method for the [[akka.actor.Props]] of the [[ShardCoordinator]] actor.
   */</span>
  <span class="keyword">def</span> <a title="(handOffTimeout: scala.concurrent.duration.FiniteDuration, rebalanceInterval: scala.concurrent.duration.FiniteDuration, snapshotInterval: scala.concurrent.duration.FiniteDuration, allocationStrategy: akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy)akka.actor.Props" id="akka.contrib.pattern.ShardCoordinator.props">props</a><span class="delimiter">(</span><a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern.ShardCoordinator.props.handOffTimeout">handOffTimeout</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>, <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern.ShardCoordinator.props.rebalanceInterval">rebalanceInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>, <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern.ShardCoordinator.props.snapshotInterval">snapshotInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
            <a title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy" id="akka.contrib.pattern.ShardCoordinator.props.allocationStrategy">allocationStrategy</a>: <a href="#akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy" title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy">ShardAllocationStrategy</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.contrib.pattern.ShardCoordinator](classOf[akka.contrib.pattern.ShardCoordinator])" class="delimiter">[</span>ShardCoordinator<span class="delimiter">]</span>, <a href="#akka.contrib.pattern.ShardCoordinator.props.handOffTimeout" title="scala.concurrent.duration.FiniteDuration">handOffTimeout</a>, <a href="#akka.contrib.pattern.ShardCoordinator.props.rebalanceInterval" title="scala.concurrent.duration.FiniteDuration">rebalanceInterval</a>, <a href="#akka.contrib.pattern.ShardCoordinator.props.snapshotInterval" title="scala.concurrent.duration.FiniteDuration">snapshotInterval</a>, <a href="#akka.contrib.pattern.ShardCoordinator.props.allocationStrategy" title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy">allocationStrategy</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Interface of the pluggable shard allocation and rebalancing logic used by the [[ShardCoordinator]].
   *
   * Java implementations should extend [[AbstractShardAllocationStrategy]].
   */</span>
  <span class="keyword">trait</span> <a title="trait ShardAllocationStrategy extends AnyRef with akka.actor.NoSerializationVerificationNeeded" id="akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy">ShardAllocationStrategy</a> <span class="keyword">extends</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;NoSerializationVerificationNeeded" title="akka.actor.NoSerializationVerificationNeeded">NoSerializationVerificationNeeded</a> <span class="delimiter">{</span>
    <span class="comment">/**
     * Invoked when the location of a new shard is to be decided.
     * @param requester actor reference to the [[ShardRegion]] that requested the location of the
     *   shard, can be returned if preference should be given to the node where the shard was first accessed
     * @param shardId the id of the shard to allocate
     * @param currentShardAllocations all actor refs to `ShardRegion` and their current allocated shards,
     *   in the order they were allocated
     * @return the actor ref of the [[ShardRegion]] that is to be responsible for the shard, must be one of
     *   the references included in the `currentShardAllocations` parameter
     */</span>
    <span class="keyword">def</span> <a title="(requester: akka.actor.ActorRef, shardId: akka.contrib.pattern.ShardRegion.ShardId, currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]])akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy.allocateShard">allocateShard</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy.allocateShard.requester">requester</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy.allocateShard.shardId">shardId</a>: <span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span>,
                      <a title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]" id="akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy.allocateShard.currentShardAllocations">currentShardAllocations</a>: <span title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>

    <span class="comment">/**
     * Invoked periodically to decide which shards to rebalance to another location.
     * @param currentShardAllocations all actor refs to `ShardRegion` and their current allocated shards,
     *   in the order they were allocated
     * @param rebalanceInProgress set of shards that are currently being rebalanced, i.e.
     *   you should not include these in the returned set
     * @return the shards to be migrated, may be empty to skip rebalance in this round
     */</span>
    <span class="keyword">def</span> <a title="(currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]], rebalanceInProgress: Set[akka.contrib.pattern.ShardRegion.ShardId])Set[akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy.rebalance">rebalance</a><span class="delimiter">(</span><a title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]" id="akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy.rebalance.currentShardAllocations">currentShardAllocations</a>: <span title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span>,
                  <a title="Set[akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy.rebalance.rebalanceInProgress">rebalanceInProgress</a>: <span title="Set[akka.contrib.pattern.ShardRegion.ShardId]">Set</span><span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Set[akka.contrib.pattern.ShardRegion.ShardId]">Set</span><span class="delimiter">[</span>ShardId<span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Java API: Java implementations of custom shard allocation and rebalancing logic used by the [[ShardCoordinator]]
   * should extend this abstract class and implement the two methods.
   */</span>
  <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class AbstractShardAllocationStrategy extends AnyRef with akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy">AbstractShardAllocationStrategy</a> <a href="#akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy" title="akka.contrib.pattern.ShardCoordinator.AbstractShardAllocationStrategy" class="keyword">extends</a> <a href="#akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy" title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy">ShardAllocationStrategy</a> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="(requester: akka.actor.ActorRef, shardId: akka.contrib.pattern.ShardRegion.ShardId, currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]])akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(1b9e936d72)">allocateShard</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(1b9e936d72).requester">requester</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(1b9e936d72).shardId">shardId</a>: <span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span>,
                                     <a title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(1b9e936d72).currentShardAllocations">currentShardAllocations</a>: <span title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <span class="delimiter">{</span>
      <span class="keyword">import</span> scala.collection.<span title="scala.collection.JavaConverters.type">JavaConverters</span>._
      <a href="#akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(84d49dddf1)" title="(requester: akka.actor.ActorRef, shardId: String, currentShardAllocations: java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]])akka.actor.ActorRef">allocateShard</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(1b9e936d72).requester" title="akka.actor.ActorRef">requester</a>, <a href="#akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(1b9e936d72).shardId" title="akka.contrib.pattern.ShardRegion.ShardId">shardId</a>, <a href="#akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(1b9e936d72).currentShardAllocations" title="(m: scala.collection.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]])scala.collection.convert.Decorators.AsJava[java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]]">currentShardAllocations</a>.<span title="=&gt; java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]">asJava</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="(currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]], rebalanceInProgress: Set[akka.contrib.pattern.ShardRegion.ShardId])Set[akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(4393aafad2)">rebalance</a><span class="delimiter">(</span><a title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(4393aafad2).currentShardAllocations">currentShardAllocations</a>: <span title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span>,
                                 <a title="Set[akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(4393aafad2).rebalanceInProgress">rebalanceInProgress</a>: <span title="Set[akka.contrib.pattern.ShardRegion.ShardId]">Set</span><span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Set[akka.contrib.pattern.ShardRegion.ShardId]">Set</span><span class="delimiter">[</span>ShardId<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">import</span> scala.collection.<span title="scala.collection.JavaConverters.type">JavaConverters</span>._
      <a href="#akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(a3d72f2814)" title="(currentShardAllocations: java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]], rebalanceInProgress: java.util.Set[String])java.util.Set[String]">rebalance</a><span title="(s: java.util.Set[String])scala.collection.convert.Decorators.AsScala[scala.collection.mutable.Set[String]]" class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(4393aafad2).currentShardAllocations" title="(m: scala.collection.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]])scala.collection.convert.Decorators.AsJava[java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]]">currentShardAllocations</a>.<span title="=&gt; java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]">asJava</span>, <a href="#akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(4393aafad2).rebalanceInProgress" title="(s: scala.collection.Set[akka.contrib.pattern.ShardRegion.ShardId])scala.collection.convert.Decorators.AsJava[java.util.Set[akka.contrib.pattern.ShardRegion.ShardId]]">rebalanceInProgress</a>.<span title="=&gt; java.util.Set[akka.contrib.pattern.ShardRegion.ShardId]">asJava</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.Set[String]">asScala</span>.<span title="scala.collection.immutable.Set[String]">toSet</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Invoked when the location of a new shard is to be decided.
     * @param requester actor reference to the [[ShardRegion]] that requested the location of the
     *   shard, can be returned if preference should be given to the node where the shard was first accessed
     * @param shardId the id of the shard to allocate
     * @param currentShardAllocations all actor refs to `ShardRegion` and their current allocated shards,
     *   in the order they were allocated
     * @return the actor ref of the [[ShardRegion]] that is to be responsible for the shard, must be one of
     *   the references included in the `currentShardAllocations` parameter
     */</span>
    <span class="keyword">def</span> <a title="(requester: akka.actor.ActorRef, shardId: String, currentShardAllocations: java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]])akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(84d49dddf1)">allocateShard</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(84d49dddf1).requester">requester</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="String" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(84d49dddf1).shardId">shardId</a>: <span title="String">String</span>,
                      <a title="java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]]" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(84d49dddf1).currentShardAllocations">currentShardAllocations</a>: java.util.<span title="java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>

    <span class="comment">/**
     * Invoked periodically to decide which shards to rebalance to another location.
     * @param currentShardAllocations all actor refs to `ShardRegion` and their current allocated shards,
     *   in the order they were allocated
     * @param rebalanceInProgress set of shards that are currently being rebalanced, i.e.
     *   you should not include these in the returned set
     * @return the shards to be migrated, may be empty to skip rebalance in this round
     */</span>
    <span class="keyword">def</span> <a title="(currentShardAllocations: java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]], rebalanceInProgress: java.util.Set[String])java.util.Set[String]" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(a3d72f2814)">rebalance</a><span class="delimiter">(</span><a title="java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]]" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(a3d72f2814).currentShardAllocations">currentShardAllocations</a>: java.util.<span title="java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span>,
                  <a title="java.util.Set[String]" id="akka.contrib.pattern.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(a3d72f2814).rebalanceInProgress">rebalanceInProgress</a>: java.util.<span title="java.util.Set[String]">Set</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: java.util.<span title="java.util.Set[String]">Set</span><span class="delimiter">[</span>String<span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * The default implementation of [[ShardCoordinator.LeastShardAllocationStrategy]]
   * allocates new shards to the `ShardRegion` with least number of previously allocated shards.
   * It picks shards for rebalancing handoff from the `ShardRegion` with most number of previously allocated shards.
   * They will then be allocated to the `ShardRegion` with least number of previously allocated shards,
   * i.e. new members in the cluster. There is a configurable threshold of how large the difference
   * must be to begin the rebalancing. The number of ongoing rebalancing processes can be limited.
   */</span>
  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
  <span class="keyword">class</span> <a title="class LeastShardAllocationStrategy extends AnyRef with akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy with Serializable" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy">LeastShardAllocationStrategy</a><a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy" title="akka.contrib.pattern.ShardCoordinator.LeastShardAllocationStrategy" class="delimiter">(</a><a title="Int" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalanceThreshold">rebalanceThreshold</a>: <span title="Int">Int</span>, <a title="Int" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.maxSimultaneousRebalance">maxSimultaneousRebalance</a>: <span title="Int">Int</span><span class="delimiter">)</span>
    <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy" title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy">ShardAllocationStrategy</a> <span class="keyword">with</span> <span title="Serializable">Serializable</span> <span class="delimiter">{</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(requester: akka.actor.ActorRef, shardId: akka.contrib.pattern.ShardRegion.ShardId, currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]])akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.allocateShard">allocateShard</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.requester">requester</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.shardId">shardId</a>: <span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span>,
                               <a title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.currentShardAllocations">currentShardAllocations</a>: <span title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.regionWithLeastShards.regionWithLeastShards" title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.regionWithLeastShards" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.regionWithLeastShards.regionWithLeastShards">regionWithLeastShards</a>, _<span class="delimiter">)</span> = <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.currentShardAllocations" title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]">currentShardAllocations</a>.<span title="(f: ((akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId])) =&gt; Int)(implicit cmp: Ordering[Int])(akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId])">minBy</span> <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.regionWithLeastShards.$anonfun.x0$6" title="Int" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>_, <a title="scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.regionWithLeastShards.$anonfun.v">v</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.regionWithLeastShards.$anonfun.v" title="scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]">v</a>.<span title="=&gt; Int">size</span> <span class="delimiter">}</span>
      <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.regionWithLeastShards" title="akka.actor.ActorRef">regionWithLeastShards</a>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]], rebalanceInProgress: Set[akka.contrib.pattern.ShardRegion.ShardId])Set[akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance">rebalance</a><span class="delimiter">(</span><a title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.currentShardAllocations">currentShardAllocations</a>: <span title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span>,
                           <a title="Set[akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.rebalanceInProgress">rebalanceInProgress</a>: <span title="Set[akka.contrib.pattern.ShardRegion.ShardId]">Set</span><span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Set[akka.contrib.pattern.ShardRegion.ShardId]">Set</span><span class="delimiter">[</span>ShardId<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span title="scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.rebalanceInProgress" title="Set[akka.contrib.pattern.ShardRegion.ShardId]">rebalanceInProgress</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.maxSimultaneousRebalance" title="Int">maxSimultaneousRebalance</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.regionWithLeastShards" title="(akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId])" class="delimiter">(</a><a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.x$7" title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.regionWithLeastShards">regionWithLeastShards</a>, <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.x$7" title="scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.leastShards">leastShards</a><span class="delimiter">)</span> = <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.currentShardAllocations" title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]">currentShardAllocations</a>.<span title="(f: ((akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId])) =&gt; Int)(implicit cmp: Ordering[Int])(akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId])">minBy</span> <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.x$7.$anonfun.x0$7" title="Int" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>_, <a title="scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.x$7.$anonfun.v">v</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.x$7.$anonfun.v" title="scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]">v</a>.<span title="=&gt; Int">size</span> <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards">mostShards</a> = <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.currentShardAllocations" title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]">currentShardAllocations</a>.<span title="(pf: PartialFunction[(akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]),scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]],scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId],scala.collection.immutable.Iterable[scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]])scala.collection.immutable.Iterable[scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]]">collect</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[(akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]),scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]] with Serializable" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
          <span class="keyword">case</span> <span class="delimiter">(</span>_, <a title="scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards;$anonfun.isDefinedAt.v">v</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards;$anonfun.isDefinedAt.v" title="scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]">v</a>.<span title="(p: akka.contrib.pattern.ShardRegion.ShardId =&gt; Boolean)scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]">filterNot</span><span title="Boolean(true)" class="delimiter">(</span><a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards;$anonfun.applyOrElse.$anonfun.s">s</a> ⇒ <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.rebalanceInProgress" title="(elem: akka.contrib.pattern.ShardRegion.ShardId)Boolean">rebalanceInProgress</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards;$anonfun.applyOrElse.$anonfun.s" title="akka.contrib.pattern.ShardRegion.ShardId">s</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>.<span title="(f: scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId] =&gt; Int)(implicit cmp: Ordering[Int])scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]">maxBy</span><span title="scala.math.Ordering.Int.type" class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards.$anonfun.x$8" title="scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]">_</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
        <span title="scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards" title="scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]">mostShards</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">-</span> <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.leastShards" title="scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]">leastShards</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&gt;=</span> <a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalanceThreshold" title="Int">rebalanceThreshold</a><span class="delimiter">)</span>
          <span title="(elems: akka.contrib.pattern.ShardRegion.ShardId*)scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]">Set</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards" title="scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]">mostShards</a>.<span title="=&gt; akka.contrib.pattern.ShardRegion.ShardId">head</span><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]">empty</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]">empty</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * INTERNAL API
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">object</span> <a title="akka.contrib.pattern.ShardCoordinator.Internal.type" id="akka.contrib.pattern.ShardCoordinator.Internal">Internal</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal" title="akka.contrib.pattern.ShardCoordinator.Internal.type" class="delimiter">{</a>
    <span class="comment">/**
     * Messages sent to the coordinator
     */</span>
    <span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait CoordinatorCommand extends AnyRef" id="akka.contrib.pattern.ShardCoordinator.Internal;CoordinatorCommand">CoordinatorCommand</a>
    <span class="comment">/**
     * Messages sent from the coordinator
     */</span>
    <span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait CoordinatorMessage extends AnyRef" id="akka.contrib.pattern.ShardCoordinator.Internal;CoordinatorMessage">CoordinatorMessage</a>
    <span class="comment">/**
     * `ShardRegion` registers to `ShardCoordinator`, until it receives [[RegisterAck]]. 
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class Register extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorCommand with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.Register.readResolve">Register</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.Register.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator.Internal;Register.shardRegion">shardRegion</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;CoordinatorCommand" title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorCommand">CoordinatorCommand</a>
    <span class="comment">/**
     * `ShardRegion` in proxy only mode registers to `ShardCoordinator`, until it receives [[RegisterAck]]. 
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class RegisterProxy extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorCommand with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.RegisterProxy.readResolve">RegisterProxy</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.RegisterProxy.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator.Internal;RegisterProxy.shardRegionProxy">shardRegionProxy</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;CoordinatorCommand" title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorCommand">CoordinatorCommand</a>
    <span class="comment">/**
     * Acknowledgement from `ShardCoordinator` that [[Register]] or [[RegisterProxy]] was sucessful.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class RegisterAck extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.RegisterAck.readResolve">RegisterAck</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.RegisterAck.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator.Internal;RegisterAck.coordinator">coordinator</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;CoordinatorMessage" title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a>
    <span class="comment">/**
     * `ShardRegion` requests the location of a shard by sending this message
     * to the `ShardCoordinator`.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class GetShardHome extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorCommand with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.GetShardHome.readResolve">GetShardHome</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.GetShardHome.readResolve" title="Product" class="delimiter">(</a><a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardCoordinator.Internal;GetShardHome.shard">shard</a>: <span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;CoordinatorCommand" title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorCommand">CoordinatorCommand</a>
    <span class="comment">/**
     * `ShardCoordinator` replies with this message for [[GetShardHome]] requests.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class ShardHome extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.ShardHome.readResolve">ShardHome</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardHome.readResolve" title="Product" class="delimiter">(</a><a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardCoordinator.Internal;ShardHome.shard">shard</a>: <span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span>, <a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator.Internal;ShardHome.ref">ref</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;CoordinatorMessage" title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a>
    <span class="comment">/**
     * `ShardCoordinator` initiates rebalancing process by sending this message
     * to all registered `ShardRegion` actors (including proxy only). They are
     * supposed to discard their known location of the shard, i.e. start buffering
     * incoming messages for the shard. They reply with [[BeginHandOffAck]].
     * When all have replied the `ShardCoordinator` continues by sending
     * [[HandOff]] to the `ShardRegion` responsible for the shard.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class BeginHandOff extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.BeginHandOff.readResolve">BeginHandOff</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.BeginHandOff.readResolve" title="Product" class="delimiter">(</a><a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardCoordinator.Internal;BeginHandOff.shard">shard</a>: <span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;CoordinatorMessage" title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a>
    <span class="comment">/**
     * Acknowledgement of [[BeginHandOff]]
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class BeginHandOffAck extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorCommand with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.BeginHandOffAck.readResolve">BeginHandOffAck</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.BeginHandOffAck.readResolve" title="Product" class="delimiter">(</a><a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardCoordinator.Internal;BeginHandOffAck.shard">shard</a>: <span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;CoordinatorCommand" title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorCommand">CoordinatorCommand</a>
    <span class="comment">/**
     * When all `ShardRegion` actors have acknoledged the [[BeginHandOff]] the
     * ShardCoordinator` sends this message to the `ShardRegion` responsible for the
     * shard. The `ShardRegion` is supposed to stop all entries in that shard and when
     * all entries have terminated reply with `ShardStopped` to the `ShardCoordinator`.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class HandOff extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.HandOff.readResolve">HandOff</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.HandOff.readResolve" title="Product" class="delimiter">(</a><a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardCoordinator.Internal;HandOff.shard">shard</a>: <span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;CoordinatorMessage" title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a>
    <span class="comment">/**
     * Reply to [[HandOff]] when all entries in the shard have been terminated.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class ShardStopped extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorCommand with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.ShardStopped.readResolve">ShardStopped</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardStopped.readResolve" title="Product" class="delimiter">(</a><a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardCoordinator.Internal;ShardStopped.shard">shard</a>: <span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;CoordinatorCommand" title="akka.contrib.pattern.ShardCoordinator.Internal.CoordinatorCommand">CoordinatorCommand</a>

    <span class="comment">// DomainEvents for the persistent state of the event sourced ShardCoordinator</span>
    <span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait DomainEvent extends AnyRef" id="akka.contrib.pattern.ShardCoordinator.Internal;DomainEvent">DomainEvent</a>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class ShardRegionRegistered extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionRegistered.readResolve">ShardRegionRegistered</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionRegistered.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator.Internal;ShardRegionRegistered.region">region</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;DomainEvent" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">DomainEvent</a>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class ShardRegionProxyRegistered extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyRegistered.readResolve">ShardRegionProxyRegistered</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyRegistered.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator.Internal;ShardRegionProxyRegistered.regionProxy">regionProxy</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;DomainEvent" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">DomainEvent</a>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class ShardRegionTerminated extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionTerminated.readResolve">ShardRegionTerminated</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionTerminated.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator.Internal;ShardRegionTerminated.region">region</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;DomainEvent" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">DomainEvent</a>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class ShardRegionProxyTerminated extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyTerminated.readResolve">ShardRegionProxyTerminated</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyTerminated.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator.Internal;ShardRegionProxyTerminated.regionProxy">regionProxy</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;DomainEvent" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">DomainEvent</a>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class ShardHomeAllocated extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeAllocated.readResolve">ShardHomeAllocated</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeAllocated.readResolve" title="Product" class="delimiter">(</a><a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardCoordinator.Internal;ShardHomeAllocated.shard">shard</a>: <span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span>, <a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator.Internal;ShardHomeAllocated.region">region</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;DomainEvent" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">DomainEvent</a>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class ShardHomeDeallocated extends AnyRef with akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeDeallocated.readResolve">ShardHomeDeallocated</a><a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeDeallocated.readResolve" title="Product" class="delimiter">(</a><a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardCoordinator.Internal;ShardHomeDeallocated.shard">shard</a>: <span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;DomainEvent" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">DomainEvent</a>

    <span class="keyword">object</span> <a title="akka.contrib.pattern.ShardCoordinator.Internal.State.type" id="akka.contrib.pattern.ShardCoordinator.Internal.State.readResolve">State</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.State.readResolve" title="akka.contrib.pattern.ShardCoordinator.Internal.State.type" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="akka.contrib.pattern.ShardCoordinator.Internal.State" id="akka.contrib.pattern.ShardCoordinator.Internal.State.empty">empty</a> = <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.equals" title="(shards: Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef], regions: Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]], regionProxies: Set[akka.actor.ActorRef])akka.contrib.pattern.ShardCoordinator.Internal.State">State</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Persistent state of the event sourced ShardCoordinator.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="(shards: Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef], regions: Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]], regionProxies: Set[akka.actor.ActorRef])akka.contrib.pattern.ShardCoordinator.Internal.State" id="akka.contrib.pattern.ShardCoordinator.Internal;State.equals">State</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.equals" title="Product" class="keyword">private</a> <span class="delimiter">(</span>
      <span class="comment">// region for each shard   </span>
      <span class="keyword">val</span> <a title="Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]" id="akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$1">shards</a>: <span title="Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">Map</span><span class="delimiter">[</span>ShardId, ActorRef<span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,Nothing]">empty</span>,
      <span class="comment">// shards for each region</span>
      <span class="keyword">val</span> <a title="Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]" id="akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2">regions</a>: <span title="Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">Map</span><span class="delimiter">[</span>ActorRef, Vector<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="scala.collection.immutable.Map[akka.actor.ActorRef,Nothing]">empty</span>,
      <span class="keyword">val</span> <a title="Set[akka.actor.ActorRef]" id="akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$3">regionProxies</a>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.actor.ActorRef]">empty</span><span class="delimiter">)</span> <span class="delimiter">{</span>

      <span class="keyword">def</span> <a title="(event: akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent)akka.contrib.pattern.ShardCoordinator.Internal.State" id="akka.contrib.pattern.ShardCoordinator.Internal;State.updated">updated</a><span class="delimiter">(</span><a title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent" id="akka.contrib.pattern.ShardCoordinator.Internal;State.updated.event">event</a>: <a href="#akka.contrib.pattern.ShardCoordinator.Internal;DomainEvent" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">DomainEvent</a><span class="delimiter">)</span>: <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.equals" title="akka.contrib.pattern.ShardCoordinator.Internal.State">State</a> = <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.updated.event" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">event</a> <span title="akka.contrib.pattern.ShardCoordinator.Internal.State" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> ShardRegionRegistered<span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Region &quot;)">Region $</span><span title="akka.actor.ActorRef">region</span><span title="String(&quot; already registered: &quot;)"> already registered: $</span><span class="keyword">this</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$1" title="Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]" id="akka.contrib.pattern.ShardCoordinator.Internal;State.updated.x$13">copy</a><span class="delimiter">(</span>regions = <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef, value: Vector[akka.contrib.pattern.ShardRegion.ShardId])scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">updated</span><a title="scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]" id="akka.contrib.pattern.ShardCoordinator.Internal;State.updated.x$11" class="delimiter">(</a><span title="akka.actor.ActorRef">region</span>, <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> ShardRegionProxyRegistered<span class="delimiter">(</span><span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span> ⇒
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Region proxy &quot;)">Region proxy $</span><span title="akka.actor.ActorRef">proxy</span><span title="String(&quot; already registered: &quot;)"> already registered: $</span><span class="keyword">this</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$1" title="Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]" id="akka.contrib.pattern.ShardCoordinator.Internal;State.updated.x$16">copy</a><span class="delimiter">(</span>regionProxies = <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a> <a title="scala.collection.immutable.Set[akka.actor.ActorRef]" id="akka.contrib.pattern.ShardCoordinator.Internal;State.updated.x$14">+</a> <span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span>
        <span class="keyword">case</span> ShardRegionTerminated<span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Terminated region &quot;)">Terminated region $</span><span title="akka.actor.ActorRef">region</span><span title="String(&quot; not registered: &quot;)"> not registered: $</span><span class="keyword">this</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$3" title="Set[akka.actor.ActorRef]" id="akka.contrib.pattern.ShardCoordinator.Internal;State.updated.x$19">copy</a><span class="delimiter">(</span>
            regions = <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a> <a title="scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]" id="akka.contrib.pattern.ShardCoordinator.Internal;State.updated.x$17">-</a> <span title="akka.actor.ActorRef">region</span>,
            shards = <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a> <a title="scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]" id="akka.contrib.pattern.ShardCoordinator.Internal;State.updated.x$18">--</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="(key: akka.actor.ActorRef)Vector[akka.contrib.pattern.ShardRegion.ShardId]">regions</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> ShardRegionProxyTerminated<span class="delimiter">(</span><span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span> ⇒
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Terminated region proxy &quot;)">Terminated region proxy $</span><span title="akka.actor.ActorRef">proxy</span><span title="String(&quot; not registered: &quot;)"> not registered: $</span><span class="keyword">this</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$1" title="Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]" id="akka.contrib.pattern.ShardCoordinator.Internal;State.updated.x$22">copy</a><span class="delimiter">(</span>regionProxies = <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a> <a title="scala.collection.immutable.Set[akka.actor.ActorRef]" id="akka.contrib.pattern.ShardCoordinator.Internal;State.updated.x$20">-</a> <span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span>
        <span class="keyword">case</span> ShardHomeAllocated<span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>, <span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Region &quot;)">Region $</span><span title="akka.actor.ActorRef">region</span><span title="String(&quot; not registered: &quot;)"> not registered: $</span><span class="keyword">this</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Shard [&quot;)">Shard [$</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span title="String(&quot;] already allocated: &quot;)">] already allocated: $</span><span class="keyword">this</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.equals" title="(shards: Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef], regions: Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]], regionProxies: Set[akka.actor.ActorRef])akka.contrib.pattern.ShardCoordinator.Internal.State">copy</a><span class="delimiter">(</span>
            shards = <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId, value: akka.actor.ActorRef)scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">updated</span><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>, <span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>,
            regions = <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef, value: Vector[akka.contrib.pattern.ShardRegion.ShardId])scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">updated</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span>, <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="(key: akka.actor.ActorRef)Vector[akka.contrib.pattern.ShardRegion.ShardId]">regions</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> <span title="(elem: akka.contrib.pattern.ShardRegion.ShardId)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector[akka.contrib.pattern.ShardRegion.ShardId],akka.contrib.pattern.ShardRegion.ShardId,Vector[akka.contrib.pattern.ShardRegion.ShardId]])Vector[akka.contrib.pattern.ShardRegion.ShardId]">:+</span> <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> ShardHomeDeallocated<span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> ⇒
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Shard [&quot;)">Shard [$</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span title="String(&quot;] not allocated: &quot;)">] not allocated: $</span><span class="keyword">this</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <span title="akka.actor.ActorRef">region</span> = <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$1" title="(key: akka.contrib.pattern.ShardRegion.ShardId)akka.actor.ActorRef">shards</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Region &quot;)">Region $</span><span title="akka.actor.ActorRef">region</span><span title="String(&quot; for shard [&quot;)"> for shard [$</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span title="String(&quot;] not registered: &quot;)">] not registered: $</span><span class="keyword">this</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.equals" title="(shards: Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef], regions: Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]], regionProxies: Set[akka.actor.ActorRef])akka.contrib.pattern.ShardCoordinator.Internal.State">copy</a><span class="delimiter">(</span>
            shards = <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a> <span title="(key: akka.contrib.pattern.ShardRegion.ShardId)scala.collection.immutable.Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">-</span> <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>,
            regions = <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef, value: Vector[akka.contrib.pattern.ShardRegion.ShardId])scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">updated</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span>, <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="(key: akka.actor.ActorRef)Vector[akka.contrib.pattern.ShardRegion.ShardId]">regions</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>.<span title="(p: akka.contrib.pattern.ShardRegion.ShardId =&gt; Boolean)scala.collection.immutable.Vector[akka.contrib.pattern.ShardRegion.ShardId]">filterNot</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.updated.$anonfun.x$9" title="akka.contrib.pattern.ShardRegion.ShardId">_</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  <span class="comment">/**
   * Periodic message to trigger rebalance
   */</span>
  <span class="keyword">private</span> <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ShardCoordinator.RebalanceTick.productElement.x$1" title="akka.contrib.pattern.ShardCoordinator.RebalanceTick.type" id="akka.contrib.pattern.ShardCoordinator.RebalanceTick.readResolve">RebalanceTick</a>
  <span class="comment">/**
   * Periodic message to trigger persistent snapshot
   */</span>
  <span class="keyword">private</span> <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ShardCoordinator.SnapshotTick.productElement.x$1" title="akka.contrib.pattern.ShardCoordinator.SnapshotTick.type" id="akka.contrib.pattern.ShardCoordinator.SnapshotTick.readResolve">SnapshotTick</a>
  <span class="comment">/**
   * End of rebalance process performed by [[RebalanceWorker]]
   */</span>
  <span class="keyword">private</span> <span class="keyword">case class</span> <a title="class RebalanceDone extends AnyRef with Product with Serializable" id="akka.contrib.pattern.ShardCoordinator.RebalanceDone.readResolve">RebalanceDone</a><a href="#akka.contrib.pattern.ShardCoordinator.RebalanceDone.readResolve" title="Product" class="delimiter">(</a><a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardCoordinator;RebalanceDone.shard">shard</a>: <span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span>, <a title="Boolean" id="akka.contrib.pattern.ShardCoordinator;RebalanceDone.ok">ok</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ShardCoordinator.AfterRecover.productElement.x$1" title="akka.contrib.pattern.ShardCoordinator.AfterRecover.type" id="akka.contrib.pattern.ShardCoordinator.AfterRecover.readResolve">AfterRecover</a>

  <span class="comment">/**
   * INTERNAL API. Rebalancing process is performed by this actor.
   * It sends [[BeginHandOff]] to all `ShardRegion` actors followed by
   * [[HandOff]] to the `ShardRegion` responsible for the shard.
   * When the handoff is completed it sends [[RebalanceDone]] to its
   * parent `ShardCoordinator`. If the process takes longer than the
   * `handOffTimeout` it also sends [[RebalanceDone]].
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">class</span> <a title="class RebalanceWorker extends AnyRef with akka.actor.Actor" id="akka.contrib.pattern.ShardCoordinator;RebalanceWorker">RebalanceWorker</a><a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker" title="akka.contrib.pattern.ShardCoordinator.RebalanceWorker" class="delimiter">(</a><a title="String" id="akka.contrib.pattern.ShardCoordinator;RebalanceWorker.shard">shard</a>: <span title="String">String</span>, <a title="akka.actor.ActorRef" id="akka.contrib.pattern.ShardCoordinator;RebalanceWorker.from">from</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern.ShardCoordinator;RebalanceWorker.handOffTimeout">handOffTimeout</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
                                      <a title="Set[akka.actor.ActorRef]" id="akka.contrib.pattern.ShardCoordinator;RebalanceWorker.regions">regions</a>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#akka.contrib.pattern.ShardCoordinator.Internal" title="akka.contrib.pattern.ShardCoordinator.Internal.type">Internal</a>._
    <a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker.regions" title="Set[akka.actor.ActorRef]">regions</a>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">_</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.BeginHandOff.readResolve" title="(shard: akka.contrib.pattern.ShardRegion.ShardId)akka.contrib.pattern.ShardCoordinator.Internal.BeginHandOff">BeginHandOff</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker.shard" title="String">shard</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="Set[akka.actor.ActorRef]" id="akka.contrib.pattern.ShardCoordinator;RebalanceWorker.remaining_=">remaining</a> = <a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker.regions" title="Set[akka.actor.ActorRef]">regions</a>

    <span class="keyword">import</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.scheduleOnce(a2d55b51db)" title="(delay: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">scheduleOnce</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker.handOffTimeout" title="scala.concurrent.duration.FiniteDuration">handOffTimeout</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.ReceiveTimeout" title="akka.actor.ReceiveTimeout.type">ReceiveTimeout</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="=&gt; PartialFunction[Any,Unit]" id="akka.contrib.pattern.ShardCoordinator;RebalanceWorker.receive">receive</a> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.contrib.pattern.ShardCoordinator;RebalanceWorker.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> BeginHandOffAck<span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker.shard" title="String">`shard`</a><span class="delimiter">)</span> ⇒
        <a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker.remaining_=" title="(x$1: Set[akka.actor.ActorRef])Unit">remaining</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-=</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker.remaining_=" title="=&gt; Set[akka.actor.ActorRef]">remaining</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">from</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.HandOff.readResolve" title="(shard: akka.contrib.pattern.ShardRegion.ShardId)akka.contrib.pattern.ShardCoordinator.Internal.HandOff">HandOff</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker.shard" title="String">shard</a><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.become(771101a7b6)" title="(behavior: akka.actor.Actor.Receive, discardOld: Boolean)Unit">become</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker.stoppingShard" title="=&gt; RebalanceWorker.this.Receive">stoppingShard</a>, discardOld = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.ReceiveTimeout" title="akka.actor.ReceiveTimeout.type">ReceiveTimeout</a> ⇒ <a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker.done" title="(ok: Boolean)Unit">done</a><span title="Boolean(true)" class="delimiter">(</span>ok = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; RebalanceWorker.this.Receive" id="akka.contrib.pattern.ShardCoordinator;RebalanceWorker.stoppingShard">stoppingShard</a>: <span title="RebalanceWorker.this.Receive">Receive</span> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.contrib.pattern.ShardCoordinator;RebalanceWorker.stoppingShard;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> ShardStopped<span class="delimiter">(</span><a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern.ShardCoordinator;RebalanceWorker.stoppingShard;$anonfun.isDefinedAt.shard">shard</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker.done" title="(ok: Boolean)Unit">done</a><span title="Boolean(true)" class="delimiter">(</span>ok = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.ReceiveTimeout" title="akka.actor.ReceiveTimeout.type">ReceiveTimeout</a>      ⇒ <a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker.done" title="(ok: Boolean)Unit">done</a><span title="Boolean(true)" class="delimiter">(</span>ok = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(ok: Boolean)Unit" id="akka.contrib.pattern.ShardCoordinator;RebalanceWorker.done">done</a><span class="delimiter">(</span><a title="Boolean" id="akka.contrib.pattern.ShardCoordinator;RebalanceWorker.done.ok">ok</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">parent</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.RebalanceDone.readResolve" title="(shard: akka.contrib.pattern.ShardRegion.ShardId, ok: Boolean)akka.contrib.pattern.ShardCoordinator.RebalanceDone">RebalanceDone</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker.shard" title="String">shard</a>, <a href="#akka.contrib.pattern.ShardCoordinator;RebalanceWorker.done.ok" title="Boolean">ok</a><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Singleton coordinator that decides where to allocate shards.
 *
 * @see [[ClusterSharding$ ClusterSharding extension]]
 */</span>
<span title="AnyRef" class="keyword">class</span> <a title="class ShardCoordinator extends AnyRef with akka.persistence.PersistentActor with akka.actor.ActorLogging" id="akka.contrib.pattern;ShardCoordinator">ShardCoordinator</a><a href="#akka.contrib.pattern;ShardCoordinator" title="akka.contrib.pattern.ShardCoordinator" class="delimiter">(</a><a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern;ShardCoordinator.handOffTimeout">handOffTimeout</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>, <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern;ShardCoordinator.rebalanceInterval">rebalanceInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
                       <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern;ShardCoordinator.snapshotInterval">snapshotInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>, <a title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy" id="akka.contrib.pattern;ShardCoordinator.allocationStrategy">allocationStrategy</a>: ShardCoordinator.<a href="#akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy" title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy">ShardAllocationStrategy</a><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="../../../../persistence-experimental/akka/persistence/Eventsourced.scala.html#akka.persistence;PersistentActor" title="akka.persistence.PersistentActor">PersistentActor</a> <span class="keyword">with</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ShardCoordinator" title="akka.contrib.pattern.ShardCoordinator.type">ShardCoordinator</a>._
  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ShardCoordinator" title="akka.contrib.pattern.ShardCoordinator.type">ShardCoordinator</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal" title="akka.contrib.pattern.ShardCoordinator.Internal.type">Internal</a>._
  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ShardRegion" title="akka.contrib.pattern.ShardRegion.type">ShardRegion</a>.ShardId

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; String" id="akka.contrib.pattern;ShardCoordinator.persistenceId">persistenceId</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.toStringWithoutAddress" title="=&gt; String">toStringWithoutAddress</a>

  <span class="keyword">var</span> <a title="akka.contrib.pattern.ShardCoordinator.Internal.State" id="akka.contrib.pattern;ShardCoordinator.persistentState_=">persistentState</a> = <a href="#akka.contrib.pattern.ShardCoordinator.Internal.State.readResolve" title="akka.contrib.pattern.ShardCoordinator.Internal.State.type">State</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal.State.empty" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">empty</a>
  <span class="keyword">var</span> <a title="scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]" id="akka.contrib.pattern;ShardCoordinator.rebalanceInProgress_=">rebalanceInProgress</a> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.immutable.Set[A]">empty</span><span title="scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]" class="delimiter">[</span><span title="akka.contrib.pattern.ShardRegion.ShardId">ShardId</span><span class="delimiter">]</span>

  <span class="keyword">import</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher
  <span class="keyword">val</span> <a title="akka.actor.Cancellable" id="akka.contrib.pattern;ShardCoordinator.rebalanceTask">rebalanceTask</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.schedule(abf8206fc2)" title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">schedule</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="#akka.contrib.pattern;ShardCoordinator.rebalanceInterval" title="scala.concurrent.duration.FiniteDuration">rebalanceInterval</a>, <a href="#akka.contrib.pattern;ShardCoordinator.rebalanceInterval" title="scala.concurrent.duration.FiniteDuration">rebalanceInterval</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.contrib.pattern.ShardCoordinator.RebalanceTick.readResolve" title="akka.contrib.pattern.ShardCoordinator.RebalanceTick.type">RebalanceTick</a><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="akka.actor.Cancellable" id="akka.contrib.pattern;ShardCoordinator.snapshotTask">snapshotTask</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.schedule(abf8206fc2)" title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">schedule</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="#akka.contrib.pattern;ShardCoordinator.snapshotInterval" title="scala.concurrent.duration.FiniteDuration">snapshotInterval</a>, <a href="#akka.contrib.pattern;ShardCoordinator.snapshotInterval" title="scala.concurrent.duration.FiniteDuration">snapshotInterval</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.contrib.pattern.ShardCoordinator.SnapshotTick.readResolve" title="akka.contrib.pattern.ShardCoordinator.SnapshotTick.type">SnapshotTick</a><span class="delimiter">)</span>

  <span class="comment">// this will be stashed and received when the recovery is completed</span>
  <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">self</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.AfterRecover.readResolve" title="akka.contrib.pattern.ShardCoordinator.AfterRecover.type">AfterRecover</a>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ShardCoordinator.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.contrib.pattern;ShardCoordinator" title="akka.contrib.pattern.ShardCoordinator" class="keyword">super</a>.<a href="../../../../persistence-experimental/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.postStop" title="()Unit">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ShardCoordinator.rebalanceTask" title="=&gt; akka.actor.Cancellable">rebalanceTask</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Cancellable.cancel" title="()Boolean">cancel</a><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; ShardCoordinator.this.Receive" id="akka.contrib.pattern;ShardCoordinator.receiveRecover">receiveRecover</a>: <span title="ShardCoordinator.this.Receive">Receive</span> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.contrib.pattern;ShardCoordinator.receiveRecover;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> <a title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent" id="akka.contrib.pattern;ShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt">evt</a>: <a href="#akka.contrib.pattern.ShardCoordinator.Internal;DomainEvent" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">DomainEvent</a> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;receiveRecover {}&quot;)" class="string">&quot;receiveRecover {}&quot;</span>, <a href="#akka.contrib.pattern;ShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">evt</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> ShardRegionRegistered<span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
          <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="(x$1: akka.contrib.pattern.ShardCoordinator.Internal.State)Unit">persistentState</a> = <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.updated" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent)akka.contrib.pattern.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
        <span class="keyword">case</span> ShardRegionProxyRegistered<span class="delimiter">(</span><span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span> ⇒
          <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="(x$1: akka.contrib.pattern.ShardCoordinator.Internal.State)Unit">persistentState</a> = <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.updated" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent)akka.contrib.pattern.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
        <span class="keyword">case</span> ShardRegionTerminated<span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="(x$1: akka.contrib.pattern.ShardCoordinator.Internal.State)Unit">persistentState</a> = <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.updated" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent)akka.contrib.pattern.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
          <span class="keyword">else</span> <span class="delimiter">{</span>
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span class="string">&quot;ShardRegionTerminated, but region {} was not registered. This inconsistency is due to that &quot;</span> +
              <span class="string">&quot; some stored ActorRef in Akka v2.3.0 and v2.3.1 did not contain full address information. It will be &quot;</span> <span title="String(&quot;ShardRegionTerminated, but region {} was not registered. This inconsistency is due to that  some stored ActorRef in Akka v2.3.0 and v2.3.1 did not contain full address information. It will be removed by later watch.&quot;)">+</span>
              <span class="string">&quot;removed by later watch.&quot;</span>, <span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="keyword">case</span> ShardRegionProxyTerminated<span class="delimiter">(</span><span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span> ⇒
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="(x$1: akka.contrib.pattern.ShardCoordinator.Internal.State)Unit">persistentState</a> = <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.updated" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent)akka.contrib.pattern.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
        <span class="keyword">case</span> ShardHomeAllocated<span class="delimiter">(</span><a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern;ShardCoordinator.receiveRecover;$anonfun.applyOrElse.shard">shard</a>, <span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
          <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="(x$1: akka.contrib.pattern.ShardCoordinator.Internal.State)Unit">persistentState</a> = <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.updated" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent)akka.contrib.pattern.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
        <span class="keyword">case</span> _: <a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeDeallocated.readResolve" title="akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeDeallocated">ShardHomeDeallocated</a> ⇒
          <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="(x$1: akka.contrib.pattern.ShardCoordinator.Internal.State)Unit">persistentState</a> = <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.updated" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent)akka.contrib.pattern.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="keyword">case</span> SnapshotOffer<span class="delimiter">(</span>_, <a title="akka.contrib.pattern.ShardCoordinator.Internal.State" id="akka.contrib.pattern;ShardCoordinator.receiveRecover;$anonfun.isDefinedAt.state">state</a>: <a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.equals" title="akka.contrib.pattern.ShardCoordinator.Internal.State">State</a><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;receiveRecover SnapshotOffer {}&quot;)" class="string">&quot;receiveRecover SnapshotOffer {}&quot;</span>, <a href="#akka.contrib.pattern;ShardCoordinator.receiveRecover;$anonfun.isDefinedAt.state" title="akka.contrib.pattern.ShardCoordinator.Internal.State">state</a><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="(x$1: akka.contrib.pattern.ShardCoordinator.Internal.State)Unit">persistentState</a> = <a href="#akka.contrib.pattern;ShardCoordinator.receiveRecover;$anonfun.isDefinedAt.state" title="akka.contrib.pattern.ShardCoordinator.Internal.State">state</a>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; ShardCoordinator.this.Receive" id="akka.contrib.pattern;ShardCoordinator.receiveCommand">receiveCommand</a>: <span title="ShardCoordinator.this.Receive">Receive</span> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> Register<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.isDefinedAt.region">region</a><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;ShardRegion registered: [{}]&quot;)" class="string">&quot;ShardRegion registered: [{}]&quot;</span>, <span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.RegisterAck.readResolve" title="(coordinator: akka.actor.ActorRef)akka.contrib.pattern.ShardCoordinator.Internal.RegisterAck">RegisterAck</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
      <span class="keyword">else</span>
        <a href="../../../../persistence-experimental/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.persist(aa368cf4a0)" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionRegistered)(handler: akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionRegistered =&gt; Unit)Unit">persist</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionRegistered.readResolve" title="(region: akka.actor.ActorRef)akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionRegistered">ShardRegionRegistered</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionRegistered">evt</span> ⇒
          <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="(x$1: akka.contrib.pattern.ShardCoordinator.Internal.State)Unit">persistentState</a> = <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.updated" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent)akka.contrib.pattern.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionRegistered">evt</span><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.RegisterAck.readResolve" title="(coordinator: akka.actor.ActorRef)akka.contrib.pattern.ShardCoordinator.Internal.RegisterAck">RegisterAck</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

    <span class="keyword">case</span> RegisterProxy<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.isDefinedAt.proxy">proxy</a><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;ShardRegion proxy registered: [{}]&quot;)" class="string">&quot;ShardRegion proxy registered: [{}]&quot;</span>, <a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.isDefinedAt.proxy" title="akka.actor.ActorRef">proxy</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.isDefinedAt.proxy" title="akka.actor.ActorRef">proxy</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.RegisterAck.readResolve" title="(coordinator: akka.actor.ActorRef)akka.contrib.pattern.ShardCoordinator.Internal.RegisterAck">RegisterAck</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
      <span class="keyword">else</span>
        <a href="../../../../persistence-experimental/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.persist(aa368cf4a0)" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyRegistered)(handler: akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyRegistered =&gt; Unit)Unit">persist</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyRegistered.readResolve" title="(regionProxy: akka.actor.ActorRef)akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyRegistered">ShardRegionProxyRegistered</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.isDefinedAt.proxy" title="akka.actor.ActorRef">proxy</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyRegistered">evt</span> ⇒
          <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="(x$1: akka.contrib.pattern.ShardCoordinator.Internal.State)Unit">persistentState</a> = <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.updated" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent)akka.contrib.pattern.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyRegistered">evt</span><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.isDefinedAt.proxy" title="akka.actor.ActorRef">proxy</a><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.RegisterAck.readResolve" title="(coordinator: akka.actor.ActorRef)akka.contrib.pattern.ShardCoordinator.Internal.RegisterAck">RegisterAck</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

    <span class="keyword">case</span> Terminated<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.isDefinedAt.ref">ref</a><span class="delimiter">)</span> ⇒
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;ShardRegion terminated: [{}]&quot;)" class="string">&quot;ShardRegion terminated: [{}]&quot;</span>, <span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span>
        <a href="../../../../persistence-experimental/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.persist(aa368cf4a0)" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionTerminated)(handler: akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionTerminated =&gt; Unit)Unit">persist</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionTerminated.readResolve" title="(region: akka.actor.ActorRef)akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionTerminated">ShardRegionTerminated</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionTerminated">evt</span> ⇒
          <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="(x$1: akka.contrib.pattern.ShardCoordinator.Internal.State)Unit">persistentState</a> = <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.updated" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent)akka.contrib.pattern.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionTerminated">evt</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;ShardRegion proxy terminated: [{}]&quot;)" class="string">&quot;ShardRegion proxy terminated: [{}]&quot;</span>, <span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span>
        <a href="../../../../persistence-experimental/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.persist(aa368cf4a0)" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyTerminated)(handler: akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyTerminated =&gt; Unit)Unit">persist</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyTerminated.readResolve" title="(regionProxy: akka.actor.ActorRef)akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyTerminated">ShardRegionProxyTerminated</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyTerminated">evt</span> ⇒
          <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="(x$1: akka.contrib.pattern.ShardCoordinator.Internal.State)Unit">persistentState</a> = <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.updated" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent)akka.contrib.pattern.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardRegionProxyTerminated">evt</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="keyword">case</span> GetShardHome<span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> ⇒
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.contrib.pattern;ShardCoordinator.rebalanceInProgress_=" title="=&gt; scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]">rebalanceInProgress</a>.<span title="(elem: akka.contrib.pattern.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId)Option[akka.actor.ActorRef]">get</span><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span> ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardHome.readResolve" title="(shard: akka.contrib.pattern.ShardRegion.ShardId, ref: akka.actor.ActorRef)akka.contrib.pattern.ShardCoordinator.Internal.ShardHome">ShardHome</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>, <span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="None.type">None</span> ⇒
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <span title="akka.actor.ActorRef">region</span> = <a href="#akka.contrib.pattern;ShardCoordinator.allocationStrategy" title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy">allocationStrategy</a>.<a href="#akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy.allocateShard" title="(requester: akka.actor.ActorRef, shardId: akka.contrib.pattern.ShardRegion.ShardId, currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]])akka.actor.ActorRef">allocateShard</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>, <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>, <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a><span class="delimiter">)</span>
              <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>,
                <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Allocated region &quot;)">Allocated region $</span><span title="akka.actor.ActorRef">region</span><span title="String(&quot; for shard [&quot;)"> for shard [$</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span title="String(&quot;] must be one of the registered regions: &quot;)">] must be one of the registered regions: $</span><a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
              <a href="../../../../persistence-experimental/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.persist(aa368cf4a0)" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeAllocated)(handler: akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeAllocated =&gt; Unit)Unit">persist</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeAllocated.readResolve" title="(shard: akka.contrib.pattern.ShardRegion.ShardId, region: akka.actor.ActorRef)akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeAllocated">ShardHomeAllocated</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>, <span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeAllocated">evt</span> ⇒
                <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="(x$1: akka.contrib.pattern.ShardCoordinator.Internal.State)Unit">persistentState</a> = <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.updated" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent)akka.contrib.pattern.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeAllocated">evt</span><span class="delimiter">)</span>
                <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Shard [{}] allocated at [{}]&quot;)" class="string">&quot;Shard [{}] allocated at [{}]&quot;</span>, <span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeAllocated">evt</span>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;ShardHomeAllocated.shard" title="=&gt; akka.contrib.pattern.ShardRegion.ShardId">shard</a>, <span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeAllocated">evt</span>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;ShardHomeAllocated.region" title="=&gt; akka.actor.ActorRef">region</a><span class="delimiter">)</span>
                <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardHome.readResolve" title="(shard: akka.contrib.pattern.ShardRegion.ShardId, ref: akka.actor.ActorRef)akka.contrib.pattern.ShardCoordinator.Internal.ShardHome">ShardHome</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeAllocated">evt</span>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;ShardHomeAllocated.shard" title="=&gt; akka.contrib.pattern.ShardRegion.ShardId">shard</a>, <span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeAllocated">evt</span>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;ShardHomeAllocated.region" title="=&gt; akka.actor.ActorRef">region</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="keyword">case</span> <a href="#akka.contrib.pattern.ShardCoordinator.RebalanceTick.readResolve" title="akka.contrib.pattern.ShardCoordinator.RebalanceTick.type">RebalanceTick</a> ⇒
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span>
        <a href="#akka.contrib.pattern;ShardCoordinator.allocationStrategy" title="akka.contrib.pattern.ShardCoordinator.ShardAllocationStrategy">allocationStrategy</a>.<a href="#akka.contrib.pattern.ShardCoordinator;ShardAllocationStrategy.rebalance" title="(currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.contrib.pattern.ShardRegion.ShardId]], rebalanceInProgress: Set[akka.contrib.pattern.ShardRegion.ShardId])Set[akka.contrib.pattern.ShardRegion.ShardId]">rebalance</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>, <a href="#akka.contrib.pattern;ShardCoordinator.rebalanceInProgress_=" title="=&gt; scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]">rebalanceInProgress</a><span class="delimiter">)</span>.<span title="(f: akka.contrib.pattern.ShardRegion.ShardId =&gt; akka.actor.ActorRef)Unit">foreach</span> <span class="delimiter">{</span> <a title="akka.contrib.pattern.ShardRegion.ShardId" id="akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.applyOrElse.$anonfun.shard">shard</a> ⇒
          <a href="#akka.contrib.pattern;ShardCoordinator.rebalanceInProgress_=" title="(x$1: scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId])Unit">rebalanceInProgress</a> <span title="(elem: akka.contrib.pattern.ShardRegion.ShardId)scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]">+=</span> <a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.applyOrElse.$anonfun.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a>
          <span class="keyword">val</span> <a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.applyOrElse.$anonfun.rebalanceFromRegion">rebalanceFromRegion</a> = <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$1" title="(key: akka.contrib.pattern.ShardRegion.ShardId)akka.actor.ActorRef">shards</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.applyOrElse.$anonfun.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Rebalance shard [{}] from [{}]&quot;)" class="string">&quot;Rebalance shard [{}] from [{}]&quot;</span>, <a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.applyOrElse.$anonfun.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a>, <a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.applyOrElse.$anonfun.rebalanceFromRegion" title="akka.actor.ActorRef">rebalanceFromRegion</a><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(59f1e43182)" title="(props: akka.actor.Props)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.contrib.pattern.ShardCoordinator.RebalanceWorker](classOf[akka.contrib.pattern.ShardCoordinator$$RebalanceWorker])" class="delimiter">[</span>RebalanceWorker<span class="delimiter">]</span>, <a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.applyOrElse.$anonfun.shard" title="akka.contrib.pattern.ShardRegion.ShardId">shard</a>, <a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.applyOrElse.$anonfun.rebalanceFromRegion" title="akka.actor.ActorRef">rebalanceFromRegion</a>, <a href="#akka.contrib.pattern;ShardCoordinator.handOffTimeout" title="scala.concurrent.duration.FiniteDuration">handOffTimeout</a>,
            <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="=&gt; scala.collection.immutable.Set[akka.actor.ActorRef]">keySet</span> <span title="(elems: scala.collection.GenTraversableOnce[akka.actor.ActorRef])scala.collection.immutable.Set[akka.actor.ActorRef]">++</span> <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

    <span class="keyword">case</span> RebalanceDone<span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>, <a title="Boolean" id="akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.isDefinedAt.ok">ok</a><span class="delimiter">)</span> ⇒
      <a href="#akka.contrib.pattern;ShardCoordinator.rebalanceInProgress_=" title="(x$1: scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId])Unit">rebalanceInProgress</a> <span title="(elem: akka.contrib.pattern.ShardRegion.ShardId)scala.collection.immutable.Set[akka.contrib.pattern.ShardRegion.ShardId]">-=</span> <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Rebalance shard [{}] done [{}]&quot;)" class="string">&quot;Rebalance shard [{}] done [{}]&quot;</span>, <span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span>, <a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.isDefinedAt.ok" title="Boolean">ok</a><span class="delimiter">)</span>
      <span class="comment">// The shard could have been removed by ShardRegionTerminated</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.isDefinedAt.ok" title="Boolean">ok</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.contrib.pattern.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.contrib.pattern.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="../../../../persistence-experimental/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.persist(aa368cf4a0)" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeDeallocated)(handler: akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeDeallocated =&gt; Unit)Unit">persist</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeDeallocated.readResolve" title="(shard: akka.contrib.pattern.ShardRegion.ShardId)akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeDeallocated">ShardHomeDeallocated</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeDeallocated">evt</span> ⇒
          <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="(x$1: akka.contrib.pattern.ShardCoordinator.Internal.State)Unit">persistentState</a> = <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.updated" title="(event: akka.contrib.pattern.ShardCoordinator.Internal.DomainEvent)akka.contrib.pattern.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeDeallocated">evt</span><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Shard [{}] deallocated&quot;)" class="string">&quot;Shard [{}] deallocated&quot;</span>, <span title="akka.contrib.pattern.ShardCoordinator.Internal.ShardHomeDeallocated">evt</span>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;ShardHomeDeallocated.shard" title="=&gt; akka.contrib.pattern.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

    <span class="keyword">case</span> <a href="#akka.contrib.pattern.ShardCoordinator.SnapshotTick.readResolve" title="akka.contrib.pattern.ShardCoordinator.SnapshotTick.type">SnapshotTick</a> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Saving persistent snapshot&quot;)" class="string">&quot;Saving persistent snapshot&quot;</span><span class="delimiter">)</span>
      <a href="../../../../persistence-experimental/akka/persistence/Snapshotter.scala.html#akka.persistence;Snapshotter.saveSnapshot" title="(snapshot: Any)Unit">saveSnapshot</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a><span class="delimiter">)</span>

    <span class="keyword">case</span> SaveSnapshotSuccess<span class="delimiter">(</span>_<span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span title="Boolean(true)" class="delimiter">(</span><span title="String(&quot;Persistent snapshot saved successfully&quot;)" class="string">&quot;Persistent snapshot saved successfully&quot;</span><span class="delimiter">)</span>

    <span class="keyword">case</span> SaveSnapshotFailure<span class="delimiter">(</span>_, <a title="Throwable" id="akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.isDefinedAt.reason">reason</a><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.warning(dc73c33c91)" title="(template: String, arg1: Any)Unit">warning</a><span title="Boolean(true)" class="delimiter">(</span><span title="String(&quot;Persistent snapshot failure: {}&quot;)" class="string">&quot;Persistent snapshot failure: {}&quot;</span>, <a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.isDefinedAt.reason" title="Throwable">reason</a>.<span title="()String">getMessage</span><span class="delimiter">)</span>

    <span class="keyword">case</span> <a href="#akka.contrib.pattern.ShardCoordinator.AfterRecover.readResolve" title="akka.contrib.pattern.ShardCoordinator.AfterRecover.type">AfterRecover</a> ⇒
      <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a>.<span title="(f: akka.actor.ActorRef =&gt; akka.actor.ActorRef)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ShardCoordinator.persistentState_=" title="=&gt; akka.contrib.pattern.ShardCoordinator.Internal.State">persistentState</a>.<a href="#akka.contrib.pattern.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.contrib.pattern.ShardRegion.ShardId]]">regions</a>.<span title="(f: ((akka.actor.ActorRef, Vector[akka.contrib.pattern.ShardRegion.ShardId])) =&gt; akka.actor.ActorRef)Unit">foreach</span> <a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.applyOrElse.$anonfun.x0$8" title="akka.actor.ActorRef" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.applyOrElse.$anonfun.a">a</a>, _<span class="delimiter">)</span> ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ShardCoordinator.receiveCommand;$anonfun.applyOrElse.$anonfun.a" title="akka.actor.ActorRef">a</a><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="delimiter">}</span>

<span class="delimiter">}</span>


        </pre>
    </body>
</html>
