<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>file-mailbox/akka/actor/mailbox/filebased/FileBasedMailbox.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

<span class="keyword">package</span> akka.actor.mailbox.filebased

<span class="keyword">import</span> akka.actor.mailbox._
<span class="keyword">import</span> akka.actor.<span class="delimiter">{</span> ActorContext, ActorRef, ActorSystem, ExtendedActorSystem <span class="delimiter">}</span>
<span class="keyword">import</span> akka.event.Logging
<span class="keyword">import</span> com.typesafe.config.Config
<span class="keyword">import</span> akka.ConfigurationException
<span class="keyword">import</span> akka.dispatch._
<span class="keyword">import</span> scala.util.control.NonFatal
<span class="keyword">import</span> akka.pattern.<span class="delimiter">{</span> CircuitBreakerOpenException, CircuitBreaker <span class="delimiter">}</span>
<span class="keyword">import</span> scala.concurrent.duration.Duration

@deprecated<span class="delimiter">(</span><span class="string">&quot;durable mailboxes are superseded by akka-persistence&quot;</span>, <span class="string">&quot;2.3&quot;</span><span class="delimiter">)</span>
<span class="keyword">class</span> <a title="class FileBasedMailboxType extends AnyRef with akka.dispatch.MailboxType" id="akka.actor.mailbox.filebased;FileBasedMailboxType">FileBasedMailboxType</a><a href="#akka.actor.mailbox.filebased;FileBasedMailboxType" title="akka.actor.mailbox.filebased.FileBasedMailboxType" class="delimiter">(</a><a title="akka.actor.ActorSystem.Settings" id="akka.actor.mailbox.filebased;FileBasedMailboxType.systemSettings">systemSettings</a>: ActorSystem.<a href="../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor.ActorSystem;Settings" title="akka.actor.ActorSystem.Settings">Settings</a>, <a title="com.typesafe.config.Config" id="akka.actor.mailbox.filebased;FileBasedMailboxType.config">config</a>: <span title="com.typesafe.config.Config">Config</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../../actor/akka/dispatch/Mailbox.scala.html#akka.dispatch;MailboxType" title="akka.dispatch.MailboxType">MailboxType</a> <span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="akka.actor.mailbox.filebased.FileBasedMailboxSettings" id="akka.actor.mailbox.filebased;FileBasedMailboxType.settings">settings</a> = <span title="akka.actor.mailbox.filebased.FileBasedMailboxSettings" class="keyword">new</span> <a href="FileBasedMailboxSettings.scala.html#akka.actor.mailbox.filebased;FileBasedMailboxSettings" title="akka.actor.mailbox.filebased.FileBasedMailboxSettings">FileBasedMailboxSettings</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased;FileBasedMailboxType.systemSettings" title="akka.actor.ActorSystem.Settings">systemSettings</a>, <a href="#akka.actor.mailbox.filebased;FileBasedMailboxType.config" title="com.typesafe.config.Config">config</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(owner: Option[akka.actor.ActorRef], system: Option[akka.actor.ActorSystem])akka.dispatch.MessageQueue" id="akka.actor.mailbox.filebased;FileBasedMailboxType.create">create</a><span class="delimiter">(</span><a title="Option[akka.actor.ActorRef]" id="akka.actor.mailbox.filebased;FileBasedMailboxType.create.owner">owner</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span>, <a title="Option[akka.actor.ActorSystem]" id="akka.actor.mailbox.filebased;FileBasedMailboxType.create.system">system</a>: <span title="Option[akka.actor.ActorSystem]">Option</span><span class="delimiter">[</span>ActorSystem<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../../actor/akka/dispatch/Mailbox.scala.html#akka.dispatch;MessageQueue" title="akka.dispatch.MessageQueue">MessageQueue</a> = <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased;FileBasedMailboxType.create.owner" title="(xo: Option[akka.actor.ActorRef])Iterable[akka.actor.ActorRef]">owner</a> <span title="(that: scala.collection.GenIterable[akka.actor.ActorSystem])(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[akka.actor.ActorRef],(akka.actor.ActorRef, akka.actor.ActorSystem),Iterable[(akka.actor.ActorRef, akka.actor.ActorSystem)]])Iterable[(akka.actor.ActorRef, akka.actor.ActorSystem)]">zip</span> <a href="#akka.actor.mailbox.filebased;FileBasedMailboxType.create.system" title="(xo: Option[akka.actor.ActorSystem])Iterable[akka.actor.ActorSystem]">system</a><span class="delimiter">)</span>.<span title="=&gt; Option[(akka.actor.ActorRef, akka.actor.ActorSystem)]">headOption</span> <span title="akka.dispatch.MessageQueue" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> Some<span class="delimiter">(</span><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.mailbox.filebased;FileBasedMailboxType.create.o">o</a>, <a title="akka.actor.ExtendedActorSystem" id="akka.actor.mailbox.filebased;FileBasedMailboxType.create.s">s</a>: <a href="../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ExtendedActorSystem" title="akka.actor.ExtendedActorSystem">ExtendedActorSystem</a><span class="delimiter">)</span><span class="delimiter">)</span> ⇒ <span title="akka.actor.mailbox.filebased.FileBasedMessageQueue" class="keyword">new</span> <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue" title="akka.actor.mailbox.filebased.FileBasedMessageQueue">FileBasedMessageQueue</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased;FileBasedMailboxType.create.o" title="akka.actor.ActorRef">o</a>, <a href="#akka.actor.mailbox.filebased;FileBasedMailboxType.create.s" title="akka.actor.ExtendedActorSystem">s</a>, <a href="#akka.actor.mailbox.filebased;FileBasedMailboxType.settings" title="=&gt; akka.actor.mailbox.filebased.FileBasedMailboxSettings">settings</a><span class="delimiter">)</span>
    <span class="keyword">case</span> _                                 ⇒ <span title="Nothing" class="keyword">throw</span> <a href="../../../../../actor/akka/AkkaException.scala.html#akka;ConfigurationException.<init>(3b0f220dea)" title="(msg: String)akka.ConfigurationException" class="keyword">new</a> <a href="../../../../../actor/akka/AkkaException.scala.html#akka;ConfigurationException" title="akka.ConfigurationException">ConfigurationException</a><span class="delimiter">(</span><span title="String(&quot;creating a durable mailbox requires an owner (i.e. does not work with BalancingDispatcher)&quot;)" class="string">&quot;creating a durable mailbox requires an owner (i.e. does not work with BalancingDispatcher)&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

@deprecated<span class="delimiter">(</span><span class="string">&quot;durable mailboxes are superseded by akka-persistence&quot;</span>, <span class="string">&quot;2.3&quot;</span><span class="delimiter">)</span>
<span class="keyword">class</span> <a title="class FileBasedMessageQueue extends akka.actor.mailbox.DurableMessageQueue with akka.actor.mailbox.DurableMessageSerialization" id="akka.actor.mailbox.filebased;FileBasedMessageQueue">FileBasedMessageQueue</a><a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue" title="akka.actor.mailbox.filebased.FileBasedMessageQueue" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.actor.mailbox.filebased;FileBasedMessageQueue._owner">_owner</a>: <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.actor.ExtendedActorSystem" id="akka.actor.mailbox.filebased;FileBasedMessageQueue._system">_system</a>: <a href="../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ExtendedActorSystem" title="akka.actor.ExtendedActorSystem">ExtendedActorSystem</a>, <span class="keyword">val</span> <a title="akka.actor.mailbox.filebased.FileBasedMailboxSettings" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.settings">settings</a>: <a href="FileBasedMailboxSettings.scala.html#akka.actor.mailbox.filebased;FileBasedMailboxSettings" title="akka.actor.mailbox.filebased.FileBasedMailboxSettings">FileBasedMailboxSettings</a><span class="delimiter">)</span>
  <span class="keyword">extends</span> <span title="akka.actor.mailbox.DurableMessageQueue">DurableMessageQueue</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue._owner" title="akka.actor.ActorRef">_owner</a>, <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue._system" title="akka.actor.ExtendedActorSystem">_system</a><span class="delimiter">)</span> <span class="keyword">with</span> <span title="akka.actor.mailbox.DurableMessageSerialization">DurableMessageSerialization</span> <span class="delimiter">{</span>
  <span class="comment">// TODO Is it reasonable for all FileBasedMailboxes to have their own logger?</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="akka.event.LoggingAdapter" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.log">log</a> = <a href="../../../../../actor/akka/event/Logging.scala.html#akka.event.Logging.apply(882ba4a885)" title="(system: akka.actor.ActorSystem, logSource: String)(implicit evidence$3: akka.event.LogSource[String])akka.event.LoggingAdapter">Logging</a><a href="../../../../../actor/akka/event/Logging.scala.html#akka.event.LogSource.fromString" title="=&gt; akka.event.LogSource[String]" class="delimiter">(</a><a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue" title="=&gt; akka.actor.ExtendedActorSystem">system</a>, <span title="String(&quot;FileBasedMessageQueue&quot;)" class="string">&quot;FileBasedMessageQueue&quot;</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="akka.pattern.CircuitBreaker" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.breaker">breaker</a> = <a href="../../../../../actor/akka/pattern/CircuitBreaker.scala.html#akka.pattern.CircuitBreaker.apply" title="(scheduler: akka.actor.Scheduler, maxFailures: Int, callTimeout: scala.concurrent.duration.FiniteDuration, resetTimeout: scala.concurrent.duration.FiniteDuration)akka.pattern.CircuitBreaker">CircuitBreaker</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue" title="=&gt; akka.actor.ExtendedActorSystem">system</a>.<a href="../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>, <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.settings" title="=&gt; akka.actor.mailbox.filebased.FileBasedMailboxSettings">settings</a>.<a href="FileBasedMailboxSettings.scala.html#akka.actor.mailbox.filebased;FileBasedMailboxSettings.CircuitBreakerMaxFailures" title="=&gt; Int">CircuitBreakerMaxFailures</a>, <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.settings" title="=&gt; akka.actor.mailbox.filebased.FileBasedMailboxSettings">settings</a>.<a href="FileBasedMailboxSettings.scala.html#akka.actor.mailbox.filebased;FileBasedMailboxSettings.CircuitBreakerCallTimeout" title="=&gt; scala.concurrent.duration.FiniteDuration">CircuitBreakerCallTimeout</a>, <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.settings" title="=&gt; akka.actor.mailbox.filebased.FileBasedMailboxSettings">settings</a>.<a href="FileBasedMailboxSettings.scala.html#akka.actor.mailbox.filebased;FileBasedMailboxSettings.CircuitBreakerResetTimeout" title="=&gt; scala.concurrent.duration.FiniteDuration">CircuitBreakerResetTimeout</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="akka.actor.mailbox.filebased.filequeue.PersistentQueue" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.queue">queue</a> = <span class="keyword">try</span> <span class="delimiter">{</span>
    <span class="delimiter">(</span><span title="java.io.File" class="keyword">new</span> java.io.<span title="java.io.File">File</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.settings" title="=&gt; akka.actor.mailbox.filebased.FileBasedMailboxSettings">settings</a>.<a href="FileBasedMailboxSettings.scala.html#akka.actor.mailbox.filebased;FileBasedMailboxSettings.QueuePath" title="=&gt; String">QueuePath</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="java.io.File">dir</span> <span class="keyword">if</span> <span title="java.io.File">dir</span>.<span title="()Boolean">exists</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><span title="java.io.File">dir</span>.<span title="()Boolean">isDirectory</span> ⇒ <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IllegalStateException" class="keyword">new</span> <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;Path already occupied by non-directory &quot;)" class="string">&quot;Path already occupied by non-directory &quot;</span> <span title="(x$1: Any)String">+</span> <span title="java.io.File">dir</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="java.io.File">dir</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><span title="java.io.File">dir</span>.<span title="()Boolean">exists</span>                    ⇒ <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><span title="java.io.File">dir</span>.<span title="()Boolean">mkdirs</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><span title="java.io.File">dir</span>.<span title="()Boolean">isDirectory</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IllegalStateException" class="keyword">new</span> <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;Creation of directory failed &quot;)" class="string">&quot;Creation of directory failed &quot;</span> <span title="(x$1: Any)String">+</span> <span title="java.io.File">dir</span><span class="delimiter">)</span>
      <span class="keyword">case</span> _                                     ⇒ <span class="comment">// All good</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="akka.actor.mailbox.filebased.filequeue.PersistentQueue" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.queue.queue">queue</a> = <span title="akka.actor.mailbox.filebased.filequeue.PersistentQueue" class="keyword">new</span> filequeue.<a href="filequeue/PersistentQueue.scala.html#akka.actor.mailbox.filebased.filequeue;PersistentQueue" title="akka.actor.mailbox.filebased.filequeue.PersistentQueue">PersistentQueue</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.settings" title="=&gt; akka.actor.mailbox.filebased.FileBasedMailboxSettings">settings</a>.<a href="FileBasedMailboxSettings.scala.html#akka.actor.mailbox.filebased;FileBasedMailboxSettings.QueuePath" title="=&gt; String">QueuePath</a>, <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue" title="=&gt; String">name</a>, <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.settings" title="=&gt; akka.actor.mailbox.filebased.FileBasedMailboxSettings">settings</a>, <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.log" title="=&gt; akka.event.LoggingAdapter">log</a><span class="delimiter">)</span>
    <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.queue.queue" title="akka.actor.mailbox.filebased.filequeue.PersistentQueue">queue</a>.<a href="filequeue/PersistentQueue.scala.html#akka.actor.mailbox.filebased.filequeue;PersistentQueue.setup" title="()Unit">setup</a> <span class="comment">// replays journal</span>
    <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.queue.queue" title="akka.actor.mailbox.filebased.filequeue.PersistentQueue">queue</a>.<a href="filequeue/PersistentQueue.scala.html#akka.actor.mailbox.filebased.filequeue;PersistentQueue.discardExpired" title="()Int">discardExpired</a>
    <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.queue.queue" title="akka.actor.mailbox.filebased.filequeue.PersistentQueue">queue</a>
  <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.queue.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.queue.e">e</a><span class="delimiter">)</span> ⇒
      <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.error(de736aeaab)" title="(cause: Throwable, message: String)Unit">error</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.queue.e" title="Throwable">e</a>, <span title="String(&quot;Could not create a file-based mailbox&quot;)" class="string">&quot;Could not create a file-based mailbox&quot;</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.queue.e" title="Throwable">e</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(receiver: akka.actor.ActorRef, envelope: akka.dispatch.Envelope)Unit" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.enqueue">enqueue</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.enqueue.receiver">receiver</a>: <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.dispatch.Envelope" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.enqueue.envelope">envelope</a>: <a href="../../../../../actor/akka/dispatch/AbstractDispatcher.scala.html#akka.dispatch;Envelope" title="akka.dispatch.Envelope">Envelope</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.breaker" title="=&gt; akka.pattern.CircuitBreaker">breaker</a>.<a href="../../../../../actor/akka/pattern/CircuitBreaker.scala.html#akka.pattern;CircuitBreaker.withSyncCircuitBreaker" title="(body: =&gt; Boolean)Boolean">withSyncCircuitBreaker</a><span title="Unit" class="delimiter">(</span><a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.queue" title="=&gt; akka.actor.mailbox.filebased.filequeue.PersistentQueue">queue</a>.<a href="filequeue/PersistentQueue.scala.html#akka.actor.mailbox.filebased.filequeue;PersistentQueue.add(a9c891b9d7)" title="(value: Array[Byte])Boolean">add</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue" title="(durableMessage: akka.dispatch.Envelope)Array[Byte]">serialize</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.enqueue.envelope" title="akka.dispatch.Envelope">envelope</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()akka.dispatch.Envelope" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.dequeue">dequeue</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../../../../actor/akka/dispatch/AbstractDispatcher.scala.html#akka.dispatch;Envelope" title="akka.dispatch.Envelope">Envelope</a> = <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.breaker" title="=&gt; akka.pattern.CircuitBreaker">breaker</a>.<a href="../../../../../actor/akka/pattern/CircuitBreaker.scala.html#akka.pattern;CircuitBreaker.withSyncCircuitBreaker" title="(body: =&gt; akka.dispatch.Envelope)akka.dispatch.Envelope">withSyncCircuitBreaker</a><span class="delimiter">(</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.queue" title="=&gt; akka.actor.mailbox.filebased.filequeue.PersistentQueue">queue</a>.<a href="filequeue/PersistentQueue.scala.html#akka.actor.mailbox.filebased.filequeue;PersistentQueue.remove(9f103a3f28)" title="()Option[akka.actor.mailbox.filebased.filequeue.QItem]">remove</a>.<span title="(f: akka.actor.mailbox.filebased.filequeue.QItem =&gt; akka.dispatch.Envelope)Option[akka.dispatch.Envelope]">map</span><span class="delimiter">(</span><a title="akka.actor.mailbox.filebased.filequeue.QItem" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.dequeue.$anonfun.item">item</a> ⇒ <span class="delimiter">{</span> <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.queue" title="=&gt; akka.actor.mailbox.filebased.filequeue.PersistentQueue">queue</a>.<a href="filequeue/PersistentQueue.scala.html#akka.actor.mailbox.filebased.filequeue;PersistentQueue.confirmRemove" title="(xid: Int)Unit">confirmRemove</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.dequeue.$anonfun.item" title="akka.actor.mailbox.filebased.filequeue.QItem">item</a>.<a href="filequeue/QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem.xid" title="=&gt; Int">xid</a><span class="delimiter">)</span>; <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue" title="(bytes: Array[Byte])akka.dispatch.Envelope">deserialize</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.dequeue.$anonfun.item" title="akka.actor.mailbox.filebased.filequeue.QItem">item</a>.<a href="filequeue/QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem.data" title="=&gt; Array[Byte]">data</a><span class="delimiter">)</span> <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="(implicit ev: &lt;:&lt;[Null,akka.dispatch.Envelope])akka.dispatch.Envelope">orNull</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> _: java.util.<span title="java.util.NoSuchElementException">NoSuchElementException</span> ⇒ <span title="Null(null)" class="keyword">null</span>
        <span class="keyword">case</span> <span title="akka.pattern.CircuitBreakerOpenException">e</span>: <a href="../../../../../actor/akka/pattern/CircuitBreaker.scala.html#akka.pattern;CircuitBreakerOpenException" title="akka.pattern.CircuitBreakerOpenException">CircuitBreakerOpenException</a> ⇒
          <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="akka.pattern.CircuitBreakerOpenException">e</span>.<span title="()String">getMessage</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">throw</span> <span title="akka.pattern.CircuitBreakerOpenException">e</span>
        <span class="keyword">case</span> <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.dequeue.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><span title="Throwable">e</span><span class="delimiter">)</span> ⇒
          <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.error(134e35740d)" title="(cause: Throwable, template: String, arg1: Any)Unit">error</a><span class="delimiter">(</span><span title="Throwable">e</span>, <span title="String(&quot;Couldn\'t dequeue from file-based mailbox, due to [{}]&quot;)" class="string">&quot;Couldn't dequeue from file-based mailbox, due to [{}]&quot;</span>, <span title="Throwable">e</span>.<span title="()String">getMessage</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">throw</span> <span title="Throwable">e</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Int" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.numberOfMessages">numberOfMessages</a>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.breaker" title="=&gt; akka.pattern.CircuitBreaker">breaker</a>.<a href="../../../../../actor/akka/pattern/CircuitBreaker.scala.html#akka.pattern;CircuitBreaker.withSyncCircuitBreaker" title="(body: =&gt; Int)Int">withSyncCircuitBreaker</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.queue" title="=&gt; akka.actor.mailbox.filebased.filequeue.PersistentQueue">queue</a>.<a href="filequeue/PersistentQueue.scala.html#akka.actor.mailbox.filebased.filequeue;PersistentQueue.length" title="=&gt; Long">length</a>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.hasMessages">hasMessages</a>: <span title="Boolean">Boolean</span> = <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.numberOfMessages" title="=&gt; Int">numberOfMessages</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span>

  <span class="comment">/**
   * Completely delete the queue.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.remove">remove</a>: <span title="Boolean">Boolean</span> = <span class="keyword">try</span> <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.queue" title="=&gt; akka.actor.mailbox.filebased.filequeue.PersistentQueue">queue</a>.<a href="filequeue/PersistentQueue.scala.html#akka.actor.mailbox.filebased.filequeue;PersistentQueue.remove(9f103a3f28)" title="()Option[akka.actor.mailbox.filebased.filequeue.QItem]">remove</a>
    <span title="Boolean(true)" class="keyword">true</span>
  <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#akka.actor.mailbox.filebased;FileBasedMessageQueue.remove.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span>_<span class="delimiter">)</span> ⇒ <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(owner: akka.actor.ActorRef, deadLetters: akka.dispatch.MessageQueue)Unit" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.cleanUp">cleanUp</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.cleanUp.owner">owner</a>: <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.dispatch.MessageQueue" id="akka.actor.mailbox.filebased;FileBasedMessageQueue.cleanUp.deadLetters">deadLetters</a>: <a href="../../../../../actor/akka/dispatch/Mailbox.scala.html#akka.dispatch;MessageQueue" title="akka.dispatch.MessageQueue">MessageQueue</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
