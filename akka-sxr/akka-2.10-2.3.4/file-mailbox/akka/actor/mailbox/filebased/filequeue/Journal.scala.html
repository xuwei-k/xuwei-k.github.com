<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>file-mailbox/akka/actor/mailbox/filebased/filequeue/Journal.scala</title>
        <script type="text/javascript" src="../../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright 2009 Twitter, Inc.
 * Copyright 2009 Robey Pointer &lt;robeypointer@gmail.com&gt;
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may
 * not use this file except in compliance with the License. You may obtain
 * a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> akka.actor.mailbox.filebased.filequeue

<span class="keyword">import</span> java.io._
<span class="keyword">import</span> java.nio.<span class="delimiter">{</span> ByteBuffer, ByteOrder <span class="delimiter">}</span>
<span class="keyword">import</span> java.nio.channels.FileChannel
<span class="keyword">import</span> akka.event.LoggingAdapter
<span class="keyword">import</span> scala.util.control.NonFatal

<span class="comment">// returned from journal replay</span>
<span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait JournalItem extends AnyRef" id="akka.actor.mailbox.filebased.filequeue;JournalItem">JournalItem</a>
@deprecated<span class="delimiter">(</span><span class="string">&quot;durable mailboxes are superseded by akka-persistence&quot;</span>, <span class="string">&quot;2.3&quot;</span><span class="delimiter">)</span>
<span class="keyword">object</span> <a title="akka.actor.mailbox.filebased.filequeue.JournalItem.type" id="akka.actor.mailbox.filebased.filequeue.JournalItem">JournalItem</a> <a href="#akka.actor.mailbox.filebased.filequeue.JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem.type" class="delimiter">{</a>
  <span class="keyword">case class</span> <a title="class Add extends AnyRef with akka.actor.mailbox.filebased.filequeue.JournalItem with Product with Serializable" id="akka.actor.mailbox.filebased.filequeue.JournalItem.Add.readResolve">Add</a><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.Add.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.mailbox.filebased.filequeue.QItem" id="akka.actor.mailbox.filebased.filequeue.JournalItem;Add.item">item</a>: <a href="QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem" title="akka.actor.mailbox.filebased.filequeue.QItem">QItem</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.actor.mailbox.filebased.filequeue;JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem">JournalItem</a>
  <span class="keyword">case object</span> <a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.Remove.productElement.x$1" title="akka.actor.mailbox.filebased.filequeue.JournalItem.Remove.type" id="akka.actor.mailbox.filebased.filequeue.JournalItem.Remove.readResolve">Remove</a> <span title="Product" class="keyword">extends</span> <a href="#akka.actor.mailbox.filebased.filequeue;JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem">JournalItem</a>
  <span class="keyword">case object</span> <a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.RemoveTentative.productElement.x$1" title="akka.actor.mailbox.filebased.filequeue.JournalItem.RemoveTentative.type" id="akka.actor.mailbox.filebased.filequeue.JournalItem.RemoveTentative.readResolve">RemoveTentative</a> <span title="Product" class="keyword">extends</span> <a href="#akka.actor.mailbox.filebased.filequeue;JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem">JournalItem</a>
  <span class="keyword">case class</span> <a title="class SavedXid extends AnyRef with akka.actor.mailbox.filebased.filequeue.JournalItem with Product with Serializable" id="akka.actor.mailbox.filebased.filequeue.JournalItem.SavedXid.readResolve">SavedXid</a><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.SavedXid.readResolve" title="Product" class="delimiter">(</a><a title="Int" id="akka.actor.mailbox.filebased.filequeue.JournalItem;SavedXid.xid">xid</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.actor.mailbox.filebased.filequeue;JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem">JournalItem</a>
  <span class="keyword">case class</span> <a title="class Unremove extends AnyRef with akka.actor.mailbox.filebased.filequeue.JournalItem with Product with Serializable" id="akka.actor.mailbox.filebased.filequeue.JournalItem.Unremove.readResolve">Unremove</a><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.Unremove.readResolve" title="Product" class="delimiter">(</a><a title="Int" id="akka.actor.mailbox.filebased.filequeue.JournalItem;Unremove.xid">xid</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.actor.mailbox.filebased.filequeue;JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem">JournalItem</a>
  <span class="keyword">case class</span> <a title="class ConfirmRemove extends AnyRef with akka.actor.mailbox.filebased.filequeue.JournalItem with Product with Serializable" id="akka.actor.mailbox.filebased.filequeue.JournalItem.ConfirmRemove.readResolve">ConfirmRemove</a><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.ConfirmRemove.readResolve" title="Product" class="delimiter">(</a><a title="Int" id="akka.actor.mailbox.filebased.filequeue.JournalItem;ConfirmRemove.xid">xid</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.actor.mailbox.filebased.filequeue;JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem">JournalItem</a>
  <span class="keyword">case object</span> <a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.EndOfFile.productElement.x$1" title="akka.actor.mailbox.filebased.filequeue.JournalItem.EndOfFile.type" id="akka.actor.mailbox.filebased.filequeue.JournalItem.EndOfFile.readResolve">EndOfFile</a> <span title="Product" class="keyword">extends</span> <a href="#akka.actor.mailbox.filebased.filequeue;JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem">JournalItem</a>
<span class="delimiter">}</span>

<span class="comment">/**
 * Codes for working with the journal file for a PersistentQueue.
 */</span>
@deprecated<span class="delimiter">(</span><span class="string">&quot;durable mailboxes are superseded by akka-persistence&quot;</span>, <span class="string">&quot;2.3&quot;</span><span class="delimiter">)</span>
<span class="keyword">class</span> <a title="class Journal extends AnyRef" id="akka.actor.mailbox.filebased.filequeue;Journal">Journal</a><a href="#akka.actor.mailbox.filebased.filequeue;Journal" title="akka.actor.mailbox.filebased.filequeue.Journal" class="delimiter">(</a><a title="String" id="akka.actor.mailbox.filebased.filequeue;Journal.queuePath">queuePath</a>: <span title="String">String</span>, <a title="=&gt; Boolean" id="akka.actor.mailbox.filebased.filequeue;Journal.syncJournal">syncJournal</a>: ⇒ Boolean, <a title="akka.event.LoggingAdapter" id="akka.actor.mailbox.filebased.filequeue;Journal.log">log</a>: <a href="../../../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter" title="akka.event.LoggingAdapter">LoggingAdapter</a><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.io.File" id="akka.actor.mailbox.filebased.filequeue;Journal.queueFile">queueFile</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.queuePath" title="String">queuePath</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="java.nio.channels.FileChannel" id="akka.actor.mailbox.filebased.filequeue;Journal.writer_=">writer</a>: <span title="java.nio.channels.FileChannel">FileChannel</span> = <span title="Null(null)" class="keyword">null</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[java.nio.channels.FileChannel]" id="akka.actor.mailbox.filebased.filequeue;Journal.reader_=">reader</a>: <span title="Option[java.nio.channels.FileChannel]">Option</span><span class="delimiter">[</span>FileChannel<span class="delimiter">]</span> = <span title="None.type">None</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[java.nio.channels.FileChannel]" id="akka.actor.mailbox.filebased.filequeue;Journal.replayer_=">replayer</a>: <span title="Option[java.nio.channels.FileChannel]">Option</span><span class="delimiter">[</span>FileChannel<span class="delimiter">]</span> = <span title="None.type">None</span>

  <span class="keyword">var</span> <a title="Long" id="akka.actor.mailbox.filebased.filequeue;Journal.size_=">size</a>: <span title="Long">Long</span> = <span title="Long(0L)" class="int">0</span>

  <span class="comment">// small temporary buffer for formatting operations into the journal:</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Array[Byte]" id="akka.actor.mailbox.filebased.filequeue;Journal.buffer">buffer</a> = <span title="Array[Byte]" class="keyword">new</span> <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(16)" class="int">16</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.nio.ByteBuffer" id="akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer">byteBuffer</a> = <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Array[Byte])java.nio.ByteBuffer">wrap</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.buffer" title="=&gt; Array[Byte]">buffer</a><span class="delimiter">)</span>
  <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="(x$1: java.nio.ByteOrder)java.nio.ByteBuffer">order</span><span class="delimiter">(</span><span title="java.nio.ByteOrder.type">ByteOrder</span>.<span title="java.nio.ByteOrder">LITTLE_ENDIAN</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.CMD_ADD">CMD_ADD</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.CMD_REMOVE">CMD_REMOVE</a> = <span title="Int(1)" class="int">1</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.CMD_ADDX">CMD_ADDX</a> = <span title="Int(2)" class="int">2</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.CMD_REMOVE_TENTATIVE">CMD_REMOVE_TENTATIVE</a> = <span title="Int(3)" class="int">3</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.CMD_SAVE_XID">CMD_SAVE_XID</a> = <span title="Int(4)" class="int">4</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.CMD_UNREMOVE">CMD_UNREMOVE</a> = <span title="Int(5)" class="int">5</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.CMD_CONFIRM_REMOVE">CMD_CONFIRM_REMOVE</a> = <span title="Int(6)" class="int">6</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.CMD_ADD_XID">CMD_ADD_XID</a> = <span title="Int(7)" class="int">7</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(file: java.io.File)Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.open(e3f9ce1f75)">open</a><span class="delimiter">(</span><a title="java.io.File" id="akka.actor.mailbox.filebased.filequeue;Journal.open(e3f9ce1f75).file">file</a>: <span title="java.io.File">File</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.writer_=" title="(x$1: java.nio.channels.FileChannel)Unit">writer</a> = <span title="(x$1: java.io.File, x$2: Boolean)java.io.FileOutputStream" class="keyword">new</span> <span title="java.io.FileOutputStream">FileOutputStream</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.open(e3f9ce1f75).file" title="java.io.File">file</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>.<span title="()java.nio.channels.FileChannel">getChannel</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.open(aa97cb1b3d)">open</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.open(e3f9ce1f75)" title="(file: java.io.File)Unit">open</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.queueFile" title="=&gt; java.io.File">queueFile</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(xid: Int, openItems: List[akka.actor.mailbox.filebased.filequeue.QItem], queue: Iterable[akka.actor.mailbox.filebased.filequeue.QItem])Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.roll">roll</a><span class="delimiter">(</span><a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.roll.xid">xid</a>: <span title="Int">Int</span>, <a title="List[akka.actor.mailbox.filebased.filequeue.QItem]" id="akka.actor.mailbox.filebased.filequeue;Journal.roll.openItems">openItems</a>: <span title="List[akka.actor.mailbox.filebased.filequeue.QItem]">List</span><span class="delimiter">[</span>QItem<span class="delimiter">]</span>, <a title="Iterable[akka.actor.mailbox.filebased.filequeue.QItem]" id="akka.actor.mailbox.filebased.filequeue;Journal.roll.queue">queue</a>: <span title="Iterable[akka.actor.mailbox.filebased.filequeue.QItem]">Iterable</span><span class="delimiter">[</span>QItem<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.writer_=" title="=&gt; java.nio.channels.FileChannel">writer</a>.<span title="()Unit">close</span>
    <span class="keyword">val</span> <a title="java.io.File" id="akka.actor.mailbox.filebased.filequeue;Journal.roll.tmpFile">tmpFile</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.queuePath" title="String">queuePath</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;~~&quot;)" class="string">&quot;~~&quot;</span> <span title="(x$1: Any)String">+</span> <span title="System.type">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">)</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.open(e3f9ce1f75)" title="(file: java.io.File)Unit">open</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.roll.tmpFile" title="java.io.File">tmpFile</a><span class="delimiter">)</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.size_=" title="(x$1: Long)Unit">size</a> = <span title="Long(0L)" class="int">0</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><span title="akka.actor.mailbox.filebased.filequeue.QItem">item</span> ← <a href="#akka.actor.mailbox.filebased.filequeue;Journal.roll.openItems" title="(f: akka.actor.mailbox.filebased.filequeue.QItem =&gt; Unit)Unit">openItems</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.actor.mailbox.filebased.filequeue;Journal.addWithXid" title="(item: akka.actor.mailbox.filebased.filequeue.QItem)Unit">addWithXid</a><span class="delimiter">(</span><span title="akka.actor.mailbox.filebased.filequeue.QItem">item</span><span class="delimiter">)</span>
      <a href="#akka.actor.mailbox.filebased.filequeue;Journal.removeTentative(dd6f2a5390)" title="(allowSync: Boolean)Unit">removeTentative</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.saveXid" title="(xid: Int)Unit">saveXid</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.roll.xid" title="Int">xid</a><span class="delimiter">)</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><span title="akka.actor.mailbox.filebased.filequeue.QItem">item</span> ← <a href="#akka.actor.mailbox.filebased.filequeue;Journal.roll.queue" title="(f: akka.actor.mailbox.filebased.filequeue.QItem =&gt; Unit)Unit">queue</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.actor.mailbox.filebased.filequeue;Journal.add(5affd82685)" title="(allowSync: Boolean, item: akka.actor.mailbox.filebased.filequeue.QItem)Unit">add</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <span title="akka.actor.mailbox.filebased.filequeue.QItem">item</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.syncJournal" title="=&gt; Boolean">syncJournal</a><span class="delimiter">)</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.writer_=" title="=&gt; java.nio.channels.FileChannel">writer</a>.<span title="(x$1: Boolean)Unit">force</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.writer_=" title="=&gt; java.nio.channels.FileChannel">writer</a>.<span title="()Unit">close</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.roll.tmpFile" title="java.io.File">tmpFile</a>.<span title="(x$1: java.io.File)Boolean">renameTo</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.queueFile" title="=&gt; java.io.File">queueFile</a><span class="delimiter">)</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.open(aa97cb1b3d)" title="()Unit">open</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.close">close</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.writer_=" title="=&gt; java.nio.channels.FileChannel">writer</a>.<span title="()Unit">close</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="java.nio.channels.FileChannel" id="akka.actor.mailbox.filebased.filequeue;Journal.close.$anonfun.r">r</a> ← <a href="#akka.actor.mailbox.filebased.filequeue;Journal.reader_=" title="(f: java.nio.channels.FileChannel =&gt; Unit)Unit">reader</a><span class="delimiter">)</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.close.$anonfun.r" title="java.nio.channels.FileChannel">r</a>.<span title="()Unit">close</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.reader_=" title="(x$1: Option[java.nio.channels.FileChannel])Unit">reader</a> = <span title="None.type">None</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.erase">erase</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#akka.actor.mailbox.filebased.filequeue;Journal.close" title="()Unit">close</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#akka.actor.mailbox.filebased.filequeue;Journal.queueFile" title="=&gt; java.io.File">queueFile</a>.<span title="()Boolean">delete</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.erase.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span>_<span class="delimiter">)</span> ⇒
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Boolean" id="akka.actor.mailbox.filebased.filequeue;Journal.inReadBehind">inReadBehind</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.reader_=" title="=&gt; Option[java.nio.channels.FileChannel]">reader</a>.<span title="=&gt; Boolean">isDefined</span>

  <span class="keyword">def</span> <a title="()Boolean" id="akka.actor.mailbox.filebased.filequeue;Journal.isReplaying">isReplaying</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replayer_=" title="=&gt; Option[java.nio.channels.FileChannel]">replayer</a>.<span title="=&gt; Boolean">isDefined</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(allowSync: Boolean, item: akka.actor.mailbox.filebased.filequeue.QItem)Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.add(5affd82685)">add</a><span class="delimiter">(</span><a title="Boolean" id="akka.actor.mailbox.filebased.filequeue;Journal.add(5affd82685).allowSync">allowSync</a>: <span title="Boolean">Boolean</span>, <a title="akka.actor.mailbox.filebased.filequeue.QItem" id="akka.actor.mailbox.filebased.filequeue;Journal.add(5affd82685).item">item</a>: <a href="QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem" title="akka.actor.mailbox.filebased.filequeue.QItem">QItem</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.nio.ByteBuffer" id="akka.actor.mailbox.filebased.filequeue;Journal.add(5affd82685).blob">blob</a> = <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Array[Byte])java.nio.ByteBuffer">wrap</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.add(5affd82685).item" title="akka.actor.mailbox.filebased.filequeue.QItem">item</a>.<a href="QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem.pack" title="()Array[Byte]">pack</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.size_=" title="(x$1: Long)Unit">size</a> <span title="(x: Int)Long">+=</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.write" title="(allowSync: Boolean, items: Any*)Int">write</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_ADDX" title="=&gt; Int">CMD_ADDX</a>.<span title="=&gt; Byte">toByte</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.add(5affd82685).blob" title="java.nio.ByteBuffer">blob</a>.<span title="()Int">limit</span><span class="delimiter">)</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.add(5affd82685).doWhile$1" title="Unit" class="keyword">do</a> <span class="delimiter">{</span>
      <a href="#akka.actor.mailbox.filebased.filequeue;Journal.writer_=" title="=&gt; java.nio.channels.FileChannel">writer</a>.<span title="(x$1: java.nio.ByteBuffer)Int">write</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.add(5affd82685).blob" title="java.nio.ByteBuffer">blob</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.add(5affd82685).blob" title="java.nio.ByteBuffer">blob</a>.<span title="()Int">position</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.add(5affd82685).blob" title="java.nio.ByteBuffer">blob</a>.<span title="()Int">limit</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.add(5affd82685).allowSync" title="Boolean">allowSync</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.syncJournal" title="=&gt; Boolean">syncJournal</a><span class="delimiter">)</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.writer_=" title="=&gt; java.nio.channels.FileChannel">writer</a>.<span title="(x$1: Boolean)Unit">force</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.size_=" title="(x$1: Long)Unit">size</a> <span title="(x: Int)Long">+=</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.add(5affd82685).blob" title="java.nio.ByteBuffer">blob</a>.<span title="()Int">limit</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(item: akka.actor.mailbox.filebased.filequeue.QItem)Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.add(92f6c4288e)">add</a><span class="delimiter">(</span><a title="akka.actor.mailbox.filebased.filequeue.QItem" id="akka.actor.mailbox.filebased.filequeue;Journal.add(92f6c4288e).item">item</a>: <a href="QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem" title="akka.actor.mailbox.filebased.filequeue.QItem">QItem</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.add(5affd82685)" title="(allowSync: Boolean, item: akka.actor.mailbox.filebased.filequeue.QItem)Unit">add</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.add(92f6c4288e).item" title="akka.actor.mailbox.filebased.filequeue.QItem">item</a><span class="delimiter">)</span>

  <span class="comment">// used only to list pending transactions when recreating the journal.</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(item: akka.actor.mailbox.filebased.filequeue.QItem)Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.addWithXid">addWithXid</a><span class="delimiter">(</span><a title="akka.actor.mailbox.filebased.filequeue.QItem" id="akka.actor.mailbox.filebased.filequeue;Journal.addWithXid.item">item</a>: <a href="QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem" title="akka.actor.mailbox.filebased.filequeue.QItem">QItem</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.nio.ByteBuffer" id="akka.actor.mailbox.filebased.filequeue;Journal.addWithXid.blob">blob</a> = <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Array[Byte])java.nio.ByteBuffer">wrap</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.addWithXid.item" title="akka.actor.mailbox.filebased.filequeue.QItem">item</a>.<a href="QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem.pack" title="()Array[Byte]">pack</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="comment">// only called from roll(), so the journal does not need to be synced after a write.</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.size_=" title="(x$1: Long)Unit">size</a> <span title="(x: Int)Long">+=</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.write" title="(allowSync: Boolean, items: Any*)Int">write</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_ADD_XID" title="=&gt; Int">CMD_ADD_XID</a>.<span title="=&gt; Byte">toByte</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.addWithXid.item" title="akka.actor.mailbox.filebased.filequeue.QItem">item</a>.<a href="QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem.xid" title="=&gt; Int">xid</a>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.addWithXid.blob" title="java.nio.ByteBuffer">blob</a>.<span title="()Int">limit</span><span class="delimiter">)</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.addWithXid.doWhile$2" title="Unit" class="keyword">do</a> <span class="delimiter">{</span>
      <a href="#akka.actor.mailbox.filebased.filequeue;Journal.writer_=" title="=&gt; java.nio.channels.FileChannel">writer</a>.<span title="(x$1: java.nio.ByteBuffer)Int">write</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.addWithXid.blob" title="java.nio.ByteBuffer">blob</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.addWithXid.blob" title="java.nio.ByteBuffer">blob</a>.<span title="()Int">position</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.addWithXid.blob" title="java.nio.ByteBuffer">blob</a>.<span title="()Int">limit</span><span class="delimiter">)</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.size_=" title="(x$1: Long)Unit">size</a> <span title="(x: Int)Long">+=</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.addWithXid.blob" title="java.nio.ByteBuffer">blob</a>.<span title="()Int">limit</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.remove">remove</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.size_=" title="(x$1: Long)Unit">size</a> <span title="(x: Int)Long">+=</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.write" title="(allowSync: Boolean, items: Any*)Int">write</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_REMOVE" title="=&gt; Int">CMD_REMOVE</a>.<span title="=&gt; Byte">toByte</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(allowSync: Boolean)Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.removeTentative(dd6f2a5390)">removeTentative</a><span class="delimiter">(</span><a title="Boolean" id="akka.actor.mailbox.filebased.filequeue;Journal.removeTentative(dd6f2a5390).allowSync">allowSync</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.size_=" title="(x$1: Long)Unit">size</a> <span title="(x: Int)Long">+=</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.write" title="(allowSync: Boolean, items: Any*)Int">write</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.removeTentative(dd6f2a5390).allowSync" title="Boolean">allowSync</a>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_REMOVE_TENTATIVE" title="=&gt; Int">CMD_REMOVE_TENTATIVE</a>.<span title="=&gt; Byte">toByte</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.removeTentative(aa97cb1b3d)">removeTentative</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.removeTentative(dd6f2a5390)" title="(allowSync: Boolean)Unit">removeTentative</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(xid: Int)Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.saveXid">saveXid</a><span class="delimiter">(</span><a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.saveXid.xid">xid</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="comment">// only called from roll(), so the journal does not need to be synced after a write.</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.size_=" title="(x$1: Long)Unit">size</a> <span title="(x: Int)Long">+=</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.write" title="(allowSync: Boolean, items: Any*)Int">write</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_SAVE_XID" title="=&gt; Int">CMD_SAVE_XID</a>.<span title="=&gt; Byte">toByte</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.saveXid.xid" title="Int">xid</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(xid: Int)Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.unremove">unremove</a><span class="delimiter">(</span><a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.unremove.xid">xid</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.size_=" title="(x$1: Long)Unit">size</a> <span title="(x: Int)Long">+=</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.write" title="(allowSync: Boolean, items: Any*)Int">write</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_UNREMOVE" title="=&gt; Int">CMD_UNREMOVE</a>.<span title="=&gt; Byte">toByte</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.unremove.xid" title="Int">xid</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(xid: Int)Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.confirmRemove">confirmRemove</a><span class="delimiter">(</span><a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.confirmRemove.xid">xid</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.size_=" title="(x$1: Long)Unit">size</a> <span title="(x: Int)Long">+=</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.write" title="(allowSync: Boolean, items: Any*)Int">write</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_CONFIRM_REMOVE" title="=&gt; Int">CMD_CONFIRM_REMOVE</a>.<span title="=&gt; Byte">toByte</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.confirmRemove.xid" title="Int">xid</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.startReadBehind">startReadBehind</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Long" id="akka.actor.mailbox.filebased.filequeue;Journal.startReadBehind.pos">pos</a> = <span title="Long" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.replayer_=" title="=&gt; Option[java.nio.channels.FileChannel]">replayer</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replayer_=" title="=&gt; Option[java.nio.channels.FileChannel]">replayer</a>.<span title="=&gt; java.nio.channels.FileChannel">get</span>.<span title="()Long">position</span> <span class="keyword">else</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.writer_=" title="=&gt; java.nio.channels.FileChannel">writer</a>.<span title="()Long">position</span>
    <span class="keyword">val</span> <a title="java.nio.channels.FileChannel" id="akka.actor.mailbox.filebased.filequeue;Journal.startReadBehind.rj">rj</a> = <span title="(x$1: java.io.File)java.io.FileInputStream" class="keyword">new</span> <span title="java.io.FileInputStream">FileInputStream</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.queueFile" title="=&gt; java.io.File">queueFile</a><span class="delimiter">)</span>.<span title="()java.nio.channels.FileChannel">getChannel</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.startReadBehind.rj" title="java.nio.channels.FileChannel">rj</a>.<span title="(x$1: Long)java.nio.channels.FileChannel">position</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.startReadBehind.pos" title="Long">pos</a><span class="delimiter">)</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.reader_=" title="(x$1: Option[java.nio.channels.FileChannel])Unit">reader</a> = <span title="(x: java.nio.channels.FileChannel)Some[java.nio.channels.FileChannel]">Some</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.startReadBehind.rj" title="java.nio.channels.FileChannel">rj</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(f: akka.actor.mailbox.filebased.filequeue.QItem =&gt; Unit)Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.fillReadBehind">fillReadBehind</a><span class="delimiter">(</span><a title="akka.actor.mailbox.filebased.filequeue.QItem =&gt; Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.fillReadBehind.f">f</a>: QItem ⇒ Unit<span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Long" id="akka.actor.mailbox.filebased.filequeue;Journal.fillReadBehind.pos">pos</a> = <span title="Long" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.replayer_=" title="=&gt; Option[java.nio.channels.FileChannel]">replayer</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replayer_=" title="=&gt; Option[java.nio.channels.FileChannel]">replayer</a>.<span title="=&gt; java.nio.channels.FileChannel">get</span>.<span title="()Long">position</span> <span class="keyword">else</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.writer_=" title="=&gt; java.nio.channels.FileChannel">writer</a>.<span title="()Long">position</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="java.nio.channels.FileChannel" id="akka.actor.mailbox.filebased.filequeue;Journal.fillReadBehind.$anonfun.rj">rj</a> ← <a href="#akka.actor.mailbox.filebased.filequeue;Journal.reader_=" title="(f: java.nio.channels.FileChannel =&gt; Unit)Unit">reader</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.fillReadBehind.$anonfun.rj" title="java.nio.channels.FileChannel">rj</a>.<span title="()Long">position</span> <span title="(x: Long)Boolean">==</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.fillReadBehind.pos" title="Long">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">// we've caught up.</span>
        <a href="#akka.actor.mailbox.filebased.filequeue;Journal.fillReadBehind.$anonfun.rj" title="java.nio.channels.FileChannel">rj</a>.<span title="()Unit">close</span>
        <a href="#akka.actor.mailbox.filebased.filequeue;Journal.reader_=" title="(x$1: Option[java.nio.channels.FileChannel])Unit">reader</a> = <span title="None.type">None</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry" title="(in: java.nio.channels.FileChannel)(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)">readJournalEntry</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.fillReadBehind.$anonfun.rj" title="java.nio.channels.FileChannel">rj</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span class="delimiter">(</span>JournalItem.Add<span class="delimiter">(</span><a title="akka.actor.mailbox.filebased.filequeue.QItem" id="akka.actor.mailbox.filebased.filequeue;Journal.fillReadBehind.$anonfun.item">item</a><span class="delimiter">)</span>, _<span class="delimiter">)</span> ⇒ <a href="#akka.actor.mailbox.filebased.filequeue;Journal.fillReadBehind.f" title="(v1: akka.actor.mailbox.filebased.filequeue.QItem)Unit">f</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.fillReadBehind.$anonfun.item" title="akka.actor.mailbox.filebased.filequeue.QItem">item</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <span class="delimiter">(</span>_, _<span class="delimiter">)</span>                     ⇒
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(name: String)(f: akka.actor.mailbox.filebased.filequeue.JournalItem =&gt; Unit)Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.replay">replay</a><span class="delimiter">(</span><a title="String" id="akka.actor.mailbox.filebased.filequeue;Journal.replay.name">name</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="akka.actor.mailbox.filebased.filequeue.JournalItem =&gt; Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.replay.f">f</a>: JournalItem ⇒ Unit<span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.size_=" title="(x$1: Long)Unit">size</a> = <span title="Long(0L)" class="int">0</span>
    <span class="keyword">var</span> <a title="Long" id="akka.actor.mailbox.filebased.filequeue;Journal.replay.lastUpdate">lastUpdate</a> = <span title="Long(0L)" class="long">0L</span>
    <span class="keyword">val</span> <a title="Long" id="akka.actor.mailbox.filebased.filequeue;Journal.replay.TEN_MB">TEN_MB</a> = <span class="long">10L</span> * <span class="int">1024</span> <span title="Long(10485760L)">*</span> <span class="int">1024</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.nio.channels.FileChannel" id="akka.actor.mailbox.filebased.filequeue;Journal.replay.in">in</a> = <span title="(x$1: java.io.File)java.io.FileInputStream" class="keyword">new</span> <span title="java.io.FileInputStream">FileInputStream</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.queueFile" title="=&gt; java.io.File">queueFile</a><span class="delimiter">)</span>.<span title="()java.nio.channels.FileChannel">getChannel</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replayer_=" title="(x$1: Option[java.nio.channels.FileChannel])Unit">replayer</a> = <span title="(x: java.nio.channels.FileChannel)Some[java.nio.channels.FileChannel]">Some</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.in" title="java.nio.channels.FileChannel">in</a><span class="delimiter">)</span>
        <span class="keyword">var</span> <a title="Boolean" id="akka.actor.mailbox.filebased.filequeue;Journal.replay.done">done</a> = <span title="Boolean(false)" class="keyword">false</span>
        <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.doWhile$3" title="Unit" class="keyword">do</a> <span class="delimiter">{</span>
          <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry" title="(in: java.nio.channels.FileChannel)(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)">readJournalEntry</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.in" title="java.nio.channels.FileChannel">in</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem.type">JournalItem</a>.<a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.EndOfFile.readResolve" title="akka.actor.mailbox.filebased.filequeue.JournalItem.EndOfFile.type">EndOfFile</a>, _<span class="delimiter">)</span> ⇒ <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.done" title="Boolean">done</a> = <span title="Boolean(true)" class="keyword">true</span>
            <span class="keyword">case</span> <span class="delimiter">(</span><a title="akka.actor.mailbox.filebased.filequeue.JournalItem" id="akka.actor.mailbox.filebased.filequeue;Journal.replay.x">x</a>, <a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.replay.itemsize">itemsize</a><span class="delimiter">)</span> ⇒
              <a href="#akka.actor.mailbox.filebased.filequeue;Journal.size_=" title="(x$1: Long)Unit">size</a> <span title="(x: Int)Long">+=</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.itemsize" title="Int">itemsize</a>
              <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.f" title="(v1: akka.actor.mailbox.filebased.filequeue.JournalItem)Unit">f</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.x" title="akka.actor.mailbox.filebased.filequeue.JournalItem">x</a><span class="delimiter">)</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.size_=" title="=&gt; Long">size</a> <span title="(x: Long)Long">/</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.TEN_MB" title="Long">TEN_MB</a> <span title="(x: Long)Boolean">&gt;</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.lastUpdate" title="Long">lastUpdate</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.lastUpdate" title="Long">lastUpdate</a> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.size_=" title="=&gt; Long">size</a> <span title="(x: Long)Long">/</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.TEN_MB" title="Long">TEN_MB</a>
                <a href="#akka.actor.mailbox.filebased.filequeue;Journal.log" title="akka.event.LoggingAdapter">log</a>.<a href="../../../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.info(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Continuing to read \'{}\' journal; {} MB so far...&quot;)" class="string">&quot;Continuing to read '{}' journal; {} MB so far...&quot;</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.name" title="String">name</a>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.lastUpdate" title="Long">lastUpdate</a> <span title="(x: Int)Long">*</span> <span title="Int(10)" class="int">10</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.done" title="Boolean">done</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="akka.actor.mailbox.filebased.filequeue.BrokenItemException">e</span>: <a href="BrokenItemException.scala.html#akka.actor.mailbox.filebased.filequeue;BrokenItemException" title="akka.actor.mailbox.filebased.filequeue.BrokenItemException">BrokenItemException</a> ⇒
          <a href="#akka.actor.mailbox.filebased.filequeue;Journal.log" title="akka.event.LoggingAdapter">log</a>.<a href="../../../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.error(134e35740d)" title="(cause: Throwable, template: String, arg1: Any)Unit">error</a><span class="delimiter">(</span><span title="akka.actor.mailbox.filebased.filequeue.BrokenItemException">e</span>, <span title="String(&quot;Exception replaying journal for \'{}\'&quot;)" class="string">&quot;Exception replaying journal for '{}'&quot;</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.name" title="String">name</a><span class="delimiter">)</span>
          <a href="#akka.actor.mailbox.filebased.filequeue;Journal.truncateJournal" title="(position: Long)Unit">truncateJournal</a><span class="delimiter">(</span><span title="akka.actor.mailbox.filebased.filequeue.BrokenItemException">e</span>.<a href="BrokenItemException.scala.html#akka.actor.mailbox.filebased.filequeue;BrokenItemException.lastValidPosition" title="=&gt; Long">lastValidPosition</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="java.io.FileNotFoundException">e</span>: <span title="java.io.FileNotFoundException">FileNotFoundException</span> ⇒
        <a href="#akka.actor.mailbox.filebased.filequeue;Journal.log" title="akka.event.LoggingAdapter">log</a>.<a href="../../../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.info(dc73c33c91)" title="(template: String, arg1: Any)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;No transaction journal for \'{}\'; starting with empty queue.&quot;)" class="string">&quot;No transaction journal for '{}'; starting with empty queue.&quot;</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.name" title="String">name</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="java.io.IOException">e</span>: <span title="java.io.IOException">IOException</span> ⇒
        <a href="#akka.actor.mailbox.filebased.filequeue;Journal.log" title="akka.event.LoggingAdapter">log</a>.<a href="../../../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.error(134e35740d)" title="(cause: Throwable, template: String, arg1: Any)Unit">error</a><span class="delimiter">(</span><span title="java.io.IOException">e</span>, <span title="String(&quot;Exception replaying journal for \'{}\'&quot;)" class="string">&quot;Exception replaying journal for '{}'&quot;</span>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replay.name" title="String">name</a><span class="delimiter">)</span>
      <span class="comment">// this can happen if the server hardware died abruptly in the middle</span>
      <span class="comment">// of writing a journal. not awesome but we should recover.</span>
    <span class="delimiter">}</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.replayer_=" title="(x$1: Option[java.nio.channels.FileChannel])Unit">replayer</a> = <span title="None.type">None</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(position: Long)Unit" id="akka.actor.mailbox.filebased.filequeue;Journal.truncateJournal">truncateJournal</a><span class="delimiter">(</span><a title="Long" id="akka.actor.mailbox.filebased.filequeue;Journal.truncateJournal.position">position</a>: <span title="Long">Long</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.nio.channels.FileChannel" id="akka.actor.mailbox.filebased.filequeue;Journal.truncateJournal.trancateWriter">trancateWriter</a> = <span title="(x$1: java.io.File, x$2: Boolean)java.io.FileOutputStream" class="keyword">new</span> <span title="java.io.FileOutputStream">FileOutputStream</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.queueFile" title="=&gt; java.io.File">queueFile</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>.<span title="()java.nio.channels.FileChannel">getChannel</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#akka.actor.mailbox.filebased.filequeue;Journal.truncateJournal.trancateWriter" title="java.nio.channels.FileChannel">trancateWriter</a>.<span title="(x$1: Long)java.nio.channels.FileChannel">truncate</span><span title="Unit" class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.truncateJournal.position" title="Long">position</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#akka.actor.mailbox.filebased.filequeue;Journal.truncateJournal.trancateWriter" title="java.nio.channels.FileChannel">trancateWriter</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(in: java.nio.channels.FileChannel)(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)" id="akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry">readJournalEntry</a><span class="delimiter">(</span><a title="java.nio.channels.FileChannel" id="akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.in">in</a>: <span title="java.nio.channels.FileChannel">FileChannel</span><span class="delimiter">)</span>: <span title="(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)" class="delimiter">(</span>JournalItem, Int<span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="()java.nio.Buffer">rewind</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="(x$1: Int)java.nio.Buffer">limit</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Long" id="akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.lastPosition">lastPosition</a> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.in" title="java.nio.channels.FileChannel">in</a>.<span title="()Long">position</span>
    <span class="keyword">var</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.x">x</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.doWhile$4" title="Unit" class="keyword">do</a> <span class="delimiter">{</span>
      <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.x" title="Int">x</a> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.in" title="java.nio.channels.FileChannel">in</a>.<span title="(x$1: java.nio.ByteBuffer)Int">read</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="()Int">position</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="()Int">limit</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.x" title="Int">x</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

    <span title="(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.x" title="Int">x</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(_1: akka.actor.mailbox.filebased.filequeue.JournalItem.EndOfFile.type, _2: Int)(akka.actor.mailbox.filebased.filequeue.JournalItem.EndOfFile.type, Int)" class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem.type">JournalItem</a>.<a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.EndOfFile.readResolve" title="akka.actor.mailbox.filebased.filequeue.JournalItem.EndOfFile.type">EndOfFile</a>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#akka.actor.mailbox.filebased.filequeue;Journal.buffer" title="(i: Int)Byte">buffer</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_ADD" title="=&gt; Int">CMD_ADD</a> ⇒
            <span class="keyword">val</span> <span title="Array[Byte]">data</span> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock" title="(in: java.nio.channels.FileChannel)Array[Byte]">readBlock</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.in" title="java.nio.channels.FileChannel">in</a><span class="delimiter">)</span>
            <span title="(_1: akka.actor.mailbox.filebased.filequeue.JournalItem.Add, _2: Int)(akka.actor.mailbox.filebased.filequeue.JournalItem.Add, Int)" class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem.type">JournalItem</a>.<a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.Add.readResolve" title="(item: akka.actor.mailbox.filebased.filequeue.QItem)akka.actor.mailbox.filebased.filequeue.JournalItem.Add">Add</a><span class="delimiter">(</span><a href="QItem.scala.html#akka.actor.mailbox.filebased.filequeue.QItem" title="akka.actor.mailbox.filebased.filequeue.QItem.type">QItem</a>.<a href="QItem.scala.html#akka.actor.mailbox.filebased.filequeue.QItem.unpackOldAdd" title="(data: Array[Byte])akka.actor.mailbox.filebased.filequeue.QItem">unpackOldAdd</a><span class="delimiter">(</span><span title="Array[Byte]">data</span><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="Int(5)" class="int">5</span> <span title="(x: Int)Int">+</span> <span title="Array[Byte]">data</span>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_REMOVE" title="=&gt; Int">CMD_REMOVE</a> ⇒
            <span title="(_1: akka.actor.mailbox.filebased.filequeue.JournalItem.Remove.type, _2: Int)(akka.actor.mailbox.filebased.filequeue.JournalItem.Remove.type, Int)" class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem.type">JournalItem</a>.<a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.Remove.readResolve" title="akka.actor.mailbox.filebased.filequeue.JournalItem.Remove.type">Remove</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_ADDX" title="=&gt; Int">CMD_ADDX</a> ⇒
            <span class="keyword">val</span> <span title="Array[Byte]">data</span> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock" title="(in: java.nio.channels.FileChannel)Array[Byte]">readBlock</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.in" title="java.nio.channels.FileChannel">in</a><span class="delimiter">)</span>
            <span title="(_1: akka.actor.mailbox.filebased.filequeue.JournalItem.Add, _2: Int)(akka.actor.mailbox.filebased.filequeue.JournalItem.Add, Int)" class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem.type">JournalItem</a>.<a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.Add.readResolve" title="(item: akka.actor.mailbox.filebased.filequeue.QItem)akka.actor.mailbox.filebased.filequeue.JournalItem.Add">Add</a><span class="delimiter">(</span><a href="QItem.scala.html#akka.actor.mailbox.filebased.filequeue.QItem" title="akka.actor.mailbox.filebased.filequeue.QItem.type">QItem</a>.<a href="QItem.scala.html#akka.actor.mailbox.filebased.filequeue.QItem.unpack" title="(data: Array[Byte])akka.actor.mailbox.filebased.filequeue.QItem">unpack</a><span class="delimiter">(</span><span title="Array[Byte]">data</span><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="Int(5)" class="int">5</span> <span title="(x: Int)Int">+</span> <span title="Array[Byte]">data</span>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_REMOVE_TENTATIVE" title="=&gt; Int">CMD_REMOVE_TENTATIVE</a> ⇒
            <span title="(_1: akka.actor.mailbox.filebased.filequeue.JournalItem.RemoveTentative.type, _2: Int)(akka.actor.mailbox.filebased.filequeue.JournalItem.RemoveTentative.type, Int)" class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem.type">JournalItem</a>.<a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.RemoveTentative.readResolve" title="akka.actor.mailbox.filebased.filequeue.JournalItem.RemoveTentative.type">RemoveTentative</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_SAVE_XID" title="=&gt; Int">CMD_SAVE_XID</a> ⇒
            <span class="keyword">val</span> <span title="Int">xid</span> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readInt" title="(in: java.nio.channels.FileChannel)Int">readInt</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.in" title="java.nio.channels.FileChannel">in</a><span class="delimiter">)</span>
            <span title="(_1: akka.actor.mailbox.filebased.filequeue.JournalItem.SavedXid, _2: Int)(akka.actor.mailbox.filebased.filequeue.JournalItem.SavedXid, Int)" class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem.type">JournalItem</a>.<a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.SavedXid.readResolve" title="(xid: Int)akka.actor.mailbox.filebased.filequeue.JournalItem.SavedXid">SavedXid</a><span class="delimiter">(</span><span title="Int">xid</span><span class="delimiter">)</span>, <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_UNREMOVE" title="=&gt; Int">CMD_UNREMOVE</a> ⇒
            <span class="keyword">val</span> <span title="Int">xid</span> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readInt" title="(in: java.nio.channels.FileChannel)Int">readInt</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.in" title="java.nio.channels.FileChannel">in</a><span class="delimiter">)</span>
            <span title="(_1: akka.actor.mailbox.filebased.filequeue.JournalItem.Unremove, _2: Int)(akka.actor.mailbox.filebased.filequeue.JournalItem.Unremove, Int)" class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem.type">JournalItem</a>.<a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.Unremove.readResolve" title="(xid: Int)akka.actor.mailbox.filebased.filequeue.JournalItem.Unremove">Unremove</a><span class="delimiter">(</span><span title="Int">xid</span><span class="delimiter">)</span>, <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_CONFIRM_REMOVE" title="=&gt; Int">CMD_CONFIRM_REMOVE</a> ⇒
            <span class="keyword">val</span> <span title="Int">xid</span> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readInt" title="(in: java.nio.channels.FileChannel)Int">readInt</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.in" title="java.nio.channels.FileChannel">in</a><span class="delimiter">)</span>
            <span title="(_1: akka.actor.mailbox.filebased.filequeue.JournalItem.ConfirmRemove, _2: Int)(akka.actor.mailbox.filebased.filequeue.JournalItem.ConfirmRemove, Int)" class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem.type">JournalItem</a>.<a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.ConfirmRemove.readResolve" title="(xid: Int)akka.actor.mailbox.filebased.filequeue.JournalItem.ConfirmRemove">ConfirmRemove</a><span class="delimiter">(</span><span title="Int">xid</span><span class="delimiter">)</span>, <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.CMD_ADD_XID" title="=&gt; Int">CMD_ADD_XID</a> ⇒
            <span class="keyword">val</span> <span title="Int">xid</span> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readInt" title="(in: java.nio.channels.FileChannel)Int">readInt</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.in" title="java.nio.channels.FileChannel">in</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <span title="Array[Byte]">data</span> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock" title="(in: java.nio.channels.FileChannel)Array[Byte]">readBlock</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.in" title="java.nio.channels.FileChannel">in</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="akka.actor.mailbox.filebased.filequeue.QItem" id="akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.item">item</a> = <a href="QItem.scala.html#akka.actor.mailbox.filebased.filequeue.QItem" title="akka.actor.mailbox.filebased.filequeue.QItem.type">QItem</a>.<a href="QItem.scala.html#akka.actor.mailbox.filebased.filequeue.QItem.unpack" title="(data: Array[Byte])akka.actor.mailbox.filebased.filequeue.QItem">unpack</a><span class="delimiter">(</span><span title="Array[Byte]">data</span><span class="delimiter">)</span>
            <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.item" title="akka.actor.mailbox.filebased.filequeue.QItem">item</a>.<a href="QItem.scala.html#akka.actor.mailbox.filebased.filequeue;QItem.xid_=" title="(x$1: Int)Unit">xid</a> = <span title="Int">xid</span>
            <span title="(_1: akka.actor.mailbox.filebased.filequeue.JournalItem.Add, _2: Int)(akka.actor.mailbox.filebased.filequeue.JournalItem.Add, Int)" class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem.type">JournalItem</a>.<a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.Add.readResolve" title="(item: akka.actor.mailbox.filebased.filequeue.QItem)akka.actor.mailbox.filebased.filequeue.JournalItem.Add">Add</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.item" title="akka.actor.mailbox.filebased.filequeue.QItem">item</a><span class="delimiter">)</span>, <span title="Int(9)" class="int">9</span> <span title="(x: Int)Int">+</span> <span title="Array[Byte]">data</span>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a title="Byte" id="akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.n">n</a> ⇒
            <span title="Nothing" class="keyword">throw</span> <span title="akka.actor.mailbox.filebased.filequeue.BrokenItemException" class="keyword">new</span> <a href="BrokenItemException.scala.html#akka.actor.mailbox.filebased.filequeue;BrokenItemException" title="akka.actor.mailbox.filebased.filequeue.BrokenItemException">BrokenItemException</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.lastPosition" title="Long">lastPosition</a>, <span title="(x$1: String)java.io.IOException" class="keyword">new</span> <span title="java.io.IOException">IOException</span><span class="delimiter">(</span><span title="String(&quot;invalid opcode in journal: &quot;)" class="string">&quot;invalid opcode in journal: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.n" title="Byte">n</a>.<span title="=&gt; Int">toInt</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; at position &quot;)" class="string">&quot; at position &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.in" title="java.nio.channels.FileChannel">in</a>.<span title="()Long">position</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="java.io.IOException" id="akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.ex">ex</a>: <span title="java.io.IOException">IOException</span> ⇒
          <span title="Nothing" class="keyword">throw</span> <span title="akka.actor.mailbox.filebased.filequeue.BrokenItemException" class="keyword">new</span> <a href="BrokenItemException.scala.html#akka.actor.mailbox.filebased.filequeue;BrokenItemException" title="akka.actor.mailbox.filebased.filequeue.BrokenItemException">BrokenItemException</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.lastPosition" title="Long">lastPosition</a>, <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry.ex" title="java.io.IOException">ex</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Iterator[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]{val in: java.nio.channels.FileChannel; def done: Boolean; def done_=(x$1: Boolean): Unit; def nextItem: Option[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]; def nextItem_=(x$1: Option[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]): Unit}" id="akka.actor.mailbox.filebased.filequeue;Journal.walk">walk</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon" title="Iterator[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]{val in: java.nio.channels.FileChannel; def done: Boolean; def done_=(x$1: Boolean): Unit; def nextItem: Option[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]; def nextItem_=(x$1: Option[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]): Unit}" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with Iterator[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]" id="akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon">Iterator</a><span class="delimiter">[</span><span class="delimiter">(</span>JournalItem, Int<span class="delimiter">)</span><span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.nio.channels.FileChannel" id="akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon.in">in</a> = <span title="java.io.FileInputStream" class="keyword">new</span> <span title="java.io.FileInputStream">FileInputStream</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.queuePath" title="String">queuePath</a><span class="delimiter">)</span>.<span title="()java.nio.channels.FileChannel">getChannel</span>
    <span class="keyword">var</span> <a title="Boolean" id="akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon.done_=">done</a> = <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">var</span> <a title="Option[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]" id="akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon.nextItem_=">nextItem</a>: <span title="Option[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]">Option</span><span class="delimiter">[</span><span class="delimiter">(</span>JournalItem, Int<span class="delimiter">)</span><span class="delimiter">]</span> = <span title="None.type">None</span>

    <span class="keyword">def</span> <a title="=&gt; Boolean" id="akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon.hasNext">hasNext</a> = <span class="delimiter">{</span>
      <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon.done_=" title="=&gt; Boolean">done</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon.nextItem_=" title="(x$1: Option[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)])Unit">nextItem</a> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readJournalEntry" title="(in: java.nio.channels.FileChannel)(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)">readJournalEntry</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon.in" title="=&gt; java.nio.channels.FileChannel">in</a><span class="delimiter">)</span> <span title="Option[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue.JournalItem" title="akka.actor.mailbox.filebased.filequeue.JournalItem.type">JournalItem</a>.<a href="#akka.actor.mailbox.filebased.filequeue.JournalItem.EndOfFile.readResolve" title="akka.actor.mailbox.filebased.filequeue.JournalItem.EndOfFile.type">EndOfFile</a>, _<span class="delimiter">)</span> ⇒
            <a href="#akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon.done_=" title="(x$1: Boolean)Unit">done</a> = <span title="Boolean(true)" class="keyword">true</span>
            <a href="#akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon.in" title="=&gt; java.nio.channels.FileChannel">in</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
            <span title="None.type">None</span>
          <span class="keyword">case</span> <a title="(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)" id="akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon.hasNext.x">x</a> ⇒
            <span title="(x: (akka.actor.mailbox.filebased.filequeue.JournalItem, Int))Some[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]">Some</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon.hasNext.x" title="(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)">x</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon.nextItem_=" title="=&gt; Option[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]">nextItem</a>.<span title="=&gt; Boolean">isDefined</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="()(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)" id="akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon.next">next</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.walk;$anon.nextItem_=" title="=&gt; Option[(akka.actor.mailbox.filebased.filequeue.JournalItem, Int)]">nextItem</a>.<span title="=&gt; (akka.actor.mailbox.filebased.filequeue.JournalItem, Int)">get</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: java.nio.channels.FileChannel)Array[Byte]" id="akka.actor.mailbox.filebased.filequeue;Journal.readBlock">readBlock</a><span class="delimiter">(</span><a title="java.nio.channels.FileChannel" id="akka.actor.mailbox.filebased.filequeue;Journal.readBlock.in">in</a>: <span title="java.nio.channels.FileChannel">FileChannel</span><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.readBlock.size">size</a> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readInt" title="(in: java.nio.channels.FileChannel)Int">readInt</a><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock.in" title="java.nio.channels.FileChannel">in</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[Byte]" id="akka.actor.mailbox.filebased.filequeue;Journal.readBlock.data">data</a> = <span title="Array[Byte]" class="keyword">new</span> <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock.size" title="Int">size</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.nio.ByteBuffer" id="akka.actor.mailbox.filebased.filequeue;Journal.readBlock.dataBuffer">dataBuffer</a> = <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Array[Byte])java.nio.ByteBuffer">wrap</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock.data" title="Array[Byte]">data</a><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.readBlock.x">x</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock.doWhile$5" title="Unit" class="keyword">do</a> <span class="delimiter">{</span>
      <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock.x" title="Int">x</a> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock.in" title="java.nio.channels.FileChannel">in</a>.<span title="(x$1: java.nio.ByteBuffer)Int">read</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock.dataBuffer" title="java.nio.ByteBuffer">dataBuffer</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock.dataBuffer" title="java.nio.ByteBuffer">dataBuffer</a>.<span title="()Int">position</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock.dataBuffer" title="java.nio.ByteBuffer">dataBuffer</a>.<span title="()Int">limit</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock.x" title="Int">x</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock.x" title="Int">x</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// we never expect EOF when reading a block.</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)java.io.IOException" class="keyword">new</span> <span title="java.io.IOException">IOException</span><span class="delimiter">(</span><span title="String(&quot;Unexpected EOF&quot;)" class="string">&quot;Unexpected EOF&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readBlock.data" title="Array[Byte]">data</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: java.nio.channels.FileChannel)Int" id="akka.actor.mailbox.filebased.filequeue;Journal.readInt">readInt</a><span class="delimiter">(</span><a title="java.nio.channels.FileChannel" id="akka.actor.mailbox.filebased.filequeue;Journal.readInt.in">in</a>: <span title="java.nio.channels.FileChannel">FileChannel</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="()java.nio.Buffer">rewind</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="(x$1: Int)java.nio.Buffer">limit</span><span class="delimiter">(</span><span title="Int(4)" class="int">4</span><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.readInt.x">x</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readInt.doWhile$6" title="Unit" class="keyword">do</a> <span class="delimiter">{</span>
      <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readInt.x" title="Int">x</a> = <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readInt.in" title="java.nio.channels.FileChannel">in</a>.<span title="(x$1: java.nio.ByteBuffer)Int">read</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="()Int">position</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="()Int">limit</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.readInt.x" title="Int">x</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.readInt.x" title="Int">x</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// we never expect EOF when reading an int.</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)java.io.IOException" class="keyword">new</span> <span title="java.io.IOException">IOException</span><span class="delimiter">(</span><span title="String(&quot;Unexpected EOF&quot;)" class="string">&quot;Unexpected EOF&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="()java.nio.Buffer">rewind</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="()Int">getInt</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(allowSync: Boolean, items: Any*)Int" id="akka.actor.mailbox.filebased.filequeue;Journal.write">write</a><span class="delimiter">(</span><a title="Boolean" id="akka.actor.mailbox.filebased.filequeue;Journal.write.allowSync">allowSync</a>: <span title="Boolean">Boolean</span>, <a title="Any*" id="akka.actor.mailbox.filebased.filequeue;Journal.write.items">items</a>: <span title="Any*">Any</span>*<span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="()java.nio.Buffer">clear</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="Any" id="akka.actor.mailbox.filebased.filequeue;Journal.write.$anonfun.item">item</a> ← <a href="#akka.actor.mailbox.filebased.filequeue;Journal.write.items" title="(f: Any =&gt; java.nio.ByteBuffer)Unit">items</a><span class="delimiter">)</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.write.$anonfun.item" title="Any">item</a> <span title="java.nio.ByteBuffer" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Byte" id="akka.actor.mailbox.filebased.filequeue;Journal.write.$anonfun.b">b</a>: <span title="Byte">Byte</span> ⇒ <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="(x$1: Byte)java.nio.ByteBuffer">put</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.write.$anonfun.b" title="Byte">b</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Int" id="akka.actor.mailbox.filebased.filequeue;Journal.write.$anonfun.i">i</a>: <span title="Int">Int</span>  ⇒ <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="(x$1: Int)java.nio.ByteBuffer">putInt</span><span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.write.$anonfun.i" title="Int">i</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="()java.nio.Buffer">flip</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="()Int">position</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="()Int">limit</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.actor.mailbox.filebased.filequeue;Journal.writer_=" title="=&gt; java.nio.channels.FileChannel">writer</a>.<span title="(x$1: java.nio.ByteBuffer)Int">write</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.write.while$1" title="()Unit" class="delimiter">(</a><a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.actor.mailbox.filebased.filequeue;Journal.write.allowSync" title="Boolean">allowSync</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.syncJournal" title="=&gt; Boolean">syncJournal</a><span class="delimiter">)</span> <a href="#akka.actor.mailbox.filebased.filequeue;Journal.writer_=" title="=&gt; java.nio.channels.FileChannel">writer</a>.<span title="(x$1: Boolean)Unit">force</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
    <a href="#akka.actor.mailbox.filebased.filequeue;Journal.byteBuffer" title="=&gt; java.nio.ByteBuffer">byteBuffer</a>.<span title="()Int">limit</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
