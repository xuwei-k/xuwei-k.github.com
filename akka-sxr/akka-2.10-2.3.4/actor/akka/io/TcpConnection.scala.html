<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>actor/akka/io/TcpConnection.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

<span class="keyword">package</span> akka.io

<span class="keyword">import</span> java.net.<span class="delimiter">{</span> SocketException, InetSocketAddress <span class="delimiter">}</span>
<span class="keyword">import</span> java.nio.channels.<span title="java.nio.channels.SelectionKey.type">SelectionKey</span>._
<span class="keyword">import</span> java.io.<span class="delimiter">{</span> FileInputStream, IOException <span class="delimiter">}</span>
<span class="keyword">import</span> java.nio.channels.<span class="delimiter">{</span> FileChannel, SocketChannel <span class="delimiter">}</span>
<span class="keyword">import</span> java.nio.ByteBuffer
<span class="keyword">import</span> scala.annotation.tailrec
<span class="keyword">import</span> scala.collection.immutable
<span class="keyword">import</span> scala.util.control.NonFatal
<span class="keyword">import</span> scala.concurrent.duration._
<span class="keyword">import</span> akka.actor._
<span class="keyword">import</span> akka.util.ByteString
<span class="keyword">import</span> akka.io.<a href="Inet.scala.html#akka.io.Inet" title="akka.io.Inet.type">Inet</a>.SocketOption
<span class="keyword">import</span> akka.io.<a href="Tcp.scala.html#akka.io.Tcp" title="akka.io.Tcp.type">Tcp</a>._
<span class="keyword">import</span> akka.io.<a href="SelectionHandler.scala.html#akka.io.SelectionHandler" title="akka.io.SelectionHandler.type">SelectionHandler</a>._
<span class="keyword">import</span> akka.dispatch.<span class="delimiter">{</span> UnboundedMessageQueueSemantics, RequiresMessageQueue <span class="delimiter">}</span>

<span class="comment">/**
 * Base class for TcpIncomingConnection and TcpOutgoingConnection.
 *
 * INTERNAL API
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>io<span class="delimiter">]</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class TcpConnection extends AnyRef with akka.actor.Actor with akka.actor.ActorLogging with akka.dispatch.RequiresMessageQueue[akka.dispatch.UnboundedMessageQueueSemantics]" id="akka.io;TcpConnection">TcpConnection</a><a href="#akka.io;TcpConnection" title="akka.io.TcpConnection" class="delimiter">(</a><span class="keyword">val</span> <a title="akka.io.TcpExt" id="akka.io;TcpConnection.tcp">tcp</a>: <a href="Tcp.scala.html#akka.io;TcpExt" title="akka.io.TcpExt">TcpExt</a>, <span class="keyword">val</span> <a title="java.nio.channels.SocketChannel" id="akka.io;TcpConnection.channel">channel</a>: <span title="java.nio.channels.SocketChannel">SocketChannel</span>, <span class="keyword">val</span> <a title="Boolean" id="akka.io;TcpConnection.pullMode">pullMode</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="../actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="keyword">with</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="keyword">with</span> <a href="../dispatch/Mailbox.scala.html#akka.dispatch;RequiresMessageQueue" title="akka.dispatch.RequiresMessageQueue[akka.dispatch.UnboundedMessageQueueSemantics]">RequiresMessageQueue</a><span class="delimiter">[</span>UnboundedMessageQueueSemantics<span class="delimiter">]</span> <span class="delimiter">{</span>

  <span class="keyword">import</span> <a href="#akka.io;TcpConnection.tcp" title="=&gt; akka.io.TcpExt">tcp</a>.<a href="Tcp.scala.html#akka.io;TcpExt.Settings" title="=&gt; TcpConnection.this.tcp.Settings">Settings</a>._
  <span class="keyword">import</span> <a href="#akka.io;TcpConnection.tcp" title="=&gt; akka.io.TcpExt">tcp</a>.bufferPool
  <span class="keyword">import</span> <a href="#akka.io.TcpConnection" title="akka.io.TcpConnection.type">TcpConnection</a>._

  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="akka.io.TcpConnection.PendingWrite" id="akka.io;TcpConnection.pendingWrite">pendingWrite</a>: <a href="#akka.io.TcpConnection;PendingWrite" title="akka.io.TcpConnection.PendingWrite">PendingWrite</a> = <a href="#akka.io.TcpConnection.EmptyPendingWrite" title="akka.io.TcpConnection.EmptyPendingWrite.type">EmptyPendingWrite</a>
  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="Boolean" id="akka.io;TcpConnection.peerClosed">peerClosed</a> = <span title="Boolean(false)" class="keyword">false</span>
  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="Boolean" id="akka.io;TcpConnection.writingSuspended">writingSuspended</a> = <span title="Boolean(false)" class="keyword">false</span>
  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="Boolean" id="akka.io;TcpConnection.readingSuspended">readingSuspended</a> = <a href="#akka.io;TcpConnection.pullMode" title="=&gt; Boolean">pullMode</a>
  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="Option[akka.actor.ActorRef]" id="akka.io;TcpConnection.interestedInResume">interestedInResume</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <span title="None.type">None</span>
  <span class="keyword">var</span> <a title="akka.io.TcpConnection.CloseInformation" id="akka.io;TcpConnection.closedMessage_=">closedMessage</a>: <a href="#akka.io.TcpConnection.CloseInformation.readResolve" title="akka.io.TcpConnection.CloseInformation">CloseInformation</a> = _ <span class="comment">// for ConnectionClosed message in postStop</span>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="akka.io;TcpConnection.writePending">writePending</a> = <a href="#akka.io;TcpConnection.pendingWrite" title="akka.io.TcpConnection.PendingWrite">pendingWrite</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="#akka.io.TcpConnection.EmptyPendingWrite" title="akka.io.TcpConnection.EmptyPendingWrite.type">EmptyPendingWrite</a>

  <span class="comment">// STATES</span>

  <span class="comment">/** connection established, waiting for registration from user handler */</span>
  <span class="keyword">def</span> <a title="(registration: akka.io.ChannelRegistration, commander: akka.actor.ActorRef)TcpConnection.this.Receive" id="akka.io;TcpConnection.waitingForRegistration">waitingForRegistration</a><span class="delimiter">(</span><a title="akka.io.ChannelRegistration" id="akka.io;TcpConnection.waitingForRegistration.registration">registration</a>: <a href="SelectionHandler.scala.html#akka.io;ChannelRegistration" title="akka.io.ChannelRegistration">ChannelRegistration</a>, <a title="akka.actor.ActorRef" id="akka.io;TcpConnection.waitingForRegistration.commander">commander</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="TcpConnection.this.Receive">Receive</span> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.io;TcpConnection.waitingForRegistration;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> Register<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.io;TcpConnection.waitingForRegistration;$anonfun.isDefinedAt.handler">handler</a>, <a title="Boolean" id="akka.io;TcpConnection.waitingForRegistration;$anonfun.isDefinedAt.keepOpenOnPeerClosed">keepOpenOnPeerClosed</a>, <a title="Boolean" id="akka.io;TcpConnection.waitingForRegistration;$anonfun.isDefinedAt.useResumeWriting">useResumeWriting</a><span class="delimiter">)</span> ⇒
      <span class="comment">// up to this point we've been watching the commander,</span>
      <span class="comment">// but since registration is now complete we only need to watch the handler from here on</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.waitingForRegistration;$anonfun.isDefinedAt.handler" title="akka.actor.ActorRef">handler</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#akka.io;TcpConnection.waitingForRegistration.commander" title="akka.actor.ActorRef">commander</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.unwatch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">unwatch</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.waitingForRegistration.commander" title="akka.actor.ActorRef">commander</a><span class="delimiter">)</span>
        <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.waitingForRegistration;$anonfun.isDefinedAt.handler" title="akka.actor.ActorRef">handler</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="SelectionHandler.scala.html#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;[{}] registered as connection handler&quot;)" class="string">&quot;[{}] registered as connection handler&quot;</span>, <a href="#akka.io;TcpConnection.waitingForRegistration;$anonfun.isDefinedAt.handler" title="akka.actor.ActorRef">handler</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <span title="akka.io.TcpConnection.ConnectionInfo">info</span> = <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="(registration: akka.io.ChannelRegistration, handler: akka.actor.ActorRef, keepOpenOnPeerClosed: Boolean, useResumeWriting: Boolean)akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.waitingForRegistration.registration" title="akka.io.ChannelRegistration">registration</a>, <a href="#akka.io;TcpConnection.waitingForRegistration;$anonfun.isDefinedAt.handler" title="akka.actor.ActorRef">handler</a>, <a href="#akka.io;TcpConnection.waitingForRegistration;$anonfun.isDefinedAt.keepOpenOnPeerClosed" title="Boolean">keepOpenOnPeerClosed</a>, <a href="#akka.io;TcpConnection.waitingForRegistration;$anonfun.isDefinedAt.useResumeWriting" title="Boolean">useResumeWriting</a><span class="delimiter">)</span>
      <span class="comment">// if we have resumed reading from pullMode while waiting for Register then register OP_READ interest</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.pullMode" title="=&gt; Boolean">pullMode</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#akka.io;TcpConnection.readingSuspended" title="Boolean">readingSuspended</a><span class="delimiter">)</span> <a href="#akka.io;TcpConnection.resumeReading" title="(info: akka.io.TcpConnection.ConnectionInfo)Unit">resumeReading</a><span class="delimiter">(</span><span title="akka.io.TcpConnection.ConnectionInfo">info</span><span class="delimiter">)</span>
      <a href="#akka.io;TcpConnection.doRead" title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef])Unit">doRead</a><span class="delimiter">(</span><span title="akka.io.TcpConnection.ConnectionInfo">info</span>, <span title="None.type">None</span><span class="delimiter">)</span> <span class="comment">// immediately try reading, pullMode is handled by readingSuspended</span>
      <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.setReceiveTimeout" title="(timeout: scala.concurrent.duration.Duration)Unit">setReceiveTimeout</a><span class="delimiter">(</span><span title="scala.concurrent.duration.Duration.type">Duration</span>.<span title="=&gt; scala.concurrent.duration.Duration.Infinite">Undefined</span><span class="delimiter">)</span>
      <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.become(07b70b901c)" title="(behavior: akka.actor.Actor.Receive)Unit">become</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.connected" title="(info: akka.io.TcpConnection.ConnectionInfo)TcpConnection.this.Receive">connected</a><span class="delimiter">(</span><span title="akka.io.TcpConnection.ConnectionInfo">info</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.ResumeReading" title="akka.io.Tcp.ResumeReading.type">ResumeReading</a> ⇒
      <a href="#akka.io;TcpConnection.readingSuspended" title="Boolean">readingSuspended</a> = <span title="Boolean(false)" class="keyword">false</span>

    <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.SuspendReading" title="akka.io.Tcp.SuspendReading.type">SuspendReading</a> ⇒
      <a href="#akka.io;TcpConnection.readingSuspended" title="Boolean">readingSuspended</a> = <span title="Boolean(true)" class="keyword">true</span>

    <span class="keyword">case</span> <a title="akka.io.Tcp.CloseCommand" id="akka.io;TcpConnection.waitingForRegistration;$anonfun.isDefinedAt.cmd">cmd</a>: <a href="Tcp.scala.html#akka.io.Tcp;CloseCommand" title="akka.io.Tcp.CloseCommand">CloseCommand</a> ⇒
      <span class="keyword">val</span> <span title="akka.io.TcpConnection.ConnectionInfo">info</span> = <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="(registration: akka.io.ChannelRegistration, handler: akka.actor.ActorRef, keepOpenOnPeerClosed: Boolean, useResumeWriting: Boolean)akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.waitingForRegistration.registration" title="akka.io.ChannelRegistration">registration</a>, <a href="#akka.io;TcpConnection.waitingForRegistration.commander" title="akka.actor.ActorRef">commander</a>, keepOpenOnPeerClosed = <span title="Boolean(false)" class="keyword">false</span>, useResumeWriting = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
      <a href="#akka.io;TcpConnection.handleClose" title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)Unit">handleClose</a><span class="delimiter">(</span><span title="akka.io.TcpConnection.ConnectionInfo">info</span>, <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#akka.io;TcpConnection.waitingForRegistration;$anonfun.isDefinedAt.cmd" title="akka.io.Tcp.CloseCommand">cmd</a>.<a href="Tcp.scala.html#akka.io.Tcp;CloseCommand.event" title="=&gt; akka.io.Tcp.ConnectionClosed">event</a><span class="delimiter">)</span>

    <span class="keyword">case</span> <a href="../actor/Actor.scala.html#akka.actor.ReceiveTimeout" title="akka.actor.ReceiveTimeout.type">ReceiveTimeout</a> ⇒
      <span class="comment">// after sending `Register` user should watch this actor to make sure</span>
      <span class="comment">// it didn't die because of the timeout</span>
      <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Configured registration timeout of [{}] expired, stopping&quot;)" class="string">&quot;Configured registration timeout of [{}] expired, stopping&quot;</span>, <a href="Tcp.scala.html#akka.io;TcpExt;Settings.RegisterTimeout" title="=&gt; scala.concurrent.duration.Duration">RegisterTimeout</a><span class="delimiter">)</span>
      <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a><span class="delimiter">(</span><a href="../actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** normal connected state */</span>
  <span class="keyword">def</span> <a title="(info: akka.io.TcpConnection.ConnectionInfo)TcpConnection.this.Receive" id="akka.io;TcpConnection.connected">connected</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.ConnectionInfo" id="akka.io;TcpConnection.connected.info">info</a>: <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a><span class="delimiter">)</span>: <span title="TcpConnection.this.Receive">Receive</span> =
    <a href="#akka.io;TcpConnection.handleWriteMessages" title="(info: akka.io.TcpConnection.ConnectionInfo)TcpConnection.this.Receive">handleWriteMessages</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.connected.info" title="akka.io.TcpConnection.ConnectionInfo">info</a><span class="delimiter">)</span> <span title="(that: PartialFunction[Any,Unit])PartialFunction[Any,Unit]">orElse</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.io;TcpConnection.connected;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.SuspendReading" title="akka.io.Tcp.SuspendReading.type">SuspendReading</a>    ⇒ <a href="#akka.io;TcpConnection.suspendReading" title="(info: akka.io.TcpConnection.ConnectionInfo)Unit">suspendReading</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.connected.info" title="akka.io.TcpConnection.ConnectionInfo">info</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.ResumeReading" title="akka.io.Tcp.ResumeReading.type">ResumeReading</a>     ⇒ <a href="#akka.io;TcpConnection.resumeReading" title="(info: akka.io.TcpConnection.ConnectionInfo)Unit">resumeReading</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.connected.info" title="akka.io.TcpConnection.ConnectionInfo">info</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="SelectionHandler.scala.html#akka.io.SelectionHandler.ChannelReadable" title="akka.io.SelectionHandler.ChannelReadable.type">ChannelReadable</a>   ⇒ <a href="#akka.io;TcpConnection.doRead" title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef])Unit">doRead</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.connected.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>, <span title="None.type">None</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="akka.io.Tcp.CloseCommand" id="akka.io;TcpConnection.connected;$anonfun.isDefinedAt.cmd">cmd</a>: <a href="Tcp.scala.html#akka.io.Tcp;CloseCommand" title="akka.io.Tcp.CloseCommand">CloseCommand</a> ⇒ <a href="#akka.io;TcpConnection.handleClose" title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)Unit">handleClose</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.connected.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>, <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#akka.io;TcpConnection.connected;$anonfun.isDefinedAt.cmd" title="akka.io.Tcp.CloseCommand">cmd</a>.<a href="Tcp.scala.html#akka.io.Tcp;CloseCommand.event" title="=&gt; akka.io.Tcp.ConnectionClosed">event</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="comment">/** the peer sent EOF first, but we may still want to send */</span>
  <span class="keyword">def</span> <a title="(info: akka.io.TcpConnection.ConnectionInfo)TcpConnection.this.Receive" id="akka.io;TcpConnection.peerSentEOF">peerSentEOF</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.ConnectionInfo" id="akka.io;TcpConnection.peerSentEOF.info">info</a>: <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a><span class="delimiter">)</span>: <span title="TcpConnection.this.Receive">Receive</span> =
    <a href="#akka.io;TcpConnection.handleWriteMessages" title="(info: akka.io.TcpConnection.ConnectionInfo)TcpConnection.this.Receive">handleWriteMessages</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.peerSentEOF.info" title="akka.io.TcpConnection.ConnectionInfo">info</a><span class="delimiter">)</span> <span title="(that: PartialFunction[Any,Unit])PartialFunction[Any,Unit]">orElse</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.io;TcpConnection.peerSentEOF;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> <a title="akka.io.Tcp.CloseCommand" id="akka.io;TcpConnection.peerSentEOF;$anonfun.isDefinedAt.cmd">cmd</a>: <a href="Tcp.scala.html#akka.io.Tcp;CloseCommand" title="akka.io.Tcp.CloseCommand">CloseCommand</a> ⇒ <a href="#akka.io;TcpConnection.handleClose" title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)Unit">handleClose</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.peerSentEOF.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>, <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#akka.io;TcpConnection.peerSentEOF;$anonfun.isDefinedAt.cmd" title="akka.io.Tcp.CloseCommand">cmd</a>.<a href="Tcp.scala.html#akka.io.Tcp;CloseCommand.event" title="=&gt; akka.io.Tcp.ConnectionClosed">event</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="comment">/** connection is closing but a write has to be finished first */</span>
  <span class="keyword">def</span> <a title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)TcpConnection.this.Receive" id="akka.io;TcpConnection.closingWithPendingWrite">closingWithPendingWrite</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.ConnectionInfo" id="akka.io;TcpConnection.closingWithPendingWrite.info">info</a>: <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a>, <a title="Option[akka.actor.ActorRef]" id="akka.io;TcpConnection.closingWithPendingWrite.closeCommander">closeCommander</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span>,
                              <a title="akka.io.Tcp.ConnectionClosed" id="akka.io;TcpConnection.closingWithPendingWrite.closedEvent">closedEvent</a>: <a href="Tcp.scala.html#akka.io.Tcp;ConnectionClosed" title="akka.io.Tcp.ConnectionClosed">ConnectionClosed</a><span class="delimiter">)</span>: <span title="TcpConnection.this.Receive">Receive</span> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.io;TcpConnection.closingWithPendingWrite;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.SuspendReading" title="akka.io.Tcp.SuspendReading.type">SuspendReading</a>  ⇒ <a href="#akka.io;TcpConnection.suspendReading" title="(info: akka.io.TcpConnection.ConnectionInfo)Unit">suspendReading</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.closingWithPendingWrite.info" title="akka.io.TcpConnection.ConnectionInfo">info</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.ResumeReading" title="akka.io.Tcp.ResumeReading.type">ResumeReading</a>   ⇒ <a href="#akka.io;TcpConnection.resumeReading" title="(info: akka.io.TcpConnection.ConnectionInfo)Unit">resumeReading</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.closingWithPendingWrite.info" title="akka.io.TcpConnection.ConnectionInfo">info</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="SelectionHandler.scala.html#akka.io.SelectionHandler.ChannelReadable" title="akka.io.SelectionHandler.ChannelReadable.type">ChannelReadable</a> ⇒ <a href="#akka.io;TcpConnection.doRead" title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef])Unit">doRead</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.closingWithPendingWrite.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>, <a href="#akka.io;TcpConnection.closingWithPendingWrite.closeCommander" title="Option[akka.actor.ActorRef]">closeCommander</a><span class="delimiter">)</span>

    <span class="keyword">case</span> <a href="SelectionHandler.scala.html#akka.io.SelectionHandler.ChannelWritable" title="akka.io.SelectionHandler.ChannelWritable.type">ChannelWritable</a> ⇒
      <a href="#akka.io;TcpConnection.doWrite" title="(info: akka.io.TcpConnection.ConnectionInfo)Unit">doWrite</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.closingWithPendingWrite.info" title="akka.io.TcpConnection.ConnectionInfo">info</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.io;TcpConnection.writePending" title="=&gt; Boolean">writePending</a><span class="delimiter">)</span> <span class="comment">// writing is now finished</span>
        <a href="#akka.io;TcpConnection.handleClose" title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)Unit">handleClose</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.closingWithPendingWrite.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>, <a href="#akka.io;TcpConnection.closingWithPendingWrite.closeCommander" title="Option[akka.actor.ActorRef]">closeCommander</a>, <a href="#akka.io;TcpConnection.closingWithPendingWrite.closedEvent" title="akka.io.Tcp.ConnectionClosed">closedEvent</a><span class="delimiter">)</span>

    <span class="keyword">case</span> UpdatePendingWrite<span class="delimiter">(</span><a title="akka.io.TcpConnection.PendingWrite" id="akka.io;TcpConnection.closingWithPendingWrite;$anonfun.isDefinedAt.remaining">remaining</a><span class="delimiter">)</span> ⇒
      <a href="#akka.io;TcpConnection.pendingWrite" title="akka.io.TcpConnection.PendingWrite">pendingWrite</a> = <a href="#akka.io;TcpConnection.closingWithPendingWrite;$anonfun.isDefinedAt.remaining" title="akka.io.TcpConnection.PendingWrite">remaining</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.writePending" title="=&gt; Boolean">writePending</a><span class="delimiter">)</span> <a href="#akka.io;TcpConnection.closingWithPendingWrite.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.registration" title="=&gt; akka.io.ChannelRegistration">registration</a>.<a href="SelectionHandler.scala.html#akka.io;ChannelRegistration.enableInterest" title="(op: Int)Unit">enableInterest</a><span class="delimiter">(</span><span title="Int(4)">OP_WRITE</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="#akka.io;TcpConnection.handleClose" title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)Unit">handleClose</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.closingWithPendingWrite.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>, <a href="#akka.io;TcpConnection.closingWithPendingWrite.closeCommander" title="Option[akka.actor.ActorRef]">closeCommander</a>, <a href="#akka.io;TcpConnection.closingWithPendingWrite.closedEvent" title="akka.io.Tcp.ConnectionClosed">closedEvent</a><span class="delimiter">)</span>

    <span class="keyword">case</span> WriteFileFailed<span class="delimiter">(</span><a title="java.io.IOException" id="akka.io;TcpConnection.closingWithPendingWrite;$anonfun.isDefinedAt.e">e</a><span class="delimiter">)</span> ⇒ <a href="#akka.io;TcpConnection.handleError" title="(handler: akka.actor.ActorRef, exception: java.io.IOException)Unit">handleError</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.closingWithPendingWrite.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.handler" title="=&gt; akka.actor.ActorRef">handler</a>, <a href="#akka.io;TcpConnection.closingWithPendingWrite;$anonfun.isDefinedAt.e" title="java.io.IOException">e</a><span class="delimiter">)</span> <span class="comment">// rethrow exception from dispatcher task</span>

    <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.Abort" title="akka.io.Tcp.Abort.type">Abort</a>              ⇒ <a href="#akka.io;TcpConnection.handleClose" title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)Unit">handleClose</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.closingWithPendingWrite.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>, <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="Tcp.scala.html#akka.io.Tcp.Aborted" title="akka.io.Tcp.Aborted.type">Aborted</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** connection is closed on our side and we're waiting from confirmation from the other side */</span>
  <span class="keyword">def</span> <a title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef])TcpConnection.this.Receive" id="akka.io;TcpConnection.closing">closing</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.ConnectionInfo" id="akka.io;TcpConnection.closing.info">info</a>: <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a>, <a title="Option[akka.actor.ActorRef]" id="akka.io;TcpConnection.closing.closeCommander">closeCommander</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="TcpConnection.this.Receive">Receive</span> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.io;TcpConnection.closing;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.SuspendReading" title="akka.io.Tcp.SuspendReading.type">SuspendReading</a>  ⇒ <a href="#akka.io;TcpConnection.suspendReading" title="(info: akka.io.TcpConnection.ConnectionInfo)Unit">suspendReading</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.closing.info" title="akka.io.TcpConnection.ConnectionInfo">info</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.ResumeReading" title="akka.io.Tcp.ResumeReading.type">ResumeReading</a>   ⇒ <a href="#akka.io;TcpConnection.resumeReading" title="(info: akka.io.TcpConnection.ConnectionInfo)Unit">resumeReading</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.closing.info" title="akka.io.TcpConnection.ConnectionInfo">info</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="SelectionHandler.scala.html#akka.io.SelectionHandler.ChannelReadable" title="akka.io.SelectionHandler.ChannelReadable.type">ChannelReadable</a> ⇒ <a href="#akka.io;TcpConnection.doRead" title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef])Unit">doRead</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.closing.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>, <a href="#akka.io;TcpConnection.closing.closeCommander" title="Option[akka.actor.ActorRef]">closeCommander</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.Abort" title="akka.io.Tcp.Abort.type">Abort</a>           ⇒ <a href="#akka.io;TcpConnection.handleClose" title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)Unit">handleClose</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.closing.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>, <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="Tcp.scala.html#akka.io.Tcp.Aborted" title="akka.io.Tcp.Aborted.type">Aborted</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(info: akka.io.TcpConnection.ConnectionInfo)TcpConnection.this.Receive" id="akka.io;TcpConnection.handleWriteMessages">handleWriteMessages</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.ConnectionInfo" id="akka.io;TcpConnection.handleWriteMessages.info">info</a>: <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a><span class="delimiter">)</span>: <span title="TcpConnection.this.Receive">Receive</span> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.io;TcpConnection.handleWriteMessages;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> <a href="SelectionHandler.scala.html#akka.io.SelectionHandler.ChannelWritable" title="akka.io.SelectionHandler.ChannelWritable.type">ChannelWritable</a> ⇒
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.writePending" title="=&gt; Boolean">writePending</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.io;TcpConnection.doWrite" title="(info: akka.io.TcpConnection.ConnectionInfo)Unit">doWrite</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.handleWriteMessages.info" title="akka.io.TcpConnection.ConnectionInfo">info</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.io;TcpConnection.writePending" title="=&gt; Boolean">writePending</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.io;TcpConnection.interestedInResume" title="Option[akka.actor.ActorRef]">interestedInResume</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#akka.io;TcpConnection.interestedInResume" title="Option[akka.actor.ActorRef]">interestedInResume</a>.<a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">get</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="Tcp.scala.html#akka.io.Tcp.WritingResumed" title="akka.io.Tcp.WritingResumed.type">WritingResumed</a>
          <a href="#akka.io;TcpConnection.interestedInResume" title="Option[akka.actor.ActorRef]">interestedInResume</a> = <span title="None.type">None</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="keyword">case</span> <a title="akka.io.Tcp.WriteCommand" id="akka.io;TcpConnection.handleWriteMessages;$anonfun.isDefinedAt.write">write</a>: <a href="Tcp.scala.html#akka.io.Tcp;WriteCommand" title="akka.io.Tcp.WriteCommand">WriteCommand</a> ⇒
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.writingSuspended" title="Boolean">writingSuspended</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="SelectionHandler.scala.html#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Dropping write because writing is suspended&quot;)" class="string">&quot;Dropping write because writing is suspended&quot;</span><span class="delimiter">)</span>
        <a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.io;TcpConnection.handleWriteMessages;$anonfun.isDefinedAt.write" title="akka.io.Tcp.WriteCommand">write</a>.<a href="Tcp.scala.html#akka.io.Tcp;Command.failureMessage" title="=&gt; akka.io.Tcp.CommandFailed">failureMessage</a>

      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.writePending" title="=&gt; Boolean">writePending</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="SelectionHandler.scala.html#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Dropping write because queue is full&quot;)" class="string">&quot;Dropping write because queue is full&quot;</span><span class="delimiter">)</span>
        <a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.io;TcpConnection.handleWriteMessages;$anonfun.isDefinedAt.write" title="akka.io.Tcp.WriteCommand">write</a>.<a href="Tcp.scala.html#akka.io.Tcp;Command.failureMessage" title="=&gt; akka.io.Tcp.CommandFailed">failureMessage</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.handleWriteMessages.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.useResumeWriting" title="=&gt; Boolean">useResumeWriting</a><span class="delimiter">)</span> <a href="#akka.io;TcpConnection.writingSuspended" title="Boolean">writingSuspended</a> = <span title="Boolean(true)" class="keyword">true</span>

      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#akka.io;TcpConnection.pendingWrite" title="akka.io.TcpConnection.PendingWrite">pendingWrite</a> = <a href="#akka.io;TcpConnection.PendingWrite" title="(commander: akka.actor.ActorRef, write: akka.io.Tcp.WriteCommand)akka.io.TcpConnection.PendingWrite">PendingWrite</a><span class="delimiter">(</span><a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#akka.io;TcpConnection.handleWriteMessages;$anonfun.isDefinedAt.write" title="akka.io.Tcp.WriteCommand">write</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.writePending" title="=&gt; Boolean">writePending</a><span class="delimiter">)</span> <a href="#akka.io;TcpConnection.doWrite" title="(info: akka.io.TcpConnection.ConnectionInfo)Unit">doWrite</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.handleWriteMessages.info" title="akka.io.TcpConnection.ConnectionInfo">info</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.ResumeWriting" title="akka.io.Tcp.ResumeWriting.type">ResumeWriting</a> ⇒
      <span class="comment">/*
       * If more than one actor sends Writes then the first to send this
       * message might resume too early for the second, leading to a Write of
       * the second to go through although it has not been resumed yet; there
       * is nothing we can do about this apart from all actors needing to
       * register themselves and us keeping track of them, which sounds bad.
       *
       * Thus it is documented that useResumeWriting is incompatible with
       * multiple writers. But we fail as gracefully as we can.
       */</span>
      <a href="#akka.io;TcpConnection.writingSuspended" title="Boolean">writingSuspended</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.writePending" title="=&gt; Boolean">writePending</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.interestedInResume" title="Option[akka.actor.ActorRef]">interestedInResume</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#akka.io;TcpConnection.interestedInResume" title="Option[akka.actor.ActorRef]">interestedInResume</a> = <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">else</span> <a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="Tcp.scala.html#akka.io.Tcp;CommandFailed" title="(cmd: akka.io.Tcp.Command)akka.io.Tcp.CommandFailed">CommandFailed</a><span class="delimiter">(</span><a href="Tcp.scala.html#akka.io.Tcp.ResumeWriting" title="akka.io.Tcp.ResumeWriting.type">ResumeWriting</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="Tcp.scala.html#akka.io.Tcp.WritingResumed" title="akka.io.Tcp.WritingResumed.type">WritingResumed</a>

    <span class="keyword">case</span> UpdatePendingWrite<span class="delimiter">(</span><a title="akka.io.TcpConnection.PendingWrite" id="akka.io;TcpConnection.handleWriteMessages;$anonfun.isDefinedAt.remaining">remaining</a><span class="delimiter">)</span> ⇒
      <a href="#akka.io;TcpConnection.pendingWrite" title="akka.io.TcpConnection.PendingWrite">pendingWrite</a> = <a href="#akka.io;TcpConnection.handleWriteMessages;$anonfun.isDefinedAt.remaining" title="akka.io.TcpConnection.PendingWrite">remaining</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.writePending" title="=&gt; Boolean">writePending</a><span class="delimiter">)</span> <a href="#akka.io;TcpConnection.handleWriteMessages.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.registration" title="=&gt; akka.io.ChannelRegistration">registration</a>.<a href="SelectionHandler.scala.html#akka.io;ChannelRegistration.enableInterest" title="(op: Int)Unit">enableInterest</a><span class="delimiter">(</span><span title="Int(4)">OP_WRITE</span><span class="delimiter">)</span>

    <span class="keyword">case</span> WriteFileFailed<span class="delimiter">(</span><a title="java.io.IOException" id="akka.io;TcpConnection.handleWriteMessages;$anonfun.isDefinedAt.e">e</a><span class="delimiter">)</span> ⇒ <a href="#akka.io;TcpConnection.handleError" title="(handler: akka.actor.ActorRef, exception: java.io.IOException)Unit">handleError</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;TcpConnection.handleWriteMessages.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.handler" title="=&gt; akka.actor.ActorRef">handler</a>, <a href="#akka.io;TcpConnection.handleWriteMessages;$anonfun.isDefinedAt.e" title="java.io.IOException">e</a><span class="delimiter">)</span> <span class="comment">// rethrow exception from dispatcher task</span>
  <span class="delimiter">}</span>

  <span class="comment">// AUXILIARIES and IMPLEMENTATION</span>

  <span class="comment">/** used in subclasses to start the common machinery above once a channel is connected */</span>
  <span class="keyword">def</span> <a title="(registration: akka.io.ChannelRegistration, commander: akka.actor.ActorRef, options: scala.collection.immutable.Traversable[akka.io.Inet.SocketOption])Unit" id="akka.io;TcpConnection.completeConnect">completeConnect</a><span class="delimiter">(</span><a title="akka.io.ChannelRegistration" id="akka.io;TcpConnection.completeConnect.registration">registration</a>: <a href="SelectionHandler.scala.html#akka.io;ChannelRegistration" title="akka.io.ChannelRegistration">ChannelRegistration</a>, <a title="akka.actor.ActorRef" id="akka.io;TcpConnection.completeConnect.commander">commander</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>,
                      <a title="scala.collection.immutable.Traversable[akka.io.Inet.SocketOption]" id="akka.io;TcpConnection.completeConnect.options">options</a>: immutable.<span title="scala.collection.immutable.Traversable[akka.io.Inet.SocketOption]">Traversable</span><span class="delimiter">[</span>SocketOption<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="comment">// Turn off Nagle's algorithm by default</span>
    <a href="#akka.io;TcpConnection.channel" title="=&gt; java.nio.channels.SocketChannel">channel</a>.<span title="()java.net.Socket">socket</span>.<span title="(x$1: Boolean)Unit">setTcpNoDelay</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
    <a href="#akka.io;TcpConnection.completeConnect.options" title="scala.collection.immutable.Traversable[akka.io.Inet.SocketOption]">options</a>.<span title="(f: akka.io.Inet.SocketOption =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#akka.io;TcpConnection.completeConnect.$anonfun.x$1" title="akka.io.Inet.SocketOption">_</a>.<a href="Inet.scala.html#akka.io.Inet;SocketOption.afterConnect" title="(s: java.net.Socket)Unit">afterConnect</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.channel" title="=&gt; java.nio.channels.SocketChannel">channel</a>.<span title="()java.net.Socket">socket</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">commander</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="Tcp.scala.html#akka.io.Tcp;Connected" title="(remoteAddress: java.net.InetSocketAddress, localAddress: java.net.InetSocketAddress)akka.io.Tcp.Connected">Connected</a><span class="delimiter">(</span>
      <a href="#akka.io;TcpConnection.channel" title="=&gt; java.nio.channels.SocketChannel">channel</a>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.SocketAddress">getRemoteSocketAddress</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="java.net.InetSocketAddress" class="delimiter">[</span><span title="java.net.InetSocketAddress">InetSocketAddress</span><span class="delimiter">]</span>,
      <a href="#akka.io;TcpConnection.channel" title="=&gt; java.nio.channels.SocketChannel">channel</a>.<span title="()java.net.Socket">socket</span>.<span title="()java.net.SocketAddress">getLocalSocketAddress</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="java.net.InetSocketAddress" class="delimiter">[</span><span title="java.net.InetSocketAddress">InetSocketAddress</span><span class="delimiter">]</span><span class="delimiter">)</span>

    <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.setReceiveTimeout" title="(timeout: scala.concurrent.duration.Duration)Unit">setReceiveTimeout</a><span class="delimiter">(</span><a href="Tcp.scala.html#akka.io;TcpExt;Settings.RegisterTimeout" title="=&gt; scala.concurrent.duration.Duration">RegisterTimeout</a><span class="delimiter">)</span>
    <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.become(07b70b901c)" title="(behavior: akka.actor.Actor.Receive)Unit">become</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.waitingForRegistration" title="(registration: akka.io.ChannelRegistration, commander: akka.actor.ActorRef)TcpConnection.this.Receive">waitingForRegistration</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.completeConnect.registration" title="akka.io.ChannelRegistration">registration</a>, <a href="#akka.io;TcpConnection.completeConnect.commander" title="akka.actor.ActorRef">commander</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(info: akka.io.TcpConnection.ConnectionInfo)Unit" id="akka.io;TcpConnection.suspendReading">suspendReading</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.ConnectionInfo" id="akka.io;TcpConnection.suspendReading.info">info</a>: <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.io;TcpConnection.readingSuspended" title="Boolean">readingSuspended</a> = <span title="Boolean(true)" class="keyword">true</span>
    <a href="#akka.io;TcpConnection.suspendReading.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.registration" title="=&gt; akka.io.ChannelRegistration">registration</a>.<a href="SelectionHandler.scala.html#akka.io;ChannelRegistration.disableInterest" title="(op: Int)Unit">disableInterest</a><span class="delimiter">(</span><span title="Int(1)">OP_READ</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(info: akka.io.TcpConnection.ConnectionInfo)Unit" id="akka.io;TcpConnection.resumeReading">resumeReading</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.ConnectionInfo" id="akka.io;TcpConnection.resumeReading.info">info</a>: <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.io;TcpConnection.readingSuspended" title="Boolean">readingSuspended</a> = <span title="Boolean(false)" class="keyword">false</span>
    <a href="#akka.io;TcpConnection.resumeReading.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.registration" title="=&gt; akka.io.ChannelRegistration">registration</a>.<a href="SelectionHandler.scala.html#akka.io;ChannelRegistration.enableInterest" title="(op: Int)Unit">enableInterest</a><span class="delimiter">(</span><span title="Int(1)">OP_READ</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef])Unit" id="akka.io;TcpConnection.doRead">doRead</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.ConnectionInfo" id="akka.io;TcpConnection.doRead.info">info</a>: <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a>, <a title="Option[akka.actor.ActorRef]" id="akka.io;TcpConnection.doRead.closeCommander">closeCommander</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.io;TcpConnection.readingSuspended" title="Boolean">readingSuspended</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      @tailrec <span class="keyword">def</span> <a title="(buffer: java.nio.ByteBuffer, remainingLimit: Int)akka.io.TcpConnection.ReadResult" id="akka.io;TcpConnection.doRead.innerRead">innerRead</a><span class="delimiter">(</span><a title="java.nio.ByteBuffer" id="akka.io;TcpConnection.doRead.innerRead.buffer">buffer</a>: <span title="java.nio.ByteBuffer">ByteBuffer</span>, <a title="Int" id="akka.io;TcpConnection.doRead.innerRead.remainingLimit">remainingLimit</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="#akka.io.TcpConnection;ReadResult" title="akka.io.TcpConnection.ReadResult">ReadResult</a> =
        <span title="akka.io.TcpConnection.ReadResult" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.doRead.innerRead.remainingLimit" title="Int">remainingLimit</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="comment">// never read more than the configured limit</span>
          <a href="#akka.io;TcpConnection.doRead.innerRead.buffer" title="java.nio.ByteBuffer">buffer</a>.<span title="()java.nio.Buffer">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Int" id="akka.io;TcpConnection.doRead.innerRead.maxBufferSpace">maxBufferSpace</a> = math.<span title="(x: Int, y: Int)Int">min</span><span class="delimiter">(</span><a href="Tcp.scala.html#akka.io;TcpExt;Settings.DirectBufferSize" title="=&gt; Int">DirectBufferSize</a>, <a href="#akka.io;TcpConnection.doRead.innerRead.remainingLimit" title="Int">remainingLimit</a><span class="delimiter">)</span>
          <a href="#akka.io;TcpConnection.doRead.innerRead.buffer" title="java.nio.ByteBuffer">buffer</a>.<span title="(x$1: Int)java.nio.Buffer">limit</span><span class="delimiter">(</span><a href="#akka.io;TcpConnection.doRead.innerRead.maxBufferSpace" title="Int">maxBufferSpace</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Int" id="akka.io;TcpConnection.doRead.innerRead.readBytes">readBytes</a> = <a href="#akka.io;TcpConnection.channel" title="=&gt; java.nio.channels.SocketChannel">channel</a>.<span title="(x$1: java.nio.ByteBuffer)Int">read</span><span class="delimiter">(</span><a href="#akka.io;TcpConnection.doRead.innerRead.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
          <a href="#akka.io;TcpConnection.doRead.innerRead.buffer" title="java.nio.ByteBuffer">buffer</a>.<span title="()java.nio.Buffer">flip</span><span class="delimiter">(</span><span class="delimiter">)</span>

          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="SelectionHandler.scala.html#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Read [{}] bytes.&quot;)" class="string">&quot;Read [{}] bytes.&quot;</span>, <a href="#akka.io;TcpConnection.doRead.innerRead.readBytes" title="Int">readBytes</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.doRead.innerRead.readBytes" title="Int">readBytes</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#akka.io;TcpConnection.doRead.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">handler</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="Tcp.scala.html#akka.io.Tcp;Received" title="(data: akka.util.ByteString)akka.io.Tcp.Received">Received</a><span class="delimiter">(</span><a href="../util/ByteString.scala.html#akka.util.ByteString.apply(f4bb008516)" title="(bytes: java.nio.ByteBuffer)akka.util.ByteString">ByteString</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.doRead.innerRead.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <a href="#akka.io;TcpConnection.doRead.innerRead.readBytes" title="Int">readBytes</a> <span title="akka.io.TcpConnection.ReadResult" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#akka.io;TcpConnection.doRead.innerRead.maxBufferSpace" title="Int">`maxBufferSpace`</a> ⇒ <a href="#akka.io;TcpConnection.doRead.innerRead" title="(buffer: java.nio.ByteBuffer, remainingLimit: Int)akka.io.TcpConnection.ReadResult">innerRead</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.doRead.innerRead.buffer" title="java.nio.ByteBuffer">buffer</a>, <a href="#akka.io;TcpConnection.doRead.innerRead.remainingLimit" title="Int">remainingLimit</a> <span title="(x: Int)Int">-</span> <a href="#akka.io;TcpConnection.doRead.innerRead.maxBufferSpace" title="Int">maxBufferSpace</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <a title="Int" id="akka.io;TcpConnection.doRead.innerRead.x">x</a> <span class="keyword">if</span> <a href="#akka.io;TcpConnection.doRead.innerRead.x" title="Int">x</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span>      ⇒ <a href="#akka.io.TcpConnection.AllRead" title="akka.io.TcpConnection.AllRead.type">AllRead</a>
            <span class="keyword">case</span> <span title="Int(-1)">-</span><span class="int">1</span>               ⇒ <a href="#akka.io.TcpConnection.EndOfStream" title="akka.io.TcpConnection.EndOfStream.type">EndOfStream</a>
            <span class="keyword">case</span> _ ⇒
              <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IllegalStateException" class="keyword">new</span> <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;Unexpected value returned from read: &quot;)" class="string">&quot;Unexpected value returned from read: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.io;TcpConnection.doRead.innerRead.readBytes" title="Int">readBytes</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#akka.io.TcpConnection.MoreDataWaiting" title="akka.io.TcpConnection.MoreDataWaiting.type">MoreDataWaiting</a>

      <span class="keyword">val</span> <a title="java.nio.ByteBuffer" id="akka.io;TcpConnection.doRead.buffer">buffer</a> = <a href="Tcp.scala.html#akka.io;TcpExt.bufferPool" title="=&gt; akka.io.BufferPool">bufferPool</a>.<a href="DirectByteBufferPool.scala.html#akka.io;BufferPool.acquire" title="()java.nio.ByteBuffer">acquire</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">try</span> <a href="#akka.io;TcpConnection.doRead.innerRead" title="(buffer: java.nio.ByteBuffer, remainingLimit: Int)akka.io.TcpConnection.ReadResult">innerRead</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.doRead.buffer" title="java.nio.ByteBuffer">buffer</a>, <a href="Tcp.scala.html#akka.io;TcpExt;Settings.ReceivedMessageSizeLimit" title="=&gt; Int">ReceivedMessageSizeLimit</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#akka.io.TcpConnection.AllRead" title="akka.io.TcpConnection.AllRead.type">AllRead</a> ⇒
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.io;TcpConnection.pullMode" title="=&gt; Boolean">pullMode</a><span class="delimiter">)</span> <a href="#akka.io;TcpConnection.doRead.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.registration" title="=&gt; akka.io.ChannelRegistration">registration</a>.<a href="SelectionHandler.scala.html#akka.io;ChannelRegistration.enableInterest" title="(op: Int)Unit">enableInterest</a><span class="delimiter">(</span><span title="Int(1)">OP_READ</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#akka.io.TcpConnection.MoreDataWaiting" title="akka.io.TcpConnection.MoreDataWaiting.type">MoreDataWaiting</a> ⇒
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.io;TcpConnection.pullMode" title="=&gt; Boolean">pullMode</a><span class="delimiter">)</span> <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">self</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="SelectionHandler.scala.html#akka.io.SelectionHandler.ChannelReadable" title="akka.io.SelectionHandler.ChannelReadable.type">ChannelReadable</a>
        <span class="keyword">case</span> <a href="#akka.io.TcpConnection.EndOfStream" title="akka.io.TcpConnection.EndOfStream.type">EndOfStream</a> <span class="keyword">if</span> <a href="#akka.io;TcpConnection.channel" title="=&gt; java.nio.channels.SocketChannel">channel</a>.<span title="()java.net.Socket">socket</span>.<span title="()Boolean">isOutputShutdown</span> ⇒
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="SelectionHandler.scala.html#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Read returned end-of-stream, our side already closed&quot;)" class="string">&quot;Read returned end-of-stream, our side already closed&quot;</span><span class="delimiter">)</span>
          <a href="#akka.io;TcpConnection.doCloseConnection" title="(handler: akka.actor.ActorRef, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)Unit">doCloseConnection</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.doRead.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.handler" title="=&gt; akka.actor.ActorRef">handler</a>, <a href="#akka.io;TcpConnection.doRead.closeCommander" title="Option[akka.actor.ActorRef]">closeCommander</a>, <a href="Tcp.scala.html#akka.io.Tcp.ConfirmedClosed" title="akka.io.Tcp.ConfirmedClosed.type">ConfirmedClosed</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#akka.io.TcpConnection.EndOfStream" title="akka.io.TcpConnection.EndOfStream.type">EndOfStream</a> ⇒
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="SelectionHandler.scala.html#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Read returned end-of-stream, our side not yet closed&quot;)" class="string">&quot;Read returned end-of-stream, our side not yet closed&quot;</span><span class="delimiter">)</span>
          <a href="#akka.io;TcpConnection.handleClose" title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)Unit">handleClose</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.doRead.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>, <a href="#akka.io;TcpConnection.doRead.closeCommander" title="Option[akka.actor.ActorRef]">closeCommander</a>, <a href="Tcp.scala.html#akka.io.Tcp.PeerClosed" title="akka.io.Tcp.PeerClosed.type">PeerClosed</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="java.io.IOException" id="akka.io;TcpConnection.doRead.e">e</a>: <span title="java.io.IOException">IOException</span> ⇒ <a href="#akka.io;TcpConnection.handleError" title="(handler: akka.actor.ActorRef, exception: java.io.IOException)Unit">handleError</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.doRead.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.handler" title="=&gt; akka.actor.ActorRef">handler</a>, <a href="#akka.io;TcpConnection.doRead.e" title="java.io.IOException">e</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">finally</span> <a href="Tcp.scala.html#akka.io;TcpExt.bufferPool" title="=&gt; akka.io.BufferPool">bufferPool</a>.<a href="DirectByteBufferPool.scala.html#akka.io;BufferPool.release" title="(buf: java.nio.ByteBuffer)Unit">release</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.doRead.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(info: akka.io.TcpConnection.ConnectionInfo)Unit" id="akka.io;TcpConnection.doWrite">doWrite</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.ConnectionInfo" id="akka.io;TcpConnection.doWrite.info">info</a>: <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.io;TcpConnection.pendingWrite" title="akka.io.TcpConnection.PendingWrite">pendingWrite</a> = <a href="#akka.io;TcpConnection.pendingWrite" title="akka.io.TcpConnection.PendingWrite">pendingWrite</a>.<a href="#akka.io.TcpConnection;PendingWrite.doWrite" title="(info: akka.io.TcpConnection.ConnectionInfo)akka.io.TcpConnection.PendingWrite">doWrite</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.doWrite.info" title="akka.io.TcpConnection.ConnectionInfo">info</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; akka.io.Tcp.ConnectionClosed with Product with Serializable" id="akka.io;TcpConnection.closeReason">closeReason</a> =
    <span title="&lt;root&gt; extends akka.io.Tcp.ConnectionClosed with Product with Serializable" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.channel" title="=&gt; java.nio.channels.SocketChannel">channel</a>.<span title="()java.net.Socket">socket</span>.<span title="()Boolean">isOutputShutdown</span><span class="delimiter">)</span> <a href="Tcp.scala.html#akka.io.Tcp.ConfirmedClosed" title="akka.io.Tcp.ConfirmedClosed.type">ConfirmedClosed</a>
    <span class="keyword">else</span> <a href="Tcp.scala.html#akka.io.Tcp.PeerClosed" title="akka.io.Tcp.PeerClosed.type">PeerClosed</a>

  <span class="keyword">def</span> <a title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)Unit" id="akka.io;TcpConnection.handleClose">handleClose</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.ConnectionInfo" id="akka.io;TcpConnection.handleClose.info">info</a>: <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a>, <a title="Option[akka.actor.ActorRef]" id="akka.io;TcpConnection.handleClose.closeCommander">closeCommander</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span>,
                  <a title="akka.io.Tcp.ConnectionClosed" id="akka.io;TcpConnection.handleClose.closedEvent">closedEvent</a>: <a href="Tcp.scala.html#akka.io.Tcp;ConnectionClosed" title="akka.io.Tcp.ConnectionClosed">ConnectionClosed</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.io;TcpConnection.handleClose.closedEvent" title="akka.io.Tcp.ConnectionClosed">closedEvent</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.Aborted" title="akka.io.Tcp.Aborted.type">Aborted</a> ⇒
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="SelectionHandler.scala.html#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Got Abort command. RESETing connection.&quot;)" class="string">&quot;Got Abort command. RESETing connection.&quot;</span><span class="delimiter">)</span>
      <a href="#akka.io;TcpConnection.doCloseConnection" title="(handler: akka.actor.ActorRef, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)Unit">doCloseConnection</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.handleClose.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.handler" title="=&gt; akka.actor.ActorRef">handler</a>, <a href="#akka.io;TcpConnection.handleClose.closeCommander" title="Option[akka.actor.ActorRef]">closeCommander</a>, <a href="#akka.io;TcpConnection.handleClose.closedEvent" title="akka.io.Tcp.ConnectionClosed">closedEvent</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.PeerClosed" title="akka.io.Tcp.PeerClosed.type">PeerClosed</a> <span class="keyword">if</span> <a href="#akka.io;TcpConnection.handleClose.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.keepOpenOnPeerClosed" title="=&gt; Boolean">keepOpenOnPeerClosed</a> ⇒
      <span class="comment">// report that peer closed the connection</span>
      <a href="#akka.io;TcpConnection.handleClose.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">handler</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="Tcp.scala.html#akka.io.Tcp.PeerClosed" title="akka.io.Tcp.PeerClosed.type">PeerClosed</a>
      <span class="comment">// used to check if peer already closed its side later</span>
      <a href="#akka.io;TcpConnection.peerClosed" title="Boolean">peerClosed</a> = <span title="Boolean(true)" class="keyword">true</span>
      <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.become(07b70b901c)" title="(behavior: akka.actor.Actor.Receive)Unit">become</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.peerSentEOF" title="(info: akka.io.TcpConnection.ConnectionInfo)TcpConnection.this.Receive">peerSentEOF</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.handleClose.info" title="akka.io.TcpConnection.ConnectionInfo">info</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> _ <span class="keyword">if</span> <a href="#akka.io;TcpConnection.writePending" title="=&gt; Boolean">writePending</a> ⇒ <span class="comment">// finish writing first</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="SelectionHandler.scala.html#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Got Close command but write is still pending.&quot;)" class="string">&quot;Got Close command but write is still pending.&quot;</span><span class="delimiter">)</span>
      <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.become(07b70b901c)" title="(behavior: akka.actor.Actor.Receive)Unit">become</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.closingWithPendingWrite" title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)TcpConnection.this.Receive">closingWithPendingWrite</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.handleClose.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>, <a href="#akka.io;TcpConnection.handleClose.closeCommander" title="Option[akka.actor.ActorRef]">closeCommander</a>, <a href="#akka.io;TcpConnection.handleClose.closedEvent" title="akka.io.Tcp.ConnectionClosed">closedEvent</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.ConfirmedClosed" title="akka.io.Tcp.ConfirmedClosed.type">ConfirmedClosed</a> ⇒ <span class="comment">// shutdown output and wait for confirmation</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="SelectionHandler.scala.html#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Got ConfirmedClose command, sending FIN.&quot;)" class="string">&quot;Got ConfirmedClose command, sending FIN.&quot;</span><span class="delimiter">)</span>

      <span class="comment">// If peer closed first, the socket is now fully closed.</span>
      <span class="comment">// Also, if shutdownOutput threw an exception we expect this to be an indication</span>
      <span class="comment">// that the peer closed first or concurrently with this code running.</span>
      <span class="comment">// also see http://bugs.sun.com/view_bug.do?bug_id=4516760</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.peerClosed" title="Boolean">peerClosed</a> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><a href="#akka.io;TcpConnection.safeShutdownOutput" title="()Boolean">safeShutdownOutput</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.io;TcpConnection.doCloseConnection" title="(handler: akka.actor.ActorRef, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)Unit">doCloseConnection</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.handleClose.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.handler" title="=&gt; akka.actor.ActorRef">handler</a>, <a href="#akka.io;TcpConnection.handleClose.closeCommander" title="Option[akka.actor.ActorRef]">closeCommander</a>, <a href="#akka.io;TcpConnection.handleClose.closedEvent" title="akka.io.Tcp.ConnectionClosed">closedEvent</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.become(07b70b901c)" title="(behavior: akka.actor.Actor.Receive)Unit">become</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.closing" title="(info: akka.io.TcpConnection.ConnectionInfo, closeCommander: Option[akka.actor.ActorRef])TcpConnection.this.Receive">closing</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.handleClose.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>, <a href="#akka.io;TcpConnection.handleClose.closeCommander" title="Option[akka.actor.ActorRef]">closeCommander</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> _ ⇒ <span class="comment">// close now</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="SelectionHandler.scala.html#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Got Close command, closing connection.&quot;)" class="string">&quot;Got Close command, closing connection.&quot;</span><span class="delimiter">)</span>
      <a href="#akka.io;TcpConnection.doCloseConnection" title="(handler: akka.actor.ActorRef, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)Unit">doCloseConnection</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.handleClose.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.handler" title="=&gt; akka.actor.ActorRef">handler</a>, <a href="#akka.io;TcpConnection.handleClose.closeCommander" title="Option[akka.actor.ActorRef]">closeCommander</a>, <a href="#akka.io;TcpConnection.handleClose.closedEvent" title="akka.io.Tcp.ConnectionClosed">closedEvent</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(handler: akka.actor.ActorRef, closeCommander: Option[akka.actor.ActorRef], closedEvent: akka.io.Tcp.ConnectionClosed)Unit" id="akka.io;TcpConnection.doCloseConnection">doCloseConnection</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.io;TcpConnection.doCloseConnection.handler">handler</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Option[akka.actor.ActorRef]" id="akka.io;TcpConnection.doCloseConnection.closeCommander">closeCommander</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span>, <a title="akka.io.Tcp.ConnectionClosed" id="akka.io;TcpConnection.doCloseConnection.closedEvent">closedEvent</a>: <a href="Tcp.scala.html#akka.io.Tcp;ConnectionClosed" title="akka.io.Tcp.ConnectionClosed">ConnectionClosed</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.doCloseConnection.closedEvent" title="akka.io.Tcp.ConnectionClosed">closedEvent</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="Tcp.scala.html#akka.io.Tcp.Aborted" title="akka.io.Tcp.Aborted.type">Aborted</a><span class="delimiter">)</span> <a href="#akka.io;TcpConnection.abort" title="()Unit">abort</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#akka.io;TcpConnection.channel" title="=&gt; java.nio.channels.SocketChannel">channel</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.io;TcpConnection.stopWith" title="(closeInfo: akka.io.TcpConnection.CloseInformation)Unit">stopWith</a><span class="delimiter">(</span><a href="#akka.io.TcpConnection.CloseInformation.readResolve" title="(notificationsTo: Set[akka.actor.ActorRef], closedEvent: akka.io.Tcp.Event)akka.io.TcpConnection.CloseInformation">CloseInformation</a><span class="delimiter">(</span><span title="(elems: akka.actor.ActorRef*)scala.collection.immutable.Set[akka.actor.ActorRef]">Set</span><span class="delimiter">(</span><a href="#akka.io;TcpConnection.doCloseConnection.handler" title="akka.actor.ActorRef">handler</a><span class="delimiter">)</span> <span title="(elems: scala.collection.GenTraversableOnce[akka.actor.ActorRef])scala.collection.immutable.Set[akka.actor.ActorRef]">++</span> <a href="#akka.io;TcpConnection.doCloseConnection.closeCommander" title="(xo: Option[akka.actor.ActorRef])Iterable[akka.actor.ActorRef]">closeCommander</a>, <a href="#akka.io;TcpConnection.doCloseConnection.closedEvent" title="akka.io.Tcp.ConnectionClosed">closedEvent</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(handler: akka.actor.ActorRef, exception: java.io.IOException)Unit" id="akka.io;TcpConnection.handleError">handleError</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.io;TcpConnection.handleError.handler">handler</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="java.io.IOException" id="akka.io;TcpConnection.handleError.exception">exception</a>: <span title="java.io.IOException">IOException</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Closing connection due to IO error {}&quot;)" class="string">&quot;Closing connection due to IO error {}&quot;</span>, <a href="#akka.io;TcpConnection.handleError.exception" title="java.io.IOException">exception</a><span class="delimiter">)</span>
    <a href="#akka.io;TcpConnection.stopWith" title="(closeInfo: akka.io.TcpConnection.CloseInformation)Unit">stopWith</a><span class="delimiter">(</span><a href="#akka.io.TcpConnection.CloseInformation.readResolve" title="(notificationsTo: Set[akka.actor.ActorRef], closedEvent: akka.io.Tcp.Event)akka.io.TcpConnection.CloseInformation">CloseInformation</a><span class="delimiter">(</span><span title="(elems: akka.actor.ActorRef*)scala.collection.immutable.Set[akka.actor.ActorRef]">Set</span><span class="delimiter">(</span><a href="#akka.io;TcpConnection.handleError.handler" title="akka.actor.ActorRef">handler</a><span class="delimiter">)</span>, <a href="Tcp.scala.html#akka.io.Tcp;ErrorClosed" title="(cause: String)akka.io.Tcp.ErrorClosed">ErrorClosed</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.extractMsg" title="(t: Throwable)String">extractMsg</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.handleError.exception" title="java.io.IOException">exception</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="()Boolean" id="akka.io;TcpConnection.safeShutdownOutput">safeShutdownOutput</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> =
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#akka.io;TcpConnection.channel" title="=&gt; java.nio.channels.SocketChannel">channel</a>.<span title="()java.net.Socket">socket</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Unit">shutdownOutput</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="Boolean(true)" class="keyword">true</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> _: <span title="java.net.SocketException">SocketException</span> ⇒ <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>

  @tailrec <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="(t: Throwable)String" id="akka.io;TcpConnection.extractMsg">extractMsg</a><span class="delimiter">(</span><a title="Throwable" id="akka.io;TcpConnection.extractMsg.t">t</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>: <span title="String">String</span> =
    <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.extractMsg.t" title="Throwable">t</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="String(&quot;unknown&quot;)" class="string">&quot;unknown&quot;</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#akka.io;TcpConnection.extractMsg.t" title="Throwable">t</a>.<span title="()String">getMessage</span> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> | <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> ⇒ <a href="#akka.io;TcpConnection.extractMsg" title="(t: Throwable)String">extractMsg</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.extractMsg.t" title="Throwable">t</a>.<span title="()Throwable">getCause</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="String" id="akka.io;TcpConnection.extractMsg.msg">msg</a>       ⇒ <a href="#akka.io;TcpConnection.extractMsg.msg" title="String">msg</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.io;TcpConnection.abort">abort</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">try</span> <a href="#akka.io;TcpConnection.channel" title="=&gt; java.nio.channels.SocketChannel">channel</a>.<span title="()java.net.Socket">socket</span>.<span title="(x$1: Boolean, x$2: Int)Unit">setSoLinger</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">// causes the following close() to send TCP RST</span>
    <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#akka.io;TcpConnection.abort.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="akka.io;TcpConnection.abort.e">e</a><span class="delimiter">)</span> ⇒
        <span class="comment">// setSoLinger can fail due to http://bugs.sun.com/view_bug.do?bug_id=6799574</span>
        <span class="comment">// (also affected: OS/X Java 1.6.0_37)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="SelectionHandler.scala.html#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;setSoLinger(true, 0) failed with [{}]&quot;)" class="string">&quot;setSoLinger(true, 0) failed with [{}]&quot;</span>, <a href="#akka.io;TcpConnection.abort.e" title="Throwable">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#akka.io;TcpConnection.channel" title="=&gt; java.nio.channels.SocketChannel">channel</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(closeInfo: akka.io.TcpConnection.CloseInformation)Unit" id="akka.io;TcpConnection.stopWith">stopWith</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.CloseInformation" id="akka.io;TcpConnection.stopWith.closeInfo">closeInfo</a>: <a href="#akka.io.TcpConnection.CloseInformation.readResolve" title="akka.io.TcpConnection.CloseInformation">CloseInformation</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.io;TcpConnection.closedMessage_=" title="(x$1: akka.io.TcpConnection.CloseInformation)Unit">closedMessage</a> = <a href="#akka.io;TcpConnection.stopWith.closeInfo" title="akka.io.TcpConnection.CloseInformation">closeInfo</a>
    <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a><span class="delimiter">(</span><a href="../actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.io;TcpConnection.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.channel" title="=&gt; java.nio.channels.SocketChannel">channel</a>.<span title="()Boolean">isOpen</span><span class="delimiter">)</span>
      <a href="#akka.io;TcpConnection.abort" title="()Unit">abort</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.writePending" title="=&gt; Boolean">writePending</a><span class="delimiter">)</span> <a href="#akka.io;TcpConnection.pendingWrite" title="akka.io.TcpConnection.PendingWrite">pendingWrite</a>.<a href="#akka.io.TcpConnection;PendingWrite.release" title="()Unit">release</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.closedMessage_=" title="=&gt; akka.io.TcpConnection.CloseInformation">closedMessage</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.immutable.Set[akka.actor.ActorRef]" id="akka.io;TcpConnection.postStop.interestedInClose">interestedInClose</a> =
        <span title="scala.collection.immutable.Set[akka.actor.ActorRef]" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.writePending" title="=&gt; Boolean">writePending</a><span class="delimiter">)</span> <a href="#akka.io;TcpConnection.closedMessage_=" title="=&gt; akka.io.TcpConnection.CloseInformation">closedMessage</a>.<a href="#akka.io.TcpConnection;CloseInformation.notificationsTo" title="=&gt; Set[akka.actor.ActorRef]">notificationsTo</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">+</span> <a href="#akka.io;TcpConnection.pendingWrite" title="akka.io.TcpConnection.PendingWrite">pendingWrite</a>.<a href="#akka.io.TcpConnection;PendingWrite.commander" title="=&gt; akka.actor.ActorRef">commander</a>
        <span class="keyword">else</span> <a href="#akka.io;TcpConnection.closedMessage_=" title="=&gt; akka.io.TcpConnection.CloseInformation">closedMessage</a>.<a href="#akka.io.TcpConnection;CloseInformation.notificationsTo" title="=&gt; Set[akka.actor.ActorRef]">notificationsTo</a>

      <a href="#akka.io;TcpConnection.postStop.interestedInClose" title="scala.collection.immutable.Set[akka.actor.ActorRef]">interestedInClose</a>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">_</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.io;TcpConnection.closedMessage_=" title="=&gt; akka.io.TcpConnection.CloseInformation">closedMessage</a>.<a href="#akka.io.TcpConnection;CloseInformation.closedEvent" title="=&gt; akka.io.Tcp.Event">closedEvent</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(reason: Throwable)Unit" id="akka.io;TcpConnection.postRestart">postRestart</a><span class="delimiter">(</span><a title="Throwable" id="akka.io;TcpConnection.postRestart.reason">reason</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IllegalStateException" class="keyword">new</span> <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;Restarting not supported for connection actors.&quot;)" class="string">&quot;Restarting not supported for connection actors.&quot;</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(commander: akka.actor.ActorRef, write: akka.io.Tcp.WriteCommand)akka.io.TcpConnection.PendingWrite" id="akka.io;TcpConnection.PendingWrite">PendingWrite</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.io;TcpConnection.PendingWrite.commander">commander</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.io.Tcp.WriteCommand" id="akka.io;TcpConnection.PendingWrite.write">write</a>: <a href="Tcp.scala.html#akka.io.Tcp;WriteCommand" title="akka.io.Tcp.WriteCommand">WriteCommand</a><span class="delimiter">)</span>: <a href="#akka.io.TcpConnection;PendingWrite" title="akka.io.TcpConnection.PendingWrite">PendingWrite</a> = <span class="delimiter">{</span>
    @tailrec <span class="keyword">def</span> <a title="(head: akka.io.Tcp.WriteCommand, tail: akka.io.Tcp.WriteCommand)akka.io.TcpConnection.PendingWrite" id="akka.io;TcpConnection.PendingWrite.create">create</a><span class="delimiter">(</span><a title="akka.io.Tcp.WriteCommand" id="akka.io;TcpConnection.PendingWrite.create.head">head</a>: <a href="Tcp.scala.html#akka.io.Tcp;WriteCommand" title="akka.io.Tcp.WriteCommand">WriteCommand</a>, <a title="akka.io.Tcp.WriteCommand" id="akka.io;TcpConnection.PendingWrite.create$default$2">tail</a>: <a href="Tcp.scala.html#akka.io.Tcp;WriteCommand" title="akka.io.Tcp.WriteCommand">WriteCommand</a> = <a href="Tcp.scala.html#akka.io.Tcp.Write" title="akka.io.Tcp.Write.type">Write</a>.<a href="Tcp.scala.html#akka.io.Tcp.Write.empty" title="=&gt; akka.io.Tcp.Write">empty</a><span class="delimiter">)</span>: <a href="#akka.io.TcpConnection;PendingWrite" title="akka.io.TcpConnection.PendingWrite">PendingWrite</a> =
      <a href="#akka.io;TcpConnection.PendingWrite.create.head" title="akka.io.Tcp.WriteCommand">head</a> <span title="akka.io.TcpConnection.PendingWrite" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="Tcp.scala.html#akka.io.Tcp.Write" title="akka.io.Tcp.Write.type">Write</a>.<a href="Tcp.scala.html#akka.io.Tcp.Write.empty" title="=&gt; akka.io.Tcp.Write">empty</a>                         ⇒ <span title="akka.io.TcpConnection.PendingWrite" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingWrite.create$default$2" title="akka.io.Tcp.WriteCommand">tail</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="Tcp.scala.html#akka.io.Tcp.Write" title="akka.io.Tcp.Write.type">Write</a>.<a href="Tcp.scala.html#akka.io.Tcp.Write.empty" title="=&gt; akka.io.Tcp.Write">empty</a><span class="delimiter">)</span> <a href="#akka.io.TcpConnection.EmptyPendingWrite" title="akka.io.TcpConnection.EmptyPendingWrite.type">EmptyPendingWrite</a> <span class="keyword">else</span> <a href="#akka.io;TcpConnection.PendingWrite.create" title="(head: akka.io.Tcp.WriteCommand, tail: akka.io.Tcp.WriteCommand)akka.io.TcpConnection.PendingWrite">create</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingWrite.create$default$2" title="akka.io.Tcp.WriteCommand">tail</a><span class="delimiter">)</span>
        <span class="keyword">case</span> Write<span class="delimiter">(</span><a title="akka.util.ByteString" id="akka.io;TcpConnection.PendingWrite.create.data">data</a>, <span title="akka.io.Tcp.Event">ack</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#akka.io;TcpConnection.PendingWrite.create.data" title="akka.util.ByteString">data</a>.<span title="=&gt; Boolean">nonEmpty</span>   ⇒ <a href="#akka.io;TcpConnection.PendingBufferWrite" title="(commander: akka.actor.ActorRef, data: akka.util.ByteString, ack: akka.io.Tcp.Event, tail: akka.io.Tcp.WriteCommand)TcpConnection.this.PendingBufferWrite">PendingBufferWrite</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingWrite.commander" title="akka.actor.ActorRef">commander</a>, <a href="#akka.io;TcpConnection.PendingWrite.create.data" title="akka.util.ByteString">data</a>, <span title="akka.io.Tcp.Event">ack</span>, <a href="#akka.io;TcpConnection.PendingWrite.create$default$2" title="akka.io.Tcp.WriteCommand">tail</a><span class="delimiter">)</span>
        <span class="keyword">case</span> WriteFile<span class="delimiter">(</span><a title="String" id="akka.io;TcpConnection.PendingWrite.create.path">path</a>, <a title="Long" id="akka.io;TcpConnection.PendingWrite.create.offset">offset</a>, <a title="Long" id="akka.io;TcpConnection.PendingWrite.create.count">count</a>, <span title="akka.io.Tcp.Event">ack</span><span class="delimiter">)</span> ⇒ <a href="#akka.io;TcpConnection.PendingWriteFile" title="(commander: akka.actor.ActorRef, filePath: String, offset: Long, count: Long, ack: akka.io.Tcp.Event, tail: akka.io.Tcp.WriteCommand)TcpConnection.this.PendingWriteFile">PendingWriteFile</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingWrite.commander" title="akka.actor.ActorRef">commander</a>, <a href="#akka.io;TcpConnection.PendingWrite.create.path" title="String">path</a>, <a href="#akka.io;TcpConnection.PendingWrite.create.offset" title="Long">offset</a>, <a href="#akka.io;TcpConnection.PendingWrite.create.count" title="Long">count</a>, <span title="akka.io.Tcp.Event">ack</span>, <a href="#akka.io;TcpConnection.PendingWrite.create$default$2" title="akka.io.Tcp.WriteCommand">tail</a><span class="delimiter">)</span>
        <span class="keyword">case</span> CompoundWrite<span class="delimiter">(</span><a title="akka.io.Tcp.SimpleWriteCommand" id="akka.io;TcpConnection.PendingWrite.create.h">h</a>, <a title="akka.io.Tcp.WriteCommand" id="akka.io;TcpConnection.PendingWrite.create.t">t</a><span class="delimiter">)</span>                 ⇒ <a href="#akka.io;TcpConnection.PendingWrite.create" title="(head: akka.io.Tcp.WriteCommand, tail: akka.io.Tcp.WriteCommand)akka.io.TcpConnection.PendingWrite">create</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingWrite.create.h" title="akka.io.Tcp.SimpleWriteCommand">h</a>, <a href="#akka.io;TcpConnection.PendingWrite.create.t" title="akka.io.Tcp.WriteCommand">t</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="akka.io.Tcp.Write" id="akka.io;TcpConnection.PendingWrite.create.x">x</a> @ Write<span class="delimiter">(</span>_, <span title="akka.io.Tcp.Event">ack</span><span class="delimiter">)</span> ⇒ <span class="comment">// empty write with either an ACK or a non-standard NoACK</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingWrite.create.x" title="akka.io.Tcp.Write">x</a>.<a href="Tcp.scala.html#akka.io.Tcp;SimpleWriteCommand.wantsAck" title="=&gt; Boolean">wantsAck</a><span class="delimiter">)</span> <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">commander</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <span title="akka.io.Tcp.Event">ack</span>
          <a href="#akka.io;TcpConnection.PendingWrite.create" title="(head: akka.io.Tcp.WriteCommand, tail: akka.io.Tcp.WriteCommand)akka.io.TcpConnection.PendingWrite">create</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingWrite.create$default$2" title="akka.io.Tcp.WriteCommand">tail</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <a href="#akka.io;TcpConnection.PendingWrite.create" title="(head: akka.io.Tcp.WriteCommand, tail: akka.io.Tcp.WriteCommand)akka.io.TcpConnection.PendingWrite">create</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingWrite.write" title="akka.io.Tcp.WriteCommand">write</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(commander: akka.actor.ActorRef, data: akka.util.ByteString, ack: akka.io.Tcp.Event, tail: akka.io.Tcp.WriteCommand)TcpConnection.this.PendingBufferWrite" id="akka.io;TcpConnection.PendingBufferWrite">PendingBufferWrite</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.io;TcpConnection.PendingBufferWrite.commander">commander</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.util.ByteString" id="akka.io;TcpConnection.PendingBufferWrite.data">data</a>: <a href="../util/ByteString.scala.html#akka.util;ByteString" title="akka.util.ByteString">ByteString</a>, <a title="akka.io.Tcp.Event" id="akka.io;TcpConnection.PendingBufferWrite.ack">ack</a>: <a href="Tcp.scala.html#akka.io.Tcp;Event" title="akka.io.Tcp.Event">Event</a>, <a title="akka.io.Tcp.WriteCommand" id="akka.io;TcpConnection.PendingBufferWrite.tail">tail</a>: <a href="Tcp.scala.html#akka.io.Tcp;WriteCommand" title="akka.io.Tcp.WriteCommand">WriteCommand</a><span class="delimiter">)</span>: <a href="#akka.io;TcpConnection;PendingBufferWrite" title="TcpConnection.this.PendingBufferWrite">PendingBufferWrite</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.nio.ByteBuffer" id="akka.io;TcpConnection.PendingBufferWrite.buffer">buffer</a> = <a href="Tcp.scala.html#akka.io;TcpExt.bufferPool" title="=&gt; akka.io.BufferPool">bufferPool</a>.<a href="DirectByteBufferPool.scala.html#akka.io;BufferPool.acquire" title="()java.nio.ByteBuffer">acquire</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="akka.io;TcpConnection.PendingBufferWrite.copied">copied</a> = <a href="#akka.io;TcpConnection.PendingBufferWrite.data" title="akka.util.ByteString">data</a>.<a href="../util/ByteString.scala.html#akka.util;ByteString.copyToBuffer(a8a554c50c)" title="(buffer: java.nio.ByteBuffer)Int">copyToBuffer</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingBufferWrite.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
      <a href="#akka.io;TcpConnection.PendingBufferWrite.buffer" title="java.nio.ByteBuffer">buffer</a>.<span title="()java.nio.Buffer">flip</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="TcpConnection.this.PendingBufferWrite" class="keyword">new</span> <a href="#akka.io;TcpConnection;PendingBufferWrite" title="TcpConnection.this.PendingBufferWrite">PendingBufferWrite</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingBufferWrite.commander" title="akka.actor.ActorRef">commander</a>, <a href="#akka.io;TcpConnection.PendingBufferWrite.data" title="akka.util.ByteString">data</a>.<a href="../util/ByteString.scala.html#akka.util;ByteString.drop" title="(n: Int)akka.util.ByteString">drop</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingBufferWrite.copied" title="Int">copied</a><span class="delimiter">)</span>, <a href="#akka.io;TcpConnection.PendingBufferWrite.ack" title="akka.io.Tcp.Event">ack</a>, <a href="#akka.io;TcpConnection.PendingBufferWrite.buffer" title="java.nio.ByteBuffer">buffer</a>, <a href="#akka.io;TcpConnection.PendingBufferWrite.tail" title="akka.io.Tcp.WriteCommand">tail</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#akka.io;TcpConnection.PendingBufferWrite.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="akka.io;TcpConnection.PendingBufferWrite.e">e</a><span class="delimiter">)</span> ⇒
        <a href="Tcp.scala.html#akka.io;TcpExt.bufferPool" title="=&gt; akka.io.BufferPool">bufferPool</a>.<a href="DirectByteBufferPool.scala.html#akka.io;BufferPool.release" title="(buf: java.nio.ByteBuffer)Unit">release</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingBufferWrite.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">throw</span> <a href="#akka.io;TcpConnection.PendingBufferWrite.e" title="Throwable">e</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">class</span> <a title="class PendingBufferWrite extends akka.io.TcpConnection.PendingWrite" id="akka.io;TcpConnection;PendingBufferWrite">PendingBufferWrite</a><a href="#akka.io;TcpConnection;PendingBufferWrite" title="TcpConnection.this.PendingBufferWrite" class="delimiter">(</a>
    <span class="keyword">val</span> <a title="akka.actor.ActorRef" id="akka.io;TcpConnection;PendingBufferWrite.commander">commander</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>,
    <a title="akka.util.ByteString" id="akka.io;TcpConnection;PendingBufferWrite.remainingData">remainingData</a>: <a href="../util/ByteString.scala.html#akka.util;ByteString" title="akka.util.ByteString">ByteString</a>,
    <a title="Any" id="akka.io;TcpConnection;PendingBufferWrite.ack">ack</a>: <span title="Any">Any</span>,
    <a title="java.nio.ByteBuffer" id="akka.io;TcpConnection;PendingBufferWrite.buffer">buffer</a>: <span title="java.nio.ByteBuffer">ByteBuffer</span>,
    <a title="akka.io.Tcp.WriteCommand" id="akka.io;TcpConnection;PendingBufferWrite.tail">tail</a>: <a href="Tcp.scala.html#akka.io.Tcp;WriteCommand" title="akka.io.Tcp.WriteCommand">WriteCommand</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.io.TcpConnection;PendingWrite" title="akka.io.TcpConnection.PendingWrite">PendingWrite</a> <span class="delimiter">{</span>

    <span class="keyword">def</span> <a title="(info: akka.io.TcpConnection.ConnectionInfo)akka.io.TcpConnection.PendingWrite" id="akka.io;TcpConnection;PendingBufferWrite.doWrite">doWrite</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.ConnectionInfo" id="akka.io;TcpConnection;PendingBufferWrite.doWrite.info">info</a>: <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a><span class="delimiter">)</span>: <a href="#akka.io.TcpConnection;PendingWrite" title="akka.io.TcpConnection.PendingWrite">PendingWrite</a> = <span class="delimiter">{</span>
      @tailrec <span class="keyword">def</span> <a title="(data: akka.util.ByteString)akka.io.TcpConnection.PendingWrite" id="akka.io;TcpConnection;PendingBufferWrite.doWrite.writeToChannel">writeToChannel</a><span class="delimiter">(</span><a title="akka.util.ByteString" id="akka.io;TcpConnection;PendingBufferWrite.doWrite.writeToChannel.data">data</a>: <a href="../util/ByteString.scala.html#akka.util;ByteString" title="akka.util.ByteString">ByteString</a><span class="delimiter">)</span>: <a href="#akka.io.TcpConnection;PendingWrite" title="akka.io.TcpConnection.PendingWrite">PendingWrite</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Int" id="akka.io;TcpConnection;PendingBufferWrite.doWrite.writeToChannel.writtenBytes">writtenBytes</a> = <a href="#akka.io;TcpConnection.channel" title="=&gt; java.nio.channels.SocketChannel">channel</a>.<span title="(x$1: java.nio.ByteBuffer)Int">write</span><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingBufferWrite.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span> <span class="comment">// at first we try to drain the remaining bytes from the buffer</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="SelectionHandler.scala.html#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Wrote [{}] bytes to channel&quot;)" class="string">&quot;Wrote [{}] bytes to channel&quot;</span>, <a href="#akka.io;TcpConnection;PendingBufferWrite.doWrite.writeToChannel.writtenBytes" title="Int">writtenBytes</a><span class="delimiter">)</span>
        <span title="akka.io.TcpConnection.PendingWrite" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingBufferWrite.buffer" title="java.nio.ByteBuffer">buffer</a>.<span title="()Boolean">hasRemaining</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="comment">// we weren't able to write all bytes from the buffer, so we need to try again later</span>
          <span title="TcpConnection.this.PendingBufferWrite" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingBufferWrite.doWrite.writeToChannel.data" title="akka.util.ByteString">data</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#akka.io;TcpConnection;PendingBufferWrite.remainingData" title="akka.util.ByteString">remainingData</a><span class="delimiter">)</span> <a href="#akka.io;TcpConnection;PendingBufferWrite" title="TcpConnection.this.PendingBufferWrite" class="keyword">this</a>
          <span class="keyword">else</span> <span title="TcpConnection.this.PendingBufferWrite" class="keyword">new</span> <a href="#akka.io;TcpConnection;PendingBufferWrite" title="TcpConnection.this.PendingBufferWrite">PendingBufferWrite</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingBufferWrite.commander" title="=&gt; akka.actor.ActorRef">commander</a>, <a href="#akka.io;TcpConnection;PendingBufferWrite.doWrite.writeToChannel.data" title="akka.util.ByteString">data</a>, <a href="#akka.io;TcpConnection;PendingBufferWrite.ack" title="Any">ack</a>, <a href="#akka.io;TcpConnection;PendingBufferWrite.buffer" title="java.nio.ByteBuffer">buffer</a>, <a href="#akka.io;TcpConnection;PendingBufferWrite.tail" title="akka.io.Tcp.WriteCommand">tail</a><span class="delimiter">)</span> <span class="comment">// copy with updated remainingData</span>

        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="akka.io.TcpConnection.PendingWrite" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingBufferWrite.doWrite.writeToChannel.data" title="akka.util.ByteString">data</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#akka.io;TcpConnection;PendingBufferWrite.buffer" title="java.nio.ByteBuffer">buffer</a>.<span title="()java.nio.Buffer">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Int" id="akka.io;TcpConnection;PendingBufferWrite.doWrite.writeToChannel.copied">copied</a> = <a href="#akka.io;TcpConnection;PendingBufferWrite.doWrite.writeToChannel.data" title="akka.util.ByteString">data</a>.<a href="../util/ByteString.scala.html#akka.util;ByteString.copyToBuffer(a8a554c50c)" title="(buffer: java.nio.ByteBuffer)Int">copyToBuffer</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingBufferWrite.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
          <a href="#akka.io;TcpConnection;PendingBufferWrite.buffer" title="java.nio.ByteBuffer">buffer</a>.<span title="()java.nio.Buffer">flip</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#akka.io;TcpConnection;PendingBufferWrite.doWrite.writeToChannel" title="(data: akka.util.ByteString)akka.io.TcpConnection.PendingWrite">writeToChannel</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingBufferWrite.doWrite.writeToChannel.data" title="akka.util.ByteString">data</a> <a href="../util/ByteString.scala.html#akka.util;ByteString.drop" title="(n: Int)akka.util.ByteString">drop</a> <a href="#akka.io;TcpConnection;PendingBufferWrite.doWrite.writeToChannel.copied" title="Int">copied</a><span class="delimiter">)</span>

        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.io;TcpConnection;PendingBufferWrite.ack" title="Any">ack</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="Tcp.scala.html#akka.io.Tcp;NoAck" title="akka.io.Tcp.NoAck">NoAck</a><span class="delimiter">]</span><span class="delimiter">)</span> <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">commander</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.io;TcpConnection;PendingBufferWrite.ack" title="Any">ack</a>
          <a href="#akka.io;TcpConnection;PendingBufferWrite.release" title="()Unit">release</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#akka.io;TcpConnection.PendingWrite" title="(commander: akka.actor.ActorRef, write: akka.io.Tcp.WriteCommand)akka.io.TcpConnection.PendingWrite">PendingWrite</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingBufferWrite.commander" title="=&gt; akka.actor.ActorRef">commander</a>, <a href="#akka.io;TcpConnection;PendingBufferWrite.tail" title="akka.io.Tcp.WriteCommand">tail</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="akka.io.TcpConnection.PendingWrite" id="akka.io;TcpConnection;PendingBufferWrite.doWrite.next">next</a> = <a href="#akka.io;TcpConnection;PendingBufferWrite.doWrite.writeToChannel" title="(data: akka.util.ByteString)akka.io.TcpConnection.PendingWrite">writeToChannel</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingBufferWrite.remainingData" title="akka.util.ByteString">remainingData</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingBufferWrite.doWrite.next" title="akka.io.TcpConnection.PendingWrite">next</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="#akka.io.TcpConnection.EmptyPendingWrite" title="akka.io.TcpConnection.EmptyPendingWrite.type">EmptyPendingWrite</a><span class="delimiter">)</span> <a href="#akka.io;TcpConnection;PendingBufferWrite.doWrite.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.registration" title="=&gt; akka.io.ChannelRegistration">registration</a>.<a href="SelectionHandler.scala.html#akka.io;ChannelRegistration.enableInterest" title="(op: Int)Unit">enableInterest</a><span class="delimiter">(</span><span title="Int(4)">OP_WRITE</span><span class="delimiter">)</span>
        <a href="#akka.io;TcpConnection;PendingBufferWrite.doWrite.next" title="akka.io.TcpConnection.PendingWrite">next</a>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a title="java.io.IOException" id="akka.io;TcpConnection;PendingBufferWrite.doWrite.e">e</a>: <span title="java.io.IOException">IOException</span> ⇒ <a href="#akka.io;TcpConnection.handleError" title="(handler: akka.actor.ActorRef, exception: java.io.IOException)Unit">handleError</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingBufferWrite.doWrite.info" title="akka.io.TcpConnection.ConnectionInfo">info</a>.<a href="#akka.io.TcpConnection;ConnectionInfo.handler" title="=&gt; akka.actor.ActorRef">handler</a>, <a href="#akka.io;TcpConnection;PendingBufferWrite.doWrite.e" title="java.io.IOException">e</a><span class="delimiter">)</span>; <a href="#akka.io;TcpConnection;PendingBufferWrite" title="TcpConnection.this.PendingBufferWrite" class="keyword">this</a> <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="()Unit" id="akka.io;TcpConnection;PendingBufferWrite.release">release</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="Tcp.scala.html#akka.io;TcpExt.bufferPool" title="=&gt; akka.io.BufferPool">bufferPool</a>.<a href="DirectByteBufferPool.scala.html#akka.io;BufferPool.release" title="(buf: java.nio.ByteBuffer)Unit">release</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingBufferWrite.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(commander: akka.actor.ActorRef, filePath: String, offset: Long, count: Long, ack: akka.io.Tcp.Event, tail: akka.io.Tcp.WriteCommand)TcpConnection.this.PendingWriteFile" id="akka.io;TcpConnection.PendingWriteFile">PendingWriteFile</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.io;TcpConnection.PendingWriteFile.commander">commander</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="String" id="akka.io;TcpConnection.PendingWriteFile.filePath">filePath</a>: <span title="String">String</span>, <a title="Long" id="akka.io;TcpConnection.PendingWriteFile.offset">offset</a>: <span title="Long">Long</span>, <a title="Long" id="akka.io;TcpConnection.PendingWriteFile.count">count</a>: <span title="Long">Long</span>, <a title="akka.io.Tcp.Event" id="akka.io;TcpConnection.PendingWriteFile.ack">ack</a>: <a href="Tcp.scala.html#akka.io.Tcp;Event" title="akka.io.Tcp.Event">Event</a>,
                       <a title="akka.io.Tcp.WriteCommand" id="akka.io;TcpConnection.PendingWriteFile.tail">tail</a>: <a href="Tcp.scala.html#akka.io.Tcp;WriteCommand" title="akka.io.Tcp.WriteCommand">WriteCommand</a><span class="delimiter">)</span>: <a href="#akka.io;TcpConnection;PendingWriteFile" title="TcpConnection.this.PendingWriteFile">PendingWriteFile</a> =
    <span title="TcpConnection.this.PendingWriteFile" class="keyword">new</span> <a href="#akka.io;TcpConnection;PendingWriteFile" title="TcpConnection.this.PendingWriteFile">PendingWriteFile</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingWriteFile.commander" title="akka.actor.ActorRef">commander</a>, <span title="java.io.FileInputStream" class="keyword">new</span> <span title="java.io.FileInputStream">FileInputStream</span><span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingWriteFile.filePath" title="String">filePath</a><span class="delimiter">)</span>.<span title="()java.nio.channels.FileChannel">getChannel</span>, <a href="#akka.io;TcpConnection.PendingWriteFile.offset" title="Long">offset</a>, <a href="#akka.io;TcpConnection.PendingWriteFile.count" title="Long">count</a>, <a href="#akka.io;TcpConnection.PendingWriteFile.ack" title="akka.io.Tcp.Event">ack</a>, <a href="#akka.io;TcpConnection.PendingWriteFile.tail" title="akka.io.Tcp.WriteCommand">tail</a><span class="delimiter">)</span>

  <span class="keyword">class</span> <a title="class PendingWriteFile extends akka.io.TcpConnection.PendingWrite with Runnable" id="akka.io;TcpConnection;PendingWriteFile">PendingWriteFile</a><a href="#akka.io;TcpConnection;PendingWriteFile" title="TcpConnection.this.PendingWriteFile" class="delimiter">(</a>
    <span class="keyword">val</span> <a title="akka.actor.ActorRef" id="akka.io;TcpConnection;PendingWriteFile.commander">commander</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>,
    <a title="java.nio.channels.FileChannel" id="akka.io;TcpConnection;PendingWriteFile.fileChannel">fileChannel</a>: <span title="java.nio.channels.FileChannel">FileChannel</span>,
    <a title="Long" id="akka.io;TcpConnection;PendingWriteFile.offset">offset</a>: <span title="Long">Long</span>,
    <a title="Long" id="akka.io;TcpConnection;PendingWriteFile.remaining">remaining</a>: <span title="Long">Long</span>,
    <a title="akka.io.Tcp.Event" id="akka.io;TcpConnection;PendingWriteFile.ack">ack</a>: <a href="Tcp.scala.html#akka.io.Tcp;Event" title="akka.io.Tcp.Event">Event</a>,
    <a title="akka.io.Tcp.WriteCommand" id="akka.io;TcpConnection;PendingWriteFile.tail">tail</a>: <a href="Tcp.scala.html#akka.io.Tcp;WriteCommand" title="akka.io.Tcp.WriteCommand">WriteCommand</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.io.TcpConnection;PendingWrite" title="akka.io.TcpConnection.PendingWrite">PendingWrite</a> <span class="keyword">with</span> <span title="Runnable">Runnable</span> <span class="delimiter">{</span>

    <span class="keyword">def</span> <a title="(info: akka.io.TcpConnection.ConnectionInfo)akka.io.TcpConnection.PendingWrite" id="akka.io;TcpConnection;PendingWriteFile.doWrite">doWrite</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.ConnectionInfo" id="akka.io;TcpConnection;PendingWriteFile.doWrite.info">info</a>: <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a><span class="delimiter">)</span>: <a href="#akka.io.TcpConnection;PendingWrite" title="akka.io.TcpConnection.PendingWrite">PendingWrite</a> = <span class="delimiter">{</span>
      <a href="#akka.io;TcpConnection.tcp" title="=&gt; akka.io.TcpExt">tcp</a>.<a href="Tcp.scala.html#akka.io;TcpExt.fileIoDispatcher" title="=&gt; akka.dispatch.MessageDispatcher">fileIoDispatcher</a>.<a href="../dispatch/BatchingExecutor.scala.html#akka.dispatch;BatchingExecutor.execute" title="(runnable: Runnable)Unit">execute</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingWriteFile" title="TcpConnection.this.PendingWriteFile" class="keyword">this</a><span class="delimiter">)</span>
      <a href="#akka.io;TcpConnection;PendingWriteFile" title="TcpConnection.this.PendingWriteFile" class="keyword">this</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="()Unit" id="akka.io;TcpConnection;PendingWriteFile.release">release</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.io;TcpConnection;PendingWriteFile.fileChannel" title="java.nio.channels.FileChannel">fileChannel</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="()Unit" id="akka.io;TcpConnection;PendingWriteFile.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Long" id="akka.io;TcpConnection;PendingWriteFile.run.toWrite">toWrite</a> = math.<span title="(x: Long, y: Long)Long">min</span><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingWriteFile.remaining" title="Long">remaining</a>, <a href="#akka.io;TcpConnection.tcp" title="=&gt; akka.io.TcpExt">tcp</a>.<a href="Tcp.scala.html#akka.io;TcpExt.Settings" title="=&gt; TcpConnection.this.tcp.Settings">Settings</a>.<a href="Tcp.scala.html#akka.io;TcpExt;Settings.TransferToLimit" title="=&gt; Long">TransferToLimit</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Long" id="akka.io;TcpConnection;PendingWriteFile.run.written">written</a> = <a href="#akka.io;TcpConnection;PendingWriteFile.fileChannel" title="java.nio.channels.FileChannel">fileChannel</a>.<span title="(x$1: Long, x$2: Long, x$3: java.nio.channels.WritableByteChannel)Long">transferTo</span><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingWriteFile.offset" title="Long">offset</a>, <a href="#akka.io;TcpConnection;PendingWriteFile.run.toWrite" title="Long">toWrite</a>, <a href="#akka.io;TcpConnection.channel" title="=&gt; java.nio.channels.SocketChannel">channel</a><span class="delimiter">)</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingWriteFile.run.written" title="Long">written</a> <span title="(x: Long)Boolean">&lt;</span> <a href="#akka.io;TcpConnection;PendingWriteFile.remaining" title="Long">remaining</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="TcpConnection.this.PendingWriteFile" id="akka.io;TcpConnection;PendingWriteFile.run.updated">updated</a> = <span title="TcpConnection.this.PendingWriteFile" class="keyword">new</span> <a href="#akka.io;TcpConnection;PendingWriteFile" title="TcpConnection.this.PendingWriteFile">PendingWriteFile</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingWriteFile.commander" title="=&gt; akka.actor.ActorRef">commander</a>, <a href="#akka.io;TcpConnection;PendingWriteFile.fileChannel" title="java.nio.channels.FileChannel">fileChannel</a>, <a href="#akka.io;TcpConnection;PendingWriteFile.offset" title="Long">offset</a> <span title="(x: Long)Long">+</span> <a href="#akka.io;TcpConnection;PendingWriteFile.run.written" title="Long">written</a>, <a href="#akka.io;TcpConnection;PendingWriteFile.remaining" title="Long">remaining</a> <span title="(x: Long)Long">-</span> <a href="#akka.io;TcpConnection;PendingWriteFile.run.written" title="Long">written</a>, <a href="#akka.io;TcpConnection;PendingWriteFile.ack" title="akka.io.Tcp.Event">ack</a>, <a href="#akka.io;TcpConnection;PendingWriteFile.tail" title="akka.io.Tcp.WriteCommand">tail</a><span class="delimiter">)</span>
          <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">self</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.io.TcpConnection.UpdatePendingWrite.readResolve" title="(remainingWrite: akka.io.TcpConnection.PendingWrite)akka.io.TcpConnection.UpdatePendingWrite">UpdatePendingWrite</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingWriteFile.run.updated" title="TcpConnection.this.PendingWriteFile">updated</a><span class="delimiter">)</span>

        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.io;TcpConnection;PendingWriteFile.ack" title="akka.io.Tcp.Event">ack</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="Tcp.scala.html#akka.io.Tcp;NoAck" title="akka.io.Tcp.NoAck">NoAck</a><span class="delimiter">]</span><span class="delimiter">)</span> <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">commander</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.io;TcpConnection;PendingWriteFile.ack" title="akka.io.Tcp.Event">ack</a>
          <a href="#akka.io;TcpConnection;PendingWriteFile.release" title="()Unit">release</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">self</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.io.TcpConnection.UpdatePendingWrite.readResolve" title="(remainingWrite: akka.io.TcpConnection.PendingWrite)akka.io.TcpConnection.UpdatePendingWrite">UpdatePendingWrite</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection.PendingWrite" title="(commander: akka.actor.ActorRef, write: akka.io.Tcp.WriteCommand)akka.io.TcpConnection.PendingWrite">PendingWrite</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingWriteFile.commander" title="=&gt; akka.actor.ActorRef">commander</a>, <a href="#akka.io;TcpConnection;PendingWriteFile.tail" title="akka.io.Tcp.WriteCommand">tail</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="java.io.IOException" id="akka.io;TcpConnection;PendingWriteFile.run.e">e</a>: <span title="java.io.IOException">IOException</span> ⇒ <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">self</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.io.TcpConnection.WriteFileFailed.readResolve" title="(e: java.io.IOException)akka.io.TcpConnection.WriteFileFailed">WriteFileFailed</a><span class="delimiter">(</span><a href="#akka.io;TcpConnection;PendingWriteFile.run.e" title="java.io.IOException">e</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>io<span class="delimiter">]</span> <span class="keyword">object</span> <a title="akka.io.TcpConnection.type" id="akka.io.TcpConnection">TcpConnection</a> <a href="#akka.io.TcpConnection" title="akka.io.TcpConnection.type" class="delimiter">{</a>
  <span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait ReadResult extends AnyRef" id="akka.io.TcpConnection;ReadResult">ReadResult</a>
  <span class="keyword">object</span> <a title="akka.io.TcpConnection.EndOfStream.type" id="akka.io.TcpConnection.EndOfStream">EndOfStream</a> <a href="#akka.io.TcpConnection.EndOfStream" title="akka.io.TcpConnection.EndOfStream.type" class="keyword">extends</a> <a href="#akka.io.TcpConnection;ReadResult" title="akka.io.TcpConnection.ReadResult">ReadResult</a>
  <span class="keyword">object</span> <a title="akka.io.TcpConnection.AllRead.type" id="akka.io.TcpConnection.AllRead">AllRead</a> <a href="#akka.io.TcpConnection.AllRead" title="akka.io.TcpConnection.AllRead.type" class="keyword">extends</a> <a href="#akka.io.TcpConnection;ReadResult" title="akka.io.TcpConnection.ReadResult">ReadResult</a>
  <span class="keyword">object</span> <a title="akka.io.TcpConnection.MoreDataWaiting.type" id="akka.io.TcpConnection.MoreDataWaiting">MoreDataWaiting</a> <a href="#akka.io.TcpConnection.MoreDataWaiting" title="akka.io.TcpConnection.MoreDataWaiting.type" class="keyword">extends</a> <a href="#akka.io.TcpConnection;ReadResult" title="akka.io.TcpConnection.ReadResult">ReadResult</a>

  <span class="comment">/**
   * Used to transport information to the postStop method to notify
   * interested party about a connection close.
   */</span>
  <span class="keyword">case class</span> <a title="class CloseInformation extends AnyRef with Product with Serializable" id="akka.io.TcpConnection.CloseInformation.readResolve">CloseInformation</a><a href="#akka.io.TcpConnection.CloseInformation.readResolve" title="Product" class="delimiter">(</a><a title="Set[akka.actor.ActorRef]" id="akka.io.TcpConnection;CloseInformation.notificationsTo">notificationsTo</a>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span>, <a title="akka.io.Tcp.Event" id="akka.io.TcpConnection;CloseInformation.closedEvent">closedEvent</a>: <a href="Tcp.scala.html#akka.io.Tcp;Event" title="akka.io.Tcp.Event">Event</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Groups required connection-related data that are only available once the connection has been fully established.
   */</span>
  <span class="keyword">case class</span> <a title="class ConnectionInfo extends AnyRef with Product with Serializable" id="akka.io.TcpConnection.ConnectionInfo.readResolve">ConnectionInfo</a><a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="Product" class="delimiter">(</a><a title="akka.io.ChannelRegistration" id="akka.io.TcpConnection;ConnectionInfo.registration">registration</a>: <a href="SelectionHandler.scala.html#akka.io;ChannelRegistration" title="akka.io.ChannelRegistration">ChannelRegistration</a>,
                            <a title="akka.actor.ActorRef" id="akka.io.TcpConnection;ConnectionInfo.handler">handler</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>,
                            <a title="Boolean" id="akka.io.TcpConnection;ConnectionInfo.keepOpenOnPeerClosed">keepOpenOnPeerClosed</a>: <span title="Boolean">Boolean</span>,
                            <a title="Boolean" id="akka.io.TcpConnection;ConnectionInfo.useResumeWriting">useResumeWriting</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>

  <span class="comment">// INTERNAL MESSAGES</span>

  <span class="keyword">case class</span> <a title="class UpdatePendingWrite extends AnyRef with akka.actor.NoSerializationVerificationNeeded with Product with Serializable" id="akka.io.TcpConnection.UpdatePendingWrite.readResolve">UpdatePendingWrite</a><a href="#akka.io.TcpConnection.UpdatePendingWrite.readResolve" title="Product" class="delimiter">(</a><a title="akka.io.TcpConnection.PendingWrite" id="akka.io.TcpConnection;UpdatePendingWrite.remainingWrite">remainingWrite</a>: <a href="#akka.io.TcpConnection;PendingWrite" title="akka.io.TcpConnection.PendingWrite">PendingWrite</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../actor/Actor.scala.html#akka.actor;NoSerializationVerificationNeeded" title="akka.actor.NoSerializationVerificationNeeded">NoSerializationVerificationNeeded</a>
  <span class="keyword">case class</span> <a title="class WriteFileFailed extends AnyRef with Product with Serializable" id="akka.io.TcpConnection.WriteFileFailed.readResolve">WriteFileFailed</a><a href="#akka.io.TcpConnection.WriteFileFailed.readResolve" title="Product" class="delimiter">(</a><a title="java.io.IOException" id="akka.io.TcpConnection;WriteFileFailed.e">e</a>: <span title="java.io.IOException">IOException</span><span class="delimiter">)</span>

  <span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class PendingWrite extends AnyRef" id="akka.io.TcpConnection;PendingWrite">PendingWrite</a> <a href="#akka.io.TcpConnection;PendingWrite" title="akka.io.TcpConnection.PendingWrite" class="delimiter">{</a>
    <span class="keyword">def</span> <a title="=&gt; akka.actor.ActorRef" id="akka.io.TcpConnection;PendingWrite.commander">commander</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>
    <span class="keyword">def</span> <a title="(info: akka.io.TcpConnection.ConnectionInfo)akka.io.TcpConnection.PendingWrite" id="akka.io.TcpConnection;PendingWrite.doWrite">doWrite</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.ConnectionInfo" id="akka.io.TcpConnection;PendingWrite.doWrite.info">info</a>: <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a><span class="delimiter">)</span>: <a href="#akka.io.TcpConnection;PendingWrite" title="akka.io.TcpConnection.PendingWrite">PendingWrite</a>
    <span class="keyword">def</span> <a title="()Unit" id="akka.io.TcpConnection;PendingWrite.release">release</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> <span class="comment">// free any occupied resources</span>
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="akka.io.TcpConnection.EmptyPendingWrite.type" id="akka.io.TcpConnection.EmptyPendingWrite">EmptyPendingWrite</a> <a href="#akka.io.TcpConnection.EmptyPendingWrite" title="akka.io.TcpConnection.EmptyPendingWrite.type" class="keyword">extends</a> <a href="#akka.io.TcpConnection;PendingWrite" title="akka.io.TcpConnection.PendingWrite">PendingWrite</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; akka.actor.ActorRef" id="akka.io.TcpConnection.EmptyPendingWrite.commander">commander</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <span title="Nothing" class="keyword">throw</span> <span title="IllegalStateException" class="keyword">new</span> <span title="IllegalStateException">IllegalStateException</span>
    <span class="keyword">def</span> <a title="(info: akka.io.TcpConnection.ConnectionInfo)akka.io.TcpConnection.PendingWrite" id="akka.io.TcpConnection.EmptyPendingWrite.doWrite">doWrite</a><span class="delimiter">(</span><a title="akka.io.TcpConnection.ConnectionInfo" id="akka.io.TcpConnection.EmptyPendingWrite.doWrite.info">info</a>: <a href="#akka.io.TcpConnection.ConnectionInfo.readResolve" title="akka.io.TcpConnection.ConnectionInfo">ConnectionInfo</a><span class="delimiter">)</span>: <a href="#akka.io.TcpConnection;PendingWrite" title="akka.io.TcpConnection.PendingWrite">PendingWrite</a> = <span title="Nothing" class="keyword">throw</span> <span title="IllegalStateException" class="keyword">new</span> <span title="IllegalStateException">IllegalStateException</span>
    <span class="keyword">def</span> <a title="()Unit" id="akka.io.TcpConnection.EmptyPendingWrite.release">release</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="Nothing" class="keyword">throw</span> <span title="IllegalStateException" class="keyword">new</span> <span title="IllegalStateException">IllegalStateException</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
