<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>actor/akka/io/SelectionHandler.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

<span class="keyword">package</span> akka.io

<span class="keyword">import</span> java.util.<span class="delimiter">{</span> Iterator ⇒ JIterator <span class="delimiter">}</span>
<span class="keyword">import</span> java.util.concurrent.atomic.AtomicBoolean
<span class="keyword">import</span> java.nio.channels.<span class="delimiter">{</span> SelectableChannel, SelectionKey, CancelledKeyException <span class="delimiter">}</span>
<span class="keyword">import</span> java.nio.channels.<span title="java.nio.channels.SelectionKey.type">SelectionKey</span>._
<span class="keyword">import</span> java.nio.channels.spi.SelectorProvider
<span class="keyword">import</span> com.typesafe.config.Config
<span class="keyword">import</span> scala.annotation.tailrec
<span class="keyword">import</span> scala.util.control.NonFatal
<span class="keyword">import</span> scala.concurrent.ExecutionContext
<span class="keyword">import</span> akka.event.LoggingAdapter
<span class="keyword">import</span> akka.dispatch.<span class="delimiter">{</span> UnboundedMessageQueueSemantics, RequiresMessageQueue <span class="delimiter">}</span>
<span class="keyword">import</span> akka.util.<a href="../util/Helpers.scala.html#akka.util.Helpers" title="akka.util.Helpers.type">Helpers</a>.Requiring
<span class="keyword">import</span> akka.util.SerializedSuspendableExecutionContext
<span class="keyword">import</span> akka.actor._
<span class="keyword">import</span> akka.routing.RandomRouter
<span class="keyword">import</span> akka.event.Logging

<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class SelectionHandlerSettings extends AnyRef" id="akka.io;SelectionHandlerSettings">SelectionHandlerSettings</a><a href="#akka.io;SelectionHandlerSettings" title="akka.io.SelectionHandlerSettings" class="delimiter">(</a><a title="com.typesafe.config.Config" id="akka.io;SelectionHandlerSettings.config">config</a>: <span title="com.typesafe.config.Config">Config</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#akka.io;SelectionHandlerSettings.config" title="com.typesafe.config.Config">config</a>._

  <span class="keyword">val</span> <a title="Int" id="akka.io;SelectionHandlerSettings.MaxChannels">MaxChannels</a>: <span title="Int">Int</span> = <a href="#akka.io;SelectionHandlerSettings.config" title="(x$1: String)String">getString</a><span class="delimiter">(</span><span title="String(&quot;max-channels&quot;)" class="string">&quot;max-channels&quot;</span><span class="delimiter">)</span> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="String(&quot;unlimited&quot;)" class="string">&quot;unlimited&quot;</span> ⇒ -<span title="Int(-1)" class="int">1</span>
    <span class="keyword">case</span> _           ⇒ <a href="#akka.io;SelectionHandlerSettings.config" title="(x$1: String)Int">getInt</a><a href="../util/Helpers.scala.html#akka.util.Helpers.Requiring(1ee601cfa2)" title="(value: Int)akka.util.Helpers.Requiring[Int]" class="delimiter">(</a><span title="String(&quot;max-channels&quot;)" class="string">&quot;max-channels&quot;</span><span class="delimiter">)</span> <a href="../util/Helpers.scala.html#akka.util.Helpers;Requiring.requiring(734662848f)" title="(cond: Int =&gt; Boolean, msg: =&gt; Any)Int">requiring</a> <span class="delimiter">(</span><a href="#akka.io;SelectionHandlerSettings.MaxChannels.$anonfun.x$1" title="Int">_</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span>, <span title="String(&quot;max-channels must be &gt; 0 or \'unlimited\'&quot;)" class="string">&quot;max-channels must be &gt; 0 or 'unlimited'&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">val</span> <a title="Int" id="akka.io;SelectionHandlerSettings.SelectorAssociationRetries">SelectorAssociationRetries</a>: <span title="Int">Int</span> = <a href="#akka.io;SelectionHandlerSettings.config" title="(x$1: String)Int">getInt</a><a href="../util/Helpers.scala.html#akka.util.Helpers.Requiring(1ee601cfa2)" title="(value: Int)akka.util.Helpers.Requiring[Int]" class="delimiter">(</a><span title="String(&quot;selector-association-retries&quot;)" class="string">&quot;selector-association-retries&quot;</span><span class="delimiter">)</span> <a href="../util/Helpers.scala.html#akka.util.Helpers;Requiring.requiring(734662848f)" title="(cond: Int =&gt; Boolean, msg: =&gt; Any)Int">requiring</a> <span class="delimiter">(</span>
    <a href="#akka.io;SelectionHandlerSettings.SelectorAssociationRetries.$anonfun.x$2" title="Int">_</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span>, <span title="String(&quot;selector-association-retries must be &gt;= 0&quot;)" class="string">&quot;selector-association-retries must be &gt;= 0&quot;</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="String" id="akka.io;SelectionHandlerSettings.SelectorDispatcher">SelectorDispatcher</a>: <span title="String">String</span> = <a href="#akka.io;SelectionHandlerSettings.config" title="(x$1: String)String">getString</a><span class="delimiter">(</span><span title="String(&quot;selector-dispatcher&quot;)" class="string">&quot;selector-dispatcher&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="String" id="akka.io;SelectionHandlerSettings.WorkerDispatcher">WorkerDispatcher</a>: <span title="String">String</span> = <a href="#akka.io;SelectionHandlerSettings.config" title="(x$1: String)String">getString</a><span class="delimiter">(</span><span title="String(&quot;worker-dispatcher&quot;)" class="string">&quot;worker-dispatcher&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="Boolean" id="akka.io;SelectionHandlerSettings.TraceLogging">TraceLogging</a>: <span title="Boolean">Boolean</span> = <a href="#akka.io;SelectionHandlerSettings.config" title="(x$1: String)Boolean">getBoolean</a><span class="delimiter">(</span><span title="String(&quot;trace-logging&quot;)" class="string">&quot;trace-logging&quot;</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; Int" id="akka.io;SelectionHandlerSettings.MaxChannelsPerSelector">MaxChannelsPerSelector</a>: <span title="Int">Int</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Interface behind which we hide our selector management logic from the connection actors
 */</span>
<span title="AnyRef" class="keyword">private</span><span class="delimiter">[</span>io<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait ChannelRegistry extends AnyRef" id="akka.io;ChannelRegistry">ChannelRegistry</a> <span class="delimiter">{</span>
  <span class="comment">/**
   * Registers the given channel with the selector, creates a ChannelRegistration instance for it
   * and dispatches it back to the channelActor calling this `register`
   */</span>
  <span class="keyword">def</span> <a title="(channel: java.nio.channels.SelectableChannel, initialOps: Int)(implicit channelActor: akka.actor.ActorRef)Unit" id="akka.io;ChannelRegistry.register">register</a><span class="delimiter">(</span><a title="java.nio.channels.SelectableChannel" id="akka.io;ChannelRegistry.register.channel">channel</a>: <span title="java.nio.channels.SelectableChannel">SelectableChannel</span>, <a title="Int" id="akka.io;ChannelRegistry.register.initialOps">initialOps</a>: <span title="Int">Int</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="akka.actor.ActorRef" id="akka.io;ChannelRegistry.register.channelActor">channelActor</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Implementations of this interface are sent as actor messages back to a channel actor as
 * a result of it having called `register` on the `ChannelRegistry`.
 * Enables a channel actor to directly schedule interest setting tasks to the selector mgmt. dispatcher.
 */</span>
<span title="AnyRef" class="keyword">private</span><span class="delimiter">[</span>io<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait ChannelRegistration extends AnyRef with akka.actor.NoSerializationVerificationNeeded" id="akka.io;ChannelRegistration">ChannelRegistration</a> <span class="keyword">extends</span> <a href="../actor/Actor.scala.html#akka.actor;NoSerializationVerificationNeeded" title="akka.actor.NoSerializationVerificationNeeded">NoSerializationVerificationNeeded</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(op: Int)Unit" id="akka.io;ChannelRegistration.enableInterest">enableInterest</a><span class="delimiter">(</span><a title="Int" id="akka.io;ChannelRegistration.enableInterest.op">op</a>: <span title="Int">Int</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(op: Int)Unit" id="akka.io;ChannelRegistration.disableInterest">disableInterest</a><span class="delimiter">(</span><a title="Int" id="akka.io;ChannelRegistration.disableInterest.op">op</a>: <span title="Int">Int</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">private</span><span class="delimiter">[</span>io<span class="delimiter">]</span> <span class="keyword">object</span> <a title="akka.io.SelectionHandler.type" id="akka.io.SelectionHandler">SelectionHandler</a> <a href="#akka.io.SelectionHandler" title="akka.io.SelectionHandler.type" class="delimiter">{</a>

  <span class="keyword">trait</span> <a title="trait HasFailureMessage extends AnyRef" id="akka.io.SelectionHandler;HasFailureMessage">HasFailureMessage</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; Any" id="akka.io.SelectionHandler;HasFailureMessage.failureMessage">failureMessage</a>: <span title="Any">Any</span>
  <span class="delimiter">}</span>

  <span class="keyword">case class</span> <a title="class WorkerForCommand extends AnyRef with akka.actor.NoSerializationVerificationNeeded with Product with Serializable" id="akka.io.SelectionHandler.WorkerForCommand.readResolve">WorkerForCommand</a><a href="#akka.io.SelectionHandler.WorkerForCommand.readResolve" title="Product" class="delimiter">(</a><a title="akka.io.SelectionHandler.HasFailureMessage" id="akka.io.SelectionHandler;WorkerForCommand.apiCommand">apiCommand</a>: <a href="#akka.io.SelectionHandler;HasFailureMessage" title="akka.io.SelectionHandler.HasFailureMessage">HasFailureMessage</a>, <a title="akka.actor.ActorRef" id="akka.io.SelectionHandler;WorkerForCommand.commander">commander</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.io.ChannelRegistry =&gt; akka.actor.Props" id="akka.io.SelectionHandler;WorkerForCommand.childProps">childProps</a>: ChannelRegistry ⇒ Props<span class="delimiter">)</span>
    <span class="keyword">extends</span> <a href="../actor/Actor.scala.html#akka.actor;NoSerializationVerificationNeeded" title="akka.actor.NoSerializationVerificationNeeded">NoSerializationVerificationNeeded</a>

  <span class="keyword">case class</span> <a title="class Retry extends AnyRef with akka.actor.NoSerializationVerificationNeeded with Product with Serializable" id="akka.io.SelectionHandler.Retry.readResolve">Retry</a><a href="#akka.io.SelectionHandler.Retry.readResolve" title="Product" class="delimiter">(</a><a title="akka.io.SelectionHandler.WorkerForCommand" id="akka.io.SelectionHandler;Retry.command">command</a>: <a href="#akka.io.SelectionHandler.WorkerForCommand.readResolve" title="akka.io.SelectionHandler.WorkerForCommand">WorkerForCommand</a>, <a title="Int" id="akka.io.SelectionHandler;Retry.retriesLeft">retriesLeft</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../actor/Actor.scala.html#akka.actor;NoSerializationVerificationNeeded" title="akka.actor.NoSerializationVerificationNeeded">NoSerializationVerificationNeeded</a> <span class="delimiter">{</span> <span title="(requirement: Boolean)Unit">require</span><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;Retry.retriesLeft" title="=&gt; Int">retriesLeft</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="keyword">case object</span> <a href="#akka.io.SelectionHandler.ChannelConnectable.productElement.x$1" title="akka.io.SelectionHandler.ChannelConnectable.type" id="akka.io.SelectionHandler.ChannelConnectable.readResolve">ChannelConnectable</a>
  <span class="keyword">case object</span> <a href="#akka.io.SelectionHandler.ChannelAcceptable.productElement.x$1" title="akka.io.SelectionHandler.ChannelAcceptable.type" id="akka.io.SelectionHandler.ChannelAcceptable.readResolve">ChannelAcceptable</a>
  <span class="keyword">case object</span> <a href="#akka.io.SelectionHandler.ChannelReadable.productElement.x$1" title="akka.io.SelectionHandler.ChannelReadable.type" id="akka.io.SelectionHandler.ChannelReadable.readResolve">ChannelReadable</a>
  <span class="keyword">case object</span> <a href="#akka.io.SelectionHandler.ChannelWritable.productElement.x$1" title="akka.io.SelectionHandler.ChannelWritable.type" id="akka.io.SelectionHandler.ChannelWritable.readResolve">ChannelWritable</a>

  <span class="keyword">private</span><span class="delimiter">[</span>io<span class="delimiter">]</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class SelectorBasedManager extends AnyRef with akka.actor.Actor" id="akka.io.SelectionHandler;SelectorBasedManager">SelectorBasedManager</a><a href="#akka.io.SelectionHandler;SelectorBasedManager" title="akka.io.SelectionHandler.SelectorBasedManager" class="delimiter">(</a><a title="akka.io.SelectionHandlerSettings" id="akka.io.SelectionHandler;SelectorBasedManager.selectorSettings">selectorSettings</a>: <a href="#akka.io;SelectionHandlerSettings" title="akka.io.SelectionHandlerSettings">SelectionHandlerSettings</a>, <a title="Int" id="akka.io.SelectionHandler;SelectorBasedManager.nrOfSelectors">nrOfSelectors</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="delimiter">{</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; akka.actor.SupervisorStrategy" id="akka.io.SelectionHandler;SelectorBasedManager.supervisorStrategy">supervisorStrategy</a> = <a href="#akka.io.SelectionHandler.connectionSupervisorStrategy" title="=&gt; akka.actor.SupervisorStrategy">connectionSupervisorStrategy</a>

    <span class="keyword">val</span> <a title="akka.actor.ActorRef" id="akka.io.SelectionHandler;SelectorBasedManager.selectorPool">selectorPool</a> = <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(874c98419a)" title="(props: akka.actor.Props, name: String)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span>
      props = <a href="../routing/DeprecatedRouting.scala.html#akka.routing;RandomRouter" title="(nrOfInstances: Int, routees: scala.collection.immutable.Iterable[String], resizer: Option[akka.routing.Resizer], routerDispatcher: String, supervisorStrategy: akka.actor.SupervisorStrategy)akka.routing.RandomRouter">RandomRouter</a><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;SelectorBasedManager.nrOfSelectors" title="Int">nrOfSelectors</a><span class="delimiter">)</span>.<a href="../routing/RouterConfig.scala.html#akka.routing;Pool.props" title="(routeeProps: akka.actor.Props)akka.actor.Props">props</a><span class="delimiter">(</span><a href="../actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.io.SelectionHandler](classOf[akka.io.SelectionHandler])" class="delimiter">[</span>SelectionHandler<span class="delimiter">]</span>, <a href="#akka.io.SelectionHandler;SelectorBasedManager.selectorSettings" title="akka.io.SelectionHandlerSettings">selectorSettings</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../actor/Props.scala.html#akka.actor;Props.withDeploy" title="(d: akka.actor.Deploy)akka.actor.Props">withDeploy</a><span class="delimiter">(</span><a href="../actor/Deployer.scala.html#akka.actor.Deploy" title="akka.actor.Deploy.type">Deploy</a>.<a href="../actor/Deployer.scala.html#akka.actor.Deploy.local" title="=&gt; akka.actor.Deploy">local</a><span class="delimiter">)</span>,
      name = <span title="String(&quot;selectors&quot;)" class="string">&quot;selectors&quot;</span><span class="delimiter">)</span>

    <span class="keyword">final</span> <span class="keyword">def</span> <a title="(pf: PartialFunction[akka.io.SelectionHandler.HasFailureMessage,akka.io.ChannelRegistry =&gt; akka.actor.Props])SelectorBasedManager.this.Receive" id="akka.io.SelectionHandler;SelectorBasedManager.workerForCommandHandler">workerForCommandHandler</a><span class="delimiter">(</span><a title="PartialFunction[akka.io.SelectionHandler.HasFailureMessage,akka.io.ChannelRegistry =&gt; akka.actor.Props]" id="akka.io.SelectionHandler;SelectorBasedManager.workerForCommandHandler.pf">pf</a>: <span title="PartialFunction[akka.io.SelectionHandler.HasFailureMessage,akka.io.ChannelRegistry =&gt; akka.actor.Props]">PartialFunction</span><span class="delimiter">[</span>HasFailureMessage, ChannelRegistry ⇒ Props<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="SelectorBasedManager.this.Receive">Receive</span> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.io.SelectionHandler;SelectorBasedManager.workerForCommandHandler;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> <a title="akka.io.SelectionHandler.HasFailureMessage" id="akka.io.SelectionHandler;SelectorBasedManager.workerForCommandHandler;$anonfun.isDefinedAt.cmd">cmd</a>: <a href="#akka.io.SelectionHandler;HasFailureMessage" title="akka.io.SelectionHandler.HasFailureMessage">HasFailureMessage</a> <span class="keyword">if</span> <a href="#akka.io.SelectionHandler;SelectorBasedManager.workerForCommandHandler.pf" title="PartialFunction[akka.io.SelectionHandler.HasFailureMessage,akka.io.ChannelRegistry =&gt; akka.actor.Props]">pf</a>.<span title="(x: akka.io.SelectionHandler.HasFailureMessage)Boolean">isDefinedAt</span><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;SelectorBasedManager.workerForCommandHandler;$anonfun.isDefinedAt.cmd" title="akka.io.SelectionHandler.HasFailureMessage">cmd</a><span class="delimiter">)</span> ⇒ <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">selectorPool</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.io.SelectionHandler.WorkerForCommand.readResolve" title="(apiCommand: akka.io.SelectionHandler.HasFailureMessage, commander: akka.actor.ActorRef, childProps: akka.io.ChannelRegistry =&gt; akka.actor.Props)akka.io.SelectionHandler.WorkerForCommand">WorkerForCommand</a><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;SelectorBasedManager.workerForCommandHandler;$anonfun.isDefinedAt.cmd" title="akka.io.SelectionHandler.HasFailureMessage">cmd</a>, <a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#akka.io.SelectionHandler;SelectorBasedManager.workerForCommandHandler.pf" title="(v1: akka.io.SelectionHandler.HasFailureMessage)akka.io.ChannelRegistry =&gt; akka.actor.Props">pf</a><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;SelectorBasedManager.workerForCommandHandler;$anonfun.isDefinedAt.cmd" title="akka.io.SelectionHandler.HasFailureMessage">cmd</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Special supervisor strategy for parents of TCP connection and listener actors.
   * Stops the child on all errors and logs DeathPactExceptions only at debug level.
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>io<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">val</span> <a title="akka.actor.SupervisorStrategy" id="akka.io.SelectionHandler.connectionSupervisorStrategy">connectionSupervisorStrategy</a>: <a href="../actor/FaultHandling.scala.html#akka.actor;SupervisorStrategy" title="akka.actor.SupervisorStrategy">SupervisorStrategy</a> =
    <a href="#akka.io.SelectionHandler.connectionSupervisorStrategy;$anon" title="akka.actor.OneForOneStrategy" class="keyword">new</a> <a href="../actor/FaultHandling.scala.html#akka.actor;OneForOneStrategy" title="anonymous class $anon extends akka.actor.OneForOneStrategy" id="akka.io.SelectionHandler.connectionSupervisorStrategy;$anon">OneForOneStrategy</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="../actor/FaultHandling.scala.html#akka.actor.SupervisorStrategy" title="akka.actor.SupervisorStrategy.type">SupervisorStrategy</a>.<a href="../actor/FaultHandling.scala.html#akka.actor.SupervisorStrategy.stoppingStrategy" title="=&gt; akka.actor.SupervisorStrategy">stoppingStrategy</a>.<a href="../actor/FaultHandling.scala.html#akka.actor;SupervisorStrategy.decider" title="=&gt; akka.actor.SupervisorStrategy.Decider">decider</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(context: akka.actor.ActorContext, child: akka.actor.ActorRef, cause: Throwable, decision: akka.actor.SupervisorStrategy.Directive)Unit" id="akka.io.SelectionHandler.connectionSupervisorStrategy;$anon.logFailure">logFailure</a><span class="delimiter">(</span><a title="akka.actor.ActorContext" id="akka.io.SelectionHandler.connectionSupervisorStrategy;$anon.logFailure.context">context</a>: <a href="../actor/ActorCell.scala.html#akka.actor;ActorContext" title="akka.actor.ActorContext">ActorContext</a>, <a title="akka.actor.ActorRef" id="akka.io.SelectionHandler.connectionSupervisorStrategy;$anon.logFailure.child">child</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Throwable" id="akka.io.SelectionHandler.connectionSupervisorStrategy;$anon.logFailure.cause">cause</a>: <span title="Throwable">Throwable</span>,
                              <a title="akka.actor.SupervisorStrategy.Directive" id="akka.io.SelectionHandler.connectionSupervisorStrategy;$anon.logFailure.decision">decision</a>: SupervisorStrategy.<a href="../actor/FaultHandling.scala.html#akka.actor.SupervisorStrategy;Directive" title="akka.actor.SupervisorStrategy.Directive">Directive</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io.SelectionHandler.connectionSupervisorStrategy;$anon.logFailure.cause" title="Throwable">cause</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../actor/Actor.scala.html#akka.actor;DeathPactException" title="akka.actor.DeathPactException">DeathPactException</a><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">try</span> <a href="#akka.io.SelectionHandler.connectionSupervisorStrategy;$anon.logFailure.context" title="akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../actor/ActorSystem.scala.html#akka.actor;ActorSystem.eventStream" title="=&gt; akka.event.EventStream">eventStream</a>.<a href="../event/EventBus.scala.html#akka.event;SubchannelClassification.publish(de973626dc)" title="(event: Object)Unit">publish</a> <span class="delimiter">{</span>
            <a href="../event/Logging.scala.html#akka.event.Logging" title="akka.event.Logging.type">Logging</a>.<a href="../event/Logging.scala.html#akka.event.Logging;Debug" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Debug">Debug</a><span class="delimiter">(</span><a href="#akka.io.SelectionHandler.connectionSupervisorStrategy;$anon.logFailure.child" title="akka.actor.ActorRef">child</a>.<a href="../actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="#akka.io.SelectionHandler.connectionSupervisorStrategy;$anon" title="()Class[_]">getClass</a>, <span title="String(&quot;Closed after handler termination&quot;)" class="string">&quot;Closed after handler termination&quot;</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a href="#akka.io.SelectionHandler.connectionSupervisorStrategy;$anon.logFailure.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span>_<span class="delimiter">)</span> ⇒ <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#akka.io.SelectionHandler.connectionSupervisorStrategy;$anon" title="akka.actor.OneForOneStrategy" class="keyword">super</a>.<a href="../actor/FaultHandling.scala.html#akka.actor;SupervisorStrategy.logFailure" title="(context: akka.actor.ActorContext, child: akka.actor.ActorRef, cause: Throwable, decision: akka.actor.SupervisorStrategy.Directive)Unit">logFailure</a><span class="delimiter">(</span><a href="#akka.io.SelectionHandler.connectionSupervisorStrategy;$anon.logFailure.context" title="akka.actor.ActorContext">context</a>, <a href="#akka.io.SelectionHandler.connectionSupervisorStrategy;$anon.logFailure.child" title="akka.actor.ActorRef">child</a>, <a href="#akka.io.SelectionHandler.connectionSupervisorStrategy;$anon.logFailure.cause" title="Throwable">cause</a>, <a href="#akka.io.SelectionHandler.connectionSupervisorStrategy;$anon.logFailure.decision" title="akka.actor.SupervisorStrategy.Directive">decision</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">class</span> <a title="class ChannelRegistryImpl extends AnyRef with akka.io.ChannelRegistry" id="akka.io.SelectionHandler;ChannelRegistryImpl">ChannelRegistryImpl</a><a href="#akka.io.SelectionHandler;ChannelRegistryImpl" title="akka.io.SelectionHandler.ChannelRegistryImpl" class="delimiter">(</a><a title="scala.concurrent.ExecutionContext" id="akka.io.SelectionHandler;ChannelRegistryImpl.executionContext">executionContext</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span>, <a title="akka.event.LoggingAdapter" id="akka.io.SelectionHandler;ChannelRegistryImpl.log">log</a>: <a href="../event/Logging.scala.html#akka.event;LoggingAdapter" title="akka.event.LoggingAdapter">LoggingAdapter</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.io;ChannelRegistry" title="akka.io.ChannelRegistry">ChannelRegistry</a> <span class="delimiter">{</span>
    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="java.nio.channels.spi.AbstractSelector" id="akka.io.SelectionHandler;ChannelRegistryImpl.selector">selector</a> = <span title="java.nio.channels.spi.SelectorProvider.type">SelectorProvider</span>.<span title="()java.nio.channels.spi.SelectorProvider">provider</span>.<span title="()java.nio.channels.spi.AbstractSelector">openSelector</span>
    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="java.util.concurrent.atomic.AtomicBoolean" id="akka.io.SelectionHandler;ChannelRegistryImpl.wakeUp">wakeUp</a> = <span title="java.util.concurrent.atomic.AtomicBoolean" class="keyword">new</span> <span title="java.util.concurrent.atomic.AtomicBoolean">AtomicBoolean</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

    <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int(5)" id="akka.io.SelectionHandler;ChannelRegistryImpl.OP_READ_AND_WRITE">OP_READ_AND_WRITE</a> = OP_READ <span title="Int(5)">|</span> OP_WRITE <span class="comment">// compile-time constant</span>

    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="ChannelRegistryImpl.this.Task" id="akka.io.SelectionHandler;ChannelRegistryImpl.select">select</a> = <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon" title="ChannelRegistryImpl.this.Task" class="keyword">new</a> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl;Task" title="anonymous class $anon extends ChannelRegistryImpl.this.Task" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon">Task</a> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="()Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun">tryRun</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.selector" title="java.nio.channels.spi.AbstractSelector">selector</a>.<span title="()Int">select</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">// This assumes select return value == selectedKeys.size</span>
          <span class="keyword">val</span> <a title="java.util.Set[java.nio.channels.SelectionKey]" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.keys">keys</a> = <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.selector" title="java.nio.channels.spi.AbstractSelector">selector</a>.<span title="()java.util.Set[java.nio.channels.SelectionKey]">selectedKeys</span>
          <span class="keyword">val</span> <a title="java.util.Iterator[java.nio.channels.SelectionKey]" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.iterator">iterator</a> = <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.keys" title="java.util.Set[java.nio.channels.SelectionKey]">keys</a>.<span title="()java.util.Iterator[java.nio.channels.SelectionKey]">iterator</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.iterator" title="java.util.Iterator[java.nio.channels.SelectionKey]">iterator</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.while$1" title="()Unit" class="delimiter">{</a>
            <span class="keyword">val</span> <a title="java.nio.channels.SelectionKey" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.key">key</a> = <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.iterator" title="java.util.Iterator[java.nio.channels.SelectionKey]">iterator</a>.<span title="()java.nio.channels.SelectionKey">next</span><span class="delimiter">(</span><span class="delimiter">)</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Boolean">isValid</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">try</span> <span class="delimiter">{</span>
                <span class="comment">// Cache because the performance implications of calling this on different platforms are not clear</span>
                <span class="keyword">val</span> <a title="Int" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.readyOps">readyOps</a> = <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Int">readyOps</span><span class="delimiter">(</span><span class="delimiter">)</span>
                <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Int)java.nio.channels.SelectionKey">interestOps</span><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Int">interestOps</span> <span title="(x: Int)Int">&amp;</span> <span title="=&gt; Int">~</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.readyOps" title="Int">readyOps</a><span class="delimiter">)</span> <span class="comment">// prevent immediate reselection by always clearing</span>
                <span class="keyword">val</span> <a title="akka.actor.ActorRef" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.connection">connection</a> = <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Object">attachment</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.actor.ActorRef" class="delimiter">[</span><a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">]</span>
                <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.readyOps" title="Int">readyOps</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                  <span class="keyword">case</span> <span title="Int(1)">OP_READ</span>                   ⇒ <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="akka.actor.ScalaActorRef" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.qual$1">connection</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!$default$2" title="akka.actor.ActorRef" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.x$4">!</a> <a href="#akka.io.SelectionHandler.ChannelReadable.readResolve" title="akka.io.SelectionHandler.ChannelReadable.type" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.x$3">ChannelReadable</a>
                  <span class="keyword">case</span> <span title="Int(4)">OP_WRITE</span>                  ⇒ <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="akka.actor.ScalaActorRef" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.qual$2">connection</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!$default$2" title="akka.actor.ActorRef" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.x$6">!</a> <a href="#akka.io.SelectionHandler.ChannelWritable.readResolve" title="akka.io.SelectionHandler.ChannelWritable.type" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.x$5">ChannelWritable</a>
                  <span class="keyword">case</span> <span title="Int(5)">OP_READ_AND_WRITE</span>         ⇒ <span class="delimiter">{</span> <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="akka.actor.ScalaActorRef" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.qual$3">connection</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!$default$2" title="akka.actor.ActorRef" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.x$8">!</a> <a href="#akka.io.SelectionHandler.ChannelWritable.readResolve" title="akka.io.SelectionHandler.ChannelWritable.type" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.x$7">ChannelWritable</a>; <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="akka.actor.ScalaActorRef" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.qual$4">connection</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!$default$2" title="akka.actor.ActorRef" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.x$10">!</a> <a href="#akka.io.SelectionHandler.ChannelReadable.readResolve" title="akka.io.SelectionHandler.ChannelReadable.type" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.x$9">ChannelReadable</a> <span class="delimiter">}</span>
                  <span class="keyword">case</span> <span title="Int">x</span> <span class="keyword">if</span> <span class="delimiter">(</span><span title="Int">x</span> <span title="(x: Int)Int">&amp;</span> <span title="Int(16)">OP_ACCEPT</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span>  ⇒ <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="akka.actor.ScalaActorRef" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.qual$5">connection</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!$default$2" title="akka.actor.ActorRef" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.x$12">!</a> <a href="#akka.io.SelectionHandler.ChannelAcceptable.readResolve" title="akka.io.SelectionHandler.ChannelAcceptable.type" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.x$11">ChannelAcceptable</a>
                  <span class="keyword">case</span> <span title="Int">x</span> <span class="keyword">if</span> <span class="delimiter">(</span><span title="Int">x</span> <span title="(x: Int)Int">&amp;</span> <span title="Int(8)">OP_CONNECT</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> ⇒ <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="akka.actor.ScalaActorRef" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.qual$6">connection</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!$default$2" title="akka.actor.ActorRef" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.x$14">!</a> <a href="#akka.io.SelectionHandler.ChannelConnectable.readResolve" title="akka.io.SelectionHandler.ChannelConnectable.type" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.x$13">ChannelConnectable</a>
                  <span class="keyword">case</span> <span title="Int">x</span>                         ⇒ <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.log" title="akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.warning(dc73c33c91)" title="(template: String, arg1: Any)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;Invalid readyOps: [{}]&quot;)" class="string">&quot;Invalid readyOps: [{}]&quot;</span>, <span title="Int">x</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> _: <span title="java.nio.channels.CancelledKeyException">CancelledKeyException</span> ⇒
                <span class="comment">// can be ignored because this exception is triggered when the key becomes invalid</span>
                <span class="comment">// because `channel.close()` in `TcpConnection.postStop` is called from another thread</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
          <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.tryRun.keys" title="java.util.Set[java.nio.channels.SelectionKey]">keys</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="comment">// we need to remove the selected keys from the set, otherwise they remain selected</span>
        <span class="delimiter">}</span>
        <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.wakeUp" title="java.util.concurrent.atomic.AtomicBoolean">wakeUp</a>.<span title="(x$1: Boolean)Unit">set</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.selector" title="java.nio.channels.spi.AbstractSelector">selector</a>.<span title="()Boolean">isOpen</span><span class="delimiter">)</span>
          <span class="keyword">try</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon" title="ChannelRegistryImpl.this.Task" class="keyword">super</a>.<a href="#akka.io.SelectionHandler;ChannelRegistryImpl;Task.run" title="()Unit">run</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="keyword">finally</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.executionContext" title="scala.concurrent.ExecutionContext">executionContext</a>.<span title="(runnable: Runnable)Unit">execute</span><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select;$anon" title="ChannelRegistryImpl.this.Task" class="keyword">this</a><span class="delimiter">)</span> <span class="comment">// re-schedule select behind all currently queued tasks</span>
    <span class="delimiter">}</span>

    <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.executionContext" title="scala.concurrent.ExecutionContext">executionContext</a>.<span title="(runnable: Runnable)Unit">execute</span><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.select" title="ChannelRegistryImpl.this.Task">select</a><span class="delimiter">)</span> <span class="comment">// start selection &quot;loop&quot;</span>

    <span class="keyword">def</span> <a title="(channel: java.nio.channels.SelectableChannel, initialOps: Int)(implicit channelActor: akka.actor.ActorRef)Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl.register">register</a><span class="delimiter">(</span><a title="java.nio.channels.SelectableChannel" id="akka.io.SelectionHandler;ChannelRegistryImpl.register.channel">channel</a>: <span title="java.nio.channels.SelectableChannel">SelectableChannel</span>, <a title="Int" id="akka.io.SelectionHandler;ChannelRegistryImpl.register.initialOps">initialOps</a>: <span title="Int">Int</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="akka.actor.ActorRef" id="akka.io.SelectionHandler;ChannelRegistryImpl.register.channelActor">channelActor</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
      <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.execute" title="(task: ChannelRegistryImpl.this.Task)Unit">execute</a> <span class="delimiter">{</span>
        <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.register;$anon" title="ChannelRegistryImpl.this.Task" class="keyword">new</a> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl;Task" title="anonymous class $anon extends ChannelRegistryImpl.this.Task" id="akka.io.SelectionHandler;ChannelRegistryImpl.register;$anon">Task</a> <span class="delimiter">{</span>
          <span class="keyword">def</span> <a title="()Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl.register;$anon.tryRun">tryRun</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="java.nio.channels.SelectionKey" id="akka.io.SelectionHandler;ChannelRegistryImpl.register;$anon.tryRun.key">key</a> = <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.register.channel" title="java.nio.channels.SelectableChannel">channel</a>.<span title="(x$1: java.nio.channels.Selector, x$2: Int, x$3: Any)java.nio.channels.SelectionKey">register</span><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.selector" title="java.nio.channels.spi.AbstractSelector">selector</a>, <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.register.initialOps" title="Int">initialOps</a>, <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.register.channelActor" title="akka.actor.ActorRef">channelActor</a><span class="delimiter">)</span>
            <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">channelActor</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.register;$anon.tryRun;$anon" title="akka.io.ChannelRegistration" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with akka.io.ChannelRegistration" id="akka.io.SelectionHandler;ChannelRegistryImpl.register;$anon.tryRun;$anon">ChannelRegistration</a> <span class="delimiter">{</span>
              <span class="keyword">def</span> <a title="(ops: Int)Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl.register;$anon.tryRun;$anon.enableInterest">enableInterest</a><span class="delimiter">(</span><a title="Int" id="akka.io.SelectionHandler;ChannelRegistryImpl.register;$anon.tryRun;$anon.enableInterest.ops">ops</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps" title="(key: java.nio.channels.SelectionKey, ops: Int)Unit">enableInterestOps</a><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.register;$anon.tryRun.key" title="java.nio.channels.SelectionKey">key</a>, <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.register;$anon.tryRun;$anon.enableInterest.ops" title="Int">ops</a><span class="delimiter">)</span>
              <span class="keyword">def</span> <a title="(ops: Int)Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl.register;$anon.tryRun;$anon.disableInterest">disableInterest</a><span class="delimiter">(</span><a title="Int" id="akka.io.SelectionHandler;ChannelRegistryImpl.register;$anon.tryRun;$anon.disableInterest.ops">ops</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps" title="(key: java.nio.channels.SelectionKey, ops: Int)Unit">disableInterestOps</a><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.register;$anon.tryRun.key" title="java.nio.channels.SelectionKey">key</a>, <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.register;$anon.tryRun;$anon.disableInterest.ops" title="Int">ops</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="()Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl.shutdown">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
      <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.execute" title="(task: ChannelRegistryImpl.this.Task)Unit">execute</a> <span class="delimiter">{</span>
        <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.shutdown;$anon" title="ChannelRegistryImpl.this.Task" class="keyword">new</a> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl;Task" title="anonymous class $anon extends ChannelRegistryImpl.this.Task" id="akka.io.SelectionHandler;ChannelRegistryImpl.shutdown;$anon">Task</a> <span class="delimiter">{</span>
          <span class="keyword">def</span> <a title="()Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl.shutdown;$anon.tryRun">tryRun</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
            <span class="comment">// thorough 'close' of the Selector</span>
            @tailrec <span class="keyword">def</span> <a title="(it: java.util.Iterator[java.nio.channels.SelectionKey])Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl.shutdown;$anon.tryRun.closeNextChannel">closeNextChannel</a><span class="delimiter">(</span><a title="java.util.Iterator[java.nio.channels.SelectionKey]" id="akka.io.SelectionHandler;ChannelRegistryImpl.shutdown;$anon.tryRun.closeNextChannel.it">it</a>: <span title="java.util.Iterator[java.nio.channels.SelectionKey]">JIterator</span><span class="delimiter">[</span>SelectionKey<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.shutdown;$anon.tryRun.closeNextChannel.it" title="java.util.Iterator[java.nio.channels.SelectionKey]">it</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">try</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.shutdown;$anon.tryRun.closeNextChannel.it" title="java.util.Iterator[java.nio.channels.SelectionKey]">it</a>.<span title="()java.nio.channels.SelectionKey">next</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.nio.channels.SelectableChannel">channel</span>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.shutdown;$anon.tryRun.closeNextChannel.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="akka.io.SelectionHandler;ChannelRegistryImpl.shutdown;$anon.tryRun.closeNextChannel.e">e</a><span class="delimiter">)</span> ⇒ <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.log" title="akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Error closing channel: {}&quot;)" class="string">&quot;Error closing channel: {}&quot;</span>, <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.shutdown;$anon.tryRun.closeNextChannel.e" title="Throwable">e</a><span class="delimiter">)</span> <span class="delimiter">}</span>
              <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.shutdown;$anon.tryRun.closeNextChannel" title="(it: java.util.Iterator[java.nio.channels.SelectionKey])Unit">closeNextChannel</a><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.shutdown;$anon.tryRun.closeNextChannel.it" title="java.util.Iterator[java.nio.channels.SelectionKey]">it</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <span class="keyword">try</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.shutdown;$anon.tryRun.closeNextChannel" title="(it: java.util.Iterator[java.nio.channels.SelectionKey])Unit">closeNextChannel</a><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.selector" title="java.nio.channels.spi.AbstractSelector">selector</a>.<span title="()java.util.Set[java.nio.channels.SelectionKey]">keys</span>.<span title="()java.util.Iterator[java.nio.channels.SelectionKey]">iterator</span><span class="delimiter">)</span>
            <span class="keyword">finally</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.selector" title="java.nio.channels.spi.AbstractSelector">selector</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="comment">// always set the interest keys on the selector thread,</span>
    <span class="comment">// benchmarks show that not doing so results in lock contention</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(key: java.nio.channels.SelectionKey, ops: Int)Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps">enableInterestOps</a><span class="delimiter">(</span><a title="java.nio.channels.SelectionKey" id="akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps.key">key</a>: <span title="java.nio.channels.SelectionKey">SelectionKey</span>, <a title="Int" id="akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps.ops">ops</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
      <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.execute" title="(task: ChannelRegistryImpl.this.Task)Unit">execute</a> <span class="delimiter">{</span>
        <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps;$anon" title="ChannelRegistryImpl.this.Task" class="keyword">new</a> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl;Task" title="anonymous class $anon extends ChannelRegistryImpl.this.Task" id="akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps;$anon">Task</a> <span class="delimiter">{</span>
          <span class="keyword">def</span> <a title="()Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps;$anon.tryRun">tryRun</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="Int" id="akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps;$anon.tryRun.currentOps">currentOps</a> = <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Int">interestOps</span>
            <span class="keyword">val</span> <a title="Int" id="akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps;$anon.tryRun.newOps">newOps</a> = <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps;$anon.tryRun.currentOps" title="Int">currentOps</a> <span title="(x: Int)Int">|</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps.ops" title="Int">ops</a>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps;$anon.tryRun.newOps" title="Int">newOps</a> <span title="(x: Int)Boolean">!=</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps;$anon.tryRun.currentOps" title="Int">currentOps</a><span class="delimiter">)</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps.key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Int)java.nio.channels.SelectionKey">interestOps</span><span title="Unit" class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.enableInterestOps;$anon.tryRun.newOps" title="Int">newOps</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(key: java.nio.channels.SelectionKey, ops: Int)Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps">disableInterestOps</a><span class="delimiter">(</span><a title="java.nio.channels.SelectionKey" id="akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps.key">key</a>: <span title="java.nio.channels.SelectionKey">SelectionKey</span>, <a title="Int" id="akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps.ops">ops</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
      <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.execute" title="(task: ChannelRegistryImpl.this.Task)Unit">execute</a> <span class="delimiter">{</span>
        <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps;$anon" title="ChannelRegistryImpl.this.Task" class="keyword">new</a> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl;Task" title="anonymous class $anon extends ChannelRegistryImpl.this.Task" id="akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps;$anon">Task</a> <span class="delimiter">{</span>
          <span class="keyword">def</span> <a title="()Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps;$anon.tryRun">tryRun</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="Int" id="akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps;$anon.tryRun.currentOps">currentOps</a> = <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps.key" title="java.nio.channels.SelectionKey">key</a>.<span title="()Int">interestOps</span>
            <span class="keyword">val</span> <a title="Int" id="akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps;$anon.tryRun.newOps">newOps</a> = <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps;$anon.tryRun.currentOps" title="Int">currentOps</a> <span title="(x: Int)Int">&amp;</span> <span title="=&gt; Int">~</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps.ops" title="Int">ops</a>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps;$anon.tryRun.newOps" title="Int">newOps</a> <span title="(x: Int)Boolean">!=</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps;$anon.tryRun.currentOps" title="Int">currentOps</a><span class="delimiter">)</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps.key" title="java.nio.channels.SelectionKey">key</a>.<span title="(x$1: Int)java.nio.channels.SelectionKey">interestOps</span><span title="Unit" class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.disableInterestOps;$anon.tryRun.newOps" title="Int">newOps</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(task: ChannelRegistryImpl.this.Task)Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl.execute">execute</a><span class="delimiter">(</span><a title="ChannelRegistryImpl.this.Task" id="akka.io.SelectionHandler;ChannelRegistryImpl.execute.task">task</a>: <a href="#akka.io.SelectionHandler;ChannelRegistryImpl;Task" title="ChannelRegistryImpl.this.Task">Task</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
      <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.executionContext" title="scala.concurrent.ExecutionContext">executionContext</a>.<span title="(runnable: Runnable)Unit">execute</span><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.execute.task" title="ChannelRegistryImpl.this.Task">task</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl.wakeUp" title="java.util.concurrent.atomic.AtomicBoolean">wakeUp</a>.<span title="(x$1: Boolean, x$2: Boolean)Boolean">compareAndSet</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="comment">// if possible avoid syscall and trade off with LOCK CMPXCHG</span>
        <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.selector" title="java.nio.channels.spi.AbstractSelector">selector</a>.<span title="()java.nio.channels.Selector">wakeup</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">// FIXME: Add possibility to signal failure of task to someone</span>
    <span class="keyword">private</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class Task extends Object with Runnable" id="akka.io.SelectionHandler;ChannelRegistryImpl;Task">Task</a> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl;Task" title="ChannelRegistryImpl.this.Task" class="keyword">extends</a> <span title="Runnable">Runnable</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="()Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl;Task.tryRun">tryRun</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="()Unit" id="akka.io.SelectionHandler;ChannelRegistryImpl;Task.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">try</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl;Task.tryRun" title="()Unit">tryRun</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">catch</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> _: <span title="java.nio.channels.CancelledKeyException">CancelledKeyException</span> ⇒ <span class="comment">// ok, can be triggered while setting interest ops</span>
          <span class="keyword">case</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl;Task.run.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="akka.io.SelectionHandler;ChannelRegistryImpl;Task.run.e">e</a><span class="delimiter">)</span>              ⇒ <a href="#akka.io.SelectionHandler;ChannelRegistryImpl.log" title="akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.error(134e35740d)" title="(cause: Throwable, template: String, arg1: Any)Unit">error</a><span class="delimiter">(</span><a href="#akka.io.SelectionHandler;ChannelRegistryImpl;Task.run.e" title="Throwable">e</a>, <span title="String(&quot;Error during selector management task: [{}]&quot;)" class="string">&quot;Error during selector management task: [{}]&quot;</span>, <a href="#akka.io.SelectionHandler;ChannelRegistryImpl;Task.run.e" title="Throwable">e</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span title="AnyRef" class="keyword">private</span><span class="delimiter">[</span>io<span class="delimiter">]</span> <span class="keyword">class</span> <a title="class SelectionHandler extends AnyRef with akka.actor.Actor with akka.actor.ActorLogging with akka.dispatch.RequiresMessageQueue[akka.dispatch.UnboundedMessageQueueSemantics]" id="akka.io;SelectionHandler">SelectionHandler</a><a href="#akka.io;SelectionHandler" title="akka.io.SelectionHandler" class="delimiter">(</a><a title="akka.io.SelectionHandlerSettings" id="akka.io;SelectionHandler.settings">settings</a>: <a href="#akka.io;SelectionHandlerSettings" title="akka.io.SelectionHandlerSettings">SelectionHandlerSettings</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="keyword">with</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a>
  <span class="keyword">with</span> <a href="../dispatch/Mailbox.scala.html#akka.dispatch;RequiresMessageQueue" title="akka.dispatch.RequiresMessageQueue[akka.dispatch.UnboundedMessageQueueSemantics]">RequiresMessageQueue</a><span class="delimiter">[</span>UnboundedMessageQueueSemantics<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#akka.io.SelectionHandler" title="akka.io.SelectionHandler.type">SelectionHandler</a>._
  <span class="keyword">import</span> <a href="#akka.io;SelectionHandler.settings" title="akka.io.SelectionHandlerSettings">settings</a>._

  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="Int" id="akka.io;SelectionHandler.sequenceNumber">sequenceNumber</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="Int" id="akka.io;SelectionHandler.childCount">childCount</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="akka.io.SelectionHandler.ChannelRegistryImpl" id="akka.io;SelectionHandler.registry">registry</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="akka.dispatch.MessageDispatcher" id="akka.io;SelectionHandler.registry.dispatcher">dispatcher</a> = <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../actor/ActorSystem.scala.html#akka.actor;ActorSystem.dispatchers" title="=&gt; akka.dispatch.Dispatchers">dispatchers</a>.<a href="../dispatch/Dispatchers.scala.html#akka.dispatch;Dispatchers.lookup" title="(id: String)akka.dispatch.MessageDispatcher">lookup</a><span class="delimiter">(</span><a href="#akka.io;SelectionHandlerSettings.SelectorDispatcher" title="=&gt; String">SelectorDispatcher</a><span class="delimiter">)</span>
    <span title="akka.io.SelectionHandler.ChannelRegistryImpl" class="keyword">new</span> <a href="#akka.io.SelectionHandler;ChannelRegistryImpl" title="akka.io.SelectionHandler.ChannelRegistryImpl">ChannelRegistryImpl</a><span class="delimiter">(</span><a href="../util/SerializedSuspendableExecutionContext.scala.html#akka.util.SerializedSuspendableExecutionContext.apply" title="(throughput: Int)(implicit context: scala.concurrent.ExecutionContext)akka.util.SerializedSuspendableExecutionContext">SerializedSuspendableExecutionContext</a><span class="delimiter">(</span><a href="#akka.io;SelectionHandler.registry.dispatcher" title="akka.dispatch.MessageDispatcher">dispatcher</a>.<a href="../dispatch/AbstractDispatcher.scala.html#akka.dispatch;MessageDispatcher.throughput" title="=&gt; Int">throughput</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.io;SelectionHandler.registry.dispatcher" title="akka.dispatch.MessageDispatcher">dispatcher</a><span class="delimiter">)</span>, <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; SelectionHandler.this.Receive" id="akka.io;SelectionHandler.receive">receive</a>: <span title="SelectionHandler.this.Receive">Receive</span> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.io;SelectionHandler.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> <span title="akka.io.SelectionHandler.WorkerForCommand">cmd</span>: <a href="#akka.io.SelectionHandler.WorkerForCommand.readResolve" title="akka.io.SelectionHandler.WorkerForCommand">WorkerForCommand</a>   ⇒ <a href="#akka.io;SelectionHandler.spawnChildWithCapacityProtection" title="(cmd: akka.io.SelectionHandler.WorkerForCommand, retriesLeft: Int)Unit">spawnChildWithCapacityProtection</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.io.SelectionHandler.WorkerForCommand">cmd</span>, <a href="#akka.io;SelectionHandlerSettings.SelectorAssociationRetries" title="=&gt; Int">SelectorAssociationRetries</a><span class="delimiter">)</span>

    <span class="keyword">case</span> Retry<span class="delimiter">(</span><span title="akka.io.SelectionHandler.WorkerForCommand">cmd</span>, <a title="Int" id="akka.io;SelectionHandler.receive;$anonfun.isDefinedAt.retriesLeft">retriesLeft</a><span class="delimiter">)</span> ⇒ <a href="#akka.io;SelectionHandler.spawnChildWithCapacityProtection" title="(cmd: akka.io.SelectionHandler.WorkerForCommand, retriesLeft: Int)Unit">spawnChildWithCapacityProtection</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.io.SelectionHandler.WorkerForCommand">cmd</span>, <a href="#akka.io;SelectionHandler.receive;$anonfun.isDefinedAt.retriesLeft" title="Int">retriesLeft</a><span class="delimiter">)</span>

    <span class="comment">// since our ActorRef is never exposed to the user and we are only assigning watches to our</span>
    <span class="comment">// children all incoming `Terminated` events must be for a child of ours</span>
    <span class="keyword">case</span> _: <a href="../actor/Actor.scala.html#akka.actor;Terminated" title="akka.actor.Terminated">Terminated</a>           ⇒ <a href="#akka.io;SelectionHandler.childCount" title="Int">childCount</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.io;SelectionHandler.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.io;SelectionHandler.registry" title="akka.io.SelectionHandler.ChannelRegistryImpl">registry</a>.<a href="#akka.io.SelectionHandler;ChannelRegistryImpl.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">// we can never recover from failures of a connection or listener child</span>
  <span class="comment">// and log the failure at debug level</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; akka.actor.OneForOneStrategy" id="akka.io;SelectionHandler.supervisorStrategy">supervisorStrategy</a> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; akka.actor.SupervisorStrategy.Decider" id="akka.io;SelectionHandler.supervisorStrategy.stoppingDecider">stoppingDecider</a>: SupervisorStrategy.<span title="akka.actor.SupervisorStrategy.Decider">Decider</span> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Throwable,akka.actor.SupervisorStrategy.Directive] with Serializable" id="akka.io;SelectionHandler.supervisorStrategy.stoppingDecider;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> _: <span title="Exception">Exception</span> ⇒ <a href="../actor/FaultHandling.scala.html#akka.actor.SupervisorStrategy" title="akka.actor.SupervisorStrategy.type">SupervisorStrategy</a>.<a href="../actor/FaultHandling.scala.html#akka.actor.SupervisorStrategy.Stop" title="akka.actor.SupervisorStrategy.Stop.type">Stop</a>
    <span class="delimiter">}</span>
    <a href="#akka.io;SelectionHandler.supervisorStrategy;$anon" title="akka.actor.OneForOneStrategy" class="keyword">new</a> <a href="../actor/FaultHandling.scala.html#akka.actor;OneForOneStrategy" title="anonymous class $anon extends akka.actor.OneForOneStrategy" id="akka.io;SelectionHandler.supervisorStrategy;$anon">OneForOneStrategy</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.io;SelectionHandler.supervisorStrategy.stoppingDecider" title="=&gt; akka.actor.SupervisorStrategy.Decider">stoppingDecider</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(context: akka.actor.ActorContext, child: akka.actor.ActorRef, cause: Throwable, decision: akka.actor.SupervisorStrategy.Directive)Unit" id="akka.io;SelectionHandler.supervisorStrategy;$anon.logFailure">logFailure</a><span class="delimiter">(</span><a title="akka.actor.ActorContext" id="akka.io;SelectionHandler.supervisorStrategy;$anon.logFailure.context">context</a>: <a href="../actor/ActorCell.scala.html#akka.actor;ActorContext" title="akka.actor.ActorContext">ActorContext</a>, <a title="akka.actor.ActorRef" id="akka.io;SelectionHandler.supervisorStrategy;$anon.logFailure.child">child</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Throwable" id="akka.io;SelectionHandler.supervisorStrategy;$anon.logFailure.cause">cause</a>: <span title="Throwable">Throwable</span>,
                              <a title="akka.actor.SupervisorStrategy.Directive" id="akka.io;SelectionHandler.supervisorStrategy;$anon.logFailure.decision">decision</a>: SupervisorStrategy.<a href="../actor/FaultHandling.scala.html#akka.actor.SupervisorStrategy;Directive" title="akka.actor.SupervisorStrategy.Directive">Directive</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
        <span class="keyword">try</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="String" id="akka.io;SelectionHandler.supervisorStrategy;$anon.logFailure.logMessage">logMessage</a> = <a href="#akka.io;SelectionHandler.supervisorStrategy;$anon.logFailure.cause" title="Throwable">cause</a> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="akka.actor.ActorInitializationException">e</span>: <a href="../actor/Actor.scala.html#akka.actor;ActorInitializationException" title="akka.actor.ActorInitializationException">ActorInitializationException</a> <span class="keyword">if</span> <span title="akka.actor.ActorInitializationException">e</span>.<span title="()Throwable">getCause</span> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span> ⇒ <span title="akka.actor.ActorInitializationException">e</span>.<span title="()Throwable">getCause</span>.<span title="()String">getMessage</span>
            <span class="keyword">case</span> <span title="Throwable">e</span> ⇒ <span title="Throwable">e</span>.<span title="()String">getMessage</span>
          <span class="delimiter">}</span>
          <a href="#akka.io;SelectionHandler.supervisorStrategy;$anon.logFailure.context" title="akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../actor/ActorSystem.scala.html#akka.actor;ActorSystem.eventStream" title="=&gt; akka.event.EventStream">eventStream</a>.<a href="../event/EventBus.scala.html#akka.event;SubchannelClassification.publish(de973626dc)" title="(event: Object)Unit">publish</a><span class="delimiter">(</span>
            <a href="../event/Logging.scala.html#akka.event.Logging" title="akka.event.Logging.type">Logging</a>.<a href="../event/Logging.scala.html#akka.event.Logging;Debug" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Debug">Debug</a><span class="delimiter">(</span><a href="#akka.io;SelectionHandler.supervisorStrategy;$anon.logFailure.child" title="akka.actor.ActorRef">child</a>.<a href="../actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, classOf<span title="Class[akka.io.SelectionHandler](classOf[akka.io.SelectionHandler])" class="delimiter">[</span>SelectionHandler<span class="delimiter">]</span>, <a href="#akka.io;SelectionHandler.supervisorStrategy;$anon.logFailure.logMessage" title="String">logMessage</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a href="#akka.io;SelectionHandler.supervisorStrategy;$anon.logFailure.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span>_<span class="delimiter">)</span> ⇒ <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(cmd: akka.io.SelectionHandler.WorkerForCommand, retriesLeft: Int)Unit" id="akka.io;SelectionHandler.spawnChildWithCapacityProtection">spawnChildWithCapacityProtection</a><span class="delimiter">(</span><a title="akka.io.SelectionHandler.WorkerForCommand" id="akka.io;SelectionHandler.spawnChildWithCapacityProtection.cmd">cmd</a>: <a href="#akka.io.SelectionHandler.WorkerForCommand.readResolve" title="akka.io.SelectionHandler.WorkerForCommand">WorkerForCommand</a>, <a title="Int" id="akka.io;SelectionHandler.spawnChildWithCapacityProtection.retriesLeft">retriesLeft</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Executing [{}]&quot;)" class="string">&quot;Executing [{}]&quot;</span>, <a href="#akka.io;SelectionHandler.spawnChildWithCapacityProtection.cmd" title="akka.io.SelectionHandler.WorkerForCommand">cmd</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;SelectionHandlerSettings.MaxChannelsPerSelector" title="=&gt; Int">MaxChannelsPerSelector</a> <span title="(x: Int)Boolean">==</span> -<span title="Int(-1)" class="int">1</span> <span title="(x: Boolean)Boolean">||</span> <a href="#akka.io;SelectionHandler.childCount" title="Int">childCount</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.io;SelectionHandlerSettings.MaxChannelsPerSelector" title="=&gt; Int">MaxChannelsPerSelector</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="akka.io;SelectionHandler.spawnChildWithCapacityProtection.newName">newName</a> = <a href="#akka.io;SelectionHandler.sequenceNumber" title="Int">sequenceNumber</a>.<span title="()String">toString</span>
      <a href="#akka.io;SelectionHandler.sequenceNumber" title="Int">sequenceNumber</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="keyword">val</span> <a title="akka.actor.ActorRef" id="akka.io;SelectionHandler.spawnChildWithCapacityProtection.child">child</a> = <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(874c98419a)" title="(props: akka.actor.Props, name: String)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span>props = <a href="#akka.io;SelectionHandler.spawnChildWithCapacityProtection.cmd" title="akka.io.SelectionHandler.WorkerForCommand">cmd</a>.<a href="#akka.io.SelectionHandler;WorkerForCommand.childProps" title="(v1: akka.io.ChannelRegistry)akka.actor.Props">childProps</a><span class="delimiter">(</span><a href="#akka.io;SelectionHandler.registry" title="akka.io.SelectionHandler.ChannelRegistryImpl">registry</a><span class="delimiter">)</span>.<a href="../actor/Props.scala.html#akka.actor;Props.withDispatcher" title="(d: String)akka.actor.Props">withDispatcher</a><span class="delimiter">(</span><a href="#akka.io;SelectionHandlerSettings.WorkerDispatcher" title="=&gt; String">WorkerDispatcher</a><span class="delimiter">)</span>.<a href="../actor/Props.scala.html#akka.actor;Props.withDeploy" title="(d: akka.actor.Deploy)akka.actor.Props">withDeploy</a><span class="delimiter">(</span><a href="../actor/Deployer.scala.html#akka.actor.Deploy" title="akka.actor.Deploy.type">Deploy</a>.<a href="../actor/Deployer.scala.html#akka.actor.Deploy.local" title="=&gt; akka.actor.Deploy">local</a><span class="delimiter">)</span>, name = <a href="#akka.io;SelectionHandler.spawnChildWithCapacityProtection.newName" title="String">newName</a><span class="delimiter">)</span>
      <a href="#akka.io;SelectionHandler.childCount" title="Int">childCount</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;SelectionHandlerSettings.MaxChannelsPerSelector" title="=&gt; Int">MaxChannelsPerSelector</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span title="Unit" class="delimiter">(</span><a href="#akka.io;SelectionHandler.spawnChildWithCapacityProtection.child" title="akka.actor.ActorRef">child</a><span class="delimiter">)</span> <span class="comment">// we don't need to watch if we aren't limited</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.io;SelectionHandler.spawnChildWithCapacityProtection.retriesLeft" title="Int">retriesLeft</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Rejecting [{}] with [{}] retries left, retrying...&quot;)" class="string">&quot;Rejecting [{}] with [{}] retries left, retrying...&quot;</span>, <a href="#akka.io;SelectionHandler.spawnChildWithCapacityProtection.cmd" title="akka.io.SelectionHandler.WorkerForCommand">cmd</a>, <a href="#akka.io;SelectionHandler.spawnChildWithCapacityProtection.retriesLeft" title="Int">retriesLeft</a><span class="delimiter">)</span>
        <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.parent" title="=&gt; akka.actor.ActorRef">parent</a> <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef.forward" title="(message: Any)(implicit context: akka.actor.ActorContext)Unit">forward</a> <a href="#akka.io.SelectionHandler.Retry.readResolve" title="(command: akka.io.SelectionHandler.WorkerForCommand, retriesLeft: Int)akka.io.SelectionHandler.Retry">Retry</a><span class="delimiter">(</span><a href="#akka.io;SelectionHandler.spawnChildWithCapacityProtection.cmd" title="akka.io.SelectionHandler.WorkerForCommand">cmd</a>, <a href="#akka.io;SelectionHandler.spawnChildWithCapacityProtection.retriesLeft" title="Int">retriesLeft</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.warning(dc73c33c91)" title="(template: String, arg1: Any)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;Rejecting [{}] with no retries left, aborting...&quot;)" class="string">&quot;Rejecting [{}] with no retries left, aborting...&quot;</span>, <a href="#akka.io;SelectionHandler.spawnChildWithCapacityProtection.cmd" title="akka.io.SelectionHandler.WorkerForCommand">cmd</a><span class="delimiter">)</span>
        <a href="#akka.io;SelectionHandler.spawnChildWithCapacityProtection.cmd" title="akka.io.SelectionHandler.WorkerForCommand">cmd</a>.<a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">commander</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.io;SelectionHandler.spawnChildWithCapacityProtection.cmd" title="akka.io.SelectionHandler.WorkerForCommand">cmd</a>.<a href="#akka.io.SelectionHandler;WorkerForCommand.apiCommand" title="=&gt; akka.io.SelectionHandler.HasFailureMessage">apiCommand</a>.<a href="#akka.io.SelectionHandler;HasFailureMessage.failureMessage" title="=&gt; Any">failureMessage</a> <span class="comment">// I can't do it, Captain!</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
