<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>remote/akka/remote/RemoteWatcher.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> akka.remote

<span class="keyword">import</span> scala.concurrent.duration._
<span class="keyword">import</span> akka.actor.Actor
<span class="keyword">import</span> akka.actor.ActorLogging
<span class="keyword">import</span> akka.actor.ActorRef
<span class="keyword">import</span> akka.actor.Address
<span class="keyword">import</span> akka.actor.AddressTerminated
<span class="keyword">import</span> akka.actor.Props
<span class="keyword">import</span> akka.actor.RootActorPath
<span class="keyword">import</span> akka.actor.Terminated
<span class="keyword">import</span> akka.actor.ExtendedActorSystem
<span class="keyword">import</span> akka.ConfigurationException
<span class="keyword">import</span> akka.dispatch.<span class="delimiter">{</span> UnboundedMessageQueueSemantics, RequiresMessageQueue <span class="delimiter">}</span>
<span class="keyword">import</span> akka.actor.InternalActorRef
<span class="keyword">import</span> akka.dispatch.sysmsg.DeathWatchNotification
<span class="keyword">import</span> akka.dispatch.sysmsg.Watch
<span class="keyword">import</span> akka.actor.Deploy
<span class="keyword">import</span> akka.event.AddressTerminatedTopic

<span class="comment">/**
 * INTERNAL API
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">object</span> <a title="akka.remote.RemoteWatcher.type" id="akka.remote.RemoteWatcher">RemoteWatcher</a> <a href="#akka.remote.RemoteWatcher" title="akka.remote.RemoteWatcher.type" class="delimiter">{</a>

  <span class="comment">/**
   * Factory method for `RemoteWatcher` [[akka.actor.Props]].
   */</span>
  <span class="keyword">def</span> <a title="(failureDetector: akka.remote.FailureDetectorRegistry[akka.actor.Address], heartbeatInterval: scala.concurrent.duration.FiniteDuration, unreachableReaperInterval: scala.concurrent.duration.FiniteDuration, heartbeatExpectedResponseAfter: scala.concurrent.duration.FiniteDuration)akka.actor.Props" id="akka.remote.RemoteWatcher.props">props</a><span class="delimiter">(</span>
    <a title="akka.remote.FailureDetectorRegistry[akka.actor.Address]" id="akka.remote.RemoteWatcher.props.failureDetector">failureDetector</a>: <a href="FailureDetectorRegistry.scala.html#akka.remote;FailureDetectorRegistry" title="akka.remote.FailureDetectorRegistry[akka.actor.Address]">FailureDetectorRegistry</a><span class="delimiter">[</span>Address<span class="delimiter">]</span>,
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.remote.RemoteWatcher.props.heartbeatInterval">heartbeatInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.remote.RemoteWatcher.props.unreachableReaperInterval">unreachableReaperInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.remote.RemoteWatcher.props.heartbeatExpectedResponseAfter">heartbeatExpectedResponseAfter</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span><span class="delimiter">)</span>: <a href="../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.remote.RemoteWatcher](classOf[akka.remote.RemoteWatcher])" class="delimiter">[</span>RemoteWatcher<span class="delimiter">]</span>, <a href="#akka.remote.RemoteWatcher.props.failureDetector" title="akka.remote.FailureDetectorRegistry[akka.actor.Address]">failureDetector</a>, <a href="#akka.remote.RemoteWatcher.props.heartbeatInterval" title="scala.concurrent.duration.FiniteDuration">heartbeatInterval</a>, <a href="#akka.remote.RemoteWatcher.props.unreachableReaperInterval" title="scala.concurrent.duration.FiniteDuration">unreachableReaperInterval</a>,
      <a href="#akka.remote.RemoteWatcher.props.heartbeatExpectedResponseAfter" title="scala.concurrent.duration.FiniteDuration">heartbeatExpectedResponseAfter</a><span class="delimiter">)</span>.<a href="../../../actor/akka/actor/Props.scala.html#akka.actor;Props.withDeploy" title="(d: akka.actor.Deploy)akka.actor.Props">withDeploy</a><span class="delimiter">(</span><a href="../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy" title="akka.actor.Deploy.type">Deploy</a>.<a href="../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy.local" title="=&gt; akka.actor.Deploy">local</a><span class="delimiter">)</span>

  <span class="keyword">case class</span> <a title="class WatchRemote extends AnyRef with Product with Serializable" id="akka.remote.RemoteWatcher.WatchRemote.readResolve">WatchRemote</a><a href="#akka.remote.RemoteWatcher.WatchRemote.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.remote.RemoteWatcher;WatchRemote.watchee">watchee</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.actor.ActorRef" id="akka.remote.RemoteWatcher;WatchRemote.watcher">watcher</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>
  <span class="keyword">case class</span> <a title="class UnwatchRemote extends AnyRef with Product with Serializable" id="akka.remote.RemoteWatcher.UnwatchRemote.readResolve">UnwatchRemote</a><a href="#akka.remote.RemoteWatcher.UnwatchRemote.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.remote.RemoteWatcher;UnwatchRemote.watchee">watchee</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.actor.ActorRef" id="akka.remote.RemoteWatcher;UnwatchRemote.watcher">watcher</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>
  <span class="keyword">case class</span> <a title="class RewatchRemote extends AnyRef with Product with Serializable" id="akka.remote.RemoteWatcher.RewatchRemote.readResolve">RewatchRemote</a><a href="#akka.remote.RemoteWatcher.RewatchRemote.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.remote.RemoteWatcher;RewatchRemote.watchee">watchee</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.actor.ActorRef" id="akka.remote.RemoteWatcher;RewatchRemote.watcher">watcher</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>
  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
  <span class="keyword">class</span> <a title="class Rewatch extends akka.dispatch.sysmsg.Watch" id="akka.remote.RemoteWatcher;Rewatch">Rewatch</a><a href="#akka.remote.RemoteWatcher;Rewatch" title="akka.remote.RemoteWatcher.Rewatch" class="delimiter">(</a><a title="akka.actor.InternalActorRef" id="akka.remote.RemoteWatcher;Rewatch.watchee">watchee</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;InternalActorRef" title="akka.actor.InternalActorRef">InternalActorRef</a>, <a title="akka.actor.InternalActorRef" id="akka.remote.RemoteWatcher;Rewatch.watcher">watcher</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;InternalActorRef" title="akka.actor.InternalActorRef">InternalActorRef</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../actor/akka/dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Watch" title="akka.dispatch.sysmsg.Watch">Watch</a><span class="delimiter">(</span><a href="#akka.remote.RemoteWatcher;Rewatch.watchee" title="akka.actor.InternalActorRef">watchee</a>, <a href="#akka.remote.RemoteWatcher;Rewatch.watcher" title="akka.actor.InternalActorRef">watcher</a><span class="delimiter">)</span>

  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case object</span> <a href="#akka.remote.RemoteWatcher.Heartbeat.productElement.x$1" title="akka.remote.RemoteWatcher.Heartbeat.type" id="akka.remote.RemoteWatcher.Heartbeat.readResolve">Heartbeat</a> <span title="Product" class="keyword">extends</span> <a href="Remoting.scala.html#akka.remote;PriorityMessage" title="akka.remote.PriorityMessage">PriorityMessage</a>
  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> <span class="keyword">case class</span> <a title="class HeartbeatRsp extends AnyRef with akka.remote.PriorityMessage with Product with Serializable" id="akka.remote.RemoteWatcher.HeartbeatRsp.readResolve">HeartbeatRsp</a><a href="#akka.remote.RemoteWatcher.HeartbeatRsp.readResolve" title="Product" class="delimiter">(</a><a title="Int" id="akka.remote.RemoteWatcher;HeartbeatRsp.addressUid">addressUid</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="Remoting.scala.html#akka.remote;PriorityMessage" title="akka.remote.PriorityMessage">PriorityMessage</a>

  <span class="comment">// sent to self only</span>
  <span class="keyword">case object</span> <a href="#akka.remote.RemoteWatcher.HeartbeatTick.productElement.x$1" title="akka.remote.RemoteWatcher.HeartbeatTick.type" id="akka.remote.RemoteWatcher.HeartbeatTick.readResolve">HeartbeatTick</a>
  <span class="keyword">case object</span> <a href="#akka.remote.RemoteWatcher.ReapUnreachableTick.productElement.x$1" title="akka.remote.RemoteWatcher.ReapUnreachableTick.type" id="akka.remote.RemoteWatcher.ReapUnreachableTick.readResolve">ReapUnreachableTick</a>
  <span class="keyword">case class</span> <a title="class ExpectedFirstHeartbeat extends AnyRef with Product with Serializable" id="akka.remote.RemoteWatcher.ExpectedFirstHeartbeat.readResolve">ExpectedFirstHeartbeat</a><a href="#akka.remote.RemoteWatcher.ExpectedFirstHeartbeat.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.Address" id="akka.remote.RemoteWatcher;ExpectedFirstHeartbeat.from">from</a>: <a href="../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a><span class="delimiter">)</span>

  <span class="comment">// test purpose</span>
  <span class="keyword">object</span> <a title="akka.remote.RemoteWatcher.Stats.type" id="akka.remote.RemoteWatcher.Stats.readResolve">Stats</a> <a href="#akka.remote.RemoteWatcher.Stats.readResolve" title="akka.remote.RemoteWatcher.Stats.type" class="delimiter">{</a>
    <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="akka.remote.RemoteWatcher.Stats" id="akka.remote.RemoteWatcher.Stats.empty">empty</a>: <a href="#akka.remote.RemoteWatcher;Stats.equals" title="akka.remote.RemoteWatcher.Stats">Stats</a> = <a href="#akka.remote.RemoteWatcher.Stats.counts" title="(watching: Int, watchingNodes: Int)akka.remote.RemoteWatcher.Stats">counts</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(watching: Int, watchingNodes: Int)akka.remote.RemoteWatcher.Stats" id="akka.remote.RemoteWatcher.Stats.counts">counts</a><span class="delimiter">(</span><a title="Int" id="akka.remote.RemoteWatcher.Stats.counts.watching">watching</a>: <span title="Int">Int</span>, <a title="Int" id="akka.remote.RemoteWatcher.Stats.counts.watchingNodes">watchingNodes</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="#akka.remote.RemoteWatcher;Stats.equals" title="akka.remote.RemoteWatcher.Stats">Stats</a> =
      <span title="akka.remote.RemoteWatcher.Stats" class="keyword">new</span> <a href="#akka.remote.RemoteWatcher;Stats.equals" title="akka.remote.RemoteWatcher.Stats">Stats</a><span class="delimiter">(</span><a href="#akka.remote.RemoteWatcher.Stats.counts.watching" title="Int">watching</a>, <a href="#akka.remote.RemoteWatcher.Stats.counts.watchingNodes" title="Int">watchingNodes</a><span class="delimiter">)</span><span class="delimiter">(</span><span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">empty</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">case class</span> <a title="(watching: Int, watchingNodes: Int)(watchingRefs: Set[(akka.actor.ActorRef, akka.actor.ActorRef)])akka.remote.RemoteWatcher.Stats" id="akka.remote.RemoteWatcher;Stats.equals">Stats</a><a href="#akka.remote.RemoteWatcher;Stats.equals" title="Product" class="delimiter">(</a><a title="Int" id="akka.remote.RemoteWatcher;Stats.copy$default$1">watching</a>: <span title="Int">Int</span>, <a title="Int" id="akka.remote.RemoteWatcher;Stats.copy$default$2">watchingNodes</a>: <span title="Int">Int</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">val</span> <a title="Set[(akka.actor.ActorRef, akka.actor.ActorRef)]" id="akka.remote.RemoteWatcher;Stats.copy.watchingRefs">watchingRefs</a>: <span title="Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">Set</span><span class="delimiter">[</span><span class="delimiter">(</span>ActorRef, ActorRef<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="akka.remote.RemoteWatcher;Stats.toString">toString</a>: <span title="String">String</span> = <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="=&gt; String" id="akka.remote.RemoteWatcher;Stats.toString.formatWatchingRefs">formatWatchingRefs</a>: <span title="String">String</span> =
        <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.remote.RemoteWatcher;Stats.copy.watchingRefs" title="=&gt; Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">watchingRefs</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>
        <span class="keyword">else</span> <span title="String(&quot;, watchingRefs=&quot;)" class="string">&quot;, watchingRefs=&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.remote.RemoteWatcher;Stats.copy.watchingRefs" title="=&gt; Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">watchingRefs</a>.<span title="(f: ((akka.actor.ActorRef, akka.actor.ActorRef)) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set[(akka.actor.ActorRef, akka.actor.ActorRef)],String,scala.collection.immutable.Set[String]])scala.collection.immutable.Set[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set.Coll,String,scala.collection.immutable.Set[String]]" class="delimiter">(</span><a title="(akka.actor.ActorRef, akka.actor.ActorRef)" id="akka.remote.RemoteWatcher;Stats.toString.formatWatchingRefs.$anonfun.x">x</a> ⇒ <a href="#akka.remote.RemoteWatcher;Stats.toString.formatWatchingRefs.$anonfun.x" title="(akka.actor.ActorRef, akka.actor.ActorRef)">x</a>.<span title="=&gt; akka.actor.ActorRef">_2</span>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.name" title="=&gt; String">name</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; -&gt; &quot;)" class="string">&quot; -&gt; &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.remote.RemoteWatcher;Stats.toString.formatWatchingRefs.$anonfun.x" title="(akka.actor.ActorRef, akka.actor.ActorRef)">x</a>.<span title="=&gt; akka.actor.ActorRef">_1</span>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.name" title="=&gt; String">name</a><span class="delimiter">)</span>.<span title="(start: String, sep: String, end: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;[&quot;)" class="string">&quot;[&quot;</span>, <span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span>, <span title="String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span>

      <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Stats(watching=&quot;)">Stats(watching=$</span><span class="delimiter">{</span><a href="#akka.remote.RemoteWatcher;Stats.copy$default$1" title="=&gt; Int">watching</a><span class="delimiter">}</span><span title="String(&quot;, watchingNodes=&quot;)">, watchingNodes=$</span><span class="delimiter">{</span><a href="#akka.remote.RemoteWatcher;Stats.copy$default$2" title="=&gt; Int">watchingNodes</a><span class="delimiter">}</span><span title="String(&quot;&quot;)">$</span><span class="delimiter">{</span><a href="#akka.remote.RemoteWatcher;Stats.toString.formatWatchingRefs" title="=&gt; String">formatWatchingRefs</a><span class="delimiter">}</span><span title="String(&quot;)&quot;)" class="string">)&quot;</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API
 *
 * Remote nodes with actors that are watched are monitored by this actor to be able
 * to detect network failures and JVM crashes. [[akka.remote.RemoteActorRefProvider]]
 * intercepts Watch and Unwatch system messages and sends corresponding
 * [[RemoteWatcher.WatchRemote]] and [[RemoteWatcher.UnwatchRemote]] to this actor.
 *
 * For a new node to be watched this actor periodically sends [[RemoteWatcher.Heartbeat]]
 * to the peer actor on the other node, which replies with [[RemoteWatcher.HeartbeatRsp]]
 * message back. The failure detector on the watching side monitors these heartbeat messages.
 * If arrival of hearbeat messages stops it will be detected and this actor will publish
 * [[akka.actor.AddressTerminated]] to the [[akka.event.AddressTerminatedTopic]].
 *
 * When all actors on a node have been unwatched it will stop sending heartbeat messages.
 *
 * For bi-directional watch between two nodes the same thing will be established in
 * both directions, but independent of each other.
 *
 */</span>
<span title="AnyRef" class="keyword">private</span><span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="keyword">class</span> <a title="class RemoteWatcher extends AnyRef with akka.actor.Actor with akka.actor.ActorLogging with akka.dispatch.RequiresMessageQueue[akka.dispatch.UnboundedMessageQueueSemantics]" id="akka.remote;RemoteWatcher">RemoteWatcher</a><a href="#akka.remote;RemoteWatcher" title="akka.remote.RemoteWatcher" class="delimiter">(</a>
  <a title="akka.remote.FailureDetectorRegistry[akka.actor.Address]" id="akka.remote;RemoteWatcher.failureDetector">failureDetector</a>: <a href="FailureDetectorRegistry.scala.html#akka.remote;FailureDetectorRegistry" title="akka.remote.FailureDetectorRegistry[akka.actor.Address]">FailureDetectorRegistry</a><span class="delimiter">[</span>Address<span class="delimiter">]</span>,
  <a title="scala.concurrent.duration.FiniteDuration" id="akka.remote;RemoteWatcher.heartbeatInterval">heartbeatInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
  <a title="scala.concurrent.duration.FiniteDuration" id="akka.remote;RemoteWatcher.unreachableReaperInterval">unreachableReaperInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
  <a title="scala.concurrent.duration.FiniteDuration" id="akka.remote;RemoteWatcher.heartbeatExpectedResponseAfter">heartbeatExpectedResponseAfter</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="keyword">with</span> <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="keyword">with</span> <a href="../../../actor/akka/dispatch/Mailbox.scala.html#akka.dispatch;RequiresMessageQueue" title="akka.dispatch.RequiresMessageQueue[akka.dispatch.UnboundedMessageQueueSemantics]">RequiresMessageQueue</a><span class="delimiter">[</span>UnboundedMessageQueueSemantics<span class="delimiter">]</span> <span class="delimiter">{</span>

  <span class="keyword">import</span> <a href="#akka.remote.RemoteWatcher" title="akka.remote.RemoteWatcher.type">RemoteWatcher</a>._
  <span class="keyword">import</span> <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher
  <span class="keyword">def</span> <a title="=&gt; akka.actor.Scheduler" id="akka.remote;RemoteWatcher.scheduler">scheduler</a> = <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>

  <span class="keyword">val</span> <a title="akka.remote.RemoteActorRefProvider" id="akka.remote;RemoteWatcher.remoteProvider">remoteProvider</a>: <a href="RemoteActorRefProvider.scala.html#akka.remote;RemoteActorRefProvider" title="akka.remote.RemoteActorRefProvider">RemoteActorRefProvider</a> = <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.actor.ExtendedActorSystem" class="delimiter">[</span><a href="../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ExtendedActorSystem" title="akka.actor.ExtendedActorSystem">ExtendedActorSystem</a><span class="delimiter">]</span>.<a href="../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ExtendedActorSystem.provider" title="=&gt; akka.actor.ActorRefProvider">provider</a> <span title="akka.remote.RemoteActorRefProvider" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="akka.remote.RemoteActorRefProvider" id="akka.remote;RemoteWatcher.remoteProvider.rarp">rarp</a>: <a href="RemoteActorRefProvider.scala.html#akka.remote;RemoteActorRefProvider" title="akka.remote.RemoteActorRefProvider">RemoteActorRefProvider</a> ⇒ <a href="#akka.remote;RemoteWatcher.remoteProvider.rarp" title="akka.remote.RemoteActorRefProvider">rarp</a>
    <span class="keyword">case</span> <a title="akka.actor.ActorRefProvider" id="akka.remote;RemoteWatcher.remoteProvider.other">other</a> ⇒ <span title="Nothing" class="keyword">throw</span> <a href="../../../actor/akka/AkkaException.scala.html#akka;ConfigurationException.<init>(3b0f220dea)" title="(msg: String)akka.ConfigurationException" class="keyword">new</a> <a href="../../../actor/akka/AkkaException.scala.html#akka;ConfigurationException" title="akka.ConfigurationException">ConfigurationException</a><span class="delimiter">(</span>
      <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;ActorSystem [&quot;)">ActorSystem [$</span><span class="delimiter">{</span><a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">}</span><span title="String(&quot;] needs to have a \'RemoteActorRefProvider\' enabled in the configuration, currently uses [&quot;)">] needs to have a 'RemoteActorRefProvider' enabled in the configuration, currently uses [$</span><span class="delimiter">{</span><a href="#akka.remote;RemoteWatcher.remoteProvider.other" title="akka.actor.ActorRefProvider">other</a>.<span title="()Class[_]">getClass</span>.<span title="()String">getName</span><span class="delimiter">}</span><span title="String(&quot;]&quot;)" class="string">]&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">val</span> <a title="akka.remote.RemoteWatcher.HeartbeatRsp" id="akka.remote;RemoteWatcher.selfHeartbeatRspMsg">selfHeartbeatRspMsg</a> = <a href="#akka.remote.RemoteWatcher.HeartbeatRsp.readResolve" title="(addressUid: Int)akka.remote.RemoteWatcher.HeartbeatRsp">HeartbeatRsp</a><span class="delimiter">(</span><a href="../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.remote.AddressUidExtension">AddressUidExtension</a><span class="delimiter">(</span><a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>.<a href="AddressUidExtension.scala.html#akka.remote;AddressUidExtension.addressUid" title="=&gt; Int">addressUid</a><span class="delimiter">)</span>

  <span class="comment">// actors that this node is watching, tuple with (watcher, watchee)</span>
  <span class="keyword">var</span> <a title="Set[(akka.actor.ActorRef, akka.actor.ActorRef)]" id="akka.remote;RemoteWatcher.watching_=">watching</a>: <span title="Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">Set</span><span class="delimiter">[</span><span class="delimiter">(</span>ActorRef, ActorRef<span class="delimiter">)</span><span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">empty</span>
  <span class="comment">// nodes that this node is watching, i.e. expecting hearteats from these nodes</span>
  <span class="keyword">var</span> <a title="Set[akka.actor.Address]" id="akka.remote;RemoteWatcher.watchingNodes_=">watchingNodes</a>: <span title="Set[akka.actor.Address]">Set</span><span class="delimiter">[</span>Address<span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.actor.Address]">empty</span>
  <span class="keyword">var</span> <a title="Set[akka.actor.Address]" id="akka.remote;RemoteWatcher.unreachable_=">unreachable</a>: <span title="Set[akka.actor.Address]">Set</span><span class="delimiter">[</span>Address<span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.actor.Address]">empty</span>
  <span class="keyword">var</span> <a title="Map[akka.actor.Address,Int]" id="akka.remote;RemoteWatcher.addressUids_=">addressUids</a>: <span title="Map[akka.actor.Address,Int]">Map</span><span class="delimiter">[</span>Address, Int<span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="scala.collection.immutable.Map[akka.actor.Address,Nothing]">empty</span>

  <span class="keyword">val</span> <a title="akka.actor.Cancellable" id="akka.remote;RemoteWatcher.heartbeatTask">heartbeatTask</a> = <a href="#akka.remote;RemoteWatcher.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.schedule(abf8206fc2)" title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">schedule</a><a href="../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="#akka.remote;RemoteWatcher.heartbeatInterval" title="scala.concurrent.duration.FiniteDuration">heartbeatInterval</a>, <a href="#akka.remote;RemoteWatcher.heartbeatInterval" title="scala.concurrent.duration.FiniteDuration">heartbeatInterval</a>, <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.remote.RemoteWatcher.HeartbeatTick.readResolve" title="akka.remote.RemoteWatcher.HeartbeatTick.type">HeartbeatTick</a><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="akka.actor.Cancellable" id="akka.remote;RemoteWatcher.failureDetectorReaperTask">failureDetectorReaperTask</a> = <a href="#akka.remote;RemoteWatcher.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.schedule(abf8206fc2)" title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">schedule</a><a href="../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="#akka.remote;RemoteWatcher.unreachableReaperInterval" title="scala.concurrent.duration.FiniteDuration">unreachableReaperInterval</a>, <a href="#akka.remote;RemoteWatcher.unreachableReaperInterval" title="scala.concurrent.duration.FiniteDuration">unreachableReaperInterval</a>,
    <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.remote.RemoteWatcher.ReapUnreachableTick.readResolve" title="akka.remote.RemoteWatcher.ReapUnreachableTick.type">ReapUnreachableTick</a><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.remote;RemoteWatcher.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.remote;RemoteWatcher" title="akka.remote.RemoteWatcher" class="keyword">super</a>.<a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.postStop" title="()Unit">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.remote;RemoteWatcher.heartbeatTask" title="=&gt; akka.actor.Cancellable">heartbeatTask</a>.<a href="../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Cancellable.cancel" title="()Boolean">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.remote;RemoteWatcher.failureDetectorReaperTask" title="=&gt; akka.actor.Cancellable">failureDetectorReaperTask</a>.<a href="../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Cancellable.cancel" title="()Boolean">cancel</a><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; PartialFunction[Any,Unit]" id="akka.remote;RemoteWatcher.receive">receive</a> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.remote;RemoteWatcher.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    <span class="keyword">case</span> <a href="#akka.remote.RemoteWatcher.HeartbeatTick.readResolve" title="akka.remote.RemoteWatcher.HeartbeatTick.type">HeartbeatTick</a>                   ⇒ <a href="#akka.remote;RemoteWatcher.sendHeartbeat" title="()Unit">sendHeartbeat</a><span title="Boolean(true)" class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#akka.remote.RemoteWatcher.Heartbeat.readResolve" title="akka.remote.RemoteWatcher.Heartbeat.type">Heartbeat</a>                       ⇒ <a href="#akka.remote;RemoteWatcher.receiveHeartbeat" title="()Unit">receiveHeartbeat</a><span title="Boolean(true)" class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">case</span> HeartbeatRsp<span class="delimiter">(</span><a title="Int" id="akka.remote;RemoteWatcher.receive;$anonfun.isDefinedAt.uid">uid</a><span class="delimiter">)</span>               ⇒ <a href="#akka.remote;RemoteWatcher.receiveHeartbeatRsp" title="(uid: Int)Unit">receiveHeartbeatRsp</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.receive;$anonfun.isDefinedAt.uid" title="Int">uid</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#akka.remote.RemoteWatcher.ReapUnreachableTick.readResolve" title="akka.remote.RemoteWatcher.ReapUnreachableTick.type">ReapUnreachableTick</a>             ⇒ <a href="#akka.remote;RemoteWatcher.reapUnreachable" title="()Unit">reapUnreachable</a><span title="Boolean(true)" class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">case</span> ExpectedFirstHeartbeat<span class="delimiter">(</span><a title="akka.actor.Address" id="akka.remote;RemoteWatcher.receive;$anonfun.isDefinedAt.from">from</a><span class="delimiter">)</span>    ⇒ <a href="#akka.remote;RemoteWatcher.triggerFirstHeartbeat" title="(address: akka.actor.Address)Unit">triggerFirstHeartbeat</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.receive;$anonfun.isDefinedAt.from" title="akka.actor.Address">from</a><span class="delimiter">)</span>
    <span class="keyword">case</span> WatchRemote<span class="delimiter">(</span><span title="akka.actor.ActorRef">watchee</span>, <span title="akka.actor.ActorRef">watcher</span><span class="delimiter">)</span>   ⇒ <a href="#akka.remote;RemoteWatcher.watchRemote" title="(watchee: akka.actor.ActorRef, watcher: akka.actor.ActorRef)Unit">watchRemote</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.actor.ActorRef">watchee</span>, <span title="akka.actor.ActorRef">watcher</span><span class="delimiter">)</span>
    <span class="keyword">case</span> UnwatchRemote<span class="delimiter">(</span><span title="akka.actor.ActorRef">watchee</span>, <span title="akka.actor.ActorRef">watcher</span><span class="delimiter">)</span> ⇒ <a href="#akka.remote;RemoteWatcher.unwatchRemote" title="(watchee: akka.actor.ActorRef, watcher: akka.actor.ActorRef)Unit">unwatchRemote</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.actor.ActorRef">watchee</span>, <span title="akka.actor.ActorRef">watcher</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="akka.actor.Terminated" id="akka.remote;RemoteWatcher.receive;$anonfun.isDefinedAt.t">t</a> @ Terminated<span class="delimiter">(</span><span title="akka.actor.ActorRef">watchee</span><span class="delimiter">)</span>         ⇒ <a href="#akka.remote;RemoteWatcher.terminated" title="(watchee: akka.actor.ActorRef, existenceConfirmed: Boolean, addressTerminated: Boolean)Unit">terminated</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.actor.ActorRef">watchee</span>, <a href="#akka.remote;RemoteWatcher.receive;$anonfun.isDefinedAt.t" title="akka.actor.Terminated">t</a>.<a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Terminated.existenceConfirmed" title="=&gt; Boolean">existenceConfirmed</a>, <a href="#akka.remote;RemoteWatcher.receive;$anonfun.isDefinedAt.t" title="akka.actor.Terminated">t</a>.<a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Terminated.addressTerminated" title="=&gt; Boolean">addressTerminated</a><span class="delimiter">)</span>
    <span class="keyword">case</span> RewatchRemote<span class="delimiter">(</span><span title="akka.actor.ActorRef">watchee</span>, <span title="akka.actor.ActorRef">watcher</span><span class="delimiter">)</span> ⇒ <a href="#akka.remote;RemoteWatcher.rewatchRemote" title="(watchee: akka.actor.ActorRef, watcher: akka.actor.ActorRef)Unit">rewatchRemote</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.actor.ActorRef">watchee</span>, <span title="akka.actor.ActorRef">watcher</span><span class="delimiter">)</span>

    <span class="comment">// test purpose</span>
    <span class="keyword">case</span> <a href="#akka.remote.RemoteWatcher.Stats.readResolve" title="akka.remote.RemoteWatcher.Stats.type">Stats</a> ⇒
      <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.remote.RemoteWatcher;Stats.equals" title="(watching: Int, watchingNodes: Int)(watchingRefs: Set[(akka.actor.ActorRef, akka.actor.ActorRef)])akka.remote.RemoteWatcher.Stats">Stats</a><span class="delimiter">(</span>
        watching = <a href="#akka.remote;RemoteWatcher.watching_=" title="=&gt; Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">watching</a>.<span title="=&gt; Int">size</span>,
        watchingNodes = <a href="#akka.remote;RemoteWatcher.watchingNodes_=" title="=&gt; Set[akka.actor.Address]">watchingNodes</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.watching_=" title="=&gt; Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">watching</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.remote;RemoteWatcher.receiveHeartbeat">receiveHeartbeat</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.remote;RemoteWatcher.selfHeartbeatRspMsg" title="=&gt; akka.remote.RemoteWatcher.HeartbeatRsp">selfHeartbeatRspMsg</a>

  <span class="keyword">def</span> <a title="(uid: Int)Unit" id="akka.remote;RemoteWatcher.receiveHeartbeatRsp">receiveHeartbeatRsp</a><span class="delimiter">(</span><a title="Int" id="akka.remote;RemoteWatcher.receiveHeartbeatRsp.uid">uid</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="akka.actor.Address" id="akka.remote;RemoteWatcher.receiveHeartbeatRsp.from">from</a> = <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.failureDetector" title="akka.remote.FailureDetectorRegistry[akka.actor.Address]">failureDetector</a>.<a href="FailureDetectorRegistry.scala.html#akka.remote;FailureDetectorRegistry.isMonitoring" title="(resource: akka.actor.Address)Boolean">isMonitoring</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.receiveHeartbeatRsp.from" title="akka.actor.Address">from</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Received heartbeat rsp from [{}]&quot;)" class="string">&quot;Received heartbeat rsp from [{}]&quot;</span>, <a href="#akka.remote;RemoteWatcher.receiveHeartbeatRsp.from" title="akka.actor.Address">from</a><span class="delimiter">)</span>
    <span class="keyword">else</span>
      <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Received first heartbeat rsp from [{}]&quot;)" class="string">&quot;Received first heartbeat rsp from [{}]&quot;</span>, <a href="#akka.remote;RemoteWatcher.receiveHeartbeatRsp.from" title="akka.actor.Address">from</a><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.watchingNodes_=" title="(elem: akka.actor.Address)Boolean">watchingNodes</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.receiveHeartbeatRsp.from" title="akka.actor.Address">from</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#akka.remote;RemoteWatcher.unreachable_=" title="(elem: akka.actor.Address)Boolean">unreachable</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.receiveHeartbeatRsp.from" title="akka.actor.Address">from</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.remote;RemoteWatcher.addressUids_=" title="=&gt; Map[akka.actor.Address,Int]">addressUids</a>.<span title="(key: akka.actor.Address)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.receiveHeartbeatRsp.from" title="akka.actor.Address">from</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#akka.remote;RemoteWatcher.addressUids_=" title="(key: akka.actor.Address)Int">addressUids</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.receiveHeartbeatRsp.from" title="akka.actor.Address">from</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <a href="#akka.remote;RemoteWatcher.receiveHeartbeatRsp.uid" title="Int">uid</a><span class="delimiter">)</span>
        <a href="#akka.remote;RemoteWatcher.reWatch" title="(address: akka.actor.Address)Unit">reWatch</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.receiveHeartbeatRsp.from" title="akka.actor.Address">from</a><span class="delimiter">)</span>
      <a href="#akka.remote;RemoteWatcher.addressUids_=" title="(x$1: Map[akka.actor.Address,Int])Unit">addressUids</a> <span title="(kv: (akka.actor.Address, Int))scala.collection.immutable.Map[akka.actor.Address,Int]">+=</span> <span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.receiveHeartbeatRsp.from" title="(x: akka.actor.Address)ArrowAssoc[akka.actor.Address]">from</a> <span title="(y: Int)(akka.actor.Address, Int)">-&gt;</span> <a href="#akka.remote;RemoteWatcher.receiveHeartbeatRsp.uid" title="Int">uid</a><span class="delimiter">)</span>
      <a href="#akka.remote;RemoteWatcher.failureDetector" title="akka.remote.FailureDetectorRegistry[akka.actor.Address]">failureDetector</a>.<a href="FailureDetectorRegistry.scala.html#akka.remote;FailureDetectorRegistry.heartbeat" title="(resource: akka.actor.Address)Unit">heartbeat</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.receiveHeartbeatRsp.from" title="akka.actor.Address">from</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.remote;RemoteWatcher.reapUnreachable">reapUnreachable</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.remote;RemoteWatcher.watchingNodes_=" title="=&gt; Set[akka.actor.Address]">watchingNodes</a> <span title="(f: akka.actor.Address =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="akka.actor.Address" id="akka.remote;RemoteWatcher.reapUnreachable.$anonfun.a">a</a> ⇒
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.remote;RemoteWatcher.unreachable_=" title="(elem: akka.actor.Address)Boolean">unreachable</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.reapUnreachable.$anonfun.a" title="akka.actor.Address">a</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#akka.remote;RemoteWatcher.failureDetector" title="akka.remote.FailureDetectorRegistry[akka.actor.Address]">failureDetector</a>.<a href="FailureDetectorRegistry.scala.html#akka.remote;FailureDetectorRegistry.isAvailable" title="(resource: akka.actor.Address)Boolean">isAvailable</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.reapUnreachable.$anonfun.a" title="akka.actor.Address">a</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.warning(dc73c33c91)" title="(template: String, arg1: Any)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;Detected unreachable: [{}]&quot;)" class="string">&quot;Detected unreachable: [{}]&quot;</span>, <a href="#akka.remote;RemoteWatcher.reapUnreachable.$anonfun.a" title="akka.actor.Address">a</a><span class="delimiter">)</span>
        <a href="#akka.remote;RemoteWatcher.quarantine" title="(address: akka.actor.Address, uid: Option[Int])Unit">quarantine</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.reapUnreachable.$anonfun.a" title="akka.actor.Address">a</a>, <a href="#akka.remote;RemoteWatcher.addressUids_=" title="=&gt; Map[akka.actor.Address,Int]">addressUids</a>.<span title="(key: akka.actor.Address)Option[Int]">get</span><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.reapUnreachable.$anonfun.a" title="akka.actor.Address">a</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.remote;RemoteWatcher.publishAddressTerminated" title="(address: akka.actor.Address)Unit">publishAddressTerminated</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.reapUnreachable.$anonfun.a" title="akka.actor.Address">a</a><span class="delimiter">)</span>
        <a href="#akka.remote;RemoteWatcher.unreachable_=" title="(x$1: Set[akka.actor.Address])Unit">unreachable</a> <span title="(elem: akka.actor.Address)scala.collection.immutable.Set[akka.actor.Address]">+=</span> <a href="#akka.remote;RemoteWatcher.reapUnreachable.$anonfun.a" title="akka.actor.Address">a</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(address: akka.actor.Address)Unit" id="akka.remote;RemoteWatcher.publishAddressTerminated">publishAddressTerminated</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.remote;RemoteWatcher.publishAddressTerminated.address">address</a>: <a href="../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.event.AddressTerminatedTopic">AddressTerminatedTopic</a><span class="delimiter">(</span><a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>.<a href="../../../actor/akka/event/AddressTerminatedTopic.scala.html#akka.event;AddressTerminatedTopic.publish" title="(msg: akka.actor.AddressTerminated)Unit">publish</a><span class="delimiter">(</span><a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;AddressTerminated" title="(address: akka.actor.Address)akka.actor.AddressTerminated">AddressTerminated</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.publishAddressTerminated.address" title="akka.actor.Address">address</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(address: akka.actor.Address, uid: Option[Int])Unit" id="akka.remote;RemoteWatcher.quarantine">quarantine</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.remote;RemoteWatcher.quarantine.address">address</a>: <a href="../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a>, <a title="Option[Int]" id="akka.remote;RemoteWatcher.quarantine.uid">uid</a>: <span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.remote;RemoteWatcher.remoteProvider" title="=&gt; akka.remote.RemoteActorRefProvider">remoteProvider</a>.<a href="RemoteActorRefProvider.scala.html#akka.remote;RemoteActorRefProvider.quarantine" title="(address: akka.actor.Address, uid: Option[Int])Unit">quarantine</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.quarantine.address" title="akka.actor.Address">address</a>, <a href="#akka.remote;RemoteWatcher.quarantine.uid" title="Option[Int]">uid</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(watchee: akka.actor.ActorRef, watcher: akka.actor.ActorRef)Unit" id="akka.remote;RemoteWatcher.rewatchRemote">rewatchRemote</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.rewatchRemote.watchee">watchee</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.rewatchRemote.watcher">watcher</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.watching_=" title="=&gt; Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">watching</a>.<span title="(elem: (akka.actor.ActorRef, akka.actor.ActorRef))Boolean">contains</span><span class="delimiter">(</span><span title="(_1: akka.actor.ActorRef, _2: akka.actor.ActorRef)(akka.actor.ActorRef, akka.actor.ActorRef)" class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.rewatchRemote.watchee" title="akka.actor.ActorRef">watchee</a>, <a href="#akka.remote;RemoteWatcher.rewatchRemote.watcher" title="akka.actor.ActorRef">watcher</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.remote;RemoteWatcher.watchRemote" title="(watchee: akka.actor.ActorRef, watcher: akka.actor.ActorRef)Unit">watchRemote</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.rewatchRemote.watchee" title="akka.actor.ActorRef">watchee</a>, <a href="#akka.remote;RemoteWatcher.rewatchRemote.watcher" title="akka.actor.ActorRef">watcher</a><span class="delimiter">)</span>
    <span class="keyword">else</span>
      <span class="comment">//has been unwatched inbetween, skip re-watch</span>
      <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Ignoring re-watch after being unwatched in the meantime: [{} -&gt; {}]&quot;)" class="string">&quot;Ignoring re-watch after being unwatched in the meantime: [{} -&gt; {}]&quot;</span>, <a href="#akka.remote;RemoteWatcher.rewatchRemote.watcher" title="akka.actor.ActorRef">watcher</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>, <a href="#akka.remote;RemoteWatcher.rewatchRemote.watchee" title="akka.actor.ActorRef">watchee</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(watchee: akka.actor.ActorRef, watcher: akka.actor.ActorRef)Unit" id="akka.remote;RemoteWatcher.watchRemote">watchRemote</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.watchRemote.watchee">watchee</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.watchRemote.watcher">watcher</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.watchRemote.watchee" title="akka.actor.ActorRef">watchee</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.uid" title="=&gt; Int">uid</a> <span title="(x: Int)Boolean">==</span> akka.actor.ActorCell.<span title="Int(0)">undefinedUid</span><span class="delimiter">)</span>
      <a href="#akka.remote;RemoteWatcher.logActorForDeprecationWarning" title="(watchee: akka.actor.ActorRef)Unit">logActorForDeprecationWarning</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.watchRemote.watchee" title="akka.actor.ActorRef">watchee</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.watchRemote.watcher" title="akka.actor.ActorRef">watcher</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Watching: [{} -&gt; {}]&quot;)" class="string">&quot;Watching: [{} -&gt; {}]&quot;</span>, <a href="#akka.remote;RemoteWatcher.watchRemote.watcher" title="akka.actor.ActorRef">watcher</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>, <a href="#akka.remote;RemoteWatcher.watchRemote.watchee" title="akka.actor.ActorRef">watchee</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a><span class="delimiter">)</span>
      <a href="#akka.remote;RemoteWatcher.addWatching" title="(watchee: akka.actor.ActorRef, watcher: akka.actor.ActorRef)Unit">addWatching</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.watchRemote.watchee" title="akka.actor.ActorRef">watchee</a>, <a href="#akka.remote;RemoteWatcher.watchRemote.watcher" title="akka.actor.ActorRef">watcher</a><span class="delimiter">)</span>

      <span class="comment">// also watch from self, to be able to cleanup on termination of the watchee</span>
      <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a> <a href="../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a> <a href="#akka.remote;RemoteWatcher.watchRemote.watchee" title="akka.actor.ActorRef">watchee</a>
      <a href="#akka.remote;RemoteWatcher.watching_=" title="(x$1: Set[(akka.actor.ActorRef, akka.actor.ActorRef)])Unit">watching</a> <span title="(elem: (akka.actor.ActorRef, akka.actor.ActorRef))scala.collection.immutable.Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">+=</span> <span class="delimiter">(</span><span title="(_1: akka.actor.ActorRef, _2: akka.actor.ActorRef)(akka.actor.ActorRef, akka.actor.ActorRef)" class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.watchRemote.watchee" title="akka.actor.ActorRef">watchee</a>, <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(watchee: akka.actor.ActorRef, watcher: akka.actor.ActorRef)Unit" id="akka.remote;RemoteWatcher.addWatching">addWatching</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.addWatching.watchee">watchee</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.addWatching.watcher">watcher</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.remote;RemoteWatcher.watching_=" title="(x$1: Set[(akka.actor.ActorRef, akka.actor.ActorRef)])Unit">watching</a> <span title="(elem: (akka.actor.ActorRef, akka.actor.ActorRef))scala.collection.immutable.Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">+=</span> <span class="delimiter">(</span><span title="(_1: akka.actor.ActorRef, _2: akka.actor.ActorRef)(akka.actor.ActorRef, akka.actor.ActorRef)" class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.addWatching.watchee" title="akka.actor.ActorRef">watchee</a>, <a href="#akka.remote;RemoteWatcher.addWatching.watcher" title="akka.actor.ActorRef">watcher</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="akka.actor.Address" id="akka.remote;RemoteWatcher.addWatching.watcheeAddress">watcheeAddress</a> = <a href="#akka.remote;RemoteWatcher.addWatching.watchee" title="akka.actor.ActorRef">watchee</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.remote;RemoteWatcher.watchingNodes_=" title="(elem: akka.actor.Address)Boolean">watchingNodes</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.addWatching.watcheeAddress" title="akka.actor.Address">watcheeAddress</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.remote;RemoteWatcher.unreachable_=" title="(elem: akka.actor.Address)Boolean">unreachable</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.addWatching.watcheeAddress" title="akka.actor.Address">watcheeAddress</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// first watch to that node after a previous unreachable</span>
      <a href="#akka.remote;RemoteWatcher.unreachable_=" title="(x$1: Set[akka.actor.Address])Unit">unreachable</a> <span title="(elem: akka.actor.Address)scala.collection.immutable.Set[akka.actor.Address]">-=</span> <a href="#akka.remote;RemoteWatcher.addWatching.watcheeAddress" title="akka.actor.Address">watcheeAddress</a>
      <a href="#akka.remote;RemoteWatcher.failureDetector" title="akka.remote.FailureDetectorRegistry[akka.actor.Address]">failureDetector</a>.<a href="FailureDetectorRegistry.scala.html#akka.remote;FailureDetectorRegistry.remove" title="(resource: akka.actor.Address)Unit">remove</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.addWatching.watcheeAddress" title="akka.actor.Address">watcheeAddress</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#akka.remote;RemoteWatcher.watchingNodes_=" title="(x$1: Set[akka.actor.Address])Unit">watchingNodes</a> <span title="(elem: akka.actor.Address)scala.collection.immutable.Set[akka.actor.Address]">+=</span> <a href="#akka.remote;RemoteWatcher.addWatching.watcheeAddress" title="akka.actor.Address">watcheeAddress</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(watchee: akka.actor.ActorRef, watcher: akka.actor.ActorRef)Unit" id="akka.remote;RemoteWatcher.unwatchRemote">unwatchRemote</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.unwatchRemote.watchee">watchee</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.unwatchRemote.watcher">watcher</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.unwatchRemote.watchee" title="akka.actor.ActorRef">watchee</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.uid" title="=&gt; Int">uid</a> <span title="(x: Int)Boolean">==</span> akka.actor.ActorCell.<span title="Int(0)">undefinedUid</span><span class="delimiter">)</span>
      <a href="#akka.remote;RemoteWatcher.logActorForDeprecationWarning" title="(watchee: akka.actor.ActorRef)Unit">logActorForDeprecationWarning</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.unwatchRemote.watchee" title="akka.actor.ActorRef">watchee</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.unwatchRemote.watcher" title="akka.actor.ActorRef">watcher</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Unwatching: [{} -&gt; {}]&quot;)" class="string">&quot;Unwatching: [{} -&gt; {}]&quot;</span>, <a href="#akka.remote;RemoteWatcher.unwatchRemote.watcher" title="akka.actor.ActorRef">watcher</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>, <a href="#akka.remote;RemoteWatcher.unwatchRemote.watchee" title="akka.actor.ActorRef">watchee</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a><span class="delimiter">)</span>
      <a href="#akka.remote;RemoteWatcher.watching_=" title="(x$1: Set[(akka.actor.ActorRef, akka.actor.ActorRef)])Unit">watching</a> <span title="(elem: (akka.actor.ActorRef, akka.actor.ActorRef))scala.collection.immutable.Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">-=</span> <span class="delimiter">(</span><span title="(_1: akka.actor.ActorRef, _2: akka.actor.ActorRef)(akka.actor.ActorRef, akka.actor.ActorRef)" class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.unwatchRemote.watchee" title="akka.actor.ActorRef">watchee</a>, <a href="#akka.remote;RemoteWatcher.unwatchRemote.watcher" title="akka.actor.ActorRef">watcher</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="comment">// clean up self watch when no more watchers of this watchee</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.watching_=" title="=&gt; Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">watching</a>.<span title="(p: ((akka.actor.ActorRef, akka.actor.ActorRef)) =&gt; Boolean)Boolean">forall</span> <a href="#akka.remote;RemoteWatcher.unwatchRemote.$anonfun.x0$1" title="Boolean" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.unwatchRemote.$anonfun.wee">wee</a>, <a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.unwatchRemote.$anonfun.wer">wer</a><span class="delimiter">)</span> ⇒ <a href="#akka.remote;RemoteWatcher.unwatchRemote.$anonfun.wee" title="akka.actor.ActorRef">wee</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#akka.remote;RemoteWatcher.unwatchRemote.watchee" title="akka.actor.ActorRef">watchee</a> <span title="(x: Boolean)Boolean">||</span> <a href="#akka.remote;RemoteWatcher.unwatchRemote.$anonfun.wer" title="akka.actor.ActorRef">wer</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a> <span class="delimiter">}</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Cleanup self watch of [{}]&quot;)" class="string">&quot;Cleanup self watch of [{}]&quot;</span>, <a href="#akka.remote;RemoteWatcher.unwatchRemote.watchee" title="akka.actor.ActorRef">watchee</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a><span class="delimiter">)</span>
        <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a> <a href="../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.unwatch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">unwatch</a> <a href="#akka.remote;RemoteWatcher.unwatchRemote.watchee" title="akka.actor.ActorRef">watchee</a>
        <a href="#akka.remote;RemoteWatcher.watching_=" title="(x$1: Set[(akka.actor.ActorRef, akka.actor.ActorRef)])Unit">watching</a> <span title="(elem: (akka.actor.ActorRef, akka.actor.ActorRef))scala.collection.immutable.Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">-=</span> <span class="delimiter">(</span><span title="(_1: akka.actor.ActorRef, _2: akka.actor.ActorRef)(akka.actor.ActorRef, akka.actor.ActorRef)" class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.unwatchRemote.watchee" title="akka.actor.ActorRef">watchee</a>, <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#akka.remote;RemoteWatcher.checkLastUnwatchOfNode" title="(watcheeAddress: akka.actor.Address)Unit">checkLastUnwatchOfNode</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.unwatchRemote.watchee" title="akka.actor.ActorRef">watchee</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(watchee: akka.actor.ActorRef)Unit" id="akka.remote;RemoteWatcher.logActorForDeprecationWarning">logActorForDeprecationWarning</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.logActorForDeprecationWarning.watchee">watchee</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;actorFor is deprecated, and watching a remote ActorRef acquired with actorFor is not reliable: [{}]&quot;)" class="string">&quot;actorFor is deprecated, and watching a remote ActorRef acquired with actorFor is not reliable: [{}]&quot;</span>, <a href="#akka.remote;RemoteWatcher.logActorForDeprecationWarning.watchee" title="akka.actor.ActorRef">watchee</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(watchee: akka.actor.ActorRef, existenceConfirmed: Boolean, addressTerminated: Boolean)Unit" id="akka.remote;RemoteWatcher.terminated">terminated</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.terminated.watchee">watchee</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Boolean" id="akka.remote;RemoteWatcher.terminated.existenceConfirmed">existenceConfirmed</a>: <span title="Boolean">Boolean</span>, <a title="Boolean" id="akka.remote;RemoteWatcher.terminated.addressTerminated">addressTerminated</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Watchee terminated: [{}]&quot;)" class="string">&quot;Watchee terminated: [{}]&quot;</span>, <a href="#akka.remote;RemoteWatcher.terminated.watchee" title="akka.actor.ActorRef">watchee</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a><span class="delimiter">)</span>

    <span class="comment">// When watchee is stopped it sends DeathWatchNotification to the watcher and to this RemoteWatcher,</span>
    <span class="comment">// which is also watching. Send extra DeathWatchNotification to the watcher in case the</span>
    <span class="comment">// DeathWatchNotification message is only delivered to RemoteWatcher. Otherwise there is a risk that</span>
    <span class="comment">// the monitoring is removed, subsequent node failure is not detected and the original watcher is</span>
    <span class="comment">// never notified. This may occur for normal system shutdown of the watchee system when not all remote</span>
    <span class="comment">// messages are flushed at shutdown.</span>
    <a href="#akka.remote;RemoteWatcher.watching_=" title="(x$1: Set[(akka.actor.ActorRef, akka.actor.ActorRef)])Unit">watching</a> <span title="(xs: scala.collection.GenTraversableOnce[(akka.actor.ActorRef, akka.actor.ActorRef)])scala.collection.immutable.Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">--=</span> <a href="#akka.remote;RemoteWatcher.watching_=" title="=&gt; Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">watching</a> <span title="(pf: PartialFunction[(akka.actor.ActorRef, akka.actor.ActorRef),(akka.actor.ActorRef, akka.actor.ActorRef)])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set[(akka.actor.ActorRef, akka.actor.ActorRef)],(akka.actor.ActorRef, akka.actor.ActorRef),scala.collection.GenTraversableOnce[(akka.actor.ActorRef, akka.actor.ActorRef)]])scala.collection.GenTraversableOnce[(akka.actor.ActorRef, akka.actor.ActorRef)]">collect</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[(akka.actor.ActorRef, akka.actor.ActorRef),(akka.actor.ActorRef, akka.actor.ActorRef)] with Serializable" id="akka.remote;RemoteWatcher.terminated;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> <a title="(akka.actor.ActorRef, akka.actor.ActorRef)" id="akka.remote;RemoteWatcher.terminated;$anonfun.isDefinedAt.tuple">tuple</a> @ <span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.terminated;$anonfun.isDefinedAt.wee">wee</a>, <a title="akka.actor.InternalActorRef" id="akka.remote;RemoteWatcher.terminated;$anonfun.isDefinedAt.wer">wer</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;InternalActorRef" title="akka.actor.InternalActorRef">InternalActorRef</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#akka.remote;RemoteWatcher.terminated;$anonfun.isDefinedAt.wee" title="akka.actor.ActorRef">wee</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#akka.remote;RemoteWatcher.terminated.watchee" title="akka.actor.ActorRef">watchee</a> ⇒
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.remote;RemoteWatcher.terminated.addressTerminated" title="Boolean">addressTerminated</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.remote;RemoteWatcher.terminated;$anonfun.isDefinedAt.wer" title="akka.actor.InternalActorRef">wer</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
          <a href="#akka.remote;RemoteWatcher.terminated;$anonfun.isDefinedAt.wer" title="akka.actor.InternalActorRef">wer</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;InternalActorRef.sendSystemMessage" title="(message: akka.dispatch.sysmsg.SystemMessage)Unit">sendSystemMessage</a><span class="delimiter">(</span><a href="../../../actor/akka/dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;DeathWatchNotification" title="(actor: akka.actor.ActorRef, existenceConfirmed: Boolean, addressTerminated: Boolean)akka.dispatch.sysmsg.DeathWatchNotification">DeathWatchNotification</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.terminated.watchee" title="akka.actor.ActorRef">watchee</a>, <a href="#akka.remote;RemoteWatcher.terminated.existenceConfirmed" title="Boolean">existenceConfirmed</a>, <a href="#akka.remote;RemoteWatcher.terminated.addressTerminated" title="Boolean">addressTerminated</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.remote;RemoteWatcher.terminated;$anonfun.isDefinedAt.tuple" title="(akka.actor.ActorRef, akka.actor.ActorRef)">tuple</a>
    <span class="delimiter">}</span>

    <a href="#akka.remote;RemoteWatcher.checkLastUnwatchOfNode" title="(watcheeAddress: akka.actor.Address)Unit">checkLastUnwatchOfNode</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.terminated.watchee" title="akka.actor.ActorRef">watchee</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(watcheeAddress: akka.actor.Address)Unit" id="akka.remote;RemoteWatcher.checkLastUnwatchOfNode">checkLastUnwatchOfNode</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.remote;RemoteWatcher.checkLastUnwatchOfNode.watcheeAddress">watcheeAddress</a>: <a href="../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.watchingNodes_=" title="(elem: akka.actor.Address)Boolean">watchingNodes</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.checkLastUnwatchOfNode.watcheeAddress" title="akka.actor.Address">watcheeAddress</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.remote;RemoteWatcher.watching_=" title="=&gt; Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">watching</a>.<span title="(p: ((akka.actor.ActorRef, akka.actor.ActorRef)) =&gt; Boolean)Boolean">forall</span> <a href="#akka.remote;RemoteWatcher.checkLastUnwatchOfNode.$anonfun.x0$2" title="Boolean" class="delimiter">{</a>
      <span class="keyword">case</span> <span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.checkLastUnwatchOfNode.$anonfun.wee">wee</a>, <a title="akka.actor.ActorRef" id="akka.remote;RemoteWatcher.checkLastUnwatchOfNode.$anonfun.wer">wer</a><span class="delimiter">)</span> ⇒ <a href="#akka.remote;RemoteWatcher.checkLastUnwatchOfNode.$anonfun.wee" title="akka.actor.ActorRef">wee</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#akka.remote;RemoteWatcher.checkLastUnwatchOfNode.watcheeAddress" title="akka.actor.Address">watcheeAddress</a>
    <span class="delimiter">}</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// unwatched last watchee on that node</span>
      <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Unwatched last watchee of node: [{}]&quot;)" class="string">&quot;Unwatched last watchee of node: [{}]&quot;</span>, <a href="#akka.remote;RemoteWatcher.checkLastUnwatchOfNode.watcheeAddress" title="akka.actor.Address">watcheeAddress</a><span class="delimiter">)</span>
      <a href="#akka.remote;RemoteWatcher.watchingNodes_=" title="(x$1: Set[akka.actor.Address])Unit">watchingNodes</a> <span title="(elem: akka.actor.Address)scala.collection.immutable.Set[akka.actor.Address]">-=</span> <a href="#akka.remote;RemoteWatcher.checkLastUnwatchOfNode.watcheeAddress" title="akka.actor.Address">watcheeAddress</a>
      <a href="#akka.remote;RemoteWatcher.addressUids_=" title="(x$1: Map[akka.actor.Address,Int])Unit">addressUids</a> <span title="(key: akka.actor.Address)scala.collection.immutable.Map[akka.actor.Address,Int]">-=</span> <a href="#akka.remote;RemoteWatcher.checkLastUnwatchOfNode.watcheeAddress" title="akka.actor.Address">watcheeAddress</a>
      <a href="#akka.remote;RemoteWatcher.failureDetector" title="akka.remote.FailureDetectorRegistry[akka.actor.Address]">failureDetector</a>.<a href="FailureDetectorRegistry.scala.html#akka.remote;FailureDetectorRegistry.remove" title="(resource: akka.actor.Address)Unit">remove</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.checkLastUnwatchOfNode.watcheeAddress" title="akka.actor.Address">watcheeAddress</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.remote;RemoteWatcher.sendHeartbeat">sendHeartbeat</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.remote;RemoteWatcher.watchingNodes_=" title="=&gt; Set[akka.actor.Address]">watchingNodes</a> <span title="(f: akka.actor.Address =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="akka.actor.Address" id="akka.remote;RemoteWatcher.sendHeartbeat.$anonfun.a">a</a> ⇒
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.remote;RemoteWatcher.unreachable_=" title="(elem: akka.actor.Address)Boolean">unreachable</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.sendHeartbeat.$anonfun.a" title="akka.actor.Address">a</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.failureDetector" title="akka.remote.FailureDetectorRegistry[akka.actor.Address]">failureDetector</a>.<a href="FailureDetectorRegistry.scala.html#akka.remote;FailureDetectorRegistry.isMonitoring" title="(resource: akka.actor.Address)Boolean">isMonitoring</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.sendHeartbeat.$anonfun.a" title="akka.actor.Address">a</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Sending Heartbeat to [{}]&quot;)" class="string">&quot;Sending Heartbeat to [{}]&quot;</span>, <a href="#akka.remote;RemoteWatcher.sendHeartbeat.$anonfun.a" title="akka.actor.Address">a</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Sending first Heartbeat to [{}]&quot;)" class="string">&quot;Sending first Heartbeat to [{}]&quot;</span>, <a href="#akka.remote;RemoteWatcher.sendHeartbeat.$anonfun.a" title="akka.actor.Address">a</a><span class="delimiter">)</span>
          <span class="comment">// schedule the expected first heartbeat for later, which will give the</span>
          <span class="comment">// other side a chance to reply, and also trigger some resends if needed</span>
          <a href="#akka.remote;RemoteWatcher.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.scheduleOnce(a2d55b51db)" title="(delay: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">scheduleOnce</a><a href="../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="#akka.remote;RemoteWatcher.heartbeatExpectedResponseAfter" title="scala.concurrent.duration.FiniteDuration">heartbeatExpectedResponseAfter</a>, <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.remote.RemoteWatcher.ExpectedFirstHeartbeat.readResolve" title="(from: akka.actor.Address)akka.remote.RemoteWatcher.ExpectedFirstHeartbeat">ExpectedFirstHeartbeat</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.sendHeartbeat.$anonfun.a" title="akka.actor.Address">a</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorSelection(e44b8bc960)" title="(path: akka.actor.ActorPath)akka.actor.ActorSelection">actorSelection</a><a href="../../../actor/akka/actor/ActorSelection.scala.html#akka.actor.ActorSelection.toScala" title="implicit akka.actor.ActorSelection.toScala : (sel: akka.actor.ActorSelection)akka.actor.ScalaActorSelection" class="delimiter">(</a><a href="../../../actor/akka/actor/ActorPath.scala.html#akka.actor;RootActorPath" title="(address: akka.actor.Address, name: String)akka.actor.RootActorPath">RootActorPath</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.sendHeartbeat.$anonfun.a" title="akka.actor.Address">a</a><span class="delimiter">)</span> <a href="../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath./(214d397cb8)" title="(child: Iterable[String])akka.actor.ActorPath">/</a> <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.elements" title="=&gt; scala.collection.immutable.Iterable[String]">elements</a><span class="delimiter">)</span> <a href="../../../actor/akka/actor/ActorSelection.scala.html#akka.actor;ScalaActorSelection.!" title="(msg: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.remote.RemoteWatcher.Heartbeat.readResolve" title="akka.remote.RemoteWatcher.Heartbeat.type">Heartbeat</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(address: akka.actor.Address)Unit" id="akka.remote;RemoteWatcher.triggerFirstHeartbeat">triggerFirstHeartbeat</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.remote;RemoteWatcher.triggerFirstHeartbeat.address">address</a>: <a href="../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.watchingNodes_=" title="(elem: akka.actor.Address)Boolean">watchingNodes</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.triggerFirstHeartbeat.address" title="akka.actor.Address">address</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#akka.remote;RemoteWatcher.failureDetector" title="akka.remote.FailureDetectorRegistry[akka.actor.Address]">failureDetector</a>.<a href="FailureDetectorRegistry.scala.html#akka.remote;FailureDetectorRegistry.isMonitoring" title="(resource: akka.actor.Address)Boolean">isMonitoring</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.triggerFirstHeartbeat.address" title="akka.actor.Address">address</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Trigger extra expected heartbeat from [{}]&quot;)" class="string">&quot;Trigger extra expected heartbeat from [{}]&quot;</span>, <a href="#akka.remote;RemoteWatcher.triggerFirstHeartbeat.address" title="akka.actor.Address">address</a><span class="delimiter">)</span>
      <a href="#akka.remote;RemoteWatcher.failureDetector" title="akka.remote.FailureDetectorRegistry[akka.actor.Address]">failureDetector</a>.<a href="FailureDetectorRegistry.scala.html#akka.remote;FailureDetectorRegistry.heartbeat" title="(resource: akka.actor.Address)Unit">heartbeat</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.triggerFirstHeartbeat.address" title="akka.actor.Address">address</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="comment">/**
   * To ensure that we receive heartbeat messages from the right actor system
   * incarnation we send Watch again for the first HeartbeatRsp (containing
   * the system UID) and if HeartbeatRsp contains a new system UID.
   * Terminated will be triggered if the watchee (including correct Actor UID)
   * does not exist.
   */</span>
  <span class="keyword">def</span> <a title="(address: akka.actor.Address)Unit" id="akka.remote;RemoteWatcher.reWatch">reWatch</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.remote;RemoteWatcher.reWatch.address">address</a>: <a href="../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.remote;RemoteWatcher.watching_=" title="=&gt; Set[(akka.actor.ActorRef, akka.actor.ActorRef)]">watching</a>.<span title="(f: ((akka.actor.ActorRef, akka.actor.ActorRef)) =&gt; Unit)Unit">foreach</span> <a href="#akka.remote;RemoteWatcher.reWatch.$anonfun.x0$3" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span class="delimiter">(</span><a title="akka.actor.InternalActorRef" id="akka.remote;RemoteWatcher.reWatch.$anonfun.wee">wee</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;InternalActorRef" title="akka.actor.InternalActorRef">InternalActorRef</a>, <a title="akka.actor.InternalActorRef" id="akka.remote;RemoteWatcher.reWatch.$anonfun.wer">wer</a>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;InternalActorRef" title="akka.actor.InternalActorRef">InternalActorRef</a><span class="delimiter">)</span> ⇒
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.reWatch.$anonfun.wee" title="akka.actor.InternalActorRef">wee</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#akka.remote;RemoteWatcher.reWatch.address" title="akka.actor.Address">address</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="comment">// this re-watch will result in a RewatchRemote message to this actor</span>
          <span class="comment">// must be a special message to be able to detect if an UnwatchRemote comes in</span>
          <span class="comment">// before the extra RewatchRemote, then the re-watch should be ignored</span>
          <a href="../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Re-watch [{} -&gt; {}]&quot;)" class="string">&quot;Re-watch [{} -&gt; {}]&quot;</span>, <a href="#akka.remote;RemoteWatcher.reWatch.$anonfun.wer" title="akka.actor.InternalActorRef">wer</a>, <a href="#akka.remote;RemoteWatcher.reWatch.$anonfun.wee" title="akka.actor.InternalActorRef">wee</a><span class="delimiter">)</span>
          <a href="#akka.remote;RemoteWatcher.reWatch.$anonfun.wee" title="akka.actor.InternalActorRef">wee</a>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;InternalActorRef.sendSystemMessage" title="(message: akka.dispatch.sysmsg.SystemMessage)Unit">sendSystemMessage</a><span class="delimiter">(</span><span title="akka.remote.RemoteWatcher.Rewatch" class="keyword">new</span> <a href="#akka.remote.RemoteWatcher;Rewatch" title="akka.remote.RemoteWatcher.Rewatch">Rewatch</a><span class="delimiter">(</span><a href="#akka.remote;RemoteWatcher.reWatch.$anonfun.wee" title="akka.actor.InternalActorRef">wee</a>, <a href="#akka.remote;RemoteWatcher.reWatch.$anonfun.wer" title="akka.actor.InternalActorRef">wer</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="comment">// ➡➡➡ NEVER SEND THE SAME SYSTEM MESSAGE OBJECT TO TWO ACTORS ⬅⬅⬅</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

<span class="delimiter">}</span>
        </pre>
    </body>
</html>
