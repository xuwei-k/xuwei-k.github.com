<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>contrib/akka/contrib/mailbox/PeekMailbox.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
<span class="keyword">package</span> akka.contrib.mailbox

<span class="keyword">import</span> java.util.concurrent.<span class="delimiter">{</span> ConcurrentHashMap, ConcurrentLinkedQueue <span class="delimiter">}</span>

<span class="keyword">import</span> com.typesafe.config.Config

<span class="keyword">import</span> akka.actor.<span class="delimiter">{</span> ActorContext, ActorRef, ActorSystem, ExtendedActorSystem, Extension, ExtensionId, ExtensionIdProvider <span class="delimiter">}</span>
<span class="keyword">import</span> akka.dispatch.<span class="delimiter">{</span> Envelope, MailboxType, MessageQueue, UnboundedQueueBasedMessageQueue <span class="delimiter">}</span>

<span class="keyword">object</span> <a title="akka.contrib.mailbox.PeekMailboxExtension.type" id="akka.contrib.mailbox.PeekMailboxExtension">PeekMailboxExtension</a> <a href="#akka.contrib.mailbox.PeekMailboxExtension" title="akka.contrib.mailbox.PeekMailboxExtension.type" class="keyword">extends</a> <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId" title="akka.actor.ExtensionId[akka.contrib.mailbox.PeekMailboxExtension]">ExtensionId</a><span class="delimiter">[</span>PeekMailboxExtension<span class="delimiter">]</span> <span class="keyword">with</span> <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionIdProvider" title="akka.actor.ExtensionIdProvider">ExtensionIdProvider</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="()akka.contrib.mailbox.PeekMailboxExtension.type" id="akka.contrib.mailbox.PeekMailboxExtension.lookup">lookup</a> = <span class="keyword">this</span>
  <span class="keyword">def</span> <a title="(s: akka.actor.ExtendedActorSystem)akka.contrib.mailbox.PeekMailboxExtension" id="akka.contrib.mailbox.PeekMailboxExtension.createExtension">createExtension</a><span class="delimiter">(</span><a title="akka.actor.ExtendedActorSystem" id="akka.contrib.mailbox.PeekMailboxExtension.createExtension.s">s</a>: <a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ExtendedActorSystem" title="akka.actor.ExtendedActorSystem">ExtendedActorSystem</a><span class="delimiter">)</span> = <span title="akka.contrib.mailbox.PeekMailboxExtension" class="keyword">new</span> <a href="#akka.contrib.mailbox;PeekMailboxExtension" title="akka.contrib.mailbox.PeekMailboxExtension">PeekMailboxExtension</a><span class="delimiter">(</span><a href="#akka.contrib.mailbox.PeekMailboxExtension.createExtension.s" title="akka.actor.ExtendedActorSystem">s</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()(implicit context: akka.actor.ActorContext)Unit" id="akka.contrib.mailbox.PeekMailboxExtension.ack">ack</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="akka.actor.ActorContext" id="akka.contrib.mailbox.PeekMailboxExtension.ack.context">context</a>: <a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext" title="akka.actor.ActorContext">ActorContext</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.contrib.mailbox.PeekMailboxExtension">PeekMailboxExtension</a><span class="delimiter">(</span><a href="#akka.contrib.mailbox.PeekMailboxExtension.ack.context" title="akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>.<a href="#akka.contrib.mailbox;PeekMailboxExtension.ack" title="()(implicit context: akka.actor.ActorContext)Unit">ack</a><a href="#akka.contrib.mailbox.PeekMailboxExtension.ack.context" title="akka.actor.ActorContext" class="delimiter">(</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class PeekMailboxExtension extends AnyRef with akka.actor.Extension" id="akka.contrib.mailbox;PeekMailboxExtension">PeekMailboxExtension</a><a href="#akka.contrib.mailbox;PeekMailboxExtension" title="akka.contrib.mailbox.PeekMailboxExtension" class="delimiter">(</a><span class="keyword">val</span> <a title="akka.actor.ExtendedActorSystem" id="akka.contrib.mailbox;PeekMailboxExtension.system">system</a>: <a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ExtendedActorSystem" title="akka.actor.ExtendedActorSystem">ExtendedActorSystem</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;Extension" title="akka.actor.Extension">Extension</a> <span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[akka.actor.ActorRef,akka.contrib.mailbox.PeekMailbox]" id="akka.contrib.mailbox;PeekMailboxExtension.mailboxes">mailboxes</a> = <span title="java.util.concurrent.ConcurrentHashMap[akka.actor.ActorRef,akka.contrib.mailbox.PeekMailbox]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[akka.actor.ActorRef,akka.contrib.mailbox.PeekMailbox]">ConcurrentHashMap</span><span class="delimiter">[</span>ActorRef, PeekMailbox<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="(actorRef: akka.actor.ActorRef, mailbox: akka.contrib.mailbox.PeekMailbox)Unit" id="akka.contrib.mailbox;PeekMailboxExtension.register">register</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.mailbox;PeekMailboxExtension.register.actorRef">actorRef</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.contrib.mailbox.PeekMailbox" id="akka.contrib.mailbox;PeekMailboxExtension.register.mailbox">mailbox</a>: <a href="#akka.contrib.mailbox;PeekMailbox" title="akka.contrib.mailbox.PeekMailbox">PeekMailbox</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.contrib.mailbox;PeekMailboxExtension.mailboxes" title="=&gt; java.util.concurrent.ConcurrentHashMap[akka.actor.ActorRef,akka.contrib.mailbox.PeekMailbox]">mailboxes</a>.<span title="(x$1: akka.actor.ActorRef, x$2: akka.contrib.mailbox.PeekMailbox)akka.contrib.mailbox.PeekMailbox">put</span><span title="Unit" class="delimiter">(</span><a href="#akka.contrib.mailbox;PeekMailboxExtension.register.actorRef" title="akka.actor.ActorRef">actorRef</a>, <a href="#akka.contrib.mailbox;PeekMailboxExtension.register.mailbox" title="akka.contrib.mailbox.PeekMailbox">mailbox</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(actorRef: akka.actor.ActorRef)Unit" id="akka.contrib.mailbox;PeekMailboxExtension.unregister">unregister</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.mailbox;PeekMailboxExtension.unregister.actorRef">actorRef</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.contrib.mailbox;PeekMailboxExtension.mailboxes" title="=&gt; java.util.concurrent.ConcurrentHashMap[akka.actor.ActorRef,akka.contrib.mailbox.PeekMailbox]">mailboxes</a>.<span title="(x$1: Any)akka.contrib.mailbox.PeekMailbox">remove</span><span title="Unit" class="delimiter">(</span><a href="#akka.contrib.mailbox;PeekMailboxExtension.unregister.actorRef" title="akka.actor.ActorRef">actorRef</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()(implicit context: akka.actor.ActorContext)Unit" id="akka.contrib.mailbox;PeekMailboxExtension.ack">ack</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="akka.actor.ActorContext" id="akka.contrib.mailbox;PeekMailboxExtension.ack.context">context</a>: <a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext" title="akka.actor.ActorContext">ActorContext</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.contrib.mailbox;PeekMailboxExtension.mailboxes" title="=&gt; java.util.concurrent.ConcurrentHashMap[akka.actor.ActorRef,akka.contrib.mailbox.PeekMailbox]">mailboxes</a>.<span title="(x$1: Any)akka.contrib.mailbox.PeekMailbox">get</span><span class="delimiter">(</span><a href="#akka.contrib.mailbox;PeekMailboxExtension.ack.context" title="akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span>    ⇒ <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)IllegalArgumentException" class="keyword">new</span> <span title="IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="String(&quot;Mailbox not registered for: &quot;)" class="string">&quot;Mailbox not registered for: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#akka.contrib.mailbox;PeekMailboxExtension.ack.context" title="akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="akka.contrib.mailbox.PeekMailbox" id="akka.contrib.mailbox;PeekMailboxExtension.ack.mailbox">mailbox</a> ⇒ <a href="#akka.contrib.mailbox;PeekMailboxExtension.ack.mailbox" title="akka.contrib.mailbox.PeekMailbox">mailbox</a>.<a href="#akka.contrib.mailbox;PeekMailbox.ack" title="()Unit">ack</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * configure the mailbox via dispatcher configuration:
 * {{{
 *   peek-dispatcher {
 *      mailbox-type = &quot;example.PeekMailboxType&quot;
 *   }
 * }}}
 */</span>
<span class="keyword">class</span> <a title="class PeekMailboxType extends AnyRef with akka.dispatch.MailboxType" id="akka.contrib.mailbox;PeekMailboxType">PeekMailboxType</a><a href="#akka.contrib.mailbox;PeekMailboxType" title="akka.contrib.mailbox.PeekMailboxType" class="delimiter">(</a><a title="akka.actor.ActorSystem.Settings" id="akka.contrib.mailbox;PeekMailboxType.settings">settings</a>: ActorSystem.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor.ActorSystem;Settings" title="akka.actor.ActorSystem.Settings">Settings</a>, <a title="com.typesafe.config.Config" id="akka.contrib.mailbox;PeekMailboxType.config">config</a>: <span title="com.typesafe.config.Config">Config</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../actor/akka/dispatch/Mailbox.scala.html#akka.dispatch;MailboxType" title="akka.dispatch.MailboxType">MailboxType</a> <span class="delimiter">{</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(owner: Option[akka.actor.ActorRef], system: Option[akka.actor.ActorSystem])akka.dispatch.MessageQueue" id="akka.contrib.mailbox;PeekMailboxType.create">create</a><span class="delimiter">(</span><a title="Option[akka.actor.ActorRef]" id="akka.contrib.mailbox;PeekMailboxType.create.owner">owner</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span>, <a title="Option[akka.actor.ActorSystem]" id="akka.contrib.mailbox;PeekMailboxType.create.system">system</a>: <span title="Option[akka.actor.ActorSystem]">Option</span><span class="delimiter">[</span>ActorSystem<span class="delimiter">]</span><span class="delimiter">)</span> = <span title="(_1: Option[akka.actor.ActorRef], _2: Option[akka.actor.ActorSystem])(Option[akka.actor.ActorRef], Option[akka.actor.ActorSystem])" class="delimiter">(</span><a href="#akka.contrib.mailbox;PeekMailboxType.create.owner" title="Option[akka.actor.ActorRef]">owner</a>, <a href="#akka.contrib.mailbox;PeekMailboxType.create.system" title="Option[akka.actor.ActorSystem]">system</a><span class="delimiter">)</span> <span title="akka.dispatch.MessageQueue" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span class="delimiter">(</span>Some<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.mailbox;PeekMailboxType.create.o">o</a><span class="delimiter">)</span>, Some<span class="delimiter">(</span><a title="akka.actor.ActorSystem" id="akka.contrib.mailbox;PeekMailboxType.create.s">s</a><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <span class="keyword">val</span> <a title="Int" id="akka.contrib.mailbox;PeekMailboxType.create.retries">retries</a> = <a href="#akka.contrib.mailbox;PeekMailboxType.config" title="com.typesafe.config.Config">config</a>.<span title="(x$1: String)Int">getInt</span><span class="delimiter">(</span><span title="String(&quot;max-retries&quot;)" class="string">&quot;max-retries&quot;</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.mailbox;PeekMailboxType.create.retries" title="Int">retries</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <a href="../../../../actor/akka/AkkaException.scala.html#akka;ConfigurationException.<init>(3b0f220dea)" title="(msg: String)akka.ConfigurationException" class="keyword">new</a> akka.<a href="../../../../actor/akka/AkkaException.scala.html#akka;ConfigurationException" title="akka.ConfigurationException">ConfigurationException</a><span class="delimiter">(</span><span title="String(&quot;max-retries must be at least 1&quot;)" class="string">&quot;max-retries must be at least 1&quot;</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="akka.contrib.mailbox.PeekMailbox" id="akka.contrib.mailbox;PeekMailboxType.create.mailbox">mailbox</a> = <span title="akka.contrib.mailbox.PeekMailbox" class="keyword">new</span> <a href="#akka.contrib.mailbox;PeekMailbox" title="akka.contrib.mailbox.PeekMailbox">PeekMailbox</a><span class="delimiter">(</span><a href="#akka.contrib.mailbox;PeekMailboxType.create.o" title="akka.actor.ActorRef">o</a>, <a href="#akka.contrib.mailbox;PeekMailboxType.create.s" title="akka.actor.ActorSystem">s</a>, <a href="#akka.contrib.mailbox;PeekMailboxType.create.retries" title="Int">retries</a><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.contrib.mailbox.PeekMailboxExtension">PeekMailboxExtension</a><span class="delimiter">(</span><a href="#akka.contrib.mailbox;PeekMailboxType.create.s" title="akka.actor.ActorSystem">s</a><span class="delimiter">)</span>.<a href="#akka.contrib.mailbox;PeekMailboxExtension.register" title="(actorRef: akka.actor.ActorRef, mailbox: akka.contrib.mailbox.PeekMailbox)Unit">register</a><span class="delimiter">(</span><a href="#akka.contrib.mailbox;PeekMailboxType.create.o" title="akka.actor.ActorRef">o</a>, <a href="#akka.contrib.mailbox;PeekMailboxType.create.mailbox" title="akka.contrib.mailbox.PeekMailbox">mailbox</a><span class="delimiter">)</span>
      <a href="#akka.contrib.mailbox;PeekMailboxType.create.mailbox" title="akka.contrib.mailbox.PeekMailbox">mailbox</a>
    <span class="keyword">case</span> _ ⇒ <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)Exception" class="keyword">new</span> <span title="Exception">Exception</span><span class="delimiter">(</span><span title="String(&quot;no mailbox owner or system given&quot;)" class="string">&quot;no mailbox owner or system given&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class PeekMailbox extends AnyRef with akka.dispatch.UnboundedQueueBasedMessageQueue" id="akka.contrib.mailbox;PeekMailbox">PeekMailbox</a><a href="#akka.contrib.mailbox;PeekMailbox" title="akka.contrib.mailbox.PeekMailbox" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.contrib.mailbox;PeekMailbox.owner">owner</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.actor.ActorSystem" id="akka.contrib.mailbox;PeekMailbox.system">system</a>: <a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem" title="akka.actor.ActorSystem">ActorSystem</a>, <a title="Int" id="akka.contrib.mailbox;PeekMailbox.maxRetries">maxRetries</a>: <span title="Int">Int</span><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="../../../../actor/akka/dispatch/Mailbox.scala.html#akka.dispatch;UnboundedQueueBasedMessageQueue" title="akka.dispatch.UnboundedQueueBasedMessageQueue">UnboundedQueueBasedMessageQueue</a> <span class="delimiter">{</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentLinkedQueue[akka.dispatch.Envelope]" id="akka.contrib.mailbox;PeekMailbox.queue">queue</a> = <span title="java.util.concurrent.ConcurrentLinkedQueue[akka.dispatch.Envelope]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentLinkedQueue[akka.dispatch.Envelope]">ConcurrentLinkedQueue</span><span class="delimiter">[</span>Envelope<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/*
   * Since the queue itself is used to determine when to schedule the actor
   * (see Mailbox.hasMessages), we cannot poll() on the first try and then
   * continue handing back out that same message until ACKed, peek() must be
   * used. The retry limit logic is then formulated in terms of the `tries`
   * field, which holds
   *  0             if clean slate (i.e. last dequeue was ack()ed)
   *  1..maxRetries if not yet ack()ed
   *  Marker        if last try was done (at which point we had to poll())
   *  -1            during cleanUp (in order to disable the ack() requirement)
   */</span>
  <span class="comment">// the mutable state is only ever accessed by the actor (i.e. dequeue() side)</span>
  <span class="keyword">var</span> <a title="Int" id="akka.contrib.mailbox;PeekMailbox.tries_=">tries</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">val</span> <a title="Int" id="akka.contrib.mailbox;PeekMailbox.Marker">Marker</a> = <a href="#akka.contrib.mailbox;PeekMailbox.maxRetries" title="Int">maxRetries</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>

  <span class="comment">// this logic does not work if maxRetries==0, but then you could also use a normal mailbox</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()akka.dispatch.Envelope" id="akka.contrib.mailbox;PeekMailbox.dequeue">dequeue</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/dispatch/AbstractDispatcher.scala.html#akka.dispatch;Envelope" title="akka.dispatch.Envelope">Envelope</a> = <a href="#akka.contrib.mailbox;PeekMailbox.tries_=" title="=&gt; Int">tries</a> <span title="akka.dispatch.Envelope" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Int(-1)">-</span><span class="int">1</span> ⇒
      <a href="#akka.contrib.mailbox;PeekMailbox.queue" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[akka.dispatch.Envelope]">queue</a>.<span title="()akka.dispatch.Envelope">poll</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="Int(0)" class="int">0</span> | <a href="#akka.contrib.mailbox;PeekMailbox.Marker" title="=&gt; Int">Marker</a> ⇒
      <span class="keyword">val</span> <a title="akka.dispatch.Envelope" id="akka.contrib.mailbox;PeekMailbox.dequeue.e">e</a> = <a href="#akka.contrib.mailbox;PeekMailbox.queue" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[akka.dispatch.Envelope]">queue</a>.<span title="()akka.dispatch.Envelope">peek</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#akka.contrib.mailbox;PeekMailbox.tries_=" title="(x$1: Int)Unit">tries</a> = <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.mailbox;PeekMailbox.dequeue.e" title="akka.dispatch.Envelope">e</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="Int(0)" class="int">0</span> <span class="keyword">else</span> <span title="Int(1)" class="int">1</span>
      <a href="#akka.contrib.mailbox;PeekMailbox.dequeue.e" title="akka.dispatch.Envelope">e</a>
    <span class="keyword">case</span> <a href="#akka.contrib.mailbox;PeekMailbox.maxRetries" title="Int">`maxRetries`</a> ⇒
      <a href="#akka.contrib.mailbox;PeekMailbox.tries_=" title="(x$1: Int)Unit">tries</a> = <a href="#akka.contrib.mailbox;PeekMailbox.Marker" title="=&gt; Int">Marker</a>
      <a href="#akka.contrib.mailbox;PeekMailbox.queue" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[akka.dispatch.Envelope]">queue</a>.<span title="()akka.dispatch.Envelope">poll</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="Int" id="akka.contrib.mailbox;PeekMailbox.dequeue.n">n</a> ⇒
      <a href="#akka.contrib.mailbox;PeekMailbox.tries_=" title="(x$1: Int)Unit">tries</a> = <a href="#akka.contrib.mailbox;PeekMailbox.dequeue.n" title="Int">n</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>
      <a href="#akka.contrib.mailbox;PeekMailbox.queue" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[akka.dispatch.Envelope]">queue</a>.<span title="()akka.dispatch.Envelope">peek</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.mailbox;PeekMailbox.ack">ack</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="comment">// do not dequeue for real if double-ack() or ack() on last try</span>
    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.mailbox;PeekMailbox.tries_=" title="=&gt; Int">tries</a> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.contrib.mailbox;PeekMailbox.tries_=" title="=&gt; Int">tries</a> <span title="(x: Int)Boolean">!=</span> <a href="#akka.contrib.mailbox;PeekMailbox.Marker" title="=&gt; Int">Marker</a><span class="delimiter">)</span> <a href="#akka.contrib.mailbox;PeekMailbox.queue" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[akka.dispatch.Envelope]">queue</a>.<span title="()akka.dispatch.Envelope">poll</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.contrib.mailbox;PeekMailbox.tries_=" title="(x$1: Int)Unit">tries</a> = <span title="Int(0)" class="int">0</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(owner: akka.actor.ActorRef, deadLetters: akka.dispatch.MessageQueue)Unit" id="akka.contrib.mailbox;PeekMailbox.cleanUp">cleanUp</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.mailbox;PeekMailbox.cleanUp.owner">owner</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.dispatch.MessageQueue" id="akka.contrib.mailbox;PeekMailbox.cleanUp.deadLetters">deadLetters</a>: <a href="../../../../actor/akka/dispatch/Mailbox.scala.html#akka.dispatch;MessageQueue" title="akka.dispatch.MessageQueue">MessageQueue</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.contrib.mailbox;PeekMailbox.tries_=" title="(x$1: Int)Unit">tries</a> = -<span title="Int(-1)" class="int">1</span> <span class="comment">// put the queue into auto-ack mode</span>
    <a href="#akka.contrib.mailbox;PeekMailbox" title="akka.contrib.mailbox.PeekMailbox" class="keyword">super</a>.<a href="../../../../actor/akka/dispatch/Mailbox.scala.html#akka.dispatch;QueueBasedMessageQueue.cleanUp" title="(owner: akka.actor.ActorRef, deadLetters: akka.dispatch.MessageQueue)Unit">cleanUp</a><span class="delimiter">(</span><a href="#akka.contrib.mailbox;PeekMailbox.cleanUp.owner" title="akka.actor.ActorRef">owner</a>, <a href="#akka.contrib.mailbox;PeekMailbox.cleanUp.deadLetters" title="akka.dispatch.MessageQueue">deadLetters</a><span class="delimiter">)</span>
    <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.contrib.mailbox.PeekMailboxExtension">PeekMailboxExtension</a><span class="delimiter">(</span><a href="#akka.contrib.mailbox;PeekMailbox.system" title="akka.actor.ActorSystem">system</a><span class="delimiter">)</span>.<a href="#akka.contrib.mailbox;PeekMailboxExtension.unregister" title="(actorRef: akka.actor.ActorRef)Unit">unregister</a><span class="delimiter">(</span><a href="#akka.contrib.mailbox;PeekMailbox.cleanUp.owner" title="akka.actor.ActorRef">owner</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
