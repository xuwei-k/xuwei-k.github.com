<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>contrib/akka/contrib/pattern/ClusterSingletonManager.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2014 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

<span class="keyword">package</span> akka.contrib.pattern

<span class="keyword">import</span> scala.concurrent.duration._
<span class="keyword">import</span> scala.collection.immutable
<span class="keyword">import</span> akka.actor.Actor
<span class="keyword">import</span> akka.actor.<a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.Actor" title="akka.actor.Actor.type">Actor</a>.Receive
<span class="keyword">import</span> akka.actor.Deploy
<span class="keyword">import</span> akka.actor.ActorLogging
<span class="keyword">import</span> akka.actor.ActorRef
<span class="keyword">import</span> akka.actor.ActorSelection
<span class="keyword">import</span> akka.actor.Address
<span class="keyword">import</span> akka.actor.FSM
<span class="keyword">import</span> akka.actor.Props
<span class="keyword">import</span> akka.actor.Terminated
<span class="keyword">import</span> akka.cluster.Cluster
<span class="keyword">import</span> akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>._
<span class="keyword">import</span> akka.cluster.Member
<span class="keyword">import</span> akka.cluster.MemberStatus
<span class="keyword">import</span> akka.AkkaException

<span class="keyword">object</span> <a title="akka.contrib.pattern.ClusterSingletonManager.type" id="akka.contrib.pattern.ClusterSingletonManager">ClusterSingletonManager</a> <a href="#akka.contrib.pattern.ClusterSingletonManager" title="akka.contrib.pattern.ClusterSingletonManager.type" class="delimiter">{</a>

  <span class="comment">/**
   * Scala API: Factory method for `ClusterSingletonManager` [[akka.actor.Props]].
   */</span>
  <span class="keyword">def</span> <a title="(singletonProps: akka.actor.Props, singletonName: String, terminationMessage: Any, role: Option[String], maxHandOverRetries: Int, maxTakeOverRetries: Int, retryInterval: scala.concurrent.duration.FiniteDuration)akka.actor.Props" id="akka.contrib.pattern.ClusterSingletonManager.props(2e1cc011fd)">props</a><span class="delimiter">(</span>
    <a title="akka.actor.Props" id="akka.contrib.pattern.ClusterSingletonManager.props(2e1cc011fd).singletonProps">singletonProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a>,
    <a title="String" id="akka.contrib.pattern.ClusterSingletonManager.props(2e1cc011fd).singletonName">singletonName</a>: <span title="String">String</span>,
    <a title="Any" id="akka.contrib.pattern.ClusterSingletonManager.props(2e1cc011fd).terminationMessage">terminationMessage</a>: <span title="Any">Any</span>,
    <a title="Option[String]" id="akka.contrib.pattern.ClusterSingletonManager.props(2e1cc011fd).role">role</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>,
    <a title="Int" id="akka.contrib.pattern.ClusterSingletonManager.props$default$5">maxHandOverRetries</a>: <span title="Int">Int</span> = <span title="Int(10)" class="int">10</span>,
    <a title="Int" id="akka.contrib.pattern.ClusterSingletonManager.props$default$6">maxTakeOverRetries</a>: <span title="Int">Int</span> = <span title="Int(5)" class="int">5</span>,
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern.ClusterSingletonManager.props$default$7">retryInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span> = <span title="implicit scala.concurrent.duration.package.DurationInt : (n: Int)concurrent.duration.DurationInt" class="int">1</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">second</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.contrib.pattern.ClusterSingletonManager](classOf[akka.contrib.pattern.ClusterSingletonManager])" class="delimiter">[</span>ClusterSingletonManager<span class="delimiter">]</span>, <a href="#akka.contrib.pattern.ClusterSingletonManager.props(2e1cc011fd).singletonProps" title="akka.actor.Props">singletonProps</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.props(2e1cc011fd).singletonName" title="String">singletonName</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.props(2e1cc011fd).terminationMessage" title="Any">terminationMessage</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.props(2e1cc011fd).role" title="Option[String]">role</a>,
      <a href="#akka.contrib.pattern.ClusterSingletonManager.props$default$5" title="Int">maxHandOverRetries</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.props$default$6" title="Int">maxTakeOverRetries</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.props$default$7" title="scala.concurrent.duration.FiniteDuration">retryInterval</a><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.withDeploy" title="(d: akka.actor.Deploy)akka.actor.Props">withDeploy</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy" title="akka.actor.Deploy.type">Deploy</a>.<a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy.local" title="=&gt; akka.actor.Deploy">local</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API: Factory method for `ClusterSingletonManager` [[akka.actor.Props]].
   */</span>
  <span class="keyword">def</span> <a title="(singletonProps: akka.actor.Props, singletonName: String, terminationMessage: Any, role: String, maxHandOverRetries: Int, maxTakeOverRetries: Int, retryInterval: scala.concurrent.duration.FiniteDuration)akka.actor.Props" id="akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b)">props</a><span class="delimiter">(</span>
    <a title="akka.actor.Props" id="akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b).singletonProps">singletonProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a>,
    <a title="String" id="akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b).singletonName">singletonName</a>: <span title="String">String</span>,
    <a title="Any" id="akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b).terminationMessage">terminationMessage</a>: <span title="Any">Any</span>,
    <a title="String" id="akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b).role">role</a>: <span title="String">String</span>,
    <a title="Int" id="akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b).maxHandOverRetries">maxHandOverRetries</a>: <span title="Int">Int</span>,
    <a title="Int" id="akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b).maxTakeOverRetries">maxTakeOverRetries</a>: <span title="Int">Int</span>,
    <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b).retryInterval">retryInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="#akka.contrib.pattern.ClusterSingletonManager.props(2e1cc011fd)" title="(singletonProps: akka.actor.Props, singletonName: String, terminationMessage: Any, role: Option[String], maxHandOverRetries: Int, maxTakeOverRetries: Int, retryInterval: scala.concurrent.duration.FiniteDuration)akka.actor.Props">props</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b).singletonProps" title="akka.actor.Props">singletonProps</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b).singletonName" title="String">singletonName</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b).terminationMessage" title="Any">terminationMessage</a>,
      <a href="#akka.contrib.pattern.ClusterSingletonManager" title="akka.contrib.pattern.ClusterSingletonManager.type">ClusterSingletonManager</a>.<a href="#akka.contrib.pattern.ClusterSingletonManager.Internal" title="akka.contrib.pattern.ClusterSingletonManager.Internal.type">Internal</a>.<a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.roleOption" title="(role: String)Option[String]">roleOption</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b).role" title="String">role</a><span class="delimiter">)</span>, <a href="#akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b).maxHandOverRetries" title="Int">maxHandOverRetries</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b).maxTakeOverRetries" title="Int">maxTakeOverRetries</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.props(3a14da918b).retryInterval" title="scala.concurrent.duration.FiniteDuration">retryInterval</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API: Factory method for `ClusterSingletonManager` [[akka.actor.Props]]
   * with default values.
   */</span>
  <span class="keyword">def</span> <a title="(singletonProps: akka.actor.Props, singletonName: String, terminationMessage: Any, role: String)akka.actor.Props" id="akka.contrib.pattern.ClusterSingletonManager.defaultProps">defaultProps</a><span class="delimiter">(</span>
    <a title="akka.actor.Props" id="akka.contrib.pattern.ClusterSingletonManager.defaultProps.singletonProps">singletonProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a>,
    <a title="String" id="akka.contrib.pattern.ClusterSingletonManager.defaultProps.singletonName">singletonName</a>: <span title="String">String</span>,
    <a title="Any" id="akka.contrib.pattern.ClusterSingletonManager.defaultProps.terminationMessage">terminationMessage</a>: <span title="Any">Any</span>,
    <a title="String" id="akka.contrib.pattern.ClusterSingletonManager.defaultProps.role">role</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="#akka.contrib.pattern.ClusterSingletonManager.props(2e1cc011fd)" title="(singletonProps: akka.actor.Props, singletonName: String, terminationMessage: Any, role: Option[String], maxHandOverRetries: Int, maxTakeOverRetries: Int, retryInterval: scala.concurrent.duration.FiniteDuration)akka.actor.Props">props</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.defaultProps.singletonProps" title="akka.actor.Props">singletonProps</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.defaultProps.singletonName" title="String">singletonName</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.defaultProps.terminationMessage" title="Any">terminationMessage</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager" title="akka.contrib.pattern.ClusterSingletonManager.type">ClusterSingletonManager</a>.<a href="#akka.contrib.pattern.ClusterSingletonManager.Internal" title="akka.contrib.pattern.ClusterSingletonManager.Internal.type">Internal</a>.<a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.roleOption" title="(role: String)Option[String]">roleOption</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.defaultProps.role" title="String">role</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * INTERNAL API
   * public due to the `with FSM` type parameters
   */</span>
  <span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait State extends AnyRef" id="akka.contrib.pattern.ClusterSingletonManager;State">State</a>
  <span class="comment">/**
   * INTERNAL API
   * public due to the `with FSM` type parameters
   */</span>
  <span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait Data extends AnyRef" id="akka.contrib.pattern.ClusterSingletonManager;Data">Data</a>

  <span class="comment">/**
   * INTERNAL API
   */</span>
  <span class="keyword">private</span> <span class="keyword">object</span> <a title="akka.contrib.pattern.ClusterSingletonManager.Internal.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal">Internal</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal" title="akka.contrib.pattern.ClusterSingletonManager.Internal.type" class="delimiter">{</a>
    <span class="comment">/**
     * Sent from new oldest to previous oldest to initate the
     * hand-over process. `HandOverInProgress` and `HandOverDone`
     * are expected replies.
     */</span>
    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.readResolve">HandOverToMe</a>
    <span class="comment">/**
     * Confirmation by the previous oldest that the hand
     * over process, shut down of the singleton actor, has
     * started.
     */</span>
    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverInProgress.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverInProgress.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverInProgress.readResolve">HandOverInProgress</a>
    <span class="comment">/**
     * Confirmation by the previous oldest that the singleton
     * actor has been terminated and the hand-over process is
     * completed.
     */</span>
    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverDone.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverDone.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverDone.readResolve">HandOverDone</a>
    <span class="comment">/**
     * Sent from from previous oldest to new oldest to
     * initiate the normal hand-over process.
     * Especially useful when new node joins and becomes
     * oldest immediately, without knowing who was previous
     * oldest.
     */</span>
    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverFromMe.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverFromMe.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverFromMe.readResolve">TakeOverFromMe</a>

    <span class="keyword">case class</span> <a title="class HandOverRetry extends AnyRef with Product with Serializable" id="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverRetry.readResolve">HandOverRetry</a><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverRetry.readResolve" title="Product" class="delimiter">(</a><a title="Int" id="akka.contrib.pattern.ClusterSingletonManager.Internal;HandOverRetry.count">count</a>: <span title="Int">Int</span><span class="delimiter">)</span>
    <span class="keyword">case class</span> <a title="class TakeOverRetry extends AnyRef with Product with Serializable" id="akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverRetry.readResolve">TakeOverRetry</a><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverRetry.readResolve" title="Product" class="delimiter">(</a><a title="Int" id="akka.contrib.pattern.ClusterSingletonManager.Internal;TakeOverRetry.count">count</a>: <span title="Int">Int</span><span class="delimiter">)</span>
    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Cleanup.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Cleanup.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.Cleanup.readResolve">Cleanup</a>
    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.StartOldestChangedBuffer.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.StartOldestChangedBuffer.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.StartOldestChangedBuffer.readResolve">StartOldestChangedBuffer</a>

    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Start.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Start.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.Start.readResolve">Start</a> <span title="Product" class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;State" title="akka.contrib.pattern.ClusterSingletonManager.State">State</a>
    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Oldest.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Oldest.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.Oldest.readResolve">Oldest</a> <span title="Product" class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;State" title="akka.contrib.pattern.ClusterSingletonManager.State">State</a>
    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Younger.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Younger.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.Younger.readResolve">Younger</a> <span title="Product" class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;State" title="akka.contrib.pattern.ClusterSingletonManager.State">State</a>
    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldest.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldest.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldest.readResolve">BecomingOldest</a> <span title="Product" class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;State" title="akka.contrib.pattern.ClusterSingletonManager.State">State</a>
    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldest.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldest.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldest.readResolve">WasOldest</a> <span title="Product" class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;State" title="akka.contrib.pattern.ClusterSingletonManager.State">State</a>
    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandingOver.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandingOver.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.HandingOver.readResolve">HandingOver</a> <span title="Product" class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;State" title="akka.contrib.pattern.ClusterSingletonManager.State">State</a>
    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOver.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOver.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOver.readResolve">TakeOver</a> <span title="Product" class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;State" title="akka.contrib.pattern.ClusterSingletonManager.State">State</a>
    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.End.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.End.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.End.readResolve">End</a> <span title="Product" class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;State" title="akka.contrib.pattern.ClusterSingletonManager.State">State</a>

    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Uninitialized.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Uninitialized.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.Uninitialized.readResolve">Uninitialized</a> <span title="Product" class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;Data" title="akka.contrib.pattern.ClusterSingletonManager.Data">Data</a>
    <span class="keyword">case class</span> <a title="class YoungerData extends AnyRef with akka.contrib.pattern.ClusterSingletonManager.Data with Product with Serializable" id="akka.contrib.pattern.ClusterSingletonManager.Internal.YoungerData.readResolve">YoungerData</a><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.YoungerData.readResolve" title="Product" class="delimiter">(</a><a title="Option[akka.actor.Address]" id="akka.contrib.pattern.ClusterSingletonManager.Internal;YoungerData.oldestOption">oldestOption</a>: <span title="Option[akka.actor.Address]">Option</span><span class="delimiter">[</span>Address<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;Data" title="akka.contrib.pattern.ClusterSingletonManager.Data">Data</a>
    <span class="keyword">case class</span> <a title="class BecomingOldestData extends AnyRef with akka.contrib.pattern.ClusterSingletonManager.Data with Product with Serializable" id="akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldestData.readResolve">BecomingOldestData</a><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldestData.readResolve" title="Product" class="delimiter">(</a><a title="Option[akka.actor.Address]" id="akka.contrib.pattern.ClusterSingletonManager.Internal;BecomingOldestData.previousOldestOption">previousOldestOption</a>: <span title="Option[akka.actor.Address]">Option</span><span class="delimiter">[</span>Address<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;Data" title="akka.contrib.pattern.ClusterSingletonManager.Data">Data</a>
    <span class="keyword">case class</span> <a title="class OldestData extends AnyRef with akka.contrib.pattern.ClusterSingletonManager.Data with Product with Serializable" id="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestData.readResolve">OldestData</a><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.OldestData.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestData.singleton">singleton</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Boolean" id="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestData.apply$default$2">singletonTerminated</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;Data" title="akka.contrib.pattern.ClusterSingletonManager.Data">Data</a>
    <span class="keyword">case class</span> <a title="class WasOldestData extends AnyRef with akka.contrib.pattern.ClusterSingletonManager.Data with Product with Serializable" id="akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldestData.readResolve">WasOldestData</a><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldestData.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ClusterSingletonManager.Internal;WasOldestData.singleton">singleton</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Boolean" id="akka.contrib.pattern.ClusterSingletonManager.Internal;WasOldestData.singletonTerminated">singletonTerminated</a>: <span title="Boolean">Boolean</span>,
                             <a title="Option[akka.actor.Address]" id="akka.contrib.pattern.ClusterSingletonManager.Internal;WasOldestData.newOldestOption">newOldestOption</a>: <span title="Option[akka.actor.Address]">Option</span><span class="delimiter">[</span>Address<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;Data" title="akka.contrib.pattern.ClusterSingletonManager.Data">Data</a>
    <span class="keyword">case class</span> <a title="class HandingOverData extends AnyRef with akka.contrib.pattern.ClusterSingletonManager.Data with Product with Serializable" id="akka.contrib.pattern.ClusterSingletonManager.Internal.HandingOverData.readResolve">HandingOverData</a><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandingOverData.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.contrib.pattern.ClusterSingletonManager.Internal;HandingOverData.singleton">singleton</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Option[akka.actor.ActorRef]" id="akka.contrib.pattern.ClusterSingletonManager.Internal;HandingOverData.handOverTo">handOverTo</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;Data" title="akka.contrib.pattern.ClusterSingletonManager.Data">Data</a>
    <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.EndData.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.EndData.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.EndData.readResolve">EndData</a> <span title="Product" class="keyword">extends</span> <a href="#akka.contrib.pattern.ClusterSingletonManager;Data" title="akka.contrib.pattern.ClusterSingletonManager.Data">Data</a>

    <span class="keyword">val</span> <a title="String" id="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverRetryTimer">HandOverRetryTimer</a> = <span title="String(&quot;hand-over-retry&quot;)" class="string">&quot;hand-over-retry&quot;</span>
    <span class="keyword">val</span> <a title="String" id="akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverRetryTimer">TakeOverRetryTimer</a> = <span title="String(&quot;take-over-retry&quot;)" class="string">&quot;take-over-retry&quot;</span>
    <span class="keyword">val</span> <a title="String" id="akka.contrib.pattern.ClusterSingletonManager.Internal.CleanupTimer">CleanupTimer</a> = <span title="String(&quot;cleanup&quot;)" class="string">&quot;cleanup&quot;</span>

    <span class="keyword">def</span> <a title="(role: String)Option[String]" id="akka.contrib.pattern.ClusterSingletonManager.Internal.roleOption">roleOption</a><span class="delimiter">(</span><a title="String" id="akka.contrib.pattern.ClusterSingletonManager.Internal.roleOption.role">role</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.roleOption.role" title="String">role</a> <span title="Option[String]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> | <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> ⇒ <span title="None.type">None</span>
      <span class="keyword">case</span> _         ⇒ <span title="(x: String)Some[String]">Some</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.roleOption.role" title="String">role</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">object</span> <a title="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer">OldestChangedBuffer</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer" title="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.type" class="delimiter">{</a>
      <span class="comment">/**
       * Request to deliver one more event.
       */</span>
      <span class="keyword">case object</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.GetNext.productElement.x$1" title="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.GetNext.type" id="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.GetNext.readResolve">GetNext</a>
      <span class="comment">/**
       * The first event, corresponding to CurrentClusterState.
       */</span>
      <span class="keyword">case class</span> <a title="class InitialOldestState extends AnyRef with Product with Serializable" id="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.InitialOldestState.readResolve">InitialOldestState</a><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.InitialOldestState.readResolve" title="Product" class="delimiter">(</a><a title="Option[akka.actor.Address]" id="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer;InitialOldestState.oldest">oldest</a>: <span title="Option[akka.actor.Address]">Option</span><span class="delimiter">[</span>Address<span class="delimiter">]</span>, <a title="Int" id="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer;InitialOldestState.memberCount">memberCount</a>: <span title="Int">Int</span><span class="delimiter">)</span>

      <span class="keyword">case class</span> <a title="class OldestChanged extends AnyRef with Product with Serializable" id="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.OldestChanged.readResolve">OldestChanged</a><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.OldestChanged.readResolve" title="Product" class="delimiter">(</a><a title="Option[akka.actor.Address]" id="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer;OldestChanged.oldest">oldest</a>: <span title="Option[akka.actor.Address]">Option</span><span class="delimiter">[</span>Address<span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Notifications of member events that track oldest member is tunneled
     * via this actor (child of ClusterSingletonManager) to be able to deliver
     * one change at a time. Avoiding simultaneous changes simplifies
     * the process in ClusterSingletonManager. ClusterSingletonManager requests
     * next event with `GetNext` when it is ready for it. Only one outstanding
     * `GetNext` request is allowed. Incoming events are buffered and delivered
     * upon `GetNext` request.
     */</span>
    <span class="keyword">class</span> <a title="class OldestChangedBuffer extends AnyRef with akka.actor.Actor" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer">OldestChangedBuffer</a><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer" title="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer" class="delimiter">(</a><a title="Option[String]" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.role">role</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="delimiter">{</span>
      <span class="keyword">import</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer" title="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.type">OldestChangedBuffer</a>._
      <span class="keyword">import</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher

      <span class="keyword">val</span> <a title="akka.cluster.Cluster" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.cluster">cluster</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>
      <span class="comment">// sort by age, oldest first</span>
      <span class="keyword">val</span> <a title="scala.math.Ordering[akka.cluster.Member]" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.ageOrdering">ageOrdering</a> = <span title="=&gt; math.Ordering.type">Ordering</span>.<span title="[T](cmp: (T, T) =&gt; Boolean)scala.math.Ordering[T]">fromLessThan</span><span title="(cmp: (akka.cluster.Member, akka.cluster.Member) =&gt; Boolean)scala.math.Ordering[akka.cluster.Member]" class="delimiter">[</span><a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member" title="akka.cluster.Member">Member</a><span class="delimiter">]</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.ageOrdering.$anonfun.a">a</a>, <a title="akka.cluster.Member" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.ageOrdering.$anonfun.b">b</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.ageOrdering.$anonfun.a" title="akka.cluster.Member">a</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.isOlderThan" title="(other: akka.cluster.Member)Boolean">isOlderThan</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.ageOrdering.$anonfun.b" title="akka.cluster.Member">b</a><span class="delimiter">)</span> <span class="delimiter">}</span>
      <span class="keyword">var</span> <a title="scala.collection.immutable.SortedSet[akka.cluster.Member]" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.membersByAge_=">membersByAge</a>: immutable.<span title="scala.collection.immutable.SortedSet[akka.cluster.Member]">SortedSet</span><span class="delimiter">[</span>Member<span class="delimiter">]</span> = immutable.<span title="scala.collection.immutable.SortedSet.type">SortedSet</span>.<span title="(implicit ord: Ordering[akka.cluster.Member])scala.collection.immutable.SortedSet[akka.cluster.Member]">empty</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.ageOrdering" title="=&gt; scala.math.Ordering[akka.cluster.Member]">ageOrdering</a><span class="delimiter">)</span>

      <span class="keyword">var</span> <a title="scala.collection.immutable.Vector[AnyRef]" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.changes_=">changes</a> = <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="[A]=&gt; scala.collection.immutable.Vector[A]">empty</span><span title="scala.collection.immutable.Vector[AnyRef]" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span>

      <span class="comment">// subscribe to MemberEvent, re-subscribe when restart</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.preStart">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.subscribe(6cfb44d410)" title="(subscriber: akka.actor.ActorRef, to: Class[_]*)Unit">subscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, classOf<span title="Class[akka.cluster.ClusterEvent.MemberEvent](classOf[akka.cluster.ClusterEvent$$MemberEvent])" class="delimiter">[</span>MemberEvent<span class="delimiter">]</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.unsubscribe(134bd64d81)" title="(subscriber: akka.actor.ActorRef)Unit">unsubscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(member: akka.cluster.Member)Boolean" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.matchingRole">matchingRole</a><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.matchingRole.member">member</a>: <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member" title="akka.cluster.Member">Member</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.role" title="Option[String]">role</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="None.type">None</span>    ⇒ <span title="Boolean(true)" class="keyword">true</span>
        <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="String" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.matchingRole.r">r</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.matchingRole.member" title="akka.cluster.Member">member</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.hasRole" title="(role: String)Boolean">hasRole</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.matchingRole.r" title="String">r</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(block: () =&gt; Unit)Unit" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.trackChange">trackChange</a><span class="delimiter">(</span><a title="() =&gt; Unit" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.trackChange.block">block</a>: <span class="delimiter">(</span><span class="delimiter">)</span> ⇒ Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Option[akka.cluster.Member]" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.trackChange.before">before</a> = <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a>.<span title="=&gt; Option[akka.cluster.Member]">headOption</span>
        <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.trackChange.block" title="()Unit">block</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Option[akka.cluster.Member]" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.trackChange.after">after</a> = <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a>.<span title="=&gt; Option[akka.cluster.Member]">headOption</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.trackChange.before" title="Option[akka.cluster.Member]">before</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.trackChange.after" title="Option[akka.cluster.Member]">after</a><span class="delimiter">)</span>
          <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.changes_=" title="(x$1: scala.collection.immutable.Vector[AnyRef])Unit">changes</a> <span title="(elem: AnyRef)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector[AnyRef],AnyRef,scala.collection.immutable.Vector[AnyRef]])scala.collection.immutable.Vector[AnyRef]">:+=</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.OldestChanged.readResolve" title="(oldest: Option[akka.actor.Address])akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.OldestChanged">OldestChanged</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.trackChange.after" title="Option[akka.cluster.Member]">after</a>.<span title="(f: akka.cluster.Member =&gt; akka.actor.Address)Option[akka.actor.Address]">map</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.trackChange.$anonfun.x$1" title="akka.cluster.Member">_</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(state: akka.cluster.ClusterEvent.CurrentClusterState)Unit" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.handleInitial">handleInitial</a><span class="delimiter">(</span><a title="akka.cluster.ClusterEvent.CurrentClusterState" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.handleInitial.state">state</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState" title="akka.cluster.ClusterEvent.CurrentClusterState">CurrentClusterState</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.membersByAge_=" title="(x$1: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit">membersByAge</a> = immutable.<span title="scala.collection.immutable.SortedSet.type">SortedSet</span>.<span title="(implicit ord: Ordering[akka.cluster.Member])scala.collection.immutable.SortedSet[akka.cluster.Member]">empty</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.ageOrdering" title="=&gt; scala.math.Ordering[akka.cluster.Member]">ageOrdering</a><span class="delimiter">)</span> <span title="(elems: scala.collection.GenTraversableOnce[akka.cluster.Member])scala.collection.immutable.SortedSet[akka.cluster.Member]">++</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.handleInitial.state" title="akka.cluster.ClusterEvent.CurrentClusterState">state</a>.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState.members" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">members</a>.<span title="(p: akka.cluster.Member =&gt; Boolean)scala.collection.immutable.SortedSet[akka.cluster.Member]">filter</span><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.handleInitial.$anonfun.m">m</a> ⇒
          <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.handleInitial.$anonfun.m" title="akka.cluster.Member">m</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.status" title="=&gt; akka.cluster.MemberStatus">status</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.MemberStatus" title="akka.cluster.MemberStatus.type">MemberStatus</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.MemberStatus.Up" title="akka.cluster.MemberStatus.Up.type">Up</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.matchingRole" title="(member: akka.cluster.Member)Boolean">matchingRole</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.handleInitial.$anonfun.m" title="akka.cluster.Member">m</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.InitialOldestState" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.handleInitial.initial">initial</a> = <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.InitialOldestState.readResolve" title="(oldest: Option[akka.actor.Address], memberCount: Int)akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.InitialOldestState">InitialOldestState</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a>.<span title="=&gt; Option[akka.cluster.Member]">headOption</span>.<span title="(f: akka.cluster.Member =&gt; akka.actor.Address)Option[akka.actor.Address]">map</span><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.handleInitial.initial.$anonfun.x$2" title="akka.cluster.Member">_</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>, <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
        <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.changes_=" title="(x$1: scala.collection.immutable.Vector[AnyRef])Unit">changes</a> <span title="(elem: AnyRef)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector[AnyRef],AnyRef,scala.collection.immutable.Vector[AnyRef]])scala.collection.immutable.Vector[AnyRef]">:+=</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.handleInitial.initial" title="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.InitialOldestState">initial</a>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(m: akka.cluster.Member)Unit" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.add">add</a><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.add.m">m</a>: <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member" title="akka.cluster.Member">Member</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.matchingRole" title="(member: akka.cluster.Member)Boolean">matchingRole</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.add.m" title="akka.cluster.Member">m</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.trackChange" title="(block: () =&gt; Unit)Unit">trackChange</a> <span class="delimiter">{</span> <span class="delimiter">(</span><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.membersByAge_=" title="(x$1: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit">membersByAge</a> <span title="(elem: akka.cluster.Member)scala.collection.immutable.SortedSet[akka.cluster.Member]">+=</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.add.m" title="akka.cluster.Member">m</a> <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(m: akka.cluster.Member)Unit" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.remove">remove</a><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.remove.m">m</a>: <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member" title="akka.cluster.Member">Member</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.matchingRole" title="(member: akka.cluster.Member)Boolean">matchingRole</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.remove.m" title="akka.cluster.Member">m</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.trackChange" title="(block: () =&gt; Unit)Unit">trackChange</a> <span class="delimiter">{</span> <span class="delimiter">(</span><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.membersByAge_=" title="(x$1: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit">membersByAge</a> <span title="(elem: akka.cluster.Member)scala.collection.immutable.SortedSet[akka.cluster.Member]">-=</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.remove.m" title="akka.cluster.Member">m</a> <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.sendFirstChange">sendFirstChange</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="AnyRef" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.sendFirstChange.event">event</a> = <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.changes_=" title="=&gt; scala.collection.immutable.Vector[AnyRef]">changes</a>.<span title="=&gt; AnyRef">head</span>
        <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.changes_=" title="(x$1: scala.collection.immutable.Vector[AnyRef])Unit">changes</a> = <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.changes_=" title="=&gt; scala.collection.immutable.Vector[AnyRef]">changes</a>.<span title="=&gt; scala.collection.immutable.Vector[AnyRef]">tail</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">parent</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.sendFirstChange.event" title="AnyRef">event</a>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="=&gt; PartialFunction[Any,Unit]" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.receive">receive</a> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
        <span class="keyword">case</span> <a title="akka.cluster.ClusterEvent.CurrentClusterState" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.receive;$anonfun.isDefinedAt.state">state</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState" title="akka.cluster.ClusterEvent.CurrentClusterState">CurrentClusterState</a> ⇒ <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.handleInitial" title="(state: akka.cluster.ClusterEvent.CurrentClusterState)Unit">handleInitial</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.receive;$anonfun.isDefinedAt.state" title="akka.cluster.ClusterEvent.CurrentClusterState">state</a><span class="delimiter">)</span>
        <span class="keyword">case</span> MemberUp<span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.receive;$anonfun.isDefinedAt.m">m</a><span class="delimiter">)</span>                ⇒ <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.add" title="(m: akka.cluster.Member)Unit">add</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.receive;$anonfun.isDefinedAt.m" title="akka.cluster.Member">m</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="akka.cluster.ClusterEvent.MemberEvent" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.receive;$anonfun.isDefinedAt.mEvent">mEvent</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;MemberEvent" title="akka.cluster.ClusterEvent.MemberEvent">MemberEvent</a> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.receive;$anonfun.isDefinedAt.mEvent" title="akka.cluster.ClusterEvent.MemberEvent">mEvent</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;MemberExited" title="akka.cluster.ClusterEvent.MemberExited">MemberExited</a><span class="delimiter">]</span> <span title="(x: Boolean)Boolean">||</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.receive;$anonfun.isDefinedAt.mEvent" title="akka.cluster.ClusterEvent.MemberEvent">mEvent</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;MemberRemoved" title="akka.cluster.ClusterEvent.MemberRemoved">MemberRemoved</a><span class="delimiter">]</span><span class="delimiter">)</span> ⇒
          <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.remove" title="(m: akka.cluster.Member)Unit">remove</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.receive;$anonfun.isDefinedAt.mEvent" title="akka.cluster.ClusterEvent.MemberEvent">mEvent</a>.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;MemberEvent.member" title="=&gt; akka.cluster.Member">member</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.GetNext.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.GetNext.type">GetNext</a> <span class="keyword">if</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.changes_=" title="=&gt; scala.collection.immutable.Vector[AnyRef]">changes</a>.<span title="=&gt; Boolean">isEmpty</span> ⇒
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.become(771101a7b6)" title="(behavior: akka.actor.Actor.Receive, discardOld: Boolean)Unit">become</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.deliverNext" title="=&gt; akka.actor.Actor.Receive">deliverNext</a>, discardOld = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.GetNext.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.GetNext.type">GetNext</a> ⇒
          <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.sendFirstChange" title="()Unit">sendFirstChange</a><span title="Boolean(true)" class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="comment">// the buffer was empty when GetNext was received, deliver next event immediately</span>
      <span class="keyword">def</span> <a title="=&gt; akka.actor.Actor.Receive" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.deliverNext">deliverNext</a>: Actor.<span title="akka.actor.Actor.Receive">Receive</span> = <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.deliverNext;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
        <span class="keyword">case</span> <a title="akka.cluster.ClusterEvent.CurrentClusterState" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.deliverNext;$anonfun.isDefinedAt.state">state</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState" title="akka.cluster.ClusterEvent.CurrentClusterState">CurrentClusterState</a> ⇒
          <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.handleInitial" title="(state: akka.cluster.ClusterEvent.CurrentClusterState)Unit">handleInitial</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.deliverNext;$anonfun.isDefinedAt.state" title="akka.cluster.ClusterEvent.CurrentClusterState">state</a><span class="delimiter">)</span>
          <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.sendFirstChange" title="()Unit">sendFirstChange</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.unbecome" title="()Unit">unbecome</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">case</span> MemberUp<span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.deliverNext;$anonfun.isDefinedAt.m">m</a><span class="delimiter">)</span> ⇒
          <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.add" title="(m: akka.cluster.Member)Unit">add</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.deliverNext;$anonfun.isDefinedAt.m" title="akka.cluster.Member">m</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.changes_=" title="=&gt; scala.collection.immutable.Vector[AnyRef]">changes</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.sendFirstChange" title="()Unit">sendFirstChange</a><span class="delimiter">(</span><span class="delimiter">)</span>
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.unbecome" title="()Unit">unbecome</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="keyword">case</span> <a title="akka.cluster.ClusterEvent.MemberEvent" id="akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.deliverNext;$anonfun.isDefinedAt.mEvent">mEvent</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;MemberEvent" title="akka.cluster.ClusterEvent.MemberEvent">MemberEvent</a> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.deliverNext;$anonfun.isDefinedAt.mEvent" title="akka.cluster.ClusterEvent.MemberEvent">mEvent</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;MemberExited" title="akka.cluster.ClusterEvent.MemberExited">MemberExited</a><span class="delimiter">]</span> <span title="(x: Boolean)Boolean">||</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.deliverNext;$anonfun.isDefinedAt.mEvent" title="akka.cluster.ClusterEvent.MemberEvent">mEvent</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;MemberRemoved" title="akka.cluster.ClusterEvent.MemberRemoved">MemberRemoved</a><span class="delimiter">]</span><span class="delimiter">)</span> ⇒
          <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.remove" title="(m: akka.cluster.Member)Unit">remove</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.deliverNext;$anonfun.isDefinedAt.mEvent" title="akka.cluster.ClusterEvent.MemberEvent">mEvent</a>.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;MemberEvent.member" title="=&gt; akka.cluster.Member">member</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.changes_=" title="=&gt; scala.collection.immutable.Vector[AnyRef]">changes</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestChangedBuffer.sendFirstChange" title="()Unit">sendFirstChange</a><span class="delimiter">(</span><span class="delimiter">)</span>
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.unbecome" title="()Unit">unbecome</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span>

  <span class="delimiter">}</span>
<span title="AnyRef" class="delimiter">}</span>

<span class="comment">/**
 * Thrown when a consistent state can't be determined within the
 * defined retry limits. Eventually it will reach a stable state and
 * can continue, and that is simplified by starting over with a clean
 * state. Parent supervisor should typically restart the actor, i.e.
 * default decision.
 */</span>
<span title="AnyRef" class="keyword">class</span> <a title="class ClusterSingletonManagerIsStuck extends akka.AkkaException" id="akka.contrib.pattern;ClusterSingletonManagerIsStuck">ClusterSingletonManagerIsStuck</a><a href="#akka.contrib.pattern;ClusterSingletonManagerIsStuck" title="akka.contrib.pattern.ClusterSingletonManagerIsStuck" class="delimiter">(</a><a title="String" id="akka.contrib.pattern;ClusterSingletonManagerIsStuck.message">message</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../actor/akka/AkkaException.scala.html#akka;AkkaException" title="akka.AkkaException">AkkaException</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManagerIsStuck.message" title="String">message</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>

<span class="comment">/**
 * Manages singleton actor instance among all cluster nodes or a group
 * of nodes tagged with a specific role. At most one singleton instance
 * is running at any point in time.
 *
 * The ClusterSingletonManager is supposed to be started on all nodes,
 * or all nodes with specified role, in the cluster with `actorOf`.
 * The actual singleton is started on the oldest node by creating a child
 * actor from the supplied `singletonProps`.
 *
 * The singleton actor is always running on the oldest member, which can
 * be determined by [[akka.cluster.Member#isOlderThan]].
 * This can change when removing members. A graceful hand over can normally
 * be performed when current oldest node is leaving the cluster. Be aware that
 * there is a short time period when there is no active singleton during the
 * hand-over process.
 *
 * The cluster failure detector will notice when oldest node
 * becomes unreachable due to things like JVM crash, hard shut down,
 * or network failure. When the crashed node has been removed (via down) from the
 * cluster then a new oldest node will take over and a new singleton actor is
 * created. For these failure scenarios there will not be a graceful hand-over,
 * but more than one active singletons is prevented by all reasonable means. Some
 * corner cases are eventually resolved by configurable timeouts.
 *
 * You access the singleton actor with `actorSelection` using the names you have
 * specified when creating the ClusterSingletonManager. You can subscribe to
 * [[akka.cluster.ClusterEvent.MemberEvent]] and sort the members by age
 * ([[akka.cluster.ClusterEvent.Member#isOlderThan]]) to keep track of oldest member.
 * Alternatively the singleton actor may broadcast its existence when it is started.
 *
 * Use factory method [[ClusterSingletonManager#props] to create the
 * [[akka.actor.Props]] for the actor.
 *
 * ==Arguments==
 *
 * '''''singletonProps''''' [[akka.actor.Props]] of the singleton actor instance.
 *
 * '''''singletonName''''' The actor name of the child singleton actor.
 *
 * '''''terminationMessage''''' When handing over to a new oldest node
 *   this `terminationMessage` is sent to the singleton actor to tell
 *   it to finish its work, close resources, and stop.
 *   The hand-over to the new oldest node is completed when the
 *   singleton actor is terminated.
 *   Note that [[akka.actor.PoisonPill]] is a perfectly fine
 *   `terminationMessage` if you only need to stop the actor.
 *
 * '''''role''''' Singleton among the nodes tagged with specified role.
 *   If the role is not specified it's a singleton among all nodes in
 *   the cluster.
 *
 * '''''maxHandOverRetries''''' When a node is becoming oldest it sends
 *   hand-over request to previous oldest. This is retried with the
 *   `retryInterval` until the previous oldest confirms that the hand
 *   over has started, or this `maxHandOverRetries` limit has been
 *   reached. If the retry limit is reached it takes the decision to be
 *   the new oldest if previous oldest is unknown (typically removed),
 *   otherwise it initiates a new round by throwing
 *   [[akka.contrib.pattern.ClusterSingletonManagerIsStuck]] and expecting
 *   restart with fresh state. For a cluster with many members you might
 *   need to increase this retry limit because it takes longer time to
 *   propagate changes across all nodes.
 *
 * '''''maxTakeOverRetries''''' When a oldest node is not oldest any more
 *   it sends take over request to the new oldest to initiate the normal
 *   hand-over process. This is especially useful when new node joins and becomes
 *   oldest immediately, without knowing who was previous oldest. This is retried
 *   with the `retryInterval` until this retry limit has been reached. If the retry
 *   limit is reached it initiates a new round by throwing
 *   [[akka.contrib.pattern.ClusterSingletonManagerIsStuck]] and expecting
 *   restart with fresh state. This will also cause the singleton actor to be
 *   stopped. `maxTakeOverRetries` must be less than `maxHandOverRetries` to
 *   ensure that new oldest doesn't start singleton actor before previous is
 *   stopped for certain corner cases.
 */</span>
<span class="keyword">class</span> <a title="class ClusterSingletonManager extends AnyRef with akka.actor.Actor with akka.actor.FSM[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]" id="akka.contrib.pattern;ClusterSingletonManager">ClusterSingletonManager</a><a href="#akka.contrib.pattern;ClusterSingletonManager" title="akka.contrib.pattern.ClusterSingletonManager" class="delimiter">(</a>
  <a title="akka.actor.Props" id="akka.contrib.pattern;ClusterSingletonManager.singletonProps">singletonProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a>,
  <a title="String" id="akka.contrib.pattern;ClusterSingletonManager.singletonName">singletonName</a>: <span title="String">String</span>,
  <a title="Any" id="akka.contrib.pattern;ClusterSingletonManager.terminationMessage">terminationMessage</a>: <span title="Any">Any</span>,
  <a title="Option[String]" id="akka.contrib.pattern;ClusterSingletonManager.role">role</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>,
  <a title="Int" id="akka.contrib.pattern;ClusterSingletonManager.maxHandOverRetries">maxHandOverRetries</a>: <span title="Int">Int</span>,
  <a title="Int" id="akka.contrib.pattern;ClusterSingletonManager.maxTakeOverRetries">maxTakeOverRetries</a>: <span title="Int">Int</span>,
  <a title="scala.concurrent.duration.FiniteDuration" id="akka.contrib.pattern;ClusterSingletonManager.retryInterval">retryInterval</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="keyword">with</span> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM" title="akka.actor.FSM[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">FSM</a><span class="delimiter">[</span>ClusterSingletonManager.State, ClusterSingletonManager.Data<span class="delimiter">]</span> <span class="delimiter">{</span>

  <span class="comment">// to ensure that new oldest doesn't start singleton actor before previous is stopped for certain corner cases</span>
  <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.maxTakeOverRetries" title="Int">maxTakeOverRetries</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.maxHandOverRetries" title="Int">maxHandOverRetries</a>,
    <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;maxTakeOverRetries [&quot;)">maxTakeOverRetries [$</span><span class="delimiter">{</span><a href="#akka.contrib.pattern;ClusterSingletonManager.maxTakeOverRetries" title="Int">maxTakeOverRetries</a><span class="delimiter">}</span><span title="String(&quot;]must be &lt; maxHandOverRetries [&quot;)">]must be &lt; maxHandOverRetries [$</span><span class="delimiter">{</span><a href="#akka.contrib.pattern;ClusterSingletonManager.maxHandOverRetries" title="Int">maxHandOverRetries</a><span class="delimiter">}</span><span title="String(&quot;]&quot;)" class="string">]&quot;</span><span class="delimiter">)</span>

  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ClusterSingletonManager" title="akka.contrib.pattern.ClusterSingletonManager.type">ClusterSingletonManager</a>._
  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ClusterSingletonManager" title="akka.contrib.pattern.ClusterSingletonManager.type">ClusterSingletonManager</a>.<a href="#akka.contrib.pattern.ClusterSingletonManager.Internal" title="akka.contrib.pattern.ClusterSingletonManager.Internal.type">Internal</a>._
  <span class="keyword">import</span> <a href="#akka.contrib.pattern.ClusterSingletonManager" title="akka.contrib.pattern.ClusterSingletonManager.type">ClusterSingletonManager</a>.<a href="#akka.contrib.pattern.ClusterSingletonManager.Internal" title="akka.contrib.pattern.ClusterSingletonManager.Internal.type">Internal</a>.<a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer" title="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.type">OldestChangedBuffer</a>._

  <span class="keyword">val</span> <a title="akka.cluster.Cluster" id="akka.contrib.pattern;ClusterSingletonManager.cluster">cluster</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="Some[akka.actor.Address]" id="akka.contrib.pattern;ClusterSingletonManager.selfAddressOption">selfAddressOption</a> = <span title="(x: akka.actor.Address)Some[akka.actor.Address]">Some</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a><span class="delimiter">)</span>
  <span class="keyword">import</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.settings" title="=&gt; akka.cluster.ClusterSettings">settings</a>.LogInfo

  <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.role" title="Option[String]">role</a>.<span title="(p: String =&gt; Boolean)Boolean">forall</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfRoles" title="=&gt; Set[String]">selfRoles</a>.<a href="#akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>.$anonfun.elem" title="(elem: String)Boolean">contains</a><span class="delimiter">)</span>,
    <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;This cluster member [&quot;)">This cluster member [$</span><span class="delimiter">{</span><a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a><span class="delimiter">}</span><span title="String(&quot;] doesn\'t have the role [&quot;)">] doesn't have the role [$</span><a href="#akka.contrib.pattern;ClusterSingletonManager.role" title="Option[String]">role</a><span title="String(&quot;]&quot;)" class="string">]&quot;</span><span class="delimiter">)</span>

  <span class="comment">// started when when self member is Up</span>
  <span class="keyword">var</span> <a title="akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSingletonManager.oldestChangedBuffer_=">oldestChangedBuffer</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = _
  <span class="comment">// Previous GetNext request delivered event and new GetNext is to be sent</span>
  <span class="keyword">var</span> <a title="Boolean" id="akka.contrib.pattern;ClusterSingletonManager.oldestChangedReceived_=">oldestChangedReceived</a> = <span title="Boolean(true)" class="keyword">true</span>

  <span class="keyword">var</span> <a title="Boolean" id="akka.contrib.pattern;ClusterSingletonManager.selfExited_=">selfExited</a> = <span title="Boolean(false)" class="keyword">false</span>

  <span class="comment">// keep track of previously removed members</span>
  <span class="keyword">var</span> <a title="scala.collection.immutable.Map[akka.actor.Address,scala.concurrent.duration.Deadline]" id="akka.contrib.pattern;ClusterSingletonManager.removed_=">removed</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.actor.Address,scala.concurrent.duration.Deadline]" class="delimiter">[</span><a href="../../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a>, <span title="scala.concurrent.duration.Deadline">Deadline</span><span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="(address: akka.actor.Address)Unit" id="akka.contrib.pattern;ClusterSingletonManager.addRemoved">addRemoved</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.contrib.pattern;ClusterSingletonManager.addRemoved.address">address</a>: <a href="../../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.contrib.pattern;ClusterSingletonManager.removed_=" title="(x$1: scala.collection.immutable.Map[akka.actor.Address,scala.concurrent.duration.Deadline])Unit">removed</a> <span title="(kv: (akka.actor.Address, scala.concurrent.duration.Deadline))scala.collection.immutable.Map[akka.actor.Address,scala.concurrent.duration.Deadline]">+=</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.addRemoved.address" title="(x: akka.actor.Address)ArrowAssoc[akka.actor.Address]">address</a> <span title="(y: scala.concurrent.duration.Deadline)(akka.actor.Address, scala.concurrent.duration.Deadline)">-&gt;</span> <span class="delimiter">(</span><span title="scala.concurrent.duration.Deadline.type">Deadline</span>.<span title="=&gt; scala.concurrent.duration.Deadline">now</span> <span title="(other: scala.concurrent.duration.FiniteDuration)scala.concurrent.duration.Deadline">+</span> <span title="implicit scala.concurrent.duration.package.DurationInt : (n: Int)concurrent.duration.DurationInt" class="int">15</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">minutes</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ClusterSingletonManager.cleanupOverdueNotMemberAnyMore">cleanupOverdueNotMemberAnyMore</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.contrib.pattern;ClusterSingletonManager.removed_=" title="(x$1: scala.collection.immutable.Map[akka.actor.Address,scala.concurrent.duration.Deadline])Unit">removed</a> = <a href="#akka.contrib.pattern;ClusterSingletonManager.removed_=" title="=&gt; scala.collection.immutable.Map[akka.actor.Address,scala.concurrent.duration.Deadline]">removed</a> <span title="(p: ((akka.actor.Address, scala.concurrent.duration.Deadline)) =&gt; Boolean)scala.collection.immutable.Map[akka.actor.Address,scala.concurrent.duration.Deadline]">filter</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.cleanupOverdueNotMemberAnyMore.$anonfun.x0$1" title="Boolean" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span><a title="akka.actor.Address" id="akka.contrib.pattern;ClusterSingletonManager.cleanupOverdueNotMemberAnyMore.$anonfun.address">address</a>, <a title="scala.concurrent.duration.Deadline" id="akka.contrib.pattern;ClusterSingletonManager.cleanupOverdueNotMemberAnyMore.$anonfun.deadline">deadline</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ClusterSingletonManager.cleanupOverdueNotMemberAnyMore.$anonfun.deadline" title="scala.concurrent.duration.Deadline">deadline</a>.<span title="()Boolean">hasTimeLeft</span> <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(message: String)Unit" id="akka.contrib.pattern;ClusterSingletonManager.logInfo(cc2e600322)">logInfo</a><span class="delimiter">(</span><a title="String" id="akka.contrib.pattern;ClusterSingletonManager.logInfo(cc2e600322).message">message</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../../cluster/akka/cluster/ClusterSettings.scala.html#akka.cluster;ClusterSettings.LogInfo" title="=&gt; Boolean">LogInfo</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.info(cc2e600322)" title="(message: String)Unit">info</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(cc2e600322).message" title="String">message</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(template: String, arg1: Any)Unit" id="akka.contrib.pattern;ClusterSingletonManager.logInfo(dc73c33c91)">logInfo</a><span class="delimiter">(</span><a title="String" id="akka.contrib.pattern;ClusterSingletonManager.logInfo(dc73c33c91).template">template</a>: <span title="String">String</span>, <a title="Any" id="akka.contrib.pattern;ClusterSingletonManager.logInfo(dc73c33c91).arg1">arg1</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../../cluster/akka/cluster/ClusterSettings.scala.html#akka.cluster;ClusterSettings.LogInfo" title="=&gt; Boolean">LogInfo</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.info(dc73c33c91)" title="(template: String, arg1: Any)Unit">info</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(dc73c33c91).template" title="String">template</a>, <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(dc73c33c91).arg1" title="Any">arg1</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(template: String, arg1: Any, arg2: Any)Unit" id="akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c)">logInfo</a><span class="delimiter">(</span><a title="String" id="akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c).template">template</a>: <span title="String">String</span>, <a title="Any" id="akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c).arg1">arg1</a>: <span title="Any">Any</span>, <a title="Any" id="akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c).arg2">arg2</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../../cluster/akka/cluster/ClusterSettings.scala.html#akka.cluster;ClusterSettings.LogInfo" title="=&gt; Boolean">LogInfo</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.info(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">info</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c).template" title="String">template</a>, <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c).arg1" title="Any">arg1</a>, <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c).arg2" title="Any">arg2</a><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ClusterSingletonManager.preStart">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.contrib.pattern;ClusterSingletonManager" title="akka.contrib.pattern.ClusterSingletonManager" class="keyword">super</a>.<a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.preStart" title="()Unit">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.isTerminated" title="=&gt; Boolean">isTerminated</a>, <span title="String(&quot;Cluster node must not be terminated&quot;)" class="string">&quot;Cluster node must not be terminated&quot;</span><span class="delimiter">)</span>

    <span class="comment">// subscribe to cluster changes, re-subscribe when restart</span>
    <a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.subscribe(6cfb44d410)" title="(subscriber: akka.actor.ActorRef, to: Class[_]*)Unit">subscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, classOf<span title="Class[akka.cluster.ClusterEvent.MemberExited](classOf[akka.cluster.ClusterEvent$$MemberExited])" class="delimiter">[</span>MemberExited<span class="delimiter">]</span>, classOf<span title="Class[akka.cluster.ClusterEvent.MemberRemoved](classOf[akka.cluster.ClusterEvent$$MemberRemoved])" class="delimiter">[</span>MemberRemoved<span class="delimiter">]</span><span class="delimiter">)</span>

    <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.setTimer" title="(name: String, msg: Any, timeout: scala.concurrent.duration.FiniteDuration, repeat: Boolean)Unit">setTimer</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.CleanupTimer" title="=&gt; String">CleanupTimer</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Cleanup.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Cleanup.type">Cleanup</a>, <span title="implicit scala.concurrent.duration.package.DurationInt : (n: Int)concurrent.duration.DurationInt" class="int">1</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">minute</span>, repeat = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

    <span class="comment">// defer subscription to avoid some jitter when</span>
    <span class="comment">// starting/joining several nodes at the same time</span>
    <a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.registerOnMemberUp(e8f142816b)" title="(code: =&gt; Unit)Unit">registerOnMemberUp</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">self</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.StartOldestChangedBuffer.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.StartOldestChangedBuffer.type">StartOldestChangedBuffer</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ClusterSingletonManager.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.cancelTimer" title="(name: String)Unit">cancelTimer</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.CleanupTimer" title="=&gt; String">CleanupTimer</a><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.unsubscribe(134bd64d81)" title="(subscriber: akka.actor.ActorRef)Unit">unsubscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ClusterSingletonManager" title="akka.contrib.pattern.ClusterSingletonManager" class="keyword">super</a>.<a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.postStop" title="()Unit">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(at: akka.actor.Address)akka.actor.ActorSelection" id="akka.contrib.pattern;ClusterSingletonManager.peer">peer</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.contrib.pattern;ClusterSingletonManager.peer.at">at</a>: <a href="../../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor;ActorSelection" title="akka.actor.ActorSelection">ActorSelection</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorSelection(271eeb39be)" title="(path: String)akka.actor.ActorSelection">actorSelection</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.toStringWithAddress" title="(address: akka.actor.Address)String">toStringWithAddress</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.peer.at" title="akka.actor.Address">at</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()Unit" id="akka.contrib.pattern;ClusterSingletonManager.getNextOldestChanged">getNextOldestChanged</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.oldestChangedReceived_=" title="=&gt; Boolean">oldestChangedReceived</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.contrib.pattern;ClusterSingletonManager.oldestChangedReceived_=" title="(x$1: Boolean)Unit">oldestChangedReceived</a> = <span title="Boolean(false)" class="keyword">false</span>
      <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">oldestChangedBuffer</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.GetNext.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer.GetNext.type">GetNext</a>
    <span class="delimiter">}</span>

  <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.startWith" title="(stateName: akka.contrib.pattern.ClusterSingletonManager.State, stateData: akka.contrib.pattern.ClusterSingletonManager.Data, timeout: ClusterSingletonManager.this.Timeout)Unit">startWith</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Start.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Start.type">Start</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Uninitialized.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Uninitialized.type">Uninitialized</a><span class="delimiter">)</span>

  <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.when" title="(stateName: akka.contrib.pattern.ClusterSingletonManager.State, stateTimeout: scala.concurrent.duration.FiniteDuration)(stateFunction: ClusterSingletonManager.this.StateFunction)Unit">when</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Start.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Start.type">Start</a><span class="delimiter">)</span> <span title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[ClusterSingletonManager.this.Event,ClusterSingletonManager.this.State] with Serializable" class="delimiter">{</span>
    <span class="keyword">case</span> Event<span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.StartOldestChangedBuffer.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.StartOldestChangedBuffer.type">StartOldestChangedBuffer</a>, _<span class="delimiter">)</span> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.oldestChangedBuffer_=" title="(x$1: akka.actor.ActorRef)Unit">oldestChangedBuffer</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(59f1e43182)" title="(props: akka.actor.Props)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.contrib.pattern.ClusterSingletonManager.Internal.OldestChangedBuffer](classOf[akka.contrib.pattern.ClusterSingletonManager$$Internal$OldestChangedBuffer])" class="delimiter">[</span>OldestChangedBuffer<span class="delimiter">]</span>, <a href="#akka.contrib.pattern;ClusterSingletonManager.role" title="Option[String]">role</a><span class="delimiter">)</span>.
        <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.withDispatcher" title="(d: String)akka.actor.Props">withDispatcher</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.props" title="=&gt; akka.actor.Props">props</a>.<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.dispatcher" title="=&gt; String">dispatcher</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ClusterSingletonManager.getNextOldestChanged" title="()Unit">getNextOldestChanged</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a>

    <span class="keyword">case</span> Event<span class="delimiter">(</span>InitialOldestState<span class="delimiter">(</span><span title="Option[akka.actor.Address]">oldestOption</span>, <a title="Int" id="akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.isDefinedAt.memberCount">memberCount</a><span class="delimiter">)</span>, _<span class="delimiter">)</span> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.oldestChangedReceived_=" title="(x$1: Boolean)Unit">oldestChangedReceived</a> = <span title="Boolean(true)" class="keyword">true</span>
      <span title="ClusterSingletonManager.this.State" class="keyword">if</span> <span class="delimiter">(</span><span title="Option[akka.actor.Address]">oldestOption</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.selfAddressOption" title="=&gt; Some[akka.actor.Address]">selfAddressOption</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.isDefinedAt.memberCount" title="Int">memberCount</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span class="comment">// alone, oldest immediately</span>
        <a href="#akka.contrib.pattern;ClusterSingletonManager.gotoOldest" title="()ClusterSingletonManager.this.State">gotoOldest</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]" class="keyword">if</span> <span class="delimiter">(</span><span title="Option[akka.actor.Address]">oldestOption</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.selfAddressOption" title="=&gt; Some[akka.actor.Address]">selfAddressOption</a><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.goto" title="(nextStateName: akka.contrib.pattern.ClusterSingletonManager.State)ClusterSingletonManager.this.State">goto</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldest.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldest.type">BecomingOldest</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State.using" title="(nextStateDate: akka.contrib.pattern.ClusterSingletonManager.Data)akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">using</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldestData.readResolve" title="(previousOldestOption: Option[akka.actor.Address])akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldestData">BecomingOldestData</a><span class="delimiter">(</span><span title="None.type">None</span><span class="delimiter">)</span>
      <span class="keyword">else</span>
        <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.goto" title="(nextStateName: akka.contrib.pattern.ClusterSingletonManager.State)ClusterSingletonManager.this.State">goto</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Younger.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Younger.type">Younger</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State.using" title="(nextStateDate: akka.contrib.pattern.ClusterSingletonManager.Data)akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">using</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.YoungerData.readResolve" title="(oldestOption: Option[akka.actor.Address])akka.contrib.pattern.ClusterSingletonManager.Internal.YoungerData">YoungerData</a><span class="delimiter">(</span><span title="Option[akka.actor.Address]">oldestOption</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.when" title="(stateName: akka.contrib.pattern.ClusterSingletonManager.State, stateTimeout: scala.concurrent.duration.FiniteDuration)(stateFunction: ClusterSingletonManager.this.StateFunction)Unit">when</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Younger.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Younger.type">Younger</a><span class="delimiter">)</span> <span title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[ClusterSingletonManager.this.Event,ClusterSingletonManager.this.State] with Serializable" class="delimiter">{</span>
    <span class="keyword">case</span> Event<span class="delimiter">(</span>OldestChanged<span class="delimiter">(</span><span title="Option[akka.actor.Address]">oldestOption</span><span class="delimiter">)</span>, YoungerData<span class="delimiter">(</span><span title="Option[akka.actor.Address]">previousOldestOption</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.oldestChangedReceived_=" title="(x$1: Boolean)Unit">oldestChangedReceived</a> = <span title="Boolean(true)" class="keyword">true</span>
      <span title="ClusterSingletonManager.this.State" class="keyword">if</span> <span class="delimiter">(</span><span title="Option[akka.actor.Address]">oldestOption</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.selfAddressOption" title="=&gt; Some[akka.actor.Address]">selfAddressOption</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(dc73c33c91)" title="(template: String, arg1: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Younger observed OldestChanged: [{} -&gt; myself]&quot;)" class="string">&quot;Younger observed OldestChanged: [{} -&gt; myself]&quot;</span>, <span title="Option[akka.actor.Address]">previousOldestOption</span><span class="delimiter">)</span>
        <span title="Option[akka.actor.Address]">previousOldestOption</span> <span title="ClusterSingletonManager.this.State" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="None.type">None</span>                                 ⇒ <a href="#akka.contrib.pattern;ClusterSingletonManager.gotoOldest" title="()ClusterSingletonManager.this.State">gotoOldest</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="akka.actor.Address">prev</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.removed_=" title="=&gt; scala.collection.immutable.Map[akka.actor.Address,scala.concurrent.duration.Deadline]">removed</a>.<span title="(key: akka.actor.Address)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.Address">prev</span><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ClusterSingletonManager.gotoOldest" title="()ClusterSingletonManager.this.State">gotoOldest</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="akka.actor.Address">prev</span><span class="delimiter">)</span> ⇒
            <a href="#akka.contrib.pattern;ClusterSingletonManager.peer" title="(at: akka.actor.Address)akka.actor.ActorSelection">peer</a><a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor.ActorSelection.toScala" title="implicit akka.actor.ActorSelection.toScala : (sel: akka.actor.ActorSelection)akka.actor.ScalaActorSelection" class="delimiter">(</a><span title="akka.actor.Address">prev</span><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor;ScalaActorSelection.!" title="(msg: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.type">HandOverToMe</a>
            <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.goto" title="(nextStateName: akka.contrib.pattern.ClusterSingletonManager.State)ClusterSingletonManager.this.State">goto</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldest.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldest.type">BecomingOldest</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State.using" title="(nextStateDate: akka.contrib.pattern.ClusterSingletonManager.Data)akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">using</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldestData.readResolve" title="(previousOldestOption: Option[akka.actor.Address])akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldestData">BecomingOldestData</a><span class="delimiter">(</span><span title="Option[akka.actor.Address]">previousOldestOption</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Younger observed OldestChanged: [{} -&gt; {}]&quot;)" class="string">&quot;Younger observed OldestChanged: [{} -&gt; {}]&quot;</span>, <span title="Option[akka.actor.Address]">previousOldestOption</span>, <span title="Option[akka.actor.Address]">oldestOption</span><span class="delimiter">)</span>
        <a href="#akka.contrib.pattern;ClusterSingletonManager.getNextOldestChanged" title="()Unit">getNextOldestChanged</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State.using" title="(nextStateDate: akka.contrib.pattern.ClusterSingletonManager.Data)akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">using</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.YoungerData.readResolve" title="(oldestOption: Option[akka.actor.Address])akka.contrib.pattern.ClusterSingletonManager.Internal.YoungerData">YoungerData</a><span class="delimiter">(</span><span title="Option[akka.actor.Address]">oldestOption</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="keyword">case</span> Event<span class="delimiter">(</span>MemberRemoved<span class="delimiter">(</span><span title="akka.cluster.Member">m</span>, _<span class="delimiter">)</span>, YoungerData<span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="akka.actor.Address">previousOldest</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="akka.actor.Address">previousOldest</span> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(dc73c33c91)" title="(template: String, arg1: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Previous oldest removed [{}]&quot;)" class="string">&quot;Previous oldest removed [{}]&quot;</span>, <span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ClusterSingletonManager.addRemoved" title="(address: akka.actor.Address)Unit">addRemoved</a><span class="delimiter">(</span><span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>
      <span class="comment">// transition when OldestChanged</span>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State.using" title="(nextStateDate: akka.contrib.pattern.ClusterSingletonManager.Data)akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">using</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.YoungerData.readResolve" title="(oldestOption: Option[akka.actor.Address])akka.contrib.pattern.ClusterSingletonManager.Internal.YoungerData">YoungerData</a><span class="delimiter">(</span><span title="None.type">None</span><span class="delimiter">)</span>

    <span class="keyword">case</span> Event<span class="delimiter">(</span>MemberRemoved<span class="delimiter">(</span><span title="akka.cluster.Member">m</span>, _<span class="delimiter">)</span>, _<span class="delimiter">)</span> <span class="keyword">if</span> <span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(cc2e600322)" title="(message: String)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Self removed, stopping ClusterSingletonManager&quot;)" class="string">&quot;Self removed, stopping ClusterSingletonManager&quot;</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stop(65b4a2ce7c)" title="()ClusterSingletonManager.this.State">stop</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="delimiter">}</span>

  <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.when" title="(stateName: akka.contrib.pattern.ClusterSingletonManager.State, stateTimeout: scala.concurrent.duration.FiniteDuration)(stateFunction: ClusterSingletonManager.this.StateFunction)Unit">when</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldest.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldest.type">BecomingOldest</a><span class="delimiter">)</span> <span title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[ClusterSingletonManager.this.Event,ClusterSingletonManager.this.State] with Serializable" class="delimiter">{</span>

    <span class="keyword">case</span> Event<span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverInProgress.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverInProgress.type">HandOverInProgress</a>, _<span class="delimiter">)</span> ⇒
      <span class="comment">// confirmation that the hand-over process has started</span>
      <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(dc73c33c91)" title="(template: String, arg1: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Hand-over in progress at [{}]&quot;)" class="string">&quot;Hand-over in progress at [{}]&quot;</span>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.cancelTimer" title="(name: String)Unit">cancelTimer</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverRetryTimer" title="=&gt; String">HandOverRetryTimer</a><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a>

    <span class="keyword">case</span> Event<span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverDone.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverDone.type">HandOverDone</a>, BecomingOldestData<span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="akka.actor.Address">previousOldest</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <span title="ClusterSingletonManager.this.State" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="akka.actor.Address">previousOldest</span><span class="delimiter">)</span>
        <a href="#akka.contrib.pattern;ClusterSingletonManager.gotoOldest" title="()ClusterSingletonManager.this.State">gotoOldest</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Ignoring HandOverDone in BecomingOldest from [{}]. Expected previous oldest [{}]&quot;)" class="string">&quot;Ignoring HandOverDone in BecomingOldest from [{}]. Expected previous oldest [{}]&quot;</span>,
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a>, <span title="akka.actor.Address">previousOldest</span><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a>
      <span class="delimiter">}</span>

    <span class="keyword">case</span> Event<span class="delimiter">(</span>MemberRemoved<span class="delimiter">(</span><span title="akka.cluster.Member">m</span>, _<span class="delimiter">)</span>, BecomingOldestData<span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="akka.actor.Address">previousOldest</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="akka.actor.Address">previousOldest</span> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(dc73c33c91)" title="(template: String, arg1: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Previous oldest [{}] removed&quot;)" class="string">&quot;Previous oldest [{}] removed&quot;</span>, <span title="akka.actor.Address">previousOldest</span><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ClusterSingletonManager.addRemoved" title="(address: akka.actor.Address)Unit">addRemoved</a><span class="delimiter">(</span><span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a>

    <span class="keyword">case</span> Event<span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverFromMe.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverFromMe.type">TakeOverFromMe</a>, BecomingOldestData<span class="delimiter">(</span><span title="None.type">None</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.type">HandOverToMe</a>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State.using" title="(nextStateDate: akka.contrib.pattern.ClusterSingletonManager.Data)akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">using</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldestData.readResolve" title="(previousOldestOption: Option[akka.actor.Address])akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldestData">BecomingOldestData</a><span class="delimiter">(</span><span title="(x: akka.actor.Address)Some[akka.actor.Address]">Some</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">case</span> Event<span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverFromMe.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverFromMe.type">TakeOverFromMe</a>, BecomingOldestData<span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="akka.actor.Address">previousOldest</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="akka.actor.Address">previousOldest</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.type">HandOverToMe</a>
      <span class="keyword">else</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Ignoring TakeOver request in BecomingOldest from [{}]. Expected previous oldest [{}]&quot;)" class="string">&quot;Ignoring TakeOver request in BecomingOldest from [{}]. Expected previous oldest [{}]&quot;</span>,
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a>, <span title="akka.actor.Address">previousOldest</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a>

    <span class="keyword">case</span> Event<span class="delimiter">(</span>HandOverRetry<span class="delimiter">(</span><span title="Int">count</span><span class="delimiter">)</span>, BecomingOldestData<span class="delimiter">(</span><span title="Option[akka.actor.Address]">previousOldestOption</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <span title="ClusterSingletonManager.this.State" class="keyword">if</span> <span class="delimiter">(</span><span title="Int">count</span> <span title="(x: Int)Boolean">&lt;=</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.maxHandOverRetries" title="Int">maxHandOverRetries</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Retry [{}], sending HandOverToMe to [{}]&quot;)" class="string">&quot;Retry [{}], sending HandOverToMe to [{}]&quot;</span>, <span title="Int">count</span>, <span title="Option[akka.actor.Address]">previousOldestOption</span><span class="delimiter">)</span>
        <span title="Option[akka.actor.Address]">previousOldestOption</span> <span title="(f: akka.actor.Address =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.peer" title="(at: akka.actor.Address)akka.actor.ActorSelection">peer</a><a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor.ActorSelection.toScala" title="implicit akka.actor.ActorSelection.toScala : (sel: akka.actor.ActorSelection)akka.actor.ScalaActorSelection" class="delimiter">(</a><a href="#akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.applyOrElse.$anonfun.x$3" title="akka.actor.Address">_</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor;ScalaActorSelection.!" title="(msg: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.type">HandOverToMe</a> <span class="delimiter">}</span>
        <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.setTimer" title="(name: String, msg: Any, timeout: scala.concurrent.duration.FiniteDuration, repeat: Boolean)Unit">setTimer</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverRetryTimer" title="=&gt; String">HandOverRetryTimer</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverRetry.readResolve" title="(count: Int)akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverRetry">HandOverRetry</a><span class="delimiter">(</span><span title="Int">count</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <a href="#akka.contrib.pattern;ClusterSingletonManager.retryInterval" title="scala.concurrent.duration.FiniteDuration">retryInterval</a>, repeat = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="ClusterSingletonManager.this.State" class="keyword">if</span> <span class="delimiter">(</span><span title="Option[akka.actor.Address]">previousOldestOption</span> <span title="(p: akka.actor.Address =&gt; Boolean)Boolean">forall</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.removed_=" title="=&gt; scala.collection.immutable.Map[akka.actor.Address,scala.concurrent.duration.Deadline]">removed</a>.<a href="#akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.applyOrElse.$anonfun.key" title="(key: akka.actor.Address)Boolean">contains</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">// can't send HandOverToMe, previousOldest unknown for new node (or restart)</span>
        <span class="comment">// previous oldest might be down or removed, so no TakeOverFromMe message is received</span>
        <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(cc2e600322)" title="(message: String)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Timeout in BecomingOldest. Previous oldest unknown, removed and no TakeOver request.&quot;)" class="string">&quot;Timeout in BecomingOldest. Previous oldest unknown, removed and no TakeOver request.&quot;</span><span class="delimiter">)</span>
        <a href="#akka.contrib.pattern;ClusterSingletonManager.gotoOldest" title="()ClusterSingletonManager.this.State">gotoOldest</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span>
        <span title="Nothing" class="keyword">throw</span> <span title="akka.contrib.pattern.ClusterSingletonManagerIsStuck" class="keyword">new</span> <a href="#akka.contrib.pattern;ClusterSingletonManagerIsStuck" title="akka.contrib.pattern.ClusterSingletonManagerIsStuck">ClusterSingletonManagerIsStuck</a><span class="delimiter">(</span>
          <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Becoming singleton oldest was stuck because previous oldest [&quot;)">Becoming singleton oldest was stuck because previous oldest [$</span><span class="delimiter">{</span><span title="Option[akka.actor.Address]">previousOldestOption</span><span class="delimiter">}</span><span title="String(&quot;] is unresponsive&quot;)" class="string">] is unresponsive&quot;</span><span class="delimiter">)</span>

  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()ClusterSingletonManager.this.State" id="akka.contrib.pattern;ClusterSingletonManager.gotoOldest">gotoOldest</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State" title="ClusterSingletonManager.this.State">State</a> = <span class="delimiter">{</span>
    <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(dc73c33c91)" title="(template: String, arg1: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Singleton manager [{}] starting singleton actor&quot;)" class="string">&quot;Singleton manager [{}] starting singleton actor&quot;</span>, <a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSingletonManager.gotoOldest.singleton">singleton</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a> <a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(874c98419a)" title="(props: akka.actor.Props, name: String)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.singletonProps" title="akka.actor.Props">singletonProps</a>, <a href="#akka.contrib.pattern;ClusterSingletonManager.singletonName" title="String">singletonName</a><span class="delimiter">)</span>
    <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.goto" title="(nextStateName: akka.contrib.pattern.ClusterSingletonManager.State)ClusterSingletonManager.this.State">goto</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Oldest.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Oldest.type">Oldest</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State.using" title="(nextStateDate: akka.contrib.pattern.ClusterSingletonManager.Data)akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">using</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.OldestData.readResolve" title="(singleton: akka.actor.ActorRef, singletonTerminated: Boolean)akka.contrib.pattern.ClusterSingletonManager.Internal.OldestData">OldestData</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.gotoOldest.singleton" title="akka.actor.ActorRef">singleton</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.when" title="(stateName: akka.contrib.pattern.ClusterSingletonManager.State, stateTimeout: scala.concurrent.duration.FiniteDuration)(stateFunction: ClusterSingletonManager.this.StateFunction)Unit">when</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Oldest.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Oldest.type">Oldest</a><span class="delimiter">)</span> <span title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[ClusterSingletonManager.this.Event,ClusterSingletonManager.this.State] with Serializable" class="delimiter">{</span>
    <span class="keyword">case</span> Event<span class="delimiter">(</span>OldestChanged<span class="delimiter">(</span><span title="Option[akka.actor.Address]">oldestOption</span><span class="delimiter">)</span>, OldestData<span class="delimiter">(</span><span title="akka.actor.ActorRef">singleton</span>, <span title="Boolean">singletonTerminated</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.oldestChangedReceived_=" title="(x$1: Boolean)Unit">oldestChangedReceived</a> = <span title="Boolean(true)" class="keyword">true</span>
      <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Oldest observed OldestChanged: [{} -&gt; {}]&quot;)" class="string">&quot;Oldest observed OldestChanged: [{} -&gt; {}]&quot;</span>, <a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a>, <span title="Option[akka.actor.Address]">oldestOption</span><span class="delimiter">)</span>
      <span title="Option[akka.actor.Address]">oldestOption</span> <span title="ClusterSingletonManager.this.State" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="akka.actor.Address">a</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="akka.actor.Address">a</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a> ⇒
          <span class="comment">// already oldest</span>
          <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a>
        <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="akka.actor.Address">a</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#akka.contrib.pattern;ClusterSingletonManager.selfExited_=" title="=&gt; Boolean">selfExited</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.removed_=" title="=&gt; scala.collection.immutable.Map[akka.actor.Address,scala.concurrent.duration.Deadline]">removed</a>.<span title="(key: akka.actor.Address)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.Address">a</span><span class="delimiter">)</span> ⇒
          <a href="#akka.contrib.pattern;ClusterSingletonManager.gotoHandingOver" title="(singleton: akka.actor.ActorRef, singletonTerminated: Boolean, handOverTo: Option[akka.actor.ActorRef])ClusterSingletonManager.this.State">gotoHandingOver</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">singleton</span>, <span title="Boolean">singletonTerminated</span>, <span title="None.type">None</span><span class="delimiter">)</span>
        <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="akka.actor.Address">a</span><span class="delimiter">)</span> ⇒
          <span class="comment">// send TakeOver request in case the new oldest doesn't know previous oldest</span>
          <a href="#akka.contrib.pattern;ClusterSingletonManager.peer" title="(at: akka.actor.Address)akka.actor.ActorSelection">peer</a><a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor.ActorSelection.toScala" title="implicit akka.actor.ActorSelection.toScala : (sel: akka.actor.ActorSelection)akka.actor.ScalaActorSelection" class="delimiter">(</a><span title="akka.actor.Address">a</span><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor;ScalaActorSelection.!" title="(msg: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverFromMe.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverFromMe.type">TakeOverFromMe</a>
          <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.setTimer" title="(name: String, msg: Any, timeout: scala.concurrent.duration.FiniteDuration, repeat: Boolean)Unit">setTimer</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverRetryTimer" title="=&gt; String">TakeOverRetryTimer</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverRetry.readResolve" title="(count: Int)akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverRetry">TakeOverRetry</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <a href="#akka.contrib.pattern;ClusterSingletonManager.retryInterval" title="scala.concurrent.duration.FiniteDuration">retryInterval</a>, repeat = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.goto" title="(nextStateName: akka.contrib.pattern.ClusterSingletonManager.State)ClusterSingletonManager.this.State">goto</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldest.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldest.type">WasOldest</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State.using" title="(nextStateDate: akka.contrib.pattern.ClusterSingletonManager.Data)akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">using</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldestData.readResolve" title="(singleton: akka.actor.ActorRef, singletonTerminated: Boolean, newOldestOption: Option[akka.actor.Address])akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldestData">WasOldestData</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">singleton</span>, <span title="Boolean">singletonTerminated</span>, newOldestOption = <span title="(x: akka.actor.Address)Some[akka.actor.Address]">Some</span><span class="delimiter">(</span><span title="akka.actor.Address">a</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="None.type">None</span> ⇒
          <span class="comment">// new oldest will initiate the hand-over</span>
          <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.setTimer" title="(name: String, msg: Any, timeout: scala.concurrent.duration.FiniteDuration, repeat: Boolean)Unit">setTimer</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverRetryTimer" title="=&gt; String">TakeOverRetryTimer</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverRetry.readResolve" title="(count: Int)akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverRetry">TakeOverRetry</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <a href="#akka.contrib.pattern;ClusterSingletonManager.retryInterval" title="scala.concurrent.duration.FiniteDuration">retryInterval</a>, repeat = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.goto" title="(nextStateName: akka.contrib.pattern.ClusterSingletonManager.State)ClusterSingletonManager.this.State">goto</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldest.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldest.type">WasOldest</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State.using" title="(nextStateDate: akka.contrib.pattern.ClusterSingletonManager.Data)akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">using</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldestData.readResolve" title="(singleton: akka.actor.ActorRef, singletonTerminated: Boolean, newOldestOption: Option[akka.actor.Address])akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldestData">WasOldestData</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">singleton</span>, <span title="Boolean">singletonTerminated</span>, newOldestOption = <span title="None.type">None</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="keyword">case</span> Event<span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.type">HandOverToMe</a>, OldestData<span class="delimiter">(</span><span title="akka.actor.ActorRef">singleton</span>, <span title="Boolean">singletonTerminated</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.gotoHandingOver" title="(singleton: akka.actor.ActorRef, singletonTerminated: Boolean, handOverTo: Option[akka.actor.ActorRef])ClusterSingletonManager.this.State">gotoHandingOver</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.actor.ActorRef">singleton</span>, <span title="Boolean">singletonTerminated</span>, <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">case</span> Event<span class="delimiter">(</span>Terminated<span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span>, <span title="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestData">d</span> @ OldestData<span class="delimiter">(</span><span title="akka.actor.ActorRef">singleton</span>, _<span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="akka.actor.ActorRef">ref</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="akka.actor.ActorRef">singleton</span> ⇒
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State.using" title="(nextStateDate: akka.contrib.pattern.ClusterSingletonManager.Data)akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">using</a> <span title="akka.contrib.pattern.ClusterSingletonManager.Internal.OldestData">d</span>.<a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;OldestData.singleton" title="akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.applyOrElse.x$9">copy</a><span class="delimiter">(</span>singletonTerminated = <a title="Boolean" id="akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.applyOrElse.x$8" class="keyword">true</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.when" title="(stateName: akka.contrib.pattern.ClusterSingletonManager.State, stateTimeout: scala.concurrent.duration.FiniteDuration)(stateFunction: ClusterSingletonManager.this.StateFunction)Unit">when</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldest.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldest.type">WasOldest</a><span class="delimiter">)</span> <span title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[ClusterSingletonManager.this.Event,ClusterSingletonManager.this.State] with Serializable" class="delimiter">{</span>
    <span class="keyword">case</span> Event<span class="delimiter">(</span>TakeOverRetry<span class="delimiter">(</span><span title="Int">count</span><span class="delimiter">)</span>, WasOldestData<span class="delimiter">(</span>_, _, <a title="Option[akka.actor.Address]" id="akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.isDefinedAt.newOldestOption">newOldestOption</a><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <span title="ClusterSingletonManager.this.State" class="keyword">if</span> <span class="delimiter">(</span><span title="Int">count</span> <span title="(x: Int)Boolean">&lt;=</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.maxTakeOverRetries" title="Int">maxTakeOverRetries</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Retry [{}], sending TakeOverFromMe to [{}]&quot;)" class="string">&quot;Retry [{}], sending TakeOverFromMe to [{}]&quot;</span>, <span title="Int">count</span>, <a href="#akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.isDefinedAt.newOldestOption" title="Option[akka.actor.Address]">newOldestOption</a><span class="delimiter">)</span>
        <a href="#akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.isDefinedAt.newOldestOption" title="Option[akka.actor.Address]">newOldestOption</a> <span title="(f: akka.actor.Address =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.peer" title="(at: akka.actor.Address)akka.actor.ActorSelection">peer</a><a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor.ActorSelection.toScala" title="implicit akka.actor.ActorSelection.toScala : (sel: akka.actor.ActorSelection)akka.actor.ScalaActorSelection" class="delimiter">(</a><a href="#akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.applyOrElse.$anonfun.x$4" title="akka.actor.Address">_</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor;ScalaActorSelection.!" title="(msg: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverFromMe.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverFromMe.type">TakeOverFromMe</a> <span class="delimiter">}</span>
        <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.setTimer" title="(name: String, msg: Any, timeout: scala.concurrent.duration.FiniteDuration, repeat: Boolean)Unit">setTimer</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverRetryTimer" title="=&gt; String">TakeOverRetryTimer</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverRetry.readResolve" title="(count: Int)akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverRetry">TakeOverRetry</a><span class="delimiter">(</span><span title="Int">count</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <a href="#akka.contrib.pattern;ClusterSingletonManager.retryInterval" title="scala.concurrent.duration.FiniteDuration">retryInterval</a>, repeat = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a>
      <span class="delimiter">}</span> <span class="keyword">else</span>
        <span title="Nothing" class="keyword">throw</span> <span title="akka.contrib.pattern.ClusterSingletonManagerIsStuck" class="keyword">new</span> <a href="#akka.contrib.pattern;ClusterSingletonManagerIsStuck" title="akka.contrib.pattern.ClusterSingletonManagerIsStuck">ClusterSingletonManagerIsStuck</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Expected hand-over to [&quot;)">Expected hand-over to [$</span><span class="delimiter">{</span><a href="#akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.isDefinedAt.newOldestOption" title="Option[akka.actor.Address]">newOldestOption</a><span class="delimiter">}</span><span title="String(&quot;] never occured&quot;)" class="string">] never occured&quot;</span><span class="delimiter">)</span>

    <span class="keyword">case</span> Event<span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.type">HandOverToMe</a>, WasOldestData<span class="delimiter">(</span><span title="akka.actor.ActorRef">singleton</span>, <span title="Boolean">singletonTerminated</span>, _<span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.gotoHandingOver" title="(singleton: akka.actor.ActorRef, singletonTerminated: Boolean, handOverTo: Option[akka.actor.ActorRef])ClusterSingletonManager.this.State">gotoHandingOver</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.actor.ActorRef">singleton</span>, <span title="Boolean">singletonTerminated</span>, <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">case</span> Event<span class="delimiter">(</span>MemberRemoved<span class="delimiter">(</span><span title="akka.cluster.Member">m</span>, _<span class="delimiter">)</span>, WasOldestData<span class="delimiter">(</span><span title="akka.actor.ActorRef">singleton</span>, <span title="Boolean">singletonTerminated</span>, Some<span class="delimiter">(</span><a title="akka.actor.Address" id="akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.isDefinedAt.newOldest">newOldest</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#akka.contrib.pattern;ClusterSingletonManager.selfExited_=" title="=&gt; Boolean">selfExited</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.isDefinedAt.newOldest" title="akka.actor.Address">newOldest</a> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.addRemoved" title="(address: akka.actor.Address)Unit">addRemoved</a><span class="delimiter">(</span><span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ClusterSingletonManager.gotoHandingOver" title="(singleton: akka.actor.ActorRef, singletonTerminated: Boolean, handOverTo: Option[akka.actor.ActorRef])ClusterSingletonManager.this.State">gotoHandingOver</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">singleton</span>, <span title="Boolean">singletonTerminated</span>, <span title="None.type">None</span><span class="delimiter">)</span>

    <span class="keyword">case</span> Event<span class="delimiter">(</span>Terminated<span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span>, <span title="akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldestData">d</span> @ WasOldestData<span class="delimiter">(</span><span title="akka.actor.ActorRef">singleton</span>, _, _<span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="akka.actor.ActorRef">ref</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="akka.actor.ActorRef">singleton</span> ⇒
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State.using" title="(nextStateDate: akka.contrib.pattern.ClusterSingletonManager.Data)akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">using</a> <span title="akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldestData">d</span>.<a href="#akka.contrib.pattern.ClusterSingletonManager.Internal;WasOldestData.singleton" title="akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.applyOrElse.x$12">copy</a><span class="delimiter">(</span>singletonTerminated = <a title="Boolean" id="akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.applyOrElse.x$10" class="keyword">true</a><span class="delimiter">)</span>

  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(singleton: akka.actor.ActorRef, singletonTerminated: Boolean, handOverTo: Option[akka.actor.ActorRef])ClusterSingletonManager.this.State" id="akka.contrib.pattern;ClusterSingletonManager.gotoHandingOver">gotoHandingOver</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.contrib.pattern;ClusterSingletonManager.gotoHandingOver.singleton">singleton</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Boolean" id="akka.contrib.pattern;ClusterSingletonManager.gotoHandingOver.singletonTerminated">singletonTerminated</a>: <span title="Boolean">Boolean</span>, <a title="Option[akka.actor.ActorRef]" id="akka.contrib.pattern;ClusterSingletonManager.gotoHandingOver.handOverTo">handOverTo</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State" title="ClusterSingletonManager.this.State">State</a> = <span class="delimiter">{</span>
    <span title="ClusterSingletonManager.this.State" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.gotoHandingOver.singletonTerminated" title="Boolean">singletonTerminated</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.contrib.pattern;ClusterSingletonManager.handOverDone" title="(handOverTo: Option[akka.actor.ActorRef])ClusterSingletonManager.this.State">handOverDone</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.gotoHandingOver.handOverTo" title="Option[akka.actor.ActorRef]">handOverTo</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#akka.contrib.pattern;ClusterSingletonManager.gotoHandingOver.handOverTo" title="Option[akka.actor.ActorRef]">handOverTo</a> <span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">_</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverInProgress.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverInProgress.type">HandOverInProgress</a> <span class="delimiter">}</span>
      <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">singleton</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern;ClusterSingletonManager.terminationMessage" title="Any">terminationMessage</a>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.goto" title="(nextStateName: akka.contrib.pattern.ClusterSingletonManager.State)ClusterSingletonManager.this.State">goto</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandingOver.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandingOver.type">HandingOver</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State.using" title="(nextStateDate: akka.contrib.pattern.ClusterSingletonManager.Data)akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">using</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandingOverData.readResolve" title="(singleton: akka.actor.ActorRef, handOverTo: Option[akka.actor.ActorRef])akka.contrib.pattern.ClusterSingletonManager.Internal.HandingOverData">HandingOverData</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.gotoHandingOver.singleton" title="akka.actor.ActorRef">singleton</a>, <a href="#akka.contrib.pattern;ClusterSingletonManager.gotoHandingOver.handOverTo" title="Option[akka.actor.ActorRef]">handOverTo</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.when" title="(stateName: akka.contrib.pattern.ClusterSingletonManager.State, stateTimeout: scala.concurrent.duration.FiniteDuration)(stateFunction: ClusterSingletonManager.this.StateFunction)Unit">when</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandingOver.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandingOver.type">HandingOver</a><span class="delimiter">)</span> <span title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[ClusterSingletonManager.this.Event,ClusterSingletonManager.this.State] with Serializable" class="delimiter">{</span>
    <span class="keyword">case</span> <span class="delimiter">(</span>Event<span class="delimiter">(</span>Terminated<span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span>, HandingOverData<span class="delimiter">(</span><span title="akka.actor.ActorRef">singleton</span>, <span title="Option[akka.actor.ActorRef]">handOverTo</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="akka.actor.ActorRef">ref</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="akka.actor.ActorRef">singleton</span> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.handOverDone" title="(handOverTo: Option[akka.actor.ActorRef])ClusterSingletonManager.this.State">handOverDone</a><span title="Boolean(true)" class="delimiter">(</span><span title="Option[akka.actor.ActorRef]">handOverTo</span><span class="delimiter">)</span>

    <span class="keyword">case</span> Event<span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverToMe.type">HandOverToMe</a>, <span title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandingOverData">d</span> @ HandingOverData<span class="delimiter">(</span><span title="akka.actor.ActorRef">singleton</span>, <span title="Option[akka.actor.ActorRef]">handOverTo</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="Option[akka.actor.ActorRef]">handOverTo</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <span class="comment">// retry</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverInProgress.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverInProgress.type">HandOverInProgress</a>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a>

  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(handOverTo: Option[akka.actor.ActorRef])ClusterSingletonManager.this.State" id="akka.contrib.pattern;ClusterSingletonManager.handOverDone">handOverDone</a><span class="delimiter">(</span><a title="Option[akka.actor.ActorRef]" id="akka.contrib.pattern;ClusterSingletonManager.handOverDone.handOverTo">handOverTo</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State" title="ClusterSingletonManager.this.State">State</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Option[akka.actor.Address]" id="akka.contrib.pattern;ClusterSingletonManager.handOverDone.newOldest">newOldest</a> = <a href="#akka.contrib.pattern;ClusterSingletonManager.handOverDone.handOverTo" title="Option[akka.actor.ActorRef]">handOverTo</a>.<span title="(f: akka.actor.ActorRef =&gt; akka.actor.Address)Option[akka.actor.Address]">map</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.handOverDone.newOldest.$anonfun.x$6" title="akka.actor.ActorRef">_</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Singleton terminated, hand-over done [{} -&gt; {}]&quot;)" class="string">&quot;Singleton terminated, hand-over done [{} -&gt; {}]&quot;</span>, <a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a>, <a href="#akka.contrib.pattern;ClusterSingletonManager.handOverDone.newOldest" title="Option[akka.actor.Address]">newOldest</a><span class="delimiter">)</span>
    <a href="#akka.contrib.pattern;ClusterSingletonManager.handOverDone.handOverTo" title="Option[akka.actor.ActorRef]">handOverTo</a> <span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">_</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverDone.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverDone.type">HandOverDone</a> <span class="delimiter">}</span>
    <span title="akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]" class="keyword">if</span> <span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.selfExited_=" title="=&gt; Boolean">selfExited</a> <span title="(x: Boolean)Boolean">||</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.removed_=" title="=&gt; scala.collection.immutable.Map[akka.actor.Address,scala.concurrent.duration.Deadline]">removed</a>.<span title="(key: akka.actor.Address)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.goto" title="(nextStateName: akka.contrib.pattern.ClusterSingletonManager.State)ClusterSingletonManager.this.State">goto</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.End.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.End.type">End</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State.using" title="(nextStateDate: akka.contrib.pattern.ClusterSingletonManager.Data)akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">using</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.EndData.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.EndData.type">EndData</a>
    <span class="keyword">else</span>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.goto" title="(nextStateName: akka.contrib.pattern.ClusterSingletonManager.State)ClusterSingletonManager.this.State">goto</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Younger.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Younger.type">Younger</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM;State.using" title="(nextStateDate: akka.contrib.pattern.ClusterSingletonManager.Data)akka.actor.FSM.State[akka.contrib.pattern.ClusterSingletonManager.State,akka.contrib.pattern.ClusterSingletonManager.Data]">using</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.YoungerData.readResolve" title="(oldestOption: Option[akka.actor.Address])akka.contrib.pattern.ClusterSingletonManager.Internal.YoungerData">YoungerData</a><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.handOverDone.newOldest" title="Option[akka.actor.Address]">newOldest</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.when" title="(stateName: akka.contrib.pattern.ClusterSingletonManager.State, stateTimeout: scala.concurrent.duration.FiniteDuration)(stateFunction: ClusterSingletonManager.this.StateFunction)Unit">when</a><span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.End.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.End.type">End</a><span class="delimiter">)</span> <span title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[ClusterSingletonManager.this.Event,ClusterSingletonManager.this.State] with Serializable" class="delimiter">{</span>
    <span class="keyword">case</span> Event<span class="delimiter">(</span>MemberRemoved<span class="delimiter">(</span><span title="akka.cluster.Member">m</span>, _<span class="delimiter">)</span>, _<span class="delimiter">)</span> <span class="keyword">if</span> <span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(cc2e600322)" title="(message: String)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Self removed, stopping ClusterSingletonManager&quot;)" class="string">&quot;Self removed, stopping ClusterSingletonManager&quot;</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stop(65b4a2ce7c)" title="()ClusterSingletonManager.this.State">stop</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.whenUnhandled" title="(stateFunction: ClusterSingletonManager.this.StateFunction)Unit">whenUnhandled</a> <span title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[ClusterSingletonManager.this.Event,ClusterSingletonManager.this.State] with Serializable" class="delimiter">{</span>
    <span class="keyword">case</span> Event<span class="delimiter">(</span>_: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState" title="akka.cluster.ClusterEvent.CurrentClusterState">CurrentClusterState</a>, _<span class="delimiter">)</span> ⇒ <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a>
    <span class="keyword">case</span> Event<span class="delimiter">(</span>MemberExited<span class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span>, _<span class="delimiter">)</span> ⇒
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.contrib.pattern;ClusterSingletonManager.selfExited_=" title="(x$1: Boolean)Unit">selfExited</a> = <span title="Boolean(true)" class="keyword">true</span>
        <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(dc73c33c91)" title="(template: String, arg1: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Exited [{}]&quot;)" class="string">&quot;Exited [{}]&quot;</span>, <span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a>
    <span class="keyword">case</span> Event<span class="delimiter">(</span>MemberRemoved<span class="delimiter">(</span><span title="akka.cluster.Member">m</span>, _<span class="delimiter">)</span>, _<span class="delimiter">)</span> ⇒
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.contrib.pattern;ClusterSingletonManager.selfExited_=" title="=&gt; Boolean">selfExited</a><span class="delimiter">)</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(dc73c33c91)" title="(template: String, arg1: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Member removed [{}]&quot;)" class="string">&quot;Member removed [{}]&quot;</span>, <span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>
      <a href="#akka.contrib.pattern;ClusterSingletonManager.addRemoved" title="(address: akka.actor.Address)Unit">addRemoved</a><span class="delimiter">(</span><span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a>
    <span class="keyword">case</span> Event<span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverFromMe.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverFromMe.type">TakeOverFromMe</a>, _<span class="delimiter">)</span> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Ignoring TakeOver request in [{}] from [{}].&quot;)" class="string">&quot;Ignoring TakeOver request in [{}] from [{}].&quot;</span>, <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stateName" title="=&gt; akka.contrib.pattern.ClusterSingletonManager.State">stateName</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a>
    <span class="keyword">case</span> Event<span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Cleanup.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Cleanup.type">Cleanup</a>, _<span class="delimiter">)</span> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.cleanupOverdueNotMemberAnyMore" title="()Unit">cleanupOverdueNotMemberAnyMore</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.stay" title="()ClusterSingletonManager.this.State">stay</a>
  <span class="delimiter">}</span>

  <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.onTransition" title="(transitionHandler: ClusterSingletonManager.this.TransitionHandler)Unit">onTransition</a> <span title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[(akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State),Unit] with Serializable" class="delimiter">{</span>
    <span class="keyword">case</span> <a title="akka.contrib.pattern.ClusterSingletonManager.State" id="akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.isDefinedAt.from">from</a> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM.->.unapply" title="(in: (akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State))Some[(akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State)]">-&gt;</a> <a title="akka.contrib.pattern.ClusterSingletonManager.State" id="akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.isDefinedAt.to">to</a> ⇒ <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">logInfo</a><span title="Boolean(true)" class="delimiter">(</span><span title="String(&quot;ClusterSingletonManager state change [{} -&gt; {}]&quot;)" class="string">&quot;ClusterSingletonManager state change [{} -&gt; {}]&quot;</span>, <a href="#akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.isDefinedAt.from" title="akka.contrib.pattern.ClusterSingletonManager.State">from</a>, <a href="#akka.contrib.pattern;ClusterSingletonManager.<local ClusterSingletonManager>;$anonfun.isDefinedAt.to" title="akka.contrib.pattern.ClusterSingletonManager.State">to</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.onTransition" title="(transitionHandler: ClusterSingletonManager.this.TransitionHandler)Unit">onTransition</a> <span title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[(akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State),Unit] with Serializable" class="delimiter">{</span>
    <span class="keyword">case</span> _ <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM.->.unapply" title="(in: (akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State))Some[(akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State)]">-&gt;</a> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldest.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldest.type">BecomingOldest</a> ⇒ <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.setTimer" title="(name: String, msg: Any, timeout: scala.concurrent.duration.FiniteDuration, repeat: Boolean)Unit">setTimer</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverRetryTimer" title="=&gt; String">HandOverRetryTimer</a>, <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverRetry.readResolve" title="(count: Int)akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverRetry">HandOverRetry</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <a href="#akka.contrib.pattern;ClusterSingletonManager.retryInterval" title="scala.concurrent.duration.FiniteDuration">retryInterval</a>, repeat = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.onTransition" title="(transitionHandler: ClusterSingletonManager.this.TransitionHandler)Unit">onTransition</a> <span title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[(akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State),Unit] with Serializable" class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldest.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.BecomingOldest.type">BecomingOldest</a> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM.->.unapply" title="(in: (akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State))Some[(akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State)]">-&gt;</a> _ ⇒ <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.cancelTimer" title="(name: String)Unit">cancelTimer</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.HandOverRetryTimer" title="=&gt; String">HandOverRetryTimer</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldest.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.WasOldest.type">WasOldest</a> <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM.->.unapply" title="(in: (akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State))Some[(akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State)]">-&gt;</a> _      ⇒ <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.cancelTimer" title="(name: String)Unit">cancelTimer</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.TakeOverRetryTimer" title="=&gt; String">TakeOverRetryTimer</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.onTransition" title="(transitionHandler: ClusterSingletonManager.this.TransitionHandler)Unit">onTransition</a> <span title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[(akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State),Unit] with Serializable" class="delimiter">{</span>
    <span class="keyword">case</span> _ <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM.->.unapply" title="(in: (akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State))Some[(akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State)]">-&gt;</a> <span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Younger.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Younger.type">Younger</a> | <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Oldest.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Oldest.type">Oldest</a><span class="delimiter">)</span> ⇒ <a href="#akka.contrib.pattern;ClusterSingletonManager.getNextOldestChanged" title="()Unit">getNextOldestChanged</a><span title="Boolean(true)" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor;FSM.onTransition" title="(transitionHandler: ClusterSingletonManager.this.TransitionHandler)Unit">onTransition</a> <span title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[(akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State),Unit] with Serializable" class="delimiter">{</span>
    <span class="keyword">case</span> _ <a href="../../../../actor/akka/actor/FSM.scala.html#akka.actor.FSM.->.unapply" title="(in: (akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State))Some[(akka.contrib.pattern.ClusterSingletonManager.State, akka.contrib.pattern.ClusterSingletonManager.State)]">-&gt;</a> <span class="delimiter">(</span><a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.Younger.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.Younger.type">Younger</a> | <a href="#akka.contrib.pattern.ClusterSingletonManager.Internal.End.readResolve" title="akka.contrib.pattern.ClusterSingletonManager.Internal.End.type">End</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#akka.contrib.pattern;ClusterSingletonManager.removed_=" title="=&gt; scala.collection.immutable.Map[akka.actor.Address,scala.concurrent.duration.Deadline]">removed</a>.<span title="(key: akka.actor.Address)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.contrib.pattern;ClusterSingletonManager.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a><span class="delimiter">)</span> ⇒
      <a href="#akka.contrib.pattern;ClusterSingletonManager.logInfo(cc2e600322)" title="(message: String)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Self removed, stopping ClusterSingletonManager&quot;)" class="string">&quot;Self removed, stopping ClusterSingletonManager&quot;</span><span class="delimiter">)</span>
      <span class="comment">// note that FSM.stop() can't be used in onTransition</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>
        </pre>
    </body>
</html>
