<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>cluster-metrics/akka/cluster/metrics/ClusterMetricsRouting.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
package akka.cluster.metrics

import java.util.Arrays
import java.util.concurrent.atomic.AtomicReference
import scala.annotation.tailrec
import scala.collection.immutable
import scala.concurrent.forkjoin.ThreadLocalRandom
import com.typesafe.config.Config
import akka.actor.Actor
import akka.actor.ActorSystem
import akka.actor.Address
import akka.actor.DynamicAccess
import akka.actor.NoSerializationVerificationNeeded
import akka.actor.Props
import akka.actor.SupervisorStrategy
import akka.cluster.Cluster
import akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.CurrentClusterState
import akka.dispatch.Dispatchers
import akka.japi.<a href="../../../../actor/akka/japi/JavaAPI.scala.html#akka.japi.Util" title="akka.japi.Util.type">Util</a>.immutableSeq
import akka.routing._
import akka.cluster.routing.ClusterRouterSettingsBase

<span class="comment">/**
 * Load balancing of messages to cluster nodes based on cluster metric data.
 *
 * It uses random selection of routees based on probabilities derived from
 * the remaining capacity of corresponding node.
 *
 * @param system the actor system hosting this router
 *
 * @param metricsSelector decides what probability to use for selecting a routee, based
 *   on remaining capacity as indicated by the node metrics
 */</span>
final case class <a title="class AdaptiveLoadBalancingRoutingLogic extends AnyRef with akka.routing.RoutingLogic with akka.actor.NoSerializationVerificationNeeded with Product with Serializable" id="akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic.readResolve">AdaptiveLoadBalancingRoutingLogic</a><span title="Product" class="delimiter">(</span><a title="akka.actor.ActorSystem" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.system">system</a>: <a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem" title="akka.actor.ActorSystem">ActorSystem</a>, <a title="akka.cluster.metrics.MetricsSelector" id="akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic.apply$default$2">metricsSelector</a>: <a href="#akka.cluster.metrics;MetricsSelector" title="akka.cluster.metrics.MetricsSelector">MetricsSelector</a> = <a href="#akka.cluster.metrics.MixMetricsSelector.readResolve" title="akka.cluster.metrics.MixMetricsSelector.type">MixMetricsSelector</a><span class="delimiter">)</span>
  extends <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing;RoutingLogic" title="akka.routing.RoutingLogic">RoutingLogic</a> with <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;NoSerializationVerificationNeeded" title="akka.actor.NoSerializationVerificationNeeded">NoSerializationVerificationNeeded</a> <span class="delimiter">{</span>

  private val <a title="akka.cluster.Cluster" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.cluster">cluster</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>

  <span class="comment">// The current weighted routees, if any. Weights are produced by the metricsSelector</span>
  <span class="comment">// via the metricsListener Actor. It's only updated by the actor, but accessed from</span>
  <span class="comment">// the threads of the sender()s.</span>
  private val <a title="java.util.concurrent.atomic.AtomicReference[(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])]" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.weightedRouteesRef">weightedRouteesRef</a> =
    new <span title="java.util.concurrent.atomic.AtomicReference[(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])]">AtomicReference</span><span class="delimiter">[</span><span class="delimiter">(</span>immutable.IndexedSeq<span class="delimiter">[</span>Routee<span class="delimiter">]</span>, Set<span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span>, Option<span class="delimiter">[</span>WeightedRoutees<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">(</span>
      <span title="(_1: scala.collection.immutable.Vector[Nothing], _2: scala.collection.immutable.Set[akka.cluster.metrics.NodeMetrics], _3: None.type)(scala.collection.immutable.Vector[Nothing], scala.collection.immutable.Set[akka.cluster.metrics.NodeMetrics], None.type)" class="delimiter">(</span><span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span>, <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.cluster.metrics.NodeMetrics]">empty</span>, <span title="None.type">None</span><span class="delimiter">)</span><span class="delimiter">)</span>

  @tailrec final def <a title="(event: akka.cluster.metrics.ClusterMetricsChanged)Unit" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged">metricsChanged</a><span class="delimiter">(</span><a title="akka.cluster.metrics.ClusterMetricsChanged" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged.event">event</a>: <a href="ClusterMetricsCollector.scala.html#akka.cluster.metrics;ClusterMetricsChanged" title="akka.cluster.metrics.ClusterMetricsChanged">ClusterMetricsChanged</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val <a title="(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged.oldValue">oldValue</a> = <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.weightedRouteesRef" title="=&gt; java.util.concurrent.atomic.AtomicReference[(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])]">weightedRouteesRef</a>.<span title="()(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])">get</span>
    val <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged.routees.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged.routees" class="delimiter">(</a><a title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged.routees.routees">routees</a>, _, _<span class="delimiter">)</span> = <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged.oldValue" title="(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])">oldValue</a>
    val <a title="Some[akka.cluster.metrics.WeightedRoutees]" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged.weightedRoutees">weightedRoutees</a> = <span title="(x: akka.cluster.metrics.WeightedRoutees)Some[akka.cluster.metrics.WeightedRoutees]">Some</span><span class="delimiter">(</span>new <a href="#akka.cluster.metrics;WeightedRoutees" title="akka.cluster.metrics.WeightedRoutees">WeightedRoutees</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a>, <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a>,
      <a href="#akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic.apply$default$2" title="=&gt; akka.cluster.metrics.MetricsSelector">metricsSelector</a>.<a href="#akka.cluster.metrics;MetricsSelector.weights" title="(nodeMetrics: Set[akka.cluster.metrics.NodeMetrics])Map[akka.actor.Address,Int]">weights</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged.event" title="akka.cluster.metrics.ClusterMetricsChanged">event</a>.<a href="ClusterMetricsCollector.scala.html#akka.cluster.metrics;ClusterMetricsChanged.nodeMetrics" title="=&gt; Set[akka.cluster.metrics.NodeMetrics]">nodeMetrics</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="comment">// retry when CAS failure</span>
    if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.weightedRouteesRef" title="=&gt; java.util.concurrent.atomic.AtomicReference[(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])]">weightedRouteesRef</a>.<span title="(x$1: (scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees]), x$2: (scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees]))Boolean">compareAndSet</span><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged.oldValue" title="(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])">oldValue</a>, <span title="(_1: scala.collection.immutable.IndexedSeq[akka.routing.Routee], _2: Set[akka.cluster.metrics.NodeMetrics], _3: Some[akka.cluster.metrics.WeightedRoutees])(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Some[akka.cluster.metrics.WeightedRoutees])" class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a>, <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged.event" title="akka.cluster.metrics.ClusterMetricsChanged">event</a>.<a href="ClusterMetricsCollector.scala.html#akka.cluster.metrics;ClusterMetricsChanged.nodeMetrics" title="=&gt; Set[akka.cluster.metrics.NodeMetrics]">nodeMetrics</a>, <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged.weightedRoutees" title="Some[akka.cluster.metrics.WeightedRoutees]">weightedRoutees</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged" title="(event: akka.cluster.metrics.ClusterMetricsChanged)Unit">metricsChanged</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged.event" title="akka.cluster.metrics.ClusterMetricsChanged">event</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  override def <a title="(message: Any, routees: scala.collection.immutable.IndexedSeq[akka.routing.Routee])akka.routing.Routee" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select">select</a><span class="delimiter">(</span><a title="Any" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.message">message</a>: <span title="Any">Any</span>, <a title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.routees">routees</a>: immutable.<span title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">IndexedSeq</span><span class="delimiter">[</span>Routee<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing;Routee" title="akka.routing.Routee">Routee</a> =
    if <span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing.NoRoutee" title="akka.routing.NoRoutee.type">NoRoutee</a>
    else <span class="delimiter">{</span>

      def <a title="()Option[akka.cluster.metrics.WeightedRoutees]" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees">updateWeightedRoutees</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Option[akka.cluster.metrics.WeightedRoutees]">Option</span><span class="delimiter">[</span>WeightedRoutees<span class="delimiter">]</span> = <span class="delimiter">{</span>
        val <a title="(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldValue">oldValue</a> = <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.weightedRouteesRef" title="=&gt; java.util.concurrent.atomic.AtomicReference[(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])]">weightedRouteesRef</a>.<span title="()(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])">get</span>
        val <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldRoutees" title="(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])" class="delimiter">(</a><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.x$1" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldRoutees">oldRoutees</a>, <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.x$1" title="Set[akka.cluster.metrics.NodeMetrics]" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldMetrics">oldMetrics</a>, <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.x$1" title="Option[akka.cluster.metrics.WeightedRoutees]" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldWeightedRoutees">oldWeightedRoutees</a><span class="delimiter">)</span> = <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldValue" title="(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])">oldValue</a>

        if <span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldRoutees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">oldRoutees</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          val <a title="Some[akka.cluster.metrics.WeightedRoutees]" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.weightedRoutees">weightedRoutees</a> = <span title="(x: akka.cluster.metrics.WeightedRoutees)Some[akka.cluster.metrics.WeightedRoutees]">Some</span><span class="delimiter">(</span>new <a href="#akka.cluster.metrics;WeightedRoutees" title="akka.cluster.metrics.WeightedRoutees">WeightedRoutees</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a>, <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a>,
            <a href="#akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic.apply$default$2" title="=&gt; akka.cluster.metrics.MetricsSelector">metricsSelector</a>.<a href="#akka.cluster.metrics;MetricsSelector.weights" title="(nodeMetrics: Set[akka.cluster.metrics.NodeMetrics])Map[akka.actor.Address,Int]">weights</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldMetrics" title="Set[akka.cluster.metrics.NodeMetrics]">oldMetrics</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="comment">// ignore, don't update, in case of CAS failure</span>
          <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.weightedRouteesRef" title="=&gt; java.util.concurrent.atomic.AtomicReference[(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])]">weightedRouteesRef</a>.<span title="(x$1: (scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees]), x$2: (scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees]))Boolean">compareAndSet</span><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldValue" title="(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Option[akka.cluster.metrics.WeightedRoutees])">oldValue</a>, <span title="(_1: scala.collection.immutable.IndexedSeq[akka.routing.Routee], _2: Set[akka.cluster.metrics.NodeMetrics], _3: Some[akka.cluster.metrics.WeightedRoutees])(scala.collection.immutable.IndexedSeq[akka.routing.Routee], Set[akka.cluster.metrics.NodeMetrics], Some[akka.cluster.metrics.WeightedRoutees])" class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a>, <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldMetrics" title="Set[akka.cluster.metrics.NodeMetrics]">oldMetrics</a>, <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.weightedRoutees" title="Some[akka.cluster.metrics.WeightedRoutees]">weightedRoutees</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.weightedRoutees" title="Some[akka.cluster.metrics.WeightedRoutees]">weightedRoutees</a>
        <span class="delimiter">}</span> else <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees.oldWeightedRoutees" title="Option[akka.cluster.metrics.WeightedRoutees]">oldWeightedRoutees</a>
      <span class="delimiter">}</span>

      <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.updateWeightedRoutees" title="()Option[akka.cluster.metrics.WeightedRoutees]">updateWeightedRoutees</a><span class="delimiter">(</span><span class="delimiter">)</span> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><a title="akka.cluster.metrics.WeightedRoutees" id="akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.weighted">weighted</a><span class="delimiter">)</span> ⇒
          if <span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.weighted" title="akka.cluster.metrics.WeightedRoutees">weighted</a>.<a href="#akka.cluster.metrics;WeightedRoutees.isEmpty" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing.NoRoutee" title="akka.routing.NoRoutee.type">NoRoutee</a>
          else <a href="#akka.cluster.metrics;WeightedRoutees.apply" title="(value: Int)akka.routing.Routee">weighted</a><span class="delimiter">(</span><span title="scala.concurrent.forkjoin.ThreadLocalRandom.type">ThreadLocalRandom</span>.<span title="()scala.concurrent.forkjoin.ThreadLocalRandom">current</span>.<span title="(x$1: Int)Int">nextInt</span><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.weighted" title="akka.cluster.metrics.WeightedRoutees">weighted</a>.<a href="#akka.cluster.metrics;WeightedRoutees.total" title="=&gt; Int">total</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        case <span title="None.type">None</span> ⇒
          <a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.routees" title="(idx: Int)akka.routing.Routee">routees</a><span class="delimiter">(</span><span title="scala.concurrent.forkjoin.ThreadLocalRandom.type">ThreadLocalRandom</span>.<span title="()scala.concurrent.forkjoin.ThreadLocalRandom">current</span>.<span title="(x$1: Int)Int">nextInt</span><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.select.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * A router pool that performs load balancing of messages to cluster nodes based on
 * cluster metric data.
 *
 * It uses random selection of routees based on probabilities derived from
 * the remaining capacity of corresponding node.
 *
 * The configuration parameter trumps the constructor arguments. This means that
 * if you provide `nrOfInstances` during instantiation they will be ignored if
 * the router is defined in the configuration file for the actor being used.
 *
 * &lt;h1&gt;Supervision Setup&lt;/h1&gt;
 *
 * Any routees that are created by a router will be created as the router's children.
 * The router is therefore also the children's supervisor.
 *
 * The supervision strategy of the router actor can be configured with
 * [[#withSupervisorStrategy]]. If no strategy is provided, routers default to
 * a strategy of “always escalate”. This means that errors are passed up to the
 * router's supervisor for handling.
 *
 * The router's supervisor will treat the error as an error with the router itself.
 * Therefore a directive to stop or restart will cause the router itself to stop or
 * restart. The router, in turn, will cause its children to stop and restart.
 *
 * @param metricsSelector decides what probability to use for selecting a routee, based
 *   on remaining capacity as indicated by the node metrics
 *
 * @param nrOfInstances initial number of routees in the pool
 *
 * @param supervisorStrategy strategy for supervising the routees, see 'Supervision Setup'
 *
 * @param routerDispatcher dispatcher to use for the router head actor, which handles
 *   supervision, death watch and router management messages
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
final case class <a title="class AdaptiveLoadBalancingPool extends AnyRef with akka.routing.Pool with Product with Serializable" id="akka.cluster.metrics.AdaptiveLoadBalancingPool.readResolve">AdaptiveLoadBalancingPool</a><span title="Product" class="delimiter">(</span>
  <a title="akka.cluster.metrics.MetricsSelector" id="akka.cluster.metrics.AdaptiveLoadBalancingPool.apply$default$1">metricsSelector</a>: <a href="#akka.cluster.metrics;MetricsSelector" title="akka.cluster.metrics.MetricsSelector">MetricsSelector</a> = <a href="#akka.cluster.metrics.MixMetricsSelector.readResolve" title="akka.cluster.metrics.MixMetricsSelector.type">MixMetricsSelector</a>,
  override val <a title="Int" id="akka.cluster.metrics.AdaptiveLoadBalancingPool.apply$default$2">nrOfInstances</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>,
  override val <a title="akka.actor.SupervisorStrategy" id="akka.cluster.metrics.AdaptiveLoadBalancingPool.apply$default$3">supervisorStrategy</a>: <a href="../../../../actor/akka/actor/FaultHandling.scala.html#akka.actor;SupervisorStrategy" title="akka.actor.SupervisorStrategy">SupervisorStrategy</a> = <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing.Pool" title="akka.routing.Pool.type">Pool</a>.<a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing.Pool.defaultSupervisorStrategy" title="=&gt; akka.actor.SupervisorStrategy">defaultSupervisorStrategy</a>,
  override val <a title="String" id="akka.cluster.metrics.AdaptiveLoadBalancingPool.apply$default$4">routerDispatcher</a>: <span title="String">String</span> = Dispatchers.<span title="String(&quot;akka.actor.default-dispatcher&quot;)">DefaultDispatcherId</span>,
  override val <a title="Boolean" id="akka.cluster.metrics.AdaptiveLoadBalancingPool.apply$default$5">usePoolDispatcher</a>: <span title="Boolean">Boolean</span> = false<span class="delimiter">)</span>
  extends <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;Pool" title="akka.routing.Pool">Pool</a> <span class="delimiter">{</span>

  def this<span class="delimiter">(</span><a title="com.typesafe.config.Config" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.<init>(a672f8f231).config">config</a>: <span title="com.typesafe.config.Config">Config</span>, <a title="akka.actor.DynamicAccess" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.<init>(a672f8f231).dynamicAccess">dynamicAccess</a>: <a href="../../../../actor/akka/actor/DynamicAccess.scala.html#akka.actor;DynamicAccess" title="akka.actor.DynamicAccess">DynamicAccess</a><span class="delimiter">)</span> =
    this<span class="delimiter">(</span>nrOfInstances = <a href="../../../../cluster/akka/cluster/routing/ClusterRouterConfig.scala.html#akka.cluster.routing.ClusterRouterSettingsBase" title="akka.cluster.routing.ClusterRouterSettingsBase.type">ClusterRouterSettingsBase</a>.<a href="../../../../cluster/akka/cluster/routing/ClusterRouterConfig.scala.html#akka.cluster.routing.ClusterRouterSettingsBase.getMaxTotalNrOfInstances" title="(config: com.typesafe.config.Config)Int">getMaxTotalNrOfInstances</a><a title="Int" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.<init>(a672f8f231).x$4" class="delimiter">(</a><a href="#akka.cluster.metrics;AdaptiveLoadBalancingPool.<init>(a672f8f231).config" title="com.typesafe.config.Config">config</a><span class="delimiter">)</span>,
      metricsSelector = <a href="#akka.cluster.metrics.MetricsSelector.readResolve" title="akka.cluster.metrics.MetricsSelector.type">MetricsSelector</a>.<a href="#akka.cluster.metrics.MetricsSelector.fromConfig" title="(config: com.typesafe.config.Config, dynamicAccess: akka.actor.DynamicAccess)akka.cluster.metrics.MetricsSelector">fromConfig</a><a title="akka.cluster.metrics.MetricsSelector" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.<init>(a672f8f231).x$5" class="delimiter">(</a><a href="#akka.cluster.metrics;AdaptiveLoadBalancingPool.<init>(a672f8f231).config" title="com.typesafe.config.Config">config</a>, <a href="#akka.cluster.metrics;AdaptiveLoadBalancingPool.<init>(a672f8f231).dynamicAccess" title="akka.actor.DynamicAccess">dynamicAccess</a><span class="delimiter">)</span>,
      usePoolDispatcher = <a href="#akka.cluster.metrics;AdaptiveLoadBalancingPool.<init>(a672f8f231).config" title="com.typesafe.config.Config">config</a>.<span title="(x$1: String)Boolean">hasPath</span><a title="Boolean" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.<init>(a672f8f231).x$6" class="delimiter">(</a><span title="String(&quot;pool-dispatcher&quot;)" class="string">&quot;pool-dispatcher&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API
   * @param metricsSelector decides what probability to use for selecting a routee, based
   *   on remaining capacity as indicated by the node metrics
   * @param nr initial number of routees in the pool
   */</span>
  def this<span class="delimiter">(</span><a title="akka.cluster.metrics.MetricsSelector" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.<init>(195755651e).metricsSelector">metricsSelector</a>: <a href="#akka.cluster.metrics;MetricsSelector" title="akka.cluster.metrics.MetricsSelector">MetricsSelector</a>, <a title="Int" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.<init>(195755651e).nr">nr</a>: <span title="Int">Int</span><span class="delimiter">)</span> = this<span class="delimiter">(</span>nrOfInstances = <a href="#akka.cluster.metrics;AdaptiveLoadBalancingPool.<init>(195755651e).nr" title="Int" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.<init>(195755651e).x$9">nr</a><span class="delimiter">)</span>

  override def <a title="=&gt; Option[akka.routing.Resizer]" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.resizer">resizer</a>: <span title="Option[akka.routing.Resizer]">Option</span><span class="delimiter">[</span>Resizer<span class="delimiter">]</span> = <span title="None.type">None</span>

  override def <a title="(sys: akka.actor.ActorSystem)Int" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.nrOfInstances(390f5afb1b)">nrOfInstances</a><span class="delimiter">(</span><a title="akka.actor.ActorSystem" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.nrOfInstances(390f5afb1b).sys">sys</a>: <a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem" title="akka.actor.ActorSystem">ActorSystem</a><span class="delimiter">)</span> = this.<a href="#akka.cluster.metrics.AdaptiveLoadBalancingPool.apply$default$2" title="=&gt; Int">nrOfInstances</a>

  override def <a title="(system: akka.actor.ActorSystem)akka.routing.Router" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.createRouter">createRouter</a><span class="delimiter">(</span><a title="akka.actor.ActorSystem" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.createRouter.system">system</a>: <a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem" title="akka.actor.ActorSystem">ActorSystem</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing;Router" title="akka.routing.Router">Router</a> =
    new <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing;Router" title="akka.routing.Router">Router</a><span class="delimiter">(</span><a href="#akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic.readResolve" title="(system: akka.actor.ActorSystem, metricsSelector: akka.cluster.metrics.MetricsSelector)akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic">AdaptiveLoadBalancingRoutingLogic</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingPool.createRouter.system" title="akka.actor.ActorSystem">system</a>, <a href="#akka.cluster.metrics.AdaptiveLoadBalancingPool.apply$default$1" title="=&gt; akka.cluster.metrics.MetricsSelector">metricsSelector</a><span class="delimiter">)</span><span class="delimiter">)</span>

  override def <a title="(routingLogic: akka.routing.RoutingLogic)Option[akka.actor.Props]" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.routingLogicController">routingLogicController</a><span class="delimiter">(</span><a title="akka.routing.RoutingLogic" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.routingLogicController.routingLogic">routingLogic</a>: <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing;RoutingLogic" title="akka.routing.RoutingLogic">RoutingLogic</a><span class="delimiter">)</span>: <span title="Option[akka.actor.Props]">Option</span><span class="delimiter">[</span>Props<span class="delimiter">]</span> =
    <span title="(x: akka.actor.Props)Some[akka.actor.Props]">Some</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.cluster.metrics.AdaptiveLoadBalancingMetricsListener](classOf[akka.cluster.metrics.AdaptiveLoadBalancingMetricsListener])" class="delimiter">[</span>AdaptiveLoadBalancingMetricsListener<span class="delimiter">]</span>,
      <a href="#akka.cluster.metrics;AdaptiveLoadBalancingPool.routingLogicController.routingLogic" title="akka.routing.RoutingLogic">routingLogic</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic" class="delimiter">[</span><a href="#akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic.readResolve" title="akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic">AdaptiveLoadBalancingRoutingLogic</a><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Setting the supervisor strategy to be used for the “head” Router actor.
   */</span>
  def <a title="(strategy: akka.actor.SupervisorStrategy)akka.cluster.metrics.AdaptiveLoadBalancingPool" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.withSupervisorStrategy">withSupervisorStrategy</a><span class="delimiter">(</span><a title="akka.actor.SupervisorStrategy" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.withSupervisorStrategy.strategy">strategy</a>: <a href="../../../../actor/akka/actor/FaultHandling.scala.html#akka.actor;SupervisorStrategy" title="akka.actor.SupervisorStrategy">SupervisorStrategy</a><span class="delimiter">)</span>: <a href="#akka.cluster.metrics.AdaptiveLoadBalancingPool.readResolve" title="akka.cluster.metrics.AdaptiveLoadBalancingPool">AdaptiveLoadBalancingPool</a> = <a href="#akka.cluster.metrics.AdaptiveLoadBalancingPool.apply$default$1" title="akka.cluster.metrics.MetricsSelector" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.withSupervisorStrategy.x$18">copy</a><span class="delimiter">(</span>supervisorStrategy = <a href="#akka.cluster.metrics;AdaptiveLoadBalancingPool.withSupervisorStrategy.strategy" title="akka.actor.SupervisorStrategy" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.withSupervisorStrategy.x$14">strategy</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Setting the dispatcher to be used for the router head actor,  which handles
   * supervision, death watch and router management messages.
   */</span>
  def <a title="(dispatcherId: String)akka.cluster.metrics.AdaptiveLoadBalancingPool" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.withDispatcher">withDispatcher</a><span class="delimiter">(</span><a title="String" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.withDispatcher.dispatcherId">dispatcherId</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#akka.cluster.metrics.AdaptiveLoadBalancingPool.readResolve" title="akka.cluster.metrics.AdaptiveLoadBalancingPool">AdaptiveLoadBalancingPool</a> = <a href="#akka.cluster.metrics.AdaptiveLoadBalancingPool.apply$default$1" title="akka.cluster.metrics.MetricsSelector" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.withDispatcher.x$23">copy</a><span class="delimiter">(</span>routerDispatcher = <a href="#akka.cluster.metrics;AdaptiveLoadBalancingPool.withDispatcher.dispatcherId" title="String" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.withDispatcher.x$19">dispatcherId</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Uses the supervisor strategy of the given RouterConfig
   * if this RouterConfig doesn't have one
   */</span>
  override def <a title="(other: akka.routing.RouterConfig)akka.routing.RouterConfig" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.withFallback">withFallback</a><span class="delimiter">(</span><a title="akka.routing.RouterConfig" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.withFallback.other">other</a>: <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;RouterConfig" title="akka.routing.RouterConfig">RouterConfig</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;RouterConfig" title="akka.routing.RouterConfig">RouterConfig</a> =
    if <span class="delimiter">(</span>this.<a href="#akka.cluster.metrics.AdaptiveLoadBalancingPool.apply$default$3" title="=&gt; akka.actor.SupervisorStrategy">supervisorStrategy</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing.Pool" title="akka.routing.Pool.type">Pool</a>.<a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing.Pool.defaultSupervisorStrategy" title="=&gt; akka.actor.SupervisorStrategy">defaultSupervisorStrategy</a><span class="delimiter">)</span> this
    else <a href="#akka.cluster.metrics;AdaptiveLoadBalancingPool.withFallback.other" title="akka.routing.RouterConfig">other</a> match <span class="delimiter">{</span>
      case _: <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;FromConfig" title="akka.routing.FromConfig">FromConfig</a> | _: <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;NoRouter" title="akka.routing.NoRouter">NoRouter</a> ⇒ this <span class="comment">// NoRouter is the default, hence “neutral”</span>
      case <a title="akka.cluster.metrics.AdaptiveLoadBalancingPool" id="akka.cluster.metrics;AdaptiveLoadBalancingPool.withFallback.otherRouter">otherRouter</a>: <a href="#akka.cluster.metrics.AdaptiveLoadBalancingPool.readResolve" title="akka.cluster.metrics.AdaptiveLoadBalancingPool">AdaptiveLoadBalancingPool</a> ⇒
        if <span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingPool.withFallback.otherRouter" title="akka.cluster.metrics.AdaptiveLoadBalancingPool">otherRouter</a>.<a href="#akka.cluster.metrics.AdaptiveLoadBalancingPool.apply$default$3" title="=&gt; akka.actor.SupervisorStrategy">supervisorStrategy</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing.Pool" title="akka.routing.Pool.type">Pool</a>.<a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing.Pool.defaultSupervisorStrategy" title="=&gt; akka.actor.SupervisorStrategy">defaultSupervisorStrategy</a><span class="delimiter">)</span> this
        else this.<a href="#akka.cluster.metrics;AdaptiveLoadBalancingPool.withSupervisorStrategy" title="(strategy: akka.actor.SupervisorStrategy)akka.cluster.metrics.AdaptiveLoadBalancingPool">withSupervisorStrategy</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingPool.withFallback.otherRouter" title="akka.cluster.metrics.AdaptiveLoadBalancingPool">otherRouter</a>.<a href="#akka.cluster.metrics.AdaptiveLoadBalancingPool.apply$default$3" title="=&gt; akka.actor.SupervisorStrategy">supervisorStrategy</a><span class="delimiter">)</span>
      case _ ⇒ throw new <span title="IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Expected AdaptiveLoadBalancingPool, got [%s]&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingPool.withFallback.other" title="akka.routing.RouterConfig">other</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * A router group that performs load balancing of messages to cluster nodes based on
 * cluster metric data.
 *
 * It uses random selection of routees based on probabilities derived from
 * the remaining capacity of corresponding node.
 *
 * The configuration parameter trumps the constructor arguments. This means that
 * if you provide `paths` during instantiation they will be ignored if
 * the router is defined in the configuration file for the actor being used.
 *
 * @param metricsSelector decides what probability to use for selecting a routee, based
 *   on remaining capacity as indicated by the node metrics
 *
 * @param paths string representation of the actor paths of the routees, messages are
 *   sent with [[akka.actor.ActorSelection]] to these paths
 *
 * @param routerDispatcher dispatcher to use for the router head actor, which handles
 *   router management messages
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
final case class <a title="class AdaptiveLoadBalancingGroup extends AnyRef with akka.routing.Group with Product with Serializable" id="akka.cluster.metrics.AdaptiveLoadBalancingGroup.readResolve">AdaptiveLoadBalancingGroup</a><span title="Product" class="delimiter">(</span>
  <a title="akka.cluster.metrics.MetricsSelector" id="akka.cluster.metrics.AdaptiveLoadBalancingGroup.apply$default$1">metricsSelector</a>: <a href="#akka.cluster.metrics;MetricsSelector" title="akka.cluster.metrics.MetricsSelector">MetricsSelector</a> = <a href="#akka.cluster.metrics.MixMetricsSelector.readResolve" title="akka.cluster.metrics.MixMetricsSelector.type">MixMetricsSelector</a>,
  override val <a title="scala.collection.immutable.Iterable[String]" id="akka.cluster.metrics.AdaptiveLoadBalancingGroup.apply$default$2">paths</a>: immutable.<span title="scala.collection.immutable.Iterable[String]">Iterable</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span title="scala.collection.immutable.Nil.type">Nil</span>,
  override val <a title="String" id="akka.cluster.metrics.AdaptiveLoadBalancingGroup.apply$default$3">routerDispatcher</a>: <span title="String">String</span> = Dispatchers.<span title="String(&quot;akka.actor.default-dispatcher&quot;)">DefaultDispatcherId</span><span class="delimiter">)</span>
  extends <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;Group" title="akka.routing.Group">Group</a> <span class="delimiter">{</span>

  def this<span class="delimiter">(</span><a title="com.typesafe.config.Config" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.<init>(e2e5c90d77).config">config</a>: <span title="com.typesafe.config.Config">Config</span>, <a title="akka.actor.DynamicAccess" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.<init>(e2e5c90d77).dynamicAccess">dynamicAccess</a>: <a href="../../../../actor/akka/actor/DynamicAccess.scala.html#akka.actor;DynamicAccess" title="akka.actor.DynamicAccess">DynamicAccess</a><span class="delimiter">)</span> =
    this<span class="delimiter">(</span>metricsSelector = <a href="#akka.cluster.metrics.MetricsSelector.readResolve" title="akka.cluster.metrics.MetricsSelector.type">MetricsSelector</a>.<a href="#akka.cluster.metrics.MetricsSelector.fromConfig" title="(config: com.typesafe.config.Config, dynamicAccess: akka.actor.DynamicAccess)akka.cluster.metrics.MetricsSelector">fromConfig</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingGroup.<init>(e2e5c90d77).config" title="com.typesafe.config.Config">config</a>, <a href="#akka.cluster.metrics;AdaptiveLoadBalancingGroup.<init>(e2e5c90d77).dynamicAccess" title="akka.actor.DynamicAccess">dynamicAccess</a><span class="delimiter">)</span>,
      paths = <a href="../../../../actor/akka/japi/JavaAPI.scala.html#akka.japi.Util.immutableSeq(42d3e3f9ec)" title="(iterable: Iterable[String])scala.collection.immutable.Seq[String]">immutableSeq</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingGroup.<init>(e2e5c90d77).config" title="com.typesafe.config.Config">config</a>.<span title="(x$1: String)java.util.List[String]">getStringList</span><span class="delimiter">(</span><span title="String(&quot;routees.paths&quot;)" class="string">&quot;routees.paths&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API
   * @param metricsSelector decides what probability to use for selecting a routee, based
   *   on remaining capacity as indicated by the node metrics
   * @param routeesPaths string representation of the actor paths of the routees, messages are
   *   sent with [[akka.actor.ActorSelection]] to these paths
   */</span>
  def this<span class="delimiter">(</span><a title="akka.cluster.metrics.MetricsSelector" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.<init>(dc1866c1c0).metricsSelector">metricsSelector</a>: <a href="#akka.cluster.metrics;MetricsSelector" title="akka.cluster.metrics.MetricsSelector">MetricsSelector</a>,
           <a title="Iterable[String]" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.<init>(dc1866c1c0).routeesPaths">routeesPaths</a>: java.lang.<span title="Iterable[String]">Iterable</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> = this<span class="delimiter">(</span>paths = <a href="../../../../actor/akka/japi/JavaAPI.scala.html#akka.japi.Util.immutableSeq(42d3e3f9ec)" title="(iterable: Iterable[String])scala.collection.immutable.Seq[String]">immutableSeq</a><a title="scala.collection.immutable.Seq[String] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.<init>(dc1866c1c0).x$24" class="delimiter">(</a><a href="#akka.cluster.metrics;AdaptiveLoadBalancingGroup.<init>(dc1866c1c0).routeesPaths" title="Iterable[String]">routeesPaths</a><span class="delimiter">)</span><span class="delimiter">)</span>

  override def <a title="(system: akka.actor.ActorSystem)scala.collection.immutable.Iterable[String]" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.paths(fec8ccead8)">paths</a><span class="delimiter">(</span><a title="akka.actor.ActorSystem" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.paths(fec8ccead8).system">system</a>: <a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem" title="akka.actor.ActorSystem">ActorSystem</a><span class="delimiter">)</span>: immutable.<span title="scala.collection.immutable.Iterable[String]">Iterable</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = this.<a href="#akka.cluster.metrics.AdaptiveLoadBalancingGroup.apply$default$2" title="=&gt; scala.collection.immutable.Iterable[String]">paths</a>

  override def <a title="(system: akka.actor.ActorSystem)akka.routing.Router" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.createRouter">createRouter</a><span class="delimiter">(</span><a title="akka.actor.ActorSystem" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.createRouter.system">system</a>: <a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem" title="akka.actor.ActorSystem">ActorSystem</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing;Router" title="akka.routing.Router">Router</a> =
    new <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing;Router" title="akka.routing.Router">Router</a><span class="delimiter">(</span><a href="#akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic.readResolve" title="(system: akka.actor.ActorSystem, metricsSelector: akka.cluster.metrics.MetricsSelector)akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic">AdaptiveLoadBalancingRoutingLogic</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingGroup.createRouter.system" title="akka.actor.ActorSystem">system</a>, <a href="#akka.cluster.metrics.AdaptiveLoadBalancingGroup.apply$default$1" title="=&gt; akka.cluster.metrics.MetricsSelector">metricsSelector</a><span class="delimiter">)</span><span class="delimiter">)</span>

  override def <a title="(routingLogic: akka.routing.RoutingLogic)Option[akka.actor.Props]" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.routingLogicController">routingLogicController</a><span class="delimiter">(</span><a title="akka.routing.RoutingLogic" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.routingLogicController.routingLogic">routingLogic</a>: <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing;RoutingLogic" title="akka.routing.RoutingLogic">RoutingLogic</a><span class="delimiter">)</span>: <span title="Option[akka.actor.Props]">Option</span><span class="delimiter">[</span>Props<span class="delimiter">]</span> =
    <span title="(x: akka.actor.Props)Some[akka.actor.Props]">Some</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.cluster.metrics.AdaptiveLoadBalancingMetricsListener](classOf[akka.cluster.metrics.AdaptiveLoadBalancingMetricsListener])" class="delimiter">[</span>AdaptiveLoadBalancingMetricsListener<span class="delimiter">]</span>,
      <a href="#akka.cluster.metrics;AdaptiveLoadBalancingGroup.routingLogicController.routingLogic" title="akka.routing.RoutingLogic">routingLogic</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic" class="delimiter">[</span><a href="#akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic.readResolve" title="akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic">AdaptiveLoadBalancingRoutingLogic</a><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Setting the dispatcher to be used for the router head actor, which handles
   * router management messages
   */</span>
  def <a title="(dispatcherId: String)akka.cluster.metrics.AdaptiveLoadBalancingGroup" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.withDispatcher">withDispatcher</a><span class="delimiter">(</span><a title="String" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.withDispatcher.dispatcherId">dispatcherId</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#akka.cluster.metrics.AdaptiveLoadBalancingGroup.readResolve" title="akka.cluster.metrics.AdaptiveLoadBalancingGroup">AdaptiveLoadBalancingGroup</a> = <a href="#akka.cluster.metrics.AdaptiveLoadBalancingGroup.apply$default$1" title="akka.cluster.metrics.MetricsSelector" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.withDispatcher.x$29">copy</a><span class="delimiter">(</span>routerDispatcher = <a href="#akka.cluster.metrics;AdaptiveLoadBalancingGroup.withDispatcher.dispatcherId" title="String" id="akka.cluster.metrics;AdaptiveLoadBalancingGroup.withDispatcher.x$27">dispatcherId</a><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * MetricsSelector that uses the heap metrics.
 * Low heap capacity =&gt; small weight.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
case object <a href="#akka.cluster.metrics.HeapMetricsSelector.productElement.x$1" title="akka.cluster.metrics.HeapMetricsSelector.type" id="akka.cluster.metrics.HeapMetricsSelector.readResolve">HeapMetricsSelector</a> extends <a href="#akka.cluster.metrics;CapacityMetricsSelector" title="akka.cluster.metrics.CapacityMetricsSelector">CapacityMetricsSelector</a> <span class="delimiter">{</span>
  import akka.cluster.metrics.<a href="Metric.scala.html#akka.cluster.metrics.StandardMetrics" title="akka.cluster.metrics.StandardMetrics.type">StandardMetrics</a>.HeapMemory
  <span class="comment">/**
   * Java API: get the singleton instance
   */</span>
  def <a title="=&gt; akka.cluster.metrics.HeapMetricsSelector.type" id="akka.cluster.metrics.HeapMetricsSelector.getInstance">getInstance</a> = this

  override def <a title="(nodeMetrics: Set[akka.cluster.metrics.NodeMetrics])Map[akka.actor.Address,Double]" id="akka.cluster.metrics.HeapMetricsSelector.capacity">capacity</a><span class="delimiter">(</span><a title="Set[akka.cluster.metrics.NodeMetrics]" id="akka.cluster.metrics.HeapMetricsSelector.capacity.nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.metrics.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Double]">Map</span><span class="delimiter">[</span>Address, Double<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.metrics.HeapMetricsSelector.capacity.nodeMetrics" title="Set[akka.cluster.metrics.NodeMetrics]">nodeMetrics</a>.<span title="(pf: PartialFunction[akka.cluster.metrics.NodeMetrics,(akka.actor.Address, Double)])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set[akka.cluster.metrics.NodeMetrics],(akka.actor.Address, Double),scala.collection.immutable.Set[(akka.actor.Address, Double)]])scala.collection.immutable.Set[(akka.actor.Address, Double)]">collect</span> <a title="&lt;$anon: akka.cluster.metrics.NodeMetrics =&gt; (akka.actor.Address, Double)&gt; extends scala.runtime.AbstractPartialFunction[akka.cluster.metrics.NodeMetrics,(akka.actor.Address, Double)] with Serializable" id="akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      case <a href="Metric.scala.html#akka.cluster.metrics.StandardMetrics.HeapMemory.unapply(bc54d973ff)" title="(nodeMetrics: akka.cluster.metrics.NodeMetrics)Option[(akka.actor.Address, Long, Long, Long, Option[Long])]">HeapMemory</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.address">address</a>, _, <a title="Long" id="akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.used">used</a>, <a title="Long" id="akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.committed">committed</a>, <a title="Option[Long]" id="akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.max">max</a><span class="delimiter">)</span> ⇒
        val <a title="Double" id="akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.applyOrElse.capacity">capacity</a> = <a href="#akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.max" title="Option[Long]">max</a> match <span class="delimiter">{</span>
          case <span title="None.type">None</span>    ⇒ <span class="delimiter">(</span><a href="#akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.committed" title="Long">committed</a> <span title="(x: Long)Long">-</span> <a href="#akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.used" title="Long">used</a><span class="delimiter">)</span>.<span title="=&gt; Double">toDouble</span> <span title="(x: Long)Double">/</span> <a href="#akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.committed" title="Long">committed</a>
          case Some<span class="delimiter">(</span><a title="Long" id="akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.applyOrElse.capacity.m">m</a><span class="delimiter">)</span> ⇒ <span class="delimiter">(</span><a href="#akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.applyOrElse.capacity.m" title="Long">m</a> <span title="(x: Long)Long">-</span> <a href="#akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.used" title="Long">used</a><span class="delimiter">)</span>.<span title="=&gt; Double">toDouble</span> <span title="(x: Long)Double">/</span> <a href="#akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.applyOrElse.capacity.m" title="Long">m</a>
        <span class="delimiter">}</span>
        <span title="(_1: akka.actor.Address, _2: Double)(akka.actor.Address, Double)" class="delimiter">(</span><a href="#akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.isDefinedAt.address" title="akka.actor.Address">address</a>, <a href="#akka.cluster.metrics.HeapMetricsSelector.capacity;$anonfun.applyOrElse.capacity" title="Double">capacity</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="(implicit ev: &lt;:&lt;[(akka.actor.Address, Double),(akka.actor.Address, Double)])scala.collection.immutable.Map[akka.actor.Address,Double]">toMap</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * MetricsSelector that uses the combined CPU time metrics and stolen CPU time metrics.
 * In modern Linux kernels: CpuCombined + CpuStolen + CpuIdle = 1.0  or 100%.
 * Combined CPU is sum of User + Sys + Nice + Wait times, as percentage.
 * Stolen CPU is the amount of CPU taken away from this virtual machine by the hypervisor, as percentage.
 *
 * Low CPU capacity =&gt; small node weight.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
case object <a href="#akka.cluster.metrics.CpuMetricsSelector.productElement.x$1" title="akka.cluster.metrics.CpuMetricsSelector.type" id="akka.cluster.metrics.CpuMetricsSelector.readResolve">CpuMetricsSelector</a> extends <a href="#akka.cluster.metrics;CapacityMetricsSelector" title="akka.cluster.metrics.CapacityMetricsSelector">CapacityMetricsSelector</a> <span class="delimiter">{</span>
  import akka.cluster.metrics.<a href="Metric.scala.html#akka.cluster.metrics.StandardMetrics" title="akka.cluster.metrics.StandardMetrics.type">StandardMetrics</a>.Cpu
  <span class="comment">/**
   * Java API: get the singleton instance
   */</span>
  def <a title="=&gt; akka.cluster.metrics.CpuMetricsSelector.type" id="akka.cluster.metrics.CpuMetricsSelector.getInstance">getInstance</a> = this

  <span class="comment">// Notes from reading around:</span>
  <span class="comment">// In modern Linux kernels: CpuCombined + CpuStolen + CpuIdle = 1.0  or 100%. More convoluted for other o/s.</span>
  <span class="comment">// We could use CpuIdle as the only capacity measure: http://axibase.com/news/ec2-monitoring-the-case-of-stolen-cpu/</span>
  <span class="comment">// But not all &quot;idle time&quot;s are created equal: https://docs.newrelic.com/docs/servers/new-relic-servers-linux/maintenance/servers-linux-faq</span>
  <span class="comment">// Example: assume that combined+stolen=70%, idle=30%. Then 50/20/30 system will be more responsive then 20/50/30 system (combined/stolen/idle ratio).</span>
  <span class="comment">// Current approach: &quot;The more stolen resources there are, the less active the virtual machine needs to be to generate a high load rating.&quot;</span>

  <span class="comment">// TODO read factor from reference.conf</span>
  <span class="comment">/** How much extra weight to give to the stolen time. */</span>
  val <a title="Double" id="akka.cluster.metrics.CpuMetricsSelector.factor">factor</a> = <span title="Double(0.3)" class="double">0.3</span>
  <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="Double(0.0)" class="double">0.0</span> <span title="(x: Double)Boolean">&lt;=</span> <a href="#akka.cluster.metrics.CpuMetricsSelector.factor" title="=&gt; Double">factor</a>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;factor must be non negative: &quot;)">factor must be non negative: $</span><span class="delimiter">{</span><a href="#akka.cluster.metrics.CpuMetricsSelector.factor" title="=&gt; Double">factor</a><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>

  override def <a title="(nodeMetrics: Set[akka.cluster.metrics.NodeMetrics])Map[akka.actor.Address,Double]" id="akka.cluster.metrics.CpuMetricsSelector.capacity">capacity</a><span class="delimiter">(</span><a title="Set[akka.cluster.metrics.NodeMetrics]" id="akka.cluster.metrics.CpuMetricsSelector.capacity.nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.metrics.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Double]">Map</span><span class="delimiter">[</span>Address, Double<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.metrics.CpuMetricsSelector.capacity.nodeMetrics" title="Set[akka.cluster.metrics.NodeMetrics]">nodeMetrics</a>.<span title="(pf: PartialFunction[akka.cluster.metrics.NodeMetrics,(akka.actor.Address, Double)])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set[akka.cluster.metrics.NodeMetrics],(akka.actor.Address, Double),scala.collection.immutable.Set[(akka.actor.Address, Double)]])scala.collection.immutable.Set[(akka.actor.Address, Double)]">collect</span> <a title="&lt;$anon: akka.cluster.metrics.NodeMetrics =&gt; (akka.actor.Address, Double)&gt; extends scala.runtime.AbstractPartialFunction[akka.cluster.metrics.NodeMetrics,(akka.actor.Address, Double)] with Serializable" id="akka.cluster.metrics.CpuMetricsSelector.capacity;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      case <a href="Metric.scala.html#akka.cluster.metrics.StandardMetrics.Cpu.unapply(fffcea9020)" title="(nodeMetrics: akka.cluster.metrics.NodeMetrics)Option[(akka.actor.Address, Long, Option[Double], Option[Double], Option[Double], Int)]">Cpu</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.metrics.CpuMetricsSelector.capacity;$anonfun.isDefinedAt.address">address</a>, _, _, Some<span class="delimiter">(</span><a title="Double" id="akka.cluster.metrics.CpuMetricsSelector.capacity;$anonfun.isDefinedAt.cpuCombined">cpuCombined</a><span class="delimiter">)</span>, Some<span class="delimiter">(</span><a title="Double" id="akka.cluster.metrics.CpuMetricsSelector.capacity;$anonfun.isDefinedAt.cpuStolen">cpuStolen</a><span class="delimiter">)</span>, _<span class="delimiter">)</span> ⇒
        <span class="comment">// Arbitrary load rating function which skews in favor of stolen time.</span>
        val load = <a href="#akka.cluster.metrics.CpuMetricsSelector.capacity;$anonfun.isDefinedAt.cpuCombined" title="Double">cpuCombined</a> <a title="Double" id="akka.cluster.metrics.CpuMetricsSelector.capacity;$anonfun.applyOrElse.load">+</a> <a href="#akka.cluster.metrics.CpuMetricsSelector.capacity;$anonfun.isDefinedAt.cpuStolen" title="Double">cpuStolen</a> <span title="(x: Double)Double">*</span> <span class="delimiter">(</span><span title="Double(1.0)" class="double">1.0</span> <span title="(x: Double)Double">+</span> <a href="#akka.cluster.metrics.CpuMetricsSelector.factor" title="=&gt; Double">factor</a><span class="delimiter">)</span>
        val <a title="Double" id="akka.cluster.metrics.CpuMetricsSelector.capacity;$anonfun.applyOrElse.capacity">capacity</a> = if <span class="delimiter">(</span><a href="#akka.cluster.metrics.CpuMetricsSelector.capacity;$anonfun.applyOrElse.load" title="Double">load</a> <span title="(x: Double)Boolean">&gt;=</span> <span title="Double(1.0)" class="double">1.0</span><span class="delimiter">)</span> <span title="Double(0.0)" class="double">0.0</span> else <span title="Double(1.0)" class="double">1.0</span> <span title="(x: Double)Double">-</span> <a href="#akka.cluster.metrics.CpuMetricsSelector.capacity;$anonfun.applyOrElse.load" title="Double">load</a>
        <span title="(_1: akka.actor.Address, _2: Double)(akka.actor.Address, Double)" class="delimiter">(</span><a href="#akka.cluster.metrics.CpuMetricsSelector.capacity;$anonfun.isDefinedAt.address" title="akka.actor.Address">address</a>, <a href="#akka.cluster.metrics.CpuMetricsSelector.capacity;$anonfun.applyOrElse.capacity" title="Double">capacity</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="(implicit ev: &lt;:&lt;[(akka.actor.Address, Double),(akka.actor.Address, Double)])scala.collection.immutable.Map[akka.actor.Address,Double]">toMap</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * MetricsSelector that uses the system load average metrics.
 * System load average is OS-specific average load on the CPUs in the system,
 * for the past 1 minute. The system is possibly nearing a bottleneck if the
 * system load average is nearing number of cpus/cores.
 * Low load average capacity =&gt; small weight.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
case object <a href="#akka.cluster.metrics.SystemLoadAverageMetricsSelector.productElement.x$1" title="akka.cluster.metrics.SystemLoadAverageMetricsSelector.type" id="akka.cluster.metrics.SystemLoadAverageMetricsSelector.readResolve">SystemLoadAverageMetricsSelector</a> extends <a href="#akka.cluster.metrics;CapacityMetricsSelector" title="akka.cluster.metrics.CapacityMetricsSelector">CapacityMetricsSelector</a> <span class="delimiter">{</span>
  import akka.cluster.metrics.<a href="Metric.scala.html#akka.cluster.metrics.StandardMetrics" title="akka.cluster.metrics.StandardMetrics.type">StandardMetrics</a>.Cpu
  <span class="comment">/**
   * Java API: get the singleton instance
   */</span>
  def <a title="=&gt; akka.cluster.metrics.SystemLoadAverageMetricsSelector.type" id="akka.cluster.metrics.SystemLoadAverageMetricsSelector.getInstance">getInstance</a> = this

  override def <a title="(nodeMetrics: Set[akka.cluster.metrics.NodeMetrics])Map[akka.actor.Address,Double]" id="akka.cluster.metrics.SystemLoadAverageMetricsSelector.capacity">capacity</a><span class="delimiter">(</span><a title="Set[akka.cluster.metrics.NodeMetrics]" id="akka.cluster.metrics.SystemLoadAverageMetricsSelector.capacity.nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.metrics.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Double]">Map</span><span class="delimiter">[</span>Address, Double<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.metrics.SystemLoadAverageMetricsSelector.capacity.nodeMetrics" title="Set[akka.cluster.metrics.NodeMetrics]">nodeMetrics</a>.<span title="(pf: PartialFunction[akka.cluster.metrics.NodeMetrics,(akka.actor.Address, Double)])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set[akka.cluster.metrics.NodeMetrics],(akka.actor.Address, Double),scala.collection.immutable.Set[(akka.actor.Address, Double)]])scala.collection.immutable.Set[(akka.actor.Address, Double)]">collect</span> <a title="&lt;$anon: akka.cluster.metrics.NodeMetrics =&gt; (akka.actor.Address, Double)&gt; extends scala.runtime.AbstractPartialFunction[akka.cluster.metrics.NodeMetrics,(akka.actor.Address, Double)] with Serializable" id="akka.cluster.metrics.SystemLoadAverageMetricsSelector.capacity;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      case <a href="Metric.scala.html#akka.cluster.metrics.StandardMetrics.Cpu.unapply(fffcea9020)" title="(nodeMetrics: akka.cluster.metrics.NodeMetrics)Option[(akka.actor.Address, Long, Option[Double], Option[Double], Option[Double], Int)]">Cpu</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.metrics.SystemLoadAverageMetricsSelector.capacity;$anonfun.isDefinedAt.address">address</a>, _, Some<span class="delimiter">(</span><a title="Double" id="akka.cluster.metrics.SystemLoadAverageMetricsSelector.capacity;$anonfun.isDefinedAt.systemLoadAverage">systemLoadAverage</a><span class="delimiter">)</span>, _, _, <a title="Int" id="akka.cluster.metrics.SystemLoadAverageMetricsSelector.capacity;$anonfun.isDefinedAt.processors">processors</a><span class="delimiter">)</span> ⇒
        val capacity = <span title="Double(1.0)" class="double">1.0</span> <a title="Double" id="akka.cluster.metrics.SystemLoadAverageMetricsSelector.capacity;$anonfun.applyOrElse.capacity">-</a> math.<span title="(x: Double, y: Double)Double">min</span><span class="delimiter">(</span><span title="Double(1.0)" class="double">1.0</span>, <a href="#akka.cluster.metrics.SystemLoadAverageMetricsSelector.capacity;$anonfun.isDefinedAt.systemLoadAverage" title="Double">systemLoadAverage</a> <span title="(x: Int)Double">/</span> <a href="#akka.cluster.metrics.SystemLoadAverageMetricsSelector.capacity;$anonfun.isDefinedAt.processors" title="Int">processors</a><span class="delimiter">)</span>
        <span title="(_1: akka.actor.Address, _2: Double)(akka.actor.Address, Double)" class="delimiter">(</span><a href="#akka.cluster.metrics.SystemLoadAverageMetricsSelector.capacity;$anonfun.isDefinedAt.address" title="akka.actor.Address">address</a>, <a href="#akka.cluster.metrics.SystemLoadAverageMetricsSelector.capacity;$anonfun.applyOrElse.capacity" title="Double">capacity</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="(implicit ev: &lt;:&lt;[(akka.actor.Address, Double),(akka.actor.Address, Double)])scala.collection.immutable.Map[akka.actor.Address,Double]">toMap</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Singleton instance of the default MixMetricsSelector, which uses [akka.cluster.routing.HeapMetricsSelector],
 * [akka.cluster.routing.CpuMetricsSelector], and [akka.cluster.routing.SystemLoadAverageMetricsSelector]
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
object <a title="akka.cluster.metrics.MixMetricsSelector.type" id="akka.cluster.metrics.MixMetricsSelector.readResolve">MixMetricsSelector</a> extends <a href="#akka.cluster.metrics;MixMetricsSelectorBase" title="akka.cluster.metrics.MixMetricsSelectorBase">MixMetricsSelectorBase</a><span class="delimiter">(</span>
  <span title="(elems: akka.cluster.metrics.CapacityMetricsSelector with Product*)scala.collection.immutable.Vector[akka.cluster.metrics.CapacityMetricsSelector with Product]">Vector</span><span class="delimiter">(</span><a href="#akka.cluster.metrics.HeapMetricsSelector.readResolve" title="akka.cluster.metrics.HeapMetricsSelector.type">HeapMetricsSelector</a>, <a href="#akka.cluster.metrics.CpuMetricsSelector.readResolve" title="akka.cluster.metrics.CpuMetricsSelector.type">CpuMetricsSelector</a>, <a href="#akka.cluster.metrics.SystemLoadAverageMetricsSelector.readResolve" title="akka.cluster.metrics.SystemLoadAverageMetricsSelector.type">SystemLoadAverageMetricsSelector</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="comment">/**
   * Java API: get the default singleton instance
   */</span>
  def <a title="=&gt; akka.cluster.metrics.MixMetricsSelector.type" id="akka.cluster.metrics.MixMetricsSelector.getInstance">getInstance</a> = this
<span class="delimiter">}</span>

<span class="comment">/**
 * MetricsSelector that combines other selectors and aggregates their capacity
 * values. By default it uses [akka.cluster.routing.HeapMetricsSelector],
 * [akka.cluster.routing.CpuMetricsSelector], and [akka.cluster.routing.SystemLoadAverageMetricsSelector]
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
final case class <a title="(selectors: scala.collection.immutable.IndexedSeq[akka.cluster.metrics.CapacityMetricsSelector])akka.cluster.metrics.MixMetricsSelector" id="akka.cluster.metrics;MixMetricsSelector.equals">MixMetricsSelector</a><span title="Product" class="delimiter">(</span>
  <a title="scala.collection.immutable.IndexedSeq[akka.cluster.metrics.CapacityMetricsSelector]" id="akka.cluster.metrics;MixMetricsSelector.copy$default$1">selectors</a>: immutable.<span title="scala.collection.immutable.IndexedSeq[akka.cluster.metrics.CapacityMetricsSelector]">IndexedSeq</span><span class="delimiter">[</span>CapacityMetricsSelector<span class="delimiter">]</span><span class="delimiter">)</span>
  extends <a href="#akka.cluster.metrics;MixMetricsSelectorBase" title="akka.cluster.metrics.MixMetricsSelectorBase">MixMetricsSelectorBase</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;MixMetricsSelector.copy$default$1" title="scala.collection.immutable.IndexedSeq[akka.cluster.metrics.CapacityMetricsSelector]">selectors</a><span class="delimiter">)</span>

<span class="comment">/**
 * Base class for MetricsSelector that combines other selectors and aggregates their capacity.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
abstract class <a title="class MixMetricsSelectorBase extends akka.cluster.metrics.CapacityMetricsSelector" id="akka.cluster.metrics;MixMetricsSelectorBase">MixMetricsSelectorBase</a><a href="#akka.cluster.metrics;MixMetricsSelectorBase" title="akka.cluster.metrics.MixMetricsSelectorBase" class="delimiter">(</a><a title="scala.collection.immutable.IndexedSeq[akka.cluster.metrics.CapacityMetricsSelector]" id="akka.cluster.metrics;MixMetricsSelectorBase.selectors">selectors</a>: immutable.<span title="scala.collection.immutable.IndexedSeq[akka.cluster.metrics.CapacityMetricsSelector]">IndexedSeq</span><span class="delimiter">[</span>CapacityMetricsSelector<span class="delimiter">]</span><span class="delimiter">)</span>
  extends <a href="#akka.cluster.metrics;CapacityMetricsSelector" title="akka.cluster.metrics.CapacityMetricsSelector">CapacityMetricsSelector</a> <span class="delimiter">{</span>

  <span class="comment">/**
   * Java API: construct a mix-selector from a sequence of selectors
   */</span>
  def this<span class="delimiter">(</span><a title="Iterable[akka.cluster.metrics.CapacityMetricsSelector]" id="akka.cluster.metrics;MixMetricsSelectorBase.<init>(457c97ff34).selectors">selectors</a>: java.lang.<span title="Iterable[akka.cluster.metrics.CapacityMetricsSelector]">Iterable</span><span class="delimiter">[</span>CapacityMetricsSelector<span class="delimiter">]</span><span class="delimiter">)</span> = this<span class="delimiter">(</span><a href="../../../../actor/akka/japi/JavaAPI.scala.html#akka.japi.Util.immutableSeq(42d3e3f9ec)" title="(iterable: Iterable[akka.cluster.metrics.CapacityMetricsSelector])scala.collection.immutable.Seq[akka.cluster.metrics.CapacityMetricsSelector]">immutableSeq</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;MixMetricsSelectorBase.<init>(457c97ff34).selectors" title="Iterable[akka.cluster.metrics.CapacityMetricsSelector]">selectors</a><span class="delimiter">)</span>.<span title="=&gt; Vector[akka.cluster.metrics.CapacityMetricsSelector]">toVector</span><span class="delimiter">)</span>

  override def <a title="(nodeMetrics: Set[akka.cluster.metrics.NodeMetrics])Map[akka.actor.Address,Double]" id="akka.cluster.metrics;MixMetricsSelectorBase.capacity">capacity</a><span class="delimiter">(</span><a title="Set[akka.cluster.metrics.NodeMetrics]" id="akka.cluster.metrics;MixMetricsSelectorBase.capacity.nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.metrics.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Double]">Map</span><span class="delimiter">[</span>Address, Double<span class="delimiter">]</span> = <span class="delimiter">{</span>
    val <a title="scala.collection.immutable.IndexedSeq[(akka.actor.Address, Double)]" id="akka.cluster.metrics;MixMetricsSelectorBase.capacity.combined">combined</a>: immutable.<span title="scala.collection.immutable.IndexedSeq[(akka.actor.Address, Double)]">IndexedSeq</span><span class="delimiter">[</span><span class="delimiter">(</span>Address, Double<span class="delimiter">)</span><span class="delimiter">]</span> = <a href="#akka.cluster.metrics;MixMetricsSelectorBase.selectors" title="scala.collection.immutable.IndexedSeq[akka.cluster.metrics.CapacityMetricsSelector]">selectors</a>.<span title="(f: akka.cluster.metrics.CapacityMetricsSelector =&gt; scala.collection.GenTraversableOnce[(akka.actor.Address, Double)])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[akka.cluster.metrics.CapacityMetricsSelector],(akka.actor.Address, Double),scala.collection.immutable.IndexedSeq[(akka.actor.Address, Double)]])scala.collection.immutable.IndexedSeq[(akka.actor.Address, Double)]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq.Coll,(akka.actor.Address, Double),scala.collection.immutable.IndexedSeq[(akka.actor.Address, Double)]]" class="delimiter">(</span><a href="#akka.cluster.metrics;MixMetricsSelectorBase.capacity.combined.$anonfun.x$2" title="akka.cluster.metrics.CapacityMetricsSelector">_</a>.<a href="#akka.cluster.metrics;CapacityMetricsSelector.capacity" title="(nodeMetrics: Set[akka.cluster.metrics.NodeMetrics])Map[akka.actor.Address,Double]">capacity</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;MixMetricsSelectorBase.capacity.nodeMetrics" title="Set[akka.cluster.metrics.NodeMetrics]">nodeMetrics</a><span class="delimiter">)</span>.<span title="=&gt; Seq[(akka.actor.Address, Double)]">toSeq</span><span class="delimiter">)</span>
    <span class="comment">// aggregated average of the capacities by address</span>
    <a href="#akka.cluster.metrics;MixMetricsSelectorBase.capacity.combined" title="scala.collection.immutable.IndexedSeq[(akka.actor.Address, Double)]">combined</a>.<span title="(z: scala.collection.immutable.Map[akka.actor.Address,(Double, Int)])(op: (scala.collection.immutable.Map[akka.actor.Address,(Double, Int)], (akka.actor.Address, Double)) =&gt; scala.collection.immutable.Map[akka.actor.Address,(Double, Int)])scala.collection.immutable.Map[akka.actor.Address,(Double, Int)]">foldLeft</span><span class="delimiter">(</span><span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.actor.Address,(Double, Int)]" class="delimiter">[</span><a href="../../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a>, <span title="(Double, Int)" class="delimiter">(</span>Double, Int<span class="delimiter">)</span><span class="delimiter">]</span>.<span title="(d: (Double, Int))scala.collection.immutable.Map[akka.actor.Address,(Double, Int)]">withDefaultValue</span><span class="delimiter">(</span><span title="(_1: Double, _2: Int)(Double, Int)" class="delimiter">(</span><span title="Double(0.0)" class="double">0.0</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.x0$1" title="scala.collection.immutable.Map[akka.actor.Address,(Double, Int)]" class="delimiter">{</a>
      case <span class="delimiter">(</span><a title="scala.collection.immutable.Map[akka.actor.Address,(Double, Int)]" id="akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.acc">acc</a>, <span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.address">address</a>, <a title="Double" id="akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.capacity">capacity</a><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
        val <a href="#akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.x$3.sum" title="(Double, Int)" class="delimiter">(</a><a href="#akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.x$3" title="Double" id="akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.x$3.sum">sum</a>, <a href="#akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.x$3" title="Int" id="akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.x$3.count">count</a><span class="delimiter">)</span> = <a href="#akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.acc" title="(key: akka.actor.Address)(Double, Int)">acc</a><span title="(Double, Int) @unchecked" class="delimiter">(</span><a href="#akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.address" title="akka.actor.Address">address</a><span class="delimiter">)</span>
        <a href="#akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.acc" title="scala.collection.immutable.Map[akka.actor.Address,(Double, Int)]">acc</a> <span title="(kv: (akka.actor.Address, (Double, Int)))scala.collection.immutable.Map[akka.actor.Address,(Double, Int)]">+</span> <span class="delimiter">(</span><a href="#akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.address" title="(self: akka.actor.Address)ArrowAssoc[akka.actor.Address]">address</a> <span title="(y: (Double, Int))(akka.actor.Address, (Double, Int))">-&gt;</span> <span class="delimiter">(</span><span title="(_1: Double, _2: Int)(Double, Int)" class="delimiter">(</span><span title="Double">sum</span> <span title="(x: Double)Double">+</span> <a href="#akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.capacity" title="Double">capacity</a>, <span title="Int">count</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="(f: ((akka.actor.Address, (Double, Int))) =&gt; (akka.actor.Address, Double))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[akka.actor.Address,(Double, Int)],(akka.actor.Address, Double),Map[akka.actor.Address,Double]])Map[akka.actor.Address,Double]">map</span> <a href="#akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.x0$2" title="(akka.actor.Address, Double)" class="delimiter">{</a>
      case <span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.addr">addr</a>, <span class="delimiter">(</span><span title="Double">sum</span>, <span title="Int">count</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒ <span class="delimiter">(</span><a href="#akka.cluster.metrics;MixMetricsSelectorBase.capacity.$anonfun.addr" title="(self: akka.actor.Address)ArrowAssoc[akka.actor.Address]">addr</a> <span title="(y: Double)(akka.actor.Address, Double)">-&gt;</span> <span title="Double">sum</span> <span title="(x: Int)Double">/</span> <span title="Int">count</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

object <a title="akka.cluster.metrics.MetricsSelector.type" id="akka.cluster.metrics.MetricsSelector.readResolve">MetricsSelector</a> <a href="#akka.cluster.metrics.MetricsSelector.readResolve" title="akka.cluster.metrics.MetricsSelector.type" class="delimiter">{</a>
  def <a title="(config: com.typesafe.config.Config, dynamicAccess: akka.actor.DynamicAccess)akka.cluster.metrics.MetricsSelector" id="akka.cluster.metrics.MetricsSelector.fromConfig">fromConfig</a><span class="delimiter">(</span><a title="com.typesafe.config.Config" id="akka.cluster.metrics.MetricsSelector.fromConfig.config">config</a>: <span title="com.typesafe.config.Config">Config</span>, <a title="akka.actor.DynamicAccess" id="akka.cluster.metrics.MetricsSelector.fromConfig.dynamicAccess">dynamicAccess</a>: <a href="../../../../actor/akka/actor/DynamicAccess.scala.html#akka.actor;DynamicAccess" title="akka.actor.DynamicAccess">DynamicAccess</a><span class="delimiter">)</span> =
    <a href="#akka.cluster.metrics.MetricsSelector.fromConfig.config" title="com.typesafe.config.Config">config</a>.<span title="(x$1: String)String">getString</span><span class="delimiter">(</span><span title="String(&quot;metrics-selector&quot;)" class="string">&quot;metrics-selector&quot;</span><span class="delimiter">)</span> match <span class="delimiter">{</span>
      case <span title="String(&quot;mix&quot;)" class="string">&quot;mix&quot;</span>  ⇒ <a href="#akka.cluster.metrics.MixMetricsSelector.readResolve" title="akka.cluster.metrics.MixMetricsSelector.type">MixMetricsSelector</a>
      case <span title="String(&quot;heap&quot;)" class="string">&quot;heap&quot;</span> ⇒ <a href="#akka.cluster.metrics.HeapMetricsSelector.readResolve" title="akka.cluster.metrics.HeapMetricsSelector.type">HeapMetricsSelector</a>
      case <span title="String(&quot;cpu&quot;)" class="string">&quot;cpu&quot;</span>  ⇒ <a href="#akka.cluster.metrics.CpuMetricsSelector.readResolve" title="akka.cluster.metrics.CpuMetricsSelector.type">CpuMetricsSelector</a>
      case <span title="String(&quot;load&quot;)" class="string">&quot;load&quot;</span> ⇒ <a href="#akka.cluster.metrics.SystemLoadAverageMetricsSelector.readResolve" title="akka.cluster.metrics.SystemLoadAverageMetricsSelector.type">SystemLoadAverageMetricsSelector</a>
      case <a title="String" id="akka.cluster.metrics.MetricsSelector.fromConfig.fqn">fqn</a> ⇒
        val <a title="List[(Class[com.typesafe.config.Config], com.typesafe.config.Config)]" id="akka.cluster.metrics.MetricsSelector.fromConfig.args">args</a> = <span title="(xs: (Class[com.typesafe.config.Config], com.typesafe.config.Config)*)List[(Class[com.typesafe.config.Config], com.typesafe.config.Config)]">List</span><span class="delimiter">(</span>classOf<span title="(self: Class[com.typesafe.config.Config])ArrowAssoc[Class[com.typesafe.config.Config]]" class="delimiter">[</span>Config<span class="delimiter">]</span> <span title="(y: com.typesafe.config.Config)(Class[com.typesafe.config.Config], com.typesafe.config.Config)">-&gt;</span> <a href="#akka.cluster.metrics.MetricsSelector.fromConfig.config" title="com.typesafe.config.Config">config</a><span class="delimiter">)</span>
        <a href="#akka.cluster.metrics.MetricsSelector.fromConfig.dynamicAccess" title="akka.actor.DynamicAccess">dynamicAccess</a>.<a href="../../../../actor/akka/actor/DynamicAccess.scala.html#akka.actor;DynamicAccess.createInstanceFor(b43a2b150b)" title="[T](fqcn: String, args: scala.collection.immutable.Seq[(Class[_], AnyRef)])(implicit evidence$3: scala.reflect.ClassTag[T])scala.util.Try[T]">createInstanceFor</a><span title="(fqcn: String, args: scala.collection.immutable.Seq[(Class[_], AnyRef)])(implicit evidence$3: scala.reflect.ClassTag[akka.cluster.metrics.MetricsSelector])scala.util.Try[akka.cluster.metrics.MetricsSelector]" class="delimiter">[</span><a href="#akka.cluster.metrics;MetricsSelector" title="akka.cluster.metrics.MetricsSelector">MetricsSelector</a><span class="delimiter">]</span><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[akka.cluster.metrics.MetricsSelector]" class="delimiter">(</span><a href="#akka.cluster.metrics.MetricsSelector.fromConfig.fqn" title="String">fqn</a>, <a href="#akka.cluster.metrics.MetricsSelector.fromConfig.args" title="List[(Class[com.typesafe.config.Config], com.typesafe.config.Config)]">args</a><span class="delimiter">)</span>.<span title="(f: PartialFunction[Throwable,akka.cluster.metrics.MetricsSelector])scala.util.Try[akka.cluster.metrics.MetricsSelector]">recover</span><span class="delimiter">(</span><a title="&lt;$anon: Throwable =&gt; Nothing&gt; extends scala.runtime.AbstractPartialFunction[Throwable,Nothing] with Serializable" id="akka.cluster.metrics.MetricsSelector.fromConfig;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
          case <a title="Throwable" id="akka.cluster.metrics.MetricsSelector.fromConfig;$anonfun.isDefinedAt.exception">exception</a> ⇒ throw new <span title="IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span>
            <span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Cannot instantiate metrics-selector [&quot;)">Cannot instantiate metrics-selector [$</span><a href="#akka.cluster.metrics.MetricsSelector.fromConfig.fqn" title="String">fqn</a><span title="String(&quot;], &quot;)" class="string">], &quot;</span> <span title="(x$1: Any)String">+</span>
              <span title="String(&quot;make sure it extends [akka.cluster.routing.MetricsSelector] and &quot;)" class="string">&quot;make sure it extends [akka.cluster.routing.MetricsSelector] and &quot;</span> <span title="(x$1: Any)String">+</span>
              <span title="String(&quot;has constructor with [com.typesafe.config.Config] parameter&quot;)" class="string">&quot;has constructor with [com.typesafe.config.Config] parameter&quot;</span><span class="delimiter">)</span>, <a href="#akka.cluster.metrics.MetricsSelector.fromConfig;$anonfun.isDefinedAt.exception" title="Throwable">exception</a><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="=&gt; akka.cluster.metrics.MetricsSelector">get</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * A MetricsSelector is responsible for producing weights from the node metrics.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
trait <a title="trait MetricsSelector extends AnyRef with Serializable" id="akka.cluster.metrics;MetricsSelector">MetricsSelector</a> extends <span title="Serializable">Serializable</span> <span class="delimiter">{</span>
  <span class="comment">/**
   * The weights per address, based on the nodeMetrics.
   */</span>
  def <a title="(nodeMetrics: Set[akka.cluster.metrics.NodeMetrics])Map[akka.actor.Address,Int]" id="akka.cluster.metrics;MetricsSelector.weights">weights</a><span class="delimiter">(</span><a title="Set[akka.cluster.metrics.NodeMetrics]" id="akka.cluster.metrics;MetricsSelector.weights.nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.metrics.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Int]">Map</span><span class="delimiter">[</span>Address, Int<span class="delimiter">]</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * A MetricsSelector producing weights from remaining capacity.
 * The weights are typically proportional to the remaining capacity.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
abstract class <a title="class CapacityMetricsSelector extends AnyRef with akka.cluster.metrics.MetricsSelector" id="akka.cluster.metrics;CapacityMetricsSelector">CapacityMetricsSelector</a> extends <a href="#akka.cluster.metrics;MetricsSelector" title="akka.cluster.metrics.MetricsSelector">MetricsSelector</a> <span class="delimiter">{</span>

  <span class="comment">/**
   * Remaining capacity for each node. The value is between
   * 0.0 and 1.0, where 0.0 means no remaining capacity (full
   * utilization) and 1.0 means full remaining capacity (zero
   * utilization).
   */</span>
  def <a title="(nodeMetrics: Set[akka.cluster.metrics.NodeMetrics])Map[akka.actor.Address,Double]" id="akka.cluster.metrics;CapacityMetricsSelector.capacity">capacity</a><span class="delimiter">(</span><a title="Set[akka.cluster.metrics.NodeMetrics]" id="akka.cluster.metrics;CapacityMetricsSelector.capacity.nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.metrics.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Double]">Map</span><span class="delimiter">[</span>Address, Double<span class="delimiter">]</span>

  <span class="comment">/**
   * Converts the capacity values to weights. The node with lowest
   * capacity gets weight 1 (lowest usable capacity is 1%) and other
   * nodes gets weights proportional to their capacity compared to
   * the node with lowest capacity.
   */</span>
  def <a title="(capacity: Map[akka.actor.Address,Double])Map[akka.actor.Address,Int]" id="akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c)">weights</a><span class="delimiter">(</span><a title="Map[akka.actor.Address,Double]" id="akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).capacity">capacity</a>: <span title="Map[akka.actor.Address,Double]">Map</span><span class="delimiter">[</span>Address, Double<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Int]">Map</span><span class="delimiter">[</span>Address, Int<span class="delimiter">]</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).capacity" title="Map[akka.actor.Address,Double]">capacity</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.actor.Address,Int]" class="delimiter">[</span><a href="../../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a>, <span title="Int">Int</span><span class="delimiter">]</span>
    else <span class="delimiter">{</span>
      val <a href="#akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).min.min" title="Double" id="akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).min" class="delimiter">(</a>_, <a title="Double" id="akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).min.min">min</a><span class="delimiter">)</span> = <a href="#akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).capacity" title="Map[akka.actor.Address,Double]">capacity</a>.<span title="(f: ((akka.actor.Address, Double)) =&gt; Double)(implicit cmp: Ordering[Double])(akka.actor.Address, Double)">minBy</span> <a href="#akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).min.$anonfun.x0$3" title="Double" class="delimiter">{</a> case <span class="delimiter">(</span>_, <a title="Double" id="akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).min.$anonfun.c">c</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).min.$anonfun.c" title="Double">c</a> <span class="delimiter">}</span>
      <span class="comment">// lowest usable capacity is 1% (&gt;= 0.5% will be rounded to weight 1), also avoids div by zero</span>
      val <a title="Double" id="akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).divisor">divisor</a> = math.<span title="(x: Double, y: Double)Double">max</span><span class="delimiter">(</span><span title="Double(0.01)" class="double">0.01</span>, <a href="#akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).min" title="Double">min</a><span class="delimiter">)</span>
      <a href="#akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).capacity" title="Map[akka.actor.Address,Double]">capacity</a> <span title="(f: ((akka.actor.Address, Double)) =&gt; (akka.actor.Address, Int))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[akka.actor.Address,Double],(akka.actor.Address, Int),Map[akka.actor.Address,Int]])Map[akka.actor.Address,Int]">map</span> <a href="#akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).$anonfun.x0$4" title="(akka.actor.Address, Int)" class="delimiter">{</a> case <span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).$anonfun.addr">addr</a>, <a title="Double" id="akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).$anonfun.c">c</a><span class="delimiter">)</span> ⇒ <span class="delimiter">(</span><a href="#akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).$anonfun.addr" title="(self: akka.actor.Address)ArrowAssoc[akka.actor.Address]">addr</a> <span title="(y: Int)(akka.actor.Address, Int)">-&gt;</span> math.<span title="(x: Double)Long">round</span><span class="delimiter">(</span><span class="delimiter">(</span><a href="#akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).$anonfun.c" title="Double">c</a><span class="delimiter">)</span> <span title="(x: Double)Double">/</span> <a href="#akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c).divisor" title="Double">divisor</a><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * The weights per address, based on the capacity produced by
   * the nodeMetrics.
   */</span>
  override def <a title="(nodeMetrics: Set[akka.cluster.metrics.NodeMetrics])Map[akka.actor.Address,Int]" id="akka.cluster.metrics;CapacityMetricsSelector.weights(35ddafeb26)">weights</a><span class="delimiter">(</span><a title="Set[akka.cluster.metrics.NodeMetrics]" id="akka.cluster.metrics;CapacityMetricsSelector.weights(35ddafeb26).nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.metrics.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Map[akka.actor.Address,Int]">Map</span><span class="delimiter">[</span>Address, Int<span class="delimiter">]</span> =
    <a href="#akka.cluster.metrics;CapacityMetricsSelector.weights(e45d06905c)" title="(capacity: Map[akka.actor.Address,Double])Map[akka.actor.Address,Int]">weights</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;CapacityMetricsSelector.capacity" title="(nodeMetrics: Set[akka.cluster.metrics.NodeMetrics])Map[akka.actor.Address,Double]">capacity</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;CapacityMetricsSelector.weights(35ddafeb26).nodeMetrics" title="Set[akka.cluster.metrics.NodeMetrics]">nodeMetrics</a><span class="delimiter">)</span><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API
 *
 * Pick routee based on its weight. Higher weight, higher probability.
 */</span>
private<span class="delimiter">[</span>metrics<span class="delimiter">]</span> class <a title="class WeightedRoutees extends AnyRef" id="akka.cluster.metrics;WeightedRoutees">WeightedRoutees</a><a href="#akka.cluster.metrics;WeightedRoutees" title="akka.cluster.metrics.WeightedRoutees" class="delimiter">(</a><a title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]" id="akka.cluster.metrics;WeightedRoutees.routees">routees</a>: immutable.<span title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">IndexedSeq</span><span class="delimiter">[</span>Routee<span class="delimiter">]</span>, <a title="akka.actor.Address" id="akka.cluster.metrics;WeightedRoutees.selfAddress">selfAddress</a>: <a href="../../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a>, <a title="Map[akka.actor.Address,Int]" id="akka.cluster.metrics;WeightedRoutees.weights">weights</a>: <span title="Map[akka.actor.Address,Int]">Map</span><span class="delimiter">[</span>Address, Int<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="comment">// fill an array of same size as the refs with accumulated weights,</span>
  <span class="comment">// binarySearch is used to pick the right bucket from a requested value</span>
  <span class="comment">// from 1 to the total sum of the used weights.</span>
  private val <a title="Array[Int]" id="akka.cluster.metrics;WeightedRoutees.buckets">buckets</a>: <span title="Array[Int]">Array</span><span class="delimiter">[</span>Int<span class="delimiter">]</span> = <span class="delimiter">{</span>
    def <a title="(routee: akka.routing.Routee)akka.actor.Address" id="akka.cluster.metrics;WeightedRoutees.buckets.fullAddress">fullAddress</a><span class="delimiter">(</span><a title="akka.routing.Routee" id="akka.cluster.metrics;WeightedRoutees.buckets.fullAddress.routee">routee</a>: <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing;Routee" title="akka.routing.Routee">Routee</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a> = <span class="delimiter">{</span>
      val <span title="akka.actor.Address">a</span> = <a href="#akka.cluster.metrics;WeightedRoutees.buckets.fullAddress.routee" title="akka.routing.Routee">routee</a> match <span class="delimiter">{</span>
        case ActorRefRoutee<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.metrics;WeightedRoutees.buckets.fullAddress.a.ref">ref</a><span class="delimiter">)</span>       ⇒ <a href="#akka.cluster.metrics;WeightedRoutees.buckets.fullAddress.a.ref" title="akka.actor.ActorRef">ref</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a>
        case ActorSelectionRoutee<span class="delimiter">(</span><a title="akka.actor.ActorSelection" id="akka.cluster.metrics;WeightedRoutees.buckets.fullAddress.a.sel">sel</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.metrics;WeightedRoutees.buckets.fullAddress.a.sel" title="akka.actor.ActorSelection">sel</a>.<a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor;ActorSelection.anchor" title="=&gt; akka.actor.ActorRef">anchor</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a>
      <span class="delimiter">}</span>
      <span title="akka.actor.Address">a</span> match <span class="delimiter">{</span>
        case Address<span class="delimiter">(</span>_, _, <span title="None.type">None</span>, <span title="None.type">None</span><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.metrics;WeightedRoutees.selfAddress" title="akka.actor.Address">selfAddress</a>
        case <span title="akka.actor.Address">a</span>                         ⇒ <span title="akka.actor.Address">a</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    val <a title="Array[Int]" id="akka.cluster.metrics;WeightedRoutees.buckets.buckets">buckets</a> = <span title="Array.type">Array</span>.<span title="[T](n1: Int)(implicit evidence$3: scala.reflect.ClassTag[T])Array[T]">ofDim</span><span title="(n1: Int)(implicit evidence$3: scala.reflect.ClassTag[Int])Array[Int]" class="delimiter">[</span><span title="Int">Int</span><span class="delimiter">]</span><span title="=&gt; scala.reflect.ClassTag[Int]" class="delimiter">(</span><a href="#akka.cluster.metrics;WeightedRoutees.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
    val <a title="Int" id="akka.cluster.metrics;WeightedRoutees.buckets.meanWeight">meanWeight</a> = if <span class="delimiter">(</span><a href="#akka.cluster.metrics;WeightedRoutees.weights" title="Map[akka.actor.Address,Int]">weights</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="Int(1)" class="int">1</span> else <a href="#akka.cluster.metrics;WeightedRoutees.weights" title="Map[akka.actor.Address,Int]">weights</a>.<span title="=&gt; Iterable[Int]">values</span>.<span title="(implicit num: Numeric[Int])Int">sum</span> <span title="(x: Int)Int">/</span> <a href="#akka.cluster.metrics;WeightedRoutees.weights" title="Map[akka.actor.Address,Int]">weights</a>.<span title="=&gt; Int">size</span>
    val <a title="scala.collection.immutable.Map[akka.actor.Address,Int]" id="akka.cluster.metrics;WeightedRoutees.buckets.w">w</a> = <a href="#akka.cluster.metrics;WeightedRoutees.weights" title="Map[akka.actor.Address,Int]">weights</a>.<span title="(d: Int)scala.collection.immutable.Map[akka.actor.Address,Int]">withDefaultValue</span><span class="delimiter">(</span><a href="#akka.cluster.metrics;WeightedRoutees.buckets.meanWeight" title="Int">meanWeight</a><span class="delimiter">)</span> <span class="comment">// we don’t necessarily have metrics for all addresses</span>
    var <a title="Int" id="akka.cluster.metrics;WeightedRoutees.buckets.i">i</a> = <span title="Int(0)" class="int">0</span>
    var <a title="Int" id="akka.cluster.metrics;WeightedRoutees.buckets.sum">sum</a> = <span title="Int(0)" class="int">0</span>
    <a href="#akka.cluster.metrics;WeightedRoutees.routees" title="scala.collection.immutable.IndexedSeq[akka.routing.Routee]">routees</a> <span title="(f: akka.routing.Routee =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="akka.routing.Routee" id="akka.cluster.metrics;WeightedRoutees.buckets.$anonfun.r">r</a> ⇒
      <a href="#akka.cluster.metrics;WeightedRoutees.buckets.sum" title="Int">sum</a> <span title="(x: Int)Int">+=</span> <a href="#akka.cluster.metrics;WeightedRoutees.buckets.w" title="(key: akka.actor.Address)Int">w</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;WeightedRoutees.buckets.fullAddress" title="(routee: akka.routing.Routee)akka.actor.Address">fullAddress</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;WeightedRoutees.buckets.$anonfun.r" title="akka.routing.Routee">r</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.cluster.metrics;WeightedRoutees.buckets.buckets" title="(i: Int, x: Int)Unit">buckets</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;WeightedRoutees.buckets.i" title="Int">i</a><span class="delimiter">)</span> = <a href="#akka.cluster.metrics;WeightedRoutees.buckets.sum" title="Int">sum</a>
      <a href="#akka.cluster.metrics;WeightedRoutees.buckets.i" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>
    <a href="#akka.cluster.metrics;WeightedRoutees.buckets.buckets" title="Array[Int]">buckets</a>
  <span class="delimiter">}</span>

  def <a title="=&gt; Boolean" id="akka.cluster.metrics;WeightedRoutees.isEmpty">isEmpty</a>: <span title="Boolean">Boolean</span> = <a href="#akka.cluster.metrics;WeightedRoutees.buckets" title="=&gt; Array[Int]">buckets</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">||</span> <a href="#akka.cluster.metrics;WeightedRoutees.buckets" title="(i: Int)Int">buckets</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;WeightedRoutees.buckets" title="=&gt; Array[Int]">buckets</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span>

  def <a title="=&gt; Int" id="akka.cluster.metrics;WeightedRoutees.total">total</a>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.metrics;WeightedRoutees.isEmpty" title="=&gt; Boolean">isEmpty</a>, <span title="String(&quot;WeightedRoutees must not be used when empty&quot;)" class="string">&quot;WeightedRoutees must not be used when empty&quot;</span><span class="delimiter">)</span>
    <a href="#akka.cluster.metrics;WeightedRoutees.buckets" title="(i: Int)Int">buckets</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;WeightedRoutees.buckets" title="=&gt; Array[Int]">buckets</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Pick the routee matching a value, from 1 to total.
   */</span>
  def <a title="(value: Int)akka.routing.Routee" id="akka.cluster.metrics;WeightedRoutees.apply">apply</a><span class="delimiter">(</span><a title="Int" id="akka.cluster.metrics;WeightedRoutees.apply.value">value</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing;Routee" title="akka.routing.Routee">Routee</a> = <span class="delimiter">{</span>
    <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <span title="(x: Int)Boolean">&lt;=</span> <a href="#akka.cluster.metrics;WeightedRoutees.apply.value" title="Int">value</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.cluster.metrics;WeightedRoutees.apply.value" title="Int">value</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="#akka.cluster.metrics;WeightedRoutees.total" title="=&gt; Int">total</a>, <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;value must be between [1 - %s]&quot;</span> <span title="(args: Any*)String">format</span> <a href="#akka.cluster.metrics;WeightedRoutees.total" title="=&gt; Int">total</a><span class="delimiter">)</span>
    <a href="#akka.cluster.metrics;WeightedRoutees.routees" title="(idx: Int)akka.routing.Routee">routees</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;WeightedRoutees.idx" title="(i: Int)Int">idx</a><span class="delimiter">(</span><span title="java.util.Arrays.type">Arrays</span>.<span title="(x$1: Array[Int], x$2: Int)Int">binarySearch</span><span class="delimiter">(</span><a href="#akka.cluster.metrics;WeightedRoutees.buckets" title="=&gt; Array[Int]">buckets</a>, <a href="#akka.cluster.metrics;WeightedRoutees.apply.value" title="Int">value</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Converts the result of Arrays.binarySearch into a index in the buckets array
   * see documentation of Arrays.binarySearch for what it returns
   */</span>
  private def <a title="(i: Int)Int" id="akka.cluster.metrics;WeightedRoutees.idx">idx</a><span class="delimiter">(</span><a title="Int" id="akka.cluster.metrics;WeightedRoutees.idx.i">i</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#akka.cluster.metrics;WeightedRoutees.idx.i" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#akka.cluster.metrics;WeightedRoutees.idx.i" title="Int">i</a> <span class="comment">// exact match</span>
    else <span class="delimiter">{</span>
      val <a title="Int" id="akka.cluster.metrics;WeightedRoutees.idx.j">j</a> = math.<span title="(x: Int)Int">abs</span><span class="delimiter">(</span><a href="#akka.cluster.metrics;WeightedRoutees.idx.i" title="Int">i</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#akka.cluster.metrics;WeightedRoutees.idx.j" title="Int">j</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#akka.cluster.metrics;WeightedRoutees.buckets" title="=&gt; Array[Int]">buckets</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> throw new <span title="IndexOutOfBoundsException">IndexOutOfBoundsException</span><span class="delimiter">(</span>
        <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Requested index [%s] is &gt; max index [%s]&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#akka.cluster.metrics;WeightedRoutees.idx.i" title="Int">i</a>, <a href="#akka.cluster.metrics;WeightedRoutees.buckets" title="=&gt; Array[Int]">buckets</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span><span class="delimiter">)</span>
      else <a href="#akka.cluster.metrics;WeightedRoutees.idx.j" title="Int">j</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API
 * Subscribe to [[ClusterMetricsEvent]]s and update routing logic depending on the events.
 */</span>
private<span class="delimiter">[</span>metrics<span class="delimiter">]</span> class <a title="class AdaptiveLoadBalancingMetricsListener extends AnyRef with akka.actor.Actor" id="akka.cluster.metrics;AdaptiveLoadBalancingMetricsListener">AdaptiveLoadBalancingMetricsListener</a><a href="#akka.cluster.metrics;AdaptiveLoadBalancingMetricsListener" title="akka.cluster.metrics.AdaptiveLoadBalancingMetricsListener" class="delimiter">(</a><a title="akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic" id="akka.cluster.metrics;AdaptiveLoadBalancingMetricsListener.routingLogic">routingLogic</a>: <a href="#akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic.readResolve" title="akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic">AdaptiveLoadBalancingRoutingLogic</a><span class="delimiter">)</span>
  extends <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="delimiter">{</span>

  def <a title="=&gt; akka.cluster.metrics.ClusterMetricsExtension" id="akka.cluster.metrics;AdaptiveLoadBalancingMetricsListener.extension">extension</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.metrics.ClusterMetricsExtension">ClusterMetricsExtension</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>

  override def <a title="()Unit" id="akka.cluster.metrics;AdaptiveLoadBalancingMetricsListener.preStart">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.cluster.metrics;AdaptiveLoadBalancingMetricsListener.extension" title="=&gt; akka.cluster.metrics.ClusterMetricsExtension">extension</a>.<a href="ClusterMetricsExtension.scala.html#akka.cluster.metrics;ClusterMetricsExtension.subscribe" title="(metricsListener: akka.actor.ActorRef)Unit">subscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>

  override def <a title="()Unit" id="akka.cluster.metrics;AdaptiveLoadBalancingMetricsListener.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.cluster.metrics;AdaptiveLoadBalancingMetricsListener.extension" title="=&gt; akka.cluster.metrics.ClusterMetricsExtension">extension</a>.<a href="ClusterMetricsExtension.scala.html#akka.cluster.metrics;ClusterMetricsExtension.unsubscribe" title="(metricsListenter: akka.actor.ActorRef)Unit">unsubscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>

  def <a title="=&gt; PartialFunction[Any,Unit]" id="akka.cluster.metrics;AdaptiveLoadBalancingMetricsListener.receive">receive</a> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.metrics;AdaptiveLoadBalancingMetricsListener.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case <a title="akka.cluster.metrics.ClusterMetricsChanged" id="akka.cluster.metrics;AdaptiveLoadBalancingMetricsListener.receive;$anonfun.isDefinedAt.event">event</a>: <a href="ClusterMetricsCollector.scala.html#akka.cluster.metrics;ClusterMetricsChanged" title="akka.cluster.metrics.ClusterMetricsChanged">ClusterMetricsChanged</a> ⇒ <a href="#akka.cluster.metrics;AdaptiveLoadBalancingMetricsListener.routingLogic" title="akka.cluster.metrics.AdaptiveLoadBalancingRoutingLogic">routingLogic</a>.<a href="#akka.cluster.metrics;AdaptiveLoadBalancingRoutingLogic.metricsChanged" title="(event: akka.cluster.metrics.ClusterMetricsChanged)Unit">metricsChanged</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.cluster.metrics;AdaptiveLoadBalancingMetricsListener.receive;$anonfun.isDefinedAt.event" title="akka.cluster.metrics.ClusterMetricsChanged">event</a><span class="delimiter">)</span>
    case _                            ⇒ <span class="comment">// ignore</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
