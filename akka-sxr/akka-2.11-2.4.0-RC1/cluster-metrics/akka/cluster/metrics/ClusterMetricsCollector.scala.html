<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>cluster-metrics/akka/cluster/metrics/ClusterMetricsCollector.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
package akka.cluster.metrics

import akka.actor.Actor
import akka.actor.ActorLogging
import akka.actor.Props
import akka.actor.Address
import akka.cluster.InternalClusterAction
import akka.cluster.ClusterEvent
import akka.cluster.Member
import akka.cluster.Cluster
import scala.collection.immutable
import akka.cluster.MemberStatus
import scala.concurrent.forkjoin.ThreadLocalRandom
import akka.actor.Terminated
import akka.actor.DeadLetterSuppression

<span class="comment">/**
 *  Runtime collection management commands.
 */</span>
sealed abstract class <a title="class CollectionControlMessage extends AnyRef with Serializable" id="akka.cluster.metrics;CollectionControlMessage">CollectionControlMessage</a> extends <a href="#akka.cluster.metrics;CollectionControlMessage" title="Serializable">Serializable</a>

<span class="comment">/**
 * Command for [[ClusterMetricsSupervisor]] to start metrics collection.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
case object <a href="#akka.cluster.metrics.CollectionStartMessage.productElement.x$1" title="akka.cluster.metrics.CollectionStartMessage.type" id="akka.cluster.metrics.CollectionStartMessage.readResolve">CollectionStartMessage</a> extends <a href="#akka.cluster.metrics;CollectionControlMessage" title="akka.cluster.metrics.CollectionControlMessage">CollectionControlMessage</a> <span class="delimiter">{</span>
  <span class="comment">/** Java API */</span>
  def <a title="=&gt; akka.cluster.metrics.CollectionStartMessage.type" id="akka.cluster.metrics.CollectionStartMessage.getInstance">getInstance</a> = <a href="#akka.cluster.metrics.CollectionStartMessage.readResolve" title="akka.cluster.metrics.CollectionStartMessage.type">CollectionStartMessage</a>
<span class="delimiter">}</span>

<span class="comment">/**
 * Command for [[ClusterMetricsSupervisor]] to stop metrics collection.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
case object <a href="#akka.cluster.metrics.CollectionStopMessage.productElement.x$1" title="akka.cluster.metrics.CollectionStopMessage.type" id="akka.cluster.metrics.CollectionStopMessage.readResolve">CollectionStopMessage</a> extends <a href="#akka.cluster.metrics;CollectionControlMessage" title="akka.cluster.metrics.CollectionControlMessage">CollectionControlMessage</a> <span class="delimiter">{</span>
  <span class="comment">/** Java API */</span>
  def <a title="=&gt; akka.cluster.metrics.CollectionStopMessage.type" id="akka.cluster.metrics.CollectionStopMessage.getInstance">getInstance</a> = <a href="#akka.cluster.metrics.CollectionStopMessage.readResolve" title="akka.cluster.metrics.CollectionStopMessage.type">CollectionStopMessage</a>
<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API.
 *
 * Actor providing customizable metrics collection supervision.
 */</span>
private<span class="delimiter">[</span>metrics<span class="delimiter">]</span> class <a title="class ClusterMetricsSupervisor extends AnyRef with akka.actor.Actor with akka.actor.ActorLogging" id="akka.cluster.metrics;ClusterMetricsSupervisor">ClusterMetricsSupervisor</a> extends <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> with <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="delimiter">{</span>
  import <a href="ClusterMetricsExtension.scala.html#akka.cluster.metrics.ClusterMetricsExtension" title="akka.cluster.metrics.ClusterMetricsExtension.type">ClusterMetricsExtension</a>._
  val <a title="akka.cluster.metrics.ClusterMetricsExtension" id="akka.cluster.metrics;ClusterMetricsSupervisor.metrics">metrics</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.metrics.ClusterMetricsExtension">ClusterMetricsExtension</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>
  import <a href="#akka.cluster.metrics;ClusterMetricsSupervisor.metrics" title="=&gt; akka.cluster.metrics.ClusterMetricsExtension">metrics</a>.<a href="ClusterMetricsExtension.scala.html#akka.cluster.metrics;ClusterMetricsExtension.settings" title="=&gt; akka.cluster.metrics.ClusterMetricsSettings">settings</a>._
  import <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>._

  override val <a title="akka.actor.SupervisorStrategy" id="akka.cluster.metrics;ClusterMetricsSupervisor.supervisorStrategy">supervisorStrategy</a> = <a href="#akka.cluster.metrics;ClusterMetricsSupervisor.metrics" title="=&gt; akka.cluster.metrics.ClusterMetricsExtension">metrics</a>.<a href="ClusterMetricsExtension.scala.html#akka.cluster.metrics;ClusterMetricsExtension.strategy" title="=&gt; akka.actor.SupervisorStrategy">strategy</a>

  var <a title="Int" id="akka.cluster.metrics;ClusterMetricsSupervisor.collectorInstance_=">collectorInstance</a> = <span title="Int(0)" class="int">0</span>

  def <a title="=&gt; String" id="akka.cluster.metrics;ClusterMetricsSupervisor.collectorName">collectorName</a> = <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;collector-&quot;)">collector-$</span><span class="delimiter">{</span><a href="#akka.cluster.metrics;ClusterMetricsSupervisor.collectorInstance_=" title="=&gt; Int">collectorInstance</a><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;</span>

  override def <a title="()Unit" id="akka.cluster.metrics;ClusterMetricsSupervisor.preStart">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="ClusterMetricsSettings.scala.html#akka.cluster.metrics;ClusterMetricsSettings.CollectorEnabled" title="=&gt; Boolean">CollectorEnabled</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">self</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.metrics.CollectionStartMessage.readResolve" title="akka.cluster.metrics.CollectionStartMessage.type">CollectionStartMessage</a>
    <span class="delimiter">}</span> else <span class="delimiter">{</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.warning(cc2e600322)" title="(message: String)Unit">warning</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Metrics collection is disabled in configuration. Use subtypes of &quot;)">Metrics collection is disabled in configuration. Use subtypes of $</span><span class="delimiter">{</span>classOf<span title="Class[akka.cluster.metrics.CollectionControlMessage](classOf[akka.cluster.metrics.CollectionControlMessage])" class="delimiter">[</span>CollectionControlMessage<span class="delimiter">]</span>.<span title="()String">getName</span><span class="delimiter">}</span><span title="String(&quot; to manage collection at runtime.&quot;)" class="string"> to manage collection at runtime.&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  override def <a title="=&gt; PartialFunction[Any,Unit]" id="akka.cluster.metrics;ClusterMetricsSupervisor.receive">receive</a> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.metrics;ClusterMetricsSupervisor.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case <a href="#akka.cluster.metrics.CollectionStartMessage.readResolve" title="akka.cluster.metrics.CollectionStartMessage.type">CollectionStartMessage</a> ⇒
      <a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.children" title="=&gt; scala.collection.immutable.Iterable[akka.actor.ActorRef]">children</a>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a><span class="delimiter">)</span>
      <a href="#akka.cluster.metrics;ClusterMetricsSupervisor.collectorInstance_=" title="(x$1: Int)Unit">collectorInstance</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(874c98419a)" title="(props: akka.actor.Props, name: String)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.cluster.metrics.ClusterMetricsCollector](classOf[akka.cluster.metrics.ClusterMetricsCollector])" class="delimiter">[</span>ClusterMetricsCollector<span class="delimiter">]</span><span class="delimiter">)</span>, <a href="#akka.cluster.metrics;ClusterMetricsSupervisor.collectorName" title="=&gt; String">collectorName</a><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Collection started.&quot;)" class="string">Collection started.&quot;</span><span class="delimiter">)</span>
    case <a href="#akka.cluster.metrics.CollectionStopMessage.readResolve" title="akka.cluster.metrics.CollectionStopMessage.type">CollectionStopMessage</a> ⇒
      <a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.children" title="=&gt; scala.collection.immutable.Iterable[akka.actor.ActorRef]">children</a>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Collection stopped.&quot;)" class="string">Collection stopped.&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Local cluster metrics extension events.
 *
 * Published to local event bus subscribers by [[ClusterMetricsCollector]].
 */</span>
trait <a title="trait ClusterMetricsEvent extends AnyRef" id="akka.cluster.metrics;ClusterMetricsEvent">ClusterMetricsEvent</a>

<span class="comment">/**
 * Current snapshot of cluster node metrics.
 */</span>
final case class <a title="class ClusterMetricsChanged extends AnyRef with akka.cluster.metrics.ClusterMetricsEvent with Product with Serializable" id="akka.cluster.metrics.ClusterMetricsChanged.readResolve">ClusterMetricsChanged</a><span title="Product" class="delimiter">(</span><a title="Set[akka.cluster.metrics.NodeMetrics]" id="akka.cluster.metrics;ClusterMetricsChanged.nodeMetrics">nodeMetrics</a>: <span title="Set[akka.cluster.metrics.NodeMetrics]">Set</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span><span class="delimiter">)</span> extends <a href="#akka.cluster.metrics;ClusterMetricsEvent" title="akka.cluster.metrics.ClusterMetricsEvent">ClusterMetricsEvent</a> <span class="delimiter">{</span>
  <span class="comment">/** Java API */</span>
  def <a title="=&gt; Iterable[akka.cluster.metrics.NodeMetrics]" id="akka.cluster.metrics;ClusterMetricsChanged.getNodeMetrics">getNodeMetrics</a>: java.lang.<span title="Iterable[akka.cluster.metrics.NodeMetrics]">Iterable</span><span class="delimiter">[</span>NodeMetrics<span class="delimiter">]</span> =
    scala.collection.<span title="scala.collection.JavaConverters.type">JavaConverters</span>.<span title="(i: Iterable[akka.cluster.metrics.NodeMetrics])scala.collection.convert.Decorators.AsJava[Iterable[akka.cluster.metrics.NodeMetrics]]">asJavaIterableConverter</span><span class="delimiter">(</span><a href="#akka.cluster.metrics;ClusterMetricsChanged.nodeMetrics" title="=&gt; Set[akka.cluster.metrics.NodeMetrics]">nodeMetrics</a><span class="delimiter">)</span>.<span title="=&gt; Iterable[akka.cluster.metrics.NodeMetrics]">asJava</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API.
 *
 * Remote cluster metrics extension messages.
 *
 * Published to cluster members with metrics extension.
 */</span>
private<span class="delimiter">[</span>metrics<span class="delimiter">]</span> trait <a title="trait ClusterMetricsMessage extends AnyRef with Serializable" id="akka.cluster.metrics;ClusterMetricsMessage">ClusterMetricsMessage</a> extends <span title="Serializable">Serializable</span>

<span class="comment">/**
 * INTERNAL API.
 *
 * Envelope adding a sender address to the cluster metrics gossip.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
private<span class="delimiter">[</span>metrics<span class="delimiter">]</span> final case class <a title="class MetricsGossipEnvelope extends AnyRef with akka.cluster.metrics.ClusterMetricsMessage with akka.actor.DeadLetterSuppression with Product with Serializable" id="akka.cluster.metrics.MetricsGossipEnvelope.readResolve">MetricsGossipEnvelope</a><span title="Product" class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.metrics;MetricsGossipEnvelope.from">from</a>: <a href="../../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a>, <a title="akka.cluster.metrics.MetricsGossip" id="akka.cluster.metrics;MetricsGossipEnvelope.gossip">gossip</a>: <a href="Metric.scala.html#akka.cluster.metrics;MetricsGossip" title="akka.cluster.metrics.MetricsGossip">MetricsGossip</a>, <a title="Boolean" id="akka.cluster.metrics;MetricsGossipEnvelope.reply">reply</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> extends <a href="#akka.cluster.metrics;ClusterMetricsMessage" title="akka.cluster.metrics.ClusterMetricsMessage">ClusterMetricsMessage</a>
  with <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;DeadLetterSuppression" title="akka.actor.DeadLetterSuppression">DeadLetterSuppression</a>

<span class="comment">/**
 * INTERNAL API.
 *
 * Actor responsible for periodic data sampling in the node and publication to the cluster.
 */</span>
private<span class="delimiter">[</span>metrics<span class="delimiter">]</span> class <a title="class ClusterMetricsCollector extends AnyRef with akka.actor.Actor with akka.actor.ActorLogging" id="akka.cluster.metrics;ClusterMetricsCollector">ClusterMetricsCollector</a> extends <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> with <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="delimiter">{</span>
  import <a href="../../../../cluster/akka/cluster/ClusterDaemon.scala.html#akka.cluster.InternalClusterAction" title="akka.cluster.InternalClusterAction.type">InternalClusterAction</a>._
  <span class="comment">// TODO collapse to ClusterEvent._ after akka-cluster metrics is gone</span>
  import <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.MemberEvent
  import <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.MemberUp
  import <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.MemberRemoved
  import <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.MemberExited
  import <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.ReachabilityEvent
  import <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.ReachableMember
  import <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.UnreachableMember
  import <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.CurrentClusterState
  import <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.Member" title="akka.cluster.Member.type">Member</a>.addressOrdering
  import <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher
  val <a title="akka.cluster.Cluster" id="akka.cluster.metrics;ClusterMetricsCollector.cluster">cluster</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>
  import <a href="#akka.cluster.metrics;ClusterMetricsCollector.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<span class="delimiter">{</span> selfAddress, scheduler, settings <span class="delimiter">}</span>
  import <a href="#akka.cluster.metrics;ClusterMetricsCollector.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.InfoLogger" title="ClusterMetricsCollector.this.cluster.InfoLogger.type">InfoLogger</a>._
  val <a title="akka.cluster.metrics.ClusterMetricsExtension" id="akka.cluster.metrics;ClusterMetricsCollector.metrics">metrics</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.metrics.ClusterMetricsExtension">ClusterMetricsExtension</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>
  import <a href="#akka.cluster.metrics;ClusterMetricsCollector.metrics" title="=&gt; akka.cluster.metrics.ClusterMetricsExtension">metrics</a>.<a href="ClusterMetricsExtension.scala.html#akka.cluster.metrics;ClusterMetricsExtension.settings" title="=&gt; akka.cluster.metrics.ClusterMetricsSettings">settings</a>._

  <span class="comment">/**
   * The node ring gossipped that contains only members that are Up.
   */</span>
  var <a title="scala.collection.immutable.SortedSet[akka.actor.Address]" id="akka.cluster.metrics;ClusterMetricsCollector.nodes_=">nodes</a>: immutable.<span title="scala.collection.immutable.SortedSet[akka.actor.Address]">SortedSet</span><span class="delimiter">[</span>Address<span class="delimiter">]</span> = immutable.<span title="scala.collection.immutable.SortedSet.type">SortedSet</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.Member.addressOrdering" title="(implicit ord: Ordering[akka.actor.Address])scala.collection.immutable.SortedSet[akka.actor.Address]">empty</a>

  <span class="comment">/**
   * The latest metric values with their statistical data.
   */</span>
  var <a title="akka.cluster.metrics.MetricsGossip" id="akka.cluster.metrics;ClusterMetricsCollector.latestGossip_=">latestGossip</a>: <a href="Metric.scala.html#akka.cluster.metrics;MetricsGossip" title="akka.cluster.metrics.MetricsGossip">MetricsGossip</a> = <a href="Metric.scala.html#akka.cluster.metrics.MetricsGossip" title="akka.cluster.metrics.MetricsGossip.type">MetricsGossip</a>.<a href="Metric.scala.html#akka.cluster.metrics.MetricsGossip.empty" title="=&gt; akka.cluster.metrics.MetricsGossip">empty</a>

  <span class="comment">/**
   * The metrics collector that samples data on the node.
   */</span>
  val <a title="akka.cluster.metrics.MetricsCollector" id="akka.cluster.metrics;ClusterMetricsCollector.collector">collector</a>: <a href="MetricsCollector.scala.html#akka.cluster.metrics;MetricsCollector" title="akka.cluster.metrics.MetricsCollector">MetricsCollector</a> = <a href="MetricsCollector.scala.html#akka.cluster.metrics.MetricsCollector.apply" title="(system: akka.actor.ActorSystem)akka.cluster.metrics.MetricsCollector">MetricsCollector</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Start periodic gossip to random nodes in cluster
   */</span>
  val <a title="akka.actor.Cancellable" id="akka.cluster.metrics;ClusterMetricsCollector.gossipTask">gossipTask</a> = <a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.schedule(abf8206fc2)" title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">schedule</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="ClusterMetricsSettings.scala.html#akka.cluster.metrics;ClusterMetricsSettings.PeriodicTasksInitialDelay" title="=&gt; scala.concurrent.duration.FiniteDuration">PeriodicTasksInitialDelay</a> <span title="(other: scala.concurrent.duration.FiniteDuration)scala.concurrent.duration.FiniteDuration">max</span> <a href="ClusterMetricsSettings.scala.html#akka.cluster.metrics;ClusterMetricsSettings.CollectorGossipInterval" title="=&gt; scala.concurrent.duration.FiniteDuration">CollectorGossipInterval</a>,
    <a href="ClusterMetricsSettings.scala.html#akka.cluster.metrics;ClusterMetricsSettings.CollectorGossipInterval" title="=&gt; scala.concurrent.duration.FiniteDuration">CollectorGossipInterval</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="../../../../cluster/akka/cluster/ClusterDaemon.scala.html#akka.cluster.InternalClusterAction.GossipTick" title="akka.cluster.InternalClusterAction.GossipTick.type">GossipTick</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Start periodic metrics collection
   */</span>
  val <a title="akka.actor.Cancellable" id="akka.cluster.metrics;ClusterMetricsCollector.sampleTask">sampleTask</a> = <a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.schedule(abf8206fc2)" title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">schedule</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="ClusterMetricsSettings.scala.html#akka.cluster.metrics;ClusterMetricsSettings.PeriodicTasksInitialDelay" title="=&gt; scala.concurrent.duration.FiniteDuration">PeriodicTasksInitialDelay</a> <span title="(other: scala.concurrent.duration.FiniteDuration)scala.concurrent.duration.FiniteDuration">max</span> <a href="ClusterMetricsSettings.scala.html#akka.cluster.metrics;ClusterMetricsSettings.CollectorSampleInterval" title="=&gt; scala.concurrent.duration.FiniteDuration">CollectorSampleInterval</a>,
    <a href="ClusterMetricsSettings.scala.html#akka.cluster.metrics;ClusterMetricsSettings.CollectorSampleInterval" title="=&gt; scala.concurrent.duration.FiniteDuration">CollectorSampleInterval</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="../../../../cluster/akka/cluster/ClusterDaemon.scala.html#akka.cluster.InternalClusterAction.MetricsTick" title="akka.cluster.InternalClusterAction.MetricsTick.type">MetricsTick</a><span class="delimiter">)</span>

  override def <a title="()Unit" id="akka.cluster.metrics;ClusterMetricsCollector.preStart">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.metrics;ClusterMetricsCollector.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.subscribe(6cfb44d410)" title="(subscriber: akka.actor.ActorRef, to: Class[_]*)Unit">subscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, classOf<span title="Class[akka.cluster.ClusterEvent.MemberEvent](classOf[akka.cluster.ClusterEvent$$MemberEvent])" class="delimiter">[</span>MemberEvent<span class="delimiter">]</span>, classOf<span title="Class[akka.cluster.ClusterEvent.ReachabilityEvent](classOf[akka.cluster.ClusterEvent$$ReachabilityEvent])" class="delimiter">[</span>ReachabilityEvent<span class="delimiter">]</span><span class="delimiter">)</span>
    <a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.InfoLogger.logInfo(cc2e600322)" title="(message: String)Unit">logInfo</a><span class="delimiter">(</span><span title="String(&quot;Metrics collection has started successfully&quot;)" class="string">&quot;Metrics collection has started successfully&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="=&gt; PartialFunction[Any,Unit]" id="akka.cluster.metrics;ClusterMetricsCollector.receive">receive</a> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.metrics;ClusterMetricsCollector.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case <a href="../../../../cluster/akka/cluster/ClusterDaemon.scala.html#akka.cluster.InternalClusterAction.GossipTick" title="akka.cluster.InternalClusterAction.GossipTick.type">GossipTick</a>                 ⇒ <a href="#akka.cluster.metrics;ClusterMetricsCollector.gossip" title="()Unit">gossip</a><span title="Boolean(true)" class="delimiter">(</span><span class="delimiter">)</span>
    case <a href="../../../../cluster/akka/cluster/ClusterDaemon.scala.html#akka.cluster.InternalClusterAction.MetricsTick" title="akka.cluster.InternalClusterAction.MetricsTick.type">MetricsTick</a>                ⇒ <a href="#akka.cluster.metrics;ClusterMetricsCollector.sample" title="()Unit">sample</a><span title="Boolean(true)" class="delimiter">(</span><span class="delimiter">)</span>
    case <a title="akka.cluster.metrics.MetricsGossipEnvelope" id="akka.cluster.metrics;ClusterMetricsCollector.receive;$anonfun.isDefinedAt.msg">msg</a>: <a href="#akka.cluster.metrics.MetricsGossipEnvelope.readResolve" title="akka.cluster.metrics.MetricsGossipEnvelope">MetricsGossipEnvelope</a> ⇒ <a href="#akka.cluster.metrics;ClusterMetricsCollector.receiveGossip" title="(envelope: akka.cluster.metrics.MetricsGossipEnvelope)Unit">receiveGossip</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.cluster.metrics;ClusterMetricsCollector.receive;$anonfun.isDefinedAt.msg" title="akka.cluster.metrics.MetricsGossipEnvelope">msg</a><span class="delimiter">)</span>
    case <a title="akka.cluster.ClusterEvent.CurrentClusterState" id="akka.cluster.metrics;ClusterMetricsCollector.receive;$anonfun.isDefinedAt.state">state</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState" title="akka.cluster.ClusterEvent.CurrentClusterState">CurrentClusterState</a> ⇒ <a href="#akka.cluster.metrics;ClusterMetricsCollector.receiveState" title="(state: akka.cluster.ClusterEvent.CurrentClusterState)Unit">receiveState</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.cluster.metrics;ClusterMetricsCollector.receive;$anonfun.isDefinedAt.state" title="akka.cluster.ClusterEvent.CurrentClusterState">state</a><span class="delimiter">)</span>
    case MemberUp<span class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span>                ⇒ <a href="#akka.cluster.metrics;ClusterMetricsCollector.addMember" title="(member: akka.cluster.Member)Unit">addMember</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span>
    case MemberRemoved<span class="delimiter">(</span><span title="akka.cluster.Member">m</span>, _<span class="delimiter">)</span>        ⇒ <a href="#akka.cluster.metrics;ClusterMetricsCollector.removeMember" title="(member: akka.cluster.Member)Unit">removeMember</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span>
    case MemberExited<span class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span>            ⇒ <a href="#akka.cluster.metrics;ClusterMetricsCollector.removeMember" title="(member: akka.cluster.Member)Unit">removeMember</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span>
    case UnreachableMember<span class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span>       ⇒ <a href="#akka.cluster.metrics;ClusterMetricsCollector.removeMember" title="(member: akka.cluster.Member)Unit">removeMember</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span>
    case ReachableMember<span class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span>         ⇒ if <span class="delimiter">(</span><span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.status" title="=&gt; akka.cluster.MemberStatus">status</a> <span title="(x$1: Any)Boolean">==</span> <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.MemberStatus" title="akka.cluster.MemberStatus.type">MemberStatus</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.MemberStatus.Up" title="akka.cluster.MemberStatus.Up.type">Up</a><span class="delimiter">)</span> <a href="#akka.cluster.metrics;ClusterMetricsCollector.addMember" title="(member: akka.cluster.Member)Unit">addMember</a><span class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span>
    case _: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;MemberEvent" title="akka.cluster.ClusterEvent.MemberEvent">MemberEvent</a>             ⇒ <span class="comment">// not interested in other types of MemberEvent</span>

  <span class="delimiter">}</span>

  override def <a title="()Unit" id="akka.cluster.metrics;ClusterMetricsCollector.postStop">postStop</a>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.metrics;ClusterMetricsCollector.cluster" title="=&gt; akka.cluster.Cluster">cluster</a> <a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.unsubscribe(134bd64d81)" title="(subscriber: akka.actor.ActorRef)Unit">unsubscribe</a> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>
    <a href="#akka.cluster.metrics;ClusterMetricsCollector.gossipTask" title="=&gt; akka.actor.Cancellable">gossipTask</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Cancellable.cancel" title="()Boolean">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.cluster.metrics;ClusterMetricsCollector.sampleTask" title="=&gt; akka.actor.Cancellable">sampleTask</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Cancellable.cancel" title="()Boolean">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.cluster.metrics;ClusterMetricsCollector.collector" title="=&gt; akka.cluster.metrics.MetricsCollector">collector</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Adds a member to the node ring.
   */</span>
  def <a title="(member: akka.cluster.Member)Unit" id="akka.cluster.metrics;ClusterMetricsCollector.addMember">addMember</a><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.cluster.metrics;ClusterMetricsCollector.addMember.member">member</a>: <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member" title="akka.cluster.Member">Member</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.cluster.metrics;ClusterMetricsCollector.nodes_=" title="(x$1: scala.collection.immutable.SortedSet[akka.actor.Address])Unit">nodes</a> <span title="(elem: akka.actor.Address)scala.collection.immutable.SortedSet[akka.actor.Address]">+=</span> <a href="#akka.cluster.metrics;ClusterMetricsCollector.addMember.member" title="akka.cluster.Member">member</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a>

  <span class="comment">/**
   * Removes a member from the member node ring.
   */</span>
  def <a title="(member: akka.cluster.Member)Unit" id="akka.cluster.metrics;ClusterMetricsCollector.removeMember">removeMember</a><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.cluster.metrics;ClusterMetricsCollector.removeMember.member">member</a>: <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member" title="akka.cluster.Member">Member</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.metrics;ClusterMetricsCollector.nodes_=" title="(x$1: scala.collection.immutable.SortedSet[akka.actor.Address])Unit">nodes</a> <span title="(elem: akka.actor.Address)scala.collection.immutable.SortedSet[akka.actor.Address]">-=</span> <a href="#akka.cluster.metrics;ClusterMetricsCollector.removeMember.member" title="akka.cluster.Member">member</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a>
    <a href="#akka.cluster.metrics;ClusterMetricsCollector.latestGossip_=" title="(x$1: akka.cluster.metrics.MetricsGossip)Unit">latestGossip</a> = <a href="#akka.cluster.metrics;ClusterMetricsCollector.latestGossip_=" title="=&gt; akka.cluster.metrics.MetricsGossip">latestGossip</a> <a href="Metric.scala.html#akka.cluster.metrics;MetricsGossip.remove" title="(node: akka.actor.Address)akka.cluster.metrics.MetricsGossip">remove</a> <a href="#akka.cluster.metrics;ClusterMetricsCollector.removeMember.member" title="akka.cluster.Member">member</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a>
    <a href="#akka.cluster.metrics;ClusterMetricsCollector.publish" title="()Unit">publish</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Updates the initial node ring for those nodes that are [[akka.cluster.MemberStatus]] `Up`.
   */</span>
  def <a title="(state: akka.cluster.ClusterEvent.CurrentClusterState)Unit" id="akka.cluster.metrics;ClusterMetricsCollector.receiveState">receiveState</a><span class="delimiter">(</span><a title="akka.cluster.ClusterEvent.CurrentClusterState" id="akka.cluster.metrics;ClusterMetricsCollector.receiveState.state">state</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState" title="akka.cluster.ClusterEvent.CurrentClusterState">CurrentClusterState</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.cluster.metrics;ClusterMetricsCollector.nodes_=" title="(x$1: scala.collection.immutable.SortedSet[akka.actor.Address])Unit">nodes</a> = <span class="delimiter">(</span><a href="#akka.cluster.metrics;ClusterMetricsCollector.receiveState.state" title="akka.cluster.ClusterEvent.CurrentClusterState">state</a>.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState.members" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">members</a> <span title="(xs: scala.collection.GenTraversableOnce[akka.cluster.Member])scala.collection.immutable.SortedSet[akka.cluster.Member]">--</span> <a href="#akka.cluster.metrics;ClusterMetricsCollector.receiveState.state" title="akka.cluster.ClusterEvent.CurrentClusterState">state</a>.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState.unreachable" title="=&gt; Set[akka.cluster.Member]">unreachable</a><span class="delimiter">)</span> <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.Member.addressOrdering" title="(pf: PartialFunction[akka.cluster.Member,akka.actor.Address])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.SortedSet[akka.cluster.Member],akka.actor.Address,scala.collection.immutable.SortedSet[akka.actor.Address]])scala.collection.immutable.SortedSet[akka.actor.Address]">collect</a> <a title="&lt;$anon: akka.cluster.Member =&gt; akka.actor.Address&gt; extends scala.runtime.AbstractPartialFunction[akka.cluster.Member,akka.actor.Address] with Serializable" id="akka.cluster.metrics;ClusterMetricsCollector.receiveState;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a> case <a title="akka.cluster.Member" id="akka.cluster.metrics;ClusterMetricsCollector.receiveState;$anonfun.isDefinedAt.m">m</a> if <a href="#akka.cluster.metrics;ClusterMetricsCollector.receiveState;$anonfun.isDefinedAt.m" title="akka.cluster.Member">m</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.status" title="=&gt; akka.cluster.MemberStatus">status</a> <span title="(x$1: Any)Boolean">==</span> <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.MemberStatus" title="akka.cluster.MemberStatus.type">MemberStatus</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.MemberStatus.Up" title="akka.cluster.MemberStatus.Up.type">Up</a> ⇒ <a href="#akka.cluster.metrics;ClusterMetricsCollector.receiveState;$anonfun.isDefinedAt.m" title="akka.cluster.Member">m</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a> <span class="delimiter">}</span>

  <span class="comment">/**
   * Samples the latest metrics for the node, updates metrics statistics in
   * [[MetricsGossip]], and publishes the change to the event bus.
   *
   * @see [[MetricsCollector]]
   */</span>
  def <a title="()Unit" id="akka.cluster.metrics;ClusterMetricsCollector.sample">sample</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.metrics;ClusterMetricsCollector.latestGossip_=" title="(x$1: akka.cluster.metrics.MetricsGossip)Unit">latestGossip</a> <a href="Metric.scala.html#akka.cluster.metrics;MetricsGossip.:+" title="(newNodeMetrics: akka.cluster.metrics.NodeMetrics)akka.cluster.metrics.MetricsGossip">:+=</a> <a href="#akka.cluster.metrics;ClusterMetricsCollector.collector" title="=&gt; akka.cluster.metrics.MetricsCollector">collector</a>.<a href="MetricsCollector.scala.html#akka.cluster.metrics;MetricsCollector.sample" title="()akka.cluster.metrics.NodeMetrics">sample</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.cluster.metrics;ClusterMetricsCollector.publish" title="()Unit">publish</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Receives changes from peer nodes, merges remote with local gossip nodes, then publishes
   * changes to the event stream for load balancing router consumption, and gossip back.
   */</span>
  def <a title="(envelope: akka.cluster.metrics.MetricsGossipEnvelope)Unit" id="akka.cluster.metrics;ClusterMetricsCollector.receiveGossip">receiveGossip</a><span class="delimiter">(</span><a title="akka.cluster.metrics.MetricsGossipEnvelope" id="akka.cluster.metrics;ClusterMetricsCollector.receiveGossip.envelope">envelope</a>: <a href="#akka.cluster.metrics.MetricsGossipEnvelope.readResolve" title="akka.cluster.metrics.MetricsGossipEnvelope">MetricsGossipEnvelope</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="comment">// remote node might not have same view of member nodes, this side should only care</span>
    <span class="comment">// about nodes that are known here, otherwise removed nodes can come back</span>
    val <a title="akka.cluster.metrics.MetricsGossip" id="akka.cluster.metrics;ClusterMetricsCollector.receiveGossip.otherGossip">otherGossip</a> = <a href="#akka.cluster.metrics;ClusterMetricsCollector.receiveGossip.envelope" title="akka.cluster.metrics.MetricsGossipEnvelope">envelope</a>.<a href="#akka.cluster.metrics;MetricsGossipEnvelope.gossip" title="=&gt; akka.cluster.metrics.MetricsGossip">gossip</a>.<a href="Metric.scala.html#akka.cluster.metrics;MetricsGossip.filter" title="(includeNodes: Set[akka.actor.Address])akka.cluster.metrics.MetricsGossip">filter</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;ClusterMetricsCollector.nodes_=" title="=&gt; scala.collection.immutable.SortedSet[akka.actor.Address]">nodes</a><span class="delimiter">)</span>
    <a href="#akka.cluster.metrics;ClusterMetricsCollector.latestGossip_=" title="(x$1: akka.cluster.metrics.MetricsGossip)Unit">latestGossip</a> = <a href="#akka.cluster.metrics;ClusterMetricsCollector.latestGossip_=" title="=&gt; akka.cluster.metrics.MetricsGossip">latestGossip</a> <a href="Metric.scala.html#akka.cluster.metrics;MetricsGossip.merge" title="(otherGossip: akka.cluster.metrics.MetricsGossip)akka.cluster.metrics.MetricsGossip">merge</a> <a href="#akka.cluster.metrics;ClusterMetricsCollector.receiveGossip.otherGossip" title="akka.cluster.metrics.MetricsGossip">otherGossip</a>
    <span class="comment">// changes will be published in the period collect task</span>
    if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.metrics;ClusterMetricsCollector.receiveGossip.envelope" title="akka.cluster.metrics.MetricsGossipEnvelope">envelope</a>.<a href="#akka.cluster.metrics;MetricsGossipEnvelope.reply" title="=&gt; Boolean">reply</a><span class="delimiter">)</span>
      <a href="#akka.cluster.metrics;ClusterMetricsCollector.replyGossipTo" title="(address: akka.actor.Address)Unit">replyGossipTo</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;ClusterMetricsCollector.receiveGossip.envelope" title="akka.cluster.metrics.MetricsGossipEnvelope">envelope</a>.<a href="#akka.cluster.metrics;MetricsGossipEnvelope.from" title="=&gt; akka.actor.Address">from</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Gossip to peer nodes.
   */</span>
  def <a title="()Unit" id="akka.cluster.metrics;ClusterMetricsCollector.gossip">gossip</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.cluster.metrics;ClusterMetricsCollector.selectRandomNode" title="(addresses: scala.collection.immutable.IndexedSeq[akka.actor.Address])Option[akka.actor.Address]">selectRandomNode</a><span class="delimiter">(</span><span class="delimiter">(</span><a href="#akka.cluster.metrics;ClusterMetricsCollector.nodes_=" title="=&gt; scala.collection.immutable.SortedSet[akka.actor.Address]">nodes</a> <span title="(elem: akka.actor.Address)scala.collection.immutable.SortedSet[akka.actor.Address]">-</span> <a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a><span class="delimiter">)</span>.<span title="=&gt; Vector[akka.actor.Address]">toVector</span><span class="delimiter">)</span> <span title="(f: akka.actor.Address =&gt; Unit)Unit">foreach</span> <a href="#akka.cluster.metrics;ClusterMetricsCollector.gossipTo" title="(address: akka.actor.Address)Unit">gossipTo</a>

  def <a title="(address: akka.actor.Address)Unit" id="akka.cluster.metrics;ClusterMetricsCollector.gossipTo">gossipTo</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.metrics;ClusterMetricsCollector.gossipTo.address">address</a>: <a href="../../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.cluster.metrics;ClusterMetricsCollector.sendGossip" title="(address: akka.actor.Address, envelope: akka.cluster.metrics.MetricsGossipEnvelope)Unit">sendGossip</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;ClusterMetricsCollector.gossipTo.address" title="akka.actor.Address">address</a>, <a href="#akka.cluster.metrics.MetricsGossipEnvelope.readResolve" title="(from: akka.actor.Address, gossip: akka.cluster.metrics.MetricsGossip, reply: Boolean)akka.cluster.metrics.MetricsGossipEnvelope">MetricsGossipEnvelope</a><span class="delimiter">(</span><a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a>, <a href="#akka.cluster.metrics;ClusterMetricsCollector.latestGossip_=" title="=&gt; akka.cluster.metrics.MetricsGossip">latestGossip</a>, reply = false<span class="delimiter">)</span><span class="delimiter">)</span>

  def <a title="(address: akka.actor.Address)Unit" id="akka.cluster.metrics;ClusterMetricsCollector.replyGossipTo">replyGossipTo</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.metrics;ClusterMetricsCollector.replyGossipTo.address">address</a>: <a href="../../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.cluster.metrics;ClusterMetricsCollector.sendGossip" title="(address: akka.actor.Address, envelope: akka.cluster.metrics.MetricsGossipEnvelope)Unit">sendGossip</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;ClusterMetricsCollector.replyGossipTo.address" title="akka.actor.Address">address</a>, <a href="#akka.cluster.metrics.MetricsGossipEnvelope.readResolve" title="(from: akka.actor.Address, gossip: akka.cluster.metrics.MetricsGossip, reply: Boolean)akka.cluster.metrics.MetricsGossipEnvelope">MetricsGossipEnvelope</a><span class="delimiter">(</span><a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a>, <a href="#akka.cluster.metrics;ClusterMetricsCollector.latestGossip_=" title="=&gt; akka.cluster.metrics.MetricsGossip">latestGossip</a>, reply = true<span class="delimiter">)</span><span class="delimiter">)</span>

  def <a title="(address: akka.actor.Address, envelope: akka.cluster.metrics.MetricsGossipEnvelope)Unit" id="akka.cluster.metrics;ClusterMetricsCollector.sendGossip">sendGossip</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.cluster.metrics;ClusterMetricsCollector.sendGossip.address">address</a>: <a href="../../../../actor/akka/actor/Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a>, <a title="akka.cluster.metrics.MetricsGossipEnvelope" id="akka.cluster.metrics;ClusterMetricsCollector.sendGossip.envelope">envelope</a>: <a href="#akka.cluster.metrics.MetricsGossipEnvelope.readResolve" title="akka.cluster.metrics.MetricsGossipEnvelope">MetricsGossipEnvelope</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorSelection(271eeb39be)" title="(path: String)akka.actor.ActorSelection">actorSelection</a><a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor.ActorSelection.toScala" title="implicit akka.actor.ActorSelection.toScala : (sel: akka.actor.ActorSelection)akka.actor.ScalaActorSelection" class="delimiter">(</a><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.toStringWithAddress" title="(address: akka.actor.Address)String">toStringWithAddress</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;ClusterMetricsCollector.sendGossip.address" title="akka.actor.Address">address</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor;ScalaActorSelection.!" title="(msg: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.metrics;ClusterMetricsCollector.sendGossip.envelope" title="akka.cluster.metrics.MetricsGossipEnvelope">envelope</a>

  def <a title="(addresses: scala.collection.immutable.IndexedSeq[akka.actor.Address])Option[akka.actor.Address]" id="akka.cluster.metrics;ClusterMetricsCollector.selectRandomNode">selectRandomNode</a><span class="delimiter">(</span><a title="scala.collection.immutable.IndexedSeq[akka.actor.Address]" id="akka.cluster.metrics;ClusterMetricsCollector.selectRandomNode.addresses">addresses</a>: immutable.<span title="scala.collection.immutable.IndexedSeq[akka.actor.Address]">IndexedSeq</span><span class="delimiter">[</span>Address<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[akka.actor.Address]">Option</span><span class="delimiter">[</span>Address<span class="delimiter">]</span> =
    if <span class="delimiter">(</span><a href="#akka.cluster.metrics;ClusterMetricsCollector.selectRandomNode.addresses" title="scala.collection.immutable.IndexedSeq[akka.actor.Address]">addresses</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="None.type">None</span> else <span title="(x: akka.actor.Address)Some[akka.actor.Address]">Some</span><span class="delimiter">(</span><a href="#akka.cluster.metrics;ClusterMetricsCollector.selectRandomNode.addresses" title="(idx: Int)akka.actor.Address">addresses</a><span class="delimiter">(</span><span title="scala.concurrent.forkjoin.ThreadLocalRandom.type">ThreadLocalRandom</span>.<span title="()scala.concurrent.forkjoin.ThreadLocalRandom">current</span> <span title="(x$1: Int)Int">nextInt</span> <a href="#akka.cluster.metrics;ClusterMetricsCollector.selectRandomNode.addresses" title="scala.collection.immutable.IndexedSeq[akka.actor.Address]">addresses</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Publishes to the event stream.
   */</span>
  def <a title="()Unit" id="akka.cluster.metrics;ClusterMetricsCollector.publish">publish</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.eventStream" title="=&gt; akka.event.EventStream">eventStream</a> <a href="../../../../actor/akka/event/EventBus.scala.html#akka.event;SubchannelClassification.publish(de973626dc)" title="(event: Object)Unit">publish</a> <a href="#akka.cluster.metrics.ClusterMetricsChanged.readResolve" title="(nodeMetrics: Set[akka.cluster.metrics.NodeMetrics])akka.cluster.metrics.ClusterMetricsChanged">ClusterMetricsChanged</a><span class="delimiter">(</span><a href="#akka.cluster.metrics;ClusterMetricsCollector.latestGossip_=" title="=&gt; akka.cluster.metrics.MetricsGossip">latestGossip</a>.<a href="Metric.scala.html#akka.cluster.metrics;MetricsGossip.nodes" title="=&gt; Set[akka.cluster.metrics.NodeMetrics]">nodes</a><span class="delimiter">)</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
