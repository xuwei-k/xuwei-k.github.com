<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>actor/akka/io/UdpConnection.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
package akka.io

import java.net.InetSocketAddress
import java.nio.ByteBuffer
import java.nio.channels.DatagramChannel
import java.nio.channels.<span title="java.nio.channels.SelectionKey.type">SelectionKey</span>._
import scala.annotation.tailrec
import scala.util.control.NonFatal
import akka.actor.<span class="delimiter">{</span> Actor, ActorLogging, ActorRef <span class="delimiter">}</span>
import akka.dispatch.<span class="delimiter">{</span> UnboundedMessageQueueSemantics, RequiresMessageQueue <span class="delimiter">}</span>
import akka.util.ByteString
import akka.io.<a href="SelectionHandler.scala.html#akka.io.SelectionHandler" title="akka.io.SelectionHandler.type">SelectionHandler</a>._
import akka.io.<a href="UdpConnected.scala.html#akka.io.UdpConnected" title="akka.io.UdpConnected.type">UdpConnected</a>._

<span class="comment">/**
 * INTERNAL API
 */</span>
private<span class="delimiter">[</span>io<span class="delimiter">]</span> class <a title="class UdpConnection extends AnyRef with akka.actor.Actor with akka.actor.ActorLogging with akka.dispatch.RequiresMessageQueue[akka.dispatch.UnboundedMessageQueueSemantics]" id="akka.io;UdpConnection">UdpConnection</a><a href="#akka.io;UdpConnection" title="akka.io.UdpConnection" class="delimiter">(</a><a title="akka.io.UdpConnectedExt" id="akka.io;UdpConnection.udpConn">udpConn</a>: <a href="UdpConnected.scala.html#akka.io;UdpConnectedExt" title="akka.io.UdpConnectedExt">UdpConnectedExt</a>,
                                <a title="akka.io.ChannelRegistry" id="akka.io;UdpConnection.channelRegistry">channelRegistry</a>: <a href="SelectionHandler.scala.html#akka.io;ChannelRegistry" title="akka.io.ChannelRegistry">ChannelRegistry</a>,
                                <a title="akka.actor.ActorRef" id="akka.io;UdpConnection.commander">commander</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>,
                                <a title="akka.io.UdpConnected.Connect" id="akka.io;UdpConnection.connect">connect</a>: <a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect" title="akka.io.UdpConnected.Connect">Connect</a><span class="delimiter">)</span>
  extends <a href="../actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> with <a href="../actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> with <a href="../dispatch/Mailbox.scala.html#akka.dispatch;RequiresMessageQueue" title="akka.dispatch.RequiresMessageQueue[akka.dispatch.UnboundedMessageQueueSemantics]">RequiresMessageQueue</a><span class="delimiter">[</span>UnboundedMessageQueueSemantics<span class="delimiter">]</span> <span class="delimiter">{</span>

  import <a href="#akka.io;UdpConnection.connect" title="akka.io.UdpConnected.Connect">connect</a>._
  import <a href="#akka.io;UdpConnection.udpConn" title="akka.io.UdpConnectedExt">udpConn</a>._
  import <a href="#akka.io;UdpConnection.udpConn" title="akka.io.UdpConnectedExt">udpConn</a>.<a href="UdpConnected.scala.html#akka.io;UdpConnectedExt.settings" title="=&gt; akka.io.Udp.UdpSettings">settings</a>._

  var <a title="(akka.io.UdpConnected.Send, akka.actor.ActorRef)" id="akka.io;UdpConnection.pendingSend_=">pendingSend</a>: <span title="(akka.io.UdpConnected.Send, akka.actor.ActorRef)" class="delimiter">(</span>Send, ActorRef<span class="delimiter">)</span> = null
  def <a title="=&gt; Boolean" id="akka.io;UdpConnection.writePending">writePending</a> = <a href="#akka.io;UdpConnection.pendingSend_=" title="=&gt; (akka.io.UdpConnected.Send, akka.actor.ActorRef)">pendingSend</a> <span title="(x$1: AnyRef)Boolean">ne</span> null

  <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.handler" title="=&gt; akka.actor.ActorRef">handler</a><span class="delimiter">)</span> <span class="comment">// sign death pact</span>
  var <a title="java.nio.channels.DatagramChannel" id="akka.io;UdpConnection.channel_=">channel</a>: <span title="java.nio.channels.DatagramChannel">DatagramChannel</span> = null

  if <span class="delimiter">(</span><a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.remoteAddress" title="=&gt; java.net.InetSocketAddress">remoteAddress</a>.<span title="()Boolean">isUnresolved</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="Dns.scala.html#akka.io.Dns" title="akka.io.Dns.type">Dns</a>.<a href="Dns.scala.html#akka.io.Dns.resolve" title="(name: String)(system: akka.actor.ActorSystem, sender: akka.actor.ActorRef)Option[akka.io.Dns.Resolved]">resolve</a><span class="delimiter">(</span><a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.remoteAddress" title="=&gt; java.net.InetSocketAddress">remoteAddress</a>.<span title="()String">getHostName</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>, <a href="../actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="akka.io.Dns.Resolved" id="akka.io;UdpConnection.<local UdpConnection>.r">r</a><span class="delimiter">)</span> ⇒
        <a href="#akka.io;UdpConnection.doConnect" title="(address: java.net.InetSocketAddress)Unit">doConnect</a><span class="delimiter">(</span>new <span title="java.net.InetSocketAddress">InetSocketAddress</span><span class="delimiter">(</span><a href="#akka.io;UdpConnection.<local UdpConnection>.r" title="akka.io.Dns.Resolved">r</a>.<a href="Dns.scala.html#akka.io.Dns;Resolved.addr" title="=&gt; java.net.InetAddress">addr</a>, <a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.remoteAddress" title="=&gt; java.net.InetSocketAddress">remoteAddress</a>.<span title="()Int">getPort</span><span class="delimiter">)</span><span class="delimiter">)</span>
      case <span title="None.type">None</span> ⇒
        <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.become(771101a7b6)" title="(behavior: akka.actor.Actor.Receive, discardOld: Boolean)Unit">become</a><span class="delimiter">(</span><a href="#akka.io;UdpConnection.resolving" title="()UdpConnection.this.Receive">resolving</a><span class="delimiter">(</span><span class="delimiter">)</span>, discardOld = true<span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span> else <span class="delimiter">{</span>
    <a href="#akka.io;UdpConnection.doConnect" title="(address: java.net.InetSocketAddress)Unit">doConnect</a><span class="delimiter">(</span><a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.remoteAddress" title="=&gt; java.net.InetSocketAddress">remoteAddress</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="()UdpConnection.this.Receive" id="akka.io;UdpConnection.resolving">resolving</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="UdpConnection.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.io;UdpConnection.resolving;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case <a title="akka.io.Dns.Resolved" id="akka.io;UdpConnection.resolving;$anonfun.isDefinedAt.r">r</a>: Dns.<a href="Dns.scala.html#akka.io.Dns;Resolved" title="akka.io.Dns.Resolved">Resolved</a> ⇒
      <a href="#akka.io;UdpConnection.reportConnectFailure" title="(thunk: =&gt; Unit)Unit">reportConnectFailure</a> <span title="Boolean(true)" class="delimiter">{</span>
        <a href="#akka.io;UdpConnection.doConnect" title="(address: java.net.InetSocketAddress)Unit">doConnect</a><span class="delimiter">(</span>new <span title="java.net.InetSocketAddress">InetSocketAddress</span><span class="delimiter">(</span><a href="#akka.io;UdpConnection.resolving;$anonfun.isDefinedAt.r" title="akka.io.Dns.Resolved">r</a>.<a href="Dns.scala.html#akka.io.Dns;Resolved.addr" title="=&gt; java.net.InetAddress">addr</a>, <a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.remoteAddress" title="=&gt; java.net.InetSocketAddress">remoteAddress</a>.<span title="()Int">getPort</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(address: java.net.InetSocketAddress)Unit" id="akka.io;UdpConnection.doConnect">doConnect</a><span class="delimiter">(</span><a title="java.net.InetSocketAddress" id="akka.io;UdpConnection.doConnect.address">address</a>: <span title="java.net.InetSocketAddress">InetSocketAddress</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.io;UdpConnection.reportConnectFailure" title="(thunk: =&gt; Unit)Unit">reportConnectFailure</a> <span class="delimiter">{</span>
      <a href="#akka.io;UdpConnection.channel_=" title="(x$1: java.nio.channels.DatagramChannel)Unit">channel</a> = <span title="java.nio.channels.DatagramChannel.type">DatagramChannel</span>.<span title="()java.nio.channels.DatagramChannel">open</span>
      <a href="#akka.io;UdpConnection.channel_=" title="=&gt; java.nio.channels.DatagramChannel">channel</a>.<span title="(x$1: Boolean)java.nio.channels.SelectableChannel">configureBlocking</span><span class="delimiter">(</span>false<span class="delimiter">)</span>
      val <a title="java.net.DatagramSocket" id="akka.io;UdpConnection.doConnect.socket">socket</a> = <a href="#akka.io;UdpConnection.channel_=" title="=&gt; java.nio.channels.DatagramChannel">channel</a>.<span title="()java.net.DatagramSocket">socket</span>
      <a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.options" title="=&gt; scala.collection.immutable.Traversable[akka.io.Inet.SocketOption]">options</a>.<span title="(f: akka.io.Inet.SocketOption =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#akka.io;UdpConnection.doConnect.$anonfun.x$1" title="akka.io.Inet.SocketOption">_</a>.<a href="Inet.scala.html#akka.io.Inet;SocketOption.beforeDatagramBind" title="(ds: java.net.DatagramSocket)Unit">beforeDatagramBind</a><span class="delimiter">(</span><a href="#akka.io;UdpConnection.doConnect.socket" title="java.net.DatagramSocket">socket</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.localAddress" title="=&gt; Option[java.net.InetSocketAddress]">localAddress</a> <span title="(f: java.net.InetSocketAddress =&gt; Unit)Unit">foreach</span> <a href="#akka.io;UdpConnection.doConnect.socket" title="java.net.DatagramSocket">socket</a>.<a href="#akka.io;UdpConnection.doConnect.$anonfun.x$1" title="(x$1: java.net.SocketAddress)Unit">bind</a>
      <a href="#akka.io;UdpConnection.channel_=" title="=&gt; java.nio.channels.DatagramChannel">channel</a>.<span title="(x$1: java.net.SocketAddress)java.nio.channels.DatagramChannel">connect</span><span class="delimiter">(</span><a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.remoteAddress" title="=&gt; java.net.InetSocketAddress">remoteAddress</a><span class="delimiter">)</span>
      <a href="#akka.io;UdpConnection.channelRegistry" title="akka.io.ChannelRegistry">channelRegistry</a>.<a href="SelectionHandler.scala.html#akka.io;ChannelRegistry.register" title="(channel: java.nio.channels.SelectableChannel, initialOps: Int)(implicit channelActor: akka.actor.ActorRef)Unit">register</a><a href="../actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef" class="delimiter">(</a><a href="#akka.io;UdpConnection.channel_=" title="=&gt; java.nio.channels.DatagramChannel">channel</a>, <span title="Int(1)">OP_READ</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Successfully connected to [{}]&quot;)" class="string">&quot;Successfully connected to [{}]&quot;</span>, <a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.remoteAddress" title="=&gt; java.net.InetSocketAddress">remoteAddress</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="=&gt; PartialFunction[Any,Unit]" id="akka.io;UdpConnection.receive">receive</a> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.io;UdpConnection.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case <a title="akka.io.ChannelRegistration" id="akka.io;UdpConnection.receive;$anonfun.isDefinedAt.registration">registration</a>: <a href="SelectionHandler.scala.html#akka.io;ChannelRegistration" title="akka.io.ChannelRegistration">ChannelRegistration</a> ⇒
      <a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.options" title="=&gt; scala.collection.immutable.Traversable[akka.io.Inet.SocketOption]">options</a>.<span title="(f: akka.io.Inet.SocketOption =&gt; Unit)Unit">foreach</span> <a href="#akka.io;UdpConnection.receive;$anonfun.applyOrElse.$anonfun.x0$1" title="Unit" class="delimiter">{</a>
        case <a title="akka.io.Inet.SocketOptionV2" id="akka.io;UdpConnection.receive;$anonfun.applyOrElse.$anonfun.v2">v2</a>: Inet.<a href="Inet.scala.html#akka.io.Inet;SocketOptionV2" title="akka.io.Inet.SocketOptionV2">SocketOptionV2</a> ⇒ <a href="#akka.io;UdpConnection.receive;$anonfun.applyOrElse.$anonfun.v2" title="akka.io.Inet.SocketOptionV2">v2</a>.<a href="Inet.scala.html#akka.io.Inet;SocketOptionV2.afterConnect(f68ed36785)" title="(s: java.net.DatagramSocket)Unit">afterConnect</a><span class="delimiter">(</span><a href="#akka.io;UdpConnection.channel_=" title="=&gt; java.nio.channels.DatagramChannel">channel</a>.<span title="()java.net.DatagramSocket">socket</span><span class="delimiter">)</span>
        case _                       ⇒
      <span class="delimiter">}</span>
      <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">commander</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="UdpConnected.scala.html#akka.io.UdpConnected.Connected" title="akka.io.UdpConnected.Connected.type">Connected</a>
      <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorCell.scala.html#akka.actor;ActorContext.become(771101a7b6)" title="(behavior: akka.actor.Actor.Receive, discardOld: Boolean)Unit">become</a><span class="delimiter">(</span><a href="#akka.io;UdpConnection.connected" title="(registration: akka.io.ChannelRegistration)UdpConnection.this.Receive">connected</a><span class="delimiter">(</span><a href="#akka.io;UdpConnection.receive;$anonfun.isDefinedAt.registration" title="akka.io.ChannelRegistration">registration</a><span class="delimiter">)</span>, discardOld = true<span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(registration: akka.io.ChannelRegistration)UdpConnection.this.Receive" id="akka.io;UdpConnection.connected">connected</a><span class="delimiter">(</span><a title="akka.io.ChannelRegistration" id="akka.io;UdpConnection.connected.registration">registration</a>: <a href="SelectionHandler.scala.html#akka.io;ChannelRegistration" title="akka.io.ChannelRegistration">ChannelRegistration</a><span class="delimiter">)</span>: <span title="UdpConnection.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.io;UdpConnection.connected;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case <a href="UdpConnected.scala.html#akka.io.UdpConnected.SuspendReading" title="akka.io.UdpConnected.SuspendReading.type">SuspendReading</a>  ⇒ <a href="#akka.io;UdpConnection.connected.registration" title="akka.io.ChannelRegistration">registration</a>.<a href="SelectionHandler.scala.html#akka.io;ChannelRegistration.disableInterest" title="(op: Int)Unit">disableInterest</a><span title="Boolean(true)" class="delimiter">(</span><span title="Int(1)">OP_READ</span><span class="delimiter">)</span>
    case <a href="UdpConnected.scala.html#akka.io.UdpConnected.ResumeReading" title="akka.io.UdpConnected.ResumeReading.type">ResumeReading</a>   ⇒ <a href="#akka.io;UdpConnection.connected.registration" title="akka.io.ChannelRegistration">registration</a>.<a href="SelectionHandler.scala.html#akka.io;ChannelRegistration.enableInterest" title="(op: Int)Unit">enableInterest</a><span title="Boolean(true)" class="delimiter">(</span><span title="Int(1)">OP_READ</span><span class="delimiter">)</span>
    case <a href="SelectionHandler.scala.html#akka.io.SelectionHandler.ChannelReadable" title="akka.io.SelectionHandler.ChannelReadable.type">ChannelReadable</a> ⇒ <a href="#akka.io;UdpConnection.doRead" title="(registration: akka.io.ChannelRegistration, handler: akka.actor.ActorRef)Unit">doRead</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.io;UdpConnection.connected.registration" title="akka.io.ChannelRegistration">registration</a>, <a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.handler" title="=&gt; akka.actor.ActorRef">handler</a><span class="delimiter">)</span>

    case <a href="UdpConnected.scala.html#akka.io.UdpConnected.Disconnect" title="akka.io.UdpConnected.Disconnect.type">Disconnect</a> ⇒
      <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Closing UDP connection to [{}]&quot;)" class="string">&quot;Closing UDP connection to [{}]&quot;</span>, <a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.remoteAddress" title="=&gt; java.net.InetSocketAddress">remoteAddress</a><span class="delimiter">)</span>
      <a href="#akka.io;UdpConnection.channel_=" title="=&gt; java.nio.channels.DatagramChannel">channel</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="UdpConnected.scala.html#akka.io.UdpConnected.Disconnected" title="akka.io.UdpConnected.Disconnected.type">Disconnected</a>
      <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Connection closed to [{}], stopping listener&quot;)" class="string">&quot;Connection closed to [{}], stopping listener&quot;</span>, <a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.remoteAddress" title="=&gt; java.net.InetSocketAddress">remoteAddress</a><span class="delimiter">)</span>
      <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a><span class="delimiter">(</span><a href="../actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>

    case <span title="akka.io.UdpConnected.Send">send</span>: <a href="UdpConnected.scala.html#akka.io.UdpConnected;Send" title="akka.io.UdpConnected.Send">Send</a> if <a href="#akka.io;UdpConnection.writePending" title="=&gt; Boolean">writePending</a> ⇒
      if <span class="delimiter">(</span><a href="SelectionHandler.scala.html#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Dropping write because queue is full&quot;)" class="string">&quot;Dropping write because queue is full&quot;</span><span class="delimiter">)</span>
      <a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="UdpConnected.scala.html#akka.io.UdpConnected;CommandFailed" title="(cmd: akka.io.UdpConnected.Command)akka.io.UdpConnected.CommandFailed">CommandFailed</a><span class="delimiter">(</span><span title="akka.io.UdpConnected.Send">send</span><span class="delimiter">)</span>

    case <span title="akka.io.UdpConnected.Send">send</span>: <a href="UdpConnected.scala.html#akka.io.UdpConnected;Send" title="akka.io.UdpConnected.Send">Send</a> if <span title="akka.io.UdpConnected.Send">send</span>.<a href="UdpConnected.scala.html#akka.io.UdpConnected;Send.payload" title="=&gt; akka.util.ByteString">payload</a>.<span title="=&gt; Boolean">isEmpty</span> ⇒
      if <span class="delimiter">(</span><span title="akka.io.UdpConnected.Send">send</span>.<a href="UdpConnected.scala.html#akka.io.UdpConnected;Send.wantsAck" title="=&gt; Boolean">wantsAck</a><span class="delimiter">)</span>
        <a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <span title="akka.io.UdpConnected.Send">send</span>.<a href="UdpConnected.scala.html#akka.io.UdpConnected;Send.ack" title="=&gt; Any">ack</a>

    case <span title="akka.io.UdpConnected.Send">send</span>: <a href="UdpConnected.scala.html#akka.io.UdpConnected;Send" title="akka.io.UdpConnected.Send">Send</a> ⇒
      <a href="#akka.io;UdpConnection.pendingSend_=" title="(x$1: (akka.io.UdpConnected.Send, akka.actor.ActorRef))Unit">pendingSend</a> = <span title="(_1: akka.io.UdpConnected.Send, _2: akka.actor.ActorRef)(akka.io.UdpConnected.Send, akka.actor.ActorRef)" class="delimiter">(</span><span title="akka.io.UdpConnected.Send">send</span>, <a href="../actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.io;UdpConnection.connected.registration" title="akka.io.ChannelRegistration">registration</a>.<a href="SelectionHandler.scala.html#akka.io;ChannelRegistration.enableInterest" title="(op: Int)Unit">enableInterest</a><span class="delimiter">(</span><span title="Int(4)">OP_WRITE</span><span class="delimiter">)</span>

    case <a href="SelectionHandler.scala.html#akka.io.SelectionHandler.ChannelWritable" title="akka.io.SelectionHandler.ChannelWritable.type">ChannelWritable</a> ⇒ <a href="#akka.io;UdpConnection.doWrite" title="()Unit">doWrite</a><span title="Boolean(true)" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(registration: akka.io.ChannelRegistration, handler: akka.actor.ActorRef)Unit" id="akka.io;UdpConnection.doRead">doRead</a><span class="delimiter">(</span><a title="akka.io.ChannelRegistration" id="akka.io;UdpConnection.doRead.registration">registration</a>: <a href="SelectionHandler.scala.html#akka.io;ChannelRegistration" title="akka.io.ChannelRegistration">ChannelRegistration</a>, <a title="akka.actor.ActorRef" id="akka.io;UdpConnection.doRead.handler">handler</a>: <a href="../actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    @tailrec def <a title="(readsLeft: Int, buffer: java.nio.ByteBuffer)Unit" id="akka.io;UdpConnection.doRead.innerRead">innerRead</a><span class="delimiter">(</span><a title="Int" id="akka.io;UdpConnection.doRead.innerRead.readsLeft">readsLeft</a>: <span title="Int">Int</span>, <a title="java.nio.ByteBuffer" id="akka.io;UdpConnection.doRead.innerRead.buffer">buffer</a>: <span title="java.nio.ByteBuffer">ByteBuffer</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
      <a href="#akka.io;UdpConnection.doRead.innerRead.buffer" title="java.nio.ByteBuffer">buffer</a>.<span title="()java.nio.Buffer">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#akka.io;UdpConnection.doRead.innerRead.buffer" title="java.nio.ByteBuffer">buffer</a>.<span title="(x$1: Int)java.nio.Buffer">limit</span><span class="delimiter">(</span><a href="Udp.scala.html#akka.io.Udp;UdpSettings.DirectBufferSize" title="=&gt; Int">DirectBufferSize</a><span class="delimiter">)</span>

      if <span class="delimiter">(</span><a href="#akka.io;UdpConnection.channel_=" title="=&gt; java.nio.channels.DatagramChannel">channel</a>.<span title="(x$1: java.nio.ByteBuffer)Int">read</span><span class="delimiter">(</span><a href="#akka.io;UdpConnection.doRead.innerRead.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.io;UdpConnection.doRead.innerRead.buffer" title="java.nio.ByteBuffer">buffer</a>.<span title="()java.nio.Buffer">flip</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">handler</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="UdpConnected.scala.html#akka.io.UdpConnected;Received" title="(data: akka.util.ByteString)akka.io.UdpConnected.Received">Received</a><span class="delimiter">(</span><a href="../util/ByteString.scala.html#akka.util.ByteString.apply(f4bb008516)" title="(bytes: java.nio.ByteBuffer)akka.util.ByteString">ByteString</a><span class="delimiter">(</span><a href="#akka.io;UdpConnection.doRead.innerRead.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.io;UdpConnection.doRead.innerRead" title="(readsLeft: Int, buffer: java.nio.ByteBuffer)Unit">innerRead</a><span class="delimiter">(</span><a href="#akka.io;UdpConnection.doRead.innerRead.readsLeft" title="Int">readsLeft</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>, <a href="#akka.io;UdpConnection.doRead.innerRead.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    val <a title="java.nio.ByteBuffer" id="akka.io;UdpConnection.doRead.buffer">buffer</a> = <a href="UdpConnected.scala.html#akka.io;UdpConnectedExt.bufferPool" title="=&gt; akka.io.BufferPool">bufferPool</a>.<a href="DirectByteBufferPool.scala.html#akka.io;BufferPool.acquire" title="()java.nio.ByteBuffer">acquire</a><span class="delimiter">(</span><span class="delimiter">)</span>
    try <a href="#akka.io;UdpConnection.doRead.innerRead" title="(readsLeft: Int, buffer: java.nio.ByteBuffer)Unit">innerRead</a><span class="delimiter">(</span><a href="Udp.scala.html#akka.io.Udp;UdpSettings.BatchReceiveLimit" title="=&gt; Int">BatchReceiveLimit</a>, <a href="#akka.io;UdpConnection.doRead.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span> finally <span class="delimiter">{</span>
      <a href="#akka.io;UdpConnection.doRead.registration" title="akka.io.ChannelRegistration">registration</a>.<a href="SelectionHandler.scala.html#akka.io;ChannelRegistration.enableInterest" title="(op: Int)Unit">enableInterest</a><span class="delimiter">(</span><span title="Int(1)">OP_READ</span><span class="delimiter">)</span>
      <a href="UdpConnected.scala.html#akka.io;UdpConnectedExt.bufferPool" title="=&gt; akka.io.BufferPool">bufferPool</a>.<a href="DirectByteBufferPool.scala.html#akka.io;BufferPool.release" title="(buf: java.nio.ByteBuffer)Unit">release</a><span class="delimiter">(</span><a href="#akka.io;UdpConnection.doRead.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  final def <a title="()Unit" id="akka.io;UdpConnection.doWrite">doWrite</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val <a title="java.nio.ByteBuffer" id="akka.io;UdpConnection.doWrite.buffer">buffer</a> = <a href="#akka.io;UdpConnection.udpConn" title="akka.io.UdpConnectedExt">udpConn</a>.<a href="UdpConnected.scala.html#akka.io;UdpConnectedExt.bufferPool" title="=&gt; akka.io.BufferPool">bufferPool</a>.<a href="DirectByteBufferPool.scala.html#akka.io;BufferPool.acquire" title="()java.nio.ByteBuffer">acquire</a><span class="delimiter">(</span><span class="delimiter">)</span>
    try <span class="delimiter">{</span>
      val <a href="#akka.io;UdpConnection.doWrite.send" title="(akka.io.UdpConnected.Send, akka.actor.ActorRef)" class="delimiter">(</a><a href="#akka.io;UdpConnection.doWrite.x$2" title="akka.io.UdpConnected.Send" id="akka.io;UdpConnection.doWrite.send">send</a>, <a href="#akka.io;UdpConnection.doWrite.x$2" title="akka.actor.ActorRef" id="akka.io;UdpConnection.doWrite.commander">commander</a><span class="delimiter">)</span> = <a href="#akka.io;UdpConnection.pendingSend_=" title="=&gt; (akka.io.UdpConnected.Send, akka.actor.ActorRef)">pendingSend</a>
      <a href="#akka.io;UdpConnection.doWrite.buffer" title="java.nio.ByteBuffer">buffer</a>.<span title="()java.nio.Buffer">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#akka.io;UdpConnection.doWrite.send" title="akka.io.UdpConnected.Send">send</a>.<a href="UdpConnected.scala.html#akka.io.UdpConnected;Send.payload" title="=&gt; akka.util.ByteString">payload</a>.<a href="../util/ByteString.scala.html#akka.util;ByteString.copyToBuffer(a8a554c50c)" title="(buffer: java.nio.ByteBuffer)Int">copyToBuffer</a><span class="delimiter">(</span><a href="#akka.io;UdpConnection.doWrite.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
      <a href="#akka.io;UdpConnection.doWrite.buffer" title="java.nio.ByteBuffer">buffer</a>.<span title="()java.nio.Buffer">flip</span><span class="delimiter">(</span><span class="delimiter">)</span>
      val <a title="Int" id="akka.io;UdpConnection.doWrite.writtenBytes">writtenBytes</a> = <a href="#akka.io;UdpConnection.channel_=" title="=&gt; java.nio.channels.DatagramChannel">channel</a>.<span title="(x$1: java.nio.ByteBuffer)Int">write</span><span class="delimiter">(</span><a href="#akka.io;UdpConnection.doWrite.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="SelectionHandler.scala.html#akka.io;SelectionHandlerSettings.TraceLogging" title="=&gt; Boolean">TraceLogging</a><span class="delimiter">)</span> <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Wrote [{}] bytes to channel&quot;)" class="string">&quot;Wrote [{}] bytes to channel&quot;</span>, <a href="#akka.io;UdpConnection.doWrite.writtenBytes" title="Int">writtenBytes</a><span class="delimiter">)</span>

      <span class="comment">// Datagram channel either sends the whole message, or nothing</span>
      if <span class="delimiter">(</span><a href="#akka.io;UdpConnection.doWrite.writtenBytes" title="Int">writtenBytes</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">commander</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="UdpConnected.scala.html#akka.io.UdpConnected;CommandFailed" title="(cmd: akka.io.UdpConnected.Command)akka.io.UdpConnected.CommandFailed">CommandFailed</a><span class="delimiter">(</span><a href="#akka.io;UdpConnection.doWrite.send" title="akka.io.UdpConnected.Send">send</a><span class="delimiter">)</span>
      else if <span class="delimiter">(</span><a href="#akka.io;UdpConnection.doWrite.send" title="akka.io.UdpConnected.Send">send</a>.<a href="UdpConnected.scala.html#akka.io.UdpConnected;Send.wantsAck" title="=&gt; Boolean">wantsAck</a><span class="delimiter">)</span> <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">commander</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.io;UdpConnection.doWrite.send" title="akka.io.UdpConnected.Send">send</a>.<a href="UdpConnected.scala.html#akka.io.UdpConnected;Send.ack" title="=&gt; Any">ack</a>
    <span class="delimiter">}</span> finally <span class="delimiter">{</span>
      <a href="#akka.io;UdpConnection.udpConn" title="akka.io.UdpConnectedExt">udpConn</a>.<a href="UdpConnected.scala.html#akka.io;UdpConnectedExt.bufferPool" title="=&gt; akka.io.BufferPool">bufferPool</a>.<a href="DirectByteBufferPool.scala.html#akka.io;BufferPool.release" title="(buf: java.nio.ByteBuffer)Unit">release</a><span class="delimiter">(</span><a href="#akka.io;UdpConnection.doWrite.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
      <a href="#akka.io;UdpConnection.pendingSend_=" title="(x$1: (akka.io.UdpConnected.Send, akka.actor.ActorRef))Unit">pendingSend</a> = null
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  override def <a title="()Unit" id="akka.io;UdpConnection.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    if <span class="delimiter">(</span><a href="#akka.io;UdpConnection.channel_=" title="=&gt; java.nio.channels.DatagramChannel">channel</a>.<span title="()Boolean">isOpen</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Closing DatagramChannel after being stopped&quot;)" class="string">&quot;Closing DatagramChannel after being stopped&quot;</span><span class="delimiter">)</span>
      try <a href="#akka.io;UdpConnection.channel_=" title="=&gt; java.nio.channels.DatagramChannel">channel</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      catch <span class="delimiter">{</span>
        case <a href="#akka.io;UdpConnection.postStop.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="akka.io;UdpConnection.postStop.e">e</a><span class="delimiter">)</span> ⇒ <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Error closing DatagramChannel: {}&quot;)" class="string">&quot;Error closing DatagramChannel: {}&quot;</span>, <a href="#akka.io;UdpConnection.postStop.e" title="Throwable">e</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  private def <a title="(thunk: =&gt; Unit)Unit" id="akka.io;UdpConnection.reportConnectFailure">reportConnectFailure</a><span class="delimiter">(</span><a title="=&gt; Unit" id="akka.io;UdpConnection.reportConnectFailure.thunk">thunk</a>: ⇒ Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    try <span class="delimiter">{</span>
      <a href="#akka.io;UdpConnection.reportConnectFailure.thunk" title="=&gt; Unit">thunk</a>
    <span class="delimiter">}</span> catch <span class="delimiter">{</span>
      case <a href="#akka.io;UdpConnection.reportConnectFailure.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="akka.io;UdpConnection.reportConnectFailure.e">e</a><span class="delimiter">)</span> ⇒
        <a href="../actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../event/Logging.scala.html#akka.event;LoggingAdapter.debug(6c666e4343)" title="(template: String, arg1: Any, arg2: Any, arg3: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Failure while connecting UDP channel to remote address [{}] local address [{}]: {}&quot;)" class="string">&quot;Failure while connecting UDP channel to remote address [{}] local address [{}]: {}&quot;</span>,
          <a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.remoteAddress" title="=&gt; java.net.InetSocketAddress">remoteAddress</a>, <a href="UdpConnected.scala.html#akka.io.UdpConnected;Connect.localAddress" title="=&gt; Option[java.net.InetSocketAddress]">localAddress</a>.<span title="(default: =&gt; java.io.Serializable)java.io.Serializable">getOrElse</span><span class="delimiter">(</span><span title="String(&quot;undefined&quot;)" class="string">&quot;undefined&quot;</span><span class="delimiter">)</span>, <a href="#akka.io;UdpConnection.reportConnectFailure.e" title="Throwable">e</a><span class="delimiter">)</span>
        <a href="../actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">commander</a> <a href="../actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="UdpConnected.scala.html#akka.io.UdpConnected;CommandFailed" title="(cmd: akka.io.UdpConnected.Command)akka.io.UdpConnected.CommandFailed">CommandFailed</a><span class="delimiter">(</span><a href="#akka.io;UdpConnection.connect" title="akka.io.UdpConnected.Connect">connect</a><span class="delimiter">)</span>
        <a href="../actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a><span class="delimiter">(</span><a href="../actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
