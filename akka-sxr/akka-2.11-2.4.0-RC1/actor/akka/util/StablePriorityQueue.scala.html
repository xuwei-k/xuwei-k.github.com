<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>actor/akka/util/StablePriorityQueue.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

package akka.util

import java.util.concurrent.PriorityBlockingQueue
import java.util.concurrent.atomic.AtomicLong
import java.util.<span class="delimiter">{</span> AbstractQueue, Comparator, Iterator, PriorityQueue <span class="delimiter">}</span>

<span class="comment">/**
 * PriorityQueueStabilizer wraps a priority queue so that it respects FIFO for elements of equal priority.
 */</span>
trait <a title="trait PriorityQueueStabilizer[E &lt;: AnyRef] extends java.util.AbstractQueue[E]" id="akka.util;PriorityQueueStabilizer">PriorityQueueStabilizer</a><span class="delimiter">[</span><a title=" &lt;: AnyRef" id="akka.util;PriorityQueueStabilizer;E">E</a> &lt;: AnyRef<span class="delimiter">]</span> extends <span title="java.util.AbstractQueue[E]">AbstractQueue</span><span class="delimiter">[</span>E<span class="delimiter">]</span> <span class="delimiter">{</span>
  val <a title="=&gt; java.util.AbstractQueue[akka.util.PriorityQueueStabilizer.WrappedElement[E]]" id="akka.util;PriorityQueueStabilizer.backingQueue">backingQueue</a>: <span title="java.util.AbstractQueue[akka.util.PriorityQueueStabilizer.WrappedElement[E]]">AbstractQueue</span><span class="delimiter">[</span>PriorityQueueStabilizer.WrappedElement<span class="delimiter">[</span>E<span class="delimiter">]</span><span class="delimiter">]</span>
  val <a title="java.util.concurrent.atomic.AtomicLong" id="akka.util;PriorityQueueStabilizer.seqNum">seqNum</a> = new <span title="java.util.concurrent.atomic.AtomicLong">AtomicLong</span><span class="delimiter">(</span><span title="Long(0L)" class="int">0</span><span class="delimiter">)</span>

  override def <a title="()E" id="akka.util;PriorityQueueStabilizer.peek">peek</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="#akka.util;PriorityQueueStabilizer;E" title="E">E</a> = <span class="delimiter">{</span>
    val <a title="akka.util.PriorityQueueStabilizer.WrappedElement[E]" id="akka.util;PriorityQueueStabilizer.peek.wrappedElement">wrappedElement</a> = <a href="#akka.util;PriorityQueueStabilizer.backingQueue" title="=&gt; java.util.AbstractQueue[akka.util.PriorityQueueStabilizer.WrappedElement[E]]">backingQueue</a>.<span title="()akka.util.PriorityQueueStabilizer.WrappedElement[E]">peek</span><span class="delimiter">(</span><span class="delimiter">)</span>
    if <span class="delimiter">(</span><a href="#akka.util;PriorityQueueStabilizer.peek.wrappedElement" title="akka.util.PriorityQueueStabilizer.WrappedElement[E]">wrappedElement</a> <span title="(x$1: AnyRef)Boolean">eq</span> null<span class="delimiter">)</span> null.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="E" class="delimiter">[</span><a href="#akka.util;PriorityQueueStabilizer;E" title="E">E</a><span class="delimiter">]</span> else <a href="#akka.util;PriorityQueueStabilizer.peek.wrappedElement" title="akka.util.PriorityQueueStabilizer.WrappedElement[E]">wrappedElement</a>.<a href="#akka.util.PriorityQueueStabilizer;WrappedElement.element" title="=&gt; E">element</a>
  <span class="delimiter">}</span>

  override def <a title="()Int" id="akka.util;PriorityQueueStabilizer.size">size</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <a href="#akka.util;PriorityQueueStabilizer.backingQueue" title="=&gt; java.util.AbstractQueue[akka.util.PriorityQueueStabilizer.WrappedElement[E]]">backingQueue</a>.<span title="()Int">size</span><span class="delimiter">(</span><span class="delimiter">)</span>

  override def <a title="(e: E)Boolean" id="akka.util;PriorityQueueStabilizer.offer">offer</a><span class="delimiter">(</span><a title="E" id="akka.util;PriorityQueueStabilizer.offer.e">e</a>: <a href="#akka.util;PriorityQueueStabilizer;E" title="E">E</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#akka.util;PriorityQueueStabilizer.offer.e" title="E">e</a> <span title="(x$1: AnyRef)Boolean">eq</span> null<span class="delimiter">)</span> throw new <span title="NullPointerException">NullPointerException</span>
    val <a title="akka.util.PriorityQueueStabilizer.WrappedElement[E]" id="akka.util;PriorityQueueStabilizer.offer.wrappedElement">wrappedElement</a> = new PriorityQueueStabilizer.<a href="#akka.util.PriorityQueueStabilizer;WrappedElement" title="akka.util.PriorityQueueStabilizer.WrappedElement[E]">WrappedElement</a><span class="delimiter">(</span><a href="#akka.util;PriorityQueueStabilizer.offer.e" title="E">e</a>, <a href="#akka.util;PriorityQueueStabilizer.seqNum" title="=&gt; java.util.concurrent.atomic.AtomicLong">seqNum</a>.<span title="()Long">incrementAndGet</span><span class="delimiter">)</span>
    <a href="#akka.util;PriorityQueueStabilizer.backingQueue" title="=&gt; java.util.AbstractQueue[akka.util.PriorityQueueStabilizer.WrappedElement[E]]">backingQueue</a>.<span title="(x$1: akka.util.PriorityQueueStabilizer.WrappedElement[E])Boolean">offer</span><span class="delimiter">(</span><a href="#akka.util;PriorityQueueStabilizer.offer.wrappedElement" title="akka.util.PriorityQueueStabilizer.WrappedElement[E]">wrappedElement</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  override def <a title="()java.util.Iterator[E]" id="akka.util;PriorityQueueStabilizer.iterator">iterator</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="java.util.Iterator[E]">Iterator</span><span class="delimiter">[</span>E<span class="delimiter">]</span> = new <a title="&lt;$anon: java.util.Iterator[E]&gt; extends Object with java.util.Iterator[E]" id="akka.util;PriorityQueueStabilizer.iterator;$anon">Iterator</a><span class="delimiter">[</span>E<span class="delimiter">]</span> <span class="delimiter">{</span>
    private<span class="delimiter">[</span>this<span class="delimiter">]</span> val <a title="java.util.Iterator[akka.util.PriorityQueueStabilizer.WrappedElement[E]]" id="akka.util;PriorityQueueStabilizer.iterator;$anon.backingIterator">backingIterator</a> = <a href="#akka.util;PriorityQueueStabilizer.backingQueue" title="=&gt; java.util.AbstractQueue[akka.util.PriorityQueueStabilizer.WrappedElement[E]]">backingQueue</a>.<span title="()java.util.Iterator[akka.util.PriorityQueueStabilizer.WrappedElement[E]]">iterator</span><span class="delimiter">(</span><span class="delimiter">)</span>
    def <a title="()Boolean" id="akka.util;PriorityQueueStabilizer.iterator;$anon.hasNext">hasNext</a>: <span title="Boolean">Boolean</span> = <a href="#akka.util;PriorityQueueStabilizer.iterator;$anon.backingIterator" title="java.util.Iterator[akka.util.PriorityQueueStabilizer.WrappedElement[E]]">backingIterator</a>.<span title="()Boolean">hasNext</span>
    def <a title="()E" id="akka.util;PriorityQueueStabilizer.iterator;$anon.next">next</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="#akka.util;PriorityQueueStabilizer;E" title="E">E</a> = <a href="#akka.util;PriorityQueueStabilizer.iterator;$anon.backingIterator" title="java.util.Iterator[akka.util.PriorityQueueStabilizer.WrappedElement[E]]">backingIterator</a>.<span title="()akka.util.PriorityQueueStabilizer.WrappedElement[E]">next</span><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="#akka.util.PriorityQueueStabilizer;WrappedElement.element" title="=&gt; E">element</a>
    def <a title="()Unit" id="akka.util;PriorityQueueStabilizer.iterator;$anon.remove">remove</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#akka.util;PriorityQueueStabilizer.iterator;$anon.backingIterator" title="java.util.Iterator[akka.util.PriorityQueueStabilizer.WrappedElement[E]]">backingIterator</a>.<span title="()Unit">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  override def <a title="()E" id="akka.util;PriorityQueueStabilizer.poll">poll</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="#akka.util;PriorityQueueStabilizer;E" title="E">E</a> = <span class="delimiter">{</span>
    val <a title="akka.util.PriorityQueueStabilizer.WrappedElement[E]" id="akka.util;PriorityQueueStabilizer.poll.wrappedElement">wrappedElement</a> = <a href="#akka.util;PriorityQueueStabilizer.backingQueue" title="=&gt; java.util.AbstractQueue[akka.util.PriorityQueueStabilizer.WrappedElement[E]]">backingQueue</a>.<span title="()akka.util.PriorityQueueStabilizer.WrappedElement[E]">poll</span><span class="delimiter">(</span><span class="delimiter">)</span>
    if <span class="delimiter">(</span><a href="#akka.util;PriorityQueueStabilizer.poll.wrappedElement" title="akka.util.PriorityQueueStabilizer.WrappedElement[E]">wrappedElement</a> <span title="(x$1: AnyRef)Boolean">eq</span> null<span class="delimiter">)</span> null.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="E" class="delimiter">[</span><a href="#akka.util;PriorityQueueStabilizer;E" title="E">E</a><span class="delimiter">]</span> else <a href="#akka.util;PriorityQueueStabilizer.poll.wrappedElement" title="akka.util.PriorityQueueStabilizer.WrappedElement[E]">wrappedElement</a>.<a href="#akka.util.PriorityQueueStabilizer;WrappedElement.element" title="=&gt; E">element</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

object <a title="akka.util.PriorityQueueStabilizer.type" id="akka.util.PriorityQueueStabilizer">PriorityQueueStabilizer</a> <a href="#akka.util.PriorityQueueStabilizer" title="akka.util.PriorityQueueStabilizer.type" class="delimiter">{</a>
  class <a title="class WrappedElement[E] extends AnyRef" id="akka.util.PriorityQueueStabilizer;WrappedElement">WrappedElement</a><span class="delimiter">[</span><a title="" id="akka.util.PriorityQueueStabilizer;WrappedElement;E">E</a><span class="delimiter">]</span><a href="#akka.util.PriorityQueueStabilizer;WrappedElement" title="akka.util.PriorityQueueStabilizer.WrappedElement[E]" class="delimiter">(</a>val <a title="E" id="akka.util.PriorityQueueStabilizer;WrappedElement.element">element</a>: <a href="#akka.util.PriorityQueueStabilizer;WrappedElement;E" title="E">E</a>, val <a title="Long" id="akka.util.PriorityQueueStabilizer;WrappedElement.seqNum">seqNum</a>: <span title="Long">Long</span><span class="delimiter">)</span>
  class <a title="class WrappedElementComparator[E] extends Object with java.util.Comparator[akka.util.PriorityQueueStabilizer.WrappedElement[E]]" id="akka.util.PriorityQueueStabilizer;WrappedElementComparator">WrappedElementComparator</a><span class="delimiter">[</span><a title="" id="akka.util.PriorityQueueStabilizer;WrappedElementComparator;E">E</a><span class="delimiter">]</span><a href="#akka.util.PriorityQueueStabilizer;WrappedElementComparator" title="akka.util.PriorityQueueStabilizer.WrappedElementComparator[E]" class="delimiter">(</a>val <a title="java.util.Comparator[E]" id="akka.util.PriorityQueueStabilizer;WrappedElementComparator.cmp">cmp</a>: <span title="java.util.Comparator[E]">Comparator</span><span class="delimiter">[</span>E<span class="delimiter">]</span><span class="delimiter">)</span> extends <a href="#akka.util.PriorityQueueStabilizer;WrappedElementComparator" title="java.util.Comparator[akka.util.PriorityQueueStabilizer.WrappedElement[E]]">Comparator</a><span class="delimiter">[</span>WrappedElement<span class="delimiter">[</span>E<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span>
    def <a title="(e1: akka.util.PriorityQueueStabilizer.WrappedElement[E], e2: akka.util.PriorityQueueStabilizer.WrappedElement[E])Int" id="akka.util.PriorityQueueStabilizer;WrappedElementComparator.compare">compare</a><span class="delimiter">(</span><a title="akka.util.PriorityQueueStabilizer.WrappedElement[E]" id="akka.util.PriorityQueueStabilizer;WrappedElementComparator.compare.e1">e1</a>: <a href="#akka.util.PriorityQueueStabilizer;WrappedElement" title="akka.util.PriorityQueueStabilizer.WrappedElement[E]">WrappedElement</a><span class="delimiter">[</span>E<span class="delimiter">]</span>, <a title="akka.util.PriorityQueueStabilizer.WrappedElement[E]" id="akka.util.PriorityQueueStabilizer;WrappedElementComparator.compare.e2">e2</a>: <a href="#akka.util.PriorityQueueStabilizer;WrappedElement" title="akka.util.PriorityQueueStabilizer.WrappedElement[E]">WrappedElement</a><span class="delimiter">[</span>E<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      val <a title="Int" id="akka.util.PriorityQueueStabilizer;WrappedElementComparator.compare.baseComparison">baseComparison</a> = <a href="#akka.util.PriorityQueueStabilizer;WrappedElementComparator.cmp" title="=&gt; java.util.Comparator[E]">cmp</a>.<span title="(x$1: E, x$2: E)Int">compare</span><span class="delimiter">(</span><a href="#akka.util.PriorityQueueStabilizer;WrappedElementComparator.compare.e1" title="akka.util.PriorityQueueStabilizer.WrappedElement[E]">e1</a>.<a href="#akka.util.PriorityQueueStabilizer;WrappedElement.element" title="=&gt; E">element</a>, <a href="#akka.util.PriorityQueueStabilizer;WrappedElementComparator.compare.e2" title="akka.util.PriorityQueueStabilizer.WrappedElement[E]">e2</a>.<a href="#akka.util.PriorityQueueStabilizer;WrappedElement.element" title="=&gt; E">element</a><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#akka.util.PriorityQueueStabilizer;WrappedElementComparator.compare.baseComparison" title="Int">baseComparison</a> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#akka.util.PriorityQueueStabilizer;WrappedElementComparator.compare.baseComparison" title="Int">baseComparison</a>
      else <span class="delimiter">{</span>
        val diff = <a href="#akka.util.PriorityQueueStabilizer;WrappedElementComparator.compare.e1" title="akka.util.PriorityQueueStabilizer.WrappedElement[E]">e1</a>.<a href="#akka.util.PriorityQueueStabilizer;WrappedElement.seqNum" title="=&gt; Long">seqNum</a> <a title="Long" id="akka.util.PriorityQueueStabilizer;WrappedElementComparator.compare.diff">-</a> <a href="#akka.util.PriorityQueueStabilizer;WrappedElementComparator.compare.e2" title="akka.util.PriorityQueueStabilizer.WrappedElement[E]">e2</a>.<a href="#akka.util.PriorityQueueStabilizer;WrappedElement.seqNum" title="=&gt; Long">seqNum</a>
        java.lang.<span title="Long.type">Long</span>.<span title="(x$1: Long)Int">signum</span><span class="delimiter">(</span><a href="#akka.util.PriorityQueueStabilizer;WrappedElementComparator.compare.diff" title="Long">diff</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * StablePriorityQueue is a priority queue that preserves order for elements of equal priority.
 * @param capacity - the initial capacity of this Queue, needs to be &amp;gt; 0.
 * @param cmp - Comparator for comparing Queue elements
 */</span>
class <a title="class StablePriorityQueue[E &lt;: AnyRef] extends java.util.AbstractQueue[E] with akka.util.PriorityQueueStabilizer[E]" id="akka.util;StablePriorityQueue">StablePriorityQueue</a><span class="delimiter">[</span><a title=" &lt;: AnyRef" id="akka.util;StablePriorityQueue;E">E</a> &lt;: AnyRef<span class="delimiter">]</span><a href="#akka.util;StablePriorityQueue" title="akka.util.StablePriorityQueue[E]" class="delimiter">(</a><a title="Int" id="akka.util;StablePriorityQueue.capacity">capacity</a>: <span title="Int">Int</span>, <a title="java.util.Comparator[E]" id="akka.util;StablePriorityQueue.cmp">cmp</a>: <span title="java.util.Comparator[E]">Comparator</span><span class="delimiter">[</span>E<span class="delimiter">]</span><span class="delimiter">)</span> extends <a href="#akka.util;PriorityQueueStabilizer" title="akka.util.PriorityQueueStabilizer[E]">PriorityQueueStabilizer</a><span class="delimiter">[</span>E<span class="delimiter">]</span> <span class="delimiter">{</span>
  val <a title="java.util.PriorityQueue[akka.util.PriorityQueueStabilizer.WrappedElement[E]]" id="akka.util;StablePriorityQueue.backingQueue">backingQueue</a> = new <span title="java.util.PriorityQueue[akka.util.PriorityQueueStabilizer.WrappedElement[E]]">PriorityQueue</span><span class="delimiter">[</span>PriorityQueueStabilizer.WrappedElement<span class="delimiter">[</span>E<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span>
    <a href="#akka.util;StablePriorityQueue.capacity" title="Int">capacity</a>,
    new PriorityQueueStabilizer.<a href="#akka.util.PriorityQueueStabilizer;WrappedElementComparator" title="akka.util.PriorityQueueStabilizer.WrappedElementComparator[E]">WrappedElementComparator</a><span class="delimiter">[</span>E<span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.util;StablePriorityQueue.cmp" title="java.util.Comparator[E]">cmp</a><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * StablePriorityBlockingQueue is a blocking priority queue that preserves order for elements of equal priority.
 * @param capacity - the initial capacity of this Queue, needs to be &amp;gt; 0.
 * @param cmp - Comparator for comparing Queue elements
 */</span>
class <a title="class StablePriorityBlockingQueue[E &lt;: AnyRef] extends java.util.AbstractQueue[E] with akka.util.PriorityQueueStabilizer[E]" id="akka.util;StablePriorityBlockingQueue">StablePriorityBlockingQueue</a><span class="delimiter">[</span><a title=" &lt;: AnyRef" id="akka.util;StablePriorityBlockingQueue;E">E</a> &lt;: AnyRef<span class="delimiter">]</span><a href="#akka.util;StablePriorityBlockingQueue" title="akka.util.StablePriorityBlockingQueue[E]" class="delimiter">(</a><a title="Int" id="akka.util;StablePriorityBlockingQueue.capacity">capacity</a>: <span title="Int">Int</span>, <a title="java.util.Comparator[E]" id="akka.util;StablePriorityBlockingQueue.cmp">cmp</a>: <span title="java.util.Comparator[E]">Comparator</span><span class="delimiter">[</span>E<span class="delimiter">]</span><span class="delimiter">)</span> extends <a href="#akka.util;PriorityQueueStabilizer" title="akka.util.PriorityQueueStabilizer[E]">PriorityQueueStabilizer</a><span class="delimiter">[</span>E<span class="delimiter">]</span> <span class="delimiter">{</span>
  val <a title="java.util.concurrent.PriorityBlockingQueue[akka.util.PriorityQueueStabilizer.WrappedElement[E]]" id="akka.util;StablePriorityBlockingQueue.backingQueue">backingQueue</a> = new <span title="java.util.concurrent.PriorityBlockingQueue[akka.util.PriorityQueueStabilizer.WrappedElement[E]]">PriorityBlockingQueue</span><span class="delimiter">[</span>PriorityQueueStabilizer.WrappedElement<span class="delimiter">[</span>E<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span>
    <a href="#akka.util;StablePriorityBlockingQueue.capacity" title="Int">capacity</a>,
    new PriorityQueueStabilizer.<a href="#akka.util.PriorityQueueStabilizer;WrappedElementComparator" title="akka.util.PriorityQueueStabilizer.WrappedElementComparator[E]">WrappedElementComparator</a><span class="delimiter">[</span>E<span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.util;StablePriorityBlockingQueue.cmp" title="java.util.Comparator[E]">cmp</a><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
