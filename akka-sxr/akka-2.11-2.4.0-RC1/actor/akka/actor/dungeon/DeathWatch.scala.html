<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>actor/akka/actor/dungeon/DeathWatch.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

package akka.actor.dungeon

import akka.actor.<span class="delimiter">{</span> Terminated, InternalActorRef, ActorRef, ActorRefScope, ActorCell, Actor, Address <span class="delimiter">}</span>
import akka.dispatch.sysmsg.<span class="delimiter">{</span> DeathWatchNotification, Watch, Unwatch <span class="delimiter">}</span>
import akka.event.<a href="../../event/Logging.scala.html#akka.event.Logging" title="akka.event.Logging.type">Logging</a>.<span class="delimiter">{</span> Warning, Error, Debug <span class="delimiter">}</span>
import scala.util.control.NonFatal
import akka.actor.MinimalActorRef
import akka.event.AddressTerminatedTopic

private<span class="delimiter">[</span>akka<span class="delimiter">]</span> trait <a title="trait DeathWatch extends AnyRef" id="akka.actor.dungeon;DeathWatch">DeathWatch</a> <span title="Unit" class="delimiter">{</span> this: ActorCell ⇒

  private var <a title="Set[akka.actor.ActorRef]" id="akka.actor.dungeon;DeathWatch.watching_=">watching</a>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <a href="../ActorCell.scala.html#akka.actor.ActorCell" title="akka.actor.ActorCell.type">ActorCell</a>.<a href="../ActorCell.scala.html#akka.actor.ActorCell.emptyActorRefSet" title="=&gt; Set[akka.actor.ActorRef]">emptyActorRefSet</a>
  private var <a title="Set[akka.actor.ActorRef]" id="akka.actor.dungeon;DeathWatch.watchedBy_=">watchedBy</a>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <a href="../ActorCell.scala.html#akka.actor.ActorCell" title="akka.actor.ActorCell.type">ActorCell</a>.<a href="../ActorCell.scala.html#akka.actor.ActorCell.emptyActorRefSet" title="=&gt; Set[akka.actor.ActorRef]">emptyActorRefSet</a>
  private var <a title="Set[akka.actor.ActorRef]" id="akka.actor.dungeon;DeathWatch.terminatedQueued_=">terminatedQueued</a>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <a href="../ActorCell.scala.html#akka.actor.ActorCell" title="akka.actor.ActorCell.type">ActorCell</a>.<a href="../ActorCell.scala.html#akka.actor.ActorCell.emptyActorRefSet" title="=&gt; Set[akka.actor.ActorRef]">emptyActorRefSet</a>

  override final def <a title="(subject: akka.actor.ActorRef)akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.watch">watch</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.watch.subject">subject</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <a href="#akka.actor.dungeon;DeathWatch.watch.subject" title="akka.actor.ActorRef">subject</a> match <span class="delimiter">{</span>
    case <a title="akka.actor.InternalActorRef" id="akka.actor.dungeon;DeathWatch.watch.a">a</a>: <a href="../ActorRef.scala.html#akka.actor;InternalActorRef" title="akka.actor.InternalActorRef">InternalActorRef</a> ⇒
      if <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watch.a" title="akka.actor.InternalActorRef">a</a> <span title="(x$1: Any)Boolean">!=</span> <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#akka.actor.dungeon;DeathWatch.watchingContains" title="(subject: akka.actor.ActorRef)Boolean">watchingContains</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watch.a" title="akka.actor.InternalActorRef">a</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription" title="(change: akka.actor.ActorRef)(block: =&gt; Unit)Unit">maintainAddressTerminatedSubscription</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watch.a" title="akka.actor.InternalActorRef">a</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#akka.actor.dungeon;DeathWatch.watch.a" title="akka.actor.InternalActorRef">a</a>.<a href="../ActorRef.scala.html#akka.actor;InternalActorRef.sendSystemMessage" title="(message: akka.dispatch.sysmsg.SystemMessage)Unit">sendSystemMessage</a><span class="delimiter">(</span><a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Watch" title="(watchee: akka.actor.InternalActorRef, watcher: akka.actor.InternalActorRef)akka.dispatch.sysmsg.Watch">Watch</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watch.a" title="akka.actor.InternalActorRef">a</a>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="comment">// ➡➡➡ NEVER SEND THE SAME SYSTEM MESSAGE OBJECT TO TWO ACTORS ⬅⬅⬅</span>
          <a href="#akka.actor.dungeon;DeathWatch.watching_=" title="(x$1: Set[akka.actor.ActorRef])Unit">watching</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">+=</span> <a href="#akka.actor.dungeon;DeathWatch.watch.a" title="akka.actor.InternalActorRef">a</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#akka.actor.dungeon;DeathWatch.watch.a" title="akka.actor.InternalActorRef">a</a>
  <span class="delimiter">}</span>

  override final def <a title="(subject: akka.actor.ActorRef)akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.unwatch">unwatch</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.unwatch.subject">subject</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <a href="#akka.actor.dungeon;DeathWatch.unwatch.subject" title="akka.actor.ActorRef">subject</a> match <span class="delimiter">{</span>
    case <a title="akka.actor.InternalActorRef" id="akka.actor.dungeon;DeathWatch.unwatch.a">a</a>: <a href="../ActorRef.scala.html#akka.actor;InternalActorRef" title="akka.actor.InternalActorRef">InternalActorRef</a> ⇒
      if <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.unwatch.a" title="akka.actor.InternalActorRef">a</a> <span title="(x$1: Any)Boolean">!=</span> <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.actor.dungeon;DeathWatch.watchingContains" title="(subject: akka.actor.ActorRef)Boolean">watchingContains</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.unwatch.a" title="akka.actor.InternalActorRef">a</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.actor.dungeon;DeathWatch.unwatch.a" title="akka.actor.InternalActorRef">a</a>.<a href="../ActorRef.scala.html#akka.actor;InternalActorRef.sendSystemMessage" title="(message: akka.dispatch.sysmsg.SystemMessage)Unit">sendSystemMessage</a><span class="delimiter">(</span><a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Unwatch" title="(watchee: akka.actor.ActorRef, watcher: akka.actor.ActorRef)akka.dispatch.sysmsg.Unwatch">Unwatch</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.unwatch.a" title="akka.actor.InternalActorRef">a</a>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="comment">// ➡➡➡ NEVER SEND THE SAME SYSTEM MESSAGE OBJECT TO TWO ACTORS ⬅⬅⬅</span>
        <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription" title="(change: akka.actor.ActorRef)(block: =&gt; Unit)Unit">maintainAddressTerminatedSubscription</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.unwatch.a" title="akka.actor.InternalActorRef">a</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#akka.actor.dungeon;DeathWatch.watching_=" title="(x$1: Set[akka.actor.ActorRef])Unit">watching</a> = <a href="#akka.actor.dungeon;DeathWatch.removeFromSet" title="(subject: akka.actor.ActorRef, set: Set[akka.actor.ActorRef])Set[akka.actor.ActorRef]">removeFromSet</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.unwatch.a" title="akka.actor.InternalActorRef">a</a>, <a href="#akka.actor.dungeon;DeathWatch.watching_=" title="=&gt; Set[akka.actor.ActorRef]">watching</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#akka.actor.dungeon;DeathWatch.terminatedQueued_=" title="(x$1: Set[akka.actor.ActorRef])Unit">terminatedQueued</a> = <a href="#akka.actor.dungeon;DeathWatch.removeFromSet" title="(subject: akka.actor.ActorRef, set: Set[akka.actor.ActorRef])Set[akka.actor.ActorRef]">removeFromSet</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.unwatch.a" title="akka.actor.InternalActorRef">a</a>, <a href="#akka.actor.dungeon;DeathWatch.terminatedQueued_=" title="=&gt; Set[akka.actor.ActorRef]">terminatedQueued</a><span class="delimiter">)</span>
      <a href="#akka.actor.dungeon;DeathWatch.unwatch.a" title="akka.actor.InternalActorRef">a</a>
  <span class="delimiter">}</span>

  protected def <a title="(t: akka.actor.Terminated)Unit" id="akka.actor.dungeon;DeathWatch.receivedTerminated">receivedTerminated</a><span class="delimiter">(</span><a title="akka.actor.Terminated" id="akka.actor.dungeon;DeathWatch.receivedTerminated.t">t</a>: <a href="../Actor.scala.html#akka.actor;Terminated" title="akka.actor.Terminated">Terminated</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    if <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.terminatedQueued_=" title="(elem: akka.actor.ActorRef)Boolean">terminatedQueued</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.receivedTerminated.t" title="akka.actor.Terminated">t</a>.<a href="../Actor.scala.html#akka.actor;Terminated.actor" title="=&gt; akka.actor.ActorRef">actor</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.actor.dungeon;DeathWatch.terminatedQueued_=" title="(x$1: Set[akka.actor.ActorRef])Unit">terminatedQueued</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-=</span> <a href="#akka.actor.dungeon;DeathWatch.receivedTerminated.t" title="akka.actor.Terminated">t</a>.<a href="../Actor.scala.html#akka.actor;Terminated.actor" title="=&gt; akka.actor.ActorRef">actor</a> <span class="comment">// here we know that it is the SAME ref which was put in</span>
      <a href="../ActorCell.scala.html#akka.actor;ActorCell.receiveMessage" title="(msg: Any)Unit">receiveMessage</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.receivedTerminated.t" title="akka.actor.Terminated">t</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="comment">/**
   * When this actor is watching the subject of [[akka.actor.Terminated]] message
   * it will be propagated to user's receive.
   */</span>
  protected def <a title="(actor: akka.actor.ActorRef, existenceConfirmed: Boolean, addressTerminated: Boolean)Unit" id="akka.actor.dungeon;DeathWatch.watchedActorTerminated">watchedActorTerminated</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.watchedActorTerminated.actor">actor</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Boolean" id="akka.actor.dungeon;DeathWatch.watchedActorTerminated.existenceConfirmed">existenceConfirmed</a>: <span title="Boolean">Boolean</span>, <a title="Boolean" id="akka.actor.dungeon;DeathWatch.watchedActorTerminated.addressTerminated">addressTerminated</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watchingContains" title="(subject: akka.actor.ActorRef)Boolean">watchingContains</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watchedActorTerminated.actor" title="akka.actor.ActorRef">actor</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription" title="(change: akka.actor.ActorRef)(block: =&gt; Unit)Unit">maintainAddressTerminatedSubscription</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watchedActorTerminated.actor" title="akka.actor.ActorRef">actor</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.actor.dungeon;DeathWatch.watching_=" title="(x$1: Set[akka.actor.ActorRef])Unit">watching</a> = <a href="#akka.actor.dungeon;DeathWatch.removeFromSet" title="(subject: akka.actor.ActorRef, set: Set[akka.actor.ActorRef])Set[akka.actor.ActorRef]">removeFromSet</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watchedActorTerminated.actor" title="akka.actor.ActorRef">actor</a>, <a href="#akka.actor.dungeon;DeathWatch.watching_=" title="=&gt; Set[akka.actor.ActorRef]">watching</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="Children.scala.html#akka.actor.dungeon;Children.isTerminating" title="=&gt; Boolean">isTerminating</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.tell" title="(msg: Any, sender: akka.actor.ActorRef)Unit">tell</a><span class="delimiter">(</span><a href="../Actor.scala.html#akka.actor;Terminated" title="(actor: akka.actor.ActorRef)(existenceConfirmed: Boolean, addressTerminated: Boolean)akka.actor.Terminated">Terminated</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watchedActorTerminated.actor" title="akka.actor.ActorRef">actor</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watchedActorTerminated.existenceConfirmed" title="Boolean">existenceConfirmed</a>, <a href="#akka.actor.dungeon;DeathWatch.watchedActorTerminated.addressTerminated" title="Boolean">addressTerminated</a><span class="delimiter">)</span>, <a href="#akka.actor.dungeon;DeathWatch.watchedActorTerminated.actor" title="akka.actor.ActorRef">actor</a><span class="delimiter">)</span>
        <a href="#akka.actor.dungeon;DeathWatch.terminatedQueuedFor" title="(subject: akka.actor.ActorRef)Unit">terminatedQueuedFor</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watchedActorTerminated.actor" title="akka.actor.ActorRef">actor</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    if <span class="delimiter">(</span><a href="Children.scala.html#akka.actor.dungeon;Children.childrenRefs" title="=&gt; akka.actor.dungeon.ChildrenContainer">childrenRefs</a>.<a href="ChildrenContainer.scala.html#akka.actor.dungeon;ChildrenContainer.getByRef" title="(actor: akka.actor.ActorRef)Option[akka.actor.ChildRestartStats]">getByRef</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watchedActorTerminated.actor" title="akka.actor.ActorRef">actor</a><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="FaultHandling.scala.html#akka.actor.dungeon;FaultHandling.handleChildTerminated" title="(child: akka.actor.ActorRef)Unit">handleChildTerminated</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watchedActorTerminated.actor" title="akka.actor.ActorRef">actor</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private<span class="delimiter">[</span>akka<span class="delimiter">]</span> def <a title="(subject: akka.actor.ActorRef)Unit" id="akka.actor.dungeon;DeathWatch.terminatedQueuedFor">terminatedQueuedFor</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.terminatedQueuedFor.subject">subject</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.actor.dungeon;DeathWatch.terminatedQueued_=" title="(x$1: Set[akka.actor.ActorRef])Unit">terminatedQueued</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">+=</span> <a href="#akka.actor.dungeon;DeathWatch.terminatedQueuedFor.subject" title="akka.actor.ActorRef">subject</a>

  <span class="comment">// TODO this should be removed and be replaced with `watching.contains(subject)`</span>
  <span class="comment">//   when all actor references have uid, i.e. actorFor is removed</span>
  private def <a title="(subject: akka.actor.ActorRef)Boolean" id="akka.actor.dungeon;DeathWatch.watchingContains">watchingContains</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.watchingContains.subject">subject</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> =
    <a href="#akka.actor.dungeon;DeathWatch.watching_=" title="=&gt; Set[akka.actor.ActorRef]">watching</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watchingContains.subject" title="akka.actor.ActorRef">subject</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watchingContains.subject" title="akka.actor.ActorRef">subject</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../ActorPath.scala.html#akka.actor;ActorPath.uid" title="=&gt; Int">uid</a> <span title="(x: Int)Boolean">!=</span> ActorCell.<span title="Int(0)">undefinedUid</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
      <a href="#akka.actor.dungeon;DeathWatch.watching_=" title="=&gt; Set[akka.actor.ActorRef]">watching</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span>new <a href="#akka.actor.dungeon;UndefinedUidActorRef" title="akka.actor.dungeon.UndefinedUidActorRef">UndefinedUidActorRef</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watchingContains.subject" title="akka.actor.ActorRef">subject</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">// TODO this should be removed and be replaced with `set - subject`</span>
  <span class="comment">//   when all actor references have uid, i.e. actorFor is removed</span>
  private def <a title="(subject: akka.actor.ActorRef, set: Set[akka.actor.ActorRef])Set[akka.actor.ActorRef]" id="akka.actor.dungeon;DeathWatch.removeFromSet">removeFromSet</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.removeFromSet.subject">subject</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Set[akka.actor.ActorRef]" id="akka.actor.dungeon;DeathWatch.removeFromSet.set">set</a>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> =
    if <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.removeFromSet.subject" title="akka.actor.ActorRef">subject</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../ActorPath.scala.html#akka.actor;ActorPath.uid" title="=&gt; Int">uid</a> <span title="(x: Int)Boolean">!=</span> ActorCell.<span title="Int(0)">undefinedUid</span><span class="delimiter">)</span> <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.removeFromSet.set" title="Set[akka.actor.ActorRef]">set</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-</span> <a href="#akka.actor.dungeon;DeathWatch.removeFromSet.subject" title="akka.actor.ActorRef">subject</a><span class="delimiter">)</span> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-</span> new <a href="#akka.actor.dungeon;UndefinedUidActorRef" title="akka.actor.dungeon.UndefinedUidActorRef">UndefinedUidActorRef</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.removeFromSet.subject" title="akka.actor.ActorRef">subject</a><span class="delimiter">)</span>
    else <a href="#akka.actor.dungeon;DeathWatch.removeFromSet.set" title="Set[akka.actor.ActorRef]">set</a> <span title="(p: akka.actor.ActorRef =&gt; Boolean)scala.collection.immutable.Set[akka.actor.ActorRef]">filterNot</span> <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.removeFromSet.$anonfun.x$1" title="akka.actor.ActorRef">_</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a> <span title="(x$1: Any)Boolean">==</span> <a href="#akka.actor.dungeon;DeathWatch.removeFromSet.subject" title="akka.actor.ActorRef">subject</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a><span class="delimiter">)</span>

  protected def <a title="()Unit" id="akka.actor.dungeon;DeathWatch.tellWatchersWeDied">tellWatchersWeDied</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.dungeon;DeathWatch.watchedBy_=" title="=&gt; Set[akka.actor.ActorRef]">watchedBy</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      try <span class="delimiter">{</span>
        <span class="comment">// Don't need to send to parent parent since it receives a DWN by default</span>
        def <a title="(ifLocal: Boolean)(watcher: akka.actor.ActorRef)Unit" id="akka.actor.dungeon;DeathWatch.tellWatchersWeDied.sendTerminated">sendTerminated</a><span class="delimiter">(</span><a title="Boolean" id="akka.actor.dungeon;DeathWatch.tellWatchersWeDied.sendTerminated.ifLocal">ifLocal</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.tellWatchersWeDied.sendTerminated.watcher">watcher</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
          if <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.tellWatchersWeDied.sendTerminated.watcher" title="akka.actor.ActorRef">watcher</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.actor.ActorRefScope" class="delimiter">[</span><a href="../ActorRef.scala.html#akka.actor;ActorRefScope" title="akka.actor.ActorRefScope">ActorRefScope</a><span class="delimiter">]</span>.<a href="../ActorRef.scala.html#akka.actor;ActorRefScope.isLocal" title="=&gt; Boolean">isLocal</a> <span title="(x: Boolean)Boolean">==</span> <a href="#akka.actor.dungeon;DeathWatch.tellWatchersWeDied.sendTerminated.ifLocal" title="Boolean">ifLocal</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.actor.dungeon;DeathWatch.tellWatchersWeDied.sendTerminated.watcher" title="akka.actor.ActorRef">watcher</a> <span title="(x$1: Any)Boolean">!=</span> <a href="../ActorCell.scala.html#akka.actor;ActorCell.parent" title="=&gt; akka.actor.InternalActorRef">parent</a><span class="delimiter">)</span>
            <a href="#akka.actor.dungeon;DeathWatch.tellWatchersWeDied.sendTerminated.watcher" title="akka.actor.ActorRef">watcher</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.actor.InternalActorRef" class="delimiter">[</span><a href="../ActorRef.scala.html#akka.actor;InternalActorRef" title="akka.actor.InternalActorRef">InternalActorRef</a><span class="delimiter">]</span>.<a href="../ActorRef.scala.html#akka.actor;InternalActorRef.sendSystemMessage" title="(message: akka.dispatch.sysmsg.SystemMessage)Unit">sendSystemMessage</a><span class="delimiter">(</span><a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;DeathWatchNotification" title="(actor: akka.actor.ActorRef, existenceConfirmed: Boolean, addressTerminated: Boolean)akka.dispatch.sysmsg.DeathWatchNotification">DeathWatchNotification</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>, existenceConfirmed = true, addressTerminated = false<span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="comment">/*
         * It is important to notify the remote watchers first, otherwise RemoteDaemon might shut down, causing
         * the remoting to shut down as well. At this point Terminated messages to remote watchers are no longer
         * deliverable.
         *
         * The problematic case is:
         *  1. Terminated is sent to RemoteDaemon
         *   1a. RemoteDaemon is fast enough to notify the terminator actor in RemoteActorRefProvider
         *   1b. The terminator is fast enough to enqueue the shutdown command in the remoting
         *  2. Only at this point is the Terminated (to be sent remotely) enqueued in the mailbox of remoting
         *
         * If the remote watchers are notified first, then the mailbox of the Remoting will guarantee the correct order.
         */</span>
        <a href="#akka.actor.dungeon;DeathWatch.watchedBy_=" title="=&gt; Set[akka.actor.ActorRef]">watchedBy</a> <span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span> <a href="#akka.actor.dungeon;DeathWatch.tellWatchersWeDied.sendTerminated" title="(ifLocal: Boolean)(watcher: akka.actor.ActorRef)Unit">sendTerminated</a><a href="#akka.actor.dungeon;DeathWatch.tellWatchersWeDied.$anonfun.watcher" title="akka.actor.ActorRef" class="delimiter">(</a>ifLocal = false<span class="delimiter">)</span>
        <a href="#akka.actor.dungeon;DeathWatch.watchedBy_=" title="=&gt; Set[akka.actor.ActorRef]">watchedBy</a> <span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span> <a href="#akka.actor.dungeon;DeathWatch.tellWatchersWeDied.sendTerminated" title="(ifLocal: Boolean)(watcher: akka.actor.ActorRef)Unit">sendTerminated</a><a href="#akka.actor.dungeon;DeathWatch.tellWatchersWeDied.$anonfun.watcher" title="akka.actor.ActorRef" class="delimiter">(</a>ifLocal = true<span class="delimiter">)</span>
      <span class="delimiter">}</span> finally <a href="#akka.actor.dungeon;DeathWatch.watchedBy_=" title="(x$1: Set[akka.actor.ActorRef])Unit">watchedBy</a> = <a href="../ActorCell.scala.html#akka.actor.ActorCell" title="akka.actor.ActorCell.type">ActorCell</a>.<a href="../ActorCell.scala.html#akka.actor.ActorCell.emptyActorRefSet" title="=&gt; Set[akka.actor.ActorRef]">emptyActorRefSet</a>
    <span class="delimiter">}</span>

  protected def <a title="(actor: akka.actor.Actor)Unit" id="akka.actor.dungeon;DeathWatch.unwatchWatchedActors">unwatchWatchedActors</a><span class="delimiter">(</span><a title="akka.actor.Actor" id="akka.actor.dungeon;DeathWatch.unwatchWatchedActors.actor">actor</a>: <a href="../Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.dungeon;DeathWatch.watching_=" title="=&gt; Set[akka.actor.ActorRef]">watching</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription" title="(change: akka.actor.ActorRef)(block: =&gt; Unit)Unit">maintainAddressTerminatedSubscription</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        try <span class="delimiter">{</span>
          <a href="#akka.actor.dungeon;DeathWatch.watching_=" title="=&gt; Set[akka.actor.ActorRef]">watching</a> <span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span> <a href="#akka.actor.dungeon;DeathWatch.unwatchWatchedActors.$anonfun.x0$1" title="Unit" class="delimiter">{</a> <span class="comment">// ➡➡➡ NEVER SEND THE SAME SYSTEM MESSAGE OBJECT TO TWO ACTORS ⬅⬅⬅</span>
            case <a title="akka.actor.InternalActorRef" id="akka.actor.dungeon;DeathWatch.unwatchWatchedActors.$anonfun.watchee">watchee</a>: <a href="../ActorRef.scala.html#akka.actor;InternalActorRef" title="akka.actor.InternalActorRef">InternalActorRef</a> ⇒ <a href="#akka.actor.dungeon;DeathWatch.unwatchWatchedActors.$anonfun.watchee" title="akka.actor.InternalActorRef">watchee</a>.<a href="../ActorRef.scala.html#akka.actor;InternalActorRef.sendSystemMessage" title="(message: akka.dispatch.sysmsg.SystemMessage)Unit">sendSystemMessage</a><span class="delimiter">(</span><a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;Unwatch" title="(watchee: akka.actor.ActorRef, watcher: akka.actor.ActorRef)akka.dispatch.sysmsg.Unwatch">Unwatch</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.unwatchWatchedActors.$anonfun.watchee" title="akka.actor.InternalActorRef">watchee</a>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> finally <span class="delimiter">{</span>
          <a href="#akka.actor.dungeon;DeathWatch.watching_=" title="(x$1: Set[akka.actor.ActorRef])Unit">watching</a> = <a href="../ActorCell.scala.html#akka.actor.ActorCell" title="akka.actor.ActorCell.type">ActorCell</a>.<a href="../ActorCell.scala.html#akka.actor.ActorCell.emptyActorRefSet" title="=&gt; Set[akka.actor.ActorRef]">emptyActorRefSet</a>
          <a href="#akka.actor.dungeon;DeathWatch.terminatedQueued_=" title="(x$1: Set[akka.actor.ActorRef])Unit">terminatedQueued</a> = <a href="../ActorCell.scala.html#akka.actor.ActorCell" title="akka.actor.ActorCell.type">ActorCell</a>.<a href="../ActorCell.scala.html#akka.actor.ActorCell.emptyActorRefSet" title="=&gt; Set[akka.actor.ActorRef]">emptyActorRefSet</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  protected def <a title="(watchee: akka.actor.ActorRef, watcher: akka.actor.ActorRef)Unit" id="akka.actor.dungeon;DeathWatch.addWatcher">addWatcher</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.addWatcher.watchee">watchee</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.addWatcher.watcher">watcher</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val watcheeSelf = <a href="#akka.actor.dungeon;DeathWatch.addWatcher.watchee" title="akka.actor.ActorRef">watchee</a> <a title="Boolean" id="akka.actor.dungeon;DeathWatch.addWatcher.watcheeSelf">==</a> <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>
    val watcherSelf = <a href="#akka.actor.dungeon;DeathWatch.addWatcher.watcher" title="akka.actor.ActorRef">watcher</a> <a title="Boolean" id="akka.actor.dungeon;DeathWatch.addWatcher.watcherSelf">==</a> <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>

    if <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.addWatcher.watcheeSelf" title="Boolean">watcheeSelf</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#akka.actor.dungeon;DeathWatch.addWatcher.watcherSelf" title="Boolean">watcherSelf</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.dungeon;DeathWatch.watchedBy_=" title="=&gt; Set[akka.actor.ActorRef]">watchedBy</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.addWatcher.watcher" title="akka.actor.ActorRef">watcher</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription" title="(change: akka.actor.ActorRef)(block: =&gt; Unit)Unit">maintainAddressTerminatedSubscription</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.addWatcher.watcher" title="akka.actor.ActorRef">watcher</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.actor.dungeon;DeathWatch.watchedBy_=" title="(x$1: Set[akka.actor.ActorRef])Unit">watchedBy</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">+=</span> <a href="#akka.actor.dungeon;DeathWatch.addWatcher.watcher" title="akka.actor.ActorRef">watcher</a>
        if <span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.system" title="=&gt; akka.actor.ActorSystemImpl">system</a>.<a href="../ActorSystem.scala.html#akka.actor;ActorSystemImpl.settings" title="=&gt; akka.actor.ActorSystem.Settings">settings</a>.<a href="../ActorSystem.scala.html#akka.actor.ActorSystem;Settings.DebugLifecycle" title="=&gt; Boolean">DebugLifecycle</a><span class="delimiter">)</span> <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Debug" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Debug">Debug</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;now watched by &quot;)">now watched by $</span><a href="#akka.actor.dungeon;DeathWatch.addWatcher.watcher" title="akka.actor.ActorRef">watcher</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> else if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.dungeon;DeathWatch.addWatcher.watcheeSelf" title="Boolean">watcheeSelf</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.actor.dungeon;DeathWatch.addWatcher.watcherSelf" title="Boolean">watcherSelf</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.actor.dungeon;DeathWatch.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span title="Unit" class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.addWatcher.watchee" title="akka.actor.ActorRef">watchee</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> else <span class="delimiter">{</span>
      <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Warning" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Warning">Warning</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span>, <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;BUG: illegal Watch(%s,%s) for %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.addWatcher.watchee" title="akka.actor.ActorRef">watchee</a>, <a href="#akka.actor.dungeon;DeathWatch.addWatcher.watcher" title="akka.actor.ActorRef">watcher</a>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  protected def <a title="(watchee: akka.actor.ActorRef, watcher: akka.actor.ActorRef)Unit" id="akka.actor.dungeon;DeathWatch.remWatcher">remWatcher</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.remWatcher.watchee">watchee</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.remWatcher.watcher">watcher</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val watcheeSelf = <a href="#akka.actor.dungeon;DeathWatch.remWatcher.watchee" title="akka.actor.ActorRef">watchee</a> <a title="Boolean" id="akka.actor.dungeon;DeathWatch.remWatcher.watcheeSelf">==</a> <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>
    val watcherSelf = <a href="#akka.actor.dungeon;DeathWatch.remWatcher.watcher" title="akka.actor.ActorRef">watcher</a> <a title="Boolean" id="akka.actor.dungeon;DeathWatch.remWatcher.watcherSelf">==</a> <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>

    if <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.remWatcher.watcheeSelf" title="Boolean">watcheeSelf</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#akka.actor.dungeon;DeathWatch.remWatcher.watcherSelf" title="Boolean">watcherSelf</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watchedBy_=" title="=&gt; Set[akka.actor.ActorRef]">watchedBy</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.remWatcher.watcher" title="akka.actor.ActorRef">watcher</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription" title="(change: akka.actor.ActorRef)(block: =&gt; Unit)Unit">maintainAddressTerminatedSubscription</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.remWatcher.watcher" title="akka.actor.ActorRef">watcher</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.actor.dungeon;DeathWatch.watchedBy_=" title="(x$1: Set[akka.actor.ActorRef])Unit">watchedBy</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-=</span> <a href="#akka.actor.dungeon;DeathWatch.remWatcher.watcher" title="akka.actor.ActorRef">watcher</a>
        if <span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.system" title="=&gt; akka.actor.ActorSystemImpl">system</a>.<a href="../ActorSystem.scala.html#akka.actor;ActorSystemImpl.settings" title="=&gt; akka.actor.ActorSystem.Settings">settings</a>.<a href="../ActorSystem.scala.html#akka.actor.ActorSystem;Settings.DebugLifecycle" title="=&gt; Boolean">DebugLifecycle</a><span class="delimiter">)</span> <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Debug" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Debug">Debug</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;no longer watched by &quot;)">no longer watched by $</span><a href="#akka.actor.dungeon;DeathWatch.remWatcher.watcher" title="akka.actor.ActorRef">watcher</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> else if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.dungeon;DeathWatch.remWatcher.watcheeSelf" title="Boolean">watcheeSelf</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.actor.dungeon;DeathWatch.remWatcher.watcherSelf" title="Boolean">watcherSelf</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.actor.dungeon;DeathWatch.unwatch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">unwatch</a><span title="Unit" class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.remWatcher.watchee" title="akka.actor.ActorRef">watchee</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> else <span class="delimiter">{</span>
      <a href="../ActorCell.scala.html#akka.actor;ActorCell.publish" title="(e: akka.event.Logging.LogEvent)Unit">publish</a><span class="delimiter">(</span><a href="../../event/Logging.scala.html#akka.event.Logging;Warning" title="(logSource: String, logClass: Class[_], message: Any)akka.event.Logging.Warning">Warning</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<span title="()String">toString</span>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.clazz" title="(o: AnyRef)Class[_]">clazz</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.actor" title="=&gt; akka.actor.Actor">actor</a><span class="delimiter">)</span>, <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;BUG: illegal Unwatch(%s,%s) for %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.remWatcher.watchee" title="akka.actor.ActorRef">watchee</a>, <a href="#akka.actor.dungeon;DeathWatch.remWatcher.watcher" title="akka.actor.ActorRef">watcher</a>, <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  protected def <a title="(address: akka.actor.Address)Unit" id="akka.actor.dungeon;DeathWatch.addressTerminated">addressTerminated</a><span class="delimiter">(</span><a title="akka.actor.Address" id="akka.actor.dungeon;DeathWatch.addressTerminated.address">address</a>: <a href="../Address.scala.html#akka.actor;Address" title="akka.actor.Address">Address</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="comment">// cleanup watchedBy since we know they are dead</span>
    <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription" title="(change: akka.actor.ActorRef)(block: =&gt; Unit)Unit">maintainAddressTerminatedSubscription</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      for <span class="delimiter">(</span><span title="akka.actor.ActorRef">a</span> ← <a href="#akka.actor.dungeon;DeathWatch.watchedBy_=" title="(p: akka.actor.ActorRef =&gt; Boolean)scala.collection.generic.FilterMonadic[akka.actor.ActorRef,scala.collection.immutable.Set[akka.actor.ActorRef]]">watchedBy</a>; if <span title="akka.actor.ActorRef">a</span>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a> <span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">==</span> <a href="#akka.actor.dungeon;DeathWatch.addressTerminated.address" title="akka.actor.Address">address</a><span class="delimiter">)</span> <a href="#akka.actor.dungeon;DeathWatch.watchedBy_=" title="(x$1: Set[akka.actor.ActorRef])Unit">watchedBy</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-=</span> <span title="akka.actor.ActorRef">a</span>
    <span class="delimiter">}</span>

    <span class="comment">// send DeathWatchNotification to self for all matching subjects</span>
    <span class="comment">// that are not child with existenceConfirmed = false because we could have been watching a</span>
    <span class="comment">// non-local ActorRef that had never resolved before the other node went down</span>
    <span class="comment">// When a parent is watching a child and it terminates due to AddressTerminated</span>
    <span class="comment">// it is removed by sending DeathWatchNotification with existenceConfirmed = true to support</span>
    <span class="comment">// immediate creation of child with same name.</span>
    for <span class="delimiter">(</span><span title="akka.actor.ActorRef">a</span> ← <a href="#akka.actor.dungeon;DeathWatch.watching_=" title="(p: akka.actor.ActorRef =&gt; Boolean)scala.collection.generic.FilterMonadic[akka.actor.ActorRef,scala.collection.immutable.Set[akka.actor.ActorRef]]">watching</a>; if <span title="akka.actor.ActorRef">a</span>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a> <span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">==</span> <a href="#akka.actor.dungeon;DeathWatch.addressTerminated.address" title="akka.actor.Address">address</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a>.<a href="../ActorRef.scala.html#akka.actor;InternalActorRef.sendSystemMessage" title="(message: akka.dispatch.sysmsg.SystemMessage)Unit">sendSystemMessage</a><span class="delimiter">(</span><a href="../../dispatch/sysmsg/SystemMessage.scala.html#akka.dispatch.sysmsg;DeathWatchNotification" title="(actor: akka.actor.ActorRef, existenceConfirmed: Boolean, addressTerminated: Boolean)akka.dispatch.sysmsg.DeathWatchNotification">DeathWatchNotification</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">a</span>, existenceConfirmed = <a href="Children.scala.html#akka.actor.dungeon;Children.childrenRefs" title="=&gt; akka.actor.dungeon.ChildrenContainer">childrenRefs</a>.<a href="ChildrenContainer.scala.html#akka.actor.dungeon;ChildrenContainer.getByRef" title="(actor: akka.actor.ActorRef)Option[akka.actor.ChildRestartStats]">getByRef</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">a</span><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span>, addressTerminated = true<span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Starts subscription to AddressTerminated if not already subscribing and the
   * block adds a non-local ref to watching or watchedBy.
   * Ends subscription to AddressTerminated if subscribing and the
   * block removes the last non-local ref from watching and watchedBy.
   */</span>
  private def <a title="[T](change: akka.actor.ActorRef)(block: =&gt; T)T" id="akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription">maintainAddressTerminatedSubscription</a><span class="delimiter">[</span><a title="" id="akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription$default$1;T">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription$default$1">change</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = null<span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; T" id="akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.block">block</a>: ⇒ T<span class="delimiter">)</span>: <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription$default$1;T" title="T">T</a> = <span class="delimiter">{</span>
    def <a title="(ref: akka.actor.ActorRef)Boolean" id="akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.isNonLocal">isNonLocal</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.isNonLocal.ref">ref</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> = <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.isNonLocal.ref" title="akka.actor.ActorRef">ref</a> match <span class="delimiter">{</span>
      case null                              ⇒ true
      case <a title="akka.actor.InternalActorRef" id="akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.isNonLocal.a">a</a>: <a href="../ActorRef.scala.html#akka.actor;InternalActorRef" title="akka.actor.InternalActorRef">InternalActorRef</a> if <span title="=&gt; Boolean">!</span><a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.isNonLocal.a" title="akka.actor.InternalActorRef">a</a>.<a href="../ActorRef.scala.html#akka.actor;InternalActorRef.isLocal" title="=&gt; Boolean">isLocal</a> ⇒ true
      case _                                 ⇒ false
    <span class="delimiter">}</span>

    if <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.isNonLocal" title="(ref: akka.actor.ActorRef)Boolean">isNonLocal</a><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription$default$1" title="akka.actor.ActorRef">change</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      def <a title="=&gt; Boolean" id="akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.hasNonLocalAddress">hasNonLocalAddress</a>: <span title="Boolean">Boolean</span> = <span class="delimiter">(</span><span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watching_=" title="=&gt; Set[akka.actor.ActorRef]">watching</a> <span title="(p: akka.actor.ActorRef =&gt; Boolean)Boolean">exists</span> <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.isNonLocal" title="(ref: akka.actor.ActorRef)Boolean">isNonLocal</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.watchedBy_=" title="=&gt; Set[akka.actor.ActorRef]">watchedBy</a> <span title="(p: akka.actor.ActorRef =&gt; Boolean)Boolean">exists</span> <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.isNonLocal" title="(ref: akka.actor.ActorRef)Boolean">isNonLocal</a><span class="delimiter">)</span><span class="delimiter">)</span>
      val <a title="Boolean" id="akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.had">had</a> = <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.hasNonLocalAddress" title="=&gt; Boolean">hasNonLocalAddress</a>
      val <a title="T" id="akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.result">result</a> = <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.block" title="=&gt; T">block</a>
      val <a title="Boolean" id="akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.has">has</a> = <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.hasNonLocalAddress" title="=&gt; Boolean">hasNonLocalAddress</a>
      if <span class="delimiter">(</span><a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.had" title="Boolean">had</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.has" title="Boolean">has</a><span class="delimiter">)</span> <a href="#akka.actor.dungeon;DeathWatch.unsubscribeAddressTerminated" title="()Unit">unsubscribeAddressTerminated</a><span class="delimiter">(</span><span class="delimiter">)</span>
      else if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.had" title="Boolean">had</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.has" title="Boolean">has</a><span class="delimiter">)</span> <a href="#akka.actor.dungeon;DeathWatch.subscribeAddressTerminated" title="()Unit">subscribeAddressTerminated</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.result" title="T">result</a>
    <span class="delimiter">}</span> else <span class="delimiter">{</span>
      <a href="#akka.actor.dungeon;DeathWatch.maintainAddressTerminatedSubscription.block" title="=&gt; T">block</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="()Unit" id="akka.actor.dungeon;DeathWatch.unsubscribeAddressTerminated">unsubscribeAddressTerminated</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="../Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.event.AddressTerminatedTopic">AddressTerminatedTopic</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.system" title="=&gt; akka.actor.ActorSystemImpl">system</a><span class="delimiter">)</span>.<a href="../../event/AddressTerminatedTopic.scala.html#akka.event;AddressTerminatedTopic.unsubscribe" title="(subscriber: akka.actor.ActorRef)Unit">unsubscribe</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a><span class="delimiter">)</span>

  private def <a title="()Unit" id="akka.actor.dungeon;DeathWatch.subscribeAddressTerminated">subscribeAddressTerminated</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="../Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.event.AddressTerminatedTopic">AddressTerminatedTopic</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.system" title="=&gt; akka.actor.ActorSystemImpl">system</a><span class="delimiter">)</span>.<a href="../../event/AddressTerminatedTopic.scala.html#akka.event;AddressTerminatedTopic.subscribe" title="(subscriber: akka.actor.ActorRef)Unit">subscribe</a><span class="delimiter">(</span><a href="../ActorCell.scala.html#akka.actor;ActorCell.self" title="=&gt; akka.actor.InternalActorRef">self</a><span class="delimiter">)</span>

<span class="delimiter">}</span>

private<span class="delimiter">[</span>akka<span class="delimiter">]</span> class <a title="class UndefinedUidActorRef extends akka.actor.InternalActorRef with akka.actor.MinimalActorRef" id="akka.actor.dungeon;UndefinedUidActorRef">UndefinedUidActorRef</a><a href="#akka.actor.dungeon;UndefinedUidActorRef" title="akka.actor.dungeon.UndefinedUidActorRef" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.actor.dungeon;UndefinedUidActorRef.ref">ref</a>: <a href="../ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> extends <a href="../ActorRef.scala.html#akka.actor;MinimalActorRef" title="akka.actor.MinimalActorRef">MinimalActorRef</a> <span class="delimiter">{</span>
  override val <a title="akka.actor.ActorPath" id="akka.actor.dungeon;UndefinedUidActorRef.path">path</a> = <a href="#akka.actor.dungeon;UndefinedUidActorRef.ref" title="akka.actor.ActorRef">ref</a>.<a href="../ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../ActorPath.scala.html#akka.actor;ActorPath.withUid" title="(uid: Int)akka.actor.ActorPath">withUid</a><span class="delimiter">(</span>ActorCell.<span title="Int(0)">undefinedUid</span><span class="delimiter">)</span>
  override def <a title="=&gt; Nothing" id="akka.actor.dungeon;UndefinedUidActorRef.provider">provider</a> = throw new <span title="UnsupportedOperationException">UnsupportedOperationException</span><span class="delimiter">(</span><span title="String(&quot;UndefinedUidActorRef does not provide&quot;)" class="string">&quot;UndefinedUidActorRef does not provide&quot;</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
