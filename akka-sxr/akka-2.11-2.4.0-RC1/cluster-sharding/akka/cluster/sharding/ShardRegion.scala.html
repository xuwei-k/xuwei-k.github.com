<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>cluster-sharding/akka/cluster/sharding/ShardRegion.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
package akka.cluster.sharding

import java.net.URLEncoder
import scala.collection.immutable
import akka.actor.Actor
import akka.actor.ActorLogging
import akka.actor.ActorRef
import akka.actor.ActorSelection
import akka.actor.Address
import akka.actor.Deploy
import akka.actor.PoisonPill
import akka.actor.Props
import akka.actor.RootActorPath
import akka.actor.Terminated
import akka.cluster.Cluster
import akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.ClusterDomainEvent
import akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.CurrentClusterState
import akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.MemberEvent
import akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.MemberRemoved
import akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.MemberUp
import akka.cluster.Member
import akka.cluster.MemberStatus

<span class="comment">/**
 * @see [[ClusterSharding$ ClusterSharding extension]]
 */</span>
object <a title="akka.cluster.sharding.ShardRegion.type" id="akka.cluster.sharding.ShardRegion">ShardRegion</a> <a href="#akka.cluster.sharding.ShardRegion" title="akka.cluster.sharding.ShardRegion.type" class="delimiter">{</a>

  <span class="comment">/**
   * INTERNAL API
   * Factory method for the [[akka.actor.Props]] of the [[ShardRegion]] actor.
   */</span>
  private<span class="delimiter">[</span>akka<span class="delimiter">]</span> def <a title="(typeName: String, entityProps: akka.actor.Props, settings: akka.cluster.sharding.ClusterShardingSettings, coordinatorPath: String, extractEntityId: akka.cluster.sharding.ShardRegion.ExtractEntityId, extractShardId: akka.cluster.sharding.ShardRegion.ExtractShardId, handOffStopMessage: Any)akka.actor.Props" id="akka.cluster.sharding.ShardRegion.props">props</a><span class="delimiter">(</span>
    <a title="String" id="akka.cluster.sharding.ShardRegion.props.typeName">typeName</a>: <span title="String">String</span>,
    <a title="akka.actor.Props" id="akka.cluster.sharding.ShardRegion.props.entityProps">entityProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a>,
    <a title="akka.cluster.sharding.ClusterShardingSettings" id="akka.cluster.sharding.ShardRegion.props.settings">settings</a>: <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings" title="akka.cluster.sharding.ClusterShardingSettings">ClusterShardingSettings</a>,
    <a title="String" id="akka.cluster.sharding.ShardRegion.props.coordinatorPath">coordinatorPath</a>: <span title="String">String</span>,
    <a title="akka.cluster.sharding.ShardRegion.ExtractEntityId" id="akka.cluster.sharding.ShardRegion.props.extractEntityId">extractEntityId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ExtractEntityId">ExtractEntityId</span>,
    <a title="akka.cluster.sharding.ShardRegion.ExtractShardId" id="akka.cluster.sharding.ShardRegion.props.extractShardId">extractShardId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ExtractShardId">ExtractShardId</span>,
    <a title="Any" id="akka.cluster.sharding.ShardRegion.props.handOffStopMessage">handOffStopMessage</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(b09a6a316b)" title="(creator: =&gt; akka.cluster.sharding.ShardRegion)(implicit evidence$2: scala.reflect.ClassTag[akka.cluster.sharding.ShardRegion])akka.actor.Props">Props</a><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[akka.cluster.sharding.ShardRegion]" class="delimiter">(</span>new <a href="#akka.cluster.sharding;ShardRegion" title="akka.cluster.sharding.ShardRegion">ShardRegion</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardRegion.props.typeName" title="String">typeName</a>, <span title="(x: akka.actor.Props)Some[akka.actor.Props]">Some</span><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardRegion.props.entityProps" title="akka.actor.Props">entityProps</a><span class="delimiter">)</span>, <a href="#akka.cluster.sharding.ShardRegion.props.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>, <a href="#akka.cluster.sharding.ShardRegion.props.coordinatorPath" title="String">coordinatorPath</a>, <a href="#akka.cluster.sharding.ShardRegion.props.extractEntityId" title="akka.cluster.sharding.ShardRegion.ExtractEntityId">extractEntityId</a>,
      <a href="#akka.cluster.sharding.ShardRegion.props.extractShardId" title="akka.cluster.sharding.ShardRegion.ExtractShardId">extractShardId</a>, <a href="#akka.cluster.sharding.ShardRegion.props.handOffStopMessage" title="Any">handOffStopMessage</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.withDeploy" title="(d: akka.actor.Deploy)akka.actor.Props">withDeploy</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy" title="akka.actor.Deploy.type">Deploy</a>.<a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy.local" title="=&gt; akka.actor.Deploy">local</a><span class="delimiter">)</span>

  <span class="comment">/**
   * INTERNAL API
   * Factory method for the [[akka.actor.Props]] of the [[ShardRegion]] actor
   * when using it in proxy only mode.
   */</span>
  private<span class="delimiter">[</span>akka<span class="delimiter">]</span> def <a title="(typeName: String, settings: akka.cluster.sharding.ClusterShardingSettings, coordinatorPath: String, extractEntityId: akka.cluster.sharding.ShardRegion.ExtractEntityId, extractShardId: akka.cluster.sharding.ShardRegion.ExtractShardId)akka.actor.Props" id="akka.cluster.sharding.ShardRegion.proxyProps">proxyProps</a><span class="delimiter">(</span>
    <a title="String" id="akka.cluster.sharding.ShardRegion.proxyProps.typeName">typeName</a>: <span title="String">String</span>,
    <a title="akka.cluster.sharding.ClusterShardingSettings" id="akka.cluster.sharding.ShardRegion.proxyProps.settings">settings</a>: <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings" title="akka.cluster.sharding.ClusterShardingSettings">ClusterShardingSettings</a>,
    <a title="String" id="akka.cluster.sharding.ShardRegion.proxyProps.coordinatorPath">coordinatorPath</a>: <span title="String">String</span>,
    <a title="akka.cluster.sharding.ShardRegion.ExtractEntityId" id="akka.cluster.sharding.ShardRegion.proxyProps.extractEntityId">extractEntityId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ExtractEntityId">ExtractEntityId</span>,
    <a title="akka.cluster.sharding.ShardRegion.ExtractShardId" id="akka.cluster.sharding.ShardRegion.proxyProps.extractShardId">extractShardId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ExtractShardId">ExtractShardId</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(b09a6a316b)" title="(creator: =&gt; akka.cluster.sharding.ShardRegion)(implicit evidence$2: scala.reflect.ClassTag[akka.cluster.sharding.ShardRegion])akka.actor.Props">Props</a><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[akka.cluster.sharding.ShardRegion]" class="delimiter">(</span>new <a href="#akka.cluster.sharding;ShardRegion" title="akka.cluster.sharding.ShardRegion">ShardRegion</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardRegion.proxyProps.typeName" title="String">typeName</a>, <span title="None.type">None</span>, <a href="#akka.cluster.sharding.ShardRegion.proxyProps.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>, <a href="#akka.cluster.sharding.ShardRegion.proxyProps.coordinatorPath" title="String">coordinatorPath</a>, <a href="#akka.cluster.sharding.ShardRegion.proxyProps.extractEntityId" title="akka.cluster.sharding.ShardRegion.ExtractEntityId">extractEntityId</a>, <a href="#akka.cluster.sharding.ShardRegion.proxyProps.extractShardId" title="akka.cluster.sharding.ShardRegion.ExtractShardId">extractShardId</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.PoisonPill" title="akka.actor.PoisonPill.type">PoisonPill</a><span class="delimiter">)</span><span class="delimiter">)</span>
      .<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.withDeploy" title="(d: akka.actor.Deploy)akka.actor.Props">withDeploy</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy" title="akka.actor.Deploy.type">Deploy</a>.<a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy.local" title="=&gt; akka.actor.Deploy">local</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Marker type of entity identifier (`String`).
   */</span>
  type <a title="String" id="akka.cluster.sharding.ShardRegion;EntityId">EntityId</a> = <span title="String">String</span>
  <span class="comment">/**
   * Marker type of shard identifier (`String`).
   */</span>
  type <a title="String" id="akka.cluster.sharding.ShardRegion;ShardId">ShardId</a> = <span title="String">String</span>
  <span class="comment">/**
   * Marker type of application messages (`Any`).
   */</span>
  type <a title="Any" id="akka.cluster.sharding.ShardRegion;Msg">Msg</a> = <span title="Any">Any</span>
  <span class="comment">/**
   * Interface of the partial function used by the [[ShardRegion]] to
   * extract the entity id and the message to send to the entity from an
   * incoming message. The implementation is application specific.
   * If the partial function does not match the message will be
   * `unhandled`, i.e. posted as `Unhandled` messages on the event stream.
   * Note that the extracted  message does not have to be the same as the incoming
   * message to support wrapping in message envelope that is unwrapped before
   * sending to the entity actor.
   */</span>
  type <a title="PartialFunction[akka.cluster.sharding.ShardRegion.Msg,(akka.cluster.sharding.ShardRegion.EntityId, akka.cluster.sharding.ShardRegion.Msg)]" id="akka.cluster.sharding.ShardRegion;ExtractEntityId">ExtractEntityId</a> = <span title="PartialFunction[akka.cluster.sharding.ShardRegion.Msg,(akka.cluster.sharding.ShardRegion.EntityId, akka.cluster.sharding.ShardRegion.Msg)]">PartialFunction</span><span class="delimiter">[</span>Msg, <span class="delimiter">(</span>EntityId, Msg<span class="delimiter">)</span><span class="delimiter">]</span>
  <span class="comment">/**
   * Interface of the function used by the [[ShardRegion]] to
   * extract the shard id from an incoming message.
   * Only messages that passed the [[ExtractEntityId]] will be used
   * as input to this function.
   */</span>
  type <a title="akka.cluster.sharding.ShardRegion.Msg =&gt; akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardRegion;ExtractShardId">ExtractShardId</a> = Msg ⇒ ShardId

  <span class="comment">/**
   * Java API: Interface of functions to extract entity id,
   * shard id, and the message to send to the entity from an
   * incoming message.
   */</span>
  trait <a title="trait MessageExtractor extends AnyRef" id="akka.cluster.sharding.ShardRegion;MessageExtractor">MessageExtractor</a> <span class="delimiter">{</span>
    <span class="comment">/**
     * Extract the entity id from an incoming `message`. If `null` is returned
     * the message will be `unhandled`, i.e. posted as `Unhandled` messages on the event stream
     */</span>
    def <a title="(message: Any)String" id="akka.cluster.sharding.ShardRegion;MessageExtractor.entityId">entityId</a><span class="delimiter">(</span><a title="Any" id="akka.cluster.sharding.ShardRegion;MessageExtractor.entityId.message">message</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="String">String</span>
    <span class="comment">/**
     * Extract the message to send to the entity from an incoming `message`.
     * Note that the extracted message does not have to be the same as the incoming
     * message to support wrapping in message envelope that is unwrapped before
     * sending to the entity actor.
     */</span>
    def <a title="(message: Any)Any" id="akka.cluster.sharding.ShardRegion;MessageExtractor.entityMessage">entityMessage</a><span class="delimiter">(</span><a title="Any" id="akka.cluster.sharding.ShardRegion;MessageExtractor.entityMessage.message">message</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Any">Any</span>
    <span class="comment">/**
     * Extract the entity id from an incoming `message`. Only messages that passed the [[#entityId]]
     * function will be used as input to this function.
     */</span>
    def <a title="(message: Any)String" id="akka.cluster.sharding.ShardRegion;MessageExtractor.shardId">shardId</a><span class="delimiter">(</span><a title="Any" id="akka.cluster.sharding.ShardRegion;MessageExtractor.shardId.message">message</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="String">String</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Convenience implementation of [[ShardRegion.MessageExtractor]] that
   * construct `shardId` based on the `hashCode` of the `entityId`. The number
   * of unique shards is limited by the given `maxNumberOfShards`.
   */</span>
  abstract class <a title="class HashCodeMessageExtractor extends AnyRef with akka.cluster.sharding.ShardRegion.MessageExtractor" id="akka.cluster.sharding.ShardRegion;HashCodeMessageExtractor">HashCodeMessageExtractor</a><a href="#akka.cluster.sharding.ShardRegion;HashCodeMessageExtractor" title="akka.cluster.sharding.ShardRegion.HashCodeMessageExtractor" class="delimiter">(</a><a title="Int" id="akka.cluster.sharding.ShardRegion;HashCodeMessageExtractor.maxNumberOfShards">maxNumberOfShards</a>: <span title="Int">Int</span><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardRegion;MessageExtractor" title="akka.cluster.sharding.ShardRegion.MessageExtractor">MessageExtractor</a> <span class="delimiter">{</span>
    <span class="comment">/**
     * Default implementation pass on the message as is.
     */</span>
    override def <a title="(message: Any)Any" id="akka.cluster.sharding.ShardRegion;HashCodeMessageExtractor.entityMessage">entityMessage</a><span class="delimiter">(</span><a title="Any" id="akka.cluster.sharding.ShardRegion;HashCodeMessageExtractor.entityMessage.message">message</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Any">Any</span> = <a href="#akka.cluster.sharding.ShardRegion;HashCodeMessageExtractor.entityMessage.message" title="Any">message</a>

    override def <a title="(message: Any)String" id="akka.cluster.sharding.ShardRegion;HashCodeMessageExtractor.shardId">shardId</a><span class="delimiter">(</span><a title="Any" id="akka.cluster.sharding.ShardRegion;HashCodeMessageExtractor.shardId.message">message</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="String">String</span> =
      <span class="delimiter">(</span>math.<span title="(x: Int)Int">abs</span><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardRegion;MessageExtractor.entityId" title="(message: Any)String">entityId</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardRegion;HashCodeMessageExtractor.shardId.message" title="Any">message</a><span class="delimiter">)</span>.<span title="()Int">hashCode</span><span class="delimiter">)</span> <span title="(x: Int)Int">%</span> <a href="#akka.cluster.sharding.ShardRegion;HashCodeMessageExtractor.maxNumberOfShards" title="Int">maxNumberOfShards</a><span class="delimiter">)</span>.<span title="()String">toString</span>
  <span class="delimiter">}</span>

  sealed trait <a title="trait ShardRegionCommand extends AnyRef" id="akka.cluster.sharding.ShardRegion;ShardRegionCommand">ShardRegionCommand</a>

  <span class="comment">/**
   * If the state of the entities are persistent you may stop entities that are not used to
   * reduce memory consumption. This is done by the application specific implementation of
   * the entity actors for example by defining receive timeout (`context.setReceiveTimeout`).
   * If a message is already enqueued to the entity when it stops itself the enqueued message
   * in the mailbox will be dropped. To support graceful passivation without loosing such
   * messages the entity actor can send this `Passivate` message to its parent `ShardRegion`.
   * The specified wrapped `stopMessage` will be sent back to the entity, which is
   * then supposed to stop itself. Incoming messages will be buffered by the `ShardRegion`
   * between reception of `Passivate` and termination of the entity. Such buffered messages
   * are thereafter delivered to a new incarnation of the entity.
   *
   * [[akka.actor.PoisonPill]] is a perfectly fine `stopMessage`.
   */</span>
  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class Passivate extends AnyRef with akka.cluster.sharding.ShardRegion.ShardRegionCommand with Product with Serializable" id="akka.cluster.sharding.ShardRegion.Passivate.readResolve">Passivate</a><span title="Product" class="delimiter">(</span><a title="Any" id="akka.cluster.sharding.ShardRegion;Passivate.stopMessage">stopMessage</a>: <span title="Any">Any</span><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardRegion;ShardRegionCommand" title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">ShardRegionCommand</a>

  <span class="comment">/*
   * Send this message to the `ShardRegion` actor to handoff all shards that are hosted by
   * the `ShardRegion` and then the `ShardRegion` actor will be stopped. You can `watch`
   * it to know when it is completed.
   */</span>
  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case object <a href="#akka.cluster.sharding.ShardRegion.GracefulShutdown.productElement.x$1" title="akka.cluster.sharding.ShardRegion.GracefulShutdown.type" id="akka.cluster.sharding.ShardRegion.GracefulShutdown.readResolve">GracefulShutdown</a> extends <a href="#akka.cluster.sharding.ShardRegion;ShardRegionCommand" title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">ShardRegionCommand</a>

  <span class="comment">/**
   * We must be sure that a shard is initialized before to start send messages to it.
   * Shard could be terminated during initialization.
   */</span>
  final case class <a title="class ShardInitialized extends AnyRef with Product with Serializable" id="akka.cluster.sharding.ShardRegion.ShardInitialized.readResolve">ShardInitialized</a><a href="#akka.cluster.sharding.ShardRegion.ShardInitialized.readResolve" title="Product" class="delimiter">(</a><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardRegion;ShardInitialized.shardId">shardId</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Java API: Send this message to the `ShardRegion` actor to handoff all shards that are hosted by
   * the `ShardRegion` and then the `ShardRegion` actor will be stopped. You can `watch`
   * it to know when it is completed.
   */</span>
  def <a title="=&gt; akka.cluster.sharding.ShardRegion.GracefulShutdown.type" id="akka.cluster.sharding.ShardRegion.gracefulShutdownInstance">gracefulShutdownInstance</a> = <a href="#akka.cluster.sharding.ShardRegion.GracefulShutdown.readResolve" title="akka.cluster.sharding.ShardRegion.GracefulShutdown.type">GracefulShutdown</a>

  <span class="comment">/*
   * Send this message to the `ShardRegion` actor to request for [[CurrentRegions]],
   * which contains the addresses of all registered regions.
   * Intended for testing purpose to see when cluster sharding is &quot;ready&quot;.
   */</span>
  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case object <a href="#akka.cluster.sharding.ShardRegion.GetCurrentRegions.productElement.x$1" title="akka.cluster.sharding.ShardRegion.GetCurrentRegions.type" id="akka.cluster.sharding.ShardRegion.GetCurrentRegions.readResolve">GetCurrentRegions</a> extends <a href="#akka.cluster.sharding.ShardRegion;ShardRegionCommand" title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">ShardRegionCommand</a>

  def <a title="=&gt; akka.cluster.sharding.ShardRegion.GetCurrentRegions.type" id="akka.cluster.sharding.ShardRegion.getCurrentRegionsInstance">getCurrentRegionsInstance</a> = <a href="#akka.cluster.sharding.ShardRegion.GetCurrentRegions.readResolve" title="akka.cluster.sharding.ShardRegion.GetCurrentRegions.type">GetCurrentRegions</a>

  <span class="comment">/**
   * Reply to `GetCurrentRegions`
   */</span>
  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class CurrentRegions extends AnyRef with Product with Serializable" id="akka.cluster.sharding.ShardRegion.CurrentRegions.readResolve">CurrentRegions</a><a href="#akka.cluster.sharding.ShardRegion.CurrentRegions.readResolve" title="Product" class="delimiter">(</a><a title="Set[akka.actor.Address]" id="akka.cluster.sharding.ShardRegion;CurrentRegions.regions">regions</a>: <span title="Set[akka.actor.Address]">Set</span><span class="delimiter">[</span>Address<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="comment">/**
     * Java API
     */</span>
    def <a title="=&gt; java.util.Set[akka.actor.Address]" id="akka.cluster.sharding.ShardRegion;CurrentRegions.getRegions">getRegions</a>: java.util.<span title="java.util.Set[akka.actor.Address]">Set</span><span class="delimiter">[</span>Address<span class="delimiter">]</span> = <span class="delimiter">{</span>
      import scala.collection.<span title="scala.collection.JavaConverters.type">JavaConverters</span>._
      <a href="#akka.cluster.sharding.ShardRegion;CurrentRegions.regions" title="(s: scala.collection.Set[akka.actor.Address])scala.collection.convert.Decorators.AsJava[java.util.Set[akka.actor.Address]]">regions</a>.<span title="=&gt; java.util.Set[akka.actor.Address]">asJava</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  private case object <a href="#akka.cluster.sharding.ShardRegion.Retry.productElement.x$1" title="akka.cluster.sharding.ShardRegion.Retry.type" id="akka.cluster.sharding.ShardRegion.Retry.readResolve">Retry</a> extends <a href="#akka.cluster.sharding.ShardRegion;ShardRegionCommand" title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">ShardRegionCommand</a>

  <span class="comment">/**
   * When an remembering entities and the shard stops unexpected (e.g. persist failure), we
   * restart it after a back off using this message.
   */</span>
  private final case class <a title="class RestartShard extends AnyRef with Product with Serializable" id="akka.cluster.sharding.ShardRegion.RestartShard.readResolve">RestartShard</a><a href="#akka.cluster.sharding.ShardRegion.RestartShard.readResolve" title="Product" class="delimiter">(</a><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardRegion;RestartShard.shardId">shardId</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span>

  private def <a title="(role: String)Option[String]" id="akka.cluster.sharding.ShardRegion.roleOption">roleOption</a><span class="delimiter">(</span><a title="String" id="akka.cluster.sharding.ShardRegion.roleOption.role">role</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> =
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardRegion.roleOption.role" title="String">role</a> <span title="(x$1: Any)Boolean">==</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span title="None.type">None</span> else <span title="(x: String)Option[String]">Option</span><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardRegion.roleOption.role" title="String">role</a><span class="delimiter">)</span>

  <span class="comment">/**
   * INTERNAL API. Sends stopMessage (e.g. `PoisonPill`) to the entities and when all of
   * them have terminated it replies with `ShardStopped`.
   */</span>
  private<span class="delimiter">[</span>akka<span class="delimiter">]</span> class <a title="class HandOffStopper extends AnyRef with akka.actor.Actor" id="akka.cluster.sharding.ShardRegion;HandOffStopper">HandOffStopper</a><a href="#akka.cluster.sharding.ShardRegion;HandOffStopper" title="akka.cluster.sharding.ShardRegion.HandOffStopper" class="delimiter">(</a><a title="String" id="akka.cluster.sharding.ShardRegion;HandOffStopper.shard">shard</a>: <span title="String">String</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardRegion;HandOffStopper.replyTo">replyTo</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Set[akka.actor.ActorRef]" id="akka.cluster.sharding.ShardRegion;HandOffStopper.entities">entities</a>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span>, <a title="Any" id="akka.cluster.sharding.ShardRegion;HandOffStopper.stopMessage">stopMessage</a>: <span title="Any">Any</span><span class="delimiter">)</span>
    extends <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="delimiter">{</span>
    import <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator" title="akka.cluster.sharding.ShardCoordinator.type">ShardCoordinator</a>.<a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal" title="akka.cluster.sharding.ShardCoordinator.Internal.type">Internal</a>.ShardStopped

    <a href="#akka.cluster.sharding.ShardRegion;HandOffStopper.entities" title="Set[akka.actor.ActorRef]">entities</a>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardRegion;HandOffStopper.<local HandOffStopper>.$anonfun.a">a</a> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a> <a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a> <a href="#akka.cluster.sharding.ShardRegion;HandOffStopper.<local HandOffStopper>.$anonfun.a" title="akka.actor.ActorRef">a</a>
      <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">a</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardRegion;HandOffStopper.stopMessage" title="Any">stopMessage</a>
    <span class="delimiter">}</span>

    var <a title="Set[akka.actor.ActorRef]" id="akka.cluster.sharding.ShardRegion;HandOffStopper.remaining_=">remaining</a> = <a href="#akka.cluster.sharding.ShardRegion;HandOffStopper.entities" title="Set[akka.actor.ActorRef]">entities</a>

    def <a title="=&gt; PartialFunction[Any,Unit]" id="akka.cluster.sharding.ShardRegion;HandOffStopper.receive">receive</a> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.sharding.ShardRegion;HandOffStopper.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      case Terminated<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardRegion;HandOffStopper.receive;$anonfun.isDefinedAt.ref">ref</a><span class="delimiter">)</span> ⇒
        <a href="#akka.cluster.sharding.ShardRegion;HandOffStopper.remaining_=" title="(x$1: Set[akka.actor.ActorRef])Unit">remaining</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-=</span> <a href="#akka.cluster.sharding.ShardRegion;HandOffStopper.receive;$anonfun.isDefinedAt.ref" title="akka.actor.ActorRef">ref</a>
        if <span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardRegion;HandOffStopper.remaining_=" title="=&gt; Set[akka.actor.ActorRef]">remaining</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">replyTo</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;ShardStopped" title="(shard: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardCoordinator.Internal.ShardStopped">ShardStopped</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardRegion;HandOffStopper.shard" title="String">shard</a><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a> <a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private<span class="delimiter">[</span>akka<span class="delimiter">]</span> def <a title="(shard: String, replyTo: akka.actor.ActorRef, entities: Set[akka.actor.ActorRef], stopMessage: Any)akka.actor.Props" id="akka.cluster.sharding.ShardRegion.handOffStopperProps">handOffStopperProps</a><span class="delimiter">(</span>
    <a title="String" id="akka.cluster.sharding.ShardRegion.handOffStopperProps.shard">shard</a>: <span title="String">String</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardRegion.handOffStopperProps.replyTo">replyTo</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Set[akka.actor.ActorRef]" id="akka.cluster.sharding.ShardRegion.handOffStopperProps.entities">entities</a>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span>, <a title="Any" id="akka.cluster.sharding.ShardRegion.handOffStopperProps.stopMessage">stopMessage</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(b09a6a316b)" title="(creator: =&gt; akka.cluster.sharding.ShardRegion.HandOffStopper)(implicit evidence$2: scala.reflect.ClassTag[akka.cluster.sharding.ShardRegion.HandOffStopper])akka.actor.Props">Props</a><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[akka.cluster.sharding.ShardRegion.HandOffStopper]" class="delimiter">(</span>new <a href="#akka.cluster.sharding.ShardRegion;HandOffStopper" title="akka.cluster.sharding.ShardRegion.HandOffStopper">HandOffStopper</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardRegion.handOffStopperProps.shard" title="String">shard</a>, <a href="#akka.cluster.sharding.ShardRegion.handOffStopperProps.replyTo" title="akka.actor.ActorRef">replyTo</a>, <a href="#akka.cluster.sharding.ShardRegion.handOffStopperProps.entities" title="Set[akka.actor.ActorRef]">entities</a>, <a href="#akka.cluster.sharding.ShardRegion.handOffStopperProps.stopMessage" title="Any">stopMessage</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.withDeploy" title="(d: akka.actor.Deploy)akka.actor.Props">withDeploy</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy" title="akka.actor.Deploy.type">Deploy</a>.<a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy.local" title="=&gt; akka.actor.Deploy">local</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * This actor creates children entity actors on demand for the shards that it is told to be
 * responsible for. It delegates messages targeted to other shards to the responsible
 * `ShardRegion` actor on other nodes.
 *
 * @see [[ClusterSharding$ ClusterSharding extension]]
 */</span>
class <a title="class ShardRegion extends AnyRef with akka.actor.Actor with akka.actor.ActorLogging" id="akka.cluster.sharding;ShardRegion">ShardRegion</a><a href="#akka.cluster.sharding;ShardRegion" title="akka.cluster.sharding.ShardRegion" class="delimiter">(</a>
  <a title="String" id="akka.cluster.sharding;ShardRegion.typeName">typeName</a>: <span title="String">String</span>,
  <a title="Option[akka.actor.Props]" id="akka.cluster.sharding;ShardRegion.entityProps">entityProps</a>: <span title="Option[akka.actor.Props]">Option</span><span class="delimiter">[</span>Props<span class="delimiter">]</span>,
  <a title="akka.cluster.sharding.ClusterShardingSettings" id="akka.cluster.sharding;ShardRegion.settings">settings</a>: <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings" title="akka.cluster.sharding.ClusterShardingSettings">ClusterShardingSettings</a>,
  <a title="String" id="akka.cluster.sharding;ShardRegion.coordinatorPath">coordinatorPath</a>: <span title="String">String</span>,
  <a title="akka.cluster.sharding.ShardRegion.ExtractEntityId" id="akka.cluster.sharding;ShardRegion.extractEntityId">extractEntityId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ExtractEntityId">ExtractEntityId</span>,
  <a title="akka.cluster.sharding.ShardRegion.ExtractShardId" id="akka.cluster.sharding;ShardRegion.extractShardId">extractShardId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ExtractShardId">ExtractShardId</span>,
  <a title="Any" id="akka.cluster.sharding;ShardRegion.handOffStopMessage">handOffStopMessage</a>: <span title="Any">Any</span><span class="delimiter">)</span> extends <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> with <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="delimiter">{</span>

  import <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator" title="akka.cluster.sharding.ShardCoordinator.type">ShardCoordinator</a>.<a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal" title="akka.cluster.sharding.ShardCoordinator.Internal.type">Internal</a>._
  import <a href="#akka.cluster.sharding.ShardRegion" title="akka.cluster.sharding.ShardRegion.type">ShardRegion</a>._
  import <a href="#akka.cluster.sharding;ShardRegion.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>._
  import <a href="#akka.cluster.sharding;ShardRegion.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>.<a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings.tuningParameters" title="=&gt; akka.cluster.sharding.ClusterShardingSettings.TuningParameters">tuningParameters</a>._

  val <a title="akka.cluster.Cluster" id="akka.cluster.sharding;ShardRegion.cluster">cluster</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>

  <span class="comment">// sort by age, oldest first</span>
  val <a title="scala.math.Ordering[akka.cluster.Member]" id="akka.cluster.sharding;ShardRegion.ageOrdering">ageOrdering</a> = <span title="=&gt; math.Ordering.type">Ordering</span>.<span title="[T](cmp: (T, T) =&gt; Boolean)scala.math.Ordering[T]">fromLessThan</span><span title="(cmp: (akka.cluster.Member, akka.cluster.Member) =&gt; Boolean)scala.math.Ordering[akka.cluster.Member]" class="delimiter">[</span><a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member" title="akka.cluster.Member">Member</a><span class="delimiter">]</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.cluster.sharding;ShardRegion.ageOrdering.$anonfun.a">a</a>, <a title="akka.cluster.Member" id="akka.cluster.sharding;ShardRegion.ageOrdering.$anonfun.b">b</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;ShardRegion.ageOrdering.$anonfun.a" title="akka.cluster.Member">a</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.isOlderThan" title="(other: akka.cluster.Member)Boolean">isOlderThan</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.ageOrdering.$anonfun.b" title="akka.cluster.Member">b</a><span class="delimiter">)</span> <span class="delimiter">}</span>
  var <a title="scala.collection.immutable.SortedSet[akka.cluster.Member]" id="akka.cluster.sharding;ShardRegion.membersByAge_=">membersByAge</a>: immutable.<span title="scala.collection.immutable.SortedSet[akka.cluster.Member]">SortedSet</span><span class="delimiter">[</span>Member<span class="delimiter">]</span> = immutable.<span title="scala.collection.immutable.SortedSet.type">SortedSet</span>.<span title="(implicit ord: Ordering[akka.cluster.Member])scala.collection.immutable.SortedSet[akka.cluster.Member]">empty</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.ageOrdering" title="=&gt; scala.math.Ordering[akka.cluster.Member]">ageOrdering</a><span class="delimiter">)</span>

  var <a title="scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]]" id="akka.cluster.sharding;ShardRegion.regions_=">regions</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]]" class="delimiter">[</span><a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <span title="Set[akka.cluster.sharding.ShardRegion.ShardId]">Set</span><span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span>
  var <a title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]" id="akka.cluster.sharding;ShardRegion.regionByShard_=">regionByShard</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]" class="delimiter">[</span><span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>, <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">]</span>
  var <a title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]" id="akka.cluster.sharding;ShardRegion.shardBuffers_=">shardBuffers</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]" class="delimiter">[</span><span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>, <span title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">Vector</span><span class="delimiter">[</span><span class="delimiter">(</span>Msg, ActorRef<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">]</span>
  var <a title="Boolean" id="akka.cluster.sharding;ShardRegion.loggedFullBufferWarning_=">loggedFullBufferWarning</a> = false
  var <a title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]" id="akka.cluster.sharding;ShardRegion.shards_=">shards</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]" class="delimiter">[</span><span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>, <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">]</span>
  var <a title="scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding;ShardRegion.shardsByRef_=">shardsByRef</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.ShardId]" class="delimiter">[</span><a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span><span class="delimiter">]</span>
  var <a title="scala.collection.immutable.Set[akka.actor.ActorRef]" id="akka.cluster.sharding;ShardRegion.handingOff_=">handingOff</a> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.immutable.Set[A]">empty</span><span title="scala.collection.immutable.Set[akka.actor.ActorRef]" class="delimiter">[</span><a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">]</span>
  var <a title="Boolean" id="akka.cluster.sharding;ShardRegion.gracefulShutdownInProgress_=">gracefulShutdownInProgress</a> = false

  def <a title="=&gt; Int" id="akka.cluster.sharding;ShardRegion.totalBufferSize">totalBufferSize</a> = <a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(z: Int)(op: (Int, (akka.cluster.sharding.ShardRegion.ShardId, Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])) =&gt; Int)Int">foldLeft</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="Int" id="akka.cluster.sharding;ShardRegion.totalBufferSize.$anonfun.sum">sum</a>, <a title="(akka.cluster.sharding.ShardRegion.ShardId, Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])" id="akka.cluster.sharding;ShardRegion.totalBufferSize.$anonfun.entity">entity</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;ShardRegion.totalBufferSize.$anonfun.sum" title="Int">sum</a> <span title="(x: Int)Int">+</span> <a href="#akka.cluster.sharding;ShardRegion.totalBufferSize.$anonfun.entity" title="(akka.cluster.sharding.ShardRegion.ShardId, Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])">entity</a>.<span title="=&gt; Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">_2</span>.<span title="=&gt; Int">size</span> <span class="delimiter">}</span>

  import <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher
  val <a title="akka.actor.Cancellable" id="akka.cluster.sharding;ShardRegion.retryTask">retryTask</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.schedule(abf8206fc2)" title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">schedule</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.retryInterval" title="=&gt; scala.concurrent.duration.FiniteDuration">retryInterval</a>, <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.retryInterval" title="=&gt; scala.concurrent.duration.FiniteDuration">retryInterval</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.cluster.sharding.ShardRegion.Retry.readResolve" title="akka.cluster.sharding.ShardRegion.Retry.type">Retry</a><span class="delimiter">)</span>
  var <a title="Int" id="akka.cluster.sharding;ShardRegion.retryCount_=">retryCount</a> = <span title="Int(0)" class="int">0</span>

  <span class="comment">// subscribe to MemberEvent, re-subscribe when restart</span>
  override def <a title="()Unit" id="akka.cluster.sharding;ShardRegion.preStart">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.sharding;ShardRegion.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.subscribe(6cfb44d410)" title="(subscriber: akka.actor.ActorRef, to: Class[_]*)Unit">subscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, classOf<span title="Class[akka.cluster.ClusterEvent.MemberEvent](classOf[akka.cluster.ClusterEvent$$MemberEvent])" class="delimiter">[</span>MemberEvent<span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  override def <a title="()Unit" id="akka.cluster.sharding;ShardRegion.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    super.<a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.postStop" title="()Unit">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.cluster.sharding;ShardRegion.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.unsubscribe(134bd64d81)" title="(subscriber: akka.actor.ActorRef)Unit">unsubscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
    <a href="#akka.cluster.sharding;ShardRegion.retryTask" title="=&gt; akka.actor.Cancellable">retryTask</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Cancellable.cancel" title="()Boolean">cancel</a><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(member: akka.cluster.Member)Boolean" id="akka.cluster.sharding;ShardRegion.matchingRole">matchingRole</a><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.cluster.sharding;ShardRegion.matchingRole.member">member</a>: <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member" title="akka.cluster.Member">Member</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings.role" title="=&gt; Option[String]">role</a> match <span class="delimiter">{</span>
    case <span title="None.type">None</span>    ⇒ true
    case Some<span class="delimiter">(</span><a title="String" id="akka.cluster.sharding;ShardRegion.matchingRole.r">r</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;ShardRegion.matchingRole.member" title="akka.cluster.Member">member</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.hasRole" title="(role: String)Boolean">hasRole</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.matchingRole.r" title="String">r</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="=&gt; Option[akka.actor.ActorSelection]" id="akka.cluster.sharding;ShardRegion.coordinatorSelection">coordinatorSelection</a>: <span title="Option[akka.actor.ActorSelection]">Option</span><span class="delimiter">[</span>ActorSelection<span class="delimiter">]</span> =
    <a href="#akka.cluster.sharding;ShardRegion.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a>.<span title="=&gt; Option[akka.cluster.Member]">headOption</span>.<span title="(f: akka.cluster.Member =&gt; akka.actor.ActorSelection)Option[akka.actor.ActorSelection]">map</span><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.cluster.sharding;ShardRegion.coordinatorSelection.$anonfun.m">m</a> ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorSelection(271eeb39be)" title="(path: String)akka.actor.ActorSelection">actorSelection</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;RootActorPath" title="(address: akka.actor.Address, name: String)akka.actor.RootActorPath">RootActorPath</a><span title="(self: akka.actor.RootActorPath)any2stringadd[akka.actor.RootActorPath]" class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.coordinatorSelection.$anonfun.m" title="akka.cluster.Member">m</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span> <span title="(other: String)String">+</span> <a href="#akka.cluster.sharding;ShardRegion.coordinatorPath" title="String">coordinatorPath</a><span class="delimiter">)</span><span class="delimiter">)</span>

  var <a title="Option[akka.actor.ActorRef]" id="akka.cluster.sharding;ShardRegion.coordinator_=">coordinator</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <span title="None.type">None</span>

  def <a title="(newMembers: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit" id="akka.cluster.sharding;ShardRegion.changeMembers">changeMembers</a><span class="delimiter">(</span><a title="scala.collection.immutable.SortedSet[akka.cluster.Member]" id="akka.cluster.sharding;ShardRegion.changeMembers.newMembers">newMembers</a>: immutable.<span title="scala.collection.immutable.SortedSet[akka.cluster.Member]">SortedSet</span><span class="delimiter">[</span>Member<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val <a title="Option[akka.cluster.Member]" id="akka.cluster.sharding;ShardRegion.changeMembers.before">before</a> = <a href="#akka.cluster.sharding;ShardRegion.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a>.<span title="=&gt; Option[akka.cluster.Member]">headOption</span>
    val <a title="Option[akka.cluster.Member]" id="akka.cluster.sharding;ShardRegion.changeMembers.after">after</a> = <a href="#akka.cluster.sharding;ShardRegion.changeMembers.newMembers" title="scala.collection.immutable.SortedSet[akka.cluster.Member]">newMembers</a>.<span title="=&gt; Option[akka.cluster.Member]">headOption</span>
    <a href="#akka.cluster.sharding;ShardRegion.membersByAge_=" title="(x$1: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit">membersByAge</a> = <a href="#akka.cluster.sharding;ShardRegion.changeMembers.newMembers" title="scala.collection.immutable.SortedSet[akka.cluster.Member]">newMembers</a>
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.changeMembers.before" title="Option[akka.cluster.Member]">before</a> <span title="(x$1: Any)Boolean">!=</span> <a href="#akka.cluster.sharding;ShardRegion.changeMembers.after" title="Option[akka.cluster.Member]">after</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.isDebugEnabled" title="=&gt; Boolean">isDebugEnabled</a><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Coordinator moved from [{}] to [{}]&quot;)" class="string">&quot;Coordinator moved from [{}] to [{}]&quot;</span>, <a href="#akka.cluster.sharding;ShardRegion.changeMembers.before" title="Option[akka.cluster.Member]">before</a>.<span title="(f: akka.cluster.Member =&gt; akka.actor.Address)Option[akka.actor.Address]">map</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.changeMembers.$anonfun.x$1" title="akka.cluster.Member">_</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>.<span title="(default: =&gt; java.io.Serializable)java.io.Serializable">getOrElse</span><span class="delimiter">(</span><span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>, <a href="#akka.cluster.sharding;ShardRegion.changeMembers.after" title="Option[akka.cluster.Member]">after</a>.<span title="(f: akka.cluster.Member =&gt; akka.actor.Address)Option[akka.actor.Address]">map</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.changeMembers.$anonfun.x$2" title="akka.cluster.Member">_</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.address" title="=&gt; akka.actor.Address">address</a><span class="delimiter">)</span>.<span title="(default: =&gt; java.io.Serializable)java.io.Serializable">getOrElse</span><span class="delimiter">(</span><span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardRegion.coordinator_=" title="(x$1: Option[akka.actor.ActorRef])Unit">coordinator</a> = <span title="None.type">None</span>
      <a href="#akka.cluster.sharding;ShardRegion.register" title="()Unit">register</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="=&gt; PartialFunction[Any,Unit]" id="akka.cluster.sharding;ShardRegion.receive">receive</a> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.sharding;ShardRegion.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case Terminated<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.receive;$anonfun.isDefinedAt.ref">ref</a><span class="delimiter">)</span>                         ⇒ <a href="#akka.cluster.sharding;ShardRegion.receiveTerminated" title="(ref: akka.actor.ActorRef)Unit">receiveTerminated</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receive;$anonfun.isDefinedAt.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
    case ShardInitialized<span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;ShardRegion.receive;$anonfun.isDefinedAt.shardId">shardId</a><span class="delimiter">)</span>               ⇒ <a href="#akka.cluster.sharding;ShardRegion.initializeShard" title="(id: akka.cluster.sharding.ShardRegion.ShardId, shard: akka.actor.ActorRef)Unit">initializeShard</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receive;$anonfun.isDefinedAt.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    case <a title="akka.cluster.ClusterEvent.ClusterDomainEvent" id="akka.cluster.sharding;ShardRegion.receive;$anonfun.isDefinedAt.evt">evt</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;ClusterDomainEvent" title="akka.cluster.ClusterEvent.ClusterDomainEvent">ClusterDomainEvent</a>                 ⇒ <a href="#akka.cluster.sharding;ShardRegion.receiveClusterEvent" title="(evt: akka.cluster.ClusterEvent.ClusterDomainEvent)Unit">receiveClusterEvent</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receive;$anonfun.isDefinedAt.evt" title="akka.cluster.ClusterEvent.ClusterDomainEvent">evt</a><span class="delimiter">)</span>
    case <a title="akka.cluster.ClusterEvent.CurrentClusterState" id="akka.cluster.sharding;ShardRegion.receive;$anonfun.isDefinedAt.state">state</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState" title="akka.cluster.ClusterEvent.CurrentClusterState">CurrentClusterState</a>              ⇒ <a href="#akka.cluster.sharding;ShardRegion.receiveClusterState" title="(state: akka.cluster.ClusterEvent.CurrentClusterState)Unit">receiveClusterState</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receive;$anonfun.isDefinedAt.state" title="akka.cluster.ClusterEvent.CurrentClusterState">state</a><span class="delimiter">)</span>
    case <span title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">msg</span>: <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorMessage" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a>                 ⇒ <a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage" title="(msg: akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage)Unit">receiveCoordinatorMessage</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">msg</span><span class="delimiter">)</span>
    case <a title="akka.cluster.sharding.ShardRegion.ShardRegionCommand" id="akka.cluster.sharding;ShardRegion.receive;$anonfun.isDefinedAt.cmd">cmd</a>: <a href="#akka.cluster.sharding.ShardRegion;ShardRegionCommand" title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">ShardRegionCommand</a>                 ⇒ <a href="#akka.cluster.sharding;ShardRegion.receiveCommand" title="(cmd: akka.cluster.sharding.ShardRegion.ShardRegionCommand)Unit">receiveCommand</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receive;$anonfun.isDefinedAt.cmd" title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">cmd</a><span class="delimiter">)</span>
    case <span title="Any">msg</span> if <a href="#akka.cluster.sharding;ShardRegion.extractEntityId" title="akka.cluster.sharding.ShardRegion.ExtractEntityId">extractEntityId</a>.<span title="(x: akka.cluster.sharding.ShardRegion.Msg)Boolean">isDefinedAt</span><span class="delimiter">(</span><span title="Any">msg</span><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;ShardRegion.deliverMessage" title="(msg: Any, snd: akka.actor.ActorRef)Unit">deliverMessage</a><span title="Boolean(true)" class="delimiter">(</span><span title="Any">msg</span>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    case <span title="akka.cluster.sharding.ShardRegion.RestartShard">msg</span>: <a href="#akka.cluster.sharding.ShardRegion.RestartShard.readResolve" title="akka.cluster.sharding.ShardRegion.RestartShard">RestartShard</a>                       ⇒ <a href="#akka.cluster.sharding;ShardRegion.deliverMessage" title="(msg: Any, snd: akka.actor.ActorRef)Unit">deliverMessage</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.RestartShard">msg</span>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(state: akka.cluster.ClusterEvent.CurrentClusterState)Unit" id="akka.cluster.sharding;ShardRegion.receiveClusterState">receiveClusterState</a><span class="delimiter">(</span><a title="akka.cluster.ClusterEvent.CurrentClusterState" id="akka.cluster.sharding;ShardRegion.receiveClusterState.state">state</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState" title="akka.cluster.ClusterEvent.CurrentClusterState">CurrentClusterState</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.sharding;ShardRegion.changeMembers" title="(newMembers: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit">changeMembers</a><span class="delimiter">(</span>immutable.<span title="scala.collection.immutable.SortedSet.type">SortedSet</span>.<span title="(implicit ord: Ordering[akka.cluster.Member])scala.collection.immutable.SortedSet[akka.cluster.Member]">empty</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.ageOrdering" title="=&gt; scala.math.Ordering[akka.cluster.Member]">ageOrdering</a><span class="delimiter">)</span> <span title="(elems: scala.collection.GenTraversableOnce[akka.cluster.Member])scala.collection.immutable.SortedSet[akka.cluster.Member]">++</span> <a href="#akka.cluster.sharding;ShardRegion.receiveClusterState.state" title="akka.cluster.ClusterEvent.CurrentClusterState">state</a>.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState.members" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">members</a>.<span title="(p: akka.cluster.Member =&gt; Boolean)scala.collection.immutable.SortedSet[akka.cluster.Member]">filter</span><span class="delimiter">(</span><a title="akka.cluster.Member" id="akka.cluster.sharding;ShardRegion.receiveClusterState.$anonfun.m">m</a> ⇒
      <a href="#akka.cluster.sharding;ShardRegion.receiveClusterState.$anonfun.m" title="akka.cluster.Member">m</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.status" title="=&gt; akka.cluster.MemberStatus">status</a> <span title="(x$1: Any)Boolean">==</span> <a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.MemberStatus" title="akka.cluster.MemberStatus.type">MemberStatus</a>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster.MemberStatus.Up" title="akka.cluster.MemberStatus.Up.type">Up</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.cluster.sharding;ShardRegion.matchingRole" title="(member: akka.cluster.Member)Boolean">matchingRole</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveClusterState.$anonfun.m" title="akka.cluster.Member">m</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(evt: akka.cluster.ClusterEvent.ClusterDomainEvent)Unit" id="akka.cluster.sharding;ShardRegion.receiveClusterEvent">receiveClusterEvent</a><span class="delimiter">(</span><a title="akka.cluster.ClusterEvent.ClusterDomainEvent" id="akka.cluster.sharding;ShardRegion.receiveClusterEvent.evt">evt</a>: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;ClusterDomainEvent" title="akka.cluster.ClusterEvent.ClusterDomainEvent">ClusterDomainEvent</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.cluster.sharding;ShardRegion.receiveClusterEvent.evt" title="akka.cluster.ClusterEvent.ClusterDomainEvent">evt</a> match <span class="delimiter">{</span>
    case MemberUp<span class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span> ⇒
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.matchingRole" title="(member: akka.cluster.Member)Boolean">matchingRole</a><span class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardRegion.changeMembers" title="(newMembers: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit">changeMembers</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a> <span title="(elem: akka.cluster.Member)scala.collection.immutable.SortedSet[akka.cluster.Member]">+</span> <span title="akka.cluster.Member">m</span><span class="delimiter">)</span>

    case MemberRemoved<span class="delimiter">(</span><span title="akka.cluster.Member">m</span>, _<span class="delimiter">)</span> ⇒
      if <span class="delimiter">(</span><span title="akka.cluster.Member">m</span>.<a href="../../../../cluster/akka/cluster/Member.scala.html#akka.cluster;Member.uniqueAddress" title="=&gt; akka.cluster.UniqueAddress">uniqueAddress</a> <span title="(x$1: Any)Boolean">==</span> <a href="#akka.cluster.sharding;ShardRegion.cluster" title="=&gt; akka.cluster.Cluster">cluster</a>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfUniqueAddress" title="=&gt; akka.cluster.UniqueAddress">selfUniqueAddress</a><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
      else if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.matchingRole" title="(member: akka.cluster.Member)Boolean">matchingRole</a><span class="delimiter">(</span><span title="akka.cluster.Member">m</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardRegion.changeMembers" title="(newMembers: scala.collection.immutable.SortedSet[akka.cluster.Member])Unit">changeMembers</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.membersByAge_=" title="=&gt; scala.collection.immutable.SortedSet[akka.cluster.Member]">membersByAge</a> <span title="(elem: akka.cluster.Member)scala.collection.immutable.SortedSet[akka.cluster.Member]">-</span> <span title="akka.cluster.Member">m</span><span class="delimiter">)</span>

    case _ ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.unhandled" title="(message: Any)Unit">unhandled</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveClusterEvent.evt" title="akka.cluster.ClusterEvent.ClusterDomainEvent">evt</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(msg: akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage)Unit" id="akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage">receiveCoordinatorMessage</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">msg</span>: <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorMessage" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">msg</span> match <span class="delimiter">{</span>
    case HostShard<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Host Shard [{}] &quot;)" class="string">&quot;Host Shard [{}] &quot;</span>, <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardRegion.regionByShard_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef])Unit">regionByShard</a> = <a href="#akka.cluster.sharding;ShardRegion.regionByShard_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">regionByShard</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId, value: akka.actor.ActorRef)scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">updated</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardRegion.regions_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]])Unit">regions</a> = <a href="#akka.cluster.sharding;ShardRegion.regions_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef, value: Set[akka.cluster.sharding.ShardRegion.ShardId])scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]]">updated</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.cluster.sharding;ShardRegion.regions_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef, default: =&gt; Set[akka.cluster.sharding.ShardRegion.ShardId])Set[akka.cluster.sharding.ShardRegion.ShardId]">getOrElse</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">empty</span><span class="delimiter">)</span> <span title="(elem: akka.cluster.sharding.ShardRegion.ShardId)scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">+</span> <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>

      <span class="comment">//Start the shard, if already started this does nothing</span>
      <a href="#akka.cluster.sharding;ShardRegion.getShard" title="(id: akka.cluster.sharding.ShardRegion.ShardId)Option[akka.actor.ActorRef]">getShard</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>

      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;ShardStarted" title="(shard: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardCoordinator.Internal.ShardStarted">ShardStarted</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>

    case ShardHome<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.ref">ref</a><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Shard [{}] located at [{}]&quot;)" class="string">&quot;Shard [{}] located at [{}]&quot;</span>, <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardRegion.regionByShard_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">regionByShard</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Option[akka.actor.ActorRef]">get</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.r">r</a><span class="delimiter">)</span> if <a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.r" title="akka.actor.ActorRef">r</a> <span title="(x$1: Any)Boolean">==</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a> <span title="(x$1: Any)Boolean">!=</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a> ⇒
          <span class="comment">// should not happen, inconsistency between ShardRegion and ShardCoordinator</span>
          throw new <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Unexpected change of shard [&quot;)">Unexpected change of shard [$</span><span class="delimiter">{</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">}</span><span title="String(&quot;] from self to [&quot;)">] from self to [$</span><span class="delimiter">{</span><a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">}</span><span title="String(&quot;]&quot;)" class="string">]&quot;</span><span class="delimiter">)</span>
        case _ ⇒
      <span class="delimiter">}</span>
      <a href="#akka.cluster.sharding;ShardRegion.regionByShard_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef])Unit">regionByShard</a> = <a href="#akka.cluster.sharding;ShardRegion.regionByShard_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">regionByShard</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId, value: akka.actor.ActorRef)scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">updated</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardRegion.regions_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]])Unit">regions</a> = <a href="#akka.cluster.sharding;ShardRegion.regions_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef, value: Set[akka.cluster.sharding.ShardRegion.ShardId])scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]]">updated</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a>, <a href="#akka.cluster.sharding;ShardRegion.regions_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef, default: =&gt; Set[akka.cluster.sharding.ShardRegion.ShardId])Set[akka.cluster.sharding.ShardRegion.ShardId]">getOrElse</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a>, <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">empty</span><span class="delimiter">)</span> <span title="(elem: akka.cluster.sharding.ShardRegion.ShardId)scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">+</span> <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>

      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a> <span title="(x$1: Any)Boolean">!=</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>

      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a> <span title="(x$1: Any)Boolean">==</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardRegion.getShard" title="(id: akka.cluster.sharding.ShardRegion.ShardId)Option[akka.actor.ActorRef]">getShard</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.deliverBufferedMessages" title="(shardId: akka.cluster.sharding.ShardRegion.ShardId, receiver: akka.actor.ActorRef)Unit">deliverBufferedMessages</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.$anonfun.x$3" title="akka.actor.ActorRef">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      else
        <a href="#akka.cluster.sharding;ShardRegion.deliverBufferedMessages" title="(shardId: akka.cluster.sharding.ShardRegion.ShardId, receiver: akka.actor.ActorRef)Unit">deliverBufferedMessages</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>

    case RegisterAck<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.coord">coord</a><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.coord" title="akka.actor.ActorRef">coord</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardRegion.coordinator_=" title="(x$1: Option[akka.actor.ActorRef])Unit">coordinator</a> = <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.coord" title="akka.actor.ActorRef">coord</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardRegion.requestShardBufferHomes" title="()Unit">requestShardBufferHomes</a><span class="delimiter">(</span><span class="delimiter">)</span>

    case BeginHandOff<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;BeginHandOff shard [{}]&quot;)" class="string">&quot;BeginHandOff shard [{}]&quot;</span>, <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.regionByShard_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">regionByShard</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        val <a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.regionRef">regionRef</a> = <a href="#akka.cluster.sharding;ShardRegion.regionByShard_=" title="(key: akka.cluster.sharding.ShardRegion.ShardId)akka.actor.ActorRef">regionByShard</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>
        val updatedShards = <a href="#akka.cluster.sharding;ShardRegion.regions_=" title="(key: akka.actor.ActorRef)Set[akka.cluster.sharding.ShardRegion.ShardId]">regions</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.regionRef" title="akka.actor.ActorRef">regionRef</a><span class="delimiter">)</span> <a title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.updatedShards">-</a> <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>
        if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.updatedShards" title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">updatedShards</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#akka.cluster.sharding;ShardRegion.regions_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]])Unit">regions</a> <span title="(key: akka.actor.ActorRef)scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]]">-=</span> <a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.regionRef" title="akka.actor.ActorRef">regionRef</a>
        else <a href="#akka.cluster.sharding;ShardRegion.regions_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]])Unit">regions</a> = <a href="#akka.cluster.sharding;ShardRegion.regions_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef, value: Set[akka.cluster.sharding.ShardRegion.ShardId])scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]]">updated</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.regionRef" title="akka.actor.ActorRef">regionRef</a>, <a href="#akka.cluster.sharding;ShardRegion.receiveCoordinatorMessage.updatedShards" title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">updatedShards</a><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardRegion.regionByShard_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef])Unit">regionByShard</a> <span title="(key: akka.cluster.sharding.ShardRegion.ShardId)scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">-=</span> <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>
      <span class="delimiter">}</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;BeginHandOffAck" title="(shard: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardCoordinator.Internal.BeginHandOffAck">BeginHandOffAck</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>

    case <span title="akka.cluster.sharding.ShardCoordinator.Internal.HandOff">msg</span> @ HandOff<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;HandOff shard [{}]&quot;)" class="string">&quot;HandOff shard [{}]&quot;</span>, <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>

      <span class="comment">// must drop requests that came in between the BeginHandOff and now,</span>
      <span class="comment">// because they might be forwarded from other regions and there</span>
      <span class="comment">// is a risk or message re-ordering otherwise</span>
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">shardBuffers</a> <span title="(key: akka.cluster.sharding.ShardRegion.ShardId)scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">-=</span> <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>
        <a href="#akka.cluster.sharding;ShardRegion.loggedFullBufferWarning_=" title="(x$1: Boolean)Unit">loggedFullBufferWarning</a> = false
      <span class="delimiter">}</span>

      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.shards_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.cluster.sharding;ShardRegion.handingOff_=" title="(x$1: scala.collection.immutable.Set[akka.actor.ActorRef])Unit">handingOff</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">+=</span> <a href="#akka.cluster.sharding;ShardRegion.shards_=" title="(key: akka.cluster.sharding.ShardRegion.ShardId)akka.actor.ActorRef">shards</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardRegion.shards_=" title="(key: akka.cluster.sharding.ShardRegion.ShardId)akka.actor.ActorRef">shards</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.forward" title="(message: Any)(implicit context: akka.actor.ActorContext)Unit">forward</a> <span title="akka.cluster.sharding.ShardCoordinator.Internal.HandOff">msg</span>
      <span class="delimiter">}</span> else
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;ShardStopped" title="(shard: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardCoordinator.Internal.ShardStopped">ShardStopped</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>

    case _ ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.unhandled" title="(message: Any)Unit">unhandled</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">msg</span><span class="delimiter">)</span>

  <span class="delimiter">}</span>

  def <a title="(cmd: akka.cluster.sharding.ShardRegion.ShardRegionCommand)Unit" id="akka.cluster.sharding;ShardRegion.receiveCommand">receiveCommand</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardRegionCommand" id="akka.cluster.sharding;ShardRegion.receiveCommand.cmd">cmd</a>: <a href="#akka.cluster.sharding.ShardRegion;ShardRegionCommand" title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">ShardRegionCommand</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.cluster.sharding;ShardRegion.receiveCommand.cmd" title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">cmd</a> match <span class="delimiter">{</span>
    case <a href="#akka.cluster.sharding.ShardRegion.Retry.readResolve" title="akka.cluster.sharding.ShardRegion.Retry.type">Retry</a> ⇒
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardRegion.retryCount_=" title="(x$1: Int)Unit">retryCount</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.coordinator_=" title="=&gt; Option[akka.actor.ActorRef]">coordinator</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardRegion.register" title="()Unit">register</a><span class="delimiter">(</span><span class="delimiter">)</span>
      else <span class="delimiter">{</span>
        <a href="#akka.cluster.sharding;ShardRegion.sendGracefulShutdownToCoordinator" title="()Unit">sendGracefulShutdownToCoordinator</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardRegion.requestShardBufferHomes" title="()Unit">requestShardBufferHomes</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    case <a href="#akka.cluster.sharding.ShardRegion.GracefulShutdown.readResolve" title="akka.cluster.sharding.ShardRegion.GracefulShutdown.type">GracefulShutdown</a> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Starting graceful shutdown of region and all its shards&quot;)" class="string">&quot;Starting graceful shutdown of region and all its shards&quot;</span><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardRegion.gracefulShutdownInProgress_=" title="(x$1: Boolean)Unit">gracefulShutdownInProgress</a> = true
      <a href="#akka.cluster.sharding;ShardRegion.sendGracefulShutdownToCoordinator" title="()Unit">sendGracefulShutdownToCoordinator</a><span class="delimiter">(</span><span class="delimiter">)</span>

    case <a href="#akka.cluster.sharding.ShardRegion.GetCurrentRegions.readResolve" title="akka.cluster.sharding.ShardRegion.GetCurrentRegions.type">GetCurrentRegions</a> ⇒
      <a href="#akka.cluster.sharding;ShardRegion.coordinator_=" title="=&gt; Option[akka.actor.ActorRef]">coordinator</a> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.receiveCommand.c">c</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;ShardRegion.receiveCommand.c" title="akka.actor.ActorRef">c</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.forward" title="(message: Any)(implicit context: akka.actor.ActorContext)Unit">forward</a><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext" class="delimiter">(</a><a href="#akka.cluster.sharding.ShardRegion.GetCurrentRegions.readResolve" title="akka.cluster.sharding.ShardRegion.GetCurrentRegions.type">GetCurrentRegions</a><span class="delimiter">)</span>
        case <span title="None.type">None</span>    ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardRegion.CurrentRegions.readResolve" title="(regions: Set[akka.actor.Address])akka.cluster.sharding.ShardRegion.CurrentRegions">CurrentRegions</a><span class="delimiter">(</span><span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.actor.Address]">empty</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    case _ ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.unhandled" title="(message: Any)Unit">unhandled</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveCommand.cmd" title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">cmd</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(ref: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;ShardRegion.receiveTerminated">receiveTerminated</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.receiveTerminated.ref">ref</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.coordinator_=" title="=&gt; Option[akka.actor.ActorRef]">coordinator</a>.<span title="(p: akka.actor.ActorRef =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.$anonfun.x$4" title="akka.actor.ActorRef">_</a> <span title="(x$1: Any)Boolean">==</span> <a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardRegion.coordinator_=" title="(x$1: Option[akka.actor.ActorRef])Unit">coordinator</a> = <span title="None.type">None</span>
    else if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.regions_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="Set[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding;ShardRegion.receiveTerminated.shards">shards</a> = <a href="#akka.cluster.sharding;ShardRegion.regions_=" title="(key: akka.actor.ActorRef)Set[akka.cluster.sharding.ShardRegion.ShardId]">regions</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardRegion.regionByShard_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef])Unit">regionByShard</a> <span title="(xs: scala.collection.GenTraversableOnce[akka.cluster.sharding.ShardRegion.ShardId])scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">--=</span> <a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.shards" title="Set[akka.cluster.sharding.ShardRegion.ShardId]">shards</a>
      <a href="#akka.cluster.sharding;ShardRegion.regions_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]])Unit">regions</a> <span title="(key: akka.actor.ActorRef)scala.collection.immutable.Map[akka.actor.ActorRef,Set[akka.cluster.sharding.ShardRegion.ShardId]]">-=</span> <a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a>
      if <span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.isDebugEnabled" title="=&gt; Boolean">isDebugEnabled</a><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Region [{}] with shards [{}] terminated&quot;)" class="string">&quot;Region [{}] with shards [{}] terminated&quot;</span>, <a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a>, <a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.shards" title="Set[akka.cluster.sharding.ShardRegion.ShardId]">shards</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> else if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.shardsByRef_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.ShardId]">shardsByRef</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;ShardRegion.receiveTerminated.shardId">shardId</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span> = <a href="#akka.cluster.sharding;ShardRegion.shardsByRef_=" title="(key: akka.actor.ActorRef)akka.cluster.sharding.ShardRegion.ShardId">shardsByRef</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>

      <a href="#akka.cluster.sharding;ShardRegion.shardsByRef_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.ShardId])Unit">shardsByRef</a> = <a href="#akka.cluster.sharding;ShardRegion.shardsByRef_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.ShardId]">shardsByRef</a> <span title="(key: akka.actor.ActorRef)scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.ShardId]">-</span> <a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a>
      <a href="#akka.cluster.sharding;ShardRegion.shards_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef])Unit">shards</a> = <a href="#akka.cluster.sharding;ShardRegion.shards_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a> <span title="(key: akka.cluster.sharding.ShardRegion.ShardId)scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">-</span> <a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a>
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.handingOff_=" title="=&gt; scala.collection.immutable.Set[akka.actor.ActorRef]">handingOff</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.cluster.sharding;ShardRegion.handingOff_=" title="(x$1: scala.collection.immutable.Set[akka.actor.ActorRef])Unit">handingOff</a> = <a href="#akka.cluster.sharding;ShardRegion.handingOff_=" title="=&gt; scala.collection.immutable.Set[akka.actor.ActorRef]">handingOff</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-</span> <a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Shard [{}] handoff complete&quot;)" class="string">&quot;Shard [{}] handoff complete&quot;</span>, <a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> else <span class="delimiter">{</span>
        <span class="comment">// if persist fails it will stop</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Shard [{}]  terminated while not being handed off&quot;)" class="string">&quot;Shard [{}]  terminated while not being handed off&quot;</span>, <a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a><span class="delimiter">)</span>
        if <span class="delimiter">(</span><a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings.rememberEntities" title="=&gt; Boolean">rememberEntities</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.scheduleOnce(a2d55b51db)" title="(delay: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">scheduleOnce</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.shardFailureBackoff" title="=&gt; scala.concurrent.duration.FiniteDuration">shardFailureBackoff</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.cluster.sharding.ShardRegion.RestartShard.readResolve" title="(shardId: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardRegion.RestartShard">RestartShard</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.receiveTerminated.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.gracefulShutdownInProgress_=" title="=&gt; Boolean">gracefulShutdownInProgress</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.cluster.sharding;ShardRegion.shards_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span> <span class="comment">// all shards have been rebalanced, complete graceful shutdown</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="()Unit" id="akka.cluster.sharding;ShardRegion.register">register</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.sharding;ShardRegion.coordinatorSelection" title="=&gt; Option[akka.actor.ActorSelection]">coordinatorSelection</a>.<span title="(f: akka.actor.ActorSelection =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor.ActorSelection.toScala" title="implicit akka.actor.ActorSelection.toScala : (sel: akka.actor.ActorSelection)akka.actor.ScalaActorSelection">_</a> <a href="../../../../actor/akka/actor/ActorSelection.scala.html#akka.actor;ScalaActorSelection.!" title="(msg: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding;ShardRegion.registrationMessage" title="=&gt; Any">registrationMessage</a><span class="delimiter">)</span>
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="=&gt; Boolean">nonEmpty</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.cluster.sharding;ShardRegion.retryCount_=" title="=&gt; Int">retryCount</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.warning(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;Trying to register to coordinator at [{}], but no acknoledgment. Total [{}] buffered messages.&quot;)" class="string">&quot;Trying to register to coordinator at [{}], but no acknoledgment. Total [{}] buffered messages.&quot;</span>,
        <a href="#akka.cluster.sharding;ShardRegion.coordinatorSelection" title="=&gt; Option[akka.actor.ActorSelection]">coordinatorSelection</a>, <a href="#akka.cluster.sharding;ShardRegion.totalBufferSize" title="=&gt; Int">totalBufferSize</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="=&gt; Any" id="akka.cluster.sharding;ShardRegion.registrationMessage">registrationMessage</a>: <span title="Any">Any</span> =
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.entityProps" title="Option[akka.actor.Props]">entityProps</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;Register" title="(shardRegion: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.Register">Register</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span> else <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;RegisterProxy" title="(shardRegionProxy: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.RegisterProxy">RegisterProxy</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>

  def <a title="()Unit" id="akka.cluster.sharding;ShardRegion.requestShardBufferHomes">requestShardBufferHomes</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(f: ((akka.cluster.sharding.ShardRegion.ShardId, Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])) =&gt; Unit)Unit">foreach</span> <a href="#akka.cluster.sharding;ShardRegion.requestShardBufferHomes.$anonfun.x0$1" title="Unit" class="delimiter">{</a>
      case <span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;ShardRegion.requestShardBufferHomes.$anonfun.shard">shard</a>, <a title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]" id="akka.cluster.sharding;ShardRegion.requestShardBufferHomes.$anonfun.buf">buf</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;ShardRegion.coordinator_=" title="=&gt; Option[akka.actor.ActorRef]">coordinator</a>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.requestShardBufferHomes.$anonfun.$anonfun.c">c</a> ⇒
        val <a title="String" id="akka.cluster.sharding;ShardRegion.requestShardBufferHomes.$anonfun.$anonfun.logMsg">logMsg</a> = <span title="String(&quot;Retry request for shard [{}] homes from coordinator at [{}]. [{}] buffered messages.&quot;)" class="string">&quot;Retry request for shard [{}] homes from coordinator at [{}]. [{}] buffered messages.&quot;</span>
        if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.retryCount_=" title="=&gt; Int">retryCount</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.warning(6c666e4343)" title="(template: String, arg1: Any, arg2: Any, arg3: Any)Unit">warning</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.requestShardBufferHomes.$anonfun.$anonfun.logMsg" title="String">logMsg</a>, <a href="#akka.cluster.sharding;ShardRegion.requestShardBufferHomes.$anonfun.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a>, <a href="#akka.cluster.sharding;ShardRegion.requestShardBufferHomes.$anonfun.$anonfun.c" title="akka.actor.ActorRef">c</a>, <a href="#akka.cluster.sharding;ShardRegion.requestShardBufferHomes.$anonfun.buf" title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">buf</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
        else
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(6c666e4343)" title="(template: String, arg1: Any, arg2: Any, arg3: Any)Unit">debug</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.requestShardBufferHomes.$anonfun.$anonfun.logMsg" title="String">logMsg</a>, <a href="#akka.cluster.sharding;ShardRegion.requestShardBufferHomes.$anonfun.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a>, <a href="#akka.cluster.sharding;ShardRegion.requestShardBufferHomes.$anonfun.$anonfun.c" title="akka.actor.ActorRef">c</a>, <a href="#akka.cluster.sharding;ShardRegion.requestShardBufferHomes.$anonfun.buf" title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">buf</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>

        <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">c</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;GetShardHome" title="(shard: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardCoordinator.Internal.GetShardHome">GetShardHome</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.requestShardBufferHomes.$anonfun.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(id: akka.cluster.sharding.ShardRegion.ShardId, shard: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;ShardRegion.initializeShard">initializeShard</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;ShardRegion.initializeShard.id">id</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.initializeShard.shard">shard</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Shard was initialized {}&quot;)" class="string">&quot;Shard was initialized {}&quot;</span>, <a href="#akka.cluster.sharding;ShardRegion.initializeShard.id" title="akka.cluster.sharding.ShardRegion.ShardId">id</a><span class="delimiter">)</span>
    <a href="#akka.cluster.sharding;ShardRegion.shards_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef])Unit">shards</a> = <a href="#akka.cluster.sharding;ShardRegion.shards_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId, value: akka.actor.ActorRef)scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">updated</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.initializeShard.id" title="akka.cluster.sharding.ShardRegion.ShardId">id</a>, <a href="#akka.cluster.sharding;ShardRegion.initializeShard.shard" title="akka.actor.ActorRef">shard</a><span class="delimiter">)</span>
    <a href="#akka.cluster.sharding;ShardRegion.deliverBufferedMessages" title="(shardId: akka.cluster.sharding.ShardRegion.ShardId, receiver: akka.actor.ActorRef)Unit">deliverBufferedMessages</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.initializeShard.id" title="akka.cluster.sharding.ShardRegion.ShardId">id</a>, <a href="#akka.cluster.sharding;ShardRegion.initializeShard.shard" title="akka.actor.ActorRef">shard</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(shardId: akka.cluster.sharding.ShardRegion.ShardId, msg: Any, snd: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;ShardRegion.bufferMessage">bufferMessage</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;ShardRegion.bufferMessage.shardId">shardId</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>, <a title="Any" id="akka.cluster.sharding;ShardRegion.bufferMessage.msg">msg</a>: <span title="Any">Any</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.bufferMessage.snd">snd</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    val <a title="Int" id="akka.cluster.sharding;ShardRegion.bufferMessage.totBufSize">totBufSize</a> = <a href="#akka.cluster.sharding;ShardRegion.totalBufferSize" title="=&gt; Int">totalBufferSize</a>
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.bufferMessage.totBufSize" title="Int">totBufSize</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.bufferSize" title="=&gt; Int">bufferSize</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.loggedFullBufferWarning_=" title="=&gt; Boolean">loggedFullBufferWarning</a><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Buffer is full, dropping message for shard [{}]&quot;)" class="string">&quot;Buffer is full, dropping message for shard [{}]&quot;</span>, <a href="#akka.cluster.sharding;ShardRegion.bufferMessage.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a><span class="delimiter">)</span>
      else <span class="delimiter">{</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.warning(dc73c33c91)" title="(template: String, arg1: Any)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;Buffer is full, dropping message for shard [{}]&quot;)" class="string">&quot;Buffer is full, dropping message for shard [{}]&quot;</span>, <a href="#akka.cluster.sharding;ShardRegion.bufferMessage.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardRegion.loggedFullBufferWarning_=" title="(x$1: Boolean)Unit">loggedFullBufferWarning</a> = true
      <span class="delimiter">}</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">deadLetters</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding;ShardRegion.bufferMessage.msg" title="Any">msg</a>
    <span class="delimiter">}</span> else <span class="delimiter">{</span>
      val <a title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]" id="akka.cluster.sharding;ShardRegion.bufferMessage.buf">buf</a> = <a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId, default: =&gt; Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">getOrElse</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.bufferMessage.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a>, <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">shardBuffers</a> = <a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId, value: Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">updated</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.bufferMessage.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a>, <a href="#akka.cluster.sharding;ShardRegion.bufferMessage.buf" title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">buf</a> <span title="(elem: (akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)],(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef),Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]])Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">:+</span> <span class="delimiter">(</span><span title="(_1: Any, _2: akka.actor.ActorRef)(Any, akka.actor.ActorRef)" class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.bufferMessage.msg" title="Any">msg</a>, <a href="#akka.cluster.sharding;ShardRegion.bufferMessage.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="comment">// log some insight to how buffers are filled up every 10% of the buffer capacity</span>
      val tot = <a href="#akka.cluster.sharding;ShardRegion.bufferMessage.totBufSize" title="Int">totBufSize</a> <a title="Int" id="akka.cluster.sharding;ShardRegion.bufferMessage.tot">+</a> <span title="Int(1)" class="int">1</span>
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.bufferMessage.tot" title="Int">tot</a> <span title="(x: Int)Int">%</span> <span class="delimiter">(</span><a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.bufferSize" title="=&gt; Int">bufferSize</a> <span title="(x: Int)Int">/</span> <span title="Int(10)" class="int">10</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        val <a title="String" id="akka.cluster.sharding;ShardRegion.bufferMessage.logMsg">logMsg</a> = <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;ShardRegion for [&quot;)">ShardRegion for [$</span><a href="#akka.cluster.sharding;ShardRegion.typeName" title="String">typeName</a><span title="String(&quot;] is using [&quot;)">] is using [$</span><span class="delimiter">{</span><span title="Double(100.0)" class="double">100.0</span> <span title="(x: Int)Double">*</span> <a href="#akka.cluster.sharding;ShardRegion.bufferMessage.tot" title="Int">tot</a> <span title="(x: Int)Double">/</span> <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.bufferSize" title="=&gt; Int">bufferSize</a><span class="delimiter">}</span><span title="String(&quot; %] of its buffer capacity.&quot;)" class="string"> %] of its buffer capacity.&quot;</span>
        if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.bufferMessage.tot" title="Int">tot</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.bufferSize" title="=&gt; Int">bufferSize</a> <span title="(x: Int)Int">/</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.info(cc2e600322)" title="(message: String)Unit">info</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.bufferMessage.logMsg" title="String">logMsg</a><span class="delimiter">)</span>
        else
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.warning(cc2e600322)" title="(message: String)Unit">warning</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.bufferMessage.logMsg" title="String">logMsg</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; The coordinator might not be available. You might want to check cluster membership status.&quot;)" class="string">&quot; The coordinator might not be available. You might want to check cluster membership status.&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(shardId: akka.cluster.sharding.ShardRegion.ShardId, receiver: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;ShardRegion.deliverBufferedMessages">deliverBufferedMessages</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;ShardRegion.deliverBufferedMessages.shardId">shardId</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.deliverBufferedMessages.receiver">receiver</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Option[Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">get</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.deliverBufferedMessages.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]" id="akka.cluster.sharding;ShardRegion.deliverBufferedMessages.buf">buf</a><span class="delimiter">)</span> ⇒
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Deliver [{}] buffered messages for shard [{}]&quot;)" class="string">&quot;Deliver [{}] buffered messages for shard [{}]&quot;</span>, <a href="#akka.cluster.sharding;ShardRegion.deliverBufferedMessages.buf" title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">buf</a>.<span title="=&gt; Int">size</span>, <a href="#akka.cluster.sharding;ShardRegion.deliverBufferedMessages.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardRegion.deliverBufferedMessages.buf" title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">buf</a>.<span title="(f: ((akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)) =&gt; Unit)Unit">foreach</span> <a href="#akka.cluster.sharding;ShardRegion.deliverBufferedMessages.$anonfun.x0$2" title="Unit" class="delimiter">{</a> case <span class="delimiter">(</span><a title="Any" id="akka.cluster.sharding;ShardRegion.deliverBufferedMessages.$anonfun.msg">msg</a>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.deliverBufferedMessages.$anonfun.snd">snd</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;ShardRegion.deliverBufferedMessages.receiver" title="akka.actor.ActorRef">receiver</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.tell" title="(msg: Any, sender: akka.actor.ActorRef)Unit">tell</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.deliverBufferedMessages.$anonfun.msg" title="Any">msg</a>, <a href="#akka.cluster.sharding;ShardRegion.deliverBufferedMessages.$anonfun.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span> <span class="delimiter">}</span>
        <a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">shardBuffers</a> <span title="(key: akka.cluster.sharding.ShardRegion.ShardId)scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">-=</span> <a href="#akka.cluster.sharding;ShardRegion.deliverBufferedMessages.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a>
      case <span title="None.type">None</span> ⇒
    <span class="delimiter">}</span>
    <a href="#akka.cluster.sharding;ShardRegion.loggedFullBufferWarning_=" title="(x$1: Boolean)Unit">loggedFullBufferWarning</a> = false
    <a href="#akka.cluster.sharding;ShardRegion.retryCount_=" title="(x$1: Int)Unit">retryCount</a> = <span title="Int(0)" class="int">0</span>
  <span class="delimiter">}</span>

  def <a title="(msg: Any, snd: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;ShardRegion.deliverMessage">deliverMessage</a><span class="delimiter">(</span><a title="Any" id="akka.cluster.sharding;ShardRegion.deliverMessage.msg">msg</a>: <span title="Any">Any</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.deliverMessage.snd">snd</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.cluster.sharding;ShardRegion.deliverMessage.msg" title="Any">msg</a> match <span class="delimiter">{</span>
      case RestartShard<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span><span class="delimiter">)</span> ⇒
        <a href="#akka.cluster.sharding;ShardRegion.regionByShard_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">regionByShard</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Option[akka.actor.ActorRef]">get</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span><span class="delimiter">)</span> match <span class="delimiter">{</span>
          case Some<span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span> ⇒
            if <span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span> <span title="(x$1: Any)Boolean">==</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
              <a href="#akka.cluster.sharding;ShardRegion.getShard" title="(id: akka.cluster.sharding.ShardRegion.ShardId)Option[akka.actor.ActorRef]">getShard</a><span title="Unit" class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span><span class="delimiter">)</span>
          case <span title="None.type">None</span> ⇒
            if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Request shard [{}] home&quot;)" class="string">&quot;Request shard [{}] home&quot;</span>, <span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span><span class="delimiter">)</span>
              <a href="#akka.cluster.sharding;ShardRegion.coordinator_=" title="=&gt; Option[akka.actor.ActorRef]">coordinator</a>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">_</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;GetShardHome" title="(shard: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardCoordinator.Internal.GetShardHome">GetShardHome</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            val <span title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span> = <a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId, default: =&gt; Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">getOrElse</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span>, <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span><span class="delimiter">)</span>
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Buffer message for shard [{}]. Total [{}] buffered messages.&quot;)" class="string">&quot;Buffer message for shard [{}]. Total [{}] buffered messages.&quot;</span>, <span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span>, <span title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
            <a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">shardBuffers</a> = <a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId, value: Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">updated</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span>, <span title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span> <span title="(elem: (akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)],(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef),Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]])Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">:+</span> <span class="delimiter">(</span><span title="(_1: Any, _2: akka.actor.ActorRef)(Any, akka.actor.ActorRef)" class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.deliverMessage.msg" title="Any">msg</a>, <a href="#akka.cluster.sharding;ShardRegion.deliverMessage.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      case _ ⇒
        val <span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span> = <a href="#akka.cluster.sharding;ShardRegion.extractShardId" title="(v1: akka.cluster.sharding.ShardRegion.Msg)akka.cluster.sharding.ShardRegion.ShardId">extractShardId</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.deliverMessage.msg" title="Any">msg</a><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardRegion.regionByShard_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">regionByShard</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Option[akka.actor.ActorRef]">get</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span><span class="delimiter">)</span> match <span class="delimiter">{</span>
          case Some<span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span> if <span title="akka.actor.ActorRef">ref</span> <span title="(x$1: Any)Boolean">==</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a> ⇒
            <a href="#akka.cluster.sharding;ShardRegion.getShard" title="(id: akka.cluster.sharding.ShardRegion.ShardId)Option[akka.actor.ActorRef]">getShard</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span><span class="delimiter">)</span> match <span class="delimiter">{</span>
              case Some<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.deliverMessage.shard">shard</a><span class="delimiter">)</span> ⇒
                <a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Option[Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">get</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span><span class="delimiter">)</span> match <span class="delimiter">{</span>
                  case Some<span class="delimiter">(</span><span title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span><span class="delimiter">)</span> ⇒
                    <span class="comment">// Since now messages to a shard is buffered then those messages must be in right order</span>
                    <a href="#akka.cluster.sharding;ShardRegion.bufferMessage" title="(shardId: akka.cluster.sharding.ShardRegion.ShardId, msg: Any, snd: akka.actor.ActorRef)Unit">bufferMessage</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span>, <a href="#akka.cluster.sharding;ShardRegion.deliverMessage.msg" title="Any">msg</a>, <a href="#akka.cluster.sharding;ShardRegion.deliverMessage.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span>
                    <a href="#akka.cluster.sharding;ShardRegion.deliverBufferedMessages" title="(shardId: akka.cluster.sharding.ShardRegion.ShardId, receiver: akka.actor.ActorRef)Unit">deliverBufferedMessages</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span>, <a href="#akka.cluster.sharding;ShardRegion.deliverMessage.shard" title="akka.actor.ActorRef">shard</a><span class="delimiter">)</span>
                  case <span title="None.type">None</span> ⇒
                    <a href="#akka.cluster.sharding;ShardRegion.deliverMessage.shard" title="akka.actor.ActorRef">shard</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.tell" title="(msg: Any, sender: akka.actor.ActorRef)Unit">tell</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.deliverMessage.msg" title="Any">msg</a>, <a href="#akka.cluster.sharding;ShardRegion.deliverMessage.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span>
                <span class="delimiter">}</span>
              case <span title="None.type">None</span> ⇒ <a href="#akka.cluster.sharding;ShardRegion.bufferMessage" title="(shardId: akka.cluster.sharding.ShardRegion.ShardId, msg: Any, snd: akka.actor.ActorRef)Unit">bufferMessage</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span>, <a href="#akka.cluster.sharding;ShardRegion.deliverMessage.msg" title="Any">msg</a>, <a href="#akka.cluster.sharding;ShardRegion.deliverMessage.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          case Some<span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span> ⇒
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Forwarding request for shard [{}] to [{}]&quot;)" class="string">&quot;Forwarding request for shard [{}] to [{}]&quot;</span>, <span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span>, <span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span>
            <span title="akka.actor.ActorRef">ref</span>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.tell" title="(msg: Any, sender: akka.actor.ActorRef)Unit">tell</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.deliverMessage.msg" title="Any">msg</a>, <a href="#akka.cluster.sharding;ShardRegion.deliverMessage.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span>
          case <span title="None.type">None</span> if <span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span> <span title="(x$1: Any)Boolean">==</span> null <span title="(x: Boolean)Boolean">||</span> <span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span> <span title="(x$1: Any)Boolean">==</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> ⇒
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.warning(dc73c33c91)" title="(template: String, arg1: Any)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;Shard must not be empty, dropping message [{}]&quot;)" class="string">&quot;Shard must not be empty, dropping message [{}]&quot;</span>, <a href="#akka.cluster.sharding;ShardRegion.deliverMessage.msg" title="Any">msg</a>.<span title="()Class[_]">getClass</span>.<span title="()String">getName</span><span class="delimiter">)</span>
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">deadLetters</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding;ShardRegion.deliverMessage.msg" title="Any">msg</a>
          case <span title="None.type">None</span> ⇒
            if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.sharding;ShardRegion.shardBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">shardBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Request shard [{}] home&quot;)" class="string">&quot;Request shard [{}] home&quot;</span>, <span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span><span class="delimiter">)</span>
              <a href="#akka.cluster.sharding;ShardRegion.coordinator_=" title="=&gt; Option[akka.actor.ActorRef]">coordinator</a>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">_</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;GetShardHome" title="(shard: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardCoordinator.Internal.GetShardHome">GetShardHome</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <a href="#akka.cluster.sharding;ShardRegion.bufferMessage" title="(shardId: akka.cluster.sharding.ShardRegion.ShardId, msg: Any, snd: akka.actor.ActorRef)Unit">bufferMessage</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shardId</span>, <a href="#akka.cluster.sharding;ShardRegion.deliverMessage.msg" title="Any">msg</a>, <a href="#akka.cluster.sharding;ShardRegion.deliverMessage.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  def <a title="(id: akka.cluster.sharding.ShardRegion.ShardId)Option[akka.actor.ActorRef]" id="akka.cluster.sharding;ShardRegion.getShard">getShard</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;ShardRegion.getShard.id">id</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <a href="#akka.cluster.sharding;ShardRegion.shards_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Option[akka.actor.ActorRef]">get</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.getShard.id" title="akka.cluster.sharding.ShardRegion.ShardId">id</a><span class="delimiter">)</span>.<span title="(alternative: =&gt; Option[akka.actor.ActorRef])Option[akka.actor.ActorRef]">orElse</span><span class="delimiter">(</span>
    <a href="#akka.cluster.sharding;ShardRegion.entityProps" title="Option[akka.actor.Props]">entityProps</a> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><span title="akka.actor.Props">props</span><span class="delimiter">)</span> if <span title="=&gt; Boolean">!</span><a href="#akka.cluster.sharding;ShardRegion.shardsByRef_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.ShardId]">shardsByRef</a>.<span title="=&gt; Iterable[akka.cluster.sharding.ShardRegion.ShardId]">values</span>.<span title="(p: akka.cluster.sharding.ShardRegion.ShardId =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.getShard.$anonfun.x$8" title="akka.cluster.sharding.ShardRegion.ShardId">_</a> <span title="(x$1: Any)Boolean">==</span> <a href="#akka.cluster.sharding;ShardRegion.getShard.id" title="akka.cluster.sharding.ShardRegion.ShardId">id</a><span class="delimiter">)</span> ⇒
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Starting shard [{}] in region&quot;)" class="string">&quot;Starting shard [{}] in region&quot;</span>, <a href="#akka.cluster.sharding;ShardRegion.getShard.id" title="akka.cluster.sharding.ShardRegion.ShardId">id</a><span class="delimiter">)</span>

        val <a title="String" id="akka.cluster.sharding;ShardRegion.getShard.name">name</a> = <span title="java.net.URLEncoder.type">URLEncoder</span>.<span title="(x$1: String, x$2: String)String">encode</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.getShard.id" title="akka.cluster.sharding.ShardRegion.ShardId">id</a>, <span title="String(&quot;utf-8&quot;)" class="string">&quot;utf-8&quot;</span><span class="delimiter">)</span>
        val <a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardRegion.getShard.shard">shard</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(874c98419a)" title="(props: akka.actor.Props, name: String)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span>
          <a href="Shard.scala.html#akka.cluster.sharding.Shard" title="akka.cluster.sharding.Shard.type">Shard</a>.<a href="Shard.scala.html#akka.cluster.sharding.Shard.props" title="(typeName: String, shardId: akka.cluster.sharding.ShardRegion.ShardId, entityProps: akka.actor.Props, settings: akka.cluster.sharding.ClusterShardingSettings, extractEntityId: akka.cluster.sharding.ShardRegion.ExtractEntityId, extractShardId: akka.cluster.sharding.ShardRegion.ExtractShardId, handOffStopMessage: Any)akka.actor.Props">props</a><span class="delimiter">(</span>
            <a href="#akka.cluster.sharding;ShardRegion.typeName" title="String">typeName</a>,
            <a href="#akka.cluster.sharding;ShardRegion.getShard.id" title="akka.cluster.sharding.ShardRegion.ShardId">id</a>,
            <span title="akka.actor.Props">props</span>,
            <a href="#akka.cluster.sharding;ShardRegion.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>,
            <a href="#akka.cluster.sharding;ShardRegion.extractEntityId" title="akka.cluster.sharding.ShardRegion.ExtractEntityId">extractEntityId</a>,
            <a href="#akka.cluster.sharding;ShardRegion.extractShardId" title="akka.cluster.sharding.ShardRegion.ExtractShardId">extractShardId</a>,
            <a href="#akka.cluster.sharding;ShardRegion.handOffStopMessage" title="Any">handOffStopMessage</a><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.withDispatcher" title="(d: String)akka.actor.Props">withDispatcher</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.props" title="=&gt; akka.actor.Props">props</a>.<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.dispatcher" title="=&gt; String">dispatcher</a><span class="delimiter">)</span>,
          <a href="#akka.cluster.sharding;ShardRegion.getShard.name" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardRegion.shardsByRef_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.ShardId])Unit">shardsByRef</a> = <a href="#akka.cluster.sharding;ShardRegion.shardsByRef_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.ShardId]">shardsByRef</a>.<span title="(key: akka.actor.ActorRef, value: akka.cluster.sharding.ShardRegion.ShardId)scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.ShardId]">updated</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.getShard.shard" title="akka.actor.ActorRef">shard</a>, <a href="#akka.cluster.sharding;ShardRegion.getShard.id" title="akka.cluster.sharding.ShardRegion.ShardId">id</a><span class="delimiter">)</span>
        <span title="None.type">None</span>
      case Some<span class="delimiter">(</span><span title="akka.actor.Props">props</span><span class="delimiter">)</span> ⇒
        <span title="None.type">None</span>
      case <span title="None.type">None</span> ⇒
        throw new <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span><span title="String(&quot;Shard must not be allocated to a proxy only ShardRegion&quot;)" class="string">&quot;Shard must not be allocated to a proxy only ShardRegion&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

  def <a title="()Unit" id="akka.cluster.sharding;ShardRegion.sendGracefulShutdownToCoordinator">sendGracefulShutdownToCoordinator</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardRegion.gracefulShutdownInProgress_=" title="=&gt; Boolean">gracefulShutdownInProgress</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardRegion.coordinator_=" title="=&gt; Option[akka.actor.ActorRef]">coordinator</a>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">_</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;GracefulShutdownReq" title="(shardRegion: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.GracefulShutdownReq">GracefulShutdownReq</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
