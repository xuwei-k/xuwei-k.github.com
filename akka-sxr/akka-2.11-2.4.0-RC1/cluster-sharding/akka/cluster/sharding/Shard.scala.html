<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>cluster-sharding/akka/cluster/sharding/Shard.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
package akka.cluster.sharding

import java.net.URLEncoder
import akka.actor.ActorLogging
import akka.actor.ActorRef
import akka.actor.Deploy
import akka.actor.Props
import akka.actor.Terminated
import akka.cluster.sharding.<a href="#akka.cluster.sharding.Shard" title="akka.cluster.sharding.Shard.type">Shard</a>.ShardCommand
import akka.persistence.PersistentActor
import akka.persistence.SnapshotOffer
import akka.actor.Actor
import akka.persistence.RecoveryCompleted

<span class="comment">/**
 * INTERNAL API
 * @see [[ClusterSharding$ ClusterSharding extension]]
 */</span>
private<span class="delimiter">[</span>akka<span class="delimiter">]</span> object <a title="akka.cluster.sharding.Shard.type" id="akka.cluster.sharding.Shard">Shard</a> <a href="#akka.cluster.sharding.Shard" title="akka.cluster.sharding.Shard.type" class="delimiter">{</a>
  import <a href="ShardRegion.scala.html#akka.cluster.sharding.ShardRegion" title="akka.cluster.sharding.ShardRegion.type">ShardRegion</a>.EntityId

  <span class="comment">/**
   * A Shard command
   */</span>
  sealed trait <a title="trait ShardCommand extends AnyRef" id="akka.cluster.sharding.Shard;ShardCommand">ShardCommand</a>

  <span class="comment">/**
   * When an remembering entities and the entity stops without issuing a `Passivate`, we
   * restart it after a back off using this message.
   */</span>
  final case class <a title="class RestartEntity extends AnyRef with akka.cluster.sharding.Shard.ShardCommand with Product with Serializable" id="akka.cluster.sharding.Shard.RestartEntity.readResolve">RestartEntity</a><span title="Product" class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.EntityId" id="akka.cluster.sharding.Shard;RestartEntity.entity">entity</a>: <span title="akka.cluster.sharding.ShardRegion.EntityId">EntityId</span><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.Shard;ShardCommand" title="akka.cluster.sharding.Shard.ShardCommand">ShardCommand</a>

  <span class="comment">/**
   * A case class which represents a state change for the Shard
   */</span>
  sealed trait <a title="trait StateChange extends AnyRef with akka.cluster.sharding.ClusterShardingSerializable" id="akka.cluster.sharding.Shard;StateChange">StateChange</a> extends <a href="ClusterShardingSerializable.scala.html#akka.cluster.sharding;ClusterShardingSerializable" title="akka.cluster.sharding.ClusterShardingSerializable">ClusterShardingSerializable</a> <span class="delimiter">{</span>
    val <a title="=&gt; akka.cluster.sharding.ShardRegion.EntityId" id="akka.cluster.sharding.Shard;StateChange.entityId">entityId</a>: <span title="akka.cluster.sharding.ShardRegion.EntityId">EntityId</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * `State` change for starting an entity in this `Shard`
   */</span>
  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class EntityStarted extends AnyRef with akka.cluster.sharding.Shard.StateChange with Product with Serializable" id="akka.cluster.sharding.Shard.EntityStarted.readResolve">EntityStarted</a><span title="Product" class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.EntityId" id="akka.cluster.sharding.Shard;EntityStarted.entityId">entityId</a>: <span title="akka.cluster.sharding.ShardRegion.EntityId">EntityId</span><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.Shard;StateChange" title="akka.cluster.sharding.Shard.StateChange">StateChange</a>

  <span class="comment">/**
   * `State` change for an entity which has terminated.
   */</span>
  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class EntityStopped extends AnyRef with akka.cluster.sharding.Shard.StateChange with Product with Serializable" id="akka.cluster.sharding.Shard.EntityStopped.readResolve">EntityStopped</a><span title="Product" class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.EntityId" id="akka.cluster.sharding.Shard;EntityStopped.entityId">entityId</a>: <span title="akka.cluster.sharding.ShardRegion.EntityId">EntityId</span><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.Shard;StateChange" title="akka.cluster.sharding.Shard.StateChange">StateChange</a>

  object <a title="akka.cluster.sharding.Shard.State.type" id="akka.cluster.sharding.Shard.State.readResolve">State</a> <a href="#akka.cluster.sharding.Shard.State.readResolve" title="akka.cluster.sharding.Shard.State.type" class="delimiter">{</a>
    val <a title="akka.cluster.sharding.Shard.State" id="akka.cluster.sharding.Shard.State.Empty">Empty</a> = <a href="#akka.cluster.sharding.Shard;State.equals" title="(entities: Set[akka.cluster.sharding.ShardRegion.EntityId])akka.cluster.sharding.Shard.State">State</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Persistent state of the Shard.
   */</span>
  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="(entities: Set[akka.cluster.sharding.ShardRegion.EntityId])akka.cluster.sharding.Shard.State" id="akka.cluster.sharding.Shard;State.equals">State</a> private<span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="delimiter">(</span>
    <a title="Set[akka.cluster.sharding.ShardRegion.EntityId]" id="akka.cluster.sharding.Shard;State.copy$default$1">entities</a>: <span title="Set[akka.cluster.sharding.ShardRegion.EntityId]">Set</span><span class="delimiter">[</span>EntityId<span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.EntityId]">empty</span><span class="delimiter">)</span> extends <a href="ClusterShardingSerializable.scala.html#akka.cluster.sharding;ClusterShardingSerializable" title="akka.cluster.sharding.ClusterShardingSerializable">ClusterShardingSerializable</a>

  <span class="comment">/**
   * Factory method for the [[akka.actor.Props]] of the [[Shard]] actor.
   * If `settings.rememberEntities` is enabled the `PersistentShard`
   * subclass is used, otherwise `Shard`.
   */</span>
  def <a title="(typeName: String, shardId: akka.cluster.sharding.ShardRegion.ShardId, entityProps: akka.actor.Props, settings: akka.cluster.sharding.ClusterShardingSettings, extractEntityId: akka.cluster.sharding.ShardRegion.ExtractEntityId, extractShardId: akka.cluster.sharding.ShardRegion.ExtractShardId, handOffStopMessage: Any)akka.actor.Props" id="akka.cluster.sharding.Shard.props">props</a><span class="delimiter">(</span><a title="String" id="akka.cluster.sharding.Shard.props.typeName">typeName</a>: <span title="String">String</span>,
            <a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.Shard.props.shardId">shardId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>,
            <a title="akka.actor.Props" id="akka.cluster.sharding.Shard.props.entityProps">entityProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a>,
            <a title="akka.cluster.sharding.ClusterShardingSettings" id="akka.cluster.sharding.Shard.props.settings">settings</a>: <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings" title="akka.cluster.sharding.ClusterShardingSettings">ClusterShardingSettings</a>,
            <a title="akka.cluster.sharding.ShardRegion.ExtractEntityId" id="akka.cluster.sharding.Shard.props.extractEntityId">extractEntityId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ExtractEntityId">ExtractEntityId</span>,
            <a title="akka.cluster.sharding.ShardRegion.ExtractShardId" id="akka.cluster.sharding.Shard.props.extractShardId">extractShardId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ExtractShardId">ExtractShardId</span>,
            <a title="Any" id="akka.cluster.sharding.Shard.props.handOffStopMessage">handOffStopMessage</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding.Shard.props.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>.<a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings.rememberEntities" title="=&gt; Boolean">rememberEntities</a><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(b09a6a316b)" title="(creator: =&gt; akka.cluster.sharding.PersistentShard)(implicit evidence$2: scala.reflect.ClassTag[akka.cluster.sharding.PersistentShard])akka.actor.Props">Props</a><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[akka.cluster.sharding.PersistentShard]" class="delimiter">(</span>new <a href="#akka.cluster.sharding;PersistentShard" title="akka.cluster.sharding.PersistentShard">PersistentShard</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.Shard.props.typeName" title="String">typeName</a>, <a href="#akka.cluster.sharding.Shard.props.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a>, <a href="#akka.cluster.sharding.Shard.props.entityProps" title="akka.actor.Props">entityProps</a>, <a href="#akka.cluster.sharding.Shard.props.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>, <a href="#akka.cluster.sharding.Shard.props.extractEntityId" title="akka.cluster.sharding.ShardRegion.ExtractEntityId">extractEntityId</a>, <a href="#akka.cluster.sharding.Shard.props.extractShardId" title="akka.cluster.sharding.ShardRegion.ExtractShardId">extractShardId</a>, <a href="#akka.cluster.sharding.Shard.props.handOffStopMessage" title="Any">handOffStopMessage</a><span class="delimiter">)</span><span class="delimiter">)</span>
        .<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.withDeploy" title="(d: akka.actor.Deploy)akka.actor.Props">withDeploy</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy" title="akka.actor.Deploy.type">Deploy</a>.<a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy.local" title="=&gt; akka.actor.Deploy">local</a><span class="delimiter">)</span>
    else
      <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(b09a6a316b)" title="(creator: =&gt; akka.cluster.sharding.Shard)(implicit evidence$2: scala.reflect.ClassTag[akka.cluster.sharding.Shard])akka.actor.Props">Props</a><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[akka.cluster.sharding.Shard]" class="delimiter">(</span>new <a href="#akka.cluster.sharding;Shard" title="akka.cluster.sharding.Shard">Shard</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.Shard.props.typeName" title="String">typeName</a>, <a href="#akka.cluster.sharding.Shard.props.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a>, <a href="#akka.cluster.sharding.Shard.props.entityProps" title="akka.actor.Props">entityProps</a>, <a href="#akka.cluster.sharding.Shard.props.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>, <a href="#akka.cluster.sharding.Shard.props.extractEntityId" title="akka.cluster.sharding.ShardRegion.ExtractEntityId">extractEntityId</a>, <a href="#akka.cluster.sharding.Shard.props.extractShardId" title="akka.cluster.sharding.ShardRegion.ExtractShardId">extractShardId</a>, <a href="#akka.cluster.sharding.Shard.props.handOffStopMessage" title="Any">handOffStopMessage</a><span class="delimiter">)</span><span class="delimiter">)</span>
        .<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.withDeploy" title="(d: akka.actor.Deploy)akka.actor.Props">withDeploy</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy" title="akka.actor.Deploy.type">Deploy</a>.<a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy.local" title="=&gt; akka.actor.Deploy">local</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API
 *
 * This actor creates children entity actors on demand that it is told to be
 * responsible for.
 *
 * @see [[ClusterSharding$ ClusterSharding extension]]
 */</span>
private<span class="delimiter">[</span>akka<span class="delimiter">]</span> class <a title="class Shard extends AnyRef with akka.actor.Actor with akka.actor.ActorLogging" id="akka.cluster.sharding;Shard">Shard</a><a href="#akka.cluster.sharding;Shard" title="akka.cluster.sharding.Shard" class="delimiter">(</a>
  <a title="String" id="akka.cluster.sharding;Shard.typeName">typeName</a>: <span title="String">String</span>,
  <a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;Shard.shardId">shardId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>,
  <a title="akka.actor.Props" id="akka.cluster.sharding;Shard.entityProps">entityProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a>,
  <a title="akka.cluster.sharding.ClusterShardingSettings" id="akka.cluster.sharding;Shard.settings">settings</a>: <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings" title="akka.cluster.sharding.ClusterShardingSettings">ClusterShardingSettings</a>,
  <a title="akka.cluster.sharding.ShardRegion.ExtractEntityId" id="akka.cluster.sharding;Shard.extractEntityId">extractEntityId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ExtractEntityId">ExtractEntityId</span>,
  <a title="akka.cluster.sharding.ShardRegion.ExtractShardId" id="akka.cluster.sharding;Shard.extractShardId">extractShardId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ExtractShardId">ExtractShardId</span>,
  <a title="Any" id="akka.cluster.sharding;Shard.handOffStopMessage">handOffStopMessage</a>: <span title="Any">Any</span><span class="delimiter">)</span> extends <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> with <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="delimiter">{</span>

  import <a href="ShardRegion.scala.html#akka.cluster.sharding.ShardRegion" title="akka.cluster.sharding.ShardRegion.type">ShardRegion</a>.<span class="delimiter">{</span> handOffStopperProps, EntityId, Msg, Passivate, ShardInitialized <span class="delimiter">}</span>
  import <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator" title="akka.cluster.sharding.ShardCoordinator.type">ShardCoordinator</a>.<a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal" title="akka.cluster.sharding.ShardCoordinator.Internal.type">Internal</a>.<span class="delimiter">{</span> HandOff, ShardStopped <span class="delimiter">}</span>
  import <a href="#akka.cluster.sharding.Shard" title="akka.cluster.sharding.Shard.type">Shard</a>.<span class="delimiter">{</span> State, RestartEntity, EntityStopped, EntityStarted <span class="delimiter">}</span>
  import akka.cluster.sharding.<a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator" title="akka.cluster.sharding.ShardCoordinator.type">ShardCoordinator</a>.<a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal" title="akka.cluster.sharding.ShardCoordinator.Internal.type">Internal</a>.CoordinatorMessage
  import akka.cluster.sharding.<a href="ShardRegion.scala.html#akka.cluster.sharding.ShardRegion" title="akka.cluster.sharding.ShardRegion.type">ShardRegion</a>.ShardRegionCommand
  import <a href="#akka.cluster.sharding;Shard.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>.<a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings.tuningParameters" title="=&gt; akka.cluster.sharding.ClusterShardingSettings.TuningParameters">tuningParameters</a>._

  var <a title="akka.cluster.sharding.Shard.State" id="akka.cluster.sharding;Shard.state_=">state</a> = <a href="#akka.cluster.sharding.Shard.State.readResolve" title="akka.cluster.sharding.Shard.State.type">State</a>.<a href="#akka.cluster.sharding.Shard.State.Empty" title="=&gt; akka.cluster.sharding.Shard.State">Empty</a>
  var <a title="scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.EntityId]" id="akka.cluster.sharding;Shard.idByRef_=">idByRef</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.EntityId]" class="delimiter">[</span><a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <span title="akka.cluster.sharding.ShardRegion.EntityId">EntityId</span><span class="delimiter">]</span>
  var <a title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,akka.actor.ActorRef]" id="akka.cluster.sharding;Shard.refById_=">refById</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,akka.actor.ActorRef]" class="delimiter">[</span><span title="akka.cluster.sharding.ShardRegion.EntityId">EntityId</span>, <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">]</span>
  var <a title="scala.collection.immutable.Set[akka.actor.ActorRef]" id="akka.cluster.sharding;Shard.passivating_=">passivating</a> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.immutable.Set[A]">empty</span><span title="scala.collection.immutable.Set[akka.actor.ActorRef]" class="delimiter">[</span><a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">]</span>
  var <a title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]" id="akka.cluster.sharding;Shard.messageBuffers_=">messageBuffers</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]" class="delimiter">[</span><span title="akka.cluster.sharding.ShardRegion.EntityId">EntityId</span>, <span title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">Vector</span><span class="delimiter">[</span><span class="delimiter">(</span>Msg, ActorRef<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">]</span>

  var <a title="Option[akka.actor.ActorRef]" id="akka.cluster.sharding;Shard.handOffStopper_=">handOffStopper</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <span title="None.type">None</span>

  <a href="#akka.cluster.sharding;Shard.initialized" title="()Unit">initialized</a><span class="delimiter">(</span><span class="delimiter">)</span>

  def <a title="()Unit" id="akka.cluster.sharding;Shard.initialized">initialized</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">parent</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="ShardRegion.scala.html#akka.cluster.sharding.ShardRegion;ShardInitialized" title="(shardId: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardRegion.ShardInitialized">ShardInitialized</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a><span class="delimiter">)</span>

  def <a title="=&gt; Int" id="akka.cluster.sharding;Shard.totalBufferSize">totalBufferSize</a> = <a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">messageBuffers</a>.<span title="(z: Int)(op: (Int, (akka.cluster.sharding.ShardRegion.EntityId, Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])) =&gt; Int)Int">foldLeft</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="Int" id="akka.cluster.sharding;Shard.totalBufferSize.$anonfun.sum">sum</a>, <a title="(akka.cluster.sharding.ShardRegion.EntityId, Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])" id="akka.cluster.sharding;Shard.totalBufferSize.$anonfun.entity">entity</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;Shard.totalBufferSize.$anonfun.sum" title="Int">sum</a> <span title="(x: Int)Int">+</span> <a href="#akka.cluster.sharding;Shard.totalBufferSize.$anonfun.entity" title="(akka.cluster.sharding.ShardRegion.EntityId, Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])">entity</a>.<span title="=&gt; Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">_2</span>.<span title="=&gt; Int">size</span> <span class="delimiter">}</span>

  def <a title="[A](event: A)(handler: A =&gt; Unit)Unit" id="akka.cluster.sharding;Shard.processChange">processChange</a><span class="delimiter">[</span><a title="" id="akka.cluster.sharding;Shard.processChange;A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A" id="akka.cluster.sharding;Shard.processChange.event">event</a>: <a href="#akka.cluster.sharding;Shard.processChange;A" title="A">A</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="A =&gt; Unit" id="akka.cluster.sharding;Shard.processChange.handler">handler</a>: A ⇒ Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.cluster.sharding;Shard.processChange.handler" title="(v1: A)Unit">handler</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.processChange.event" title="A">event</a><span class="delimiter">)</span>

  def <a title="=&gt; Shard.this.Receive" id="akka.cluster.sharding;Shard.receive">receive</a> = <a href="#akka.cluster.sharding;Shard.receiveCommand" title="=&gt; Shard.this.Receive">receiveCommand</a>

  def <a title="=&gt; Shard.this.Receive" id="akka.cluster.sharding;Shard.receiveCommand">receiveCommand</a>: <span title="Shard.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.sharding;Shard.receiveCommand;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case Terminated<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;Shard.receiveCommand;$anonfun.isDefinedAt.ref">ref</a><span class="delimiter">)</span>                         ⇒ <a href="#akka.cluster.sharding;Shard.receiveTerminated" title="(ref: akka.actor.ActorRef)Unit">receiveTerminated</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.receiveCommand;$anonfun.isDefinedAt.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
    case <span title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">msg</span>: <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorMessage" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a>                 ⇒ <a href="#akka.cluster.sharding;Shard.receiveCoordinatorMessage" title="(msg: akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage)Unit">receiveCoordinatorMessage</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">msg</span><span class="delimiter">)</span>
    case <span title="akka.cluster.sharding.Shard.ShardCommand">msg</span>: <a href="#akka.cluster.sharding.Shard;ShardCommand" title="akka.cluster.sharding.Shard.ShardCommand">ShardCommand</a>                       ⇒ <a href="#akka.cluster.sharding;Shard.receiveShardCommand" title="(msg: akka.cluster.sharding.Shard.ShardCommand)Unit">receiveShardCommand</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.cluster.sharding.Shard.ShardCommand">msg</span><span class="delimiter">)</span>
    case <span title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">msg</span>: <a href="ShardRegion.scala.html#akka.cluster.sharding.ShardRegion;ShardRegionCommand" title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">ShardRegionCommand</a>                 ⇒ <a href="#akka.cluster.sharding;Shard.receiveShardRegionCommand" title="(msg: akka.cluster.sharding.ShardRegion.ShardRegionCommand)Unit">receiveShardRegionCommand</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">msg</span><span class="delimiter">)</span>
    case <span title="Any">msg</span> if <a href="#akka.cluster.sharding;Shard.extractEntityId" title="akka.cluster.sharding.ShardRegion.ExtractEntityId">extractEntityId</a>.<span title="(x: akka.cluster.sharding.ShardRegion.Msg)Boolean">isDefinedAt</span><span class="delimiter">(</span><span title="Any">msg</span><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;Shard.deliverMessage" title="(msg: Any, snd: akka.actor.ActorRef)Unit">deliverMessage</a><span title="Boolean(true)" class="delimiter">(</span><span title="Any">msg</span>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(msg: akka.cluster.sharding.Shard.ShardCommand)Unit" id="akka.cluster.sharding;Shard.receiveShardCommand">receiveShardCommand</a><span class="delimiter">(</span><a title="akka.cluster.sharding.Shard.ShardCommand" id="akka.cluster.sharding;Shard.receiveShardCommand.msg">msg</a>: <a href="#akka.cluster.sharding.Shard;ShardCommand" title="akka.cluster.sharding.Shard.ShardCommand">ShardCommand</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.cluster.sharding;Shard.receiveShardCommand.msg" title="akka.cluster.sharding.Shard.ShardCommand">msg</a> match <span class="delimiter">{</span>
    case RestartEntity<span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.EntityId" id="akka.cluster.sharding;Shard.receiveShardCommand.id">id</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;Shard.getEntity" title="(id: akka.cluster.sharding.ShardRegion.EntityId)akka.actor.ActorRef">getEntity</a><span title="Unit" class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.receiveShardCommand.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(msg: akka.cluster.sharding.ShardRegion.ShardRegionCommand)Unit" id="akka.cluster.sharding;Shard.receiveShardRegionCommand">receiveShardRegionCommand</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardRegionCommand" id="akka.cluster.sharding;Shard.receiveShardRegionCommand.msg">msg</a>: <a href="ShardRegion.scala.html#akka.cluster.sharding.ShardRegion;ShardRegionCommand" title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">ShardRegionCommand</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.cluster.sharding;Shard.receiveShardRegionCommand.msg" title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">msg</a> match <span class="delimiter">{</span>
    case Passivate<span class="delimiter">(</span><a title="Any" id="akka.cluster.sharding;Shard.receiveShardRegionCommand.stopMessage">stopMessage</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;Shard.passivate" title="(entity: akka.actor.ActorRef, stopMessage: Any)Unit">passivate</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#akka.cluster.sharding;Shard.receiveShardRegionCommand.stopMessage" title="Any">stopMessage</a><span class="delimiter">)</span>
    case _                      ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.unhandled" title="(message: Any)Unit">unhandled</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.receiveShardRegionCommand.msg" title="akka.cluster.sharding.ShardRegion.ShardRegionCommand">msg</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(msg: akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage)Unit" id="akka.cluster.sharding;Shard.receiveCoordinatorMessage">receiveCoordinatorMessage</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage" id="akka.cluster.sharding;Shard.receiveCoordinatorMessage.msg">msg</a>: <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorMessage" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.cluster.sharding;Shard.receiveCoordinatorMessage.msg" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">msg</a> match <span class="delimiter">{</span>
    case HandOff<span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">`shardId`</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;Shard.handOff" title="(replyTo: akka.actor.ActorRef)Unit">handOff</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    case HandOff<span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;Shard.receiveCoordinatorMessage.shard">shard</a><span class="delimiter">)</span>     ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.warning(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;Shard [{}] can not hand off for another Shard [{}]&quot;)" class="string">&quot;Shard [{}] can not hand off for another Shard [{}]&quot;</span>, <a href="#akka.cluster.sharding;Shard.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a>, <a href="#akka.cluster.sharding;Shard.receiveCoordinatorMessage.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
    case _                  ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.unhandled" title="(message: Any)Unit">unhandled</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.receiveCoordinatorMessage.msg" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">msg</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(replyTo: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;Shard.handOff">handOff</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;Shard.handOff.replyTo">replyTo</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.cluster.sharding;Shard.handOffStopper_=" title="=&gt; Option[akka.actor.ActorRef]">handOffStopper</a> match <span class="delimiter">{</span>
    case Some<span class="delimiter">(</span>_<span class="delimiter">)</span> ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.warning(dc73c33c91)" title="(template: String, arg1: Any)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;HandOff shard [{}] received during existing handOff&quot;)" class="string">&quot;HandOff shard [{}] received during existing handOff&quot;</span>, <a href="#akka.cluster.sharding;Shard.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a><span class="delimiter">)</span>
    case <span title="None.type">None</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;HandOff shard [{}]&quot;)" class="string">&quot;HandOff shard [{}]&quot;</span>, <a href="#akka.cluster.sharding;Shard.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a><span class="delimiter">)</span>

      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.state_=" title="=&gt; akka.cluster.sharding.Shard.State">state</a>.<a href="#akka.cluster.sharding.Shard;State.copy$default$1" title="=&gt; Set[akka.cluster.sharding.ShardRegion.EntityId]">entities</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.cluster.sharding;Shard.handOffStopper_=" title="(x$1: Option[akka.actor.ActorRef])Unit">handOffStopper</a> = <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(59f1e43182)" title="(props: akka.actor.Props)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span>
          <a href="ShardRegion.scala.html#akka.cluster.sharding.ShardRegion.handOffStopperProps" title="(shard: String, replyTo: akka.actor.ActorRef, entities: Set[akka.actor.ActorRef], stopMessage: Any)akka.actor.Props">handOffStopperProps</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a>, <a href="#akka.cluster.sharding;Shard.handOff.replyTo" title="akka.actor.ActorRef">replyTo</a>, <a href="#akka.cluster.sharding;Shard.idByRef_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.EntityId]">idByRef</a>.<span title="=&gt; scala.collection.immutable.Set[akka.actor.ActorRef]">keySet</span>, <a href="#akka.cluster.sharding;Shard.handOffStopMessage" title="Any">handOffStopMessage</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="comment">//During hand off we only care about watching for termination of the hand off stopper</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a> <a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.become(07b70b901c)" title="(behavior: akka.actor.Actor.Receive)Unit">become</a> <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.sharding;Shard.handOff;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
          case Terminated<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;Shard.handOff;$anonfun.isDefinedAt.ref">ref</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;Shard.receiveTerminated" title="(ref: akka.actor.ActorRef)Unit">receiveTerminated</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.handOff;$anonfun.isDefinedAt.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> else <span class="delimiter">{</span>
        <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">replyTo</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="ShardCoordinator.scala.html#akka.cluster.sharding.ShardCoordinator.Internal;ShardStopped" title="(shard: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardCoordinator.Internal.ShardStopped">ShardStopped</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a> <a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(ref: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;Shard.receiveTerminated">receiveTerminated</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;Shard.receiveTerminated.ref">ref</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.handOffStopper_=" title="=&gt; Option[akka.actor.ActorRef]">handOffStopper</a>.<span title="(p: akka.actor.ActorRef =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.receiveTerminated.$anonfun.x$1" title="akka.actor.ActorRef">_</a> <span title="(x$1: Any)Boolean">==</span> <a href="#akka.cluster.sharding;Shard.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a> <a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>
    else if <span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.idByRef_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.EntityId]">idByRef</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.cluster.sharding;Shard.handOffStopper_=" title="=&gt; Option[akka.actor.ActorRef]">handOffStopper</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;Shard.entityTerminated" title="(ref: akka.actor.ActorRef)Unit">entityTerminated</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.receiveTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(ref: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;Shard.entityTerminated">entityTerminated</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;Shard.entityTerminated.ref">ref</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val <a title="akka.cluster.sharding.ShardRegion.EntityId" id="akka.cluster.sharding;Shard.entityTerminated.id">id</a> = <a href="#akka.cluster.sharding;Shard.idByRef_=" title="(key: akka.actor.ActorRef)akka.cluster.sharding.ShardRegion.EntityId">idByRef</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.entityTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">messageBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.EntityId, default: =&gt; Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">getOrElse</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.entityTerminated.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a>, <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span><span class="delimiter">)</span>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Starting entity [{}] again, there are buffered messages for it&quot;)" class="string">&quot;Starting entity [{}] again, there are buffered messages for it&quot;</span>, <a href="#akka.cluster.sharding;Shard.entityTerminated.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;Shard.sendMsgBuffer" title="(event: akka.cluster.sharding.Shard.EntityStarted)Unit">sendMsgBuffer</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.Shard.EntityStarted.readResolve" title="(entityId: akka.cluster.sharding.ShardRegion.EntityId)akka.cluster.sharding.Shard.EntityStarted">EntityStarted</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.entityTerminated.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> else <span class="delimiter">{</span>
      <a href="#akka.cluster.sharding;Shard.processChange" title="(event: akka.cluster.sharding.Shard.EntityStopped)(handler: akka.cluster.sharding.Shard.EntityStopped =&gt; Unit)Unit">processChange</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.Shard.EntityStopped.readResolve" title="(entityId: akka.cluster.sharding.ShardRegion.EntityId)akka.cluster.sharding.Shard.EntityStopped">EntityStopped</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.entityTerminated.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.passivateCompleted" title="(event: akka.cluster.sharding.Shard.EntityStopped)Unit">passivateCompleted</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#akka.cluster.sharding;Shard.passivating_=" title="(x$1: scala.collection.immutable.Set[akka.actor.ActorRef])Unit">passivating</a> = <a href="#akka.cluster.sharding;Shard.passivating_=" title="=&gt; scala.collection.immutable.Set[akka.actor.ActorRef]">passivating</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-</span> <a href="#akka.cluster.sharding;Shard.entityTerminated.ref" title="akka.actor.ActorRef">ref</a>
  <span class="delimiter">}</span>

  def <a title="(entity: akka.actor.ActorRef, stopMessage: Any)Unit" id="akka.cluster.sharding;Shard.passivate">passivate</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;Shard.passivate.entity">entity</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Any" id="akka.cluster.sharding;Shard.passivate.stopMessage">stopMessage</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.sharding;Shard.idByRef_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.EntityId]">idByRef</a>.<span title="(key: akka.actor.ActorRef)Option[akka.cluster.sharding.ShardRegion.EntityId]">get</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.passivate.entity" title="akka.actor.ActorRef">entity</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.EntityId" id="akka.cluster.sharding;Shard.passivate.id">id</a><span class="delimiter">)</span> if <span title="=&gt; Boolean">!</span><a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">messageBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.EntityId)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.passivate.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span> ⇒
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Passivating started on entity {}&quot;)" class="string">&quot;Passivating started on entity {}&quot;</span>, <a href="#akka.cluster.sharding;Shard.passivate.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span>

        <a href="#akka.cluster.sharding;Shard.passivating_=" title="(x$1: scala.collection.immutable.Set[akka.actor.ActorRef])Unit">passivating</a> = <a href="#akka.cluster.sharding;Shard.passivating_=" title="=&gt; scala.collection.immutable.Set[akka.actor.ActorRef]">passivating</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">+</span> <a href="#akka.cluster.sharding;Shard.passivate.entity" title="akka.actor.ActorRef">entity</a>
        <a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">messageBuffers</a> = <a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">messageBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.EntityId, value: Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">updated</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.passivate.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a>, <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">entity</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding;Shard.passivate.stopMessage" title="Any">stopMessage</a>

      case _ ⇒ <span class="comment">//ignored</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">// EntityStopped handler</span>
  def <a title="(event: akka.cluster.sharding.Shard.EntityStopped)Unit" id="akka.cluster.sharding;Shard.passivateCompleted">passivateCompleted</a><span class="delimiter">(</span><a title="akka.cluster.sharding.Shard.EntityStopped" id="akka.cluster.sharding;Shard.passivateCompleted.event">event</a>: <a href="#akka.cluster.sharding.Shard.EntityStopped.readResolve" title="akka.cluster.sharding.Shard.EntityStopped">EntityStopped</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Entity stopped [{}]&quot;)" class="string">&quot;Entity stopped [{}]&quot;</span>, <a href="#akka.cluster.sharding;Shard.passivateCompleted.event" title="akka.cluster.sharding.Shard.EntityStopped">event</a>.<a href="#akka.cluster.sharding.Shard;EntityStopped.entityId" title="=&gt; akka.cluster.sharding.ShardRegion.EntityId">entityId</a><span class="delimiter">)</span>

    val <a title="akka.actor.ActorRef" id="akka.cluster.sharding;Shard.passivateCompleted.ref">ref</a> = <a href="#akka.cluster.sharding;Shard.refById_=" title="(key: akka.cluster.sharding.ShardRegion.EntityId)akka.actor.ActorRef">refById</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.passivateCompleted.event" title="akka.cluster.sharding.Shard.EntityStopped">event</a>.<a href="#akka.cluster.sharding.Shard;EntityStopped.entityId" title="=&gt; akka.cluster.sharding.ShardRegion.EntityId">entityId</a><span class="delimiter">)</span>
    <a href="#akka.cluster.sharding;Shard.idByRef_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.EntityId])Unit">idByRef</a> <span title="(key: akka.actor.ActorRef)scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.EntityId]">-=</span> <a href="#akka.cluster.sharding;Shard.passivateCompleted.ref" title="akka.actor.ActorRef">ref</a>
    <a href="#akka.cluster.sharding;Shard.refById_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,akka.actor.ActorRef])Unit">refById</a> <span title="(key: akka.cluster.sharding.ShardRegion.EntityId)scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,akka.actor.ActorRef]">-=</span> <a href="#akka.cluster.sharding;Shard.passivateCompleted.event" title="akka.cluster.sharding.Shard.EntityStopped">event</a>.<a href="#akka.cluster.sharding.Shard;EntityStopped.entityId" title="=&gt; akka.cluster.sharding.ShardRegion.EntityId">entityId</a>

    <a href="#akka.cluster.sharding;Shard.state_=" title="(x$1: akka.cluster.sharding.Shard.State)Unit">state</a> = <a href="#akka.cluster.sharding;Shard.state_=" title="=&gt; akka.cluster.sharding.Shard.State">state</a>.<a href="#akka.cluster.sharding.Shard;State.equals" title="(entities: Set[akka.cluster.sharding.ShardRegion.EntityId])akka.cluster.sharding.Shard.State">copy</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.state_=" title="=&gt; akka.cluster.sharding.Shard.State">state</a>.<a href="#akka.cluster.sharding.Shard;State.copy$default$1" title="=&gt; Set[akka.cluster.sharding.ShardRegion.EntityId]">entities</a> <span title="(elem: akka.cluster.sharding.ShardRegion.EntityId)scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.EntityId]">-</span> <a href="#akka.cluster.sharding;Shard.passivateCompleted.event" title="akka.cluster.sharding.Shard.EntityStopped">event</a>.<a href="#akka.cluster.sharding.Shard;EntityStopped.entityId" title="=&gt; akka.cluster.sharding.ShardRegion.EntityId">entityId</a><span class="delimiter">)</span>
    <a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">messageBuffers</a> = <a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">messageBuffers</a> <span title="(key: akka.cluster.sharding.ShardRegion.EntityId)scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">-</span> <a href="#akka.cluster.sharding;Shard.passivateCompleted.event" title="akka.cluster.sharding.Shard.EntityStopped">event</a>.<a href="#akka.cluster.sharding.Shard;EntityStopped.entityId" title="=&gt; akka.cluster.sharding.ShardRegion.EntityId">entityId</a>
  <span class="delimiter">}</span>

  <span class="comment">// EntityStarted handler</span>
  def <a title="(event: akka.cluster.sharding.Shard.EntityStarted)Unit" id="akka.cluster.sharding;Shard.sendMsgBuffer">sendMsgBuffer</a><span class="delimiter">(</span><a title="akka.cluster.sharding.Shard.EntityStarted" id="akka.cluster.sharding;Shard.sendMsgBuffer.event">event</a>: <a href="#akka.cluster.sharding.Shard.EntityStarted.readResolve" title="akka.cluster.sharding.Shard.EntityStarted">EntityStarted</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="comment">//Get the buffered messages and remove the buffer</span>
    val <a title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]" id="akka.cluster.sharding;Shard.sendMsgBuffer.messages">messages</a> = <a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">messageBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.EntityId, default: =&gt; Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">getOrElse</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.sendMsgBuffer.event" title="akka.cluster.sharding.Shard.EntityStarted">event</a>.<a href="#akka.cluster.sharding.Shard;EntityStarted.entityId" title="=&gt; akka.cluster.sharding.ShardRegion.EntityId">entityId</a>, <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span><span class="delimiter">)</span>
    <a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">messageBuffers</a> = <a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">messageBuffers</a> <span title="(key: akka.cluster.sharding.ShardRegion.EntityId)scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">-</span> <a href="#akka.cluster.sharding;Shard.sendMsgBuffer.event" title="akka.cluster.sharding.Shard.EntityStarted">event</a>.<a href="#akka.cluster.sharding.Shard;EntityStarted.entityId" title="=&gt; akka.cluster.sharding.ShardRegion.EntityId">entityId</a>

    if <span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.sendMsgBuffer.messages" title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">messages</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Sending message buffer for entity [{}] ([{}] messages)&quot;)" class="string">&quot;Sending message buffer for entity [{}] ([{}] messages)&quot;</span>, <a href="#akka.cluster.sharding;Shard.sendMsgBuffer.event" title="akka.cluster.sharding.Shard.EntityStarted">event</a>.<a href="#akka.cluster.sharding.Shard;EntityStarted.entityId" title="=&gt; akka.cluster.sharding.ShardRegion.EntityId">entityId</a>, <a href="#akka.cluster.sharding;Shard.sendMsgBuffer.messages" title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">messages</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;Shard.getEntity" title="(id: akka.cluster.sharding.ShardRegion.EntityId)akka.actor.ActorRef">getEntity</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.sendMsgBuffer.event" title="akka.cluster.sharding.Shard.EntityStarted">event</a>.<a href="#akka.cluster.sharding.Shard;EntityStarted.entityId" title="=&gt; akka.cluster.sharding.ShardRegion.EntityId">entityId</a><span class="delimiter">)</span>

      <span class="comment">//Now there is no deliveryBuffer we can try to redeliver</span>
      <span class="comment">// and as the child exists, the message will be directly forwarded</span>
      <a href="#akka.cluster.sharding;Shard.sendMsgBuffer.messages" title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">messages</a> <span title="(f: ((akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)) =&gt; Unit)Unit">foreach</span> <a href="#akka.cluster.sharding;Shard.sendMsgBuffer.$anonfun.x0$1" title="Unit" class="delimiter">{</a>
        case <span class="delimiter">(</span><a title="Any" id="akka.cluster.sharding;Shard.sendMsgBuffer.$anonfun.msg">msg</a>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;Shard.sendMsgBuffer.$anonfun.snd">snd</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;Shard.deliverMessage" title="(msg: Any, snd: akka.actor.ActorRef)Unit">deliverMessage</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.sendMsgBuffer.$anonfun.msg" title="Any">msg</a>, <a href="#akka.cluster.sharding;Shard.sendMsgBuffer.$anonfun.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(msg: Any, snd: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;Shard.deliverMessage">deliverMessage</a><span class="delimiter">(</span><a title="Any" id="akka.cluster.sharding;Shard.deliverMessage.msg">msg</a>: <span title="Any">Any</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;Shard.deliverMessage.snd">snd</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val <a href="#akka.cluster.sharding;Shard.deliverMessage.id" title="(akka.cluster.sharding.ShardRegion.EntityId, Any)" class="delimiter">(</a><a href="#akka.cluster.sharding;Shard.deliverMessage.x$2" title="akka.cluster.sharding.ShardRegion.EntityId" id="akka.cluster.sharding;Shard.deliverMessage.id">id</a>, <a href="#akka.cluster.sharding;Shard.deliverMessage.x$2" title="Any" id="akka.cluster.sharding;Shard.deliverMessage.payload">payload</a><span class="delimiter">)</span> = <a href="#akka.cluster.sharding;Shard.extractEntityId" title="(v1: akka.cluster.sharding.ShardRegion.Msg)(akka.cluster.sharding.ShardRegion.EntityId, akka.cluster.sharding.ShardRegion.Msg)">extractEntityId</a><span title="(akka.cluster.sharding.ShardRegion.EntityId, akka.cluster.sharding.ShardRegion.Msg) @unchecked" class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.deliverMessage.msg" title="Any">msg</a><span class="delimiter">)</span>
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.deliverMessage.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a> <span title="(x$1: Any)Boolean">==</span> null <span title="(x: Boolean)Boolean">||</span> <a href="#akka.cluster.sharding;Shard.deliverMessage.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a> <span title="(x$1: Any)Boolean">==</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.warning(dc73c33c91)" title="(template: String, arg1: Any)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;Id must not be empty, dropping message [{}]&quot;)" class="string">&quot;Id must not be empty, dropping message [{}]&quot;</span>, <a href="#akka.cluster.sharding;Shard.deliverMessage.msg" title="Any">msg</a>.<span title="()Class[_]">getClass</span>.<span title="()String">getName</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">deadLetters</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding;Shard.deliverMessage.msg" title="Any">msg</a>
    <span class="delimiter">}</span> else <span class="delimiter">{</span>
      <a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">messageBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.EntityId)Option[Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">get</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.deliverMessage.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
        case <span title="None.type">None</span> ⇒ <a href="#akka.cluster.sharding;Shard.deliverTo" title="(id: akka.cluster.sharding.ShardRegion.EntityId, msg: Any, payload: akka.cluster.sharding.ShardRegion.Msg, snd: akka.actor.ActorRef)Unit">deliverTo</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.deliverMessage.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a>, <a href="#akka.cluster.sharding;Shard.deliverMessage.msg" title="Any">msg</a>, <a href="#akka.cluster.sharding;Shard.deliverMessage.payload" title="Any">payload</a>, <a href="#akka.cluster.sharding;Shard.deliverMessage.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span>

        case Some<span class="delimiter">(</span><span title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span><span class="delimiter">)</span> if <a href="#akka.cluster.sharding;Shard.totalBufferSize" title="=&gt; Int">totalBufferSize</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.bufferSize" title="=&gt; Int">bufferSize</a> ⇒
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Buffer is full, dropping message for entity [{}]&quot;)" class="string">&quot;Buffer is full, dropping message for entity [{}]&quot;</span>, <a href="#akka.cluster.sharding;Shard.deliverMessage.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">deadLetters</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding;Shard.deliverMessage.msg" title="Any">msg</a>

        case Some<span class="delimiter">(</span><span title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span><span class="delimiter">)</span> ⇒
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Message for entity [{}] buffered&quot;)" class="string">&quot;Message for entity [{}] buffered&quot;</span>, <a href="#akka.cluster.sharding;Shard.deliverMessage.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span>
          <a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">messageBuffers</a> = <a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">messageBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.EntityId, value: Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">updated</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.deliverMessage.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a>, <span title="Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">buf</span> <span title="(elem: (akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)],(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef),Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]])Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">:+</span> <span class="delimiter">(</span><span title="(_1: Any, _2: akka.actor.ActorRef)(Any, akka.actor.ActorRef)" class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.deliverMessage.msg" title="Any">msg</a>, <a href="#akka.cluster.sharding;Shard.deliverMessage.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(id: akka.cluster.sharding.ShardRegion.EntityId, msg: Any, payload: akka.cluster.sharding.ShardRegion.Msg, snd: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;Shard.deliverTo">deliverTo</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.EntityId" id="akka.cluster.sharding;Shard.deliverTo.id">id</a>: <span title="akka.cluster.sharding.ShardRegion.EntityId">EntityId</span>, <a title="Any" id="akka.cluster.sharding;Shard.deliverTo.msg">msg</a>: <span title="Any">Any</span>, <a title="akka.cluster.sharding.ShardRegion.Msg" id="akka.cluster.sharding;Shard.deliverTo.payload">payload</a>: <span title="akka.cluster.sharding.ShardRegion.Msg">Msg</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;Shard.deliverTo.snd">snd</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val <a title="String" id="akka.cluster.sharding;Shard.deliverTo.name">name</a> = <span title="java.net.URLEncoder.type">URLEncoder</span>.<span title="(x$1: String, x$2: String)String">encode</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.deliverTo.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a>, <span title="String(&quot;utf-8&quot;)" class="string">&quot;utf-8&quot;</span><span class="delimiter">)</span>
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.child" title="(name: String)Option[akka.actor.ActorRef]">child</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.deliverTo.name" title="String">name</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;Shard.deliverTo.actor">actor</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;Shard.deliverTo.actor" title="akka.actor.ActorRef">actor</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.tell" title="(msg: Any, sender: akka.actor.ActorRef)Unit">tell</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.deliverTo.payload" title="akka.cluster.sharding.ShardRegion.Msg">payload</a>, <a href="#akka.cluster.sharding;Shard.deliverTo.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span>
      case <span title="None.type">None</span>        ⇒ <a href="#akka.cluster.sharding;Shard.getEntity" title="(id: akka.cluster.sharding.ShardRegion.EntityId)akka.actor.ActorRef">getEntity</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.deliverTo.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.tell" title="(msg: Any, sender: akka.actor.ActorRef)Unit">tell</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.deliverTo.payload" title="akka.cluster.sharding.ShardRegion.Msg">payload</a>, <a href="#akka.cluster.sharding;Shard.deliverTo.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(id: akka.cluster.sharding.ShardRegion.EntityId)akka.actor.ActorRef" id="akka.cluster.sharding;Shard.getEntity">getEntity</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.EntityId" id="akka.cluster.sharding;Shard.getEntity.id">id</a>: <span title="akka.cluster.sharding.ShardRegion.EntityId">EntityId</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <span class="delimiter">{</span>
    val <a title="String" id="akka.cluster.sharding;Shard.getEntity.name">name</a> = <span title="java.net.URLEncoder.type">URLEncoder</span>.<span title="(x$1: String, x$2: String)String">encode</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.getEntity.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a>, <span title="String(&quot;utf-8&quot;)" class="string">&quot;utf-8&quot;</span><span class="delimiter">)</span>
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.child" title="(name: String)Option[akka.actor.ActorRef]">child</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.getEntity.name" title="String">name</a><span class="delimiter">)</span>.<span title="(default: =&gt; akka.actor.ActorRef)akka.actor.ActorRef">getOrElse</span> <span class="delimiter">{</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Starting entity [{}] in shard [{}]&quot;)" class="string">&quot;Starting entity [{}] in shard [{}]&quot;</span>, <a href="#akka.cluster.sharding;Shard.getEntity.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a>, <a href="#akka.cluster.sharding;Shard.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a><span class="delimiter">)</span>

      val <a title="akka.actor.ActorRef" id="akka.cluster.sharding;Shard.getEntity.a">a</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(874c98419a)" title="(props: akka.actor.Props, name: String)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.entityProps" title="akka.actor.Props">entityProps</a>, <a href="#akka.cluster.sharding;Shard.getEntity.name" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;Shard.idByRef_=" title="(x$1: scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.EntityId])Unit">idByRef</a> = <a href="#akka.cluster.sharding;Shard.idByRef_=" title="=&gt; scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.EntityId]">idByRef</a>.<span title="(key: akka.actor.ActorRef, value: akka.cluster.sharding.ShardRegion.EntityId)scala.collection.immutable.Map[akka.actor.ActorRef,akka.cluster.sharding.ShardRegion.EntityId]">updated</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.getEntity.a" title="akka.actor.ActorRef">a</a>, <a href="#akka.cluster.sharding;Shard.getEntity.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;Shard.refById_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,akka.actor.ActorRef])Unit">refById</a> = <a href="#akka.cluster.sharding;Shard.refById_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,akka.actor.ActorRef]">refById</a>.<span title="(key: akka.cluster.sharding.ShardRegion.EntityId, value: akka.actor.ActorRef)scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,akka.actor.ActorRef]">updated</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.getEntity.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a>, <a href="#akka.cluster.sharding;Shard.getEntity.a" title="akka.actor.ActorRef">a</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;Shard.state_=" title="(x$1: akka.cluster.sharding.Shard.State)Unit">state</a> = <a href="#akka.cluster.sharding;Shard.state_=" title="=&gt; akka.cluster.sharding.Shard.State">state</a>.<a href="#akka.cluster.sharding.Shard;State.equals" title="(entities: Set[akka.cluster.sharding.ShardRegion.EntityId])akka.cluster.sharding.Shard.State">copy</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.state_=" title="=&gt; akka.cluster.sharding.Shard.State">state</a>.<a href="#akka.cluster.sharding.Shard;State.copy$default$1" title="=&gt; Set[akka.cluster.sharding.ShardRegion.EntityId]">entities</a> <span title="(elem: akka.cluster.sharding.ShardRegion.EntityId)scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.EntityId]">+</span> <a href="#akka.cluster.sharding;Shard.getEntity.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;Shard.getEntity.a" title="akka.actor.ActorRef">a</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API
 *
 * This actor creates children entity actors on demand that it is told to be
 * responsible for. It is used when `rememberEntities` is enabled.
 *
 * @see [[ClusterSharding$ ClusterSharding extension]]
 */</span>
private<span class="delimiter">[</span>akka<span class="delimiter">]</span> class <a title="class PersistentShard extends akka.cluster.sharding.Shard with akka.persistence.PersistentActor with akka.actor.ActorLogging" id="akka.cluster.sharding;PersistentShard">PersistentShard</a><a href="#akka.cluster.sharding;PersistentShard" title="akka.cluster.sharding.PersistentShard" class="delimiter">(</a>
  <a title="String" id="akka.cluster.sharding;PersistentShard.typeName">typeName</a>: <span title="String">String</span>,
  <a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;PersistentShard.shardId">shardId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>,
  <a title="akka.actor.Props" id="akka.cluster.sharding;PersistentShard.entityProps">entityProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a>,
  <a title="akka.cluster.sharding.ClusterShardingSettings" id="akka.cluster.sharding;PersistentShard.settings">settings</a>: <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings" title="akka.cluster.sharding.ClusterShardingSettings">ClusterShardingSettings</a>,
  <a title="akka.cluster.sharding.ShardRegion.ExtractEntityId" id="akka.cluster.sharding;PersistentShard.extractEntityId">extractEntityId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ExtractEntityId">ExtractEntityId</span>,
  <a title="akka.cluster.sharding.ShardRegion.ExtractShardId" id="akka.cluster.sharding;PersistentShard.extractShardId">extractShardId</a>: ShardRegion.<span title="akka.cluster.sharding.ShardRegion.ExtractShardId">ExtractShardId</span>,
  <a title="Any" id="akka.cluster.sharding;PersistentShard.handOffStopMessage">handOffStopMessage</a>: <span title="Any">Any</span><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding;Shard" title="akka.cluster.sharding.Shard">Shard</a><span class="delimiter">(</span>
  <a href="#akka.cluster.sharding;PersistentShard.typeName" title="String">typeName</a>, <a href="#akka.cluster.sharding;PersistentShard.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a>, <a href="#akka.cluster.sharding;PersistentShard.entityProps" title="akka.actor.Props">entityProps</a>, <a href="#akka.cluster.sharding;PersistentShard.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>, <a href="#akka.cluster.sharding;PersistentShard.extractEntityId" title="akka.cluster.sharding.ShardRegion.ExtractEntityId">extractEntityId</a>, <a href="#akka.cluster.sharding;PersistentShard.extractShardId" title="akka.cluster.sharding.ShardRegion.ExtractShardId">extractShardId</a>, <a href="#akka.cluster.sharding;PersistentShard.handOffStopMessage" title="Any">handOffStopMessage</a><span class="delimiter">)</span>
  with <a href="../../../../persistence/akka/persistence/PersistentActor.scala.html#akka.persistence;PersistentActor" title="akka.persistence.PersistentActor">PersistentActor</a> with <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="delimiter">{</span>

  import <a href="ShardRegion.scala.html#akka.cluster.sharding.ShardRegion" title="akka.cluster.sharding.ShardRegion.type">ShardRegion</a>.<span class="delimiter">{</span> EntityId, Msg <span class="delimiter">}</span>
  import <a href="#akka.cluster.sharding.Shard" title="akka.cluster.sharding.Shard.type">Shard</a>.<span class="delimiter">{</span> State, RestartEntity, EntityStopped, EntityStarted <span class="delimiter">}</span>
  import <a href="#akka.cluster.sharding;PersistentShard.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>.<a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings.tuningParameters" title="=&gt; akka.cluster.sharding.ClusterShardingSettings.TuningParameters">tuningParameters</a>._

  override def <a title="=&gt; String" id="akka.cluster.sharding;PersistentShard.persistenceId">persistenceId</a> = <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;/sharding/&quot;)">/sharding/$</span><span class="delimiter">{</span><a href="#akka.cluster.sharding;PersistentShard.typeName" title="String">typeName</a><span class="delimiter">}</span><span title="String(&quot;Shard/&quot;)">Shard/$</span><span class="delimiter">{</span><a href="#akka.cluster.sharding;PersistentShard.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;</span>

  override def <a title="=&gt; String" id="akka.cluster.sharding;PersistentShard.journalPluginId">journalPluginId</a>: <span title="String">String</span> = <a href="#akka.cluster.sharding;PersistentShard.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>.<a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings.journalPluginId" title="=&gt; String">journalPluginId</a>

  override def <a title="=&gt; String" id="akka.cluster.sharding;PersistentShard.snapshotPluginId">snapshotPluginId</a>: <span title="String">String</span> = <a href="#akka.cluster.sharding;PersistentShard.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>.<a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings.snapshotPluginId" title="=&gt; String">snapshotPluginId</a>

  var <a title="Int" id="akka.cluster.sharding;PersistentShard.persistCount_=">persistCount</a> = <span title="Int(0)" class="int">0</span>

  <span class="comment">// would be initialized after recovery completed</span>
  override def <a title="()Unit" id="akka.cluster.sharding;PersistentShard.initialized">initialized</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>

  override def <a title="=&gt; PersistentShard.this.Receive" id="akka.cluster.sharding;PersistentShard.receive">receive</a> = <a href="#akka.cluster.sharding;Shard.receiveCommand" title="=&gt; PersistentShard.this.Receive">receiveCommand</a>

  override def <a title="[A](event: A)(handler: A =&gt; Unit)Unit" id="akka.cluster.sharding;PersistentShard.processChange">processChange</a><span class="delimiter">[</span><a title="" id="akka.cluster.sharding;PersistentShard.processChange;A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A" id="akka.cluster.sharding;PersistentShard.processChange.event">event</a>: <a href="#akka.cluster.sharding;PersistentShard.processChange;A" title="A">A</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="A =&gt; Unit" id="akka.cluster.sharding;PersistentShard.processChange.handler">handler</a>: A ⇒ Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.sharding;PersistentShard.saveSnapshotWhenNeeded" title="()Unit">saveSnapshotWhenNeeded</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="../../../../persistence/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.persist(aa368cf4a0)" title="(event: A)(handler: A =&gt; Unit)Unit">persist</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.processChange.event" title="A">event</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.processChange.handler" title="A =&gt; Unit">handler</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="()Unit" id="akka.cluster.sharding;PersistentShard.saveSnapshotWhenNeeded">saveSnapshotWhenNeeded</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.sharding;PersistentShard.persistCount_=" title="(x$1: Int)Unit">persistCount</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.persistCount_=" title="=&gt; Int">persistCount</a> <span title="(x: Int)Int">%</span> <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.snapshotAfter" title="=&gt; Int">snapshotAfter</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Saving snapshot, sequence number [{}]&quot;)" class="string">&quot;Saving snapshot, sequence number [{}]&quot;</span>, <a href="../../../../persistence/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.snapshotSequenceNr" title="=&gt; Long">snapshotSequenceNr</a><span class="delimiter">)</span>
      <a href="../../../../persistence/akka/persistence/Snapshotter.scala.html#akka.persistence;Snapshotter.saveSnapshot" title="(snapshot: Any)Unit">saveSnapshot</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.state_=" title="=&gt; akka.cluster.sharding.Shard.State">state</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  override def <a title="=&gt; PersistentShard.this.Receive" id="akka.cluster.sharding;PersistentShard.receiveRecover">receiveRecover</a>: <span title="PersistentShard.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.sharding;PersistentShard.receiveRecover;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case EntityStarted<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.EntityId">id</span><span class="delimiter">)</span>                 ⇒ <a href="#akka.cluster.sharding;Shard.state_=" title="(x$1: akka.cluster.sharding.Shard.State)Unit">state</a> = <a href="#akka.cluster.sharding;Shard.state_=" title="=&gt; akka.cluster.sharding.Shard.State">state</a>.<a href="#akka.cluster.sharding.Shard;State.equals" title="(entities: Set[akka.cluster.sharding.ShardRegion.EntityId])akka.cluster.sharding.Shard.State">copy</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.state_=" title="=&gt; akka.cluster.sharding.Shard.State">state</a>.<a href="#akka.cluster.sharding.Shard;State.copy$default$1" title="=&gt; Set[akka.cluster.sharding.ShardRegion.EntityId]">entities</a> <span title="(elem: akka.cluster.sharding.ShardRegion.EntityId)scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.EntityId]">+</span> <span title="akka.cluster.sharding.ShardRegion.EntityId">id</span><span class="delimiter">)</span>
    case EntityStopped<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.EntityId">id</span><span class="delimiter">)</span>                 ⇒ <a href="#akka.cluster.sharding;Shard.state_=" title="(x$1: akka.cluster.sharding.Shard.State)Unit">state</a> = <a href="#akka.cluster.sharding;Shard.state_=" title="=&gt; akka.cluster.sharding.Shard.State">state</a>.<a href="#akka.cluster.sharding.Shard;State.equals" title="(entities: Set[akka.cluster.sharding.ShardRegion.EntityId])akka.cluster.sharding.Shard.State">copy</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.state_=" title="=&gt; akka.cluster.sharding.Shard.State">state</a>.<a href="#akka.cluster.sharding.Shard;State.copy$default$1" title="=&gt; Set[akka.cluster.sharding.ShardRegion.EntityId]">entities</a> <span title="(elem: akka.cluster.sharding.ShardRegion.EntityId)scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.EntityId]">-</span> <span title="akka.cluster.sharding.ShardRegion.EntityId">id</span><span class="delimiter">)</span>
    case SnapshotOffer<span class="delimiter">(</span>_, <a title="akka.cluster.sharding.Shard.State" id="akka.cluster.sharding;PersistentShard.receiveRecover;$anonfun.isDefinedAt.snapshot">snapshot</a>: <a href="#akka.cluster.sharding.Shard;State.equals" title="akka.cluster.sharding.Shard.State">State</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;Shard.state_=" title="(x$1: akka.cluster.sharding.Shard.State)Unit">state</a> = <a href="#akka.cluster.sharding;PersistentShard.receiveRecover;$anonfun.isDefinedAt.snapshot" title="akka.cluster.sharding.Shard.State">snapshot</a>
    case <a href="../../../../persistence/akka/persistence/PersistentActor.scala.html#akka.persistence.RecoveryCompleted" title="akka.persistence.RecoveryCompleted.type">RecoveryCompleted</a> ⇒
      <a href="#akka.cluster.sharding;Shard.state_=" title="=&gt; akka.cluster.sharding.Shard.State">state</a>.<a href="#akka.cluster.sharding.Shard;State.copy$default$1" title="=&gt; Set[akka.cluster.sharding.ShardRegion.EntityId]">entities</a> <span title="(f: akka.cluster.sharding.ShardRegion.EntityId =&gt; akka.actor.ActorRef)Unit">foreach</span> <a href="#akka.cluster.sharding;Shard.getEntity" title="(id: akka.cluster.sharding.ShardRegion.EntityId)akka.actor.ActorRef">getEntity</a>
      super.<a href="#akka.cluster.sharding;Shard.initialized" title="()Unit">initialized</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Shard recovery completed {}&quot;)" class="string">&quot;Shard recovery completed {}&quot;</span>, <a href="#akka.cluster.sharding;PersistentShard.shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  override def <a title="(ref: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;PersistentShard.entityTerminated">entityTerminated</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;PersistentShard.entityTerminated.ref">ref</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val <a title="akka.cluster.sharding.ShardRegion.EntityId" id="akka.cluster.sharding;PersistentShard.entityTerminated.id">id</a> = <a href="#akka.cluster.sharding;Shard.idByRef_=" title="(key: akka.actor.ActorRef)akka.cluster.sharding.ShardRegion.EntityId">idByRef</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.entityTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">messageBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.EntityId, default: =&gt; Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]">getOrElse</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.entityTerminated.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a>, <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span><span class="delimiter">)</span>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">//Note; because we're not persisting the EntityStopped, we don't need</span>
      <span class="comment">// to persist the EntityStarted either.</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Starting entity [{}] again, there are buffered messages for it&quot;)" class="string">&quot;Starting entity [{}] again, there are buffered messages for it&quot;</span>, <a href="#akka.cluster.sharding;PersistentShard.entityTerminated.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;Shard.sendMsgBuffer" title="(event: akka.cluster.sharding.Shard.EntityStarted)Unit">sendMsgBuffer</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.Shard.EntityStarted.readResolve" title="(entityId: akka.cluster.sharding.ShardRegion.EntityId)akka.cluster.sharding.Shard.EntityStarted">EntityStarted</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.entityTerminated.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> else <span class="delimiter">{</span>
      if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.sharding;Shard.passivating_=" title="=&gt; scala.collection.immutable.Set[akka.actor.ActorRef]">passivating</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.entityTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Entity [{}] stopped without passivating, will restart after backoff&quot;)" class="string">&quot;Entity [{}] stopped without passivating, will restart after backoff&quot;</span>, <a href="#akka.cluster.sharding;PersistentShard.entityTerminated.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span>
        import <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.scheduleOnce(a2d55b51db)" title="(delay: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">scheduleOnce</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.entityRestartBackoff" title="=&gt; scala.concurrent.duration.FiniteDuration">entityRestartBackoff</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.cluster.sharding.Shard.RestartEntity.readResolve" title="(entity: akka.cluster.sharding.ShardRegion.EntityId)akka.cluster.sharding.Shard.RestartEntity">RestartEntity</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.entityTerminated.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> else <a href="#akka.cluster.sharding;PersistentShard.processChange" title="(event: akka.cluster.sharding.Shard.EntityStopped)(handler: akka.cluster.sharding.Shard.EntityStopped =&gt; Unit)Unit">processChange</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.Shard.EntityStopped.readResolve" title="(entityId: akka.cluster.sharding.ShardRegion.EntityId)akka.cluster.sharding.Shard.EntityStopped">EntityStopped</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.entityTerminated.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.passivateCompleted" title="(event: akka.cluster.sharding.Shard.EntityStopped)Unit">passivateCompleted</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#akka.cluster.sharding;Shard.passivating_=" title="(x$1: scala.collection.immutable.Set[akka.actor.ActorRef])Unit">passivating</a> = <a href="#akka.cluster.sharding;Shard.passivating_=" title="=&gt; scala.collection.immutable.Set[akka.actor.ActorRef]">passivating</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-</span> <a href="#akka.cluster.sharding;PersistentShard.entityTerminated.ref" title="akka.actor.ActorRef">ref</a>
  <span class="delimiter">}</span>

  override def <a title="(id: akka.cluster.sharding.ShardRegion.EntityId, msg: Any, payload: akka.cluster.sharding.ShardRegion.Msg, snd: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;PersistentShard.deliverTo">deliverTo</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.EntityId" id="akka.cluster.sharding;PersistentShard.deliverTo.id">id</a>: <span title="akka.cluster.sharding.ShardRegion.EntityId">EntityId</span>, <a title="Any" id="akka.cluster.sharding;PersistentShard.deliverTo.msg">msg</a>: <span title="Any">Any</span>, <a title="akka.cluster.sharding.ShardRegion.Msg" id="akka.cluster.sharding;PersistentShard.deliverTo.payload">payload</a>: <span title="akka.cluster.sharding.ShardRegion.Msg">Msg</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;PersistentShard.deliverTo.snd">snd</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val <a title="String" id="akka.cluster.sharding;PersistentShard.deliverTo.name">name</a> = <span title="java.net.URLEncoder.type">URLEncoder</span>.<span title="(x$1: String, x$2: String)String">encode</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.deliverTo.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a>, <span title="String(&quot;utf-8&quot;)" class="string">&quot;utf-8&quot;</span><span class="delimiter">)</span>
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.child" title="(name: String)Option[akka.actor.ActorRef]">child</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.deliverTo.name" title="String">name</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;PersistentShard.deliverTo.actor">actor</a><span class="delimiter">)</span> ⇒
        <a href="#akka.cluster.sharding;PersistentShard.deliverTo.actor" title="akka.actor.ActorRef">actor</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.tell" title="(msg: Any, sender: akka.actor.ActorRef)Unit">tell</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.deliverTo.payload" title="akka.cluster.sharding.ShardRegion.Msg">payload</a>, <a href="#akka.cluster.sharding;PersistentShard.deliverTo.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span>

      case <span title="None.type">None</span> ⇒
        <span class="comment">//Note; we only do this if remembering, otherwise the buffer is an overhead</span>
        <a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]])Unit">messageBuffers</a> = <a href="#akka.cluster.sharding;Shard.messageBuffers_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">messageBuffers</a>.<span title="(key: akka.cluster.sharding.ShardRegion.EntityId, value: Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)])scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.EntityId,Vector[(akka.cluster.sharding.ShardRegion.Msg, akka.actor.ActorRef)]]">updated</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.deliverTo.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a>, <span title="(elems: (Any, akka.actor.ActorRef)*)scala.collection.immutable.Vector[(Any, akka.actor.ActorRef)]">Vector</span><span class="delimiter">(</span><span title="(_1: Any, _2: akka.actor.ActorRef)(Any, akka.actor.ActorRef)" class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.deliverTo.msg" title="Any">msg</a>, <a href="#akka.cluster.sharding;PersistentShard.deliverTo.snd" title="akka.actor.ActorRef">snd</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;PersistentShard.saveSnapshotWhenNeeded" title="()Unit">saveSnapshotWhenNeeded</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="../../../../persistence/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.persist(aa368cf4a0)" title="(event: akka.cluster.sharding.Shard.EntityStarted)(handler: akka.cluster.sharding.Shard.EntityStarted =&gt; Unit)Unit">persist</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.Shard.EntityStarted.readResolve" title="(entityId: akka.cluster.sharding.ShardRegion.EntityId)akka.cluster.sharding.Shard.EntityStarted">EntityStarted</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShard.deliverTo.id" title="akka.cluster.sharding.ShardRegion.EntityId">id</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;Shard.sendMsgBuffer" title="(event: akka.cluster.sharding.Shard.EntityStarted)Unit">sendMsgBuffer</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
