<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>cluster-sharding/akka/cluster/sharding/ShardCoordinator.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
package akka.cluster.sharding

import akka.persistence._

import scala.collection.immutable
import scala.concurrent.Future
import scala.concurrent.duration._
import scala.util.Success
import akka.actor.Actor
import akka.actor.ActorLogging
import akka.actor.ActorRef
import akka.actor.Cancellable
import akka.actor.Deploy
import akka.actor.NoSerializationVerificationNeeded
import akka.actor.Props
import akka.actor.ReceiveTimeout
import akka.actor.Stash
import akka.actor.Terminated
import akka.cluster.Cluster
import akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.ClusterShuttingDown
import akka.cluster.<a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent" title="akka.cluster.ClusterEvent.type">ClusterEvent</a>.CurrentClusterState
import akka.cluster.ddata.LWWRegisterKey
import akka.cluster.ddata.LWWRegister
import akka.cluster.ddata.<a href="../../../../distributed-data-experimental/akka/cluster/ddata/Replicator.scala.html#akka.cluster.ddata.Replicator" title="akka.cluster.ddata.Replicator.type">Replicator</a>._
import akka.dispatch.ExecutionContexts
import akka.pattern.pipe
import akka.actor.DeadLetterSuppression

<span class="comment">/**
 * @see [[ClusterSharding$ ClusterSharding extension]]
 */</span>
object <a title="akka.cluster.sharding.ShardCoordinator.type" id="akka.cluster.sharding.ShardCoordinator">ShardCoordinator</a> <a href="#akka.cluster.sharding.ShardCoordinator" title="akka.cluster.sharding.ShardCoordinator.type" class="delimiter">{</a>

  import <a href="ShardRegion.scala.html#akka.cluster.sharding.ShardRegion" title="akka.cluster.sharding.ShardRegion.type">ShardRegion</a>.ShardId

  <span class="comment">/**
   * INTERNAL API
   * Factory method for the [[akka.actor.Props]] of the [[ShardCoordinator]] actor.
   */</span>
  private<span class="delimiter">[</span>akka<span class="delimiter">]</span> def <a title="(typeName: String, settings: akka.cluster.sharding.ClusterShardingSettings, allocationStrategy: akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy)akka.actor.Props" id="akka.cluster.sharding.ShardCoordinator.props(194b2a4f2c)">props</a><span class="delimiter">(</span><a title="String" id="akka.cluster.sharding.ShardCoordinator.props(194b2a4f2c).typeName">typeName</a>: <span title="String">String</span>, <a title="akka.cluster.sharding.ClusterShardingSettings" id="akka.cluster.sharding.ShardCoordinator.props(194b2a4f2c).settings">settings</a>: <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings" title="akka.cluster.sharding.ClusterShardingSettings">ClusterShardingSettings</a>,
                          <a title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy" id="akka.cluster.sharding.ShardCoordinator.props(194b2a4f2c).allocationStrategy">allocationStrategy</a>: <a href="#akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy" title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy">ShardAllocationStrategy</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(b09a6a316b)" title="(creator: =&gt; akka.cluster.sharding.PersistentShardCoordinator)(implicit evidence$2: scala.reflect.ClassTag[akka.cluster.sharding.PersistentShardCoordinator])akka.actor.Props">Props</a><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[akka.cluster.sharding.PersistentShardCoordinator]" class="delimiter">(</span>new <a href="#akka.cluster.sharding;PersistentShardCoordinator" title="akka.cluster.sharding.PersistentShardCoordinator">PersistentShardCoordinator</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.props(194b2a4f2c).typeName" title="String">typeName</a>: <span title="String">String</span>, <a href="#akka.cluster.sharding.ShardCoordinator.props(194b2a4f2c).settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>, <a href="#akka.cluster.sharding.ShardCoordinator.props(194b2a4f2c).allocationStrategy" title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy">allocationStrategy</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.withDeploy" title="(d: akka.actor.Deploy)akka.actor.Props">withDeploy</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy" title="akka.actor.Deploy.type">Deploy</a>.<a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy.local" title="=&gt; akka.actor.Deploy">local</a><span class="delimiter">)</span>

  <span class="comment">/**
   * INTERNAL API
   * Factory method for the [[akka.actor.Props]] of the [[ShardCoordinator]] actor with state based on ddata.
   */</span>
  private<span class="delimiter">[</span>akka<span class="delimiter">]</span> def <a title="(typeName: String, settings: akka.cluster.sharding.ClusterShardingSettings, allocationStrategy: akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy, replicator: akka.actor.ActorRef)akka.actor.Props" id="akka.cluster.sharding.ShardCoordinator.props(8d56e222bb)">props</a><span class="delimiter">(</span><a title="String" id="akka.cluster.sharding.ShardCoordinator.props(8d56e222bb).typeName">typeName</a>: <span title="String">String</span>, <a title="akka.cluster.sharding.ClusterShardingSettings" id="akka.cluster.sharding.ShardCoordinator.props(8d56e222bb).settings">settings</a>: <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings" title="akka.cluster.sharding.ClusterShardingSettings">ClusterShardingSettings</a>,
                          <a title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy" id="akka.cluster.sharding.ShardCoordinator.props(8d56e222bb).allocationStrategy">allocationStrategy</a>: <a href="#akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy" title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy">ShardAllocationStrategy</a>,
                          <a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator.props(8d56e222bb).replicator">replicator</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(b09a6a316b)" title="(creator: =&gt; akka.cluster.sharding.DDataShardCoordinator)(implicit evidence$2: scala.reflect.ClassTag[akka.cluster.sharding.DDataShardCoordinator])akka.actor.Props">Props</a><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[akka.cluster.sharding.DDataShardCoordinator]" class="delimiter">(</span>new <a href="#akka.cluster.sharding;DDataShardCoordinator" title="akka.cluster.sharding.DDataShardCoordinator">DDataShardCoordinator</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.props(8d56e222bb).typeName" title="String">typeName</a>: <span title="String">String</span>, <a href="#akka.cluster.sharding.ShardCoordinator.props(8d56e222bb).settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>, <a href="#akka.cluster.sharding.ShardCoordinator.props(8d56e222bb).allocationStrategy" title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy">allocationStrategy</a>, <a href="#akka.cluster.sharding.ShardCoordinator.props(8d56e222bb).replicator" title="akka.actor.ActorRef">replicator</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.withDeploy" title="(d: akka.actor.Deploy)akka.actor.Props">withDeploy</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy" title="akka.actor.Deploy.type">Deploy</a>.<a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy.local" title="=&gt; akka.actor.Deploy">local</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Interface of the pluggable shard allocation and rebalancing logic used by the [[ShardCoordinator]].
   *
   * Java implementations should extend [[AbstractShardAllocationStrategy]].
   */</span>
  trait <a title="trait ShardAllocationStrategy extends AnyRef with akka.actor.NoSerializationVerificationNeeded" id="akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy">ShardAllocationStrategy</a> extends <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;NoSerializationVerificationNeeded" title="akka.actor.NoSerializationVerificationNeeded">NoSerializationVerificationNeeded</a> <span class="delimiter">{</span>
    <span class="comment">/**
     * Invoked when the location of a new shard is to be decided.
     * @param requester actor reference to the [[ShardRegion]] that requested the location of the
     *                  shard, can be returned if preference should be given to the node where the shard was first accessed
     * @param shardId the id of the shard to allocate
     * @param currentShardAllocations all actor refs to `ShardRegion` and their current allocated shards,
     *                                in the order they were allocated
     * @return a `Future` of the actor ref of the [[ShardRegion]] that is to be responsible for the shard, must be one of
     *         the references included in the `currentShardAllocations` parameter
     */</span>
    def <a title="(requester: akka.actor.ActorRef, shardId: akka.cluster.sharding.ShardRegion.ShardId, currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]])scala.concurrent.Future[akka.actor.ActorRef]" id="akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy.allocateShard">allocateShard</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy.allocateShard.requester">requester</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy.allocateShard.shardId">shardId</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>,
                      <a title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]" id="akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy.allocateShard.currentShardAllocations">currentShardAllocations</a>: <span title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[akka.actor.ActorRef]">Future</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span>

    <span class="comment">/**
     * Invoked periodically to decide which shards to rebalance to another location.
     * @param currentShardAllocations all actor refs to `ShardRegion` and their current allocated shards,
     *                                in the order they were allocated
     * @param rebalanceInProgress set of shards that are currently being rebalanced, i.e.
     *                            you should not include these in the returned set
     * @return a `Future` of the shards to be migrated, may be empty to skip rebalance in this round
     */</span>
    def <a title="(currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]], rebalanceInProgress: Set[akka.cluster.sharding.ShardRegion.ShardId])scala.concurrent.Future[Set[akka.cluster.sharding.ShardRegion.ShardId]]" id="akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy.rebalance">rebalance</a><span class="delimiter">(</span><a title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]" id="akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy.rebalance.currentShardAllocations">currentShardAllocations</a>: <span title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span>,
                  <a title="Set[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy.rebalance.rebalanceInProgress">rebalanceInProgress</a>: <span title="Set[akka.cluster.sharding.ShardRegion.ShardId]">Set</span><span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Set[akka.cluster.sharding.ShardRegion.ShardId]]">Future</span><span class="delimiter">[</span>Set<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Java API: Java implementations of custom shard allocation and rebalancing logic used by the [[ShardCoordinator]]
   * should extend this abstract class and implement the two methods.
   */</span>
  abstract class <a title="class AbstractShardAllocationStrategy extends AnyRef with akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy">AbstractShardAllocationStrategy</a> extends <a href="#akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy" title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy">ShardAllocationStrategy</a> <span class="delimiter">{</span>
    override final def <a title="(requester: akka.actor.ActorRef, shardId: akka.cluster.sharding.ShardRegion.ShardId, currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]])scala.concurrent.Future[akka.actor.ActorRef]" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(dd78c04531)">allocateShard</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(dd78c04531).requester">requester</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(dd78c04531).shardId">shardId</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>,
                                     <a title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(dd78c04531).currentShardAllocations">currentShardAllocations</a>: <span title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[akka.actor.ActorRef]">Future</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <span class="delimiter">{</span>

      import scala.collection.<span title="scala.collection.JavaConverters.type">JavaConverters</span>._
      <a href="#akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(441bb131dd)" title="(requester: akka.actor.ActorRef, shardId: String, currentShardAllocations: java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]])scala.concurrent.Future[akka.actor.ActorRef]">allocateShard</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(dd78c04531).requester" title="akka.actor.ActorRef">requester</a>, <a href="#akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(dd78c04531).shardId" title="akka.cluster.sharding.ShardRegion.ShardId">shardId</a>, <a href="#akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(dd78c04531).currentShardAllocations" title="(m: scala.collection.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]])scala.collection.convert.Decorators.AsJava[java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]]">currentShardAllocations</a>.<span title="=&gt; java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]">asJava</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    override final def <a title="(currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]], rebalanceInProgress: Set[akka.cluster.sharding.ShardRegion.ShardId])scala.concurrent.Future[Set[akka.cluster.sharding.ShardRegion.ShardId]]" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(ba6135770c)">rebalance</a><span class="delimiter">(</span><a title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(ba6135770c).currentShardAllocations">currentShardAllocations</a>: <span title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span>,
                                 <a title="Set[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(ba6135770c).rebalanceInProgress">rebalanceInProgress</a>: <span title="Set[akka.cluster.sharding.ShardRegion.ShardId]">Set</span><span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Set[akka.cluster.sharding.ShardRegion.ShardId]]">Future</span><span class="delimiter">[</span>Set<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      import scala.collection.<span title="scala.collection.JavaConverters.type">JavaConverters</span>._
      implicit val <a title="akka.dispatch.ExecutionContexts.sameThreadExecutionContext.type" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(ba6135770c).ec">ec</a> = <a href="../../../../actor/akka/dispatch/Future.scala.html#akka.dispatch.ExecutionContexts" title="akka.dispatch.ExecutionContexts.type">ExecutionContexts</a>.<a href="../../../../actor/akka/dispatch/Future.scala.html#akka.dispatch.ExecutionContexts.sameThreadExecutionContext" title="akka.dispatch.ExecutionContexts.sameThreadExecutionContext.type">sameThreadExecutionContext</a>
      <a href="#akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(f46c45376e)" title="(currentShardAllocations: java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]], rebalanceInProgress: java.util.Set[String])scala.concurrent.Future[java.util.Set[String]]">rebalance</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(ba6135770c).currentShardAllocations" title="(m: scala.collection.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]])scala.collection.convert.Decorators.AsJava[java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]]">currentShardAllocations</a>.<span title="=&gt; java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]">asJava</span>, <a href="#akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(ba6135770c).rebalanceInProgress" title="(s: scala.collection.Set[akka.cluster.sharding.ShardRegion.ShardId])scala.collection.convert.Decorators.AsJava[java.util.Set[akka.cluster.sharding.ShardRegion.ShardId]]">rebalanceInProgress</a>.<span title="=&gt; java.util.Set[akka.cluster.sharding.ShardRegion.ShardId]">asJava</span><span class="delimiter">)</span>.<span title="(f: java.util.Set[String] =&gt; scala.collection.immutable.Set[String])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[scala.collection.immutable.Set[String]]">map</span><a href="#akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(ba6135770c).ec" title="akka.dispatch.ExecutionContexts.sameThreadExecutionContext.type" class="delimiter">(</a><a href="#akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(ba6135770c).$anonfun.x$1" title="(s: java.util.Set[String])scala.collection.convert.Decorators.AsScala[scala.collection.mutable.Set[String]]">_</a>.<span title="=&gt; scala.collection.mutable.Set[String]">asScala</span>.<span title="scala.collection.immutable.Set[String]">toSet</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Invoked when the location of a new shard is to be decided.
     * @param requester actor reference to the [[ShardRegion]] that requested the location of the
     *                  shard, can be returned if preference should be given to the node where the shard was first accessed
     * @param shardId the id of the shard to allocate
     * @param currentShardAllocations all actor refs to `ShardRegion` and their current allocated shards,
     *                                in the order they were allocated
     * @return a `Future` of the actor ref of the [[ShardRegion]] that is to be responsible for the shard, must be one of
     *         the references included in the `currentShardAllocations` parameter
     */</span>
    def <a title="(requester: akka.actor.ActorRef, shardId: String, currentShardAllocations: java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]])scala.concurrent.Future[akka.actor.ActorRef]" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(441bb131dd)">allocateShard</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(441bb131dd).requester">requester</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="String" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(441bb131dd).shardId">shardId</a>: <span title="String">String</span>,
                      <a title="java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]]" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.allocateShard(441bb131dd).currentShardAllocations">currentShardAllocations</a>: java.util.<span title="java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[akka.actor.ActorRef]">Future</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span>

    <span class="comment">/**
     * Invoked periodically to decide which shards to rebalance to another location.
     * @param currentShardAllocations all actor refs to `ShardRegion` and their current allocated shards,
     *                                in the order they were allocated
     * @param rebalanceInProgress set of shards that are currently being rebalanced, i.e.
     *                            you should not include these in the returned set
     * @return a `Future` of the shards to be migrated, may be empty to skip rebalance in this round
     */</span>
    def <a title="(currentShardAllocations: java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]], rebalanceInProgress: java.util.Set[String])scala.concurrent.Future[java.util.Set[String]]" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(f46c45376e)">rebalance</a><span class="delimiter">(</span><a title="java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]]" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(f46c45376e).currentShardAllocations">currentShardAllocations</a>: java.util.<span title="java.util.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[String]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span>,
                  <a title="java.util.Set[String]" id="akka.cluster.sharding.ShardCoordinator;AbstractShardAllocationStrategy.rebalance(f46c45376e).rebalanceInProgress">rebalanceInProgress</a>: java.util.<span title="java.util.Set[String]">Set</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[java.util.Set[String]]">Future</span><span class="delimiter">[</span>java.util.Set<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  private val <a title="scala.concurrent.Future[scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]]" id="akka.cluster.sharding.ShardCoordinator.emptyRebalanceResult">emptyRebalanceResult</a> = <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId])scala.concurrent.Future[scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]]">successful</span><span class="delimiter">(</span><span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.immutable.Set[A]">empty</span><span title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]" class="delimiter">[</span><span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span><span class="delimiter">]</span><span class="delimiter">)</span>

  <span class="comment">/**
   * The default implementation of [[ShardCoordinator.LeastShardAllocationStrategy]]
   * allocates new shards to the `ShardRegion` with least number of previously allocated shards.
   * It picks shards for rebalancing handoff from the `ShardRegion` with most number of previously allocated shards.
   * They will then be allocated to the `ShardRegion` with least number of previously allocated shards,
   * i.e. new members in the cluster. There is a configurable threshold of how large the difference
   * must be to begin the rebalancing. The number of ongoing rebalancing processes can be limited.
   */</span>
  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
  class <a title="class LeastShardAllocationStrategy extends AnyRef with akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy with Serializable" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy">LeastShardAllocationStrategy</a><a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy" title="akka.cluster.sharding.ShardCoordinator.LeastShardAllocationStrategy" class="delimiter">(</a><a title="Int" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalanceThreshold">rebalanceThreshold</a>: <span title="Int">Int</span>, <a title="Int" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.maxSimultaneousRebalance">maxSimultaneousRebalance</a>: <span title="Int">Int</span><span class="delimiter">)</span>
    extends <a href="#akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy" title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy">ShardAllocationStrategy</a> with <span title="Serializable">Serializable</span> <span class="delimiter">{</span>

    override def <a title="(requester: akka.actor.ActorRef, shardId: akka.cluster.sharding.ShardRegion.ShardId, currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]])scala.concurrent.Future[akka.actor.ActorRef]" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.allocateShard">allocateShard</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.requester">requester</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.shardId">shardId</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>,
                               <a title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.currentShardAllocations">currentShardAllocations</a>: <span title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[akka.actor.ActorRef]">Future</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <span class="delimiter">{</span>
      val <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.regionWithLeastShards.regionWithLeastShards" title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.regionWithLeastShards" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.regionWithLeastShards.regionWithLeastShards">regionWithLeastShards</a>, _<span class="delimiter">)</span> = <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.currentShardAllocations" title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]">currentShardAllocations</a>.<span title="(f: ((akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId])) =&gt; Int)(implicit cmp: Ordering[Int])(akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId])">minBy</span> <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.regionWithLeastShards.$anonfun.x0$1" title="Int" class="delimiter">{</a> case <span class="delimiter">(</span>_, <a title="scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.regionWithLeastShards.$anonfun.v">v</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.regionWithLeastShards.$anonfun.v" title="scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]">v</a>.<span title="=&gt; Int">size</span> <span class="delimiter">}</span>
      <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: akka.actor.ActorRef)scala.concurrent.Future[akka.actor.ActorRef]">successful</span><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.allocateShard.regionWithLeastShards" title="akka.actor.ActorRef">regionWithLeastShards</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    override def <a title="(currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]], rebalanceInProgress: Set[akka.cluster.sharding.ShardRegion.ShardId])scala.concurrent.Future[Set[akka.cluster.sharding.ShardRegion.ShardId]]" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance">rebalance</a><span class="delimiter">(</span><a title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.currentShardAllocations">currentShardAllocations</a>: <span title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]">Map</span><span class="delimiter">[</span>ActorRef, immutable.IndexedSeq<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span>,
                           <a title="Set[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.rebalanceInProgress">rebalanceInProgress</a>: <span title="Set[akka.cluster.sharding.ShardRegion.ShardId]">Set</span><span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Set[akka.cluster.sharding.ShardRegion.ShardId]]">Future</span><span class="delimiter">[</span>Set<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.rebalanceInProgress" title="Set[akka.cluster.sharding.ShardRegion.ShardId]">rebalanceInProgress</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.maxSimultaneousRebalance" title="Int">maxSimultaneousRebalance</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        val <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.regionWithLeastShards" title="(akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId])" class="delimiter">(</a><a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.x$2" title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.regionWithLeastShards">regionWithLeastShards</a>, <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.x$2" title="scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.leastShards">leastShards</a><span class="delimiter">)</span> = <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.currentShardAllocations" title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]">currentShardAllocations</a>.<span title="(f: ((akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId])) =&gt; Int)(implicit cmp: Ordering[Int])(akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId])">minBy</span> <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.x$2.$anonfun.x0$2" title="Int" class="delimiter">{</a> case <span class="delimiter">(</span>_, <a title="scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.x$2.$anonfun.v">v</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.x$2.$anonfun.v" title="scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]">v</a>.<span title="=&gt; Int">size</span> <span class="delimiter">}</span>
        val <a title="scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards">mostShards</a> = <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.currentShardAllocations" title="Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]">currentShardAllocations</a>.<span title="(pf: PartialFunction[(akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]),scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]],scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId],scala.collection.immutable.Iterable[scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]])scala.collection.immutable.Iterable[scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]]">collect</span> <a title="&lt;$anon: ((akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId])) =&gt; scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]&gt; extends scala.runtime.AbstractPartialFunction[(akka.actor.ActorRef, scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]),scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]] with Serializable" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
          case <span class="delimiter">(</span>_, <a title="scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards;$anonfun.isDefinedAt.v">v</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards;$anonfun.isDefinedAt.v" title="scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]">v</a>.<span title="(p: akka.cluster.sharding.ShardRegion.ShardId =&gt; Boolean)scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]">filterNot</span><span title="Boolean(true)" class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards;$anonfun.applyOrElse.$anonfun.s">s</a> ⇒ <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.rebalanceInProgress" title="(elem: akka.cluster.sharding.ShardRegion.ShardId)Boolean">rebalanceInProgress</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards;$anonfun.applyOrElse.$anonfun.s" title="akka.cluster.sharding.ShardRegion.ShardId">s</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>.<span title="(f: scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId] =&gt; Int)(implicit cmp: Ordering[Int])scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]">maxBy</span><span title="scala.math.Ordering.Int.type" class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards.$anonfun.x$3" title="scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]">_</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
        if <span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards" title="scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]">mostShards</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">-</span> <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.leastShards" title="scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]">leastShards</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&gt;=</span> <a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalanceThreshold" title="Int">rebalanceThreshold</a><span class="delimiter">)</span>
          <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId])scala.concurrent.Future[scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]]">successful</span><span class="delimiter">(</span><span title="(elems: akka.cluster.sharding.ShardRegion.ShardId*)scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">Set</span><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator;LeastShardAllocationStrategy.rebalance.mostShards" title="scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]">mostShards</a>.<span title="=&gt; akka.cluster.sharding.ShardRegion.ShardId">head</span><span class="delimiter">)</span><span class="delimiter">)</span>
        else
          <a href="#akka.cluster.sharding.ShardCoordinator.emptyRebalanceResult" title="=&gt; scala.concurrent.Future[scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]]">emptyRebalanceResult</a>
      <span class="delimiter">}</span> else <a href="#akka.cluster.sharding.ShardCoordinator.emptyRebalanceResult" title="=&gt; scala.concurrent.Future[scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]]">emptyRebalanceResult</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * INTERNAL API
   */</span>
  private<span class="delimiter">[</span>akka<span class="delimiter">]</span> object <a title="akka.cluster.sharding.ShardCoordinator.Internal.type" id="akka.cluster.sharding.ShardCoordinator.Internal">Internal</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal" title="akka.cluster.sharding.ShardCoordinator.Internal.type" class="delimiter">{</a>
    <span class="comment">/**
     * Messages sent to the coordinator
     */</span>
    sealed trait <a title="trait CoordinatorCommand extends AnyRef with akka.cluster.sharding.ClusterShardingSerializable" id="akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorCommand">CoordinatorCommand</a> extends <a href="ClusterShardingSerializable.scala.html#akka.cluster.sharding;ClusterShardingSerializable" title="akka.cluster.sharding.ClusterShardingSerializable">ClusterShardingSerializable</a>
    <span class="comment">/**
     * Messages sent from the coordinator
     */</span>
    sealed trait <a title="trait CoordinatorMessage extends AnyRef with akka.cluster.sharding.ClusterShardingSerializable" id="akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorMessage">CoordinatorMessage</a> extends <a href="ClusterShardingSerializable.scala.html#akka.cluster.sharding;ClusterShardingSerializable" title="akka.cluster.sharding.ClusterShardingSerializable">ClusterShardingSerializable</a>
    <span class="comment">/**
     * `ShardRegion` registers to `ShardCoordinator`, until it receives [[RegisterAck]].
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class Register extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorCommand with akka.actor.DeadLetterSuppression with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.Register.readResolve">Register</a><span title="Product" class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator.Internal;Register.shardRegion">shardRegion</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorCommand" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorCommand">CoordinatorCommand</a>
      with <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;DeadLetterSuppression" title="akka.actor.DeadLetterSuppression">DeadLetterSuppression</a>

    <span class="comment">/**
     * `ShardRegion` in proxy only mode registers to `ShardCoordinator`, until it receives [[RegisterAck]].
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class RegisterProxy extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorCommand with akka.actor.DeadLetterSuppression with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.RegisterProxy.readResolve">RegisterProxy</a><span title="Product" class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator.Internal;RegisterProxy.shardRegionProxy">shardRegionProxy</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorCommand" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorCommand">CoordinatorCommand</a>
      with <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;DeadLetterSuppression" title="akka.actor.DeadLetterSuppression">DeadLetterSuppression</a>

    <span class="comment">/**
     * Acknowledgement from `ShardCoordinator` that [[Register]] or [[RegisterProxy]] was successful.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class RegisterAck extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.RegisterAck.readResolve">RegisterAck</a><span title="Product" class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator.Internal;RegisterAck.coordinator">coordinator</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorMessage" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a>
    <span class="comment">/**
     * `ShardRegion` requests the location of a shard by sending this message
     * to the `ShardCoordinator`.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class GetShardHome extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorCommand with akka.actor.DeadLetterSuppression with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.GetShardHome.readResolve">GetShardHome</a><span title="Product" class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator.Internal;GetShardHome.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorCommand" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorCommand">CoordinatorCommand</a>
      with <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;DeadLetterSuppression" title="akka.actor.DeadLetterSuppression">DeadLetterSuppression</a>

    <span class="comment">/**
     * `ShardCoordinator` replies with this message for [[GetShardHome]] requests.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class ShardHome extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.ShardHome.readResolve">ShardHome</a><span title="Product" class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator.Internal;ShardHome.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator.Internal;ShardHome.ref">ref</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorMessage" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a>
    <span class="comment">/**
     * `ShardCoordinator` informs a `ShardRegion` that it is hosting this shard
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class HostShard extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.HostShard.readResolve">HostShard</a><span title="Product" class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator.Internal;HostShard.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorMessage" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a>
    <span class="comment">/**
     * `ShardRegion` replies with this message for [[HostShard]] requests which lead to it hosting the shard
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1l</span><span class="delimiter">)</span> final case class <a title="class ShardStarted extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.ShardStarted.readResolve">ShardStarted</a><span title="Product" class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator.Internal;ShardStarted.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorMessage" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a>
    <span class="comment">/**
     * `ShardCoordinator` initiates rebalancing process by sending this message
     * to all registered `ShardRegion` actors (including proxy only). They are
     * supposed to discard their known location of the shard, i.e. start buffering
     * incoming messages for the shard. They reply with [[BeginHandOffAck]].
     * When all have replied the `ShardCoordinator` continues by sending
     * `HandOff` to the `ShardRegion` responsible for the shard.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class BeginHandOff extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.BeginHandOff.readResolve">BeginHandOff</a><span title="Product" class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator.Internal;BeginHandOff.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorMessage" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a>
    <span class="comment">/**
     * Acknowledgement of [[BeginHandOff]]
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class BeginHandOffAck extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorCommand with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.BeginHandOffAck.readResolve">BeginHandOffAck</a><span title="Product" class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator.Internal;BeginHandOffAck.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorCommand" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorCommand">CoordinatorCommand</a>
    <span class="comment">/**
     * When all `ShardRegion` actors have acknowledged the `BeginHandOff` the
     * `ShardCoordinator` sends this message to the `ShardRegion` responsible for the
     * shard. The `ShardRegion` is supposed to stop all entities in that shard and when
     * all entities have terminated reply with `ShardStopped` to the `ShardCoordinator`.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class HandOff extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.HandOff.readResolve">HandOff</a><span title="Product" class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator.Internal;HandOff.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorMessage" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorMessage">CoordinatorMessage</a>
    <span class="comment">/**
     * Reply to `HandOff` when all entities in the shard have been terminated.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class ShardStopped extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorCommand with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.ShardStopped.readResolve">ShardStopped</a><span title="Product" class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator.Internal;ShardStopped.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorCommand" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorCommand">CoordinatorCommand</a>

    <span class="comment">/**
     * `ShardRegion` requests full handoff to be able to shutdown gracefully.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class GracefulShutdownReq extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorCommand with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.GracefulShutdownReq.readResolve">GracefulShutdownReq</a><span title="Product" class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator.Internal;GracefulShutdownReq.shardRegion">shardRegion</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;CoordinatorCommand" title="akka.cluster.sharding.ShardCoordinator.Internal.CoordinatorCommand">CoordinatorCommand</a>

    <span class="comment">// DomainEvents for the persistent state of the event sourced ShardCoordinator</span>
    sealed trait <a title="trait DomainEvent extends AnyRef with akka.cluster.sharding.ClusterShardingSerializable" id="akka.cluster.sharding.ShardCoordinator.Internal;DomainEvent">DomainEvent</a> extends <a href="ClusterShardingSerializable.scala.html#akka.cluster.sharding;ClusterShardingSerializable" title="akka.cluster.sharding.ClusterShardingSerializable">ClusterShardingSerializable</a>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class ShardRegionRegistered extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionRegistered.readResolve">ShardRegionRegistered</a><span title="Product" class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator.Internal;ShardRegionRegistered.region">region</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;DomainEvent" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">DomainEvent</a>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class ShardRegionProxyRegistered extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionProxyRegistered.readResolve">ShardRegionProxyRegistered</a><span title="Product" class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator.Internal;ShardRegionProxyRegistered.regionProxy">regionProxy</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;DomainEvent" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">DomainEvent</a>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class ShardRegionTerminated extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionTerminated.readResolve">ShardRegionTerminated</a><span title="Product" class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator.Internal;ShardRegionTerminated.region">region</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;DomainEvent" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">DomainEvent</a>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class ShardRegionProxyTerminated extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionProxyTerminated.readResolve">ShardRegionProxyTerminated</a><span title="Product" class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator.Internal;ShardRegionProxyTerminated.regionProxy">regionProxy</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;DomainEvent" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">DomainEvent</a>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class ShardHomeAllocated extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeAllocated.readResolve">ShardHomeAllocated</a><span title="Product" class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator.Internal;ShardHomeAllocated.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator.Internal;ShardHomeAllocated.region">region</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;DomainEvent" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">DomainEvent</a>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="class ShardHomeDeallocated extends AnyRef with akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeDeallocated.readResolve">ShardHomeDeallocated</a><span title="Product" class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator.Internal;ShardHomeDeallocated.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span><span class="delimiter">)</span> extends <a href="#akka.cluster.sharding.ShardCoordinator.Internal;DomainEvent" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">DomainEvent</a>

    object <a title="akka.cluster.sharding.ShardCoordinator.Internal.State.type" id="akka.cluster.sharding.ShardCoordinator.Internal.State.readResolve">State</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal.State.readResolve" title="akka.cluster.sharding.ShardCoordinator.Internal.State.type" class="delimiter">{</a>
      val <a title="akka.cluster.sharding.ShardCoordinator.Internal.State" id="akka.cluster.sharding.ShardCoordinator.Internal.State.empty">empty</a> = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.equals" title="(shards: Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef], regions: Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]], regionProxies: Set[akka.actor.ActorRef], unallocatedShards: Set[akka.cluster.sharding.ShardRegion.ShardId])akka.cluster.sharding.ShardCoordinator.Internal.State">State</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Persistent state of the event sourced ShardCoordinator.
     */</span>
    @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span> final case class <a title="(shards: Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef], regions: Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]], regionProxies: Set[akka.actor.ActorRef], unallocatedShards: Set[akka.cluster.sharding.ShardRegion.ShardId])akka.cluster.sharding.ShardCoordinator.Internal.State" id="akka.cluster.sharding.ShardCoordinator.Internal;State.equals">State</a> private<span class="delimiter">[</span>akka<span class="delimiter">]</span> <span class="delimiter">(</span>
      <span class="comment">// region for each shard</span>
      <a title="Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]" id="akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1">shards</a>: <span title="Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">Map</span><span class="delimiter">[</span>ShardId, ActorRef<span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,Nothing]">empty</span>,
      <span class="comment">// shards for each region</span>
      <a title="Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]" id="akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2">regions</a>: <span title="Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">Map</span><span class="delimiter">[</span>ActorRef, Vector<span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="scala.collection.immutable.Map[akka.actor.ActorRef,Nothing]">empty</span>,
      <a title="Set[akka.actor.ActorRef]" id="akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$3">regionProxies</a>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.actor.ActorRef]">empty</span>,
      <a title="Set[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$4">unallocatedShards</a>: <span title="Set[akka.cluster.sharding.ShardRegion.ShardId]">Set</span><span class="delimiter">[</span>ShardId<span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">empty</span><span class="delimiter">)</span> extends <a href="ClusterShardingSerializable.scala.html#akka.cluster.sharding;ClusterShardingSerializable" title="akka.cluster.sharding.ClusterShardingSerializable">ClusterShardingSerializable</a> <span class="delimiter">{</span>

      def <a title="(event: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)akka.cluster.sharding.ShardCoordinator.Internal.State" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated">updated</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.event">event</a>: <a href="#akka.cluster.sharding.ShardCoordinator.Internal;DomainEvent" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">DomainEvent</a><span class="delimiter">)</span>: <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.equals" title="akka.cluster.sharding.ShardCoordinator.Internal.State">State</a> = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated.event" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">event</a> match <span class="delimiter">{</span>
        case ShardRegionRegistered<span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Region &quot;)">Region $</span><span title="akka.actor.ActorRef">region</span><span title="String(&quot; already registered: &quot;)"> already registered: $</span>this<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$10">copy</a><span class="delimiter">(</span>regions = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef, value: Vector[akka.cluster.sharding.ShardRegion.ShardId])scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">updated</span><a title="scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$7" class="delimiter">(</a><span title="akka.actor.ActorRef">region</span>, <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span><span class="delimiter">)</span><span class="delimiter">)</span>
        case ShardRegionProxyRegistered<span class="delimiter">(</span><span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span> ⇒
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Region proxy &quot;)">Region proxy $</span><span title="akka.actor.ActorRef">proxy</span><span title="String(&quot; already registered: &quot;)"> already registered: $</span>this<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$14">copy</a><span class="delimiter">(</span>regionProxies = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a> <a title="scala.collection.immutable.Set[akka.actor.ActorRef] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$11">+</a> <span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span>
        case ShardRegionTerminated<span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Terminated region &quot;)">Terminated region $</span><span title="akka.actor.ActorRef">region</span><span title="String(&quot; not registered: &quot;)"> not registered: $</span>this<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$3" title="Set[akka.actor.ActorRef] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$18">copy</a><span class="delimiter">(</span>
            regions = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a> <a title="scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$15">-</a> <span title="akka.actor.ActorRef">region</span>,
            shards = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a> <a title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$16">--</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="(key: akka.actor.ActorRef)Vector[akka.cluster.sharding.ShardRegion.ShardId]">regions</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>,
            unallocatedShards = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$4" title="=&gt; Set[akka.cluster.sharding.ShardRegion.ShardId]">unallocatedShards</a> <a title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$17">++</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="(key: akka.actor.ActorRef)Vector[akka.cluster.sharding.ShardRegion.ShardId]">regions</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span><span class="delimiter">)</span>
        case ShardRegionProxyTerminated<span class="delimiter">(</span><span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span> ⇒
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Terminated region proxy &quot;)">Terminated region proxy $</span><span title="akka.actor.ActorRef">proxy</span><span title="String(&quot; not registered: &quot;)"> not registered: $</span>this<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$22">copy</a><span class="delimiter">(</span>regionProxies = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a> <a title="scala.collection.immutable.Set[akka.actor.ActorRef] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$19">-</a> <span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span>
        case ShardHomeAllocated<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Region &quot;)">Region $</span><span title="akka.actor.ActorRef">region</span><span title="String(&quot; not registered: &quot;)"> not registered: $</span>this<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Shard [&quot;)">Shard [$</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span title="String(&quot;] already allocated: &quot;)">] already allocated: $</span>this<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$3" title="Set[akka.actor.ActorRef] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$26">copy</a><span class="delimiter">(</span>
            shards = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId, value: akka.actor.ActorRef)scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">updated</span><a title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$23" class="delimiter">(</a><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>,
            regions = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef, value: Vector[akka.cluster.sharding.ShardRegion.ShardId])scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">updated</span><a title="scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$24" class="delimiter">(</a><span title="akka.actor.ActorRef">region</span>, <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="(key: akka.actor.ActorRef)Vector[akka.cluster.sharding.ShardRegion.ShardId]">regions</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> <span title="(elem: akka.cluster.sharding.ShardRegion.ShardId)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector[akka.cluster.sharding.ShardRegion.ShardId],akka.cluster.sharding.ShardRegion.ShardId,Vector[akka.cluster.sharding.ShardRegion.ShardId]])Vector[akka.cluster.sharding.ShardRegion.ShardId]">:+</span> <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>,
            unallocatedShards = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$4" title="=&gt; Set[akka.cluster.sharding.ShardRegion.ShardId]">unallocatedShards</a> <a title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$25">-</a> <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>
        case ShardHomeDeallocated<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> ⇒
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Shard [&quot;)">Shard [$</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span title="String(&quot;] not allocated: &quot;)">] not allocated: $</span>this<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          val <span title="akka.actor.ActorRef">region</span> = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="(key: akka.cluster.sharding.ShardRegion.ShardId)akka.actor.ActorRef">shards</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Region &quot;)">Region $</span><span title="akka.actor.ActorRef">region</span><span title="String(&quot; for shard [&quot;)"> for shard [$</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span title="String(&quot;] not registered: &quot;)">] not registered: $</span>this<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.equals" title="String(&quot;&quot;)" class="string">&quot;</a><span class="delimiter">)</span>
          <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$3" title="Set[akka.actor.ActorRef] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$30">copy</a><span class="delimiter">(</span>
            shards = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a> <a title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$27">-</a> <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>,
            regions = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef, value: Vector[akka.cluster.sharding.ShardRegion.ShardId])scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">updated</span><a title="scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$28" class="delimiter">(</a><span title="akka.actor.ActorRef">region</span>, <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="(key: akka.actor.ActorRef)Vector[akka.cluster.sharding.ShardRegion.ShardId]">regions</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>.<span title="(p: akka.cluster.sharding.ShardRegion.ShardId =&gt; Boolean)scala.collection.immutable.Vector[akka.cluster.sharding.ShardRegion.ShardId]">filterNot</span><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$28.$anonfun.x$4" title="akka.cluster.sharding.ShardRegion.ShardId">_</a> <span title="(x$1: Any)Boolean">==</span> <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span>,
            unallocatedShards = <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$4" title="=&gt; Set[akka.cluster.sharding.ShardRegion.ShardId]">unallocatedShards</a> <a title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding.ShardCoordinator.Internal;State.updated.x$29">+</a> <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  <span class="comment">/**
   * Periodic message to trigger rebalance
   */</span>
  private case object <a href="#akka.cluster.sharding.ShardCoordinator.RebalanceTick.productElement.x$1" title="akka.cluster.sharding.ShardCoordinator.RebalanceTick.type" id="akka.cluster.sharding.ShardCoordinator.RebalanceTick.readResolve">RebalanceTick</a>
  <span class="comment">/**
   * End of rebalance process performed by [[RebalanceWorker]]
   */</span>
  private final case class <a title="class RebalanceDone extends AnyRef with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.RebalanceDone.readResolve">RebalanceDone</a><a href="#akka.cluster.sharding.ShardCoordinator.RebalanceDone.readResolve" title="Product" class="delimiter">(</a><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator;RebalanceDone.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>, <a title="Boolean" id="akka.cluster.sharding.ShardCoordinator;RebalanceDone.ok">ok</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>
  <span class="comment">/**
   * Check if we've received a shard start request
   */</span>
  private final case class <a title="class ResendShardHost extends AnyRef with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.ResendShardHost.readResolve">ResendShardHost</a><a href="#akka.cluster.sharding.ShardCoordinator.ResendShardHost.readResolve" title="Product" class="delimiter">(</a><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator;ResendShardHost.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator;ResendShardHost.region">region</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>

  private final case class <a title="class DelayedShardRegionTerminated extends AnyRef with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.DelayedShardRegionTerminated.readResolve">DelayedShardRegionTerminated</a><a href="#akka.cluster.sharding.ShardCoordinator.DelayedShardRegionTerminated.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator;DelayedShardRegionTerminated.region">region</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Result of `allocateShard` is piped to self with this message.
   */</span>
  private final case class <a title="class AllocateShardResult extends AnyRef with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.AllocateShardResult.readResolve">AllocateShardResult</a><a href="#akka.cluster.sharding.ShardCoordinator.AllocateShardResult.readResolve" title="Product" class="delimiter">(</a>
    <a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator;AllocateShardResult.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>, <a title="Option[akka.actor.ActorRef]" id="akka.cluster.sharding.ShardCoordinator;AllocateShardResult.shardRegion">shardRegion</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator;AllocateShardResult.getShardHomeSender">getShardHomeSender</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Result of `rebalance` is piped to self with this message.
   */</span>
  private final case class <a title="class RebalanceResult extends AnyRef with Product with Serializable" id="akka.cluster.sharding.ShardCoordinator.RebalanceResult.readResolve">RebalanceResult</a><a href="#akka.cluster.sharding.ShardCoordinator.RebalanceResult.readResolve" title="Product" class="delimiter">(</a><a title="Set[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding.ShardCoordinator;RebalanceResult.shards">shards</a>: <span title="Set[akka.cluster.sharding.ShardRegion.ShardId]">Set</span><span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">)</span>

  <span class="comment">/**
   * INTERNAL API. Rebalancing process is performed by this actor.
   * It sends `BeginHandOff` to all `ShardRegion` actors followed by
   * `HandOff` to the `ShardRegion` responsible for the shard.
   * When the handoff is completed it sends [[RebalanceDone]] to its
   * parent `ShardCoordinator`. If the process takes longer than the
   * `handOffTimeout` it also sends [[RebalanceDone]].
   */</span>
  private<span class="delimiter">[</span>akka<span class="delimiter">]</span> class <a title="class RebalanceWorker extends AnyRef with akka.actor.Actor" id="akka.cluster.sharding.ShardCoordinator;RebalanceWorker">RebalanceWorker</a><a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker" title="akka.cluster.sharding.ShardCoordinator.RebalanceWorker" class="delimiter">(</a><a title="String" id="akka.cluster.sharding.ShardCoordinator;RebalanceWorker.shard">shard</a>: <span title="String">String</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator;RebalanceWorker.from">from</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="scala.concurrent.duration.FiniteDuration" id="akka.cluster.sharding.ShardCoordinator;RebalanceWorker.handOffTimeout">handOffTimeout</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
                                      <a title="Set[akka.actor.ActorRef]" id="akka.cluster.sharding.ShardCoordinator;RebalanceWorker.regions">regions</a>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span><span class="delimiter">)</span> extends <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="delimiter">{</span>
    import <a href="#akka.cluster.sharding.ShardCoordinator.Internal" title="akka.cluster.sharding.ShardCoordinator.Internal.type">Internal</a>._
    <a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker.regions" title="Set[akka.actor.ActorRef]">regions</a>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">_</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal.BeginHandOff.readResolve" title="(shard: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardCoordinator.Internal.BeginHandOff">BeginHandOff</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker.shard" title="String">shard</a><span class="delimiter">)</span><span class="delimiter">)</span>
    var <a title="Set[akka.actor.ActorRef]" id="akka.cluster.sharding.ShardCoordinator;RebalanceWorker.remaining_=">remaining</a> = <a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker.regions" title="Set[akka.actor.ActorRef]">regions</a>

    import <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.scheduleOnce(a2d55b51db)" title="(delay: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">scheduleOnce</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker.handOffTimeout" title="scala.concurrent.duration.FiniteDuration">handOffTimeout</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.ReceiveTimeout" title="akka.actor.ReceiveTimeout.type">ReceiveTimeout</a><span class="delimiter">)</span>

    def <a title="=&gt; PartialFunction[Any,Unit]" id="akka.cluster.sharding.ShardCoordinator;RebalanceWorker.receive">receive</a> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.sharding.ShardCoordinator;RebalanceWorker.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      case BeginHandOffAck<span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker.shard" title="String">`shard`</a><span class="delimiter">)</span> ⇒
        <a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker.remaining_=" title="(x$1: Set[akka.actor.ActorRef])Unit">remaining</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-=</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>
        if <span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker.remaining_=" title="=&gt; Set[akka.actor.ActorRef]">remaining</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">from</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal.HandOff.readResolve" title="(shard: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardCoordinator.Internal.HandOff">HandOff</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker.shard" title="String">shard</a><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.become(771101a7b6)" title="(behavior: akka.actor.Actor.Receive, discardOld: Boolean)Unit">become</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker.stoppingShard" title="=&gt; RebalanceWorker.this.Receive">stoppingShard</a>, discardOld = true<span class="delimiter">)</span>
        <span class="delimiter">}</span>
      case <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.ReceiveTimeout" title="akka.actor.ReceiveTimeout.type">ReceiveTimeout</a> ⇒ <a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker.done" title="(ok: Boolean)Unit">done</a><span title="Boolean(true)" class="delimiter">(</span>ok = false<span class="delimiter">)</span>
    <span class="delimiter">}</span>

    def <a title="=&gt; RebalanceWorker.this.Receive" id="akka.cluster.sharding.ShardCoordinator;RebalanceWorker.stoppingShard">stoppingShard</a>: <span title="RebalanceWorker.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.sharding.ShardCoordinator;RebalanceWorker.stoppingShard;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      case ShardStopped<span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding.ShardCoordinator;RebalanceWorker.stoppingShard;$anonfun.isDefinedAt.shard">shard</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker.done" title="(ok: Boolean)Unit">done</a><span title="Boolean(true)" class="delimiter">(</span>ok = true<span class="delimiter">)</span>
      case <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.ReceiveTimeout" title="akka.actor.ReceiveTimeout.type">ReceiveTimeout</a>      ⇒ <a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker.done" title="(ok: Boolean)Unit">done</a><span title="Boolean(true)" class="delimiter">(</span>ok = false<span class="delimiter">)</span>
    <span class="delimiter">}</span>

    def <a title="(ok: Boolean)Unit" id="akka.cluster.sharding.ShardCoordinator;RebalanceWorker.done">done</a><span class="delimiter">(</span><a title="Boolean" id="akka.cluster.sharding.ShardCoordinator;RebalanceWorker.done.ok">ok</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">parent</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardCoordinator.RebalanceDone.readResolve" title="(shard: akka.cluster.sharding.ShardRegion.ShardId, ok: Boolean)akka.cluster.sharding.ShardCoordinator.RebalanceDone">RebalanceDone</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker.shard" title="String">shard</a>, <a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker.done.ok" title="Boolean">ok</a><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private<span class="delimiter">[</span>akka<span class="delimiter">]</span> def <a title="(shard: String, from: akka.actor.ActorRef, handOffTimeout: scala.concurrent.duration.FiniteDuration, regions: Set[akka.actor.ActorRef])akka.actor.Props" id="akka.cluster.sharding.ShardCoordinator.rebalanceWorkerProps">rebalanceWorkerProps</a><span class="delimiter">(</span><a title="String" id="akka.cluster.sharding.ShardCoordinator.rebalanceWorkerProps.shard">shard</a>: <span title="String">String</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding.ShardCoordinator.rebalanceWorkerProps.from">from</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="scala.concurrent.duration.FiniteDuration" id="akka.cluster.sharding.ShardCoordinator.rebalanceWorkerProps.handOffTimeout">handOffTimeout</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span>,
                                         <a title="Set[akka.actor.ActorRef]" id="akka.cluster.sharding.ShardCoordinator.rebalanceWorkerProps.regions">regions</a>: <span title="Set[akka.actor.ActorRef]">Set</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a> =
    <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(b09a6a316b)" title="(creator: =&gt; akka.cluster.sharding.ShardCoordinator.RebalanceWorker)(implicit evidence$2: scala.reflect.ClassTag[akka.cluster.sharding.ShardCoordinator.RebalanceWorker])akka.actor.Props">Props</a><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[akka.cluster.sharding.ShardCoordinator.RebalanceWorker]" class="delimiter">(</span>new <a href="#akka.cluster.sharding.ShardCoordinator;RebalanceWorker" title="akka.cluster.sharding.ShardCoordinator.RebalanceWorker">RebalanceWorker</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.rebalanceWorkerProps.shard" title="String">shard</a>, <a href="#akka.cluster.sharding.ShardCoordinator.rebalanceWorkerProps.from" title="akka.actor.ActorRef">from</a>, <a href="#akka.cluster.sharding.ShardCoordinator.rebalanceWorkerProps.handOffTimeout" title="scala.concurrent.duration.FiniteDuration">handOffTimeout</a>, <a href="#akka.cluster.sharding.ShardCoordinator.rebalanceWorkerProps.regions" title="Set[akka.actor.ActorRef]">regions</a><span class="delimiter">)</span><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Singleton coordinator that decides where to allocate shards.
 *
 * @see [[ClusterSharding$ ClusterSharding extension]]
 */</span>
abstract class <a title="class ShardCoordinator extends AnyRef with akka.actor.Actor with akka.actor.ActorLogging" id="akka.cluster.sharding;ShardCoordinator">ShardCoordinator</a><a href="#akka.cluster.sharding;ShardCoordinator" title="akka.cluster.sharding.ShardCoordinator" class="delimiter">(</a><a title="String" id="akka.cluster.sharding;ShardCoordinator.typeName">typeName</a>: <span title="String">String</span>, <a title="akka.cluster.sharding.ClusterShardingSettings" id="akka.cluster.sharding;ShardCoordinator.settings">settings</a>: <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings" title="akka.cluster.sharding.ClusterShardingSettings">ClusterShardingSettings</a>,
                                <a title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy" id="akka.cluster.sharding;ShardCoordinator.allocationStrategy">allocationStrategy</a>: ShardCoordinator.<a href="#akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy" title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy">ShardAllocationStrategy</a><span class="delimiter">)</span>
  extends <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> with <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="delimiter">{</span>
  import <a href="#akka.cluster.sharding.ShardCoordinator" title="akka.cluster.sharding.ShardCoordinator.type">ShardCoordinator</a>._
  import <a href="#akka.cluster.sharding.ShardCoordinator" title="akka.cluster.sharding.ShardCoordinator.type">ShardCoordinator</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal" title="akka.cluster.sharding.ShardCoordinator.Internal.type">Internal</a>._
  import <a href="ShardRegion.scala.html#akka.cluster.sharding.ShardRegion" title="akka.cluster.sharding.ShardRegion.type">ShardRegion</a>.ShardId
  import <a href="#akka.cluster.sharding;ShardCoordinator.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>.<a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings.tuningParameters" title="=&gt; akka.cluster.sharding.ClusterShardingSettings.TuningParameters">tuningParameters</a>._

  val <a title="scala.concurrent.duration.FiniteDuration" id="akka.cluster.sharding;ShardCoordinator.removalMargin">removalMargin</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.settings" title="=&gt; akka.cluster.ClusterSettings">settings</a>.<a href="../../../../cluster/akka/cluster/ClusterSettings.scala.html#akka.cluster;ClusterSettings.DownRemovalMargin" title="=&gt; scala.concurrent.duration.FiniteDuration">DownRemovalMargin</a>

  var <a title="akka.cluster.sharding.ShardCoordinator.Internal.State" id="akka.cluster.sharding;ShardCoordinator.state_=">state</a> = <a href="#akka.cluster.sharding.ShardCoordinator.Internal.State.readResolve" title="akka.cluster.sharding.ShardCoordinator.Internal.State.type">State</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal.State.empty" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">empty</a>
  var <a title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding;ShardCoordinator.rebalanceInProgress_=">rebalanceInProgress</a> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.immutable.Set[A]">empty</span><span title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]" class="delimiter">[</span><span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span><span class="delimiter">]</span>
  var <a title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.Cancellable]" id="akka.cluster.sharding;ShardCoordinator.unAckedHostShards_=">unAckedHostShards</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.Cancellable]" class="delimiter">[</span><span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>, <a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Cancellable" title="akka.actor.Cancellable">Cancellable</a><span class="delimiter">]</span>
  <span class="comment">// regions that have requested handoff, for graceful shutdown</span>
  var <a title="scala.collection.immutable.Set[akka.actor.ActorRef]" id="akka.cluster.sharding;ShardCoordinator.gracefulShutdownInProgress_=">gracefulShutdownInProgress</a> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.immutable.Set[A]">empty</span><span title="scala.collection.immutable.Set[akka.actor.ActorRef]" class="delimiter">[</span><a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">]</span>
  var <a title="scala.collection.immutable.Set[akka.actor.ActorRef]" id="akka.cluster.sharding;ShardCoordinator.aliveRegions_=">aliveRegions</a> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.immutable.Set[A]">empty</span><span title="scala.collection.immutable.Set[akka.actor.ActorRef]" class="delimiter">[</span><a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">]</span>

  import <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher
  val <a title="akka.actor.Cancellable" id="akka.cluster.sharding;ShardCoordinator.rebalanceTask">rebalanceTask</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.schedule(abf8206fc2)" title="(initialDelay: scala.concurrent.duration.FiniteDuration, interval: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">schedule</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.rebalanceInterval" title="=&gt; scala.concurrent.duration.FiniteDuration">rebalanceInterval</a>, <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.rebalanceInterval" title="=&gt; scala.concurrent.duration.FiniteDuration">rebalanceInterval</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.cluster.sharding.ShardCoordinator.RebalanceTick.readResolve" title="akka.cluster.sharding.ShardCoordinator.RebalanceTick.type">RebalanceTick</a><span class="delimiter">)</span>

  <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.subscribe(6cfb44d410)" title="(subscriber: akka.actor.ActorRef, to: Class[_]*)Unit">subscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent.ClusterShuttingDown" title="akka.cluster.ClusterEvent.ClusterShuttingDown.type">ClusterShuttingDown</a>.<span title="()Class[_]">getClass</span><span class="delimiter">)</span>

  override def <a title="()Unit" id="akka.cluster.sharding;ShardCoordinator.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    super.<a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.postStop" title="()Unit">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#akka.cluster.sharding;ShardCoordinator.rebalanceTask" title="=&gt; akka.actor.Cancellable">rebalanceTask</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Cancellable.cancel" title="()Boolean">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.unsubscribe(134bd64d81)" title="(subscriber: akka.actor.ActorRef)Unit">unsubscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="=&gt; ShardCoordinator.this.Receive" id="akka.cluster.sharding;ShardCoordinator.active">active</a>: <span title="ShardCoordinator.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.sharding;ShardCoordinator.active;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case Register<span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;ShardRegion registered: [{}]&quot;)" class="string">&quot;ShardRegion registered: [{}]&quot;</span>, <span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardCoordinator.aliveRegions_=" title="(x$1: scala.collection.immutable.Set[akka.actor.ActorRef])Unit">aliveRegions</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">+=</span> <span title="akka.actor.ActorRef">region</span>
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">region</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal.RegisterAck.readResolve" title="(coordinator: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.RegisterAck">RegisterAck</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
      else <span class="delimiter">{</span>
        <a href="#akka.cluster.sharding;ShardCoordinator.gracefulShutdownInProgress_=" title="(x$1: scala.collection.immutable.Set[akka.actor.ActorRef])Unit">gracefulShutdownInProgress</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-=</span> <span title="akka.actor.ActorRef">region</span>
        <a href="#akka.cluster.sharding;ShardCoordinator.update" title="(evt: akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionRegistered)(f: akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionRegistered =&gt; Unit)Unit">update</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionRegistered.readResolve" title="(region: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionRegistered">ShardRegionRegistered</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span title="akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionRegistered">evt</span> ⇒
          val <a title="Boolean" id="akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.$anonfun.firstRegion">firstRegion</a> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="=&gt; Boolean">isEmpty</span>
          <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated" title="(event: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)akka.cluster.sharding.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionRegistered">evt</span><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">region</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal.RegisterAck.readResolve" title="(coordinator: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.RegisterAck">RegisterAck</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>

          if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.$anonfun.firstRegion" title="Boolean">firstRegion</a><span class="delimiter">)</span>
            <a href="#akka.cluster.sharding;ShardCoordinator.allocateShardHomes" title="()Unit">allocateShardHomes</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    case RegisterProxy<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardCoordinator.active;$anonfun.isDefinedAt.proxy">proxy</a><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;ShardRegion proxy registered: [{}]&quot;)" class="string">&quot;ShardRegion proxy registered: [{}]&quot;</span>, <a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.isDefinedAt.proxy" title="akka.actor.ActorRef">proxy</a><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.isDefinedAt.proxy" title="akka.actor.ActorRef">proxy</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">proxy</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal.RegisterAck.readResolve" title="(coordinator: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.RegisterAck">RegisterAck</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
      else <span class="delimiter">{</span>
        <a href="#akka.cluster.sharding;ShardCoordinator.update" title="(evt: akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionProxyRegistered)(f: akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionProxyRegistered =&gt; Unit)Unit">update</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionProxyRegistered.readResolve" title="(regionProxy: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionProxyRegistered">ShardRegionProxyRegistered</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.isDefinedAt.proxy" title="akka.actor.ActorRef">proxy</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span title="akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionProxyRegistered">evt</span> ⇒
          <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated" title="(event: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)akka.cluster.sharding.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionProxyRegistered">evt</span><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.isDefinedAt.proxy" title="akka.actor.ActorRef">proxy</a><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">proxy</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal.RegisterAck.readResolve" title="(coordinator: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.RegisterAck">RegisterAck</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    case <a title="akka.actor.Terminated" id="akka.cluster.sharding;ShardCoordinator.active;$anonfun.isDefinedAt.t">t</a> @ Terminated<span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span> ⇒
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.removalMargin" title="=&gt; scala.concurrent.duration.FiniteDuration">removalMargin</a> <span title="(x$1: Any)Boolean">!=</span> <span title="scala.concurrent.duration.Duration.type">Duration</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">Zero</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.isDefinedAt.t" title="akka.actor.Terminated">t</a>.<a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Terminated.addressTerminated" title="=&gt; Boolean">addressTerminated</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.cluster.sharding;ShardCoordinator.aliveRegions_=" title="(elem: akka.actor.ActorRef)Boolean">aliveRegions</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.scheduleOnce(a2d55b51db)" title="(delay: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">scheduleOnce</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="#akka.cluster.sharding;ShardCoordinator.removalMargin" title="=&gt; scala.concurrent.duration.FiniteDuration">removalMargin</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.cluster.sharding.ShardCoordinator.DelayedShardRegionTerminated.readResolve" title="(region: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.DelayedShardRegionTerminated">DelayedShardRegionTerminated</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span><span class="delimiter">)</span>
        else
          <a href="#akka.cluster.sharding;ShardCoordinator.regionTerminated" title="(ref: akka.actor.ActorRef)Unit">regionTerminated</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> else if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;ShardRegion proxy terminated: [{}]&quot;)" class="string">&quot;ShardRegion proxy terminated: [{}]&quot;</span>, <span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardCoordinator.update" title="(evt: akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionProxyTerminated)(f: akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionProxyTerminated =&gt; Unit)Unit">update</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionProxyTerminated.readResolve" title="(regionProxy: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionProxyTerminated">ShardRegionProxyTerminated</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span title="akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionProxyTerminated">evt</span> ⇒
          <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated" title="(event: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)akka.cluster.sharding.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionProxyTerminated">evt</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    case DelayedShardRegionTerminated<span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span> ⇒
      <a href="#akka.cluster.sharding;ShardCoordinator.regionTerminated" title="(ref: akka.actor.ActorRef)Unit">regionTerminated</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span>

    case GetShardHome<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> ⇒
      if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.sharding;ShardCoordinator.rebalanceInProgress_=" title="=&gt; scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">rebalanceInProgress</a>.<span title="(elem: akka.cluster.sharding.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Option[akka.actor.ActorRef]">get</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> match <span class="delimiter">{</span>
          case Some<span class="delimiter">(</span><span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span> ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal.ShardHome.readResolve" title="(shard: akka.cluster.sharding.ShardRegion.ShardId, ref: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.ShardHome">ShardHome</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <span title="akka.actor.ActorRef">ref</span><span class="delimiter">)</span>
          case <span title="None.type">None</span> ⇒
            val activeRegions = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a> <a title="scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]" id="akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.activeRegions">--</a> <a href="#akka.cluster.sharding;ShardCoordinator.gracefulShutdownInProgress_=" title="=&gt; scala.collection.immutable.Set[akka.actor.ActorRef]">gracefulShutdownInProgress</a>
            if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.activeRegions" title="scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">activeRegions</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              val <span title="akka.actor.ActorRef">getShardHomeSender</span> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>
              val <a title="scala.concurrent.Future[akka.actor.ActorRef]" id="akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.regionFuture">regionFuture</a> = <a href="#akka.cluster.sharding;ShardCoordinator.allocationStrategy" title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy">allocationStrategy</a>.<a href="#akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy.allocateShard" title="(requester: akka.actor.ActorRef, shardId: akka.cluster.sharding.ShardRegion.ShardId, currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]])scala.concurrent.Future[akka.actor.ActorRef]">allocateShard</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">getShardHomeSender</span>, <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.activeRegions" title="scala.collection.immutable.Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">activeRegions</a><span class="delimiter">)</span>
              <a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.regionFuture" title="scala.concurrent.Future[akka.actor.ActorRef]">regionFuture</a>.<span title="=&gt; Option[scala.util.Try[akka.actor.ActorRef]]">value</span> match <span class="delimiter">{</span>
                case Some<span class="delimiter">(</span>Success<span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
                  <a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome" title="(shard: akka.cluster.sharding.ShardRegion.ShardId, region: akka.actor.ActorRef, getShardHomeSender: akka.actor.ActorRef)Unit">continueGetShardHome</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <span title="akka.actor.ActorRef">region</span>, <span title="akka.actor.ActorRef">getShardHomeSender</span><span class="delimiter">)</span>
                case _ ⇒
                  <span class="comment">// continue when future is completed</span>
                  <a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.regionFuture" title="scala.concurrent.Future[akka.actor.ActorRef]">regionFuture</a>.<span title="(f: akka.actor.ActorRef =&gt; akka.cluster.sharding.ShardCoordinator.AllocateShardResult)(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[akka.cluster.sharding.ShardCoordinator.AllocateShardResult]">map</span> <a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">{</a> <a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.$anonfun.region">region</a> ⇒
                    <a href="#akka.cluster.sharding.ShardCoordinator.AllocateShardResult.readResolve" title="(shard: akka.cluster.sharding.ShardRegion.ShardId, shardRegion: Option[akka.actor.ActorRef], getShardHomeSender: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.AllocateShardResult">AllocateShardResult</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.$anonfun.region" title="akka.actor.ActorRef">region</a><span class="delimiter">)</span>, <span title="akka.actor.ActorRef">getShardHomeSender</span><span class="delimiter">)</span>
                  <span class="delimiter">}</span>.<span title="(pf: PartialFunction[Throwable,akka.cluster.sharding.ShardCoordinator.AllocateShardResult])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[akka.cluster.sharding.ShardCoordinator.AllocateShardResult]">recover</span> <a href="../../../../actor/akka/pattern/PipeToSupport.scala.html#akka.pattern;PipeToSupport.pipe" title="(future: scala.concurrent.Future[akka.cluster.sharding.ShardCoordinator.AllocateShardResult])(implicit executionContext: scala.concurrent.ExecutionContext)akka.pattern.PipeableFuture[akka.cluster.sharding.ShardCoordinator.AllocateShardResult]" class="delimiter">{</a>
                    case _ ⇒ <a href="#akka.cluster.sharding.ShardCoordinator.AllocateShardResult.readResolve" title="(shard: akka.cluster.sharding.ShardRegion.ShardId, shardRegion: Option[akka.actor.ActorRef], getShardHomeSender: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.AllocateShardResult">AllocateShardResult</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <span title="None.type">None</span>, <span title="akka.actor.ActorRef">getShardHomeSender</span><span class="delimiter">)</span>
                  <span class="delimiter">}</span>.<a href="../../../../actor/akka/pattern/PipeToSupport.scala.html#akka.pattern;PipeToSupport;PipeableFuture.pipeTo" title="(recipient: akka.actor.ActorRef)(implicit sender: akka.actor.ActorRef)scala.concurrent.Future[akka.cluster.sharding.ShardCoordinator.AllocateShardResult]">pipeTo</a><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef" class="delimiter">(</a><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    case AllocateShardResult<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <span title="None.type">None</span>, <span title="akka.actor.ActorRef">getShardHomeSender</span><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span title="Boolean(true)" class="delimiter">(</span><span title="String(&quot;Shard [{}] allocation failed. It will be retried.&quot;)" class="string">&quot;Shard [{}] allocation failed. It will be retried.&quot;</span>, <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>

    case AllocateShardResult<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, Some<span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>, <span title="akka.actor.ActorRef">getShardHomeSender</span><span class="delimiter">)</span> ⇒
      <a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome" title="(shard: akka.cluster.sharding.ShardRegion.ShardId, region: akka.actor.ActorRef, getShardHomeSender: akka.actor.ActorRef)Unit">continueGetShardHome</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <span title="akka.actor.ActorRef">region</span>, <span title="akka.actor.ActorRef">getShardHomeSender</span><span class="delimiter">)</span>

    case ShardStarted<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> ⇒
      <a href="#akka.cluster.sharding;ShardCoordinator.unAckedHostShards_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.Cancellable]">unAckedHostShards</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Option[akka.actor.Cancellable]">get</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><a title="akka.actor.Cancellable" id="akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.cancel">cancel</a><span class="delimiter">)</span> ⇒
          <a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.cancel" title="akka.actor.Cancellable">cancel</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Cancellable.cancel" title="()Boolean">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#akka.cluster.sharding;ShardCoordinator.unAckedHostShards_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.Cancellable])Unit">unAckedHostShards</a> = <a href="#akka.cluster.sharding;ShardCoordinator.unAckedHostShards_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.Cancellable]">unAckedHostShards</a> <span title="(key: akka.cluster.sharding.ShardRegion.ShardId)scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.Cancellable]">-</span> <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>
        case _ ⇒
      <span class="delimiter">}</span>

    case ResendShardHost<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
      <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Option[akka.actor.ActorRef]">get</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><span title="akka.actor.ActorRef">`region`</span><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;ShardCoordinator.sendHostShardMsg" title="(shard: akka.cluster.sharding.ShardRegion.ShardId, region: akka.actor.ActorRef)Unit">sendHostShardMsg</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>
        case _              ⇒ <span class="comment">//Reallocated to another region</span>
      <span class="delimiter">}</span>

    case <a href="#akka.cluster.sharding.ShardCoordinator.RebalanceTick.readResolve" title="akka.cluster.sharding.ShardCoordinator.RebalanceTick.type">RebalanceTick</a> ⇒
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        val <a title="scala.concurrent.Future[Set[akka.cluster.sharding.ShardRegion.ShardId]]" id="akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.shardsFuture">shardsFuture</a> = <a href="#akka.cluster.sharding;ShardCoordinator.allocationStrategy" title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy">allocationStrategy</a>.<a href="#akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy.rebalance" title="(currentShardAllocations: Map[akka.actor.ActorRef,scala.collection.immutable.IndexedSeq[akka.cluster.sharding.ShardRegion.ShardId]], rebalanceInProgress: Set[akka.cluster.sharding.ShardRegion.ShardId])scala.concurrent.Future[Set[akka.cluster.sharding.ShardRegion.ShardId]]">rebalance</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>, <a href="#akka.cluster.sharding;ShardCoordinator.rebalanceInProgress_=" title="=&gt; scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">rebalanceInProgress</a><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.shardsFuture" title="scala.concurrent.Future[Set[akka.cluster.sharding.ShardRegion.ShardId]]">shardsFuture</a>.<span title="=&gt; Option[scala.util.Try[Set[akka.cluster.sharding.ShardRegion.ShardId]]]">value</span> match <span class="delimiter">{</span>
          case Some<span class="delimiter">(</span>Success<span class="delimiter">(</span><span title="Set[akka.cluster.sharding.ShardRegion.ShardId]">shards</span><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
            <a href="#akka.cluster.sharding;ShardCoordinator.continueRebalance" title="(shards: Set[akka.cluster.sharding.ShardRegion.ShardId])Unit">continueRebalance</a><span class="delimiter">(</span><span title="Set[akka.cluster.sharding.ShardRegion.ShardId]">shards</span><span class="delimiter">)</span>
          case _ ⇒
            <span class="comment">// continue when future is completed</span>
            <a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.shardsFuture" title="scala.concurrent.Future[Set[akka.cluster.sharding.ShardRegion.ShardId]]">shardsFuture</a>.<span title="(f: Set[akka.cluster.sharding.ShardRegion.ShardId] =&gt; akka.cluster.sharding.ShardCoordinator.RebalanceResult)(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[akka.cluster.sharding.ShardCoordinator.RebalanceResult]">map</span> <a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">{</a> <a title="Set[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.$anonfun.shards">shards</a> ⇒ <a href="#akka.cluster.sharding.ShardCoordinator.RebalanceResult.readResolve" title="(shards: Set[akka.cluster.sharding.ShardRegion.ShardId])akka.cluster.sharding.ShardCoordinator.RebalanceResult">RebalanceResult</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.$anonfun.shards" title="Set[akka.cluster.sharding.ShardRegion.ShardId]">shards</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>.<span title="(pf: PartialFunction[Throwable,akka.cluster.sharding.ShardCoordinator.RebalanceResult])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[akka.cluster.sharding.ShardCoordinator.RebalanceResult]">recover</span> <a href="../../../../actor/akka/pattern/PipeToSupport.scala.html#akka.pattern;PipeToSupport.pipe" title="(future: scala.concurrent.Future[akka.cluster.sharding.ShardCoordinator.RebalanceResult])(implicit executionContext: scala.concurrent.ExecutionContext)akka.pattern.PipeableFuture[akka.cluster.sharding.ShardCoordinator.RebalanceResult]" class="delimiter">{</a>
              case _ ⇒ <a href="#akka.cluster.sharding.ShardCoordinator.RebalanceResult.readResolve" title="(shards: Set[akka.cluster.sharding.ShardRegion.ShardId])akka.cluster.sharding.ShardCoordinator.RebalanceResult">RebalanceResult</a><span title="Boolean(true)" class="delimiter">(</span><span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">empty</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>.<a href="../../../../actor/akka/pattern/PipeToSupport.scala.html#akka.pattern;PipeToSupport;PipeableFuture.pipeTo" title="(recipient: akka.actor.ActorRef)(implicit sender: akka.actor.ActorRef)scala.concurrent.Future[akka.cluster.sharding.ShardCoordinator.RebalanceResult]">pipeTo</a><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef" class="delimiter">(</a><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    case RebalanceResult<span class="delimiter">(</span><a title="Set[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding;ShardCoordinator.active;$anonfun.isDefinedAt.shards">shards</a><span class="delimiter">)</span> ⇒
      <a href="#akka.cluster.sharding;ShardCoordinator.continueRebalance" title="(shards: Set[akka.cluster.sharding.ShardRegion.ShardId])Unit">continueRebalance</a><span title="Boolean(true)" class="delimiter">(</span><span title="Set[akka.cluster.sharding.ShardRegion.ShardId]">shards</span><span class="delimiter">)</span>

    case RebalanceDone<span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <a title="Boolean" id="akka.cluster.sharding;ShardCoordinator.active;$anonfun.isDefinedAt.ok">ok</a><span class="delimiter">)</span> ⇒
      <a href="#akka.cluster.sharding;ShardCoordinator.rebalanceInProgress_=" title="(x$1: scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId])Unit">rebalanceInProgress</a> <span title="(elem: akka.cluster.sharding.ShardRegion.ShardId)scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">-=</span> <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Rebalance shard [{}] done [{}]&quot;)" class="string">&quot;Rebalance shard [{}] done [{}]&quot;</span>, <span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span>, <a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.isDefinedAt.ok" title="Boolean">ok</a><span class="delimiter">)</span>
      <span class="comment">// The shard could have been removed by ShardRegionTerminated</span>
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span>
        if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.isDefinedAt.ok" title="Boolean">ok</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#akka.cluster.sharding;ShardCoordinator.update" title="(evt: akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeDeallocated)(f: akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeDeallocated =&gt; Unit)Unit">update</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeDeallocated.readResolve" title="(shard: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeDeallocated">ShardHomeDeallocated</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span title="akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeDeallocated">evt</span> ⇒
            <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated" title="(event: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)akka.cluster.sharding.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeDeallocated">evt</span><span class="delimiter">)</span>
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Shard [{}] deallocated&quot;)" class="string">&quot;Shard [{}] deallocated&quot;</span>, <span title="akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeDeallocated">evt</span>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;ShardHomeDeallocated.shard" title="=&gt; akka.cluster.sharding.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
            <a href="#akka.cluster.sharding;ShardCoordinator.allocateShardHomes" title="()Unit">allocateShardHomes</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> else <span class="comment">// rebalance not completed, graceful shutdown will be retried</span>
          <a href="#akka.cluster.sharding;ShardCoordinator.gracefulShutdownInProgress_=" title="(x$1: scala.collection.immutable.Set[akka.actor.ActorRef])Unit">gracefulShutdownInProgress</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-=</span> <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="(key: akka.cluster.sharding.ShardRegion.ShardId)akka.actor.ActorRef">shards</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">shard</span><span class="delimiter">)</span>

    case GracefulShutdownReq<span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
      if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.sharding;ShardCoordinator.gracefulShutdownInProgress_=" title="(elem: akka.actor.ActorRef)Boolean">gracefulShutdownInProgress</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Option[Vector[akka.cluster.sharding.ShardRegion.ShardId]]">get</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> match <span class="delimiter">{</span>
          case Some<span class="delimiter">(</span><span title="Vector[akka.cluster.sharding.ShardRegion.ShardId]">shards</span><span class="delimiter">)</span> ⇒
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Graceful shutdown of region [{}] with shards [{}]&quot;)" class="string">&quot;Graceful shutdown of region [{}] with shards [{}]&quot;</span>, <span title="akka.actor.ActorRef">region</span>, <span title="Vector[akka.cluster.sharding.ShardRegion.ShardId]">shards</span><span class="delimiter">)</span>
            <a href="#akka.cluster.sharding;ShardCoordinator.gracefulShutdownInProgress_=" title="(x$1: scala.collection.immutable.Set[akka.actor.ActorRef])Unit">gracefulShutdownInProgress</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">+=</span> <span title="akka.actor.ActorRef">region</span>
            <a href="#akka.cluster.sharding;ShardCoordinator.continueRebalance" title="(shards: Set[akka.cluster.sharding.ShardRegion.ShardId])Unit">continueRebalance</a><span class="delimiter">(</span><span title="Vector[akka.cluster.sharding.ShardRegion.ShardId]">shards</span>.<span title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">toSet</span><span class="delimiter">)</span>
          case <span title="None.type">None</span> ⇒
        <span class="delimiter">}</span>

    case ShardHome<span class="delimiter">(</span>_, _<span class="delimiter">)</span> ⇒
    <span class="comment">//On rebalance, we send ourselves a GetShardHome message to reallocate a</span>
    <span class="comment">// shard. This receive handles the &quot;response&quot; from that message. i.e. ignores it.</span>

    case <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent.ClusterShuttingDown" title="akka.cluster.ClusterEvent.ClusterShuttingDown.type">ClusterShuttingDown</a> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Shutting down ShardCoordinator&quot;)" class="string">&quot;Shutting down ShardCoordinator&quot;</span><span class="delimiter">)</span>
      <span class="comment">// can't stop because supervisor will start it again,</span>
      <span class="comment">// it will soon be stopped when singleton is stopped</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.become(07b70b901c)" title="(behavior: akka.actor.Actor.Receive)Unit">become</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.shuttingDown" title="=&gt; ShardCoordinator.this.Receive">shuttingDown</a><span class="delimiter">)</span>

    case <a href="ShardRegion.scala.html#akka.cluster.sharding.ShardRegion" title="akka.cluster.sharding.ShardRegion.type">ShardRegion</a>.<a href="ShardRegion.scala.html#akka.cluster.sharding.ShardRegion.GetCurrentRegions" title="akka.cluster.sharding.ShardRegion.GetCurrentRegions.type">GetCurrentRegions</a> ⇒
      val <a title="akka.cluster.sharding.ShardRegion.CurrentRegions" id="akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.reply">reply</a> = <a href="ShardRegion.scala.html#akka.cluster.sharding.ShardRegion" title="akka.cluster.sharding.ShardRegion.type">ShardRegion</a>.<a href="ShardRegion.scala.html#akka.cluster.sharding.ShardRegion;CurrentRegions" title="(regions: Set[akka.actor.Address])akka.cluster.sharding.ShardRegion.CurrentRegions">CurrentRegions</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="=&gt; scala.collection.immutable.Set[akka.actor.ActorRef]">keySet</span>.<span title="(f: akka.actor.ActorRef =&gt; akka.actor.Address)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set[akka.actor.ActorRef],akka.actor.Address,Set[akka.actor.Address]])Set[akka.actor.Address]">map</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set.Coll,akka.actor.Address,scala.collection.immutable.Set[akka.actor.Address]]" class="delimiter">{</span> <a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.reply.$anonfun.ref">ref</a> ⇒
        if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.reply.$anonfun.ref" title="akka.actor.ActorRef">ref</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a>.<a href="../../../../actor/akka/actor/Address.scala.html#akka.actor;Address.host" title="=&gt; Option[String]">host</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.selfAddress" title="=&gt; akka.actor.Address">selfAddress</a>
        else <a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.reply.$anonfun.ref" title="akka.actor.ActorRef">ref</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.path" title="=&gt; akka.actor.ActorPath">path</a>.<a href="../../../../actor/akka/actor/ActorPath.scala.html#akka.actor;ActorPath.address" title="=&gt; akka.actor.Address">address</a>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding;ShardCoordinator.active;$anonfun.applyOrElse.reply" title="akka.cluster.sharding.ShardRegion.CurrentRegions">reply</a>

    case _: <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent;CurrentClusterState" title="akka.cluster.ClusterEvent.CurrentClusterState">CurrentClusterState</a> ⇒
  <span class="delimiter">}</span>

  def <a title="[E &lt;: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent](evt: E)(f: E =&gt; Unit)Unit" id="akka.cluster.sharding;ShardCoordinator.update">update</a><span class="delimiter">[</span><a title=" &lt;: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent" id="akka.cluster.sharding;ShardCoordinator.update;E">E</a> &lt;: DomainEvent<span class="delimiter">]</span><span class="delimiter">(</span><a title="E" id="akka.cluster.sharding;ShardCoordinator.update.evt">evt</a>: <a href="#akka.cluster.sharding;ShardCoordinator.update;E" title="E">E</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="E =&gt; Unit" id="akka.cluster.sharding;ShardCoordinator.update.f">f</a>: E ⇒ Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span>

  def <a title="(ref: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;ShardCoordinator.regionTerminated">regionTerminated</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardCoordinator.regionTerminated.ref">ref</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.regionTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;ShardRegion terminated: [{}]&quot;)" class="string">&quot;ShardRegion terminated: [{}]&quot;</span>, <a href="#akka.cluster.sharding;ShardCoordinator.regionTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="(key: akka.actor.ActorRef)Vector[akka.cluster.sharding.ShardRegion.ShardId]">regions</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.regionTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>.<span title="(f: akka.cluster.sharding.ShardRegion.ShardId =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;ShardCoordinator.regionTerminated.$anonfun.s">s</a> ⇒ <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">self</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal.GetShardHome.readResolve" title="(shard: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardCoordinator.Internal.GetShardHome">GetShardHome</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.regionTerminated.$anonfun.s" title="akka.cluster.sharding.ShardRegion.ShardId">s</a><span class="delimiter">)</span> <span class="delimiter">}</span>

      <a href="#akka.cluster.sharding;ShardCoordinator.gracefulShutdownInProgress_=" title="(x$1: scala.collection.immutable.Set[akka.actor.ActorRef])Unit">gracefulShutdownInProgress</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-=</span> <a href="#akka.cluster.sharding;ShardCoordinator.regionTerminated.ref" title="akka.actor.ActorRef">ref</a>

      <a href="#akka.cluster.sharding;ShardCoordinator.update" title="(evt: akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionTerminated)(f: akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionTerminated =&gt; Unit)Unit">update</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionTerminated.readResolve" title="(region: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionTerminated">ShardRegionTerminated</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.regionTerminated.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionTerminated" id="akka.cluster.sharding;ShardCoordinator.regionTerminated.$anonfun.evt">evt</a> ⇒
        <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated" title="(event: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)akka.cluster.sharding.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.regionTerminated.$anonfun.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.ShardRegionTerminated">evt</a><span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardCoordinator.allocateShardHomes" title="()Unit">allocateShardHomes</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  def <a title="=&gt; ShardCoordinator.this.Receive" id="akka.cluster.sharding;ShardCoordinator.shuttingDown">shuttingDown</a>: <span title="ShardCoordinator.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.sharding;ShardCoordinator.shuttingDown;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case _ ⇒ <span class="comment">// ignore all</span>
  <span class="delimiter">}</span>

  def <a title="(shard: akka.cluster.sharding.ShardRegion.ShardId, region: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;ShardCoordinator.sendHostShardMsg">sendHostShardMsg</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;ShardCoordinator.sendHostShardMsg.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardCoordinator.sendHostShardMsg.region">region</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">region</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal.HostShard.readResolve" title="(shard: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardCoordinator.Internal.HostShard">HostShard</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.sendHostShardMsg.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
    val <a title="akka.actor.Cancellable" id="akka.cluster.sharding;ShardCoordinator.sendHostShardMsg.cancel">cancel</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.scheduleOnce(a2d55b51db)" title="(delay: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">scheduleOnce</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.shardStartTimeout" title="=&gt; scala.concurrent.duration.FiniteDuration">shardStartTimeout</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.cluster.sharding.ShardCoordinator.ResendShardHost.readResolve" title="(shard: akka.cluster.sharding.ShardRegion.ShardId, region: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.ResendShardHost">ResendShardHost</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.sendHostShardMsg.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a>, <a href="#akka.cluster.sharding;ShardCoordinator.sendHostShardMsg.region" title="akka.actor.ActorRef">region</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#akka.cluster.sharding;ShardCoordinator.unAckedHostShards_=" title="(x$1: scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.Cancellable])Unit">unAckedHostShards</a> = <a href="#akka.cluster.sharding;ShardCoordinator.unAckedHostShards_=" title="=&gt; scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.Cancellable]">unAckedHostShards</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId, value: akka.actor.Cancellable)scala.collection.immutable.Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.Cancellable]">updated</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.sendHostShardMsg.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a>, <a href="#akka.cluster.sharding;ShardCoordinator.sendHostShardMsg.cancel" title="akka.actor.Cancellable">cancel</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="()Unit" id="akka.cluster.sharding;ShardCoordinator.allocateShardHomes">allocateShardHomes</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$4" title="=&gt; Set[akka.cluster.sharding.ShardRegion.ShardId]">unallocatedShards</a>.<span title="(f: akka.cluster.sharding.ShardRegion.ShardId =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">self</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal.GetShardHome.readResolve" title="(shard: akka.cluster.sharding.ShardRegion.ShardId)akka.cluster.sharding.ShardCoordinator.Internal.GetShardHome">GetShardHome</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.allocateShardHomes.$anonfun.x$6" title="akka.cluster.sharding.ShardRegion.ShardId">_</a><span class="delimiter">)</span> <span class="delimiter">}</span>

  def <a title="(shard: akka.cluster.sharding.ShardRegion.ShardId, region: akka.actor.ActorRef, getShardHomeSender: akka.actor.ActorRef)Unit" id="akka.cluster.sharding;ShardCoordinator.continueGetShardHome">continueGetShardHome</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;ShardCoordinator.continueGetShardHome.shard">shard</a>: <span title="akka.cluster.sharding.ShardRegion.ShardId">ShardId</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardCoordinator.continueGetShardHome.region">region</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardCoordinator.continueGetShardHome.getShardHomeSender">getShardHomeSender</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.sharding;ShardCoordinator.rebalanceInProgress_=" title="=&gt; scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">rebalanceInProgress</a>.<span title="(elem: akka.cluster.sharding.ShardRegion.ShardId)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Option[akka.actor.ActorRef]">get</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardCoordinator.continueGetShardHome.ref">ref</a><span class="delimiter">)</span> ⇒ <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">getShardHomeSender</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal.ShardHome.readResolve" title="(shard: akka.cluster.sharding.ShardRegion.ShardId, ref: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.ShardHome">ShardHome</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a>, <a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
        case <span title="None.type">None</span> ⇒
          if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.region" title="akka.actor.ActorRef">region</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#akka.cluster.sharding;ShardCoordinator.gracefulShutdownInProgress_=" title="=&gt; scala.collection.immutable.Set[akka.actor.ActorRef]">gracefulShutdownInProgress</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.region" title="akka.actor.ActorRef">region</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#akka.cluster.sharding;ShardCoordinator.update" title="(evt: akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeAllocated)(f: akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeAllocated =&gt; Unit)Unit">update</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeAllocated.readResolve" title="(shard: akka.cluster.sharding.ShardRegion.ShardId, region: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeAllocated">ShardHomeAllocated</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a>, <a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.region" title="akka.actor.ActorRef">region</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeAllocated" id="akka.cluster.sharding;ShardCoordinator.continueGetShardHome.$anonfun.evt">evt</a> ⇒
              <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated" title="(event: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)akka.cluster.sharding.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.$anonfun.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeAllocated">evt</a><span class="delimiter">)</span>
              <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Shard [{}] allocated at [{}]&quot;)" class="string">&quot;Shard [{}] allocated at [{}]&quot;</span>, <a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.$anonfun.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeAllocated">evt</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;ShardHomeAllocated.shard" title="=&gt; akka.cluster.sharding.ShardRegion.ShardId">shard</a>, <a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.$anonfun.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeAllocated">evt</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;ShardHomeAllocated.region" title="=&gt; akka.actor.ActorRef">region</a><span class="delimiter">)</span>

              <a href="#akka.cluster.sharding;ShardCoordinator.sendHostShardMsg" title="(shard: akka.cluster.sharding.ShardRegion.ShardId, region: akka.actor.ActorRef)Unit">sendHostShardMsg</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.$anonfun.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeAllocated">evt</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;ShardHomeAllocated.shard" title="=&gt; akka.cluster.sharding.ShardRegion.ShardId">shard</a>, <a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.$anonfun.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeAllocated">evt</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;ShardHomeAllocated.region" title="=&gt; akka.actor.ActorRef">region</a><span class="delimiter">)</span>
              <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">getShardHomeSender</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.cluster.sharding.ShardCoordinator.Internal.ShardHome.readResolve" title="(shard: akka.cluster.sharding.ShardRegion.ShardId, ref: akka.actor.ActorRef)akka.cluster.sharding.ShardCoordinator.Internal.ShardHome">ShardHome</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.$anonfun.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeAllocated">evt</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;ShardHomeAllocated.shard" title="=&gt; akka.cluster.sharding.ShardRegion.ShardId">shard</a>, <a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.$anonfun.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeAllocated">evt</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;ShardHomeAllocated.region" title="=&gt; akka.actor.ActorRef">region</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> else
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(6c666e4343)" title="(template: String, arg1: Any, arg2: Any, arg3: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Allocated region {} for shard [{}] is not (any longer) one of the registered regions: {}&quot;)" class="string">&quot;Allocated region {} for shard [{}] is not (any longer) one of the registered regions: {}&quot;</span>,
              <a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.region" title="akka.actor.ActorRef">region</a>, <a href="#akka.cluster.sharding;ShardCoordinator.continueGetShardHome.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a>, <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  def <a title="(shards: Set[akka.cluster.sharding.ShardRegion.ShardId])Unit" id="akka.cluster.sharding;ShardCoordinator.continueRebalance">continueRebalance</a><span class="delimiter">(</span><a title="Set[akka.cluster.sharding.ShardRegion.ShardId]" id="akka.cluster.sharding;ShardCoordinator.continueRebalance.shards">shards</a>: <span title="Set[akka.cluster.sharding.ShardRegion.ShardId]">Set</span><span class="delimiter">[</span>ShardId<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.cluster.sharding;ShardCoordinator.continueRebalance.shards" title="Set[akka.cluster.sharding.ShardRegion.ShardId]">shards</a>.<span title="(f: akka.cluster.sharding.ShardRegion.ShardId =&gt; Any)Unit">foreach</span> <span class="delimiter">{</span> <a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;ShardCoordinator.continueRebalance.$anonfun.shard">shard</a> ⇒
      if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.cluster.sharding;ShardCoordinator.rebalanceInProgress_=" title="(elem: akka.cluster.sharding.ShardRegion.ShardId)Boolean">rebalanceInProgress</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.continueRebalance.$anonfun.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(key: akka.cluster.sharding.ShardRegion.ShardId)Option[akka.actor.ActorRef]">get</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.continueRebalance.$anonfun.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
          case Some<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.cluster.sharding;ShardCoordinator.continueRebalance.$anonfun.rebalanceFromRegion">rebalanceFromRegion</a><span class="delimiter">)</span> ⇒
            <a href="#akka.cluster.sharding;ShardCoordinator.rebalanceInProgress_=" title="(x$1: scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId])Unit">rebalanceInProgress</a> <span title="(elem: akka.cluster.sharding.ShardRegion.ShardId)scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId]">+=</span> <a href="#akka.cluster.sharding;ShardCoordinator.continueRebalance.$anonfun.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a>
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Rebalance shard [{}] from [{}]&quot;)" class="string">&quot;Rebalance shard [{}] from [{}]&quot;</span>, <a href="#akka.cluster.sharding;ShardCoordinator.continueRebalance.$anonfun.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a>, <a href="#akka.cluster.sharding;ShardCoordinator.continueRebalance.$anonfun.rebalanceFromRegion" title="akka.actor.ActorRef">rebalanceFromRegion</a><span class="delimiter">)</span>
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(59f1e43182)" title="(props: akka.actor.Props)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span><a href="#akka.cluster.sharding.ShardCoordinator.rebalanceWorkerProps" title="(shard: String, from: akka.actor.ActorRef, handOffTimeout: scala.concurrent.duration.FiniteDuration, regions: Set[akka.actor.ActorRef])akka.actor.Props">rebalanceWorkerProps</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.continueRebalance.$anonfun.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a>, <a href="#akka.cluster.sharding;ShardCoordinator.continueRebalance.$anonfun.rebalanceFromRegion" title="akka.actor.ActorRef">rebalanceFromRegion</a>, <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.handOffTimeout" title="=&gt; scala.concurrent.duration.FiniteDuration">handOffTimeout</a>,
              <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="=&gt; scala.collection.immutable.Set[akka.actor.ActorRef]">keySet</span> <span title="(elems: scala.collection.GenTraversableOnce[akka.actor.ActorRef])scala.collection.immutable.Set[akka.actor.ActorRef]">++</span> <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a><span class="delimiter">)</span>
              .<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.withDispatcher" title="(d: String)akka.actor.Props">withDispatcher</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.props" title="=&gt; akka.actor.Props">props</a>.<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.dispatcher" title="=&gt; String">dispatcher</a><span class="delimiter">)</span><span class="delimiter">)</span>
          case <span title="None.type">None</span> ⇒
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Rebalance of non-existing shard [{}] is ignored&quot;)" class="string">&quot;Rebalance of non-existing shard [{}] is ignored&quot;</span>, <a href="#akka.cluster.sharding;ShardCoordinator.continueRebalance.$anonfun.shard" title="akka.cluster.sharding.ShardRegion.ShardId">shard</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Singleton coordinator that decides where to allocate shards.
 *
 * @see [[ClusterSharding$ ClusterSharding extension]]
 */</span>
class <a title="class PersistentShardCoordinator extends akka.cluster.sharding.ShardCoordinator with akka.persistence.PersistentActor" id="akka.cluster.sharding;PersistentShardCoordinator">PersistentShardCoordinator</a><a href="#akka.cluster.sharding;PersistentShardCoordinator" title="akka.cluster.sharding.PersistentShardCoordinator" class="delimiter">(</a><a title="String" id="akka.cluster.sharding;PersistentShardCoordinator.typeName">typeName</a>: <span title="String">String</span>, <a title="akka.cluster.sharding.ClusterShardingSettings" id="akka.cluster.sharding;PersistentShardCoordinator.settings">settings</a>: <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings" title="akka.cluster.sharding.ClusterShardingSettings">ClusterShardingSettings</a>,
                                 <a title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy" id="akka.cluster.sharding;PersistentShardCoordinator.allocationStrategy">allocationStrategy</a>: ShardCoordinator.<a href="#akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy" title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy">ShardAllocationStrategy</a><span class="delimiter">)</span>
  extends <a href="#akka.cluster.sharding;ShardCoordinator" title="akka.cluster.sharding.ShardCoordinator">ShardCoordinator</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShardCoordinator.typeName" title="String">typeName</a>, <a href="#akka.cluster.sharding;PersistentShardCoordinator.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>, <a href="#akka.cluster.sharding;PersistentShardCoordinator.allocationStrategy" title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy">allocationStrategy</a><span class="delimiter">)</span> with <a href="../../../../persistence/akka/persistence/PersistentActor.scala.html#akka.persistence;PersistentActor" title="akka.persistence.PersistentActor">PersistentActor</a> <span class="delimiter">{</span>
  import <a href="#akka.cluster.sharding.ShardCoordinator" title="akka.cluster.sharding.ShardCoordinator.type">ShardCoordinator</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal" title="akka.cluster.sharding.ShardCoordinator.Internal.type">Internal</a>._
  import <a href="#akka.cluster.sharding;PersistentShardCoordinator.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>.<a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings.tuningParameters" title="=&gt; akka.cluster.sharding.ClusterShardingSettings.TuningParameters">tuningParameters</a>._

  override def <a title="=&gt; String" id="akka.cluster.sharding;PersistentShardCoordinator.persistenceId">persistenceId</a> = <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;/sharding/&quot;)">/sharding/$</span><span class="delimiter">{</span><a href="#akka.cluster.sharding;PersistentShardCoordinator.typeName" title="String">typeName</a><span class="delimiter">}</span><span title="String(&quot;Coordinator&quot;)" class="string">Coordinator&quot;</span>

  override def <a title="=&gt; String" id="akka.cluster.sharding;PersistentShardCoordinator.journalPluginId">journalPluginId</a>: <span title="String">String</span> = <a href="#akka.cluster.sharding;PersistentShardCoordinator.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>.<a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings.journalPluginId" title="=&gt; String">journalPluginId</a>

  override def <a title="=&gt; String" id="akka.cluster.sharding;PersistentShardCoordinator.snapshotPluginId">snapshotPluginId</a>: <span title="String">String</span> = <a href="#akka.cluster.sharding;PersistentShardCoordinator.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>.<a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings.snapshotPluginId" title="=&gt; String">snapshotPluginId</a>

  var <a title="Int" id="akka.cluster.sharding;PersistentShardCoordinator.persistCount_=">persistCount</a> = <span title="Int(0)" class="int">0</span>

  override def <a title="=&gt; PersistentShardCoordinator.this.Receive" id="akka.cluster.sharding;PersistentShardCoordinator.receiveRecover">receiveRecover</a>: <span title="PersistentShardCoordinator.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case <a title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent" id="akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt">evt</a>: <a href="#akka.cluster.sharding.ShardCoordinator.Internal;DomainEvent" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">DomainEvent</a> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;receiveRecover {}&quot;)" class="string">&quot;receiveRecover {}&quot;</span>, <a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">evt</a> match <span class="delimiter">{</span>
        case ShardRegionRegistered<span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
          <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated" title="(event: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)akka.cluster.sharding.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
        case ShardRegionProxyRegistered<span class="delimiter">(</span><span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span> ⇒
          <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated" title="(event: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)akka.cluster.sharding.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
        case ShardRegionTerminated<span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
          if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(key: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated" title="(event: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)akka.cluster.sharding.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
          else <span class="delimiter">{</span>
            <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span class="string">&quot;ShardRegionTerminated, but region {} was not registered. This inconsistency is due to that &quot;</span> +
              <span class="string">&quot; some stored ActorRef in Akka v2.3.0 and v2.3.1 did not contain full address information. It will be &quot;</span> <span title="String(&quot;ShardRegionTerminated, but region {} was not registered. This inconsistency is due to that  some stored ActorRef in Akka v2.3.0 and v2.3.1 did not contain full address information. It will be removed by later watch.&quot;)">+</span>
              <span class="string">&quot;removed by later watch.&quot;</span>, <span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        case ShardRegionProxyTerminated<span class="delimiter">(</span><span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span> ⇒
          if <span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><span title="akka.actor.ActorRef">proxy</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated" title="(event: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)akka.cluster.sharding.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
        case ShardHomeAllocated<span class="delimiter">(</span><a title="akka.cluster.sharding.ShardRegion.ShardId" id="akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.applyOrElse.shard">shard</a>, <span title="akka.actor.ActorRef">region</span><span class="delimiter">)</span> ⇒
          <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated" title="(event: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)akka.cluster.sharding.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
        case _: <a href="#akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeDeallocated.readResolve" title="akka.cluster.sharding.ShardCoordinator.Internal.ShardHomeDeallocated">ShardHomeDeallocated</a> ⇒
          <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated" title="(event: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)akka.cluster.sharding.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    case SnapshotOffer<span class="delimiter">(</span>_, <a title="akka.cluster.sharding.ShardCoordinator.Internal.State" id="akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.st">st</a>: <a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.equals" title="akka.cluster.sharding.ShardCoordinator.Internal.State">State</a><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;receiveRecover SnapshotOffer {}&quot;)" class="string">&quot;receiveRecover SnapshotOffer {}&quot;</span>, <a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.st" title="akka.cluster.sharding.ShardCoordinator.Internal.State">st</a><span class="delimiter">)</span>
      <span class="comment">//Old versions of the state object may not have unallocatedShard set,</span>
      <span class="comment">// thus it will be null.</span>
      if <span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.st" title="akka.cluster.sharding.ShardCoordinator.Internal.State">st</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$4" title="=&gt; Set[akka.cluster.sharding.ShardRegion.ShardId]">unallocatedShards</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span>
        <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.st" title="akka.cluster.sharding.ShardCoordinator.Internal.State">st</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.applyOrElse.x$34">copy</a><span class="delimiter">(</span>unallocatedShards = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<a title="scala.collection.immutable.Set[akka.cluster.sharding.ShardRegion.ShardId] @scala.reflect.internal.annotations.uncheckedBounds" id="akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.applyOrElse.x$31">empty</a><span class="delimiter">)</span>
      else
        <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.isDefinedAt.st" title="akka.cluster.sharding.ShardCoordinator.Internal.State">st</a>

    case <a href="../../../../persistence/akka/persistence/PersistentActor.scala.html#akka.persistence.RecoveryCompleted" title="akka.persistence.RecoveryCompleted.type">RecoveryCompleted</a> ⇒
      <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a>.<span title="(f: akka.actor.ActorRef =&gt; akka.actor.ActorRef)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(f: ((akka.actor.ActorRef, Vector[akka.cluster.sharding.ShardRegion.ShardId])) =&gt; akka.actor.ActorRef)Unit">foreach</span> <a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.applyOrElse.$anonfun.x0$3" title="akka.actor.ActorRef" class="delimiter">{</a> case <span class="delimiter">(</span><span title="akka.actor.ActorRef">a</span>, _<span class="delimiter">)</span> ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">a</span><span class="delimiter">)</span> <span class="delimiter">}</span>
      <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(f: ((akka.cluster.sharding.ShardRegion.ShardId, akka.actor.ActorRef)) =&gt; Unit)Unit">foreach</span> <a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.applyOrElse.$anonfun.x0$4" title="Unit" class="delimiter">{</a> case <span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">a</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.applyOrElse.$anonfun.r">r</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;ShardCoordinator.sendHostShardMsg" title="(shard: akka.cluster.sharding.ShardRegion.ShardId, region: akka.actor.ActorRef)Unit">sendHostShardMsg</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">a</span>, <a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveRecover;$anonfun.applyOrElse.$anonfun.r" title="akka.actor.ActorRef">r</a><span class="delimiter">)</span> <span class="delimiter">}</span>
      <a href="#akka.cluster.sharding;ShardCoordinator.allocateShardHomes" title="()Unit">allocateShardHomes</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  override def <a title="=&gt; PersistentShardCoordinator.this.Receive" id="akka.cluster.sharding;PersistentShardCoordinator.receiveCommand">receiveCommand</a>: <span title="PersistentShardCoordinator.this.Receive">Receive</span> = <a href="#akka.cluster.sharding;ShardCoordinator.active" title="=&gt; PersistentShardCoordinator.this.Receive">active</a> <span title="(that: PartialFunction[Any,Unit])PartialFunction[Any,Unit]">orElse</span> <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.sharding;PersistentShardCoordinator.receiveCommand;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case SaveSnapshotSuccess<span class="delimiter">(</span>_<span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(cc2e600322)" title="(message: String)Unit">debug</a><span title="Boolean(true)" class="delimiter">(</span><span title="String(&quot;Persistent snapshot saved successfully&quot;)" class="string">&quot;Persistent snapshot saved successfully&quot;</span><span class="delimiter">)</span>

    case SaveSnapshotFailure<span class="delimiter">(</span>_, <a title="Throwable" id="akka.cluster.sharding;PersistentShardCoordinator.receiveCommand;$anonfun.isDefinedAt.reason">reason</a><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.warning(dc73c33c91)" title="(template: String, arg1: Any)Unit">warning</a><span title="Boolean(true)" class="delimiter">(</span><span title="String(&quot;Persistent snapshot failure: {}&quot;)" class="string">&quot;Persistent snapshot failure: {}&quot;</span>, <a href="#akka.cluster.sharding;PersistentShardCoordinator.receiveCommand;$anonfun.isDefinedAt.reason" title="Throwable">reason</a>.<span title="()String">getMessage</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="[E &lt;: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent](evt: E)(f: E =&gt; Unit)Unit" id="akka.cluster.sharding;PersistentShardCoordinator.update">update</a><span class="delimiter">[</span><a title=" &lt;: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent" id="akka.cluster.sharding;PersistentShardCoordinator.update;E">E</a> &lt;: DomainEvent<span class="delimiter">]</span><span class="delimiter">(</span><a title="E" id="akka.cluster.sharding;PersistentShardCoordinator.update.evt">evt</a>: <a href="#akka.cluster.sharding;PersistentShardCoordinator.update;E" title="E">E</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="E =&gt; Unit" id="akka.cluster.sharding;PersistentShardCoordinator.update.f">f</a>: E ⇒ Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.sharding;PersistentShardCoordinator.saveSnapshotWhenNeeded" title="()Unit">saveSnapshotWhenNeeded</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="../../../../persistence/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.persist(aa368cf4a0)" title="(event: E)(handler: E =&gt; Unit)Unit">persist</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShardCoordinator.update.evt" title="E">evt</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShardCoordinator.update.f" title="E =&gt; Unit">f</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="()Unit" id="akka.cluster.sharding;PersistentShardCoordinator.saveSnapshotWhenNeeded">saveSnapshotWhenNeeded</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.sharding;PersistentShardCoordinator.persistCount_=" title="(x$1: Int)Unit">persistCount</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
    if <span class="delimiter">(</span><a href="#akka.cluster.sharding;PersistentShardCoordinator.persistCount_=" title="=&gt; Int">persistCount</a> <span title="(x: Int)Int">%</span> <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.snapshotAfter" title="=&gt; Int">snapshotAfter</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;Saving snapshot, sequence number [{}]&quot;)" class="string">&quot;Saving snapshot, sequence number [{}]&quot;</span>, <a href="../../../../persistence/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.snapshotSequenceNr" title="=&gt; Long">snapshotSequenceNr</a><span class="delimiter">)</span>
      <a href="../../../../persistence/akka/persistence/Snapshotter.scala.html#akka.persistence;Snapshotter.saveSnapshot" title="(snapshot: Any)Unit">saveSnapshot</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Singleton coordinator (with state based on ddata) that decides where to allocate shards.
 *
 * @see [[ClusterSharding$ ClusterSharding extension]]
 */</span>
class <a title="class DDataShardCoordinator extends akka.cluster.sharding.ShardCoordinator with akka.actor.Stash" id="akka.cluster.sharding;DDataShardCoordinator">DDataShardCoordinator</a><a href="#akka.cluster.sharding;DDataShardCoordinator" title="akka.cluster.sharding.DDataShardCoordinator" class="delimiter">(</a><a title="String" id="akka.cluster.sharding;DDataShardCoordinator.typeName">typeName</a>: <span title="String">String</span>, <a title="akka.cluster.sharding.ClusterShardingSettings" id="akka.cluster.sharding;DDataShardCoordinator.settings">settings</a>: <a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings" title="akka.cluster.sharding.ClusterShardingSettings">ClusterShardingSettings</a>,
                            <a title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy" id="akka.cluster.sharding;DDataShardCoordinator.allocationStrategy">allocationStrategy</a>: ShardCoordinator.<a href="#akka.cluster.sharding.ShardCoordinator;ShardAllocationStrategy" title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy">ShardAllocationStrategy</a>,
                            <a title="akka.actor.ActorRef" id="akka.cluster.sharding;DDataShardCoordinator.replicator">replicator</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>
  extends <a href="#akka.cluster.sharding;ShardCoordinator" title="akka.cluster.sharding.ShardCoordinator">ShardCoordinator</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.typeName" title="String">typeName</a>, <a href="#akka.cluster.sharding;DDataShardCoordinator.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>, <a href="#akka.cluster.sharding;DDataShardCoordinator.allocationStrategy" title="akka.cluster.sharding.ShardCoordinator.ShardAllocationStrategy">allocationStrategy</a><span class="delimiter">)</span> with <a href="../../../../actor/akka/actor/Stash.scala.html#akka.actor;Stash" title="akka.actor.Stash">Stash</a> <span class="delimiter">{</span>
  import <a href="#akka.cluster.sharding.ShardCoordinator" title="akka.cluster.sharding.ShardCoordinator.type">ShardCoordinator</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal" title="akka.cluster.sharding.ShardCoordinator.Internal.type">Internal</a>._
  import akka.cluster.ddata.<a href="../../../../distributed-data-experimental/akka/cluster/ddata/Replicator.scala.html#akka.cluster.ddata.Replicator" title="akka.cluster.ddata.Replicator.type">Replicator</a>.Update

  val <a title="scala.concurrent.duration.FiniteDuration" id="akka.cluster.sharding;DDataShardCoordinator.waitingForStateTimeout">waitingForStateTimeout</a> = <a href="#akka.cluster.sharding;DDataShardCoordinator.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>.<a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings.tuningParameters" title="=&gt; akka.cluster.sharding.ClusterShardingSettings.TuningParameters">tuningParameters</a>.<a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.waitingForStateTimeout" title="=&gt; scala.concurrent.duration.FiniteDuration">waitingForStateTimeout</a>
  val <a title="scala.concurrent.duration.FiniteDuration" id="akka.cluster.sharding;DDataShardCoordinator.updatingStateTimeout">updatingStateTimeout</a> = <a href="#akka.cluster.sharding;DDataShardCoordinator.settings" title="akka.cluster.sharding.ClusterShardingSettings">settings</a>.<a href="ClusterShardingSettings.scala.html#akka.cluster.sharding;ClusterShardingSettings.tuningParameters" title="=&gt; akka.cluster.sharding.ClusterShardingSettings.TuningParameters">tuningParameters</a>.<a href="ClusterShardingSettings.scala.html#akka.cluster.sharding.ClusterShardingSettings;TuningParameters.updatingStateTimeout" title="=&gt; scala.concurrent.duration.FiniteDuration">updatingStateTimeout</a>

  <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>.<a href="../../../../cluster/akka/cluster/Cluster.scala.html#akka.cluster;Cluster.subscribe(6cfb44d410)" title="(subscriber: akka.actor.ActorRef, to: Class[_]*)Unit">subscribe</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="../../../../cluster/akka/cluster/ClusterEvent.scala.html#akka.cluster.ClusterEvent.ClusterShuttingDown" title="akka.cluster.ClusterEvent.ClusterShuttingDown.type">ClusterShuttingDown</a>.<span title="()Class[_]">getClass</span><span class="delimiter">)</span>

  implicit val <a title="akka.cluster.Cluster" id="akka.cluster.sharding;DDataShardCoordinator.node">node</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.cluster.Cluster">Cluster</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>
  val <a title="akka.cluster.ddata.LWWRegisterKey[akka.cluster.sharding.ShardCoordinator.Internal.State]" id="akka.cluster.sharding;DDataShardCoordinator.CoordinatorStateKey">CoordinatorStateKey</a> = <a href="../../../../distributed-data-experimental/akka/cluster/ddata/LWWRegister.scala.html#akka.cluster.ddata;LWWRegisterKey" title="[A](_id: String)akka.cluster.ddata.LWWRegisterKey[A]">LWWRegisterKey</a><span title="(_id: String)akka.cluster.ddata.LWWRegisterKey[akka.cluster.sharding.ShardCoordinator.Internal.State]" class="delimiter">[</span><a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.equals" title="akka.cluster.sharding.ShardCoordinator.Internal.State">State</a><span class="delimiter">]</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;&quot;)">$</span><span class="delimiter">{</span><a href="#akka.cluster.sharding;DDataShardCoordinator.typeName" title="String">typeName</a><span class="delimiter">}</span><span title="String(&quot;CoordinatorState&quot;)" class="string">CoordinatorState&quot;</span><span class="delimiter">)</span>

  var <a title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent =&gt; Unit" id="akka.cluster.sharding;DDataShardCoordinator.afterUpdateCallback_=">afterUpdateCallback</a>: DomainEvent ⇒ Unit = _

  <a href="#akka.cluster.sharding;DDataShardCoordinator.getState" title="()Unit">getState</a><span class="delimiter">(</span><span class="delimiter">)</span>

  override def <a title="=&gt; DDataShardCoordinator.this.Receive" id="akka.cluster.sharding;DDataShardCoordinator.receive">receive</a>: <span title="DDataShardCoordinator.this.Receive">Receive</span> = <a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForState" title="=&gt; DDataShardCoordinator.this.Receive">waitingForState</a>

  <span class="comment">// This state will drop all other messages since they will be retried</span>
  def <a title="=&gt; DDataShardCoordinator.this.Receive" id="akka.cluster.sharding;DDataShardCoordinator.waitingForState">waitingForState</a>: <span title="DDataShardCoordinator.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.sharding;DDataShardCoordinator.waitingForState;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case <a title="akka.cluster.ddata.Replicator.GetSuccess[akka.cluster.ddata.ReplicatedData]" id="akka.cluster.sharding;DDataShardCoordinator.waitingForState;$anonfun.isDefinedAt.g">g</a> @ GetSuccess<span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.CoordinatorStateKey" title="=&gt; akka.cluster.ddata.LWWRegisterKey[akka.cluster.sharding.ShardCoordinator.Internal.State]">CoordinatorStateKey</a>, _<span class="delimiter">)</span> ⇒
      <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.State)Unit">state</a> = <a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForState;$anonfun.isDefinedAt.g" title="akka.cluster.ddata.Replicator.GetSuccess[akka.cluster.ddata.ReplicatedData]">g</a>.<a href="../../../../distributed-data-experimental/akka/cluster/ddata/Replicator.scala.html#akka.cluster.ddata.Replicator;GetSuccess.get" title="(key: akka.cluster.ddata.Key[akka.cluster.ddata.LWWRegister[akka.cluster.sharding.ShardCoordinator.Internal.State]])akka.cluster.ddata.LWWRegister[akka.cluster.sharding.ShardCoordinator.Internal.State]">get</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.CoordinatorStateKey" title="=&gt; akka.cluster.ddata.LWWRegisterKey[akka.cluster.sharding.ShardCoordinator.Internal.State]">CoordinatorStateKey</a><span class="delimiter">)</span>.<a href="../../../../distributed-data-experimental/akka/cluster/ddata/LWWRegister.scala.html#akka.cluster.ddata;LWWRegister.value" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">value</a>
      <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$3" title="=&gt; Set[akka.actor.ActorRef]">regionProxies</a>.<span title="(f: akka.actor.ActorRef =&gt; akka.actor.ActorRef)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$2" title="=&gt; Map[akka.actor.ActorRef,Vector[akka.cluster.sharding.ShardRegion.ShardId]]">regions</a>.<span title="(f: ((akka.actor.ActorRef, Vector[akka.cluster.sharding.ShardRegion.ShardId])) =&gt; akka.actor.ActorRef)Unit">foreach</span> <a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForState;$anonfun.applyOrElse.$anonfun.x0$5" title="akka.actor.ActorRef" class="delimiter">{</a> case <span class="delimiter">(</span><span title="akka.actor.ActorRef">a</span>, _<span class="delimiter">)</span> ⇒ <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.watch" title="(subject: akka.actor.ActorRef)akka.actor.ActorRef">watch</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">a</span><span class="delimiter">)</span> <span class="delimiter">}</span>
      <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.copy$default$1" title="=&gt; Map[akka.cluster.sharding.ShardRegion.ShardId,akka.actor.ActorRef]">shards</a>.<span title="(f: ((akka.cluster.sharding.ShardRegion.ShardId, akka.actor.ActorRef)) =&gt; Unit)Unit">foreach</span> <a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForState;$anonfun.applyOrElse.$anonfun.x0$6" title="Unit" class="delimiter">{</a> case <span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">a</span>, <a title="akka.actor.ActorRef" id="akka.cluster.sharding;DDataShardCoordinator.waitingForState;$anonfun.applyOrElse.$anonfun.r">r</a><span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;ShardCoordinator.sendHostShardMsg" title="(shard: akka.cluster.sharding.ShardRegion.ShardId, region: akka.actor.ActorRef)Unit">sendHostShardMsg</a><span class="delimiter">(</span><span title="akka.cluster.sharding.ShardRegion.ShardId">a</span>, <a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForState;$anonfun.applyOrElse.$anonfun.r" title="akka.actor.ActorRef">r</a><span class="delimiter">)</span> <span class="delimiter">}</span>
      <a href="#akka.cluster.sharding;ShardCoordinator.allocateShardHomes" title="()Unit">allocateShardHomes</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;DDataShardCoordinator.activate" title="()Unit">activate</a><span class="delimiter">(</span><span class="delimiter">)</span>

    case GetFailure<span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.CoordinatorStateKey" title="=&gt; akka.cluster.ddata.LWWRegisterKey[akka.cluster.sharding.ShardCoordinator.Internal.State]">CoordinatorStateKey</a>, _<span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.error(dc73c33c91)" title="(template: String, arg1: Any)Unit">error</a><span class="delimiter">(</span>
        <span title="String(&quot;The ShardCoordinator was unable to get an initial state within \'waiting-for-state-timeout\' (was retrying): {} millis&quot;)" class="string">&quot;The ShardCoordinator was unable to get an initial state within 'waiting-for-state-timeout' (was retrying): {} millis&quot;</span>,
        <a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForStateTimeout" title="=&gt; scala.concurrent.duration.FiniteDuration">waitingForStateTimeout</a>.<span title="=&gt; Long">toMillis</span><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;DDataShardCoordinator.getState" title="()Unit">getState</a><span class="delimiter">(</span><span class="delimiter">)</span>

    case NotFound<span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.CoordinatorStateKey" title="=&gt; akka.cluster.ddata.LWWRegisterKey[akka.cluster.sharding.ShardCoordinator.Internal.State]">CoordinatorStateKey</a>, _<span class="delimiter">)</span> ⇒ <a href="#akka.cluster.sharding;DDataShardCoordinator.activate" title="()Unit">activate</a><span title="Boolean(true)" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="[E &lt;: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent](evt: E)DDataShardCoordinator.this.Receive" id="akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate">waitingForUpdate</a><span class="delimiter">[</span><a title=" &lt;: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent" id="akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate;E">E</a> &lt;: DomainEvent<span class="delimiter">]</span><span class="delimiter">(</span><a title="E" id="akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate.evt">evt</a>: <a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate;E" title="E">E</a><span class="delimiter">)</span>: <span title="DDataShardCoordinator.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case UpdateSuccess<span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.CoordinatorStateKey" title="=&gt; akka.cluster.ddata.LWWRegisterKey[akka.cluster.sharding.ShardCoordinator.Internal.State]">CoordinatorStateKey</a>, Some<span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate.evt" title="E">`evt`</a><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.debug(dc73c33c91)" title="(template: String, arg1: Any)Unit">debug</a><span class="delimiter">(</span><span title="String(&quot;The coordinator state was successfully updated with {}&quot;)" class="string">&quot;The coordinator state was successfully updated with {}&quot;</span>, <a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate.evt" title="E">evt</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;DDataShardCoordinator.updateSuccess" title="(evt: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)Unit">updateSuccess</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate.evt" title="E">evt</a><span class="delimiter">)</span>

    case UpdateTimeout<span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.CoordinatorStateKey" title="=&gt; akka.cluster.ddata.LWWRegisterKey[akka.cluster.sharding.ShardCoordinator.Internal.State]">CoordinatorStateKey</a>, Some<span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate.evt" title="E">`evt`</a><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.error(2f488eb77c)" title="(template: String, arg1: Any, arg2: Any)Unit">error</a><span class="delimiter">(</span>
        <span title="String(&quot;The ShardCoordinator was unable to update a distributed state within \'updating-state-timeout\'={} millis (was retrying), event={}&quot;)" class="string">&quot;The ShardCoordinator was unable to update a distributed state within 'updating-state-timeout'={} millis (was retrying), event={}&quot;</span>,
        <a href="#akka.cluster.sharding;DDataShardCoordinator.updatingStateTimeout" title="=&gt; scala.concurrent.duration.FiniteDuration">updatingStateTimeout</a>.<span title="=&gt; Long">toMillis</span>,
        <a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate.evt" title="E">evt</a><span class="delimiter">)</span>
      <a href="#akka.cluster.sharding;DDataShardCoordinator.sendUpdate" title="(evt: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)Unit">sendUpdate</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate.evt" title="E">evt</a><span class="delimiter">)</span>

    case ModifyFailure<span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.CoordinatorStateKey" title="=&gt; akka.cluster.ddata.LWWRegisterKey[akka.cluster.sharding.ShardCoordinator.Internal.State]">CoordinatorStateKey</a>, <a title="String" id="akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate;$anonfun.isDefinedAt.error">error</a>, <a title="Throwable" id="akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate;$anonfun.isDefinedAt.cause">cause</a>, Some<span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate.evt" title="E">`evt`</a><span class="delimiter">)</span><span class="delimiter">)</span> ⇒
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.error(41f64575e3)" title="(cause: Throwable, template: String, arg1: Any, arg2: Any)Unit">error</a><span class="delimiter">(</span>
        <a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate;$anonfun.isDefinedAt.cause" title="Throwable">cause</a>,
        <span title="String(&quot;The ShardCoordinator was unable to update a distributed state with error {} and event {}.Coordinator will be restarted&quot;)" class="string">&quot;The ShardCoordinator was unable to update a distributed state with error {} and event {}.Coordinator will be restarted&quot;</span>,
        <a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate;$anonfun.isDefinedAt.error" title="String">error</a>,
        <a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate.evt" title="E">evt</a><span class="delimiter">)</span>
      throw <a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate;$anonfun.isDefinedAt.cause" title="Throwable">cause</a>
    case _ ⇒ <a href="../../../../actor/akka/actor/Stash.scala.html#akka.actor;StashSupport.stash" title="()Unit">stash</a><span title="Boolean(true)" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="()Unit" id="akka.cluster.sharding;DDataShardCoordinator.activate">activate</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.become(07b70b901c)" title="(behavior: akka.actor.Actor.Receive)Unit">become</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.active" title="=&gt; DDataShardCoordinator.this.Receive">active</a><span class="delimiter">)</span>
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging.log" title="=&gt; akka.event.LoggingAdapter">log</a>.<a href="../../../../actor/akka/event/Logging.scala.html#akka.event;LoggingAdapter.info(dc73c33c91)" title="(template: String, arg1: Any)Unit">info</a><span class="delimiter">(</span><span title="String(&quot;Sharding Coordinator was moved to the active state {}&quot;)" class="string">&quot;Sharding Coordinator was moved to the active state {}&quot;</span>, <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="[E &lt;: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent](evt: E)(f: E =&gt; Unit)Unit" id="akka.cluster.sharding;DDataShardCoordinator.update">update</a><span class="delimiter">[</span><a title=" &lt;: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent" id="akka.cluster.sharding;DDataShardCoordinator.update;E">E</a> &lt;: DomainEvent<span class="delimiter">]</span><span class="delimiter">(</span><a title="E" id="akka.cluster.sharding;DDataShardCoordinator.update.evt">evt</a>: <a href="#akka.cluster.sharding;DDataShardCoordinator.update;E" title="E">E</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="E =&gt; Unit" id="akka.cluster.sharding;DDataShardCoordinator.update.f">f</a>: E ⇒ Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.sharding;DDataShardCoordinator.afterUpdateCallback_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent =&gt; Unit)Unit">afterUpdateCallback</a> = <a href="#akka.cluster.sharding;DDataShardCoordinator.update.f" title="E =&gt; Unit">f</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent =&gt; Unit" class="delimiter">[</span>DomainEvent ⇒ Unit<span class="delimiter">]</span>
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.become(07b70b901c)" title="(behavior: akka.actor.Actor.Receive)Unit">become</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForUpdate" title="(evt: E)DDataShardCoordinator.this.Receive">waitingForUpdate</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.update.evt" title="E">evt</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#akka.cluster.sharding;DDataShardCoordinator.sendUpdate" title="(evt: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)Unit">sendUpdate</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.update.evt" title="E">evt</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(evt: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)Unit" id="akka.cluster.sharding;DDataShardCoordinator.updateSuccess">updateSuccess</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent" id="akka.cluster.sharding;DDataShardCoordinator.updateSuccess.evt">evt</a>: <a href="#akka.cluster.sharding.ShardCoordinator.Internal;DomainEvent" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">DomainEvent</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.cluster.sharding;DDataShardCoordinator.afterUpdateCallback_=" title="(v1: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)Unit">afterUpdateCallback</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.updateSuccess.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
    <a href="#akka.cluster.sharding;DDataShardCoordinator.afterUpdateCallback_=" title="(x$1: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent =&gt; Unit)Unit">afterUpdateCallback</a> = null
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.become(07b70b901c)" title="(behavior: akka.actor.Actor.Receive)Unit">become</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;ShardCoordinator.active" title="=&gt; DDataShardCoordinator.this.Receive">active</a><span class="delimiter">)</span>
    <a href="../../../../actor/akka/actor/Stash.scala.html#akka.actor;StashSupport.unstashAll(aa97cb1b3d)" title="()Unit">unstashAll</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="()Unit" id="akka.cluster.sharding;DDataShardCoordinator.getState">getState</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">replicator</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="../../../../distributed-data-experimental/akka/cluster/ddata/Replicator.scala.html#akka.cluster.ddata.Replicator;Get" title="(key: akka.cluster.ddata.Key[akka.cluster.ddata.LWWRegister[akka.cluster.sharding.ShardCoordinator.Internal.State]], consistency: akka.cluster.ddata.Replicator.ReadConsistency, request: Option[Any])akka.cluster.ddata.Replicator.Get[akka.cluster.ddata.LWWRegister[akka.cluster.sharding.ShardCoordinator.Internal.State]]">Get</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.CoordinatorStateKey" title="=&gt; akka.cluster.ddata.LWWRegisterKey[akka.cluster.sharding.ShardCoordinator.Internal.State]">CoordinatorStateKey</a>, <a href="../../../../distributed-data-experimental/akka/cluster/ddata/Replicator.scala.html#akka.cluster.ddata.Replicator;ReadMajority" title="(timeout: scala.concurrent.duration.FiniteDuration)akka.cluster.ddata.Replicator.ReadMajority">ReadMajority</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.waitingForStateTimeout" title="=&gt; scala.concurrent.duration.FiniteDuration">waitingForStateTimeout</a><span class="delimiter">)</span><span class="delimiter">)</span>

  def <a title="(evt: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)Unit" id="akka.cluster.sharding;DDataShardCoordinator.sendUpdate">sendUpdate</a><span class="delimiter">(</span><a title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent" id="akka.cluster.sharding;DDataShardCoordinator.sendUpdate.evt">evt</a>: <a href="#akka.cluster.sharding.ShardCoordinator.Internal;DomainEvent" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">DomainEvent</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    val <a title="akka.cluster.sharding.ShardCoordinator.Internal.State" id="akka.cluster.sharding;DDataShardCoordinator.sendUpdate.s">s</a> = <a href="#akka.cluster.sharding;ShardCoordinator.state_=" title="=&gt; akka.cluster.sharding.ShardCoordinator.Internal.State">state</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal;State.updated" title="(event: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)akka.cluster.sharding.ShardCoordinator.Internal.State">updated</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.sendUpdate.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span>
    <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">replicator</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="../../../../distributed-data-experimental/akka/cluster/ddata/Replicator.scala.html#akka.cluster.ddata.Replicator.Update.apply(248dd2199e)" title="(key: akka.cluster.ddata.Key[akka.cluster.ddata.LWWRegister[akka.cluster.sharding.ShardCoordinator.Internal.State]], initial: akka.cluster.ddata.LWWRegister[akka.cluster.sharding.ShardCoordinator.Internal.State], writeConsistency: akka.cluster.ddata.Replicator.WriteConsistency, request: Option[Any])(modify: akka.cluster.ddata.LWWRegister[akka.cluster.sharding.ShardCoordinator.Internal.State] =&gt; akka.cluster.ddata.LWWRegister[akka.cluster.sharding.ShardCoordinator.Internal.State])akka.cluster.ddata.Replicator.Update[akka.cluster.ddata.LWWRegister[akka.cluster.sharding.ShardCoordinator.Internal.State]]">Update</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.CoordinatorStateKey" title="=&gt; akka.cluster.ddata.LWWRegisterKey[akka.cluster.sharding.ShardCoordinator.Internal.State]">CoordinatorStateKey</a>, <a href="../../../../distributed-data-experimental/akka/cluster/ddata/LWWRegister.scala.html#akka.cluster.ddata.LWWRegister" title="akka.cluster.ddata.LWWRegister.type">LWWRegister</a><a href="#akka.cluster.sharding;DDataShardCoordinator.node" title="akka.cluster.Cluster" id="akka.cluster.sharding;DDataShardCoordinator.sendUpdate.x$37" class="delimiter">(</a><a href="#akka.cluster.sharding.ShardCoordinator.Internal.State.readResolve" title="akka.cluster.sharding.ShardCoordinator.Internal.State.type">State</a>.<a href="#akka.cluster.sharding.ShardCoordinator.Internal.State.empty" title="akka.cluster.sharding.ShardCoordinator.Internal.State" id="akka.cluster.sharding;DDataShardCoordinator.sendUpdate.x$35">empty</a><span class="delimiter">)</span>, <a href="../../../../distributed-data-experimental/akka/cluster/ddata/Replicator.scala.html#akka.cluster.ddata.Replicator;WriteMajority" title="(timeout: scala.concurrent.duration.FiniteDuration)akka.cluster.ddata.Replicator.WriteMajority">WriteMajority</a><span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.updatingStateTimeout" title="=&gt; scala.concurrent.duration.FiniteDuration">updatingStateTimeout</a><span class="delimiter">)</span>, <span title="(x: akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent)Some[akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent]">Some</span><span class="delimiter">(</span><a href="#akka.cluster.sharding;DDataShardCoordinator.sendUpdate.evt" title="akka.cluster.sharding.ShardCoordinator.Internal.DomainEvent">evt</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="akka.cluster.ddata.LWWRegister[akka.cluster.sharding.ShardCoordinator.Internal.State]" id="akka.cluster.sharding;DDataShardCoordinator.sendUpdate.$anonfun.reg">reg</a> ⇒
      <a href="#akka.cluster.sharding;DDataShardCoordinator.sendUpdate.$anonfun.reg" title="akka.cluster.ddata.LWWRegister[akka.cluster.sharding.ShardCoordinator.Internal.State]">reg</a>.<a href="../../../../distributed-data-experimental/akka/cluster/ddata/LWWRegister.scala.html#akka.cluster.ddata;LWWRegister.withValue(4bf02da05c)" title="(value: akka.cluster.sharding.ShardCoordinator.Internal.State)(implicit node: akka.cluster.Cluster, implicit clock: akka.cluster.ddata.LWWRegister.Clock[akka.cluster.sharding.ShardCoordinator.Internal.State])akka.cluster.ddata.LWWRegister[akka.cluster.sharding.ShardCoordinator.Internal.State]">withValue</a><a href="#akka.cluster.sharding;DDataShardCoordinator.node" title="akka.cluster.Cluster" id="akka.cluster.sharding;DDataShardCoordinator.sendUpdate.$anonfun.x$40" class="delimiter">(</a><a href="#akka.cluster.sharding;DDataShardCoordinator.sendUpdate.s" title="akka.cluster.sharding.ShardCoordinator.Internal.State" id="akka.cluster.sharding;DDataShardCoordinator.sendUpdate.$anonfun.x$38">s</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
