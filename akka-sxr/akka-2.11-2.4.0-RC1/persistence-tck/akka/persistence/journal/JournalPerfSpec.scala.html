<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>persistence-tck/akka/persistence/journal/JournalPerfSpec.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2014-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
package akka.persistence.journal

import akka.actor.<span class="delimiter">{</span> ActorLogging, ActorRef, Props <span class="delimiter">}</span>
import akka.persistence.journal.<a href="#akka.persistence.journal.JournalPerfSpec.readResolve" title="akka.persistence.journal.JournalPerfSpec.type">JournalPerfSpec</a>.<span class="delimiter">{</span> BenchActor, Cmd, ResetCounter <span class="delimiter">}</span>
import akka.persistence.<span class="delimiter">{</span> PersistentActor, PluginSpec <span class="delimiter">}</span>
import akka.testkit.TestProbe
import scala.collection.immutable
import scala.concurrent.duration._
import com.typesafe.config.Config

object <a title="akka.persistence.journal.JournalPerfSpec.type" id="akka.persistence.journal.JournalPerfSpec.readResolve">JournalPerfSpec</a> <a href="#akka.persistence.journal.JournalPerfSpec.readResolve" title="akka.persistence.journal.JournalPerfSpec.type" class="delimiter">{</a>
  class <a title="class BenchActor extends AnyRef with akka.persistence.PersistentActor with akka.actor.ActorLogging" id="akka.persistence.journal.JournalPerfSpec;BenchActor">BenchActor</a><a href="#akka.persistence.journal.JournalPerfSpec;BenchActor" title="akka.persistence.journal.JournalPerfSpec.BenchActor" class="delimiter">(</a>override val <a title="String" id="akka.persistence.journal.JournalPerfSpec;BenchActor.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="akka.actor.ActorRef" id="akka.persistence.journal.JournalPerfSpec;BenchActor.replyTo">replyTo</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="Int" id="akka.persistence.journal.JournalPerfSpec;BenchActor.replyAfter">replyAfter</a>: <span title="Int">Int</span><span class="delimiter">)</span> extends <a href="../../../../persistence/akka/persistence/PersistentActor.scala.html#akka.persistence;PersistentActor" title="akka.persistence.PersistentActor">PersistentActor</a>
    with <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="delimiter">{</span>

    var <a title="Int" id="akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=">counter</a> = <span title="Int(0)" class="int">0</span>

    override def <a title="=&gt; BenchActor.this.Receive" id="akka.persistence.journal.JournalPerfSpec;BenchActor.receiveCommand">receiveCommand</a>: <span title="BenchActor.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.persistence.journal.JournalPerfSpec;BenchActor.receiveCommand;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      case <span title="akka.persistence.journal.JournalPerfSpec.Cmd">c</span> @ Cmd<span class="delimiter">(</span><span title="String(&quot;p&quot;)" class="string">&quot;p&quot;</span>, <span title="Int">payload</span><span class="delimiter">)</span> ⇒
        <a href="../../../../persistence/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.persist(aa368cf4a0)" title="(event: akka.persistence.journal.JournalPerfSpec.Cmd)(handler: akka.persistence.journal.JournalPerfSpec.Cmd =&gt; Unit)Unit">persist</a><span class="delimiter">(</span><span title="akka.persistence.journal.JournalPerfSpec.Cmd">c</span><span class="delimiter">)</span> <span title="Boolean(true)" class="delimiter">{</span> <span title="akka.persistence.journal.JournalPerfSpec.Cmd">d</span> ⇒
          <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="(x$1: Int)Unit">counter</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="akka.persistence.journal.JournalPerfSpec.Cmd">d</span>.<a href="#akka.persistence.journal.JournalPerfSpec;Cmd.payload" title="=&gt; Int">payload</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Expected to receive [&quot;)">Expected to receive [$</span><a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a><span title="String(&quot;] yet got: [&quot;)">] yet got: [$</span><span class="delimiter">{</span><span title="akka.persistence.journal.JournalPerfSpec.Cmd">d</span>.<a href="#akka.persistence.journal.JournalPerfSpec;Cmd.payload" title="=&gt; Int">payload</a><span class="delimiter">}</span><span title="String(&quot;]&quot;)" class="string">]&quot;</span><span class="delimiter">)</span>
          if <span class="delimiter">(</span><a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.replyAfter" title="Int">replyAfter</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">replyTo</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <span title="akka.persistence.journal.JournalPerfSpec.Cmd">d</span>.<a href="#akka.persistence.journal.JournalPerfSpec;Cmd.payload" title="=&gt; Int">payload</a>
        <span class="delimiter">}</span>

      case <span title="akka.persistence.journal.JournalPerfSpec.Cmd">c</span> @ Cmd<span class="delimiter">(</span><span title="String(&quot;pa&quot;)" class="string">&quot;pa&quot;</span>, <span title="Int">payload</span><span class="delimiter">)</span> ⇒
        <a href="../../../../persistence/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.persistAsync(aa368cf4a0)" title="(event: akka.persistence.journal.JournalPerfSpec.Cmd)(handler: akka.persistence.journal.JournalPerfSpec.Cmd =&gt; Unit)Unit">persistAsync</a><span class="delimiter">(</span><span title="akka.persistence.journal.JournalPerfSpec.Cmd">c</span><span class="delimiter">)</span> <span title="Boolean(true)" class="delimiter">{</span> <span title="akka.persistence.journal.JournalPerfSpec.Cmd">d</span> ⇒
          <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="(x$1: Int)Unit">counter</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="akka.persistence.journal.JournalPerfSpec.Cmd">d</span>.<a href="#akka.persistence.journal.JournalPerfSpec;Cmd.payload" title="=&gt; Int">payload</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Expected to receive [&quot;)">Expected to receive [$</span><a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a><span title="String(&quot;] yet got: [&quot;)">] yet got: [$</span><span class="delimiter">{</span><span title="akka.persistence.journal.JournalPerfSpec.Cmd">d</span>.<a href="#akka.persistence.journal.JournalPerfSpec;Cmd.payload" title="=&gt; Int">payload</a><span class="delimiter">}</span><span title="String(&quot;]&quot;)" class="string">]&quot;</span><span class="delimiter">)</span>
          if <span class="delimiter">(</span><a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.replyAfter" title="Int">replyAfter</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">replyTo</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <span title="akka.persistence.journal.JournalPerfSpec.Cmd">d</span>.<a href="#akka.persistence.journal.JournalPerfSpec;Cmd.payload" title="=&gt; Int">payload</a>
        <span class="delimiter">}</span>

      case <span title="akka.persistence.journal.JournalPerfSpec.Cmd">c</span> @ Cmd<span class="delimiter">(</span><span title="String(&quot;par&quot;)" class="string">&quot;par&quot;</span>, <span title="Int">payload</span><span class="delimiter">)</span> ⇒
        <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="(x$1: Int)Unit">counter</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
        <a href="../../../../persistence/akka/persistence/Eventsourced.scala.html#akka.persistence;Eventsourced.persistAsync(aa368cf4a0)" title="(event: akka.persistence.journal.JournalPerfSpec.Cmd)(handler: akka.persistence.journal.JournalPerfSpec.Cmd =&gt; Unit)Unit">persistAsync</a><span class="delimiter">(</span><span title="akka.persistence.journal.JournalPerfSpec.Cmd">c</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span title="akka.persistence.journal.JournalPerfSpec.Cmd">d</span> ⇒
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="akka.persistence.journal.JournalPerfSpec.Cmd">d</span>.<a href="#akka.persistence.journal.JournalPerfSpec;Cmd.payload" title="=&gt; Int">payload</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Expected to receive [&quot;)">Expected to receive [$</span><a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a><span title="String(&quot;] yet got: [&quot;)">] yet got: [$</span><span class="delimiter">{</span><span title="akka.persistence.journal.JournalPerfSpec.Cmd">d</span>.<a href="#akka.persistence.journal.JournalPerfSpec;Cmd.payload" title="=&gt; Int">payload</a><span class="delimiter">}</span><span title="String(&quot;]&quot;)" class="string">]&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        if <span class="delimiter">(</span><a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.replyAfter" title="Int">replyAfter</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">replyTo</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <span title="Int">payload</span>

      case <span title="akka.persistence.journal.JournalPerfSpec.Cmd">c</span> @ Cmd<span class="delimiter">(</span><span title="String(&quot;n&quot;)" class="string">&quot;n&quot;</span>, <span title="Int">payload</span><span class="delimiter">)</span> ⇒
        <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="(x$1: Int)Unit">counter</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
        <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="Int">payload</span> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Expected to receive [&quot;)">Expected to receive [$</span><a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a><span title="String(&quot;] yet got: [&quot;)">] yet got: [$</span><span class="delimiter">{</span><span title="Int">payload</span><span class="delimiter">}</span><span title="String(&quot;]&quot;)" class="string">]&quot;</span><span class="delimiter">)</span>
        if <span class="delimiter">(</span><a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.replyAfter" title="Int">replyAfter</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">replyTo</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <span title="Int">payload</span>

      case <a href="#akka.persistence.journal.JournalPerfSpec.ResetCounter.readResolve" title="akka.persistence.journal.JournalPerfSpec.ResetCounter.type">ResetCounter</a> ⇒
        <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="(x$1: Int)Unit">counter</a> = <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span>

    override def <a title="=&gt; BenchActor.this.Receive" id="akka.persistence.journal.JournalPerfSpec;BenchActor.receiveRecover">receiveRecover</a>: <span title="BenchActor.this.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.persistence.journal.JournalPerfSpec;BenchActor.receiveRecover;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      case Cmd<span class="delimiter">(</span>_, <a title="Int" id="akka.persistence.journal.JournalPerfSpec;BenchActor.receiveRecover;$anonfun.isDefinedAt.payload">payload</a><span class="delimiter">)</span> ⇒
        <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="(x$1: Int)Unit">counter</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
        <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.receiveRecover;$anonfun.isDefinedAt.payload" title="Int">payload</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Expected to receive [&quot;)">Expected to receive [$</span><a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a><span title="String(&quot;] yet got: [&quot;)">] yet got: [$</span><span class="delimiter">{</span><a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.receiveRecover;$anonfun.isDefinedAt.payload" title="Int">payload</a><span class="delimiter">}</span><span title="String(&quot;]&quot;)" class="string">]&quot;</span><span class="delimiter">)</span>
        if <span class="delimiter">(</span><a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.counter_=" title="=&gt; Int">counter</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.replyAfter" title="Int">replyAfter</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">replyTo</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.persistence.journal.JournalPerfSpec;BenchActor.receiveRecover;$anonfun.isDefinedAt.payload" title="Int">payload</a>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  case object <a href="#akka.persistence.journal.JournalPerfSpec.ResetCounter.productElement.x$1" title="akka.persistence.journal.JournalPerfSpec.ResetCounter.type" id="akka.persistence.journal.JournalPerfSpec.ResetCounter.readResolve">ResetCounter</a>
  case class <a title="class Cmd extends AnyRef with Product with Serializable" id="akka.persistence.journal.JournalPerfSpec.Cmd.readResolve">Cmd</a><a href="#akka.persistence.journal.JournalPerfSpec.Cmd.readResolve" title="Product" class="delimiter">(</a><a title="String" id="akka.persistence.journal.JournalPerfSpec;Cmd.mode">mode</a>: <span title="String">String</span>, <a title="Int" id="akka.persistence.journal.JournalPerfSpec;Cmd.payload">payload</a>: <span title="Int">Int</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * This spec measures execution times of the basic operations that an [[akka.persistence.PersistentActor]] provides,
 * using the provided Journal (plugin).
 *
 * It is *NOT* meant to be a comprehensive benchmark, but rather aims to help plugin developers to easily determine
 * if their plugin's performance is roughly as expected. It also validates the plugin still works under &quot;more messages&quot; scenarios.
 *
 * In case your journal plugin needs some kind of setup or teardown, override the `beforeAll` or `afterAll`
 * methods (don't forget to call `super` in your overridden methods).
 *
 * For a Java and JUnit consumable version of the TCK please refer to [[akka.persistence.japi.journal.JavaJournalPerfSpec]].
 *
 * @see [[akka.persistence.journal.JournalSpec]]
 */</span>
abstract class <a title="class JournalPerfSpec extends akka.persistence.journal.JournalSpec" id="akka.persistence.journal;JournalPerfSpec">JournalPerfSpec</a><a href="#akka.persistence.journal;JournalPerfSpec" title="akka.persistence.journal.JournalPerfSpec" class="delimiter">(</a><a title="com.typesafe.config.Config" id="akka.persistence.journal;JournalPerfSpec.config">config</a>: <span title="com.typesafe.config.Config">Config</span><span class="delimiter">)</span> extends <a href="JournalSpec.scala.html#akka.persistence.journal;JournalSpec" title="akka.persistence.journal.JournalSpec">JournalSpec</a><span class="delimiter">(</span><a href="#akka.persistence.journal;JournalPerfSpec.config" title="com.typesafe.config.Config">config</a><span class="delimiter">)</span> <span class="delimiter">{</span>

  private val <a title="akka.testkit.TestProbe" id="akka.persistence.journal;JournalPerfSpec.testProbe">testProbe</a> = <a href="../../../../testkit/akka/testkit/TestKit.scala.html#akka.testkit.TestProbe.apply(1a16cb23c5)" title="()(implicit system: akka.actor.ActorSystem)akka.testkit.TestProbe">TestProbe</a><a href="JournalSpec.scala.html#akka.persistence.journal;JournalSpec.system" title="=&gt; akka.actor.ActorSystem" class="delimiter">(</a><span class="delimiter">)</span>

  def <a title="(replyAfter: Int)akka.actor.ActorRef" id="akka.persistence.journal;JournalPerfSpec.benchActor">benchActor</a><span class="delimiter">(</span><a title="Int" id="akka.persistence.journal;JournalPerfSpec.benchActor.replyAfter">replyAfter</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> =
    <a href="JournalSpec.scala.html#akka.persistence.journal;JournalSpec.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(59f1e43182)" title="(props: akka.actor.Props)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.persistence.journal.JournalPerfSpec.BenchActor](classOf[akka.persistence.journal.JournalPerfSpec$$BenchActor])" class="delimiter">[</span>BenchActor<span class="delimiter">]</span>, <a href="../PluginSpec.scala.html#akka.persistence;PluginSpec.pid" title="=&gt; String">pid</a>, <a href="#akka.persistence.journal;JournalPerfSpec.testProbe" title="=&gt; akka.testkit.TestProbe">testProbe</a>.<a href="../../../../testkit/akka/testkit/TestKit.scala.html#akka.testkit;TestProbe.ref" title="=&gt; akka.actor.ActorRef">ref</a>, <a href="#akka.persistence.journal;JournalPerfSpec.benchActor.replyAfter" title="Int">replyAfter</a><span class="delimiter">)</span><span class="delimiter">)</span>

  def <a title="(actor: akka.actor.ActorRef, mode: String, cmnds: scala.collection.immutable.Seq[Int])Unit" id="akka.persistence.journal;JournalPerfSpec.feedAndExpectLast">feedAndExpectLast</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.persistence.journal;JournalPerfSpec.feedAndExpectLast.actor">actor</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="String" id="akka.persistence.journal;JournalPerfSpec.feedAndExpectLast.mode">mode</a>: <span title="String">String</span>, <a title="scala.collection.immutable.Seq[Int]" id="akka.persistence.journal;JournalPerfSpec.feedAndExpectLast.cmnds">cmnds</a>: immutable.<span title="scala.collection.immutable.Seq[Int]">Seq</span><span class="delimiter">[</span>Int<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.persistence.journal;JournalPerfSpec.feedAndExpectLast.cmnds" title="scala.collection.immutable.Seq[Int]">cmnds</a> <span title="(f: Int =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="Int" id="akka.persistence.journal;JournalPerfSpec.feedAndExpectLast.$anonfun.c">c</a> ⇒ <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="akka.actor.ScalaActorRef" id="akka.persistence.journal;JournalPerfSpec.feedAndExpectLast.$anonfun.qual$1">actor</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!$default$2" title="akka.actor.ActorRef" id="akka.persistence.journal;JournalPerfSpec.feedAndExpectLast.$anonfun.x$3">!</a> <a href="#akka.persistence.journal.JournalPerfSpec.Cmd.readResolve" title="(mode: String, payload: Int)akka.persistence.journal.JournalPerfSpec.Cmd">Cmd</a><a title="akka.persistence.journal.JournalPerfSpec.Cmd" id="akka.persistence.journal;JournalPerfSpec.feedAndExpectLast.$anonfun.x$2" class="delimiter">(</a><a href="#akka.persistence.journal;JournalPerfSpec.feedAndExpectLast.mode" title="String">mode</a>, <a href="#akka.persistence.journal;JournalPerfSpec.feedAndExpectLast.$anonfun.c" title="Int">c</a><span class="delimiter">)</span> <span class="delimiter">}</span>
    <a href="#akka.persistence.journal;JournalPerfSpec.testProbe" title="=&gt; akka.testkit.TestProbe">testProbe</a>.<a href="../../../../testkit/akka/testkit/TestKit.scala.html#akka.testkit;TestKitBase.expectMsg(23711c1182)" title="(max: scala.concurrent.duration.FiniteDuration, obj: Int)Int">expectMsg</a><span title="Unit" class="delimiter">(</span><a href="#akka.persistence.journal;JournalPerfSpec.awaitDuration" title="=&gt; scala.concurrent.duration.FiniteDuration">awaitDuration</a>, <a href="#akka.persistence.journal;JournalPerfSpec.feedAndExpectLast.cmnds" title="scala.collection.immutable.Seq[Int]">cmnds</a>.<span title="=&gt; Int">last</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Executes a block of code multiple times (no warm-up) */</span>
  def <a title="(msg: scala.concurrent.duration.Duration =&gt; String)(block: =&gt; Unit)Unit" id="akka.persistence.journal;JournalPerfSpec.measure">measure</a><span class="delimiter">(</span><a title="scala.concurrent.duration.Duration =&gt; String" id="akka.persistence.journal;JournalPerfSpec.measure.msg">msg</a>: Duration ⇒ String<span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; Unit" id="akka.persistence.journal;JournalPerfSpec.measure.block">block</a>: ⇒ Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val <a title="Array[scala.concurrent.duration.Duration]" id="akka.persistence.journal;JournalPerfSpec.measure.measurements">measurements</a> = <span title="Array.type">Array</span>.<span title="[T](n1: Int)(implicit evidence$3: scala.reflect.ClassTag[T])Array[T]">ofDim</span><span title="(n1: Int)(implicit evidence$3: scala.reflect.ClassTag[scala.concurrent.duration.Duration])Array[scala.concurrent.duration.Duration]" class="delimiter">[</span><span title="scala.concurrent.duration.Duration">Duration</span><span class="delimiter">]</span><span title="(runtimeClass1: Class[_])scala.reflect.ClassTag[scala.concurrent.duration.Duration]" class="delimiter">(</span><a href="#akka.persistence.journal;JournalPerfSpec.measurementIterations" title="=&gt; Int">measurementIterations</a><span class="delimiter">)</span>
    var <a title="Int" id="akka.persistence.journal;JournalPerfSpec.measure.i">i</a> = <span title="Int(0)" class="int">0</span>
    while <span class="delimiter">(</span><a href="#akka.persistence.journal;JournalPerfSpec.measure.i" title="Int">i</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#akka.persistence.journal;JournalPerfSpec.measurementIterations" title="=&gt; Int">measurementIterations</a><span class="delimiter">)</span> <a href="#akka.persistence.journal;JournalPerfSpec.measure.while$1" title="()Unit" class="delimiter">{</a>
      val <a title="Long" id="akka.persistence.journal;JournalPerfSpec.measure.start">start</a> = <span title="System.type">System</span>.<span title="()Long">nanoTime</span><span class="delimiter">(</span><span class="delimiter">)</span>

      <a href="#akka.persistence.journal;JournalPerfSpec.measure.block" title="=&gt; Unit">block</a>

      val <a title="Long" id="akka.persistence.journal;JournalPerfSpec.measure.stop">stop</a> = <span title="System.type">System</span>.<span title="()Long">nanoTime</span><span class="delimiter">(</span><span class="delimiter">)</span>
      val <a title="scala.concurrent.duration.FiniteDuration" id="akka.persistence.journal;JournalPerfSpec.measure.d">d</a> = <span class="delimiter">(</span><a href="#akka.persistence.journal;JournalPerfSpec.measure.stop" title="Long">stop</a> <span title="implicit scala.concurrent.duration.package.DurationLong : (n: Long)concurrent.duration.DurationLong">-</span> <a href="#akka.persistence.journal;JournalPerfSpec.measure.start" title="Long">start</a><span class="delimiter">)</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">nanos</span>
      <a href="#akka.persistence.journal;JournalPerfSpec.measure.measurements" title="(i: Int, x: scala.concurrent.duration.Duration)Unit">measurements</a><span class="delimiter">(</span><a href="#akka.persistence.journal;JournalPerfSpec.measure.i" title="Int">i</a><span class="delimiter">)</span> = <a href="#akka.persistence.journal;JournalPerfSpec.measure.d" title="scala.concurrent.duration.FiniteDuration">d</a>
      <a href="#akka.persistence.journal;JournalPerfSpec" title="org.scalatest.Informer" id="akka.persistence.journal;JournalPerfSpec.measure.x$5">info</a><span class="delimiter">(</span><a href="#akka.persistence.journal;JournalPerfSpec.measure.msg" title="(v1: scala.concurrent.duration.Duration)String">msg</a><a title="String" id="akka.persistence.journal;JournalPerfSpec.measure.x$4" class="delimiter">(</a><a href="#akka.persistence.journal;JournalPerfSpec.measure.d" title="scala.concurrent.duration.FiniteDuration">d</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#akka.persistence.journal;JournalPerfSpec.measure.i" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>
    <a href="#akka.persistence.journal;JournalPerfSpec" title="org.scalatest.Informer" id="akka.persistence.journal;JournalPerfSpec.measure.x$7">info</a><span class="delimiter">(</span><a title="String" id="akka.persistence.journal;JournalPerfSpec.measure.x$6">s</a>&quot;<span title="String(&quot;Average time: &quot;)">Average time: $</span><span class="delimiter">{</span><span class="delimiter">(</span><a href="#akka.persistence.journal;JournalPerfSpec.measure.measurements" title="(xs: Array[scala.concurrent.duration.Duration])scala.collection.mutable.ArrayOps[scala.concurrent.duration.Duration]">measurements</a>.<span title="(f: scala.concurrent.duration.Duration =&gt; Long)(implicit bf: scala.collection.generic.CanBuildFrom[Array[scala.concurrent.duration.Duration],Long,Array[Long]])Array[Long]">map</span><span title="implicit scala.Predef.longArrayOps : (xs: Array[Long])scala.collection.mutable.ArrayOps[Long]" class="delimiter">(</span><a href="#akka.persistence.journal;JournalPerfSpec.measure.x$6.$anonfun.x$1" title="scala.concurrent.duration.Duration">_</a>.<span title="=&gt; Long">toNanos</span><span class="delimiter">)</span>.<span title="(implicit num: Numeric[Long])Long">sum</span> <span title="implicit scala.concurrent.duration.package.DurationLong : (n: Long)concurrent.duration.DurationLong">/</span> <a href="#akka.persistence.journal;JournalPerfSpec.measurementIterations" title="=&gt; Int">measurementIterations</a><span class="delimiter">)</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">nanos</span>.<span title="=&gt; Long">toMillis</span><span class="delimiter">}</span><span title="String(&quot; ms&quot;)" class="string"> ms&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Override in order to customize timeouts used for expectMsg, in order to tune the awaits to your journal's perf */</span>
  def <a title="=&gt; Long" id="akka.persistence.journal;JournalPerfSpec.awaitDurationMillis">awaitDurationMillis</a>: <span title="Long">Long</span> = <span title="implicit scala.concurrent.duration.package.DurationInt : (n: Int)concurrent.duration.DurationInt" class="int">10</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">seconds</span>.<span title="=&gt; Long">toMillis</span>

  <span class="comment">/** Override in order to customize timeouts used for expectMsg, in order to tune the awaits to your journal's perf */</span>
  private def <a title="=&gt; scala.concurrent.duration.FiniteDuration" id="akka.persistence.journal;JournalPerfSpec.awaitDuration">awaitDuration</a>: <span title="scala.concurrent.duration.FiniteDuration">FiniteDuration</span> = <a href="#akka.persistence.journal;JournalPerfSpec.awaitDurationMillis" title="implicit scala.concurrent.duration.package.DurationLong : (n: Long)concurrent.duration.DurationLong">awaitDurationMillis</a>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">millis</span>

  <span class="comment">/** Number of messages sent to the PersistentActor under test for each test iteration */</span>
  def <a title="=&gt; Int" id="akka.persistence.journal;JournalPerfSpec.eventsCount">eventsCount</a>: <span title="Int">Int</span> = <span class="int">10</span> <span title="Int(10000)">*</span> <span class="int">1000</span>

  <span class="comment">/** Number of measurement iterations each test will be run. */</span>
  def <a title="=&gt; Int" id="akka.persistence.journal;JournalPerfSpec.measurementIterations">measurementIterations</a>: <span title="Int">Int</span> = <span title="Int(10)" class="int">10</span>

  private val <a title="scala.collection.immutable.Vector[Int]" id="akka.persistence.journal;JournalPerfSpec.commands">commands</a> = <span title="(elems: Int*)scala.collection.immutable.Vector[Int]">Vector</span><span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#akka.persistence.journal;JournalPerfSpec.eventsCount" title="=&gt; Int">eventsCount</a>: _*<span class="delimiter">)</span>

  <a href="#akka.persistence.journal;JournalPerfSpec" title="implicit org.scalatest.words.MustVerb.convertToStringMustWrapper : (o: String)JournalPerfSpec.this.StringMustWrapperForVerb" class="string">&quot;A PersistentActor's performance&quot;</a> <a href="#akka.persistence.journal;JournalPerfSpec" title="(right: =&gt; Unit)(implicit fun: org.scalatest.words.StringVerbBlockRegistration)Unit">must</a> <span class="delimiter">{</span>
    <a href="#akka.persistence.journal;JournalPerfSpec" title="implicit org.scalatest.WordSpecLike.convertToWordSpecStringWrapper : (s: String)JournalPerfSpec.this.WordSpecStringWrapper">s</a>&quot;<span title="String(&quot;measure: persistAsync()-ing &quot;)">measure: persistAsync()-ing $</span><a href="#akka.persistence.journal;JournalPerfSpec.eventsCount" title="=&gt; Int">eventsCount</a><span title="String(&quot; events&quot;)" class="string"> events&quot;</span> <span title="(f: =&gt; Unit)Unit">in</span> <span class="delimiter">{</span>
      val <span title="akka.actor.ActorRef">p1</span> = <a href="#akka.persistence.journal;JournalPerfSpec.benchActor" title="(replyAfter: Int)akka.actor.ActorRef">benchActor</a><span class="delimiter">(</span><a href="#akka.persistence.journal;JournalPerfSpec.eventsCount" title="=&gt; Int">eventsCount</a><span class="delimiter">)</span>

      <a href="#akka.persistence.journal;JournalPerfSpec.measure" title="(msg: scala.concurrent.duration.Duration =&gt; String)(block: =&gt; Unit)Unit">measure</a><span class="delimiter">(</span><span title="scala.concurrent.duration.Duration">d</span> ⇒ <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;PersistAsync()-ing &quot;)">PersistAsync()-ing $</span><a href="#akka.persistence.journal;JournalPerfSpec.eventsCount" title="=&gt; Int">eventsCount</a><span title="String(&quot; took &quot;)"> took $</span><span class="delimiter">{</span><span title="scala.concurrent.duration.Duration">d</span>.<span title="=&gt; Long">toMillis</span><span class="delimiter">}</span><span title="String(&quot; ms&quot;)" class="string"> ms&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.persistence.journal;JournalPerfSpec.feedAndExpectLast" title="(actor: akka.actor.ActorRef, mode: String, cmnds: scala.collection.immutable.Seq[Int])Unit">feedAndExpectLast</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">p1</span>, <span title="String(&quot;pa&quot;)" class="string">&quot;pa&quot;</span>, <a href="#akka.persistence.journal;JournalPerfSpec.commands" title="=&gt; scala.collection.immutable.Vector[Int]">commands</a><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="akka.actor.ScalaActorRef" id="akka.persistence.journal;JournalPerfSpec.<local JournalPerfSpec>.qual$4">p1</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!$default$2" title="akka.actor.ActorRef" id="akka.persistence.journal;JournalPerfSpec.<local JournalPerfSpec>.x$9">!</a> <a href="#akka.persistence.journal.JournalPerfSpec.ResetCounter.readResolve" title="akka.persistence.journal.JournalPerfSpec.ResetCounter.type" id="akka.persistence.journal;JournalPerfSpec.<local JournalPerfSpec>.x$8">ResetCounter</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#akka.persistence.journal;JournalPerfSpec" title="implicit org.scalatest.WordSpecLike.convertToWordSpecStringWrapper : (s: String)JournalPerfSpec.this.WordSpecStringWrapper">s</a>&quot;<span title="String(&quot;measure: persist()-ing &quot;)">measure: persist()-ing $</span><a href="#akka.persistence.journal;JournalPerfSpec.eventsCount" title="=&gt; Int">eventsCount</a><span title="String(&quot; events&quot;)" class="string"> events&quot;</span> <span title="(f: =&gt; Unit)Unit">in</span> <span class="delimiter">{</span>
      val <span title="akka.actor.ActorRef">p1</span> = <a href="#akka.persistence.journal;JournalPerfSpec.benchActor" title="(replyAfter: Int)akka.actor.ActorRef">benchActor</a><span class="delimiter">(</span><a href="#akka.persistence.journal;JournalPerfSpec.eventsCount" title="=&gt; Int">eventsCount</a><span class="delimiter">)</span>

      <a href="#akka.persistence.journal;JournalPerfSpec.measure" title="(msg: scala.concurrent.duration.Duration =&gt; String)(block: =&gt; Unit)Unit">measure</a><span class="delimiter">(</span><span title="scala.concurrent.duration.Duration">d</span> ⇒ <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Persist()-ing &quot;)">Persist()-ing $</span><a href="#akka.persistence.journal;JournalPerfSpec.eventsCount" title="=&gt; Int">eventsCount</a><span title="String(&quot; took &quot;)"> took $</span><span class="delimiter">{</span><span title="scala.concurrent.duration.Duration">d</span>.<span title="=&gt; Long">toMillis</span><span class="delimiter">}</span><span title="String(&quot; ms&quot;)" class="string"> ms&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.persistence.journal;JournalPerfSpec.feedAndExpectLast" title="(actor: akka.actor.ActorRef, mode: String, cmnds: scala.collection.immutable.Seq[Int])Unit">feedAndExpectLast</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">p1</span>, <span title="String(&quot;p&quot;)" class="string">&quot;p&quot;</span>, <a href="#akka.persistence.journal;JournalPerfSpec.commands" title="=&gt; scala.collection.immutable.Vector[Int]">commands</a><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="akka.actor.ScalaActorRef" id="akka.persistence.journal;JournalPerfSpec.<local JournalPerfSpec>.qual$5">p1</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!$default$2" title="akka.actor.ActorRef" id="akka.persistence.journal;JournalPerfSpec.<local JournalPerfSpec>.x$11">!</a> <a href="#akka.persistence.journal.JournalPerfSpec.ResetCounter.readResolve" title="akka.persistence.journal.JournalPerfSpec.ResetCounter.type" id="akka.persistence.journal;JournalPerfSpec.<local JournalPerfSpec>.x$10">ResetCounter</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#akka.persistence.journal;JournalPerfSpec" title="implicit org.scalatest.WordSpecLike.convertToWordSpecStringWrapper : (s: String)JournalPerfSpec.this.WordSpecStringWrapper">s</a>&quot;<span title="String(&quot;measure: recovering &quot;)">measure: recovering $</span><a href="#akka.persistence.journal;JournalPerfSpec.eventsCount" title="=&gt; Int">eventsCount</a><span title="String(&quot; events&quot;)" class="string"> events&quot;</span> <span title="(f: =&gt; Unit)Unit">in</span> <span class="delimiter">{</span>
      val <span title="akka.actor.ActorRef">p1</span> = <a href="#akka.persistence.journal;JournalPerfSpec.benchActor" title="(replyAfter: Int)akka.actor.ActorRef">benchActor</a><span class="delimiter">(</span><a href="#akka.persistence.journal;JournalPerfSpec.eventsCount" title="=&gt; Int">eventsCount</a><span class="delimiter">)</span>
      <a href="#akka.persistence.journal;JournalPerfSpec.feedAndExpectLast" title="(actor: akka.actor.ActorRef, mode: String, cmnds: scala.collection.immutable.Seq[Int])Unit">feedAndExpectLast</a><span class="delimiter">(</span><span title="akka.actor.ActorRef">p1</span>, <span title="String(&quot;p&quot;)" class="string">&quot;p&quot;</span>, <a href="#akka.persistence.journal;JournalPerfSpec.commands" title="=&gt; scala.collection.immutable.Vector[Int]">commands</a><span class="delimiter">)</span>

      <a href="#akka.persistence.journal;JournalPerfSpec.measure" title="(msg: scala.concurrent.duration.Duration =&gt; String)(block: =&gt; Unit)Unit">measure</a><span class="delimiter">(</span><span title="scala.concurrent.duration.Duration">d</span> ⇒ <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Recovering &quot;)">Recovering $</span><a href="#akka.persistence.journal;JournalPerfSpec.eventsCount" title="=&gt; Int">eventsCount</a><span title="String(&quot; took &quot;)"> took $</span><span class="delimiter">{</span><span title="scala.concurrent.duration.Duration">d</span>.<span title="=&gt; Long">toMillis</span><span class="delimiter">}</span><span title="String(&quot; ms&quot;)" class="string"> ms&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#akka.persistence.journal;JournalPerfSpec.benchActor" title="(replyAfter: Int)akka.actor.ActorRef">benchActor</a><span class="delimiter">(</span><a href="#akka.persistence.journal;JournalPerfSpec.eventsCount" title="=&gt; Int">eventsCount</a><span class="delimiter">)</span>
        <a href="#akka.persistence.journal;JournalPerfSpec.testProbe" title="=&gt; akka.testkit.TestProbe">testProbe</a>.<a href="../../../../testkit/akka/testkit/TestKit.scala.html#akka.testkit;TestKitBase.expectMsg(23711c1182)" title="(max: scala.concurrent.duration.FiniteDuration, obj: Int)Int">expectMsg</a><span title="Unit" class="delimiter">(</span>max = <a href="#akka.persistence.journal;JournalPerfSpec.awaitDuration" title="=&gt; scala.concurrent.duration.FiniteDuration">awaitDuration</a>, <a href="#akka.persistence.journal;JournalPerfSpec.commands" title="=&gt; scala.collection.immutable.Vector[Int]">commands</a>.<span title="=&gt; Int">last</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
