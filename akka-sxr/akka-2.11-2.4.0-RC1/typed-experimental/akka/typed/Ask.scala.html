<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>typed-experimental/akka/typed/Ask.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2014-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
package akka.typed

import scala.concurrent.Future
import akka.util.Timeout
import akka.actor.InternalActorRef
import akka.pattern.AskTimeoutException
import akka.pattern.PromiseActorRef
import java.lang.IllegalArgumentException
import scala.util.Success
import scala.concurrent.ExecutionContext
import scala.util.Failure
import akka.actor.Status

<span class="comment">/**
 * The ask-pattern implements the initiator side of a request–reply protocol.
 * The party that asks may be within or without an Actor, since the
 * implementation will fabricate a (hidden) [[ActorRef]] that is bound to a
 * [[scala.concurrent.Promise]]. This ActorRef will need to be injected in the
 * message that is sent to the target Actor in order to function as a reply-to
 * address, therefore the argument to the ask / `?`
 * operator is not the message itself but a function that given the reply-to
 * address will create the message.
 *
 * {{{
 * case class Request(msg: String, replyTo: ActorRef[Reply])
 * case class Reply(msg: String)
 *
 * implicit val timeout = Timeout(3.seconds)
 * val target: ActorRef[Request] = ...
 * val f: Future[Reply] = target ? (Request(&quot;hello&quot;, _))
 * }}}
 */</span>
object <a title="akka.typed.AskPattern.type" id="akka.typed.AskPattern">AskPattern</a> <a href="#akka.typed.AskPattern" title="akka.typed.AskPattern.type" class="delimiter">{</a>
  implicit class <a href="ActorRef.scala.html#akka.typed;ActorRef.hashCode" title="class Askable[T] extends AnyVal" id="akka.typed.AskPattern.Askable(fed3b26d1e)">Askable</a><span class="delimiter">[</span><a title="" id="akka.typed.AskPattern.Askable(fed3b26d1e);T">T</a><span class="delimiter">]</span><a href="#akka.typed.AskPattern.Askable(fed3b26d1e)" title="akka.typed.AskPattern.Askable[T]" class="delimiter">(</a>val <a title="akka.typed.ActorRef[T]" id="akka.typed.AskPattern.Askable(fed3b26d1e).ref">ref</a>: <a href="ActorRef.scala.html#akka.typed;ActorRef" title="akka.typed.ActorRef[T]">ActorRef</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> extends <a href="#akka.typed.AskPattern.Askable(fed3b26d1e)" title="AnyVal">AnyVal</a> <span class="delimiter">{</span>
    def <a title="[U](f: akka.typed.ActorRef[U] =&gt; T)(implicit timeout: akka.util.Timeout)scala.concurrent.Future[U]" id="akka.typed.AskPattern;Askable.?">?</a><span class="delimiter">[</span><a title="" id="akka.typed.AskPattern;Askable.?;U">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="akka.typed.ActorRef[U] =&gt; T" id="akka.typed.AskPattern;Askable.?.f">f</a>: ActorRef<span class="delimiter">[</span>U<span class="delimiter">]</span> ⇒ T<span class="delimiter">)</span><span class="delimiter">(</span>implicit <a title="akka.util.Timeout" id="akka.typed.AskPattern;Askable.?.timeout">timeout</a>: <a href="../../../actor/akka/util/Timeout.scala.html#akka.util;Timeout" title="akka.util.Timeout">Timeout</a><span class="delimiter">)</span>: <span title="scala.concurrent.Future[U]">Future</span><span class="delimiter">[</span>U<span class="delimiter">]</span> = <a href="#akka.typed.AskPattern.ask" title="(actorRef: akka.typed.ActorRef[T], timeout: akka.util.Timeout, f: akka.typed.ActorRef[U] =&gt; T)scala.concurrent.Future[U]">ask</a><span class="delimiter">(</span><a href="#akka.typed.AskPattern.Askable(fed3b26d1e).ref" title="=&gt; akka.typed.ActorRef[T]">ref</a>, <a href="#akka.typed.AskPattern;Askable.?.timeout" title="akka.util.Timeout">timeout</a>, <a href="#akka.typed.AskPattern;Askable.?.f" title="akka.typed.ActorRef[U] =&gt; T">f</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private class <a title="class PromiseRef[U] extends AnyRef" id="akka.typed.AskPattern;PromiseRef">PromiseRef</a><span class="delimiter">[</span><a title="" id="akka.typed.AskPattern;PromiseRef;U">U</a><span class="delimiter">]</span><a href="#akka.typed.AskPattern;PromiseRef" title="akka.typed.AskPattern.PromiseRef[U]" class="delimiter">(</a><a title="akka.typed.ActorRef[_]" id="akka.typed.AskPattern;PromiseRef.actorRef">actorRef</a>: <a href="ActorRef.scala.html#akka.typed;ActorRef" title="akka.typed.ActorRef[_]">ActorRef</a><span class="delimiter">[</span>_<span class="delimiter">]</span>, <a title="akka.util.Timeout" id="akka.typed.AskPattern;PromiseRef.timeout">timeout</a>: <a href="../../../actor/akka/util/Timeout.scala.html#akka.util;Timeout" title="akka.util.Timeout">Timeout</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    val <span title="(akka.typed.ActorRef[U], scala.concurrent.Future[U], akka.pattern.PromiseActorRef)" class="delimiter">(</span><a href="#akka.typed.AskPattern;PromiseRef.x$1" title="akka.typed.ActorRef[U]" id="akka.typed.AskPattern;PromiseRef.ref">ref</a>: <a href="ActorRef.scala.html#akka.typed;ActorRef" title="akka.typed.ActorRef[U]">ActorRef</a><span class="delimiter">[</span>U<span class="delimiter">]</span>, <a href="#akka.typed.AskPattern;PromiseRef.x$1" title="scala.concurrent.Future[U]" id="akka.typed.AskPattern;PromiseRef.future">future</a>: <span title="scala.concurrent.Future[U]">Future</span><span class="delimiter">[</span>U<span class="delimiter">]</span>, <a href="#akka.typed.AskPattern;PromiseRef.x$1" title="akka.pattern.PromiseActorRef" id="akka.typed.AskPattern;PromiseRef.promiseRef">promiseRef</a>: <a href="../../../actor/akka/pattern/AskSupport.scala.html#akka.pattern;PromiseActorRef" title="akka.pattern.PromiseActorRef">PromiseActorRef</a><span class="delimiter">)</span> = <a href="#akka.typed.AskPattern;PromiseRef.actorRef" title="akka.typed.ActorRef[_]">actorRef</a>.<a href="ActorRef.scala.html#akka.typed;ActorRef.untypedRef" title="=&gt; akka.actor.ActorRef">untypedRef</a> match <span class="delimiter">{</span>
      case <span title="akka.actor.InternalActorRef">ref</span>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;InternalActorRef" title="akka.actor.InternalActorRef">InternalActorRef</a> if <span title="akka.actor.InternalActorRef">ref</span>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;InternalActorRef.isTerminated" title="=&gt; Boolean">isTerminated</a> ⇒
        <span title="(_1: akka.typed.ActorRef[U], _2: scala.concurrent.Future[U])(akka.typed.ActorRef[U], scala.concurrent.Future[U])" class="delimiter">(</span><a href="ActorRef.scala.html#akka.typed.ActorRef.apply" title="[T](ref: akka.actor.ActorRef)akka.typed.ActorRef[T]">ActorRef</a><span title="(ref: akka.actor.ActorRef)akka.typed.ActorRef[U]" class="delimiter">[</span><a href="#akka.typed.AskPattern;PromiseRef;U" title="U">U</a><span class="delimiter">]</span><span class="delimiter">(</span><span title="akka.actor.InternalActorRef">ref</span>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;InternalActorRef.provider" title="=&gt; akka.actor.ActorRefProvider">provider</a>.<a href="../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefProvider.deadLetters" title="=&gt; akka.actor.ActorRef">deadLetters</a><span class="delimiter">)</span>,
          <span title="scala.concurrent.Future.type">Future</span>.<span title="[T](exception: Throwable)scala.concurrent.Future[T]">failed</span><span title="(exception: Throwable)scala.concurrent.Future[U]" class="delimiter">[</span><a href="#akka.typed.AskPattern;PromiseRef;U" title="U">U</a><span class="delimiter">]</span><span class="delimiter">(</span>new <a href="../../../actor/akka/pattern/AskSupport.scala.html#akka.pattern;AskTimeoutException" title="akka.pattern.AskTimeoutException">AskTimeoutException</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Recipient[&quot;)">Recipient[$</span><a href="#akka.typed.AskPattern;PromiseRef.actorRef" title="akka.typed.ActorRef[_]">actorRef</a><span title="String(&quot;] had already been terminated.&quot;)" class="string">] had already been terminated.&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      case <span title="akka.actor.InternalActorRef">ref</span>: <a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;InternalActorRef" title="akka.actor.InternalActorRef">InternalActorRef</a> ⇒
        if <span class="delimiter">(</span><a href="#akka.typed.AskPattern;PromiseRef.timeout" title="akka.util.Timeout">timeout</a>.<a href="../../../actor/akka/util/Timeout.scala.html#akka.util;Timeout.duration" title="=&gt; scala.concurrent.duration.FiniteDuration">duration</a>.<span title="=&gt; Long">length</span> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
          <span title="(_1: akka.typed.ActorRef[U], _2: scala.concurrent.Future[U])(akka.typed.ActorRef[U], scala.concurrent.Future[U])" class="delimiter">(</span><a href="ActorRef.scala.html#akka.typed.ActorRef.apply" title="[T](ref: akka.actor.ActorRef)akka.typed.ActorRef[T]">ActorRef</a><span title="(ref: akka.actor.ActorRef)akka.typed.ActorRef[U]" class="delimiter">[</span><a href="#akka.typed.AskPattern;PromiseRef;U" title="U">U</a><span class="delimiter">]</span><span class="delimiter">(</span><span title="akka.actor.InternalActorRef">ref</span>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;InternalActorRef.provider" title="=&gt; akka.actor.ActorRefProvider">provider</a>.<a href="../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefProvider.deadLetters" title="=&gt; akka.actor.ActorRef">deadLetters</a><span class="delimiter">)</span>,
            <span title="scala.concurrent.Future.type">Future</span>.<span title="[T](exception: Throwable)scala.concurrent.Future[T]">failed</span><span title="(exception: Throwable)scala.concurrent.Future[U]" class="delimiter">[</span><a href="#akka.typed.AskPattern;PromiseRef;U" title="U">U</a><span class="delimiter">]</span><span class="delimiter">(</span>new <span title="IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Timeout length must not be negative, question not sent to [&quot;)">Timeout length must not be negative, question not sent to [$</span><a href="#akka.typed.AskPattern;PromiseRef.actorRef" title="akka.typed.ActorRef[_]">actorRef</a><span title="String(&quot;]&quot;)" class="string">]&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        else <span class="delimiter">{</span>
          val <a title="akka.pattern.PromiseActorRef" id="akka.typed.AskPattern;PromiseRef.x$1.a">a</a> = <a href="../../../actor/akka/pattern/AskSupport.scala.html#akka.pattern.PromiseActorRef.apply(4d3891c5b5)" title="(provider: akka.actor.ActorRefProvider, timeout: akka.util.Timeout, targetName: Any, messageClassName: String, sender: akka.actor.ActorRef)akka.pattern.PromiseActorRef">PromiseActorRef</a><span class="delimiter">(</span><span title="akka.actor.InternalActorRef">ref</span>.<a href="../../../actor/akka/actor/ActorRef.scala.html#akka.actor;InternalActorRef.provider" title="=&gt; akka.actor.ActorRefProvider">provider</a>, <a href="#akka.typed.AskPattern;PromiseRef.timeout" title="akka.util.Timeout">timeout</a>, <a href="#akka.typed.AskPattern;PromiseRef.actorRef" title="akka.typed.ActorRef[_]">actorRef</a>, <span title="String(&quot;unknown&quot;)" class="string">&quot;unknown&quot;</span><span class="delimiter">)</span>
          val <a title="akka.typed.ActorRef[U]" id="akka.typed.AskPattern;PromiseRef.x$1.b">b</a> = <a href="ActorRef.scala.html#akka.typed.ActorRef.apply" title="[T](ref: akka.actor.ActorRef)akka.typed.ActorRef[T]">ActorRef</a><span title="(ref: akka.actor.ActorRef)akka.typed.ActorRef[U]" class="delimiter">[</span><a href="#akka.typed.AskPattern;PromiseRef;U" title="U">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.typed.AskPattern;PromiseRef.x$1.a" title="akka.pattern.PromiseActorRef">a</a><span class="delimiter">)</span>
          <span title="(_1: akka.typed.ActorRef[U], _2: scala.concurrent.Future[U], _3: akka.pattern.PromiseActorRef)(akka.typed.ActorRef[U], scala.concurrent.Future[U], akka.pattern.PromiseActorRef)" class="delimiter">(</span><a href="#akka.typed.AskPattern;PromiseRef.x$1.b" title="akka.typed.ActorRef[U]">b</a>, <a href="#akka.typed.AskPattern;PromiseRef.x$1.a" title="akka.pattern.PromiseActorRef">a</a>.<a href="../../../actor/akka/pattern/AskSupport.scala.html#akka.pattern;PromiseActorRef.result" title="=&gt; scala.concurrent.Promise[Any]">result</a>.<span title="=&gt; scala.concurrent.Future[Any]">future</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.concurrent.Future[U]" class="delimiter">[</span><span title="scala.concurrent.Future[U]">Future</span><span class="delimiter">[</span>U<span class="delimiter">]</span><span class="delimiter">]</span>, <a href="#akka.typed.AskPattern;PromiseRef.x$1.a" title="akka.pattern.PromiseActorRef">a</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      case _ ⇒ throw new <span title="IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;cannot create PromiseRef for non-Akka ActorRef (&quot;)">cannot create PromiseRef for non-Akka ActorRef ($</span><span class="delimiter">{</span><a href="#akka.typed.AskPattern;PromiseRef.actorRef" title="akka.typed.ActorRef[_]">actorRef</a>.<span title="()Class[_]">getClass</span><span class="delimiter">}</span><span title="String(&quot;)&quot;)" class="string">)&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private object <a title="akka.typed.AskPattern.PromiseRef.type" id="akka.typed.AskPattern.PromiseRef">PromiseRef</a> <a href="#akka.typed.AskPattern.PromiseRef" title="akka.typed.AskPattern.PromiseRef.type" class="delimiter">{</a>
    def <a title="[U](actorRef: akka.typed.ActorRef[_])(implicit timeout: akka.util.Timeout)akka.typed.AskPattern.PromiseRef[U]" id="akka.typed.AskPattern.PromiseRef.apply">apply</a><span class="delimiter">[</span><a title="" id="akka.typed.AskPattern.PromiseRef.apply;U">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="akka.typed.ActorRef[_]" id="akka.typed.AskPattern.PromiseRef.apply.actorRef">actorRef</a>: <a href="ActorRef.scala.html#akka.typed;ActorRef" title="akka.typed.ActorRef[_]">ActorRef</a><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span>implicit <a title="akka.util.Timeout" id="akka.typed.AskPattern.PromiseRef.apply.timeout">timeout</a>: <a href="../../../actor/akka/util/Timeout.scala.html#akka.util;Timeout" title="akka.util.Timeout">Timeout</a><span class="delimiter">)</span> = new <a href="#akka.typed.AskPattern;PromiseRef" title="akka.typed.AskPattern.PromiseRef[U]">PromiseRef</a><span class="delimiter">[</span>U<span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.typed.AskPattern.PromiseRef.apply.actorRef" title="akka.typed.ActorRef[_]">actorRef</a>, <a href="#akka.typed.AskPattern.PromiseRef.apply.timeout" title="akka.util.Timeout">timeout</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private<span class="delimiter">[</span>typed<span class="delimiter">]</span> def <a title="[T, U](actorRef: akka.typed.ActorRef[T], timeout: akka.util.Timeout, f: akka.typed.ActorRef[U] =&gt; T)scala.concurrent.Future[U]" id="akka.typed.AskPattern.ask">ask</a><span class="delimiter">[</span><a title="" id="akka.typed.AskPattern.ask;T">T</a>, <a title="" id="akka.typed.AskPattern.ask;U">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="akka.typed.ActorRef[T]" id="akka.typed.AskPattern.ask.actorRef">actorRef</a>: <a href="ActorRef.scala.html#akka.typed;ActorRef" title="akka.typed.ActorRef[T]">ActorRef</a><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="akka.util.Timeout" id="akka.typed.AskPattern.ask.timeout">timeout</a>: <a href="../../../actor/akka/util/Timeout.scala.html#akka.util;Timeout" title="akka.util.Timeout">Timeout</a>, <a title="akka.typed.ActorRef[U] =&gt; T" id="akka.typed.AskPattern.ask.f">f</a>: ActorRef<span class="delimiter">[</span>U<span class="delimiter">]</span> ⇒ T<span class="delimiter">)</span>: <span title="scala.concurrent.Future[U]">Future</span><span class="delimiter">[</span>U<span class="delimiter">]</span> = <span class="delimiter">{</span>
    val <a title="akka.typed.AskPattern.PromiseRef[U]" id="akka.typed.AskPattern.ask.p">p</a> = <a href="#akka.typed.AskPattern.PromiseRef.apply" title="[U](actorRef: akka.typed.ActorRef[_])(implicit timeout: akka.util.Timeout)akka.typed.AskPattern.PromiseRef[U]">PromiseRef</a><span title="(actorRef: akka.typed.ActorRef[_])(implicit timeout: akka.util.Timeout)akka.typed.AskPattern.PromiseRef[U]" class="delimiter">[</span><a href="#akka.typed.AskPattern.ask;U" title="U">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.typed.AskPattern.ask.actorRef" title="akka.typed.ActorRef[T]">actorRef</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.typed.AskPattern.ask.timeout" title="akka.util.Timeout">timeout</a><span class="delimiter">)</span>
    val <a title="T" id="akka.typed.AskPattern.ask.m">m</a> = <a href="#akka.typed.AskPattern.ask.f" title="(v1: akka.typed.ActorRef[U])T">f</a><span class="delimiter">(</span><a href="#akka.typed.AskPattern.ask.p" title="akka.typed.AskPattern.PromiseRef[U]">p</a>.<a href="#akka.typed.AskPattern;PromiseRef.ref" title="=&gt; akka.typed.ActorRef[U]">ref</a><span class="delimiter">)</span>
    <a href="#akka.typed.AskPattern.ask.p" title="akka.typed.AskPattern.PromiseRef[U]">p</a>.<a href="#akka.typed.AskPattern;PromiseRef.promiseRef" title="=&gt; akka.pattern.PromiseActorRef">promiseRef</a>.<a href="../../../actor/akka/pattern/AskSupport.scala.html#akka.pattern;PromiseActorRef.messageClassName_=" title="(x$1: String)Unit">messageClassName</a> = <a href="#akka.typed.AskPattern.ask.m" title="T">m</a>.<span title="()Class[_]">getClass</span>.<span title="()String">getName</span>
    <a href="ActorRef.scala.html#akka.typed.ActorRef.toScalaActorRef" title="(ref: akka.typed.ActorRef[T])akka.typed.ScalaActorRef[T]">actorRef</a> <a href="ActorRef.scala.html#akka.typed;ScalaActorRef.!" title="(msg: T)Unit">!</a> <a href="#akka.typed.AskPattern.ask.m" title="T">m</a>
    <a href="#akka.typed.AskPattern.ask.p" title="akka.typed.AskPattern.PromiseRef[U]">p</a>.<a href="#akka.typed.AskPattern;PromiseRef.future" title="=&gt; scala.concurrent.Future[U]">future</a>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
