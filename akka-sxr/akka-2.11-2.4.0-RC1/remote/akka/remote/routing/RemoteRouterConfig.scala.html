<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>remote/akka/remote/routing/RemoteRouterConfig.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>
package akka.remote.routing

import java.util.concurrent.atomic.AtomicInteger

import akka.actor.ActorCell
import akka.actor.ActorContext
import akka.actor.ActorSystem
import akka.actor.Address
import akka.actor.Deploy
import akka.actor.Props
import akka.actor.SupervisorStrategy
import akka.japi.<a href="../../../../actor/akka/japi/JavaAPI.scala.html#akka.japi.Util" title="akka.japi.Util.type">Util</a>.immutableSeq
import akka.remote.RemoteScope
import akka.routing.ActorRefRoutee
import akka.routing.Pool
import akka.routing.Resizer
import akka.routing.Routee
import akka.routing.Router
import akka.routing.RouterActor
import akka.routing.RouterConfig
import com.typesafe.config.ConfigFactory

<span class="comment">/**
 * [[akka.routing.RouterConfig]] implementation for remote deployment on defined
 * target nodes. Delegates other duties to the local [[akka.routing.Pool]],
 * which makes it possible to mix this with the built-in routers such as
 * [[akka.routing.RoundRobinGroup]] or custom routers.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
final case class <a title="class RemoteRouterConfig extends AnyRef with akka.routing.Pool with Product with Serializable" id="akka.remote.routing.RemoteRouterConfig.readResolve">RemoteRouterConfig</a><span title="Product" class="delimiter">(</span><a title="akka.routing.Pool" id="akka.remote.routing;RemoteRouterConfig.local">local</a>: <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;Pool" title="akka.routing.Pool">Pool</a>, <a title="Iterable[akka.actor.Address]" id="akka.remote.routing;RemoteRouterConfig.nodes">nodes</a>: <span title="Iterable[akka.actor.Address]">Iterable</span><span class="delimiter">[</span>Address<span class="delimiter">]</span><span class="delimiter">)</span> extends <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;Pool" title="akka.routing.Pool">Pool</a> <span class="delimiter">{</span>

  <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#akka.remote.routing;RemoteRouterConfig.nodes" title="=&gt; Iterable[akka.actor.Address]">nodes</a>.<span title="=&gt; Boolean">nonEmpty</span>, <span title="String(&quot;Must specify list of remote target.nodes&quot;)" class="string">&quot;Must specify list of remote target.nodes&quot;</span><span class="delimiter">)</span>

  def this<span class="delimiter">(</span><a title="akka.routing.Pool" id="akka.remote.routing;RemoteRouterConfig.<init>(ff8c672964).local">local</a>: <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;Pool" title="akka.routing.Pool">Pool</a>, <a title="Iterable[akka.actor.Address]" id="akka.remote.routing;RemoteRouterConfig.<init>(ff8c672964).nodes">nodes</a>: java.lang.<span title="Iterable[akka.actor.Address]">Iterable</span><span class="delimiter">[</span>Address<span class="delimiter">]</span><span class="delimiter">)</span> = this<span class="delimiter">(</span><a href="#akka.remote.routing;RemoteRouterConfig.<init>(ff8c672964).local" title="akka.routing.Pool">local</a>, <a href="../../../../actor/akka/japi/JavaAPI.scala.html#akka.japi.Util.immutableSeq(42d3e3f9ec)" title="(iterable: Iterable[akka.actor.Address])scala.collection.immutable.Seq[akka.actor.Address]">immutableSeq</a><span class="delimiter">(</span><a href="#akka.remote.routing;RemoteRouterConfig.<init>(ff8c672964).nodes" title="Iterable[akka.actor.Address]">nodes</a><span class="delimiter">)</span><span class="delimiter">)</span>
  def this<span class="delimiter">(</span><a title="akka.routing.Pool" id="akka.remote.routing;RemoteRouterConfig.<init>(094d8a6f1d).local">local</a>: <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;Pool" title="akka.routing.Pool">Pool</a>, <a title="Array[akka.actor.Address]" id="akka.remote.routing;RemoteRouterConfig.<init>(094d8a6f1d).nodes">nodes</a>: <span title="Array[akka.actor.Address]">Array</span><span class="delimiter">[</span>Address<span class="delimiter">]</span><span class="delimiter">)</span> = this<span class="delimiter">(</span><a href="#akka.remote.routing;RemoteRouterConfig.<init>(094d8a6f1d).local" title="akka.routing.Pool">local</a>, <a href="#akka.remote.routing;RemoteRouterConfig.<init>(094d8a6f1d).nodes" title="(xs: Array[akka.actor.Address])scala.collection.mutable.WrappedArray[akka.actor.Address]">nodes</a>: <span title="Iterable[akka.actor.Address]">Iterable</span><span class="delimiter">[</span>Address<span class="delimiter">]</span><span class="delimiter">)</span>

  <span class="comment">// need this iterator as instance variable since Resizer may call createRoutees several times</span>
  @transient private val <a title="Iterator[akka.actor.Address]" id="akka.remote.routing;RemoteRouterConfig.nodeAddressIter">nodeAddressIter</a>: <span title="Iterator[akka.actor.Address]">Iterator</span><span class="delimiter">[</span>Address<span class="delimiter">]</span> = <span title="=&gt; collection.immutable.Stream.type">Stream</span>.<span title="(elem: =&gt; Iterable[akka.actor.Address])scala.collection.immutable.Stream[Iterable[akka.actor.Address]]">continually</span><span class="delimiter">(</span><a href="#akka.remote.routing;RemoteRouterConfig.nodes" title="=&gt; Iterable[akka.actor.Address]">nodes</a><span class="delimiter">)</span>.<span title="(implicit asTraversable: Iterable[akka.actor.Address] =&gt; scala.collection.GenTraversableOnce[akka.actor.Address])scala.collection.immutable.Stream[akka.actor.Address]">flatten</span>.<span title="=&gt; Iterator[akka.actor.Address]">iterator</span>
  <span class="comment">// need this counter as instance variable since Resizer may call createRoutees several times</span>
  @transient private val <a title="java.util.concurrent.atomic.AtomicInteger" id="akka.remote.routing;RemoteRouterConfig.childNameCounter">childNameCounter</a> = new <span title="java.util.concurrent.atomic.AtomicInteger">AtomicInteger</span>

  override def <a title="(system: akka.actor.ActorSystem)akka.routing.Router" id="akka.remote.routing;RemoteRouterConfig.createRouter">createRouter</a><span class="delimiter">(</span><a title="akka.actor.ActorSystem" id="akka.remote.routing;RemoteRouterConfig.createRouter.system">system</a>: <a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem" title="akka.actor.ActorSystem">ActorSystem</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing;Router" title="akka.routing.Router">Router</a> = <a href="#akka.remote.routing;RemoteRouterConfig.local" title="=&gt; akka.routing.Pool">local</a>.<a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;RouterConfig.createRouter" title="(system: akka.actor.ActorSystem)akka.routing.Router">createRouter</a><span class="delimiter">(</span><a href="#akka.remote.routing;RemoteRouterConfig.createRouter.system" title="akka.actor.ActorSystem">system</a><span class="delimiter">)</span>

  override def <a title="(sys: akka.actor.ActorSystem)Int" id="akka.remote.routing;RemoteRouterConfig.nrOfInstances(390f5afb1b)">nrOfInstances</a><span class="delimiter">(</span><a title="akka.actor.ActorSystem" id="akka.remote.routing;RemoteRouterConfig.nrOfInstances(390f5afb1b).sys">sys</a>: <a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem" title="akka.actor.ActorSystem">ActorSystem</a><span class="delimiter">)</span>: <span title="Int">Int</span> = <a href="#akka.remote.routing;RemoteRouterConfig.local" title="=&gt; akka.routing.Pool">local</a>.<a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;Pool.nrOfInstances(390f5afb1b)" title="(sys: akka.actor.ActorSystem)Int">nrOfInstances</a><span class="delimiter">(</span><a href="#akka.remote.routing;RemoteRouterConfig.nrOfInstances(390f5afb1b).sys" title="akka.actor.ActorSystem">sys</a><span class="delimiter">)</span>

  override def <a title="(routeeProps: akka.actor.Props, context: akka.actor.ActorContext)akka.routing.Routee" id="akka.remote.routing;RemoteRouterConfig.newRoutee">newRoutee</a><span class="delimiter">(</span><a title="akka.actor.Props" id="akka.remote.routing;RemoteRouterConfig.newRoutee.routeeProps">routeeProps</a>: <a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props" title="akka.actor.Props">Props</a>, <a title="akka.actor.ActorContext" id="akka.remote.routing;RemoteRouterConfig.newRoutee.context">context</a>: <a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext" title="akka.actor.ActorContext">ActorContext</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing;Routee" title="akka.routing.Routee">Routee</a> = <span class="delimiter">{</span>
    val name = <span title="String(&quot;c&quot;)" class="string">&quot;c&quot;</span> <a title="String" id="akka.remote.routing;RemoteRouterConfig.newRoutee.name">+</a> <a href="#akka.remote.routing;RemoteRouterConfig.childNameCounter" title="=&gt; java.util.concurrent.atomic.AtomicInteger">childNameCounter</a>.<span title="()Int">incrementAndGet</span>
    val <a title="akka.actor.Deploy" id="akka.remote.routing;RemoteRouterConfig.newRoutee.deploy">deploy</a> = <a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy.apply$default$1" title="String" id="akka.remote.routing;RemoteRouterConfig.newRoutee.deploy.x$6">Deploy</a><span class="delimiter">(</span>config = <span title="com.typesafe.config.ConfigFactory.type">ConfigFactory</span>.<span title="()com.typesafe.config.Config">empty</span><a title="com.typesafe.config.Config" id="akka.remote.routing;RemoteRouterConfig.newRoutee.deploy.x$1" class="delimiter">(</a><span class="delimiter">)</span>, routerConfig = <a href="#akka.remote.routing;RemoteRouterConfig.newRoutee.routeeProps" title="akka.actor.Props">routeeProps</a>.<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.routerConfig" title="akka.routing.RouterConfig" id="akka.remote.routing;RemoteRouterConfig.newRoutee.deploy.x$2">routerConfig</a>,
      scope = <a href="../RemoteDeployer.scala.html#akka.remote;RemoteScope" title="(node: akka.actor.Address)akka.remote.RemoteScope">RemoteScope</a><a title="akka.remote.RemoteScope" id="akka.remote.routing;RemoteRouterConfig.newRoutee.deploy.x$3" class="delimiter">(</a><a href="#akka.remote.routing;RemoteRouterConfig.nodeAddressIter" title="=&gt; Iterator[akka.actor.Address]">nodeAddressIter</a>.<span title="()akka.actor.Address">next</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="comment">// attachChild means that the provider will treat this call as if possibly done out of the wrong</span>
    <span class="comment">// context and use RepointableActorRef instead of LocalActorRef. Seems like a slightly sub-optimal</span>
    <span class="comment">// choice in a corner case (and hence not worth fixing).</span>
    val <a title="akka.actor.ActorRef" id="akka.remote.routing;RemoteRouterConfig.newRoutee.ref">ref</a> = <a href="#akka.remote.routing;RemoteRouterConfig.newRoutee.context" title="akka.actor.ActorContext">context</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.actor.ActorCell" class="delimiter">[</span><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorCell" title="akka.actor.ActorCell">ActorCell</a><span class="delimiter">]</span>.<a href="../../../../actor/akka/actor/dungeon/Children.scala.html#akka.actor.dungeon;Children.attachChild(f2c4c88db4)" title="(props: akka.actor.Props, name: String, systemService: Boolean)akka.actor.ActorRef">attachChild</a><span class="delimiter">(</span>
      <a href="#akka.remote.routing;RemoteRouterConfig.local" title="=&gt; akka.routing.Pool">local</a>.<a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;Pool.enrichWithPoolDispatcher" title="(routeeProps: akka.actor.Props, context: akka.actor.ActorContext)akka.actor.Props">enrichWithPoolDispatcher</a><span class="delimiter">(</span><a href="#akka.remote.routing;RemoteRouterConfig.newRoutee.routeeProps" title="akka.actor.Props">routeeProps</a>, <a href="#akka.remote.routing;RemoteRouterConfig.newRoutee.context" title="akka.actor.ActorContext">context</a><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.withDeploy" title="(d: akka.actor.Deploy)akka.actor.Props">withDeploy</a><span class="delimiter">(</span><a href="#akka.remote.routing;RemoteRouterConfig.newRoutee.deploy" title="akka.actor.Deploy">deploy</a><span class="delimiter">)</span>, <a href="#akka.remote.routing;RemoteRouterConfig.newRoutee.name" title="String">name</a>, systemService = false<span class="delimiter">)</span>
    <a href="../../../../actor/akka/routing/Router.scala.html#akka.routing;ActorRefRoutee" title="(ref: akka.actor.ActorRef)akka.routing.ActorRefRoutee">ActorRefRoutee</a><span class="delimiter">(</span><a href="#akka.remote.routing;RemoteRouterConfig.newRoutee.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  override def <a title="()akka.routing.RouterActor" id="akka.remote.routing;RemoteRouterConfig.createRouterActor">createRouterActor</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/routing/RoutedActorCell.scala.html#akka.routing;RouterActor" title="akka.routing.RouterActor">RouterActor</a> = <a href="#akka.remote.routing;RemoteRouterConfig.local" title="=&gt; akka.routing.Pool">local</a>.<a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;Pool.createRouterActor" title="()akka.routing.RouterActor">createRouterActor</a><span class="delimiter">(</span><span class="delimiter">)</span>

  override def <a title="=&gt; akka.actor.SupervisorStrategy" id="akka.remote.routing;RemoteRouterConfig.supervisorStrategy">supervisorStrategy</a>: <a href="../../../../actor/akka/actor/FaultHandling.scala.html#akka.actor;SupervisorStrategy" title="akka.actor.SupervisorStrategy">SupervisorStrategy</a> = <a href="#akka.remote.routing;RemoteRouterConfig.local" title="=&gt; akka.routing.Pool">local</a>.<a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;Pool.supervisorStrategy" title="=&gt; akka.actor.SupervisorStrategy">supervisorStrategy</a>

  override def <a title="=&gt; String" id="akka.remote.routing;RemoteRouterConfig.routerDispatcher">routerDispatcher</a>: <span title="String">String</span> = <a href="#akka.remote.routing;RemoteRouterConfig.local" title="=&gt; akka.routing.Pool">local</a>.<a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;RouterConfig.routerDispatcher" title="=&gt; String">routerDispatcher</a>

  override def <a title="=&gt; Option[akka.routing.Resizer]" id="akka.remote.routing;RemoteRouterConfig.resizer">resizer</a>: <span title="Option[akka.routing.Resizer]">Option</span><span class="delimiter">[</span>Resizer<span class="delimiter">]</span> = <a href="#akka.remote.routing;RemoteRouterConfig.local" title="=&gt; akka.routing.Pool">local</a>.<a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;Pool.resizer" title="=&gt; Option[akka.routing.Resizer]">resizer</a>

  override def <a title="(other: akka.routing.RouterConfig)akka.routing.RouterConfig" id="akka.remote.routing;RemoteRouterConfig.withFallback">withFallback</a><span class="delimiter">(</span><a title="akka.routing.RouterConfig" id="akka.remote.routing;RemoteRouterConfig.withFallback.other">other</a>: <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;RouterConfig" title="akka.routing.RouterConfig">RouterConfig</a><span class="delimiter">)</span>: <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;RouterConfig" title="akka.routing.RouterConfig">RouterConfig</a> = <a href="#akka.remote.routing;RemoteRouterConfig.withFallback.other" title="akka.routing.RouterConfig">other</a> match <span class="delimiter">{</span>
    case RemoteRouterConfig<span class="delimiter">(</span><span title="akka.remote.routing.RemoteRouterConfig">local</span>: <a href="#akka.remote.routing.RemoteRouterConfig.readResolve" title="akka.remote.routing.RemoteRouterConfig">RemoteRouterConfig</a>, <span title="Iterable[akka.actor.Address]">nodes</span><span class="delimiter">)</span> ⇒ throw new <span title="IllegalStateException">IllegalStateException</span><span class="delimiter">(</span>
      <span title="String(&quot;RemoteRouterConfig is not allowed to wrap a RemoteRouterConfig&quot;)" class="string">&quot;RemoteRouterConfig is not allowed to wrap a RemoteRouterConfig&quot;</span><span class="delimiter">)</span>
    case RemoteRouterConfig<span class="delimiter">(</span><span title="akka.routing.Pool">local</span>: <a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;Pool" title="akka.routing.Pool">Pool</a>, <span title="Iterable[akka.actor.Address]">nodes</span><span class="delimiter">)</span> ⇒
      <a href="#akka.remote.routing.RemoteRouterConfig.readResolve" title="(local: akka.routing.Pool, nodes: Iterable[akka.actor.Address])akka.remote.routing.RemoteRouterConfig">copy</a><span class="delimiter">(</span>local = this.<a href="#akka.remote.routing;RemoteRouterConfig.local" title="=&gt; akka.routing.Pool">local</a>.<a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;RouterConfig.withFallback" title="(other: akka.routing.RouterConfig)akka.routing.RouterConfig">withFallback</a><span class="delimiter">(</span><span title="akka.routing.Pool">local</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.routing.Pool" class="delimiter">[</span><a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;Pool" title="akka.routing.Pool">Pool</a><span class="delimiter">]</span><span class="delimiter">)</span>
    case _ ⇒ <a href="#akka.remote.routing.RemoteRouterConfig.readResolve" title="(local: akka.routing.Pool, nodes: Iterable[akka.actor.Address])akka.remote.routing.RemoteRouterConfig">copy</a><span class="delimiter">(</span>local = this.<a href="#akka.remote.routing;RemoteRouterConfig.local" title="=&gt; akka.routing.Pool">local</a>.<a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;RouterConfig.withFallback" title="(other: akka.routing.RouterConfig)akka.routing.RouterConfig">withFallback</a><span class="delimiter">(</span><a href="#akka.remote.routing;RemoteRouterConfig.withFallback.other" title="akka.routing.RouterConfig">other</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="akka.routing.Pool" class="delimiter">[</span><a href="../../../../actor/akka/routing/RouterConfig.scala.html#akka.routing;Pool" title="akka.routing.Pool">Pool</a><span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>
        </pre>
    </body>
</html>
