<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>persistence/akka/persistence/snapshot/SnapshotStore.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 * Copyright (C) 2012-2013 Eligotech BV.
 */</span>

package akka.persistence.snapshot

import scala.concurrent.duration._
import scala.concurrent.Future
import akka.actor._
import akka.pattern.pipe
import akka.persistence._
import akka.pattern.CircuitBreaker

<span class="comment">/**
 * Abstract snapshot store.
 */</span>
trait <a title="trait SnapshotStore extends AnyRef with akka.actor.Actor with akka.actor.ActorLogging" id="akka.persistence.snapshot;SnapshotStore">SnapshotStore</a> extends <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> with <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="delimiter">{</span>
  import <a href="../SnapshotProtocol.scala.html#akka.persistence.SnapshotProtocol" title="akka.persistence.SnapshotProtocol.type">SnapshotProtocol</a>._
  import <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher

  private val <a title="akka.persistence.Persistence" id="akka.persistence.snapshot;SnapshotStore.extension">extension</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.persistence.Persistence">Persistence</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>
  private val <a title="Boolean" id="akka.persistence.snapshot;SnapshotStore.publish">publish</a> = <a href="#akka.persistence.snapshot;SnapshotStore.extension" title="=&gt; akka.persistence.Persistence">extension</a>.<a href="../Persistence.scala.html#akka.persistence;Persistence.settings" title="=&gt; akka.persistence.PersistenceSettings">settings</a>.<a href="../Persistence.scala.html#akka.persistence;PersistenceSettings.internal" title="SnapshotStore.this.extension.settings.internal.type">internal</a>.<a href="../Persistence.scala.html#akka.persistence;PersistenceSettings.internal.publishPluginCommands" title="=&gt; Boolean">publishPluginCommands</a>

  private val <a title="akka.pattern.CircuitBreaker" id="akka.persistence.snapshot;SnapshotStore.breaker">breaker</a> = <span class="delimiter">{</span>
    val <a title="com.typesafe.config.Config" id="akka.persistence.snapshot;SnapshotStore.breaker.cfg">cfg</a> = <a href="#akka.persistence.snapshot;SnapshotStore.extension" title="=&gt; akka.persistence.Persistence">extension</a>.<a href="../Persistence.scala.html#akka.persistence;Persistence.configFor" title="(journalPluginActor: akka.actor.ActorRef)com.typesafe.config.Config">configFor</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
    val <a title="Int" id="akka.persistence.snapshot;SnapshotStore.breaker.maxFailures">maxFailures</a> = <a href="#akka.persistence.snapshot;SnapshotStore.breaker.cfg" title="com.typesafe.config.Config">cfg</a>.<span title="(x$1: String)Int">getInt</span><span class="delimiter">(</span><span title="String(&quot;circuit-breaker.max-failures&quot;)" class="string">&quot;circuit-breaker.max-failures&quot;</span><span class="delimiter">)</span>
    val <a title="scala.concurrent.duration.FiniteDuration" id="akka.persistence.snapshot;SnapshotStore.breaker.callTimeout">callTimeout</a> = <a href="#akka.persistence.snapshot;SnapshotStore.breaker.cfg" title="com.typesafe.config.Config">cfg</a>.<span title="(x$1: String, x$2: java.util.concurrent.TimeUnit)Long">getDuration</span><span title="implicit scala.concurrent.duration.package.DurationLong : (n: Long)concurrent.duration.DurationLong" class="delimiter">(</span><span title="String(&quot;circuit-breaker.call-timeout&quot;)" class="string">&quot;circuit-breaker.call-timeout&quot;</span>, <span title="java.util.concurrent.TimeUnit(MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">millis</span>
    val <a title="scala.concurrent.duration.FiniteDuration" id="akka.persistence.snapshot;SnapshotStore.breaker.resetTimeout">resetTimeout</a> = <a href="#akka.persistence.snapshot;SnapshotStore.breaker.cfg" title="com.typesafe.config.Config">cfg</a>.<span title="(x$1: String, x$2: java.util.concurrent.TimeUnit)Long">getDuration</span><span title="implicit scala.concurrent.duration.package.DurationLong : (n: Long)concurrent.duration.DurationLong" class="delimiter">(</span><span title="String(&quot;circuit-breaker.reset-timeout&quot;)" class="string">&quot;circuit-breaker.reset-timeout&quot;</span>, <span title="java.util.concurrent.TimeUnit(MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>.<span title="=&gt; scala.concurrent.duration.FiniteDuration">millis</span>
    <a href="../../../../actor/akka/pattern/CircuitBreaker.scala.html#akka.pattern.CircuitBreaker.apply" title="(scheduler: akka.actor.Scheduler, maxFailures: Int, callTimeout: scala.concurrent.duration.FiniteDuration, resetTimeout: scala.concurrent.duration.FiniteDuration)akka.pattern.CircuitBreaker">CircuitBreaker</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>, <a href="#akka.persistence.snapshot;SnapshotStore.breaker.maxFailures" title="Int">maxFailures</a>, <a href="#akka.persistence.snapshot;SnapshotStore.breaker.callTimeout" title="scala.concurrent.duration.FiniteDuration">callTimeout</a>, <a href="#akka.persistence.snapshot;SnapshotStore.breaker.resetTimeout" title="scala.concurrent.duration.FiniteDuration">resetTimeout</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  final def <a title="=&gt; PartialFunction[Any,Unit]" id="akka.persistence.snapshot;SnapshotStore.receive">receive</a> = <a href="#akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore" title="=&gt; akka.actor.Actor.Receive">receiveSnapshotStore</a>.<span title="[A1, B1 &gt;: Unit](that: PartialFunction[A1,B1])PartialFunction[A1,B1]">orElse</span><span title="(that: PartialFunction[Any,Unit])PartialFunction[Any,Unit]" class="delimiter">[</span><span title="Any">Any</span>, <span title="Unit">Unit</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.receivePluginInternal" title="=&gt; akka.actor.Actor.Receive">receivePluginInternal</a><span class="delimiter">)</span>

  final val <a title="akka.actor.Actor.Receive" id="akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore">receiveSnapshotStore</a>: Actor.<span title="akka.actor.Actor.Receive">Receive</span> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case LoadSnapshot<span class="delimiter">(</span><span title="String">persistenceId</span>, <span title="akka.persistence.SnapshotSelectionCriteria">criteria</span>, <a title="Long" id="akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.isDefinedAt.toSequenceNr">toSequenceNr</a><span class="delimiter">)</span> ⇒
      <a href="#akka.persistence.snapshot;SnapshotStore.breaker" title="=&gt; akka.pattern.CircuitBreaker">breaker</a>.<a href="../../../../actor/akka/pattern/CircuitBreaker.scala.html#akka.pattern;CircuitBreaker.withCircuitBreaker" title="(body: =&gt; scala.concurrent.Future[Option[akka.persistence.SelectedSnapshot]])scala.concurrent.Future[Option[akka.persistence.SelectedSnapshot]]">withCircuitBreaker</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.loadAsync" title="(persistenceId: String, criteria: akka.persistence.SnapshotSelectionCriteria)scala.concurrent.Future[Option[akka.persistence.SelectedSnapshot]]">loadAsync</a><span class="delimiter">(</span><span title="String">persistenceId</span>, <span title="akka.persistence.SnapshotSelectionCriteria">criteria</span>.<a href="../SnapshotProtocol.scala.html#akka.persistence;SnapshotSelectionCriteria.limit" title="(toSequenceNr: Long)akka.persistence.SnapshotSelectionCriteria">limit</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.isDefinedAt.toSequenceNr" title="Long">toSequenceNr</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="(f: Option[akka.persistence.SelectedSnapshot] =&gt; akka.persistence.SnapshotProtocol.LoadSnapshotResult)(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[akka.persistence.SnapshotProtocol.LoadSnapshotResult]">map</a> <span class="delimiter">{</span>
        <a title="Option[akka.persistence.SelectedSnapshot]" id="akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.applyOrElse.$anonfun.sso">sso</a> ⇒ <a href="../SnapshotProtocol.scala.html#akka.persistence.SnapshotProtocol;LoadSnapshotResult" title="(snapshot: Option[akka.persistence.SelectedSnapshot], toSequenceNr: Long)akka.persistence.SnapshotProtocol.LoadSnapshotResult">LoadSnapshotResult</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.applyOrElse.$anonfun.sso" title="Option[akka.persistence.SelectedSnapshot]">sso</a>, <a href="#akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.isDefinedAt.toSequenceNr" title="Long">toSequenceNr</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <a href="../../../../actor/akka/pattern/PipeToSupport.scala.html#akka.pattern;PipeToSupport.pipe" title="(future: scala.concurrent.Future[akka.persistence.SnapshotProtocol.LoadSnapshotResult])(implicit executionContext: scala.concurrent.ExecutionContext)akka.pattern.PipeableFuture[akka.persistence.SnapshotProtocol.LoadSnapshotResult]">recover</a> <span title="&lt;$anon: Throwable =&gt; akka.persistence.SnapshotProtocol.LoadSnapshotResult&gt; extends scala.runtime.AbstractPartialFunction[Throwable,akka.persistence.SnapshotProtocol.LoadSnapshotResult] with Serializable" class="delimiter">{</span>
        case <span title="Throwable">e</span> ⇒ <a href="../SnapshotProtocol.scala.html#akka.persistence.SnapshotProtocol;LoadSnapshotResult" title="(snapshot: Option[akka.persistence.SelectedSnapshot], toSequenceNr: Long)akka.persistence.SnapshotProtocol.LoadSnapshotResult">LoadSnapshotResult</a><span title="Boolean(true)" class="delimiter">(</span><span title="None.type">None</span>, <a href="#akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.isDefinedAt.toSequenceNr" title="Long">toSequenceNr</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <a href="../../../../actor/akka/pattern/PipeToSupport.scala.html#akka.pattern;PipeToSupport;PipeableFuture.pipeTo" title="(recipient: akka.actor.ActorRef)(implicit sender: akka.actor.ActorRef)scala.concurrent.Future[akka.persistence.SnapshotProtocol.LoadSnapshotResult]">pipeTo</a> <a href="#akka.persistence.snapshot;SnapshotStore.senderPersistentActor" title="()akka.actor.ActorRef">senderPersistentActor</a><span class="delimiter">(</span><span class="delimiter">)</span>

    case SaveSnapshot<span class="delimiter">(</span><span title="akka.persistence.SnapshotMetadata">metadata</span>, <a title="Any" id="akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.isDefinedAt.snapshot">snapshot</a><span class="delimiter">)</span> ⇒
      val <a title="akka.persistence.SnapshotMetadata" id="akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.applyOrElse.md">md</a> = <span title="akka.persistence.SnapshotMetadata">metadata</span>.<a href="../SnapshotProtocol.scala.html#akka.persistence;SnapshotMetadata.copy$default$1" title="String" id="akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.applyOrElse.md.x$4">copy</a><span class="delimiter">(</span>timestamp = <span title="System.type">System</span>.<a title="Long" id="akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.applyOrElse.md.x$2">currentTimeMillis</a><span class="delimiter">)</span>
      <a href="#akka.persistence.snapshot;SnapshotStore.breaker" title="=&gt; akka.pattern.CircuitBreaker">breaker</a>.<a href="../../../../actor/akka/pattern/CircuitBreaker.scala.html#akka.pattern;CircuitBreaker.withCircuitBreaker" title="(body: =&gt; scala.concurrent.Future[Unit])scala.concurrent.Future[Unit]">withCircuitBreaker</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.saveAsync" title="(metadata: akka.persistence.SnapshotMetadata, snapshot: Any)scala.concurrent.Future[Unit]">saveAsync</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.applyOrElse.md" title="akka.persistence.SnapshotMetadata">md</a>, <a href="#akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.isDefinedAt.snapshot" title="Any">snapshot</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="(f: Unit =&gt; akka.persistence.SaveSnapshotSuccess)(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[akka.persistence.SaveSnapshotSuccess]">map</a> <span class="delimiter">{</span>
        <a title="Unit" id="akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.applyOrElse.$anonfun.x$1">_</a> ⇒ <a href="../SnapshotProtocol.scala.html#akka.persistence;SaveSnapshotSuccess" title="(metadata: akka.persistence.SnapshotMetadata)akka.persistence.SaveSnapshotSuccess">SaveSnapshotSuccess</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.applyOrElse.md" title="akka.persistence.SnapshotMetadata">md</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <a href="../../../../actor/akka/pattern/PipeToSupport.scala.html#akka.pattern;PipeToSupport.pipe" title="(future: scala.concurrent.Future[akka.persistence.SnapshotProtocol.Response with Product with Serializable])(implicit executionContext: scala.concurrent.ExecutionContext)akka.pattern.PipeableFuture[akka.persistence.SnapshotProtocol.Response with Product with Serializable]">recover</a> <span title="&lt;$anon: Throwable =&gt; akka.persistence.SaveSnapshotFailure&gt; extends scala.runtime.AbstractPartialFunction[Throwable,akka.persistence.SaveSnapshotFailure] with Serializable" class="delimiter">{</span>
        case <span title="Throwable">e</span> ⇒ <a href="../SnapshotProtocol.scala.html#akka.persistence;SaveSnapshotFailure" title="(metadata: akka.persistence.SnapshotMetadata, cause: Throwable)akka.persistence.SaveSnapshotFailure">SaveSnapshotFailure</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.persistence.SnapshotMetadata">metadata</span>, <span title="Throwable">e</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <a href="../../../../actor/akka/pattern/PipeToSupport.scala.html#akka.pattern;PipeToSupport;PipeableFuture.to(3eb8bf0952)" title="(recipient: akka.actor.ActorRef, sender: akka.actor.ActorRef)akka.pattern.PipeableFuture[akka.persistence.SnapshotProtocol.Response with Product with Serializable]">to</a> <span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.persistence.snapshot;SnapshotStore.senderPersistentActor" title="()akka.actor.ActorRef">senderPersistentActor</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

    case <span title="akka.persistence.SaveSnapshotSuccess">evt</span>: <a href="../SnapshotProtocol.scala.html#akka.persistence;SaveSnapshotSuccess" title="akka.persistence.SaveSnapshotSuccess">SaveSnapshotSuccess</a> ⇒
      try <a href="#akka.persistence.snapshot;SnapshotStore.tryReceivePluginInternal" title="(evt: Any)Unit">tryReceivePluginInternal</a><span class="delimiter">(</span><span title="akka.persistence.SaveSnapshotSuccess">evt</span><span class="delimiter">)</span> finally <a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">senderPersistentActor</a> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <span title="akka.persistence.SaveSnapshotSuccess">evt</span> <span class="comment">// sender is persistentActor</span>
    case <span title="akka.persistence.SaveSnapshotFailure">evt</span> @ SaveSnapshotFailure<span class="delimiter">(</span><span title="akka.persistence.SnapshotMetadata">metadata</span>, _<span class="delimiter">)</span> ⇒
      try <span class="delimiter">{</span>
        <a href="#akka.persistence.snapshot;SnapshotStore.tryReceivePluginInternal" title="(evt: Any)Unit">tryReceivePluginInternal</a><span class="delimiter">(</span><span title="akka.persistence.SaveSnapshotFailure">evt</span><span class="delimiter">)</span>
        <a href="#akka.persistence.snapshot;SnapshotStore.breaker" title="=&gt; akka.pattern.CircuitBreaker">breaker</a>.<a href="../../../../actor/akka/pattern/CircuitBreaker.scala.html#akka.pattern;CircuitBreaker.withCircuitBreaker" title="(body: =&gt; scala.concurrent.Future[Unit])scala.concurrent.Future[Unit]">withCircuitBreaker</a><span title="Unit" class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.deleteAsync(549211478e)" title="(metadata: akka.persistence.SnapshotMetadata)scala.concurrent.Future[Unit]">deleteAsync</a><span class="delimiter">(</span><span title="akka.persistence.SnapshotMetadata">metadata</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> finally <a href="#akka.persistence.snapshot;SnapshotStore.senderPersistentActor" title="()akka.actor.ActorRef">senderPersistentActor</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <span title="akka.persistence.SaveSnapshotFailure">evt</span> <span class="comment">// sender is persistentActor</span>

    case <span title="akka.persistence.SnapshotProtocol.DeleteSnapshot">d</span> @ DeleteSnapshot<span class="delimiter">(</span><span title="akka.persistence.SnapshotMetadata">metadata</span><span class="delimiter">)</span> ⇒
      <a href="#akka.persistence.snapshot;SnapshotStore.breaker" title="=&gt; akka.pattern.CircuitBreaker">breaker</a>.<a href="../../../../actor/akka/pattern/CircuitBreaker.scala.html#akka.pattern;CircuitBreaker.withCircuitBreaker" title="(body: =&gt; scala.concurrent.Future[Unit])scala.concurrent.Future[Unit]">withCircuitBreaker</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.deleteAsync(549211478e)" title="(metadata: akka.persistence.SnapshotMetadata)scala.concurrent.Future[Unit]">deleteAsync</a><span class="delimiter">(</span><span title="akka.persistence.SnapshotMetadata">metadata</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: Unit =&gt; akka.persistence.DeleteSnapshotSuccess)(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[akka.persistence.DeleteSnapshotSuccess]">map</span> <a href="#akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.applyOrElse.$anonfun.x0$1" title="akka.persistence.DeleteSnapshotSuccess" class="delimiter">{</a>
        case _ ⇒ <a href="../SnapshotProtocol.scala.html#akka.persistence;DeleteSnapshotSuccess" title="(metadata: akka.persistence.SnapshotMetadata)akka.persistence.DeleteSnapshotSuccess">DeleteSnapshotSuccess</a><span class="delimiter">(</span><span title="akka.persistence.SnapshotMetadata">metadata</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>.<span title="(pf: PartialFunction[Throwable,akka.persistence.SnapshotProtocol.Response with Product with Serializable])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[akka.persistence.SnapshotProtocol.Response with Product with Serializable]">recover</span> <a href="../../../../actor/akka/pattern/PipeToSupport.scala.html#akka.pattern;PipeToSupport.pipe" title="(future: scala.concurrent.Future[akka.persistence.SnapshotProtocol.Response with Product with Serializable])(implicit executionContext: scala.concurrent.ExecutionContext)akka.pattern.PipeableFuture[akka.persistence.SnapshotProtocol.Response with Product with Serializable]" class="delimiter">{</a>
        case <span title="Throwable">e</span> ⇒ <a href="../SnapshotProtocol.scala.html#akka.persistence;DeleteSnapshotFailure" title="(metadata: akka.persistence.SnapshotMetadata, cause: Throwable)akka.persistence.DeleteSnapshotFailure">DeleteSnapshotFailure</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.persistence.SnapshotMetadata">metadata</span>, <span title="Throwable">e</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>.<a href="../../../../actor/akka/pattern/PipeToSupport.scala.html#akka.pattern;PipeToSupport;PipeableFuture.pipeTo" title="(recipient: akka.actor.ActorRef)(implicit sender: akka.actor.ActorRef)scala.concurrent.Future[akka.persistence.SnapshotProtocol.Response with Product with Serializable]">pipeTo</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.senderPersistentActor" title="()akka.actor.ActorRef">senderPersistentActor</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: scala.util.Try[akka.persistence.SnapshotProtocol.Response with Product with Serializable] =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)Unit">onComplete</span> <a href="#akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.applyOrElse.$anonfun.x0$2" title="Unit" class="delimiter">{</a>
        case _ ⇒ if <span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.publish" title="=&gt; Boolean">publish</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.eventStream" title="=&gt; akka.event.EventStream">eventStream</a>.<a href="../../../../actor/akka/event/EventBus.scala.html#akka.event;SubchannelClassification.publish(de973626dc)" title="(event: Object)Unit">publish</a><span class="delimiter">(</span><span title="akka.persistence.SnapshotProtocol.DeleteSnapshot">d</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    case <span title="akka.persistence.DeleteSnapshotSuccess">evt</span>: <a href="../SnapshotProtocol.scala.html#akka.persistence;DeleteSnapshotSuccess" title="akka.persistence.DeleteSnapshotSuccess">DeleteSnapshotSuccess</a> ⇒
      try <a href="#akka.persistence.snapshot;SnapshotStore.tryReceivePluginInternal" title="(evt: Any)Unit">tryReceivePluginInternal</a><span class="delimiter">(</span><span title="akka.persistence.DeleteSnapshotSuccess">evt</span><span class="delimiter">)</span> finally <a href="#akka.persistence.snapshot;SnapshotStore.senderPersistentActor" title="()akka.actor.ActorRef">senderPersistentActor</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <span title="akka.persistence.DeleteSnapshotSuccess">evt</span>
    case <span title="akka.persistence.DeleteSnapshotFailure">evt</span>: <a href="../SnapshotProtocol.scala.html#akka.persistence;DeleteSnapshotFailure" title="akka.persistence.DeleteSnapshotFailure">DeleteSnapshotFailure</a> ⇒
      try <a href="#akka.persistence.snapshot;SnapshotStore.tryReceivePluginInternal" title="(evt: Any)Unit">tryReceivePluginInternal</a><span class="delimiter">(</span><span title="akka.persistence.DeleteSnapshotFailure">evt</span><span class="delimiter">)</span> finally <a href="#akka.persistence.snapshot;SnapshotStore.senderPersistentActor" title="()akka.actor.ActorRef">senderPersistentActor</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <span title="akka.persistence.DeleteSnapshotFailure">evt</span>

    case <span title="akka.persistence.SnapshotProtocol.DeleteSnapshots">d</span> @ DeleteSnapshots<span class="delimiter">(</span><span title="String">persistenceId</span>, <span title="akka.persistence.SnapshotSelectionCriteria">criteria</span><span class="delimiter">)</span> ⇒
      <a href="#akka.persistence.snapshot;SnapshotStore.breaker" title="=&gt; akka.pattern.CircuitBreaker">breaker</a>.<a href="../../../../actor/akka/pattern/CircuitBreaker.scala.html#akka.pattern;CircuitBreaker.withCircuitBreaker" title="(body: =&gt; scala.concurrent.Future[Unit])scala.concurrent.Future[Unit]">withCircuitBreaker</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.deleteAsync(306a8a4ab1)" title="(persistenceId: String, criteria: akka.persistence.SnapshotSelectionCriteria)scala.concurrent.Future[Unit]">deleteAsync</a><span class="delimiter">(</span><span title="String">persistenceId</span>, <span title="akka.persistence.SnapshotSelectionCriteria">criteria</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: Unit =&gt; akka.persistence.DeleteSnapshotsSuccess)(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[akka.persistence.DeleteSnapshotsSuccess]">map</span> <a href="#akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.applyOrElse.$anonfun.x0$3" title="akka.persistence.DeleteSnapshotsSuccess" class="delimiter">{</a>
        case _ ⇒ <a href="../SnapshotProtocol.scala.html#akka.persistence;DeleteSnapshotsSuccess" title="(criteria: akka.persistence.SnapshotSelectionCriteria)akka.persistence.DeleteSnapshotsSuccess">DeleteSnapshotsSuccess</a><span class="delimiter">(</span><span title="akka.persistence.SnapshotSelectionCriteria">criteria</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>.<span title="(pf: PartialFunction[Throwable,akka.persistence.SnapshotProtocol.Response with Product with Serializable])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[akka.persistence.SnapshotProtocol.Response with Product with Serializable]">recover</span> <a href="../../../../actor/akka/pattern/PipeToSupport.scala.html#akka.pattern;PipeToSupport.pipe" title="(future: scala.concurrent.Future[akka.persistence.SnapshotProtocol.Response with Product with Serializable])(implicit executionContext: scala.concurrent.ExecutionContext)akka.pattern.PipeableFuture[akka.persistence.SnapshotProtocol.Response with Product with Serializable]" class="delimiter">{</a>
        case <span title="Throwable">e</span> ⇒ <a href="../SnapshotProtocol.scala.html#akka.persistence;DeleteSnapshotsFailure" title="(criteria: akka.persistence.SnapshotSelectionCriteria, cause: Throwable)akka.persistence.DeleteSnapshotsFailure">DeleteSnapshotsFailure</a><span title="Boolean(true)" class="delimiter">(</span><span title="akka.persistence.SnapshotSelectionCriteria">criteria</span>, <span title="Throwable">e</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>.<a href="../../../../actor/akka/pattern/PipeToSupport.scala.html#akka.pattern;PipeToSupport;PipeableFuture.pipeTo" title="(recipient: akka.actor.ActorRef)(implicit sender: akka.actor.ActorRef)scala.concurrent.Future[akka.persistence.SnapshotProtocol.Response with Product with Serializable]">pipeTo</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.senderPersistentActor" title="()akka.actor.ActorRef">senderPersistentActor</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: scala.util.Try[akka.persistence.SnapshotProtocol.Response with Product with Serializable] =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)Unit">onComplete</span> <a href="#akka.persistence.snapshot;SnapshotStore.receiveSnapshotStore;$anonfun.applyOrElse.$anonfun.x0$4" title="Unit" class="delimiter">{</a>
        case _ ⇒ if <span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.publish" title="=&gt; Boolean">publish</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.eventStream" title="=&gt; akka.event.EventStream">eventStream</a>.<a href="../../../../actor/akka/event/EventBus.scala.html#akka.event;SubchannelClassification.publish(de973626dc)" title="(event: Object)Unit">publish</a><span class="delimiter">(</span><span title="akka.persistence.SnapshotProtocol.DeleteSnapshots">d</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    case <span title="akka.persistence.DeleteSnapshotsFailure">evt</span>: <a href="../SnapshotProtocol.scala.html#akka.persistence;DeleteSnapshotsFailure" title="akka.persistence.DeleteSnapshotsFailure">DeleteSnapshotsFailure</a> ⇒
      try <a href="#akka.persistence.snapshot;SnapshotStore.tryReceivePluginInternal" title="(evt: Any)Unit">tryReceivePluginInternal</a><span class="delimiter">(</span><span title="akka.persistence.DeleteSnapshotsFailure">evt</span><span class="delimiter">)</span> finally <a href="#akka.persistence.snapshot;SnapshotStore.senderPersistentActor" title="()akka.actor.ActorRef">senderPersistentActor</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <span title="akka.persistence.DeleteSnapshotsFailure">evt</span> <span class="comment">// sender is persistentActor</span>
    case <span title="akka.persistence.DeleteSnapshotsSuccess">evt</span>: <a href="../SnapshotProtocol.scala.html#akka.persistence;DeleteSnapshotsSuccess" title="akka.persistence.DeleteSnapshotsSuccess">DeleteSnapshotsSuccess</a> ⇒
      try <a href="#akka.persistence.snapshot;SnapshotStore.tryReceivePluginInternal" title="(evt: Any)Unit">tryReceivePluginInternal</a><span class="delimiter">(</span><span title="akka.persistence.DeleteSnapshotsSuccess">evt</span><span class="delimiter">)</span> finally <a href="#akka.persistence.snapshot;SnapshotStore.senderPersistentActor" title="()akka.actor.ActorRef">senderPersistentActor</a><a href="../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef" class="delimiter">(</a><span class="delimiter">)</span> <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <span title="akka.persistence.DeleteSnapshotsSuccess">evt</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Documents intent that the sender() is expected to be the PersistentActor */</span>
  @inline private final def <a title="()akka.actor.ActorRef" id="akka.persistence.snapshot;SnapshotStore.senderPersistentActor">senderPersistentActor</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.sender" title="()akka.actor.ActorRef">sender</a><span class="delimiter">(</span><span class="delimiter">)</span>

  private def <a title="(evt: Any)Unit" id="akka.persistence.snapshot;SnapshotStore.tryReceivePluginInternal">tryReceivePluginInternal</a><span class="delimiter">(</span><a title="Any" id="akka.persistence.snapshot;SnapshotStore.tryReceivePluginInternal.evt">evt</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    if <span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.receivePluginInternal" title="=&gt; akka.actor.Actor.Receive">receivePluginInternal</a>.<span title="(x: Any)Boolean">isDefinedAt</span><span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.tryReceivePluginInternal.evt" title="Any">evt</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.persistence.snapshot;SnapshotStore.receivePluginInternal" title="(v1: Any)Unit">receivePluginInternal</a><span class="delimiter">(</span><a href="#akka.persistence.snapshot;SnapshotStore.tryReceivePluginInternal.evt" title="Any">evt</a><span class="delimiter">)</span>

  <span class="comment">//#snapshot-store-plugin-api</span>

  <span class="comment">/**
   * Plugin API: asynchronously loads a snapshot.
   *
   * This call is protected with a circuit-breaker.
   *
   * @param persistenceId id of the persistent actor.
   * @param criteria selection criteria for loading.
   */</span>
  def <a title="(persistenceId: String, criteria: akka.persistence.SnapshotSelectionCriteria)scala.concurrent.Future[Option[akka.persistence.SelectedSnapshot]]" id="akka.persistence.snapshot;SnapshotStore.loadAsync">loadAsync</a><span class="delimiter">(</span><a title="String" id="akka.persistence.snapshot;SnapshotStore.loadAsync.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="akka.persistence.SnapshotSelectionCriteria" id="akka.persistence.snapshot;SnapshotStore.loadAsync.criteria">criteria</a>: <a href="../SnapshotProtocol.scala.html#akka.persistence;SnapshotSelectionCriteria" title="akka.persistence.SnapshotSelectionCriteria">SnapshotSelectionCriteria</a><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Option[akka.persistence.SelectedSnapshot]]">Future</span><span class="delimiter">[</span>Option<span class="delimiter">[</span>SelectedSnapshot<span class="delimiter">]</span><span class="delimiter">]</span>

  <span class="comment">/**
   * Plugin API: asynchronously saves a snapshot.
   *
   * This call is protected with a circuit-breaker.
   *
   * @param metadata snapshot metadata.
   * @param snapshot snapshot.
   */</span>
  def <a title="(metadata: akka.persistence.SnapshotMetadata, snapshot: Any)scala.concurrent.Future[Unit]" id="akka.persistence.snapshot;SnapshotStore.saveAsync">saveAsync</a><span class="delimiter">(</span><a title="akka.persistence.SnapshotMetadata" id="akka.persistence.snapshot;SnapshotStore.saveAsync.metadata">metadata</a>: <a href="../SnapshotProtocol.scala.html#akka.persistence;SnapshotMetadata" title="akka.persistence.SnapshotMetadata">SnapshotMetadata</a>, <a title="Any" id="akka.persistence.snapshot;SnapshotStore.saveAsync.snapshot">snapshot</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Unit]">Future</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span>

  <span class="comment">/**
   * Plugin API: deletes the snapshot identified by `metadata`.
   *
   * This call is protected with a circuit-breaker.
   *
   * @param metadata snapshot metadata.
   */</span>
  def <a title="(metadata: akka.persistence.SnapshotMetadata)scala.concurrent.Future[Unit]" id="akka.persistence.snapshot;SnapshotStore.deleteAsync(549211478e)">deleteAsync</a><span class="delimiter">(</span><a title="akka.persistence.SnapshotMetadata" id="akka.persistence.snapshot;SnapshotStore.deleteAsync(549211478e).metadata">metadata</a>: <a href="../SnapshotProtocol.scala.html#akka.persistence;SnapshotMetadata" title="akka.persistence.SnapshotMetadata">SnapshotMetadata</a><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Unit]">Future</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span>

  <span class="comment">/**
   * Plugin API: deletes all snapshots matching `criteria`.
   *
   * This call is protected with a circuit-breaker.
   *
   * @param persistenceId id of the persistent actor.
   * @param criteria selection criteria for deleting.
   */</span>
  def <a title="(persistenceId: String, criteria: akka.persistence.SnapshotSelectionCriteria)scala.concurrent.Future[Unit]" id="akka.persistence.snapshot;SnapshotStore.deleteAsync(306a8a4ab1)">deleteAsync</a><span class="delimiter">(</span><a title="String" id="akka.persistence.snapshot;SnapshotStore.deleteAsync(306a8a4ab1).persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="akka.persistence.SnapshotSelectionCriteria" id="akka.persistence.snapshot;SnapshotStore.deleteAsync(306a8a4ab1).criteria">criteria</a>: <a href="../SnapshotProtocol.scala.html#akka.persistence;SnapshotSelectionCriteria" title="akka.persistence.SnapshotSelectionCriteria">SnapshotSelectionCriteria</a><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Unit]">Future</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span>

  <span class="comment">/**
   * Plugin API
   * Allows plugin implementers to use `f pipeTo self` and
   * handle additional messages for implementing advanced features
   */</span>
  def <a title="=&gt; akka.actor.Actor.Receive" id="akka.persistence.snapshot;SnapshotStore.receivePluginInternal">receivePluginInternal</a>: Actor.<span title="akka.actor.Actor.Receive">Receive</span> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.Actor" title="akka.actor.Actor.type">Actor</a>.<a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.Actor.emptyBehavior" title="akka.actor.Actor.emptyBehavior.type">emptyBehavior</a>
  <span class="comment">//#snapshot-store-plugin-api</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
