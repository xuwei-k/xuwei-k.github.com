<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>persistence/akka/persistence/journal/WriteJournalBase.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2014-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

package akka.persistence.journal

import akka.actor.Actor
import akka.persistence.<span class="delimiter">{</span> Persistence, PersistentEnvelope, PersistentRepr <span class="delimiter">}</span>

import scala.collection.immutable
import akka.persistence.AtomicWrite

private<span class="delimiter">[</span>akka<span class="delimiter">]</span> trait <a title="trait WriteJournalBase extends AnyRef" id="akka.persistence.journal;WriteJournalBase">WriteJournalBase</a> <span title="Unit" class="delimiter">{</span>
  this: Actor ⇒

  lazy val <a title="akka.persistence.Persistence" id="akka.persistence.journal;WriteJournalBase.persistence">persistence</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.persistence.Persistence">Persistence</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>
  private def <a title="=&gt; akka.persistence.journal.EventAdapters" id="akka.persistence.journal;WriteJournalBase.eventAdapters">eventAdapters</a> = <a href="#akka.persistence.journal;WriteJournalBase.persistence" title="=&gt; akka.persistence.Persistence">persistence</a>.<a href="../Persistence.scala.html#akka.persistence;Persistence.adaptersFor(5b50c93c4e)" title="(journalPluginActor: akka.actor.ActorRef)akka.persistence.journal.EventAdapters">adaptersFor</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>

  protected def <a title="(rb: scala.collection.immutable.Seq[akka.persistence.PersistentEnvelope])scala.collection.immutable.Seq[akka.persistence.AtomicWrite]" id="akka.persistence.journal;WriteJournalBase.preparePersistentBatch">preparePersistentBatch</a><span class="delimiter">(</span><a title="scala.collection.immutable.Seq[akka.persistence.PersistentEnvelope]" id="akka.persistence.journal;WriteJournalBase.preparePersistentBatch.rb">rb</a>: immutable.<span title="scala.collection.immutable.Seq[akka.persistence.PersistentEnvelope]">Seq</span><span class="delimiter">[</span>PersistentEnvelope<span class="delimiter">]</span><span class="delimiter">)</span>: immutable.<span title="scala.collection.immutable.Seq[akka.persistence.AtomicWrite]">Seq</span><span class="delimiter">[</span>AtomicWrite<span class="delimiter">]</span> =
    <a href="#akka.persistence.journal;WriteJournalBase.preparePersistentBatch.rb" title="scala.collection.immutable.Seq[akka.persistence.PersistentEnvelope]">rb</a>.<span title="(pf: PartialFunction[akka.persistence.PersistentEnvelope,akka.persistence.AtomicWrite])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Seq[akka.persistence.PersistentEnvelope],akka.persistence.AtomicWrite,scala.collection.immutable.Seq[akka.persistence.AtomicWrite]])scala.collection.immutable.Seq[akka.persistence.AtomicWrite]">collect</span> <a title="&lt;$anon: akka.persistence.PersistentEnvelope =&gt; akka.persistence.AtomicWrite&gt; extends scala.runtime.AbstractPartialFunction[akka.persistence.PersistentEnvelope,akka.persistence.AtomicWrite] with Serializable" id="akka.persistence.journal;WriteJournalBase.preparePersistentBatch;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a> <span class="comment">// collect instead of flatMap to avoid Some allocations</span>
      case <a title="akka.persistence.AtomicWrite" id="akka.persistence.journal;WriteJournalBase.preparePersistentBatch;$anonfun.isDefinedAt.a">a</a>: <a href="../Persistent.scala.html#akka.persistence;AtomicWrite" title="akka.persistence.AtomicWrite">AtomicWrite</a> ⇒
        <span class="comment">// don't store sender</span>
        <a href="#akka.persistence.journal;WriteJournalBase.preparePersistentBatch;$anonfun.isDefinedAt.a" title="akka.persistence.AtomicWrite">a</a>.<a href="../Persistent.scala.html#akka.persistence;AtomicWrite.copy" title="(payload: scala.collection.immutable.Seq[akka.persistence.PersistentRepr])akka.persistence.AtomicWrite">copy</a><span title="Boolean(true)" class="delimiter">(</span>payload = <a href="#akka.persistence.journal;WriteJournalBase.preparePersistentBatch;$anonfun.isDefinedAt.a" title="akka.persistence.AtomicWrite">a</a>.<a href="../Persistent.scala.html#akka.persistence;AtomicWrite.payload" title="=&gt; scala.collection.immutable.Seq[akka.persistence.PersistentRepr]">payload</a>.<span title="(f: akka.persistence.PersistentRepr =&gt; akka.persistence.PersistentRepr)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Seq[akka.persistence.PersistentRepr],akka.persistence.PersistentRepr,scala.collection.immutable.Seq[akka.persistence.PersistentRepr]])scala.collection.immutable.Seq[akka.persistence.PersistentRepr]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Seq.Coll,akka.persistence.PersistentRepr,scala.collection.immutable.Seq[akka.persistence.PersistentRepr]]" class="delimiter">(</span><a title="akka.persistence.PersistentRepr" id="akka.persistence.journal;WriteJournalBase.preparePersistentBatch;$anonfun.applyOrElse.$anonfun.p">p</a> ⇒ <a href="#akka.persistence.journal;WriteJournalBase.adaptToJournal" title="(repr: akka.persistence.PersistentRepr)akka.persistence.PersistentRepr">adaptToJournal</a><span class="delimiter">(</span><a href="#akka.persistence.journal;WriteJournalBase.preparePersistentBatch;$anonfun.applyOrElse.$anonfun.p" title="akka.persistence.PersistentRepr">p</a>.<a href="../Persistent.scala.html#akka.persistence;PersistentRepr.update$default$1" title="Long" id="akka.persistence.journal;WriteJournalBase.preparePersistentBatch;$anonfun.applyOrElse.$anonfun.x$5">update</a><span class="delimiter">(</span>sender = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.Actor" title="akka.actor.Actor.type">Actor</a>.<a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.Actor.noSender" title="akka.actor.ActorRef" id="akka.persistence.journal;WriteJournalBase.preparePersistentBatch;$anonfun.applyOrElse.$anonfun.x$1">noSender</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="comment">/** INTERNAL API */</span>
  private<span class="delimiter">[</span>akka<span class="delimiter">]</span> final def <a title="(repr: akka.persistence.PersistentRepr)scala.collection.immutable.Seq[akka.persistence.PersistentRepr]" id="akka.persistence.journal;WriteJournalBase.adaptFromJournal">adaptFromJournal</a><span class="delimiter">(</span><a title="akka.persistence.PersistentRepr" id="akka.persistence.journal;WriteJournalBase.adaptFromJournal.repr">repr</a>: <a href="../Persistent.scala.html#akka.persistence;PersistentRepr" title="akka.persistence.PersistentRepr">PersistentRepr</a><span class="delimiter">)</span>: immutable.<span title="scala.collection.immutable.Seq[akka.persistence.PersistentRepr]">Seq</span><span class="delimiter">[</span>PersistentRepr<span class="delimiter">]</span> =
    <a href="#akka.persistence.journal;WriteJournalBase.eventAdapters" title="=&gt; akka.persistence.journal.EventAdapters">eventAdapters</a>.<a href="EventAdapters.scala.html#akka.persistence.journal;EventAdapters.get" title="(clazz: Class[_])akka.persistence.journal.EventAdapter">get</a><span class="delimiter">(</span><a href="#akka.persistence.journal;WriteJournalBase.adaptFromJournal.repr" title="akka.persistence.PersistentRepr">repr</a>.<a href="../Persistent.scala.html#akka.persistence;PersistentRepr.payload" title="=&gt; Any">payload</a>.<span title="()Class[_]">getClass</span><span class="delimiter">)</span>.<a href="EventAdapter.scala.html#akka.persistence.journal;ReadEventAdapter.fromJournal" title="(event: Any, manifest: String)akka.persistence.journal.EventSeq">fromJournal</a><span class="delimiter">(</span><a href="#akka.persistence.journal;WriteJournalBase.adaptFromJournal.repr" title="akka.persistence.PersistentRepr">repr</a>.<a href="../Persistent.scala.html#akka.persistence;PersistentRepr.payload" title="=&gt; Any">payload</a>, <a href="#akka.persistence.journal;WriteJournalBase.adaptFromJournal.repr" title="akka.persistence.PersistentRepr">repr</a>.<a href="../Persistent.scala.html#akka.persistence;PersistentRepr.manifest" title="=&gt; String">manifest</a><span class="delimiter">)</span>.<a href="EventAdapter.scala.html#akka.persistence.journal;EventSeq.events" title="=&gt; scala.collection.immutable.Seq[Any]">events</a> <span title="(f: Any =&gt; akka.persistence.PersistentRepr)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Seq[Any],akka.persistence.PersistentRepr,scala.collection.immutable.Seq[akka.persistence.PersistentRepr]])scala.collection.immutable.Seq[akka.persistence.PersistentRepr]">map</span> <span class="delimiter">{</span> <a title="Any" id="akka.persistence.journal;WriteJournalBase.adaptFromJournal.$anonfun.adaptedPayload">adaptedPayload</a> ⇒
      <a href="#akka.persistence.journal;WriteJournalBase.adaptFromJournal.repr" title="akka.persistence.PersistentRepr">repr</a>.<a href="../Persistent.scala.html#akka.persistence;PersistentRepr.withPayload" title="(payload: Any)akka.persistence.PersistentRepr">withPayload</a><span class="delimiter">(</span><a href="#akka.persistence.journal;WriteJournalBase.adaptFromJournal.$anonfun.adaptedPayload" title="Any">adaptedPayload</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="comment">/** INTERNAL API */</span>
  private<span class="delimiter">[</span>akka<span class="delimiter">]</span> final def <a title="(repr: akka.persistence.PersistentRepr)akka.persistence.PersistentRepr" id="akka.persistence.journal;WriteJournalBase.adaptToJournal">adaptToJournal</a><span class="delimiter">(</span><a title="akka.persistence.PersistentRepr" id="akka.persistence.journal;WriteJournalBase.adaptToJournal.repr">repr</a>: <a href="../Persistent.scala.html#akka.persistence;PersistentRepr" title="akka.persistence.PersistentRepr">PersistentRepr</a><span class="delimiter">)</span>: <a href="../Persistent.scala.html#akka.persistence;PersistentRepr" title="akka.persistence.PersistentRepr">PersistentRepr</a> = <span class="delimiter">{</span>
    val <a title="Any" id="akka.persistence.journal;WriteJournalBase.adaptToJournal.payload">payload</a> = <a href="#akka.persistence.journal;WriteJournalBase.adaptToJournal.repr" title="akka.persistence.PersistentRepr">repr</a>.<a href="../Persistent.scala.html#akka.persistence;PersistentRepr.payload" title="=&gt; Any">payload</a>
    val <a title="akka.persistence.journal.EventAdapter" id="akka.persistence.journal;WriteJournalBase.adaptToJournal.adapter">adapter</a> = <a href="#akka.persistence.journal;WriteJournalBase.eventAdapters" title="=&gt; akka.persistence.journal.EventAdapters">eventAdapters</a>.<a href="EventAdapters.scala.html#akka.persistence.journal;EventAdapters.get" title="(clazz: Class[_])akka.persistence.journal.EventAdapter">get</a><span class="delimiter">(</span><a href="#akka.persistence.journal;WriteJournalBase.adaptToJournal.payload" title="Any">payload</a>.<span title="()Class[_]">getClass</span><span class="delimiter">)</span>
    val <a title="String" id="akka.persistence.journal;WriteJournalBase.adaptToJournal.manifest">manifest</a> = <a href="#akka.persistence.journal;WriteJournalBase.adaptToJournal.adapter" title="akka.persistence.journal.EventAdapter">adapter</a>.<a href="EventAdapter.scala.html#akka.persistence.journal;WriteEventAdapter.manifest" title="(event: Any)String">manifest</a><span class="delimiter">(</span><a href="#akka.persistence.journal;WriteJournalBase.adaptToJournal.payload" title="Any">payload</a><span class="delimiter">)</span>

    <a href="#akka.persistence.journal;WriteJournalBase.adaptToJournal.repr" title="akka.persistence.PersistentRepr">repr</a>
      .<a href="../Persistent.scala.html#akka.persistence;PersistentRepr.withPayload" title="(payload: Any)akka.persistence.PersistentRepr">withPayload</a><span class="delimiter">(</span><a href="#akka.persistence.journal;WriteJournalBase.adaptToJournal.adapter" title="akka.persistence.journal.EventAdapter">adapter</a>.<a href="EventAdapter.scala.html#akka.persistence.journal;WriteEventAdapter.toJournal" title="(event: Any)Any">toJournal</a><span class="delimiter">(</span><a href="#akka.persistence.journal;WriteJournalBase.adaptToJournal.payload" title="Any">payload</a><span class="delimiter">)</span><span class="delimiter">)</span>
      .<a href="../Persistent.scala.html#akka.persistence;PersistentRepr.withManifest" title="(manifest: String)akka.persistence.PersistentRepr">withManifest</a><span class="delimiter">(</span><a href="#akka.persistence.journal;WriteJournalBase.adaptToJournal.manifest" title="String">manifest</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
