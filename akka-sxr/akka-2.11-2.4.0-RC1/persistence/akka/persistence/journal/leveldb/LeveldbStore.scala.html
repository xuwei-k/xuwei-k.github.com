<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>persistence/akka/persistence/journal/leveldb/LeveldbStore.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 * Copyright (C) 2012-2013 Eligotech BV.
 */</span>

package akka.persistence.journal.leveldb

import java.io.File
import scala.collection.mutable
import akka.actor._
import akka.persistence._
import akka.persistence.journal.<span class="delimiter">{</span> WriteJournalBase, AsyncWriteTarget <span class="delimiter">}</span>
import akka.serialization.SerializationExtension
import org.iq80.leveldb._
import scala.collection.immutable
import scala.util._
import scala.concurrent.Future
import scala.util.control.NonFatal
import akka.persistence.journal.AsyncWriteJournal

<span class="comment">/**
 * INTERNAL API.
 */</span>
private<span class="delimiter">[</span>persistence<span class="delimiter">]</span> trait <a title="trait LeveldbStore extends AnyRef with akka.actor.Actor with akka.persistence.journal.WriteJournalBase with akka.persistence.journal.leveldb.LeveldbIdMapping with akka.persistence.journal.leveldb.LeveldbRecovery" id="akka.persistence.journal.leveldb;LeveldbStore">LeveldbStore</a> extends <a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> with <a href="../WriteJournalBase.scala.html#akka.persistence.journal;WriteJournalBase" title="akka.persistence.journal.WriteJournalBase">WriteJournalBase</a> with <a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping" title="akka.persistence.journal.leveldb.LeveldbIdMapping">LeveldbIdMapping</a> with <a href="LeveldbRecovery.scala.html#akka.persistence.journal.leveldb;LeveldbRecovery" title="akka.persistence.journal.leveldb.LeveldbRecovery">LeveldbRecovery</a> <span class="delimiter">{</span>
  val <a title="=&gt; String" id="akka.persistence.journal.leveldb;LeveldbStore.configPath">configPath</a>: <span title="String">String</span>

  val <a title="com.typesafe.config.Config" id="akka.persistence.journal.leveldb;LeveldbStore.config">config</a> = <a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.settings" title="=&gt; akka.actor.ActorSystem.Settings">settings</a>.<a href="../../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor.ActorSystem;Settings.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)com.typesafe.config.Config">getConfig</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.configPath" title="=&gt; String">configPath</a><span class="delimiter">)</span>
  val <a title="Boolean" id="akka.persistence.journal.leveldb;LeveldbStore.nativeLeveldb">nativeLeveldb</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)Boolean">getBoolean</span><span class="delimiter">(</span><span title="String(&quot;native&quot;)" class="string">&quot;native&quot;</span><span class="delimiter">)</span>

  val <a title="org.iq80.leveldb.Options" id="akka.persistence.journal.leveldb;LeveldbStore.leveldbOptions">leveldbOptions</a> = new <span title="org.iq80.leveldb.Options">Options</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Boolean)org.iq80.leveldb.Options">createIfMissing</span><span class="delimiter">(</span>true<span class="delimiter">)</span>
  def <a title="=&gt; org.iq80.leveldb.ReadOptions" id="akka.persistence.journal.leveldb;LeveldbStore.leveldbReadOptions">leveldbReadOptions</a> = new <span title="org.iq80.leveldb.ReadOptions">ReadOptions</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Boolean)org.iq80.leveldb.ReadOptions">verifyChecksums</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)Boolean">getBoolean</span><span class="delimiter">(</span><span title="String(&quot;checksum&quot;)" class="string">&quot;checksum&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  val <a title="org.iq80.leveldb.WriteOptions" id="akka.persistence.journal.leveldb;LeveldbStore.leveldbWriteOptions">leveldbWriteOptions</a> = new <span title="org.iq80.leveldb.WriteOptions">WriteOptions</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Boolean)org.iq80.leveldb.WriteOptions">sync</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)Boolean">getBoolean</span><span class="delimiter">(</span><span title="String(&quot;fsync&quot;)" class="string">&quot;fsync&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(x$1: Boolean)org.iq80.leveldb.WriteOptions">snapshot</span><span class="delimiter">(</span>false<span class="delimiter">)</span>
  val <a title="java.io.File" id="akka.persistence.journal.leveldb;LeveldbStore.leveldbDir">leveldbDir</a> = new <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.config" title="=&gt; com.typesafe.config.Config">config</a>.<span title="(x$1: String)String">getString</span><span class="delimiter">(</span><span title="String(&quot;dir&quot;)" class="string">&quot;dir&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  var <a title="org.iq80.leveldb.DB" id="akka.persistence.journal.leveldb;LeveldbStore.leveldb_=">leveldb</a>: <span title="org.iq80.leveldb.DB">DB</span> = _

  private val <a title="&lt;refinement of String =&gt; scala.collection.mutable.Set[akka.actor.ActorRef] with String =&gt; scala.collection.mutable.Set[akka.actor.ActorRef]&gt; extends scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]" id="akka.persistence.journal.leveldb;LeveldbStore.persistenceIdSubscribers">persistenceIdSubscribers</a> = new <a title="&lt;$anon: String =&gt; scala.collection.mutable.Set[akka.actor.ActorRef] with String =&gt; scala.collection.mutable.Set[akka.actor.ActorRef]&gt; extends scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]" id="akka.persistence.journal.leveldb;LeveldbStore.persistenceIdSubscribers;$anon">mutable</a>.<a href="#akka.persistence.journal.leveldb;LeveldbStore.persistenceIdSubscribers;$anon" title="scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]]">HashMap</a><span class="delimiter">[</span>String, mutable.Set<span class="delimiter">[</span>ActorRef<span class="delimiter">]</span><span class="delimiter">]</span> with mutable.<span title="scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]">MultiMap</span><span class="delimiter">[</span>String, ActorRef<span class="delimiter">]</span>
  private val <a title="&lt;refinement of String =&gt; scala.collection.mutable.Set[akka.actor.ActorRef] with String =&gt; scala.collection.mutable.Set[akka.actor.ActorRef]&gt; extends scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]" id="akka.persistence.journal.leveldb;LeveldbStore.tagSubscribers">tagSubscribers</a> = new <a title="&lt;$anon: String =&gt; scala.collection.mutable.Set[akka.actor.ActorRef] with String =&gt; scala.collection.mutable.Set[akka.actor.ActorRef]&gt; extends scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]" id="akka.persistence.journal.leveldb;LeveldbStore.tagSubscribers;$anon">mutable</a>.<a href="#akka.persistence.journal.leveldb;LeveldbStore.tagSubscribers;$anon" title="scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]]">HashMap</a><span class="delimiter">[</span>String, mutable.Set<span class="delimiter">[</span>ActorRef<span class="delimiter">]</span><span class="delimiter">]</span> with mutable.<span title="scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]">MultiMap</span><span class="delimiter">[</span>String, ActorRef<span class="delimiter">]</span>
  private var <a title="scala.collection.immutable.Set[akka.actor.ActorRef]" id="akka.persistence.journal.leveldb;LeveldbStore.allPersistenceIdsSubscribers_=">allPersistenceIdsSubscribers</a> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.immutable.Set[A]">empty</span><span title="scala.collection.immutable.Set[akka.actor.ActorRef]" class="delimiter">[</span><a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">]</span>

  private var <a title="scala.collection.immutable.Map[String,Long]" id="akka.persistence.journal.leveldb;LeveldbStore.tagSequenceNr_=">tagSequenceNr</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[String,Long]" class="delimiter">[</span><span title="String">String</span>, <span title="Long">Long</span><span class="delimiter">]</span>
  private val <a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.tagPersistenceIdPrefix">tagPersistenceIdPrefix</a> = <span title="String(&quot;$$$&quot;)" class="string">&quot;$$$&quot;</span>

  def <a title="=&gt; org.iq80.leveldb.DBFactory" id="akka.persistence.journal.leveldb;LeveldbStore.leveldbFactory">leveldbFactory</a> =
    if <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.nativeLeveldb" title="=&gt; Boolean">nativeLeveldb</a><span class="delimiter">)</span> org.fusesource.leveldbjni.<span title="org.fusesource.leveldbjni.JniDBFactory.type">JniDBFactory</span>.<span title="org.fusesource.leveldbjni.JniDBFactory">factory</span>
    else org.iq80.leveldb.impl.<span title="org.iq80.leveldb.impl.Iq80DBFactory.type">Iq80DBFactory</span>.<span title="org.iq80.leveldb.impl.Iq80DBFactory">factory</span>

  val <a title="akka.serialization.Serialization" id="akka.persistence.journal.leveldb;LeveldbStore.serialization">serialization</a> = <a href="../../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.serialization.Serialization">SerializationExtension</a><span class="delimiter">(</span><a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a><span class="delimiter">)</span>

  import <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key" title="akka.persistence.journal.leveldb.Key.type">Key</a>._

  def <a title="(messages: scala.collection.immutable.Seq[akka.persistence.AtomicWrite])scala.concurrent.Future[scala.collection.immutable.Seq[scala.util.Try[Unit]]]" id="akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages">asyncWriteMessages</a><span class="delimiter">(</span><a title="scala.collection.immutable.Seq[akka.persistence.AtomicWrite]" id="akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.messages">messages</a>: immutable.<span title="scala.collection.immutable.Seq[akka.persistence.AtomicWrite]">Seq</span><span class="delimiter">[</span>AtomicWrite<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[scala.collection.immutable.Seq[scala.util.Try[Unit]]]">Future</span><span class="delimiter">[</span>immutable.Seq<span class="delimiter">[</span>Try<span class="delimiter">[</span>Unit<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    var <a title="scala.collection.immutable.Set[String]" id="akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.persistenceIds">persistenceIds</a> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.immutable.Set[A]">empty</span><span title="scala.collection.immutable.Set[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span>
    var <a title="scala.collection.immutable.Set[String]" id="akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.allTags">allTags</a> = <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.immutable.Set[A]">empty</span><span title="scala.collection.immutable.Set[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span>

    val <a title="scala.concurrent.Future[scala.collection.immutable.Seq[scala.util.Try[Unit]]]" id="akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result">result</a> = <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: scala.util.Try[scala.collection.immutable.Seq[scala.util.Try[Unit]]])scala.concurrent.Future[scala.collection.immutable.Seq[scala.util.Try[Unit]]]">fromTry</span><span class="delimiter">(</span><span title="(r: =&gt; scala.collection.immutable.Seq[scala.util.Try[Unit]])scala.util.Try[scala.collection.immutable.Seq[scala.util.Try[Unit]]]">Try</span> <span class="delimiter">{</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch" title="(body: org.iq80.leveldb.WriteBatch =&gt; scala.collection.immutable.Seq[scala.util.Try[Unit]])scala.collection.immutable.Seq[scala.util.Try[Unit]]">withBatch</a><span class="delimiter">(</span><a title="org.iq80.leveldb.WriteBatch" id="akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.batch">batch</a> ⇒ <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.messages" title="scala.collection.immutable.Seq[akka.persistence.AtomicWrite]">messages</a>.<span title="(f: akka.persistence.AtomicWrite =&gt; scala.util.Try[Unit])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Seq[akka.persistence.AtomicWrite],scala.util.Try[Unit],scala.collection.immutable.Seq[scala.util.Try[Unit]]])scala.collection.immutable.Seq[scala.util.Try[Unit]]">map</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Seq.Coll,scala.util.Try[Unit],scala.collection.immutable.Seq[scala.util.Try[Unit]]]" class="delimiter">{</span> <a title="akka.persistence.AtomicWrite" id="akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.a">a</a> ⇒
        <span title="(r: =&gt; Unit)scala.util.Try[Unit]">Try</span> <span class="delimiter">{</span>
          <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.a" title="akka.persistence.AtomicWrite">a</a>.<a href="../../Persistent.scala.html#akka.persistence;AtomicWrite.payload" title="=&gt; scala.collection.immutable.Seq[akka.persistence.PersistentRepr]">payload</a>.<span title="(f: akka.persistence.PersistentRepr =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="akka.persistence.PersistentRepr" id="akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.p">p</a> ⇒
            val <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.p2" title="(akka.persistence.PersistentRepr, Set[String])" class="delimiter">(</a><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.x$1" title="akka.persistence.PersistentRepr" id="akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.p2">p2</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.x$1" title="Set[String]" id="akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.tags">tags</a><span class="delimiter">)</span> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.p" title="akka.persistence.PersistentRepr">p</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentRepr.payload" title="=&gt; Any">payload</a> match <span class="delimiter">{</span>
              case Tagged<span class="delimiter">(</span><a title="Any" id="akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.x$1.payload">payload</a>, <span title="Set[String]">tags</span><span class="delimiter">)</span> ⇒
                <span title="(_1: akka.persistence.PersistentRepr, _2: Set[String])(akka.persistence.PersistentRepr, Set[String])" class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.p" title="akka.persistence.PersistentRepr">p</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentRepr.withPayload" title="(payload: Any)akka.persistence.PersistentRepr">withPayload</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.x$1.payload" title="Any">payload</a><span class="delimiter">)</span>, <span title="Set[String]">tags</span><span class="delimiter">)</span>
              case _ ⇒ <span title="(_1: akka.persistence.PersistentRepr, _2: scala.collection.immutable.Set[String])(akka.persistence.PersistentRepr, scala.collection.immutable.Set[String])" class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.p" title="akka.persistence.PersistentRepr">p</a>, <span title="=&gt; scala.collection.immutable.Set.type">Set</span>.<span title="[A]=&gt; scala.collection.immutable.Set[A]">empty</span><span title="scala.collection.immutable.Set[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            if <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.tags" title="Set[String]">tags</a>.<span title="=&gt; Boolean">nonEmpty</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.hasTagSubscribers" title="=&gt; Boolean">hasTagSubscribers</a><span class="delimiter">)</span>
              <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.allTags" title="scala.collection.immutable.Set[String]">allTags</a> <span title="(elems: scala.collection.GenTraversableOnce[String])scala.collection.immutable.Set[String]">++=</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.tags" title="Set[String]">tags</a>

            <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.p2" title="akka.persistence.PersistentRepr">p2</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentRepr.persistenceId" title="=&gt; String">persistenceId</a>.<span title="(x$1: String)Boolean">startsWith</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.tagPersistenceIdPrefix" title="=&gt; String">tagPersistenceIdPrefix</a><span class="delimiter">)</span>,
              <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;persistenceId [&quot;)">persistenceId [$</span><span class="delimiter">{</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.p" title="akka.persistence.PersistentRepr">p</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentRepr.persistenceId" title="=&gt; String">persistenceId</a><span class="delimiter">}</span><span title="String(&quot;] must not start with &quot;)">] must not start with $</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.tagPersistenceIdPrefix" title="=&gt; String">tagPersistenceIdPrefix</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
            <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch" title="(persistent: akka.persistence.PersistentRepr, tags: Set[String], batch: org.iq80.leveldb.WriteBatch)Unit">addToMessageBatch</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.p2" title="akka.persistence.PersistentRepr">p2</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.$anonfun.tags" title="Set[String]">tags</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.batch" title="org.iq80.leveldb.WriteBatch">batch</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          if <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.hasPersistenceIdSubscribers" title="=&gt; Boolean">hasPersistenceIdSubscribers</a><span class="delimiter">)</span>
            <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.persistenceIds" title="scala.collection.immutable.Set[String]">persistenceIds</a> <span title="(elem: String)scala.collection.immutable.Set[String]">+=</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result.$anonfun.$anonfun.a" title="akka.persistence.AtomicWrite">a</a>.<a href="../../Persistent.scala.html#akka.persistence;AtomicWrite.persistenceId" title="=&gt; String">persistenceId</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    if <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.hasPersistenceIdSubscribers" title="=&gt; Boolean">hasPersistenceIdSubscribers</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.persistenceIds" title="scala.collection.immutable.Set[String]">persistenceIds</a>.<span title="(f: String =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.$anonfun.pid">pid</a> ⇒
        <a href="#akka.persistence.journal.leveldb;LeveldbStore.notifyPersistenceIdChange" title="(persistenceId: String)Unit">notifyPersistenceIdChange</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.$anonfun.pid" title="String">pid</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    if <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.hasTagSubscribers" title="=&gt; Boolean">hasTagSubscribers</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.allTags" title="scala.collection.immutable.Set[String]">allTags</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.allTags" title="scala.collection.immutable.Set[String]">allTags</a>.<span title="(f: String =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.notifyTagChange" title="(tag: String)Unit">notifyTagChange</a><span class="delimiter">)</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncWriteMessages.result" title="scala.concurrent.Future[scala.collection.immutable.Seq[scala.util.Try[Unit]]]">result</a>
  <span class="delimiter">}</span>

  def <a title="(persistenceId: String, toSequenceNr: Long)scala.concurrent.Future[Unit]" id="akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo">asyncDeleteMessagesTo</a><span class="delimiter">(</span><a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="Long" id="akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.toSequenceNr">toSequenceNr</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Unit]">Future</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span> =
    try <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: Unit)scala.concurrent.Future[Unit]">successful</span> <span class="delimiter">{</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch" title="(body: org.iq80.leveldb.WriteBatch =&gt; Unit)Unit">withBatch</a> <span class="delimiter">{</span> <a title="org.iq80.leveldb.WriteBatch" id="akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.batch">batch</a> ⇒
        val <a title="Int" id="akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.nid">nid</a> = <a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.numericId" title="(id: String)Int">numericId</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.persistenceId" title="String">persistenceId</a><span class="delimiter">)</span>

        <span class="comment">// seek to first existing message</span>
        val <a title="Long" id="akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.fromSequenceNr">fromSequenceNr</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.withIterator" title="(body: org.iq80.leveldb.DBIterator =&gt; Long)Long">withIterator</a> <span class="delimiter">{</span> <a title="org.iq80.leveldb.DBIterator" id="akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.fromSequenceNr.$anonfun.iter">iter</a> ⇒
          val <a title="akka.persistence.journal.leveldb.Key" id="akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.fromSequenceNr.$anonfun.startKey">startKey</a> = <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key" title="(persistenceId: Int, sequenceNr: Long, mappingId: Int)akka.persistence.journal.leveldb.Key">Key</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.nid" title="Int">nid</a>, <span title="Long(1L)" class="long">1L</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
          <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.fromSequenceNr.$anonfun.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="(x$1: Array[Byte])Unit">seek</span><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.fromSequenceNr.$anonfun.startKey" title="akka.persistence.journal.leveldb.Key">startKey</a><span class="delimiter">)</span><span class="delimiter">)</span>
          if <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.fromSequenceNr.$anonfun.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyFromBytes" title="(bytes: Array[Byte])akka.persistence.journal.leveldb.Key">keyFromBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.fromSequenceNr.$anonfun.iter" title="org.iq80.leveldb.DBIterator">iter</a>.<span title="()java.util.Map.Entry[Array[Byte],Array[Byte]]">peekNext</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Array[Byte]">getKey</span><span class="delimiter">)</span>.<a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key.sequenceNr" title="=&gt; Long">sequenceNr</a> else Long.<span title="Long(9223372036854775807L)">MaxValue</span>
        <span class="delimiter">}</span>

        <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.fromSequenceNr" title="implicit scala.LowPriorityImplicits.longWrapper : (x: Long)scala.runtime.RichLong">fromSequenceNr</a> <span title="(end: Long)scala.collection.immutable.NumericRange.Inclusive[Long]">to</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.toSequenceNr" title="Long">toSequenceNr</a> <span title="(f: Long =&gt; org.iq80.leveldb.WriteBatch)Unit">foreach</span> <span class="delimiter">{</span> <a title="Long" id="akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.$anonfun.sequenceNr">sequenceNr</a> ⇒
          <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.batch" title="org.iq80.leveldb.WriteBatch">batch</a>.<span title="(x$1: Array[Byte])org.iq80.leveldb.WriteBatch">delete</span><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key" title="(persistenceId: Int, sequenceNr: Long, mappingId: Int)akka.persistence.journal.leveldb.Key">Key</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.nid" title="Int">nid</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.$anonfun.$anonfun.sequenceNr" title="Long">sequenceNr</a>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> catch <span class="delimiter">{</span>
      case <a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span><a title="Throwable" id="akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.e">e</a><span class="delimiter">)</span> ⇒ <span title="scala.concurrent.Future.type">Future</span>.<span title="(exception: Throwable)scala.concurrent.Future[Nothing]">failed</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.asyncDeleteMessagesTo.e" title="Throwable">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  def <a title="()org.iq80.leveldb.ReadOptions" id="akka.persistence.journal.leveldb;LeveldbStore.leveldbSnapshot">leveldbSnapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="org.iq80.leveldb.ReadOptions">ReadOptions</span> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldbReadOptions" title="=&gt; org.iq80.leveldb.ReadOptions">leveldbReadOptions</a>.<span title="(x$1: org.iq80.leveldb.Snapshot)org.iq80.leveldb.ReadOptions">snapshot</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldb_=" title="=&gt; org.iq80.leveldb.DB">leveldb</a>.<span title="()org.iq80.leveldb.Snapshot">getSnapshot</span><span class="delimiter">)</span>

  def <a title="[R](body: org.iq80.leveldb.DBIterator =&gt; R)R" id="akka.persistence.journal.leveldb;LeveldbStore.withIterator">withIterator</a><span class="delimiter">[</span><a title="" id="akka.persistence.journal.leveldb;LeveldbStore.withIterator;R">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="org.iq80.leveldb.DBIterator =&gt; R" id="akka.persistence.journal.leveldb;LeveldbStore.withIterator.body">body</a>: DBIterator ⇒ R<span class="delimiter">)</span>: <a href="#akka.persistence.journal.leveldb;LeveldbStore.withIterator;R" title="R">R</a> = <span class="delimiter">{</span>
    val <a title="org.iq80.leveldb.ReadOptions" id="akka.persistence.journal.leveldb;LeveldbStore.withIterator.ro">ro</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldbSnapshot" title="()org.iq80.leveldb.ReadOptions">leveldbSnapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="org.iq80.leveldb.DBIterator" id="akka.persistence.journal.leveldb;LeveldbStore.withIterator.iterator">iterator</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldb_=" title="=&gt; org.iq80.leveldb.DB">leveldb</a>.<span title="(x$1: org.iq80.leveldb.ReadOptions)org.iq80.leveldb.DBIterator">iterator</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.withIterator.ro" title="org.iq80.leveldb.ReadOptions">ro</a><span class="delimiter">)</span>
    try <span class="delimiter">{</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.withIterator.body" title="(v1: org.iq80.leveldb.DBIterator)R">body</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.withIterator.iterator" title="org.iq80.leveldb.DBIterator">iterator</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> finally <span class="delimiter">{</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.withIterator.iterator" title="org.iq80.leveldb.DBIterator">iterator</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.withIterator.ro" title="org.iq80.leveldb.ReadOptions">ro</a>.<span title="()org.iq80.leveldb.Snapshot">snapshot</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="[R](body: org.iq80.leveldb.WriteBatch =&gt; R)R" id="akka.persistence.journal.leveldb;LeveldbStore.withBatch">withBatch</a><span class="delimiter">[</span><a title="" id="akka.persistence.journal.leveldb;LeveldbStore.withBatch;R">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="org.iq80.leveldb.WriteBatch =&gt; R" id="akka.persistence.journal.leveldb;LeveldbStore.withBatch.body">body</a>: WriteBatch ⇒ R<span class="delimiter">)</span>: <a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch;R" title="R">R</a> = <span class="delimiter">{</span>
    val <a title="org.iq80.leveldb.WriteBatch" id="akka.persistence.journal.leveldb;LeveldbStore.withBatch.batch">batch</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldb_=" title="=&gt; org.iq80.leveldb.DB">leveldb</a>.<span title="()org.iq80.leveldb.WriteBatch">createWriteBatch</span><span class="delimiter">(</span><span class="delimiter">)</span>
    try <span class="delimiter">{</span>
      val <a title="R" id="akka.persistence.journal.leveldb;LeveldbStore.withBatch.r">r</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch.body" title="(v1: org.iq80.leveldb.WriteBatch)R">body</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch.batch" title="org.iq80.leveldb.WriteBatch">batch</a><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldb_=" title="=&gt; org.iq80.leveldb.DB">leveldb</a>.<span title="(x$1: org.iq80.leveldb.WriteBatch, x$2: org.iq80.leveldb.WriteOptions)org.iq80.leveldb.Snapshot">write</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch.batch" title="org.iq80.leveldb.WriteBatch">batch</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldbWriteOptions" title="=&gt; org.iq80.leveldb.WriteOptions">leveldbWriteOptions</a><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch.r" title="R">r</a>
    <span class="delimiter">}</span> finally <span class="delimiter">{</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.withBatch.batch" title="org.iq80.leveldb.WriteBatch">batch</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  def <a title="(p: akka.persistence.PersistentRepr)Array[Byte]" id="akka.persistence.journal.leveldb;LeveldbStore.persistentToBytes">persistentToBytes</a><span class="delimiter">(</span><a title="akka.persistence.PersistentRepr" id="akka.persistence.journal.leveldb;LeveldbStore.persistentToBytes.p">p</a>: <a href="../../Persistent.scala.html#akka.persistence;PersistentRepr" title="akka.persistence.PersistentRepr">PersistentRepr</a><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.serialization" title="=&gt; akka.serialization.Serialization">serialization</a>.<a href="../../../../../actor/akka/serialization/Serialization.scala.html#akka.serialization;Serialization.serialize" title="(o: AnyRef)scala.util.Try[Array[Byte]]">serialize</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.persistentToBytes.p" title="akka.persistence.PersistentRepr">p</a><span class="delimiter">)</span>.<span title="=&gt; Array[Byte]">get</span>
  def <a title="(a: Array[Byte])akka.persistence.PersistentRepr" id="akka.persistence.journal.leveldb;LeveldbStore.persistentFromBytes">persistentFromBytes</a><span class="delimiter">(</span><a title="Array[Byte]" id="akka.persistence.journal.leveldb;LeveldbStore.persistentFromBytes.a">a</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Persistent.scala.html#akka.persistence;PersistentRepr" title="akka.persistence.PersistentRepr">PersistentRepr</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.serialization" title="=&gt; akka.serialization.Serialization">serialization</a>.<a href="../../../../../actor/akka/serialization/Serialization.scala.html#akka.serialization;Serialization.deserialize(2392165273)" title="(bytes: Array[Byte], clazz: Class[akka.persistence.PersistentRepr])scala.util.Try[akka.persistence.PersistentRepr]">deserialize</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.persistentFromBytes.a" title="Array[Byte]">a</a>, classOf<span title="Class[akka.persistence.PersistentRepr](classOf[akka.persistence.PersistentRepr])" class="delimiter">[</span>PersistentRepr<span class="delimiter">]</span><span class="delimiter">)</span>.<span title="=&gt; akka.persistence.PersistentRepr">get</span>

  private def <a title="(persistent: akka.persistence.PersistentRepr, tags: Set[String], batch: org.iq80.leveldb.WriteBatch)Unit" id="akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch">addToMessageBatch</a><span class="delimiter">(</span><a title="akka.persistence.PersistentRepr" id="akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.persistent">persistent</a>: <a href="../../Persistent.scala.html#akka.persistence;PersistentRepr" title="akka.persistence.PersistentRepr">PersistentRepr</a>, <a title="Set[String]" id="akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.tags">tags</a>: <span title="Set[String]">Set</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="org.iq80.leveldb.WriteBatch" id="akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.batch">batch</a>: <span title="org.iq80.leveldb.WriteBatch">WriteBatch</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val <a title="Array[Byte]" id="akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.persistentBytes">persistentBytes</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.persistentToBytes" title="(p: akka.persistence.PersistentRepr)Array[Byte]">persistentToBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.persistent" title="akka.persistence.PersistentRepr">persistent</a><span class="delimiter">)</span>
    val <a title="Int" id="akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.nid">nid</a> = <a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.numericId" title="(id: String)Int">numericId</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.persistent" title="akka.persistence.PersistentRepr">persistent</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentRepr.persistenceId" title="=&gt; String">persistenceId</a><span class="delimiter">)</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.batch" title="org.iq80.leveldb.WriteBatch">batch</a>.<span title="(x$1: Array[Byte], x$2: Array[Byte])org.iq80.leveldb.WriteBatch">put</span><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.counterKey" title="(persistenceId: Int)akka.persistence.journal.leveldb.Key">counterKey</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.nid" title="Int">nid</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.counterToBytes" title="(ctr: Long)Array[Byte]">counterToBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.persistent" title="akka.persistence.PersistentRepr">persistent</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentRepr.sequenceNr" title="=&gt; Long">sequenceNr</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.batch" title="org.iq80.leveldb.WriteBatch">batch</a>.<span title="(x$1: Array[Byte], x$2: Array[Byte])org.iq80.leveldb.WriteBatch">put</span><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key" title="(persistenceId: Int, sequenceNr: Long, mappingId: Int)akka.persistence.journal.leveldb.Key">Key</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.nid" title="Int">nid</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.persistent" title="akka.persistence.PersistentRepr">persistent</a>.<a href="../../Persistent.scala.html#akka.persistence;PersistentRepr.sequenceNr" title="=&gt; Long">sequenceNr</a>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.persistentBytes" title="Array[Byte]">persistentBytes</a><span class="delimiter">)</span>

    <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.tags" title="Set[String]">tags</a>.<span title="(f: String =&gt; org.iq80.leveldb.WriteBatch)Unit">foreach</span> <span class="delimiter">{</span> <a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.$anonfun.tag">tag</a> ⇒
      val <a title="Int" id="akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.$anonfun.tagNid">tagNid</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.tagNumericId" title="(tag: String)Int">tagNumericId</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.$anonfun.tag" title="String">tag</a><span class="delimiter">)</span>
      val <a title="Long" id="akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.$anonfun.tagSeqNr">tagSeqNr</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.nextTagSequenceNr" title="(tag: String)Long">nextTagSequenceNr</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.$anonfun.tag" title="String">tag</a><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.batch" title="org.iq80.leveldb.WriteBatch">batch</a>.<span title="(x$1: Array[Byte], x$2: Array[Byte])org.iq80.leveldb.WriteBatch">put</span><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.counterKey" title="(persistenceId: Int)akka.persistence.journal.leveldb.Key">counterKey</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.$anonfun.tagNid" title="Int">tagNid</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.counterToBytes" title="(ctr: Long)Array[Byte]">counterToBytes</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.$anonfun.tagSeqNr" title="Long">tagSeqNr</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.batch" title="org.iq80.leveldb.WriteBatch">batch</a>.<span title="(x$1: Array[Byte], x$2: Array[Byte])org.iq80.leveldb.WriteBatch">put</span><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb.Key.keyToBytes" title="(key: akka.persistence.journal.leveldb.Key)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="LeveldbKey.scala.html#akka.persistence.journal.leveldb;Key" title="(persistenceId: Int, sequenceNr: Long, mappingId: Int)akka.persistence.journal.leveldb.Key">Key</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.$anonfun.tagNid" title="Int">tagNid</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.$anonfun.tagSeqNr" title="Long">tagSeqNr</a>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.addToMessageBatch.persistentBytes" title="Array[Byte]">persistentBytes</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(tag: String)Long" id="akka.persistence.journal.leveldb;LeveldbStore.nextTagSequenceNr">nextTagSequenceNr</a><span class="delimiter">(</span><a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.nextTagSequenceNr.tag">tag</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <span class="delimiter">{</span>
    val <a title="Long" id="akka.persistence.journal.leveldb;LeveldbStore.nextTagSequenceNr.n">n</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.tagSequenceNr_=" title="=&gt; scala.collection.immutable.Map[String,Long]">tagSequenceNr</a>.<span title="(key: String)Option[Long]">get</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.nextTagSequenceNr.tag" title="String">tag</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="Long" id="akka.persistence.journal.leveldb;LeveldbStore.nextTagSequenceNr.n.n">n</a><span class="delimiter">)</span> ⇒ <a href="#akka.persistence.journal.leveldb;LeveldbStore.nextTagSequenceNr.n.n" title="Long">n</a>
      case <span title="None.type">None</span>    ⇒ <a href="LeveldbRecovery.scala.html#akka.persistence.journal.leveldb;LeveldbRecovery.readHighestSequenceNr" title="(persistenceId: Int)Long">readHighestSequenceNr</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.tagNumericId" title="(tag: String)Int">tagNumericId</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.nextTagSequenceNr.tag" title="String">tag</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.tagSequenceNr_=" title="(x$1: scala.collection.immutable.Map[String,Long])Unit">tagSequenceNr</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.tagSequenceNr_=" title="=&gt; scala.collection.immutable.Map[String,Long]">tagSequenceNr</a>.<span title="(key: String, value: Long)scala.collection.immutable.Map[String,Long]">updated</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.nextTagSequenceNr.tag" title="String">tag</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.nextTagSequenceNr.n" title="Long">n</a> <span title="(x: Int)Long">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.nextTagSequenceNr.n" title="Long">n</a> <span title="(x: Int)Long">+</span> <span title="Int(1)" class="int">1</span>
  <span class="delimiter">}</span>

  def <a title="(tag: String)Int" id="akka.persistence.journal.leveldb;LeveldbStore.tagNumericId">tagNumericId</a><span class="delimiter">(</span><a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.tagNumericId.tag">tag</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Int">Int</span> =
    <a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.numericId" title="(id: String)Int">numericId</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.tagAsPersistenceId" title="(tag: String)String">tagAsPersistenceId</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.tagNumericId.tag" title="String">tag</a><span class="delimiter">)</span><span class="delimiter">)</span>

  def <a title="(tag: String)String" id="akka.persistence.journal.leveldb;LeveldbStore.tagAsPersistenceId">tagAsPersistenceId</a><span class="delimiter">(</span><a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.tagAsPersistenceId.tag">tag</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> =
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.tagPersistenceIdPrefix" title="=&gt; String">tagPersistenceIdPrefix</a> <span title="(x$1: Any)String">+</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.tagAsPersistenceId.tag" title="String">tag</a>

  override def <a title="()Unit" id="akka.persistence.journal.leveldb;LeveldbStore.preStart">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldb_=" title="(x$1: org.iq80.leveldb.DB)Unit">leveldb</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldbFactory" title="=&gt; org.iq80.leveldb.DBFactory">leveldbFactory</a>.<span title="(x$1: java.io.File, x$2: org.iq80.leveldb.Options)org.iq80.leveldb.DB">open</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldbDir" title="=&gt; java.io.File">leveldbDir</a>, if <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.nativeLeveldb" title="=&gt; Boolean">nativeLeveldb</a><span class="delimiter">)</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldbOptions" title="=&gt; org.iq80.leveldb.Options">leveldbOptions</a> else <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldbOptions" title="=&gt; org.iq80.leveldb.Options">leveldbOptions</a>.<span title="(x$1: org.iq80.leveldb.CompressionType)org.iq80.leveldb.Options">compressionType</span><span class="delimiter">(</span>CompressionType.<span title="org.iq80.leveldb.CompressionType(NONE)">NONE</span><span class="delimiter">)</span><span class="delimiter">)</span>
    super.<a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.preStart" title="()Unit">preStart</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  override def <a title="()Unit" id="akka.persistence.journal.leveldb;LeveldbStore.postStop">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.leveldb_=" title="=&gt; org.iq80.leveldb.DB">leveldb</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    super.<a href="../../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.postStop" title="()Unit">postStop</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  protected def <a title="=&gt; Boolean" id="akka.persistence.journal.leveldb;LeveldbStore.hasPersistenceIdSubscribers">hasPersistenceIdSubscribers</a>: <span title="Boolean">Boolean</span> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.persistenceIdSubscribers" title="=&gt; scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]">persistenceIdSubscribers</a>.<span title="=&gt; Boolean">nonEmpty</span>

  protected def <a title="(subscriber: akka.actor.ActorRef, persistenceId: String)Unit" id="akka.persistence.journal.leveldb;LeveldbStore.addPersistenceIdSubscriber">addPersistenceIdSubscriber</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.persistence.journal.leveldb;LeveldbStore.addPersistenceIdSubscriber.subscriber">subscriber</a>: <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.addPersistenceIdSubscriber.persistenceId">persistenceId</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.persistenceIdSubscribers" title="=&gt; scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]">persistenceIdSubscribers</a>.<span title="(key: String, value: akka.actor.ActorRef)akka.persistence.journal.leveldb.LeveldbStore.&lt;refinement&gt;.type">addBinding</span><span title="Unit" class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addPersistenceIdSubscriber.persistenceId" title="String">persistenceId</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.addPersistenceIdSubscriber.subscriber" title="akka.actor.ActorRef">subscriber</a><span class="delimiter">)</span>

  protected def <a title="(subscriber: akka.actor.ActorRef)Unit" id="akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber">removeSubscriber</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.subscriber">subscriber</a>: <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val <a title="scala.collection.mutable.Iterable[String]" id="akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.keys">keys</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.persistenceIdSubscribers" title="=&gt; scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]">persistenceIdSubscribers</a>.<span title="(pf: PartialFunction[(String, scala.collection.mutable.Set[akka.actor.ActorRef]),String])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]],String,scala.collection.mutable.Iterable[String]])scala.collection.mutable.Iterable[String]">collect</span> <a title="&lt;$anon: ((String, scala.collection.mutable.Set[akka.actor.ActorRef])) =&gt; String&gt; extends scala.runtime.AbstractPartialFunction[(String, scala.collection.mutable.Set[akka.actor.ActorRef]),String] with Serializable" id="akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.keys;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a> case <span class="delimiter">(</span><a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.keys;$anonfun.isDefinedAt.k">k</a>, <a title="scala.collection.mutable.Set[akka.actor.ActorRef]" id="akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.keys;$anonfun.isDefinedAt.s">s</a><span class="delimiter">)</span> if <a href="#akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.keys;$anonfun.isDefinedAt.s" title="scala.collection.mutable.Set[akka.actor.ActorRef]">s</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.subscriber" title="akka.actor.ActorRef">subscriber</a><span class="delimiter">)</span> ⇒ <a href="#akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.keys;$anonfun.isDefinedAt.k" title="String">k</a> <span class="delimiter">}</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.keys" title="scala.collection.mutable.Iterable[String]">keys</a>.<span title="(f: String =&gt; scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef])Unit">foreach</span> <span class="delimiter">{</span> <span title="String">key</span> ⇒ <a href="#akka.persistence.journal.leveldb;LeveldbStore.persistenceIdSubscribers" title="=&gt; scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]">persistenceIdSubscribers</a>.<span title="(key: String, value: akka.actor.ActorRef)akka.persistence.journal.leveldb.LeveldbStore.&lt;refinement&gt;.type">removeBinding</span><span class="delimiter">(</span><span title="String">key</span>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.subscriber" title="akka.actor.ActorRef">subscriber</a><span class="delimiter">)</span> <span class="delimiter">}</span>

    val <a title="scala.collection.mutable.Iterable[String]" id="akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.tagKeys">tagKeys</a> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.tagSubscribers" title="=&gt; scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]">tagSubscribers</a>.<span title="(pf: PartialFunction[(String, scala.collection.mutable.Set[akka.actor.ActorRef]),String])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]],String,scala.collection.mutable.Iterable[String]])scala.collection.mutable.Iterable[String]">collect</span> <a title="&lt;$anon: ((String, scala.collection.mutable.Set[akka.actor.ActorRef])) =&gt; String&gt; extends scala.runtime.AbstractPartialFunction[(String, scala.collection.mutable.Set[akka.actor.ActorRef]),String] with Serializable" id="akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.tagKeys;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a> case <span class="delimiter">(</span><a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.tagKeys;$anonfun.isDefinedAt.k">k</a>, <a title="scala.collection.mutable.Set[akka.actor.ActorRef]" id="akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.tagKeys;$anonfun.isDefinedAt.s">s</a><span class="delimiter">)</span> if <a href="#akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.tagKeys;$anonfun.isDefinedAt.s" title="scala.collection.mutable.Set[akka.actor.ActorRef]">s</a>.<span title="(elem: akka.actor.ActorRef)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.subscriber" title="akka.actor.ActorRef">subscriber</a><span class="delimiter">)</span> ⇒ <a href="#akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.tagKeys;$anonfun.isDefinedAt.k" title="String">k</a> <span class="delimiter">}</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.tagKeys" title="scala.collection.mutable.Iterable[String]">tagKeys</a>.<span title="(f: String =&gt; scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef])Unit">foreach</span> <span class="delimiter">{</span> <span title="String">key</span> ⇒ <a href="#akka.persistence.journal.leveldb;LeveldbStore.tagSubscribers" title="=&gt; scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]">tagSubscribers</a>.<span title="(key: String, value: akka.actor.ActorRef)akka.persistence.journal.leveldb.LeveldbStore.&lt;refinement&gt;.type">removeBinding</span><span class="delimiter">(</span><span title="String">key</span>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.subscriber" title="akka.actor.ActorRef">subscriber</a><span class="delimiter">)</span> <span class="delimiter">}</span>

    <a href="#akka.persistence.journal.leveldb;LeveldbStore.allPersistenceIdsSubscribers_=" title="(x$1: scala.collection.immutable.Set[akka.actor.ActorRef])Unit">allPersistenceIdsSubscribers</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">-=</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.removeSubscriber.subscriber" title="akka.actor.ActorRef">subscriber</a>
  <span class="delimiter">}</span>

  protected def <a title="=&gt; Boolean" id="akka.persistence.journal.leveldb;LeveldbStore.hasTagSubscribers">hasTagSubscribers</a>: <span title="Boolean">Boolean</span> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.tagSubscribers" title="=&gt; scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]">tagSubscribers</a>.<span title="=&gt; Boolean">nonEmpty</span>

  protected def <a title="(subscriber: akka.actor.ActorRef, tag: String)Unit" id="akka.persistence.journal.leveldb;LeveldbStore.addTagSubscriber">addTagSubscriber</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.persistence.journal.leveldb;LeveldbStore.addTagSubscriber.subscriber">subscriber</a>: <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a>, <a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.addTagSubscriber.tag">tag</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.tagSubscribers" title="=&gt; scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]">tagSubscribers</a>.<span title="(key: String, value: akka.actor.ActorRef)akka.persistence.journal.leveldb.LeveldbStore.&lt;refinement&gt;.type">addBinding</span><span title="Unit" class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.addTagSubscriber.tag" title="String">tag</a>, <a href="#akka.persistence.journal.leveldb;LeveldbStore.addTagSubscriber.subscriber" title="akka.actor.ActorRef">subscriber</a><span class="delimiter">)</span>

  protected def <a title="=&gt; Boolean" id="akka.persistence.journal.leveldb;LeveldbStore.hasAllPersistenceIdsSubscribers">hasAllPersistenceIdsSubscribers</a>: <span title="Boolean">Boolean</span> = <a href="#akka.persistence.journal.leveldb;LeveldbStore.allPersistenceIdsSubscribers_=" title="=&gt; scala.collection.immutable.Set[akka.actor.ActorRef]">allPersistenceIdsSubscribers</a>.<span title="=&gt; Boolean">nonEmpty</span>

  protected def <a title="(subscriber: akka.actor.ActorRef)Unit" id="akka.persistence.journal.leveldb;LeveldbStore.addAllPersistenceIdsSubscriber">addAllPersistenceIdsSubscriber</a><span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.persistence.journal.leveldb;LeveldbStore.addAllPersistenceIdsSubscriber.subscriber">subscriber</a>: <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#akka.persistence.journal.leveldb;LeveldbStore.allPersistenceIdsSubscribers_=" title="(x$1: scala.collection.immutable.Set[akka.actor.ActorRef])Unit">allPersistenceIdsSubscribers</a> <span title="(elem: akka.actor.ActorRef)scala.collection.immutable.Set[akka.actor.ActorRef]">+=</span> <a href="#akka.persistence.journal.leveldb;LeveldbStore.addAllPersistenceIdsSubscriber.subscriber" title="akka.actor.ActorRef">subscriber</a>
    <a href="../../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">subscriber</a> <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="LeveldbJournal.scala.html#akka.persistence.journal.leveldb.LeveldbJournal" title="akka.persistence.journal.leveldb.LeveldbJournal.type">LeveldbJournal</a>.<a href="LeveldbJournal.scala.html#akka.persistence.journal.leveldb.LeveldbJournal;CurrentPersistenceIds" title="(allPersistenceIds: Set[String])akka.persistence.journal.leveldb.LeveldbJournal.CurrentPersistenceIds">CurrentPersistenceIds</a><span class="delimiter">(</span><a href="LeveldbIdMapping.scala.html#akka.persistence.journal.leveldb;LeveldbIdMapping.allPersistenceIds" title="=&gt; Set[String]">allPersistenceIds</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private def <a title="(persistenceId: String)Unit" id="akka.persistence.journal.leveldb;LeveldbStore.notifyPersistenceIdChange">notifyPersistenceIdChange</a><span class="delimiter">(</span><a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.notifyPersistenceIdChange.persistenceId">persistenceId</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    if <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.persistenceIdSubscribers" title="=&gt; scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]">persistenceIdSubscribers</a>.<span title="(key: String)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.notifyPersistenceIdChange.persistenceId" title="String">persistenceId</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="akka.persistence.journal.leveldb.LeveldbJournal.EventAppended" id="akka.persistence.journal.leveldb;LeveldbStore.notifyPersistenceIdChange.changed">changed</a> = <a href="LeveldbJournal.scala.html#akka.persistence.journal.leveldb.LeveldbJournal" title="akka.persistence.journal.leveldb.LeveldbJournal.type">LeveldbJournal</a>.<a href="LeveldbJournal.scala.html#akka.persistence.journal.leveldb.LeveldbJournal;EventAppended" title="(persistenceId: String)akka.persistence.journal.leveldb.LeveldbJournal.EventAppended">EventAppended</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.notifyPersistenceIdChange.persistenceId" title="String">persistenceId</a><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.persistenceIdSubscribers" title="(key: String)scala.collection.mutable.Set[akka.actor.ActorRef]">persistenceIdSubscribers</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.notifyPersistenceIdChange.persistenceId" title="String">persistenceId</a><span class="delimiter">)</span>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">_</a> <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.persistence.journal.leveldb;LeveldbStore.notifyPersistenceIdChange.changed" title="akka.persistence.journal.leveldb.LeveldbJournal.EventAppended">changed</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  private def <a title="(tag: String)Unit" id="akka.persistence.journal.leveldb;LeveldbStore.notifyTagChange">notifyTagChange</a><span class="delimiter">(</span><a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.notifyTagChange.tag">tag</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    if <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.tagSubscribers" title="=&gt; scala.collection.mutable.HashMap[String,scala.collection.mutable.Set[akka.actor.ActorRef]] with scala.collection.mutable.MultiMap[String,akka.actor.ActorRef]">tagSubscribers</a>.<span title="(key: String)Boolean">contains</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.notifyTagChange.tag" title="String">tag</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="akka.persistence.journal.leveldb.LeveldbJournal.TaggedEventAppended" id="akka.persistence.journal.leveldb;LeveldbStore.notifyTagChange.changed">changed</a> = <a href="LeveldbJournal.scala.html#akka.persistence.journal.leveldb.LeveldbJournal" title="akka.persistence.journal.leveldb.LeveldbJournal.type">LeveldbJournal</a>.<a href="LeveldbJournal.scala.html#akka.persistence.journal.leveldb.LeveldbJournal;TaggedEventAppended" title="(tag: String)akka.persistence.journal.leveldb.LeveldbJournal.TaggedEventAppended">TaggedEventAppended</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.notifyTagChange.tag" title="String">tag</a><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.tagSubscribers" title="(key: String)scala.collection.mutable.Set[akka.actor.ActorRef]">tagSubscribers</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.notifyTagChange.tag" title="String">tag</a><span class="delimiter">)</span>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">_</a> <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.persistence.journal.leveldb;LeveldbStore.notifyTagChange.changed" title="akka.persistence.journal.leveldb.LeveldbJournal.TaggedEventAppended">changed</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  override protected def <a title="(id: String)Unit" id="akka.persistence.journal.leveldb;LeveldbStore.newPersistenceIdAdded">newPersistenceIdAdded</a><span class="delimiter">(</span><a title="String" id="akka.persistence.journal.leveldb;LeveldbStore.newPersistenceIdAdded.id">id</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.hasAllPersistenceIdsSubscribers" title="=&gt; Boolean">hasAllPersistenceIdsSubscribers</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.newPersistenceIdAdded.id" title="String">id</a>.<span title="(x$1: String)Boolean">startsWith</span><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.tagPersistenceIdPrefix" title="=&gt; String">tagPersistenceIdPrefix</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="akka.persistence.journal.leveldb.LeveldbJournal.PersistenceIdAdded" id="akka.persistence.journal.leveldb;LeveldbStore.newPersistenceIdAdded.added">added</a> = <a href="LeveldbJournal.scala.html#akka.persistence.journal.leveldb.LeveldbJournal" title="akka.persistence.journal.leveldb.LeveldbJournal.type">LeveldbJournal</a>.<a href="LeveldbJournal.scala.html#akka.persistence.journal.leveldb.LeveldbJournal;PersistenceIdAdded" title="(persistenceId: String)akka.persistence.journal.leveldb.LeveldbJournal.PersistenceIdAdded">PersistenceIdAdded</a><span class="delimiter">(</span><a href="#akka.persistence.journal.leveldb;LeveldbStore.newPersistenceIdAdded.id" title="String">id</a><span class="delimiter">)</span>
      <a href="#akka.persistence.journal.leveldb;LeveldbStore.allPersistenceIdsSubscribers_=" title="=&gt; scala.collection.immutable.Set[akka.actor.ActorRef]">allPersistenceIdsSubscribers</a>.<span title="(f: akka.actor.ActorRef =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="../../../../../actor/akka/actor/package.scala.html#akka.actor.package.actorRef2Scala" title="implicit akka.actor.package.actorRef2Scala : (ref: akka.actor.ActorRef)akka.actor.ScalaActorRef">_</a> <a href="../../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ScalaActorRef.!" title="(message: Any)(implicit sender: akka.actor.ActorRef)Unit">!</a> <a href="#akka.persistence.journal.leveldb;LeveldbStore.newPersistenceIdAdded.added" title="akka.persistence.journal.leveldb.LeveldbJournal.PersistenceIdAdded">added</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>


        </pre>
    </body>
</html>
