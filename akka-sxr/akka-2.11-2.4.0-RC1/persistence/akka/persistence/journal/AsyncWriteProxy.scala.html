<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>persistence/akka/persistence/journal/AsyncWriteProxy.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 */</span>

package akka.persistence.journal

import akka.AkkaException
import akka.actor._
import akka.pattern.ask
import akka.persistence._
import akka.util._
import scala.util.Try

import scala.collection.immutable
import scala.concurrent._
import scala.concurrent.duration.Duration
import scala.<span title="language.type">language</span>.postfixOps

<span class="comment">/**
 * INTERNAL API.
 *
 * A journal that delegates actual storage to a target actor. For testing only.
 */</span>
private<span class="delimiter">[</span>persistence<span class="delimiter">]</span> trait <a title="trait AsyncWriteProxy extends AnyRef with akka.persistence.journal.AsyncWriteJournal with akka.actor.Stash with akka.actor.ActorLogging" id="akka.persistence.journal;AsyncWriteProxy">AsyncWriteProxy</a> extends <a href="AsyncWriteJournal.scala.html#akka.persistence.journal;AsyncWriteJournal" title="akka.persistence.journal.AsyncWriteJournal">AsyncWriteJournal</a> with <a href="../../../../actor/akka/actor/Stash.scala.html#akka.actor;Stash" title="akka.actor.Stash">Stash</a> with <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;ActorLogging" title="akka.actor.ActorLogging">ActorLogging</a> <span class="delimiter">{</span>
  import <a href="#akka.persistence.journal.AsyncWriteProxy" title="akka.persistence.journal.AsyncWriteProxy.type">AsyncWriteProxy</a>._
  import <a href="#akka.persistence.journal.AsyncWriteTarget" title="akka.persistence.journal.AsyncWriteTarget.type">AsyncWriteTarget</a>._
  import <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.dispatcher

  private var <a title="Boolean" id="akka.persistence.journal;AsyncWriteProxy.isInitialized_=">isInitialized</a> = false
  private var <a title="Boolean" id="akka.persistence.journal;AsyncWriteProxy.isInitTimedOut_=">isInitTimedOut</a> = false
  protected var <a title="Option[akka.actor.ActorRef]" id="akka.persistence.journal;AsyncWriteProxy.store_=">store</a>: <span title="Option[akka.actor.ActorRef]">Option</span><span class="delimiter">[</span>ActorRef<span class="delimiter">]</span> = <span title="None.type">None</span>
  private val <a title="scala.concurrent.Future[Nothing]" id="akka.persistence.journal;AsyncWriteProxy.storeNotInitialized">storeNotInitialized</a> =
    <span title="scala.concurrent.Future.type">Future</span>.<span title="(exception: Throwable)scala.concurrent.Future[Nothing]">failed</span><span class="delimiter">(</span>new <span title="java.util.concurrent.TimeoutException">TimeoutException</span><span class="delimiter">(</span><span class="string">&quot;Store not initialized. &quot;</span> <span title="String(&quot;Store not initialized. Use `SharedLeveldbJournal.setStore(sharedStore, system)`&quot;)">+</span>
      <span class="string">&quot;Use `SharedLeveldbJournal.setStore(sharedStore, system)`&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

  override protected<span class="delimiter">[</span>akka<span class="delimiter">]</span> def <a title="()Unit" id="akka.persistence.journal;AsyncWriteProxy.aroundPreStart">aroundPreStart</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.system" title="=&gt; akka.actor.ActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ActorSystem.scheduler" title="=&gt; akka.actor.Scheduler">scheduler</a>.<a href="../../../../actor/akka/actor/Scheduler.scala.html#akka.actor;Scheduler.scheduleOnce(a2d55b51db)" title="(delay: scala.concurrent.duration.FiniteDuration, receiver: akka.actor.ActorRef, message: Any)(implicit executor: scala.concurrent.ExecutionContext, implicit sender: akka.actor.ActorRef)akka.actor.Cancellable">scheduleOnce</a><a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.dispatcher" title="=&gt; scala.concurrent.ExecutionContextExecutor" class="delimiter">(</a><a href="#akka.persistence.journal;AsyncWriteProxy.timeout" title="=&gt; akka.util.Timeout">timeout</a>.<a href="../../../../actor/akka/util/Timeout.scala.html#akka.util;Timeout.duration" title="=&gt; scala.concurrent.duration.FiniteDuration">duration</a>, <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a>, <a href="#akka.persistence.journal.AsyncWriteProxy.InitTimeout.readResolve" title="akka.persistence.journal.AsyncWriteProxy.InitTimeout.type">InitTimeout</a><span class="delimiter">)</span>
    super.<a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.aroundPreStart" title="()Unit">aroundPreStart</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  override protected<span class="delimiter">[</span>akka<span class="delimiter">]</span> def <a title="(receive: AsyncWriteProxy.this.Receive, msg: Any)Unit" id="akka.persistence.journal;AsyncWriteProxy.aroundReceive">aroundReceive</a><span class="delimiter">(</span><a title="AsyncWriteProxy.this.Receive" id="akka.persistence.journal;AsyncWriteProxy.aroundReceive.receive">receive</a>: <span title="AsyncWriteProxy.this.Receive">Receive</span>, <a title="Any" id="akka.persistence.journal;AsyncWriteProxy.aroundReceive.msg">msg</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    if <span class="delimiter">(</span><a href="#akka.persistence.journal;AsyncWriteProxy.isInitialized_=" title="=&gt; Boolean">isInitialized</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#akka.persistence.journal;AsyncWriteProxy.aroundReceive.msg" title="Any">msg</a> <span title="(x$1: Any)Boolean">!=</span> <a href="#akka.persistence.journal.AsyncWriteProxy.InitTimeout.readResolve" title="akka.persistence.journal.AsyncWriteProxy.InitTimeout.type">InitTimeout</a><span class="delimiter">)</span> super.<a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.aroundReceive" title="(receive: akka.actor.Actor.Receive, msg: Any)Unit">aroundReceive</a><span class="delimiter">(</span><a href="#akka.persistence.journal;AsyncWriteProxy.aroundReceive.receive" title="AsyncWriteProxy.this.Receive">receive</a>, <a href="#akka.persistence.journal;AsyncWriteProxy.aroundReceive.msg" title="Any">msg</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> else <a href="#akka.persistence.journal;AsyncWriteProxy.aroundReceive.msg" title="Any">msg</a> match <span class="delimiter">{</span>
      case SetStore<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.persistence.journal;AsyncWriteProxy.aroundReceive.ref">ref</a><span class="delimiter">)</span> ⇒
        <a href="#akka.persistence.journal;AsyncWriteProxy.store_=" title="(x$1: Option[akka.actor.ActorRef])Unit">store</a> = <span title="(x: akka.actor.ActorRef)Some[akka.actor.ActorRef]">Some</span><span class="delimiter">(</span><a href="#akka.persistence.journal;AsyncWriteProxy.aroundReceive.ref" title="akka.actor.ActorRef">ref</a><span class="delimiter">)</span>
        <a href="../../../../actor/akka/actor/Stash.scala.html#akka.actor;StashSupport.unstashAll(aa97cb1b3d)" title="()Unit">unstashAll</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#akka.persistence.journal;AsyncWriteProxy.isInitialized_=" title="(x$1: Boolean)Unit">isInitialized</a> = true
      case <a href="#akka.persistence.journal.AsyncWriteProxy.InitTimeout.readResolve" title="akka.persistence.journal.AsyncWriteProxy.InitTimeout.type">InitTimeout</a> ⇒
        <a href="#akka.persistence.journal;AsyncWriteProxy.isInitTimedOut_=" title="(x$1: Boolean)Unit">isInitTimedOut</a> = true
        <a href="../../../../actor/akka/actor/Stash.scala.html#akka.actor;StashSupport.unstashAll(aa97cb1b3d)" title="()Unit">unstashAll</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="comment">// will trigger appropriate failures</span>
      case _ if <a href="#akka.persistence.journal;AsyncWriteProxy.isInitTimedOut_=" title="=&gt; Boolean">isInitTimedOut</a> ⇒ super.<a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.aroundReceive" title="(receive: akka.actor.Actor.Receive, msg: Any)Unit">aroundReceive</a><span class="delimiter">(</span><a href="#akka.persistence.journal;AsyncWriteProxy.aroundReceive.receive" title="AsyncWriteProxy.this.Receive">receive</a>, <a href="#akka.persistence.journal;AsyncWriteProxy.aroundReceive.msg" title="Any">msg</a><span class="delimiter">)</span>
      case _                   ⇒ <a href="../../../../actor/akka/actor/Stash.scala.html#akka.actor;StashSupport.stash" title="()Unit">stash</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  implicit def <a title="=&gt; akka.util.Timeout" id="akka.persistence.journal;AsyncWriteProxy.timeout">timeout</a>: <a href="../../../../actor/akka/util/Timeout.scala.html#akka.util;Timeout" title="akka.util.Timeout">Timeout</a>

  def <a title="(messages: scala.collection.immutable.Seq[akka.persistence.AtomicWrite])scala.concurrent.Future[scala.collection.immutable.Seq[scala.util.Try[Unit]]]" id="akka.persistence.journal;AsyncWriteProxy.asyncWriteMessages">asyncWriteMessages</a><span class="delimiter">(</span><a title="scala.collection.immutable.Seq[akka.persistence.AtomicWrite]" id="akka.persistence.journal;AsyncWriteProxy.asyncWriteMessages.messages">messages</a>: immutable.<span title="scala.collection.immutable.Seq[akka.persistence.AtomicWrite]">Seq</span><span class="delimiter">[</span>AtomicWrite<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[scala.collection.immutable.Seq[scala.util.Try[Unit]]]">Future</span><span class="delimiter">[</span>immutable.Seq<span class="delimiter">[</span>Try<span class="delimiter">[</span>Unit<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span> =
    <a href="#akka.persistence.journal;AsyncWriteProxy.store_=" title="=&gt; Option[akka.actor.ActorRef]">store</a> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.persistence.journal;AsyncWriteProxy.asyncWriteMessages.s">s</a><span class="delimiter">)</span> ⇒ <span class="delimiter">(</span><a href="../../../../actor/akka/pattern/AskSupport.scala.html#akka.pattern;AskSupport.ask(13940b1e32)" title="implicit akka.pattern.AskSupport.ask : (actorRef: akka.actor.ActorRef)akka.pattern.AskableActorRef">s</a> <a href="../../../../actor/akka/pattern/AskSupport.scala.html#akka.pattern;AskableActorRef.?(840937cb3d)" title="(message: Any)(implicit timeout: akka.util.Timeout, implicit sender: akka.actor.ActorRef)scala.concurrent.Future[Any]">?</a> <a href="#akka.persistence.journal.AsyncWriteTarget.WriteMessages.readResolve" title="(messages: scala.collection.immutable.Seq[akka.persistence.AtomicWrite])akka.persistence.journal.AsyncWriteTarget.WriteMessages">WriteMessages</a><span class="delimiter">(</span><a href="#akka.persistence.journal;AsyncWriteProxy.asyncWriteMessages.messages" title="scala.collection.immutable.Seq[akka.persistence.AtomicWrite]">messages</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="[S](implicit tag: scala.reflect.ClassTag[S])scala.concurrent.Future[S]">mapTo</span><span title="(implicit tag: scala.reflect.ClassTag[scala.collection.immutable.Seq[scala.util.Try[Unit]]])scala.concurrent.Future[scala.collection.immutable.Seq[scala.util.Try[Unit]]]" class="delimiter">[</span>immutable.<span title="scala.collection.immutable.Seq[scala.util.Try[Unit]]">Seq</span><span class="delimiter">[</span>Try<span class="delimiter">[</span>Unit<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>
      case <span title="None.type">None</span>    ⇒ <a href="#akka.persistence.journal;AsyncWriteProxy.storeNotInitialized" title="=&gt; scala.concurrent.Future[Nothing]">storeNotInitialized</a>
    <span class="delimiter">}</span>

  def <a title="(persistenceId: String, toSequenceNr: Long)scala.concurrent.Future[Unit]" id="akka.persistence.journal;AsyncWriteProxy.asyncDeleteMessagesTo">asyncDeleteMessagesTo</a><span class="delimiter">(</span><a title="String" id="akka.persistence.journal;AsyncWriteProxy.asyncDeleteMessagesTo.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="Long" id="akka.persistence.journal;AsyncWriteProxy.asyncDeleteMessagesTo.toSequenceNr">toSequenceNr</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Unit]">Future</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span> =
    <a href="#akka.persistence.journal;AsyncWriteProxy.store_=" title="=&gt; Option[akka.actor.ActorRef]">store</a> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.persistence.journal;AsyncWriteProxy.asyncDeleteMessagesTo.s">s</a><span class="delimiter">)</span> ⇒ <span class="delimiter">(</span><a href="../../../../actor/akka/pattern/AskSupport.scala.html#akka.pattern;AskSupport.ask(13940b1e32)" title="implicit akka.pattern.AskSupport.ask : (actorRef: akka.actor.ActorRef)akka.pattern.AskableActorRef">s</a> <a href="../../../../actor/akka/pattern/AskSupport.scala.html#akka.pattern;AskableActorRef.?(840937cb3d)" title="(message: Any)(implicit timeout: akka.util.Timeout, implicit sender: akka.actor.ActorRef)scala.concurrent.Future[Any]">?</a> <a href="#akka.persistence.journal.AsyncWriteTarget.DeleteMessagesTo.readResolve" title="(persistenceId: String, toSequenceNr: Long)akka.persistence.journal.AsyncWriteTarget.DeleteMessagesTo">DeleteMessagesTo</a><span class="delimiter">(</span><a href="#akka.persistence.journal;AsyncWriteProxy.asyncDeleteMessagesTo.persistenceId" title="String">persistenceId</a>, <a href="#akka.persistence.journal;AsyncWriteProxy.asyncDeleteMessagesTo.toSequenceNr" title="Long">toSequenceNr</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="[S](implicit tag: scala.reflect.ClassTag[S])scala.concurrent.Future[S]">mapTo</span><span title="(implicit tag: scala.reflect.ClassTag[Unit])scala.concurrent.Future[Unit]" class="delimiter">[</span><span title="Unit">Unit</span><span class="delimiter">]</span>
      case <span title="None.type">None</span>    ⇒ <a href="#akka.persistence.journal;AsyncWriteProxy.storeNotInitialized" title="=&gt; scala.concurrent.Future[Nothing]">storeNotInitialized</a>
    <span class="delimiter">}</span>

  def <a title="(persistenceId: String, fromSequenceNr: Long, toSequenceNr: Long, max: Long)(replayCallback: akka.persistence.PersistentRepr =&gt; Unit)scala.concurrent.Future[Unit]" id="akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages">asyncReplayMessages</a><span class="delimiter">(</span><a title="String" id="akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="Long" id="akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.fromSequenceNr">fromSequenceNr</a>: <span title="Long">Long</span>, <a title="Long" id="akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.toSequenceNr">toSequenceNr</a>: <span title="Long">Long</span>, <a title="Long" id="akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.max">max</a>: <span title="Long">Long</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="akka.persistence.PersistentRepr =&gt; Unit" id="akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.replayCallback">replayCallback</a>: PersistentRepr ⇒ Unit<span class="delimiter">)</span>: <span title="scala.concurrent.Future[Unit]">Future</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span> =
    <a href="#akka.persistence.journal;AsyncWriteProxy.store_=" title="=&gt; Option[akka.actor.ActorRef]">store</a> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.s">s</a><span class="delimiter">)</span> ⇒
        val <a title="scala.concurrent.Promise[Unit]" id="akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.replayCompletionPromise">replayCompletionPromise</a> = <span title="[T]()scala.concurrent.Promise[T]">Promise</span><span title="()scala.concurrent.Promise[Unit]" class="delimiter">[</span><span title="Unit">Unit</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
        val <a title="akka.actor.ActorRef" id="akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.mediator">mediator</a> = <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.actorOf(59f1e43182)" title="(props: akka.actor.Props)akka.actor.ActorRef">actorOf</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Props.scala.html#akka.actor.Props.apply(0870a176b3)" title="(clazz: Class[_], args: Any*)akka.actor.Props">Props</a><span class="delimiter">(</span>classOf<span title="Class[akka.persistence.journal.ReplayMediator](classOf[akka.persistence.journal.ReplayMediator])" class="delimiter">[</span>ReplayMediator<span class="delimiter">]</span>, <a href="#akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.replayCallback" title="akka.persistence.PersistentRepr =&gt; Unit">replayCallback</a>, <a href="#akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.replayCompletionPromise" title="scala.concurrent.Promise[Unit]">replayCompletionPromise</a>, <a href="#akka.persistence.journal;AsyncWriteProxy.timeout" title="=&gt; akka.util.Timeout">timeout</a>.<a href="../../../../actor/akka/util/Timeout.scala.html#akka.util;Timeout.duration" title="=&gt; scala.concurrent.duration.FiniteDuration">duration</a><span class="delimiter">)</span>.<a href="../../../../actor/akka/actor/Props.scala.html#akka.actor;Props.withDeploy" title="(d: akka.actor.Deploy)akka.actor.Props">withDeploy</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy" title="akka.actor.Deploy.type">Deploy</a>.<a href="../../../../actor/akka/actor/Deployer.scala.html#akka.actor.Deploy.local" title="=&gt; akka.actor.Deploy">local</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.s" title="akka.actor.ActorRef">s</a>.<a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef.tell" title="(msg: Any, sender: akka.actor.ActorRef)Unit">tell</a><span class="delimiter">(</span><a href="#akka.persistence.journal.AsyncWriteTarget.ReplayMessages.readResolve" title="(persistenceId: String, fromSequenceNr: Long, toSequenceNr: Long, max: Long)akka.persistence.journal.AsyncWriteTarget.ReplayMessages">ReplayMessages</a><span class="delimiter">(</span><a href="#akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.persistenceId" title="String">persistenceId</a>, <a href="#akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.fromSequenceNr" title="Long">fromSequenceNr</a>, <a href="#akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.toSequenceNr" title="Long">toSequenceNr</a>, <a href="#akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.max" title="Long">max</a><span class="delimiter">)</span>, <a href="#akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.mediator" title="akka.actor.ActorRef">mediator</a><span class="delimiter">)</span>
        <a href="#akka.persistence.journal;AsyncWriteProxy.asyncReplayMessages.replayCompletionPromise" title="scala.concurrent.Promise[Unit]">replayCompletionPromise</a>.<span title="=&gt; scala.concurrent.Future[Unit]">future</span>
      case <span title="None.type">None</span> ⇒ <a href="#akka.persistence.journal;AsyncWriteProxy.storeNotInitialized" title="=&gt; scala.concurrent.Future[Nothing]">storeNotInitialized</a>
    <span class="delimiter">}</span>

  def <a title="(persistenceId: String, fromSequenceNr: Long)scala.concurrent.Future[Long]" id="akka.persistence.journal;AsyncWriteProxy.asyncReadHighestSequenceNr">asyncReadHighestSequenceNr</a><span class="delimiter">(</span><a title="String" id="akka.persistence.journal;AsyncWriteProxy.asyncReadHighestSequenceNr.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="Long" id="akka.persistence.journal;AsyncWriteProxy.asyncReadHighestSequenceNr.fromSequenceNr">fromSequenceNr</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Long]">Future</span><span class="delimiter">[</span>Long<span class="delimiter">]</span> =
    <a href="#akka.persistence.journal;AsyncWriteProxy.store_=" title="=&gt; Option[akka.actor.ActorRef]">store</a> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="akka.actor.ActorRef" id="akka.persistence.journal;AsyncWriteProxy.asyncReadHighestSequenceNr.s">s</a><span class="delimiter">)</span> ⇒
        <span class="delimiter">(</span><a href="../../../../actor/akka/pattern/AskSupport.scala.html#akka.pattern;AskSupport.ask(13940b1e32)" title="implicit akka.pattern.AskSupport.ask : (actorRef: akka.actor.ActorRef)akka.pattern.AskableActorRef">s</a> <a href="../../../../actor/akka/pattern/AskSupport.scala.html#akka.pattern;AskableActorRef.?(840937cb3d)" title="(message: Any)(implicit timeout: akka.util.Timeout, implicit sender: akka.actor.ActorRef)scala.concurrent.Future[Any]">?</a> <a href="#akka.persistence.journal.AsyncWriteTarget.ReplayMessages.readResolve" title="(persistenceId: String, fromSequenceNr: Long, toSequenceNr: Long, max: Long)akka.persistence.journal.AsyncWriteTarget.ReplayMessages">ReplayMessages</a><span class="delimiter">(</span><a href="#akka.persistence.journal;AsyncWriteProxy.asyncReadHighestSequenceNr.persistenceId" title="String">persistenceId</a>, fromSequenceNr = <span title="Long(0L)" class="long">0L</span>, toSequenceNr = <span title="Long(0L)" class="long">0L</span>, max = <span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: Any =&gt; Long)(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[Long]">map</span> <a href="#akka.persistence.journal;AsyncWriteProxy.asyncReadHighestSequenceNr.$anonfun.x0$1" title="Long" class="delimiter">{</a>
          case ReplaySuccess<span class="delimiter">(</span><a title="Long" id="akka.persistence.journal;AsyncWriteProxy.asyncReadHighestSequenceNr.$anonfun.highest">highest</a><span class="delimiter">)</span> ⇒ <a href="#akka.persistence.journal;AsyncWriteProxy.asyncReadHighestSequenceNr.$anonfun.highest" title="Long">highest</a>
        <span class="delimiter">}</span>
      case <span title="None.type">None</span> ⇒ <a href="#akka.persistence.journal;AsyncWriteProxy.storeNotInitialized" title="=&gt; scala.concurrent.Future[Nothing]">storeNotInitialized</a>
    <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * INTERNAL API.
 */</span>
private<span class="delimiter">[</span>persistence<span class="delimiter">]</span> object <a title="akka.persistence.journal.AsyncWriteProxy.type" id="akka.persistence.journal.AsyncWriteProxy">AsyncWriteProxy</a> <a href="#akka.persistence.journal.AsyncWriteProxy" title="akka.persistence.journal.AsyncWriteProxy.type" class="delimiter">{</a>
  final case class <a title="class SetStore extends AnyRef with Product with Serializable" id="akka.persistence.journal.AsyncWriteProxy.SetStore.readResolve">SetStore</a><a href="#akka.persistence.journal.AsyncWriteProxy.SetStore.readResolve" title="Product" class="delimiter">(</a><a title="akka.actor.ActorRef" id="akka.persistence.journal.AsyncWriteProxy;SetStore.ref">ref</a>: <a href="../../../../actor/akka/actor/ActorRef.scala.html#akka.actor;ActorRef" title="akka.actor.ActorRef">ActorRef</a><span class="delimiter">)</span>
  final case object <a href="#akka.persistence.journal.AsyncWriteProxy.InitTimeout.productElement.x$1" title="akka.persistence.journal.AsyncWriteProxy.InitTimeout.type" id="akka.persistence.journal.AsyncWriteProxy.InitTimeout.readResolve">InitTimeout</a>
<a href="#akka.persistence.journal.AsyncWriteProxy.InitTimeout.readResolve" title="akka.persistence.journal.AsyncWriteProxy.InitTimeout.type" class="delimiter">}</a>

<span class="comment">/**
 * INTERNAL API.
 */</span>
private<span class="delimiter">[</span>persistence<span class="delimiter">]</span> object <a title="akka.persistence.journal.AsyncWriteTarget.type" id="akka.persistence.journal.AsyncWriteTarget">AsyncWriteTarget</a> <a href="#akka.persistence.journal.AsyncWriteTarget" title="akka.persistence.journal.AsyncWriteTarget.type" class="delimiter">{</a>
  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
  final case class <a title="class WriteMessages extends AnyRef with Product with Serializable" id="akka.persistence.journal.AsyncWriteTarget.WriteMessages.readResolve">WriteMessages</a><a href="#akka.persistence.journal.AsyncWriteTarget.WriteMessages.readResolve" title="Product" class="delimiter">(</a><a title="scala.collection.immutable.Seq[akka.persistence.AtomicWrite]" id="akka.persistence.journal.AsyncWriteTarget;WriteMessages.messages">messages</a>: immutable.<span title="scala.collection.immutable.Seq[akka.persistence.AtomicWrite]">Seq</span><span class="delimiter">[</span>AtomicWrite<span class="delimiter">]</span><span class="delimiter">)</span>

  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
  final case class <a title="class DeleteMessagesTo extends AnyRef with Product with Serializable" id="akka.persistence.journal.AsyncWriteTarget.DeleteMessagesTo.readResolve">DeleteMessagesTo</a><a href="#akka.persistence.journal.AsyncWriteTarget.DeleteMessagesTo.readResolve" title="Product" class="delimiter">(</a><a title="String" id="akka.persistence.journal.AsyncWriteTarget;DeleteMessagesTo.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="Long" id="akka.persistence.journal.AsyncWriteTarget;DeleteMessagesTo.toSequenceNr">toSequenceNr</a>: <span title="Long">Long</span><span class="delimiter">)</span>

  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
  final case class <a title="class ReplayMessages extends AnyRef with Product with Serializable" id="akka.persistence.journal.AsyncWriteTarget.ReplayMessages.readResolve">ReplayMessages</a><a href="#akka.persistence.journal.AsyncWriteTarget.ReplayMessages.readResolve" title="Product" class="delimiter">(</a><a title="String" id="akka.persistence.journal.AsyncWriteTarget;ReplayMessages.persistenceId">persistenceId</a>: <span title="String">String</span>, <a title="Long" id="akka.persistence.journal.AsyncWriteTarget;ReplayMessages.fromSequenceNr">fromSequenceNr</a>: <span title="Long">Long</span>, <a title="Long" id="akka.persistence.journal.AsyncWriteTarget;ReplayMessages.toSequenceNr">toSequenceNr</a>: <span title="Long">Long</span>, <a title="Long" id="akka.persistence.journal.AsyncWriteTarget;ReplayMessages.max">max</a>: <span title="Long">Long</span><span class="delimiter">)</span>

  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
  case class <a title="class ReplaySuccess extends AnyRef with Product with Serializable" id="akka.persistence.journal.AsyncWriteTarget.ReplaySuccess.readResolve">ReplaySuccess</a><a href="#akka.persistence.journal.AsyncWriteTarget.ReplaySuccess.readResolve" title="Product" class="delimiter">(</a><a title="Long" id="akka.persistence.journal.AsyncWriteTarget;ReplaySuccess.highestSequenceNr">highestSequenceNr</a>: <span title="Long">Long</span><span class="delimiter">)</span>

  @SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
  final case class <a title="class ReplayFailure extends AnyRef with Product with Serializable" id="akka.persistence.journal.AsyncWriteTarget.ReplayFailure.readResolve">ReplayFailure</a><a href="#akka.persistence.journal.AsyncWriteTarget.ReplayFailure.readResolve" title="Product" class="delimiter">(</a><a title="Throwable" id="akka.persistence.journal.AsyncWriteTarget;ReplayFailure.cause">cause</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="comment">/**
 * Thrown if replay inactivity exceeds a specified timeout.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
class <a title="class AsyncReplayTimeoutException extends akka.AkkaException" id="akka.persistence.journal;AsyncReplayTimeoutException">AsyncReplayTimeoutException</a><a href="#akka.persistence.journal;AsyncReplayTimeoutException" title="akka.persistence.journal.AsyncReplayTimeoutException" class="delimiter">(</a><a title="String" id="akka.persistence.journal;AsyncReplayTimeoutException.msg">msg</a>: <span title="String">String</span><span class="delimiter">)</span> extends <a href="../../../../actor/akka/AkkaException.scala.html#akka;AkkaException" title="akka.AkkaException">AkkaException</a><span class="delimiter">(</span><a href="#akka.persistence.journal;AsyncReplayTimeoutException.msg" title="String">msg</a><span class="delimiter">)</span>

private class <a title="class ReplayMediator extends AnyRef with akka.actor.Actor" id="akka.persistence.journal;ReplayMediator">ReplayMediator</a><a href="#akka.persistence.journal;ReplayMediator" title="akka.persistence.journal.ReplayMediator" class="delimiter">(</a><a title="akka.persistence.PersistentRepr =&gt; Unit" id="akka.persistence.journal;ReplayMediator.replayCallback">replayCallback</a>: PersistentRepr ⇒ Unit, <a title="scala.concurrent.Promise[Unit]" id="akka.persistence.journal;ReplayMediator.replayCompletionPromise">replayCompletionPromise</a>: <span title="scala.concurrent.Promise[Unit]">Promise</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span>, <a title="scala.concurrent.duration.Duration" id="akka.persistence.journal;ReplayMediator.replayTimeout">replayTimeout</a>: <span title="scala.concurrent.duration.Duration">Duration</span><span class="delimiter">)</span> extends <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor" title="akka.actor.Actor">Actor</a> <span class="delimiter">{</span>
  import <a href="#akka.persistence.journal.AsyncWriteTarget" title="akka.persistence.journal.AsyncWriteTarget.type">AsyncWriteTarget</a>._

  <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorCell.scala.html#akka.actor;ActorContext.setReceiveTimeout" title="(timeout: scala.concurrent.duration.Duration)Unit">setReceiveTimeout</a><span class="delimiter">(</span><a href="#akka.persistence.journal;ReplayMediator.replayTimeout" title="scala.concurrent.duration.Duration">replayTimeout</a><span class="delimiter">)</span>

  def <a title="=&gt; PartialFunction[Any,Unit]" id="akka.persistence.journal;ReplayMediator.receive">receive</a> = <a title="&lt;$anon: Any =&gt; Unit&gt; extends scala.runtime.AbstractPartialFunction[Any,Unit] with Serializable" id="akka.persistence.journal;ReplayMediator.receive;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
    case <a title="akka.persistence.PersistentRepr" id="akka.persistence.journal;ReplayMediator.receive;$anonfun.isDefinedAt.p">p</a>: <a href="../Persistent.scala.html#akka.persistence;PersistentRepr" title="akka.persistence.PersistentRepr">PersistentRepr</a> ⇒ <a href="#akka.persistence.journal;ReplayMediator.replayCallback" title="(v1: akka.persistence.PersistentRepr)Unit">replayCallback</a><span title="Boolean(true)" class="delimiter">(</span><a href="#akka.persistence.journal;ReplayMediator.receive;$anonfun.isDefinedAt.p" title="akka.persistence.PersistentRepr">p</a><span class="delimiter">)</span>
    case _: <a href="#akka.persistence.journal.AsyncWriteTarget.ReplaySuccess.readResolve" title="akka.persistence.journal.AsyncWriteTarget.ReplaySuccess">ReplaySuccess</a> ⇒
      <a href="#akka.persistence.journal;ReplayMediator.replayCompletionPromise" title="scala.concurrent.Promise[Unit]">replayCompletionPromise</a>.<span title="(value: Unit)ReplayMediator.this.replayCompletionPromise.type">success</span><span class="delimiter">(</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
    case ReplayFailure<span class="delimiter">(</span><a title="Throwable" id="akka.persistence.journal;ReplayMediator.receive;$anonfun.isDefinedAt.cause">cause</a><span class="delimiter">)</span> ⇒
      <a href="#akka.persistence.journal;ReplayMediator.replayCompletionPromise" title="scala.concurrent.Promise[Unit]">replayCompletionPromise</a>.<span title="(cause: Throwable)ReplayMediator.this.replayCompletionPromise.type">failure</span><span class="delimiter">(</span><a href="#akka.persistence.journal;ReplayMediator.receive;$anonfun.isDefinedAt.cause" title="Throwable">cause</a><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
    case <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor.ReceiveTimeout" title="akka.actor.ReceiveTimeout.type">ReceiveTimeout</a> ⇒
      <a href="#akka.persistence.journal;ReplayMediator.replayCompletionPromise" title="scala.concurrent.Promise[Unit]">replayCompletionPromise</a>.<span title="(cause: Throwable)ReplayMediator.this.replayCompletionPromise.type">failure</span><span class="delimiter">(</span>new <a href="#akka.persistence.journal;AsyncReplayTimeoutException" title="akka.persistence.journal.AsyncReplayTimeoutException">AsyncReplayTimeoutException</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;replay timed out after &quot;)">replay timed out after $</span><span class="delimiter">{</span><a href="#akka.persistence.journal;ReplayMediator.replayTimeout" title="scala.concurrent.duration.Duration">replayTimeout</a>.<span title="=&gt; Long">toSeconds</span><span class="delimiter">}</span><span title="String(&quot; seconds inactivity&quot;)" class="string"> seconds inactivity&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.context" title="=&gt; akka.actor.ActorContext">context</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefFactory.stop" title="(actor: akka.actor.ActorRef)Unit">stop</a><span class="delimiter">(</span><a href="../../../../actor/akka/actor/Actor.scala.html#akka.actor;Actor.self" title="=&gt; akka.actor.ActorRef">self</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
