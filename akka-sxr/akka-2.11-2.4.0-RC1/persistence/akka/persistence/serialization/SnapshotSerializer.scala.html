<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>persistence/akka/persistence/serialization/SnapshotSerializer.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/**
 * Copyright (C) 2009-2015 Typesafe Inc. &lt;http://www.typesafe.com&gt;
 * Copyright (C) 2012-2013 Eligotech BV.
 */</span>

package akka.persistence.serialization

import java.io._
import akka.actor._
import akka.serialization._
import akka.util.<a href="../../../../actor/akka/util/ByteString.scala.html#akka.util.ByteString" title="akka.util.ByteString.type">ByteString</a>.UTF_8
import scala.util.Success
import scala.util.Failure

<span class="comment">/**
 * Wrapper for snapshot `data`. Snapshot `data` are the actual snapshot objects captured by
 * the persistent actor.
 *
 * @see [[SnapshotSerializer]]
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
final case class <a title="class Snapshot extends AnyRef with Product with Serializable" id="akka.persistence.serialization.Snapshot.readResolve">Snapshot</a><a href="#akka.persistence.serialization.Snapshot.readResolve" title="Product" class="delimiter">(</a><a title="Any" id="akka.persistence.serialization;Snapshot.data">data</a>: <span title="Any">Any</span><span class="delimiter">)</span>

<span class="comment">/**
 * INTERNAL API.
 */</span>
@SerialVersionUID<span class="delimiter">(</span><span class="long">1L</span><span class="delimiter">)</span>
private<span class="delimiter">[</span>serialization<span class="delimiter">]</span> final case class <a title="class SnapshotHeader extends AnyRef with Product with Serializable" id="akka.persistence.serialization.SnapshotHeader.readResolve">SnapshotHeader</a><a href="#akka.persistence.serialization.SnapshotHeader.readResolve" title="Product" class="delimiter">(</a><a title="Int" id="akka.persistence.serialization;SnapshotHeader.serializerId">serializerId</a>: <span title="Int">Int</span>, <a title="Option[String]" id="akka.persistence.serialization;SnapshotHeader.manifest">manifest</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>

<span class="comment">/**
 * [[Snapshot]] serializer.
 */</span>
class <a title="class SnapshotSerializer extends AnyRef with akka.serialization.BaseSerializer" id="akka.persistence.serialization;SnapshotSerializer">SnapshotSerializer</a><a href="#akka.persistence.serialization;SnapshotSerializer" title="akka.persistence.serialization.SnapshotSerializer" class="delimiter">(</a>val <a title="akka.actor.ExtendedActorSystem" id="akka.persistence.serialization;SnapshotSerializer.system">system</a>: <a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ExtendedActorSystem" title="akka.actor.ExtendedActorSystem">ExtendedActorSystem</a><span class="delimiter">)</span> extends <a href="../../../../actor/akka/serialization/Serializer.scala.html#akka.serialization;BaseSerializer" title="akka.serialization.BaseSerializer">BaseSerializer</a> <span class="delimiter">{</span>

  override val <a title="Boolean" id="akka.persistence.serialization;SnapshotSerializer.includeManifest">includeManifest</a>: <span title="Boolean">Boolean</span> = false

  private lazy val <a title="akka.serialization.Serialization" id="akka.persistence.serialization;SnapshotSerializer.serialization">serialization</a> = <a href="../../../../actor/akka/actor/Extension.scala.html#akka.actor;ExtensionId.apply" title="(system: akka.actor.ActorSystem)akka.serialization.Serialization">SerializationExtension</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.system" title="=&gt; akka.actor.ExtendedActorSystem">system</a><span class="delimiter">)</span>

  private lazy val <a title="Option[akka.serialization.Serialization.Information]" id="akka.persistence.serialization;SnapshotSerializer.transportInformation">transportInformation</a>: <span title="Option[akka.serialization.Serialization.Information]">Option</span><span class="delimiter">[</span>Serialization.Information<span class="delimiter">]</span> = <span class="delimiter">{</span>
    val <a title="akka.actor.Address" id="akka.persistence.serialization;SnapshotSerializer.transportInformation.address">address</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.system" title="=&gt; akka.actor.ExtendedActorSystem">system</a>.<a href="../../../../actor/akka/actor/ActorSystem.scala.html#akka.actor;ExtendedActorSystem.provider" title="=&gt; akka.actor.ActorRefProvider">provider</a>.<a href="../../../../actor/akka/actor/ActorRefProvider.scala.html#akka.actor;ActorRefProvider.getDefaultAddress" title="=&gt; akka.actor.Address">getDefaultAddress</a>
    if <span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.transportInformation.address" title="akka.actor.Address">address</a>.<a href="../../../../actor/akka/actor/Address.scala.html#akka.actor;Address.hasLocalScope" title="=&gt; Boolean">hasLocalScope</a><span class="delimiter">)</span> <span title="None.type">None</span>
    else <span title="(x: akka.serialization.Serialization.Information)Some[akka.serialization.Serialization.Information]">Some</span><span class="delimiter">(</span><a href="../../../../actor/akka/serialization/Serialization.scala.html#akka.serialization.Serialization" title="akka.serialization.Serialization.type">Serialization</a>.<a href="../../../../actor/akka/serialization/Serialization.scala.html#akka.serialization.Serialization;Information" title="(address: akka.actor.Address, system: akka.actor.ActorSystem)akka.serialization.Serialization.Information">Information</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.transportInformation.address" title="akka.actor.Address">address</a>, <a href="#akka.persistence.serialization;SnapshotSerializer.system" title="=&gt; akka.actor.ExtendedActorSystem">system</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Serializes a [[Snapshot]]. Delegates serialization of snapshot `data` to a matching
   * `akka.serialization.Serializer`.
   */</span>
  def <a title="(o: AnyRef)Array[Byte]" id="akka.persistence.serialization;SnapshotSerializer.toBinary">toBinary</a><span class="delimiter">(</span><a title="AnyRef" id="akka.persistence.serialization;SnapshotSerializer.toBinary.o">o</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <a href="#akka.persistence.serialization;SnapshotSerializer.toBinary.o" title="AnyRef">o</a> match <span class="delimiter">{</span>
    case Snapshot<span class="delimiter">(</span><a title="Any" id="akka.persistence.serialization;SnapshotSerializer.toBinary.data">data</a><span class="delimiter">)</span> ⇒ <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary" title="(snapshot: AnyRef)Array[Byte]">snapshotToBinary</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.toBinary.data" title="Any">data</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>
    case _              ⇒ throw new <span title="IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Can\'t serialize object of type &quot;)">Can't serialize object of type $</span><span class="delimiter">{</span><a href="#akka.persistence.serialization;SnapshotSerializer.toBinary.o" title="AnyRef">o</a>.<span title="()Class[_]">getClass</span><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Deserializes a [[Snapshot]]. Delegates deserialization of snapshot `data` to a matching
   * `akka.serialization.Serializer`.
   */</span>
  def <a title="(bytes: Array[Byte], manifest: Option[Class[_]])AnyRef" id="akka.persistence.serialization;SnapshotSerializer.fromBinary(d2b6dd778d)">fromBinary</a><span class="delimiter">(</span><a title="Array[Byte]" id="akka.persistence.serialization;SnapshotSerializer.fromBinary(d2b6dd778d).bytes">bytes</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <a title="Option[Class[_]]" id="akka.persistence.serialization;SnapshotSerializer.fromBinary(d2b6dd778d).manifest">manifest</a>: <span title="Option[Class[_]]">Option</span><span class="delimiter">[</span>Class<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <span title="AnyRef">AnyRef</span> =
    <a href="#akka.persistence.serialization.Snapshot.readResolve" title="(data: Any)akka.persistence.serialization.Snapshot">Snapshot</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary" title="(bytes: Array[Byte])AnyRef">snapshotFromBinary</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.fromBinary(d2b6dd778d).bytes" title="Array[Byte]">bytes</a><span class="delimiter">)</span><span class="delimiter">)</span>

  private def <a title="(snapshot: AnyRef)Array[Byte]" id="akka.persistence.serialization;SnapshotSerializer.snapshotToBinary">snapshotToBinary</a><span class="delimiter">(</span><a title="AnyRef" id="akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.snapshot">snapshot</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">{</span>
    def <a title="()Array[Byte]" id="akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize">serialize</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      val <a title="akka.serialization.Serializer" id="akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.snapshotSerializer">snapshotSerializer</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.serialization" title="=&gt; akka.serialization.Serialization">serialization</a>.<a href="../../../../actor/akka/serialization/Serialization.scala.html#akka.serialization;Serialization.findSerializerFor" title="(o: AnyRef)akka.serialization.Serializer">findSerializerFor</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.snapshot" title="AnyRef">snapshot</a><span class="delimiter">)</span>

      val <a title="java.io.ByteArrayOutputStream" id="akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.headerOut">headerOut</a> = new <span title="java.io.ByteArrayOutputStream">ByteArrayOutputStream</span>
      <a href="#akka.persistence.serialization;SnapshotSerializer.writeInt" title="(outputStream: java.io.OutputStream, i: Int)Unit">writeInt</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.headerOut" title="java.io.ByteArrayOutputStream">headerOut</a>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.snapshotSerializer" title="akka.serialization.Serializer">snapshotSerializer</a>.<a href="../../../../actor/akka/serialization/Serializer.scala.html#akka.serialization;Serializer.identifier" title="=&gt; Int">identifier</a><span class="delimiter">)</span>

      <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.snapshotSerializer" title="akka.serialization.Serializer">snapshotSerializer</a> match <span class="delimiter">{</span>
        case <a title="akka.serialization.SerializerWithStringManifest" id="akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.ser2">ser2</a>: <a href="../../../../actor/akka/serialization/Serializer.scala.html#akka.serialization;SerializerWithStringManifest" title="akka.serialization.SerializerWithStringManifest">SerializerWithStringManifest</a> ⇒
          val <a title="String" id="akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.manifest">manifest</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.ser2" title="akka.serialization.SerializerWithStringManifest">ser2</a>.<a href="../../../../actor/akka/serialization/Serializer.scala.html#akka.serialization;SerializerWithStringManifest.manifest" title="(o: AnyRef)String">manifest</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.snapshot" title="AnyRef">snapshot</a><span class="delimiter">)</span>
          if <span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.manifest" title="String">manifest</a> <span title="(x$1: Any)Boolean">!=</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
            <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.headerOut" title="java.io.ByteArrayOutputStream">headerOut</a>.<span title="(x$1: Array[Byte])Unit">write</span><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.manifest" title="String">manifest</a>.<span title="(x$1: String)Array[Byte]">getBytes</span><span class="delimiter">(</span><a href="../../../../actor/akka/util/ByteString.scala.html#akka.util.ByteString.UTF_8" title="=&gt; String">UTF_8</a><span class="delimiter">)</span><span class="delimiter">)</span>
        case _ ⇒
          if <span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.snapshotSerializer" title="akka.serialization.Serializer">snapshotSerializer</a>.<a href="../../../../actor/akka/serialization/Serializer.scala.html#akka.serialization;Serializer.includeManifest" title="=&gt; Boolean">includeManifest</a><span class="delimiter">)</span>
            <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.headerOut" title="java.io.ByteArrayOutputStream">headerOut</a>.<span title="(x$1: Array[Byte])Unit">write</span><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.snapshot" title="AnyRef">snapshot</a>.<span title="()Class[_]">getClass</span>.<span title="()String">getName</span>.<span title="(x$1: String)Array[Byte]">getBytes</span><span class="delimiter">(</span><a href="../../../../actor/akka/util/ByteString.scala.html#akka.util.ByteString.UTF_8" title="=&gt; String">UTF_8</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      val <a title="Array[Byte]" id="akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.headerBytes">headerBytes</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.headerOut" title="java.io.ByteArrayOutputStream">headerOut</a>.<span title="()Array[Byte]">toByteArray</span>

      val <a title="java.io.ByteArrayOutputStream" id="akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.out">out</a> = new <span title="java.io.ByteArrayOutputStream">ByteArrayOutputStream</span>

      <a href="#akka.persistence.serialization;SnapshotSerializer.writeInt" title="(outputStream: java.io.OutputStream, i: Int)Unit">writeInt</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.out" title="java.io.ByteArrayOutputStream">out</a>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.headerBytes" title="Array[Byte]">headerBytes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>

      <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.out" title="java.io.ByteArrayOutputStream">out</a>.<span title="(x$1: Array[Byte])Unit">write</span><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.headerBytes" title="Array[Byte]">headerBytes</a><span class="delimiter">)</span>
      <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.out" title="java.io.ByteArrayOutputStream">out</a>.<span title="(x$1: Array[Byte])Unit">write</span><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.snapshotSerializer" title="akka.serialization.Serializer">snapshotSerializer</a>.<a href="../../../../actor/akka/serialization/Serializer.scala.html#akka.serialization;Serializer.toBinary" title="(o: AnyRef)Array[Byte]">toBinary</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.snapshot" title="AnyRef">snapshot</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize.out" title="java.io.ByteArrayOutputStream">out</a>.<span title="()Array[Byte]">toByteArray</span>
    <span class="delimiter">}</span>

    <span class="comment">// serialize actor references with full address information (defaultAddress)</span>
    <a href="#akka.persistence.serialization;SnapshotSerializer.transportInformation" title="=&gt; Option[akka.serialization.Serialization.Information]">transportInformation</a> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="akka.serialization.Serialization.Information" id="akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.ti">ti</a><span class="delimiter">)</span> ⇒ <a href="../../../../actor/akka/serialization/Serialization.scala.html#akka.serialization.Serialization" title="akka.serialization.Serialization.type">Serialization</a>.<a href="../../../../actor/akka/serialization/Serialization.scala.html#akka.serialization.Serialization.currentTransportInformation" title="=&gt; scala.util.DynamicVariable[akka.serialization.Serialization.Information]">currentTransportInformation</a>.<span title="(newval: akka.serialization.Serialization.Information)(thunk: =&gt; Array[Byte])Array[Byte]">withValue</span><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.ti" title="akka.serialization.Serialization.Information">ti</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize" title="()Array[Byte]">serialize</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>
      case <span title="None.type">None</span>     ⇒ <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotToBinary.serialize" title="()Array[Byte]">serialize</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(bytes: Array[Byte])AnyRef" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary">snapshotFromBinary</a><span class="delimiter">(</span><a title="Array[Byte]" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.bytes">bytes</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="AnyRef">AnyRef</span> = <span class="delimiter">{</span>
    val <a title="java.io.ByteArrayInputStream" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.in">in</a> = new <span title="java.io.ByteArrayInputStream">ByteArrayInputStream</span><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.bytes" title="Array[Byte]">bytes</a><span class="delimiter">)</span>
    val <a title="Int" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.headerLength">headerLength</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.readInt" title="(inputStream: java.io.InputStream)Int">readInt</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.in" title="java.io.ByteArrayInputStream">in</a><span class="delimiter">)</span>
    val <a title="Array[Byte]" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.headerBytes">headerBytes</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.bytes" title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">bytes</a>.<span title="(from: Int, until: Int)Array[Byte]">slice</span><span class="delimiter">(</span><span title="Int(4)" class="int">4</span>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.headerLength" title="Int">headerLength</a> <span title="(x: Int)Int">+</span> <span title="Int(4)" class="int">4</span><span class="delimiter">)</span>
    val <a title="Array[Byte]" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.snapshotBytes">snapshotBytes</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.bytes" title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">bytes</a>.<span title="(n: Int)Array[Byte]">drop</span><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.headerLength" title="Int">headerLength</a> <span title="(x: Int)Int">+</span> <span title="Int(4)" class="int">4</span><span class="delimiter">)</span>

    <span class="comment">/*
     * Attempt to find the `key` in the supplied array and if successful
     * construct a new array, replacing the contained UID with the `replacement`.
     */</span>
    def <a title="(b: Array[Byte])Array[Byte]" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch">patch</a><span class="delimiter">(</span><a title="Array[Byte]" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.b">b</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">{</span>
      import <a href="#akka.persistence.serialization.SnapshotSerializer" title="akka.persistence.serialization.SnapshotSerializer.type">SnapshotSerializer</a>._
      def <a title="(pos: Int, offset: Int)Int" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find">find</a><span class="delimiter">(</span><a title="Int" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find.pos">pos</a>: <span title="Int">Int</span>, <a title="Int" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find.offset">offset</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
        if <span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find.pos" title="Int">pos</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.b" title="Array[Byte]">b</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> -<span title="Int(-1)" class="int">1</span>
        else if <span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find.offset" title="Int">offset</a> <span title="(x: Int)Boolean">==</span> <a href="#akka.persistence.serialization.SnapshotSerializer.key" title="=&gt; Array[Byte]">key</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find.pos" title="Int">pos</a>
        else if <span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.b" title="(i: Int)Byte">b</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find.pos" title="Int">pos</a> <span title="(x: Int)Int">+</span> <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find.offset" title="Int">offset</a><span class="delimiter">)</span> <span title="(x: Byte)Boolean">==</span> <a href="#akka.persistence.serialization.SnapshotSerializer.key" title="(i: Int)Byte">key</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find.offset" title="Int">offset</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find" title="(pos: Int, offset: Int)Int">find</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find.pos" title="Int">pos</a>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find.offset" title="Int">offset</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        else <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find" title="(pos: Int, offset: Int)Int">find</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find.pos" title="Int">pos</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      val <a title="Int" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.found">found</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.find" title="(pos: Int, offset: Int)Int">find</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.found" title="Int">found</a> <span title="(x: Int)Boolean">==</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.b" title="Array[Byte]">b</a>
      else <span class="delimiter">{</span>
        val <a title="Array[Byte]" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.n">n</a> = new <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.b" title="Array[Byte]">b</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
        val start = <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.found" title="Int">found</a> <a title="Int" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.start">+</a> <a href="#akka.persistence.serialization.SnapshotSerializer.offset" title="=&gt; Int">offset</a>
        val end = <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.start" title="Int">start</a> <a title="Int" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.end">+</a> <a href="#akka.persistence.serialization.SnapshotSerializer.replacement" title="=&gt; Array[Byte]">replacement</a>.<span title="=&gt; Int">length</span>
        <span title="System.type">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.b" title="Array[Byte]">b</a>, <span title="Int(0)" class="int">0</span>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.n" title="Array[Byte]">n</a>, <span title="Int(0)" class="int">0</span>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.start" title="Int">start</a><span class="delimiter">)</span>
        <span title="System.type">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.replacement" title="=&gt; Array[Byte]">replacement</a>, <span title="Int(0)" class="int">0</span>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.n" title="Array[Byte]">n</a>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.start" title="Int">start</a>, <a href="#akka.persistence.serialization.SnapshotSerializer.replacement" title="=&gt; Array[Byte]">replacement</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
        <span title="System.type">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.b" title="Array[Byte]">b</a>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.end" title="Int">end</a>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.n" title="Array[Byte]">n</a>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.end" title="Int">end</a>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.b" title="Array[Byte]">b</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.end" title="Int">end</a><span class="delimiter">)</span>
        <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch.n" title="Array[Byte]">n</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">// If we are allowed to break serialization compatibility of stored snapshots in 2.4</span>
    <span class="comment">// we can remove this attempt to deserialize SnapshotHeader with JavaSerializer.</span>
    <span class="comment">// Then the class SnapshotHeader can be removed. See issue #16009</span>
    val <a title="Option[akka.persistence.serialization.SnapshotHeader]" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.oldHeader">oldHeader</a> =
      if <span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.readShort" title="(inputStream: java.io.InputStream)Int">readShort</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.in" title="java.io.ByteArrayInputStream">in</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <span title="Int(60844)" class="int">0xedac</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">// Java Serialization magic value with swapped bytes</span>
        val <a title="Array[Byte]" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.oldHeader.b">b</a> = if <span class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer" title="akka.persistence.serialization.SnapshotSerializer.type">SnapshotSerializer</a>.<a href="#akka.persistence.serialization.SnapshotSerializer.doPatch" title="=&gt; Boolean">doPatch</a><span class="delimiter">)</span> <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.patch" title="(b: Array[Byte])Array[Byte]">patch</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.headerBytes" title="Array[Byte]">headerBytes</a><span class="delimiter">)</span> else <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.headerBytes" title="Array[Byte]">headerBytes</a>
        <a href="#akka.persistence.serialization;SnapshotSerializer.serialization" title="=&gt; akka.serialization.Serialization">serialization</a>.<a href="../../../../actor/akka/serialization/Serialization.scala.html#akka.serialization;Serialization.deserialize(2392165273)" title="(bytes: Array[Byte], clazz: Class[akka.persistence.serialization.SnapshotHeader])scala.util.Try[akka.persistence.serialization.SnapshotHeader]">deserialize</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.oldHeader.b" title="Array[Byte]">b</a>, classOf<span title="Class[akka.persistence.serialization.SnapshotHeader](classOf[akka.persistence.serialization.SnapshotHeader])" class="delimiter">[</span>SnapshotHeader<span class="delimiter">]</span><span class="delimiter">)</span>.<span title="=&gt; Option[akka.persistence.serialization.SnapshotHeader]">toOption</span>
      <span class="delimiter">}</span> else <span title="None.type">None</span>

    val <a title="akka.persistence.serialization.SnapshotHeader" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header">header</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.oldHeader" title="Option[akka.persistence.serialization.SnapshotHeader]">oldHeader</a>.<span title="(default: =&gt; akka.persistence.serialization.SnapshotHeader)akka.persistence.serialization.SnapshotHeader">getOrElse</span> <span class="delimiter">{</span>
      val <a title="java.io.ByteArrayInputStream" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header.headerIn">headerIn</a> = new <span title="java.io.ByteArrayInputStream">ByteArrayInputStream</span><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.headerBytes" title="Array[Byte]">headerBytes</a><span class="delimiter">)</span>
      val <a title="Int" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header.serializerId">serializerId</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.readInt" title="(inputStream: java.io.InputStream)Int">readInt</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header.headerIn" title="java.io.ByteArrayInputStream">headerIn</a><span class="delimiter">)</span>
      val <a title="Int" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header.remaining">remaining</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header.headerIn" title="java.io.ByteArrayInputStream">headerIn</a>.<span title="()Int">available</span>
      val <a title="Option[String]" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header.manifest">manifest</a> =
        if <span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header.remaining" title="Int">remaining</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="None.type">None</span>
        else <span class="delimiter">{</span>
          val <a title="Array[Byte]" id="akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header.manifest.manifestBytes">manifestBytes</a> = <span title="Array.type">Array</span>.<span title="[T](n1: Int)(implicit evidence$3: scala.reflect.ClassTag[T])Array[T]">ofDim</span><span title="(n1: Int)(implicit evidence$3: scala.reflect.ClassTag[Byte])Array[Byte]" class="delimiter">[</span><span title="Byte">Byte</span><span class="delimiter">]</span><span title="=&gt; scala.reflect.ClassTag[Byte]" class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header.remaining" title="Int">remaining</a><span class="delimiter">)</span>
          <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header.headerIn" title="java.io.ByteArrayInputStream">headerIn</a>.<span title="(x$1: Array[Byte])Int">read</span><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header.manifest.manifestBytes" title="Array[Byte]">manifestBytes</a><span class="delimiter">)</span>
          <span title="(x: String)Some[String]">Some</span><span class="delimiter">(</span>new <span title="String">String</span><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header.manifest.manifestBytes" title="Array[Byte]">manifestBytes</a>, <a href="../../../../actor/akka/util/ByteString.scala.html#akka.util.ByteString.UTF_8" title="=&gt; String">UTF_8</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <a href="#akka.persistence.serialization.SnapshotHeader.readResolve" title="(serializerId: Int, manifest: Option[String])akka.persistence.serialization.SnapshotHeader">SnapshotHeader</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header.serializerId" title="Int">serializerId</a>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header.manifest" title="Option[String]">manifest</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#akka.persistence.serialization;SnapshotSerializer.serialization" title="=&gt; akka.serialization.Serialization">serialization</a>.<a href="../../../../actor/akka/serialization/Serialization.scala.html#akka.serialization;Serialization.deserialize(0d68c6bee1)" title="(bytes: Array[Byte], serializerId: Int, manifest: String)scala.util.Try[AnyRef]">deserialize</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.snapshotBytes" title="Array[Byte]">snapshotBytes</a>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header" title="akka.persistence.serialization.SnapshotHeader">header</a>.<a href="#akka.persistence.serialization;SnapshotHeader.serializerId" title="=&gt; Int">serializerId</a>, <a href="#akka.persistence.serialization;SnapshotSerializer.snapshotFromBinary.header" title="akka.persistence.serialization.SnapshotHeader">header</a>.<a href="#akka.persistence.serialization;SnapshotHeader.manifest" title="=&gt; Option[String]">manifest</a>.<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; AnyRef">get</span>
  <span class="delimiter">}</span>

  private def <a title="(outputStream: java.io.OutputStream, i: Int)Unit" id="akka.persistence.serialization;SnapshotSerializer.writeInt">writeInt</a><span class="delimiter">(</span><a title="java.io.OutputStream" id="akka.persistence.serialization;SnapshotSerializer.writeInt.outputStream">outputStream</a>: <span title="java.io.OutputStream">OutputStream</span>, <a title="Int" id="akka.persistence.serialization;SnapshotSerializer.writeInt.i">i</a>: <span title="Int">Int</span><span class="delimiter">)</span> =
    <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <span title="Int(24)" class="int">24</span> <span title="(step: Int)scala.collection.immutable.Range">by</span> <span title="Int(8)" class="int">8</span> <span title="(f: Int =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="Int" id="akka.persistence.serialization;SnapshotSerializer.writeInt.$anonfun.shift">shift</a> ⇒ <a href="#akka.persistence.serialization;SnapshotSerializer.writeInt.outputStream" title="java.io.OutputStream">outputStream</a>.<span title="(x$1: Int)Unit">write</span><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.writeInt.i" title="Int">i</a> <span title="(x: Int)Int">&gt;&gt;</span> <a href="#akka.persistence.serialization;SnapshotSerializer.writeInt.$anonfun.shift" title="Int">shift</a><span class="delimiter">)</span> <span class="delimiter">}</span>

  private def <a title="(inputStream: java.io.InputStream)Int" id="akka.persistence.serialization;SnapshotSerializer.readShort">readShort</a><span class="delimiter">(</span><a title="java.io.InputStream" id="akka.persistence.serialization;SnapshotSerializer.readShort.inputStream">inputStream</a>: <span title="java.io.InputStream">InputStream</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    val <a title="Int" id="akka.persistence.serialization;SnapshotSerializer.readShort.ch1">ch1</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.readShort.inputStream" title="java.io.InputStream">inputStream</a>.<span title="()Int">read</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="Int" id="akka.persistence.serialization;SnapshotSerializer.readShort.ch2">ch2</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.readShort.inputStream" title="java.io.InputStream">inputStream</a>.<span title="()Int">read</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.readShort.ch2" title="Int">ch2</a> <span title="(x: Int)Int">&lt;&lt;</span> <span title="Int(8)" class="int">8</span><span class="delimiter">)</span> <span title="(x: Int)Int">|</span> <a href="#akka.persistence.serialization;SnapshotSerializer.readShort.ch1" title="Int">ch1</a>
  <span class="delimiter">}</span>

  private def <a title="(inputStream: java.io.InputStream)Int" id="akka.persistence.serialization;SnapshotSerializer.readInt">readInt</a><span class="delimiter">(</span><a title="java.io.InputStream" id="akka.persistence.serialization;SnapshotSerializer.readInt.inputStream">inputStream</a>: <span title="java.io.InputStream">InputStream</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    val <a title="Int" id="akka.persistence.serialization;SnapshotSerializer.readInt.sh1">sh1</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.readShort" title="(inputStream: java.io.InputStream)Int">readShort</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.readInt.inputStream" title="java.io.InputStream">inputStream</a><span class="delimiter">)</span>
    val <a title="Int" id="akka.persistence.serialization;SnapshotSerializer.readInt.sh2">sh2</a> = <a href="#akka.persistence.serialization;SnapshotSerializer.readShort" title="(inputStream: java.io.InputStream)Int">readShort</a><span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.readInt.inputStream" title="java.io.InputStream">inputStream</a><span class="delimiter">)</span>
    <span class="delimiter">(</span><a href="#akka.persistence.serialization;SnapshotSerializer.readInt.sh2" title="Int">sh2</a> <span title="(x: Int)Int">&lt;&lt;</span> <span title="Int(16)" class="int">16</span><span class="delimiter">)</span> <span title="(x: Int)Int">|</span> <a href="#akka.persistence.serialization;SnapshotSerializer.readInt.sh1" title="Int">sh1</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

object <a title="akka.persistence.serialization.SnapshotSerializer.type" id="akka.persistence.serialization.SnapshotSerializer">SnapshotSerializer</a> <a href="#akka.persistence.serialization.SnapshotSerializer" title="akka.persistence.serialization.SnapshotSerializer.type" class="delimiter">{</a>
  <span class="comment">/*
   * This is the serialized form of Class[Option[_]] (as a superclass, hence
   * the leading 0x78) with Scala 2.10.
   */</span>
  val <a title="Array[Byte]" id="akka.persistence.serialization.SnapshotSerializer.key">key</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span title="(x: Int, xs: Int*)Array[Int]">Array</span><span title="implicit scala.Predef.intArrayOps : (xs: Array[Int])scala.collection.mutable.ArrayOps[Int]" class="delimiter">(</span>
    <span title="Int(120)" class="int">0x78</span>, <span title="Int(114)" class="int">0x72</span>, <span title="Int(0)" class="int">0x00</span>, <span title="Int(12)" class="int">0x0c</span>, <span title="Int(115)" class="int">0x73</span>, <span title="Int(99)" class="int">0x63</span>, <span title="Int(97)" class="int">0x61</span>, <span title="Int(108)" class="int">0x6c</span>,
    <span title="Int(97)" class="int">0x61</span>, <span title="Int(46)" class="int">0x2e</span>, <span title="Int(79)" class="int">0x4f</span>, <span title="Int(112)" class="int">0x70</span>, <span title="Int(116)" class="int">0x74</span>, <span title="Int(105)" class="int">0x69</span>, <span title="Int(111)" class="int">0x6f</span>, <span title="Int(110)" class="int">0x6e</span>,
    <span title="Int(227)" class="int">0xe3</span>, <span title="Int(96)" class="int">0x60</span>, <span title="Int(36)" class="int">0x24</span>, <span title="Int(168)" class="int">0xa8</span>, <span title="Int(50)" class="int">0x32</span>, <span title="Int(138)" class="int">0x8a</span>, <span title="Int(69)" class="int">0x45</span>, <span title="Int(233)" class="int">0xe9</span>, <span class="comment">// here is the UID</span>
    <span title="Int(2)" class="int">0x02</span>, <span title="Int(0)" class="int">0x00</span>, <span title="Int(0)" class="int">0x00</span>, <span title="Int(120)" class="int">0x78</span>, <span title="Int(112)" class="int">0x70</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Byte)(implicit bf: scala.collection.generic.CanBuildFrom[Array[Int],Byte,Array[Byte]])Array[Byte]">map</span><span title="(implicit t: scala.reflect.ClassTag[Byte])scala.collection.generic.CanBuildFrom[Array[_],Byte,Array[Byte]]" class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.key.$anonfun.x$1" title="Int">_</a>.<span title="=&gt; Byte">toByte</span><span class="delimiter">)</span>
  <span class="comment">// The offset of the serialVersionUID in the above.</span>
  val <a title="Int" id="akka.persistence.serialization.SnapshotSerializer.offset">offset</a> = <span title="Int(16)" class="int">16</span>
  <span class="comment">// This is the new serialVersionUID from Scala 2.11 onwards.</span>
  val <a title="Array[Byte]" id="akka.persistence.serialization.SnapshotSerializer.replacement">replacement</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span title="(x: Int, xs: Int*)Array[Int]">Array</span><span title="implicit scala.Predef.intArrayOps : (xs: Array[Int])scala.collection.mutable.ArrayOps[Int]" class="delimiter">(</span>
    <span title="Int(254)" class="int">0xfe</span>, <span title="Int(105)" class="int">0x69</span>, <span title="Int(55)" class="int">0x37</span>, <span title="Int(253)" class="int">0xfd</span>, <span title="Int(219)" class="int">0xdb</span>, <span title="Int(14)" class="int">0x0e</span>, <span title="Int(102)" class="int">0x66</span>, <span title="Int(116)" class="int">0x74</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Byte)(implicit bf: scala.collection.generic.CanBuildFrom[Array[Int],Byte,Array[Byte]])Array[Byte]">map</span><span title="(implicit t: scala.reflect.ClassTag[Byte])scala.collection.generic.CanBuildFrom[Array[_],Byte,Array[Byte]]" class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.replacement.$anonfun.x$2" title="Int">_</a>.<span title="=&gt; Byte">toByte</span><span class="delimiter">)</span>
  val <a title="Boolean" id="akka.persistence.serialization.SnapshotSerializer.doPatch">doPatch</a>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="comment">/*
     * The only way to obtain the serialVersionUID for the Option[_] class is
     * to serialize one and look at the result, since prior to 2.11.5 it does
     * not declare such a field and relies on automatic UID generation.
     */</span>
    val <a title="java.io.ByteArrayOutputStream" id="akka.persistence.serialization.SnapshotSerializer.doPatch.baus">baus</a> = new <span title="java.io.ByteArrayOutputStream">ByteArrayOutputStream</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="java.io.ObjectOutputStream" id="akka.persistence.serialization.SnapshotSerializer.doPatch.out">out</a> = new <span title="java.io.ObjectOutputStream">ObjectOutputStream</span><span class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.baus" title="java.io.ByteArrayOutputStream">baus</a><span class="delimiter">)</span>
    <a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.out" title="java.io.ObjectOutputStream">out</a>.<span title="(x$1: Any)Unit">writeObject</span><span class="delimiter">(</span><span title="None.type">None</span><span class="delimiter">)</span>
    <span class="comment">// the first 30 bytes serialize the None object, then comes its superclass Option[_]</span>
    val <a title="Int" id="akka.persistence.serialization.SnapshotSerializer.doPatch.superOffset">superOffset</a> = <span title="Int(30)" class="int">30</span>
    val uidOffset = <a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.superOffset" title="Int">superOffset</a> <a title="Int" id="akka.persistence.serialization.SnapshotSerializer.doPatch.uidOffset">+</a> <a href="#akka.persistence.serialization.SnapshotSerializer.offset" title="=&gt; Int">offset</a>
    val <a title="Seq[Byte]" id="akka.persistence.serialization.SnapshotSerializer.doPatch.clazz">clazz</a>: <span title="Seq[Byte]">Seq</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.baus" title="java.io.ByteArrayOutputStream">baus</a>.<span title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">toByteArray</span>.<span title="(from: Int, until: Int)Array[Byte]">slice</span><span title="implicit scala.LowPriorityImplicits.wrapByteArray : (xs: Array[Byte])scala.collection.mutable.WrappedArray[Byte]" class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.superOffset" title="Int">superOffset</a>, <a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.uidOffset" title="Int">uidOffset</a><span class="delimiter">)</span>
    val <a title="Seq[Byte]" id="akka.persistence.serialization.SnapshotSerializer.doPatch.knownClazz">knownClazz</a>: <span title="Seq[Byte]">Seq</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <a href="#akka.persistence.serialization.SnapshotSerializer.key" title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">key</a>.<span title="(n: Int)Array[Byte]">take</span><span title="implicit scala.LowPriorityImplicits.wrapByteArray : (xs: Array[Byte])scala.collection.mutable.WrappedArray[Byte]" class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.offset" title="=&gt; Int">offset</a><span class="delimiter">)</span>
    val <a title="Seq[Byte]" id="akka.persistence.serialization.SnapshotSerializer.doPatch.uid">uid</a>: <span title="Seq[Byte]">Seq</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.baus" title="java.io.ByteArrayOutputStream">baus</a>.<span title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">toByteArray</span>.<span title="(from: Int, until: Int)Array[Byte]">slice</span><span title="implicit scala.LowPriorityImplicits.wrapByteArray : (xs: Array[Byte])scala.collection.mutable.WrappedArray[Byte]" class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.uidOffset" title="Int">uidOffset</a>, <a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.uidOffset" title="Int">uidOffset</a> <span title="(x: Int)Int">+</span> <a href="#akka.persistence.serialization.SnapshotSerializer.replacement" title="=&gt; Array[Byte]">replacement</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
    <span class="comment">// only attempt to patch if we know the target class</span>
    if <span class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.clazz" title="Seq[Byte]">clazz</a> <span title="(x$1: Any)Boolean">==</span> <a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.knownClazz" title="Seq[Byte]">knownClazz</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.uid" title="Seq[Byte]">uid</a> <span title="(x$1: Any)Boolean">==</span> <a href="#akka.persistence.serialization.SnapshotSerializer.replacement" title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">replacement</a>.<span title="=&gt; Seq[Byte]">toSeq</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">// running on 2.11</span>
        true
      <span class="delimiter">}</span> else if <span class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.uid" title="Seq[Byte]">uid</a> <span title="(x$1: Any)Boolean">==</span> <span class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.key" title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">key</a>.<span title="(from: Int, until: Int)Array[Byte]">slice</span><span title="implicit scala.LowPriorityImplicits.wrapByteArray : (xs: Array[Byte])scala.collection.mutable.WrappedArray[Byte]" class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.offset" title="=&gt; Int">offset</a>, <a href="#akka.persistence.serialization.SnapshotSerializer.offset" title="=&gt; Int">offset</a> <span title="(x: Int)Int">+</span> <a href="#akka.persistence.serialization.SnapshotSerializer.replacement" title="=&gt; Array[Byte]">replacement</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>: <span title="Seq[Byte]">Seq</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">// running on 2.10, need to switch out UID between key and replacement</span>
        val <a title="Int" id="akka.persistence.serialization.SnapshotSerializer.doPatch.len">len</a> = <a href="#akka.persistence.serialization.SnapshotSerializer.replacement" title="=&gt; Array[Byte]">replacement</a>.<span title="=&gt; Int">length</span>
        val <a title="Array[Byte]" id="akka.persistence.serialization.SnapshotSerializer.doPatch.tmp">tmp</a> = new <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.len" title="Int">len</a><span class="delimiter">)</span>
        <span title="System.type">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.replacement" title="=&gt; Array[Byte]">replacement</a>, <span title="Int(0)" class="int">0</span>, <a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.tmp" title="Array[Byte]">tmp</a>, <span title="Int(0)" class="int">0</span>, <a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.len" title="Int">len</a><span class="delimiter">)</span>
        <span title="System.type">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.key" title="=&gt; Array[Byte]">key</a>, <a href="#akka.persistence.serialization.SnapshotSerializer.offset" title="=&gt; Int">offset</a>, <a href="#akka.persistence.serialization.SnapshotSerializer.replacement" title="=&gt; Array[Byte]">replacement</a>, <span title="Int(0)" class="int">0</span>, <a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.len" title="Int">len</a><span class="delimiter">)</span>
        <span title="System.type">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.tmp" title="Array[Byte]">tmp</a>, <span title="Int(0)" class="int">0</span>, <a href="#akka.persistence.serialization.SnapshotSerializer.key" title="=&gt; Array[Byte]">key</a>, <a href="#akka.persistence.serialization.SnapshotSerializer.offset" title="=&gt; Int">offset</a>, <a href="#akka.persistence.serialization.SnapshotSerializer.doPatch.len" title="Int">len</a><span class="delimiter">)</span>
        true
      <span class="delimiter">}</span> else false
    <span class="delimiter">}</span> else false
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
