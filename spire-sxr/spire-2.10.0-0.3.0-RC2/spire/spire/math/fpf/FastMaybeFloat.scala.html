<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>spire/spire/math/fpf/FastMaybeFloat.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> spire.math.fpf

<span class="keyword">import</span> spire.math._

<span class="keyword">import</span> scala.math.abs

<span class="keyword">import</span> java.lang.<span class="delimiter">{</span> Float =&gt; jFloat <span class="delimiter">}</span>


/**
 * A `Long` encoded version of `MaybeDouble`, geared for unboxed speed. This
 * is significantly less accurate, but may provide good speed gains in common
 * cases.
 *
 * The values `approx` and `measure` are both truncated floats with the full
 * 8 bit exponent, but only 16 bit mantissa. Since the `measure` is always
 * positive, we only need `2 * (16 + 8) + 1 = 49` bits for these 2 numbers,
 * which leaves 15 bits for the `index`. These sizes were chosen so that
 * worst case relative error, `ind * eps`, has a value less than 1. In our
 * case, with worst case `ind = -1 &gt;&gt;&gt; 17`, we have `ind * eps =~ 0.5`.
 *
 * This was inspired by Erik Osheim's awesome FastComplex, which encodes the
 * imaginary and real parts as 2 `Float`s in the a single `Long`.
 *
 * TODO: Perhaps, if we've only used + or *, we could store a higher precision
 *       float instead, since we don't need measure. Use 1 bit to handle the
 *       switching, taken from the index.
 */
<span class="keyword">object</span> <a title="spire.math.fpf.FastMaybeFloat.type" id="16457">FastMaybeFloat</a> <a href="#16458" title="spire.math.fpf.FastMaybeFloat.type" class="delimiter">{</a>
  <span class="keyword">final</span> <span class="keyword">val</span> <a title="Long(-1L)" id="185699">Invalid</a> = -<span title="Long(-1L)" class="long">1L</span>
 
  // esp = ~0.000015
  <span class="keyword">final</span> <span class="keyword">val</span> <a title="Float" id="185701">eps</a> = java.lang.<span title="Float.type">Float</span>.<span title="(x$1: Int)Float">intBitsToFloat</span><span class="delimiter">(</span><span class="delimiter">(</span><span class="int">127</span> - <span class="int">16</span><span class="delimiter">)</span> <span title="Int(931135488)">&lt;&lt;</span> <span class="int">23</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">val</span> <a title="Long(32767L)" id="185703">indexMask</a>   = <span title="Long(32767L)" class="long">0x0000000000007FFFL</span>
  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">val</span> <a title="Long(549755781120L)" id="185705">measureMask</a> = <span title="Long(549755781120L)" class="long">0x0000007FFFFF8000L</span>
  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">val</span> <a title="Long(-549755813888L)" id="185707">approxMask</a>  = <span title="Long(-549755813888L)" class="long">0xFFFFFF8000000000L</span>
  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">val</span> <a title="Long(9187343239835811840L)" id="185709">invalidMask</a> = <span title="Long(9187343239835811840L)" class="long">0x7F80000000000000L</span>

  @inline <span class="keyword">def</span> <a title="(x: Long)Float" id="185711">asFloat</a><span class="delimiter">(</span><a title="Long" id="185744">x</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Float">Float</span> = java.lang.<span title="Float.type">Float</span>.<span title="(x$1: Int)Float">intBitsToFloat</span><span class="delimiter">(</span><a href="#185744" title="Long">x</a>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span>
  @inline <span class="keyword">def</span> <a title="(a: Int, b: Int)Int" id="185712">max</a><span class="delimiter">(</span><a title="Int" id="185745">a</a>: <span title="Int">Int</span>, <a title="Int" id="185746">b</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#185745" title="Int">a</a> <span title="(x: Int)Boolean">&gt;</span> <a href="#185746" title="Int">b</a><span class="delimiter">)</span> <a href="#185745" title="Int">a</a> <span class="keyword">else</span> <a href="#185746" title="Int">b</a>
  @inline <span class="keyword">def</span> <a title="(a: Int, b: Int)Int" id="185713">min</a><span class="delimiter">(</span><a title="Int" id="185751">a</a>: <span title="Int">Int</span>, <a title="Int" id="185752">b</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#185751" title="Int">a</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#185752" title="Int">b</a><span class="delimiter">)</span> <a href="#185751" title="Int">a</a> <span class="keyword">else</span> <a href="#185752" title="Int">b</a>
  @inline <span class="keyword">def</span> <a title="(a: Long)Boolean" id="185714">invalid</a><span class="delimiter">(</span><a title="Long" id="185757">a</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">(</span><a href="#185757" title="Long">a</a> <span title="(x: Long)Long">&amp;</span> <span title="Long(9187343239835811840L)">invalidMask</span><span class="delimiter">)</span> <span title="(x: Long)Boolean">==</span> <span title="Long(9187343239835811840L)">invalidMask</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(mf: Long)Float" id="185715">approx</a><span class="delimiter">(</span><a title="Long" id="185767">mf</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Float">Float</span> = <a href="#185711" title="(x: Long)Float">asFloat</a><span class="delimiter">(</span><span class="delimiter">(</span><a href="#185767" title="Long">mf</a> <span title="(x: Long)Long">&amp;</span> <span title="Long(-549755813888L)">approxMask</span><span class="delimiter">)</span> <span title="(x: Int)Long">&gt;&gt;&gt;</span> <span title="Int(32)" class="int">32</span><span class="delimiter">)</span>
  @inline <span class="keyword">final</span> <span class="keyword">def</span> <a title="(mf: Long)Float" id="185716">measure</a><span class="delimiter">(</span><a title="Long" id="185776">mf</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Float">Float</span> = <a href="#185711" title="(x: Long)Float">asFloat</a><span class="delimiter">(</span><span class="delimiter">(</span><a href="#185776" title="Long">mf</a> <span title="(x: Long)Long">&amp;</span> <span title="Long(549755781120L)">measureMask</span><span class="delimiter">)</span> <span title="(x: Int)Long">&gt;&gt;&gt;</span> <span title="Int(8)" class="int">8</span><span class="delimiter">)</span>
  @inline <span class="keyword">final</span> <span class="keyword">def</span> <a title="(mf: Long)Int" id="185717">index</a><span class="delimiter">(</span><a title="Long" id="185785">mf</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">(</span><a href="#185785" title="Long">mf</a> <span title="(x: Long)Long">&amp;</span> <span title="Long(32767L)">indexMask</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(mf: Long)Float" id="185718">error</a><span class="delimiter">(</span><a title="Long" id="185790">mf</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Float">Float</span> = <a href="#185716" title="(mf: Long)Float">measure</a><span class="delimiter">(</span><a href="#185790" title="Long">mf</a><span class="delimiter">)</span> <span title="(x: Int)Float">*</span> <a href="#185717" title="(mf: Long)Int">index</a><span class="delimiter">(</span><a href="#185790" title="Long">mf</a><span class="delimiter">)</span> <span title="(x: Float)Float">*</span> <a href="#185701" title="=&gt; Float">eps</a>

  @inline <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="(a: Float, m: Float, i: Int)Long" id="185719">applySafe</a><span class="delimiter">(</span><a title="Float" id="185800">a</a>: <span title="Float">Float</span>, <a title="Float" id="185801">m</a>: <span title="Float">Float</span>, <a title="Int" id="185802">i</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Long">Long</span> = 
    <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span><a href="#185800" title="Float">a</a>, <a href="#185801" title="Float">m</a>, <a href="#185713" title="(a: Int, b: Int)Int">min</a><span class="delimiter">(</span><a href="#185802" title="Int">i</a>, <span class="int">1</span> <span title="Int(65536)">&lt;&lt;</span> <span class="int">16</span><span class="delimiter">)</span><span class="delimiter">)</span>
  
  /**
   * This should be used whenever it can be guaranteed that `i &lt; 2^17`. Notably,
   * this can be used when adding at most 1 to the sum of 2 different indexes.
   */
  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="(a: Float, m: Float, i: Int)Long" id="185720">apply</a><span class="delimiter">(</span><a title="Float" id="185814">a</a>: <span title="Float">Float</span>, <a title="Float" id="185815">m</a>: <span title="Float">Float</span>, <a title="Int" id="185816">i</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Long" id="185821">x</a> = <span class="delimiter">(</span><span class="delimiter">(</span><span title="Float.type">jFloat</span>.<span title="(x$1: Float)Int">floatToIntBits</span><span class="delimiter">(</span><a href="#185814" title="Float">a</a><span class="delimiter">)</span>.<span title="=&gt; Long">toLong</span> <span title="(x: Int)Long">&lt;&lt;</span> <span title="Int(17)" class="int">17</span><span class="delimiter">)</span> <span title="(x: Long)Long">&amp;</span> <span title="Long(-16777216L)" class="long">0xFFFFFFFFFF000000L</span><span class="delimiter">)</span> <span title="(x: Long)Long">|</span>
      <span class="delimiter">(</span><span title="Float.type">jFloat</span>.<span title="(x$1: Float)Int">floatToIntBits</span><span class="delimiter">(</span><a href="#185815" title="Float">m</a><span class="delimiter">)</span> <span title="(x: Int)Int">&gt;&gt;&gt;</span> <span title="Int(7)" class="int">7</span><span class="delimiter">)</span>.<span title="=&gt; Long">toLong</span>
    
    // Sign extends it if bit 16 is set, thus making it invalid.
    
    <span class="delimiter">(</span><a href="#185821" title="Long">x</a> <span title="(x: Int)Long">&lt;&lt;</span> <span title="Int(15)" class="int">15</span><span class="delimiter">)</span> <span title="(x: Long)Long">|</span> <span class="delimiter">(</span><a href="#185816" title="Int">i</a>.<span title="=&gt; Long">toLong</span> <span title="(x: Int)Long">&lt;&lt;</span> <span title="Int(48)" class="int">48</span> <span title="(x: Int)Long">&gt;&gt;</span> <span title="Int(48)" class="int">48</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(a: Long, b: Long)Long" id="185721">plus</a><span class="delimiter">(</span><a title="Long" id="185854">a</a>: <span title="Long">Long</span>, <a title="Long" id="185855">b</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Long">Long</span> =
    <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span><a href="#185715" title="(mf: Long)Float">approx</a><span class="delimiter">(</span><a href="#185854" title="Long">a</a><span class="delimiter">)</span> <span title="(x: Float)Float">+</span> <a href="#185715" title="(mf: Long)Float">approx</a><span class="delimiter">(</span><a href="#185855" title="Long">b</a><span class="delimiter">)</span>, <a href="#185716" title="(mf: Long)Float">measure</a><span class="delimiter">(</span><a href="#185854" title="Long">a</a><span class="delimiter">)</span> <span title="(x: Float)Float">+</span> <a href="#185716" title="(mf: Long)Float">measure</a><span class="delimiter">(</span><a href="#185855" title="Long">b</a><span class="delimiter">)</span>, <a href="#185712" title="(a: Int, b: Int)Int">max</a><span class="delimiter">(</span><a href="#185717" title="(mf: Long)Int">index</a><span class="delimiter">(</span><a href="#185854" title="Long">a</a><span class="delimiter">)</span>, <a href="#185717" title="(mf: Long)Int">index</a><span class="delimiter">(</span><a href="#185855" title="Long">b</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(a: Long, b: Long)Long" id="185722">minus</a><span class="delimiter">(</span><a title="Long" id="185872">a</a>: <span title="Long">Long</span>, <a title="Long" id="185873">b</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Long">Long</span> =
    <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span><a href="#185715" title="(mf: Long)Float">approx</a><span class="delimiter">(</span><a href="#185872" title="Long">a</a><span class="delimiter">)</span> <span title="(x: Float)Float">-</span> <a href="#185715" title="(mf: Long)Float">approx</a><span class="delimiter">(</span><a href="#185873" title="Long">b</a><span class="delimiter">)</span>, <a href="#185716" title="(mf: Long)Float">measure</a><span class="delimiter">(</span><a href="#185872" title="Long">a</a><span class="delimiter">)</span> <span title="(x: Float)Float">+</span> <a href="#185716" title="(mf: Long)Float">measure</a><span class="delimiter">(</span><a href="#185873" title="Long">b</a><span class="delimiter">)</span>, <a href="#185712" title="(a: Int, b: Int)Int">max</a><span class="delimiter">(</span><a href="#185717" title="(mf: Long)Int">index</a><span class="delimiter">(</span><a href="#185872" title="Long">a</a><span class="delimiter">)</span>, <a href="#185717" title="(mf: Long)Int">index</a><span class="delimiter">(</span><a href="#185873" title="Long">b</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(a: Long, b: Long)Long" id="185723">times</a><span class="delimiter">(</span><a title="Long" id="185890">a</a>: <span title="Long">Long</span>, <a title="Long" id="185891">b</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Long">Long</span> =
    <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span><a href="#185715" title="(mf: Long)Float">approx</a><span class="delimiter">(</span><a href="#185890" title="Long">a</a><span class="delimiter">)</span> <span title="(x: Float)Float">*</span> <a href="#185715" title="(mf: Long)Float">approx</a><span class="delimiter">(</span><a href="#185891" title="Long">b</a><span class="delimiter">)</span>, <a href="#185716" title="(mf: Long)Float">measure</a><span class="delimiter">(</span><a href="#185890" title="Long">a</a><span class="delimiter">)</span> <span title="(x: Float)Float">*</span> <a href="#185716" title="(mf: Long)Float">measure</a><span class="delimiter">(</span><a href="#185891" title="Long">b</a><span class="delimiter">)</span>, <a href="#185717" title="(mf: Long)Int">index</a><span class="delimiter">(</span><a href="#185890" title="Long">a</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <a href="#185717" title="(mf: Long)Int">index</a><span class="delimiter">(</span><a href="#185891" title="Long">b</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(a: Long, b: Long)Long" id="185724">div</a><span class="delimiter">(</span><a title="Long" id="185912">a</a>: <span title="Long">Long</span>, <a title="Long" id="185913">b</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Float" id="185914">fa</a> = <a href="#185715" title="(mf: Long)Float">approx</a><span class="delimiter">(</span><a href="#185912" title="Long">a</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Float" id="185915">fb</a> = <a href="#185715" title="(mf: Long)Float">approx</a><span class="delimiter">(</span><a href="#185913" title="Long">b</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Float" id="185916">ma</a> = <a href="#185716" title="(mf: Long)Float">measure</a><span class="delimiter">(</span><a href="#185912" title="Long">a</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Float" id="185917">mb</a> = <a href="#185716" title="(mf: Long)Float">measure</a><span class="delimiter">(</span><a href="#185913" title="Long">b</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="185918">ib</a> = <a href="#185717" title="(mf: Long)Int">index</a><span class="delimiter">(</span><a href="#185913" title="Long">b</a><span class="delimiter">)</span>

    <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span>
      <a href="#185914" title="Float">fa</a> <span title="(x: Float)Float">/</span> <a href="#185915" title="Float">fb</a>,
      <span class="delimiter">(</span><span title="(x: Float)Float">abs</span><span class="delimiter">(</span><a href="#185914" title="Float">fa</a><span class="delimiter">)</span> <span title="(x: Float)Float">/</span> <span title="(x: Float)Float">abs</span><span class="delimiter">(</span><a href="#185915" title="Float">fb</a><span class="delimiter">)</span> <span title="(x: Float)Float">+</span> <a href="#185916" title="Float">ma</a> <span title="(x: Float)Float">/</span> <a href="#185917" title="Float">mb</a><span class="delimiter">)</span> <span title="(x: Float)Float">/</span> <span class="delimiter">(</span><span title="(x: Float)Float">abs</span><span class="delimiter">(</span><a href="#185915" title="Float">fb</a><span class="delimiter">)</span> <span title="(x: Float)Float">/</span> <a href="#185917" title="Float">mb</a> <span title="(x: Float)Float">-</span> <span class="delimiter">(</span><a href="#185918" title="Int">ib</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(x: Float)Float">*</span> <a href="#185701" title="=&gt; Float">eps</a><span class="delimiter">)</span>,
      <span title="Int(1)" class="int">1</span> <span title="(x: Int)Int">+</span> <a href="#185712" title="(a: Int, b: Int)Int">max</a><span class="delimiter">(</span><a href="#185717" title="(mf: Long)Int">index</a><span class="delimiter">(</span><a href="#185912" title="Long">a</a><span class="delimiter">)</span>, <a href="#185918" title="Int">ib</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(a: Long, k: Int)Long" id="185725">pow</a><span class="delimiter">(</span><a title="Long" id="185979">a</a>: <span title="Long">Long</span>, <a title="Int" id="185980">k</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <span title="Long" class="keyword">if</span> <span class="delimiter">(</span><a href="#185980" title="Int">k</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span>math.<span title="(x: Double, y: Double)Double">pow</span><span class="delimiter">(</span><a href="#185715" title="(mf: Long)Float">approx</a><span title="=&gt; Double" class="delimiter">(</span><a href="#185979" title="Long">a</a><span class="delimiter">)</span>, <a href="#185980" title="=&gt; Double">k</a><span class="delimiter">)</span>.<span title="=&gt; Float">toFloat</span>, math.<span title="(x: Double, y: Double)Double">pow</span><span class="delimiter">(</span><a href="#185716" title="(mf: Long)Float">measure</a><span title="=&gt; Double" class="delimiter">(</span><a href="#185979" title="Long">a</a><span class="delimiter">)</span>, <a href="#185980" title="=&gt; Double">k</a><span class="delimiter">)</span>.<span title="=&gt; Float">toFloat</span>, <a href="#185717" title="(mf: Long)Int">index</a><span class="delimiter">(</span><a href="#185979" title="Long">a</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <a href="#185980" title="Int">k</a><span class="delimiter">)</span>
  <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Long" class="keyword">if</span> <span class="delimiter">(</span><a href="#185980" title="Int">k</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Float" id="185997">fb</a> = math.<span title="(x: Double, y: Double)Double">pow</span><span class="delimiter">(</span><a href="#185715" title="(mf: Long)Float">approx</a><span title="=&gt; Double" class="delimiter">(</span><a href="#185979" title="Long">a</a><span class="delimiter">)</span>, <span title="=&gt; Double">-</span><a href="#185980" title="Int">k</a><span class="delimiter">)</span>.<span title="=&gt; Float">toFloat</span>
    <span class="keyword">val</span> <a title="Float" id="185998">mb</a> = math.<span title="(x: Double, y: Double)Double">pow</span><span class="delimiter">(</span><a href="#185716" title="(mf: Long)Float">measure</a><span title="=&gt; Double" class="delimiter">(</span><a href="#185979" title="Long">a</a><span class="delimiter">)</span>, <span title="=&gt; Double">-</span><a href="#185980" title="Int">k</a><span class="delimiter">)</span>.<span title="=&gt; Float">toFloat</span>
    <span class="keyword">val</span> <a title="Int" id="185999">ib</a> = <a href="#185717" title="(mf: Long)Int">index</a><span class="delimiter">(</span><a href="#185979" title="Long">a</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <a href="#185980" title="Int">k</a>

    <span class="keyword">val</span> <a title="Float" id="186000">mes</a> = <span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <span title="(x: Float)Float">/</span> <span title="(x: Float)Float">abs</span><span class="delimiter">(</span><a href="#185997" title="Float">fb</a><span class="delimiter">)</span> <span title="(x: Float)Float">+</span> <span title="Int(1)" class="int">1</span> <span title="(x: Float)Float">/</span> <a href="#185998" title="Float">mb</a><span class="delimiter">)</span> <span title="(x: Float)Float">/</span> <span class="delimiter">(</span><span title="(x: Float)Float">abs</span><span class="delimiter">(</span><a href="#185997" title="Float">fb</a><span class="delimiter">)</span> <span title="(x: Float)Float">/</span> <a href="#185998" title="Float">mb</a> <span title="(x: Float)Float">-</span> <span class="delimiter">(</span><a href="#185998" title="Float">mb</a> <span title="(x: Int)Float">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(x: Float)Float">*</span> <a href="#185701" title="=&gt; Float">eps</a><span class="delimiter">)</span>

    <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <span title="(x: Float)Float">/</span> <a href="#185997" title="Float">fb</a>, <a href="#186000" title="Float">mes</a>, <a href="#185999" title="Int">ib</a> <span title="(x: Int)Int">+</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span>
  <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
    <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span><span title="Float(1.0)" class="int">1</span>, <span title="Float(1.0)" class="int">1</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
 
  <span class="keyword">def</span> <a title="(a: Long, n: Int)Long" id="185726">nroot</a><span class="delimiter">(</span><a title="Long" id="186061">a</a>: <span title="Long">Long</span>, <a title="Int" id="186062">n</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <span title="Long" class="keyword">if</span> <span class="delimiter">(</span><a href="#186062" title="Int">n</a> <span title="(x: Int)Boolean">==</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <a href="#185727" title="(a: Long)Long">sqrt</a><span class="delimiter">(</span><a href="#186061" title="Long">a</a><span class="delimiter">)</span> <span class="keyword">else</span> <span title="Long(-1L)">Invalid</span>
   
  <span class="keyword">def</span> <a title="(a: Long)Long" id="185727">sqrt</a><span class="delimiter">(</span><a title="Long" id="186067">a</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Float" id="186068">fa</a> = <a href="#185715" title="(mf: Long)Float">approx</a><span class="delimiter">(</span><a href="#186067" title="Long">a</a><span class="delimiter">)</span>

    // If fa &lt; 0, then sqrt(fa) == NaN, which is OK for now.

    <span title="Long" class="keyword">if</span> <span class="delimiter">(</span><a href="#185714" title="(a: Long)Boolean">invalid</a><span class="delimiter">(</span><a href="#186067" title="Long">a</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#186068" title="Float">fa</a> <span title="(x: Float)Boolean">&lt;=</span> <span title="Float(0.0)" class="float">0.0f</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span>math.<span title="(x: Double)Double">sqrt</span><span class="delimiter">(</span><a href="#186068" title="=&gt; Double">fa</a><span class="delimiter">)</span>.<span title="=&gt; Float">toFloat</span>, math.<span title="(x: Double)Double">sqrt</span><span class="delimiter">(</span><a href="#185716" title="(mf: Long)Float">measure</a><span title="=&gt; Double" class="delimiter">(</span><a href="#186067" title="Long">a</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; Float">toFloat</span> <span title="(x: Int)Float">*</span> <span class="delimiter">(</span><span class="int">1</span> <span title="Int(16)">&lt;&lt;</span> <span class="int">4</span><span class="delimiter">)</span>, <a href="#185717" title="(mf: Long)Int">index</a><span class="delimiter">(</span><a href="#186067" title="Long">a</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Float" id="186089">fb</a> = math.<span title="(x: Double)Double">sqrt</span><span class="delimiter">(</span><a href="#186068" title="=&gt; Double">fa</a><span class="delimiter">)</span>.<span title="=&gt; Float">toFloat</span>
      <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span><a href="#186089" title="Float">fb</a>, <span class="delimiter">(</span><a href="#185716" title="(mf: Long)Float">measure</a><span class="delimiter">(</span><a href="#186067" title="Long">a</a><span class="delimiter">)</span> <span title="(x: Float)Float">/</span> <a href="#186068" title="Float">fa</a><span class="delimiter">)</span> <span title="(x: Float)Float">*</span> <a href="#186089" title="Float">fb</a>, <a href="#185717" title="(mf: Long)Int">index</a><span class="delimiter">(</span><a href="#186067" title="Long">a</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="keyword">def</span> <a title="(x: Float)Long" id="185728">apply</a><span class="delimiter">(</span><a title="Float" id="185813">x</a>: <span title="Float">Float</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span><a href="#185813" title="Float">x</a>, <a href="#185813" title="Float">x</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(x: Double)Long" id="185729">apply</a><span class="delimiter">(</span><a title="Double" id="185812">x</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span><a href="#185812" title="Double">x</a>.<span title="=&gt; Float">toFloat</span>, <a href="#185812" title="Double">x</a>.<span title="=&gt; Float">toFloat</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(x: Int)Long" id="185730">apply</a><span class="delimiter">(</span><a title="Int" id="185811">x</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span><a href="#185811" title="=&gt; Float">x</a>, <a href="#185811" title="=&gt; Float">x</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(x: Long)Long" id="185731">apply</a><span class="delimiter">(</span><a title="Long" id="185810">x</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span><a href="#185810" title="=&gt; Float">x</a>, <a href="#185810" title="=&gt; Float">x</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(x: BigInt)Long" id="185732">apply</a><span class="delimiter">(</span><a title="BigInt" id="185809">x</a>: <span title="BigInt">BigInt</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Float" id="186122">f</a> = <a href="#185809" title="BigInt">x</a>.<span title="=&gt; Float">toFloat</span>
    <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span><a href="#186122" title="Float">f</a>, <a href="#186122" title="Float">f</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(x: BigDecimal)Long" id="185733">apply</a><span class="delimiter">(</span><a title="BigDecimal" id="185808">x</a>: <span title="BigDecimal">BigDecimal</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Float" id="186127">f</a> = <a href="#185808" title="BigDecimal">x</a>.<span title="=&gt; Float">toFloat</span>
    <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span><a href="#186127" title="Float">f</a>, <a href="#186127" title="Float">f</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(x: spire.math.Rational)Long" id="185734">apply</a><span class="delimiter">(</span><a title="spire.math.Rational" id="185807">x</a>: <a href="../Rational.scala.html#15737" title="spire.math.Rational">Rational</a><span class="delimiter">)</span>: <span title="Long">Long</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Float" id="186132">f</a> = <a href="#185807" title="spire.math.Rational">x</a>.<span title="=&gt; Float">toFloat</span>
    <a href="#185720" title="(a: Float, m: Float, i: Int)Long">apply</a><span class="delimiter">(</span><a href="#186132" title="Float">f</a>, <a href="#186132" title="Float">f</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>