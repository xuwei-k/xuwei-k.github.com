<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>spire/spire/math/real/BigDecimalApproximations.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> spire.math.real

<span class="keyword">import</span> java.math.<span class="delimiter">{</span> MathContext, BigDecimal =&gt; BigDec <span class="delimiter">}</span>
<span class="keyword">import</span> scala.math.max

<span class="keyword">import</span> spire.algebra.<span class="delimiter">{</span> NRoot, Zero <span class="delimiter">}</span>
<span class="keyword">import</span> spire.math._

/**
 * Provides absolute and relative approximations to `RealLike` types that have
 * mixed in a `SeparationBound`. The absolute approximations take 
 * `BigDecimal` for their context, returning a `BigDecimal` that is equal to
 * the `RealLike` +/- the context (error). The relative approximations take a
 * `MathContext` specifying how many digits to determine the value of the
 * `RealLike` to.
 *
 * Note that a relative approximation of 0 is always 0.
 *
 * Here, we mostly work with `java.math.BigDecimal` as its operations let you
 * provide a `MathContext` directly. However, I'm pretty sure that
 * `a.add(b, mc)` is equivalent to `(a + b).round(mc)`.
 */
<span class="keyword">object</span> <a title="spire.math.real.BigDecimalApproximations.type" id="16560">BigDecimalApproximations</a> <a href="#16561" title="spire.math.real.BigDecimalApproximations.type" class="delimiter">{</a>

  /**
   * Removes some of the tedium when dealing with manipulating the precision of
   * `MathContext`s.
   */
  <span class="keyword">final</span> <span class="keyword">class</span> <a title="class MathContextOps extends Object" id="84844">MathContextOps</a><a href="#84844" title="spire.math.real.BigDecimalApproximations.MathContextOps" class="delimiter">(</a><a title="java.math.MathContext" id="146794">mc</a>: <span title="java.math.MathContext">MathContext</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; java.math.RoundingMode" id="146784">roundingMode</a>: java.math.<span title="java.math.RoundingMode">RoundingMode</span> = <a href="#146794" title="java.math.MathContext">mc</a>.<span title="()java.math.RoundingMode">getRoundingMode</span>
    <span class="keyword">def</span> <a title="=&gt; Int" id="146785">precision</a>: <span title="Int">Int</span> = <a href="#146794" title="java.math.MathContext">mc</a>.<span title="()Int">getPrecision</span>
    <span class="keyword">def</span> <a title="(x: Int)java.math.MathContext" id="146786">+</a><span class="delimiter">(</span><a title="Int" id="187838">x</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="java.math.MathContext">MathContext</span> = <span title="(x$1: Int, x$2: java.math.RoundingMode)java.math.MathContext" class="keyword">new</span> <span title="java.math.MathContext">MathContext</span><span class="delimiter">(</span><a href="#146785" title="=&gt; Int">precision</a> <span title="(x: Int)Int">+</span> <a href="#187838" title="Int">x</a>, <a href="#146784" title="=&gt; java.math.RoundingMode">roundingMode</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(x: Int)java.math.MathContext" id="146787">-</a><span class="delimiter">(</span><a title="Int" id="187846">x</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="java.math.MathContext">MathContext</span> = <span title="(x$1: Int, x$2: java.math.RoundingMode)java.math.MathContext" class="keyword">new</span> <span title="java.math.MathContext">MathContext</span><span class="delimiter">(</span><a href="#146785" title="=&gt; Int">precision</a> <span title="(x: Int)Int">-</span> <a href="#187846" title="Int">x</a>, <a href="#146784" title="=&gt; java.math.RoundingMode">roundingMode</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(x: Int)java.math.MathContext" id="146788">*</a><span class="delimiter">(</span><a title="Int" id="187853">x</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="java.math.MathContext">MathContext</span> = <span title="(x$1: Int, x$2: java.math.RoundingMode)java.math.MathContext" class="keyword">new</span> <span title="java.math.MathContext">MathContext</span><span class="delimiter">(</span><a href="#146785" title="=&gt; Int">precision</a> <span title="(x: Int)Int">*</span> <a href="#187853" title="Int">x</a>, <a href="#146784" title="=&gt; java.math.RoundingMode">roundingMode</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(x: Int)java.math.MathContext" id="146789">/</a><span class="delimiter">(</span><a title="Int" id="187860">x</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="java.math.MathContext">MathContext</span> = <span title="(x$1: Int, x$2: java.math.RoundingMode)java.math.MathContext" class="keyword">new</span> <span title="java.math.MathContext">MathContext</span><span class="delimiter">(</span><a href="#146785" title="=&gt; Int">precision</a> <span title="(x: Int)Int">/</span> <a href="#187860" title="Int">x</a>, <a href="#146784" title="=&gt; java.math.RoundingMode">roundingMode</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(x: Int)java.math.MathContext" id="146790">min</a><span class="delimiter">(</span><a title="Int" id="187867">x</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="java.math.MathContext">MathContext</span> = <span title="(x$1: Int, x$2: java.math.RoundingMode)java.math.MathContext" class="keyword">new</span> <span title="java.math.MathContext">MathContext</span><span class="delimiter">(</span>math.<span title="(x: Int, y: Int)Int">min</span><span class="delimiter">(</span><a href="#146785" title="=&gt; Int">precision</a>, <a href="#187867" title="Int">x</a><span class="delimiter">)</span>, <a href="#146784" title="=&gt; java.math.RoundingMode">roundingMode</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(x: Int)java.math.MathContext" id="146791">max</a><span class="delimiter">(</span><a title="Int" id="187872">x</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="java.math.MathContext">MathContext</span> = <span title="(x$1: Int, x$2: java.math.RoundingMode)java.math.MathContext" class="keyword">new</span> <span title="java.math.MathContext">MathContext</span><span class="delimiter">(</span>math.<span title="(x: Int, y: Int)Int">max</span><span class="delimiter">(</span><a href="#146785" title="=&gt; Int">precision</a>, <a href="#187872" title="Int">x</a><span class="delimiter">)</span>, <a href="#146784" title="=&gt; java.math.RoundingMode">roundingMode</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(omc: java.math.MathContext)java.math.MathContext" id="146792">min</a><span class="delimiter">(</span><a title="java.math.MathContext" id="187877">omc</a>: <span title="java.math.MathContext">MathContext</span><span class="delimiter">)</span>: <span title="java.math.MathContext">MathContext</span> = <a href="#84844" title="MathContextOps.this.type" class="keyword">this</a> <a href="#146790" title="(x: Int)java.math.MathContext">min</a> <a href="#187877" title="java.math.MathContext">omc</a>.<span title="()Int">getPrecision</span>
    <span class="keyword">def</span> <a title="(omc: java.math.MathContext)java.math.MathContext" id="146793">max</a><span class="delimiter">(</span><a title="java.math.MathContext" id="187882">omc</a>: <span title="java.math.MathContext">MathContext</span><span class="delimiter">)</span>: <span title="java.math.MathContext">MathContext</span> = <a href="#84844" title="MathContextOps.this.type" class="keyword">this</a> <a href="#146791" title="(x: Int)java.math.MathContext">max</a> <a href="#187882" title="java.math.MathContext">omc</a>.<span title="()Int">getPrecision</span>
  <span class="delimiter">}</span>


  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps" id="84845">mathContextOps</a><span class="delimiter">(</span><a title="java.math.MathContext" id="146780">omc</a>: <span title="java.math.MathContext">MathContext</span><span class="delimiter">)</span> = <span title="spire.math.real.BigDecimalApproximations.MathContextOps" class="keyword">new</span> <a href="#84844" title="spire.math.real.BigDecimalApproximations.MathContextOps">MathContextOps</a><span class="delimiter">(</span><a href="#146780" title="java.math.MathContext">omc</a><span class="delimiter">)</span>


  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[A &lt;: spire.math.real.RealLike[A] with spire.math.real.SeparationBound[A]](implicit evidence$1: spire.math.real.Coexpr[A])spire.math.real.BigDecimalApproximations.Absolute[A]" id="146767">Absolute</a><span class="delimiter">[</span><a title=" &lt;: spire.math.real.RealLike[A] with spire.math.real.SeparationBound[A]" id="84848">A</a> &lt;: RealLike<span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="keyword">with</span> SeparationBound<span class="delimiter">[</span>A<span class="delimiter">]</span>: Coexpr<span class="delimiter">]</span> = <a href="#146767" title="spire.math.real.BigDecimalApproximations.Absolute[A]" class="keyword">new</a> <a href="#84849" title="spire.math.real.BigDecimalApproximations.Absolute[A]">Absolute</a><span class="delimiter">[</span>A<span class="delimiter">]</span>

  <span class="keyword">class</span> <a title="class Absolute[A &lt;: spire.math.real.RealLike[A] with spire.math.real.SeparationBound[A]] extends Object with spire.math.Approximation[A,BigDecimal,BigDecimal]" id="84849">Absolute</a><span class="delimiter">[</span><a title=" &lt;: spire.math.real.RealLike[A] with spire.math.real.SeparationBound[A]" id="84850">A</a> &lt;: RealLike<span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="keyword">with</span> SeparationBound<span class="delimiter">[</span>A<span class="delimiter">]</span>: Coexpr<span class="delimiter">]</span>
  <span class="keyword">extends</span> <a href="../Approximation.scala.html#13739" title="spire.math.Approximation[A,BigDecimal,BigDecimal]">Approximation</a><span class="delimiter">[</span>A, BigDecimal, BigDecimal<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(a: A, err: BigDecimal)BigDecimal" id="146773">apply</a><span class="delimiter">(</span><a title="A" id="187890">a</a>: <a href="#84850" title="A">A</a>, <a title="BigDecimal" id="187891">err</a>: <span title="BigDecimal">BigDecimal</span><span class="delimiter">)</span>: <span title="BigDecimal">BigDecimal</span> = <span class="delimiter">{</span>
      
      // TODO: Does &quot;scale&quot; always guarantee 10^-scale as a lower bound of err?

      <a href="#146774" title="(a: A, bits: Int)BigDecimal">apply</a><span class="delimiter">(</span><a href="#187890" title="A">a</a>, <a href="#187891" title="BigDecimal">err</a>.<span title="=&gt; Int">scale</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(a: A, bits: Int)BigDecimal" id="146774">apply</a><span class="delimiter">(</span><a title="A" id="187899">a</a>: <a href="#84850" title="A">A</a>, <a title="Int" id="187900">bits</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="BigDecimal">BigDecimal</span> = <a href="#187899" title="A">a</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="Expr.scala.html#186706" title="Option[Int]" id="214836">IntLit</a><span class="delimiter">(</span><a title="Int" id="187929">n</a><span class="delimiter">)</span> =&gt; <span title="(i: Int)scala.math.BigDecimal">BigDecimal</span><a href="#214832" title="(x: BigDecimal)BigDecimal" class="delimiter">(</a><a href="#187929" title="Int">n</a><span class="delimiter">)</span>
      
      <span class="keyword">case</span> <a href="Expr.scala.html#186730" title="Option[BigInt]" id="214838">BigIntLit</a><span class="delimiter">(</span><a title="BigInt" id="187951">n</a><span class="delimiter">)</span> =&gt; <span title="(x: scala.math.BigInt)scala.math.BigDecimal">BigDecimal</span><a href="#214832" title="(x: BigDecimal)BigDecimal" class="delimiter">(</a><a href="#187951" title="BigInt">n</a><span class="delimiter">)</span>
      
      <span class="keyword">case</span> <a href="Expr.scala.html#186904" title="Option[A]" id="214840">Neg</a><span class="delimiter">(</span><a title="A" id="187973">a</a><span class="delimiter">)</span> =&gt; <a href="#214832" title="(x: BigDecimal)BigDecimal">-</a><a href="#146774" title="(a: A, bits: Int)BigDecimal">apply</a><span class="delimiter">(</span><a href="#187973" title="A">a</a>, <a href="#187900" title="Int">bits</a><span class="delimiter">)</span>
      
      <span class="keyword">case</span> <a href="Expr.scala.html#186800" title="Option[(A, A)]" id="214842">Add</a><span class="delimiter">(</span><a title="A" id="187993">a</a>, <a title="A" id="187994">b</a><span class="delimiter">)</span> =&gt; <a href="#146774" title="(a: A, bits: Int)BigDecimal">apply</a><span class="delimiter">(</span><a href="#187993" title="A">a</a>, <a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="#214832" title="(x: BigDecimal)BigDecimal">+</a> <a href="#146774" title="(a: A, bits: Int)BigDecimal">apply</a><span class="delimiter">(</span><a href="#187994" title="A">b</a>, <a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      
      <span class="keyword">case</span> <a href="Expr.scala.html#186826" title="Option[(A, A)]" id="214844">Sub</a><span class="delimiter">(</span><a title="A" id="188028">a</a>, <a title="A" id="188029">b</a><span class="delimiter">)</span> =&gt; <a href="#146774" title="(a: A, bits: Int)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188028" title="A">a</a>, <a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="#214832" title="(x: BigDecimal)BigDecimal">-</a> <a href="#146774" title="(a: A, bits: Int)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188029" title="A">b</a>, <a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>

      <span class="keyword">case</span> <a href="Expr.scala.html#186852" title="Option[(A, A)]" id="214846">Mul</a><span class="delimiter">(</span><a title="A" id="188063">a</a>, <a title="A" id="188064">b</a><span class="delimiter">)</span> =&gt;
        <span class="keyword">val</span> <a title="Int" id="188065">ae</a> = <a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">/</span> <span title="Int(2)" class="int">2</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>
        <span class="keyword">val</span> <a title="Int" id="188066">be</a> = <a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">+</span> <span title="Int(2)" class="int">2</span> <span title="(x: Int)Int">-</span> <a href="#188065" title="Int">ae</a>
        <span class="keyword">val</span> <a title="BigDecimal" id="188067">lhs</a> = <a href="#146774" title="(a: A, bits: Int)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188063" title="A">a</a>, <span title="(x: Int, y: Int)Int">max</span><span class="delimiter">(</span><a href="#188065" title="Int">ae</a>, <a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span> <span title="(x: Int)Int">+</span> <a href="#188064" title="A">b</a>.<a href="SeparationBound.scala.html#58084" title="=&gt; Int">decimalUpperBound</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="BigDecimal" id="188068">rhs</a> = <a href="#146774" title="(a: A, bits: Int)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188064" title="A">b</a>, <span title="(x: Int, y: Int)Int">max</span><span class="delimiter">(</span><a href="#188066" title="Int">be</a>, <a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span> <span title="(x: Int)Int">+</span> <a href="#188063" title="A">a</a>.<a href="SeparationBound.scala.html#58084" title="=&gt; Int">decimalUpperBound</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#188067" title="BigDecimal">lhs</a> <span title="(that: scala.math.BigDecimal)scala.math.BigDecimal">*</span> <a href="#188068" title="BigDecimal">rhs</a>

      <span class="keyword">case</span> e @ <a href="Expr.scala.html#186878" title="Option[(A, A)]" id="214848">Div</a><span class="delimiter">(</span><a title="A" id="188139">a</a>, <a title="A" id="188140">b</a><span class="delimiter">)</span> =&gt;
        <a href="#214832" title="(x: BigDecimal)BigDecimal" class="keyword">if</a> <span class="delimiter">(</span><a href="#188140" title="A">b</a>.<a href="RealLike.scala.html#58060" title="=&gt; spire.algebra.Sign">sign</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../algebra/Sign.scala.html#10941" title="spire.algebra.Zero.type">Zero</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)ArithmeticException" class="keyword">new</span> <span title="ArithmeticException">ArithmeticException</span><span class="delimiter">(</span><span title="String(&quot;/ by zero&quot;)" class="string">&quot;/ by zero&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Int" id="188148">ae</a> = <span class="delimiter">(</span><a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">+</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <span title="(x: Int)Int">/</span> <span title="Int(2)" class="int">2</span>
          <span class="keyword">val</span> <a title="Int" id="188149">be</a> = <a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">+</span> <span title="Int(2)" class="int">2</span> <span title="(x: Int)Int">-</span> <a href="#188148" title="Int">ae</a>

          <span class="keyword">val</span> <a title="BigDecimal" id="188150">lhs</a> = <a href="#146774" title="(a: A, bits: Int)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188139" title="A">a</a>, <a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">+</span> <span title="Int(2)" class="int">2</span> <span title="(x: Int)Int">-</span> <a href="#188140" title="A">b</a>.<a href="SeparationBound.scala.html#58085" title="=&gt; Int">decimalLowerBound</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="BigDecimal" id="188151">rhs</a> = <a href="#146774" title="(a: A, bits: Int)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188140" title="A">b</a>, <span title="(x: Int, y: Int)Int">max</span><span class="delimiter">(</span>
                <span title="Int(1)" class="int">1</span> <span title="(x: Int)Int">-</span> <a href="#188140" title="A">b</a>.<a href="SeparationBound.scala.html#58085" title="=&gt; Int">decimalLowerBound</a>,
                <a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">+</span> <span title="Int(2)" class="int">2</span> <span title="(x: Int)Int">-</span> <span title="Int(2)" class="int">2</span> <span title="(x: Int)Int">*</span> <a href="#188140" title="A">b</a>.<a href="SeparationBound.scala.html#58085" title="=&gt; Int">decimalLowerBound</a> <span title="(x: Int)Int">+</span> <a href="#188139" title="A">a</a>.<a href="SeparationBound.scala.html#58084" title="=&gt; Int">decimalUpperBound</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="Int" id="188152">ub</a> = e.<a href="SeparationBound.scala.html#58084" title="=&gt; Int">decimalUpperBound</a>
          <span class="keyword">val</span> <a title="java.math.MathContext" id="188153">mc</a> = <span title="java.math.MathContext" class="keyword">new</span> <span title="java.math.MathContext">MathContext</span><span class="delimiter">(</span><a href="#188152" title="Int">ub</a> <span title="(x: Int)Int">+</span> <a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> // bits + 1 absolute digits.
          <span title="(bd: java.math.BigDecimal)scala.math.BigDecimal">BigDecimal</span><span class="delimiter">(</span><a href="#188150" title="BigDecimal">lhs</a>.<span title="=&gt; java.math.BigDecimal">bigDecimal</span>.<span title="(x$1: java.math.BigDecimal, x$2: java.math.MathContext)java.math.BigDecimal">divide</span><span class="delimiter">(</span><a href="#188151" title="BigDecimal">rhs</a>.<span title="=&gt; java.math.BigDecimal">bigDecimal</span>, <a href="#188153" title="java.math.MathContext">mc</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      <span class="keyword">case</span> e @ <a href="Expr.scala.html#186762" title="Option[(A, Int)]" id="214850">KRoot</a><span class="delimiter">(</span><a title="A" id="188253">a</a>, <a title="Int" id="188254">k</a><span class="delimiter">)</span> =&gt;
        <span class="keyword">import</span> spire.<a href="../../package.scala.html#7310" title="spire.implicits.type">implicits</a>._

        <span class="keyword">val</span> <a title="BigDecimal" id="188256">x</a> = <a href="#146774" title="(a: A, bits: Int)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188253" title="A">a</a>, <span title="(x: Int, y: Int)Int">max</span><span class="delimiter">(</span><a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <span title="Int(1)" class="int">1</span> <span title="(x: Int)Int">-</span> <a href="#188253" title="A">a</a>.<a href="SeparationBound.scala.html#58085" title="=&gt; Int">decimalLowerBound</a> <span title="(x: Int)Int">/</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span><span class="delimiter">)</span>

        // We need to use the upper bound to determine how many bits we need.
        
        <span class="keyword">val</span> <a title="Int" id="188257">ub</a> = e.<a href="SeparationBound.scala.html#58084" title="=&gt; Int">decimalUpperBound</a>
        
        <span title="scala.math.BigDecimal" class="keyword">if</span> <span class="delimiter">(</span><a href="#188256" title="BigDecimal">x</a> <span title="(that: scala.math.BigDecimal)Boolean">&lt;</span> <span title="implicit scala.math.BigDecimal.int2bigDecimal : (i: Int)scala.math.BigDecimal" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#188254" title="Int">k</a> <span title="(x: Int)Int">%</span> <span title="Int(2)" class="int">2</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#188253" title="A">a</a>.<a href="RealLike.scala.html#58060" title="=&gt; spire.algebra.Sign">sign</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../algebra/Sign.scala.html#10941" title="spire.algebra.Zero.type">Zero</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="(i: Int)scala.math.BigDecimal">BigDecimal</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="../../algebra/NRoot.scala.html#10587" title="spire.algebra.NRoot.type">NRoot</a>.<a href="../../algebra/NRoot.scala.html#55705" title="(a: BigDecimal, k: Int, ctxt: java.math.MathContext)BigDecimal">nroot</a><span class="delimiter">(</span><a href="#188256" title="BigDecimal">x</a>, <a href="#188254" title="Int">k</a>, <span title="java.math.MathContext" class="keyword">new</span> <span title="java.math.MathContext">MathContext</span><span class="delimiter">(</span><a href="#188257" title="Int">ub</a> <span title="(x: Int)Int">+</span> <a href="#187900" title="Int">bits</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[A &lt;: spire.math.real.RealLike[A] with spire.math.real.SeparationBound[A]](implicit evidence$3: spire.math.real.Coexpr[A])spire.math.real.BigDecimalApproximations.Relative[A]" id="146862">Relative</a><span class="delimiter">[</span><a title=" &lt;: spire.math.real.RealLike[A] with spire.math.real.SeparationBound[A]" id="84853">A</a> &lt;: RealLike<span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="keyword">with</span> SeparationBound<span class="delimiter">[</span>A<span class="delimiter">]</span>: Coexpr<span class="delimiter">]</span> = <a href="#146862" title="spire.math.real.BigDecimalApproximations.Relative[A]" class="keyword">new</a> <a href="#84854" title="spire.math.real.BigDecimalApproximations.Relative[A]">Relative</a><span class="delimiter">[</span>A<span class="delimiter">]</span>


  <span class="keyword">class</span> <a title="class Relative[A &lt;: spire.math.real.RealLike[A] with spire.math.real.SeparationBound[A]] extends Object with spire.math.Approximation[A,java.math.MathContext,BigDecimal]" id="84854">Relative</a><span class="delimiter">[</span><a title=" &lt;: spire.math.real.RealLike[A] with spire.math.real.SeparationBound[A]" id="84855">A</a> &lt;: RealLike<span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="keyword">with</span> SeparationBound<span class="delimiter">[</span>A<span class="delimiter">]</span>: Coexpr<span class="delimiter">]</span>
  <span class="keyword">extends</span> <a href="../Approximation.scala.html#13739" title="spire.math.Approximation[A,java.math.MathContext,BigDecimal]">Approximation</a><span class="delimiter">[</span>A, MathContext, BigDecimal<span class="delimiter">]</span> <span class="delimiter">{</span>
    
    <span class="keyword">def</span> <a title="(n: A, mc: java.math.MathContext)BigDecimal" id="146868">apply</a><span class="delimiter">(</span><a title="A" id="188323">n</a>: <a href="#84855" title="A">A</a>, <a title="java.math.MathContext" id="188324">mc</a>: <span title="java.math.MathContext">MathContext</span><span class="delimiter">)</span>: <span title="BigDecimal">BigDecimal</span> = <a href="#188323" title="A">n</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="Expr.scala.html#186800" title="Option[(A, A)]" id="214875">Add</a><span class="delimiter">(</span><a title="A" id="188345">a</a>, <a title="A" id="188346">b</a><span class="delimiter">)</span> =&gt;
        <a href="#214871" title="(x: BigDecimal)BigDecimal" class="keyword">if</a> <span class="delimiter">(</span><a href="#188323" title="A">n</a>.<a href="RealLike.scala.html#58060" title="=&gt; spire.algebra.Sign">sign</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../algebra/Sign.scala.html#10941" title="spire.algebra.Zero.type">Zero</a><span class="delimiter">)</span> <span title="(i: Int)scala.math.BigDecimal">BigDecimal</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="java.math.BigDecimal" id="188360">lhs</a> = <a href="#146868" title="(n: A, mc: java.math.MathContext)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188345" title="A">a</a>, <a href="#84845" title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps">mc</a> <a href="#84845" title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps">+</a> <span title="Int(1)" class="int">1</span> <a href="#146787" title="(x: Int)java.math.MathContext">-</a> <a href="#188323" title="A">n</a>.<a href="SeparationBound.scala.html#58085" title="=&gt; Int">decimalLowerBound</a><span class="delimiter">)</span>.<span title="=&gt; java.math.BigDecimal">bigDecimal</span>
          <span class="keyword">val</span> <a title="java.math.BigDecimal" id="188361">rhs</a> = <a href="#146868" title="(n: A, mc: java.math.MathContext)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188346" title="A">b</a>, <a href="#84845" title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps">mc</a> <a href="#84845" title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps">+</a> <span title="Int(1)" class="int">1</span> <a href="#146787" title="(x: Int)java.math.MathContext">-</a> <a href="#188323" title="A">n</a>.<a href="SeparationBound.scala.html#58085" title="=&gt; Int">decimalLowerBound</a><span class="delimiter">)</span>.<span title="=&gt; java.math.BigDecimal">bigDecimal</span>
          <span title="(bd: java.math.BigDecimal)scala.math.BigDecimal">BigDecimal</span><span class="delimiter">(</span><a href="#188360" title="java.math.BigDecimal">lhs</a>.<span title="(x$1: java.math.BigDecimal, x$2: java.math.MathContext)java.math.BigDecimal">add</span><span class="delimiter">(</span><a href="#188361" title="java.math.BigDecimal">rhs</a>, <a href="#188324" title="java.math.MathContext">mc</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      
      <span class="keyword">case</span> <a href="Expr.scala.html#186826" title="Option[(A, A)]" id="214877">Sub</a><span class="delimiter">(</span><a title="A" id="188399">a</a>, <a title="A" id="188400">b</a><span class="delimiter">)</span> =&gt;
        <a href="#214871" title="(x: BigDecimal)BigDecimal" class="keyword">if</a> <span class="delimiter">(</span><a href="#188323" title="A">n</a>.<a href="RealLike.scala.html#58060" title="=&gt; spire.algebra.Sign">sign</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../algebra/Sign.scala.html#10941" title="spire.algebra.Zero.type">Zero</a><span class="delimiter">)</span> <span title="(i: Int)scala.math.BigDecimal">BigDecimal</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="java.math.BigDecimal" id="188414">lhs</a> = <a href="#146868" title="(n: A, mc: java.math.MathContext)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188399" title="A">a</a>, <a href="#84845" title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps">mc</a> <a href="#84845" title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps">+</a> <span title="Int(1)" class="int">1</span> <a href="#146787" title="(x: Int)java.math.MathContext">-</a> <a href="#188323" title="A">n</a>.<a href="SeparationBound.scala.html#58085" title="=&gt; Int">decimalLowerBound</a><span class="delimiter">)</span>.<span title="=&gt; java.math.BigDecimal">bigDecimal</span>
          <span class="keyword">val</span> <a title="java.math.BigDecimal" id="188415">rhs</a> = <a href="#146868" title="(n: A, mc: java.math.MathContext)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188400" title="A">b</a>, <a href="#84845" title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps">mc</a> <a href="#84845" title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps">+</a> <span title="Int(1)" class="int">1</span> <a href="#146787" title="(x: Int)java.math.MathContext">-</a> <a href="#188323" title="A">n</a>.<a href="SeparationBound.scala.html#58085" title="=&gt; Int">decimalLowerBound</a><span class="delimiter">)</span>.<span title="=&gt; java.math.BigDecimal">bigDecimal</span>
          <span title="(bd: java.math.BigDecimal)scala.math.BigDecimal">BigDecimal</span><span class="delimiter">(</span><a href="#188414" title="java.math.BigDecimal">lhs</a>.<span title="(x$1: java.math.BigDecimal, x$2: java.math.MathContext)java.math.BigDecimal">subtract</span><span class="delimiter">(</span><a href="#188415" title="java.math.BigDecimal">rhs</a>, <a href="#188324" title="java.math.MathContext">mc</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      <span class="keyword">case</span> <a href="Expr.scala.html#186852" title="Option[(A, A)]" id="214879">Mul</a><span class="delimiter">(</span><a title="A" id="188449">a</a>, <a title="A" id="188450">b</a><span class="delimiter">)</span> =&gt;

        // Implement heuristic for cost?
        
        <span class="keyword">val</span> <a title="java.math.BigDecimal" id="188451">lhs</a> = <a href="#146868" title="(n: A, mc: java.math.MathContext)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188449" title="A">a</a>, <a href="#84845" title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps">mc</a> <a href="#146786" title="(x: Int)java.math.MathContext">+</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="=&gt; java.math.BigDecimal">bigDecimal</span>
        <span class="keyword">val</span> <a title="java.math.BigDecimal" id="188452">rhs</a> = <a href="#146868" title="(n: A, mc: java.math.MathContext)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188450" title="A">b</a>, <a href="#84845" title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps">mc</a> <a href="#146786" title="(x: Int)java.math.MathContext">+</a> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span>.<span title="=&gt; java.math.BigDecimal">bigDecimal</span>
        <span title="(bd: java.math.BigDecimal)scala.math.BigDecimal">BigDecimal</span><span class="delimiter">(</span><a href="#188451" title="java.math.BigDecimal">lhs</a>.<span title="(x$1: java.math.BigDecimal, x$2: java.math.MathContext)java.math.BigDecimal">multiply</span><span class="delimiter">(</span><a href="#188452" title="java.math.BigDecimal">rhs</a>, <a href="#188324" title="java.math.MathContext">mc</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">case</span> <a href="Expr.scala.html#186878" title="Option[(A, A)]" id="214881">Div</a><span class="delimiter">(</span><a title="A" id="188482">a</a>, <a title="A" id="188483">b</a><span class="delimiter">)</span> =&gt;
        <span class="keyword">val</span> <a title="java.math.BigDecimal" id="188484">lhs</a> = <a href="#146868" title="(n: A, mc: java.math.MathContext)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188482" title="A">a</a>, <a href="#84845" title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps">mc</a> <a href="#146786" title="(x: Int)java.math.MathContext">+</a> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span>.<span title="=&gt; java.math.BigDecimal">bigDecimal</span>
        <span class="keyword">val</span> <a title="java.math.BigDecimal" id="188485">rhs</a> = <a href="#146868" title="(n: A, mc: java.math.MathContext)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188483" title="A">b</a>, <a href="#84845" title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps">mc</a> <a href="#146786" title="(x: Int)java.math.MathContext">+</a> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span>.<span title="=&gt; java.math.BigDecimal">bigDecimal</span>
        <span title="(bd: java.math.BigDecimal)scala.math.BigDecimal">BigDecimal</span><span class="delimiter">(</span><a href="#188484" title="java.math.BigDecimal">lhs</a>.<span title="(x$1: java.math.BigDecimal, x$2: java.math.MathContext)java.math.BigDecimal">divide</span><span class="delimiter">(</span><a href="#188485" title="java.math.BigDecimal">rhs</a>, <a href="#84845" title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps">mc</a> <a href="#146786" title="(x: Int)java.math.MathContext">+</a> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">case</span> <a href="Expr.scala.html#186904" title="Option[A]" id="214883">Neg</a><span class="delimiter">(</span><a title="A" id="188520">a</a><span class="delimiter">)</span> =&gt;
        <a href="#214871" title="(x: BigDecimal)BigDecimal">-</a><a href="#146868" title="(n: A, mc: java.math.MathContext)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188520" title="A">a</a>, <a href="#188324" title="java.math.MathContext">mc</a><span class="delimiter">)</span>

      <span class="keyword">case</span> <a href="Expr.scala.html#186762" title="Option[(A, Int)]" id="214885">KRoot</a><span class="delimiter">(</span><a title="A" id="188534">a</a>, <a title="Int" id="188535">k</a><span class="delimiter">)</span> =&gt; <a href="#214871" title="(x: BigDecimal)BigDecimal" class="delimiter">{</a>
        <span class="keyword">import</span> spire.<a href="../../package.scala.html#7310" title="spire.implicits.type">implicits</a>._

        <span class="keyword">val</span> <a title="java.math.MathContext" id="188537">ctxt</a> = <a href="#84845" title="implicit spire.math.real.BigDecimalApproximations.mathContextOps : (omc: java.math.MathContext)spire.math.real.BigDecimalApproximations.MathContextOps">mc</a> <a href="#146786" title="(x: Int)java.math.MathContext">+</a> <span title="Int(1)" class="int">1</span>
        <span class="keyword">val</span> <a title="BigDecimal" id="188538">sub</a> = <a href="#146868" title="(n: A, mc: java.math.MathContext)BigDecimal">apply</a><span class="delimiter">(</span><a href="#188534" title="A">a</a>, <a href="#188537" title="java.math.MathContext">ctxt</a><span class="delimiter">)</span>
        <a href="../../algebra/NRoot.scala.html#10587" title="spire.algebra.NRoot.type">NRoot</a>.<a href="../../algebra/NRoot.scala.html#55705" title="(a: BigDecimal, k: Int, ctxt: java.math.MathContext)BigDecimal">nroot</a><span class="delimiter">(</span><a href="#188538" title="BigDecimal">sub</a>, <a href="#188535" title="Int">k</a>, <a href="#188537" title="java.math.MathContext">ctxt</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">case</span> <a href="Expr.scala.html#186706" title="Option[Int]" id="214887">IntLit</a><span class="delimiter">(</span><a title="Int" id="188566">n</a><span class="delimiter">)</span> =&gt; <span title="(i: Int, mc: java.math.MathContext)scala.math.BigDecimal">BigDecimal</span><a href="#214871" title="(x: BigDecimal)BigDecimal" class="delimiter">(</a><a href="#188566" title="Int">n</a>, <a href="#188324" title="java.math.MathContext">mc</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="Expr.scala.html#186730" title="Option[BigInt]" id="214889">BigIntLit</a><span class="delimiter">(</span><a title="BigInt" id="188588">n</a><span class="delimiter">)</span> =&gt; <span title="(x: scala.math.BigInt, mc: java.math.MathContext)scala.math.BigDecimal">BigDecimal</span><a href="#214871" title="(x: BigDecimal)BigDecimal" class="delimiter">(</a><a href="#188588" title="BigInt">n</a>, <a href="#188324" title="java.math.MathContext">mc</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>