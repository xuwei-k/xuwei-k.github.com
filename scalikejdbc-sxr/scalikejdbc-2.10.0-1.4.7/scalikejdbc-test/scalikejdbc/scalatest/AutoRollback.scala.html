<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scalikejdbc-test/scalikejdbc/scalatest/AutoRollback.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scalikejdbc.scalatest

<span class="keyword">import</span> org.scalatest.fixture.Suite
<span class="keyword">import</span> scalikejdbc._

/**
 * AutoRollback for ScalaTest
 *
 * {{{
 * import org.scalatest.fixture.FlatSpec
 * class MemberSpec extends FlatSpec with AutoRollback {
 *   describe of &quot;Member&quot;
 *   it should &quot;create a new record&quot; in { implicit session =&gt;
 *     Member.create(1, &quot;Alice&quot;)
 *     Member.find(1).isDefined should be(true)
 *   }
 * }
 * class LegacyAccountSpec extends FlatSpec with AutoRollback {
 *   override def db = NamedDB('db2).toDB
 *   override def fixture(implicit session: DBSession) {
 *     SQL(&quot;insert into legacy_accounts values ...&quot;).update.apply()
 *   }
 *
 *   it should &quot;create a new record&quot; in { implicit session =?
 *     LegacyAccount.create(2, &quot;Bob&quot;)
 *     LegacyAccount.find(2).isDefined should be(true)
 *   }
 * }
 * }}}
 */
<span class="keyword">trait</span> <a title="trait AutoRollback extends AnyRef" id="9167">AutoRollback</a> <span title="Unit" class="delimiter">{</span> self: Suite =&gt;

  <span class="keyword">type</span> <a title="scalikejdbc.DBSession" id="44894">FixtureParam</a> = <a href="../../../scalikejdbc/scalikejdbc/DBSession.scala.html#7794" title="scalikejdbc.DBSession">DBSession</a>

  /**
   * Creates a [[scalikejdbc.DB]] instance.
   * @return DB instance
   */
  <span class="keyword">def</span> <a title="()scalikejdbc.DB" id="44895">db</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../../scalikejdbc/scalikejdbc/DB.scala.html#7869" title="scalikejdbc.DB">DB</a> = <a href="../../../scalikejdbc/scalikejdbc/DB.scala.html#33128" title="(conn: java.sql.Connection)scalikejdbc.DB">DB</a><span class="delimiter">(</span><a href="../../../scalikejdbc/scalikejdbc/ConnectionPool.scala.html#8341" title="scalikejdbc.ConnectionPool.type">ConnectionPool</a>.<a href="../../../scalikejdbc/scalikejdbc/ConnectionPool.scala.html#13339" title="(name: Any)java.sql.Connection">borrow</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

  /**
   * Prepares database for the test.
   * @param session db session implicitly
   */
  <span class="keyword">def</span> <a title="(implicit session: scalikejdbc.DBSession)Unit" id="44896">fixture</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="scalikejdbc.DBSession" id="46074">session</a>: <a href="../../../scalikejdbc/scalikejdbc/DBSession.scala.html#7794" title="scalikejdbc.DBSession">DBSession</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>

  /**
   * Provides transactional block
   * @param test one arg test
   */
  <span class="keyword">def</span> <a title="(test: AutoRollback.this.OneArgTest)Unit" id="44897">withFixture</a><span class="delimiter">(</span><a title="AutoRollback.this.OneArgTest" id="46075">test</a>: <span title="AutoRollback.this.OneArgTest">OneArgTest</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../../../scalikejdbc/scalikejdbc/package.scala.html#9619" title="(resource: scalikejdbc.DB)(f: scalikejdbc.DB =&gt; Unit)Unit">using</a><span class="delimiter">(</span><a href="#44895" title="()scalikejdbc.DB">db</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="scalikejdbc.DB" id="46097">db</a> =&gt;
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#46097" title="scalikejdbc.DB">db</a>.<a href="../../../scalikejdbc/scalikejdbc/DB.scala.html#45296" title="()Unit">begin</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#46097" title="scalikejdbc.DB">db</a>.<a href="../../../scalikejdbc/scalikejdbc/DB.scala.html#45316" title="(execution: scalikejdbc.DBSession =&gt; Unit)Unit">withinTx</a> <span class="delimiter">{</span> <span class="keyword">implicit</span> <a title="scalikejdbc.DBSession" id="46106">session</a> =&gt;
          <a href="#44896" title="(implicit session: scalikejdbc.DBSession)Unit">fixture</a><span class="delimiter">(</span><a href="#46106" title="scalikejdbc.DBSession">session</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#46075" title="(fixture: AutoRollback.this.FixtureParam)Unit">test</a><span class="delimiter">(</span><a href="#46097" title="scalikejdbc.DB">db</a>.<a href="../../../scalikejdbc/scalikejdbc/DB.scala.html#45315" title="(tx: scalikejdbc.Tx)scalikejdbc.DBSession">withinTxSession</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
        <a href="#46097" title="scalikejdbc.DB">db</a>.<a href="../../../scalikejdbc/scalikejdbc/DB.scala.html#45300" title="()Unit">rollbackIfActive</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>