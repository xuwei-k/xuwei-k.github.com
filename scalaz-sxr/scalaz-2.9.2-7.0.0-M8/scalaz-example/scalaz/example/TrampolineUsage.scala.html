<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scalaz-example/scalaz/example/TrampolineUsage.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scalaz.example

<span class="keyword">object</span> <a title="object scalaz.example.TrampolineUsage" id="34658">TrampolineUsage</a> <span title="ScalaObject" class="keyword">extends</span> <span title="App">App</span> <span class="delimiter">{</span>

  <span class="keyword">import</span> scalaz._, <a href="../../../scalaz-core/scalaz/Scalaz.scala.html#20701" title="object scalaz.Scalaz">Scalaz</a>._, <a href="../../../scalaz-core/scalaz/Free.scala.html#23599" title="object scalaz.Free">Free</a>._

  <span class="keyword">def</span> <a title="[F[+_], T](xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]" id="683864">quickSort</a><span class="delimiter">[</span><a title="[+_]&gt;: Nothing &lt;: Any" id="682663">F</a><span class="delimiter">[</span>+ <a title="&gt;: Nothing &lt;: Any" id="683865">_</a><span class="delimiter">]</span> : Applicative, <a title="&gt;: Nothing &lt;: Any" id="682664">T</a>: Order<span class="delimiter">]</span><span class="delimiter">(</span><a title="List[T]" id="683862">xs</a>: <span title="List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../scalaz-core/scalaz/Free.scala.html#23598" title="scalaz.Free[F,List[T]]">Free</a><span class="delimiter">[</span>F, List<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#683862" title="List[T]">xs</a> <span title="scalaz.Free[F,List[T]]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="scalaz.Free[F,scala.collection.immutable.Nil.type]">Nil</span> =&gt;
        <a href="../../../scalaz-core/scalaz/Free.scala.html#54389" title="(value: =&gt; scala.collection.immutable.Nil.type)(implicit S: scalaz.Applicative[F])scalaz.Free[F,scala.collection.immutable.Nil.type]">return_</a> <a href="#683864" title="scalaz.Applicative[F]" class="delimiter">{</a>
          <span title="object Nil">Nil</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <a title="scalaz.Free[F,List[T]]" id="684300">x</a> :: <a title="List[T]" id="684301">tail</a> =&gt;
        <a href="../../../scalaz-core/scalaz/Free.scala.html#54394" title="(value: =&gt; scalaz.Free[F,List[T]])(implicit S: scalaz.Applicative[F])scalaz.Free[F,List[T]]">suspend</a> <a href="#683864" title="scalaz.Applicative[F]" class="delimiter">{</a>
          <span class="keyword">val</span> <a href="#684311" title="(List[T], List[T])" class="delimiter">(</a><a href="#684310" title="List[T]" id="684311">left</a>, <a href="#684310" title="List[T]" id="684312">right</a><span class="delimiter">)</span> = <a href="#684301" title="List[T]">tail</a>.<span title="(p: T =&gt; Boolean)(List[T], List[T])">partition</span><span title="(List[T], List[T]) @unchecked" class="delimiter">(</span><a href="../../../scalaz-core/scalaz/syntax/OrderSyntax.scala.html#55066" title="(v: T)(implicit F0: scalaz.Order[T])java.lang.Object with scalaz.syntax.OrderOps[T]">_</a> <a href="../../../scalaz-core/scalaz/syntax/OrderSyntax.scala.html#155511" title="(other: T)Boolean">&lt;</a> <a href="#684300" title="T">x</a><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">{</span>
            <a title="List[T]" id="685987">ls</a> &lt;- <a href="#683864" title="[F[+_], T](xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]">quickSort</a><span title="(xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]" class="delimiter">[</span><a href="#682663" title="F">F</a>, <a href="#682664" title="T">T</a><span class="delimiter">]</span><a href="../../../scalaz-core/scalaz/Free.scala.html#115540" title="(f: List[T] =&gt; scalaz.Free[F,List[T]])scalaz.Free[F,List[T]]" class="delimiter">(</a><a href="#684311" title="List[T]">left</a><span class="delimiter">)</span>
            <a title="List[T]" id="686708">rs</a> &lt;- <a href="#683864" title="[F[+_], T](xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]">quickSort</a><span title="(xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]" class="delimiter">[</span><a href="#682663" title="F">F</a>, <a href="#682664" title="T">T</a><span class="delimiter">]</span><a href="../../../scalaz-core/scalaz/Free.scala.html#115534" title="(f: List[T] =&gt; List[T])scalaz.Free[F,List[T]]" class="delimiter">(</a><a href="#684312" title="List[T]">right</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#685987" title="List[T]">ls</a> <a href="#686709" title="(prefix: List[T])List[T]">:::</a> <span class="delimiter">(</span><a href="#684300" title="T">x</a> <a href="#686710" title="(x: T)List[T]">::</a> <a href="#686708" title="List[T]">rs</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[F[+_], T](xs: List[T])(implicit evidence$3: scalaz.Applicative[F], implicit evidence$4: scalaz.Comonad[F], implicit evidence$5: scalaz.Order[T])List[T]" id="687123">runQuickSort</a><span class="delimiter">[</span><a title="[+_]&gt;: Nothing &lt;: Any" id="682668">F</a><span class="delimiter">[</span>+ <a title="&gt;: Nothing &lt;: Any" id="687125">_</a><span class="delimiter">]</span> : Applicative : Comonad, <a title="&gt;: Nothing &lt;: Any" id="682669">T</a>: Order<span class="delimiter">]</span><span class="delimiter">(</span><a title="List[T]" id="687120">xs</a>: <span title="List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span> =
    <a href="#683864" title="[F[+_], T](xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]">quickSort</a><span title="(xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]" class="delimiter">[</span><a href="#682668" title="F">F</a>, <a href="#682669" title="T">T</a><span class="delimiter">]</span><a href="#687123" title="scalaz.Applicative[F]" class="delimiter">(</a><a href="#687120" title="List[T]">xs</a><span class="delimiter">)</span>.<a href="../../../scalaz-core/scalaz/Free.scala.html#115563" title="(f: F[scalaz.Free[F,List[T]]] =&gt; scalaz.Free[F,List[T]])List[T]">go</a><span class="delimiter">(</span><a title="F[scalaz.Free[F,List[T]]]" id="687854">f</a> =&gt; <a href="../../../scalaz-core/scalaz/Comonad.scala.html#144277" title="[F[_]](implicit F: scalaz.Comonad[F])scalaz.Comonad[F]">Comonad</a><a href="#687123" title="(implicit F: scalaz.Comonad[F])scalaz.Comonad[F]" class="delimiter">[</a><a href="#682668" title="F">F</a><span class="delimiter">]</span>.<a href="../../../scalaz-core/scalaz/Comonad.scala.html#44920" title="(p: F[scalaz.Free[F,List[T]]])scalaz.Free[F,List[T]]">copoint</a><span class="delimiter">(</span><a href="#687854" title="F[scalaz.Free[F,List[T]]]">f</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="List[Int]" id="682670">xs</a> = <span title="object List">List</span>.<span title="(n: Int)(elem: =&gt; Int)List[Int]">fill</span><span class="delimiter">(</span><span title="Int(32)" class="int">32</span><span class="delimiter">)</span><span class="delimiter">(</span>util.<span title="object scala.util.Random">Random</span>.<span title="()Int">nextInt</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="delimiter">{</span>
    <span class="comment">// Trampoline is Free[Function0, A].</span>

    <span class="comment">// use the heap</span>
    <span class="keyword">val</span> <a title="List[Int]" id="688172">sorted</a> = <a href="#687123" title="[F[+_], T](xs: List[T])(implicit evidence$3: scalaz.Applicative[F], implicit evidence$4: scalaz.Comonad[F], implicit evidence$5: scalaz.Order[T])List[T]">runQuickSort</a><span title="(xs: List[Int])(implicit evidence$3: scalaz.Applicative[Function0], implicit evidence$4: scalaz.Comonad[Function0], implicit evidence$5: scalaz.Order[Int])List[Int]" class="delimiter">[</span><span title="Function0">Function0</span>, <span title="Int">Int</span><span class="delimiter">]</span><a href="../../../scalaz-core/scalaz/std/Function.scala.html#54464" title="function0Instance extends java.lang.Object with scalaz.Traverse[Function0] with scalaz.Monad[Function0] with scalaz.Comonad[Function0] with scalaz.Distributive[Function0]" class="delimiter">(</a><a href="#682670" title="=&gt; List[Int]">xs</a><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#688172" title="List[Int]">sorted</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a href="#688174" title="(Int, List[Int])" class="delimiter">(</a><a href="#688173" title="Int" id="688174">steps</a>, <a href="#688173" title="List[Int]" id="688175">sorted1</a><span class="delimiter">)</span> = <a href="#683864" title="[F[+_], T](xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]">quickSort</a><span title="(xs: List[Int])(implicit evidence$1: scalaz.Applicative[Function0], implicit evidence$2: scalaz.Order[Int])scalaz.Free[Function0,List[Int]]" class="delimiter">[</span><span title="Function0">Function0</span>, <span title="Int">Int</span><span class="delimiter">]</span><a href="../../../scalaz-core/scalaz/std/Function.scala.html#54464" title="function0Instance extends java.lang.Object with scalaz.Traverse[Function0] with scalaz.Monad[Function0] with scalaz.Comonad[Function0] with scalaz.Distributive[Function0]" class="delimiter">(</a><a href="#682670" title="=&gt; List[Int]">xs</a><span class="delimiter">)</span>.<a href="../../../scalaz-core/scalaz/Free.scala.html#115566" title="(b: Int)(f: (Int, () =&gt; scalaz.Free[Function0,List[Int]]) =&gt; (Int, scalaz.Free[Function0,List[Int]]))(Int, List[Int])">foldRun</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span title="(Int, List[Int]) @unchecked" class="delimiter">(</span><span class="delimiter">(</span><a title="Int" id="689937">i</a>, <a title="() =&gt; scalaz.Free[Function0,List[Int]]" id="689938">f</a><span class="delimiter">)</span> =&gt; <span title="(_1: Int, _2: scalaz.Free[Function0,List[Int]])(Int, scalaz.Free[Function0,List[Int]])" class="delimiter">(</span><a href="#689937" title="Int">i</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="#689938" title="()scalaz.Free[Function0,List[Int]]">f</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;sort using heap took %d steps&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#688174" title="Int">steps</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="delimiter">{</span>
    <span class="comment">// Use the stack.</span>
    <span class="keyword">val</span> <a title="List[Int]" id="694904">sorted</a> = <a href="#687123" title="[F[+_], T](xs: List[T])(implicit evidence$3: scalaz.Applicative[F], implicit evidence$4: scalaz.Comonad[F], implicit evidence$5: scalaz.Order[T])List[T]">runQuickSort</a><span title="(xs: List[Int])(implicit evidence$3: scalaz.Applicative[scalaz.Scalaz.Id], implicit evidence$4: scalaz.Comonad[scalaz.Scalaz.Id], implicit evidence$5: scalaz.Order[Int])List[Int]" class="delimiter">[</span><a href="../../../scalaz-core/scalaz/Id.scala.html#43732" title="scalaz.Scalaz.Id">Id</a>, <span title="Int">Int</span><span class="delimiter">]</span><a href="../../../scalaz-core/scalaz/package.scala.html#40348" title="=&gt; scalaz.Traverse1[scalaz.Id.Id] with scalaz.Each[scalaz.Id.Id] with scalaz.Monad[scalaz.Id.Id] with scalaz.Comonad[scalaz.Id.Id] with scalaz.Cojoin[scalaz.Id.Id] with scalaz.Distributive[scalaz.Id.Id] with scalaz.Zip[scalaz.Id.Id] with scalaz.Unzip[scalaz.Id.Id] with scalaz.Cozip[scalaz.Id.Id]" class="delimiter">(</a><a href="#682670" title="=&gt; List[Int]">xs</a><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#694904" title="List[Int]">sorted</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">import</span> scalaz.concurrent._
  <span class="keyword">import</span> annotation.unchecked.uncheckedVariance
  <span class="keyword">type</span> <a title="[+A]scalaz.concurrent.Promise[A @scala.annotation.unchecked.uncheckedVariance]" id="682674">PromiseCov</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="682675">A</a><span class="delimiter">]</span> = <a href="../../../scalaz-concurrent/scalaz/concurrent/Promise.scala.html#25703" title="scalaz.concurrent.Promise[A @scala.annotation.unchecked.uncheckedVariance]">Promise</a><span class="delimiter">[</span>A @uncheckedVariance<span class="delimiter">]</span>

  <span class="delimiter">{</span>
    <span class="comment">// Run in parallel.</span>
    <span class="keyword">val</span> <a title="List[Int]" id="695950">sorted</a> = <a href="#687123" title="[F[+_], T](xs: List[T])(implicit evidence$3: scalaz.Applicative[F], implicit evidence$4: scalaz.Comonad[F], implicit evidence$5: scalaz.Order[T])List[T]">runQuickSort</a><span title="(xs: List[Int])(implicit evidence$3: scalaz.Applicative[scalaz.example.TrampolineUsage.PromiseCov], implicit evidence$4: scalaz.Comonad[scalaz.example.TrampolineUsage.PromiseCov], implicit evidence$5: scalaz.Order[Int])List[Int]" class="delimiter">[</span><a href="../../../scalaz-concurrent/scalaz/concurrent/Promise.scala.html#25703" title="scalaz.example.TrampolineUsage.PromiseCov">PromiseCov</a>, <span title="Int">Int</span><span class="delimiter">]</span><a href="../../../scalaz-concurrent/scalaz/concurrent/Promise.scala.html#57874" title="implicit scalaz.concurrent.PromiseInstances.promiseInstance : (implicit s: scalaz.concurrent.Strategy)java.lang.Object with scalaz.Traverse[scalaz.concurrent.Promise] with scalaz.Monad[scalaz.concurrent.Promise] with scalaz.Comonad[scalaz.concurrent.Promise]" class="delimiter">(</a><a href="#682670" title="=&gt; List[Int]">xs</a><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#695950" title="List[Int]">sorted</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="comment">/**Run using `F1` as a binding for lists longer than `threshold`, and `F2` otherwise. */</span>
  <span class="keyword">def</span> <a title="[F[+_], F2[+_], T](xs: List[T], nat: scalaz.package.~&gt;[F2,F], threshold: Int)(implicit evidence$6: scalaz.Applicative[F], implicit evidence$7: scalaz.Applicative[F2], implicit evidence$8: scalaz.Order[T])scalaz.Free[F,List[T]]" id="697948">quickSort2</a><span class="delimiter">[</span><a title="[+_]&gt;: Nothing &lt;: Any" id="682680">F</a><span class="delimiter">[</span>+ <a title="&gt;: Nothing &lt;: Any" id="697949">_</a><span class="delimiter">]</span> : Applicative, <a title="[+_]&gt;: Nothing &lt;: Any" id="682681">F2</a><span class="delimiter">[</span>+ <a title="&gt;: Nothing &lt;: Any" id="697951">_</a><span class="delimiter">]</span> : Applicative, <a title="&gt;: Nothing &lt;: Any" id="682682">T</a>: Order<span class="delimiter">]</span><span class="delimiter">(</span><a title="List[T]" id="697943">xs</a>: <span title="List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="scalaz.package.~&gt;[F2,F]" id="697944">nat</a>: F2 <a href="../../../scalaz-core/scalaz/NaturalTransformation.scala.html#17343" title="scalaz.package.~&gt;[F2,F]">~&gt;</a> F, <a title="Int" id="697945">threshold</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="../../../scalaz-core/scalaz/Free.scala.html#23598" title="scalaz.Free[F,List[T]]">Free</a><span class="delimiter">[</span>F, List<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(as: List[T])scalaz.Free[F,List[T]]" id="697958">qs</a><span class="delimiter">(</span><a title="List[T]" id="697959">as</a>: <span title="List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../scalaz-core/scalaz/Free.scala.html#23598" title="scalaz.Free[F,List[T]]">Free</a><span class="delimiter">[</span>F, List<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span> =
      <span title="scalaz.Free[F,List[T]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#697959" title="List[T]">as</a>.<span title="(len: Int)Int">lengthCompare</span><span class="delimiter">(</span><a href="#697945" title="Int">threshold</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="scalaz.Free[F2,List[T]]" id="697964">free</a>: <a href="../../../scalaz-core/scalaz/Free.scala.html#23598" title="scalaz.Free[F2,List[T]]">Free</a><span class="delimiter">[</span>F2, List<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#697948" title="[F[+_], F2[+_], T](xs: List[T], nat: scalaz.package.~&gt;[F2,F], threshold: Int)(implicit evidence$6: scalaz.Applicative[F], implicit evidence$7: scalaz.Applicative[F2], implicit evidence$8: scalaz.Order[T])scalaz.Free[F,List[T]]">quickSort2</a><span title="(xs: List[T], nat: scalaz.package.~&gt;[F2,F2], threshold: Int)(implicit evidence$6: scalaz.Applicative[F2], implicit evidence$7: scalaz.Applicative[F2], implicit evidence$8: scalaz.Order[T])scalaz.Free[F2,List[T]]" class="delimiter">[</span><a href="#682681" title="F2">F2</a>, <a href="#682681" title="F2">F2</a>, <a href="#682682" title="T">T</a><span class="delimiter">]</span><a href="#697948" title="scalaz.Applicative[F2]" class="delimiter">(</a><a href="#697959" title="List[T]">as</a>, <a href="../../../scalaz-core/scalaz/NaturalTransformation.scala.html#17344" title="object scalaz.NaturalTransformation">NaturalTransformation</a>.<a href="../../../scalaz-core/scalaz/NaturalTransformation.scala.html#393970" title="[F[_]]=&gt; java.lang.Object with scalaz.package.~&gt;[F,F]">refl</a><span title="refl extends java.lang.Object with scalaz.package.~&gt;[F2,F2]" class="delimiter">[</span><a href="#682681" title="F2">F2</a><span class="delimiter">]</span>, <a href="#697945" title="Int">threshold</a><span class="delimiter">)</span>
        <a href="#697964" title="scalaz.Free[F2,List[T]]">free</a>.<a href="../../../scalaz-core/scalaz/Free.scala.html#115544" title="(f: scalaz.package.~&gt;[F2,F])(implicit evidence$4: scalaz.Functor[F])scalaz.Free[F,List[T]]">mapSuspension</a><a href="#697948" title="scalaz.Applicative[F]" class="delimiter">(</a><a href="#697944" title="scalaz.package.~&gt;[F2,F]">nat</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#697948" title="[F[+_], F2[+_], T](xs: List[T], nat: scalaz.package.~&gt;[F2,F], threshold: Int)(implicit evidence$6: scalaz.Applicative[F], implicit evidence$7: scalaz.Applicative[F2], implicit evidence$8: scalaz.Order[T])scalaz.Free[F,List[T]]">quickSort2</a><span title="(xs: List[T], nat: scalaz.package.~&gt;[F2,F], threshold: Int)(implicit evidence$6: scalaz.Applicative[F], implicit evidence$7: scalaz.Applicative[F2], implicit evidence$8: scalaz.Order[T])scalaz.Free[F,List[T]]" class="delimiter">[</span><a href="#682680" title="F">F</a>, <a href="#682681" title="F2">F2</a>, <a href="#682682" title="T">T</a><span class="delimiter">]</span><a href="#697948" title="scalaz.Applicative[F]" class="delimiter">(</a><a href="#697959" title="List[T]">as</a>, <a href="#697944" title="scalaz.package.~&gt;[F2,F]">nat</a>, <a href="#697945" title="Int">threshold</a><span class="delimiter">)</span>

    <a href="#697943" title="List[T]">xs</a> <span title="scalaz.Free[F,List[T]]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="scalaz.Free[F,scala.collection.immutable.Nil.type]">Nil</span> =&gt;
        <a href="../../../scalaz-core/scalaz/Free.scala.html#54389" title="(value: =&gt; scala.collection.immutable.Nil.type)(implicit S: scalaz.Applicative[F])scalaz.Free[F,scala.collection.immutable.Nil.type]">return_</a> <a href="#697948" title="scalaz.Applicative[F]" class="delimiter">{</a>
          <span title="object Nil">Nil</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <a title="scalaz.Free[F,List[T]]" id="701031">x</a> :: <a title="List[T]" id="701032">tail</a> =&gt;
        <a href="../../../scalaz-core/scalaz/Free.scala.html#54394" title="(value: =&gt; scalaz.Free[F,List[T]])(implicit S: scalaz.Applicative[F])scalaz.Free[F,List[T]]">suspend</a> <a href="#697948" title="scalaz.Applicative[F]" class="delimiter">{</a>
          <span class="keyword">val</span> <a href="#701042" title="(List[T], List[T])" class="delimiter">(</a><a href="#701041" title="List[T]" id="701042">left</a>, <a href="#701041" title="List[T]" id="701043">right</a><span class="delimiter">)</span> = <a href="#701032" title="List[T]">tail</a>.<span title="(p: T =&gt; Boolean)(List[T], List[T])">partition</span><span title="(List[T], List[T]) @unchecked" class="delimiter">(</span><a href="../../../scalaz-core/scalaz/syntax/OrderSyntax.scala.html#55066" title="(v: T)(implicit F0: scalaz.Order[T])java.lang.Object with scalaz.syntax.OrderOps[T]">_</a> <a href="../../../scalaz-core/scalaz/syntax/OrderSyntax.scala.html#155511" title="(other: T)Boolean">&lt;</a> <a href="#701031" title="T">x</a><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">{</span>
            <a title="List[T]" id="702002">ls</a> &lt;- <a href="#697958" title="(as: List[T])scalaz.Free[F,List[T]]">qs</a><a href="../../../scalaz-core/scalaz/Free.scala.html#115540" title="(f: List[T] =&gt; scalaz.Free[F,List[T]])scalaz.Free[F,List[T]]" class="delimiter">(</a><a href="#701042" title="List[T]">left</a><span class="delimiter">)</span>
            <a title="List[T]" id="702007">rs</a> &lt;- <a href="#697958" title="(as: List[T])scalaz.Free[F,List[T]]">qs</a><a href="../../../scalaz-core/scalaz/Free.scala.html#115534" title="(f: List[T] =&gt; List[T])scalaz.Free[F,List[T]]" class="delimiter">(</a><a href="#701043" title="List[T]">right</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#702002" title="List[T]">ls</a> <a href="#702008" title="(prefix: List[T])List[T]">:::</a> <span class="delimiter">(</span><a href="#701031" title="T">x</a> <a href="#702009" title="(x: T)List[T]">::</a> <a href="#702007" title="List[T]">rs</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[F[+_], F2[+_], T](xs: List[T], nat: scalaz.package.~&gt;[F2,F], threshold: Int)(implicit evidence$9: scalaz.Applicative[F], implicit evidence$10: scalaz.Comonad[F], implicit evidence$11: scalaz.Applicative[F2], implicit evidence$12: scalaz.Order[T])List[T]" id="702426">runQuickSort2</a><span class="delimiter">[</span><a title="[+_]&gt;: Nothing &lt;: Any" id="682687">F</a><span class="delimiter">[</span>+ <a title="&gt;: Nothing &lt;: Any" id="702429">_</a><span class="delimiter">]</span> : Applicative : Comonad, <a title="[+_]&gt;: Nothing &lt;: Any" id="682688">F2</a><span class="delimiter">[</span>+ <a title="&gt;: Nothing &lt;: Any" id="702428">_</a><span class="delimiter">]</span> : Applicative, <a title="&gt;: Nothing &lt;: Any" id="682689">T</a>: Order<span class="delimiter">]</span><span class="delimiter">(</span><a title="List[T]" id="702420">xs</a>: <span title="List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="scalaz.package.~&gt;[F2,F]" id="702421">nat</a>: F2 <a href="../../../scalaz-core/scalaz/NaturalTransformation.scala.html#17343" title="scalaz.package.~&gt;[F2,F]">~&gt;</a> F, <a title="Int" id="702422">threshold</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span> =
    <a href="#697948" title="[F[+_], F2[+_], T](xs: List[T], nat: scalaz.package.~&gt;[F2,F], threshold: Int)(implicit evidence$6: scalaz.Applicative[F], implicit evidence$7: scalaz.Applicative[F2], implicit evidence$8: scalaz.Order[T])scalaz.Free[F,List[T]]">quickSort2</a><span title="(xs: List[T], nat: scalaz.package.~&gt;[F2,F], threshold: Int)(implicit evidence$6: scalaz.Applicative[F], implicit evidence$7: scalaz.Applicative[F2], implicit evidence$8: scalaz.Order[T])scalaz.Free[F,List[T]]" class="delimiter">[</span><a href="#682687" title="F">F</a>, <a href="#682688" title="F2">F2</a>, <a href="#682689" title="T">T</a><span class="delimiter">]</span><a href="#702426" title="scalaz.Applicative[F]" class="delimiter">(</a><a href="#702420" title="List[T]">xs</a>, <a href="#702421" title="scalaz.package.~&gt;[F2,F]">nat</a>, <a href="#702422" title="Int">threshold</a><span class="delimiter">)</span>.<a href="../../../scalaz-core/scalaz/Free.scala.html#115563" title="(f: F[scalaz.Free[F,List[T]]] =&gt; scalaz.Free[F,List[T]])List[T]">go</a><span class="delimiter">(</span><a title="F[scalaz.Free[F,List[T]]]" id="703554">f</a> =&gt; <a href="../../../scalaz-core/scalaz/Comonad.scala.html#144277" title="[F[_]](implicit F: scalaz.Comonad[F])scalaz.Comonad[F]">Comonad</a><a href="#702426" title="(implicit F: scalaz.Comonad[F])scalaz.Comonad[F]" class="delimiter">[</a><a href="#682687" title="F">F</a><span class="delimiter">]</span>.<a href="../../../scalaz-core/scalaz/Comonad.scala.html#44920" title="(p: F[scalaz.Free[F,List[T]]])scalaz.Free[F,List[T]]">copoint</a><span class="delimiter">(</span><a href="#703554" title="F[scalaz.Free[F,List[T]]]">f</a><span class="delimiter">)</span><span class="delimiter">)</span>


  <span class="delimiter">{</span>
    <span class="comment">// mixed binding</span>
    <span class="keyword">val</span> <a title="promise2Id extends java.lang.Object with scalaz.package.~&gt;[scalaz.Scalaz.Id,scalaz.example.TrampolineUsage.PromiseCov]" id="703872">promise2Id</a> = <a href="#703874" title="java.lang.Object with scalaz.package.~&gt;[scalaz.Scalaz.Id,scalaz.example.TrampolineUsage.PromiseCov]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scalaz.package.~&gt;[scalaz.Scalaz.Id,scalaz.example.TrampolineUsage.PromiseCov]" id="703874" class="delimiter">(</a>Id <a href="../../../scalaz-core/scalaz/NaturalTransformation.scala.html#17343" title="scalaz.package.~&gt;[scalaz.Scalaz.Id,scalaz.example.TrampolineUsage.PromiseCov]">~&gt;</a> PromiseCov<span class="delimiter">)</span> <span class="delimiter">{</span> <span class="keyword">def</span> <a title="[A](a: A)scalaz.concurrent.Promise[A]" id="703876">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="703878">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A" id="703879">a</a>: <a href="#703878" title="A">A</a><span class="delimiter">)</span> = <a href="../../../scalaz-concurrent/scalaz/concurrent/Promise.scala.html#57853" title="(a: =&gt; A)(implicit s: scalaz.concurrent.Strategy)scalaz.concurrent.Promise[A]">Promise</a><a href="../../../scalaz-concurrent/scalaz/concurrent/Strategy.scala.html#59669" title="=&gt; scalaz.concurrent.Strategy" class="delimiter">(</a><a href="#703879" title="A">a</a><span class="delimiter">)</span><span class="delimiter">}</span>

    <span class="comment">// run in parallel for lists larger then 8 elements, and on the stack for lists smaller.</span>
    <span class="keyword">val</span> <a title="List[Int]" id="703873">sorted</a> = <a href="#702426" title="[F[+_], F2[+_], T](xs: List[T], nat: scalaz.package.~&gt;[F2,F], threshold: Int)(implicit evidence$9: scalaz.Applicative[F], implicit evidence$10: scalaz.Comonad[F], implicit evidence$11: scalaz.Applicative[F2], implicit evidence$12: scalaz.Order[T])List[T]">runQuickSort2</a><span title="(xs: List[Int], nat: scalaz.package.~&gt;[scalaz.Scalaz.Id,scalaz.example.TrampolineUsage.PromiseCov], threshold: Int)(implicit evidence$9: scalaz.Applicative[scalaz.example.TrampolineUsage.PromiseCov], implicit evidence$10: scalaz.Comonad[scalaz.example.TrampolineUsage.PromiseCov], implicit evidence$11: scalaz.Applicative[scalaz.Scalaz.Id], implicit evidence$12: scalaz.Order[Int])List[Int]" class="delimiter">[</span><a href="../../../scalaz-concurrent/scalaz/concurrent/Promise.scala.html#25703" title="scalaz.example.TrampolineUsage.PromiseCov">PromiseCov</a>, <a href="../../../scalaz-core/scalaz/Id.scala.html#43732" title="scalaz.Scalaz.Id">Id</a>, <span title="Int">Int</span><span class="delimiter">]</span><a href="../../../scalaz-concurrent/scalaz/concurrent/Promise.scala.html#57874" title="implicit scalaz.concurrent.PromiseInstances.promiseInstance : (implicit s: scalaz.concurrent.Strategy)java.lang.Object with scalaz.Traverse[scalaz.concurrent.Promise] with scalaz.Monad[scalaz.concurrent.Promise] with scalaz.Comonad[scalaz.concurrent.Promise]" class="delimiter">(</a><a href="#682670" title="=&gt; List[Int]">xs</a>, <a href="#703872" title="promise2Id extends java.lang.Object with scalaz.package.~&gt;[scalaz.Scalaz.Id,scalaz.example.TrampolineUsage.PromiseCov]">promise2Id</a>, <span title="Int(8)" class="int">8</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#703873" title="List[Int]">sorted</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">// Ackermann function. Blows the stack for very small inputs.</span>
  <span class="keyword">def</span> <a title="(m: Int, n: Int)Int" id="682690">ack</a><span class="delimiter">(</span><a title="Int" id="706619">m</a>: <span title="Int">Int</span>, <a title="Int" id="706620">n</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> =
    <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#706619" title="Int">m</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="#706620" title="Int">n</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>
    <span class="keyword">else</span> <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#706620" title="Int">n</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="#682690" title="(m: Int, n: Int)Int">ack</a><span class="delimiter">(</span><a href="#706619" title="Int">m</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#682690" title="(m: Int, n: Int)Int">ack</a><span class="delimiter">(</span><a href="#706619" title="Int">m</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>, <a href="#682690" title="(m: Int, n: Int)Int">ack</a><span class="delimiter">(</span><a href="#706619" title="Int">m</a>, <a href="#706620" title="Int">n</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">// Trampolined ackermann function. Never blows the stack, even for large inputs.</span>
  <span class="keyword">def</span> <a title="(m: Int, n: Int)scalaz.Free.Trampoline[Int]" id="682691">ackermann</a><span class="delimiter">(</span><a title="Int" id="720920">m</a>: <span title="Int">Int</span>, <a title="Int" id="720921">n</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="../../../scalaz-core/scalaz/Free.scala.html#23598" title="scalaz.Free.Trampoline[Int]">Trampoline</a><span class="delimiter">[</span>Int<span class="delimiter">]</span> =
    <span title="scalaz.Free.Trampoline[Int]" class="keyword">if</span> <span class="delimiter">(</span><a href="#720920" title="Int">m</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="../../../scalaz-core/scalaz/Free.scala.html#54389" title="(value: =&gt; Int)(implicit S: scalaz.Applicative[Function0])scalaz.Free[Function0,Int]">return_</a><a href="../../../scalaz-core/scalaz/std/Function.scala.html#54464" title="function0Instance extends java.lang.Object with scalaz.Traverse[Function0] with scalaz.Monad[Function0] with scalaz.Comonad[Function0] with scalaz.Distributive[Function0]" class="delimiter">(</a><a href="#720921" title="Int">n</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <span title="scalaz.Free.Trampoline[Int]" class="keyword">if</span> <span class="delimiter">(</span><a href="#720921" title="Int">n</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="../../../scalaz-core/scalaz/Free.scala.html#54394" title="(value: =&gt; scalaz.Free[Function0,Int])(implicit S: scalaz.Applicative[Function0])scalaz.Free[Function0,Int]">suspend</a><a href="../../../scalaz-core/scalaz/std/Function.scala.html#54464" title="function0Instance extends java.lang.Object with scalaz.Traverse[Function0] with scalaz.Monad[Function0] with scalaz.Comonad[Function0] with scalaz.Distributive[Function0]" class="delimiter">(</a><a href="#682691" title="(m: Int, n: Int)scalaz.Free.Trampoline[Int]">ackermann</a><span class="delimiter">(</span><a href="#720920" title="Int">m</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <span class="keyword">for</span> <span class="delimiter">{</span>
      <a title="Int" id="733130">a</a> &lt;- <a href="../../../scalaz-core/scalaz/Free.scala.html#54394" title="(value: =&gt; scalaz.Free[Function0,Int])(implicit S: scalaz.Applicative[Function0])scalaz.Free[Function0,Int]">suspend</a><a href="../../../scalaz-core/scalaz/Free.scala.html#115540" title="(f: Int =&gt; scalaz.Free[Function0,Int])scalaz.Free[Function0,Int]" class="delimiter">(</a><a href="#682691" title="(m: Int, n: Int)scalaz.Free.Trampoline[Int]">ackermann</a><span class="delimiter">(</span><a href="#720920" title="Int">m</a>, <a href="#720921" title="Int">n</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a title="Int" id="736832">b</a> &lt;- <a href="../../../scalaz-core/scalaz/Free.scala.html#54394" title="(value: =&gt; scalaz.Free[Function0,Int])(implicit S: scalaz.Applicative[Function0])scalaz.Free[Function0,Int]">suspend</a><a href="../../../scalaz-core/scalaz/Free.scala.html#115534" title="(f: Int =&gt; Int)scalaz.Free[Function0,Int]" class="delimiter">(</a><a href="#682691" title="(m: Int, n: Int)scalaz.Free.Trampoline[Int]">ackermann</a><span class="delimiter">(</span><a href="#720920" title="Int">m</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>, <a href="#733130" title="Int">a</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#736832" title="Int">b</a>


<span class="delimiter">}</span>

        </pre>
    </body>
</html>