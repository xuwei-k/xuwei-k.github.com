<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scalaz-example/scalaz/example/StateTUsage.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scalaz.example

<span class="keyword">import</span> scalaz._

<span class="keyword">object</span> <a title="object scalaz.example.StateTUsage" id="34817">StateTUsage</a> <span title="ScalaObject" class="keyword">extends</span> <span title="App">App</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="../../../scalaz-core/scalaz/package.scala.html#40402" title="object scalaz.package.StateT">StateT</a>._

  <span class="keyword">def</span> <a title="[M[+_]](implicit evidence$1: scalaz.Functor[M])Unit" id="656725">f</a><span class="delimiter">[</span><a title="[+_]&gt;: Nothing &lt;: Any" id="656719">M</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="656727">_</a><span class="delimiter">]</span>: Functor<span class="delimiter">]</span> <span class="delimiter">{</span>
    <a href="../../../scalaz-core/scalaz/Functor.scala.html#110480" title="[F[_]](implicit F: scalaz.Functor[F])scalaz.Functor[F]">Functor</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#140399" title="(implicit F: scalaz.Functor[[a]scalaz.IndexedStateT[M,Int,Int,a]])scalaz.Functor[[a]scalaz.IndexedStateT[M,Int,Int,a]]" class="delimiter">[</a><span class="delimiter">(</span><span class="delimiter">{</span><span class="keyword">type</span> l<span class="delimiter">[</span>a<span class="delimiter">]</span> = StateT<span class="delimiter">[</span>M, Int, a<span class="delimiter">]</span><span class="delimiter">}</span><span class="delimiter">)</span>#<a href="../../../scalaz-core/scalaz/StateT.scala.html#18774" title="[a]scalaz.IndexedStateT[M,Int,Int,a]">l</a><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[M[+_]](implicit evidence$2: scalaz.Monad[M])Unit" id="656802">m</a><span class="delimiter">[</span><a title="[+_]&gt;: Nothing &lt;: Any" id="656722">M</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="656804">_</a><span class="delimiter">]</span>: Monad<span class="delimiter">]</span> <span class="delimiter">{</span>
    <a href="../../../scalaz-core/scalaz/Applicative.scala.html#59317" title="[F[_]](implicit F: scalaz.Applicative[F])scalaz.Applicative[F]">Applicative</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#140407" title="(implicit F: scalaz.Applicative[[a]scalaz.IndexedStateT[M,Int,Int,a]])scalaz.Applicative[[a]scalaz.IndexedStateT[M,Int,Int,a]]" class="delimiter">[</a><span class="delimiter">(</span><span class="delimiter">{</span><span class="keyword">type</span> l<span class="delimiter">[</span>a<span class="delimiter">]</span> = StateT<span class="delimiter">[</span>M, Int, a<span class="delimiter">]</span><span class="delimiter">}</span><span class="delimiter">)</span>#<a href="../../../scalaz-core/scalaz/StateT.scala.html#18774" title="[a]scalaz.IndexedStateT[M,Int,Int,a]">l</a><span class="delimiter">]</span>
    <a href="../../../scalaz-core/scalaz/Monad.scala.html#254788" title="[F[_]](implicit F: scalaz.Monad[F])scalaz.Monad[F]">Monad</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#140407" title="(implicit F: scalaz.Monad[[a]scalaz.IndexedStateT[M,Int,Int,a]])scalaz.Monad[[a]scalaz.IndexedStateT[M,Int,Int,a]]" class="delimiter">[</a><span class="delimiter">(</span><span class="delimiter">{</span><span class="keyword">type</span> l<span class="delimiter">[</span>a<span class="delimiter">]</span> = StateT<span class="delimiter">[</span>M, Int, a<span class="delimiter">]</span><span class="delimiter">}</span><span class="delimiter">)</span>#<a href="../../../scalaz-core/scalaz/StateT.scala.html#18774" title="[a]scalaz.IndexedStateT[M,Int,Int,a]">l</a><span class="delimiter">]</span>
    <a href="../../../scalaz-core/scalaz/MonadState.scala.html#393728" title="[F[_,_], S](implicit F: scalaz.MonadState[F,S])scalaz.MonadState[F,S]">MonadState</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#140407" title="(implicit F: scalaz.MonadState[[s, a]scalaz.IndexedStateT[M,s,s,a],Int])scalaz.MonadState[[s, a]scalaz.IndexedStateT[M,s,s,a],Int]" class="delimiter">[</a><span class="delimiter">(</span><span class="delimiter">{</span><span class="keyword">type</span> f<span class="delimiter">[</span>s, a<span class="delimiter">]</span> = StateT<span class="delimiter">[</span>M, s, a<span class="delimiter">]</span><span class="delimiter">}</span><span class="delimiter">)</span>#<a href="../../../scalaz-core/scalaz/StateT.scala.html#18774" title="[s, a]scalaz.IndexedStateT[M,s,s,a]">f</a>, <span title="Int">Int</span><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="656723">state</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scalaz.package.State[String,Int]" id="656925">state</a>: <a href="../../../scalaz-core/scalaz/StateT.scala.html#18774" title="scalaz.package.State[String,Int]">State</a><span class="delimiter">[</span>String, Int<span class="delimiter">]</span> = <a href="../../../scalaz-core/scalaz/package.scala.html#86091" title="(f: java.lang.String =&gt; (java.lang.String, Int))scalaz.package.State[java.lang.String,Int]">State</a><span class="delimiter">(</span><span class="delimiter">(</span>x: <span title="String">String</span><span class="delimiter">)</span> =&gt; <span title="(_1: java.lang.String, _2: Int)(java.lang.String, Int)" class="delimiter">(</span><a href="#656931" title="String">x</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="Int(1)" class="int">1</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="656926">eval</a>: <span title="Int">Int</span> = <a href="#656925" title="scalaz.package.State[String,Int]">state</a>.<a href="../../../scalaz-core/scalaz/StateT.scala.html#86015" title="(initial: String)(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.Id.Id[Int]">eval</a><a href="../../../scalaz-core/scalaz/package.scala.html#40348" title="=&gt; scalaz.Traverse1[scalaz.Id.Id] with scalaz.Each[scalaz.Id.Id] with scalaz.Monad[scalaz.Id.Id] with scalaz.Comonad[scalaz.Id.Id] with scalaz.Cojoin[scalaz.Id.Id] with scalaz.Distributive[scalaz.Id.Id] with scalaz.Zip[scalaz.Id.Id] with scalaz.Unzip[scalaz.Id.Id] with scalaz.Cozip[scalaz.Id.Id]" class="delimiter">(</a><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
    <a href="#656925" title="scalaz.package.State[String,Int]">state</a>.<a href="../../../scalaz-core/scalaz/StateT.scala.html#86051" title="(f: Int =&gt; scalaz.IndexedStateT[scalaz.Id.Id,String,String,Int])(implicit F: scalaz.Bind[scalaz.Id.Id])scalaz.IndexedStateT[scalaz.Id.Id,String,String,Int]">flatMap</a><a href="../../../scalaz-core/scalaz/package.scala.html#40348" title="=&gt; scalaz.Traverse1[scalaz.Id.Id] with scalaz.Each[scalaz.Id.Id] with scalaz.Monad[scalaz.Id.Id] with scalaz.Comonad[scalaz.Id.Id] with scalaz.Cojoin[scalaz.Id.Id] with scalaz.Distributive[scalaz.Id.Id] with scalaz.Zip[scalaz.Id.Id] with scalaz.Unzip[scalaz.Id.Id] with scalaz.Cozip[scalaz.Id.Id]" class="delimiter">(</a><a title="Int" id="656954">_</a> =&gt; <a href="#656925" title="scalaz.package.State[String,Int]">state</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object scalaz.example.FibStateExample" id="34307">FibStateExample</a> <span title="ScalaObject" class="keyword">extends</span> <span title="App">App</span> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="scalaz.MonadState[[s, +a]scalaz.IndexedStateT[[+X]X,s,s,a],(Int, Int)]" id="656960">S</a> = scalaz.<a href="../../../scalaz-core/scalaz/package.scala.html#40402" title="object scalaz.package.StateT">StateT</a>.<a href="../../../scalaz-core/scalaz/StateT.scala.html#140417" title="[S]=&gt; scalaz.MonadState[[s, +a]scalaz.IndexedStateT[[+X]X,s,s,a],S]">stateMonad</a><span title="scalaz.MonadState[[s, +a]scalaz.IndexedStateT[[+X]X,s,s,a],(Int, Int)]" class="delimiter">[</span><span title="(Int, Int)" class="delimiter">(</span>Int, Int<span class="delimiter">)</span><span class="delimiter">]</span>
  <span class="keyword">import</span> <a href="#656960" title="=&gt; scalaz.MonadState[[s, +a]scalaz.IndexedStateT[[+X]X,s,s,a],(Int, Int)]">S</a>.<a href="../../../scalaz-core/scalaz/Monad.scala.html#44883" title="=&gt; java.lang.Object with scalaz.syntax.MonadSyntax[[x]scalaz.IndexedStateT[[+X]X,(Int, Int),(Int, Int),x]]">monadSyntax</a>._
  <span class="keyword">import</span> scalaz.<a href="../../../scalaz-core/scalaz/package.scala.html#40406" title="object scalaz.package.State">State</a>._
  <span class="keyword">import</span> scalaz.std.<a href="../../../scalaz-core/scalaz/std/List.scala.html#27759" title="object scalaz.std.list">list</a>._

  <span class="keyword">val</span> <a title="(Int, Int)" id="656965">initialState</a> = <span title="(_1: Int, _2: Int)(Int, Int)" class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <span class="delimiter">(</span>nextFib: <a href="../../../scalaz-core/scalaz/StateT.scala.html#18774" title="scalaz.package.State[(Int, Int),Int]">State</a><span class="delimiter">[</span><span class="delimiter">(</span>Int, Int<span class="delimiter">)</span>, Int<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="keyword">for</span> <span class="delimiter">{</span>
    <a title="(Int, Int)" id="657041">s</a> &lt;- <a href="../../../scalaz-core/scalaz/State.scala.html#55015" title="scalaz.package.State[(Int, Int),(Int, Int)]">init</a>:<a href="../../../scalaz-core/scalaz/StateT.scala.html#18774" title="scalaz.package.State[(Int, Int),(Int, Int)]">State</a><span class="delimiter">[</span><span class="delimiter">(</span>Int, Int<span class="delimiter">)</span>, <span class="delimiter">(</span>Int, Int<span class="delimiter">)</span><span class="delimiter">]</span>
    <a title="((Int, Int), Int, Int)" id="656987" class="delimiter">(</a><a href="#656986" title="Int" id="657044">a</a>,<a href="#656986" title="Int" id="657045">b</a><span class="delimiter">)</span> = <a href="#657041" title="(Int, Int)">s</a>
    <a title="Int" id="657046">n</a> = <a href="#657044" title="Int">a</a> <span title="(x: Int)Int">+</span> <a href="#657045" title="Int">b</a>
    <a title="Unit" id="657061">_</a> &lt;- <a href="../../../scalaz-core/scalaz/State.scala.html#55026" title="(s: (Int, Int))scalaz.package.State[(Int, Int),Unit]">put</a> <a href="../../../scalaz-core/scalaz/StateT.scala.html#86023" title="(f: Unit =&gt; Int)(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.IndexedStateT[scalaz.Id.Id,(Int, Int),(Int, Int),Int]" class="delimiter">(</a><a href="#657045" title="Int">b</a>, <a href="#657046" title="Int">n</a><span class="delimiter">)</span>
  <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#657045" title="Int">b</a> <span class="comment">// if we yield n, getNFibs gives you (1,2,3,5,8...)</span>
            <span class="comment">// yield b instead to get (1,1,2,3...)</span>

  <span class="keyword">def</span> <a title="(k: Int)scalaz.package.State[(Int, Int),List[Int]]" id="656969">getNFibs</a><span class="delimiter">(</span><a title="Int" id="657071">k</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="../../../scalaz-core/scalaz/StateT.scala.html#18774" title="scalaz.package.State[(Int, Int),List[Int]]">State</a><span class="delimiter">[</span><span class="delimiter">(</span>Int, Int<span class="delimiter">)</span>, List<span class="delimiter">[</span>Int<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="../../../scalaz-core/scalaz/syntax/ApplicativeSyntax.scala.html#114247" title="(v: scalaz.IndexedStateT[[+X]X,(Int, Int),(Int, Int),Int])scalaz.syntax.ApplicativeOps[[x]scalaz.IndexedStateT[[+X]X,(Int, Int),(Int, Int),x],Int]">nextFib</a>.<a href="../../../scalaz-core/scalaz/syntax/ApplicativeSyntax.scala.html#154764" title="(n: Int)scalaz.IndexedStateT[[+X]X,(Int, Int),(Int, Int),List[Int]]">replicateM</a><span class="delimiter">(</span><a href="#657071" title="Int">k</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(k: Int)scalaz.package.State[(Int, Int),Int]" id="656970">getNthFib</a><span class="delimiter">(</span><a title="Int" id="657106">k</a>:<span title="Int">Int</span><span class="delimiter">)</span>: <a href="../../../scalaz-core/scalaz/StateT.scala.html#18774" title="scalaz.package.State[(Int, Int),Int]">State</a><span class="delimiter">[</span><span class="delimiter">(</span>Int, Int<span class="delimiter">)</span>, Int<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="scalaz.package.State[(Int, Int),Int]" class="keyword">if</span> <span class="delimiter">(</span><a href="#657106" title="Int">k</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="../../../scalaz-core/scalaz/syntax/ApplicativeSyntax.scala.html#114254" title="(a: =&gt; Int)(implicit F: scalaz.Applicative[[x]scalaz.IndexedStateT[[+X]X,(Int, Int),(Int, Int),x]])scalaz.IndexedStateT[[+X]X,(Int, Int),(Int, Int),Int]">pure</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#140417" title="scalaz.MonadState[[s, +a]scalaz.IndexedStateT[[+X]X,s,s,a],(Int, Int)]" class="delimiter">(</a><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">// will be thrown away</span>
    <span class="keyword">else</span>
      <a href="#656970" title="(k: Int)scalaz.package.State[(Int, Int),Int]">getNthFib</a><a href="../../../scalaz-core/scalaz/syntax/BindSyntax.scala.html#139492" title="(v: scalaz.IndexedStateT[[+X]X,(Int, Int),(Int, Int),Int])scalaz.syntax.BindOps[[x]scalaz.IndexedStateT[[+X]X,(Int, Int),(Int, Int),x],Int]" class="delimiter">(</a><a href="#657106" title="Int">k</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="../../../scalaz-core/scalaz/syntax/BindSyntax.scala.html#154662" title="(b: =&gt; scalaz.IndexedStateT[[+X]X,(Int, Int),(Int, Int),Int])scalaz.IndexedStateT[[+X]X,(Int, Int),(Int, Int),Int]">&gt;&gt;</a> <a href="#656967" title="=&gt; scalaz.package.State[(Int, Int),Int]">nextFib</a>
  <span class="delimiter">}</span>

  <span class="comment">// run two examples through the magic of App</span>
  <span title="(x: Any)Unit">println</span><span class="delimiter">(</span> <a href="#656970" title="(k: Int)scalaz.package.State[(Int, Int),Int]">getNthFib</a><span class="delimiter">(</span><span title="Int(5)" class="int">5</span><span class="delimiter">)</span>.<a href="../../../scalaz-core/scalaz/StateT.scala.html#86015" title="(initial: (Int, Int))(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.Id.Id[Int]">eval</a><a href="../../../scalaz-core/scalaz/package.scala.html#40348" title="=&gt; scalaz.Traverse1[scalaz.Id.Id] with scalaz.Each[scalaz.Id.Id] with scalaz.Monad[scalaz.Id.Id] with scalaz.Comonad[scalaz.Id.Id] with scalaz.Cojoin[scalaz.Id.Id] with scalaz.Distributive[scalaz.Id.Id] with scalaz.Zip[scalaz.Id.Id] with scalaz.Unzip[scalaz.Id.Id] with scalaz.Cozip[scalaz.Id.Id]" class="delimiter">(</a> <a href="#656965" title="=&gt; (Int, Int)">initialState</a> <span class="delimiter">)</span> <span class="delimiter">)</span>
  <span title="(x: Any)Unit">println</span><span class="delimiter">(</span> <a href="#656969" title="(k: Int)scalaz.package.State[(Int, Int),List[Int]]">getNFibs</a><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>.<a href="../../../scalaz-core/scalaz/StateT.scala.html#86015" title="(initial: (Int, Int))(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.Id.Id[List[Int]]">eval</a><a href="../../../scalaz-core/scalaz/package.scala.html#40348" title="=&gt; scalaz.Traverse1[scalaz.Id.Id] with scalaz.Each[scalaz.Id.Id] with scalaz.Monad[scalaz.Id.Id] with scalaz.Comonad[scalaz.Id.Id] with scalaz.Cojoin[scalaz.Id.Id] with scalaz.Distributive[scalaz.Id.Id] with scalaz.Zip[scalaz.Id.Id] with scalaz.Unzip[scalaz.Id.Id] with scalaz.Cozip[scalaz.Id.Id]" class="delimiter">(</a> <a href="#656965" title="=&gt; (Int, Int)">initialState</a> <span class="delimiter">)</span> <span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/** Simple call-by-need (i.e. lazy) interpreter for Lambda Calculus based off of
  * John Launchbury's &quot;A Natural Semantics for Lazy Evaluation&quot;
  * Uses the &quot;Barendregt convention&quot;: All variable names are globally unique
  * (i.e. you cannot shadow variable names), and renames variables after substitution
  * to maintain this invariant.
  */</span>
<span class="keyword">object</span> <a title="object scalaz.example.LaunchburyInterpreter" id="34913">LaunchburyInterpreter</a> <span title="ScalaObject" class="keyword">extends</span> <span title="App">App</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> scala.collection.immutable.HashMap
  <span class="keyword">import</span> scalaz.<a href="../../../scalaz-core/scalaz/StreamT.scala.html#10750" title="object scalaz.StreamT">StreamT</a>._
  <span class="keyword">import</span> scalaz.std.<a href="../../../scalaz-core/scalaz/std/Function.scala.html#27447" title="object scalaz.std.function">function</a>._
  <span class="keyword">import</span> scalaz.std.<a href="../../../scalaz-core/scalaz/std/List.scala.html#27759" title="object scalaz.std.list">list</a>._
  <span class="keyword">import</span> scalaz.std.<a href="../../../scalaz-core/scalaz/std/Map.scala.html#27906" title="object scalaz.std.map">map</a>._
  <span class="keyword">import</span> scalaz.syntax.<a href="../../../scalaz-core/scalaz/syntax/Syntax.scala.html#40624" title="object scalaz.syntax.package.foldable">foldable</a>._
  <span class="keyword">import</span> scalaz.syntax.<a href="../../../scalaz-core/scalaz/syntax/Syntax.scala.html#40586" title="object scalaz.syntax.package.traverse">traverse</a>._
  <span class="keyword">import</span> scalaz.syntax.<a href="../../../scalaz-core/scalaz/syntax/Syntax.scala.html#40604" title="object scalaz.syntax.package.arrow">arrow</a>._

  <span class="keyword">val</span> <a title="scalaz.MonadState[[s, +a]scalaz.IndexedStateT[[+X]X,s,s,a],scalaz.example.LaunchburyInterpreter.ReduceState]" id="657252">S</a> = scalaz.<a href="../../../scalaz-core/scalaz/package.scala.html#40402" title="object scalaz.package.StateT">StateT</a>.<a href="../../../scalaz-core/scalaz/StateT.scala.html#140417" title="[S]=&gt; scalaz.MonadState[[s, +a]scalaz.IndexedStateT[[+X]X,s,s,a],S]">stateMonad</a><span title="scalaz.MonadState[[s, +a]scalaz.IndexedStateT[[+X]X,s,s,a],scalaz.example.LaunchburyInterpreter.ReduceState]" class="delimiter">[</span><a href="#661188" title="scalaz.example.LaunchburyInterpreter.ReduceState">ReduceState</a><span class="delimiter">]</span>
  <span class="keyword">import</span> <a href="#657252" title="=&gt; scalaz.MonadState[[s, +a]scalaz.IndexedStateT[[+X]X,s,s,a],scalaz.example.LaunchburyInterpreter.ReduceState]">S</a>.<a href="../../../scalaz-core/scalaz/Monad.scala.html#44883" title="=&gt; java.lang.Object with scalaz.syntax.MonadSyntax[[x]scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,x]]">monadSyntax</a>._
  <span class="keyword">import</span> scalaz.<a href="../../../scalaz-core/scalaz/package.scala.html#40406" title="object scalaz.package.State">State</a>._

  <span class="comment">/** Simple lambda calculus Abstract Syntax Tree.
    * Note that that apply applies a let-bound argument to an Expr.
    * This is to make sharing easier, by ensuring that arguments are in the heap.
    */</span>
  <span class="keyword">abstract</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <a title="class Expr extends java.lang.Object with ScalaObject" id="657256">Expr</a>
  case <span class="keyword">class</span> <a title="class Lambda extends scalaz.example.LaunchburyInterpreter.Expr with ScalaObject with Product with Serializable" id="661204">Lambda</a><a href="#661204" title="ScalaObject" class="delimiter">(</a><a title="String" id="657305">name</a>: <span title="String">String</span>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="657306">term</a>: <a href="#657256" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#657256" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a>
  case <span class="keyword">class</span> <a title="class Apply extends scalaz.example.LaunchburyInterpreter.Expr with ScalaObject with Product with Serializable" id="661200">Apply</a><a href="#661200" title="ScalaObject" class="delimiter">(</a><a title="scalaz.example.LaunchburyInterpreter.Expr" id="657477">term</a>: <a href="#657256" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a>, <a title="String" id="657478">arg</a>:<span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#657256" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a>
  case <span class="keyword">class</span> <a title="class Var extends scalaz.example.LaunchburyInterpreter.Expr with ScalaObject with Product with Serializable" id="661196">Var</a><a href="#661196" title="ScalaObject" class="delimiter">(</a><a title="String" id="657321">name</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#657256" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a>
  case <span class="keyword">class</span> <a title="class Let extends scalaz.example.LaunchburyInterpreter.Expr with ScalaObject with Product with Serializable" id="661192">Let</a><a href="#661192" title="ScalaObject" class="delimiter">(</a><a title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]" id="657337">bindings</a>: <span title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]">Map</span><span class="delimiter">[</span>String, Expr<span class="delimiter">]</span>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="657338">term</a>: <a href="#657256" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#657256" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a>

  <span class="comment">// \x.x</span>
  <span class="keyword">val</span> <a title="scalaz.example.LaunchburyInterpreter.Lambda" id="657269">example1</a> = <a href="#661204" title="(name: String, term: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Lambda">Lambda</a><span class="delimiter">(</span><span title="java.lang.String(&quot;x&quot;)" class="string">&quot;x&quot;</span>, <a href="#661196" title="(name: String)scalaz.example.LaunchburyInterpreter.Var">Var</a><span class="delimiter">(</span><span title="java.lang.String(&quot;x&quot;)" class="string">&quot;x&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="comment">// let z = \y.y in (\x.x) z</span>
  <span class="keyword">val</span> <a title="scalaz.example.LaunchburyInterpreter.Let" id="657271">example2</a> = <a href="#661192" title="(bindings: Map[String,scalaz.example.LaunchburyInterpreter.Expr], term: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Let">Let</a><span class="delimiter">(</span> <span title="(elems: (java.lang.String, scalaz.example.LaunchburyInterpreter.Lambda)*)scala.collection.immutable.HashMap[java.lang.String,scalaz.example.LaunchburyInterpreter.Lambda]">HashMap</span><span class="delimiter">(</span> <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;z&quot;</span> <span title="(y: scalaz.example.LaunchburyInterpreter.Lambda)(java.lang.String, scalaz.example.LaunchburyInterpreter.Lambda)">-&gt;</span> <a href="#661204" title="(name: String, term: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Lambda">Lambda</a><span class="delimiter">(</span><span title="java.lang.String(&quot;y&quot;)" class="string">&quot;y&quot;</span>, <a href="#661196" title="(name: String)scalaz.example.LaunchburyInterpreter.Var">Var</a><span class="delimiter">(</span><span title="java.lang.String(&quot;y&quot;)" class="string">&quot;y&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">)</span>
                    , <a href="#661200" title="(term: scalaz.example.LaunchburyInterpreter.Expr, arg: String)scalaz.example.LaunchburyInterpreter.Apply">Apply</a><span class="delimiter">(</span><a href="#657269" title="=&gt; scalaz.example.LaunchburyInterpreter.Lambda">example1</a>, <span title="java.lang.String(&quot;z&quot;)" class="string">&quot;z&quot;</span><span class="delimiter">)</span>
                    <span class="delimiter">)</span>

  case <span class="keyword">class</span> <a title="class ReduceState extends java.lang.Object with ScalaObject with Product with Serializable" id="661188">ReduceState</a><a href="#661188" title="ScalaObject" class="delimiter">(</a> <a title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]" id="657488">heap</a>: <span title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]">Map</span><span class="delimiter">[</span>String, Expr<span class="delimiter">]</span>
                        , <a title="Stream[String]" id="657489">freshVars</a>: <span title="Stream[String]">Stream</span><span class="delimiter">[</span>String<span class="delimiter">]</span>
                        <span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scalaz.example.LaunchburyInterpreter.ReduceState" id="657276">initialState</a> = <a href="#661188" title="(heap: Map[String,scalaz.example.LaunchburyInterpreter.Expr], freshVars: Stream[String])scalaz.example.LaunchburyInterpreter.ReduceState">ReduceState</a><span class="delimiter">(</span> <span title="(elems: (String, Nothing)*)scala.collection.immutable.HashMap[String,Nothing]">HashMap</span><span class="delimiter">(</span><span class="delimiter">)</span>
                                        , <span title="=&gt; collection.immutable.Stream.type">Stream</span>.<span title="(start: Int)scala.collection.immutable.Stream[Int]">from</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Stream[Int],java.lang.String,Stream[String]])Stream[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Stream.Coll,java.lang.String,scala.collection.immutable.Stream[java.lang.String]]" class="delimiter">(</span><a title="Int" id="657526">x</a> =&gt; <span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#657526" title="Int">x</a><span class="delimiter">)</span> <span class="comment">// i.e. $1, $2, $3, ...</span>
                                        <span class="delimiter">)</span>
  <span class="comment">// Substitute new variable names in</span>
  <span class="comment">// e.g. sub(map(&quot;x&quot; -&gt; &quot;y&quot;), Var(&quot;x&quot;)) =&gt; Var(&quot;y&quot;)</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(m: Map[String,String])(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr" id="657278">sub</a><span class="delimiter">(</span><a title="Map[String,String]" id="657870">m</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="657871">e</a>: <a href="#657256" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a><span class="delimiter">)</span>: <a href="#657256" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Expr" id="657873">subExpr</a> = <a href="#657278" title="(m: Map[String,String])(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">sub</a><a href="#657876" title="scalaz.example.LaunchburyInterpreter.Expr" class="delimiter">(</a><a href="#657870" title="Map[String,String]">m</a><span class="delimiter">)</span> _
    <span class="keyword">def</span> <a title="(n: String)String" id="657874">subName</a><span class="delimiter">(</span><a title="String" id="657877">n</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#657870" title="Map[String,String]">m</a> <span title="(key: String)Boolean">contains</span> <a href="#657877" title="String">n</a><span class="delimiter">)</span> <a href="#657870" title="(key: String)String">m</a><span class="delimiter">(</span><a href="#657877" title="String">n</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#657877" title="String">n</a>
    <a href="#657871" title="scalaz.example.LaunchburyInterpreter.Expr">e</a> <span title="scalaz.example.LaunchburyInterpreter.Expr" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="scalaz.example.LaunchburyInterpreter.Lambda">Lambda</span><span class="delimiter">(</span><a title="String" id="657898">z</a>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="657899">e2</a><span class="delimiter">)</span> =&gt; <a href="#661204" title="(name: String, term: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Lambda">Lambda</a><span class="delimiter">(</span><a href="#657874" title="(n: String)String">subName</a><span class="delimiter">(</span><a href="#657898" title="String">z</a><span class="delimiter">)</span>, <a href="#657873" title="(v1: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">subExpr</a><span class="delimiter">(</span><a href="#657899" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scalaz.example.LaunchburyInterpreter.Apply">Apply</span><span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="657903">e2</a>, <a title="String" id="657904">z</a><span class="delimiter">)</span>  =&gt; <a href="#661200" title="(term: scalaz.example.LaunchburyInterpreter.Expr, arg: String)scalaz.example.LaunchburyInterpreter.Apply">Apply</a><span class="delimiter">(</span><a href="#657873" title="(v1: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">subExpr</a><span class="delimiter">(</span><a href="#657903" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span>, <a href="#657874" title="(n: String)String">subName</a><span class="delimiter">(</span><a href="#657904" title="String">z</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scalaz.example.LaunchburyInterpreter.Var">Var</span><span class="delimiter">(</span><a title="String" id="657907">z</a><span class="delimiter">)</span>        =&gt; <a href="#661196" title="(name: String)scalaz.example.LaunchburyInterpreter.Var">Var</a><span class="delimiter">(</span><a href="#657874" title="(n: String)String">subName</a><span class="delimiter">(</span><a href="#657907" title="String">z</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scalaz.example.LaunchburyInterpreter.Let">Let</span><span class="delimiter">(</span><a title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]" id="657909">bs</a>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="657910">e2</a><span class="delimiter">)</span>   =&gt; <a href="#661192" title="(bindings: Map[String,scalaz.example.LaunchburyInterpreter.Expr], term: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Let">Let</a><span class="delimiter">(</span> <a href="#657909" title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]">bs</a>.<span title="(f: ((String, scalaz.example.LaunchburyInterpreter.Expr)) =&gt; (String, scalaz.example.LaunchburyInterpreter.Expr))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr],(String, scalaz.example.LaunchburyInterpreter.Expr),Map[String,scalaz.example.LaunchburyInterpreter.Expr]])Map[String,scalaz.example.LaunchburyInterpreter.Expr]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map.Coll,(String, scalaz.example.LaunchburyInterpreter.Expr),scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]]" class="delimiter">(</span><a href="../../../scalaz-core/scalaz/syntax/ArrowSyntax.scala.html#55473" title="(v: String =&gt; String)(implicit F0: scalaz.Arrow[Function1])java.lang.Object with scalaz.syntax.ArrowOps[Function1,String,String]">subName</a> _ <a href="../../../scalaz-core/scalaz/syntax/ArrowSyntax.scala.html#153336" title="(k: scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Expr)((String, scalaz.example.LaunchburyInterpreter.Expr)) =&gt; (String, scalaz.example.LaunchburyInterpreter.Expr)">***</a> <a href="#657873" title="scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Expr">subExpr</a><span class="delimiter">)</span>, <a href="#657873" title="(v1: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">subExpr</a><span class="delimiter">(</span><a href="#657910" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="comment">// replaces every bound variable with a new, &quot;fresh&quot; variable</span>
  <span class="comment">// e.g. freshen(Lambda(&quot;x&quot;, Var(&quot;x&quot;))).eval(initialState) =&gt; Lambda(&quot;$1&quot;, Var(&quot;$1&quot;))</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" id="657279">freshen</a><span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="658159">e</a>: <a href="#657256" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a><span class="delimiter">)</span>: <a href="../../../scalaz-core/scalaz/StateT.scala.html#18774" title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">State</a><span class="delimiter">[</span>ReduceState, Expr<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,String]" id="658161">getFreshVar</a> = <span class="keyword">for</span> <span class="delimiter">{</span> <a title="scalaz.example.LaunchburyInterpreter.ReduceState" id="658254">s</a> &lt;- <a href="../../../scalaz-core/scalaz/State.scala.html#55015" title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState]">init</a>: <a href="../../../scalaz-core/scalaz/StateT.scala.html#18774" title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState]">State</a><span class="delimiter">[</span>ReduceState,ReduceState<span class="delimiter">]</span>
                            ReduceState<a title="(scalaz.example.LaunchburyInterpreter.ReduceState, String, scala.collection.immutable.Stream[String])" id="658170" class="delimiter">(</a>_, <a href="#658169" title="String" id="658265">f</a> <a href="#658174" title="(xs: scala.collection.immutable.Stream[String])Option[(String, scala.collection.immutable.Stream[String])]">#::</a> <a href="#658169" title="scala.collection.immutable.Stream[String]" id="658266">fs</a><span class="delimiter">)</span> = <a href="#658254" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>
                            <a title="Unit" id="658279">_</a> &lt;- <a href="../../../scalaz-core/scalaz/State.scala.html#55029" title="(f: scalaz.example.LaunchburyInterpreter.ReduceState =&gt; scalaz.example.LaunchburyInterpreter.ReduceState)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,Unit]">modify</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#86023" title="(f: Unit =&gt; String)(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,String]" class="delimiter">(</a><span class="delimiter">(</span>s:<a href="#661188" title="scalaz.example.LaunchburyInterpreter.ReduceState">ReduceState</a><span class="delimiter">)</span> =&gt; <a href="#658270" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>.<a href="#657488" title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]" id="658272">copy</a><span class="delimiter">(</span>freshVars = <a href="#658266" title="scala.collection.immutable.Stream[String]" id="658271">fs</a><span class="delimiter">)</span><span class="delimiter">)</span>
                          <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#658265" title="String">f</a>
    <span class="comment">// Lambda and Let define new bound variables, so we substitute fresh variables into them</span>
    <span class="comment">// Var and Apply just recursively traverse the AST</span>
    <a href="#658159" title="scalaz.example.LaunchburyInterpreter.Expr">e</a> <span title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Lambda]">Lambda</span><span class="delimiter">(</span><a title="String" id="658359">x</a>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="658360">e2</a><span class="delimiter">)</span> =&gt; <span class="keyword">for</span> <span class="delimiter">{</span> <a title="String" id="658367">y</a> &lt;- <a href="../../../scalaz-core/scalaz/StateT.scala.html#86051" title="(f: String =&gt; scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Lambda])(implicit F: scalaz.Bind[scalaz.Id.Id])scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Lambda]">getFreshVar</a>
                                  <a title="scalaz.example.LaunchburyInterpreter.Expr" id="658476">e3</a> &lt;- <a href="#657279" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">freshen</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#86023" title="(f: scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Lambda)(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Lambda]" class="delimiter">(</a> <a href="#657278" title="(m: Map[String,String])(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">sub</a><span class="delimiter">(</span><span title="(elems: (String, String)*)scala.collection.immutable.HashMap[String,String]">HashMap</span><span class="delimiter">(</span><a href="#658359" title="(x: String)ArrowAssoc[String]">x</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#658367" title="String">y</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#658360" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span> <span class="delimiter">)</span>
                                <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#661204" title="(name: String, term: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Lambda">Lambda</a><span class="delimiter">(</span><a href="#658367" title="String">y</a>, <a href="#658476" title="scalaz.example.LaunchburyInterpreter.Expr">e3</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Apply]">Apply</span><span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="658558">e2</a>, <a title="String" id="658559">x</a><span class="delimiter">)</span>  =&gt; <a href="#657279" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">freshen</a><a href="../../../scalaz-core/scalaz/syntax/BindSyntax.scala.html#139492" title="(v: scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr])scalaz.syntax.BindOps[[x]scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,x],scalaz.example.LaunchburyInterpreter.Expr]" class="delimiter">(</a><a href="#658558" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span> <a href="../../../scalaz-core/scalaz/syntax/BindSyntax.scala.html#154650" title="(f: scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Apply])scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Apply]">&gt;&gt;=</a> <span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="658676">e3</a> =&gt; <a href="../../../scalaz-core/scalaz/syntax/ApplicativeSyntax.scala.html#114254" title="(a: =&gt; scalaz.example.LaunchburyInterpreter.Apply)(implicit F: scalaz.Applicative[[x]scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,x]])scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Apply]">pure</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#140417" title="scalaz.MonadState[[s, +a]scalaz.IndexedStateT[[+X]X,s,s,a],scalaz.example.LaunchburyInterpreter.ReduceState]" class="delimiter">(</a><a href="#661200" title="(term: scalaz.example.LaunchburyInterpreter.Expr, arg: String)scalaz.example.LaunchburyInterpreter.Apply">Apply</a><span class="delimiter">(</span><a href="#658676" title="scalaz.example.LaunchburyInterpreter.Expr">e3</a>, <a href="#658559" title="String">x</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">Var</span><span class="delimiter">(</span>_<span class="delimiter">)</span>        =&gt; <a href="../../../scalaz-core/scalaz/syntax/ApplicativeSyntax.scala.html#114254" title="(a: =&gt; scalaz.example.LaunchburyInterpreter.Expr)(implicit F: scalaz.Applicative[[x]scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,x]])scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">pure</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#140417" title="scalaz.MonadState[[s, +a]scalaz.IndexedStateT[[+X]X,s,s,a],scalaz.example.LaunchburyInterpreter.ReduceState]" class="delimiter">(</a><a href="#658159" title="scalaz.example.LaunchburyInterpreter.Expr">e</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">Let</span><span class="delimiter">(</span><a title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]" id="658883">bs</a>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="658884">e2</a><span class="delimiter">)</span>   =&gt; <span class="keyword">for</span> <span class="delimiter">{</span> <a title="List[String]" id="659627">fs</a> &lt;- <a href="../../../scalaz-core/scalaz/syntax/ApplicativeSyntax.scala.html#114247" title="(v: scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,String])scalaz.syntax.ApplicativeOps[[x]scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,x],String]">getFreshVar</a>.<a href="../../../scalaz-core/scalaz/syntax/ApplicativeSyntax.scala.html#154764" title="(n: Int)scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,List[String]]">replicateM</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#86023" title="(f: List[String] =&gt; (List[String], Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)], scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Expr, List[(String, scalaz.example.LaunchburyInterpreter.Expr)]))(implicit F: scalaz.Functor[[+X]X])scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,(List[String], Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)], scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Expr, List[(String, scalaz.example.LaunchburyInterpreter.Expr)])]" class="delimiter">(</a><a href="#658883" title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]">bs</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
                                  <span class="comment">// Seq[((originalVar, Expr), freshVar)]</span>
                                  <a title="Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)]" id="659628">newBindings</a> = <a href="#658883" title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]">bs</a>.<span title="=&gt; Seq[(String, scalaz.example.LaunchburyInterpreter.Expr)]">toSeq</span>.<span title="(that: scala.collection.GenIterable[String])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(String, scalaz.example.LaunchburyInterpreter.Expr)],((String, scalaz.example.LaunchburyInterpreter.Expr), String),Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)]])Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)]">zip</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,((String, scalaz.example.LaunchburyInterpreter.Expr), String),Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)]]" class="delimiter">(</span><a href="#659627" title="List[String]">fs</a><span class="delimiter">)</span>
                                  <span class="comment">// sub(Map(originalVar -&gt; freshVar))</span>
                                  <a title="scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Expr" id="659629">subs</a> = <a href="#657278" title="(m: Map[String,String])(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">sub</a><a href="#659470" title="scalaz.example.LaunchburyInterpreter.Expr" class="delimiter">(</a> <a href="#659628" title="Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)]">newBindings</a>.<span title="(f: (((String, scalaz.example.LaunchburyInterpreter.Expr), String)) =&gt; (String, String))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)],(String, String),Seq[(String, String)]])Seq[(String, String)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(String, String),Seq[(String, String)]]" class="delimiter">(</span><a title="((String, scalaz.example.LaunchburyInterpreter.Expr), String)" id="659119">tpl</a> =&gt; <a href="#659119" title="((String, scalaz.example.LaunchburyInterpreter.Expr), String)">tpl</a>.<span title="(_1: String, _2: String)(String, String)">copy</span><span class="delimiter">(</span>_1 = <a href="#659119" title="((String, scalaz.example.LaunchburyInterpreter.Expr), String)">tpl</a>.<span title="=&gt; (String, scalaz.example.LaunchburyInterpreter.Expr)">_1</span>.<span title="=&gt; String">_1</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#659468" title="(implicit ev: &lt;:&lt;[(String, String),(String, String)])scala.collection.immutable.Map[String,String]">toMap</a> <span class="delimiter">)</span> _
                                  <span class="comment">// List[freshVar, Expr] - change to map when dolio's done</span>
                                  <a title="List[(String, scalaz.example.LaunchburyInterpreter.Expr)]" id="659630">bs2</a> = <a href="#659628" title="Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)]">newBindings</a>.<span title="(f: (((String, scalaz.example.LaunchburyInterpreter.Expr), String)) =&gt; (String, scalaz.example.LaunchburyInterpreter.Expr))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)],(String, scalaz.example.LaunchburyInterpreter.Expr),Seq[(String, scalaz.example.LaunchburyInterpreter.Expr)]])Seq[(String, scalaz.example.LaunchburyInterpreter.Expr)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(String, scalaz.example.LaunchburyInterpreter.Expr),Seq[(String, scalaz.example.LaunchburyInterpreter.Expr)]]" class="delimiter">(</span><a title="((String, scalaz.example.LaunchburyInterpreter.Expr), String)" id="659481">tpl</a> =&gt; <a href="#659481" title="((String, scalaz.example.LaunchburyInterpreter.Expr), String)">tpl</a>.<span title="(_1: String, _2: scalaz.example.LaunchburyInterpreter.Expr)(String, scalaz.example.LaunchburyInterpreter.Expr)">copy</span><span class="delimiter">(</span>_2 = <a href="#659481" title="((String, scalaz.example.LaunchburyInterpreter.Expr), String)">tpl</a>.<span title="=&gt; (String, scalaz.example.LaunchburyInterpreter.Expr)">_1</span>.<a title="scalaz.example.LaunchburyInterpreter.Expr" id="659488">_2</a>, _1 = <a href="#659481" title="((String, scalaz.example.LaunchburyInterpreter.Expr), String)">tpl</a>.<a title="String" id="659489">_2</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; List[(String, scalaz.example.LaunchburyInterpreter.Expr)]">toList</span>
                                  <a title="scalaz.example.LaunchburyInterpreter.Expr" id="659640">e3</a> &lt;- <a href="#657279" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">freshen</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#86051" title="(f: scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Let])(implicit F: scalaz.Bind[scalaz.Id.Id])scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Let]" class="delimiter">(</a> <a href="#659629" title="(v1: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">subs</a><span class="delimiter">(</span><a href="#658884" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span> <span class="delimiter">)</span>
                                  <a title="scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]" id="659947">freshendBs</a> &lt;- <a href="../../../scalaz-core/scalaz/syntax/TraverseSyntax.scala.html#55399" title="(v: List[(String, scalaz.example.LaunchburyInterpreter.Expr)])(implicit F0: scalaz.Traverse[List])java.lang.Object with scalaz.syntax.TraverseOps[List,(String, scalaz.example.LaunchburyInterpreter.Expr)]">bs2</a>.<a href="../../../scalaz-core/scalaz/syntax/TraverseSyntax.scala.html#153869" title="(f: ((String, scalaz.example.LaunchburyInterpreter.Expr)) =&gt; scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,(String, scalaz.example.LaunchburyInterpreter.Expr)])scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,List[(String, scalaz.example.LaunchburyInterpreter.Expr)]]">traverseS</a><a href="#659801" title="scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,(String, scalaz.example.LaunchburyInterpreter.Expr)]" class="delimiter">{</a><span class="keyword">case</span> <span title="scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,(String, scalaz.example.LaunchburyInterpreter.Expr)]" class="delimiter">(</span><a title="String" id="659804">x</a>,<a title="scalaz.example.LaunchburyInterpreter.Expr" id="659805">e</a><span class="delimiter">)</span> =&gt; <a href="#657279" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">freshen</a><span class="delimiter">(</span> <a href="#659629" title="(v1: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">subs</a><span class="delimiter">(</span><a href="#659805" title="scalaz.example.LaunchburyInterpreter.Expr">e</a><span class="delimiter">)</span> <span class="delimiter">)</span>.<a href="../../../scalaz-core/scalaz/StateT.scala.html#86023" title="(f: scalaz.example.LaunchburyInterpreter.Expr =&gt; (String, scalaz.example.LaunchburyInterpreter.Expr))(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,(String, scalaz.example.LaunchburyInterpreter.Expr)]">map</a><a href="../../../scalaz-core/scalaz/package.scala.html#40348" title="=&gt; scalaz.Traverse1[scalaz.Id.Id] with scalaz.Each[scalaz.Id.Id] with scalaz.Monad[scalaz.Id.Id] with scalaz.Comonad[scalaz.Id.Id] with scalaz.Cojoin[scalaz.Id.Id] with scalaz.Distributive[scalaz.Id.Id] with scalaz.Zip[scalaz.Id.Id] with scalaz.Unzip[scalaz.Id.Id] with scalaz.Cozip[scalaz.Id.Id]" class="delimiter">(</a><span title="(_1: String, _2: scalaz.example.LaunchburyInterpreter.Expr)(String, scalaz.example.LaunchburyInterpreter.Expr)" class="delimiter">(</span><a href="#659804" title="String">x</a>,<a href="#659811" title="scalaz.example.LaunchburyInterpreter.Expr">_</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">}</span>.<a href="../../../scalaz-core/scalaz/StateT.scala.html#86023" title="(f: List[(String, scalaz.example.LaunchburyInterpreter.Expr)] =&gt; scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr])(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]]">map</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#86023" title="(f: scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr] =&gt; scalaz.example.LaunchburyInterpreter.Let)(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Let]" class="delimiter">(</a><a href="#659868" title="List[(String, scalaz.example.LaunchburyInterpreter.Expr)]">_</a>.<span title="(implicit ev: &lt;:&lt;[(String, scalaz.example.LaunchburyInterpreter.Expr),(String, scalaz.example.LaunchburyInterpreter.Expr)])scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]">toMap</span><span class="delimiter">)</span>
                                <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#661192" title="(bindings: Map[String,scalaz.example.LaunchburyInterpreter.Expr], term: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Let">Let</a><span class="delimiter">(</span><a href="#659947" title="scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]">freshendBs</a>, <a href="#659640" title="scalaz.example.LaunchburyInterpreter.Expr">e3</a><span class="delimiter">)</span>

    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** performs &quot;big-step&quot; reduction: a single call maps a term to its final result
    * reduces lambda-terms to whnf or &quot;weak head normal form&quot;.  For our purposes,
    * whnf means a lambda term (generally, it also refers to primitives and constructors,
    * which we've ommitted).
    */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" id="657280">reduce</a><span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="660080">e</a>:<a href="#657256" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a><span class="delimiter">)</span>: <a href="../../../scalaz-core/scalaz/StateT.scala.html#18774" title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">State</a><span class="delimiter">[</span>ReduceState, Expr<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <a href="#660080" title="scalaz.example.LaunchburyInterpreter.Expr">e</a> <span title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">Lambda</span><span class="delimiter">(</span><a title="String" id="660082">x</a>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="660083">e2</a><span class="delimiter">)</span> =&gt; <a href="../../../scalaz-core/scalaz/syntax/ApplicativeSyntax.scala.html#114254" title="(a: =&gt; scalaz.example.LaunchburyInterpreter.Expr)(implicit F: scalaz.Applicative[[x]scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,x]])scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">pure</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#140417" title="scalaz.MonadState[[s, +a]scalaz.IndexedStateT[[+X]X,s,s,a],scalaz.example.LaunchburyInterpreter.ReduceState]" class="delimiter">(</a><a href="#660080" title="scalaz.example.LaunchburyInterpreter.Expr">e</a><span class="delimiter">)</span> <span class="comment">// as defined above, a Lambda is already in whnf</span>
      <span class="keyword">case</span> <span title="scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">Apply</span><span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="660186">e2</a>, <a title="String" id="660187">x</a><span class="delimiter">)</span>  =&gt; <a href="#657280" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">reduce</a><a href="../../../scalaz-core/scalaz/syntax/BindSyntax.scala.html#139492" title="(v: scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr])scalaz.syntax.BindOps[[x]scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,x],scalaz.example.LaunchburyInterpreter.Expr]" class="delimiter">(</a><a href="#660186" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span> <a href="../../../scalaz-core/scalaz/syntax/BindSyntax.scala.html#154650" title="(f: scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr])scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">&gt;&gt;=</a> <a href="#660301" title="scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" class="delimiter">{</a> <span class="keyword">case</span> <span title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">Lambda</span><span class="delimiter">(</span><a title="String" id="660302">y</a>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="660303">e3</a><span class="delimiter">)</span> =&gt; <a href="#657280" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">reduce</a><span class="delimiter">(</span> <a href="#657278" title="(m: Map[String,String])(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">sub</a><span class="delimiter">(</span><span title="(elems: (String, String)*)scala.collection.immutable.HashMap[String,String]">HashMap</span><span class="delimiter">(</span><a href="#660302" title="(x: String)ArrowAssoc[String]">y</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#660187" title="String">x</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#660303" title="scalaz.example.LaunchburyInterpreter.Expr">e3</a><span class="delimiter">)</span> <span class="delimiter">)</span>
                                             <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Ill-typed lambda term&quot;)" class="string">&quot;Ill-typed lambda term&quot;</span><span class="delimiter">)</span>
                                           <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">Var</span><span class="delimiter">(</span><a title="String" id="660414">x</a><span class="delimiter">)</span>        =&gt; <span class="keyword">for</span> <span class="delimiter">{</span> <a title="scalaz.example.LaunchburyInterpreter.ReduceState" id="660501">state</a> &lt;- <a href="../../../scalaz-core/scalaz/State.scala.html#55015" title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState]">init</a>:<a href="../../../scalaz-core/scalaz/StateT.scala.html#18774" title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState]">State</a><span class="delimiter">[</span>ReduceState, ReduceState<span class="delimiter">]</span>
                                  <a title="scalaz.example.LaunchburyInterpreter.Expr" id="660502">e2</a> = <a href="#660501" title="scalaz.example.LaunchburyInterpreter.ReduceState">state</a>.<a href="#657488" title="(key: String)scalaz.example.LaunchburyInterpreter.Expr">heap</a><span class="delimiter">(</span><a href="#660414" title="String">x</a><span class="delimiter">)</span>
                                  <a title="Unit" id="660522">_</a> &lt;- <a href="../../../scalaz-core/scalaz/State.scala.html#55029" title="(f: scalaz.example.LaunchburyInterpreter.ReduceState =&gt; scalaz.example.LaunchburyInterpreter.ReduceState)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,Unit]">modify</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#86051" title="(f: Unit =&gt; scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr])(implicit F: scalaz.Bind[scalaz.Id.Id])scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" class="delimiter">(</a><span class="delimiter">(</span>s:<a href="#661188" title="scalaz.example.LaunchburyInterpreter.ReduceState">ReduceState</a><span class="delimiter">)</span> =&gt; <a href="#660506" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>.<a href="#661188" title="(heap: Map[String,scalaz.example.LaunchburyInterpreter.Expr], freshVars: Stream[String])scalaz.example.LaunchburyInterpreter.ReduceState">copy</a><span class="delimiter">(</span>heap = <a href="#660506" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>.<a href="#657488" title="=&gt; Map[String,scalaz.example.LaunchburyInterpreter.Expr]">heap</a> <span title="(key: String)scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]">-</span> <a href="#660414" title="String">x</a><span class="delimiter">)</span><span class="delimiter">)</span>
                                  <a title="scalaz.example.LaunchburyInterpreter.Expr" id="660529">e3</a> &lt;- <a href="#657280" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">reduce</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#86051" title="(f: scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr])(implicit F: scalaz.Bind[scalaz.Id.Id])scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" class="delimiter">(</a><a href="#660502" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span>
                                  <a title="Unit" id="660600">_</a> &lt;- <a href="../../../scalaz-core/scalaz/State.scala.html#55029" title="(f: scalaz.example.LaunchburyInterpreter.ReduceState =&gt; scalaz.example.LaunchburyInterpreter.ReduceState)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,Unit]">modify</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#86051" title="(f: Unit =&gt; scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr])(implicit F: scalaz.Bind[scalaz.Id.Id])scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" class="delimiter">(</a><span class="delimiter">(</span>s:<a href="#661188" title="scalaz.example.LaunchburyInterpreter.ReduceState">ReduceState</a><span class="delimiter">)</span> =&gt; <a href="#660533" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>.<a href="#661188" title="(heap: Map[String,scalaz.example.LaunchburyInterpreter.Expr], freshVars: Stream[String])scalaz.example.LaunchburyInterpreter.ReduceState">copy</a><span class="delimiter">(</span>heap = <a href="#660533" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>.<a href="#657488" title="=&gt; Map[String,scalaz.example.LaunchburyInterpreter.Expr]">heap</a> <span title="(kv: (String, scalaz.example.LaunchburyInterpreter.Expr))scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]">+</span> <span class="delimiter">(</span><span title="(_1: String, _2: scalaz.example.LaunchburyInterpreter.Expr)(String, scalaz.example.LaunchburyInterpreter.Expr)" class="delimiter">(</span><a href="#660414" title="String">x</a>, <a href="#660529" title="scalaz.example.LaunchburyInterpreter.Expr">e3</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                                  <a title="scalaz.example.LaunchburyInterpreter.Expr" id="660606">freshendE</a> &lt;- <a href="#657279" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">freshen</a><a href="../../../scalaz-core/scalaz/StateT.scala.html#86023" title="(f: scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Expr)(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.IndexedStateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" class="delimiter">(</a><a href="#660529" title="scalaz.example.LaunchburyInterpreter.Expr">e3</a><span class="delimiter">)</span>
                                <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#660606" title="scalaz.example.LaunchburyInterpreter.Expr">freshendE</a>
     <span class="keyword">case</span> <span title="scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">Let</span><span class="delimiter">(</span><a title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]" id="660791">bs</a>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="660792">e2</a><span class="delimiter">)</span>   =&gt; <span class="delimiter">{</span> <span class="keyword">val</span> <a title="((String, scalaz.example.LaunchburyInterpreter.Expr)) =&gt; scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,Unit]" id="660793">heapAdd</a> = <span class="delimiter">(</span><span class="delimiter">(</span>binding:<span title="(String, scalaz.example.LaunchburyInterpreter.Expr)" class="delimiter">(</span>String, Expr<span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
                                              <a href="../../../scalaz-core/scalaz/State.scala.html#55029" title="(f: scalaz.example.LaunchburyInterpreter.ReduceState =&gt; scalaz.example.LaunchburyInterpreter.ReduceState)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,Unit]">modify</a><span class="delimiter">(</span><span class="delimiter">(</span>s:<a href="#661188" title="scalaz.example.LaunchburyInterpreter.ReduceState">ReduceState</a><span class="delimiter">)</span> =&gt; <a href="#660799" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>.<a href="#661188" title="(heap: Map[String,scalaz.example.LaunchburyInterpreter.Expr], freshVars: Stream[String])scalaz.example.LaunchburyInterpreter.ReduceState">copy</a><span class="delimiter">(</span>heap = <a href="#660799" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>.<a href="#657488" title="=&gt; Map[String,scalaz.example.LaunchburyInterpreter.Expr]">heap</a> <span title="(kv: (String, scalaz.example.LaunchburyInterpreter.Expr))scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]">+</span> <a href="#660795" title="(String, scalaz.example.LaunchburyInterpreter.Expr)">binding</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                             <a href="#660791" title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]">bs</a>.<a href="../../../scalaz-core/scalaz/syntax/TraverseSyntax.scala.html#55399" title="(v: List[(String, scalaz.example.LaunchburyInterpreter.Expr)])(implicit F0: scalaz.Traverse[List])java.lang.Object with scalaz.syntax.TraverseOps[List,(String, scalaz.example.LaunchburyInterpreter.Expr)]">toList</a>.<a href="../../../scalaz-core/scalaz/syntax/TraverseSyntax.scala.html#153869" title="(f: ((String, scalaz.example.LaunchburyInterpreter.Expr)) =&gt; scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,Unit])scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,List[Unit]]">traverseS</a><a href="../../../scalaz-core/scalaz/syntax/BindSyntax.scala.html#139492" title="(v: scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,List[Unit]])scalaz.syntax.BindOps[[x]scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,x],List[Unit]]" class="delimiter">(</a><a href="#660793" title="((String, scalaz.example.LaunchburyInterpreter.Expr)) =&gt; scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,Unit]">heapAdd</a><span class="delimiter">)</span> <a href="../../../scalaz-core/scalaz/syntax/BindSyntax.scala.html#154662" title="(b: =&gt; scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr])scalaz.IndexedStateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">&gt;&gt;</a> <a href="#657280" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">reduce</a><span class="delimiter">(</span><a href="#660792" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span>
                           <span class="delimiter">}</span>
   <span class="delimiter">}</span>
 <span class="delimiter">}</span>

 <span class="keyword">def</span> <a title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr" id="657281">evaluate</a><span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="661136">e</a>:<a href="#657256" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a><span class="delimiter">)</span>: <a href="#657256" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a> = <a href="#657280" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">reduce</a><span class="delimiter">(</span><a href="#661136" title="scalaz.example.LaunchburyInterpreter.Expr">e</a><span class="delimiter">)</span>.<a href="../../../scalaz-core/scalaz/StateT.scala.html#86015" title="(initial: scalaz.example.LaunchburyInterpreter.ReduceState)(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.Id.Id[scalaz.example.LaunchburyInterpreter.Expr]">eval</a><a href="../../../scalaz-core/scalaz/package.scala.html#40348" title="=&gt; scalaz.Traverse1[scalaz.Id.Id] with scalaz.Each[scalaz.Id.Id] with scalaz.Monad[scalaz.Id.Id] with scalaz.Comonad[scalaz.Id.Id] with scalaz.Cojoin[scalaz.Id.Id] with scalaz.Distributive[scalaz.Id.Id] with scalaz.Zip[scalaz.Id.Id] with scalaz.Unzip[scalaz.Id.Id] with scalaz.Cozip[scalaz.Id.Id]" class="delimiter">(</a><a href="#657276" title="=&gt; scalaz.example.LaunchburyInterpreter.ReduceState">initialState</a><span class="delimiter">)</span>
 <span class="comment">// run an example through the magic of App</span>
 <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#657281" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">evaluate</a><span class="delimiter">(</span><a href="#657271" title="=&gt; scalaz.example.LaunchburyInterpreter.Let">example2</a><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>