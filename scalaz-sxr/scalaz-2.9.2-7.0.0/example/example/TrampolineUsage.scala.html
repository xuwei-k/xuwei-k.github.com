<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>example/example/TrampolineUsage.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scalaz.example

<span class="keyword">object</span> <a title="scalaz.example.TrampolineUsage.type" id="30031">TrampolineUsage</a> <a href="#30032" title="scalaz.example.TrampolineUsage.type" class="keyword">extends</a> <span title="App">App</span> <span class="delimiter">{</span>

  <span class="keyword">import</span> scalaz._, <a href="../../core/Scalaz.scala.html#12585" title="scalaz.Scalaz.type">Scalaz</a>._, <a href="../../core/Free.scala.html#10908" title="scalaz.Free.type">Free</a>._

  <span class="keyword">def</span> <a title="[F[+_], T](xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]" id="701379">quickSort</a><span class="delimiter">[</span><a title="[+_]" id="700139">F</a><span class="delimiter">[</span>+ <a title="" id="701380">_</a><span class="delimiter">]</span> : Applicative, <a title="" id="700140">T</a>: Order<span class="delimiter">]</span><span class="delimiter">(</span><a title="List[T]" id="701377">xs</a>: <span title="List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../core/Free.scala.html#10907" title="scalaz.Free[F,List[T]]">Free</a><span class="delimiter">[</span>F, List<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#701377" title="List[T]">xs</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1692003" title="scalaz.Free[F,List[T]]">Nil</a> =&gt;
        <a href="../../core/Free.scala.html#44473" title="(value: =&gt; scala.collection.immutable.Nil.type)(implicit S: scalaz.Applicative[F])scalaz.Free[F,scala.collection.immutable.Nil.type]">return_</a> <a href="#1692008" title="(x: scalaz.Free[F,List[T]])scalaz.Free[F,List[T]]" class="delimiter">{</a>
          <span title="scala.collection.immutable.Nil.type">Nil</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#1692005" title="T" id="701800">x</a> <a href="#1692003" title="scalaz.Free[F,List[T]]">::</a> <a href="#1692005" title="List[T]" id="701801">tail</a> =&gt;
        <a href="../../core/Free.scala.html#44478" title="(value: =&gt; scalaz.Free[F,List[T]])(implicit S: scalaz.Applicative[F])scalaz.Free[F,List[T]]">suspend</a> <a href="#1692008" title="(x: scalaz.Free[F,List[T]])scalaz.Free[F,List[T]]" class="delimiter">{</a>
          <span class="keyword">val</span> <a href="#1691999" title="(x: (List[T], List[T]))(List[T], List[T])" class="delimiter">(</a><a href="#1691997" title="List[T]" id="701811">left</a>, <a href="#1691997" title="List[T]" id="701812">right</a><span class="delimiter">)</span> = <a href="#701801" title="List[T]">tail</a>.<span title="(p: T =&gt; Boolean)(List[T], List[T])">partition</span><a href="#1691997" title="(List[T], List[T]) @unchecked" class="delimiter">(</a><a href="../../core/syntax/OrderSyntax.scala.html#45124" title="(v: T)(implicit F0: scalaz.Order[T])scalaz.syntax.OrderOps[T]">_</a> <a href="../../core/syntax/OrderSyntax.scala.html#156660" title="(other: T)Boolean">&lt;</a> <a href="#701800" title="T">x</a><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">{</span>
            <a title="List[T]" id="703492">ls</a> &lt;- <a href="#701379" title="[F[+_], T](xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]">quickSort</a><span title="(xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]" class="delimiter">[</span><a href="#700139" title="F">F</a>, <a href="#700140" title="T">T</a><span class="delimiter">]</span><a href="../../core/Free.scala.html#48231" title="(f: List[T] =&gt; scalaz.Free[F,List[T]])scalaz.Free[F,List[T]]" class="delimiter">(</a><a href="#701811" title="List[T]">left</a><span class="delimiter">)</span>
            <a title="List[T]" id="704213">rs</a> &lt;- <a href="#701379" title="[F[+_], T](xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]">quickSort</a><span title="(xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]" class="delimiter">[</span><a href="#700139" title="F">F</a>, <a href="#700140" title="T">T</a><span class="delimiter">]</span><a href="../../core/Free.scala.html#48225" title="(f: List[T] =&gt; List[T])scalaz.Free[F,List[T]]" class="delimiter">(</a><a href="#701812" title="List[T]">right</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#703492" title="List[T]">ls</a> <a href="#704214" title="(prefix: List[T])List[T]">:::</a> <span class="delimiter">(</span><a href="#701800" title="T">x</a> <a href="#704215" title="(x: T)List[T]">::</a> <a href="#704213" title="List[T]">rs</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[F[+_], T](xs: List[T])(implicit evidence$3: scalaz.Applicative[F], implicit evidence$4: scalaz.Comonad[F], implicit evidence$5: scalaz.Order[T])List[T]" id="704640">runQuickSort</a><span class="delimiter">[</span><a title="[+_]" id="700144">F</a><span class="delimiter">[</span>+ <a title="" id="704642">_</a><span class="delimiter">]</span> : Applicative : Comonad, <a title="" id="700145">T</a>: Order<span class="delimiter">]</span><span class="delimiter">(</span><a title="List[T]" id="704637">xs</a>: <span title="List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span> =
    <a href="#701379" title="[F[+_], T](xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]">quickSort</a><span title="(xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]" class="delimiter">[</span><a href="#700144" title="F">F</a>, <a href="#700145" title="T">T</a><span class="delimiter">]</span><a href="#704640" title="scalaz.Applicative[F]" class="delimiter">(</a><a href="#704637" title="List[T]">xs</a><span class="delimiter">)</span>.<a href="../../core/Free.scala.html#48254" title="(f: F[scalaz.Free[F,List[T]]] =&gt; scalaz.Free[F,List[T]])List[T]">go</a><span class="delimiter">(</span><a title="F[scalaz.Free[F,List[T]]]" id="705371">f</a> =&gt; <a href="../../core/Comonad.scala.html#145940" title="[F[_]](implicit F: scalaz.Comonad[F])scalaz.Comonad[F]">Comonad</a><a href="#704640" title="(implicit F: scalaz.Comonad[F])scalaz.Comonad[F]" class="delimiter">[</a><a href="#700144" title="F">F</a><span class="delimiter">]</span>.<a href="../../core/Comonad.scala.html#34607" title="(p: F[scalaz.Free[F,List[T]]])scalaz.Free[F,List[T]]">copoint</a><span class="delimiter">(</span><a href="#705371" title="F[scalaz.Free[F,List[T]]]">f</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="List[Int]" id="700146">xs</a> = <span title="scala.collection.immutable.List.type">List</span>.<span title="(n: Int)(elem: =&gt; Int)List[Int]">fill</span><span class="delimiter">(</span><span title="Int(32)" class="int">32</span><span class="delimiter">)</span><span class="delimiter">(</span>util.<span title="scala.util.Random.type">Random</span>.<span title="()Int">nextInt</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="delimiter">{</span>
    // Trampoline is Free[Function0, A].

    // use the heap
    <span class="keyword">val</span> <a title="List[Int]" id="705689">sorted</a> = <a href="#704640" title="[F[+_], T](xs: List[T])(implicit evidence$3: scalaz.Applicative[F], implicit evidence$4: scalaz.Comonad[F], implicit evidence$5: scalaz.Order[T])List[T]">runQuickSort</a><span title="(xs: List[Int])(implicit evidence$3: scalaz.Applicative[Function0], implicit evidence$4: scalaz.Comonad[Function0], implicit evidence$5: scalaz.Order[Int])List[Int]" class="delimiter">[</span><span title="Function0">Function0</span>, <span title="Int">Int</span><span class="delimiter">]</span><a href="../../core/std/Function.scala.html#44548" title="=&gt; scalaz.Traverse[Function0] with scalaz.Monad[Function0] with scalaz.Comonad[Function0] with scalaz.Distributive[Function0]" class="delimiter">(</a><a href="#700146" title="=&gt; List[Int]">xs</a><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#705689" title="List[Int]">sorted</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a href="#1692018" title="(x: (Int, List[Int]))(Int, List[Int])" class="delimiter">(</a><a href="#1692016" title="Int" id="705691">steps</a>, <a href="#1692016" title="List[Int]" id="705692">sorted1</a><span class="delimiter">)</span> = <a href="#701379" title="[F[+_], T](xs: List[T])(implicit evidence$1: scalaz.Applicative[F], implicit evidence$2: scalaz.Order[T])scalaz.Free[F,List[T]]">quickSort</a><span title="(xs: List[Int])(implicit evidence$1: scalaz.Applicative[Function0], implicit evidence$2: scalaz.Order[Int])scalaz.Free[Function0,List[Int]]" class="delimiter">[</span><span title="Function0">Function0</span>, <span title="Int">Int</span><span class="delimiter">]</span><a href="../../core/std/Function.scala.html#44548" title="=&gt; scalaz.Traverse[Function0] with scalaz.Monad[Function0] with scalaz.Comonad[Function0] with scalaz.Distributive[Function0]" class="delimiter">(</a><a href="#700146" title="=&gt; List[Int]">xs</a><span class="delimiter">)</span>.<a href="../../core/Free.scala.html#48257" title="(b: Int)(f: (Int, () =&gt; scalaz.Free[Function0,List[Int]]) =&gt; (Int, scalaz.Free[Function0,List[Int]]))(Int, List[Int])">foldRun</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><a href="#1692016" title="(Int, List[Int]) @unchecked" class="delimiter">(</a><span class="delimiter">(</span><a title="Int" id="707451">i</a>, <a title="() =&gt; scalaz.Free[Function0,List[Int]]" id="707452">f</a><span class="delimiter">)</span> =&gt; <span title="(_1: Int, _2: scalaz.Free[Function0,List[Int]])(Int, scalaz.Free[Function0,List[Int]])" class="delimiter">(</span><a href="#707451" title="Int">i</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="#707452" title="()scalaz.Free[Function0,List[Int]]">f</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;sort using heap took %d steps&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#705691" title="Int">steps</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="delimiter">{</span>
    // Use the stack.
    <span class="keyword">val</span> <a title="List[Int]" id="712591">sorted</a> = <a href="#704640" title="[F[+_], T](xs: List[T])(implicit evidence$3: scalaz.Applicative[F], implicit evidence$4: scalaz.Comonad[F], implicit evidence$5: scalaz.Order[T])List[T]">runQuickSort</a><span title="(xs: List[Int])(implicit evidence$3: scalaz.Applicative[scalaz.Scalaz.Id], implicit evidence$4: scalaz.Comonad[scalaz.Scalaz.Id], implicit evidence$5: scalaz.Order[Int])List[Int]" class="delimiter">[</span><a href="../../core/Id.scala.html#33406" title="scalaz.Scalaz.Id">Id</a>, <span title="Int">Int</span><span class="delimiter">]</span><a href="../../core/package.scala.html#30683" title="=&gt; scalaz.Traverse1[scalaz.Id.Id] with scalaz.Each[scalaz.Id.Id] with scalaz.Monad[scalaz.Id.Id] with scalaz.Comonad[scalaz.Id.Id] with scalaz.Cojoin[scalaz.Id.Id] with scalaz.Distributive[scalaz.Id.Id] with scalaz.Zip[scalaz.Id.Id] with scalaz.Unzip[scalaz.Id.Id] with scalaz.Cozip[scalaz.Id.Id]" class="delimiter">(</a><a href="#700146" title="=&gt; List[Int]">xs</a><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#712591" title="List[Int]">sorted</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">import</span> scalaz.concurrent._
  <span class="keyword">import</span> annotation.unchecked.uncheckedVariance
  <span class="keyword">type</span> <a title="[+A]scalaz.concurrent.Promise[A @scala.annotation.unchecked.uncheckedVariance]" id="700150">PromiseCov</a><span class="delimiter">[</span>+<a title="" id="700151">A</a><span class="delimiter">]</span> = <a href="../../concurrent/concurrent/Promise.scala.html#22783" title="scalaz.concurrent.Promise[A @scala.annotation.unchecked.uncheckedVariance]">Promise</a><span class="delimiter">[</span>A @uncheckedVariance<span class="delimiter">]</span>

  <span class="delimiter">{</span>
    // Run in parallel.
    <span class="keyword">val</span> <a title="List[Int]" id="713638">sorted</a> = <a href="#704640" title="[F[+_], T](xs: List[T])(implicit evidence$3: scalaz.Applicative[F], implicit evidence$4: scalaz.Comonad[F], implicit evidence$5: scalaz.Order[T])List[T]">runQuickSort</a><span title="(xs: List[Int])(implicit evidence$3: scalaz.Applicative[scalaz.example.TrampolineUsage.PromiseCov], implicit evidence$4: scalaz.Comonad[scalaz.example.TrampolineUsage.PromiseCov], implicit evidence$5: scalaz.Order[Int])List[Int]" class="delimiter">[</span><a href="../../concurrent/concurrent/Promise.scala.html#22783" title="scalaz.example.TrampolineUsage.PromiseCov">PromiseCov</a>, <span title="Int">Int</span><span class="delimiter">]</span><a href="../../concurrent/concurrent/Promise.scala.html#62075" title="implicit scalaz.concurrent.PromiseInstances.promiseInstance : (implicit s: scalaz.concurrent.Strategy)scalaz.Traverse[scalaz.concurrent.Promise] with scalaz.Monad[scalaz.concurrent.Promise] with scalaz.Comonad[scalaz.concurrent.Promise]" class="delimiter">(</a><a href="#700146" title="=&gt; List[Int]">xs</a><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#713638" title="List[Int]">sorted</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  /**Run using `F1` as a binding for lists longer than `threshold`, and `F2` otherwise. */
  <span class="keyword">def</span> <a title="[F[+_], F2[+_], T](xs: List[T], nat: scalaz.~&gt;[F2,F], threshold: Int)(implicit evidence$6: scalaz.Applicative[F], implicit evidence$7: scalaz.Applicative[F2], implicit evidence$8: scalaz.Order[T])scalaz.Free[F,List[T]]" id="715635">quickSort2</a><span class="delimiter">[</span><a title="[+_]" id="700156">F</a><span class="delimiter">[</span>+ <a title="" id="715636">_</a><span class="delimiter">]</span> : Applicative, <a title="[+_]" id="700157">F2</a><span class="delimiter">[</span>+ <a title="" id="715638">_</a><span class="delimiter">]</span> : Applicative, <a title="" id="700158">T</a>: Order<span class="delimiter">]</span><span class="delimiter">(</span><a title="List[T]" id="715630">xs</a>: <span title="List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="scalaz.~&gt;[F2,F]" id="715631">nat</a>: F2 <a href="../../core/NaturalTransformation.scala.html#19940" title="scalaz.~&gt;[F2,F]">~&gt;</a> F, <a title="Int" id="715632">threshold</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="../../core/Free.scala.html#10907" title="scalaz.Free[F,List[T]]">Free</a><span class="delimiter">[</span>F, List<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(as: List[T])scalaz.Free[F,List[T]]" id="715645">qs</a><span class="delimiter">(</span><a title="List[T]" id="715646">as</a>: <span title="List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../core/Free.scala.html#10907" title="scalaz.Free[F,List[T]]">Free</a><span class="delimiter">[</span>F, List<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span> =
      <span title="scalaz.Free[F,List[T]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#715646" title="List[T]">as</a>.<span title="(len: Int)Int">lengthCompare</span><span class="delimiter">(</span><a href="#715632" title="Int">threshold</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="scalaz.Free[F2,List[T]]" id="715651">free</a>: <a href="../../core/Free.scala.html#10907" title="scalaz.Free[F2,List[T]]">Free</a><span class="delimiter">[</span>F2, List<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#715635" title="[F[+_], F2[+_], T](xs: List[T], nat: scalaz.~&gt;[F2,F], threshold: Int)(implicit evidence$6: scalaz.Applicative[F], implicit evidence$7: scalaz.Applicative[F2], implicit evidence$8: scalaz.Order[T])scalaz.Free[F,List[T]]">quickSort2</a><span title="(xs: List[T], nat: scalaz.~&gt;[F2,F2], threshold: Int)(implicit evidence$6: scalaz.Applicative[F2], implicit evidence$7: scalaz.Applicative[F2], implicit evidence$8: scalaz.Order[T])scalaz.Free[F2,List[T]]" class="delimiter">[</span><a href="#700157" title="F2">F2</a>, <a href="#700157" title="F2">F2</a>, <a href="#700158" title="T">T</a><span class="delimiter">]</span><a href="#715635" title="scalaz.Applicative[F2]" class="delimiter">(</a><a href="#715646" title="List[T]">as</a>, <a href="../../core/NaturalTransformation.scala.html#19941" title="scalaz.NaturalTransformation.type">NaturalTransformation</a>.<a href="../../core/NaturalTransformation.scala.html#396607" title="[F[_]]=&gt; scalaz.~&gt;[F,F]">refl</a><span title="refl extends AnyRef with scalaz.~&gt;[F2,F2]" class="delimiter">[</span><a href="#700157" title="F2">F2</a><span class="delimiter">]</span>, <a href="#715632" title="Int">threshold</a><span class="delimiter">)</span>
        <a href="#715651" title="scalaz.Free[F2,List[T]]">free</a>.<a href="../../core/Free.scala.html#48235" title="(f: scalaz.~&gt;[F2,F])(implicit evidence$4: scalaz.Functor[F])scalaz.Free[F,List[T]]">mapSuspension</a><a href="#715635" title="scalaz.Applicative[F]" class="delimiter">(</a><a href="#715631" title="scalaz.~&gt;[F2,F]">nat</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#715635" title="[F[+_], F2[+_], T](xs: List[T], nat: scalaz.~&gt;[F2,F], threshold: Int)(implicit evidence$6: scalaz.Applicative[F], implicit evidence$7: scalaz.Applicative[F2], implicit evidence$8: scalaz.Order[T])scalaz.Free[F,List[T]]">quickSort2</a><span title="(xs: List[T], nat: scalaz.~&gt;[F2,F], threshold: Int)(implicit evidence$6: scalaz.Applicative[F], implicit evidence$7: scalaz.Applicative[F2], implicit evidence$8: scalaz.Order[T])scalaz.Free[F,List[T]]" class="delimiter">[</span><a href="#700156" title="F">F</a>, <a href="#700157" title="F2">F2</a>, <a href="#700158" title="T">T</a><span class="delimiter">]</span><a href="#715635" title="scalaz.Applicative[F]" class="delimiter">(</a><a href="#715646" title="List[T]">as</a>, <a href="#715631" title="scalaz.~&gt;[F2,F]">nat</a>, <a href="#715632" title="Int">threshold</a><span class="delimiter">)</span>

    <a href="#715630" title="List[T]">xs</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1692028" title="scalaz.Free[F,List[T]]">Nil</a> =&gt;
        <a href="../../core/Free.scala.html#44473" title="(value: =&gt; scala.collection.immutable.Nil.type)(implicit S: scalaz.Applicative[F])scalaz.Free[F,scala.collection.immutable.Nil.type]">return_</a> <a href="#1692033" title="(x: scalaz.Free[F,List[T]])scalaz.Free[F,List[T]]" class="delimiter">{</a>
          <span title="scala.collection.immutable.Nil.type">Nil</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#1692030" title="T" id="718706">x</a> <a href="#1692028" title="scalaz.Free[F,List[T]]">::</a> <a href="#1692030" title="List[T]" id="718707">tail</a> =&gt;
        <a href="../../core/Free.scala.html#44478" title="(value: =&gt; scalaz.Free[F,List[T]])(implicit S: scalaz.Applicative[F])scalaz.Free[F,List[T]]">suspend</a> <a href="#1692033" title="(x: scalaz.Free[F,List[T]])scalaz.Free[F,List[T]]" class="delimiter">{</a>
          <span class="keyword">val</span> <a href="#1692024" title="(x: (List[T], List[T]))(List[T], List[T])" class="delimiter">(</a><a href="#1692022" title="List[T]" id="718717">left</a>, <a href="#1692022" title="List[T]" id="718718">right</a><span class="delimiter">)</span> = <a href="#718707" title="List[T]">tail</a>.<span title="(p: T =&gt; Boolean)(List[T], List[T])">partition</span><a href="#1692022" title="(List[T], List[T]) @unchecked" class="delimiter">(</a><a href="../../core/syntax/OrderSyntax.scala.html#45124" title="(v: T)(implicit F0: scalaz.Order[T])scalaz.syntax.OrderOps[T]">_</a> <a href="../../core/syntax/OrderSyntax.scala.html#156660" title="(other: T)Boolean">&lt;</a> <a href="#718706" title="T">x</a><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">{</span>
            <a title="List[T]" id="719682">ls</a> &lt;- <a href="#715645" title="(as: List[T])scalaz.Free[F,List[T]]">qs</a><a href="../../core/Free.scala.html#48231" title="(f: List[T] =&gt; scalaz.Free[F,List[T]])scalaz.Free[F,List[T]]" class="delimiter">(</a><a href="#718717" title="List[T]">left</a><span class="delimiter">)</span>
            <a title="List[T]" id="719687">rs</a> &lt;- <a href="#715645" title="(as: List[T])scalaz.Free[F,List[T]]">qs</a><a href="../../core/Free.scala.html#48225" title="(f: List[T] =&gt; List[T])scalaz.Free[F,List[T]]" class="delimiter">(</a><a href="#718718" title="List[T]">right</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#719682" title="List[T]">ls</a> <a href="#719688" title="(prefix: List[T])List[T]">:::</a> <span class="delimiter">(</span><a href="#718706" title="T">x</a> <a href="#719689" title="(x: T)List[T]">::</a> <a href="#719687" title="List[T]">rs</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[F[+_], F2[+_], T](xs: List[T], nat: scalaz.~&gt;[F2,F], threshold: Int)(implicit evidence$9: scalaz.Applicative[F], implicit evidence$10: scalaz.Comonad[F], implicit evidence$11: scalaz.Applicative[F2], implicit evidence$12: scalaz.Order[T])List[T]" id="720118">runQuickSort2</a><span class="delimiter">[</span><a title="[+_]" id="700163">F</a><span class="delimiter">[</span>+ <a title="" id="720121">_</a><span class="delimiter">]</span> : Applicative : Comonad, <a title="[+_]" id="700164">F2</a><span class="delimiter">[</span>+ <a title="" id="720120">_</a><span class="delimiter">]</span> : Applicative, <a title="" id="700165">T</a>: Order<span class="delimiter">]</span><span class="delimiter">(</span><a title="List[T]" id="720112">xs</a>: <span title="List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="scalaz.~&gt;[F2,F]" id="720113">nat</a>: F2 <a href="../../core/NaturalTransformation.scala.html#19940" title="scalaz.~&gt;[F2,F]">~&gt;</a> F, <a title="Int" id="720114">threshold</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="List[T]">List</span><span class="delimiter">[</span>T<span class="delimiter">]</span> =
    <a href="#715635" title="[F[+_], F2[+_], T](xs: List[T], nat: scalaz.~&gt;[F2,F], threshold: Int)(implicit evidence$6: scalaz.Applicative[F], implicit evidence$7: scalaz.Applicative[F2], implicit evidence$8: scalaz.Order[T])scalaz.Free[F,List[T]]">quickSort2</a><span title="(xs: List[T], nat: scalaz.~&gt;[F2,F], threshold: Int)(implicit evidence$6: scalaz.Applicative[F], implicit evidence$7: scalaz.Applicative[F2], implicit evidence$8: scalaz.Order[T])scalaz.Free[F,List[T]]" class="delimiter">[</span><a href="#700163" title="F">F</a>, <a href="#700164" title="F2">F2</a>, <a href="#700165" title="T">T</a><span class="delimiter">]</span><a href="#720118" title="scalaz.Applicative[F]" class="delimiter">(</a><a href="#720112" title="List[T]">xs</a>, <a href="#720113" title="scalaz.~&gt;[F2,F]">nat</a>, <a href="#720114" title="Int">threshold</a><span class="delimiter">)</span>.<a href="../../core/Free.scala.html#48254" title="(f: F[scalaz.Free[F,List[T]]] =&gt; scalaz.Free[F,List[T]])List[T]">go</a><span class="delimiter">(</span><a title="F[scalaz.Free[F,List[T]]]" id="721246">f</a> =&gt; <a href="../../core/Comonad.scala.html#145940" title="[F[_]](implicit F: scalaz.Comonad[F])scalaz.Comonad[F]">Comonad</a><a href="#720118" title="(implicit F: scalaz.Comonad[F])scalaz.Comonad[F]" class="delimiter">[</a><a href="#700163" title="F">F</a><span class="delimiter">]</span>.<a href="../../core/Comonad.scala.html#34607" title="(p: F[scalaz.Free[F,List[T]]])scalaz.Free[F,List[T]]">copoint</a><span class="delimiter">(</span><a href="#721246" title="F[scalaz.Free[F,List[T]]]">f</a><span class="delimiter">)</span><span class="delimiter">)</span>


  <span class="delimiter">{</span>
    // mixed binding
    <span class="keyword">val</span> <a title="promise2Id extends AnyRef with scalaz.~&gt;[scalaz.Scalaz.Id,scalaz.example.TrampolineUsage.PromiseCov]" id="721564">promise2Id</a> = <a href="#721566" title="scalaz.~&gt;[scalaz.Scalaz.Id,scalaz.example.TrampolineUsage.PromiseCov]" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with scalaz.~&gt;[scalaz.Scalaz.Id,scalaz.example.TrampolineUsage.PromiseCov]" id="721566" class="delimiter">(</a>Id <a href="../../core/NaturalTransformation.scala.html#19940" title="scalaz.~&gt;[scalaz.Scalaz.Id,scalaz.example.TrampolineUsage.PromiseCov]">~&gt;</a> PromiseCov<span class="delimiter">)</span> <span class="delimiter">{</span> <span class="keyword">def</span> <a title="[A](a: A)scalaz.concurrent.Promise[A]" id="721568">apply</a><span class="delimiter">[</span><a title="" id="721570">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A" id="721571">a</a>: <a href="#721570" title="A">A</a><span class="delimiter">)</span> = <a href="../../concurrent/concurrent/Promise.scala.html#62050" title="(a: =&gt; A)(implicit s: scalaz.concurrent.Strategy)scalaz.concurrent.Promise[A]">Promise</a><a href="../../concurrent/concurrent/Strategy.scala.html#59718" title="=&gt; scalaz.concurrent.Strategy" class="delimiter">(</a><a href="#721571" title="A">a</a><span class="delimiter">)</span><span class="delimiter">}</span>

    // run in parallel for lists larger then 8 elements, and on the stack for lists smaller.
    <span class="keyword">val</span> <a title="List[Int]" id="721565">sorted</a> = <a href="#720118" title="[F[+_], F2[+_], T](xs: List[T], nat: scalaz.~&gt;[F2,F], threshold: Int)(implicit evidence$9: scalaz.Applicative[F], implicit evidence$10: scalaz.Comonad[F], implicit evidence$11: scalaz.Applicative[F2], implicit evidence$12: scalaz.Order[T])List[T]">runQuickSort2</a><span title="(xs: List[Int], nat: scalaz.~&gt;[scalaz.Scalaz.Id,scalaz.example.TrampolineUsage.PromiseCov], threshold: Int)(implicit evidence$9: scalaz.Applicative[scalaz.example.TrampolineUsage.PromiseCov], implicit evidence$10: scalaz.Comonad[scalaz.example.TrampolineUsage.PromiseCov], implicit evidence$11: scalaz.Applicative[scalaz.Scalaz.Id], implicit evidence$12: scalaz.Order[Int])List[Int]" class="delimiter">[</span><a href="../../concurrent/concurrent/Promise.scala.html#22783" title="scalaz.example.TrampolineUsage.PromiseCov">PromiseCov</a>, <a href="../../core/Id.scala.html#33406" title="scalaz.Scalaz.Id">Id</a>, <span title="Int">Int</span><span class="delimiter">]</span><a href="../../concurrent/concurrent/Promise.scala.html#62075" title="implicit scalaz.concurrent.PromiseInstances.promiseInstance : (implicit s: scalaz.concurrent.Strategy)scalaz.Traverse[scalaz.concurrent.Promise] with scalaz.Monad[scalaz.concurrent.Promise] with scalaz.Comonad[scalaz.concurrent.Promise]" class="delimiter">(</a><a href="#700146" title="=&gt; List[Int]">xs</a>, <a href="#721564" title="promise2Id extends AnyRef with scalaz.~&gt;[scalaz.Scalaz.Id,scalaz.example.TrampolineUsage.PromiseCov]">promise2Id</a>, <span title="Int(8)" class="int">8</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#721565" title="List[Int]">sorted</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  // Ackermann function. Blows the stack for very small inputs.
  <span class="keyword">def</span> <a title="(m: Int, n: Int)Int" id="700166">ack</a><span class="delimiter">(</span><a title="Int" id="724320">m</a>: <span title="Int">Int</span>, <a title="Int" id="724321">n</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> =
    <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#724320" title="Int">m</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="#724321" title="Int">n</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>
    <span class="keyword">else</span> <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#724321" title="Int">n</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="#700166" title="(m: Int, n: Int)Int">ack</a><span class="delimiter">(</span><a href="#724320" title="Int">m</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#700166" title="(m: Int, n: Int)Int">ack</a><span class="delimiter">(</span><a href="#724320" title="Int">m</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>, <a href="#700166" title="(m: Int, n: Int)Int">ack</a><span class="delimiter">(</span><a href="#724320" title="Int">m</a>, <a href="#724321" title="Int">n</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>

  // Trampolined ackermann function. Never blows the stack, even for large inputs.
  <span class="keyword">def</span> <a title="(m: Int, n: Int)scalaz.Free.Trampoline[Int]" id="700167">ackermann</a><span class="delimiter">(</span><a title="Int" id="739115">m</a>: <span title="Int">Int</span>, <a title="Int" id="739116">n</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="../../core/Free.scala.html#10907" title="scalaz.Free.Trampoline[Int]">Trampoline</a><span class="delimiter">[</span>Int<span class="delimiter">]</span> =
    <span title="scalaz.Free[Function0,Int]" class="keyword">if</span> <span class="delimiter">(</span><a href="#739115" title="Int">m</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="../../core/Free.scala.html#44473" title="(value: =&gt; Int)(implicit S: scalaz.Applicative[Function0])scalaz.Free[Function0,Int]">return_</a><a href="../../core/std/Function.scala.html#44548" title="=&gt; scalaz.Traverse[Function0] with scalaz.Monad[Function0] with scalaz.Comonad[Function0] with scalaz.Distributive[Function0]" class="delimiter">(</a><a href="#739116" title="Int">n</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <span title="scalaz.Free[Function0,Int]" class="keyword">if</span> <span class="delimiter">(</span><a href="#739116" title="Int">n</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="../../core/Free.scala.html#44478" title="(value: =&gt; scalaz.Free[Function0,Int])(implicit S: scalaz.Applicative[Function0])scalaz.Free[Function0,Int]">suspend</a><a href="../../core/std/Function.scala.html#44548" title="=&gt; scalaz.Traverse[Function0] with scalaz.Monad[Function0] with scalaz.Comonad[Function0] with scalaz.Distributive[Function0]" class="delimiter">(</a><a href="#700167" title="(m: Int, n: Int)scalaz.Free.Trampoline[Int]">ackermann</a><span class="delimiter">(</span><a href="#739115" title="Int">m</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <span class="keyword">for</span> <span class="delimiter">{</span>
      <a title="Int" id="751702">a</a> &lt;- <a href="../../core/Free.scala.html#44478" title="(value: =&gt; scalaz.Free[Function0,Int])(implicit S: scalaz.Applicative[Function0])scalaz.Free[Function0,Int]">suspend</a><a href="../../core/Free.scala.html#48231" title="(f: Int =&gt; scalaz.Free[Function0,Int])scalaz.Free[Function0,Int]" class="delimiter">(</a><a href="#700167" title="(m: Int, n: Int)scalaz.Free.Trampoline[Int]">ackermann</a><span class="delimiter">(</span><a href="#739115" title="Int">m</a>, <a href="#739116" title="Int">n</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a title="Int" id="755517">b</a> &lt;- <a href="../../core/Free.scala.html#44478" title="(value: =&gt; scalaz.Free[Function0,Int])(implicit S: scalaz.Applicative[Function0])scalaz.Free[Function0,Int]">suspend</a><a href="../../core/Free.scala.html#48225" title="(f: Int =&gt; Int)scalaz.Free[Function0,Int]" class="delimiter">(</a><a href="#700167" title="(m: Int, n: Int)scalaz.Free.Trampoline[Int]">ackermann</a><span class="delimiter">(</span><a href="#739115" title="Int">m</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>, <a href="#751702" title="Int">a</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#755517" title="Int">b</a>


<span class="delimiter">}</span>

        </pre>
    </body>
</html>