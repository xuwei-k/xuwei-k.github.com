<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>netty-websockets/unfiltered/netty/websockets/plans.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> unfiltered.netty.websockets

<span class="keyword">import</span> unfiltered.request.<span class="delimiter">{</span> GET, Host, HttpRequest <span class="delimiter">}</span>
<span class="keyword">import</span> unfiltered.netty.<span class="delimiter">{</span> ExceptionHandler, ReceivedMessage, RequestBinding <span class="delimiter">}</span>

<span class="keyword">import</span> org.jboss.<span class="delimiter">{</span> netty =&gt; jnetty <span class="delimiter">}</span>
<span class="keyword">import</span> jnetty.buffer.ChannelBuffers
<span class="keyword">import</span> jnetty.channel.<span class="delimiter">{</span>
  Channel, ChannelEvent, ChannelFuture, ChannelFutureListener,
  ChannelHandlerContext, MessageEvent, SimpleChannelUpstreamHandler
<span class="delimiter">}</span>
<span class="keyword">import</span> jnetty.handler.codec.http.HttpHeaders
<span class="keyword">import</span> jnetty.handler.codec.http.<span class="delimiter">{</span> HttpRequest =&gt; NHttpRequest, DefaultHttpResponse <span class="delimiter">}</span>
<span class="keyword">import</span> jnetty.handler.codec.http.websocketx.WebSocketServerHandshaker
<span class="keyword">import</span> jnetty.util.CharsetUtil


/** Serves the same purpose of unfiltered.netty.ServerErrorResponse, which is to
 *  satisfy ExceptionHandler#onException, except that it is not specific to the HTTP protocol.
 *  It will simply log the Throwable and close the Channel */
<span class="keyword">trait</span> <a title="trait CloseOnException extends AnyRef" id="10938">CloseOnException</a> <span title="Unit" class="delimiter">{</span> self: ExceptionHandler =&gt;
  <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, t: Throwable)Unit" id="68187">onException</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="68190">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="Throwable" id="68191">t</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#68191" title="Throwable">t</a>.<span title="()Unit">printStackTrace</span>
    <a href="#68190" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="()org.jboss.netty.channel.ChannelFuture">close</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span title="AnyRef" class="keyword">private</span> <span class="delimiter">[</span>websockets<span class="delimiter">]</span> <span class="keyword">object</span> <a title="unfiltered.netty.websockets.WSLocation.type" id="11038">WSLocation</a> <a href="#11039" title="unfiltered.netty.websockets.WSLocation.type" class="delimiter">{</a>
  <span class="keyword">def</span> <a title="[T](r: unfiltered.request.HttpRequest[T])String" id="68440">apply</a><span class="delimiter">[</span><a title="" id="68442">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="unfiltered.request.HttpRequest[T]" id="68444">r</a>: <a href="../../../../unfiltered/unfiltered/unfiltered/request/HttpRequest.scala.html#7615" title="unfiltered.request.HttpRequest[T]">HttpRequest</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%s://%s%s&quot;</span> <span title="(args: Any*)String">format</span><span class="delimiter">(</span><span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="#68444" title="unfiltered.request.HttpRequest[T]">r</a>.<a href="../../../../unfiltered/unfiltered/unfiltered/request/HttpRequest.scala.html#12739" title="=&gt; Boolean">isSecure</a><span class="delimiter">)</span> <span title="String(&quot;wss&quot;)" class="string">&quot;wss&quot;</span> <span class="keyword">else</span> <span title="String(&quot;ws&quot;)" class="string">&quot;ws&quot;</span>, <a href="../../../../unfiltered/unfiltered/unfiltered/request/headers.scala.html#17611" title="(req: unfiltered.request.HttpRequest[T])Option[String]">Host</a><span class="delimiter">(</span><a href="#68444" title="unfiltered.request.HttpRequest[T]">r</a><span class="delimiter">)</span>.<span title="=&gt; String">get</span>, <a href="#68444" title="unfiltered.request.HttpRequest[T]">r</a>.<a href="../../../../unfiltered/unfiltered/unfiltered/request/HttpRequest.scala.html#12734" title="=&gt; String">uri</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

/** Provides an extension point for netty ChannelHandlers that wish to
 *  support the WebSocket protocol */
<span title="AnyRef" class="keyword">trait</span> <a title="trait Plan extends org.jboss.netty.channel.SimpleChannelUpstreamHandler with unfiltered.netty.ExceptionHandler" id="10995">Plan</a> <span title="Unit" class="keyword">extends</span> <span title="org.jboss.netty.channel.SimpleChannelUpstreamHandler">SimpleChannelUpstreamHandler</span> <span class="keyword">with</span> <a href="../../../../netty/unfiltered/netty/exceptions.scala.html#9773" title="unfiltered.netty.ExceptionHandler">ExceptionHandler</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> jnetty.channel.ExceptionEvent
  <span class="keyword">import</span> jnetty.handler.codec.http.websocketx.<span class="delimiter">{</span>
    WebSocketHandshakeException, WebSocketServerHandshakerFactory
  <span class="delimiter">}</span>
  <span class="keyword">import</span> scala.util.control.<span title="scala.util.control.Exception.type">Exception</span>.catching

  <span class="keyword">def</span> <a title="=&gt; unfiltered.netty.websockets.Intent" id="68457">intent</a>: <span title="unfiltered.netty.websockets.Intent">Intent</span>

  <span class="keyword">def</span> <a title="=&gt; (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit" id="68458">pass</a>: <span title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit">PassHandler</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, event: org.jboss.netty.channel.MessageEvent)Unit" id="68459">messageReceived</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="68470">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.MessageEvent" id="68471">event</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span><span class="delimiter">)</span> =
    <a href="#68471" title="org.jboss.netty.channel.MessageEvent">event</a>.<span title="()Object">getMessage</span> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#122646" title="Unit">http</a>: NHttpRequest =&gt; <a href="#68460" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, request: org.jboss.netty.handler.codec.http.HttpRequest, event: org.jboss.netty.channel.MessageEvent)Unit">upgrade</a><a href="#122649" title="(x: Unit)Unit" class="delimiter">(</a><a href="#68470" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#122647" title="org.jboss.netty.handler.codec.http.HttpRequest">http</a>, <a href="#68471" title="org.jboss.netty.channel.MessageEvent">event</a><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt; <a href="#68458" title="(v1: org.jboss.netty.channel.ChannelHandlerContext, v2: org.jboss.netty.channel.ChannelEvent)Unit">pass</a><a href="#122649" title="(x: Unit)Unit" class="delimiter">(</a><a href="#68470" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#68471" title="org.jboss.netty.channel.MessageEvent">event</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  /** `Lifts` an HTTP request into a WebSocket request.
   *  If the HTTP request handling intent is not defined or results
   *   in a Pass, the `pass` method will be invoked.
   *  If the HTTP request handling intent is
   *   defined for the HttpRequest, its SocketIntent return value will be used to
   *   evaluate WebSocket protocol requests
   *  If an HTTP intent filter is matched but this is not a websocket request,
   *    the `pass` method will be invoked. */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, request: org.jboss.netty.handler.codec.http.HttpRequest, event: org.jboss.netty.channel.MessageEvent)Unit" id="68460">upgrade</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="68475">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>,
                      <a title="org.jboss.netty.handler.codec.http.HttpRequest" id="68476">request</a>: <span title="org.jboss.netty.handler.codec.http.HttpRequest">NHttpRequest</span>,
                      <a title="org.jboss.netty.channel.MessageEvent" id="68477">event</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span><span class="delimiter">)</span> =
    <span title="unfiltered.netty.RequestBinding" class="keyword">new</span> <a href="../../../../netty/unfiltered/netty/bindings.scala.html#9863" title="unfiltered.netty.RequestBinding">RequestBinding</a><span class="delimiter">(</span><a href="../../../../netty/unfiltered/netty/bindings.scala.html#65204" title="(request: org.jboss.netty.handler.codec.http.HttpRequest, context: org.jboss.netty.channel.ChannelHandlerContext, event: org.jboss.netty.channel.MessageEvent)unfiltered.netty.ReceivedMessage">ReceivedMessage</a><span class="delimiter">(</span><a href="#68476" title="org.jboss.netty.handler.codec.http.HttpRequest">request</a>, <a href="#68475" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#68477" title="org.jboss.netty.channel.MessageEvent">event</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> r @ <a href="../../../../unfiltered/unfiltered/unfiltered/request/methods.scala.html#34957" title="(req: unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage])Option[unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage]]">GET</a><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
        <a href="#68457" title="=&gt; unfiltered.netty.websockets.Intent">intent</a>.<span title="(that: PartialFunction[unfiltered.netty.RequestBinding,unfiltered.netty.websockets.SocketIntent])PartialFunction[unfiltered.netty.RequestBinding,unfiltered.netty.websockets.SocketIntent]">orElse</span><span title="(v1: unfiltered.netty.RequestBinding)unfiltered.netty.websockets.SocketIntent" class="delimiter">(</span><a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[unfiltered.netty.RequestBinding,unfiltered.netty.websockets.SocketIntent] with Serializable" id="68508" class="delimiter">{</a> <span class="keyword">case</span> _ =&gt; <a href="#122656" title="(x: B1)B1">Pass</a> <span class="delimiter">}</span>: <span title="unfiltered.netty.websockets.Intent">Intent</span><span class="delimiter">)</span><a href="#122710" title="(x: Unit)Unit" class="delimiter">(</a><a href="#122706" title="unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage]">r</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="package.scala.html#12575" title="Unit">Pass</a> =&gt; <a href="#68458" title="(v1: org.jboss.netty.channel.ChannelHandlerContext, v2: org.jboss.netty.channel.ChannelEvent)Unit">pass</a><a href="#122698" title="(x: Unit)Unit" class="delimiter">(</a><a href="#68475" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#68477" title="org.jboss.netty.channel.MessageEvent">event</a><span class="delimiter">)</span>
          <span class="keyword">case</span> socketIntent =&gt;
            <span class="keyword">def</span> <a title="=&gt; PartialFunction[unfiltered.netty.websockets.SocketCallback,Unit]" id="68539">attempt</a> = <a href="#122691" title="unfiltered.netty.websockets.SocketIntent">socketIntent</a>.<span title="(that: PartialFunction[unfiltered.netty.websockets.SocketCallback,Unit])PartialFunction[unfiltered.netty.websockets.SocketCallback,Unit]">orElse</span><span class="delimiter">(</span><a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[unfiltered.netty.websockets.SocketCallback,Unit] with Serializable" id="68556" class="delimiter">{</a> <span class="keyword">case</span> _ =&gt; <a href="#122668" title="(x: B1)B1" class="delimiter">(</a><span class="delimiter">)</span> <span class="delimiter">}</span>: <span title="unfiltered.netty.websockets.SocketIntent">SocketIntent</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="org.jboss.netty.handler.codec.http.websocketx.WebSocketServerHandshakerFactory" id="68540">factory</a> =
              <span title="org.jboss.netty.handler.codec.http.websocketx.WebSocketServerHandshakerFactory" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.http.websocketx.WebSocketServerHandshakerFactory">WebSocketServerHandshakerFactory</span><span class="delimiter">(</span>
                <a href="#68440" title="(r: unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage])String">WSLocation</a><span class="delimiter">(</span><a href="#122706" title="unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage]">r</a><span class="delimiter">)</span>, <span title="Null(null)" class="keyword">null</span>/* subprotocols */, <span title="Boolean(false)" class="keyword">false</span>/* allowExtensions */<span class="delimiter">)</span>
            <a href="#68540" title="org.jboss.netty.handler.codec.http.websocketx.WebSocketServerHandshakerFactory">factory</a>.<span title="(x$1: org.jboss.netty.handler.codec.http.HttpRequest)org.jboss.netty.handler.codec.http.websocketx.WebSocketServerHandshaker">newHandshaker</span><span title="Unit" class="delimiter">(</span><a href="#68476" title="org.jboss.netty.handler.codec.http.HttpRequest">request</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a href="#122678" title="Unit" class="keyword">null</a> =&gt;
                <a href="#68540" title="org.jboss.netty.handler.codec.http.websocketx.WebSocketServerHandshakerFactory">factory</a>.<span title="(x$1: org.jboss.netty.channel.Channel)Unit">sendUnsupportedWebSocketVersionResponse</span><a href="#122683" title="(x: Unit)Unit" class="delimiter">(</a><a href="#68475" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">case</span> shaker =&gt;
                // handle handshake exceptions for the use case
                // of mounting an http plan on the same path
                // as a websocket handler
                <span title="(exceptions: Class[_]*)util.control.Exception.Catch[Nothing]">catching</span><span class="delimiter">(</span>classOf<span title="Class[org.jboss.netty.handler.codec.http.websocketx.WebSocketHandshakeException](classOf[org.jboss.netty.handler.codec.http.websocketx.WebSocketHandshakeException])" class="delimiter">[</span>WebSocketHandshakeException<span class="delimiter">]</span><span class="delimiter">)</span>.<span title="(body: =&gt; Unit)scala.util.Either[Throwable,Unit]">either</span> <span class="delimiter">{</span>
                  <a href="#122678" title="org.jboss.netty.handler.codec.http.websocketx.WebSocketServerHandshaker">shaker</a>.<span title="(x$1: org.jboss.netty.channel.Channel, x$2: org.jboss.netty.handler.codec.http.HttpRequest)org.jboss.netty.channel.ChannelFuture">handshake</span><span class="delimiter">(</span><a href="#68475" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>, <a href="#68476" title="org.jboss.netty.handler.codec.http.HttpRequest">request</a><span class="delimiter">)</span>.<span title="(x$1: org.jboss.netty.channel.ChannelFutureListener)Unit">addListener</span><span class="delimiter">(</span><a href="#68654" title="org.jboss.netty.channel.ChannelFutureListener" class="keyword">new</a> <a title="anonymous class $anon extends Object with org.jboss.netty.channel.ChannelFutureListener" id="68654">ChannelFutureListener</a> <span class="delimiter">{</span>
                    <span class="keyword">def</span> <a title="(hf: org.jboss.netty.channel.ChannelFuture)Unit" id="68656">operationComplete</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelFuture" id="68658">hf</a>: <span title="org.jboss.netty.channel.ChannelFuture">ChannelFuture</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                      <span class="keyword">val</span> <a title="org.jboss.netty.channel.Channel" id="68662">chan</a> = <a href="#68658" title="org.jboss.netty.channel.ChannelFuture">hf</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>
                      <a href="#68539" title="(v1: unfiltered.netty.websockets.SocketCallback)Unit">attempt</a><span class="delimiter">(</span><a href="websockets.scala.html#68666" title="(socket: unfiltered.netty.websockets.WebSocket)unfiltered.netty.websockets.Open">Open</a><span class="delimiter">(</span><a href="websockets.scala.html#68678" title="(channel: org.jboss.netty.channel.Channel)unfiltered.netty.websockets.WebSocket">WebSocket</a><span class="delimiter">(</span><a href="#68662" title="org.jboss.netty.channel.Channel">chan</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                      <a href="#68662" title="org.jboss.netty.channel.Channel">chan</a>.<span title="()org.jboss.netty.channel.ChannelFuture">getCloseFuture</span>.<span title="(x$1: org.jboss.netty.channel.ChannelFutureListener)Unit">addListener</span><span class="delimiter">(</span><a href="#68691" title="org.jboss.netty.channel.ChannelFutureListener" class="keyword">new</a> <a title="anonymous class $anon extends Object with org.jboss.netty.channel.ChannelFutureListener" id="68691">ChannelFutureListener</a> <span class="delimiter">{</span>
                        <span class="keyword">def</span> <a title="(cf: org.jboss.netty.channel.ChannelFuture)Unit" id="68693">operationComplete</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelFuture" id="68695">cf</a>: <span title="org.jboss.netty.channel.ChannelFuture">ChannelFuture</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
                          <a href="#68539" title="(v1: unfiltered.netty.websockets.SocketCallback)Unit">attempt</a><span class="delimiter">(</span><a href="websockets.scala.html#68701" title="(socket: unfiltered.netty.websockets.WebSocket)unfiltered.netty.websockets.Close">Close</a><span class="delimiter">(</span><a href="websockets.scala.html#68678" title="(channel: org.jboss.netty.channel.Channel)unfiltered.netty.websockets.WebSocket">WebSocket</a><span class="delimiter">(</span><a href="#68695" title="org.jboss.netty.channel.ChannelFuture">cf</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                        <span class="delimiter">}</span>
                      <span class="delimiter">}</span><span class="delimiter">)</span>
                      <a href="#68662" title="org.jboss.netty.channel.Channel">chan</a>.<span title="()org.jboss.netty.channel.ChannelPipeline">getPipeline</span>.<span title="(x$1: org.jboss.netty.channel.ChannelHandler, x$2: String, x$3: org.jboss.netty.channel.ChannelHandler)Unit">replace</span><span class="delimiter">(</span>
                        <a href="#10995" title="unfiltered.netty.websockets.Plan">Plan</a>.<span class="keyword">this</span>, <a href="#68475" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()String">getName</span>,
                        <a href="#69117" title="(intent: unfiltered.netty.websockets.SocketIntent, pass: (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit, shaker: org.jboss.netty.handler.codec.http.websocketx.WebSocketServerHandshaker, exceptions: unfiltered.netty.ExceptionHandler)unfiltered.netty.websockets.SocketPlan">SocketPlan</a><span class="delimiter">(</span><a href="#122691" title="unfiltered.netty.websockets.SocketIntent">socketIntent</a>, <a href="#68458" title="=&gt; (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit">pass</a>, <a href="#122678" title="org.jboss.netty.handler.codec.http.websocketx.WebSocketServerHandshaker">shaker</a>, <a href="#10995" title="unfiltered.netty.websockets.Plan">Plan</a>.<span class="keyword">this</span><span class="delimiter">)</span><span class="delimiter">)</span>
                    <span class="delimiter">}</span>
                  <span class="delimiter">}</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>.<span title="(fa: Throwable =&gt; Unit, fb: Unit =&gt; Unit)Unit">fold</span><a href="#122683" title="(x: Unit)Unit" class="delimiter">(</a><span class="delimiter">{</span> <a title="Throwable" id="68788">_</a> =&gt; <a href="#68458" title="(v1: org.jboss.netty.channel.ChannelHandlerContext, v2: org.jboss.netty.channel.ChannelEvent)Unit">pass</a><span class="delimiter">(</span><a href="#68475" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#68477" title="org.jboss.netty.channel.MessageEvent">event</a><span class="delimiter">)</span> <span class="delimiter">}</span>, <a href="#68792" title="(x: Unit)Unit">identity</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> _ =&gt; <a href="#68458" title="(v1: org.jboss.netty.channel.ChannelHandlerContext, v2: org.jboss.netty.channel.ChannelEvent)Unit">pass</a><a href="#122710" title="(x: Unit)Unit" class="delimiter">(</a><a href="#68475" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#68477" title="org.jboss.netty.channel.MessageEvent">event</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  /** By default, when a websocket handler `passes` it writes an Http Forbidden response
   *  to the channel in DefaultPassHandler. To override this behavior, call this method
   *   with a function to handle the ChannelEvent with custom behavior */
  <span class="keyword">def</span> <a title="(handler: (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit)org.jboss.netty.channel.SimpleChannelUpstreamHandler with unfiltered.netty.websockets.Plan with unfiltered.netty.websockets.CloseOnException{val intent: unfiltered.netty.websockets.Intent; val pass: (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit}" id="68461">onPass</a><span class="delimiter">(</span><a title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit" id="68797">handler</a>: <span title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit">PassHandler</span><span class="delimiter">)</span> = <a href="#68801" title="(intentIn: unfiltered.netty.websockets.Intent, passIn: (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit)org.jboss.netty.channel.SimpleChannelUpstreamHandler with unfiltered.netty.websockets.Plan with unfiltered.netty.websockets.CloseOnException{val intent: unfiltered.netty.websockets.Intent; val pass: (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit}">Planify</a><span class="delimiter">(</span><a href="#68457" title="=&gt; unfiltered.netty.websockets.Intent">intent</a>, <a href="#68797" title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit">handler</a><span class="delimiter">)</span>
<span class="delimiter">}</span>


/** The result of defined Intent should result in a SocketPlan value.
 *  SocketPlans are handlers for message frames in the WebSocket protocol.
 *  If an unexpected message is received by a SocketPlan, the request handling will automatically
 *  be delegated the PassHandler. As part of the WebSocket protocol, server errors should
 *  be reported to the websocket before closing. This is handled for you. */
<span class="keyword">case class</span> <a title="class SocketPlan extends org.jboss.netty.channel.SimpleChannelUpstreamHandler with Product with Serializable" id="69117">SocketPlan</a><a href="#69117" title="Product" class="delimiter">(</a><a title="unfiltered.netty.websockets.SocketIntent" id="68746">intent</a>: <span title="unfiltered.netty.websockets.SocketIntent">SocketIntent</span>,
                      <a title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit" id="68747">pass</a>: <span title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit">PassHandler</span>,
                      <a title="org.jboss.netty.handler.codec.http.websocketx.WebSocketServerHandshaker" id="68748">shaker</a>: <span title="org.jboss.netty.handler.codec.http.websocketx.WebSocketServerHandshaker">WebSocketServerHandshaker</span>,
                      <a title="unfiltered.netty.ExceptionHandler" id="68749">exceptions</a>: <a href="../../../../netty/unfiltered/netty/exceptions.scala.html#9773" title="unfiltered.netty.ExceptionHandler">ExceptionHandler</a><span class="delimiter">)</span>
  <span class="keyword">extends</span> <span title="org.jboss.netty.channel.SimpleChannelUpstreamHandler">SimpleChannelUpstreamHandler</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> jnetty.channel.ExceptionEvent
  <span class="keyword">import</span> jnetty.handler.codec.http.websocketx.<span class="delimiter">{</span>
    CloseWebSocketFrame, PingWebSocketFrame,
    PongWebSocketFrame, TextWebSocketFrame,
    WebSocketFrame
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; PartialFunction[unfiltered.netty.websockets.SocketCallback,Unit]" id="68765">attempt</a> = <a href="#68746" title="=&gt; unfiltered.netty.websockets.SocketIntent">intent</a>.<span title="(that: PartialFunction[unfiltered.netty.websockets.SocketCallback,Unit])PartialFunction[unfiltered.netty.websockets.SocketCallback,Unit]">orElse</span><span class="delimiter">(</span><a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[unfiltered.netty.websockets.SocketCallback,Unit] with Serializable" id="68861" class="delimiter">{</a> <span class="keyword">case</span> _ =&gt; <a href="#122718" title="(x: B1)B1" class="delimiter">(</a><span class="delimiter">)</span> <span class="delimiter">}</span>: <span title="unfiltered.netty.websockets.SocketIntent">SocketIntent</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, event: org.jboss.netty.channel.MessageEvent)Unit" id="68766">messageReceived</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="68888">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.MessageEvent" id="68889">event</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span><span class="delimiter">)</span> =
    <a href="#68889" title="org.jboss.netty.channel.MessageEvent">event</a>.<a href="#122734" title="()Object">getMessage</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#122728" title="Unit">c</a>: CloseWebSocketFrame =&gt;
        <a href="#68748" title="=&gt; org.jboss.netty.handler.codec.http.websocketx.WebSocketServerHandshaker">shaker</a>.<span title="(x$1: org.jboss.netty.channel.Channel, x$2: org.jboss.netty.handler.codec.http.websocketx.CloseWebSocketFrame)org.jboss.netty.channel.ChannelFuture">close</span><a href="#122734" title="(x: Unit)Unit" class="delimiter">(</a><a href="#68888" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>, <a href="#122729" title="org.jboss.netty.handler.codec.http.websocketx.CloseWebSocketFrame">c</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#122728" title="Unit">p</a>: PingWebSocketFrame =&gt;
        <a href="#68888" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="(x$1: Any)org.jboss.netty.channel.ChannelFuture">write</span><a href="#122734" title="(x: Unit)Unit" class="delimiter">(</a><span title="(x$1: org.jboss.netty.buffer.ChannelBuffer)org.jboss.netty.handler.codec.http.websocketx.PongWebSocketFrame" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.http.websocketx.PongWebSocketFrame">PongWebSocketFrame</span><span class="delimiter">(</span><a href="#122730" title="org.jboss.netty.handler.codec.http.websocketx.PingWebSocketFrame">p</a>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getBinaryData</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#122728" title="Unit">t</a>: TextWebSocketFrame =&gt;
        <a href="#68765" title="(v1: unfiltered.netty.websockets.SocketCallback)Unit">attempt</a><a href="#122734" title="(x: Unit)Unit" class="delimiter">(</a><a href="websockets.scala.html#68964" title="(socket: unfiltered.netty.websockets.WebSocket, msg: unfiltered.netty.websockets.Msg)unfiltered.netty.websockets.Message">Message</a><span class="delimiter">(</span><a href="websockets.scala.html#68678" title="(channel: org.jboss.netty.channel.Channel)unfiltered.netty.websockets.WebSocket">WebSocket</a><span class="delimiter">(</span><a href="#68888" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span><span class="delimiter">)</span>, <a href="websockets.scala.html#68983" title="(txt: String)unfiltered.netty.websockets.Text">Text</a><span class="delimiter">(</span><a href="#122731" title="org.jboss.netty.handler.codec.http.websocketx.TextWebSocketFrame">t</a>.<span title="()String">getText</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#122728" title="Unit">f</a>: WebSocketFrame =&gt;
        // only text frames are supported
        <a href="#68747" title="(v1: org.jboss.netty.channel.ChannelHandlerContext, v2: org.jboss.netty.channel.ChannelEvent)Unit">pass</a><a href="#122734" title="(x: Unit)Unit" class="delimiter">(</a><a href="#68888" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#68889" title="org.jboss.netty.channel.MessageEvent">event</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, event: org.jboss.netty.channel.ExceptionEvent)Unit" id="68767">exceptionCaught</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="68996">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.ExceptionEvent" id="68997">event</a>: <span title="org.jboss.netty.channel.ExceptionEvent">ExceptionEvent</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#68765" title="(v1: unfiltered.netty.websockets.SocketCallback)Unit">attempt</a><span class="delimiter">(</span><a href="websockets.scala.html#69002" title="(socket: unfiltered.netty.websockets.WebSocket, err: Throwable)unfiltered.netty.websockets.Error">Error</a><span class="delimiter">(</span><a href="websockets.scala.html#68678" title="(channel: org.jboss.netty.channel.Channel)unfiltered.netty.websockets.WebSocket">WebSocket</a><span class="delimiter">(</span><a href="#68996" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span><span class="delimiter">)</span>, <a href="#68997" title="org.jboss.netty.channel.ExceptionEvent">event</a>.<span title="()Throwable">getCause</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#68749" title="=&gt; unfiltered.netty.ExceptionHandler">exceptions</a>.<a href="../../../../netty/unfiltered/netty/exceptions.scala.html#58552" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, t: Throwable)Unit">onException</a><span class="delimiter">(</span><a href="#68996" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#68997" title="org.jboss.netty.channel.ExceptionEvent">event</a>.<span title="()Throwable">getCause</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

/** A companion module for building web socket Plans. These plans have default CloseOnException
 *  error handling baked in. To your own ExceptionHandler, Instantiate an instance of Planify
 *  yourself mixing a custom ExceptionHandler implementation */
<span class="keyword">object</span> <a title="unfiltered.netty.websockets.Planify.type" id="11008">Planify</a> <a href="#11009" title="unfiltered.netty.websockets.Planify.type" class="delimiter">{</a>
  /** Creates a WebSocket Plan with a custom PassHandler function */
  <span class="keyword">def</span> <a title="(intentIn: unfiltered.netty.websockets.Intent, passIn: (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit)org.jboss.netty.channel.SimpleChannelUpstreamHandler with unfiltered.netty.websockets.Plan with unfiltered.netty.websockets.CloseOnException{val intent: unfiltered.netty.websockets.Intent; val pass: (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit}" id="68801">apply</a><span class="delimiter">(</span><a title="unfiltered.netty.websockets.Intent" id="68806">intentIn</a>: <span title="unfiltered.netty.websockets.Intent">Intent</span>, <a title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit" id="68807">passIn</a>: <span title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit">PassHandler</span><span class="delimiter">)</span> =
    <a href="#68808" title="org.jboss.netty.channel.SimpleChannelUpstreamHandler with unfiltered.netty.websockets.Plan with unfiltered.netty.websockets.CloseOnException{}" class="keyword">new</a> <a title="anonymous class $anon extends org.jboss.netty.channel.SimpleChannelUpstreamHandler with unfiltered.netty.websockets.Plan with unfiltered.netty.websockets.CloseOnException" id="68808">Plan</a> <span class="keyword">with</span> <a href="#10938" title="unfiltered.netty.websockets.CloseOnException">CloseOnException</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="unfiltered.netty.websockets.Intent" id="68810">intent</a> = <a href="#68806" title="unfiltered.netty.websockets.Intent">intentIn</a>
      <span class="keyword">val</span> <a title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit" id="68812">pass</a> = <a href="#68807" title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit">passIn</a>
    <span class="delimiter">}</span>

  /** Creates a WebSocket Plan that, when `Pass`ing, will return a forbidden
   *  response to the client */
  <span class="keyword">def</span> <a title="(intentIn: unfiltered.netty.websockets.Intent)unfiltered.netty.websockets.Plan" id="68802">apply</a><span class="delimiter">(</span><a title="unfiltered.netty.websockets.Intent" id="68805">intentIn</a>: <span title="unfiltered.netty.websockets.Intent">Intent</span><span class="delimiter">)</span>: <a href="#10995" title="unfiltered.netty.websockets.Plan">Plan</a> =
    <a href="#69077" title="org.jboss.netty.channel.SimpleChannelUpstreamHandler with unfiltered.netty.websockets.Plan with unfiltered.netty.websockets.CloseOnException{}" class="keyword">new</a> <a title="anonymous class $anon extends org.jboss.netty.channel.SimpleChannelUpstreamHandler with unfiltered.netty.websockets.Plan with unfiltered.netty.websockets.CloseOnException" id="69077">Plan</a> <span class="keyword">with</span> <a href="#10938" title="unfiltered.netty.websockets.CloseOnException">CloseOnException</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="unfiltered.netty.websockets.Intent" id="69079">intent</a> = <a href="#68805" title="unfiltered.netty.websockets.Intent">intentIn</a>
      <span class="keyword">val</span> <a title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit" id="69081">pass</a> = <a href="package.scala.html#12577" title="=&gt; (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit">DefaultPassHandler</a>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>