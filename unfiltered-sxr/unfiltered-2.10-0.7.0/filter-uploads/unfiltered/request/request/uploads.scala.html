<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>filter-uploads/unfiltered/request/request/uploads.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> unfiltered.filter.request

<span class="keyword">import</span> unfiltered.request._
<span class="keyword">import</span> unfiltered.request.<span class="delimiter">{</span>
  MultiPartMatcher, MultipartData,AbstractDiskFile,
  TupleGenerator, AbstractStreamedFile, StreamedExtractor,
  AbstractDiskExtractor, DiskExtractor <span class="delimiter">}</span>

<span class="keyword">import</span> unfiltered.filter.util.IteratorConversions
<span class="keyword">import</span> unfiltered.util.control.NonFatal
<span class="keyword">import</span> scala.util.control.<span title="scala.util.control.Exception.type">Exception</span>.allCatch

<span class="keyword">import</span> javax.servlet.http.HttpServletRequest

<span class="keyword">import</span> org.apache.commons.<span class="delimiter">{</span>fileupload =&gt; fu<span class="delimiter">}</span>
<span class="keyword">import</span> fu.servlet.ServletFileUpload
<span class="keyword">import</span> java.io.<span class="delimiter">{</span>File =&gt; JFile<span class="delimiter">}</span>

<span class="keyword">import</span> <a href="conversions.scala.html#8683" title="unfiltered.filter.util.IteratorConversions.type">IteratorConversions</a>._

/** Matches requests that have multipart content */
<span class="keyword">object</span> <a title="unfiltered.filter.request.MultiPart.type" id="8701">MultiPart</a> <a href="#8702" title="unfiltered.filter.request.MultiPart.type" class="keyword">extends</a> <a href="../../../../uploads/unfiltered/request/request/uploads.scala.html#7735" title="unfiltered.request.MultiPartMatcher[unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]]">MultiPartMatcher</a><span class="delimiter">[</span>HttpRequest<span class="delimiter">[</span>HttpServletRequest<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(req: unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest])Option[unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]]" id="40611">unapply</a><span class="delimiter">(</span><a title="unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]" id="40613">req</a>: <a href="../../../../unfiltered/unfiltered/unfiltered/request/HttpRequest.scala.html#7615" title="unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]">HttpRequest</a><span class="delimiter">[</span>HttpServletRequest<span class="delimiter">]</span><span class="delimiter">)</span> =
    <span title="Option[unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]]" class="keyword">if</span> <span class="delimiter">(</span><span title="org.apache.commons.fileupload.servlet.ServletFileUpload.type">ServletFileUpload</span>.<span title="(x$1: javax.servlet.http.HttpServletRequest)Boolean">isMultipartContent</span><span class="delimiter">(</span><a href="#40613" title="unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]">req</a>.<a href="../../../../unfiltered/unfiltered/unfiltered/request/HttpRequest.scala.html#12727" title="=&gt; javax.servlet.http.HttpServletRequest">underlying</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="(x: unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest])Some[unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]]">Some</span><span class="delimiter">(</span><a href="#40613" title="unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]">req</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <span title="None.type">None</span>
<span class="delimiter">}</span>

/** Represents an uploaded file loaded into memory (and possibly written to disk) */
<span class="keyword">class</span> <a title="class DiskFileWrapper extends AnyRef with unfiltered.request.AbstractDiskFile" id="8694">DiskFileWrapper</a><a href="#8694" title="unfiltered.filter.request.DiskFileWrapper" class="delimiter">(</a><a title="org.apache.commons.fileupload.FileItem" id="40670">item</a>: fu.<span title="org.apache.commons.fileupload.FileItem">FileItem</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../uploads/unfiltered/request/request/uploads.scala.html#7240" title="unfiltered.request.AbstractDiskFile">AbstractDiskFile</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(out: java.io.File)Option[java.io.File]" id="40641">write</a><span class="delimiter">(</span><a title="java.io.File" id="40671">out</a>: <span title="java.io.File">JFile</span><span class="delimiter">)</span>: <span title="Option[java.io.File]">Option</span><span class="delimiter">[</span>JFile<span class="delimiter">]</span> = <a href="#121636" title="Option[java.io.File]" id="121634" class="keyword">try</a> <span class="delimiter">{</span>
    <a href="#40670" title="org.apache.commons.fileupload.FileItem">item</a>.<span title="(x$1: java.io.File)Unit">write</span><span class="delimiter">(</span><a href="#40671" title="java.io.File">out</a><span class="delimiter">)</span>
    <span title="(x: java.io.File)Some[java.io.File]">Some</span><span class="delimiter">(</span><a href="#40671" title="java.io.File">out</a><span class="delimiter">)</span>
  <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="../../../../util/unfiltered/util/control/NonFatal.scala.html#40969" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="#121636" title="(x: Option[java.io.File])Option[java.io.File]">None</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="40642">inMemory</a> = <a href="#40670" title="org.apache.commons.fileupload.FileItem">item</a>.<span title="()Boolean">isInMemory</span>
  <span class="keyword">def</span> <a title="=&gt; Array[Byte]" id="40643">bytes</a> = <a href="#40670" title="org.apache.commons.fileupload.FileItem">item</a>.<span title="()Array[Byte]">get</span>
  <span class="keyword">def</span> <a title="=&gt; Long" id="40644">size</a> = <a href="#40670" title="org.apache.commons.fileupload.FileItem">item</a>.<span title="()Long">getSize</span>
  <span class="keyword">val</span> <a title="String" id="40645">name</a> = <a href="#40670" title="org.apache.commons.fileupload.FileItem">item</a>.<span title="()String">getName</span>
  <span class="keyword">val</span> <a title="String" id="40647">contentType</a> = <a href="#40670" title="org.apache.commons.fileupload.FileItem">item</a>.<span title="()String">getContentType</span>
<span class="delimiter">}</span>

/** Represents an uploaded file exposing a stream to read its contents */
<span class="keyword">class</span> <a title="class StreamedFileWrapper extends AnyRef with unfiltered.request.AbstractStreamedFile with unfiltered.request.io.FileIO" id="8757">StreamedFileWrapper</a><a href="#8757" title="unfiltered.filter.request.StreamedFileWrapper" class="delimiter">(</a><a title="org.apache.commons.fileupload.FileItemStream" id="41015">fstm</a>: fu.<span title="org.apache.commons.fileupload.FileItemStream">FileItemStream</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../uploads/unfiltered/request/request/uploads.scala.html#7243" title="unfiltered.request.AbstractStreamedFile">AbstractStreamedFile</a>
  <span class="keyword">with</span> unfiltered.request.io.<a href="../../../../uploads/unfiltered/request/request/io/files.scala.html#12438" title="unfiltered.request.io.FileIO">FileIO</a> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(out: java.io.File)Option[java.io.File]" id="40993">write</a><span class="delimiter">(</span><a title="java.io.File" id="41016">out</a>: <span title="java.io.File">JFile</span><span class="delimiter">)</span>: <span title="Option[java.io.File]">Option</span><span class="delimiter">[</span>JFile<span class="delimiter">]</span> = <span title="util.control.Exception.Catch[Nothing]">allCatch</span>.<span title="(body: =&gt; java.io.File)Option[java.io.File]">opt</span> <span class="delimiter">{</span>
    <a href="#40994" title="(v1: java.io.InputStream =&gt; java.io.File)java.io.File">stream</a> <span class="delimiter">{</span> <a title="java.io.InputStream" id="41030">stm</a> =&gt;
      <a href="../../../../uploads/unfiltered/request/request/io/files.scala.html#41011" title="(from: java.io.InputStream)(to: java.io.File)Unit">toFile</a><span class="delimiter">(</span><a href="#41030" title="java.io.InputStream">stm</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#41016" title="java.io.File">out</a><span class="delimiter">)</span>
      <a href="#41016" title="java.io.File">out</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[T]=&gt; (java.io.InputStream =&gt; T) =&gt; T" id="40994">stream</a><span class="delimiter">[</span><a title="" id="40996">T</a><span class="delimiter">]</span>: <span class="delimiter">(</span>java.io.InputStream =&gt; T<span class="delimiter">)</span> =&gt; T =
    <a href="#8746" title="unfiltered.filter.request.MultiPartParams.type">MultiPartParams</a>.<a href="#41047" title="unfiltered.filter.request.MultiPartParams.Streamed.type">Streamed</a>.<a href="#41064" title="[T](fstm: org.apache.commons.fileupload.FileItemStream)(f: java.io.InputStream =&gt; T)T">withStreamedFile</a><span title="(fstm: org.apache.commons.fileupload.FileItemStream)(f: java.io.InputStream =&gt; T)T" class="delimiter">[</span><a href="#40996" title="T">T</a><span class="delimiter">]</span><a href="#41086" title="java.io.InputStream =&gt; T" class="delimiter">(</a><a href="#41015" title="org.apache.commons.fileupload.FileItemStream">fstm</a><span class="delimiter">)</span>_
  <span class="keyword">val</span> <a title="String" id="40997">name</a> = <a href="#41015" title="org.apache.commons.fileupload.FileItemStream">fstm</a>.<span title="()String">getName</span>
  <span class="keyword">val</span> <a title="String" id="40999">contentType</a> = <a href="#41015" title="org.apache.commons.fileupload.FileItemStream">fstm</a>.<span title="()String">getContentType</span>
<span class="delimiter">}</span>

/** Extactors for multi-part form param processing
  * @note a request can go through one pass of this extractor
  * afterwards, the requests input stream will appear empty
  */
<span class="keyword">object</span> <a title="unfiltered.filter.request.MultiPartParams.type" id="8746">MultiPartParams</a> <a href="#8747" title="unfiltered.filter.request.MultiPartParams.type" class="keyword">extends</a> <a href="../../../../uploads/unfiltered/request/request/uploads.scala.html#8032" title="unfiltered.request.TupleGenerator">TupleGenerator</a> <span class="delimiter">{</span>

  <span class="keyword">object</span> <a title="unfiltered.filter.request.MultiPartParams.Streamed.type" id="41047">Streamed</a> <a href="#41048" title="unfiltered.filter.request.MultiPartParams.Streamed.type" class="keyword">extends</a> <a href="../../../../uploads/unfiltered/request/request/uploads.scala.html#8005" title="unfiltered.request.StreamedExtractor[unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]]">StreamedExtractor</a><span class="delimiter">[</span>HttpRequest<span class="delimiter">[</span>HttpServletRequest<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">import</span> fu.<span class="delimiter">{</span>FileItemIterator, FileItemStream<span class="delimiter">}</span>
    <span class="keyword">import</span> fu.util.Streams
    <span class="keyword">def</span> <a title="(req: unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest])unfiltered.request.MultipartData[Seq[unfiltered.request.AbstractStreamedFile]]" id="41063">apply</a><span class="delimiter">(</span><a title="unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]" id="41109">req</a>: <a href="../../../../unfiltered/unfiltered/unfiltered/request/HttpRequest.scala.html#7615" title="unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]">HttpRequest</a><span class="delimiter">[</span>HttpServletRequest<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="=&gt; org.apache.commons.fileupload.FileItemIterator" id="41114">items</a> = <span title="org.apache.commons.fileupload.servlet.ServletFileUpload" class="keyword">new</span> <span title="org.apache.commons.fileupload.servlet.ServletFileUpload">ServletFileUpload</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: javax.servlet.http.HttpServletRequest)org.apache.commons.fileupload.FileItemIterator">getItemIterator</span><span class="delimiter">(</span><a href="#41109" title="unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]">req</a>.<a href="../../../../unfiltered/unfiltered/unfiltered/request/HttpRequest.scala.html#12727" title="=&gt; javax.servlet.http.HttpServletRequest">underlying</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.apache.commons.fileupload.FileItemIterator" class="delimiter">[</span><span title="org.apache.commons.fileupload.FileItemIterator">FileItemIterator</span><span class="delimiter">]</span>
      /** attempt to extract the first named param from the stream */
      <span class="keyword">def</span> <a title="(name: String)Seq[String]" id="41115">extractParam</a><span class="delimiter">(</span><a title="String" id="41227">name</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
         <a href="conversions.scala.html#40288" title="implicit unfiltered.filter.util.IteratorConversions.acfi2si : (i: org.apache.commons.fileupload.FileItemIterator)unfiltered.filter.util.IteratorConversions.FIIteratorWrapper">items</a>.<span title="(p: org.apache.commons.fileupload.FileItemStream =&gt; Boolean)Option[org.apache.commons.fileupload.FileItemStream]">find</span><span title="Seq[String]" class="delimiter">(</span><a title="org.apache.commons.fileupload.FileItemStream" id="41252">f</a> =&gt; <a href="#41252" title="org.apache.commons.fileupload.FileItemStream">f</a>.<span title="()String">getFieldName</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#41227" title="String">name</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#41252" title="org.apache.commons.fileupload.FileItemStream">f</a>.<span title="()Boolean">isFormField</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
           <span class="keyword">case</span> Some<a href="#121641" title="Seq[String]" class="delimiter">(</a><a href="#121642" title="org.apache.commons.fileupload.FileItemStream" id="41259">p</a><span class="delimiter">)</span> =&gt; <span title="(elems: String*)Seq[String]">Seq</span><a href="#121644" title="(x: Seq[String])Seq[String]" class="delimiter">(</a><a href="#41067" title="(fstm: org.apache.commons.fileupload.FileItemStream)String">extractStr</a><span class="delimiter">(</span><a href="#41259" title="org.apache.commons.fileupload.FileItemStream">p</a><span class="delimiter">)</span><span class="delimiter">)</span>
           <span class="keyword">case</span> _ =&gt; <a href="#121644" title="(x: Seq[String])Seq[String]">Nil</a>
         <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      /** attempt to extract the first named file from the stream */
      <span class="keyword">def</span> <a title="(name: String)Seq[unfiltered.filter.request.StreamedFileWrapper]" id="41116">extractFile</a><span class="delimiter">(</span><a title="String" id="41294">name</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Seq[unfiltered.filter.request.StreamedFileWrapper]">Seq</span><span class="delimiter">[</span>StreamedFileWrapper<span class="delimiter">]</span> = <span class="delimiter">{</span>
         <a href="conversions.scala.html#40288" title="implicit unfiltered.filter.util.IteratorConversions.acfi2si : (i: org.apache.commons.fileupload.FileItemIterator)unfiltered.filter.util.IteratorConversions.FIIteratorWrapper">items</a>.<span title="(p: org.apache.commons.fileupload.FileItemStream =&gt; Boolean)Option[org.apache.commons.fileupload.FileItemStream]">find</span><span title="Seq[unfiltered.filter.request.StreamedFileWrapper]" class="delimiter">(</span><a title="org.apache.commons.fileupload.FileItemStream" id="41317">f</a> =&gt; <a href="#41317" title="org.apache.commons.fileupload.FileItemStream">f</a>.<span title="()String">getFieldName</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#41294" title="String">name</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#41317" title="org.apache.commons.fileupload.FileItemStream">f</a>.<span title="()Boolean">isFormField</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
           <span class="keyword">case</span> Some<a href="#121649" title="Seq[unfiltered.filter.request.StreamedFileWrapper]" class="delimiter">(</a><a href="#121650" title="org.apache.commons.fileupload.FileItemStream" id="41324">f</a><span class="delimiter">)</span> =&gt; <span title="(elems: unfiltered.filter.request.StreamedFileWrapper*)Seq[unfiltered.filter.request.StreamedFileWrapper]">Seq</span><a href="#121652" title="(x: Seq[unfiltered.filter.request.StreamedFileWrapper])Seq[unfiltered.filter.request.StreamedFileWrapper]" class="delimiter">(</a><span title="unfiltered.filter.request.StreamedFileWrapper" class="keyword">new</span> <a href="#8757" title="unfiltered.filter.request.StreamedFileWrapper">StreamedFileWrapper</a><span class="delimiter">(</span><a href="#41324" title="org.apache.commons.fileupload.FileItemStream">f</a><span class="delimiter">)</span><span class="delimiter">)</span>
           <span class="keyword">case</span> _ =&gt; <a href="#121652" title="(x: Seq[unfiltered.filter.request.StreamedFileWrapper])Seq[unfiltered.filter.request.StreamedFileWrapper]">Nil</a>
         <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="../../../../uploads/unfiltered/request/request/uploads.scala.html#41330" title="(params: String =&gt; Seq[String], files: String =&gt; Seq[unfiltered.request.AbstractStreamedFile])unfiltered.request.MultipartData[Seq[unfiltered.request.AbstractStreamedFile]]">MultipartData</a><span class="delimiter">(</span><a href="#41115" title="(name: String)Seq[String]">extractParam</a> _,<a href="#41116" title="(name: String)Seq[unfiltered.filter.request.StreamedFileWrapper]">extractFile</a> _<span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="[T](fstm: org.apache.commons.fileupload.FileItemStream)(f: java.io.InputStream =&gt; T)T" id="41064">withStreamedFile</a><span class="delimiter">[</span><a title="" id="41066">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="org.apache.commons.fileupload.FileItemStream" id="41068">fstm</a>: <span title="org.apache.commons.fileupload.FileItemStream">FileItemStream</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="java.io.InputStream =&gt; T" id="41069">f</a>: java.io.InputStream =&gt; T<span class="delimiter">)</span>: <a href="#41066" title="T">T</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.io.InputStream" id="41359">stm</a> = <a href="#41068" title="org.apache.commons.fileupload.FileItemStream">fstm</a>.<span title="()java.io.InputStream">openStream</span>
      <span class="keyword">try</span> <span class="delimiter">{</span> <a href="#41069" title="(v1: java.io.InputStream)T">f</a><span class="delimiter">(</span><a href="#41359" title="java.io.InputStream">stm</a><span class="delimiter">)</span> <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span> <a href="#41359" title="java.io.InputStream">stm</a>.<span title="()Unit">close</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(fstm: org.apache.commons.fileupload.FileItemStream)String" id="41067">extractStr</a><span class="delimiter">(</span><a title="org.apache.commons.fileupload.FileItemStream" id="41262">fstm</a>: <span title="org.apache.commons.fileupload.FileItemStream">FileItemStream</span><span class="delimiter">)</span> = <a href="#41064" title="[T](fstm: org.apache.commons.fileupload.FileItemStream)(f: java.io.InputStream =&gt; T)T">withStreamedFile</a><span title="(fstm: org.apache.commons.fileupload.FileItemStream)(f: java.io.InputStream =&gt; String)String" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#41262" title="org.apache.commons.fileupload.FileItemStream">fstm</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="java.io.InputStream" id="41276">stm</a> =&gt;
      <span title="org.apache.commons.fileupload.util.Streams.type">Streams</span>.<span title="(x$1: java.io.InputStream)String">asString</span><span class="delimiter">(</span><a href="#41276" title="java.io.InputStream">stm</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** On-disk  multi-part form data extractor */
  <span class="keyword">object</span> <a title="unfiltered.filter.request.MultiPartParams.Disk.type" id="41049">Disk</a> <a href="#41050" title="unfiltered.filter.request.MultiPartParams.Disk.type" class="keyword">extends</a> <a href="#41053" title="unfiltered.filter.request.MultiPartParams.AbstractDisk">AbstractDisk</a> <span class="keyword">with</span> <a href="../../../../uploads/unfiltered/request/request/uploads.scala.html#7528" title="unfiltered.request.DiskExtractor">DiskExtractor</a>

  /** All in memory multi-part form data extractor.
      This exposes a very specific class of file references
      intended for use in environments such as GAE where writing
      to disk is prohibited.
      */
  <span class="keyword">object</span> <a title="unfiltered.filter.request.MultiPartParams.Memory.type" id="41051">Memory</a> <a href="#41052" title="unfiltered.filter.request.MultiPartParams.Memory.type" class="keyword">extends</a> <a href="#41053" title="unfiltered.filter.request.MultiPartParams.AbstractDisk">AbstractDisk</a> <span class="delimiter">{</span>
    <span class="keyword">class</span> <a title="class ByteArrayFileItem extends Object with org.apache.commons.fileupload.FileItem" id="41378">ByteArrayFileItem</a><a href="#41378" title="unfiltered.filter.request.MultiPartParams.Memory.ByteArrayFileItem" class="delimiter">(</a><span class="keyword">var</span> <a title="String" id="41611">fieldName</a>: <span title="String">String</span>,
      <span class="keyword">val</span> <a title="String" id="41612">contentType</a>: <span title="String">String</span>,
      <span class="keyword">var</span> <a title="Boolean" id="41613">formField</a>: <span title="Boolean">Boolean</span>,
      <span class="keyword">val</span> <a title="String" id="41614">name</a>: <span title="String">String</span>,
      <span class="keyword">val</span> <a title="Int" id="41615">sizeThreshold</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> fu.<span title="org.apache.commons.fileupload.FileItem">FileItem</span> <span class="delimiter">{</span>

      <span class="keyword">import</span> java.io.<span class="delimiter">{</span>InputStream, ByteArrayInputStream,
        OutputStream, ByteArrayOutputStream<span class="delimiter">}</span>

      <span class="keyword">var</span> <a title="Option[Array[Byte]]" id="41547">cache</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="None.type">None</span>
      <span class="keyword">val</span> <a title="java.io.ByteArrayOutputStream" id="41549">out</a> = <span title="java.io.ByteArrayOutputStream" class="keyword">new</span> <span title="java.io.ByteArrayOutputStream">ByteArrayOutputStream</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="41551">delete</a> <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Array[Byte]" id="41552">get</a> = <a href="#41547" title="=&gt; Option[Array[Byte]]">cache</a> <span title="(default: =&gt; Array[Byte])Array[Byte]">getOrElse</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Array[Byte]" id="41625">content</a> = <a href="#41549" title="=&gt; java.io.ByteArrayOutputStream">out</a>.<span title="()Array[Byte]">toByteArray</span>
        <a href="#41547" title="(x$1: Option[Array[Byte]])Unit">cache</a> = <span title="(x: Array[Byte])Some[Array[Byte]]">Some</span><span class="delimiter">(</span><a href="#41625" title="Array[Byte]">content</a><span class="delimiter">)</span>
        <a href="#41625" title="Array[Byte]">content</a>
      <span class="delimiter">}</span>

      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="41553">getContentType</a> = <a href="#41612" title="=&gt; String">contentType</a>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="41554">getFieldName</a> = <a href="#41611" title="=&gt; String">fieldName</a>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.io.InputStream" id="41555">getInputStream</a>: <span title="java.io.InputStream">InputStream</span> = <span title="java.io.ByteArrayInputStream" class="keyword">new</span> <span title="java.io.ByteArrayInputStream">ByteArrayInputStream</span><span class="delimiter">(</span><a href="#41552" title="()Array[Byte]">get</a><span class="delimiter">)</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="41556">getName</a> = <a href="#41614" title="=&gt; String">name</a>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.io.ByteArrayOutputStream" id="41557">getOutputStream</a> = <a href="#41549" title="=&gt; java.io.ByteArrayOutputStream">out</a>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Long" id="41558">getSize</a> = <a href="#41552" title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">get</a>.<span title="=&gt; Long">size</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(charset: String)String" id="41559">getString</a><span class="delimiter">(</span><a title="String" id="41729">charset</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="(x$1: Array[Byte], x$2: String)String" class="keyword">new</span> <span title="String">String</span><span class="delimiter">(</span><a href="#41552" title="()Array[Byte]">get</a>, <a href="#41729" title="String">charset</a><span class="delimiter">)</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="41560">getString</a> = <a href="#41559" title="(charset: String)String">getString</a><span class="delimiter">(</span><span title="String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Boolean" id="41561">isFormField</a> = <a href="#41613" title="=&gt; Boolean">formField</a>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Boolean" id="41562">isInMemory</a> = <span title="Boolean(true)" class="keyword">true</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(value: String)Unit" id="41563">setFieldName</a><span class="delimiter">(</span><a title="String" id="42413">value</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#41611" title="(x$1: String)Unit">fieldName</a> = <a href="#42413" title="String">value</a> <span class="delimiter">}</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(state: Boolean)Unit" id="41564">setFormField</a><span class="delimiter">(</span><a title="Boolean" id="42415">state</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#41613" title="(x$1: Boolean)Unit">formField</a> = <a href="#42415" title="Boolean">state</a> <span class="delimiter">}</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(file: java.io.File)Unit" id="41565">write</a><span class="delimiter">(</span><a title="java.io.File" id="42417">file</a>: <span title="java.io.File">JFile</span><span class="delimiter">)</span> <span class="delimiter">{</span> sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="String(&quot;File writing is not permitted&quot;)" class="string">&quot;File writing is not permitted&quot;</span><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">class</span> <a title="class ByteArrayFileItemFactory extends Object with org.apache.commons.fileupload.FileItemFactory" id="41379">ByteArrayFileItemFactory</a> <a href="#41379" title="unfiltered.filter.request.MultiPartParams.Memory.ByteArrayFileItemFactory" class="keyword">extends</a> fu.<span title="org.apache.commons.fileupload.FileItemFactory">FileItemFactory</span> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(fieldName: String, contentType: String, isFormField: Boolean, fileName: String)unfiltered.filter.request.MultiPartParams.Memory.ByteArrayFileItem" id="42533">createItem</a><span class="delimiter">(</span><a title="String" id="42535">fieldName</a>: <span title="String">String</span> , <a title="String" id="42536">contentType</a>: <span title="String">String</span> ,
                            <a title="Boolean" id="42537">isFormField</a>: <span title="Boolean">Boolean</span> , <a title="String" id="42538">fileName</a>: <span title="String">String</span> <span class="delimiter">)</span> = <span title="unfiltered.filter.request.MultiPartParams.Memory.ByteArrayFileItem" class="keyword">new</span> <a href="#41378" title="unfiltered.filter.request.MultiPartParams.Memory.ByteArrayFileItem">ByteArrayFileItem</a><span class="delimiter">(</span>
                              <a href="#42535" title="String">fieldName</a>, <a href="#42536" title="String">contentType</a>, <a href="#42537" title="Boolean">isFormField</a>, <a href="#42538" title="String">fileName</a>, Int.<span title="Int(2147483647)">MaxValue</span>
                            <span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(writeAfter: Int, writeDir: java.io.File)unfiltered.filter.request.MultiPartParams.Memory.ByteArrayFileItemFactory" id="41380">factory</a><span class="delimiter">(</span><a title="Int" id="42541">writeAfter</a>: <span title="Int">Int</span>, <a title="java.io.File" id="42542">writeDir</a>: <span title="java.io.File">JFile</span><span class="delimiter">)</span> = <span title="unfiltered.filter.request.MultiPartParams.Memory.ByteArrayFileItemFactory" class="keyword">new</span> <a href="#41379" title="unfiltered.filter.request.MultiPartParams.Memory.ByteArrayFileItemFactory">ByteArrayFileItemFactory</a>
    <span class="keyword">val</span> <a title="Int" id="41381">memLimit</a> = Int.<span title="Int(2147483647)">MaxValue</span>
    <span class="keyword">val</span> <a title="java.io.File" id="41383">tempDir</a> = <span title="java.io.File" class="keyword">new</span> java.io.<span title="java.io.File">File</span><span class="delimiter">(</span><span title="String(&quot;.&quot;)" class="string">&quot;.&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">trait</span> <a title="trait AbstractDisk extends AnyRef with unfiltered.request.AbstractDiskExtractor[unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]]" id="41053">AbstractDisk</a> <span title="Unit" class="keyword">extends</span> <a href="../../../../uploads/unfiltered/request/request/uploads.scala.html#7237" title="unfiltered.request.AbstractDiskExtractor[unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]]">AbstractDiskExtractor</a><span class="delimiter">[</span>HttpRequest<span class="delimiter">[</span>HttpServletRequest<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">import</span> fu.<span class="delimiter">{</span>FileItemFactory, FileItem =&gt; ACFileItem<span class="delimiter">}</span>
    <span class="keyword">import</span> java.util.<span class="delimiter">{</span>Iterator =&gt; JIterator<span class="delimiter">}</span>
    <span class="keyword">import</span> fu.disk.<span class="delimiter">{</span>DiskFileItemFactory<span class="delimiter">}</span>

     /** @return a configured FileItemFactory to parse a request */
    <span class="keyword">def</span> <a title="(writeAfter: Int, writeDir: java.io.File)org.apache.commons.fileupload.FileItemFactory" id="41368">factory</a><span class="delimiter">(</span><a title="Int" id="42544">writeAfter</a>: <span title="Int">Int</span>, <a title="java.io.File" id="42545">writeDir</a>: <span title="java.io.File">JFile</span><span class="delimiter">)</span>: <span title="org.apache.commons.fileupload.FileItemFactory">FileItemFactory</span> =
      <span title="(x$1: Int, x$2: java.io.File)org.apache.commons.fileupload.disk.DiskFileItemFactory" class="keyword">new</span> <span title="org.apache.commons.fileupload.disk.DiskFileItemFactory">DiskFileItemFactory</span><span class="delimiter">(</span><a href="#42544" title="Int">writeAfter</a>, <a href="#42545" title="java.io.File">writeDir</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(req: unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest])unfiltered.request.MultipartData[Seq[unfiltered.request.AbstractDiskFile]]" id="41369">apply</a><span class="delimiter">(</span><a title="unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]" id="42639">req</a>: <a href="../../../../unfiltered/unfiltered/unfiltered/request/HttpRequest.scala.html#7615" title="unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]">HttpRequest</a><span class="delimiter">[</span>HttpServletRequest<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.util.Iterator[org.apache.commons.fileupload.FileItem]" id="42644">items</a> =  <span title="(x$1: org.apache.commons.fileupload.FileItemFactory)org.apache.commons.fileupload.servlet.ServletFileUpload" class="keyword">new</span> <span title="org.apache.commons.fileupload.servlet.ServletFileUpload">ServletFileUpload</span><span class="delimiter">(</span><a href="#41368" title="(writeAfter: Int, writeDir: java.io.File)org.apache.commons.fileupload.FileItemFactory">factory</a><span class="delimiter">(</span><a href="../../../../uploads/unfiltered/request/request/uploads.scala.html#41361" title="=&gt; Int">memLimit</a>, <a href="../../../../uploads/unfiltered/request/request/uploads.scala.html#41362" title="=&gt; java.io.File">tempDir</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(x$1: javax.servlet.http.HttpServletRequest)java.util.List[_]">parseRequest</span><span class="delimiter">(</span>
        <a href="#42639" title="unfiltered.request.HttpRequest[javax.servlet.http.HttpServletRequest]">req</a>.<a href="../../../../unfiltered/unfiltered/unfiltered/request/HttpRequest.scala.html#12727" title="=&gt; javax.servlet.http.HttpServletRequest">underlying</a>
      <span class="delimiter">)</span>.<span title="()java.util.Iterator[?0]">iterator</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="java.util.Iterator[org.apache.commons.fileupload.FileItem]" class="delimiter">[</span><span title="java.util.Iterator[org.apache.commons.fileupload.FileItem]">JIterator</span><span class="delimiter">[</span>ACFileItem<span class="delimiter">]</span><span class="delimiter">]</span>
      <span class="keyword">val</span> <a href="#121659" title="(x: (scala.collection.immutable.Map[String,List[String]], scala.collection.immutable.Map[String,List[unfiltered.filter.request.DiskFileWrapper]]))(scala.collection.immutable.Map[String,List[String]], scala.collection.immutable.Map[String,List[unfiltered.filter.request.DiskFileWrapper]])" class="delimiter">(</a><a href="#121657" title="scala.collection.immutable.Map[String,List[String]]" id="42646">params</a>, <a href="#121657" title="scala.collection.immutable.Map[String,List[unfiltered.filter.request.DiskFileWrapper]]" id="42647">files</a><span class="delimiter">)</span> = <a href="../../../../uploads/unfiltered/request/request/uploads.scala.html#41039" title="[A, B, C](iter: Iterator[C])(f: ((Map[String,List[A]], Map[String,List[B]]), C) =&gt; (Map[String,List[A]], Map[String,List[B]]))(scala.collection.immutable.Map[String,List[A]], scala.collection.immutable.Map[String,List[B]])">genTuple</a><span title="(iter: Iterator[org.apache.commons.fileupload.FileItem])(f: ((Map[String,List[String]], Map[String,List[unfiltered.filter.request.DiskFileWrapper]]), org.apache.commons.fileupload.FileItem) =&gt; (Map[String,List[String]], Map[String,List[unfiltered.filter.request.DiskFileWrapper]]))(scala.collection.immutable.Map[String,List[String]], scala.collection.immutable.Map[String,List[unfiltered.filter.request.DiskFileWrapper]])" class="delimiter">[</span><span title="String">String</span>, <a href="#8694" title="unfiltered.filter.request.DiskFileWrapper">DiskFileWrapper</a>, <span title="org.apache.commons.fileupload.FileItem">ACFileItem</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="conversions.scala.html#40289" title="(i: java.util.Iterator[org.apache.commons.fileupload.FileItem])unfiltered.filter.util.IteratorConversions.JIteratorWrapper[org.apache.commons.fileupload.FileItem]">items</a><span class="delimiter">)</span> <a href="#121657" title="(scala.collection.immutable.Map[String,List[String]], scala.collection.immutable.Map[String,List[unfiltered.filter.request.DiskFileWrapper]]) @unchecked" class="delimiter">(</a><span class="delimiter">(</span><a title="(Map[String,List[String]], Map[String,List[unfiltered.filter.request.DiskFileWrapper]])" id="42843">maps</a>, <a title="org.apache.commons.fileupload.FileItem" id="42844">item</a><span class="delimiter">)</span> =&gt;
        <span title="(scala.collection.immutable.Map[String,List[String]], Map[String,List[unfiltered.filter.request.DiskFileWrapper]])" class="keyword">if</span><span class="delimiter">(</span><a href="#42844" title="org.apache.commons.fileupload.FileItem">item</a>.<span title="()Boolean">isFormField</span><span class="delimiter">)</span> <span title="(_1: scala.collection.immutable.Map[String,List[String]], _2: Map[String,List[unfiltered.filter.request.DiskFileWrapper]])(scala.collection.immutable.Map[String,List[String]], Map[String,List[unfiltered.filter.request.DiskFileWrapper]])" class="delimiter">(</span><a href="#42843" title="(Map[String,List[String]], Map[String,List[unfiltered.filter.request.DiskFileWrapper]])">maps</a>.<span title="=&gt; Map[String,List[String]]">_1</span> <span title="(kv: (String, List[String]))scala.collection.immutable.Map[String,List[String]]">+</span> <span class="delimiter">(</span><a href="#42844" title="org.apache.commons.fileupload.FileItem">item</a>.<span title="(x: String)ArrowAssoc[String]">getFieldName</span> <span title="(y: List[String])(String, List[String])">-&gt;</span> <span class="delimiter">(</span><a href="#42844" title="org.apache.commons.fileupload.FileItem">item</a>.<span title="()String">getString</span> <a href="#42930" title="(x: String)List[String]">::</a> <a href="#42843" title="(Map[String,List[String]], Map[String,List[unfiltered.filter.request.DiskFileWrapper]])">maps</a>.<span title="(key: String)List[String]">_1</span><span class="delimiter">(</span><a href="#42844" title="org.apache.commons.fileupload.FileItem">item</a>.<span title="()String">getFieldName</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#42843" title="(Map[String,List[String]], Map[String,List[unfiltered.filter.request.DiskFileWrapper]])">maps</a>.<span title="=&gt; Map[String,List[unfiltered.filter.request.DiskFileWrapper]]">_2</span><span class="delimiter">)</span>
        <span class="keyword">else</span> <span title="(_1: Map[String,List[String]], _2: scala.collection.immutable.Map[String,List[unfiltered.filter.request.DiskFileWrapper]])(Map[String,List[String]], scala.collection.immutable.Map[String,List[unfiltered.filter.request.DiskFileWrapper]])" class="delimiter">(</span><a href="#42843" title="(Map[String,List[String]], Map[String,List[unfiltered.filter.request.DiskFileWrapper]])">maps</a>.<span title="=&gt; Map[String,List[String]]">_1</span>, <a href="#42843" title="(Map[String,List[String]], Map[String,List[unfiltered.filter.request.DiskFileWrapper]])">maps</a>.<span title="=&gt; Map[String,List[unfiltered.filter.request.DiskFileWrapper]]">_2</span> <span title="(kv: (String, List[unfiltered.filter.request.DiskFileWrapper]))scala.collection.immutable.Map[String,List[unfiltered.filter.request.DiskFileWrapper]]">+</span> <span class="delimiter">(</span><a href="#42844" title="org.apache.commons.fileupload.FileItem">item</a>.<span title="(x: String)ArrowAssoc[String]">getFieldName</span> <span title="(y: List[unfiltered.filter.request.DiskFileWrapper])(String, List[unfiltered.filter.request.DiskFileWrapper])">-&gt;</span> <span class="delimiter">(</span><span title="unfiltered.filter.request.DiskFileWrapper" class="keyword">new</span> <a href="#8694" title="unfiltered.filter.request.DiskFileWrapper">DiskFileWrapper</a><span class="delimiter">(</span><a href="#42844" title="org.apache.commons.fileupload.FileItem">item</a><span class="delimiter">)</span> <a href="#43070" title="(x: unfiltered.filter.request.DiskFileWrapper)List[unfiltered.filter.request.DiskFileWrapper]">::</a> <a href="#42843" title="(Map[String,List[String]], Map[String,List[unfiltered.filter.request.DiskFileWrapper]])">maps</a>.<span title="(key: String)List[unfiltered.filter.request.DiskFileWrapper]">_2</span><span class="delimiter">(</span><a href="#42844" title="org.apache.commons.fileupload.FileItem">item</a>.<span title="()String">getFieldName</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">)</span>
      <a href="../../../../uploads/unfiltered/request/request/uploads.scala.html#41330" title="(params: String =&gt; Seq[String], files: String =&gt; Seq[unfiltered.request.AbstractDiskFile])unfiltered.request.MultipartData[Seq[unfiltered.request.AbstractDiskFile]]">MultipartData</a><span class="delimiter">(</span><a href="#42646" title="scala.collection.immutable.Map[String,List[String]]">params</a>, <a href="#42647" title="scala.collection.immutable.Map[String,List[unfiltered.filter.request.DiskFileWrapper]]">files</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>