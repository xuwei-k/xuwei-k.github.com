<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>netty/unfiltered/netty/bindings.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> unfiltered.netty

<span class="keyword">import</span> unfiltered.<span class="delimiter">{</span>Async<span class="delimiter">}</span>
<span class="keyword">import</span> unfiltered.response.<span class="delimiter">{</span>ResponseFunction, HttpResponse, Pass<span class="delimiter">}</span>
<span class="keyword">import</span> unfiltered.request.<span class="delimiter">{</span>HttpRequest,POST,RequestContentType,Charset<span class="delimiter">}</span>
<span class="keyword">import</span> java.net.URLDecoder
<span class="keyword">import</span> org.jboss.netty.handler.codec.http._
<span class="keyword">import</span> java.io.<span class="delimiter">{</span>BufferedReader, ByteArrayOutputStream, InputStreamReader<span class="delimiter">}</span>
<span class="keyword">import</span> org.jboss.netty.buffer.<span class="delimiter">{</span>ChannelBuffers, ChannelBufferOutputStream,
  ChannelBufferInputStream<span class="delimiter">}</span>
<span class="keyword">import</span> org.jboss.netty.channel._
<span class="keyword">import</span> org.jboss.netty.handler.codec.http.<span title="org.jboss.netty.handler.codec.http.HttpVersion.type">HttpVersion</span>._
<span class="keyword">import</span> org.jboss.netty.handler.codec.http.<span title="org.jboss.netty.handler.codec.http.HttpResponseStatus.type">HttpResponseStatus</span>._
<span class="keyword">import</span> org.jboss.netty.handler.codec.http.<span class="delimiter">{</span>HttpResponse=&gt;NHttpResponse,
                                           HttpRequest=&gt;NHttpRequest<span class="delimiter">}</span>
<span class="keyword">import</span> java.nio.charset.<span class="delimiter">{</span>Charset =&gt; JNIOCharset<span class="delimiter">}</span>
<span class="keyword">import</span> unfiltered.Cookie
<span class="keyword">import</span> scala.collection.<span title="scala.collection.JavaConverters.type">JavaConverters</span>._

<span class="keyword">object</span> <a title="unfiltered.netty.HttpConfig.type" id="9798">HttpConfig</a> <a href="#9799" title="unfiltered.netty.HttpConfig.type" class="delimiter">{</a>
   <span class="keyword">val</span> <a title="String" id="70344">DEFAULT_CHARSET</a> = <span title="String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span>
<span class="delimiter">}</span>

<span title="AnyRef" class="keyword">class</span> <a title="class RequestBinding extends unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage] with unfiltered.Async.Responder[org.jboss.netty.handler.codec.http.HttpResponse]" id="9863">RequestBinding</a><a href="#9863" title="unfiltered.netty.RequestBinding" class="delimiter">(</a><a title="unfiltered.netty.ReceivedMessage" id="65226">msg</a>: <a href="#72435" title="unfiltered.netty.ReceivedMessage">ReceivedMessage</a><span class="delimiter">)</span>
<span class="keyword">extends</span> <a href="../../../unfiltered/unfiltered/unfiltered/request/HttpRequest.scala.html#7615" title="unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage]">HttpRequest</a><span class="delimiter">(</span><a href="#65226" title="unfiltered.netty.ReceivedMessage">msg</a><span class="delimiter">)</span> <span class="keyword">with</span> Async.<a href="../../../unfiltered/unfiltered/unfiltered/intents.scala.html#38902" title="unfiltered.Async.Responder[org.jboss.netty.handler.codec.http.HttpResponse]">Responder</a><span class="delimiter">[</span>NHttpResponse<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="org.jboss.netty.handler.codec.http.HttpRequest" id="65124">req</a> = <a href="#65226" title="unfiltered.netty.ReceivedMessage">msg</a>.<a href="#65206" title="=&gt; org.jboss.netty.handler.codec.http.HttpRequest">request</a>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.collection.immutable.Map[String,Seq[String]]" id="65126">params</a> = <a href="#65128" title="=&gt; Map[String,Seq[String]]">queryParams</a> <span title="(xs: scala.collection.GenTraversableOnce[(String, Seq[String])])scala.collection.immutable.Map[String,Seq[String]]">++</span> <a href="#65129" title="=&gt; Map[String,Seq[String]]">postParams</a>
  <span class="keyword">def</span> <a title="=&gt; Map[String,Seq[String]]" id="65128">queryParams</a> = <a href="#65124" title="=&gt; org.jboss.netty.handler.codec.http.HttpRequest">req</a>.<span title="()String">getUri</span>.<span title="(x$1: String, x$2: Int)Array[String]">split</span><span title="Map[String,Seq[String]]" class="delimiter">(</span><span title="String(&quot;\\?&quot;)" class="string">&quot;\\?&quot;</span>, <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#122914" title="(x: Array[String])Option[IndexedSeq[String]]">Array</a><span class="delimiter">(</span>_, <a title="String" id="70363">qs</a><span class="delimiter">)</span> =&gt; <a href="#9969" title="unfiltered.netty.URLParser.type">URLParser</a>.<a href="#70365" title="(enc: String)Map[String,Seq[String]]">urldecode</a><a href="#122919" title="(x: Map[String,Seq[String]])Map[String,Seq[String]]" class="delimiter">(</a><a href="#70363" title="String">qs</a><span class="delimiter">)</span>
    <span class="keyword">case</span> _ =&gt; <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><a href="#122919" title="(x: Map[String,Seq[String]])Map[String,Seq[String]]" class="delimiter">[</a><span title="String">String</span>,<span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="=&gt; Map[String,Seq[String]]" id="65129">postParams</a> = <a href="#9863" title="unfiltered.netty.RequestBinding" class="keyword">this</a> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="../../../unfiltered/unfiltered/unfiltered/request/methods.scala.html#34957" title="(req: unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage])Option[unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage]]">POST</a><span class="delimiter">(</span><a href="../../../unfiltered/unfiltered/unfiltered/request/headers.scala.html#17608" title="(req: unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage])Option[String]">RequestContentType</a><span title="=&gt; unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage]" class="delimiter">(</span><a title="String" id="70436">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#70436" title="String">ct</a>.<span title="(x$1: CharSequence)Boolean">contains</span><span class="delimiter">(</span><span title="String(&quot;application/x-www-form-urlencoded&quot;)" class="string">&quot;application/x-www-form-urlencoded&quot;</span><span class="delimiter">)</span> =&gt;
      <a href="#9969" title="unfiltered.netty.URLParser.type">URLParser</a>.<a href="#70365" title="(enc: String)Map[String,Seq[String]]">urldecode</a><a href="#122963" title="(x: Map[String,Seq[String]])Map[String,Seq[String]]" class="delimiter">(</a><a href="#65124" title="=&gt; org.jboss.netty.handler.codec.http.HttpRequest">req</a>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getContent</span>.<span title="(x$1: java.nio.charset.Charset)String">toString</span><span class="delimiter">(</span><span title="java.nio.charset.Charset.type">JNIOCharset</span>.<span title="(x$1: String)java.nio.charset.Charset">forName</span><span class="delimiter">(</span><a href="#65130" title="=&gt; String">charset</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> _ =&gt; <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><a href="#122963" title="(x: Map[String,Seq[String]])Map[String,Seq[String]]" class="delimiter">[</a><span title="String">String</span>,<span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; String" id="65130">charset</a> = <a href="../../../unfiltered/unfiltered/unfiltered/request/headers.scala.html#70464" title="(req: unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage])Option[String]">Charset</a><span class="delimiter">(</span><a href="#9863" title="unfiltered.netty.RequestBinding" class="keyword">this</a><span class="delimiter">)</span>.<span title="(default: =&gt; String)String">getOrElse</span> <span class="delimiter">{</span>
    <a href="#9798" title="unfiltered.netty.HttpConfig.type">HttpConfig</a>.<a href="#70344" title="=&gt; String">DEFAULT_CHARSET</a>
  <span class="delimiter">}</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.jboss.netty.buffer.ChannelBufferInputStream" id="65131">inputStream</a> = <span title="org.jboss.netty.buffer.ChannelBufferInputStream" class="keyword">new</span> <span title="org.jboss.netty.buffer.ChannelBufferInputStream">ChannelBufferInputStream</span><span class="delimiter">(</span><a href="#65124" title="=&gt; org.jboss.netty.handler.codec.http.HttpRequest">req</a>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getContent</span><span class="delimiter">)</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.io.BufferedReader" id="65133">reader</a> = <span class="delimiter">{</span>
    <span title="(x$1: java.io.Reader)java.io.BufferedReader" class="keyword">new</span> <span title="java.io.BufferedReader">BufferedReader</span><span class="delimiter">(</span><span title="(x$1: java.io.InputStream, x$2: String)java.io.InputStreamReader" class="keyword">new</span> <span title="java.io.InputStreamReader">InputStreamReader</span><span class="delimiter">(</span><a href="#65131" title="=&gt; org.jboss.netty.buffer.ChannelBufferInputStream">inputStream</a>, <a href="#65130" title="=&gt; String">charset</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; String" id="65135">protocol</a> = <a href="#65124" title="=&gt; org.jboss.netty.handler.codec.http.HttpRequest">req</a>.<a href="#122982" title="()org.jboss.netty.handler.codec.http.HttpVersion">getProtocolVersion</a> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="org.jboss.netty.handler.codec.http.HttpVersion.type">HttpVersion</span>.<a href="#122970" title="String">HTTP_1_0</a> =&gt; <a href="#122982" title="(x: String)String" class="string">&quot;HTTP/1.0&quot;</a>
    <span class="keyword">case</span> <span title="org.jboss.netty.handler.codec.http.HttpVersion.type">HttpVersion</span>.<a href="#122970" title="String">HTTP_1_1</a> =&gt; <a href="#122982" title="(x: String)String" class="string">&quot;HTTP/1.1&quot;</a>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="65136">method</a> = <a href="#65124" title="=&gt; org.jboss.netty.handler.codec.http.HttpRequest">req</a>.<span title="()org.jboss.netty.handler.codec.http.HttpMethod">getMethod</span>.<span title="()String">toString</span>.<span title="()String">toUpperCase</span>

  // todo should we call URLDecoder.decode(uri, charset) on this here?
  <span class="keyword">def</span> <a title="=&gt; String" id="65137">uri</a> = <a href="#65124" title="=&gt; org.jboss.netty.handler.codec.http.HttpRequest">req</a>.<span title="()String">getUri</span>

  <span class="keyword">def</span> <a title="=&gt; Iterator[String]" id="65138">parameterNames</a> = <a href="#65126" title="=&gt; scala.collection.immutable.Map[String,Seq[String]]">params</a>.<span title="=&gt; scala.collection.immutable.Set[String]">keySet</span>.<span title="=&gt; Iterator[String]">iterator</span>
  <span class="keyword">def</span> <a title="(param: String)Seq[String]" id="65139">parameterValues</a><span class="delimiter">(</span><a title="String" id="70880">param</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#65126" title="=&gt; scala.collection.immutable.Map[String,Seq[String]]">params</a>.<span title="(key: String, default: =&gt; Seq[String])Seq[String]">getOrElse</span><span class="delimiter">(</span><a href="#70880" title="String">param</a>, <span title="scala.collection.Seq.type">Seq</span>.<span title="Seq[Nothing]">empty</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; Iterator[String]" id="65140">headerNames</a> = <a href="#65124" title="=&gt; org.jboss.netty.handler.codec.http.HttpRequest">req</a>.<span title="()java.util.Set[String]">getHeaderNames</span>.<span title="(i: java.util.Iterator[String])scala.collection.convert.Decorators.AsScala[Iterator[String]]">iterator</span>.<span title="=&gt; Iterator[String]">asScala</span>
  <span class="keyword">def</span> <a title="(name: String)Iterator[String]" id="65141">headers</a><span class="delimiter">(</span><a title="String" id="70926">name</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#65124" title="=&gt; org.jboss.netty.handler.codec.http.HttpRequest">req</a>.<span title="(x$1: String)java.util.List[String]">getHeaders</span><span class="delimiter">(</span><a href="#70926" title="String">name</a><span class="delimiter">)</span>.<span title="(i: java.util.Iterator[String])scala.collection.convert.Decorators.AsScala[Iterator[String]]">iterator</span>.<span title="=&gt; Iterator[String]">asScala</span>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="65142">isSecure</a> = <a href="#65226" title="unfiltered.netty.ReceivedMessage">msg</a>.<a href="#65207" title="=&gt; org.jboss.netty.channel.ChannelHandlerContext">context</a>.<span title="()org.jboss.netty.channel.ChannelPipeline">getPipeline</span>.<span title="(x$1: Class[org.jboss.netty.handler.ssl.SslHandler])org.jboss.netty.handler.ssl.SslHandler">get</span><span title="Boolean" class="delimiter">(</span>classOf<span title="Class[org.jboss.netty.handler.ssl.SslHandler](classOf[org.jboss.netty.handler.ssl.SslHandler])" class="delimiter">[</span>org.jboss.netty.handler.ssl.SslHandler<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#122993" title="Boolean" class="keyword">null</a> =&gt; <a href="#122998" title="(x: Boolean)Boolean" class="keyword">false</a>
    <span class="keyword">case</span> _ =&gt; <a href="#122998" title="(x: Boolean)Boolean" class="keyword">true</a>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="65143">remoteAddr</a> =<a href="#65226" title="unfiltered.netty.ReceivedMessage">msg</a>.<a href="#65207" title="=&gt; org.jboss.netty.channel.ChannelHandlerContext">context</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="()java.net.SocketAddress">getRemoteAddress</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="java.net.InetSocketAddress" class="delimiter">[</span>java.net.<span title="java.net.InetSocketAddress">InetSocketAddress</span><span class="delimiter">]</span>.<span title="()java.net.InetAddress">getAddress</span>.<span title="()String">getHostAddress</span>

  <span class="keyword">def</span> <a title="(rf: unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.HttpResponse])Unit" id="65144">respond</a><span class="delimiter">(</span><a title="unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.HttpResponse]" id="65820">rf</a>: <a href="../../../unfiltered/unfiltered/unfiltered/response/functions.scala.html#9439" title="unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.HttpResponse]">ResponseFunction</a><span class="delimiter">[</span>NHttpResponse<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="../../../unfiltered/unfiltered/unfiltered/request/HttpRequest.scala.html#12727" title="=&gt; unfiltered.netty.ReceivedMessage">underlying</a>.<a href="#58652" title="(v1: unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.HttpResponse])Unit">respond</a><span class="delimiter">(</span><a href="#65820" title="unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.HttpResponse]">rf</a><span class="delimiter">)</span>
<span class="delimiter">}</span>
/** Extension of basic request binding to expose Netty-specific attributes */
<span class="keyword">case class</span> <a title="class ReceivedMessage extends AnyRef with Product with Serializable" id="72435">ReceivedMessage</a><a href="#72435" title="Product" class="delimiter">(</a>
  <a title="org.jboss.netty.handler.codec.http.HttpRequest" id="65206">request</a>: <span title="org.jboss.netty.handler.codec.http.HttpRequest">NHttpRequest</span>,
  <a title="org.jboss.netty.channel.ChannelHandlerContext" id="65207">context</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>,
  <a title="org.jboss.netty.channel.MessageEvent" id="65208">event</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span><span class="delimiter">)</span> <span class="delimiter">{</span>

  /** Binds a Netty HttpResponse res to Unfiltered's HttpResponse to apply any
   * response function to it. */
  <span class="keyword">def</span> <a title="[T &lt;: org.jboss.netty.handler.codec.http.HttpResponse](res: T)(rf: unfiltered.response.ResponseFunction[T])T" id="58647">response</a><span class="delimiter">[</span><a title=" &lt;: org.jboss.netty.handler.codec.http.HttpResponse" id="58649">T</a> &lt;: NHttpResponse<span class="delimiter">]</span><span class="delimiter">(</span><a title="T" id="59154">res</a>: <a href="#58649" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="unfiltered.response.ResponseFunction[T]" id="59155">rf</a>: <a href="../../../unfiltered/unfiltered/unfiltered/response/functions.scala.html#9439" title="unfiltered.response.ResponseFunction[T]">ResponseFunction</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="../../../unfiltered/unfiltered/unfiltered/response/functions.scala.html#22174" title="(res: unfiltered.response.HttpResponse[T])unfiltered.response.HttpResponse[T]">rf</a><span class="delimiter">(</span><span title="unfiltered.netty.ResponseBinding[T]" class="keyword">new</span> <a href="#9911" title="unfiltered.netty.ResponseBinding[T]">ResponseBinding</a><span class="delimiter">(</span><a href="#59154" title="T">res</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../unfiltered/unfiltered/unfiltered/response/HttpResponse.scala.html#22212" title="=&gt; T">underlying</a>

  /** @return a new Netty DefaultHttpResponse bound to an Unfiltered HttpResponse */
  <span class="keyword">val</span> <a title="unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.DefaultHttpResponse] =&gt; org.jboss.netty.handler.codec.http.DefaultHttpResponse" id="58650">defaultResponse</a> = <a href="#58647" title="(res: org.jboss.netty.handler.codec.http.DefaultHttpResponse)(rf: unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.DefaultHttpResponse])org.jboss.netty.handler.codec.http.DefaultHttpResponse">response</a><a href="#59243" title="unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.DefaultHttpResponse]" class="delimiter">(</a><a href="#59241" title="org.jboss.netty.handler.codec.http.DefaultHttpResponse" class="keyword">new</a> <span title="org.jboss.netty.handler.codec.http.DefaultHttpResponse">DefaultHttpResponse</span><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.HttpVersion">HTTP_1_1</span>, <span title="org.jboss.netty.handler.codec.http.HttpResponseStatus">OK</span><span class="delimiter">)</span><span class="delimiter">)</span>_
  /** Applies rf to a new `defaultResponse` and writes it out */
  <span class="keyword">def</span> <a title="=&gt; unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.HttpResponse] =&gt; Unit" id="58652">respond</a>: <span class="delimiter">(</span>ResponseFunction<span class="delimiter">[</span>NHttpResponse<span class="delimiter">]</span> =&gt; Unit<span class="delimiter">)</span> = <a href="#70970" title="unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.HttpResponse]" class="delimiter">{</a>
    <span class="keyword">case</span> <a href="../../../unfiltered/unfiltered/unfiltered/response/pass.scala.html#9308" title="Unit">Pass</a> =&gt; <a href="#65207" title="=&gt; org.jboss.netty.channel.ChannelHandlerContext">context</a>.<span title="(x$1: org.jboss.netty.channel.ChannelEvent)Unit">sendUpstream</span><a href="#123010" title="(x: Unit)Unit" class="delimiter">(</a><a href="#65208" title="=&gt; org.jboss.netty.channel.MessageEvent">event</a><span class="delimiter">)</span>
    <span class="keyword">case</span> rf =&gt;
      <span class="keyword">val</span> <a title="Boolean" id="70972">keepAlive</a> = <a href="../../../netty-uploads/unfiltered/netty/uploads/org/jboss/netty/handler/codec/http/HttpHeaders.java.html#10209" title="org.jboss.netty.handler.codec.http.HttpHeaders.type">HttpHeaders</a>.<a href="../../../netty-uploads/unfiltered/netty/uploads/org/jboss/netty/handler/codec/http/HttpHeaders.java.html#59694" title="(message: org.jboss.netty.handler.codec.http.HttpMessage)Boolean">isKeepAlive</a><span class="delimiter">(</span><a href="#65206" title="=&gt; org.jboss.netty.handler.codec.http.HttpRequest">request</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="closer extends AnyRef with unfiltered.response.Responder[org.jboss.netty.handler.codec.http.HttpResponse]" id="70973">closer</a> = <a href="#70975" title="unfiltered.response.Responder[org.jboss.netty.handler.codec.http.HttpResponse]" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with unfiltered.response.Responder[org.jboss.netty.handler.codec.http.HttpResponse]" id="70975">unfiltered</a>.response.<a href="../../../unfiltered/unfiltered/unfiltered/response/functions.scala.html#9406" title="unfiltered.response.Responder[org.jboss.netty.handler.codec.http.HttpResponse]">Responder</a><span class="delimiter">[</span>NHttpResponse<span class="delimiter">]</span> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="(res: unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse])Unit" id="70977">respond</a><span class="delimiter">(</span><a title="unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse]" id="70978">res</a>: <a href="../../../unfiltered/unfiltered/unfiltered/response/HttpResponse.scala.html#9106" title="unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse]">HttpResponse</a><span class="delimiter">[</span>NHttpResponse<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#70978" title="unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse]">res</a>.<a href="../../../unfiltered/unfiltered/unfiltered/response/HttpResponse.scala.html#22217" title="=&gt; java.io.OutputStream">outputStream</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">(</span>
            <a href="../../../unfiltered/unfiltered/unfiltered/response/functions.scala.html#22174" title="(res: unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse])unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse]" class="keyword">if</a> <span class="delimiter">(</span><a href="#70972" title="Boolean">keepAlive</a><span class="delimiter">)</span>
              unfiltered.response.<a href="../../../unfiltered/unfiltered/unfiltered/response/headers.scala.html#54841" title="(value: String*)unfiltered.response.ResponseHeader">Connection</a><span class="delimiter">(</span><span title="String(&quot;Keep-Alive&quot;)" class="string">&quot;Keep-Alive&quot;</span><span class="delimiter">)</span> <a href="../../../unfiltered/unfiltered/unfiltered/response/functions.scala.html#22177" title="(that: unfiltered.response.ResponseFunction[Any])unfiltered.response.ResponseFunction[Any]">~&gt;</a>
              unfiltered.response.<a href="../../../unfiltered/unfiltered/unfiltered/response/headers.scala.html#54841" title="(value: String*)unfiltered.response.ResponseHeader">ContentLength</a><span class="delimiter">(</span>
                <a href="#70978" title="unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse]">res</a>.<a href="../../../unfiltered/unfiltered/unfiltered/response/HttpResponse.scala.html#22212" title="=&gt; org.jboss.netty.handler.codec.http.HttpResponse">underlying</a>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getContent</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Int">readableBytes</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()String">toString</span><span class="delimiter">)</span>
            <span class="keyword">else</span> unfiltered.response.<a href="../../../unfiltered/unfiltered/unfiltered/response/headers.scala.html#54841" title="(value: String*)unfiltered.response.ResponseHeader">Connection</a><span class="delimiter">(</span><span title="String(&quot;close&quot;)" class="string">&quot;close&quot;</span><span class="delimiter">)</span>
          <span class="delimiter">)</span><span title="Unit" class="delimiter">(</span><a href="#70978" title="unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse]">res</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="org.jboss.netty.channel.ChannelFuture" id="70974">future</a> = <a href="#65208" title="=&gt; org.jboss.netty.channel.MessageEvent">event</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="(x$1: Any)org.jboss.netty.channel.ChannelFuture">write</span><span class="delimiter">(</span>
        <a href="#58650" title="(v1: unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.DefaultHttpResponse])org.jboss.netty.handler.codec.http.DefaultHttpResponse">defaultResponse</a><span class="delimiter">(</span><a href="#123006" title="unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.HttpResponse]">rf</a> <a href="../../../unfiltered/unfiltered/unfiltered/response/functions.scala.html#22177" title="(that: unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.HttpResponse])unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.HttpResponse]">~&gt;</a> <a href="#70973" title="closer extends AnyRef with unfiltered.response.Responder[org.jboss.netty.handler.codec.http.HttpResponse]">closer</a><span class="delimiter">)</span>
      <span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#70972" title="Boolean">keepAlive</a><span class="delimiter">)</span>
        <a href="#70974" title="org.jboss.netty.channel.ChannelFuture">future</a>.<span title="(x$1: org.jboss.netty.channel.ChannelFutureListener)Unit">addListener</span><span class="delimiter">(</span><span title="org.jboss.netty.channel.ChannelFutureListener.type">ChannelFutureListener</span>.<span title="org.jboss.netty.channel.ChannelFutureListener">CLOSE</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class ResponseBinding[U &lt;: org.jboss.netty.handler.codec.http.HttpResponse] extends unfiltered.response.HttpResponse[U]" id="9911">ResponseBinding</a><span class="delimiter">[</span><a title=" &lt;: org.jboss.netty.handler.codec.http.HttpResponse" id="11092">U</a> &lt;: NHttpResponse<span class="delimiter">]</span><a href="#9911" title="unfiltered.netty.ResponseBinding[U]" class="delimiter">(</a><a title="U" id="59175">res</a>: <a href="#11092" title="U">U</a><span class="delimiter">)</span>
    <span class="keyword">extends</span> <a href="../../../unfiltered/unfiltered/unfiltered/response/HttpResponse.scala.html#9106" title="unfiltered.response.HttpResponse[U]">HttpResponse</a><span class="delimiter">(</span><a href="#59175" title="U">res</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.io.ByteArrayOutputStream" id="59168">byteOutputStream</a> = <a href="#71081" title="java.io.ByteArrayOutputStream" class="keyword">new</a> <a title="anonymous class $anon extends java.io.ByteArrayOutputStream" id="71081">ByteArrayOutputStream</a> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="71083">close</a> = <span class="delimiter">{</span>
      <a href="#59175" title="U">res</a>.<span title="(x$1: org.jboss.netty.buffer.ChannelBuffer)Unit">setContent</span><span class="delimiter">(</span><span title="org.jboss.netty.buffer.ChannelBuffers.type">ChannelBuffers</span>.<span title="(x$1: Array[Byte])org.jboss.netty.buffer.ChannelBuffer">copiedBuffer</span><span class="delimiter">(</span><a href="#71081" title="unfiltered.netty.ResponseBinding.$anon.type" class="keyword">this</a>.<span title="()Array[Byte]">toByteArray</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(statusCode: Int)Unit" id="59170">status</a><span class="delimiter">(</span><a title="Int" id="71103">statusCode</a>: <span title="Int">Int</span><span class="delimiter">)</span> =
    <a href="#59175" title="U">res</a>.<span title="(x$1: org.jboss.netty.handler.codec.http.HttpResponseStatus)Unit">setStatus</span><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.HttpResponseStatus.type">HttpResponseStatus</span>.<span title="(x$1: Int)org.jboss.netty.handler.codec.http.HttpResponseStatus">valueOf</span><span class="delimiter">(</span><a href="#71103" title="Int">statusCode</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(name: String, value: String)Unit" id="59171">header</a><span class="delimiter">(</span><a title="String" id="71104">name</a>: <span title="String">String</span>, <a title="String" id="71105">value</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#59175" title="U">res</a>.<span title="(x$1: String, x$2: Any)Unit">addHeader</span><span class="delimiter">(</span><a href="#71104" title="String">name</a>, <a href="#71105" title="String">value</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(url: String)Unit" id="59172">redirect</a><span class="delimiter">(</span><a title="String" id="71106">url</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#59175" title="U">res</a>.<span title="(x$1: org.jboss.netty.handler.codec.http.HttpResponseStatus)Unit">setStatus</span><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.HttpResponseStatus.type">HttpResponseStatus</span>.<span title="org.jboss.netty.handler.codec.http.HttpResponseStatus">FOUND</span><span class="delimiter">)</span>
    <a href="#59175" title="U">res</a>.<span title="(x$1: String, x$2: Any)Unit">setHeader</span><span class="delimiter">(</span><a href="../../../netty-uploads/unfiltered/netty/uploads/org/jboss/netty/handler/codec/http/HttpHeaders.java.html#10209" title="org.jboss.netty.handler.codec.http.HttpHeaders.type">HttpHeaders</a>.<a href="../../../netty-uploads/unfiltered/netty/uploads/org/jboss/netty/handler/codec/http/HttpHeaders.java.html#59688" title="org.jboss.netty.handler.codec.http.HttpHeaders.Names.type">Names</a>.<a href="../../../netty-uploads/unfiltered/netty/uploads/org/jboss/netty/handler/codec/http/HttpHeaders.java.html#71146" title="String">LOCATION</a>, <a href="#71106" title="String">url</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; java.io.ByteArrayOutputStream" id="59173">outputStream</a> = <a href="#59168" title="=&gt; java.io.ByteArrayOutputStream">byteOutputStream</a>
<span class="delimiter">}</span>

<span class="keyword">private</span> <span class="delimiter">[</span>netty<span class="delimiter">]</span> <span class="keyword">object</span> <a title="unfiltered.netty.URLParser.type" id="9969">URLParser</a> <a href="#9970" title="unfiltered.netty.URLParser.type" class="delimiter">{</a>

  <span class="keyword">def</span> <a title="(enc: String)Map[String,Seq[String]]" id="70365">urldecode</a><span class="delimiter">(</span><a title="String" id="70366">enc</a>: <span title="String">String</span><span class="delimiter">)</span> : <span title="Map[String,Seq[String]]">Map</span><span class="delimiter">[</span>String, Seq<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(raw: String)String" id="71181">decode</a><span class="delimiter">(</span><a title="String" id="71183">raw</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="java.net.URLDecoder.type">URLDecoder</span>.<span title="(x$1: String, x$2: String)String">decode</span><span class="delimiter">(</span><a href="#71183" title="String">raw</a>, <a href="#9798" title="unfiltered.netty.HttpConfig.type">HttpConfig</a>.<a href="#70344" title="=&gt; String">DEFAULT_CHARSET</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[(String, String)]" id="71182">pairs</a> = <a href="#70366" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">enc</a>.<span title="(separator: Char)Array[String]">split</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><span title="Char('&amp;')" class="char">'&amp;'</span><span class="delimiter">)</span>.<span title="(f: String =&gt; scala.collection.GenTraversableOnce[(String, String)])(implicit bf: scala.collection.generic.CanBuildFrom[Array[String],(String, String),Array[(String, String)]])Array[(String, String)]">flatMap</span> <span title="(xs: Array[(String, String)])scala.collection.mutable.ArrayOps[(String, String)]" class="delimiter">{</span>
      <a href="#71601" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">_</a>.<span title="(separator: Char)Array[String]">split</span><span title="List[(String, String)]" class="delimiter">(</span><span title="Char('=')" class="char">'='</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#123049" title="(x: Array[String])Option[IndexedSeq[String]]">Array</a><span class="delimiter">(</span><a title="String" id="71628">key</a>, <a title="String" id="71629">value</a><span class="delimiter">)</span> =&gt; <span title="(xs: (String, String)*)List[(String, String)]">List</span><a href="#123055" title="(x: List[(String, String)])List[(String, String)]" class="delimiter">(</a><span title="(_1: String, _2: String)(String, String)" class="delimiter">(</span><a href="#71181" title="(raw: String)String">decode</a><span class="delimiter">(</span><a href="#71628" title="String">key</a><span class="delimiter">)</span>, <a href="#71181" title="(raw: String)String">decode</a><span class="delimiter">(</span><a href="#71629" title="String">value</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#123049" title="(x: Array[String])Option[IndexedSeq[String]]">Array</a><span class="delimiter">(</span><a title="String" id="71649">key</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#71649" title="String">key</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> =&gt; <span title="(xs: (String, String)*)List[(String, String)]">List</span><a href="#123055" title="(x: List[(String, String)])List[(String, String)]" class="delimiter">(</a><span title="(_1: String, _2: String)(String, String)" class="delimiter">(</span><a href="#71181" title="(raw: String)String">decode</a><span class="delimiter">(</span><a href="#71649" title="String">key</a><span class="delimiter">)</span>, <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> _ =&gt; <a href="#123055" title="(x: List[(String, String)])List[(String, String)]">Nil</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>.<span title="=&gt; Array[(String, String)]">reverse</span>
    <span class="delimiter">(</span><span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[String,List[String]]" class="delimiter">[</span><span title="String">String</span>, <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span>.<span title="(d: String =&gt; List[String])scala.collection.immutable.Map[String,List[String]]">withDefault</span> <span class="delimiter">{</span><a title="String" id="72104">_</a> =&gt; <span title="scala.collection.immutable.Nil.type">Nil</span> <span class="delimiter">}</span> <a href="#72097" title="(z: scala.collection.immutable.Map[String,List[String]])(op: (scala.collection.immutable.Map[String,List[String]], (String, String)) =&gt; scala.collection.immutable.Map[String,List[String]])scala.collection.immutable.Map[String,List[String]]">/:</a> <a href="#71182" title="(xs: Array[(String, String)])scala.collection.mutable.ArrayOps[(String, String)]">pairs</a><span class="delimiter">)</span> <a href="#72311" title="(_1: scala.collection.immutable.Map[String,List[String]], _2: (String, String))(scala.collection.immutable.Map[String,List[String]], (String, String))" class="delimiter">{</a>
      <span class="keyword">case</span> <span class="delimiter">(</span><a href="#123112" title="scala.collection.immutable.Map[String,List[String]]" id="72321">m</a>, <a href="#123112" title="=&gt; (String, String)" class="delimiter">(</a><a href="#123113" title="String" id="72324">k</a>, <a href="#123113" title="String" id="72325">v</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#72321" title="scala.collection.immutable.Map[String,List[String]]">m</a> <a href="#123115" title="(x: scala.collection.immutable.Map[String,List[String]])scala.collection.immutable.Map[String,List[String]]">+</a> <span class="delimiter">(</span><a href="#72324" title="(x: String)ArrowAssoc[String]">k</a> <span title="(y: List[String])(String, List[String])">-&gt;</span> <span class="delimiter">(</span><a href="#72325" title="String">v</a> <a href="#72386" title="(x: String)List[String]">::</a> <a href="#72321" title="(key: String)List[String]">m</a><span class="delimiter">(</span><a href="#72324" title="String">k</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>