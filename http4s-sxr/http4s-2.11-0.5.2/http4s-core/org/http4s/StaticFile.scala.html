<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>http4s-core/org/http4s/StaticFile.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
package org.http4s

import java.io.File
import java.util.Collections
import java.net.URL
import java.nio.ByteBuffer
import java.nio.channels.<span class="delimiter">{</span>CompletionHandler, AsynchronousFileChannel<span class="delimiter">}</span>
import java.nio.file.Files
import java.util.concurrent.ExecutorService

import scalaz.stream.<span title="scalaz.stream.Cause.type">Cause</span>.<span class="delimiter">{</span>End, Terminated<span class="delimiter">}</span>
import scalaz.<span class="delimiter">{</span>\/-, -\/<span class="delimiter">}</span>
import scalaz.concurrent.<span class="delimiter">{</span>Strategy, Task<span class="delimiter">}</span>
import scalaz.stream.Process
import <span title="scalaz.stream.Process.type">Process</span>._

import org.http4s.<a href="Header.scala.html#org.http4s.Header" title="org.http4s.Header.type">Header</a>._
import org.http4s.<a href="Status.scala.html#org.http4s.Status" title="org.http4s.Status.type">Status</a>.NotModified
import org.log4s.getLogger
import scodec.bits.ByteVector

<span class="comment">// TODO: consider using the new scalaz.stream.nio.file operations</span>
object <a title="org.http4s.StaticFile.type" id="org.http4s.StaticFile">StaticFile</a> <a href="#org.http4s.StaticFile" title="org.http4s.StaticFile.type" class="delimiter">{</a>
  private<span class="delimiter">[</span>this<span class="delimiter">]</span> val <a title="org.log4s.Logger" id="org.http4s.StaticFile.logger">logger</a> = <span title="org.log4s.Logger">getLogger</span>

  val <a title="Int" id="org.http4s.StaticFile.DefaultBufferSize">DefaultBufferSize</a> = <span title="Int(10240)" class="int">10240</span>

  def <a title="(url: String, req: Option[org.http4s.Request])(implicit es: java.util.concurrent.ExecutorService)Option[org.http4s.Response]" id="org.http4s.StaticFile.fromString">fromString</a><span class="delimiter">(</span><a title="String" id="org.http4s.StaticFile.fromString$default$3.url">url</a>: <span title="String">String</span>, <a title="Option[org.http4s.Request]" id="org.http4s.StaticFile.fromString$default$3.req">req</a>: <span title="Option[org.http4s.Request]">Option</span><span class="delimiter">[</span>Request<span class="delimiter">]</span> = <span title="None.type">None</span><span class="delimiter">)</span>
                <span class="delimiter">(</span>implicit <a title="java.util.concurrent.ExecutorService" id="org.http4s.StaticFile.fromString$default$3">es</a>: <span title="java.util.concurrent.ExecutorService">ExecutorService</span> = <span title="scalaz.concurrent.Strategy.type">Strategy</span>.<span title="=&gt; java.util.concurrent.ExecutorService">DefaultExecutorService</span><span class="delimiter">)</span>: <span title="Option[org.http4s.Response]">Option</span><span class="delimiter">[</span>Response<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#org.http4s.StaticFile.fromFile(eab475d0b7)" title="(f: java.io.File, req: Option[org.http4s.Request])(implicit es: java.util.concurrent.ExecutorService)Option[org.http4s.Response]">fromFile</a><a href="#org.http4s.StaticFile.fromString$default$3" title="java.util.concurrent.ExecutorService" class="delimiter">(</a>new <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromString$default$3.url" title="String">url</a><span class="delimiter">)</span>, <a href="#org.http4s.StaticFile.fromString$default$3.req" title="Option[org.http4s.Request]">req</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(name: String, req: Option[org.http4s.Request])(implicit es: java.util.concurrent.ExecutorService)Option[org.http4s.Response]" id="org.http4s.StaticFile.fromResource">fromResource</a><span class="delimiter">(</span><a title="String" id="org.http4s.StaticFile.fromResource$default$3.name">name</a>: <span title="String">String</span>, <a title="Option[org.http4s.Request]" id="org.http4s.StaticFile.fromResource$default$3.req">req</a>: <span title="Option[org.http4s.Request]">Option</span><span class="delimiter">[</span>Request<span class="delimiter">]</span> = <span title="None.type">None</span><span class="delimiter">)</span>
             <span class="delimiter">(</span>implicit <a title="java.util.concurrent.ExecutorService" id="org.http4s.StaticFile.fromResource$default$3">es</a>: <span title="java.util.concurrent.ExecutorService">ExecutorService</span> = <span title="scalaz.concurrent.Strategy.type">Strategy</span>.<span title="=&gt; java.util.concurrent.ExecutorService">DefaultExecutorService</span><span class="delimiter">)</span>: <span title="Option[org.http4s.Response]">Option</span><span class="delimiter">[</span>Response<span class="delimiter">]</span> = <span class="delimiter">{</span>
    val <a title="java.net.URL" id="org.http4s.StaticFile.fromResource.url">url</a> = <span title="()Class[_]">getClass</span>.<span title="(x$1: String)java.net.URL">getResource</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromResource$default$3.name" title="String">name</a><span class="delimiter">)</span>
    if <span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromResource.url" title="java.net.URL">url</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <a href="#org.http4s.StaticFile" title="org.http4s.StaticFile.type">StaticFile</a>.<a href="#org.http4s.StaticFile.fromURL" title="(url: java.net.URL, req: Option[org.http4s.Request])(implicit es: java.util.concurrent.ExecutorService)Option[org.http4s.Response]">fromURL</a><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromResource.url" title="java.net.URL">url</a>, <a href="#org.http4s.StaticFile.fromResource$default$3.req" title="Option[org.http4s.Request]">req</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromResource$default$3" title="java.util.concurrent.ExecutorService">es</a><span class="delimiter">)</span>
    else <span title="None.type">None</span>
  <span class="delimiter">}</span>

  def <a title="(url: java.net.URL, req: Option[org.http4s.Request])(implicit es: java.util.concurrent.ExecutorService)Option[org.http4s.Response]" id="org.http4s.StaticFile.fromURL">fromURL</a><span class="delimiter">(</span><a title="java.net.URL" id="org.http4s.StaticFile.fromURL$default$3.url">url</a>: <span title="java.net.URL">URL</span>, <a title="Option[org.http4s.Request]" id="org.http4s.StaticFile.fromURL$default$3.req">req</a>: <span title="Option[org.http4s.Request]">Option</span><span class="delimiter">[</span>Request<span class="delimiter">]</span> = <span title="None.type">None</span><span class="delimiter">)</span>
             <span class="delimiter">(</span>implicit <a title="java.util.concurrent.ExecutorService" id="org.http4s.StaticFile.fromURL$default$3">es</a>: <span title="java.util.concurrent.ExecutorService">ExecutorService</span> = <span title="scalaz.concurrent.Strategy.type">Strategy</span>.<span title="=&gt; java.util.concurrent.ExecutorService">DefaultExecutorService</span><span class="delimiter">)</span>: <span title="Option[org.http4s.Response]">Option</span><span class="delimiter">[</span>Response<span class="delimiter">]</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromURL$default$3.url" title="java.net.URL">url</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span>
      throw new <span title="NullPointerException">NullPointerException</span><span class="delimiter">(</span><span title="String(&quot;url&quot;)" class="string">&quot;url&quot;</span><span class="delimiter">)</span>

    <a href="#org.http4s.StaticFile.fromFile(eab475d0b7)" title="(f: java.io.File, req: Option[org.http4s.Request])(implicit es: java.util.concurrent.ExecutorService)Option[org.http4s.Response]">fromFile</a><span class="delimiter">(</span>new <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromURL$default$3.url" title="java.net.URL">url</a>.<span title="()java.net.URI">toURI</span><span class="delimiter">)</span>, <a href="#org.http4s.StaticFile.fromURL$default$3.req" title="Option[org.http4s.Request]">req</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromURL$default$3" title="java.util.concurrent.ExecutorService">es</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  def <a title="(f: java.io.File, req: Option[org.http4s.Request])(implicit es: java.util.concurrent.ExecutorService)Option[org.http4s.Response]" id="org.http4s.StaticFile.fromFile(eab475d0b7)">fromFile</a><span class="delimiter">(</span><a title="java.io.File" id="org.http4s.StaticFile.fromFile$default$3.f">f</a>: <span title="java.io.File">File</span>, <a title="Option[org.http4s.Request]" id="org.http4s.StaticFile.fromFile$default$3.req">req</a>: <span title="Option[org.http4s.Request]">Option</span><span class="delimiter">[</span>Request<span class="delimiter">]</span> = <span title="None.type">None</span><span class="delimiter">)</span><span class="delimiter">(</span>implicit <a title="java.util.concurrent.ExecutorService" id="org.http4s.StaticFile.fromFile$default$3">es</a>: <span title="java.util.concurrent.ExecutorService">ExecutorService</span> = <span title="scalaz.concurrent.Strategy.type">Strategy</span>.<span title="=&gt; java.util.concurrent.ExecutorService">DefaultExecutorService</span><span class="delimiter">)</span>: <span title="Option[org.http4s.Response]">Option</span><span class="delimiter">[</span>Response<span class="delimiter">]</span> =
    <a href="#org.http4s.StaticFile.fromFile(6157914500)" title="(f: java.io.File, buffsize: Int, req: Option[org.http4s.Request])(implicit es: java.util.concurrent.ExecutorService)Option[org.http4s.Response]">fromFile</a><a href="#org.http4s.StaticFile.fromFile$default$3" title="java.util.concurrent.ExecutorService" class="delimiter">(</a><a href="#org.http4s.StaticFile.fromFile$default$3.f" title="java.io.File">f</a>, <a href="#org.http4s.StaticFile.DefaultBufferSize" title="=&gt; Int">DefaultBufferSize</a>, <a href="#org.http4s.StaticFile.fromFile$default$3.req" title="Option[org.http4s.Request]">req</a><span class="delimiter">)</span>

  def <a title="(f: java.io.File, buffsize: Int, req: Option[org.http4s.Request])(implicit es: java.util.concurrent.ExecutorService)Option[org.http4s.Response]" id="org.http4s.StaticFile.fromFile(6157914500)">fromFile</a><span class="delimiter">(</span><a title="java.io.File" id="org.http4s.StaticFile.fromFile(6157914500).f">f</a>: <span title="java.io.File">File</span>, <a title="Int" id="org.http4s.StaticFile.fromFile(6157914500).buffsize">buffsize</a>: <span title="Int">Int</span>, <a title="Option[org.http4s.Request]" id="org.http4s.StaticFile.fromFile(6157914500).req">req</a>: <span title="Option[org.http4s.Request]">Option</span><span class="delimiter">[</span>Request<span class="delimiter">]</span><span class="delimiter">)</span>
           <span class="delimiter">(</span>implicit <a title="java.util.concurrent.ExecutorService" id="org.http4s.StaticFile.fromFile(6157914500).es">es</a>: <span title="java.util.concurrent.ExecutorService">ExecutorService</span><span class="delimiter">)</span>: <span title="Option[org.http4s.Response]">Option</span><span class="delimiter">[</span>Response<span class="delimiter">]</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(6157914500).f" title="java.io.File">f</a>.<span title="()Boolean">isFile</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#org.http4s.StaticFile" title="org.http4s.StaticFile.type">StaticFile</a>.<a href="#org.http4s.StaticFile.fromFile(ef2071f5da)" title="(f: java.io.File, start: Long, end: Long, buffsize: Int, req: Option[org.http4s.Request])(implicit es: java.util.concurrent.ExecutorService)Option[org.http4s.Response]">fromFile</a><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(6157914500).f" title="java.io.File">f</a>, <span title="Long(0L)" class="int">0</span>, <a href="#org.http4s.StaticFile.fromFile(6157914500).f" title="java.io.File">f</a>.<span title="()Long">length</span><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#org.http4s.StaticFile.fromFile(6157914500).buffsize" title="Int">buffsize</a>, <a href="#org.http4s.StaticFile.fromFile(6157914500).req" title="Option[org.http4s.Request]">req</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(6157914500).es" title="java.util.concurrent.ExecutorService">es</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    else <span title="None.type">None</span>
  <span class="delimiter">}</span>

  def <a title="(f: java.io.File, start: Long, end: Long, buffsize: Int, req: Option[org.http4s.Request])(implicit es: java.util.concurrent.ExecutorService)Option[org.http4s.Response]" id="org.http4s.StaticFile.fromFile(ef2071f5da)">fromFile</a><span class="delimiter">(</span><a title="java.io.File" id="org.http4s.StaticFile.fromFile(ef2071f5da).f">f</a>: <span title="java.io.File">File</span>, <a title="Long" id="org.http4s.StaticFile.fromFile(ef2071f5da).start">start</a>: <span title="Long">Long</span>, <a title="Long" id="org.http4s.StaticFile.fromFile(ef2071f5da).end">end</a>: <span title="Long">Long</span>, <a title="Int" id="org.http4s.StaticFile.fromFile(ef2071f5da).buffsize">buffsize</a>: <span title="Int">Int</span>, <a title="Option[org.http4s.Request]" id="org.http4s.StaticFile.fromFile(ef2071f5da).req">req</a>: <span title="Option[org.http4s.Request]">Option</span><span class="delimiter">[</span>Request<span class="delimiter">]</span><span class="delimiter">)</span>
                        <span class="delimiter">(</span>implicit <a title="java.util.concurrent.ExecutorService" id="org.http4s.StaticFile.fromFile(ef2071f5da).es">es</a>: <span title="java.util.concurrent.ExecutorService">ExecutorService</span><span class="delimiter">)</span>: <span title="Option[org.http4s.Response]">Option</span><span class="delimiter">[</span>Response<span class="delimiter">]</span> = <span class="delimiter">{</span>

    if <span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).f" title="java.io.File">f</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span> throw new <span title="NullPointerException">NullPointerException</span><span class="delimiter">(</span><span title="String(&quot;File&quot;)" class="string">&quot;File&quot;</span><span class="delimiter">)</span>

    if <span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).start" title="Long">start</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">||</span> <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).end" title="Long">end</a> <span title="(x: Long)Boolean">&lt;</span> <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).start" title="Long">start</a> <span title="(x: Boolean)Boolean">||</span> <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).buffsize" title="Int">buffsize</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      throw new <span title="Exception">Exception</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;start: &quot;)">start: $</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).start" title="Long">start</a><span title="String(&quot;, end: &quot;)">, end: $</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).end" title="Long">end</a><span title="String(&quot;, buffsize: &quot;)">, buffsize: $</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).buffsize" title="Int">buffsize</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>

    if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).f" title="java.io.File">f</a>.<span title="()Boolean">isFile</span><span class="delimiter">)</span> return <span title="None.type">None</span>

    val <a title="Long" id="org.http4s.StaticFile.fromFile(ef2071f5da).lastModified">lastModified</a> = <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).f" title="java.io.File">f</a>.<span title="()Long">lastModified</span><span class="delimiter">(</span><span class="delimiter">)</span>

<span class="comment">//    // See if we need to actually resend the file</span>
    if <span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).req" title="Option[org.http4s.Request]">req</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).req" title="Option[org.http4s.Request]">req</a>.<span title="=&gt; org.http4s.Request">get</span>.<a href="Message.scala.html#org.http4s;Request.headers" title="=&gt; org.http4s.Headers">headers</a>.<a href="Headers.scala.html#org.http4s;Headers.get(2d275bcbb3)" title="(key: org.http4s.HeaderKey.Extractable)Option[key.HeaderT]">get</a><span class="delimiter">(</span><a href="Header.scala.html#org.http4s.Header.If-Modified-Since" title="org.http4s.Header.If-Modified-Since.type">`If-Modified-Since`</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><a title="org.http4s.Header.If-Modified-Since.HeaderT" id="org.http4s.StaticFile.fromFile(ef2071f5da).h">h</a><span class="delimiter">)</span> =&gt;
          val <a title="org.http4s.DateTime" id="org.http4s.StaticFile.fromFile(ef2071f5da).mod">mod</a> = <a href="DateTime.scala.html#org.http4s.DateTime.apply(e9b8436550)" title="(clicks: Long)org.http4s.DateTime">DateTime</a><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).lastModified" title="Long">lastModified</a><span class="delimiter">)</span>
          val expired = <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).h" title="org.http4s.Header.If-Modified-Since.HeaderT">h</a>.<a href="Header.scala.html#org.http4s.Header;If-Modified-Since.date" title="=&gt; org.http4s.DateTime">date</a>.<span title="(that: org.http4s.DateTime)Int">compareTo</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).mod" title="org.http4s.DateTime">mod</a><span class="delimiter">)</span> <a title="Boolean" id="org.http4s.StaticFile.fromFile(ef2071f5da).expired">&lt;</a> <span title="Int(0)" class="int">0</span>
          <a href="#org.http4s.StaticFile.logger" title="org.log4s.Logger">logger</a>.trace<span title="Unit" class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Expired: &quot;)">Expired: $</span><span class="delimiter">{</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).expired" title="Boolean">expired</a><span class="delimiter">}</span><span title="String(&quot;. Request age: &quot;)">. Request age: $</span><span class="delimiter">{</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).h" title="org.http4s.Header.If-Modified-Since.HeaderT">h</a>.<a href="Header.scala.html#org.http4s.Header;If-Modified-Since.date" title="=&gt; org.http4s.DateTime">date</a><span class="delimiter">}</span><span title="String(&quot;, Modified: &quot;)">, Modified: $</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).mod" title="org.http4s.DateTime">mod</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
          if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).expired" title="Boolean">expired</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            return <span title="(x: org.http4s.Response)Some[org.http4s.Response]">Some</span><span class="delimiter">(</span><a href="Message.scala.html#org.http4s;Response" title="(status: org.http4s.Status, httpVersion: org.http4s.HttpVersion, headers: org.http4s.Headers, body: org.http4s.EntityBody, attributes: org.http4s.AttributeMap)org.http4s.Response">Response</a><span class="delimiter">(</span><a href="Status.scala.html#org.http4s.Status.NotModified" title="=&gt; org.http4s.Status">NotModified</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        case _ =&gt;  <span class="comment">// Just send it</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    val <a title="org.http4s.Header.Last-Modified" id="org.http4s.StaticFile.fromFile(ef2071f5da).lastmodified">lastmodified</a> = <a href="Header.scala.html#org.http4s.Header;Last-Modified" title="(date: org.http4s.DateTime)org.http4s.Header.Last-Modified">`Last-Modified`</a><span class="delimiter">(</span><a href="DateTime.scala.html#org.http4s.DateTime.apply(e9b8436550)" title="(clicks: Long)org.http4s.DateTime">DateTime</a><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).lastModified" title="Long">lastModified</a><span class="delimiter">)</span><span class="delimiter">)</span>

    val <a title="Option[org.http4s.Header.Content-Type]" id="org.http4s.StaticFile.fromFile(ef2071f5da).mimeheader">mimeheader</a> = <span title="(x: String)Option[String]">Option</span><span class="delimiter">(</span><span title="java.nio.file.Files.type">Files</span>.<span title="(x$1: java.nio.file.Path)String">probeContentType</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).f" title="java.io.File">f</a>.<span title="()java.nio.file.Path">toPath</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: String =&gt; Option[org.http4s.Header.Content-Type])Option[org.http4s.Header.Content-Type]">flatMap</span> <span class="delimiter">{</span> <a title="String" id="org.http4s.StaticFile.fromFile(ef2071f5da).mimeheader.$anonfun.mime">mime</a> =&gt;
      val <a title="Array[String]" id="org.http4s.StaticFile.fromFile(ef2071f5da).mimeheader.$anonfun.parts">parts</a> = <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).mimeheader.$anonfun.mime" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">mime</a>.<span title="(separator: Char)Array[String]">split</span><span class="delimiter">(</span><span title="Char('/')" class="char">'/'</span><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).mimeheader.$anonfun.parts" title="Array[String]">parts</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="MediaType.scala.html#org.http4s.MediaType" title="org.http4s.MediaType.type">MediaType</a>.<a href="util/Registry.scala.html#org.http4s.util;Registry.get" title="(key: org.http4s.MediaType.Key)Option[org.http4s.MediaType.Value]">get</a><span class="delimiter">(</span> <span title="(_1: String, _2: String)(String, String)" class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).mimeheader.$anonfun.parts" title="(i: Int)String">parts</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).mimeheader.$anonfun.parts" title="(i: Int)String">parts</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">)</span>.<span title="(f: org.http4s.MediaType.Value =&gt; org.http4s.Header.Content-Type)Option[org.http4s.Header.Content-Type]">map</span><span class="delimiter">(</span><a href="Header.scala.html#org.http4s.Header.Content-Type.apply(cee1da9291)" title="implicit org.http4s.Header.Content-Type.apply : (mediaType: org.http4s.MediaType)org.http4s.Header.Content-Type">`Content-Type`</a><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).mimeheader.$anonfun.$anonfun.x$1" title="org.http4s.MediaType.Value">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> else <span title="None.type">None</span>
    <span class="delimiter">}</span>

    val <a title="Long" id="org.http4s.StaticFile.fromFile(ef2071f5da).len">len</a> = <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).f" title="java.io.File">f</a>.<span title="()Long">length</span><span class="delimiter">(</span><span class="delimiter">)</span>
    val <a title="scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]" id="org.http4s.StaticFile.fromFile(ef2071f5da).body">body</a> = if <span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).len" title="Long">len</a> <span title="(x: Long)Boolean">&lt;</span> <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).end" title="Long">end</a><span class="delimiter">)</span> <span title="=&gt; scalaz.stream.Process0[Nothing]">halt</span> else <a href="#org.http4s.StaticFile.fileToBody" title="(f: java.io.File, start: Long, end: Long, buffsize: Int)(implicit es: java.util.concurrent.ExecutorService)scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">fileToBody</a><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).es" title="java.util.concurrent.ExecutorService" class="delimiter">(</a><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).f" title="java.io.File">f</a>, <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).start" title="Long">start</a>, <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).end" title="Long">end</a>, <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).buffsize" title="Int">buffsize</a><span class="delimiter">)</span>
    val <a title="org.http4s.Header.Content-Length" id="org.http4s.StaticFile.fromFile(ef2071f5da).lengthheader">lengthheader</a> = <a href="Header.scala.html#org.http4s.Header;Content-Length" title="(length: Int)org.http4s.Header.Content-Length">`Content-Length`</a><span class="delimiter">(</span>if <span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).len" title="Long">len</a> <span title="(x: Long)Boolean">&lt;</span> <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).end" title="Long">end</a><span class="delimiter">)</span> <span title="Int(0)" class="int">0</span> else <span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).end" title="Long">end</a> <span title="(x: Long)Long">-</span> <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).start" title="Long">start</a><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span>

    <span class="comment">// See if we have a mime type or not</span>
    val <a title="org.http4s.Headers" id="org.http4s.StaticFile.fromFile(ef2071f5da).headers">headers</a> = <a href="Headers.scala.html#org.http4s.Headers" title="org.http4s.Headers.type">Headers</a>.<a href="Headers.scala.html#org.http4s.Headers.apply(d220169851)" title="(headers: List[org.http4s.Header])org.http4s.Headers">apply</a><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).mimeheader" title="Option[org.http4s.Header.Content-Type]">mimeheader</a> match <span class="delimiter">{</span>
      case Some<span class="delimiter">(</span><a title="org.http4s.Header.Content-Type" id="org.http4s.StaticFile.fromFile(ef2071f5da).headers.h">h</a><span class="delimiter">)</span> =&gt;  <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).headers.h" title="org.http4s.Header.Content-Type">h</a><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).headers.x$4" title="(x: org.http4s.Header.Parsed with Serializable{def key: org.http4s.HeaderKey.Singleton with Serializable})List[org.http4s.Header.Parsed with Serializable{def key: org.http4s.HeaderKey.Singleton with Serializable}]">::</a><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).lastmodified" title="org.http4s.Header.Last-Modified">lastmodified</a><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).headers.x$3" title="(x: org.http4s.Header.Parsed with Serializable{def key: org.http4s.HeaderKey.Singleton with Serializable})List[org.http4s.Header.Parsed with Serializable{def key: org.http4s.HeaderKey.Singleton with Serializable}]">::</a><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).lengthheader" title="org.http4s.Header.Content-Length">lengthheader</a><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).headers.x$2" title="(x: org.http4s.Header.Content-Length)List[org.http4s.Header.Content-Length]">::</a><span title="scala.collection.immutable.Nil.type">Nil</span>
      case <span title="None.type">None</span>    =&gt;     <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).lastmodified" title="org.http4s.Header.Last-Modified">lastmodified</a><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).headers.x$6" title="(x: org.http4s.Header.Parsed with Serializable{def key: org.http4s.HeaderKey.Singleton with Serializable})List[org.http4s.Header.Parsed with Serializable{def key: org.http4s.HeaderKey.Singleton with Serializable}]">::</a><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).lengthheader" title="org.http4s.Header.Content-Length">lengthheader</a><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).headers.x$5" title="(x: org.http4s.Header.Content-Length)List[org.http4s.Header.Content-Length]">::</a><span title="scala.collection.immutable.Nil.type">Nil</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    val <a title="org.http4s.Response" id="org.http4s.StaticFile.fromFile(ef2071f5da).r">r</a> = <a href="Message.scala.html#org.http4s.Response.apply$default$1" title="org.http4s.Status" id="org.http4s.StaticFile.fromFile(ef2071f5da).r.x$12">Response</a><span class="delimiter">(</span>
      headers = <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).headers" title="org.http4s.Headers" id="org.http4s.StaticFile.fromFile(ef2071f5da).r.x$8">headers</a>,
      body = <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).body" title="scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector] @scala.reflect.internal.annotations.uncheckedBounds" id="org.http4s.StaticFile.fromFile(ef2071f5da).r.x$9">body</a>,
      attributes = <a href="AttributeMap.scala.html#org.http4s.AttributeMap" title="org.http4s.AttributeMap.type">AttributeMap</a>.<a href="AttributeMap.scala.html#org.http4s.AttributeMap.empty" title="=&gt; org.http4s.AttributeMap">empty</a>.<a href="AttributeMap.scala.html#org.http4s;AttributeMap.put" title="(k: org.http4s.AttributeKey[java.io.File], value: java.io.File)org.http4s.AttributeMap">put</a><a title="org.http4s.AttributeMap" id="org.http4s.StaticFile.fromFile(ef2071f5da).r.x$10" class="delimiter">(</a><a href="#org.http4s.StaticFile.staticFileKey" title="=&gt; org.http4s.AttributeKey[java.io.File]">staticFileKey</a>, <a href="#org.http4s.StaticFile.fromFile(ef2071f5da).f" title="java.io.File">f</a><span class="delimiter">)</span>
    <span class="delimiter">)</span>

    <a href="#org.http4s.StaticFile.logger" title="org.log4s.Logger">logger</a>.trace<span title="Unit" class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Static file generated response: &quot;)">Static file generated response: $</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).r" title="org.http4s.Response">r</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
    <span title="(x: org.http4s.Response)Some[org.http4s.Response]">Some</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fromFile(ef2071f5da).r" title="org.http4s.Response">r</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private def <a title="(f: java.io.File, start: Long, end: Long, buffsize: Int)(implicit es: java.util.concurrent.ExecutorService)scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]" id="org.http4s.StaticFile.fileToBody">fileToBody</a><span class="delimiter">(</span><a title="java.io.File" id="org.http4s.StaticFile.fileToBody.f">f</a>: <span title="java.io.File">File</span>, <a title="Long" id="org.http4s.StaticFile.fileToBody.start">start</a>: <span title="Long">Long</span>, <a title="Long" id="org.http4s.StaticFile.fileToBody.end">end</a>: <span title="Long">Long</span>, <a title="Int" id="org.http4s.StaticFile.fileToBody.buffsize">buffsize</a>: <span title="Int">Int</span><span class="delimiter">)</span>
                <span class="delimiter">(</span>implicit <a title="java.util.concurrent.ExecutorService" id="org.http4s.StaticFile.fileToBody.es">es</a>: <span title="java.util.concurrent.ExecutorService">ExecutorService</span><span class="delimiter">)</span>: <span title="scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">Process</span><span class="delimiter">[</span>Task, ByteVector<span class="delimiter">]</span> = <span class="delimiter">{</span>

    val <a title="scalaz.concurrent.Task[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]" id="org.http4s.StaticFile.fileToBody.outer">outer</a> = <span title="(a: =&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])(implicit pool: java.util.concurrent.ExecutorService)scalaz.concurrent.Task[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]">Task</span> <a href="#org.http4s.StaticFile.fileToBody.es" title="java.util.concurrent.ExecutorService" class="delimiter">{</a>

      val <a title="java.nio.channels.AsynchronousFileChannel" id="org.http4s.StaticFile.fileToBody.outer.ch">ch</a> = <span title="java.nio.channels.AsynchronousFileChannel.type">AsynchronousFileChannel</span>.<span title="(x$1: java.nio.file.Path, x$2: java.util.Set[_ &lt;: java.nio.file.OpenOption], x$3: java.util.concurrent.ExecutorService, x$4: java.nio.file.attribute.FileAttribute[_]*)java.nio.channels.AsynchronousFileChannel">open</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.f" title="java.io.File">f</a>.<span title="()java.nio.file.Path">toPath</span>, <span title="java.util.Collections.type">Collections</span>.<span title="()java.util.Set[Nothing]">emptySet</span><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#org.http4s.StaticFile.fileToBody.es" title="java.util.concurrent.ExecutorService">es</a><span class="delimiter">)</span>

      val <a title="java.nio.ByteBuffer" id="org.http4s.StaticFile.fileToBody.outer.buff">buff</a> = <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Int)java.nio.ByteBuffer">allocate</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.buffsize" title="Int">buffsize</a><span class="delimiter">)</span>
      var <a title="Long" id="org.http4s.StaticFile.fileToBody.outer.position">position</a> = <a href="#org.http4s.StaticFile.fileToBody.start" title="Long">start</a>

      val <a title="scalaz.concurrent.Task[scodec.bits.ByteVector]" id="org.http4s.StaticFile.fileToBody.outer.innerTask">innerTask</a> = <span title="scalaz.concurrent.Task.type">Task</span>.<span title="[A](register: (scalaz.\/[Throwable,A] =&gt; Unit) =&gt; Unit)scalaz.concurrent.Task[A]">async</span><span title="(register: (scalaz.\/[Throwable,scodec.bits.ByteVector] =&gt; Unit) =&gt; Unit)scalaz.concurrent.Task[scodec.bits.ByteVector]" class="delimiter">[</span><span title="scodec.bits.ByteVector">ByteVector</span><span class="delimiter">]</span><span class="delimiter">{</span> <a title="scalaz.\/[Throwable,scodec.bits.ByteVector] =&gt; Unit" id="org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun.cb">cb</a> =&gt;
        <span class="comment">// Check for ending condition</span>
        if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#org.http4s.StaticFile.fileToBody.outer.ch" title="java.nio.channels.AsynchronousFileChannel">ch</a>.<span title="()Boolean">isOpen</span><span class="delimiter">)</span> <a href="#org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun.cb" title="(v1: scalaz.\/[Throwable,scodec.bits.ByteVector])Unit">cb</a><span class="delimiter">(</span><span title="(a: scalaz.stream.Cause.Terminated)scalaz.-\/[scalaz.stream.Cause.Terminated]">-\/</span><span class="delimiter">(</span><span title="(cause: scalaz.stream.Cause)scalaz.stream.Cause.Terminated">Terminated</span><span class="delimiter">(</span><span title="scalaz.stream.Cause.End.type">End</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

        else <span class="delimiter">{</span>
          val remaining = <a href="#org.http4s.StaticFile.fileToBody.end" title="Long">end</a> <a title="Long" id="org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun.remaining">-</a> <a href="#org.http4s.StaticFile.fileToBody.outer.position" title="Long">position</a>
          if <span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.buff" title="java.nio.ByteBuffer">buff</a>.<span title="()Int">capacity</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Long)Boolean">&gt;</span> <a href="#org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun.remaining" title="Long">remaining</a><span class="delimiter">)</span> <a href="#org.http4s.StaticFile.fileToBody.outer.buff" title="java.nio.ByteBuffer">buff</a>.<span title="(x$1: Int)java.nio.Buffer">limit</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun.remaining" title="Long">remaining</a>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span>

          <a href="#org.http4s.StaticFile.fileToBody.outer.ch" title="java.nio.channels.AsynchronousFileChannel">ch</a>.<span title="(x$1: java.nio.ByteBuffer, x$2: Long, x$3: Null, x$4: java.nio.channels.CompletionHandler[Integer, _ &gt;: Null])Unit">read</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.buff" title="java.nio.ByteBuffer">buff</a>, <a href="#org.http4s.StaticFile.fileToBody.outer.position" title="Long">position</a>, null: <span title="Null">Null</span>, new <a title="&lt;$anon: java.nio.channels.CompletionHandler[Integer,Null]&gt; extends Object with java.nio.channels.CompletionHandler[Integer,Null]" id="org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun;$anon">CompletionHandler</a><span class="delimiter">[</span>Integer, Null<span class="delimiter">]</span> <span class="delimiter">{</span>
            def <a title="(t: Throwable, attachment: Null)Unit" id="org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun;$anon.failed">failed</a><span class="delimiter">(</span><a title="Throwable" id="org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun;$anon.failed.t">t</a>: <span title="Throwable">Throwable</span>, <a title="Null" id="org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun;$anon.failed.attachment">attachment</a>: <span title="Null">Null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#org.http4s.StaticFile.logger" title="org.log4s.Logger">logger</a>.error<span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun;$anon.failed.t" title="Throwable">t</a><span class="delimiter">)</span><span title="(x$1: String, x$2: Throwable)Unit" class="delimiter">(</span><span title="String(&quot;Static file NIO process failed&quot;)" class="string">&quot;Static file NIO process failed&quot;</span><span class="delimiter">)</span>
              <a href="#org.http4s.StaticFile.fileToBody.outer.ch" title="java.nio.channels.AsynchronousFileChannel">ch</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
              <a href="#org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun.cb" title="(v1: scalaz.\/[Throwable,scodec.bits.ByteVector])Unit">cb</a><span class="delimiter">(</span><span title="(a: Throwable)scalaz.-\/[Throwable]">-\/</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun;$anon.failed.t" title="Throwable">t</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>

            def <a title="(count: Integer, attachment: Null)Unit" id="org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun;$anon.completed">completed</a><span class="delimiter">(</span><a title="Integer" id="org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun;$anon.completed.count">count</a>: <span title="Integer">Integer</span>, <a title="Null" id="org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun;$anon.completed.attachment">attachment</a>: <span title="Null">Null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#org.http4s.StaticFile.logger" title="org.log4s.Logger">logger</a>.trace<span title="Unit" class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Read &quot;)">Read $</span><a href="#org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun;$anon.completed.count" title="Integer">count</a><span title="String(&quot; bytes&quot;)" class="string"> bytes&quot;</span><span class="delimiter">)</span>
              <a href="#org.http4s.StaticFile.fileToBody.outer.buff" title="java.nio.ByteBuffer">buff</a>.<span title="()java.nio.Buffer">flip</span><span class="delimiter">(</span><span class="delimiter">)</span>

              <span class="comment">// Don't make yet another copy unless we need to</span>
              val <a title="scodec.bits.ByteVector" id="org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun;$anon.completed.c">c</a> = if <span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.buffsize" title="Int">buffsize</a> <span title="(x$1: Any)Boolean">==</span> <a href="#org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun;$anon.completed.count" title="Integer">count</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span title="(bytes: Array[Byte])scodec.bits.ByteVector">ByteVector</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.buff" title="java.nio.ByteBuffer">buff</a>.<span title="()Array[Byte]">array</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span> else <span title="(buffer: java.nio.ByteBuffer)scodec.bits.ByteVector">ByteVector</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.buff" title="java.nio.ByteBuffer">buff</a><span class="delimiter">)</span>

              <a href="#org.http4s.StaticFile.fileToBody.outer.buff" title="java.nio.ByteBuffer">buff</a>.<span title="()java.nio.Buffer">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
              <a href="#org.http4s.StaticFile.fileToBody.outer.position" title="Long">position</a> <span title="(x: Int)Long">+=</span> <a href="#org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun;$anon.completed.count" title="implicit scala.Predef.Integer2int : (x: Integer)Int">count</a>
              if <span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.position" title="Long">position</a> <span title="(x: Long)Boolean">&gt;=</span> <a href="#org.http4s.StaticFile.fileToBody.end" title="Long">end</a><span class="delimiter">)</span> <a href="#org.http4s.StaticFile.fileToBody.outer.ch" title="java.nio.channels.AsynchronousFileChannel">ch</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>

              <a href="#org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun.cb" title="(v1: scalaz.\/[Throwable,scodec.bits.ByteVector])Unit">cb</a><span class="delimiter">(</span><span title="(b: scodec.bits.ByteVector)scalaz.\/-[scodec.bits.ByteVector]">\/-</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.innerTask.$anonfun;$anon.completed.c" title="scodec.bits.ByteVector">c</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      val <a title="scalaz.stream.Process[scalaz.concurrent.Task,Nothing]" id="org.http4s.StaticFile.fileToBody.outer.cleanup">cleanup</a>: <span title="scalaz.stream.Process[scalaz.concurrent.Task,Nothing]">Process</span><span class="delimiter">[</span>Task, Nothing<span class="delimiter">]</span> = <span title="(f: scalaz.concurrent.Task[Unit])scalaz.stream.Process[scalaz.concurrent.Task,Nothing]">eval_</span><span class="delimiter">(</span><span title="[A](a: =&gt; A)(implicit pool: java.util.concurrent.ExecutorService)scalaz.concurrent.Task[A]">Task</span><span title="(a: =&gt; Unit)(implicit pool: java.util.concurrent.ExecutorService)scalaz.concurrent.Task[Unit]" class="delimiter">[</span><span title="Unit">Unit</span><span class="delimiter">]</span><a href="#org.http4s.StaticFile.fileToBody.es" title="java.util.concurrent.ExecutorService" class="delimiter">{</a>
        <a href="#org.http4s.StaticFile.logger" title="org.log4s.Logger">logger</a>.trace<span title="Unit" class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Cleaning up file: ensuring &quot;)">Cleaning up file: ensuring $</span><span class="delimiter">{</span><a href="#org.http4s.StaticFile.fileToBody.f" title="java.io.File">f</a>.<span title="()java.net.URI">toURI</span><span class="delimiter">}</span><span title="String(&quot; is closed&quot;)" class="string"> is closed&quot;</span><span class="delimiter">)</span>
        if <span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.ch" title="java.nio.channels.AsynchronousFileChannel">ch</a>.<span title="()Boolean">isOpen</span><span class="delimiter">)</span> <a href="#org.http4s.StaticFile.fileToBody.outer.ch" title="java.nio.channels.AsynchronousFileChannel">ch</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      def <a title="(c: scodec.bits.ByteVector)scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]" id="org.http4s.StaticFile.fileToBody.outer.go">go</a><span class="delimiter">(</span><a title="scodec.bits.ByteVector" id="org.http4s.StaticFile.fileToBody.outer.go.c">c</a>: <span title="scodec.bits.ByteVector">ByteVector</span><span class="delimiter">)</span>: <span title="scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">Process</span><span class="delimiter">[</span>Task, ByteVector<span class="delimiter">]</span> = <span class="delimiter">{</span>
        <span title="(o: scodec.bits.ByteVector)scalaz.stream.Process0[scodec.bits.ByteVector]">emit</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.go.c" title="scodec.bits.ByteVector">c</a><span class="delimiter">)</span> <span title="(p2: =&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">++</span> <span title="(req: scalaz.concurrent.Task[scodec.bits.ByteVector])(fb: scalaz.stream.Cause.EarlyCause =&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])(rcv: scodec.bits.ByteVector =&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">awaitOr</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.innerTask" title="scalaz.concurrent.Task[scodec.bits.ByteVector]">innerTask</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="scalaz.stream.Cause.EarlyCause" id="org.http4s.StaticFile.fileToBody.outer.go.$anonfun.x$7">_</a> =&gt; <a href="#org.http4s.StaticFile.fileToBody.outer.cleanup" title="scalaz.stream.Process[scalaz.concurrent.Task,Nothing]">cleanup</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.go" title="(c: scodec.bits.ByteVector)scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">go</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span title="(req: scalaz.concurrent.Task[scodec.bits.ByteVector])(rcv: scodec.bits.ByteVector =&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">await</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.innerTask" title="scalaz.concurrent.Task[scodec.bits.ByteVector]">innerTask</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer.go" title="(c: scodec.bits.ByteVector)scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">go</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span title="(req: scalaz.concurrent.Task[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]])(rcv: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector] =&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">await</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.outer" title="scalaz.concurrent.Task[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]">outer</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#org.http4s.StaticFile.fileToBody.$anonfun.x" title="(x: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">identity</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  private<span class="delimiter">[</span>http4s<span class="delimiter">]</span> val <a title="org.http4s.AttributeKey[java.io.File]" id="org.http4s.StaticFile.staticFileKey">staticFileKey</a> = <a href="AttributeMap.scala.html#org.http4s.AttributeKey" title="org.http4s.AttributeKey.type">AttributeKey</a>.<a href="AttributeMap.scala.html#org.http4s.AttributeKey.http4s" title="[T](name: String)org.http4s.AttributeKey[T]">http4s</a><span title="(name: String)org.http4s.AttributeKey[java.io.File]" class="delimiter">[</span><span title="java.io.File">File</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="String(&quot;staticFile&quot;)" class="string">&quot;staticFile&quot;</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
