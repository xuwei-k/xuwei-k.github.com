<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>http4s-blazeclient/org/http4s/client/blaze/Http1ClientReceiver.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
package org.http4s.client.blaze

import java.nio.ByteBuffer

import org.http4s._
import org.http4s.blaze.http.http_parser.Http1ClientParser
import org.http4s.blaze.pipeline.Command

import scala.collection.mutable.ListBuffer
import scala.util.<span class="delimiter">{</span>Failure, Success<span class="delimiter">}</span>
import scalaz.concurrent.Task
import scalaz.stream.Process
import scalaz.<span class="delimiter">{</span>-\/, \/-<span class="delimiter">}</span>

abstract class <a title="class Http1ClientReceiver extends org.http4s.blaze.http.http_parser.Http1ClientParser with org.http4s.client.blaze.BlazeClientStage" id="org.http4s.client.blaze;Http1ClientReceiver">Http1ClientReceiver</a> extends <a href="#org.http4s.client.blaze;Http1ClientReceiver" title="org.http4s.blaze.http.http_parser.Http1ClientParser">Http1ClientParser</a> with <a href="BlazeClientStage.scala.html#org.http4s.client.blaze;BlazeClientStage" title="org.http4s.client.blaze.BlazeClientStage">BlazeClientStage</a> <span class="delimiter">{</span> self: Http1ClientStage =&gt;
  private val <a title="scala.collection.mutable.ListBuffer[org.http4s.Header]" id="org.http4s.client.blaze;Http1ClientReceiver._headers">_headers</a> = new <span title="scala.collection.mutable.ListBuffer[org.http4s.Header]">ListBuffer</span><span class="delimiter">[</span>Header<span class="delimiter">]</span>
  private var <a title="org.http4s.Status" id="org.http4s.client.blaze;Http1ClientReceiver._status_=">_status</a>: <a href="../../../../../http4s-core/org/http4s/Status.scala.html#org.http4s;Status" title="org.http4s.Status">Status</a> = _
  private var <a title="org.http4s.HttpVersion" id="org.http4s.client.blaze;Http1ClientReceiver._httpVersion_=">_httpVersion</a>: <a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s;HttpVersion" title="org.http4s.HttpVersion">HttpVersion</a> = _
  @volatile private var <a title="Boolean" id="org.http4s.client.blaze;Http1ClientReceiver.closed_=">closed</a> = false

  final override def <a title="()Boolean" id="org.http4s.client.blaze;Http1ClientReceiver.isClosed">isClosed</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#org.http4s.client.blaze;Http1ClientReceiver.closed_=" title="=&gt; Boolean">closed</a>

  final override def <a title="()Unit" id="org.http4s.client.blaze;Http1ClientReceiver.shutdown">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#org.http4s.client.blaze;Http1ClientReceiver.stageShutdown" title="()Unit">stageShutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">// seal this off, use shutdown()</span>
  final override def <a title="()Unit" id="org.http4s.client.blaze;Http1ClientReceiver.stageShutdown">stageShutdown</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#org.http4s.client.blaze;Http1ClientReceiver.closed_=" title="(x$1: Boolean)Unit">closed</a> = true
    <a href="#org.http4s.client.blaze;Http1ClientReceiver" title="(cmd: org.http4s.blaze.pipeline.Command.OutboundCommand)Unit">sendOutboundCommand</a><span class="delimiter">(</span><span title="org.http4s.blaze.pipeline.Command.type">Command</span>.<span title="org.http4s.blaze.pipeline.Command.Disconnect.type">Disconnect</span><span class="delimiter">)</span>
    <a href="#org.http4s.client.blaze;Http1ClientReceiver" title="()Unit">shutdownParser</a><span class="delimiter">(</span><span class="delimiter">)</span>
    super.<span title="()Unit">stageShutdown</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  override def <a title="()Unit" id="org.http4s.client.blaze;Http1ClientReceiver.reset">reset</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#org.http4s.client.blaze;Http1ClientReceiver._headers" title="=&gt; scala.collection.mutable.ListBuffer[org.http4s.Header]">_headers</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#org.http4s.client.blaze;Http1ClientReceiver._status_=" title="(x$1: org.http4s.Status)Unit">_status</a> = null
    <a href="#org.http4s.client.blaze;Http1ClientReceiver._httpVersion_=" title="(x$1: org.http4s.HttpVersion)Unit">_httpVersion</a> = null
    super.<span title="()Unit">reset</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  final override protected def <a title="(code: Int, reason: String, scheme: String, majorversion: Int, minorversion: Int)Unit" id="org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine">submitResponseLine</a><span class="delimiter">(</span><a title="Int" id="org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.code">code</a>: <span title="Int">Int</span>, <a title="String" id="org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.reason">reason</a>: <span title="String">String</span>,
                                            <a title="String" id="org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.scheme">scheme</a>: <span title="String">String</span>,
                                            <a title="Int" id="org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.majorversion">majorversion</a>: <span title="Int">Int</span>, <a title="Int" id="org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.minorversion">minorversion</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#org.http4s.client.blaze;Http1ClientReceiver._status_=" title="(x$1: org.http4s.Status)Unit">_status</a> = <a href="../../../../../http4s-core/org/http4s/Status.scala.html#org.http4s.Status" title="org.http4s.Status.type">Status</a>.<a href="../../../../../http4s-core/org/http4s/Status.scala.html#org.http4s.Status.fromIntAndReason" title="(code: Int, reason: String)org.http4s.ParseResult[org.http4s.Status]">fromIntAndReason</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.code" title="Int">code</a>, <a href="#org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.reason" title="String">reason</a><span class="delimiter">)</span>.<span title="(x: org.http4s.ParseFailure =&gt; org.http4s.Status)org.http4s.Status">valueOr</span><span class="delimiter">(</span><a title="org.http4s.ParseFailure" id="org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.$anonfun.e">e</a> =&gt; throw new <a href="../../../../../http4s-core/org/http4s/ParseFailure.scala.html#org.http4s;ParseException" title="org.http4s.ParseException">ParseException</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.$anonfun.e" title="org.http4s.ParseFailure">e</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#org.http4s.client.blaze;Http1ClientReceiver._httpVersion_=" title="(x$1: org.http4s.HttpVersion)Unit">_httpVersion</a> = <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.majorversion" title="Int">majorversion</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.minorversion" title="Int">minorversion</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>  <a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s.HttpVersion" title="org.http4s.HttpVersion.type">HttpVersion</a>.<a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s.HttpVersion.HTTP/1.1" title="=&gt; org.http4s.HttpVersion">`HTTP/1.1`</a>
      else if <span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.majorversion" title="Int">majorversion</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.minorversion" title="Int">minorversion</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>  <a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s.HttpVersion" title="org.http4s.HttpVersion.type">HttpVersion</a>.<a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s.HttpVersion.HTTP/1.0" title="=&gt; org.http4s.HttpVersion">`HTTP/1.0`</a>
      else <a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s.HttpVersion" title="org.http4s.HttpVersion.type">HttpVersion</a>.<a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s.HttpVersion.fromVersion" title="(major: Int, minor: Int)org.http4s.ParseResult[org.http4s.HttpVersion]">fromVersion</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.majorversion" title="Int">majorversion</a>, <a href="#org.http4s.client.blaze;Http1ClientReceiver.submitResponseLine.minorversion" title="Int">minorversion</a><span class="delimiter">)</span>.<span title="(x: =&gt; org.http4s.HttpVersion)org.http4s.HttpVersion">getOrElse</span><span class="delimiter">(</span><a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s.HttpVersion" title="org.http4s.HttpVersion.type">HttpVersion</a>.<a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s.HttpVersion.HTTP/1.0" title="=&gt; org.http4s.HttpVersion">`HTTP/1.0`</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  final protected def <a title="(body: org.http4s.EntityBody)org.http4s.Response" id="org.http4s.client.blaze;Http1ClientReceiver.collectMessage">collectMessage</a><span class="delimiter">(</span><a title="org.http4s.EntityBody" id="org.http4s.client.blaze;Http1ClientReceiver.collectMessage.body">body</a>: <span title="org.http4s.EntityBody">EntityBody</span><span class="delimiter">)</span>: <a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Response" title="org.http4s.Response">Response</a> = <span class="delimiter">{</span>
    val <a title="org.http4s.Status" id="org.http4s.client.blaze;Http1ClientReceiver.collectMessage.status">status</a>   = if <span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver._status_=" title="=&gt; org.http4s.Status">_status</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span> <a href="../../../../../http4s-core/org/http4s/Status.scala.html#org.http4s.Status" title="org.http4s.Status.type">Status</a>.<a href="../../../../../http4s-core/org/http4s/Status.scala.html#org.http4s.Status.InternalServerError" title="=&gt; org.http4s.Status">InternalServerError</a> else <a href="#org.http4s.client.blaze;Http1ClientReceiver._status_=" title="=&gt; org.http4s.Status">_status</a>
    val <a title="org.http4s.Headers" id="org.http4s.client.blaze;Http1ClientReceiver.collectMessage.headers">headers</a>  = if <span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver._headers" title="=&gt; scala.collection.mutable.ListBuffer[org.http4s.Header]">_headers</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="../../../../../http4s-core/org/http4s/Headers.scala.html#org.http4s.Headers" title="org.http4s.Headers.type">Headers</a>.<a href="../../../../../http4s-core/org/http4s/Headers.scala.html#org.http4s.Headers.empty" title="=&gt; org.http4s.Headers">empty</a> else <a href="../../../../../http4s-core/org/http4s/Headers.scala.html#org.http4s.Headers.apply(d220169851)" title="(headers: List[org.http4s.Header])org.http4s.Headers">Headers</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver._headers" title="=&gt; scala.collection.mutable.ListBuffer[org.http4s.Header]">_headers</a>.<span title="()List[org.http4s.Header]">result</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    val <a title="org.http4s.HttpVersion" id="org.http4s.client.blaze;Http1ClientReceiver.collectMessage.httpVersion">httpVersion</a> = if <span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver._httpVersion_=" title="=&gt; org.http4s.HttpVersion">_httpVersion</a> <span title="(x$1: Any)Boolean">==</span> null<span class="delimiter">)</span> <a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s.HttpVersion" title="org.http4s.HttpVersion.type">HttpVersion</a>.<a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s.HttpVersion.HTTP/1.0" title="=&gt; org.http4s.HttpVersion">`HTTP/1.0`</a> else <a href="#org.http4s.client.blaze;Http1ClientReceiver._httpVersion_=" title="=&gt; org.http4s.HttpVersion">_httpVersion</a> <span class="comment">// TODO Questionable default</span>
    <a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Response" title="(status: org.http4s.Status, httpVersion: org.http4s.HttpVersion, headers: org.http4s.Headers, body: org.http4s.EntityBody, attributes: org.http4s.AttributeMap)org.http4s.Response">Response</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.collectMessage.status" title="org.http4s.Status">status</a>, <a href="#org.http4s.client.blaze;Http1ClientReceiver.collectMessage.httpVersion" title="org.http4s.HttpVersion">httpVersion</a>, <a href="#org.http4s.client.blaze;Http1ClientReceiver.collectMessage.headers" title="org.http4s.Headers">headers</a>, <a href="#org.http4s.client.blaze;Http1ClientReceiver.collectMessage.body" title="org.http4s.EntityBody">body</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  final override protected def <a title="(name: String, value: String)Boolean" id="org.http4s.client.blaze;Http1ClientReceiver.headerComplete">headerComplete</a><span class="delimiter">(</span><a title="String" id="org.http4s.client.blaze;Http1ClientReceiver.headerComplete.name">name</a>: <span title="String">String</span>, <a title="String" id="org.http4s.client.blaze;Http1ClientReceiver.headerComplete.value">value</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <a href="#org.http4s.client.blaze;Http1ClientReceiver._headers" title="=&gt; scala.collection.mutable.ListBuffer[org.http4s.Header]">_headers</a> <span title="(x: org.http4s.Header)Http1ClientReceiver.this._headers.type">+=</span> <a href="../../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header.apply" title="(name: String, value: String)org.http4s.Header.Raw">Header</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.headerComplete.name" title="String">name</a>, <a href="#org.http4s.client.blaze;Http1ClientReceiver.headerComplete.value" title="String">value</a><span class="delimiter">)</span>
    false
  <span class="delimiter">}</span>

  final protected def <a title="(cb: Http1ClientReceiver.this.Callback, close: Boolean)Unit" id="org.http4s.client.blaze;Http1ClientReceiver.receiveResponse">receiveResponse</a><span class="delimiter">(</span><a title="Http1ClientReceiver.this.Callback" id="org.http4s.client.blaze;Http1ClientReceiver.receiveResponse.cb">cb</a>: <span title="Http1ClientReceiver.this.Callback">Callback</span>, <a title="Boolean" id="org.http4s.client.blaze;Http1ClientReceiver.receiveResponse.close">close</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#org.http4s.client.blaze;Http1ClientReceiver.readAndParse" title="(cb: Http1ClientReceiver.this.Callback, closeOnFinish: Boolean, phase: String)Unit">readAndParse</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.receiveResponse.cb" title="Http1ClientReceiver.this.Callback">cb</a>, <a href="#org.http4s.client.blaze;Http1ClientReceiver.receiveResponse.close" title="Boolean">close</a>, <span title="String(&quot;Initial Read&quot;)" class="string">&quot;Initial Read&quot;</span><span class="delimiter">)</span>

  <span class="comment">// this method will get some data, and try to continue parsing using the implicit ec</span>
  private def <a title="(cb: Http1ClientReceiver.this.Callback, closeOnFinish: Boolean, phase: String)Unit" id="org.http4s.client.blaze;Http1ClientReceiver.readAndParse">readAndParse</a><span class="delimiter">(</span><a title="Http1ClientReceiver.this.Callback" id="org.http4s.client.blaze;Http1ClientReceiver.readAndParse.cb">cb</a>: <span title="Http1ClientReceiver.this.Callback">Callback</span>,  <a title="Boolean" id="org.http4s.client.blaze;Http1ClientReceiver.readAndParse.closeOnFinish">closeOnFinish</a>: <span title="Boolean">Boolean</span>, <a title="String" id="org.http4s.client.blaze;Http1ClientReceiver.readAndParse.phase">phase</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#org.http4s.client.blaze;Http1ClientReceiver" title="(size: Int, timeout: scala.concurrent.duration.Duration)scala.concurrent.Future[java.nio.ByteBuffer]">channelRead</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(f: scala.util.Try[java.nio.ByteBuffer] =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)Unit">onComplete</span> <a href="#org.http4s.client.blaze;Http1ClientReceiver.readAndParse.$anonfun.x0$1" title="Unit" class="delimiter">{</a>
      case Success<span class="delimiter">(</span><a title="java.nio.ByteBuffer" id="org.http4s.client.blaze;Http1ClientReceiver.readAndParse.$anonfun.buff">buff</a><span class="delimiter">)</span> =&gt; <a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop" title="(buffer: java.nio.ByteBuffer, closeOnFinish: Boolean, cb: Http1ClientReceiver.this.Callback)Unit">requestLoop</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.readAndParse.$anonfun.buff" title="java.nio.ByteBuffer">buff</a>, <a href="#org.http4s.client.blaze;Http1ClientReceiver.readAndParse.closeOnFinish" title="Boolean">closeOnFinish</a>, <a href="#org.http4s.client.blaze;Http1ClientReceiver.readAndParse.cb" title="Http1ClientReceiver.this.Callback">cb</a><span class="delimiter">)</span>
      case Failure<span class="delimiter">(</span><a title="Throwable" id="org.http4s.client.blaze;Http1ClientReceiver.readAndParse.$anonfun.t">t</a><span class="delimiter">)</span>    =&gt;
        <a href="../../../../../http4s-blazecore/org/http4s/blaze/Http1Stage.scala.html#org.http4s.blaze;Http1Stage.fatalError" title="(t: Throwable, msg: String)Unit">fatalError</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.readAndParse.$anonfun.t" title="Throwable">t</a>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Error during phase: &quot;)">Error during phase: $</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.readAndParse.phase" title="String">phase</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
        <a href="#org.http4s.client.blaze;Http1ClientReceiver.readAndParse.cb" title="(v1: scalaz.\/[Throwable,org.http4s.Response])Unit">cb</a><span class="delimiter">(</span><span title="(a: Throwable)scalaz.-\/[Throwable]">-\/</span><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.readAndParse.$anonfun.t" title="Throwable">t</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(buffer: java.nio.ByteBuffer, closeOnFinish: Boolean, cb: Http1ClientReceiver.this.Callback)Unit" id="org.http4s.client.blaze;Http1ClientReceiver.requestLoop">requestLoop</a><span class="delimiter">(</span><a title="java.nio.ByteBuffer" id="org.http4s.client.blaze;Http1ClientReceiver.requestLoop.buffer">buffer</a>: <span title="java.nio.ByteBuffer">ByteBuffer</span>, <a title="Boolean" id="org.http4s.client.blaze;Http1ClientReceiver.requestLoop.closeOnFinish">closeOnFinish</a>: <span title="Boolean">Boolean</span>, <a title="Http1ClientReceiver.this.Callback" id="org.http4s.client.blaze;Http1ClientReceiver.requestLoop.cb">cb</a>: <span title="Http1ClientReceiver.this.Callback">Callback</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = try <span class="delimiter">{</span>
    if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#org.http4s.client.blaze;Http1ClientReceiver" title="()Boolean">responseLineComplete</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#org.http4s.client.blaze;Http1ClientReceiver" title="(x$1: java.nio.ByteBuffer)Boolean">parseResponseLine</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#org.http4s.client.blaze;Http1ClientReceiver.readAndParse" title="(cb: Http1ClientReceiver.this.Callback, closeOnFinish: Boolean, phase: String)Unit">readAndParse</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.cb" title="Http1ClientReceiver.this.Callback">cb</a>, <a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.closeOnFinish" title="Boolean">closeOnFinish</a>, <span title="String(&quot;Response Line Parsing&quot;)" class="string">&quot;Response Line Parsing&quot;</span><span class="delimiter">)</span>
      return
    <span class="delimiter">}</span>

    if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#org.http4s.client.blaze;Http1ClientReceiver" title="()Boolean">headersComplete</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#org.http4s.client.blaze;Http1ClientReceiver" title="(x$1: java.nio.ByteBuffer)Boolean">parseHeaders</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#org.http4s.client.blaze;Http1ClientReceiver.readAndParse" title="(cb: Http1ClientReceiver.this.Callback, closeOnFinish: Boolean, phase: String)Unit">readAndParse</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.cb" title="Http1ClientReceiver.this.Callback">cb</a>, <a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.closeOnFinish" title="Boolean">closeOnFinish</a>, <span title="String(&quot;Header Parsing&quot;)" class="string">&quot;Header Parsing&quot;</span><span class="delimiter">)</span>
      return
    <span class="delimiter">}</span>

    <span class="comment">// We are to the point of parsing the body and then cleaning up</span>
    val <a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.rawBody" title="(org.http4s.EntityBody, () =&gt; scala.concurrent.Future[java.nio.ByteBuffer])" class="delimiter">(</a><a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.x$1" title="org.http4s.EntityBody" id="org.http4s.client.blaze;Http1ClientReceiver.requestLoop.rawBody">rawBody</a>, <a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.x$1" title="() =&gt; scala.concurrent.Future[java.nio.ByteBuffer]" id="org.http4s.client.blaze;Http1ClientReceiver.requestLoop.cleanup">cleanup</a><span class="delimiter">)</span> = <a href="../../../../../http4s-blazecore/org/http4s/blaze/Http1Stage.scala.html#org.http4s.blaze;Http1Stage.collectBodyFromParser" title="(buffer: java.nio.ByteBuffer)(org.http4s.EntityBody, () =&gt; scala.concurrent.Future[java.nio.ByteBuffer])">collectBodyFromParser</a><span title="(org.http4s.EntityBody, () =&gt; scala.concurrent.Future[java.nio.ByteBuffer]) @unchecked" class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>

    val body = <a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.rawBody" title="org.http4s.EntityBody">rawBody</a> <a title="scalaz.stream.Process[[x]scalaz.concurrent.Task[x],scodec.bits.ByteVector]" id="org.http4s.client.blaze;Http1ClientReceiver.requestLoop.body">++</a> <span title="scalaz.stream.Process.type">Process</span>.<span title="(f: scalaz.concurrent.Task[Unit])scalaz.stream.Process[scalaz.concurrent.Task,Nothing]">eval_</span><span class="delimiter">(</span><span title="scalaz.concurrent.Task.type">Task</span>.<span title="[A](register: (scalaz.\/[Throwable,A] =&gt; Unit) =&gt; Unit)scalaz.concurrent.Task[A]">async</span><span title="(register: (scalaz.\/[Throwable,Unit] =&gt; Unit) =&gt; Unit)scalaz.concurrent.Task[Unit]" class="delimiter">[</span><span title="Unit">Unit</span><span class="delimiter">]</span> <span class="delimiter">{</span> <a title="scalaz.\/[Throwable,Unit] =&gt; Unit" id="org.http4s.client.blaze;Http1ClientReceiver.requestLoop.body.$anonfun.cb">cb</a> =&gt;
      if <span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.closeOnFinish" title="Boolean">closeOnFinish</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#org.http4s.client.blaze;Http1ClientReceiver.stageShutdown" title="()Unit">stageShutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.body.$anonfun.cb" title="(v1: scalaz.\/[Throwable,Unit])Unit">cb</a><span class="delimiter">(</span><span title="(b: Unit)scalaz.\/-[Unit]">\/-</span><span class="delimiter">(</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      else <a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.cleanup" title="()scala.concurrent.Future[java.nio.ByteBuffer]">cleanup</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(f: scala.util.Try[java.nio.ByteBuffer] =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)Unit">onComplete</span> <a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.body.$anonfun.$anonfun.x0$2" title="Unit" class="delimiter">{</a>
        case Success<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="Http1ClientStage.scala.html#org.http4s.client.blaze;Http1ClientStage.reset" title="()Unit">reset</a><span class="delimiter">(</span><span class="delimiter">)</span>; <a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.body.$anonfun.cb" title="(v1: scalaz.\/[Throwable,Unit])Unit">cb</a><span class="delimiter">(</span><span title="(b: Unit)scalaz.\/-[Unit]">\/-</span><span class="delimiter">(</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>     <span class="comment">// we shouldn't have any leftover buffer</span>
        case Failure<span class="delimiter">(</span><a title="Throwable" id="org.http4s.client.blaze;Http1ClientReceiver.requestLoop.body.$anonfun.$anonfun.t">t</a><span class="delimiter">)</span> =&gt; <a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.body.$anonfun.cb" title="(v1: scalaz.\/[Throwable,Unit])Unit">cb</a><span class="delimiter">(</span><span title="(a: Throwable)scalaz.-\/[Throwable]">-\/</span><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.body.$anonfun.$anonfun.t" title="Throwable">t</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <span class="comment">// TODO: we need to detect if the other side has signaled the connection will close.</span>
    <a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.cb" title="(v1: scalaz.\/[Throwable,org.http4s.Response])Unit">cb</a><span class="delimiter">(</span><span title="(b: org.http4s.Response)scalaz.\/-[org.http4s.Response]">\/-</span><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.collectMessage" title="(body: org.http4s.EntityBody)org.http4s.Response">collectMessage</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.body" title="scalaz.stream.Process[[x]scalaz.concurrent.Task[x],scodec.bits.ByteVector]">body</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span> catch <span class="delimiter">{</span>
    case <a title="Throwable" id="org.http4s.client.blaze;Http1ClientReceiver.requestLoop.t">t</a>: <span title="Throwable">Throwable</span> =&gt;
      <a href="#org.http4s.client.blaze;Http1ClientReceiver" title="=&gt; org.log4s.Logger">logger</a>.error<span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.t" title="Throwable">t</a><span class="delimiter">)</span><span title="(x$1: String, x$2: Throwable)Unit" class="delimiter">(</span><span title="String(&quot;Error during client request decode loop&quot;)" class="string">&quot;Error during client request decode loop&quot;</span><span class="delimiter">)</span>
      <a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.cb" title="(v1: scalaz.\/[Throwable,org.http4s.Response])Unit">cb</a><span class="delimiter">(</span><span title="(a: Throwable)scalaz.-\/[Throwable]">-\/</span><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientReceiver.requestLoop.t" title="Throwable">t</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
