<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>http4s-blazeclient/org/http4s/client/blaze/Http1ClientStage.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
package org.http4s.client.blaze

import java.nio.ByteBuffer
import java.util.concurrent.atomic.AtomicReference

import org.http4s.<a href="../../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header" title="org.http4s.Header.type">Header</a>.<span class="delimiter">{</span>Host, `Content-Length`<span class="delimiter">}</span>
import org.http4s.<a href="../../../../../http4s-core/org/http4s/Uri.scala.html#org.http4s.Uri" title="org.http4s.Uri.type">Uri</a>.<span class="delimiter">{</span>Authority, RegName<span class="delimiter">}</span>
import org.http4s.blaze.Http1Stage
import org.http4s.blaze.util.<span class="delimiter">{</span>Cancellable, ProcessWriter<span class="delimiter">}</span>
import org.http4s.util.<span class="delimiter">{</span>StringWriter, Writer<span class="delimiter">}</span>
import org.http4s.<span class="delimiter">{</span>Header, Request, Response, HttpVersion<span class="delimiter">}</span>

import scala.annotation.tailrec
import scala.concurrent.<span class="delimiter">{</span>TimeoutException, ExecutionContext<span class="delimiter">}</span>
import scala.concurrent.duration._
import scala.util.control.NoStackTrace

import scalaz.concurrent.Task
import scalaz.stream.<span title="scalaz.stream.Process.type">Process</span>.halt
import scalaz.<span class="delimiter">{</span>-\/, \/, \/-<span class="delimiter">}</span>

final class <a title="class Http1ClientStage extends org.http4s.client.blaze.Http1ClientReceiver with org.http4s.blaze.Http1Stage" id="org.http4s.client.blaze;Http1ClientStage">Http1ClientStage</a><a href="#org.http4s.client.blaze;Http1ClientStage" title="org.http4s.client.blaze.Http1ClientStage" class="delimiter">(</a><a title="scala.concurrent.duration.Duration" id="org.http4s.client.blaze;Http1ClientStage.timeout">timeout</a>: <span title="scala.concurrent.duration.Duration">Duration</span><span class="delimiter">)</span>
                      <span class="delimiter">(</span>implicit protected val <a title="scala.concurrent.ExecutionContext" id="org.http4s.client.blaze;Http1ClientStage.ec">ec</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span>
                      extends <a href="Http1ClientReceiver.scala.html#org.http4s.client.blaze;Http1ClientReceiver" title="org.http4s.client.blaze.Http1ClientReceiver">Http1ClientReceiver</a> with <a href="../../../../../http4s-blazecore/org/http4s/blaze/Http1Stage.scala.html#org.http4s.blaze;Http1Stage" title="org.http4s.blaze.Http1Stage">Http1Stage</a> <span class="delimiter">{</span>

  import <a href="#org.http4s.client.blaze.Http1ClientStage" title="org.http4s.client.blaze.Http1ClientStage.type">Http1ClientStage</a>._

  protected type <a title="scalaz.\/[Throwable,org.http4s.Response] =&gt; Unit" id="org.http4s.client.blaze;Http1ClientStage;Callback">Callback</a> = Throwable\/Response =&gt; Unit
  
  private val <a title="java.util.concurrent.atomic.AtomicReference[org.http4s.blaze.util.Cancellable]" id="org.http4s.client.blaze;Http1ClientStage._inProgress">_inProgress</a> = new <span title="java.util.concurrent.atomic.AtomicReference[org.http4s.blaze.util.Cancellable]">AtomicReference</span><span class="delimiter">[</span>Cancellable<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

  override def <a title="=&gt; String" id="org.http4s.client.blaze;Http1ClientStage.name">name</a>: <span title="String">String</span> = <a href="#org.http4s.client.blaze;Http1ClientStage" title="()Class[_]">getClass</a>.<span title="()String">getName</span>

  override def <a title="()Unit" id="org.http4s.client.blaze;Http1ClientStage.reset">reset</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    val <a title="org.http4s.blaze.util.Cancellable" id="org.http4s.client.blaze;Http1ClientStage.reset.c">c</a> = <a href="#org.http4s.client.blaze;Http1ClientStage._inProgress" title="=&gt; java.util.concurrent.atomic.AtomicReference[org.http4s.blaze.util.Cancellable]">_inProgress</a>.<span title="(x$1: org.http4s.blaze.util.Cancellable)org.http4s.blaze.util.Cancellable">getAndSet</span><span class="delimiter">(</span>null<span class="delimiter">)</span>
    <a href="#org.http4s.client.blaze;Http1ClientStage.reset.c" title="org.http4s.blaze.util.Cancellable">c</a>.<span title="()Unit">cancel</span><span class="delimiter">(</span><span class="delimiter">)</span>
    super.<a href="Http1ClientReceiver.scala.html#org.http4s.client.blaze;Http1ClientReceiver.reset" title="()Unit">reset</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  override protected def <a title="(buffer: java.nio.ByteBuffer)Option[java.nio.ByteBuffer]" id="org.http4s.client.blaze;Http1ClientStage.doParseContent">doParseContent</a><span class="delimiter">(</span><a title="java.nio.ByteBuffer" id="org.http4s.client.blaze;Http1ClientStage.doParseContent.buffer">buffer</a>: <span title="java.nio.ByteBuffer">ByteBuffer</span><span class="delimiter">)</span>: <span title="Option[java.nio.ByteBuffer]">Option</span><span class="delimiter">[</span>ByteBuffer<span class="delimiter">]</span> = <span title="(x: java.nio.ByteBuffer)Option[java.nio.ByteBuffer]">Option</span><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage" title="(x$1: java.nio.ByteBuffer)java.nio.ByteBuffer">parseContent</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.doParseContent.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/** Generate a `Task[Response]` that will perform an HTTP 1 request on execution */</span>
  def <a title="(req: org.http4s.Request)scalaz.concurrent.Task[org.http4s.Response]" id="org.http4s.client.blaze;Http1ClientStage.runRequest">runRequest</a><span class="delimiter">(</span><a title="org.http4s.Request" id="org.http4s.client.blaze;Http1ClientStage.runRequest.req">req</a>: <a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request" title="org.http4s.Request">Request</a><span class="delimiter">)</span>: <span title="scalaz.concurrent.Task[org.http4s.Response]">Task</span><span class="delimiter">[</span>Response<span class="delimiter">]</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.timeout" title="scala.concurrent.duration.Duration">timeout</a>.<span title="()Boolean">isFinite</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="comment">// We need to race two Tasks, one that will result in failure, one that gives the Response</span>

      val <a title="scalaz.concurrent.Task[org.http4s.Response]" id="org.http4s.client.blaze;Http1ClientStage.runRequest.resp">resp</a> = <span title="scalaz.concurrent.Task.type">Task</span>.<span title="[A](register: (scalaz.\/[Throwable,A] =&gt; Unit) =&gt; Unit)scalaz.concurrent.Task[A]">async</span><span title="(register: (scalaz.\/[Throwable,org.http4s.Response] =&gt; Unit) =&gt; Unit)scalaz.concurrent.Task[org.http4s.Response]" class="delimiter">[</span><a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Response" title="org.http4s.Response">Response</a><span class="delimiter">]</span> <span class="delimiter">{</span> <a title="scalaz.\/[Throwable,org.http4s.Response] =&gt; Unit" id="org.http4s.client.blaze;Http1ClientStage.runRequest.resp.$anonfun.cb">cb</a> =&gt;
        val <a title="org.http4s.blaze.util.Cancellable" id="org.http4s.client.blaze;Http1ClientStage.runRequest.resp.$anonfun.c">c</a>: <span title="org.http4s.blaze.util.Cancellable">Cancellable</span> = <a href="package.scala.html#org.http4s.client.blaze.package.ClientTickWheel" title="=&gt; org.http4s.blaze.util.TickWheelExecutor">ClientTickWheel</a>.<span title="(r: Runnable, timeout: scala.concurrent.duration.Duration)org.http4s.blaze.util.Cancellable">schedule</span><span class="delimiter">(</span>new <a title="&lt;$anon: Runnable&gt; extends Object with Runnable" id="org.http4s.client.blaze;Http1ClientStage.runRequest.resp.$anonfun.c;$anon">Runnable</a> <span class="delimiter">{</span>
          override def <a title="()Unit" id="org.http4s.client.blaze;Http1ClientStage.runRequest.resp.$anonfun.c;$anon.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
            if <span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage._inProgress" title="=&gt; java.util.concurrent.atomic.AtomicReference[org.http4s.blaze.util.Cancellable]">_inProgress</a>.<span title="()org.http4s.blaze.util.Cancellable">get</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>  <span class="comment">// We must still be active, and the stage hasn't reset.</span>
              <a href="#org.http4s.client.blaze;Http1ClientStage.runRequest.resp.$anonfun.cb" title="(v1: scalaz.\/[Throwable,org.http4s.Response])Unit">cb</a><span class="delimiter">(</span><span title="(a: concurrent.TimeoutException with scala.util.control.NoStackTrace)scalaz.-\/[concurrent.TimeoutException with scala.util.control.NoStackTrace]">-\/</span><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.mkTimeoutEx" title="=&gt; concurrent.TimeoutException with scala.util.control.NoStackTrace">mkTimeoutEx</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <a href="Http1ClientReceiver.scala.html#org.http4s.client.blaze;Http1ClientReceiver.shutdown" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>, <a href="#org.http4s.client.blaze;Http1ClientStage.timeout" title="scala.concurrent.duration.Duration">timeout</a><span class="delimiter">)</span>

        if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#org.http4s.client.blaze;Http1ClientStage._inProgress" title="=&gt; java.util.concurrent.atomic.AtomicReference[org.http4s.blaze.util.Cancellable]">_inProgress</a>.<span title="(x$1: org.http4s.blaze.util.Cancellable, x$2: org.http4s.blaze.util.Cancellable)Boolean">compareAndSet</span><span class="delimiter">(</span>null, <a href="#org.http4s.client.blaze;Http1ClientStage.runRequest.resp.$anonfun.c" title="org.http4s.blaze.util.Cancellable">c</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#org.http4s.client.blaze;Http1ClientStage.runRequest.resp.$anonfun.c" title="org.http4s.blaze.util.Cancellable">c</a>.<span title="()Unit">cancel</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#org.http4s.client.blaze;Http1ClientStage.runRequest.resp.$anonfun.cb" title="(v1: scalaz.\/[Throwable,org.http4s.Response])Unit">cb</a><span class="delimiter">(</span><span title="(a: org.http4s.client.blaze.Http1ClientStage.InProgressException)scalaz.-\/[org.http4s.client.blaze.Http1ClientStage.InProgressException]">-\/</span><span class="delimiter">(</span>new <a href="#org.http4s.client.blaze.Http1ClientStage;InProgressException" title="org.http4s.client.blaze.Http1ClientStage.InProgressException">InProgressException</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        else <a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest" title="(req: org.http4s.Request)scalaz.concurrent.Task[org.http4s.Response]">executeRequest</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.runRequest.req" title="org.http4s.Request">req</a><span class="delimiter">)</span>.<span title="(f: scalaz.\/[Throwable,org.http4s.Response] =&gt; Unit)Unit">runAsync</span><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.runRequest.resp.$anonfun.cb" title="scalaz.\/[Throwable,org.http4s.Response] =&gt; Unit">cb</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#org.http4s.client.blaze;Http1ClientStage.runRequest.resp" title="scalaz.concurrent.Task[org.http4s.Response]">resp</a>
    <span class="delimiter">}</span>
    else <span title="scalaz.concurrent.Task.type">Task</span>.<span title="(a: =&gt; scalaz.concurrent.Task[org.http4s.Response])scalaz.concurrent.Task[org.http4s.Response]">suspend</span> <span class="delimiter">{</span>
      if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#org.http4s.client.blaze;Http1ClientStage._inProgress" title="=&gt; java.util.concurrent.atomic.AtomicReference[org.http4s.blaze.util.Cancellable]">_inProgress</a>.<span title="(x$1: org.http4s.blaze.util.Cancellable, x$2: org.http4s.blaze.util.Cancellable)Boolean">compareAndSet</span><span class="delimiter">(</span>null, <a href="#org.http4s.client.blaze.Http1ClientStage.ForeverCancellable" title="=&gt; org.http4s.blaze.util.Cancellable">ForeverCancellable</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="scalaz.concurrent.Task.type">Task</span>.<span title="(e: Throwable)scalaz.concurrent.Task[Nothing]">fail</span><span class="delimiter">(</span>new <a href="#org.http4s.client.blaze.Http1ClientStage;InProgressException" title="org.http4s.client.blaze.Http1ClientStage.InProgressException">InProgressException</a><span class="delimiter">)</span>
      else <a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest" title="(req: org.http4s.Request)scalaz.concurrent.Task[org.http4s.Response]">executeRequest</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.runRequest.req" title="org.http4s.Request">req</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(req: org.http4s.Request)scalaz.concurrent.Task[org.http4s.Response]" id="org.http4s.client.blaze;Http1ClientStage.executeRequest">executeRequest</a><span class="delimiter">(</span><span title="org.http4s.Request">req</span>: <a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request" title="org.http4s.Request">Request</a><span class="delimiter">)</span>: <span title="scalaz.concurrent.Task[org.http4s.Response]">Task</span><span class="delimiter">[</span>Response<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#org.http4s.client.blaze;Http1ClientStage" title="=&gt; org.log4s.Logger">logger</a>.debug<span title="Unit" class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Beginning request: &quot;)">Beginning request: $</span><span title="org.http4s.Request">req</span><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
    <a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest" title="(req: org.http4s.Request)Either[Exception,org.http4s.Request]">validateRequest</a><span class="delimiter">(</span><span title="org.http4s.Request">req</span><span class="delimiter">)</span> match <span class="delimiter">{</span>
      case Left<span class="delimiter">(</span><a title="Exception" id="org.http4s.client.blaze;Http1ClientStage.executeRequest.e">e</a><span class="delimiter">)</span>    =&gt; <span title="scalaz.concurrent.Task.type">Task</span>.<span title="(e: Throwable)scalaz.concurrent.Task[Nothing]">fail</span><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.e" title="Exception">e</a><span class="delimiter">)</span>
      case Right<span class="delimiter">(</span><span title="org.http4s.Request">req</span><span class="delimiter">)</span> =&gt;
        <span title="scalaz.concurrent.Task.type">Task</span>.<span title="(register: (scalaz.\/[Throwable,org.http4s.Response] =&gt; Unit) =&gt; Unit)scalaz.concurrent.Task[org.http4s.Response]">async</span> <span class="delimiter">{</span> <a title="scalaz.\/[Throwable,org.http4s.Response] =&gt; Unit" id="org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.cb">cb</a> =&gt;
          try <span class="delimiter">{</span>
            val <a title="org.http4s.util.StringWriter" id="org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.rr">rr</a> = new <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;StringWriter" title="org.http4s.util.StringWriter">StringWriter</a><span class="delimiter">(</span><span title="Int(512)" class="int">512</span><span class="delimiter">)</span>
            <a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine" title="(req: org.http4s.Request, writer: org.http4s.util.Writer)writer.type">encodeRequestLine</a><span class="delimiter">(</span><span title="org.http4s.Request">req</span>, <a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.rr" title="org.http4s.util.StringWriter">rr</a><span class="delimiter">)</span>
            <a href="../../../../../http4s-blazecore/org/http4s/blaze/Http1Stage.scala.html#org.http4s.blaze;Http1Stage.encodeHeaders" title="(headers: org.http4s.Headers, rr: org.http4s.util.Writer)Option[org.http4s.Header.Transfer-Encoding]">encodeHeaders</a><span class="delimiter">(</span><span title="org.http4s.Request">req</span>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.headers" title="=&gt; org.http4s.Headers">headers</a>, <a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.rr" title="org.http4s.util.StringWriter">rr</a><span class="delimiter">)</span>

            val <a title="Boolean" id="org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.closeHeader">closeHeader</a> = <a href="../../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header" title="org.http4s.Header.type">Header</a>.<a href="../../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header.Connection" title="org.http4s.Header.Connection.type">Connection</a>.<a href="../../../../../http4s-core/org/http4s/HeaderKey.scala.html#org.http4s.HeaderKey;Recurring.from" title="(headers: org.http4s.Headers)Option[org.http4s.Header.Connection.HeaderT]">from</a><span class="delimiter">(</span><span title="org.http4s.Request">req</span>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.headers" title="=&gt; org.http4s.Headers">headers</a><span class="delimiter">)</span>
              .<span title="(f: org.http4s.Header.Connection.HeaderT =&gt; Boolean)Option[Boolean]">map</span><span class="delimiter">(</span><a href="../../../../../http4s-blazecore/org/http4s/blaze/Http1Stage.scala.html#org.http4s.blaze;Http1Stage.checkCloseConnection" title="(conn: org.http4s.Header.Connection, rr: org.http4s.util.StringWriter)Boolean">checkCloseConnection</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.closeHeader.$anonfun.x$1" title="org.http4s.Header.Connection.HeaderT">_</a>, <a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.rr" title="org.http4s.util.StringWriter">rr</a><span class="delimiter">)</span><span class="delimiter">)</span>
              .<span title="(default: =&gt; Boolean)Boolean">getOrElse</span><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.getHttpMinor" title="(req: org.http4s.Request)Int">getHttpMinor</a><span class="delimiter">(</span><span title="org.http4s.Request">req</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

            val <a title="org.http4s.blaze.util.ProcessWriter" id="org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.enc">enc</a> = <a href="#org.http4s.client.blaze;Http1ClientStage.getChunkEncoder" title="(req: org.http4s.Request, closeHeader: Boolean, rr: org.http4s.util.StringWriter)org.http4s.blaze.util.ProcessWriter">getChunkEncoder</a><span class="delimiter">(</span><span title="org.http4s.Request">req</span>, <a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.closeHeader" title="Boolean">closeHeader</a>, <a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.rr" title="org.http4s.util.StringWriter">rr</a><span class="delimiter">)</span>

            <a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.enc" title="org.http4s.blaze.util.ProcessWriter">enc</a>.<a href="../../../../../http4s-blazecore/org/http4s/blaze/util/ProcessWriter.scala.html#org.http4s.blaze.util;ProcessWriter.writeProcess" title="(p: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])scalaz.concurrent.Task[Unit]">writeProcess</a><span class="delimiter">(</span><span title="org.http4s.Request">req</span>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.body" title="=&gt; org.http4s.EntityBody">body</a><span class="delimiter">)</span>.<span title="(f: scalaz.\/[Throwable,Unit] =&gt; Unit)Unit">runAsync</span> <a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.$anonfun.x0$1" title="Unit" class="delimiter">{</a>
              case \/-<span class="delimiter">(</span>_<span class="delimiter">)</span>    =&gt; <a href="Http1ClientReceiver.scala.html#org.http4s.client.blaze;Http1ClientReceiver.receiveResponse" title="(cb: Http1ClientStage.this.Callback, close: Boolean)Unit">receiveResponse</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.cb" title="scalaz.\/[Throwable,org.http4s.Response] =&gt; Unit">cb</a>, <a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.closeHeader" title="Boolean">closeHeader</a><span class="delimiter">)</span>
              case <a title="scalaz.-\/[Throwable]" id="org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.$anonfun.e">e</a>@ -\/<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.cb" title="(v1: scalaz.\/[Throwable,org.http4s.Response])Unit">cb</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.$anonfun.e" title="scalaz.-\/[Throwable]">e</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> catch <span class="delimiter">{</span> case <a title="Throwable" id="org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.t">t</a>: <span title="Throwable">Throwable</span> =&gt;
            <a href="#org.http4s.client.blaze;Http1ClientStage" title="=&gt; org.log4s.Logger">logger</a>.error<span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.t" title="Throwable">t</a><span class="delimiter">)</span><span title="(x$1: String, x$2: Throwable)Unit" class="delimiter">(</span><span title="String(&quot;Error during request submission&quot;)" class="string">&quot;Error during request submission&quot;</span><span class="delimiter">)</span>
            <a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.cb" title="(v1: scalaz.\/[Throwable,org.http4s.Response])Unit">cb</a><span class="delimiter">(</span><span title="(a: Throwable)scalaz.-\/[Throwable]">-\/</span><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.executeRequest.$anonfun.t" title="Throwable">t</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">///////////////////////// Private helpers /////////////////////////</span>

  <span class="comment">/** Validates the request, attempting to fix it if possible,
    * returning an Exception if invalid, None otherwise */</span>
  @tailrec private def <a title="(req: org.http4s.Request)Either[Exception,org.http4s.Request]" id="org.http4s.client.blaze;Http1ClientStage.validateRequest">validateRequest</a><span class="delimiter">(</span><a title="org.http4s.Request" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.req">req</a>: <a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request" title="org.http4s.Request">Request</a><span class="delimiter">)</span>: <span title="Either[Exception,org.http4s.Request]">Either</span><span class="delimiter">[</span>Exception, Request<span class="delimiter">]</span> = <span class="delimiter">{</span>
    val <a title="Int" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.minor">minor</a> = <a href="#org.http4s.client.blaze;Http1ClientStage.getHttpMinor" title="(req: org.http4s.Request)Int">getHttpMinor</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a><span class="delimiter">)</span>

      <span class="comment">// If we are HTTP/1.0, make sure HTTP/1.0 has no body or a Content-Length header</span>
    if <span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.minor" title="Int">minor</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.body" title="=&gt; org.http4s.EntityBody">body</a>.<span title="=&gt; Boolean">isHalt</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header.Content-Length" title="org.http4s.Header.Content-Length.type">`Content-Length`</a>.<a href="../../../../../http4s-core/org/http4s/HeaderKey.scala.html#org.http4s.HeaderKey;Singleton.from" title="(headers: org.http4s.Headers)Option[org.http4s.Header.Content-Length.HeaderT]">from</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.headers" title="=&gt; org.http4s.Headers">headers</a><span class="delimiter">)</span>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#org.http4s.client.blaze;Http1ClientStage" title="=&gt; org.log4s.Logger">logger</a>.warn<span title="Unit" class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Request &quot;)">Request $</span><span class="delimiter">{</span><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.copy$default$1" title="org.http4s.Method" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.x$7">copy</a><span class="delimiter">(</span>body = <a title="scalaz.stream.Process0[Nothing] @scala.reflect.internal.annotations.uncheckedBounds" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.x$2">halt</a><span class="delimiter">)</span><span class="delimiter">}</span><span title="String(&quot; is HTTP/1.0 but lacks a length header. Transforming to HTTP/1.1&quot;)" class="string"> is HTTP/1.0 but lacks a length header. Transforming to HTTP/1.1&quot;</span><span class="delimiter">)</span>
      <a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest" title="(req: org.http4s.Request)Either[Exception,org.http4s.Request]">validateRequest</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.copy$default$1" title="org.http4s.Method" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.x$13">copy</a><span class="delimiter">(</span>httpVersion = <a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s.HttpVersion" title="org.http4s.HttpVersion.type">HttpVersion</a>.<a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s.HttpVersion.HTTP/1.1" title="org.http4s.HttpVersion" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.x$8">`HTTP/1.1`</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
      <span class="comment">// Ensure we have a host header for HTTP/1.1</span>
    else if <span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.minor" title="Int">minor</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.uri" title="=&gt; org.http4s.Uri">uri</a>.<a href="../../../../../http4s-core/org/http4s/Uri.scala.html#org.http4s;Uri.host" title="=&gt; Option[org.http4s.Uri.Host]">host</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">// this is unlikely if not impossible</span>
      if <span class="delimiter">(</span><a href="../../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header.Host" title="org.http4s.Header.Host.type">Host</a>.<a href="../../../../../http4s-core/org/http4s/HeaderKey.scala.html#org.http4s.HeaderKey;Singleton.from" title="(headers: org.http4s.Headers)Option[org.http4s.Header.Host.HeaderT]">from</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.headers" title="=&gt; org.http4s.Headers">headers</a><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        val <a title="org.http4s.Header.Host.HeaderT" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.host">host</a> = <a href="../../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header.Host" title="org.http4s.Header.Host.type">Host</a>.<a href="../../../../../http4s-core/org/http4s/HeaderKey.scala.html#org.http4s.HeaderKey;Singleton.from" title="(headers: org.http4s.Headers)Option[org.http4s.Header.Host.HeaderT]">from</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.headers" title="=&gt; org.http4s.Headers">headers</a><span class="delimiter">)</span>.<span title="=&gt; org.http4s.Header.Host.HeaderT">get</span>
        val <a title="org.http4s.Uri.Authority" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.newAuth">newAuth</a> = <a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.uri" title="=&gt; org.http4s.Uri">uri</a>.<a href="../../../../../http4s-core/org/http4s/Uri.scala.html#org.http4s;Uri.authority" title="=&gt; Option[org.http4s.Uri.Authority]">authority</a> match <span class="delimiter">{</span>
          case Some<span class="delimiter">(</span><a title="org.http4s.Uri.Authority" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.newAuth.auth">auth</a><span class="delimiter">)</span> =&gt; <a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.newAuth.auth" title="org.http4s.Uri.Authority">auth</a>.<a href="../../../../../http4s-core/org/http4s/Uri.scala.html#org.http4s.Uri;Authority.copy$default$1" title="Option[org.http4s.Uri.UserInfo] @scala.reflect.internal.annotations.uncheckedBounds" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.newAuth.x$16">copy</a><span class="delimiter">(</span>host = <a href="../../../../../http4s-core/org/http4s/Uri.scala.html#org.http4s.Uri.RegName.apply(a584179f7f)" title="(name: String)org.http4s.Uri.RegName">RegName</a><a title="org.http4s.Uri.RegName" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.newAuth.x$14" class="delimiter">(</a><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.host" title="org.http4s.Header.Host.HeaderT">host</a>.<a href="../../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header;Host.host" title="=&gt; String">host</a><span class="delimiter">)</span>, port = <a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.host" title="org.http4s.Header.Host.HeaderT">host</a>.<a href="../../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header;Host.port" title="Option[Int] @scala.reflect.internal.annotations.uncheckedBounds" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.newAuth.x$15">port</a><span class="delimiter">)</span>
          case <span title="None.type">None</span> =&gt; <a href="../../../../../http4s-core/org/http4s/Uri.scala.html#org.http4s.Uri.Authority.apply$default$1" title="Option[org.http4s.Uri.UserInfo] @scala.reflect.internal.annotations.uncheckedBounds" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.newAuth.x$19">Authority</a><span class="delimiter">(</span>host = <a href="../../../../../http4s-core/org/http4s/Uri.scala.html#org.http4s.Uri.RegName.apply(a584179f7f)" title="(name: String)org.http4s.Uri.RegName">RegName</a><a title="org.http4s.Uri.RegName" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.newAuth.x$17" class="delimiter">(</a><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.host" title="org.http4s.Header.Host.HeaderT">host</a>.<a href="../../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header;Host.host" title="=&gt; String">host</a><span class="delimiter">)</span>, port = <a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.host" title="org.http4s.Header.Host.HeaderT">host</a>.<a href="../../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header;Host.port" title="Option[Int] @scala.reflect.internal.annotations.uncheckedBounds" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.newAuth.x$18">port</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest" title="(req: org.http4s.Request)Either[Exception,org.http4s.Request]">validateRequest</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.copy$default$1" title="org.http4s.Method" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.x$30">copy</a><span class="delimiter">(</span>uri = <a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.uri" title="=&gt; org.http4s.Uri">uri</a>.<a href="../../../../../http4s-core/org/http4s/Uri.scala.html#org.http4s;Uri.copy$default$1" title="Option[org.http4s.util.CaseInsensitiveString] @scala.reflect.internal.annotations.uncheckedBounds" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.x$25.x$24">copy</a><a title="org.http4s.Uri" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.x$25" class="delimiter">(</a>authority = <span title="(x: org.http4s.Uri.Authority)Some[org.http4s.Uri.Authority]">Some</span><a title="Some[org.http4s.Uri.Authority] @scala.reflect.internal.annotations.uncheckedBounds" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.x$25.x$20" class="delimiter">(</a><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.newAuth" title="org.http4s.Uri.Authority">newAuth</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      else if <span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.body" title="=&gt; org.http4s.EntityBody">body</a>.<span title="=&gt; Boolean">isHalt</span> <span title="(x: Boolean)Boolean">||</span> <a href="../../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header.Content-Length" title="org.http4s.Header.Content-Length.type">`Content-Length`</a>.<a href="../../../../../http4s-core/org/http4s/HeaderKey.scala.html#org.http4s.HeaderKey;Singleton.from" title="(headers: org.http4s.Headers)Option[org.http4s.Header.Content-Length.HeaderT]">from</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.headers" title="=&gt; org.http4s.Headers">headers</a><span class="delimiter">)</span>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>  <span class="comment">// translate to HTTP/1.0</span>
        <a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest" title="(req: org.http4s.Request)Either[Exception,org.http4s.Request]">validateRequest</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.copy$default$1" title="org.http4s.Method" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.x$36">copy</a><span class="delimiter">(</span>httpVersion = <a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s.HttpVersion" title="org.http4s.HttpVersion.type">HttpVersion</a>.<a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s.HttpVersion.HTTP/1.0" title="org.http4s.HttpVersion" id="org.http4s.client.blaze;Http1ClientStage.validateRequest.x$31">`HTTP/1.0`</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> else <span class="delimiter">{</span>
        <span title="(a: Exception)scala.util.Left[Exception,Nothing]">Left</span><span class="delimiter">(</span>new <span title="Exception">Exception</span><span class="delimiter">(</span><span title="String(&quot;Host header required for HTTP/1.1 request&quot;)" class="string">&quot;Host header required for HTTP/1.1 request&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    else <span title="(b: org.http4s.Request)scala.util.Right[Nothing,org.http4s.Request]">Right</span><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.validateRequest.req" title="org.http4s.Request">req</a><span class="delimiter">)</span> <span class="comment">// All appears to be well</span>
  <span class="delimiter">}</span>

  private def <a title="=&gt; concurrent.TimeoutException with scala.util.control.NoStackTrace" id="org.http4s.client.blaze;Http1ClientStage.mkTimeoutEx">mkTimeoutEx</a> = new <a title="&lt;$anon: concurrent.TimeoutException with scala.util.control.NoStackTrace&gt; extends concurrent.TimeoutException with scala.util.control.NoStackTrace" id="org.http4s.client.blaze;Http1ClientStage.mkTimeoutEx;$anon">TimeoutException</a><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Request timed out. Timeout: &quot;)">Request timed out. Timeout: $</span><a href="#org.http4s.client.blaze;Http1ClientStage.timeout" title="scala.concurrent.duration.Duration">timeout</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span> with <span title="scala.util.control.NoStackTrace">NoStackTrace</span>

  private def <a title="(req: org.http4s.Request)Int" id="org.http4s.client.blaze;Http1ClientStage.getHttpMinor">getHttpMinor</a><span class="delimiter">(</span><a title="org.http4s.Request" id="org.http4s.client.blaze;Http1ClientStage.getHttpMinor.req">req</a>: <a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request" title="org.http4s.Request">Request</a><span class="delimiter">)</span>: <span title="Int">Int</span> = <a href="#org.http4s.client.blaze;Http1ClientStage.getHttpMinor.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.httpVersion" title="=&gt; org.http4s.HttpVersion">httpVersion</a>.<a href="../../../../../http4s-core/org/http4s/HttpVersion.scala.html#org.http4s;HttpVersion.minor" title="=&gt; Int">minor</a>

  private def <a title="(req: org.http4s.Request, closeHeader: Boolean, rr: org.http4s.util.StringWriter)org.http4s.blaze.util.ProcessWriter" id="org.http4s.client.blaze;Http1ClientStage.getChunkEncoder">getChunkEncoder</a><span class="delimiter">(</span><a title="org.http4s.Request" id="org.http4s.client.blaze;Http1ClientStage.getChunkEncoder.req">req</a>: <a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request" title="org.http4s.Request">Request</a>, <a title="Boolean" id="org.http4s.client.blaze;Http1ClientStage.getChunkEncoder.closeHeader">closeHeader</a>: <span title="Boolean">Boolean</span>, <a title="org.http4s.util.StringWriter" id="org.http4s.client.blaze;Http1ClientStage.getChunkEncoder.rr">rr</a>: <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;StringWriter" title="org.http4s.util.StringWriter">StringWriter</a><span class="delimiter">)</span>: <a href="../../../../../http4s-blazecore/org/http4s/blaze/util/ProcessWriter.scala.html#org.http4s.blaze.util;ProcessWriter" title="org.http4s.blaze.util.ProcessWriter">ProcessWriter</a> =
    <a href="../../../../../http4s-blazecore/org/http4s/blaze/Http1Stage.scala.html#org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49)" title="(msg: org.http4s.Message, rr: org.http4s.util.StringWriter, minor: Int, closeOnFinish: Boolean)org.http4s.blaze.util.ProcessWriter">getEncoder</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.getChunkEncoder.req" title="org.http4s.Request">req</a>, <a href="#org.http4s.client.blaze;Http1ClientStage.getChunkEncoder.rr" title="org.http4s.util.StringWriter">rr</a>, <a href="#org.http4s.client.blaze;Http1ClientStage.getHttpMinor" title="(req: org.http4s.Request)Int">getHttpMinor</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.getChunkEncoder.req" title="org.http4s.Request">req</a><span class="delimiter">)</span>, <a href="#org.http4s.client.blaze;Http1ClientStage.getChunkEncoder.closeHeader" title="Boolean">closeHeader</a><span class="delimiter">)</span>

  private def <a title="(req: org.http4s.Request, writer: org.http4s.util.Writer)writer.type" id="org.http4s.client.blaze;Http1ClientStage.encodeRequestLine">encodeRequestLine</a><span class="delimiter">(</span><a title="org.http4s.Request" id="org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.req">req</a>: <a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request" title="org.http4s.Request">Request</a>, <a title="org.http4s.util.Writer" id="org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.writer">writer</a>: <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer" title="org.http4s.util.Writer">Writer</a><span class="delimiter">)</span>: writer.type = <span class="delimiter">{</span>
    val <a title="org.http4s.Uri" id="org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.uri">uri</a> = <a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.uri" title="=&gt; org.http4s.Uri">uri</a>
    <a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.writer" title="org.http4s.util.Writer">writer</a> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(98e2fb2962)" title="(r: org.http4s.Method)(implicit evidence$3: org.http4s.util.Renderer[org.http4s.Method])writer.type">&lt;&lt;</a> <a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.method" title="=&gt; org.http4s.Method">method</a> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)writer.type">&lt;&lt;</a> <span title="Char(' ')" class="char">' '</span> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(98e2fb2962)" title="(r: org.http4s.Uri)(implicit evidence$3: org.http4s.util.Renderer[org.http4s.Uri])writer.type">&lt;&lt;</a> <a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.uri" title="org.http4s.Uri">uri</a>.<a href="../../../../../http4s-core/org/http4s/Uri.scala.html#org.http4s;Uri.copy" title="(scheme: Option[org.http4s.util.CaseInsensitiveString], authority: Option[org.http4s.Uri.Authority], path: org.http4s.Uri.Path, query: Option[org.http4s.Uri.Query], fragment: Option[org.http4s.Uri.Fragment])org.http4s.Uri">copy</a><span class="delimiter">(</span>scheme = <span title="None.type">None</span>, authority = <span title="None.type">None</span><span class="delimiter">)</span> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)writer.type">&lt;&lt;</a> <span title="Char(' ')" class="char">' '</span> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(98e2fb2962)" title="(r: org.http4s.HttpVersion)(implicit evidence$3: org.http4s.util.Renderer[org.http4s.HttpVersion])writer.type">&lt;&lt;</a> <a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.httpVersion" title="=&gt; org.http4s.HttpVersion">httpVersion</a> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)writer.type">&lt;&lt;</a> <span title="Char('\r')" class="char">'\r'</span> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)writer.type">&lt;&lt;</a> <span title="Char('\n')" class="char">'\n'</span>
    if <span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.getHttpMinor" title="(req: org.http4s.Request)Int">getHttpMinor</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.req" title="org.http4s.Request">req</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header.Host" title="org.http4s.Header.Host.type">Host</a>.<a href="../../../../../http4s-core/org/http4s/HeaderKey.scala.html#org.http4s.HeaderKey;Singleton.from" title="(headers: org.http4s.Headers)Option[org.http4s.Header.Host.HeaderT]">from</a><span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.req" title="org.http4s.Request">req</a>.<a href="../../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Request.headers" title="=&gt; org.http4s.Headers">headers</a><span class="delimiter">)</span>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">// need to add the host header for HTTP/1.1</span>
      <a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.uri" title="org.http4s.Uri">uri</a>.<a href="../../../../../http4s-core/org/http4s/Uri.scala.html#org.http4s;Uri.host" title="=&gt; Option[org.http4s.Uri.Host]">host</a> match <span class="delimiter">{</span>
        case Some<span class="delimiter">(</span><a title="org.http4s.Uri.Host" id="org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.host">host</a><span class="delimiter">)</span> =&gt;
          <a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.writer" title="org.http4s.util.Writer">writer</a> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(8d31e5b642)" title="(s: String)writer.type">&lt;&lt;</a> <span title="String(&quot;Host: &quot;)" class="string">&quot;Host: &quot;</span> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(8d31e5b642)" title="(s: String)writer.type">&lt;&lt;</a> <a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.host" title="org.http4s.Uri.Host">host</a>.<a href="../../../../../http4s-core/org/http4s/Uri.scala.html#org.http4s.Uri;Host.value" title="=&gt; String">value</a>
          if <span class="delimiter">(</span><a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.uri" title="org.http4s.Uri">uri</a>.<a href="../../../../../http4s-core/org/http4s/Uri.scala.html#org.http4s;Uri.port" title="=&gt; Option[Int]">port</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span>  <a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.writer" title="org.http4s.util.Writer">writer</a> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)writer.type">&lt;&lt;</a> <span title="Char(':')" class="char">':'</span> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(361630288b)" title="(int: Int)writer.type">&lt;&lt;</a> <a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.uri" title="org.http4s.Uri">uri</a>.<a href="../../../../../http4s-core/org/http4s/Uri.scala.html#org.http4s;Uri.port" title="=&gt; Option[Int]">port</a>.<span title="=&gt; Int">get</span>
          <a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.writer" title="org.http4s.util.Writer">writer</a> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)writer.type">&lt;&lt;</a> <span title="Char('\r')" class="char">'\r'</span> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)writer.type">&lt;&lt;</a> <span title="Char('\n')" class="char">'\n'</span>

        case <span title="None.type">None</span> =&gt;
      <span class="delimiter">}</span>
      <a href="#org.http4s.client.blaze;Http1ClientStage.encodeRequestLine.writer" title="org.http4s.util.Writer">writer</a>
    <span class="delimiter">}</span> else sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="String(&quot;Request URI must have a host.&quot;)" class="string">&quot;Request URI must have a host.&quot;</span><span class="delimiter">)</span> <span class="comment">// TODO: do we want to do this by exception?</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

object <a title="org.http4s.client.blaze.Http1ClientStage.type" id="org.http4s.client.blaze.Http1ClientStage">Http1ClientStage</a> <a href="#org.http4s.client.blaze.Http1ClientStage" title="org.http4s.client.blaze.Http1ClientStage.type" class="delimiter">{</a>
  class <a title="class InProgressException extends Exception" id="org.http4s.client.blaze.Http1ClientStage;InProgressException">InProgressException</a> extends <a href="#org.http4s.client.blaze.Http1ClientStage;InProgressException" title="Exception">Exception</a><span class="delimiter">(</span><span title="String(&quot;Stage has request in progress&quot;)" class="string">&quot;Stage has request in progress&quot;</span><span class="delimiter">)</span>

  <span class="comment">// Acts as a place holder for requests that don't have a timeout set</span>
  private val <a title="&lt;refinement of org.http4s.blaze.util.Cancellable&gt; extends AnyRef with org.http4s.blaze.util.Cancellable" id="org.http4s.client.blaze.Http1ClientStage.ForeverCancellable">ForeverCancellable</a> = new <a title="&lt;$anon: org.http4s.blaze.util.Cancellable&gt; extends AnyRef with org.http4s.blaze.util.Cancellable" id="org.http4s.client.blaze.Http1ClientStage.ForeverCancellable;$anon">Cancellable</a> <span class="delimiter">{</span>
    override def <a title="()Boolean" id="org.http4s.client.blaze.Http1ClientStage.ForeverCancellable;$anon.isCancelled">isCancelled</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = false
    override def <a title="()Unit" id="org.http4s.client.blaze.Http1ClientStage.ForeverCancellable;$anon.cancel">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>



        </pre>
    </body>
</html>
