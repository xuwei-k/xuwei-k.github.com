<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>http4s-blazecore/org/http4s/blaze/Http1Stage.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
package org.http4s
package blaze

import java.nio.ByteBuffer
import java.nio.charset.StandardCharsets

import org.http4s.<a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header" title="org.http4s.Header.type">Header</a>.`Transfer-Encoding`
import org.http4s.blaze.util.<span title="org.http4s.blaze.util.BufferTools.type">BufferTools</span>.<span class="delimiter">{</span>concatBuffers, emptyBuffer<span class="delimiter">}</span>
import org.http4s.blaze.http.http_parser.<span title="org.http4s.blaze.http.http_parser.BaseExceptions.type">BaseExceptions</span>.ParserException
import org.http4s.blaze.pipeline.<span title="org.http4s.blaze.pipeline.Command.type">Command</span>.EOF
import org.http4s.blaze.pipeline.<span class="delimiter">{</span>Command, TailStage<span class="delimiter">}</span>
import org.http4s.blaze.util.<span class="delimiter">{</span>ChunkProcessWriter, CachingStaticWriter, CachingChunkWriter, ProcessWriter<span class="delimiter">}</span>
import org.http4s.util.<span class="delimiter">{</span>Writer, StringWriter<span class="delimiter">}</span>
import scodec.bits.ByteVector

import scala.concurrent.<span class="delimiter">{</span>Future, ExecutionContext<span class="delimiter">}</span>
import scala.util.<span class="delimiter">{</span>Failure, Success<span class="delimiter">}</span>
import scalaz.stream.<span title="scalaz.stream.Process.type">Process</span>._
import scalaz.stream.<span title="scalaz.stream.Cause.type">Cause</span>.<span class="delimiter">{</span>Terminated, End<span class="delimiter">}</span>
import scalaz.<span class="delimiter">{</span>-\/, \/-<span class="delimiter">}</span>
import scalaz.concurrent.Task

trait <a title="trait Http1Stage extends AnyRef" id="org.http4s.blaze;Http1Stage">Http1Stage</a> <span title="Unit" class="delimiter">{</span> self: TailStage<span class="delimiter">[</span>ByteBuffer<span class="delimiter">]</span> =&gt;

  <span class="comment">/** ExecutionContext to be used for all Future continuations
    * '''WARNING:''' The ExecutionContext should trampoline or risk possibly unhandled stack overflows */</span>
  protected implicit def <a title="=&gt; scala.concurrent.ExecutionContext" id="org.http4s.blaze;Http1Stage.ec">ec</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span>

  protected def <a title="(buffer: java.nio.ByteBuffer)Option[java.nio.ByteBuffer]" id="org.http4s.blaze;Http1Stage.doParseContent">doParseContent</a><span class="delimiter">(</span><a title="java.nio.ByteBuffer" id="org.http4s.blaze;Http1Stage.doParseContent.buffer">buffer</a>: <span title="java.nio.ByteBuffer">ByteBuffer</span><span class="delimiter">)</span>: <span title="Option[java.nio.ByteBuffer]">Option</span><span class="delimiter">[</span>ByteBuffer<span class="delimiter">]</span>

  protected def <a title="()Boolean" id="org.http4s.blaze;Http1Stage.contentComplete">contentComplete</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span>

  <span class="comment">/** Encodes the headers into the Writer, except the Transfer-Encoding header which may be returned
    * Note: this method is very niche but useful for both server and client. */</span>
  protected def <a title="(headers: org.http4s.Headers, rr: org.http4s.util.Writer)Option[org.http4s.Header.Transfer-Encoding]" id="org.http4s.blaze;Http1Stage.encodeHeaders">encodeHeaders</a><span class="delimiter">(</span><a title="org.http4s.Headers" id="org.http4s.blaze;Http1Stage.encodeHeaders.headers">headers</a>: <a href="../../../../http4s-core/org/http4s/Headers.scala.html#org.http4s;Headers" title="org.http4s.Headers">Headers</a>, <a title="org.http4s.util.Writer" id="org.http4s.blaze;Http1Stage.encodeHeaders.rr">rr</a>: <a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer" title="org.http4s.util.Writer">Writer</a><span class="delimiter">)</span>: <span title="Option[org.http4s.Header.Transfer-Encoding]">Option</span><span class="delimiter">[</span>`Transfer-Encoding`<span class="delimiter">]</span> = <span class="delimiter">{</span>
    var <a title="Option[org.http4s.Header.Transfer-Encoding]" id="org.http4s.blaze;Http1Stage.encodeHeaders.encoding">encoding</a>: <span title="Option[org.http4s.Header.Transfer-Encoding]">Option</span><span class="delimiter">[</span>`Transfer-Encoding`<span class="delimiter">]</span> = <span title="None.type">None</span>
    <a href="#org.http4s.blaze;Http1Stage.encodeHeaders.headers" title="org.http4s.Headers">headers</a>.<a href="../../../../http4s-core/org/http4s/Headers.scala.html#org.http4s;Headers.foreach" title="(f: org.http4s.Header =&gt; Any)Unit">foreach</a><span class="delimiter">(</span> <a title="org.http4s.Header" id="org.http4s.blaze;Http1Stage.encodeHeaders.$anonfun.header">header</a> =&gt;
      if <span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.encodeHeaders.$anonfun.header" title="org.http4s.Header">header</a>.<a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s;Header.name" title="=&gt; org.http4s.util.CaseInsensitiveString">name</a> <span title="(x$1: Any)Boolean">!=</span> <a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header.Transfer-Encoding" title="org.http4s.Header.Transfer-Encoding.type">`Transfer-Encoding`</a>.<a href="../../../../http4s-core/org/http4s/HeaderKey.scala.html#org.http4s.HeaderKey;Internal.name" title="=&gt; org.http4s.util.CaseInsensitiveString">name</a><span class="delimiter">)</span> <a href="#org.http4s.blaze;Http1Stage.encodeHeaders.rr" title="org.http4s.util.Writer">rr</a> <a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(98e2fb2962)" title="(r: org.http4s.Header)(implicit evidence$3: org.http4s.util.Renderer[org.http4s.Header])rr.type">&lt;&lt;</a> <a href="#org.http4s.blaze;Http1Stage.encodeHeaders.$anonfun.header" title="org.http4s.Header">header</a> <a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)rr.type">&lt;&lt;</a> <span title="Char('\r')" class="char">'\r'</span> <a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)rr.type">&lt;&lt;</a> <span title="Char('\n')" class="char">'\n'</span>
      else <a href="#org.http4s.blaze;Http1Stage.encodeHeaders.encoding" title="Option[org.http4s.Header.Transfer-Encoding]">encoding</a> = <a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header.Transfer-Encoding" title="org.http4s.Header.Transfer-Encoding.type">`Transfer-Encoding`</a>.<a href="../../../../http4s-core/org/http4s/HeaderKey.scala.html#org.http4s.HeaderKey;Internal.matchHeader" title="(header: org.http4s.Header)Option[org.http4s.Header.Transfer-Encoding.HeaderT]">matchHeader</a><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.encodeHeaders.$anonfun.header" title="org.http4s.Header">header</a><span class="delimiter">)</span>
    <span class="delimiter">)</span>
    <a href="#org.http4s.blaze;Http1Stage.encodeHeaders.encoding" title="Option[org.http4s.Header.Transfer-Encoding]">encoding</a>
  <span class="delimiter">}</span>

  <span class="comment">/** Check Connection header and add applicable headers to response */</span>
  protected def <a title="(conn: org.http4s.Header.Connection, rr: org.http4s.util.StringWriter)Boolean" id="org.http4s.blaze;Http1Stage.checkCloseConnection">checkCloseConnection</a><span class="delimiter">(</span><a title="org.http4s.Header.Connection" id="org.http4s.blaze;Http1Stage.checkCloseConnection.conn">conn</a>: Header.<a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header;Connection" title="org.http4s.Header.Connection">Connection</a>, <a title="org.http4s.util.StringWriter" id="org.http4s.blaze;Http1Stage.checkCloseConnection.rr">rr</a>: <a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;StringWriter" title="org.http4s.util.StringWriter">StringWriter</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.checkCloseConnection.conn" title="org.http4s.Header.Connection">conn</a>.<a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header;Connection.hasKeepAlive" title="=&gt; Boolean">hasKeepAlive</a><span class="delimiter">)</span> <span class="delimiter">{</span>                          <span class="comment">// connection, look to the request</span>
      <a href="#org.http4s.blaze;Http1Stage" title="=&gt; org.log4s.Logger">logger</a>.trace<span title="(x$1: String)Unit" class="delimiter">(</span><span title="String(&quot;Found Keep-Alive header&quot;)" class="string">&quot;Found Keep-Alive header&quot;</span><span class="delimiter">)</span>
      false
    <span class="delimiter">}</span>
    else if <span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.checkCloseConnection.conn" title="org.http4s.Header.Connection">conn</a>.<a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header;Connection.hasClose" title="=&gt; Boolean">hasClose</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#org.http4s.blaze;Http1Stage" title="=&gt; org.log4s.Logger">logger</a>.trace<span title="(x$1: String)Unit" class="delimiter">(</span><span title="String(&quot;Found Connection:Close header&quot;)" class="string">&quot;Found Connection:Close header&quot;</span><span class="delimiter">)</span>
      <a href="#org.http4s.blaze;Http1Stage.checkCloseConnection.rr" title="org.http4s.util.StringWriter">rr</a> <a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(8d31e5b642)" title="(s: String)rr.type">&lt;&lt;</a> <span title="String(&quot;Connection:close\r\n&quot;)" class="string">&quot;Connection:close\r\n&quot;</span>
      true
    <span class="delimiter">}</span>
    else <span class="delimiter">{</span>
      <a href="#org.http4s.blaze;Http1Stage" title="=&gt; org.log4s.Logger">logger</a>.info<span title="Unit" class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Unknown connection header: \'&quot;)">Unknown connection header: '$</span><span class="delimiter">{</span><a href="#org.http4s.blaze;Http1Stage.checkCloseConnection.conn" title="org.http4s.Header.Connection">conn</a>.<a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s;Header.value" title="=&gt; String">value</a><span class="delimiter">}</span><span title="String(&quot;\'. Closing connection upon completion.&quot;)" class="string">'. Closing connection upon completion.&quot;</span><span class="delimiter">)</span>
      <a href="#org.http4s.blaze;Http1Stage.checkCloseConnection.rr" title="org.http4s.util.StringWriter">rr</a> <a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(8d31e5b642)" title="(s: String)rr.type">&lt;&lt;</a> <span title="String(&quot;Connection:close\r\n&quot;)" class="string">&quot;Connection:close\r\n&quot;</span>
      true
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Get the proper body encoder based on the message headers */</span>
  final protected def <a title="(msg: org.http4s.Message, rr: org.http4s.util.StringWriter, minor: Int, closeOnFinish: Boolean)org.http4s.blaze.util.ProcessWriter" id="org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49)">getEncoder</a><span class="delimiter">(</span><a title="org.http4s.Message" id="org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49).msg">msg</a>: <a href="../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Message" title="org.http4s.Message">Message</a>,
                                 <a title="org.http4s.util.StringWriter" id="org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49).rr">rr</a>: <a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;StringWriter" title="org.http4s.util.StringWriter">StringWriter</a>,
                                 <a title="Int" id="org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49).minor">minor</a>: <span title="Int">Int</span>,
                                 <a title="Boolean" id="org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49).closeOnFinish">closeOnFinish</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <a href="util/ProcessWriter.scala.html#org.http4s.blaze.util;ProcessWriter" title="org.http4s.blaze.util.ProcessWriter">ProcessWriter</a> = <span class="delimiter">{</span>
    val <a title="org.http4s.Headers" id="org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49).headers">headers</a> = <a href="#org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49).msg" title="org.http4s.Message">msg</a>.<a href="../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Message.headers" title="=&gt; org.http4s.Headers">headers</a>
    <a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7)" title="(connectionHeader: Option[org.http4s.Header.Connection], bodyEncoding: Option[org.http4s.Header.Transfer-Encoding], lengthHeader: Option[org.http4s.Header.Content-Length], trailer: scalaz.concurrent.Task[org.http4s.Headers], rr: org.http4s.util.StringWriter, minor: Int, closeOnFinish: Boolean)org.http4s.blaze.util.ProcessWriter">getEncoder</a><span class="delimiter">(</span><a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header" title="org.http4s.Header.type">Header</a>.<a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header.Connection" title="org.http4s.Header.Connection.type">Connection</a>.<a href="../../../../http4s-core/org/http4s/HeaderKey.scala.html#org.http4s.HeaderKey;Recurring.from" title="(headers: org.http4s.Headers)Option[org.http4s.Header.Connection.HeaderT]">from</a><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49).headers" title="org.http4s.Headers">headers</a><span class="delimiter">)</span>,
               <a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header" title="org.http4s.Header.type">Header</a>.<a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header.Transfer-Encoding" title="org.http4s.Header.Transfer-Encoding.type">`Transfer-Encoding`</a>.<a href="../../../../http4s-core/org/http4s/HeaderKey.scala.html#org.http4s.HeaderKey;Recurring.from" title="(headers: org.http4s.Headers)Option[org.http4s.Header.Transfer-Encoding.HeaderT]">from</a><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49).headers" title="org.http4s.Headers">headers</a><span class="delimiter">)</span>,
               <a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header" title="org.http4s.Header.type">Header</a>.<a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header.Content-Length" title="org.http4s.Header.Content-Length.type">`Content-Length`</a>.<a href="../../../../http4s-core/org/http4s/HeaderKey.scala.html#org.http4s.HeaderKey;Singleton.from" title="(headers: org.http4s.Headers)Option[org.http4s.Header.Content-Length.HeaderT]">from</a><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49).headers" title="org.http4s.Headers">headers</a><span class="delimiter">)</span>,
               <a href="#org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49).msg" title="org.http4s.Message">msg</a>.<a href="../../../../http4s-core/org/http4s/Message.scala.html#org.http4s;Message.trailerHeaders" title="=&gt; scalaz.concurrent.Task[org.http4s.Headers]">trailerHeaders</a>,
               <a href="#org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49).rr" title="org.http4s.util.StringWriter">rr</a>,
               <a href="#org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49).minor" title="Int">minor</a>,
               <a href="#org.http4s.blaze;Http1Stage.getEncoder(1b7f7a4b49).closeOnFinish" title="Boolean">closeOnFinish</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Get the proper body encoder based on the message headers,
    * adding the appropriate Connection and Transfer-Encoding headers along the way */</span>
  protected def <a title="(connectionHeader: Option[org.http4s.Header.Connection], bodyEncoding: Option[org.http4s.Header.Transfer-Encoding], lengthHeader: Option[org.http4s.Header.Content-Length], trailer: scalaz.concurrent.Task[org.http4s.Headers], rr: org.http4s.util.StringWriter, minor: Int, closeOnFinish: Boolean)org.http4s.blaze.util.ProcessWriter" id="org.http4s.blaze;Http1Stage.getEncoder(7d809242e7)">getEncoder</a><span class="delimiter">(</span><a title="Option[org.http4s.Header.Connection]" id="org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).connectionHeader">connectionHeader</a>: <span title="Option[org.http4s.Header.Connection]">Option</span><span class="delimiter">[</span>Header.Connection<span class="delimiter">]</span>,
                 <a title="Option[org.http4s.Header.Transfer-Encoding]" id="org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).bodyEncoding">bodyEncoding</a>: <span title="Option[org.http4s.Header.Transfer-Encoding]">Option</span><span class="delimiter">[</span>Header.`Transfer-Encoding`<span class="delimiter">]</span>,
                 <a title="Option[org.http4s.Header.Content-Length]" id="org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).lengthHeader">lengthHeader</a>: <span title="Option[org.http4s.Header.Content-Length]">Option</span><span class="delimiter">[</span>Header.`Content-Length`<span class="delimiter">]</span>,
                 <a title="scalaz.concurrent.Task[org.http4s.Headers]" id="org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).trailer">trailer</a>: <span title="scalaz.concurrent.Task[org.http4s.Headers]">Task</span><span class="delimiter">[</span>Headers<span class="delimiter">]</span>,
                 <a title="org.http4s.util.StringWriter" id="org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).rr">rr</a>: <a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;StringWriter" title="org.http4s.util.StringWriter">StringWriter</a>,
                 <a title="Int" id="org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).minor">minor</a>: <span title="Int">Int</span>,
                 <a title="Boolean" id="org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).closeOnFinish">closeOnFinish</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <a href="util/ProcessWriter.scala.html#org.http4s.blaze.util;ProcessWriter" title="org.http4s.blaze.util.ProcessWriter">ProcessWriter</a> = <a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).lengthHeader" title="Option[org.http4s.Header.Content-Length]">lengthHeader</a> match <span class="delimiter">{</span>
    case Some<span class="delimiter">(</span><span title="org.http4s.Header.Content-Length">h</span><span class="delimiter">)</span> if <a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).bodyEncoding" title="Option[org.http4s.Header.Transfer-Encoding]">bodyEncoding</a>.<span title="=&gt; Boolean">isEmpty</span> =&gt;
      <a href="#org.http4s.blaze;Http1Stage" title="=&gt; org.log4s.Logger">logger</a>.trace<span title="(x$1: String)Unit" class="delimiter">(</span><span title="String(&quot;Using static encoder&quot;)" class="string">&quot;Using static encoder&quot;</span><span class="delimiter">)</span>

      <span class="comment">// add KeepAlive to Http 1.0 responses if the header isn't already present</span>
      if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).closeOnFinish" title="Boolean">closeOnFinish</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).minor" title="Int">minor</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).connectionHeader" title="Option[org.http4s.Header.Connection]">connectionHeader</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).rr" title="org.http4s.util.StringWriter">rr</a> <a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(8d31e5b642)" title="(s: String)rr.type">&lt;&lt;</a> <span title="String(&quot;Connection:keep-alive\r\n\r\n&quot;)" class="string">&quot;Connection:keep-alive\r\n\r\n&quot;</span>
      else <a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).rr" title="org.http4s.util.StringWriter">rr</a> <a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)rr.type">&lt;&lt;</a> <span title="Char('\r')" class="char">'\r'</span> <a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)rr.type">&lt;&lt;</a> <span title="Char('\n')" class="char">'\n'</span>

      val <span title="java.nio.ByteBuffer">b</span> = <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Array[Byte])java.nio.ByteBuffer">wrap</span><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).rr" title="org.http4s.util.StringWriter">rr</a>.<a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;StringWriter.result" title="()String">result</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.nio.charset.Charset)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.nio.charset.StandardCharsets.type">StandardCharsets</span>.<span title="java.nio.charset.Charset">US_ASCII</span><span class="delimiter">)</span><span class="delimiter">)</span>
      new <a href="StaticWriter.scala.html#org.http4s.blaze;StaticWriter" title="org.http4s.blaze.StaticWriter">StaticWriter</a><span class="delimiter">(</span><span title="java.nio.ByteBuffer">b</span>, <span title="org.http4s.Header.Content-Length">h</span>.<a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header;Content-Length.length" title="=&gt; Int">length</a>, this<span class="delimiter">)</span>

    case _ =&gt;  <span class="comment">// No Length designated for body or Transfer-Encoding included</span>
      if <span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).minor" title="Int">minor</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">// we are replying to a HTTP 1.0 request see if the length is reasonable</span>
        if <span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).closeOnFinish" title="Boolean">closeOnFinish</a><span class="delimiter">)</span> <span class="delimiter">{</span>  <span class="comment">// HTTP 1.0 uses a static encoder</span>
          <a href="#org.http4s.blaze;Http1Stage" title="=&gt; org.log4s.Logger">logger</a>.trace<span title="(x$1: String)Unit" class="delimiter">(</span><span title="String(&quot;Using static encoder&quot;)" class="string">&quot;Using static encoder&quot;</span><span class="delimiter">)</span>
          <a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).rr" title="org.http4s.util.StringWriter">rr</a> <a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)rr.type">&lt;&lt;</a> <span title="Char('\r')" class="char">'\r'</span> <a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)rr.type">&lt;&lt;</a> <span title="Char('\n')" class="char">'\n'</span>
          val <span title="java.nio.ByteBuffer">b</span> = <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Array[Byte])java.nio.ByteBuffer">wrap</span><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).rr" title="org.http4s.util.StringWriter">rr</a>.<a href="../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;StringWriter.result" title="()String">result</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.nio.charset.Charset)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.nio.charset.StandardCharsets.type">StandardCharsets</span>.<span title="java.nio.charset.Charset">US_ASCII</span><span class="delimiter">)</span><span class="delimiter">)</span>
          new <a href="StaticWriter.scala.html#org.http4s.blaze;StaticWriter" title="org.http4s.blaze.StaticWriter">StaticWriter</a><span class="delimiter">(</span><span title="java.nio.ByteBuffer">b</span>, -<span title="Int(-1)" class="int">1</span>, this<span class="delimiter">)</span>
        <span class="delimiter">}</span>
        else <span class="delimiter">{</span>  <span class="comment">// HTTP 1.0, but request was Keep-Alive.</span>
          <a href="#org.http4s.blaze;Http1Stage" title="=&gt; org.log4s.Logger">logger</a>.trace<span title="(x$1: String)Unit" class="delimiter">(</span><span title="String(&quot;Using static encoder without length&quot;)" class="string">&quot;Using static encoder without length&quot;</span><span class="delimiter">)</span>
          new <a href="util/CachingStaticWriter.scala.html#org.http4s.blaze.util;CachingStaticWriter" title="org.http4s.blaze.util.CachingStaticWriter">CachingStaticWriter</a><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).rr" title="org.http4s.util.StringWriter">rr</a>, this<span class="delimiter">)</span> <span class="comment">// will cache for a bit, then signal close if the body is long</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      else <span class="delimiter">{</span>
        <a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).bodyEncoding" title="Option[org.http4s.Header.Transfer-Encoding]">bodyEncoding</a> match <span class="delimiter">{</span> <span class="comment">// HTTP &gt;= 1.1 request without length. Will use a chunked encoder</span>
          case Some<span class="delimiter">(</span><span title="org.http4s.Header.Transfer-Encoding">h</span><span class="delimiter">)</span> =&gt; <span class="comment">// Signaling chunked means flush every chunk</span>
            if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><span title="org.http4s.Header.Transfer-Encoding">h</span>.<a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s.Header;Transfer-Encoding.hasChunked" title="=&gt; Boolean">hasChunked</a><span class="delimiter">)</span> <a href="#org.http4s.blaze;Http1Stage" title="=&gt; org.log4s.Logger">logger</a>.warn<span title="Unit" class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Unknown transfer encoding: \'&quot;)">Unknown transfer encoding: '$</span><span class="delimiter">{</span><span title="org.http4s.Header.Transfer-Encoding">h</span>.<a href="../../../../http4s-core/org/http4s/Header.scala.html#org.http4s;Header.value" title="=&gt; String">value</a><span class="delimiter">}</span><span title="String(&quot;\'. Defaulting to Chunked Encoding&quot;)" class="string">'. Defaulting to Chunked Encoding&quot;</span><span class="delimiter">)</span>
            new <a href="util/ChunkProcessWriter.scala.html#org.http4s.blaze.util;ChunkProcessWriter" title="org.http4s.blaze.util.ChunkProcessWriter">ChunkProcessWriter</a><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).rr" title="org.http4s.util.StringWriter">rr</a>, this, <a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).trailer" title="scalaz.concurrent.Task[org.http4s.Headers]">trailer</a><span class="delimiter">)</span>

          case <span title="None.type">None</span> =&gt;     <span class="comment">// use a cached chunk encoder for HTTP/1.1 without length of transfer encoding</span>
            <a href="#org.http4s.blaze;Http1Stage" title="=&gt; org.log4s.Logger">logger</a>.trace<span title="(x$1: String)Unit" class="delimiter">(</span><span title="String(&quot;Using Caching Chunk Encoder&quot;)" class="string">&quot;Using Caching Chunk Encoder&quot;</span><span class="delimiter">)</span>
            new <a href="util/CachingChunkWriter.scala.html#org.http4s.blaze.util;CachingChunkWriter" title="org.http4s.blaze.util.CachingChunkWriter">CachingChunkWriter</a><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).rr" title="org.http4s.util.StringWriter">rr</a>, this, <a href="#org.http4s.blaze;Http1Stage.getEncoder(7d809242e7).trailer" title="scalaz.concurrent.Task[org.http4s.Headers]">trailer</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  final protected def <a title="(buffer: java.nio.ByteBuffer)(org.http4s.EntityBody, () =&gt; scala.concurrent.Future[java.nio.ByteBuffer])" id="org.http4s.blaze;Http1Stage.collectBodyFromParser">collectBodyFromParser</a><span class="delimiter">(</span><a title="java.nio.ByteBuffer" id="org.http4s.blaze;Http1Stage.collectBodyFromParser.buffer">buffer</a>: <span title="java.nio.ByteBuffer">ByteBuffer</span><span class="delimiter">)</span>: <span title="(org.http4s.EntityBody, () =&gt; scala.concurrent.Future[java.nio.ByteBuffer])" class="delimiter">(</span>EntityBody, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Future<span class="delimiter">[</span>ByteBuffer<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.contentComplete" title="()Boolean">contentComplete</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.buffer" title="java.nio.ByteBuffer">buffer</a>.<span title="()Int">remaining</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#org.http4s.blaze.Http1Stage" title="org.http4s.blaze.Http1Stage.type">Http1Stage</a>.<a href="#org.http4s.blaze.Http1Stage.CachedEmptyBody" title="=&gt; (scalaz.stream.Process0[Nothing], () =&gt; scala.concurrent.Future[java.nio.ByteBuffer])">CachedEmptyBody</a>
      else <span title="(_1: scalaz.stream.Process0[Nothing], _2: () =&gt; scala.concurrent.Future[java.nio.ByteBuffer])(scalaz.stream.Process0[Nothing], () =&gt; scala.concurrent.Future[java.nio.ByteBuffer])" class="delimiter">(</span><a href="../../../../http4s-core/org/http4s/package.scala.html#org.http4s.package.EmptyBody" title="=&gt; scalaz.stream.Process0[Nothing]">EmptyBody</a>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: java.nio.ByteBuffer)scala.concurrent.Future[java.nio.ByteBuffer]">successful</span><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    else <span class="delimiter">{</span>
      @volatile var <a title="java.nio.ByteBuffer" id="org.http4s.blaze;Http1Stage.collectBodyFromParser.currentBuffer">currentBuffer</a> = <a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.buffer" title="java.nio.ByteBuffer">buffer</a>

      <span class="comment">// TODO: we need to work trailers into here somehow</span>
      val <a title="scalaz.concurrent.Task[scodec.bits.ByteVector]" id="org.http4s.blaze;Http1Stage.collectBodyFromParser.t">t</a> = <span title="scalaz.concurrent.Task.type">Task</span>.<span title="[A](register: (scalaz.\/[Throwable,A] =&gt; Unit) =&gt; Unit)scalaz.concurrent.Task[A]">async</span><span title="(register: (scalaz.\/[Throwable,scodec.bits.ByteVector] =&gt; Unit) =&gt; Unit)scalaz.concurrent.Task[scodec.bits.ByteVector]" class="delimiter">[</span><span title="scodec.bits.ByteVector">ByteVector</span><span class="delimiter">]</span><span class="delimiter">{</span> <a title="scalaz.\/[Throwable,scodec.bits.ByteVector] =&gt; Unit" id="org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.cb">cb</a> =&gt;
        if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#org.http4s.blaze;Http1Stage.contentComplete" title="()Boolean">contentComplete</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>

          def <a title="()Unit" id="org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.go">go</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = try <span class="delimiter">{</span>
            <a href="#org.http4s.blaze;Http1Stage.doParseContent" title="(buffer: java.nio.ByteBuffer)Option[java.nio.ByteBuffer]">doParseContent</a><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.currentBuffer" title="java.nio.ByteBuffer">currentBuffer</a><span class="delimiter">)</span> match <span class="delimiter">{</span>
              case Some<span class="delimiter">(</span><a title="java.nio.ByteBuffer" id="org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.go.result">result</a><span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.cb" title="(v1: scalaz.\/[Throwable,scodec.bits.ByteVector])Unit">cb</a><span class="delimiter">(</span><span title="(b: scodec.bits.ByteVector)scalaz.\/-[scodec.bits.ByteVector]">\/-</span><span class="delimiter">(</span><span title="(buffer: java.nio.ByteBuffer)scodec.bits.ByteVector">ByteVector</span><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.go.result" title="java.nio.ByteBuffer">result</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              case <span title="None.type">None</span> if <a href="#org.http4s.blaze;Http1Stage.contentComplete" title="()Boolean">contentComplete</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.cb" title="(v1: scalaz.\/[Throwable,scodec.bits.ByteVector])Unit">cb</a><span class="delimiter">(</span><span title="(a: scalaz.stream.Cause.Terminated)scalaz.-\/[scalaz.stream.Cause.Terminated]">-\/</span><span class="delimiter">(</span><span title="(cause: scalaz.stream.Cause)scalaz.stream.Cause.Terminated">Terminated</span><span class="delimiter">(</span><span title="scalaz.stream.Cause.End.type">End</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              case <span title="None.type">None</span> =&gt;
                <a href="#org.http4s.blaze;Http1Stage" title="(size: Int, timeout: scala.concurrent.duration.Duration)scala.concurrent.Future[java.nio.ByteBuffer]">channelRead</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(f: scala.util.Try[java.nio.ByteBuffer] =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)Unit">onComplete</span> <a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.go.$anonfun.x0$1" title="Unit" class="delimiter">{</a>
                  case Success<span class="delimiter">(</span><a title="java.nio.ByteBuffer" id="org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.go.$anonfun.b">b</a><span class="delimiter">)</span>   =&gt; <a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.currentBuffer" title="java.nio.ByteBuffer">currentBuffer</a> = <a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.go.$anonfun.b" title="java.nio.ByteBuffer">b</a>; <a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.go" title="()Unit">go</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="comment">// Need more data...</span>
                  case Failure<span class="delimiter">(</span><span title="org.http4s.blaze.pipeline.Command.EOF.type">EOF</span><span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.cb" title="(v1: scalaz.\/[Throwable,scodec.bits.ByteVector])Unit">cb</a><span class="delimiter">(</span><span title="(a: org.http4s.InvalidBodyException)scalaz.-\/[org.http4s.InvalidBodyException]">-\/</span><span class="delimiter">(</span><a href="../../../../http4s-core/org/http4s/InvalidBodyException.scala.html#org.http4s;InvalidBodyException" title="(msg: String)org.http4s.InvalidBodyException">InvalidBodyException</a><span class="delimiter">(</span><span title="String(&quot;Received premature EOF.&quot;)" class="string">&quot;Received premature EOF.&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                  case Failure<span class="delimiter">(</span><a title="Throwable" id="org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.go.$anonfun.t">t</a><span class="delimiter">)</span>   =&gt; <a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.cb" title="(v1: scalaz.\/[Throwable,scodec.bits.ByteVector])Unit">cb</a><span class="delimiter">(</span><span title="(a: Throwable)scalaz.-\/[Throwable]">-\/</span><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.go.$anonfun.t" title="Throwable">t</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> catch <span class="delimiter">{</span>
            case <span title="org.http4s.blaze.http.http_parser.BaseExceptions.ParserException">t</span>: <span title="org.http4s.blaze.http.http_parser.BaseExceptions.ParserException">ParserException</span> =&gt;
              <a href="#org.http4s.blaze;Http1Stage.fatalError" title="(t: Throwable, msg: String)Unit">fatalError</a><span class="delimiter">(</span><span title="org.http4s.blaze.http.http_parser.BaseExceptions.ParserException">t</span>, <span title="String(&quot;Error parsing request body&quot;)" class="string">&quot;Error parsing request body&quot;</span><span class="delimiter">)</span>
              <a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.cb" title="(v1: scalaz.\/[Throwable,scodec.bits.ByteVector])Unit">cb</a><span class="delimiter">(</span><span title="(a: org.http4s.InvalidBodyException)scalaz.-\/[org.http4s.InvalidBodyException]">-\/</span><span class="delimiter">(</span><a href="../../../../http4s-core/org/http4s/InvalidBodyException.scala.html#org.http4s;InvalidBodyException" title="(msg: String)org.http4s.InvalidBodyException">InvalidBodyException</a><span class="delimiter">(</span><span title="org.http4s.blaze.http.http_parser.BaseExceptions.ParserException">t</span>.<span title="()String">msg</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

            case <span title="Throwable">t</span>: <span title="Throwable">Throwable</span> =&gt;
              <a href="#org.http4s.blaze;Http1Stage.fatalError" title="(t: Throwable, msg: String)Unit">fatalError</a><span class="delimiter">(</span><span title="Throwable">t</span>, <span title="String(&quot;Error collecting body&quot;)" class="string">&quot;Error collecting body&quot;</span><span class="delimiter">)</span>
              <a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.cb" title="(v1: scalaz.\/[Throwable,scodec.bits.ByteVector])Unit">cb</a><span class="delimiter">(</span><span title="(a: Throwable)scalaz.-\/[Throwable]">-\/</span><span class="delimiter">(</span><span title="Throwable">t</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.go" title="()Unit">go</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        else <a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.t.$anonfun.cb" title="(v1: scalaz.\/[Throwable,scodec.bits.ByteVector])Unit">cb</a><span class="delimiter">(</span><span title="(a: scalaz.stream.Cause.Terminated)scalaz.-\/[scalaz.stream.Cause.Terminated]">-\/</span><span class="delimiter">(</span><span title="(cause: scalaz.stream.Cause)scalaz.stream.Cause.Terminated">Terminated</span><span class="delimiter">(</span><span title="scalaz.stream.Cause.End.type">End</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span title="(_1: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector], _2: () =&gt; scala.concurrent.Future[java.nio.ByteBuffer])(scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector], () =&gt; scala.concurrent.Future[java.nio.ByteBuffer])" class="delimiter">(</span><span title="(f: scalaz.concurrent.Task[scodec.bits.ByteVector])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">repeatEval</span><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.t" title="scalaz.concurrent.Task[scodec.bits.ByteVector]">t</a><span class="delimiter">)</span>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze;Http1Stage.drainBody" title="(buffer: java.nio.ByteBuffer)scala.concurrent.Future[java.nio.ByteBuffer]">drainBody</a><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.collectBodyFromParser.currentBuffer" title="java.nio.ByteBuffer">currentBuffer</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Called when a fatal error has occurred
    * The method logs an error and shuts down the stage, sending the error outbound
    * @param t
    * @param msg
    */</span>
  protected def <a title="(t: Throwable, msg: String)Unit" id="org.http4s.blaze;Http1Stage.fatalError">fatalError</a><span class="delimiter">(</span><a title="Throwable" id="org.http4s.blaze;Http1Stage.fatalError.t">t</a>: <span title="Throwable">Throwable</span>, <a title="String" id="org.http4s.blaze;Http1Stage.fatalError$default$2">msg</a>: <span title="String">String</span> = <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#org.http4s.blaze;Http1Stage" title="=&gt; org.log4s.Logger">logger</a>.error<span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.fatalError.t" title="Throwable">t</a><span class="delimiter">)</span><span title="Unit" class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Fatal Error: &quot;)">Fatal Error: $</span><a href="#org.http4s.blaze;Http1Stage.fatalError$default$2" title="String">msg</a><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
    <a href="#org.http4s.blaze;Http1Stage" title="()Unit">stageShutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#org.http4s.blaze;Http1Stage" title="(cmd: org.http4s.blaze.pipeline.Command.OutboundCommand)Unit">sendOutboundCommand</a><span class="delimiter">(</span><span title="org.http4s.blaze.pipeline.Command.type">Command</span>.<span title="(e: Throwable)org.http4s.blaze.pipeline.Command.Error">Error</span><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.fatalError.t" title="Throwable">t</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Cleans out any remaining body from the parser */</span>
  final protected def <a title="(buffer: java.nio.ByteBuffer)scala.concurrent.Future[java.nio.ByteBuffer]" id="org.http4s.blaze;Http1Stage.drainBody">drainBody</a><span class="delimiter">(</span><a title="java.nio.ByteBuffer" id="org.http4s.blaze;Http1Stage.drainBody.buffer">buffer</a>: <span title="java.nio.ByteBuffer">ByteBuffer</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[java.nio.ByteBuffer]">Future</span><span class="delimiter">[</span>ByteBuffer<span class="delimiter">]</span> = <span class="delimiter">{</span>
    if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#org.http4s.blaze;Http1Stage.contentComplete" title="()Boolean">contentComplete</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      while<span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#org.http4s.blaze;Http1Stage.contentComplete" title="()Boolean">contentComplete</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#org.http4s.blaze;Http1Stage.doParseContent" title="(buffer: java.nio.ByteBuffer)Option[java.nio.ByteBuffer]">doParseContent</a><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.drainBody.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <a href="#org.http4s.blaze;Http1Stage.drainBody.while$1" title="Unit" class="delimiter">{</a> <span class="comment">/* we just discard the results */</span> <span class="delimiter">}</span>

      if <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#org.http4s.blaze;Http1Stage.contentComplete" title="()Boolean">contentComplete</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#org.http4s.blaze;Http1Stage" title="(size: Int, timeout: scala.concurrent.duration.Duration)scala.concurrent.Future[java.nio.ByteBuffer]">channelRead</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(f: java.nio.ByteBuffer =&gt; scala.concurrent.Future[java.nio.ByteBuffer])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[java.nio.ByteBuffer]">flatMap</span><a href="#org.http4s.blaze;Http1Stage.ec" title="=&gt; scala.concurrent.ExecutionContext" class="delimiter">(</a><a title="java.nio.ByteBuffer" id="org.http4s.blaze;Http1Stage.drainBody.$anonfun.newBuffer">newBuffer</a> =&gt; <a href="#org.http4s.blaze;Http1Stage.drainBody" title="(buffer: java.nio.ByteBuffer)scala.concurrent.Future[java.nio.ByteBuffer]">drainBody</a><span class="delimiter">(</span><span title="(oldbuff: java.nio.ByteBuffer, newbuff: java.nio.ByteBuffer)java.nio.ByteBuffer">concatBuffers</span><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.drainBody.buffer" title="java.nio.ByteBuffer">buffer</a>, <a href="#org.http4s.blaze;Http1Stage.drainBody.$anonfun.newBuffer" title="java.nio.ByteBuffer">newBuffer</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      else <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: java.nio.ByteBuffer)scala.concurrent.Future[java.nio.ByteBuffer]">successful</span><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.drainBody.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    else <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: java.nio.ByteBuffer)scala.concurrent.Future[java.nio.ByteBuffer]">successful</span><span class="delimiter">(</span><a href="#org.http4s.blaze;Http1Stage.drainBody.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

private object <a title="org.http4s.blaze.Http1Stage.type" id="org.http4s.blaze.Http1Stage">Http1Stage</a> <a href="#org.http4s.blaze.Http1Stage" title="org.http4s.blaze.Http1Stage.type" class="delimiter">{</a>
  val <a title="(scalaz.stream.Process0[Nothing], () =&gt; scala.concurrent.Future[java.nio.ByteBuffer])" id="org.http4s.blaze.Http1Stage.CachedEmptyBody">CachedEmptyBody</a> = <span class="delimiter">{</span>
    val <a title="scala.concurrent.Future[java.nio.ByteBuffer]" id="org.http4s.blaze.Http1Stage.CachedEmptyBody.f">f</a> = <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: java.nio.ByteBuffer)scala.concurrent.Future[java.nio.ByteBuffer]">successful</span><span class="delimiter">(</span><span title="=&gt; java.nio.ByteBuffer">emptyBuffer</span><span class="delimiter">)</span>
    <span title="(_1: scalaz.stream.Process0[Nothing], _2: () =&gt; scala.concurrent.Future[java.nio.ByteBuffer])(scalaz.stream.Process0[Nothing], () =&gt; scala.concurrent.Future[java.nio.ByteBuffer])" class="delimiter">(</span><a href="../../../../http4s-core/org/http4s/package.scala.html#org.http4s.package.EmptyBody" title="=&gt; scalaz.stream.Process0[Nothing]">EmptyBody</a>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze.Http1Stage.CachedEmptyBody.f" title="scala.concurrent.Future[java.nio.ByteBuffer]">f</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
