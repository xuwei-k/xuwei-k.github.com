<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>http4s-blazecore/org/http4s/blaze/util/ChunkProcessWriter.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
package org.http4s.blaze.util

import java.nio.ByteBuffer
import java.nio.charset.StandardCharsets

import org.http4s.Headers
import org.http4s.blaze.pipeline.TailStage
import org.http4s.util.StringWriter

import scodec.bits.ByteVector

import scala.concurrent.<span class="delimiter">{</span>ExecutionContext, Future, Promise<span class="delimiter">}</span>
import scalaz.concurrent.Task
import scalaz.<span class="delimiter">{</span>-\/, \/-<span class="delimiter">}</span>

class <a title="class ChunkProcessWriter extends AnyRef with org.http4s.blaze.util.ProcessWriter" id="org.http4s.blaze.util;ChunkProcessWriter">ChunkProcessWriter</a><a href="#org.http4s.blaze.util;ChunkProcessWriter" title="org.http4s.blaze.util.ChunkProcessWriter" class="delimiter">(</a>private var <a title="org.http4s.util.StringWriter" id="org.http4s.blaze.util;ChunkProcessWriter.headers">headers</a>: <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;StringWriter" title="org.http4s.util.StringWriter">StringWriter</a>,
                         <a title="org.http4s.blaze.pipeline.TailStage[java.nio.ByteBuffer]" id="org.http4s.blaze.util;ChunkProcessWriter.pipe">pipe</a>: <span title="org.http4s.blaze.pipeline.TailStage[java.nio.ByteBuffer]">TailStage</span><span class="delimiter">[</span>ByteBuffer<span class="delimiter">]</span>,
                         <a title="scalaz.concurrent.Task[org.http4s.Headers]" id="org.http4s.blaze.util;ChunkProcessWriter.trailer">trailer</a>: <span title="scalaz.concurrent.Task[org.http4s.Headers]">Task</span><span class="delimiter">[</span>Headers<span class="delimiter">]</span><span class="delimiter">)</span>
                         <span class="delimiter">(</span>implicit val <a title="scala.concurrent.ExecutionContext" id="org.http4s.blaze.util;ChunkProcessWriter.ec">ec</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span><span class="delimiter">)</span> extends <a href="ProcessWriter.scala.html#org.http4s.blaze.util;ProcessWriter" title="org.http4s.blaze.util.ProcessWriter">ProcessWriter</a> <span class="delimiter">{</span>

  import org.http4s.blaze.util.<a href="#org.http4s.blaze.util.ChunkProcessWriter" title="org.http4s.blaze.util.ChunkProcessWriter.type">ChunkProcessWriter</a>._

  private def <a title="=&gt; java.nio.ByteBuffer" id="org.http4s.blaze.util;ChunkProcessWriter.CRLF">CRLF</a> = <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Array[Byte])java.nio.ByteBuffer">wrap</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util.ChunkProcessWriter.CRLFBytes" title="=&gt; Array[Byte]">CRLFBytes</a><span class="delimiter">)</span>.<span title="()java.nio.ByteBuffer">asReadOnlyBuffer</span><span class="delimiter">(</span><span class="delimiter">)</span>

  protected def <a title="(chunk: scodec.bits.ByteVector, flush: Boolean)scala.concurrent.Future[Unit]" id="org.http4s.blaze.util;ChunkProcessWriter.writeBodyChunk">writeBodyChunk</a><span class="delimiter">(</span><a title="scodec.bits.ByteVector" id="org.http4s.blaze.util;ChunkProcessWriter.writeBodyChunk.chunk">chunk</a>: <span title="scodec.bits.ByteVector">ByteVector</span>, <a title="Boolean" id="org.http4s.blaze.util;ChunkProcessWriter.writeBodyChunk.flush">flush</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Unit]">Future</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#org.http4s.blaze.util;ChunkProcessWriter.pipe" title="org.http4s.blaze.pipeline.TailStage[java.nio.ByteBuffer]">pipe</a>.<span title="(data: Seq[java.nio.ByteBuffer])scala.concurrent.Future[Unit]">channelWrite</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.encodeChunk" title="(chunk: scodec.bits.ByteVector, last: List[java.nio.ByteBuffer])List[java.nio.ByteBuffer]">encodeChunk</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeBodyChunk.chunk" title="scodec.bits.ByteVector">chunk</a>, <span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  protected def <a title="(chunk: scodec.bits.ByteVector)scala.concurrent.Future[Unit]" id="org.http4s.blaze.util;ChunkProcessWriter.writeEnd">writeEnd</a><span class="delimiter">(</span><a title="scodec.bits.ByteVector" id="org.http4s.blaze.util;ChunkProcessWriter.writeEnd.chunk">chunk</a>: <span title="scodec.bits.ByteVector">ByteVector</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Unit]">Future</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span> = <span class="delimiter">{</span>
    def <a title="=&gt; scala.concurrent.Future[Unit]" id="org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer">writeTrailer</a> = <span class="delimiter">{</span>
      val <a title="scala.concurrent.Promise[Unit]" id="org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.promise">promise</a> = <span title="[T]()scala.concurrent.Promise[T]">Promise</span><span title="()scala.concurrent.Promise[Unit]" class="delimiter">[</span><span title="Unit">Unit</span><span class="delimiter">]</span>
      <a href="#org.http4s.blaze.util;ChunkProcessWriter.trailer" title="scalaz.concurrent.Task[org.http4s.Headers]">trailer</a>.<span title="(f: org.http4s.Headers =&gt; java.nio.ByteBuffer)scalaz.concurrent.Task[java.nio.ByteBuffer]">map</span> <span class="delimiter">{</span> <a title="org.http4s.Headers" id="org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.trailerHeaders">trailerHeaders</a> =&gt;
        if <span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.trailerHeaders" title="org.http4s.Headers">trailerHeaders</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          val <a title="org.http4s.util.StringWriter" id="org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.rr">rr</a> = new <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;StringWriter" title="org.http4s.util.StringWriter">StringWriter</a><span class="delimiter">(</span><span title="Int(256)" class="int">256</span><span class="delimiter">)</span>
          <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.rr" title="org.http4s.util.StringWriter">rr</a> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)rr.type">&lt;&lt;</a> <span title="Char('0')" class="char">'0'</span> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)rr.type">&lt;&lt;</a> <span title="Char('\r')" class="char">'\r'</span> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)rr.type">&lt;&lt;</a> <span title="Char('\n')" class="char">'\n'</span>             <span class="comment">// Last chunk</span>
          <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.trailerHeaders" title="org.http4s.Headers">trailerHeaders</a>.<a href="../../../../../http4s-core/org/http4s/Headers.scala.html#org.http4s;Headers.foreach" title="(f: org.http4s.Header =&gt; org.http4s.util.StringWriter)Unit">foreach</a><span class="delimiter">(</span> <a title="org.http4s.Header" id="org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.$anonfun.h">h</a> =&gt;  <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.rr" title="org.http4s.util.StringWriter">rr</a> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(8d31e5b642)" title="(s: String)rr.type">&lt;&lt;</a> <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.$anonfun.h" title="org.http4s.Header">h</a>.<a href="../../../../../http4s-core/org/http4s/Header.scala.html#org.http4s;Header.name" title="=&gt; org.http4s.util.CaseInsensitiveString">name</a>.<a href="../../../../../http4s-core/org/http4s/util/CaseInsensitiveString.scala.html#org.http4s.util;CaseInsensitiveString.toString" title="()String">toString</a> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(8d31e5b642)" title="(s: String)rr.type">&lt;&lt;</a> <span title="String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(98e2fb2962)" title="(r: org.http4s.Header)(implicit evidence$3: org.http4s.util.Renderer[org.http4s.Header])rr.type">&lt;&lt;</a> <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.$anonfun.h" title="org.http4s.Header">h</a> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)rr.type">&lt;&lt;</a> <span title="Char('\r')" class="char">'\r'</span> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)rr.type">&lt;&lt;</a> <span title="Char('\n')" class="char">'\n'</span><span class="delimiter">)</span>   <span class="comment">// trailers</span>
          <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.rr" title="org.http4s.util.StringWriter">rr</a> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)rr.type">&lt;&lt;</a> <span title="Char('\r')" class="char">'\r'</span> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(d41d751f45)" title="(char: Char)rr.type">&lt;&lt;</a> <span title="Char('\n')" class="char">'\n'</span>          <span class="comment">// end of chunks</span>
          <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Array[Byte])java.nio.ByteBuffer">wrap</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.rr" title="org.http4s.util.StringWriter">rr</a>.<a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;StringWriter.result" title="()String">result</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.nio.charset.Charset)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.nio.charset.StandardCharsets.type">StandardCharsets</span>.<span title="java.nio.charset.Charset">US_ASCII</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> else <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Array[Byte])java.nio.ByteBuffer">wrap</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util.ChunkProcessWriter.ChunkEndBytes" title="=&gt; Array[Byte]">ChunkEndBytes</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>.<span title="(f: scalaz.\/[Throwable,java.nio.ByteBuffer] =&gt; Unit)Unit">runAsync</span> <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.x0$1" title="Unit" class="delimiter">{</a>
        case \/-<span class="delimiter">(</span><a title="java.nio.ByteBuffer" id="org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.buffer">buffer</a><span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.promise" title="scala.concurrent.Promise[Unit]">promise</a>.<span title="(other: scala.concurrent.Future[Unit])promise.type">completeWith</span><span title="Unit" class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.pipe" title="org.http4s.blaze.pipeline.TailStage[java.nio.ByteBuffer]">pipe</a>.<span title="(data: java.nio.ByteBuffer)scala.concurrent.Future[Unit]">channelWrite</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.buffer" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span><span class="delimiter">)</span>
        case -\/<span class="delimiter">(</span><a title="Throwable" id="org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.t">t</a><span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.promise" title="scala.concurrent.Promise[Unit]">promise</a>.<span title="(cause: Throwable)promise.type">failure</span><span title="Unit" class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.$anonfun.t" title="Throwable">t</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer.promise" title="scala.concurrent.Promise[Unit]">promise</a>.<span title="=&gt; scala.concurrent.Future[Unit]">future</span>
    <span class="delimiter">}</span>

    if <span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.headers" title="=&gt; org.http4s.util.StringWriter">headers</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>  <span class="comment">// This is the first write, so we can add a body length instead of chunking</span>
      val <a title="org.http4s.util.StringWriter" id="org.http4s.blaze.util;ChunkProcessWriter.writeEnd.h">h</a> = <a href="#org.http4s.blaze.util;ChunkProcessWriter.headers" title="=&gt; org.http4s.util.StringWriter">headers</a>
      <a href="#org.http4s.blaze.util;ChunkProcessWriter.headers" title="(x$1: org.http4s.util.StringWriter)Unit">headers</a> = null

      if <span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.chunk" title="scodec.bits.ByteVector">chunk</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        val <a title="java.nio.ByteBuffer" id="org.http4s.blaze.util;ChunkProcessWriter.writeEnd.body">body</a> = <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.chunk" title="scodec.bits.ByteVector">chunk</a>.<span title="=&gt; java.nio.ByteBuffer">toByteBuffer</span>
        <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.h" title="org.http4s.util.StringWriter">h</a> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(8d31e5b642)" title="(s: String)h.type">&lt;&lt;</a> <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Content-Length: &quot;)">Content-Length: $</span><span class="delimiter">{</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.body" title="java.nio.ByteBuffer">body</a>.<span title="()Int">remaining</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">}</span><span title="String(&quot;\\r\\n\\r\\n&quot;)" class="string">\r\n\r\n&quot;</span>
        
        <span class="comment">// Trailers are optional, so dropping because we have no body.</span>
        val <span title="java.nio.ByteBuffer">hbuff</span> = <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Array[Byte])java.nio.ByteBuffer">wrap</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.h" title="org.http4s.util.StringWriter">h</a>.<a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;StringWriter.result" title="()String">result</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.nio.charset.Charset)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.nio.charset.StandardCharsets.type">StandardCharsets</span>.<span title="java.nio.charset.Charset">US_ASCII</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#org.http4s.blaze.util;ChunkProcessWriter.pipe" title="org.http4s.blaze.pipeline.TailStage[java.nio.ByteBuffer]">pipe</a>.<span title="(data: Seq[java.nio.ByteBuffer])scala.concurrent.Future[Unit]">channelWrite</span><span class="delimiter">(</span><span title="java.nio.ByteBuffer">hbuff</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.x$2" title="(x: java.nio.ByteBuffer)List[java.nio.ByteBuffer]">::</a><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.body" title="java.nio.ByteBuffer">body</a><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.x$1" title="(x: java.nio.ByteBuffer)List[java.nio.ByteBuffer]">::</a><span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      else <span class="delimiter">{</span>
        <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.h" title="org.http4s.util.StringWriter">h</a> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(8d31e5b642)" title="(s: String)h.type">&lt;&lt;</a> <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Content-Length: 0\\r\\n\\r\\n&quot;)" class="string">Content-Length: 0\r\n\r\n&quot;</span>
        val <span title="java.nio.ByteBuffer">hbuff</span> = <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Array[Byte])java.nio.ByteBuffer">wrap</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.h" title="org.http4s.util.StringWriter">h</a>.<a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;StringWriter.result" title="()String">result</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.nio.charset.Charset)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.nio.charset.StandardCharsets.type">StandardCharsets</span>.<span title="java.nio.charset.Charset">US_ASCII</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#org.http4s.blaze.util;ChunkProcessWriter.pipe" title="org.http4s.blaze.pipeline.TailStage[java.nio.ByteBuffer]">pipe</a>.<span title="(data: java.nio.ByteBuffer)scala.concurrent.Future[Unit]">channelWrite</span><span class="delimiter">(</span><span title="java.nio.ByteBuffer">hbuff</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> else <span class="delimiter">{</span>
      if <span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.chunk" title="scodec.bits.ByteVector">chunk</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeBodyChunk" title="(chunk: scodec.bits.ByteVector, flush: Boolean)scala.concurrent.Future[Unit]">writeBodyChunk</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.chunk" title="scodec.bits.ByteVector">chunk</a>, true<span class="delimiter">)</span>.<span title="(f: Unit =&gt; scala.concurrent.Future[Unit])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[Unit]">flatMap</span> <a href="#org.http4s.blaze.util;ChunkProcessWriter.ec" title="=&gt; scala.concurrent.ExecutionContext" class="delimiter">{</a> <a title="Unit" id="org.http4s.blaze.util;ChunkProcessWriter.writeEnd.$anonfun.x$3">_</a> =&gt; <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer" title="=&gt; scala.concurrent.Future[Unit]">writeTrailer</a> <span class="delimiter">}</span>
      else <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeEnd.writeTrailer" title="=&gt; scala.concurrent.Future[Unit]">writeTrailer</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(length: Int)java.nio.ByteBuffer" id="org.http4s.blaze.util;ChunkProcessWriter.writeLength">writeLength</a><span class="delimiter">(</span><a title="Int" id="org.http4s.blaze.util;ChunkProcessWriter.writeLength.length">length</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="java.nio.ByteBuffer">ByteBuffer</span> = <span class="delimiter">{</span>
    val <a title="Array[Byte]" id="org.http4s.blaze.util;ChunkProcessWriter.writeLength.bytes">bytes</a> = <span title="Integer.type">Integer</span>.<span title="(x$1: Int)String">toHexString</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeLength.length" title="Int">length</a><span class="delimiter">)</span>.<span title="(x$1: java.nio.charset.Charset)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.nio.charset.StandardCharsets.type">StandardCharsets</span>.<span title="java.nio.charset.Charset">US_ASCII</span><span class="delimiter">)</span>
    val <a title="java.nio.ByteBuffer" id="org.http4s.blaze.util;ChunkProcessWriter.writeLength.b">b</a> = <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Int)java.nio.ByteBuffer">allocate</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeLength.bytes" title="Array[Byte]">bytes</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">+</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span>
    <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeLength.b" title="java.nio.ByteBuffer">b</a>.<span title="(x$1: Array[Byte])java.nio.ByteBuffer">put</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.writeLength.bytes" title="Array[Byte]">bytes</a><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])java.nio.ByteBuffer">put</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util.ChunkProcessWriter.CRLFBytes" title="=&gt; Array[Byte]">CRLFBytes</a><span class="delimiter">)</span>.<span title="()java.nio.Buffer">flip</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeLength.b" title="java.nio.ByteBuffer">b</a>
  <span class="delimiter">}</span>

  private def <a title="(chunk: scodec.bits.ByteVector, last: List[java.nio.ByteBuffer])List[java.nio.ByteBuffer]" id="org.http4s.blaze.util;ChunkProcessWriter.encodeChunk">encodeChunk</a><span class="delimiter">(</span><a title="scodec.bits.ByteVector" id="org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.chunk">chunk</a>: <span title="scodec.bits.ByteVector">ByteVector</span>, <a title="List[java.nio.ByteBuffer]" id="org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.last">last</a>: <span title="List[java.nio.ByteBuffer]">List</span><span class="delimiter">[</span>ByteBuffer<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="List[java.nio.ByteBuffer]">List</span><span class="delimiter">[</span>ByteBuffer<span class="delimiter">]</span> = <span class="delimiter">{</span>
    val list = <a href="#org.http4s.blaze.util;ChunkProcessWriter.writeLength" title="(length: Int)java.nio.ByteBuffer">writeLength</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.chunk" title="scodec.bits.ByteVector">chunk</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.list.x$6" title="List[java.nio.ByteBuffer]" id="org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.list">::</a><a href="#org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.chunk" title="scodec.bits.ByteVector">chunk</a>.<span title="=&gt; java.nio.ByteBuffer">toByteBuffer</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.list.x$5" title="(x: java.nio.ByteBuffer)List[java.nio.ByteBuffer]">::</a><a href="#org.http4s.blaze.util;ChunkProcessWriter.CRLF" title="=&gt; java.nio.ByteBuffer">CRLF</a><a href="#org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.list.x$4" title="(x: java.nio.ByteBuffer)List[java.nio.ByteBuffer]">::</a><a href="#org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.last" title="List[java.nio.ByteBuffer]">last</a>
    if <span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.headers" title="=&gt; org.http4s.util.StringWriter">headers</a> <span title="(x$1: Any)Boolean">!=</span> null<span class="delimiter">)</span> <span class="delimiter">{</span>
      val <a title="org.http4s.util.StringWriter" id="org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.i">i</a> = <a href="#org.http4s.blaze.util;ChunkProcessWriter.headers" title="=&gt; org.http4s.util.StringWriter">headers</a>
      <a href="#org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.i" title="org.http4s.util.StringWriter">i</a> <a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;Writer.<<(8d31e5b642)" title="(s: String)i.type">&lt;&lt;</a> <span title="String(&quot;Transfer-Encoding: chunked\r\n\r\n&quot;)" class="string">&quot;Transfer-Encoding: chunked\r\n\r\n&quot;</span>
      val <a title="java.nio.ByteBuffer" id="org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.b">b</a> = <span title="java.nio.ByteBuffer.type">ByteBuffer</span>.<span title="(x$1: Array[Byte])java.nio.ByteBuffer">wrap</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.i" title="org.http4s.util.StringWriter">i</a>.<a href="../../../../../http4s-core/org/http4s/util/Renderable.scala.html#org.http4s.util;StringWriter.result" title="()String">result</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.nio.charset.Charset)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.nio.charset.StandardCharsets.type">StandardCharsets</span>.<span title="java.nio.charset.Charset">US_ASCII</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#org.http4s.blaze.util;ChunkProcessWriter.headers" title="(x$1: org.http4s.util.StringWriter)Unit">headers</a> = null
      <a href="#org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.b" title="java.nio.ByteBuffer">b</a><a href="#org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.x$7" title="(x: java.nio.ByteBuffer)List[java.nio.ByteBuffer]">::</a><a href="#org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.list" title="List[java.nio.ByteBuffer]">list</a>
    <span class="delimiter">}</span> else <a href="#org.http4s.blaze.util;ChunkProcessWriter.encodeChunk.list" title="List[java.nio.ByteBuffer]">list</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

object <a title="org.http4s.blaze.util.ChunkProcessWriter.type" id="org.http4s.blaze.util.ChunkProcessWriter">ChunkProcessWriter</a> <a href="#org.http4s.blaze.util.ChunkProcessWriter" title="org.http4s.blaze.util.ChunkProcessWriter.type" class="delimiter">{</a>
  private val <a title="Array[Byte]" id="org.http4s.blaze.util.ChunkProcessWriter.CRLFBytes">CRLFBytes</a> = <span title="String(&quot;\r\n&quot;)" class="string">&quot;\r\n&quot;</span>.<span title="(x$1: java.nio.charset.Charset)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.nio.charset.StandardCharsets.type">StandardCharsets</span>.<span title="java.nio.charset.Charset">US_ASCII</span><span class="delimiter">)</span>
  private val <a title="Array[Byte]" id="org.http4s.blaze.util.ChunkProcessWriter.ChunkEndBytes">ChunkEndBytes</a> = <span title="String(&quot;0\r\n\r\n&quot;)" class="string">&quot;0\r\n\r\n&quot;</span>.<span title="(x$1: java.nio.charset.Charset)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.nio.charset.StandardCharsets.type">StandardCharsets</span>.<span title="java.nio.charset.Charset">US_ASCII</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
