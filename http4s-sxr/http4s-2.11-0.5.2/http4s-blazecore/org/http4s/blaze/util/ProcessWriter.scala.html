<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>http4s-blazecore/org/http4s/blaze/util/ProcessWriter.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
package org.http4s.blaze.util

import scodec.bits.ByteVector

import scala.concurrent.<span class="delimiter">{</span>ExecutionContext, Future<span class="delimiter">}</span>
import scala.util.<span class="delimiter">{</span>Failure, Success, Try<span class="delimiter">}</span>
import scalaz.concurrent.Task
import scalaz.stream.<span class="delimiter">{</span>Cause, Process<span class="delimiter">}</span>
import scalaz.stream.<span title="scalaz.stream.Process.type">Process</span>._
import scalaz.stream.<span title="scalaz.stream.Cause.type">Cause</span>._
import scalaz.<span class="delimiter">{</span>-\/, \/, \/-<span class="delimiter">}</span>

trait <a title="trait ProcessWriter extends AnyRef" id="org.http4s.blaze.util;ProcessWriter">ProcessWriter</a> <span title="Unit" class="delimiter">{</span>

  implicit protected def <a title="=&gt; scala.concurrent.ExecutionContext" id="org.http4s.blaze.util;ProcessWriter.ec">ec</a>: <span title="scala.concurrent.ExecutionContext">ExecutionContext</span>

  type <a title="scalaz.\/[Throwable,Unit] =&gt; Unit" id="org.http4s.blaze.util;ProcessWriter;CBType">CBType</a> = Throwable \/ Unit =&gt; Unit

  <span class="comment">/** write a ByteVector to the wire
    * If a request is cancelled, or the stream is closed this method should
    * return a failed Future with Cancelled as the exception
    *
    * @param chunk BodyChunk to write to wire
    * @return a future letting you know when its safe to continue
    */</span>
  protected def <a title="(chunk: scodec.bits.ByteVector, flush: Boolean)scala.concurrent.Future[Unit]" id="org.http4s.blaze.util;ProcessWriter.writeBodyChunk">writeBodyChunk</a><span class="delimiter">(</span><a title="scodec.bits.ByteVector" id="org.http4s.blaze.util;ProcessWriter.writeBodyChunk.chunk">chunk</a>: <span title="scodec.bits.ByteVector">ByteVector</span>, <a title="Boolean" id="org.http4s.blaze.util;ProcessWriter.writeBodyChunk.flush">flush</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Unit]">Future</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span>

  <span class="comment">/** Write the ending chunk and, in chunked encoding, a trailer to the wire.
    * If a request is cancelled, or the stream is closed this method should
    * return a failed Future with Cancelled as the exception
    *
    * @param chunk BodyChunk to write to wire
    * @return a future letting you know when its safe to continue
    */</span>
  protected def <a title="(chunk: scodec.bits.ByteVector)scala.concurrent.Future[Unit]" id="org.http4s.blaze.util;ProcessWriter.writeEnd">writeEnd</a><span class="delimiter">(</span><a title="scodec.bits.ByteVector" id="org.http4s.blaze.util;ProcessWriter.writeEnd.chunk">chunk</a>: <span title="scodec.bits.ByteVector">ByteVector</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Unit]">Future</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span>

  def <a title="()Boolean" id="org.http4s.blaze.util;ProcessWriter.requireClose">requireClose</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = false

  <span class="comment">/** Called in the event of an Await failure to alert the pipeline to cleanup */</span>
  protected def <a title="()scala.concurrent.Future[Unit]" id="org.http4s.blaze.util;ProcessWriter.exceptionFlush">exceptionFlush</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="scala.concurrent.Future[Unit]">Future</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span> = <span title="scala.concurrent.Future.type">Future</span>.<span title="(result: Unit)scala.concurrent.Future[Unit]">successful</span><span class="delimiter">(</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/** Creates a Task that writes the contents the Process to the output.
    * Cancelled exceptions fall through to the Task cb
    *
    * @param p Process[Task, ByteVector] to write out
    * @return the Task which when run will unwind the Process
    */</span>
  def <a title="(p: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])scalaz.concurrent.Task[Unit]" id="org.http4s.blaze.util;ProcessWriter.writeProcess">writeProcess</a><span class="delimiter">(</span><a title="scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]" id="org.http4s.blaze.util;ProcessWriter.writeProcess.p">p</a>: <span title="scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">Process</span><span class="delimiter">[</span>Task, ByteVector<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scalaz.concurrent.Task[Unit]">Task</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span> = <span title="scalaz.concurrent.Task.type">Task</span>.<span title="(register: (scalaz.\/[Throwable,Unit] =&gt; Unit) =&gt; Unit)scalaz.concurrent.Task[Unit]">async</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go" title="(p: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector], stack: Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]], cb: ProcessWriter.this.CBType)Unit">go</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.writeProcess.p" title="scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">p</a>, <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span>, <a href="#org.http4s.blaze.util;ProcessWriter.writeProcess.$anonfun.x$1" title="scalaz.\/[Throwable,Unit] =&gt; Unit">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

  final private def <a title="(p: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector], stack: Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]], cb: ProcessWriter.this.CBType)Unit" id="org.http4s.blaze.util;ProcessWriter.go">go</a><span class="delimiter">(</span><a title="scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]" id="org.http4s.blaze.util;ProcessWriter.go.p">p</a>: <span title="scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">Process</span><span class="delimiter">[</span>Task, ByteVector<span class="delimiter">]</span>, <a title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]" id="org.http4s.blaze.util;ProcessWriter.go.stack">stack</a>: <span title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">Vector</span><span class="delimiter">[</span>Cause =&gt; Trampoline<span class="delimiter">[</span>Process<span class="delimiter">[</span>Task,ByteVector<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>, <a title="ProcessWriter.this.CBType" id="org.http4s.blaze.util;ProcessWriter.go.cb">cb</a>: <span title="ProcessWriter.this.CBType">CBType</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#org.http4s.blaze.util;ProcessWriter.go.p" title="scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">p</a> match <span class="delimiter">{</span>
    case Emit<span class="delimiter">(</span><span title="Seq[scodec.bits.ByteVector]">seq</span><span class="delimiter">)</span> if <span title="Seq[scodec.bits.ByteVector]">seq</span>.<span title="=&gt; Boolean">isEmpty</span> =&gt;
      if <span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#org.http4s.blaze.util;ProcessWriter.writeEnd" title="(chunk: scodec.bits.ByteVector)scala.concurrent.Future[Unit]">writeEnd</a><span class="delimiter">(</span><span title="scodec.bits.ByteVector.type">ByteVector</span>.<span title="=&gt; scodec.bits.ByteVector">empty</span><span class="delimiter">)</span>.<span title="(f: scala.util.Try[Unit] =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)Unit">onComplete</span><a href="#org.http4s.blaze.util;ProcessWriter.ec" title="=&gt; scala.concurrent.ExecutionContext" class="delimiter">(</a><a href="#org.http4s.blaze.util;ProcessWriter.completionListener" title="(t: scala.util.Try[_], cb: ProcessWriter.this.CBType)Unit">completionListener</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.$anonfun.x$2" title="scala.util.Try[Unit]">_</a>, <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="ProcessWriter.this.CBType">cb</a><span class="delimiter">)</span><span class="delimiter">)</span>
      else <a href="#org.http4s.blaze.util;ProcessWriter.go" title="(p: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector], stack: Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]], cb: ProcessWriter.this.CBType)Unit">go</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.Try" title="(p: =&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">Try</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>.<span title="=&gt; scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]">head</span>.<span title="(v1: scalaz.stream.Cause)scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]">apply</span><span class="delimiter">(</span><span title="scalaz.stream.Cause.End.type">End</span><span class="delimiter">)</span>.<span title="(implicit ev: =:=[scalaz.Free[Function0,scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]],scalaz.Free.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">run</span><span class="delimiter">)</span>, <a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>.<span title="=&gt; scala.collection.immutable.Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">tail</span>, <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="ProcessWriter.this.CBType">cb</a><span class="delimiter">)</span>

    case Emit<span class="delimiter">(</span><span title="Seq[scodec.bits.ByteVector]">seq</span><span class="delimiter">)</span> =&gt;
      val <a title="scodec.bits.ByteVector" id="org.http4s.blaze.util;ProcessWriter.go.buff">buff</a> = <span title="Seq[scodec.bits.ByteVector]">seq</span>.<span title="(op: (scodec.bits.ByteVector, scodec.bits.ByteVector) =&gt; scodec.bits.ByteVector)scodec.bits.ByteVector">reduce</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.buff.$anonfun.x$3" title="scodec.bits.ByteVector">_</a> <span title="(other: scodec.bits.ByteVector)scodec.bits.ByteVector">++</span> <a href="#org.http4s.blaze.util;ProcessWriter.go.buff.$anonfun.x$4" title="scodec.bits.ByteVector">_</a><span class="delimiter">)</span>
      if <span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#org.http4s.blaze.util;ProcessWriter.writeEnd" title="(chunk: scodec.bits.ByteVector)scala.concurrent.Future[Unit]">writeEnd</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.buff" title="scodec.bits.ByteVector">buff</a><span class="delimiter">)</span>.<span title="(f: scala.util.Try[Unit] =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)Unit">onComplete</span><a href="#org.http4s.blaze.util;ProcessWriter.ec" title="=&gt; scala.concurrent.ExecutionContext" class="delimiter">(</a><a href="#org.http4s.blaze.util;ProcessWriter.completionListener" title="(t: scala.util.Try[_], cb: ProcessWriter.this.CBType)Unit">completionListener</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.$anonfun.x$5" title="scala.util.Try[Unit]">_</a>, <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="ProcessWriter.this.CBType">cb</a><span class="delimiter">)</span><span class="delimiter">)</span>
      else <a href="#org.http4s.blaze.util;ProcessWriter.writeBodyChunk" title="(chunk: scodec.bits.ByteVector, flush: Boolean)scala.concurrent.Future[Unit]">writeBodyChunk</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.buff" title="scodec.bits.ByteVector">buff</a>, false<span class="delimiter">)</span>.<span title="(f: scala.util.Try[Unit] =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)Unit">onComplete</span> <a href="#org.http4s.blaze.util;ProcessWriter.go.$anonfun.x0$1" title="Unit" class="delimiter">{</a>
        case Success<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze.util;ProcessWriter.go" title="(p: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector], stack: Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]], cb: ProcessWriter.this.CBType)Unit">go</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.Try" title="(p: =&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">Try</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>.<span title="(v1: scalaz.stream.Cause)scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]">head</span><span class="delimiter">(</span><span title="scalaz.stream.Cause.End.type">End</span><span class="delimiter">)</span>.<span title="(implicit ev: =:=[scalaz.Free[Function0,scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]],scalaz.Free.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">run</span><span class="delimiter">)</span>, <a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>.<span title="=&gt; scala.collection.immutable.Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">tail</span>, <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="ProcessWriter.this.CBType">cb</a><span class="delimiter">)</span>
        case Failure<span class="delimiter">(</span><span title="Throwable">t</span><span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze.util;ProcessWriter.go" title="(p: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector], stack: Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]], cb: ProcessWriter.this.CBType)Unit">go</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.Try" title="(p: =&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">Try</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>.<span title="(v1: scalaz.stream.Cause)scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]">head</span><span class="delimiter">(</span><span title="scalaz.stream.Cause.type">Cause</span>.<span title="(rsn: Throwable)scalaz.stream.Cause.Error">Error</span><span class="delimiter">(</span><span title="Throwable">t</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit ev: =:=[scalaz.Free[Function0,scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]],scalaz.Free.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">run</span><span class="delimiter">)</span>, <a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>.<span title="=&gt; scala.collection.immutable.Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">tail</span>, <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="ProcessWriter.this.CBType">cb</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    case Await<span class="delimiter">(</span><span title="scalaz.concurrent.Task[Any]">t</span>, <a title="scalaz.\/[scalaz.stream.Cause.EarlyCause,Any] =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]" id="org.http4s.blaze.util;ProcessWriter.go.f">f</a><span class="delimiter">)</span> =&gt; <span title="scalaz.concurrent.Task[Any]">t</span>.<span title="(f: scalaz.\/[Throwable,Any] =&gt; Unit)Unit">runAsync</span> <a href="#org.http4s.blaze.util;ProcessWriter.go.$anonfun.x0$2" title="Unit" class="delimiter">{</a>  <span class="comment">// Wait for it to finish, then continue to unwind</span>
      case <a title="scalaz.\/-[Any]" id="org.http4s.blaze.util;ProcessWriter.go.$anonfun.r">r</a>@ \/-<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze.util;ProcessWriter.go" title="(p: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector], stack: Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]], cb: ProcessWriter.this.CBType)Unit">go</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.Try" title="(p: =&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">Try</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.f" title="(v1: scalaz.\/[scalaz.stream.Cause.EarlyCause,Any])scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]">f</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.$anonfun.r" title="scalaz.\/-[Any]">r</a><span class="delimiter">)</span>.<span title="(implicit ev: =:=[scalaz.Free[Function0,scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]],scalaz.Free.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">run</span><span class="delimiter">)</span>, <a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>, <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="ProcessWriter.this.CBType">cb</a><span class="delimiter">)</span>
      case -\/<span class="delimiter">(</span><span title="Throwable">t</span><span class="delimiter">)</span>    =&gt; <a href="#org.http4s.blaze.util;ProcessWriter.go" title="(p: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector], stack: Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]], cb: ProcessWriter.this.CBType)Unit">go</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.Try" title="(p: =&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">Try</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.f" title="(v1: scalaz.\/[scalaz.stream.Cause.EarlyCause,Any])scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]">f</a><span class="delimiter">(</span><span title="(a: scalaz.stream.Cause.Error)scalaz.-\/[scalaz.stream.Cause.Error]">-\/</span><span class="delimiter">(</span><span title="(rsn: Throwable)scalaz.stream.Cause.Error">Error</span><span class="delimiter">(</span><span title="Throwable">t</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit ev: =:=[scalaz.Free[Function0,scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]],scalaz.Free.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">run</span><span class="delimiter">)</span>, <a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>, <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="ProcessWriter.this.CBType">cb</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    case Append<span class="delimiter">(</span><a title="scalaz.stream.Process.HaltEmitOrAwait[scalaz.concurrent.Task,scodec.bits.ByteVector]" id="org.http4s.blaze.util;ProcessWriter.go.head">head</a>, <a title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]" id="org.http4s.blaze.util;ProcessWriter.go.tail">tail</a><span class="delimiter">)</span> =&gt;
      if <span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <a href="#org.http4s.blaze.util;ProcessWriter.go" title="(p: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector], stack: Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]], cb: ProcessWriter.this.CBType)Unit">go</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.head" title="scalaz.stream.Process.HaltEmitOrAwait[scalaz.concurrent.Task,scodec.bits.ByteVector]">head</a>, <a href="#org.http4s.blaze.util;ProcessWriter.go.tail" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">tail</a> <span title="(that: scala.collection.GenTraversableOnce[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]],scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]],Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]])Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">++</span> <a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>, <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="ProcessWriter.this.CBType">cb</a><span class="delimiter">)</span>
      else <a href="#org.http4s.blaze.util;ProcessWriter.go" title="(p: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector], stack: Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]], cb: ProcessWriter.this.CBType)Unit">go</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.head" title="scalaz.stream.Process.HaltEmitOrAwait[scalaz.concurrent.Task,scodec.bits.ByteVector]">head</a>, <a href="#org.http4s.blaze.util;ProcessWriter.go.tail" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">tail</a>, <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="ProcessWriter.this.CBType">cb</a><span class="delimiter">)</span>

    case Halt<span class="delimiter">(</span><span title="scalaz.stream.Cause">cause</span><span class="delimiter">)</span> if <a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>.<span title="=&gt; Boolean">nonEmpty</span> =&gt; <a href="#org.http4s.blaze.util;ProcessWriter.go" title="(p: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector], stack: Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]], cb: ProcessWriter.this.CBType)Unit">go</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.Try" title="(p: =&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">Try</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>.<span title="(v1: scalaz.stream.Cause)scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]">head</span><span class="delimiter">(</span><span title="scalaz.stream.Cause">cause</span><span class="delimiter">)</span>.<span title="(implicit ev: =:=[scalaz.Free[Function0,scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]],scalaz.Free.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">run</span><span class="delimiter">)</span>, <a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>.<span title="=&gt; scala.collection.immutable.Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">tail</span>, <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="ProcessWriter.this.CBType">cb</a><span class="delimiter">)</span>

    <span class="comment">// Rest are terminal cases</span>
    case Halt<span class="delimiter">(</span><span title="scalaz.stream.Cause.End.type">End</span><span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze.util;ProcessWriter.writeEnd" title="(chunk: scodec.bits.ByteVector)scala.concurrent.Future[Unit]">writeEnd</a><span class="delimiter">(</span><span title="scodec.bits.ByteVector.type">ByteVector</span>.<span title="=&gt; scodec.bits.ByteVector">empty</span><span class="delimiter">)</span>.<span title="(f: scala.util.Try[Unit] =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)Unit">onComplete</span><a href="#org.http4s.blaze.util;ProcessWriter.ec" title="=&gt; scala.concurrent.ExecutionContext" class="delimiter">(</a><a href="#org.http4s.blaze.util;ProcessWriter.completionListener" title="(t: scala.util.Try[_], cb: ProcessWriter.this.CBType)Unit">completionListener</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.$anonfun.x$6" title="scala.util.Try[Unit]">_</a>, <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="ProcessWriter.this.CBType">cb</a><span class="delimiter">)</span><span class="delimiter">)</span>

    case Halt<span class="delimiter">(</span><span title="scalaz.stream.Cause.Kill.type">Kill</span><span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze.util;ProcessWriter.writeEnd" title="(chunk: scodec.bits.ByteVector)scala.concurrent.Future[Unit]">writeEnd</a><span class="delimiter">(</span><span title="scodec.bits.ByteVector.type">ByteVector</span>.<span title="=&gt; scodec.bits.ByteVector">empty</span><span class="delimiter">)</span>
                         .<span title="(f: Unit =&gt; scala.concurrent.Future[Unit])(implicit executor: scala.concurrent.ExecutionContext)scala.concurrent.Future[Unit]">flatMap</span><a href="#org.http4s.blaze.util;ProcessWriter.ec" title="=&gt; scala.concurrent.ExecutionContext" class="delimiter">(</a><a title="Unit" id="org.http4s.blaze.util;ProcessWriter.go.$anonfun.x$7">_</a> =&gt; <a href="#org.http4s.blaze.util;ProcessWriter.exceptionFlush" title="()scala.concurrent.Future[Unit]">exceptionFlush</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
                         .<span title="(f: scala.util.Try[Unit] =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)Unit">onComplete</span><a href="#org.http4s.blaze.util;ProcessWriter.ec" title="=&gt; scala.concurrent.ExecutionContext" class="delimiter">(</a><a href="#org.http4s.blaze.util;ProcessWriter.completionListener" title="(t: scala.util.Try[_], cb: ProcessWriter.this.CBType)Unit">completionListener</a><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.go.$anonfun.x$8" title="scala.util.Try[Unit]">_</a>, <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="ProcessWriter.this.CBType">cb</a><span class="delimiter">)</span><span class="delimiter">)</span>

    case Halt<span class="delimiter">(</span>Error<span class="delimiter">(</span>Terminated<span class="delimiter">(</span><span title="scalaz.stream.Cause">cause</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze.util;ProcessWriter.go" title="(p: scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector], stack: Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]], cb: ProcessWriter.this.CBType)Unit">go</a><span class="delimiter">(</span><span title="(cause: scalaz.stream.Cause)scalaz.stream.Process.Halt">Halt</span><span class="delimiter">(</span><span title="scalaz.stream.Cause">cause</span><span class="delimiter">)</span>, <a href="#org.http4s.blaze.util;ProcessWriter.go.stack" title="Vector[scalaz.stream.Cause =&gt; scalaz.stream.Process.Trampoline[scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]]]">stack</a>, <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="ProcessWriter.this.CBType">cb</a><span class="delimiter">)</span>

    case Halt<span class="delimiter">(</span>Error<span class="delimiter">(</span><span title="Throwable">t</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze.util;ProcessWriter.exceptionFlush" title="()scala.concurrent.Future[Unit]">exceptionFlush</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(f: scala.util.Try[Unit] =&gt; Unit)(implicit executor: scala.concurrent.ExecutionContext)Unit">onComplete</span> <a href="#org.http4s.blaze.util;ProcessWriter.go.$anonfun.x0$3" title="Unit" class="delimiter">{</a>
      case Success<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="(v1: scalaz.\/[Throwable,Unit])Unit">cb</a><span class="delimiter">(</span><span title="(a: Throwable)scalaz.-\/[Throwable]">-\/</span><span class="delimiter">(</span><span title="Throwable">t</span><span class="delimiter">)</span><span class="delimiter">)</span>
      case Failure<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="#org.http4s.blaze.util;ProcessWriter.go.cb" title="(v1: scalaz.\/[Throwable,Unit])Unit">cb</a><span class="delimiter">(</span><span title="(a: Throwable)scalaz.-\/[Throwable]">-\/</span><span class="delimiter">(</span><span title="Throwable">t</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  private def <a title="(t: scala.util.Try[_], cb: ProcessWriter.this.CBType)Unit" id="org.http4s.blaze.util;ProcessWriter.completionListener">completionListener</a><span class="delimiter">(</span><span title="scala.util.Try[_]">t</span>: <span title="scala.util.Try[_]">Try</span><span class="delimiter">[</span>_<span class="delimiter">]</span>, <a title="ProcessWriter.this.CBType" id="org.http4s.blaze.util;ProcessWriter.completionListener.cb">cb</a>: <span title="ProcessWriter.this.CBType">CBType</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="scala.util.Try[_]">t</span> match <span class="delimiter">{</span>
    case Success<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;  <a href="#org.http4s.blaze.util;ProcessWriter.completionListener.cb" title="(v1: scalaz.\/[Throwable,Unit])Unit">cb</a><span class="delimiter">(</span><span title="(b: Unit)scalaz.\/-[Unit]">\/-</span><span class="delimiter">(</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    case Failure<span class="delimiter">(</span><span title="Throwable">t</span><span class="delimiter">)</span> =&gt;  <a href="#org.http4s.blaze.util;ProcessWriter.completionListener.cb" title="(v1: scalaz.\/[Throwable,Unit])Unit">cb</a><span class="delimiter">(</span><span title="(a: Throwable)scalaz.-\/[Throwable]">-\/</span><span class="delimiter">(</span><span title="Throwable">t</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  @inline
  private def <a title="(p: =&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector])scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]" id="org.http4s.blaze.util;ProcessWriter.Try">Try</a><span class="delimiter">(</span><a title="=&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]" id="org.http4s.blaze.util;ProcessWriter.Try.p">p</a>: =&gt; Process<span class="delimiter">[</span>Task, ByteVector<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">Process</span><span class="delimiter">[</span>Task, ByteVector<span class="delimiter">]</span> = <span class="delimiter">{</span>
    try <a href="#org.http4s.blaze.util;ProcessWriter.Try.p" title="=&gt; scalaz.stream.Process[scalaz.concurrent.Task,scodec.bits.ByteVector]">p</a>
    catch <span class="delimiter">{</span> case <a title="Throwable" id="org.http4s.blaze.util;ProcessWriter.Try.t">t</a>: <span title="Throwable">Throwable</span> =&gt; <span title="scalaz.stream.Process.type">Process</span>.<span title="(rsn: Throwable)scalaz.stream.Process0[Nothing]">fail</span><span class="delimiter">(</span><a href="#org.http4s.blaze.util;ProcessWriter.Try.t" title="Throwable">t</a><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>
